<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SpringCloud | donn的博客</title><meta name="author" content="donn"><meta name="copyright" content="donn"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本博客参照了韩顺平老师的 Sping Cloud 课程讲义！ 1 Spring Cloud 基本介绍1.1 官方文档1.1.1地址**: https:&#x2F;&#x2F;spring.io&#x2F;projects&#x2F;spring-cloud**1.2 微服务引出1.没有微服务技术**,是不是程序员就不能开发大型项目?**​		是可以的, 对大型项目进行模块划分,对各个模块进行实现, 模块之间更多的是以API调用完成,耦">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringCloud">
<meta property="og:url" content="https://tangjiayang.github.io/2023/06/02/SpringCloud/index.html">
<meta property="og:site_name" content="donn的博客">
<meta property="og:description" content="本博客参照了韩顺平老师的 Sping Cloud 课程讲义！ 1 Spring Cloud 基本介绍1.1 官方文档1.1.1地址**: https:&#x2F;&#x2F;spring.io&#x2F;projects&#x2F;spring-cloud**1.2 微服务引出1.没有微服务技术**,是不是程序员就不能开发大型项目?**​		是可以的, 对大型项目进行模块划分,对各个模块进行实现, 模块之间更多的是以API调用完成,耦">
<meta property="og:locale">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2023-06-02T07:24:09.000Z">
<meta property="article:modified_time" content="2023-08-02T15:11:53.876Z">
<meta property="article:author" content="donn">
<meta property="article:tag" content="SpringCloud">
<meta property="article:tag" content="微服务">
<meta property="article:tag" content="分布式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://tangjiayang.github.io/2023/06/02/SpringCloud/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":30,"languages":{"author":"Author: donn","link":"Link: ","source":"Source: donn的博客","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SpringCloud',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-08-02 23:11:53'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/bg.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">12</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="donn的博客"><span class="site-name">donn的博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SpringCloud</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-06-02T07:24:09.000Z" title="Created 2023-06-02 15:24:09">2023-06-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-08-02T15:11:53.876Z" title="Updated 2023-08-02 23:11:53">2023-08-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Spring%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/">Spring开发框架</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">38.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>164min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SpringCloud"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p> 本博客参照了韩顺平老师的 Sping Cloud 课程讲义！</p>
<h1 id="1-Spring-Cloud-基本介绍"><a href="#1-Spring-Cloud-基本介绍" class="headerlink" title="1 Spring Cloud 基本介绍"></a><strong>1 Spring Cloud</strong> 基本介绍</h1><h2 id="1-1-官方文档"><a href="#1-1-官方文档" class="headerlink" title="1.1 官方文档"></a>1.1 官方文档</h2><h3 id="1-1-1"><a href="#1-1-1" class="headerlink" title="1.1.1"></a>1.1.1</h3><h3 id="地址-https-spring-io-projects-spring-cloud"><a href="#地址-https-spring-io-projects-spring-cloud" class="headerlink" title="地址**: https://spring.io/projects/spring-cloud**"></a>地址**: <a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud">https://spring.io/projects/spring-cloud</a>**</h3><h2 id="1-2-微服务引出"><a href="#1-2-微服务引出" class="headerlink" title="1.2 微服务引出"></a>1.2 微服务引出</h2><h3 id="1-没有微服务技术-是不是程序员就不能开发大型项目"><a href="#1-没有微服务技术-是不是程序员就不能开发大型项目" class="headerlink" title="1.没有微服务技术**,是不是程序员就不能开发大型项目?**"></a>1.没有微服务技术**,<strong>是不是程序员就不能开发大型项目</strong>?**</h3><p>​		<strong>是可以的, 对大型项目进行模块划分,对各个模块进行实现, 模块之间更多的是以API调用完成,耦合度较高, 不利于扩展和维护。</strong></p>
<h3 id="2-标准的微服务解决方案-springcloud-和cloud-alibaba-出现原因和价值是什么"><a href="#2-标准的微服务解决方案-springcloud-和cloud-alibaba-出现原因和价值是什么" class="headerlink" title="2.标准的微服务解决方案(springcloud 和cloud alibaba)出现原因和价值是什么?"></a>2.标准的微服务解决方案(springcloud 和cloud alibaba)出现原因和价值是什么?</h3><p>​		<strong>(1)</strong> **微服务可以根据业务不同，将一个大项目 , 分解成不同的服务(微服务，比如搜 索服务&#x2F;网关服务&#x2F;配置服务&#x2F;存储服务&#x2F;发现服务等等) **</p>
<p>​		<strong>(2)各个服务通过分布式方式进行工 作，从而可以高效，快速，稳定的完成复杂的功能</strong></p>
<p>​		<strong>(3) 如果小伙伴还不理解, 你也可以理解成就 将原来大项目的某些模块-&gt;抽出形成微服务-&gt;配合分布式工作方式-&gt;从而高效，快速，稳定的完成复杂业务功能。</strong></p>
<h3 id="3-一图胜千言"><a href="#3-一图胜千言" class="headerlink" title="3. 一图胜千言"></a>3. 一图胜千言</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519160836110.png" alt="image-20230519160836110"></p>
<h2 id="1-3-系统架构的演变过程"><a href="#1-3-系统架构的演变过程" class="headerlink" title="1.3 系统架构的演变过程"></a>1.3 系统架构的演变过程</h2><h3 id="1-3-1单体架构："><a href="#1-3-1单体架构：" class="headerlink" title="1.3.1单体架构："></a>1.3.1单体架构：</h3><p>​	<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519161225897.png" alt="image-20230519161225897"></p>
<p>仅适合少量用户的情况</p>
<p>如果用户量大，server无法响应大量请求；大量操作数据库的语句冲垮DB</p>
<h3 id="1-3-2动静分离架构："><a href="#1-3-2动静分离架构：" class="headerlink" title="1.3.2动静分离架构："></a>1.3.2动静分离架构：</h3><p>​	<u>静态缓存+文件存储</u></p>
<p>动静分离：</p>
<p>1.对静态资源、动态资源的请求进行分离过滤，对于静态资源的请求，直接找资源服务器响应；对于动态服务器的请求才找到应用服务器进行响应。</p>
<p>2.对请求的数据进行缓存，使用redis等，降低数据库等负荷。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519162426761.png" alt="image-20230519162426761"></p>
<h3 id="1-3-3分布式架构："><a href="#1-3-3分布式架构：" class="headerlink" title="1.3.3分布式架构："></a>1.3.3分布式架构：</h3><p>​	<u>业务拆分+负载均衡</u></p>
<p>​	<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519163644982.png" alt="image-20230519163644982"></p>
<h3 id="1-3-4微服务架构："><a href="#1-3-4微服务架构：" class="headerlink" title="1.3.4微服务架构："></a>1.3.4微服务架构：</h3><p>​	<u>使用Spring Cloud</u></p>
<p><img src="https://mp.processon.com/chart_image/id/5c77d08ae4b0628e8208c507.png" alt="点击查看图片来源"></p>
<ul>
<li><p><strong>“微服务” 一词源于 Martin Fowler 的名为Microservices 的博文，简单地说， 微服 务是系统架构上的一种设计风格，它的主旨是<u>将一个原本独立的系统拆分成多个小型服务，这些小型服务都在各自独立的进程中运行</u>，服务之间通过基于HTTP 的 RESTful API 进行通信协作。</strong></p>
</li>
<li><p><strong>被拆分成的每一个小型服务都国绕着系统中的某一项或一些耦合度较高的业务功能进行构建， 并且每个服务都维护着自身的数据存储、业务开发、自动化测试案例以及独立部署机制。 由于有轻量级的通信协作基础，所以这些微服务可以使用不同的语言来编写，这里我们使用 java。</strong></p>
</li>
</ul>
<h2 id="1-4-Spring-Colud全面说明"><a href="#1-4-Spring-Colud全面说明" class="headerlink" title="1.4 Spring Colud全面说明"></a>1.4 Spring Colud全面说明</h2><h4 id="1-Springcloud-来源于-Spring，是更高层次的、-架构视角的综合性大型项目，-目标旨在构建一套标准化的微服务解决方案，让架构师在使用微服务理念构建系统的时，-面对各环节的问题都可以找到相应的组件来处理"><a href="#1-Springcloud-来源于-Spring，是更高层次的、-架构视角的综合性大型项目，-目标旨在构建一套标准化的微服务解决方案，让架构师在使用微服务理念构建系统的时，-面对各环节的问题都可以找到相应的组件来处理" class="headerlink" title="1.Springcloud 来源于 Spring，是更高层次的、 架构视角的综合性大型项目， 目标旨在构建一套标准化的微服务解决方案，让架构师在使用微服务理念构建系统的时， 面对各环节的问题都可以找到相应的组件来处理"></a>1.Springcloud 来源于 Spring，是更高层次的、 架构视角的综合性大型项目， 目标旨在构建一套标准化的微服务解决方案，让架构师在使用微服务理念构建系统的时， 面对各环节的问题都可以找到相应的组件来处理</h4><h4 id="2-Spring-Cloud-是Spring-社区为微服务架构提供的一个-“全家桶”-套餐。套餐中各个组件之间的配合，可以减少在组件的选型和整合上花费的精力，可以快速构建起基础的微服务架构系统，是微服务架构的最佳落地方案"><a href="#2-Spring-Cloud-是Spring-社区为微服务架构提供的一个-“全家桶”-套餐。套餐中各个组件之间的配合，可以减少在组件的选型和整合上花费的精力，可以快速构建起基础的微服务架构系统，是微服务架构的最佳落地方案" class="headerlink" title="2.Spring Cloud 是Spring 社区为微服务架构提供的一个 “全家桶” 套餐。套餐中各个组件之间的配合，可以减少在组件的选型和整合上花费的精力，可以快速构建起基础的微服务架构系统，是微服务架构的最佳落地方案"></a>2.Spring Cloud 是Spring 社区为微服务架构提供的一个 “全家桶” 套餐。套餐中各个组件之间的配合，可以减少在组件的选型和整合上花费的精力，可以快速构建起基础的微服务架构系统，是微服务架构的最佳落地方案</h4><h4 id="3-Spirng-Cloud-天然支持-spring-Boot-有版本对应要求-，使用门槛较低"><a href="#3-Spirng-Cloud-天然支持-spring-Boot-有版本对应要求-，使用门槛较低" class="headerlink" title="3.Spirng Cloud 天然支持 spring Boot(有版本对应要求)，使用门槛较低"></a>3.Spirng Cloud 天然支持 spring Boot(有版本对应要求)，使用门槛较低</h4><h4 id="4-解决与分布式系统相关的复杂性-一网络问题，延迟开销，带宽向题，安全问题"><a href="#4-解决与分布式系统相关的复杂性-一网络问题，延迟开销，带宽向题，安全问题" class="headerlink" title="4.解决与分布式系统相关的复杂性 一网络问题，延迟开销，带宽向题，安全问题"></a>4.解决与分布式系统相关的复杂性 一网络问题，延迟开销，带宽向题，安全问题</h4><h4 id="5-处理服务发现的能力-一-服务发现允许集群中的进程和服务找到彼此并进行通信"><a href="#5-处理服务发现的能力-一-服务发现允许集群中的进程和服务找到彼此并进行通信" class="headerlink" title="5.处理服务发现的能力 一 服务发现允许集群中的进程和服务找到彼此并进行通信"></a>5.处理服务发现的能力 一 服务发现允许集群中的进程和服务找到彼此并进行通信</h4><h4 id="6-解決冗余问题-一-元余问题经常发生在分布式系统中"><a href="#6-解決冗余问题-一-元余问题经常发生在分布式系统中" class="headerlink" title="6.解決冗余问题 一 元余问题经常发生在分布式系统中"></a>6.解決冗余问题 一 元余问题经常发生在分布式系统中</h4><h4 id="7-解决负载均衡-一-改进跨多个计算资源（例如计算机集群，网络链接，中央处理单元）的工作负载分布"><a href="#7-解决负载均衡-一-改进跨多个计算资源（例如计算机集群，网络链接，中央处理单元）的工作负载分布" class="headerlink" title="7.解决负载均衡 一 改进跨多个计算资源（例如计算机集群，网络链接，中央处理单元）的工作负载分布"></a>7.解决负载均衡 一 改进跨多个计算资源（例如计算机集群，网络链接，中央处理单元）的工作负载分布</h4><h2 id="1-5-Spring-Cloud-核心组件图"><a href="#1-5-Spring-Cloud-核心组件图" class="headerlink" title="1.5 Spring Cloud 核心组件图"></a>1.5 Spring Cloud 核心组件图</h2><h3 id="1-5-1-文档-https-spring-io-projects-spring-cloud"><a href="#1-5-1-文档-https-spring-io-projects-spring-cloud" class="headerlink" title="1.5.1 文档 : https://spring.io/projects/spring-cloud"></a><strong>1.5.1</strong> 文档 <strong>: <a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud">https://spring.io/projects/spring-cloud</a></strong></h3><h3 id="1-5-2一图胜千言"><a href="#1-5-2一图胜千言" class="headerlink" title="1.5.2一图胜千言"></a>1.5.2一图胜千言</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519184405128.png" alt="image-20230519184405128"></p>
<h2 id="1-6-Spring-Cloud-分布式示意图"><a href="#1-6-Spring-Cloud-分布式示意图" class="headerlink" title="1.6 Spring Cloud 分布式示意图"></a>1.6 Spring Cloud 分布式示意图</h2><h3 id="1-6-1-文档-https-spring-io-microservices"><a href="#1-6-1-文档-https-spring-io-microservices" class="headerlink" title="1.6.1 文档 : https://spring.io/microservices"></a><strong>1.6.1</strong> 文档 <strong>: <a target="_blank" rel="noopener" href="https://spring.io/microservices">https://spring.io/microservices</a></strong></h3><h3 id="1-6-2-一图胜千言"><a href="#1-6-2-一图胜千言" class="headerlink" title="1.6.2 一图胜千言"></a><strong>1.6.2</strong> 一图胜千言</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519185237018.png" alt="image-20230519185237018"></p>
<ol>
<li><p>Spring cloud 是微服务的落地</p>
</li>
<li><p>Spring cloud 体现了微服务的弹性设计</p>
</li>
<li><p>微服务的工作方式一般是基于分布式的。</p>
</li>
<li><p>Spring Cloud 仍然是 Spring 家族一员，可以解决微服务的分布式工作方式带来的各种问题</p>
</li>
<li><p>Spring Cloud 提供很多组件，比如 服务发现，负载均街，链路中断，分布式追踪和监控，甚至提供 API gateway 功能.</p>
</li>
</ol>
<h3 id="1-6-3-SpringCloud和SpringBoot版本对应关系"><a href="#1-6-3-SpringCloud和SpringBoot版本对应关系" class="headerlink" title="1.6.3 SpringCloud和SpringBoot版本对应关系"></a><strong>1.6.3 SpringCloud</strong>和<strong>SpringBoot</strong>版本对应关系</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519190708371.png" alt="image-20230519190708371"></p>
<h2 id="1-7-Spring-Cloud-组件选型"><a href="#1-7-Spring-Cloud-组件选型" class="headerlink" title="1.7 Spring Cloud 组件选型"></a>1.7 Spring Cloud 组件选型</h2><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519190901580.png" alt="image-20230519190901580"></p>
<h1 id="2-Spring-Cloud-Alibaba-基本介绍"><a href="#2-Spring-Cloud-Alibaba-基本介绍" class="headerlink" title="2 Spring Cloud Alibaba 基本介绍"></a><strong>2 Spring Cloud Alibaba</strong> 基本介绍</h1><h2 id="2-1-官方文档"><a href="#2-1-官方文档" class="headerlink" title="2.1 官方文档"></a>2.1 官方文档</h2><h3 id="2-1-1-英文地址-https-github-com-alibaba-spring-cloud-alibaba"><a href="#2-1-1-英文地址-https-github-com-alibaba-spring-cloud-alibaba" class="headerlink" title="2.1.1 英文地址**: https://github.com/alibaba/spring-cloud-alibaba**"></a><strong>2.1.1</strong> 英文地址**: <a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba">https://github.com/alibaba/spring-cloud-alibaba</a>**</h3><h3 id="2-1-2英-文-地-址-中-文-文-档-https-github-com-alibaba-spring-cloud-alibaba-blob-master-README-zh-md"><a href="#2-1-2英-文-地-址-中-文-文-档-https-github-com-alibaba-spring-cloud-alibaba-blob-master-README-zh-md" class="headerlink" title="2.1.2英 文 地 址 : 中 文 文 档 : https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md"></a><strong>2.1.2</strong>英 文 地 址 <strong>:</strong> 中 文 文 档 <strong>: <a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></strong></h3><h2 id="2-2-SpringCloudAlibaba是什么"><a href="#2-2-SpringCloudAlibaba是什么" class="headerlink" title="2.2 SpringCloudAlibaba是什么"></a>2.2 SpringCloudAlibaba是什么</h2><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519192136898.png" alt="image-20230519192136898"></p>
<h2 id="2-3-主要功能一览"><a href="#2-3-主要功能一览" class="headerlink" title="2.3 主要功能一览"></a>2.3 主要功能一览</h2><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519192150299.png" alt="image-20230519192150299"></p>
<h2 id="2-4-Spring-Cloud-Alibaba-核心组件"><a href="#2-4-Spring-Cloud-Alibaba-核心组件" class="headerlink" title="2.4 Spring Cloud Alibaba 核心组件"></a>2.4 Spring Cloud Alibaba 核心组件</h2><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519192202912.png" alt="image-20230519192202912"></p>
<h2 id="2-5-分布式微服务技术选型"><a href="#2-5-分布式微服务技术选型" class="headerlink" title="2.5: 分布式微服务技术选型"></a>2.5: 分布式微服务技术选型</h2><h3 id="•Spring-Cloud-原生组件的几大痛点"><a href="#•Spring-Cloud-原生组件的几大痛点" class="headerlink" title="•Spring Cloud 原生组件的几大痛点"></a>•Spring Cloud 原生组件的几大痛点</h3><p>1.Spring Cloud 部分组件停止维护和更新，给开发带来不便</p>
<p>2.Spring cioud 部分环境搭建复杂，没有完善的可视化界面，我们需要大量的二次开发和定制</p>
<p>3.Spring Cloud 配置复杂，难以上手</p>
<h3 id="•Spring-Cloud-Alibaba-的优势"><a href="#•Spring-Cloud-Alibaba-的优势" class="headerlink" title="•Spring Cloud Alibaba 的优势"></a>•Spring Cloud Alibaba 的优势</h3><ol>
<li>阿里使用过的组件经历了考验（高并发，高性能，高可用，性能强悍，设计合理，现在开源</li>
</ol>
<p>出来供大家使用。</p>
<ol start="2">
<li>搭配完善的可视化界面，给开发运维带来极大的便利搭建简单，学习曲线低。</li>
</ol>
<ul>
<li><h3 id="分布式微服务技术选型建议"><a href="#分布式微服务技术选型建议" class="headerlink" title="分布式微服务技术选型建议"></a><strong>分布式微服务技术选型建议</strong></h3></li>
</ul>
<p>以Spring Cloud Alibaba为主，以Spring Cloud 原生组件为辅。</p>
<h1 id="3-微服务基础环境搭建"><a href="#3-微服务基础环境搭建" class="headerlink" title="3 微服务基础环境搭建"></a>3 微服务基础环境搭建</h1><h2 id="3-1-创建父工程-，用于聚合其它微服务模块"><a href="#3-1-创建父工程-，用于聚合其它微服务模块" class="headerlink" title="3.1 创建父工程 ，用于聚合其它微服务模块"></a>3.1 创建父工程 ，用于聚合其它微服务模块</h2><h3 id="3-1-1-需求说明-x2F-图解"><a href="#3-1-1-需求说明-x2F-图解" class="headerlink" title="3.1.1 需求说明**&#x2F;**图解"></a><strong>3.1.1</strong> 需求说明**&#x2F;**图解</h3><h3 id="3-1-2-实现步骤"><a href="#3-1-2-实现步骤" class="headerlink" title="3.1.2 实现步骤"></a><strong>3.1.2</strong> 实现步骤</h3><h4 id="3-1-2-1-创建父项目-作为聚合其它微服务模块"><a href="#3-1-2-1-创建父项目-作为聚合其它微服务模块" class="headerlink" title="3.1.2.1 创建父项目, 作为聚合其它微服务模块"></a>3.1.2.1 创建父项目, 作为聚合其它微服务模块</h4><p>###我们先创建一个父项目**,** 该父项目会去管理多个微服务模块(module)</p>
<p>Maven创建项目 使用webapp Maven工件</p>
<h4 id="3-1-2-2-项目设置"><a href="#3-1-2-2-项目设置" class="headerlink" title="3.1.2.2 项目设置"></a>3.1.2.2 项目设置</h4><ol>
<li></li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519194056058.png" alt="image-20230519194056058"></p>
<ol start="2">
<li></li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519194231324.png" alt="image-20230519194231324"></p>
<p>3.父项目本身不写代码，是用来进行管理的</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519194329079.png" alt="image-20230519194329079"></p>
<h4 id="3-1-2-4-配置父工程-pom-xml-作为聚合其它模块"><a href="#3-1-2-4-配置父工程-pom-xml-作为聚合其它模块" class="headerlink" title="3.1.2.4 配置父工程 pom.xml, 作为聚合其它模块"></a>3.1.2.4 配置父工程 pom.xml, 作为聚合其它模块</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.study.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e-commerce-center<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  表明是一个父工程，用于聚合管理其他模块--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>e-commerce-center Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      老师说明: 使用最新版本的 log4j , 防止安全漏洞</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>2.17.2<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.31<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis.spring.boot.version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">mybatis.spring.boot.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  1. dependencyManagement 作用: 子模块继承后, 锁定版本,</span></span><br><span class="line"><span class="comment">  子模块不用再写 version --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      老师解读:</span></span><br><span class="line"><span class="comment">      1. type: pom 和 scope import 配合使用</span></span><br><span class="line"><span class="comment">      2. 表示 父项目的子模块, 在引入 springboot 相关依赖时 锁定版本为</span></span><br><span class="line"><span class="comment">      3. 通过 pom + import 解决 maven 单继承机制</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.SR1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-3-注意事项和细节"><a href="#3-1-3-注意事项和细节" class="headerlink" title="3.1.3 注意事项和细节"></a><strong>3.1.3</strong> 注意事项和细节</h3><h4 id="3-1-3-1-Maven的dependencyManagement说明"><a href="#3-1-3-1-Maven的dependencyManagement说明" class="headerlink" title="3.1.3.1 Maven的dependencyManagement说明"></a>3.1.3.1 Maven的dependencyManagement说明</h4><p>1、Maven 使用 dependencyManagement 元素来提供了一种管理依赖版本号的方式。通常在项目</p>
<p>packaging 为 POM，中使用dependencvManadement 元素。</p>
<p>2、使用pom.xml 中的dependencyManagement 元素能让所有在子项目中引用一个依赖， Maven 会沿着父子层次向上走，直到找到一个拥有dependencyManagement 元素的项目，然后它就会使用这个dependencyManagement 元素中指定的版本号。</p>
<p>3、好处：如果有多个子项目都号1用同一样依赖，则可以避免在每个使用的子项目里都声明一个版本号，当开级或切换到另一个版本时，只需要在顶层父容器里更新，而不需要分别在子项目的修改;另外如果某个子项目需要另外的一个版本，只需要声明version 就可。</p>
<p>4、dependency Management 里只是声明依赖，并不实现引入，因此子项目需要显示的声明需要用的依赖。</p>
<p>5、如果不在子项目中声明依赖，是不会从父项目中继承下来的；只有在子项目中写了该依赖项，并且没有指定具体版本，才会从父项目中继承该项，并且version 和 scope 都读取自父 pom</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519202427190.png" alt="image-20230519202427190" style="zoom:50%;" />

<p>6、如果子项目中指定了版本号，那么会使用子项目中指定的 jar 版本</p>
<h2 id="3-2-创建会员中心微服务模块-service-provider"><a href="#3-2-创建会员中心微服务模块-service-provider" class="headerlink" title="3.2 创建会员中心微服务模块 -service provider"></a>3.2 创建会员中心微服务模块 -service provider</h2><h3 id="3-2-1-需求说明"><a href="#3-2-1-需求说明" class="headerlink" title="3.2.1 需求说明"></a><strong>3.2.1</strong> 需求说明</h3><h4 id="1、通过浏览器可以获取会员信息-通过会员中心微服务模块"><a href="#1、通过浏览器可以获取会员信息-通过会员中心微服务模块" class="headerlink" title="1、通过浏览器可以获取会员信息**(通过会员中心微服务模块)**"></a><strong>1</strong>、通过浏览器可以获取会员信息**(<strong>通过会员中心微服务模块</strong>)**</h4><h3 id="3-2-2-思路分析"><a href="#3-2-2-思路分析" class="headerlink" title="3.2.2 思路分析"></a><strong>3.2.2</strong> 思路分析</h3><p>1、创建 Moduel &amp; 完成配置</p>
<p>2、创建数据库&#x2F;表</p>
<p>3、创建 entity-dao&#x2F;Mapper.xml-service-controller</p>
<p>4、完成测试</p>
<h3 id="3-2-3-实现步骤"><a href="#3-2-3-实现步骤" class="headerlink" title="3.2.3 实现步骤"></a><strong>3.2.3</strong> 实现步骤</h3><p>​	application.yml:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-provider-10000</span>	<span class="comment">#名称，可以自己指定</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/booking?characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">QWEASDzxc123</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span> <span class="comment">#后面 mapper 文件的位置</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.study.springcloud.entity</span>  <span class="comment">#实体类的包路径</span></span><br></pre></td></tr></table></figure>

<p>MemberMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.study.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e-commerce-center<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>member-service-provider-10000<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;packaging&gt;war&lt;/packaging&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>member-service-provider-10000 Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        使用版本仲裁，从父项目中获取版本--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        springboot程序的监控系统，实现系统健康检测</span></span><br><span class="line"><span class="comment">            可以通过 http://localhost:10000/actuator 看到相关连接</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>member-service-provider-10000<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-4-🌟注意事项和细节"><a href="#3-2-4-🌟注意事项和细节" class="headerlink" title="3.2.4 🌟注意事项和细节"></a><strong>3.2.4</strong> 🌟注意事项和细节</h3><p><strong>传输javabean时</strong></p>
<p>1、我们的前端如果是以 <strong>json 格式</strong>来发送添加信息Member，那么我们<strong>需要使用@RequestBody</strong>,</p>
<p>才能将数据封裝到对应的 bean，同时保证 http 的请求头的 content-type 是对应的</p>
<p>2、如果前端是以 <strong>表单</strong> 或者 <strong>parameters</strong> 形式提交， 则一定不能使用@RequestBody， 才</p>
<p>会进行对象参数封装，同时保证http 的请求头的 content-type 是对应</p>
<p>3、在进行 SpringBoot 应用程序测试时，引入的 jUnit 是ore.junit.jupiter.api.Test</p>
<p>4、 在运行程序时，一定要确保你的 XxxxMapper.xml 文件被自动放到的 target 目录的</p>
<p>classes 指定目录。</p>
<h2 id="3-3-创建使用会员微服务模块-service-consumer"><a href="#3-3-创建使用会员微服务模块-service-consumer" class="headerlink" title="3.3 创建使用会员微服务模块 -service consumer"></a>3.3 创建使用会员微服务模块 -service consumer</h2><h3 id="3-3-1-需求说明-x2F-图解"><a href="#3-3-1-需求说明-x2F-图解" class="headerlink" title="3.3.1 需求说明**&#x2F;**图解"></a><strong>3.3.1</strong> 需求说明**&#x2F;**图解</h3><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230520114632421.png" alt="image-20230520114632421" style="zoom:30%;" />

<p>-浏览器: <a target="_blank" rel="noopener" href="http://localhost/member/consumer/get/1">http://localhost/member/consumer/get/1</a></p>
<p>-测试添加会员 : <a target="_blank" rel="noopener" href="http://localhost/member/consumer/save">http://localhost/member/consumer/save</a></p>
<h3 id="3-3-2-思路分析-x2F-图解"><a href="#3-3-2-思路分析-x2F-图解" class="headerlink" title="3.3.2 思路分析**&#x2F;**图解"></a><strong>3.3.2</strong> 思路分析**&#x2F;**图解</h3><p>1、创建 Moduel(member-service-consumer-80) ＆ 完成配罝</p>
<p>2、创建 controller</p>
<p>3、完成测试</p>
<h3 id="3-3-3-实现步骤"><a href="#3-3-3-实现步骤" class="headerlink" title="3.3.3 实现步骤"></a><strong>3.3.3</strong> 实现步骤</h3><h4 id="3-3-3-1-创建-Moduel-amp-完成配置"><a href="#3-3-3-1-创建-Moduel-amp-完成配置" class="headerlink" title="3.3.3.1 创建 Moduel &amp; 完成配置"></a>3.3.3.1 创建 Moduel &amp; 完成配置</h4><h5 id="创建Moduel："><a href="#创建Moduel：" class="headerlink" title="创建Moduel："></a>创建Moduel：</h5><p>在创建Moduel后，其父工程的 pom.xml 会做相应变化，在<modules>标签中增加管理member-service-consumer-80微服务模块</p>
<h5 id="完成配置："><a href="#完成配置：" class="headerlink" title="完成配置："></a>完成配置：</h5><p>pom.xml &#x2F; application.yaml 可参考之前写的，取自己需要的即可。</p>
<h5 id="注入-RestTemplate："><a href="#注入-RestTemplate：" class="headerlink" title="注入 RestTemplate："></a>注入 RestTemplate：</h5><h6 id="RestTemplate基本介绍："><a href="#RestTemplate基本介绍：" class="headerlink" title="RestTemplate基本介绍："></a>RestTemplate基本介绍：</h6><p>​		1、<strong>RestTemplate</strong> 是Spring 提供的用于访问 Rest 服务的模板类</p>
<p>​		2、RestTerplate 提供了多种<strong>便捷访问远程 Http 服务</strong>的方法</p>
<p>​		3、说明：可以这样理解，通过 RestTemplate，我们可以发出 http 请求(支持Restful 风格)，去调用Controller 提供的 API 接口，就像我们使用浏览器发出http 请求调用该 API接口一样。</p>
<p>​		4、使用简单便捷</p>
<h6 id="官网地址："><a href="#官网地址：" class="headerlink" title="官网地址："></a>官网地址：</h6><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html">https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html</a></p>
<h6 id="创建配置类-com-x2F-hspedu-x2F-springcloud-x2F-config-x2F-CustomizationBean-java"><a href="#创建配置类-com-x2F-hspedu-x2F-springcloud-x2F-config-x2F-CustomizationBean-java" class="headerlink" title="创建配置类: com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;CustomizationBean.java"></a>创建配置类: com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;CustomizationBean.java</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomizationBean</span> &#123;</span><br><span class="line">    <span class="comment">//配置注入RestTemplate bean 对象</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="创建-com-x2F-hspedu-x2F-springcloud-x2F-controller-x2F-MemberConsumerController-java"><a href="#创建-com-x2F-hspedu-x2F-springcloud-x2F-controller-x2F-MemberConsumerController-java" class="headerlink" title="创建:com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberConsumerController.java"></a>创建:com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberConsumerController.java</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberConsumerController</span> &#123;</span><br><span class="line">    <span class="comment">//url由（ip：端口）+（请求名称）两部分组成</span></span><br><span class="line">    <span class="comment">//定义member_service_provider_url</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MEMBER_SERVICE_PROVIDER_URL</span> <span class="operator">=</span></span><br><span class="line">            <span class="string">&quot;http://localhost:10000&quot;</span>;</span><br><span class="line">    <span class="comment">//方法/接口，添加member对象到数据库/表</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//装配RestController</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;member/consumer/save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Member&gt; <span class="title function_">save</span><span class="params">(Member member)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;service-consumer member=&#123;&#125;&quot;</span>,member);</span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(</span><br><span class="line">                MEMBER_SERVICE_PROVIDER_URL+<span class="string">&quot;/member/save&quot;</span>,member, Result.class);</span><br><span class="line">        <span class="comment">//url,要save的对象，返回值的类型</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据id 调用服务接口，返回member对象信息</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/member/consumer/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Member&gt; <span class="title function_">getMemberById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(</span><br><span class="line">                MEMBER_SERVICE_PROVIDER_URL+<span class="string">&quot;/member/get/&quot;</span> + id,Result.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-3-2-注意事项和使用细节"><a href="#3-3-3-2-注意事项和使用细节" class="headerlink" title="3.3.3.2 注意事项和使用细节"></a>3.3.3.2 注意事项和使用细节</h4><h5 id="添加会员数据库中为-null-的解决方案"><a href="#添加会员数据库中为-null-的解决方案" class="headerlink" title="添加会员数据库中为 null 的解决方案"></a>添加会员数据库中为 <strong>null</strong> 的解决方案</h5><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230520171355467.png" alt="image-20230520171355467" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230520171418620.png" alt="image-20230520171418620" style="zoom:50%;" />

<h5 id="开启-Run-DashBoard"><a href="#开启-Run-DashBoard" class="headerlink" title="开启 Run DashBoard"></a>开启 <strong>Run DashBoard</strong></h5><p>​	当springcloud 的服务有多个时，管理多个服务的启动使用run会不好管理，这样我们就可以使用 </p>
<p>RunDashboard.</p>
<p>找到 你的项目&#x2F;.idea&#x2F;workspace.xml 文件在其中添加下面的代码即可</p>
<p>添加在：原本第二行<project version="4">的下一行即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">name</span>=<span class="string">&quot;RunDashboard&quot;</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;configurationTypes&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;SpringBootApplicationConfigurationType&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;ruleStates&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RuleState</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ConfigurationTypeDashboardGroupingRule&quot;</span> /&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">RuleState</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RuleState</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;StatusDashboardGroupingRule&quot;</span> /&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">RuleState</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">option</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>重启项目 </p>
<p>​	<strong>视图-工具窗口-服务</strong> 即可方便管理各个主程序！</p>
<h2 id="3-4-创建共用模块-供其它模块使用"><a href="#3-4-创建共用模块-供其它模块使用" class="headerlink" title="3.4 创建共用模块-供其它模块使用"></a>3.4 创建共用模块-供其它模块使用</h2><h3 id="3-4-1-需求说明-x2F-图解"><a href="#3-4-1-需求说明-x2F-图解" class="headerlink" title="3.4.1 需求说明**&#x2F;**图解"></a><strong>3.4.1</strong> 需求说明**&#x2F;**图解</h3><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230520185154382.png" alt="image-20230520185154382" style="zoom:50%;" />

<h3 id="3-4-2-思路分析-x2F-图解"><a href="#3-4-2-思路分析-x2F-图解" class="headerlink" title="3.4.2 思路分析**&#x2F;**图解"></a><strong>3.4.2</strong> 思路分析**&#x2F;**图解</h3><p>1、创建 Moduel &amp; 完成配置</p>
<p>2、创建entity，把共用的实体类放到对应的包下</p>
<p>3、完成测试</p>
<h3 id="3-4-3-实现步骤"><a href="#3-4-3-实现步骤" class="headerlink" title="3.4.3 实现步骤"></a><strong>3.4.3</strong> 实现步骤</h3><h4 id="3-4-3-1-创建-Moduel-amp-完成配置"><a href="#3-4-3-1-创建-Moduel-amp-完成配置" class="headerlink" title="3.4.3.1 创建 Moduel &amp; 完成配置"></a>3.4.3.1 创建 Moduel &amp; 完成配置</h4><h5 id="3-4-3-1-1-创建-e-commerce-center-common-api"><a href="#3-4-3-1-1-创建-e-commerce-center-common-api" class="headerlink" title="3.4.3.1.1 创建 e_commerce_center-common-api"></a><strong>3.4.3.1.1</strong> 创建 <strong>e_commerce_center-common-api</strong></h5><h6 id="在pom-xml中提取公共依赖"><a href="#在pom-xml中提取公共依赖" class="headerlink" title="在pom.xml中提取公共依赖"></a>在pom.xml中提取公共依赖</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--老师解读&lt;optional&gt;true&lt;/optional&gt;:</span></span><br><span class="line"><span class="comment">    1. true 表示两个项目之间依赖不传递</span></span><br><span class="line"><span class="comment">    2. 小伙伴可以这里理解&lt;optional&gt;true&lt;/optional&gt;: 防止将该依赖传递到其他模块中</span></span><br><span class="line"><span class="comment">    说的再具体一点，比如 member-service-consumer-80 模块依赖了本项目,</span></span><br><span class="line"><span class="comment">    那么本项目不会把 lombok 传递给 member-service-consumer-80</span></span><br><span class="line"><span class="comment">    3. 不设置 optional 或者 optional 是 false，表示传递依赖</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="抽取共用-API-x2F-类"><a href="#抽取共用-API-x2F-类" class="headerlink" title="抽取共用 API&#x2F;类"></a>抽取共用 API&#x2F;类</h6><p>​		写入公共的entity</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230520191145475.png" alt="image-20230520191145475" style="zoom:55%;" />

<h6 id="使用-Maven-打包成-jar"><a href="#使用-Maven-打包成-jar" class="headerlink" title="使用 Maven 打包成 jar"></a>使用 Maven 打包成 jar</h6><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230520192050410.png" alt="image-20230520192050410" style="zoom:50%;" />

<p>会在test目录中生成对应jar包</p>
<h6 id="工程重构"><a href="#工程重构" class="headerlink" title="工程重构"></a>工程重构</h6><p>​	1.在 <strong>member-service-consumer-80</strong> 引入 <strong>e_commerce_center-common-api-1.0-SNAPSHOT.jar</strong></p>
<p>​		删除原来的 <strong>entity</strong> 包</p>
<p>​		修改 <strong>pom.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入 e_commerce_center-common-api --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hspedu.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e_commerce_center-common-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样就完成了！</p>
<h1 id="4-SpringCloud-Eureka-服务注册中心"><a href="#4-SpringCloud-Eureka-服务注册中心" class="headerlink" title="4 SpringCloud Eureka 服务注册中心"></a>4 SpringCloud Eureka 服务注册中心</h1><h2 id="4-1-Eureka介绍"><a href="#4-1-Eureka介绍" class="headerlink" title="4.1 Eureka介绍"></a>4.1 Eureka介绍</h2><h3 id="4-1-1-学-Eureka-前的说明"><a href="#4-1-1-学-Eureka-前的说明" class="headerlink" title="4.1.1 学 Eureka 前的说明"></a><strong>4.1.1</strong> 学 <strong>Eureka</strong> 前的说明</h3><h4 id="1、Spring-Cloud-组件选型图"><a href="#1、Spring-Cloud-组件选型图" class="headerlink" title="1、Spring Cloud 组件选型图"></a><strong>1</strong>、Spring Cloud 组件选型图</h4><p>![image-20230519190901580](&#x2F;Users&#x2F;donn&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230519190901580.png)</p>
<h4 id="2、从上图可以看出，目前主流的服务注册-amp-发现的组件是-Nacos，-但是-Eureka-作为一个老牌经典的-服务注册-amp-发现技术还是有必要学习一下，原因："><a href="#2、从上图可以看出，目前主流的服务注册-amp-发现的组件是-Nacos，-但是-Eureka-作为一个老牌经典的-服务注册-amp-发现技术还是有必要学习一下，原因：" class="headerlink" title="2、从上图可以看出，目前主流的服务注册&amp;发现的组件是 Nacos， 但是 Eureka 作为一个老牌经典的 服务注册&amp;发现技术还是有必要学习一下，原因："></a>2、从上图可以看出，目前主流的服务注册&amp;发现的组件是 Nacos， 但是 Eureka 作为一个老牌经典的 服务注册&amp;发现技术还是有必要学习一下，原因：</h4><p>（1） 一些早期的分布式 微服务项目使用的是 Eureka， 小伙伴在工作中，完全有可能遇到这种情况。</p>
<p>（2） 后期的服务注册&amp;发现组件&#x2F;技术，都参考了 Eureka 设计和理念，学习了Eureka 后，我们上手Nacos容易很多，而且理解的更深刻。</p>
<h3 id="4-1-2-当前项目架构问题分析-引出-Eureka"><a href="#4-1-2-当前项目架构问题分析-引出-Eureka" class="headerlink" title="4.1.2 当前项目架构问题分析 **-**引出 Eureka"></a><strong>4.1.2</strong> 当前项目架构问题分析 **-**引出 Eureka</h3><p>一图胜千言</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230521192330770.png" alt="image-20230521192330770"></p>
<p>1.在企业级项目中，服务消费访问请求会存在高并发 (一个服务提供模块可能无法承受)</p>
<p>2.如果只有一个会员中心-提供服务模块，可用性差 (如果只有一个服务提供模块，如果故障，系统将无法使用，可用性差)</p>
<p>3.所以，会员中心提供服务往往是一个集群，也就是说会有<strong>多个会员中心提供服务微服务模块</strong> ( 高可用 )  </p>
<p>4.那么这个时候，就存在一个问题：服务消费方，怎么去发现可以使用的服务 </p>
<p>5,当服务消费方，发现了可以使用的服务后(可能是多个，又存在一个问题：到底调用 A服务，还是B服务？ 这就引出了服务注册和负载均衡)</p>
<p>6.Eureka 就可以解决上述问题</p>
<h3 id="4-1-3-引入-Eureka-项目架构"><a href="#4-1-3-引入-Eureka-项目架构" class="headerlink" title="4.1.3 引入 Eureka 项目架构"></a><strong>4.1.3</strong> 引入 <strong>Eureka</strong> 项目架构</h3><h4 id="一图胜千言"><a href="#一图胜千言" class="headerlink" title="一图胜千言"></a>一图胜千言</h4><p>​	<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230521193144050.png" alt="image-20230521193144050"></p>
<ol>
<li><p>会员中心-是提供服务的模块，在项目中，会做成集群，提供高可用</p>
</li>
<li><p>Eureka Server 有必要的话，也可以做成集群</p>
</li>
<li><p>Eureka 包含两个组件：Eureka Server和 Eureka Client</p>
</li>
<li><p>Eureka Server 提供注册服务，各个微服务节点通过配置启动后，会在 Eureka Server中迸行注册，这样 EurekaServer 中的服务注册表中将会存储所有可用服务节点的信息，服务节点的信息可以在界面中直观看到。</p>
</li>
<li><p>Euretka Client 通过注册中心进行访问，是一个Java 客户端，用于简化 Eureka Server的交互，客户端同时也具备一个内置的、使用轮询(round-robin） 负载算法的负载均衡器。在应用启动后，将会向 Eureka Server 发送心跳（默认周期为 30秒)。如果 Eureka Server 在多个心跳周期内没有接收到某个节点的心跳，EurekaServer 将会从服务注册表中把这个服务节点移除(默认90秒)</p>
</li>
</ol>
<h3 id="4-1-4-服务治理介绍"><a href="#4-1-4-服务治理介绍" class="headerlink" title="4.1.4 服务治理介绍"></a><strong>4.1.4</strong> 服务治理介绍</h3><h4 id="4-1-4-1-Eureka实现服务治理"><a href="#4-1-4-1-Eureka实现服务治理" class="headerlink" title="4.1.4.1 Eureka实现服务治理"></a>4.1.4.1 Eureka实现服务治理</h4><h4 id="4-1-4-2-在传统的-rpc-远程调用框架中，管理每个服务与服务之间依赖关系比较复杂，管理困难，所以-需要治理服务之间依赖关系"><a href="#4-1-4-2-在传统的-rpc-远程调用框架中，管理每个服务与服务之间依赖关系比较复杂，管理困难，所以-需要治理服务之间依赖关系" class="headerlink" title="4.1.4.2 在传统的 rpc 远程调用框架中，管理每个服务与服务之间依赖关系比较复杂，管理困难，所以 需要治理服务之间依赖关系"></a>4.1.4.2 在传统的 rpc 远程调用框架中，管理每个服务与服务之间依赖关系比较复杂，管理困难，所以 需要治理服务之间依赖关系</h4><h4 id="4-1-4-3-服务治理实现服务调用、负载均衡、容错等，实现服务发现与注册。"><a href="#4-1-4-3-服务治理实现服务调用、负载均衡、容错等，实现服务发现与注册。" class="headerlink" title="4.1.4.3 服务治理实现服务调用、负载均衡、容错等，实现服务发现与注册。"></a>4.1.4.3 服务治理实现服务调用、负载均衡、容错等，实现服务发现与注册。</h4><h4 id="4-1-4-4-二说分布式开发-https-jingyan-baidu-com-article-46650658def479f549e5f83e-html"><a href="#4-1-4-4-二说分布式开发-https-jingyan-baidu-com-article-46650658def479f549e5f83e-html" class="headerlink" title="4.1.4.4 二说分布式开发: https://jingyan.baidu.com/article/46650658def479f549e5f83e.html"></a>4.1.4.4 二说分布式开发: <a target="_blank" rel="noopener" href="https://jingyan.baidu.com/article/46650658def479f549e5f83e.html">https://jingyan.baidu.com/article/46650658def479f549e5f83e.html</a></h4><h3 id="4-1-5-服务注册和发现"><a href="#4-1-5-服务注册和发现" class="headerlink" title="4.1.5 服务注册和发现"></a><strong>4.1.5</strong> 服务注册和发现</h3><p>Eureka采用了CS [client-server-java基础我们讲过一个多人聊天项目] 的设计架构，Eureka Server 作为服务注册功能的服务器，它是服务注册中心。</p>
<p>系统中的其他微服务，<strong>使用 Eureka的客户端连接到 Eureka Server</strong>并维持心跳连接，通过 Eureka Server 来监控系统中各个微服务是否正常运行。</p>
<p>在服务注册与发现中，有一个注册中心。当服务器启动的时候，会把当前自己服务器的信息 比如 服务地址通讯地址等以别名方式注册到注册中心上。</p>
<p>服务消费者或者服务提供者，以服务别名的方式去注册中心上获取到实际的服务提供者通讯地址，然后通过RPC调用服务。</p>
<h2 id="4-2-创建单机-Eureka-Server-注册中心"><a href="#4-2-创建单机-Eureka-Server-注册中心" class="headerlink" title="4.2 创建单机 Eureka Server-注册中心"></a>4.2 创建单机 Eureka Server-注册中心</h2><h3 id="4-2-1-需求说明-x2F-图解"><a href="#4-2-1-需求说明-x2F-图解" class="headerlink" title="4.2.1 需求说明**&#x2F;**图解"></a><strong>4.2.1</strong> 需求说明**&#x2F;**图解</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230522104534270.png" alt="image-20230522104534270"></p>
<h3 id="4-2-2-实现步骤"><a href="#4-2-2-实现步骤" class="headerlink" title="4.2.2 实现步骤"></a><strong>4.2.2</strong> 实现步骤</h3><h4 id="4-2-2-1-创建-Moduel-amp-完成配置"><a href="#4-2-2-1-创建-Moduel-amp-完成配置" class="headerlink" title="4.2.2.1 创建 Moduel &amp; 完成配置"></a>4.2.2.1 创建 Moduel &amp; 完成配置</h4><h5 id="4-2-2-1-1-创建-e-commerce-eureka-server-9001-微服务模块-作为注册中心"><a href="#4-2-2-1-1-创建-e-commerce-eureka-server-9001-微服务模块-作为注册中心" class="headerlink" title="4.2.2.1.1 创建 e-commerce-eureka-server-9001 微服务模块**[**作为注册中心]"></a>4.2.2.1.1 创建 <strong>e-commerce-eureka-server-9001</strong> 微服务模块**[**作为注册中心]</h5><h6 id="创建-module"><a href="#创建-module" class="headerlink" title="创建 module"></a>创建 <strong>module</strong></h6><h6 id="4-2-2-1-2-修改-e-commerce-eureka-server-9001-的-pom-xml-加入依赖"><a href="#4-2-2-1-2-修改-e-commerce-eureka-server-9001-的-pom-xml-加入依赖" class="headerlink" title="4.2.2.1.2 修改 e-commerce-eureka-server-9001 的 pom.xml , 加入依赖"></a>4.2.2.1.2 修改 <strong>e-commerce-eureka-server-9001</strong> 的 <strong>pom.xml ,</strong> 加入依赖</h6><h6 id="4-2-2-1-3-创建-resources-x2F-application-yml"><a href="#4-2-2-1-3-创建-resources-x2F-application-yml" class="headerlink" title="4.2.2.1.3 创建 resources&#x2F;application.yml"></a><strong>4.2.2.1.3</strong> 创建 <strong>resources&#x2F;application.yml</strong></h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"><span class="comment"># 配置eureka-server</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment">#服务实例名</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment">#不向注册中心注册自己</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment">#表示自己就是注册中心，作用是维护注册服务实例，不需要去检索服务</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure>

<h6 id="4-2-2-1-4-创建主启动类-com-x2F-hspedu-x2F-springcloud-x2F-EurekaApplication-java"><a href="#4-2-2-1-4-创建主启动类-com-x2F-hspedu-x2F-springcloud-x2F-EurekaApplication-java" class="headerlink" title="4.2.2.1.4 创建主启动类 com&#x2F;hspedu&#x2F;springcloud&#x2F;EurekaApplication.java"></a><strong>4.2.2.1.4</strong> 创建主启动类 <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;EurekaApplication.java</strong></h6><p>记得添加@EnableEurekaServer，表示该程序作为EurekaServer</p>
<h3 id="4-2-3-将-member-service-provider-10000-作-为-EurekaClient-注-册-到-e-commerce-eureka-server-9001-成为服务提供者"><a href="#4-2-3-将-member-service-provider-10000-作-为-EurekaClient-注-册-到-e-commerce-eureka-server-9001-成为服务提供者" class="headerlink" title="4.2.3 将 member-service-provider-10000 作 为 EurekaClient 注 册 到 e-commerce-eureka-server-9001 成为服务提供者"></a><strong>4.2.3</strong> 将 <strong>member-service-provider-10000</strong> 作 为 <strong>EurekaClient</strong> 注 册 到 <strong>e-commerce-eureka-server-9001</strong> 成为服务提供者</h3><h4 id="4-2-3-1-架构示意图"><a href="#4-2-3-1-架构示意图" class="headerlink" title="4.2.3.1 架构示意图"></a>4.2.3.1 架构示意图</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230522124755649.png" alt="image-20230522124755649" style="zoom:50%;" />

<h4 id="4-2-3-2-修改-member-service-provider-10000-的-pom-xml"><a href="#4-2-3-2-修改-member-service-provider-10000-的-pom-xml" class="headerlink" title="4.2.3.2 修改 member-service-provider-10000 的 pom.xml"></a>4.2.3.2 修改 member-service-provider-10000 的 pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--       引入eureka-client场景启动器starter--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-3-3-修改-member-service-provider-10000-的-resources-x2F-application-yml"><a href="#4-2-3-3-修改-member-service-provider-10000-的-resources-x2F-application-yml" class="headerlink" title="4.2.3.3 修改 member-service-provider-10000 的 resources&#x2F;application.yml"></a>4.2.3.3 修改 member-service-provider-10000 的 resources&#x2F;application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-provider-10000</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/e_commerce_center_db?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">QWEASDzxc123</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.study.springcloud.entity</span></span><br><span class="line"><span class="comment">#配置eureka-client</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#将自己注册到Eureka-server</span></span><br><span class="line">    <span class="comment">#表示从Eureka-server抓取注册信息</span></span><br><span class="line">    <span class="comment">#如果是单节点，可以不配置；</span></span><br><span class="line">    <span class="comment">#但是provider是一个集群，则必须将此项配置为true，这样才能配合Ribbon使用负载均衡功能</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># 表示将自己注册到哪个eureka-server</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:9001/eureka</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-3-4-修改-member-service-provider-10000-的-com-x2F-hspedu-x2F-springcloud-x2F-MemberApplication-java"><a href="#4-2-3-4-修改-member-service-provider-10000-的-com-x2F-hspedu-x2F-springcloud-x2F-MemberApplication-java" class="headerlink" title="4.2.3.4 修改 member-service-provider-10000 的 com&#x2F;hspedu&#x2F;springcloud&#x2F;MemberApplication.java"></a>4.2.3.4 修改 member-service-provider-10000 的 com&#x2F;hspedu&#x2F;springcloud&#x2F;MemberApplication.java</h4><p>添加注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@EnableEurekaClient,将该程序标识为Eureka-client</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-3-5-完成测试"><a href="#4-2-3-5-完成测试" class="headerlink" title="4.2.3.5 完成测试"></a>4.2.3.5 完成测试</h4><h5 id="4-2-3-5-1-启动-e-commerce-eureka-server-9001"><a href="#4-2-3-5-1-启动-e-commerce-eureka-server-9001" class="headerlink" title="4.2.3.5.1 启动 **e-commerce-eureka-server-9001 **"></a><strong>4.2.3.5.1</strong> 启动 **e-commerce-eureka-server-9001 **</h5><h5 id="4-2-3-5-2-启动-member-service-provider-10000"><a href="#4-2-3-5-2-启动-member-service-provider-10000" class="headerlink" title="4.2.3.5.2 启动 **member-service-provider-10000 **"></a><strong>4.2.3.5.2</strong> 启动 **member-service-provider-10000 **</h5><h5 id="4-2-3-5-3-浏览器-http-localhost-9001"><a href="#4-2-3-5-3-浏览器-http-localhost-9001" class="headerlink" title="4.2.3.5.3 浏览器**: http://localhost:9001**"></a><strong>4.2.3.5.3</strong> 浏览器**: <a target="_blank" rel="noopener" href="http://localhost:9001/">http://localhost:9001</a>**</h5><h5 id="4-2-3-5-4-微服务注册名配置说明"><a href="#4-2-3-5-4-微服务注册名配置说明" class="headerlink" title="4.2.3.5.4 微服务注册名配置说明"></a><strong>4.2.3.5.4</strong> 微服务注册名配置说明</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230522130616526.png" alt="image-20230522130616526"></p>
<h3 id="4-2-4-配-置-member-service-consumer-80-作-为-EurekaClient，-可-以-拉取-x2F-获-取e-commerce-eureka-server-9001-提供的服务信息"><a href="#4-2-4-配-置-member-service-consumer-80-作-为-EurekaClient，-可-以-拉取-x2F-获-取e-commerce-eureka-server-9001-提供的服务信息" class="headerlink" title="4.2.4 配 置 member-service-consumer-80 作 为 EurekaClient， 可 以 拉取 &#x2F; 获 取e-commerce-eureka-server-9001 提供的服务信息"></a><strong>4.2.4</strong> 配 置 <strong>member-service-consumer-80</strong> 作 为 <strong>EurekaClient</strong>， 可 以 拉取 <strong>&#x2F;</strong> 获 取e-commerce-eureka-server-9001 提供的服务信息</h3><h4 id="4-2-4-1-架构示意图"><a href="#4-2-4-1-架构示意图" class="headerlink" title="4.2.4.1 架构示意图"></a>4.2.4.1 架构示意图</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230522202407897.png" alt="image-20230522202407897"></p>
<h4 id="4-2-4-2-修改-pom-xml"><a href="#4-2-4-2-修改-pom-xml" class="headerlink" title="4.2.4.2 修改 pom.xml"></a>4.2.4.2 修改 pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--       引入eureka-client场景启动器starter--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-4-3-修改-application-yml"><a href="#4-2-4-3-修改-application-yml" class="headerlink" title="4.2.4.3 修改 application.yml"></a>4.2.4.3 修改 application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">在原本的配置在增加：</span></span><br><span class="line"><span class="comment">#配置eureka-client</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#将自己注册到Eureka-server</span></span><br><span class="line">    <span class="comment">#表示从Eureka-server抓取注册信息</span></span><br><span class="line">    <span class="comment">#如果是单节点，可以不配置；</span></span><br><span class="line">    <span class="comment">#但是provider是一个集群，则必须将此项配置为true，这样才能配合Ribbon使用负载均衡功能</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># 表示将自己注册到哪个eureka-server</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:9001/eureka</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-4-4-修改-MemberConsumerApplication-java"><a href="#4-2-4-4-修改-MemberConsumerApplication-java" class="headerlink" title="4.2.4.4 修改 MemberConsumerApplication.java"></a>4.2.4.4 修改 MemberConsumerApplication.java</h4><p>添加注解：@EnableEurekaClient             							将该程序标识为Eureka-client</p>
<h4 id="4-2-4-5-完成测试"><a href="#4-2-4-5-完成测试" class="headerlink" title="4.2.4.5 完成测试"></a>4.2.4.5 完成测试</h4><h5 id="4-2-4-5-1-启动-e-commerce-eureka-server-9001"><a href="#4-2-4-5-1-启动-e-commerce-eureka-server-9001" class="headerlink" title="4.2.4.5.1 启动 **e-commerce-eureka-server-9001 **"></a><strong>4.2.4.5.1</strong> 启动 **e-commerce-eureka-server-9001 **</h5><h5 id="4-2-4-5-2-启动-member-service-consumer-80"><a href="#4-2-4-5-2-启动-member-service-consumer-80" class="headerlink" title="4.2.4.5.2 启动 **member-service-consumer-80 **"></a><strong>4.2.4.5.2</strong> 启动 **member-service-consumer-80 **</h5><h5 id="4-2-4-5-3-浏览器-http-localhost-9001"><a href="#4-2-4-5-3-浏览器-http-localhost-9001" class="headerlink" title="4.2.4.5.3 浏览器**: http://localhost:9001**"></a><strong>4.2.4.5.3</strong> 浏览器**: <a target="_blank" rel="noopener" href="http://localhost:9001/">http://localhost:9001</a>**</h5><h3 id="4-2-5-Service-Consumer-、Service-Provider-、EurekaServer-的维护机制"><a href="#4-2-5-Service-Consumer-、Service-Provider-、EurekaServer-的维护机制" class="headerlink" title="4.2.5 Service Consumer 、Service Provider 、EurekaServer 的维护机制"></a><strong>4.2.5 Service Consumer</strong> 、<strong>Service Provider</strong> 、<strong>EurekaServer</strong> 的维护机制</h3><p>EurekaServer中维护了服务信息——一个键值对：key是<strong>服务名</strong>，value是 <strong>调用服务的地址</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230526170804321.png" alt="image-20230526170804321"></p>
<h3 id="4-2-6-Eureka自我保护模式"><a href="#4-2-6-Eureka自我保护模式" class="headerlink" title="4.2.6 Eureka自我保护模式"></a><strong>4.2.6 Eureka</strong>自我保护模式</h3><h4 id="4-2-6-1-自我保护模式理论"><a href="#4-2-6-1-自我保护模式理论" class="headerlink" title="4.2.6.1 自我保护模式理论"></a>4.2.6.1 自我保护模式理论</h4><ol>
<li><p>在默认情况下， <strong>Eureka 启动了自我保护模式</strong></p>
</li>
<li><p>自我保证机制&#x2F;模式说明</p>
<ul>
<li><p>默认情況下Eurekaclient定时向EurekaServer端发送心跳包。</p>
</li>
<li><p>如果Eureka在server端在一定时间内（默认90秒）没有收到Eurekaclient发送心跳包，便会直接从服务注册列表中剔除该服务。</p>
</li>
<li><p>如果Eureka 开启了自我保护模式&#x2F;机制，那么在短时间 (90秒中）内丢失了大量的服务实例心跳，这时候EurekaServer会开启自我保护机制，不会剔除该服务（该现象可能出现在如果网络不通或者阻鑫) 因为客户端还能正常发送心跳，只是网络延迟问题，而保护机制是为了解决此问题而产生的。</p>
</li>
</ul>
</li>
<li><p>自我保护是属于 <strong>CAP</strong> 里面的 AP 分支， 保证高可用和分区容错性。(cap解读：<a target="_blank" rel="noopener" href="https://blog.csdn.net/wangliangluang/article/details/120626014">https://blog.csdn.net/wangliangluang/article/details/120626014</a>)</p>
</li>
<li><p>自我保护模式是—种<strong>应对网络异常的安全保护措施</strong>。它的架构哲学是宁可同时保留所有微服务(健康的微服务和不健康的微服务都会保留)也不盲目注销任何健康的微服 务。使用自我保护模式，可以让 Eureka 集群更加的健壮、稳定。</p>
</li>
<li><p>测试：</p>
<p>……</p>
</li>
</ol>
<h2 id="4-3-搭建-EurekaServer-集群-实现负载均衡-amp-故障容错"><a href="#4-3-搭建-EurekaServer-集群-实现负载均衡-amp-故障容错" class="headerlink" title="4.3 搭建 EurekaServer 集群- 实现负载均衡&amp;故障容错"></a>4.3 搭建 EurekaServer 集群- 实现负载均衡&amp;故障容错</h2><h3 id="4-3-1-为什么需要集群-Eureka-Server"><a href="#4-3-1-为什么需要集群-Eureka-Server" class="headerlink" title="4.3.1 为什么需要集群 Eureka Server"></a><strong>4.3.1</strong> 为什么需要集群 Eureka Server</h3><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230528115636389.png" alt="image-20230528115636389" style="zoom:50%;" />

<ol>
<li><p>微服务 RPC 远程服务调用最核心的是实现高可用</p>
</li>
<li><p>如果注册中心只有1个，它出故障，会导致整个服务环境不可用</p>
</li>
<li><p>解决办法：搭建 <strong>Eureka 注册中心集群</strong>，<strong>实现负载均衡+故障容错</strong></p>
</li>
</ol>
<h3 id="4-3-2需求分析-x2F-图解"><a href="#4-3-2需求分析-x2F-图解" class="headerlink" title="4.3.2需求分析**&#x2F;**图解"></a>4.3.2需求分析**&#x2F;**图解</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230528120007909.png" alt="image-20230528120007909"></p>
<h3 id="4-3-3-搭建-Eureka-Server-集群"><a href="#4-3-3-搭建-Eureka-Server-集群" class="headerlink" title="4.3.3 搭建 Eureka Server 集群"></a><strong>4.3.3</strong> 搭建 <strong>Eureka Server</strong> 集群</h3><h4 id="4-3-3-1-创建-e-commerce-eureka-server-9002-微服务模块-作为注册中心"><a href="#4-3-3-1-创建-e-commerce-eureka-server-9002-微服务模块-作为注册中心" class="headerlink" title="4.3.3.1 创建 e-commerce-eureka-server-9002 微服务模块[作为注册中心]"></a>4.3.3.1 创建 e-commerce-eureka-server-9002 微服务模块[作为注册中心]</h4><h5 id="4-3-3-1-1-创建步骤参考-e-commerce-eureka-server-9001"><a href="#4-3-3-1-1-创建步骤参考-e-commerce-eureka-server-9001" class="headerlink" title="4.3.3.1.1 创建步骤参考 e-commerce-eureka-server-9001"></a><strong>4.3.3.1.1</strong> 创建步骤参考 <strong>e-commerce-eureka-server-9001</strong></h5><h5 id="4-3-3-1-2-修改-pom-xml-加入依赖"><a href="#4-3-3-1-2-修改-pom-xml-加入依赖" class="headerlink" title="4.3.3.1.2 修改 pom.xml , 加入依赖"></a><strong>4.3.3.1.2</strong> 修改 <strong>pom.xml ,</strong> 加入依赖</h5><h5 id="4-3-3-1-3-创建-resources-x2F-application-yml"><a href="#4-3-3-1-3-创建-resources-x2F-application-yml" class="headerlink" title="4.3.3.1.3 创建 resources&#x2F;application.yml"></a><strong>4.3.3.1.3</strong> 创建 <strong>resources&#x2F;application.yml</strong></h5><h5 id="4-3-3-1-4-创建主启动类-EurekaApplication9002-java"><a href="#4-3-3-1-4-创建主启动类-EurekaApplication9002-java" class="headerlink" title="4.3.3.1.4 创建主启动类 EurekaApplication9002.java"></a><strong>4.3.3.1.4</strong> 创建主启动类 <strong>EurekaApplication9002.java</strong></h5><h4 id="4-3-3-2-修改-e-commerce-eureka-server-9001-微服务模块"><a href="#4-3-3-2-修改-e-commerce-eureka-server-9001-微服务模块" class="headerlink" title="4.3.3.2 修改 e-commerce-eureka-server-9001 微服务模块"></a>4.3.3.2 修改 e-commerce-eureka-server-9001 微服务模块</h4><h5 id="4-3-3-2-1-修改-resources-x2F-application-yml"><a href="#4-3-3-2-1-修改-resources-x2F-application-yml" class="headerlink" title="4.3.3.2.1 修改 resources&#x2F;application.yml"></a><strong>4.3.3.2.1</strong> 修改 <strong>resources&#x2F;application.yml</strong></h5><h5 id="4-3-3-2-2-修改主启动类名为-EurekaApplication9001-java"><a href="#4-3-3-2-2-修改主启动类名为-EurekaApplication9001-java" class="headerlink" title="4.3.3.2.2 修改主启动类名为 EurekaApplication9001.java"></a><strong>4.3.3.2.2</strong> 修改主启动类名为 <strong>EurekaApplication9001.java</strong></h5><h4 id="4-3-3-3-修改-hosts-文件"><a href="#4-3-3-3-修改-hosts-文件" class="headerlink" title="4.3.3.3 修改 hosts 文件"></a>4.3.3.3 修改 hosts 文件</h4><p>​	域名转ip地址：先找本机的host文件，hosts文件中没有才去DNS服务器寻找，</p>
<p>​	现在我们需要访问eureka9001.com这样的形式，就需要自行在本机的hosts文件添加键值对实现域名-&gt;ip</p>
<p>&#x2F;private&#x2F;etc&#x2F;hosts	复制出来，修改，覆盖原来的文件即可完成修改</p>
<p>​		在hosts文件中添加内容：</p>
<p>​		<strong>#eureka</strong> 主机名和 <strong>ip</strong> 映射 </p>
<p>​		**127.0.0.1 eureka9001.com **</p>
<p>​		<strong>127.0.0.1 eureka9002.com</strong></p>
<h4 id="4-3-3-4-完成测试"><a href="#4-3-3-4-完成测试" class="headerlink" title="4.3.3.4 完成测试"></a>4.3.3.4 完成测试</h4><h5 id="4-3-3-4-1-启动-e-commerce-eureka-server-9001"><a href="#4-3-3-4-1-启动-e-commerce-eureka-server-9001" class="headerlink" title="4.3.3.4.1 启动 **e-commerce-eureka-server-9001"></a><strong>4.3.3.4.1</strong> 启动 **e-commerce-eureka-server-9001</h5><h5 id="4-3-3-4-2-启动-e-commerce-eureka-server-9002"><a href="#4-3-3-4-2-启动-e-commerce-eureka-server-9002" class="headerlink" title="4.3.3.4.2** 启动 **e-commerce-eureka-server-9002"></a>4.3.3.4.2** 启动 **e-commerce-eureka-server-9002</h5><h5 id="4-3-3-4-3-浏览器-http-eureka9001-com-9001-浏览器-http-eureka9002-com-9002"><a href="#4-3-3-4-3-浏览器-http-eureka9001-com-9001-浏览器-http-eureka9002-com-9002" class="headerlink" title="4.3.3.4.3** 浏览器**: http://eureka9001.com:9001** 浏览器**: http://eureka9002.com:9002**"></a>4.3.3.4.3** 浏览器**: <a target="_blank" rel="noopener" href="http://eureka9001.com:9001/">http://eureka9001.com:9001</a>** 浏览器**: <a target="_blank" rel="noopener" href="http://eureka9002.com:9002/">http://eureka9002.com:9002</a>**</h5><h4 id="4-3-3-5-将-member-service-provider-10000-注册到-EurekaServer-集群-目前-2-台"><a href="#4-3-3-5-将-member-service-provider-10000-注册到-EurekaServer-集群-目前-2-台" class="headerlink" title="4.3.3.5 将 member-service-provider-10000 注册到 EurekaServer 集群(目前 2 台)"></a>4.3.3.5 将 member-service-provider-10000 注册到 EurekaServer 集群(目前 2 台)</h4><h5 id="4-3-3-5-1-修改-resources-x2F-application-yml"><a href="#4-3-3-5-1-修改-resources-x2F-application-yml" class="headerlink" title="4.3.3.5.1 修改 resources&#x2F;application.yml"></a><strong>4.3.3.5.1</strong> 修改 <strong>resources&#x2F;application.yml</strong></h5><p>‘’’</p>
<p>defaultZone: <a target="_blank" rel="noopener" href="http://eureka9001.com:9001/eureka">http://eureka9001.com:9001/eureka</a>, <a target="_blank" rel="noopener" href="http://eureka9002.com:9002/eureka">http://eureka9002.com:9002/eureka</a></p>
<p>*#*表示将自己注册到哪个 <em>eurekaServer</em></p>
<p>将本微服务注册到多个 <em>eurekaServer,</em> 使用逗号隔开</p>
<p>‘’’</p>
<h5 id="4-3-3-5-2-完成测试"><a href="#4-3-3-5-2-完成测试" class="headerlink" title="4.3.3.5.2 完成测试"></a><strong>4.3.3.5.2</strong> 完成测试</h5><p><strong>1.</strong> <strong>启动</strong> <strong>e-commerce-eureka-server-9001</strong> <strong>和</strong> <strong>e-commerce-eureka-server-9002</strong></p>
<p><strong>2. 启动</strong> <strong>member-service-provider-10000<br>3.</strong> <strong>观察</strong> <strong>member-service-provider-10000</strong> <strong>是否注册到</strong> <strong>Eureka</strong> <strong>集群</strong>前 <strong>2</strong> <strong>台</strong>)</p>
<h4 id="4-3-3-6-将-member-service-consumer-80-注册到-EurekaServer-集群-目前-2-台"><a href="#4-3-3-6-将-member-service-consumer-80-注册到-EurekaServer-集群-目前-2-台" class="headerlink" title="4.3.3.6 将 member-service-consumer-80 注册到 EurekaServer 集群(目前 2 台)"></a>4.3.3.6 将 member-service-consumer-80 注册到 EurekaServer 集群(目前 2 台)</h4><h5 id="4-3-3-6-1-修改-resources-x2F-application-yml"><a href="#4-3-3-6-1-修改-resources-x2F-application-yml" class="headerlink" title="4.3.3.6.1 修改 resources&#x2F;application.yml"></a><strong>4.3.3.6.1</strong> 修改 <strong>resources&#x2F;application.yml</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaultZone: http://eureka9001.com:9001/eureka,http://eureka9002.com:9002/eureka</span><br></pre></td></tr></table></figure>

<h5 id="4-3-3-6-2-完成测试"><a href="#4-3-3-6-2-完成测试" class="headerlink" title="4.3.3.6.2 完成测试"></a><strong>4.3.3.6.2</strong> 完成测试</h5><p><strong>1.</strong> <strong>启动</strong> <strong>e-commerce-eureka-server-9001</strong> <strong>和</strong> <strong>e-commerce-eureka-server-9002</strong><br><strong>2.</strong> <strong>启动</strong> <strong>member-service-consumer-80<br>3.</strong> <strong>观察</strong> <strong>member-service-consumer-80</strong> <strong>是否注册到</strong> <strong>Eureka</strong> <strong>集群</strong>(<strong>目前</strong> <strong>2</strong> <strong>台</strong>)</p>
<h3 id="4-3-4-搭建会员中心服务提供方-集群"><a href="#4-3-4-搭建会员中心服务提供方-集群" class="headerlink" title="4.3.4 搭建会员中心服务提供方**-**集群"></a><strong>4.3.4</strong> 搭建会员中心服务提供方**-**集群</h3><h4 id="4-3-4-1-架构示意图"><a href="#4-3-4-1-架构示意图" class="headerlink" title="4.3.4.1 架构示意图"></a>4.3.4.1 架构示意图</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230528140357541.png" alt="image-20230528140357541"></p>
<h4 id="4-3-4-2-创建member-service-provider-10002"><a href="#4-3-4-2-创建member-service-provider-10002" class="headerlink" title="4.3.4.2 创建member-service-provider-10002"></a>4.3.4.2 创建member-service-provider-10002</h4><p>1.参考member-service-provider-10000 来创建 member-service-provider-10002 即可</p>
<p>2.创建好后，使用memberservice-provider-10000 的源 码和配置替換member-service-provider-10002 生成的代码（不要到磁盘整体拷贝，会出现关联到 member-service-provider-10000 的问题，很麻烦，可以创建好新项目的包，然后再拷贝对应包下的文件，就不会出向题）</p>
<p>3.提醒，拷贝时不要忘记拷贝 resources&#x2F;mapper&#x2F;Mem berMapper:xml 这些xaos.xml 文件</p>
<h4 id="4-3-4-3-创建-resources-x2F-application-yml"><a href="#4-3-4-3-创建-resources-x2F-application-yml" class="headerlink" title="4.3.4.3 创建 resources&#x2F;application.yml"></a>4.3.4.3 创建 resources&#x2F;application.yml</h4><p><strong>1.</strong> 创建好 <strong>application.yml</strong></p>
<p><strong>2.</strong> 从 <strong>member-service-provider-10000</strong> 拷贝 <strong>application.yml</strong> 的内容</p>
<p><strong>3.</strong> 修改端口号即可</p>
<h4 id="4-3-4-4-修改主启动类名"><a href="#4-3-4-4-修改主启动类名" class="headerlink" title="4.3.4.4 修改主启动类名"></a>4.3.4.4 修改主启动类名</h4><p><strong>1.</strong> 修改 <strong>member-service-provider-10000</strong> 的主启动类为 <strong>MemberProviderApplication10000</strong></p>
<p><strong>2.</strong> <strong>修改</strong> <strong>member-service-provider-10002</strong> <strong>的主启动类为</strong> <strong>MemberProviderApplication10002</strong></p>
<h4 id="4-3-4-5-完成测试"><a href="#4-3-4-5-完成测试" class="headerlink" title="4.3.4.5 完成测试"></a>4.3.4.5 完成测试</h4><p>……</p>
<h4 id="4-3-4-6-注意事项和细节"><a href="#4-3-4-6-注意事项和细节" class="headerlink" title="4.3.4.6 注意事项和细节"></a>4.3.4.6 注意事项和细节</h4><ol>
<li>因为 member-service-provider-10000 和 mem ber-service-provider-10002 作为一个集群提供服务，因此需要將 spring.application.name 进行统一。</li>
<li>这样消费方通过统一的别名进行负载均衡调用。</li>
</ol>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230528142117680.png" alt="image-20230528142117680" style="zoom:33%;" />

<p>将相同服务的提供方对外暴露的名称设置为相同的，这样就方便管理了。</p>
<h3 id="4-3-5-配置服务消费端-member-service-consumer-80-使用会员中心服务集群"><a href="#4-3-5-配置服务消费端-member-service-consumer-80-使用会员中心服务集群" class="headerlink" title="4.3.5 配置服务消费端 member-service-consumer-80 使用会员中心服务集群"></a><strong>4.3.5</strong> 配置服务消费端 <strong>member-service-consumer-80</strong> 使用会员中心服务集群</h3><h4 id="4-3-5-1-架构图"><a href="#4-3-5-1-架构图" class="headerlink" title="4.3.5.1 架构图"></a>4.3.5.1 架构图</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230528143413873.png" alt="image-20230528143413873"></p>
<h4 id="4-3-5-2-修改-MemberConsumerController-java"><a href="#4-3-5-2-修改-MemberConsumerController-java" class="headerlink" title="4.3.5.2 修改 MemberConsumerController.java"></a>4.3.5.2 修改 MemberConsumerController.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MEMBER_SERVICE_PROVIDER_URL</span> <span class="operator">=</span> <span class="string">&quot;http://member-service-provider&quot;</span>;</span><br><span class="line"><span class="comment">//member-service-provider为服务提供集群对外暴露的统一名称</span></span><br></pre></td></tr></table></figure>

<h4 id="4-3-5-3-修改-CustomizationBean-java"><a href="#4-3-5-3-修改-CustomizationBean-java" class="headerlink" title="4.3.5.3 修改 CustomizationBean.java"></a>4.3.5.3 修改 CustomizationBean.java</h4><p>​	给 RestTemplate添加注解：**@LoadBalanced**</p>
<p>​		目的是：赋予 <em>RestTemplate</em> 负载均衡的能力</p>
<h4 id="4-3-5-5-完成测试"><a href="#4-3-5-5-完成测试" class="headerlink" title="4.3.5.5 完成测试"></a>4.3.5.5 完成测试</h4><h5 id="4-3-5-5-1-启动-eureka-server-集群-目前-2-台"><a href="#4-3-5-5-1-启动-eureka-server-集群-目前-2-台" class="headerlink" title="4.3.5.5.1 启动 eureka server 集群**(目前 2 台)**"></a>4.3.5.5.1 启动 <strong>eureka server</strong> 集群**(<strong>目前 <strong>2</strong> 台</strong>)**</h5><h5 id="4-3-5-5-2-启动-member-service-provider-10000"><a href="#4-3-5-5-2-启动-member-service-provider-10000" class="headerlink" title="4.3.5.5.2 启动 member-service-provider-10000"></a>4.3.5.5.2 启动 <strong>member-service-provider-10000</strong></h5><h5 id="4-3-5-5-3-启动-member-service-provider-10002"><a href="#4-3-5-5-3-启动-member-service-provider-10002" class="headerlink" title="4.3.5.5.3 启动 member-service-provider-10002"></a>4.3.5.5.3 启动 <strong>member-service-provider-10002</strong></h5><h5 id="4-3-5-5-4不急，先测试-http-localhost-10000-member-get-1-和-http-localhost-10002-member-get-1"><a href="#4-3-5-5-4不急，先测试-http-localhost-10000-member-get-1-和-http-localhost-10002-member-get-1" class="headerlink" title="4.3.5.5.4不急，先测试 : http://localhost:10000/member/get/1 和 http://localhost:10002/member/get/1"></a><strong>4.3.5.5.4</strong>不急，先测试 <strong>: <a target="_blank" rel="noopener" href="http://localhost:10000/member/get/1">http://localhost:10000/member/get/1</a></strong> 和 <strong><a target="_blank" rel="noopener" href="http://localhost:10002/member/get/1">http://localhost:10002/member/get/1</a></strong></h5><p>先看看直接使用服务提供方时有没有问题，没问题再进行下一步测试(方便排错！)</p>
<h5 id="4-3-5-5-5-启动-member-service-consumer-80"><a href="#4-3-5-5-5-启动-member-service-consumer-80" class="headerlink" title="4.3.5.5.5 启动 member-service-consumer-80"></a><strong>4.3.5.5.5</strong> 启动 <strong>member-service-consumer-80</strong></h5><h5 id="4-3-5-5-6-浏览器访问-http-localhost-member-consumer-get-1"><a href="#4-3-5-5-6-浏览器访问-http-localhost-member-consumer-get-1" class="headerlink" title="4.3.5.5.6 浏览器访问**: http://localhost/member/consumer/get/1**"></a><strong>4.3.5.5.6</strong> 浏览器访问**: <a target="_blank" rel="noopener" href="http://localhost/member/consumer/get/1">http://localhost/member/consumer/get/1</a>**</h5><h4 id="4-3-5-6-交替访问member服务说明"><a href="#4-3-5-6-交替访问member服务说明" class="headerlink" title="4.3.5.6 交替访问member服务说明:"></a>4.3.5.6 交替访问member服务说明:</h4><ol>
<li>注解@LoadBalanced 底层是Ribbon支持算法</li>
<li>2.Ribbon和Eureka 整合后consumer 直接调用服务而不用再关心地址和端口号，且该服务还有负载功能</li>
</ol>
<h3 id="4-3-6-获取-Eureka-Server-服务注册信息-DiscoveryClient"><a href="#4-3-6-获取-Eureka-Server-服务注册信息-DiscoveryClient" class="headerlink" title="4.3.6 获取 Eureka Server 服务注册信息 -DiscoveryClient"></a><strong>4.3.6</strong> 获取 <strong>Eureka Server</strong> 服务注册信息 <strong>-DiscoveryClient</strong></h3><h4 id="4-3-6-1-需求分析-x2F-图解"><a href="#4-3-6-1-需求分析-x2F-图解" class="headerlink" title="4.3.6.1 需求分析&#x2F;图解"></a>4.3.6.1 需求分析&#x2F;图解</h4><p><strong>1.</strong> 需求分析示意图</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230528150507261.png" alt="image-20230528150507261"></p>
<p><strong>2.</strong> <strong>这里我们以服务消费方</strong>， <strong>去获取</strong> <strong>Eureka Server</strong> <strong>的服务注册信息为例讲解</strong></p>
<p><strong>3.</strong> <strong>当然也可以在服务提供方获取</strong> <strong>Eureka Server</strong> <strong>的服务注册信息</strong></p>
<h4 id="4-3-6-2-代码实现"><a href="#4-3-6-2-代码实现" class="headerlink" title="4.3.6.2 代码实现"></a>4.3.6.2 代码实现</h4><ol>
<li><strong>所在模块  member-service-consumer-80</strong></li>
<li><strong>修改</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberConsumerController.java</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//装配DiscoveryClient</span></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> DiscoveryClient discoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/member/consumer/discovery&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">discovery</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;String&gt; services = discoveryClient.getServices();</span><br><span class="line">    <span class="keyword">for</span> (String service : services)&#123;</span><br><span class="line">        log.info(<span class="string">&quot;服务名=&#123;&#125;&quot;</span>,service);</span><br><span class="line">        List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(service);</span><br><span class="line">        <span class="keyword">for</span> (ServiceInstance instance : instances)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;id=&#123;&#125;,host=&#123;&#125;,port=&#123;&#125;,uri=&#123;&#125;&quot;</span>,instance.getServiceId(),instance.getHost(),instance.getPort(),instance.getUri());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> discoveryClient;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.</strong> <strong>这里修改主启动类</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;MemberConsumerApplication.java</strong></p>
<p>添加注解：@EnableDiscoveryClient</p>
<h4 id="4-3-6-3-测试"><a href="#4-3-6-3-测试" class="headerlink" title="4.3.6.3 测试"></a>4.3.6.3 测试</h4><p><strong>1.</strong> <strong>重启</strong> <strong>member-service-consumer-80</strong></p>
<p><strong>2.</strong> <strong>浏览器输出</strong> <strong><a target="_blank" rel="noopener" href="http://localhost/member/consumer/discovery">http://localhost/member/consumer/discovery</a></strong></p>
<h4 id="4-3-6-4-注意事项和细节说明"><a href="#4-3-6-4-注意事项和细节说明" class="headerlink" title="4.3.6.4 注意事项和细节说明"></a>4.3.6.4 注意事项和细节说明</h4><ol>
<li><p>在引入 <strong>DiscoveryClient</strong> 时，不要引入错误的包：</p>
<p>正确的包**:** <strong>import</strong> <strong>org.springframework.cloud.client.discovery.DiscoveryClient</strong>;</p>
<p>错误的包**:** <strong>import</strong> <strong>com.netflix.discovery.DiscoveryClient</strong>;</p>
</li>
</ol>
<h2 id="4-4-Eureka后续说明"><a href="#4-4-Eureka后续说明" class="headerlink" title="4.4 Eureka后续说明"></a>4.4 Eureka后续说明</h2><p><strong>1. Eureka</strong> 停更说明**: <a target="_blank" rel="noopener" href="https://github.com/Netflix/eureka/wiki">https://github.com/Netflix/eureka/wiki</a>**</p>
<p><strong>2.</strong> <strong>对于一些早期使用</strong> <strong>Eureka</strong> <strong>项目，掌握老师讲解技术基本可以应付了</strong>(<strong>这也是老师为什么还 要讲</strong> <strong>Eureka</strong> <strong>的原因</strong>)</p>
<p><strong>3.目前替代 Eureka 做服务注册和发现，均衡负载的 最佳组件是 spring Cloud Alibaba Nacos，后面老师会重点讲解。</strong></p>
<p><strong>4.虽然Eureka 停更，目前用的不多，但是它的服务注册和发现，均衡负载的思想是优先的，有了Eureka 的基础，我们学习 Spring Cloud Alibaba Nacos 会轻松很多</strong></p>
<h1 id="5-SpringCloudRibbon服务负载均衡"><a href="#5-SpringCloudRibbon服务负载均衡" class="headerlink" title="5 SpringCloudRibbon服务负载均衡"></a><strong>5 SpringCloudRibbon</strong>服务负载均衡</h1><h2 id="5-1-Ribbon介绍"><a href="#5-1-Ribbon介绍" class="headerlink" title="5.1 Ribbon介绍"></a>5.1 Ribbon介绍</h2><h3 id="5-1-1-Ribbon是什么"><a href="#5-1-1-Ribbon是什么" class="headerlink" title="5.1.1 Ribbon是什么"></a><strong>5.1.1 Ribbon</strong>是什么</h3><ol>
<li><p>Spring Cloud Ribbon 是<strong>基于 Netflix Ribbon</strong> 实现的一套**<u>客户端负载均衡</u>**的工具。</p>
</li>
<li><p>Ribbon 主要功能是<strong>提供客户端负载均衡算法和服务调用</strong></p>
</li>
<li><p>Ribbon 客户端组件提供一系列完善的配置项如连接超时，重试等。</p>
</li>
<li><p>Ribbon 会基于某种规则（如简单轮询，随机连接等）去连接指定服务</p>
</li>
<li><p>程序员很容易使用 Ribbon 的负载均衡算法实现负载均衡</p>
</li>
<li><p>一句话：Ribbon： <strong>负载均衡+RestTemplate调用</strong></p>
</li>
</ol>
<h3 id="5-1-2-官网"><a href="#5-1-2-官网" class="headerlink" title="5.1.2 官网"></a><strong>5.1.2</strong> 官网</h3><h4 id="5-1-2-1-https-github-com-Netflix-ribbon"><a href="#5-1-2-1-https-github-com-Netflix-ribbon" class="headerlink" title="5.1.2.1 https://github.com/Netflix/ribbon"></a>5.1.2.1 <a target="_blank" rel="noopener" href="https://github.com/Netflix/ribbon">https://github.com/Netflix/ribbon</a></h4><h3 id="5-1-3-Ribbon进入维护状态"><a href="#5-1-3-Ribbon进入维护状态" class="headerlink" title="5.1.3 Ribbon进入维护状态"></a><strong>5.1.3 Ribbon</strong>进入维护状态</h3><p><strong>Ribbon 目前进入维护模式, 未来替换方案 是 <u>Spring Cloud LoadBalancer</u></strong></p>
<h3 id="5-1-4-LB-Load-Balance"><a href="#5-1-4-LB-Load-Balance" class="headerlink" title="5.1.4 LB(Load Balance)"></a>5.1.4 LB(Load Balance)</h3><h4 id="5-1-4-1-LB分类"><a href="#5-1-4-1-LB分类" class="headerlink" title="5.1.4.1 LB分类"></a>5.1.4.1 LB分类</h4><h5 id="集中式-LB"><a href="#集中式-LB" class="headerlink" title="集中式 LB"></a>集中式 LB</h5><ul>
<li><p>即在服务的消费方和提供方之间使用独立的LB设施（可以是硬件，如F5，也可以是软件，如Nginx)，由该设施负责把访向请求通过某种策略转发至服务的提供方：</p>
</li>
<li><p>LB(Load Balance 负载均衡）</p>
</li>
</ul>
<h5 id="进程内-LB"><a href="#进程内-LB" class="headerlink" title="进程内 LB"></a>进程内 LB</h5><ul>
<li><p>将LB逻辑集成到消费方，消费方从服务注册中心获知有哪些服务地址可用，然后再从这些地址中选择出一个合适的服务地址。</p>
</li>
<li><p>Ribbon就属于进程内LB，它只是一个类库，集成于消费方进程，消费方通过它来获取到服务提供方的地址。</p>
</li>
</ul>
<h4 id="5-1-4-2-实例-前面-member-consumer-轮询负载访问-10000-x2F-10002-底层就是-Ribbon-默认的轮询负载算法"><a href="#5-1-4-2-实例-前面-member-consumer-轮询负载访问-10000-x2F-10002-底层就是-Ribbon-默认的轮询负载算法" class="headerlink" title="5.1.4.2 实例-前面 member-consumer 轮询负载访问 10000&#x2F;10002 底层就是 Ribbon 默认的轮询负载算法"></a>5.1.4.2 实例-前面 member-consumer 轮询负载访问 10000&#x2F;10002 底层就是 Ribbon 默认的轮询负载算法</h4><h2 id="5-2-Ribbon原理"><a href="#5-2-Ribbon原理" class="headerlink" title="5.2 Ribbon原理"></a>5.2 Ribbon原理</h2><h3 id="5-2-1-Ribbon架构图-amp-机制"><a href="#5-2-1-Ribbon架构图-amp-机制" class="headerlink" title="5.2.1 Ribbon架构图**&amp;**机制"></a><strong>5.2.1 Ribbon</strong>架构图**&amp;**机制</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230529203201726.png" alt="image-20230529203201726">Ribbon 机制</p>
<ol>
<li><strong>先选择 EurekaServer</strong>，它<u>优先选择在同一个区域内负载较少的 serve</u>r</li>
<li><strong>再根据用户指定的策略</strong>，在<u>从 server取到的服务注册列表中选择一个地址</u></li>
<li>Ribbon 提供了多种策略：比如轮询、随机和根据响应时间加权。</li>
</ol>
<h3 id="5-2-2-Ribbon常见负载算法"><a href="#5-2-2-Ribbon常见负载算法" class="headerlink" title="5.2.2 Ribbon常见负载算法"></a><strong>5.2.2 Ribbon</strong>常见负载算法</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230529203353777.png" alt="image-20230529203353777"></p>
<h2 id="5-3-替换负载均衡算法-应用实例"><a href="#5-3-替换负载均衡算法-应用实例" class="headerlink" title="5.3 替换负载均衡算法-应用实例"></a>5.3 替换负载均衡算法-应用实例</h2><h3 id="5-3-1-需求分析-x2F-图解"><a href="#5-3-1-需求分析-x2F-图解" class="headerlink" title="5.3.1 需求分析**&#x2F;**图解"></a><strong>5.3.1</strong> 需求分析**&#x2F;**图解</h3><ol>
<li>需求：将默认的轮询算法改成随机算法 RandomRule</li>
<li>浏览器输入：htp:&#x2F;&#x2F;ocalhost&#x2F;member&#x2F;consuimer&#x2F;get&#x2F;1</li>
<li>要求 彷问的 10000&#x2F;10002 端口的服务是随机的</li>
</ol>
<h3 id="5-3-2代码实现"><a href="#5-3-2代码实现" class="headerlink" title="5.3.2代码实现"></a>5.3.2代码实现</h3><ol>
<li>创建 member-service-consumer-80com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;RibbonRule.java</li>
</ol>
<h3 id="5-3-3-测试"><a href="#5-3-3-测试" class="headerlink" title="5.3.3 测试"></a><strong>5.3.3</strong> 测试</h3><p><strong>1.</strong> 浏览器输入 **: <a target="_blank" rel="noopener" href="http://localhost/member/consumer/get/1">http://localhost/member/consumer/get/1</a> **</p>
<p><strong>2.</strong> <strong>观察访问的</strong> <strong>10000&#x2F;10002</strong> <strong>端口的服务是随机的</strong></p>
<h1 id="6-SpringCloud-Open-Feign服务调用"><a href="#6-SpringCloud-Open-Feign服务调用" class="headerlink" title="6 SpringCloud Open Feign服务调用"></a>6 SpringCloud Open Feign服务调用</h1><h2 id="6-1-OpenFeign介绍"><a href="#6-1-OpenFeign介绍" class="headerlink" title="6.1 OpenFeign介绍"></a>6.1 OpenFeign介绍</h2><h3 id="6-1-1-OpenFeign是什么"><a href="#6-1-1-OpenFeign是什么" class="headerlink" title="6.1.1 OpenFeign是什么"></a><strong>6.1.1 OpenFeign</strong>是什么</h3><ol>
<li><p>0penFeign 是个声明式 Webservice 客户端，使用 OpenFeign 让编写 web Service 客户端更简单</p>
</li>
<li><p>它的使用方法是定义一个服务接口然后在上面添加注解</p>
</li>
<li><p>0penFeign 也支持可拔插式的编码器和解码器。</p>
</li>
<li><p>Spring cloud 对 OpenFeign 进行了封装使其支持了 Spring Mvc 标准注解和HttpMessageConverters</p>
</li>
<li><p>0penFeign 可以与Eureka 和 Ribbon 组合使用以支持负载均衡</p>
</li>
</ol>
<h3 id="6-1-2-官网"><a href="#6-1-2-官网" class="headerlink" title="6.1.2 官网"></a><strong>6.1.2</strong> 官网</h3><h4 id="6-1-2-1-https-github-com-spring-cloud-spring-cloud-openfeign"><a href="#6-1-2-1-https-github-com-spring-cloud-spring-cloud-openfeign" class="headerlink" title="6.1.2.1 https://github.com/spring-cloud/spring-cloud-openfeign"></a>6.1.2.1 <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-openfeign">https://github.com/spring-cloud/spring-cloud-openfeign</a></h4><h3 id="6-1-3-Feign和OpenFeign区别"><a href="#6-1-3-Feign和OpenFeign区别" class="headerlink" title="6.1.3 Feign和OpenFeign区别"></a><strong>6.1.3 Feign</strong>和<strong>OpenFeign</strong>区别</h3><p>​	Feign(不好用，没人用了)：</p>
<ul>
<li><p>Feign是Spring Cioud组件中的一个轻量级RESTful的HTTP服务客户端</p>
</li>
<li><p>Feign内置了Ribbon，用来做客户端免载均衡， 去调用服务注册中心的服务。</p>
</li>
<li><p>Feign的使用方式是：使用Feign的注解定义接口，调用服务注册中心的服务</p>
</li>
<li><p>Feign支持的注解和用法请参考官方文档：<a target="_blank" rel="noopener" href="https://githulb.com/OpenFeign/feign">https://githulb.com/OpenFeign/feign</a></p>
</li>
<li><p>Feign本身不支持Spring MvC的注解，它有一套自己的注解</p>
</li>
</ul>
<p>​	</p>
<p>​	OpenFeign：</p>
<ul>
<li><p>openFeign是Spring Cloud **<u>在Feign的基础上支持了Spring MvC的注解</u>**，如@Requesapping等等。</p>
</li>
<li><p>OpenFeign的@FeignClient可以解析SpringvC的@RequestMapping注解下的接口</p>
</li>
<li><p>OpenFeign通过动态代理的方式产生实现类，实现<strong>类中做负载均衡并调用其他服务</strong></p>
</li>
</ul>
<p>精简一句话 : <strong>OpenFeign 就是在 Feign 基础上做了加强</strong> , 有些程序员为了方便，说 <u>Feign 就是指的 OpenFeign</u></p>
<h2 id="6-2-OpenFeign-应用实例"><a href="#6-2-OpenFeign-应用实例" class="headerlink" title="6.2 OpenFeign-应用实例"></a>6.2 OpenFeign-应用实例</h2><h3 id="6-2-1-需求分析-x2F-图解"><a href="#6-2-1-需求分析-x2F-图解" class="headerlink" title="6.2.1 需求分析**&#x2F;**图解"></a><strong>6.2.1</strong> 需求分析**&#x2F;**图解</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230529210545959.png" alt="image-20230529210545959"></p>
<p>(Eureka实现获取服务、Ribbon实现自定义负载均衡算法、RestTemplate实现远程调用)</p>
<p>(Eureka实现获取服务、OpenFeign实现负载均衡+远程调用)</p>
<h3 id="6-2-2-创建服务消费模块-通过-OpenFeigen-实现远程调用"><a href="#6-2-2-创建服务消费模块-通过-OpenFeigen-实现远程调用" class="headerlink" title="6.2.2 创建服务消费模块 **-**通过 OpenFeigen 实现远程调用"></a><strong>6.2.2</strong> 创建服务消费模块 **-**通过 <strong>OpenFeigen</strong> 实现远程调用</h3><p><strong>1.</strong> 参考 <strong>member-service-consumer-80</strong> 创建 **member-service-consumer-openfeign-80(**具体步骤参考以前)</p>
<p><strong>2.</strong> <strong>修改</strong> <strong>pom.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    引入openfeign-start，即场景启动器    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>**3.创建 application.yml 内容如下:**、</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">e-commerce-consumer-openfeign</span></span><br><span class="line"><span class="comment">#配置eureka-client</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#将自己注册到Eureka-server</span></span><br><span class="line">    <span class="comment">#表示从Eureka-server抓取注册信息</span></span><br><span class="line">    <span class="comment">#如果是单节点，可以不配置；</span></span><br><span class="line">    <span class="comment">#但是provider是一个集群，则必须将此项配置为true，这样才能配合Ribbon使用负载均衡功能</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># 表示将自己注册到哪个eureka-server</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka9001.com:9001/eureka,http://eureka9002.com:9002/eureka</span></span><br></pre></td></tr></table></figure>

<p>4.创建主启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span> <span class="comment">//启动openFeignClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberConsumerOpenfeignApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MemberConsumerOpenfeignApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>创建 com&#x2F;study&#x2F;springcloud&#x2F;service&#x2F;MemberFeignService.java</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;MEMBER-SERVICE-PROVIDER&quot;)</span>	</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MemberFeignService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在这里定义方法——远程调用服务提供方给的接口</span></span><br><span class="line">    <span class="comment">//原来是使用RestController实现功能的</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.远程调用的方式是get</span></span><br><span class="line">    <span class="comment">//2.远程调用的url http:MEMBER-SERVICE-PROVIDER/member/get/&#123;id&#125;</span></span><br><span class="line">    <span class="comment">//3.MEMBER-SERVICE-PROVIDER是服务提供方在Eureka Server注册的服务</span></span><br><span class="line">    <span class="comment">//4.openfeign会根据负载均衡来决定调用哪个服务-默认是轮询</span></span><br><span class="line">    <span class="comment">//5.优点：openfeign支持了springMVC注解 + 接口 --&gt;解耦</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/member/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">getMemberById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>创建 com&#x2F;study&#x2F;springcloud&#x2F;controller&#x2F;MemberConsumerFeignController.java</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span> <span class="comment">//结果以json格式返回</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberConsumerFeignController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//装配MemberFeignService</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MemberFeignService memberFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/member/consumer/openfeign/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">getMemberById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> memberFeignService.getMemberById(id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-3-测试"><a href="#6-2-3-测试" class="headerlink" title="6.2.3 测试"></a><strong>6.2.3</strong> 测试</h3><p>​	浏览器输入 <strong>: <a target="_blank" rel="noopener" href="http://localhost/member/consumer/openfeign/get/1">http://localhost/member/consumer/openfeign/get/1</a></strong></p>
<h3 id="6-2-4-注意事项和细节"><a href="#6-2-4-注意事项和细节" class="headerlink" title="6.2.4 注意事项和细节"></a><strong>6.2.4</strong> 注意事项和细节</h3><ul>
<li><p>配Openfeign的使用特点是 微服务调用接口+@Feignclient，使用接口进行<strong>解耦</strong></p>
</li>
<li><p>@FeignClient(value &#x3D; “MEMBER-SERVICE-PROVIDER”)，这里MEMBER-SERVICE-PROVIDER就是Eureka Server服务提供方注册的名称，不要写错了</p>
</li>
<li><p>接口方法上： value是不能乱写，远程调用的url 为<a target="_blank" rel="noopener" href="http://member-service-provider/member/get/%7Bid%7D">http://MEMBER-SERVICE-PROVIDER/member/get/{id}</a></p>
</li>
</ul>
<p>​	@GetMapping(“&#x2F;member&#x2F;get&#x2F;{id}”)<br>​    public Result getMemberById(@PathVariable(“id”)Long id);</p>
<h2 id="6-3-日志配置"><a href="#6-3-日志配置" class="headerlink" title="6.3 日志配置"></a>6.3 日志配置</h2><h3 id="6-3-1-基本介绍"><a href="#6-3-1-基本介绍" class="headerlink" title="6.3.1 基本介绍"></a><strong>6.3.1</strong> 基本介绍</h3><p>1．说明：Feign 提供了日志打印功能，可以通过配罝来调整日志级别，从而对 Feign 接口的调用情况进行监控和输出</p>
<p>2.日志级别</p>
<ul>
<li><p><strong>NONE</strong> ：默认的，不显示任何日志</p>
</li>
<li><p><strong>BASIC</strong>：仅记录请求方法、URL、响应状态码及执行时间;</p>
</li>
<li><p><strong>HEADERS</strong> ： 除了 BASIC中定义的信息之外，还有请求和响应的头信息;</p>
</li>
<li><p><strong>FULL</strong>：除了HEADERS中定义的信息之外，还有请求和响应的正文及元数据。</p>
</li>
</ul>
<h3 id="6-3-2-配置日志-应用实例"><a href="#6-3-2-配置日志-应用实例" class="headerlink" title="6.3.2 配置日志**-**应用实例"></a><strong>6.3.2</strong> 配置日志**-**应用实例</h3><p><strong>1.</strong> 在 <strong>member-service-consumer-openfeign-80</strong> 创 建</p>
<p><strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;OpenFeignConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenFeignConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger.Level <span class="title function_">loggerLevel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> 在 <strong>member-service-consumer-openfeign-80</strong> 修改 <strong>application.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#对MemberFeignService接口调用过程打印信息-debug</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.study.springcloud.service.MemberFeignService:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230530125632781.png" alt="image-20230530125632781" style="zoom:50%;" />

<h3 id="6-3-3-测试"><a href="#6-3-3-测试" class="headerlink" title="6.3.3 测试"></a><strong>6.3.3</strong> 测试</h3><p>……</p>
<h2 id="6-4-OpenFeign超时"><a href="#6-4-OpenFeign超时" class="headerlink" title="6.4 OpenFeign超时"></a>6.4 OpenFeign超时</h2><p>若服务提供方(可能由于各种原因，比如操作数据库时间过长)响应超过OpenFeign的等待时间(默认1秒)，会返回超时错误(time out)</p>
<p>……</p>
<h3 id="6-4-3-设置OpenFeign超时时间"><a href="#6-4-3-设置OpenFeign超时时间" class="headerlink" title="6.4.3 设置OpenFeign超时时间"></a><strong>6.4.3</strong> 设置OpenFeign超时时间</h3><p>在服务消费方的配置文件中进行响应配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置feign客户端超时时间</span></span><br><span class="line"><span class="comment"># read-timeout 建立连接：从服务提供方获取可用资源的全部时间</span></span><br><span class="line"><span class="comment"># connect-timeout 两端连接所用时间</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">connect-timeout:</span> <span class="number">5000</span></span><br><span class="line">        <span class="attr">read-timeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure>

<h3 id="6-4-4-测试"><a href="#6-4-4-测试" class="headerlink" title="6.4.4 测试"></a><strong>6.4.4</strong> 测试</h3><p>……</p>
<h1 id="7-🌟SpringCloudGateway-服务网关"><a href="#7-🌟SpringCloudGateway-服务网关" class="headerlink" title="7 🌟SpringCloudGateway 服务网关"></a>7 🌟SpringCloudGateway 服务网关</h1><h2 id="7-1-Gateway介绍"><a href="#7-1-Gateway介绍" class="headerlink" title="7.1 Gateway介绍"></a>7.1 Gateway介绍</h2><h3 id="7-1-1-看一个需求，引出网关服务"><a href="#7-1-1-看一个需求，引出网关服务" class="headerlink" title="7.1.1 看一个需求，引出网关服务"></a><strong>7.1.1</strong> 看一个需求，引出网关服务</h3><p><strong>1</strong>、有一个前后端分离项目**,** 分析如图</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230530144204835.png" alt="image-20230530144204835"></p>
<p>2、使用网关服务, 重构项目架构</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230530144645171.png" alt="image-20230530144645171"></p>
<h3 id="7-1-2-🌟Gateway-网络拓扑图"><a href="#7-1-2-🌟Gateway-网络拓扑图" class="headerlink" title="7.1.2 🌟Gateway 网络拓扑图"></a><strong>7.1.2 🌟Gateway</strong> 网络拓扑图</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230530151559362.png" alt="image-20230530151559362"></p>
<h3 id="7-1-3-Gateway是什么"><a href="#7-1-3-Gateway是什么" class="headerlink" title="7.1.3 Gateway是什么"></a><strong>7.1.3 Gateway</strong>是什么</h3><ol>
<li><p>Gateway 是在 Spring 生态系统之上构建的 API 网关服务，基于 spring , Spring Boot 和 Project Reactor 等技术。</p>
</li>
<li><p>Gateway 旨在提供一种简单而有效的方式来对 API 进行路由，以及提供一些强大的过滤器功能，例如 ：熔断、限流、重试等。</p>
</li>
</ol>
<h3 id="7-1-4-官网"><a href="#7-1-4-官网" class="headerlink" title="7.1.4 官网"></a>7.1.4 官网</h3><h4 id="7-1-4-1-https-cloud-spring-io-spring-cloud-static-spring-cloud-gateway-2-2-1-RELEASE-reference-html"><a href="#7-1-4-1-https-cloud-spring-io-spring-cloud-static-spring-cloud-gateway-2-2-1-RELEASE-reference-html" class="headerlink" title="7.1.4.1 https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/"></a>7.1.4.1 <a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/</a></h4><h3 id="7-1-5-Gateway-核心功能"><a href="#7-1-5-Gateway-核心功能" class="headerlink" title="7.1.5 Gateway 核心功能"></a><strong>7.1.5 Gateway</strong> 核心功能</h3><h4 id="7-1-5-1-鉴权"><a href="#7-1-5-1-鉴权" class="headerlink" title="7.1.5.1 鉴权"></a>7.1.5.1 鉴权</h4><h4 id="7-1-5-2-流量控制"><a href="#7-1-5-2-流量控制" class="headerlink" title="7.1.5.2 流量控制"></a>7.1.5.2 流量控制</h4><h4 id="7-1-5-3-熔断"><a href="#7-1-5-3-熔断" class="headerlink" title="7.1.5.3 熔断"></a>7.1.5.3 熔断</h4><h4 id="7-1-5-4-日志监控"><a href="#7-1-5-4-日志监控" class="headerlink" title="7.1.5.4 日志监控"></a>7.1.5.4 日志监控</h4><h4 id="7-1-5-5-反向代理"><a href="#7-1-5-5-反向代理" class="headerlink" title="7.1.5.5 反向代理"></a>7.1.5.5 反向代理</h4><h3 id="7-1-6-Gateway-vs-Zuul"><a href="#7-1-6-Gateway-vs-Zuul" class="headerlink" title="7.1.6 Gateway vs Zuul"></a><strong>7.1.6 Gateway vs Zuul</strong></h3><h4 id="7-1-6-1-Gateway-和-Zuul-区别"><a href="#7-1-6-1-Gateway-和-Zuul-区别" class="headerlink" title="7.1.6.1 Gateway 和 Zuul 区别"></a>7.1.6.1 Gateway 和 Zuul 区别</h4><ol>
<li><p>SpringCloud Gateway 作为 Spring Cloud 生态系统中的网关，目标是替代 Zuul</p>
</li>
<li><p>SpringCloud Gateway 是基于 Spring WebFlux框架实现的</p>
</li>
<li><p>Spring WebFlux 框架底层则使用了高性能的 Reactor 模式通信框架 Netty，提升了网关性能</p>
</li>
</ol>
<h4 id="7-1-6-2-Gateway-特性"><a href="#7-1-6-2-Gateway-特性" class="headerlink" title="7.1.6.2 Gateway 特性"></a>7.1.6.2 Gateway 特性</h4><p>​	Spring Cloud Gateway 基 于 Spring Framework(支 特 Spring WebFlux)， project Reactor 和 spring Boot 进行构建，具有如下特性：</p>
<ul>
<li>动态路由</li>
<li>可以对路由指定 predicate(断言)和Filter(过滤器）</li>
<li>集成Hystrix的断路器功能</li>
<li>集成 Spring Cloud 服务发现功能</li>
<li>请求限流功能</li>
<li>支持路径重写</li>
</ul>
<h2 id="7-2-Gateway基本原理"><a href="#7-2-Gateway基本原理" class="headerlink" title="7.2 Gateway基本原理"></a>7.2 Gateway基本原理</h2><h3 id="7-2-1-Gateway核心组件"><a href="#7-2-1-Gateway核心组件" class="headerlink" title="7.2.1 Gateway核心组件"></a><strong>7.2.1 Gateway</strong>核心组件</h3><h4 id="7-2-1-1-一张图"><a href="#7-2-1-1-一张图" class="headerlink" title="7.2.1.1 一张图"></a>7.2.1.1 一张图</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230530152704594.png" alt="image-20230530152704594" style="zoom:50%;" />

<ol>
<li><p>web 请求通过一些匹配条件，定位到真正的服务节点&#x2F;微服务模块，在这个转发过程的前后，进行一些精细化控制。</p>
</li>
<li><p>predicate：就是匹配条件(请求是否能被接受使用)</p>
</li>
<li><p>filter：可以理解为是网关的过滤机制。</p>
<p>有了predicate 和filter，再加上目标 URL,就可以实现一个具体的路由</p>
</li>
</ol>
<h4 id="7-2-1-2-Route-路由"><a href="#7-2-1-2-Route-路由" class="headerlink" title="7.2.1.2 Route(路由)"></a>7.2.1.2 Route(路由)</h4><p>一句话：路由是构建网关的基本模块，它由 <strong>ID</strong>，<strong>目标 URL</strong>，<strong>一系列的断言和过滤器</strong>组成，如果断言为 true 则匹配该路由。</p>
<h4 id="7-2-1-3-Predicate-断言"><a href="#7-2-1-3-Predicate-断言" class="headerlink" title="7.2.1.3 Predicate(断言)"></a>7.2.1.3 Predicate(断言)</h4><ol>
<li><p>一句话：对 HTTP 请求中的所有内容（例如请求头或请求参数）进行匹配，如果请求与断言相匹配则进行路由</p>
</li>
<li><p>简单举例，比如配置路径，- Path&#x3D;&#x2F;member&#x2F;get&#x2F;**             断言,路经相匹配的进行路由转发，如果Http 请求的路径不匹配，则不进行路由转发。</p>
</li>
</ol>
<h4 id="7-2-1-4-Filter-过滤"><a href="#7-2-1-4-Filter-过滤" class="headerlink" title="7.2.1.4 Filter(过滤)"></a>7.2.1.4 Filter(过滤)</h4><p>1、一句话：使用过滤器，可以在<strong>请求被路由前或者之后</strong>对请求进行处理</p>
<p>2、你可以理解成，在对 Http 请求断言匹配成功后，可以通过网关的过滤机制，对Http 请求处理</p>
<h3 id="7-2-2-HowItWorks工作机制"><a href="#7-2-2-HowItWorks工作机制" class="headerlink" title="7.2.2 HowItWorks工作机制"></a><strong>7.2.2 HowItWorks</strong>工作机制</h3><h4 id="7-2-2-1-一图胜千言"><a href="#7-2-2-1-一图胜千言" class="headerlink" title="7.2.2.1 一图胜千言"></a>7.2.2.1 一图胜千言</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230530163559159.png" alt="image-20230530163559159" style="zoom:50%;" />



<ol>
<li><p>客户端向 Spring Cloud Gateway 发出请求。然后在 Gateway Handler Mapping 中找到与请求相匹配的路由，將其发送到 Gateway Web Handler。</p>
</li>
<li><p>Handler 再通过指定的过滤器链来将请求发送到我们实际的服务执行业务逻辑，然后返回。</p>
</li>
<li><p>过滤器之间用虚线分开是因为过滤器可能会在发送代理请求之前（”pre”）或之后(“post”）执行业务逻辑。</p>
</li>
<li><p>Filter 在”pre”类型的过滤器可以做<strong>参数校验、权限校验、流量监控、日志输出、协议转换</strong>等，</p>
</li>
<li><p>在”post”类型的过滤器中可以做响应内容、响应头的修改，日志的输出，流量监控等有着非常重要的作用。</p>
</li>
</ol>
<p>一句话说：路由转发＋执行过滤器链</p>
<h2 id="7-3-搭建-Gateway-微服务"><a href="#7-3-搭建-Gateway-微服务" class="headerlink" title="7.3 搭建 Gateway 微服务"></a>7.3 搭建 Gateway 微服务</h2><h3 id="7-3-1-搭建-Gateway-应用实例"><a href="#7-3-1-搭建-Gateway-应用实例" class="headerlink" title="7.3.1 搭建 **Gateway-**应用实例"></a><strong>7.3.1</strong> 搭建 **Gateway-**应用实例</h3><h4 id="7-3-1-1-需求分析-x2F-图解"><a href="#7-3-1-1-需求分析-x2F-图解" class="headerlink" title="7.3.1.1 需求分析&#x2F;图解"></a>7.3.1.1 需求分析&#x2F;图解</h4><p>– 引入 <strong>Gateway</strong> 项目架构</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230531095247037.png" alt="image-20230531095247037"></p>
<p><strong>1.</strong> <strong>通过网关暴露的接口，实现调用真正的服务</strong> </p>
<p><strong>2.</strong> <strong>网关本身也是一个微服务模块</strong></p>
<h4 id="7-3-1-2-代码实现"><a href="#7-3-1-2-代码实现" class="headerlink" title="7.3.1.2 代码实现"></a>7.3.1.2 代码实现</h4><p><strong>1.</strong> 参考 <strong>member-service-consumer-80</strong> 创建 **e-commerce-gateway-20000(**具体步骤参考以前)<br><strong>2.</strong> 修改 <strong>pom.xml,</strong> 部分内容可以从 <strong>member-service-consumer-80</strong> 的 <strong>pom.xml</strong> 拷贝</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.study.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e-commerce-center<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e-commerce-gateway-20000<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="comment">&lt;!--       引入gateway start， 网关场景启动器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--       引入eureka-client场景启动器starter--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--老师特别说明：</span></span><br><span class="line"><span class="comment">    不要引入：spring-boot-starter-web、spring-boot-starter-actuator</span></span><br><span class="line"><span class="comment">    否则会出现冲突</span></span><br><span class="line"><span class="comment">    因为gateway是一个服务网关，不需要web</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入 e_commerce_center-common-api --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.study.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e_commerce_center-common-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>3.<strong>创建 <strong>application.yml(<strong>重点核心</strong>)</strong> 内容如下</strong>:</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">20000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">e-commerce-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span> <span class="comment">#配置路由，可以配置多个 List&lt;RouteDefinition&gt; routes</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">member_route01</span> <span class="comment">#路由的id，程序员自行配置</span></span><br><span class="line">          <span class="comment">#gateway 最终访问的url 是 uri + path</span></span><br><span class="line">          <span class="comment">#匹配后提供服务的路由地址：也可以是外网 如www.baidu.com</span></span><br><span class="line">          <span class="comment">#比如：客户端/浏览器请求url：http:localhost:20000/member/get/1</span></span><br><span class="line">          <span class="comment">#网关对请求url中的path进行匹配，如果匹配失败，返回404</span></span><br><span class="line">          <span class="comment">#如果匹配成功，最终访问的url=http://localhost:10000/member/get/1</span></span><br><span class="line">          <span class="comment">#                     即 uri + path</span></span><br><span class="line">          <span class="comment">#这里⬇️的uri是固定不变的，在当前这种情况下是可以不使用Eureka Server 的</span></span><br><span class="line">          <span class="comment">#后面会使用灵活uri配置，会用到Eureka Server</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://localhost:10000</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># 断言，可以有多种形式</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/member/get/**</span></span><br><span class="line"><span class="comment"># 配置Eureka Client</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">e-commerce-service</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#将自己注册到Eureka-server</span></span><br><span class="line">    <span class="comment">#表示从Eureka-server抓取注册信息</span></span><br><span class="line">    <span class="comment">#如果是单节点，可以不配置；</span></span><br><span class="line">    <span class="comment">#但是provider是一个集群，则必须将此项配置为true，这样才能配合Ribbon使用负载均衡功能</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># 表示将自己注册到哪个eureka-server</span></span><br><span class="line">      <span class="comment">#这里为了方便，就使用9001端口一个server</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka9001.com:9001/eureka</span></span><br></pre></td></tr></table></figure>

<p>**4.**创建主启动类 <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;GateWayApplication20000.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GateWayApplication20000</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GateWayApplication20000.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-3-1-3-测试"><a href="#7-3-1-3-测试" class="headerlink" title="7.3.1.3 测试"></a>7.3.1.3 测试</h4><p>……</p>
<h4 id="7-3-1-4-注意事项和细节"><a href="#7-3-1-4-注意事项和细节" class="headerlink" title="7.3.1.4 注意事项和细节"></a>7.3.1.4 注意事项和细节</h4><p>因为我们的 member 的 controller 的方法参数使用了@RequestBody ,所以在使用 postman时，需要使用 json 格式发送数据, 否则会报400错误。</p>
<h3 id="7-3-2-二说-Gateway-路由配置"><a href="#7-3-2-二说-Gateway-路由配置" class="headerlink" title="7.3.2 二说 Gateway 路由配置"></a><strong>7.3.2</strong> 二说 <strong>Gateway</strong> 路由配置</h3><h4 id="7-3-2-1-方式-1-application-yml-中配置-前面讲过"><a href="#7-3-2-1-方式-1-application-yml-中配置-前面讲过" class="headerlink" title="7.3.2.1 方式 1: application.yml 中配置-前面讲过"></a>7.3.2.1 方式 1: application.yml 中配置-前面讲过</h4><h4 id="7-3-2-2-方式-2-编写配置类注入【了解】"><a href="#7-3-2-2-方式-2-编写配置类注入【了解】" class="headerlink" title="7.3.2.2 方式 2: 编写配置类注入【了解】"></a>7.3.2.2 方式 2: 编写配置类注入【了解】</h4><p>​	<strong>1.</strong> 先注销 <strong>application.yml</strong> 对网关路由部分注销</p>
<p>​	<strong>2.</strong> <strong>重启</strong> <strong>e-commerce-gateway-20000,</strong> <strong>再次测试，网关路由失效</strong></p>
<p><strong>3.</strong> 参考官方文档:<a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#spring-cloud-circuitbreaker-filter-factory">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#spring-cloud-circuitbreaker-filter-factory</a> ， 创 建com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;GateWayRoutesConfig.java</p>
<h4 id="7-3-2-3-测试"><a href="#7-3-2-3-测试" class="headerlink" title="7.3.2.3 测试"></a>7.3.2.3 测试</h4><p>……</p>
<h3 id="7-3-3-动态路由"><a href="#7-3-3-动态路由" class="headerlink" title="7.3.3 动态路由"></a><strong>7.3.3</strong> 动态路由</h3><h4 id="7-3-3-1-需求分析-x2F-图"><a href="#7-3-3-1-需求分析-x2F-图" class="headerlink" title="7.3.3.1 需求分析&#x2F;图"></a>7.3.3.1 需求分析&#x2F;图</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230531150741007.png" alt="image-20230531150741007"></p>
<h4 id="7-3-3-2-代码实现"><a href="#7-3-3-2-代码实现" class="headerlink" title="7.3.3.2 代码实现"></a>7.3.3.2 代码实现</h4><p><strong>1.</strong> 修改 <strong>e-commerce-gateway-20000</strong> 的 <strong>application.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">20000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">e-commerce-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="comment"># 启用 DiscoveryClient 服务发现</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">routes:</span> <span class="comment">#配置路由，可以配置多个 List&lt;RouteDefinition&gt; routes</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">member_route01</span> <span class="comment">#路由的id，程序员自行配置</span></span><br><span class="line">          <span class="comment"># 1. lb:负载均衡协议名称</span></span><br><span class="line">          <span class="comment">#    member-service-provider：注册到eureka server的服务名(小写)</span></span><br><span class="line">          <span class="comment"># 2. 默认情况下，负载均衡算法为轮询</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://member-service-provider</span></span><br><span class="line">          <span class="attr">predicates:</span> </span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/member/get/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">member_route02</span> </span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://member-service-provider</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/member/save</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">member_route03</span> </span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://member-service-provider</span></span><br><span class="line">          <span class="attr">predicates:</span> </span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/</span></span><br><span class="line"><span class="comment"># 配置Eureka Client</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">e-commerce-service</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#将自己注册到Eureka-server</span></span><br><span class="line">    <span class="comment">#表示从Eureka-server抓取注册信息</span></span><br><span class="line">    <span class="comment">#如果是单节点，可以不配置；</span></span><br><span class="line">    <span class="comment">#但是provider是一个集群，则必须将此项配置为true，这样才能配合Ribbon使用负载均衡功能</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># 表示将自己注册到哪个eureka-server</span></span><br><span class="line">      <span class="comment">#这里为了方便，就使用9001端口一个server</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka9001.com:9001/eureka</span></span><br></pre></td></tr></table></figure>

<h4 id="7-3-3-3-测试"><a href="#7-3-3-3-测试" class="headerlink" title="7.3.3.3 测试"></a>7.3.3.3 测试</h4><h5 id="7-3-3-3-1-启动-e-commerce-eureka-server-9001"><a href="#7-3-3-3-1-启动-e-commerce-eureka-server-9001" class="headerlink" title="7.3.3.3.1 启动 e-commerce-eureka-server-9001"></a>7.3.3.3.1 启动 e-commerce-eureka-server-9001</h5><h5 id="7-3-3-3-2-启动-member-service-provider-10000"><a href="#7-3-3-3-2-启动-member-service-provider-10000" class="headerlink" title="7.3.3.3.2 启动 member-service-provider-10000"></a>7.3.3.3.2 启动 member-service-provider-10000</h5><h5 id="7-3-3-3-3-启动-member-service-provider-10002"><a href="#7-3-3-3-3-启动-member-service-provider-10002" class="headerlink" title="7.3.3.3.3 启动 member-service-provider-10002"></a>7.3.3.3.3 启动 member-service-provider-10002</h5><h5 id="7-3-3-3-4-启动-e-commerce-gateway-20000"><a href="#7-3-3-3-4-启动-e-commerce-gateway-20000" class="headerlink" title="7.3.3.3.4 启动 e-commerce-gateway-20000"></a>7.3.3.3.4 启动 e-commerce-gateway-20000</h5><h5 id="7-3-3-3-5-浏览器-通过网关访问-http-localhost-20000-member-get-1"><a href="#7-3-3-3-5-浏览器-通过网关访问-http-localhost-20000-member-get-1" class="headerlink" title="7.3.3.3.5 浏览器**:(通过网关访问) http://localhost:20000/member/get/1**"></a>7.3.3.3.5 浏览器**:(<strong>通过网关访问</strong>) <a target="_blank" rel="noopener" href="http://localhost:20000/member/get/1">http://localhost:20000/member/get/1</a>**</h5><p>​	浏览器输入**: <a target="_blank" rel="noopener" href="http://localhost:20000/member/get/1">http://localhost:20000/member/get/1</a>**</p>
<h4 id="7-3-3-4-注意事项和细节"><a href="#7-3-3-4-注意事项和细节" class="headerlink" title="7.3.3.4 注意事项和细节"></a>7.3.3.4 注意事项和细节</h4><h5 id="7-3-3-4-1-配置好动态路由后-Gateway-会根据注册中心上微服务名，为请求创建动态路由，实现-动态路由-功能"><a href="#7-3-3-4-1-配置好动态路由后-Gateway-会根据注册中心上微服务名，为请求创建动态路由，实现-动态路由-功能" class="headerlink" title="7.3.3.4.1 配置好动态路由后 Gateway 会根据注册中心上微服务名，为请求创建动态路由，实现 动态路由 功能"></a><strong>7.3.3.4.1</strong> 配置好动态路由后 <strong>Gateway</strong> 会根据注册中心上微服务名，为请求创建动态路由，实现 动态路由 功能</h5><h5 id="7-3-3-4-2-使用的-lb-协议支持负载均衡-轮询算法"><a href="#7-3-3-4-2-使用的-lb-协议支持负载均衡-轮询算法" class="headerlink" title="7.3.3.4.2 使用的 lb 协议支持负载均衡**-**轮询算法"></a><strong>7.3.3.4.2</strong> 使用的 <strong>lb</strong> 协议支持负载均衡**-**轮询算法</h5><h5 id="7-3-3-4-3-配置自己的负载均衡算法，-测试完毕恢复成原来的轮询算法"><a href="#7-3-3-4-3-配置自己的负载均衡算法，-测试完毕恢复成原来的轮询算法" class="headerlink" title="7.3.3.4.3 配置自己的负载均衡算法， 测试完毕恢复成原来的轮询算法"></a><strong>7.3.3.4.3</strong> 配置自己的负载均衡算法， 测试完毕恢复成原来的轮询算法</h5><h2 id="7-4-Predicate-x2F-断言"><a href="#7-4-Predicate-x2F-断言" class="headerlink" title="7.4 Predicate&#x2F;断言"></a>7.4 Predicate&#x2F;断言</h2><h3 id="7-4-1-基本介绍"><a href="#7-4-1-基本介绍" class="headerlink" title="7.4.1 基本介绍"></a><strong>7.4.1</strong> 基本介绍</h3><h4 id="7-4-1-1-一句话-Predicate-就是一组匹配规则，当请求匹配成功，就执行对应Route-匹配失败，放弃-处理-x2F-转发"><a href="#7-4-1-1-一句话-Predicate-就是一组匹配规则，当请求匹配成功，就执行对应Route-匹配失败，放弃-处理-x2F-转发" class="headerlink" title="7.4.1.1 一句话: Predicate 就是一组匹配规则，当请求匹配成功，就执行对应Route, 匹配失败，放弃 处理&#x2F;转发"></a>7.4.1.1 一句话: Predicate 就是一组匹配规则，当请求匹配成功，就执行对应Route, 匹配失败，放弃 处理&#x2F;转发</h4><h4 id="7-4-1-2-RoutePredicateFactories"><a href="#7-4-1-2-RoutePredicateFactories" class="headerlink" title="7.4.1.2 RoutePredicateFactories"></a>7.4.1.2 RoutePredicateFactories</h4><p><strong>文档地址</strong>: <a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories</a></p>
<ul>
<li>Spring Cloud Gateway包括许多内置的Route Predicate工厂，所有这些Predicate都与HTTP请求的不同属性匹配，可以组合使用．</li>
<li>Spring Cloud Gateway 创建 Route 对象时，使用RoutePredicateFactory 创建Predicate对象，Predicate 对象可以赋值给Route。</li>
<li>所有这些谓词都匹配HTTP请求的不同属性。多种谓词工厂可以组合</li>
</ul>
<p>其实就是利用工厂中的api进行断言</p>
<h3 id="7-4-2-RoutePredicate实例-根据上述文档进行操作演示"><a href="#7-4-2-RoutePredicate实例-根据上述文档进行操作演示" class="headerlink" title="7.4.2 RoutePredicate实例(根据上述文档进行操作演示)"></a>7.4.2 RoutePredicate实例(根据上述文档进行操作演示)</h3><h4 id="7-4-2-1-AfterRoutePredicate"><a href="#7-4-2-1-AfterRoutePredicate" class="headerlink" title="7.4.2.1 AfterRoutePredicate"></a>7.4.2.1 AfterRoutePredicate</h4><h5 id="7-4-2-1-1-需求分析-x2F-图解"><a href="#7-4-2-1-1-需求分析-x2F-图解" class="headerlink" title="7.4.2.1.1 需求分析**&#x2F;**图解"></a><strong>7.4.2.1.1</strong> 需求分析**&#x2F;**图解</h5><p><strong>1.</strong> 需求分析**&#x2F;**图解</p>
<p>​		需求**:** 只有 2022-11-18 12:35:50 <u><strong>之后</strong></u>的请求才进行匹配**&#x2F;<strong>转发</strong>,** 不满足该条件的，不处理</p>
<h5 id="7-4-2-1-2-代码实现"><a href="#7-4-2-1-2-代码实现" class="headerlink" title="7.4.2.1.2 代码实现"></a><strong>7.4.2.1.2</strong> 代码实现</h5><h5 id="1-参考文档-https-cloud-spring-io-spring-cloud-static-spring-cloud-gateway-2-2-1-RELEASE-reference-html-gateway-request-predicates-factories"><a href="#1-参考文档-https-cloud-spring-io-spring-cloud-static-spring-cloud-gateway-2-2-1-RELEASE-reference-html-gateway-request-predicates-factories" class="headerlink" title="1. 参考文档 : https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories"></a><strong>1.</strong> 参考文档 <strong>: <a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories</a></strong></h5><p><strong>2.</strong> <strong>修改</strong> <strong>e-commerce-gateway-20000</strong> <strong>的</strong> <strong>application.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">after_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">After=2017-01-20T17:42:47.789-07:00[America/Denver]</span></span><br></pre></td></tr></table></figure>

<h4 id="7-4-2-2-BeforeRoutePredicate"><a href="#7-4-2-2-BeforeRoutePredicate" class="headerlink" title="7.4.2.2 BeforeRoutePredicate"></a>7.4.2.2 BeforeRoutePredicate</h4><p><strong>1.</strong> 需求分析**&#x2F;**图解</p>
<p>需求**:** 只有 2022-11-18 12:35:50 <u><strong>之前</strong></u>的请求才进行匹配**&#x2F;<strong>转发</strong>,** 不满足该条件的，不处理</p>
<h5 id="7-4-2-2-2-代码实现"><a href="#7-4-2-2-2-代码实现" class="headerlink" title="7.4.2.2.2 代码实现"></a><strong>7.4.2.2.2</strong> 代码实现</h5><p><strong>1.</strong> 参考文档 <strong>: <a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories</a></strong></p>
<p><strong>2.</strong> <strong>修改</strong> <strong>e-commerce-gateway-20000</strong> <strong>的</strong> <strong>application.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">before_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Before=2017-01-20T17:42:47.789-07:00[America/Denver]</span></span><br></pre></td></tr></table></figure>

<h4 id="7-4-2-3-BetweenRoutePredicate"><a href="#7-4-2-3-BetweenRoutePredicate" class="headerlink" title="7.4.2.3 BetweenRoutePredicate"></a>7.4.2.3 BetweenRoutePredicate</h4><p><strong>1.</strong> 需求分析**&#x2F;**图解</p>
<p>需求**:** 只有 <strong>2020-11-18 12:35:50</strong> 和 <strong>2022-11-18 12:35:50</strong> <u><em>之间</em></u> 的请求才进行匹配**&#x2F;<strong>转 发</strong>,** 不满足该条件的，不处理</p>
<h5 id="7-4-2-3-2-代码实现"><a href="#7-4-2-3-2-代码实现" class="headerlink" title="7.4.2.3.2 代码实现"></a><strong>7.4.2.3.2</strong> 代码实现</h5><p><strong>1.</strong> 参考文档 <strong>: <a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories</a></strong></p>
<p><strong>2.</strong> <strong>修改</strong> <strong>e-commerce-gateway-20000</strong> <strong>的</strong> <strong>application.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">between_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Between=2017-01-20T17:42:47.789-07:00[America/Denver],</span> <span class="number">2017-01-21T17:42:47.789-07:00</span>[<span class="string">America/Denver</span>]</span><br></pre></td></tr></table></figure>

<h4 id="7-4-2-4-CookieRoutePredicate"><a href="#7-4-2-4-CookieRoutePredicate" class="headerlink" title="7.4.2.4 CookieRoutePredicate"></a>7.4.2.4 CookieRoutePredicate</h4><h5 id="7-4-2-4-1-需求分析-x2F-图解"><a href="#7-4-2-4-1-需求分析-x2F-图解" class="headerlink" title="7.4.2.4.1 需求分析**&#x2F;**图解"></a><strong>7.4.2.4.1</strong> 需求分析**&#x2F;**图解</h5><p>​	需求**:** 请求带有 <strong>cookie</strong> 键**: user** 值**: hsp** 才匹配**&#x2F;**断言成功</p>
<p><strong>1.4.2.4.2</strong> 代码实现</p>
<p><strong>1.</strong> 参考文档 <strong>: <a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories</a></strong></p>
<p><strong>2.</strong> <strong>修改</strong> <strong>e-commerce-gateway-20000</strong> <strong>的</strong> <strong>application.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">cookie_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Cookie=chocolate,</span> <span class="string">ch.p</span></span><br><span class="line">        <span class="comment"># chocolate 是 cookie 名字 ch.p 是 cookie 的值，是按照正则表达式来匹配的</span></span><br></pre></td></tr></table></figure>

<h4 id="7-4-2-5-HeaderRoutePredicate"><a href="#7-4-2-5-HeaderRoutePredicate" class="headerlink" title="7.4.2.5 HeaderRoutePredicate"></a>7.4.2.5 HeaderRoutePredicate</h4><h5 id="7-4-2-5-1-需求分析-x2F-图解"><a href="#7-4-2-5-1-需求分析-x2F-图解" class="headerlink" title="7.4.2.5.1 需求分析**&#x2F;**图解"></a><strong>7.4.2.5.1</strong> 需求分析**&#x2F;**图解</h5><p><strong>1.</strong> 需求分析**&#x2F;**图解</p>
<p><strong>需求</strong>: <strong>请求头</strong> <strong>Header</strong> <strong>有</strong> <strong>X-Request-Id</strong>， 并且值为xxxxx 才匹配&#x2F;断言成功</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">header_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span></span><br><span class="line">        <span class="comment"># X-Request-Id 是 header 的名称, \d+ 是一个正则表达式</span></span><br></pre></td></tr></table></figure>



<h4 id="7-4-2-6-HostRoutePredicate"><a href="#7-4-2-6-HostRoutePredicate" class="headerlink" title="7.4.2.6 HostRoutePredicate"></a>7.4.2.6 HostRoutePredicate</h4><h5 id="7-4-2-6-1-需求分析-x2F-图解"><a href="#7-4-2-6-1-需求分析-x2F-图解" class="headerlink" title="7.4.2.6.1 需求分析**&#x2F;**图解"></a><strong>7.4.2.6.1</strong> 需求分析**&#x2F;**图解</h5><p><strong>1.</strong> 需求分析**&#x2F;**图解</p>
<p>需求： <strong>请求</strong> <strong>Host</strong> <strong>是</strong><em><strong>*.hspedu.*</strong></em> 才匹配&#x2F;断言成功 <strong>,</strong> <strong>比如</strong> <strong>Host： <a target="_blank" rel="noopener" href="http://www.hspedu.com/">www.hspedu.com</a></strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">host_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Host=**.somehost.org,**.anotherhost.org</span></span><br><span class="line">        <span class="comment">#Host 可以有多个, 使用逗号间隔</span></span><br></pre></td></tr></table></figure>



<h4 id="7-4-2-7-MethodRoutePredicate"><a href="#7-4-2-7-MethodRoutePredicate" class="headerlink" title="7.4.2.7 MethodRoutePredicate"></a>7.4.2.7 MethodRoutePredicate</h4><p><strong>1.4.2.7.1</strong> 需求分析**&#x2F;**图解</p>
<p><strong>需求</strong>: <strong>请求是</strong> <strong>XXXXXX</strong> <strong>方式才匹配</strong>&#x2F;<strong>断言成功</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">method_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Method=GET,POST</span></span><br><span class="line">        <span class="comment"># 请求方式可以有多个, 使用逗号间隔</span></span><br></pre></td></tr></table></figure>



<h4 id="7-4-2-8-PathRoutePredicate"><a href="#7-4-2-8-PathRoutePredicate" class="headerlink" title="7.4.2.8 PathRoutePredicate"></a>7.4.2.8 PathRoutePredicate</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">host_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/red/&#123;segment&#125;,/blue/&#123;segment&#125;</span></span><br><span class="line">        <span class="comment"># Path 可以有多个, 使用逗号间隔</span></span><br></pre></td></tr></table></figure>



<h4 id="7-4-2-9-QueryRoutePredicate"><a href="#7-4-2-9-QueryRoutePredicate" class="headerlink" title="7.4.2.9 QueryRoutePredicate"></a>7.4.2.9 QueryRoutePredicate</h4><h5 id="1-4-2-9-1-需求分析-x2F-图解"><a href="#1-4-2-9-1-需求分析-x2F-图解" class="headerlink" title="1.4.2.9.1 需求分析**&#x2F;**图解"></a><strong>1.4.2.9.1</strong> 需求分析**&#x2F;**图解</h5><p>需求**:** 请求有参数 <strong>email ,<strong>并且满足电子邮件的基本格式</strong>,</strong> 才能匹配**&#x2F;**断言成功</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">query_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Query=red,</span> <span class="string">gree.</span></span><br><span class="line">        <span class="comment">#red 是参数名 gree. 是值, 支持正则表达式.</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#对应邮箱：</span></span><br><span class="line">      <span class="comment"># - Query=email, [\w-]+@([a-zA-Z]+\.)+[a-zA-Z]+</span></span><br></pre></td></tr></table></figure>



<h4 id="7-4-2-10-RemoteAddr-Route-Predicate"><a href="#7-4-2-10-RemoteAddr-Route-Predicate" class="headerlink" title="7.4.2.10 RemoteAddr Route Predicate"></a>7.4.2.10 RemoteAddr Route Predicate</h4><h5 id="7-4-2-10-1-需求分析-x2F-图解"><a href="#7-4-2-10-1-需求分析-x2F-图解" class="headerlink" title="7.4.2.10.1 需求分析**&#x2F;**图解"></a><strong>7.4.2.10.1</strong> 需求分析**&#x2F;**图解</h5><p><strong>需求</strong>: <strong>请求的</strong> <strong>IP</strong> <strong>是</strong> <strong>127.0.0.1,</strong> <strong>才能匹配</strong>&#x2F;断言成功</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">remoteaddr_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">RemoteAddr=192.168.1.1/24</span></span><br></pre></td></tr></table></figure>



<h2 id="7-5-Filter-x2F-过滤器"><a href="#7-5-Filter-x2F-过滤器" class="headerlink" title="7.5 Filter&#x2F;过滤器"></a>7.5 Filter&#x2F;过滤器</h2><h3 id="7-5-1-基本介绍"><a href="#7-5-1-基本介绍" class="headerlink" title="7.5.1 基本介绍"></a><strong>7.5.1</strong> 基本介绍</h3><p><strong>1.</strong> 文档地址 <strong>: <a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gatewayfilter-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gatewayfilter-factories</a></strong></p>
<p> <strong>路由过滤器可用于修改进入的HTTP请求和返回的HTTP响应</strong></p>
<p><strong>Spring Cloud Gateway 内置了多种路由过滤器，他们都由GatewayFilter的工厂类来产生</strong></p>
<h3 id="7-5-2-类型"><a href="#7-5-2-类型" class="headerlink" title="7.5.2 类型"></a><strong>7.5.2</strong> 类型</h3><h4 id="7-5-2-1-GatewayFilter"><a href="#7-5-2-1-GatewayFilter" class="headerlink" title="7.5.2.1 GatewayFilter"></a>7.5.2.1 GatewayFilter</h4><h4 id="7-5-2-2-GlobalFilter"><a href="#7-5-2-2-GlobalFilter" class="headerlink" title="7.5.2.2 GlobalFilter"></a>7.5.2.2 GlobalFilter</h4><p>一般很少使用官方的filter，都是自定义满足需求，因此只介绍一个官方filter</p>
<h3 id="7-5-3-GatewayFilter使用"><a href="#7-5-3-GatewayFilter使用" class="headerlink" title="7.5.3 GatewayFilter使用"></a><strong>7.5.3 GatewayFilter</strong>使用</h3><h4 id="7-5-3-1-开发直接使用-GatewayFilter-较少，一般是自定义过滤器"><a href="#7-5-3-1-开发直接使用-GatewayFilter-较少，一般是自定义过滤器" class="headerlink" title="7.5.3.1 开发直接使用 GatewayFilter 较少，一般是自定义过滤器"></a>7.5.3.1 开发直接使用 GatewayFilter 较少，一般是自定义过滤器</h4><p>​	演示：The AddRequestParameter GatewayFilter Factory</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">add_request_parameter_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestParameter=color,</span> <span class="string">blue</span></span><br></pre></td></tr></table></figure>

<h3 id="7-5-4-自定义-GlobalFilter"><a href="#7-5-4-自定义-GlobalFilter" class="headerlink" title="7.5.4 自定义 GlobalFilter"></a><strong>7.5.4</strong> 自定义 <strong>GlobalFilter</strong></h3><h4 id="7-5-4-1-需求分析-x2F-图解"><a href="#7-5-4-1-需求分析-x2F-图解" class="headerlink" title="7.5.4.1 需求分析&#x2F;图解"></a>7.5.4.1 需求分析&#x2F;图解</h4><p><strong>1.</strong> 自定义全局 <strong>GlobalFilter</strong> 过滤器<br><strong>2.</strong> 如果请求参数 <strong>user&#x3D;hspedu , pwd&#x3D;123456</strong> 则放行**,** 否则不能通过验证</p>
<h4 id="7-5-4-2-代码实现"><a href="#7-5-4-2-代码实现" class="headerlink" title="7.5.4.2 代码实现"></a>7.5.4.2 代码实现</h4><p><strong>1.</strong> 在 <strong>e-commerce-gateway-20000</strong> 创建<strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;filter&#x2F;CustomGateWayFilter.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 浦原</span></span><br><span class="line"><span class="comment"> * 2023/6/1</span></span><br><span class="line"><span class="comment"> * 11:14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomGateWayFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//filter是核心的方法，将我们的过滤业务写在该方法中</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="comment">//先获取到对应的参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span></span><br><span class="line">                exchange.getRequest().getQueryParams().getFirst(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span></span><br><span class="line">                exchange.getRequest().getQueryParams().getFirst(<span class="string">&quot;pwd&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="string">&quot;hspedu&quot;</span>.equals(user) &amp;&amp; <span class="string">&quot;123456&quot;</span>.equals(pwd)))&#123;</span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//表示过滤器执行的顺序，数字越小，优先级越高</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-5-4-3-测试"><a href="#7-5-4-3-测试" class="headerlink" title="7.5.4.3 测试"></a>7.5.4.3 测试</h4><h5 id="7-5-4-3-1-启动-e-commerce-eureka-server-9001"><a href="#7-5-4-3-1-启动-e-commerce-eureka-server-9001" class="headerlink" title="7.5.4.3.1 启动 e-commerce-eureka-server-9001"></a><strong>7.5.4.3.1</strong> 启动 e-commerce-eureka-server-9001</h5><h5 id="7-5-4-3-2-启动-member-service-provider-10000-x2F-10002"><a href="#7-5-4-3-2-启动-member-service-provider-10000-x2F-10002" class="headerlink" title="7.5.4.3.2 启动 member-service-provider-10000&#x2F;10002"></a>7.5.4.3.2 启动 member-service-provider-10000&#x2F;10002</h5><h5 id="7-5-4-3-3-启动-e-commerce-gateway-20000"><a href="#7-5-4-3-3-启动-e-commerce-gateway-20000" class="headerlink" title="7.5.4.3.3 启动 e-commerce-gateway-20000"></a>7.5.4.3.3 启动 e-commerce-gateway-20000</h5><h5 id="7-5-4-3-4-浏览器-通过网关访问-http-localhost-20000-member-get-1-user-hspedu-amp-pwd-123456-输入-http-localhost-20000-member-get-1-user-hspedu-amp-pwd-123456"><a href="#7-5-4-3-4-浏览器-通过网关访问-http-localhost-20000-member-get-1-user-hspedu-amp-pwd-123456-输入-http-localhost-20000-member-get-1-user-hspedu-amp-pwd-123456" class="headerlink" title="7.5.4.3.4 浏览器**:(通过网关访问) http://localhost:20000/member/get/1?user=hspedu&amp;pwd=123456** 输入**: http://localhost:20000/member/get/1?user=hspedu&amp;pwd=123456**"></a>7.5.4.3.4 浏览器**:(<strong>通过网关访问</strong>) <a target="_blank" rel="noopener" href="http://localhost:20000/member/get/1?user=hspedu&pwd=123456">http://localhost:20000/member/get/1?user=hspedu&amp;pwd=123456</a>** 输入**: <a target="_blank" rel="noopener" href="http://localhost:20000/member/get/1?user=hspedu&pwd=123456">http://localhost:20000/member/get/1?user=hspedu&amp;pwd=123456</a>**</h5><h4 id="7-5-4-4-测试完毕，记得代码恢复到测试前"><a href="#7-5-4-4-测试完毕，记得代码恢复到测试前" class="headerlink" title="7.5.4.4 测试完毕，记得代码恢复到测试前"></a>7.5.4.4 测试完毕，记得代码恢复到测试前</h4><h1 id="8-SpringCloud-Sleuth-Zipkin-服务跟踪"><a href="#8-SpringCloud-Sleuth-Zipkin-服务跟踪" class="headerlink" title="8 SpringCloud Sleuth+Zipkin 服务跟踪"></a>8 SpringCloud Sleuth+Zipkin 服务跟踪</h1><h2 id="8-1-Sleuth-x2F-ZipKin基础"><a href="#8-1-Sleuth-x2F-ZipKin基础" class="headerlink" title="8.1 Sleuth&#x2F;ZipKin基础"></a>8.1 Sleuth&#x2F;ZipKin基础</h2><h3 id="8-1-1-官网"><a href="#8-1-1-官网" class="headerlink" title="8.1.1 官网"></a><strong>8.1.1</strong> 官网</h3><h4 id="8-1-1-1-https-github-com-spring-cloud-spring-cloud-sleuth"><a href="#8-1-1-1-https-github-com-spring-cloud-spring-cloud-sleuth" class="headerlink" title="8.1.1.1 https://github.com/spring-cloud/spring-cloud-sleuth"></a>8.1.1.1 <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-sleuth">https://github.com/spring-cloud/spring-cloud-sleuth</a></h4><h3 id="8-1-2-Sleuth-x2F-Zipkin是什么"><a href="#8-1-2-Sleuth-x2F-Zipkin是什么" class="headerlink" title="8.1.2 Sleuth&#x2F;Zipkin是什么?"></a><strong>8.1.2 Sleuth&#x2F;Zipkin</strong>是什么?</h3><h4 id="8-1-2-1-概述-两张图"><a href="#8-1-2-1-概述-两张图" class="headerlink" title="8.1.2.1 概述(两张图)"></a>8.1.2.1 概述(两张图)</h4><ol>
<li><p>在微服务框架中，一个由客户端发起的请求在后端系统中会经过多个不同的服务节点调用**,** 来协同产生最后的请求结果，每一个请求都会形成一条复杂的分布式服务调用链路</p>
</li>
<li><p>链路中的任何一环出现高延时或错误都会引起整个请求最后的失败,因此<u>对整个服务的调用进行链路追踪和分析</u>就非常的重要</p>
</li>
<li><p>Sleuth 和 Zipkin简单关系图</p>
</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230601125136474.png" alt="image-20230601125136474"></p>
<h4 id="8-1-2-2-一句话-Sleuth-提供了一套完整的服务跟踪的解决方案-并兼容-Zipkin"><a href="#8-1-2-2-一句话-Sleuth-提供了一套完整的服务跟踪的解决方案-并兼容-Zipkin" class="headerlink" title="8.1.2.2 一句话: Sleuth 提供了一套完整的服务跟踪的解决方案 并兼容 Zipkin"></a>8.1.2.2 一句话: Sleuth 提供了一套完整的服务跟踪的解决方案 并兼容 Zipkin</h4><h4 id="8-1-2-3-梳理-🌟Sleuth-做链路追踪-Zipkin-做数据搜集-x2F-存储-x2F-可视化"><a href="#8-1-2-3-梳理-🌟Sleuth-做链路追踪-Zipkin-做数据搜集-x2F-存储-x2F-可视化" class="headerlink" title="8.1.2.3 梳理: 🌟Sleuth 做链路追踪 , Zipkin 做数据搜集&#x2F;存储&#x2F;可视化"></a>8.1.2.3 梳理: 🌟<u>Sleuth 做链路追踪 , Zipkin 做数据搜集&#x2F;存储&#x2F;可视化</u></h4><h3 id="8-1-3-Sleuth工作原理"><a href="#8-1-3-Sleuth工作原理" class="headerlink" title="8.1.3 Sleuth工作原理"></a><strong>8.1.3 Sleuth</strong>工作原理</h3><p><strong>1. Span</strong> 和 <strong>Trace</strong> 在一个系统中使用 <strong>Zipkin</strong> 的过程**-**图形化</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230603152155135.png" alt="image-20230603152155135"></p>
<ul>
<li><p>表示一请求链路，一条链路通过Trace id唯一标识，span标识发起的请求信息，各span通过parent id关联起来</p>
</li>
<li><p>Trace：类似于树结构的Span集合，表示一条调用链路，存在唯一标识 (一条请求链路只有唯一一个Trace id)</p>
</li>
<li><p>Span：基本工作单元，表示调用链路来源，通俗的理解span就是一次请求信息</p>
</li>
</ul>
<p><strong>2. spans</strong> <strong>的</strong> <strong>parent&#x2F;child</strong> <strong>关系图形化</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230603152459615.png" alt="image-20230603152459615"></p>
<ul>
<li><p>小伙伴注意看老师标识的红线，后一个span节点的parentid 指向&#x2F;记录 了上一个Span结点</p>
</li>
<li><p>span就是一次请求信息</p>
</li>
<li><p>多个Span集合就构成<u>一条调用链路</u></p>
</li>
<li><p>在span&#x3D;C 这个节点存在分支</p>
</li>
</ul>
<h2 id="8-2-Sleuth-x2F-ZipKin-搭建链路监控实例"><a href="#8-2-Sleuth-x2F-ZipKin-搭建链路监控实例" class="headerlink" title="8.2 Sleuth&#x2F;ZipKin-搭建链路监控实例"></a>8.2 Sleuth&#x2F;ZipKin-搭建链路监控实例</h2><h3 id="8-2-1-需求说明-x2F-图解"><a href="#8-2-1-需求说明-x2F-图解" class="headerlink" title="8.2.1 需求说明**&#x2F;**图解"></a><strong>8.2.1</strong> 需求说明**&#x2F;**图解</h3><p><strong>要求</strong>: <strong>通过</strong> <strong>Sleuth</strong> <strong>和</strong> <strong>Zipkin</strong> <strong>可以对</strong>服务调用链路<strong>进行监控</strong>, <strong>并在</strong> <strong>Zipkin</strong> <strong>进行显示</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230603152942262.png" alt="image-20230603152942262"></p>
<h3 id="8-2-2-安装-x2F-使用-Zipkin"><a href="#8-2-2-安装-x2F-使用-Zipkin" class="headerlink" title="8.2.2 安装**&#x2F;**使用 Zipkin"></a><strong>8.2.2</strong> 安装**&#x2F;**使用 <strong>Zipkin</strong></h3><h4 id="8-2-2-1-下载"><a href="#8-2-2-1-下载" class="headerlink" title="8.2.2.1 下载"></a>8.2.2.1 下载</h4><ol>
<li><p>下载地址：<a target="_blank" rel="noopener" href="https://repo1.maven.org/maven2/io/zipkin/zipkin-server/">https://repo1.maven.org/maven2/io/zipkin/zipkin-server/</a></p>
</li>
<li><p>得到 zipkin-server-2.14.1-exec.jar</p>
</li>
</ol>
<h4 id="8-2-2-2-运行"><a href="#8-2-2-2-运行" class="headerlink" title="8.2.2.2 运行"></a>8.2.2.2 运行</h4><ol>
<li>进入 zipkin-server-2.14.1-exec.jar 所在目录的终端</li>
<li>执行命令  java -jar zipkin-server-2.14.1-exec.jar    开启zipkin服务</li>
</ol>
<h4 id="8-2-2-3-访问"><a href="#8-2-2-3-访问" class="headerlink" title="8.2.2.3 访问"></a>8.2.2.3 访问</h4><p>​	浏览器输入**:<a target="_blank" rel="noopener" href="http://localhost:9411/zipkin/">http://localhost:9411/zipkin/</a>**</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230603225430611.png" alt="image-20230603225430611"></p>
<h3 id="8-2-3-服务提供方集成-Sleuth-x2F-Zipkin"><a href="#8-2-3-服务提供方集成-Sleuth-x2F-Zipkin" class="headerlink" title="8.2.3 服务提供方集成 Sleuth&#x2F;Zipkin"></a><strong>8.2.3</strong> 服务提供方集成 <strong>Sleuth&#x2F;Zipkin</strong></h3><p><strong>1.</strong> 修改 <strong>member-service-provider-10000</strong> 的 <strong>pom.xml ,</strong> 增加引入 <strong>sleuth+zipkin</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    引入sleuth与zipkin相关依赖    --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--包含了 sleuth+zipkin--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230603230040079.png" alt="image-20230603230040079" style="zoom:50%;" />

<p><strong>2.</strong> <strong>修改</strong> <strong>member-service-provider-10000</strong> <strong>的</strong> <strong>appliaction.xml ,</strong> <strong>指定</strong> <strong>Zipkin</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-provider</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/e_commerce_center_db?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">QWEASDzxc123</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="comment">#配置sleuth和zipkin</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">base-url:</span> <span class="string">http://localhost:9411</span></span><br><span class="line">  <span class="attr">sleuth:</span></span><br><span class="line">    <span class="attr">sampler:</span></span><br><span class="line">      <span class="comment"># 采样率 在0～1之间，1表示全部采集</span></span><br><span class="line">      <span class="attr">probability:</span> <span class="number">1</span></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.study.springcloud.entity</span></span><br><span class="line"><span class="comment">#配置eureka-client</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#将自己注册到Eureka-server</span></span><br><span class="line">    <span class="comment">#表示从Eureka-server抓取注册信息</span></span><br><span class="line">    <span class="comment">#如果是单节点，可以不配置；</span></span><br><span class="line">    <span class="comment">#但是provider是一个集群，则必须将此项配置为true，这样才能配合Ribbon使用负载均衡功能</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># 表示将自己注册到哪个eureka-</span></span><br><span class="line">      <span class="comment"># 将本服务注册到多个eureka-server，使用逗号间隔即可</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka9001.com:9001/eureka,http://eureka9002.com:9002/eureka</span></span><br><span class="line"><span class="comment">#  instance:</span></span><br><span class="line">    <span class="comment">#1秒发送一次心跳(默认是90秒</span></span><br><span class="line"><span class="comment">#    lease-renewal-interval-in-seconds: 1</span></span><br><span class="line">    <span class="comment">#服务端收到最后一次心跳后的等待时间上限</span></span><br><span class="line"><span class="comment">#    lease-expiration-duration-in-seconds: 2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="8-2-4-服务消费方集成-Sleuth-x2F-Zipkin"><a href="#8-2-4-服务消费方集成-Sleuth-x2F-Zipkin" class="headerlink" title="8.2.4 服务消费方集成 Sleuth&#x2F;Zipkin"></a>8.2.4 服务消费方集成 Sleuth&#x2F;Zipkin</h3><p><strong>1.</strong> 修改 <strong>member-service-consumer-80</strong> 的 <strong>pom.xml ,</strong> 增加引入 <strong>sleuth+zipkin</strong></p>
<p><strong>2.</strong> 修改 <strong>member-service-consumer-80</strong> 的 <strong>appliaction.xml ,</strong> 指定 <strong>Zipkin</strong></p>
<h3 id="8-2-5-测试"><a href="#8-2-5-测试" class="headerlink" title="8.2.5 测试"></a><strong>8.2.5</strong> 测试</h3><h4 id="8-2-5-1-启动-e-commerce-eureka-server-9001"><a href="#8-2-5-1-启动-e-commerce-eureka-server-9001" class="headerlink" title="8.2.5.1 启动 e-commerce-eureka-server-9001"></a>8.2.5.1 启动 e-commerce-eureka-server-9001</h4><h4 id="8-2-5-2-启动-member-service-provider-10000"><a href="#8-2-5-2-启动-member-service-provider-10000" class="headerlink" title="8.2.5.2 启动 member-service-provider-10000"></a>8.2.5.2 启动 member-service-provider-10000</h4><h4 id="8-2-5-3-启动-member-service-consumer-80"><a href="#8-2-5-3-启动-member-service-consumer-80" class="headerlink" title="8.2.5.3 启动 member-service-consumer-80"></a>8.2.5.3 启动 member-service-consumer-80</h4><h4 id="8-2-5-4-浏览器-浏览器输入-http-localhost-member-consumer-get-1"><a href="#8-2-5-4-浏览器-浏览器输入-http-localhost-member-consumer-get-1" class="headerlink" title="8.2.5.4 浏览器: 浏览器输入: http://localhost/member/consumer/get/1"></a>8.2.5.4 浏览器: 浏览器输入: <a target="_blank" rel="noopener" href="http://localhost/member/consumer/get/1">http://localhost/member/consumer/get/1</a></h4><h3 id="8-2-6-查看监控-amp-分析结果"><a href="#8-2-6-查看监控-amp-分析结果" class="headerlink" title="8.2.6 查看监控**&amp;**分析结果"></a>8.2.6 查看监控**&amp;**分析结果</h3><h4 id="8-2-6-1-查看监控-amp-分析结果"><a href="#8-2-6-1-查看监控-amp-分析结果" class="headerlink" title="8.2.6.1 查看监控&amp;分析结果"></a>8.2.6.1 查看监控&amp;分析结果</h4><p><strong>1.</strong> 查看 **Zipkin : <a target="_blank" rel="noopener" href="http://localhost:9411/zipkin/">http://localhost:9411/zipkin/</a> **</p>
<p><strong>2.</strong> <strong>选择某个服务，看结果</strong></p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230604102426067.png" alt="image-20230604102426067" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230604102442418.png" alt="image-20230604102442418" style="zoom:50%;" />

<p><strong>3.</strong> 查看一次调用链路的深度，以及该链路包含请求,各个请求耗时，**<u><em>找到请求瓶颈，为优化提供依据</em></u>**(重要)</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230604102455803.png" alt="image-20230604102455803" style="zoom:50%;" />

<p><strong>4.</strong> <strong>查看服务调用的依赖关系</strong></p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230604102509066.png" alt="image-20230604102509066" style="zoom:50%;" />

<h1 id="9-🌟SpringCloudAlibabaNacos-服务注册中心-服务配置"><a href="#9-🌟SpringCloudAlibabaNacos-服务注册中心-服务配置" class="headerlink" title="9 🌟SpringCloudAlibabaNacos 服务注册中心+服务配置"></a>9 🌟SpringCloudAlibabaNacos 服务注册中心+服务配置</h1><h2 id="9-1-Nacos基础"><a href="#9-1-Nacos基础" class="headerlink" title="9.1 Nacos基础"></a>9.1 Nacos基础</h2><h3 id="9-1-1-官网"><a href="#9-1-1-官网" class="headerlink" title="9.1.1 官网"></a>9.1.1 官网</h3><h4 id="9-1-1-1-https-github-com-alibaba-Nacos"><a href="#9-1-1-1-https-github-com-alibaba-Nacos" class="headerlink" title="9.1.1.1 https://github.com/alibaba/Nacos"></a>9.1.1.1 <a target="_blank" rel="noopener" href="https://github.com/alibaba/Nacos">https://github.com/alibaba/Nacos</a></h4><h3 id="9-1-2-Nacos是什么"><a href="#9-1-2-Nacos是什么" class="headerlink" title="9.1.2 Nacos是什么?"></a>9.1.2 Nacos是什么?</h3><h4 id="9-1-2-1-一句话-Nacos-就是注册中心-替代-Eureka-配置中心-替代-Config"><a href="#9-1-2-1-一句话-Nacos-就是注册中心-替代-Eureka-配置中心-替代-Config" class="headerlink" title="9.1.2.1 一句话: Nacos 就是注册中心[替代 Eureka]+配置中心[替代 Config]"></a>9.1.2.1 一句话: <u>Nacos 就是注册中心[替代 Eureka]+配置中心[替代 Config]</u></h4><h4 id="9-1-2-2-Nacos-Dynamic-Naming-and-Configuration-Service"><a href="#9-1-2-2-Nacos-Dynamic-Naming-and-Configuration-Service" class="headerlink" title="9.1.2.2 Nacos:Dynamic Naming and Configuration Service"></a>9.1.2.2 Nacos:Dynamic Naming and Configuration Service</h4><h4 id="9-1-2-3-Nacos-架构理论基础-CAP-理论-支持-AP-和-CP-可以切换"><a href="#9-1-2-3-Nacos-架构理论基础-CAP-理论-支持-AP-和-CP-可以切换" class="headerlink" title="9.1.2.3 Nacos:架构理论基础: CAP 理论 (支持 AP 和 CP, 可以切换)"></a>9.1.2.3 Nacos:架构理论基础: CAP 理论 (支持 AP 和 CP, 可以切换)</h4><p>CAP理论：</p>
<p>​	一个分布式系统最多只能同时满足<strong>一致性</strong>（Consistency）、<strong>可用性</strong>（Availability）和<strong>分区容错性</strong>（Partition tolerance）这三项中的两项。</p>
<ul>
<li><strong>一致性</strong>指 “all nodes see the same data at the same time”，即所有节点在同一时间的数据完全一致。即多副本（Replications）问题中的数据一致性</li>
<li><strong>可用性</strong>指“<code>Reads and writes always succeed</code>”，即服务在正常响应时间内一直可用。好的可用性主要是指系统能够很好的为用户服务，不出现用户操作失败或者访问超时等用户体验不好的情况。</li>
<li><strong>分区容错性</strong>指“the system continues to operate despite arbitrary message loss or failure of part of the system”，即分布式系统在遇到某节点或网络分区故障的时候，仍然能够对外提供满足一致性或可用性的服务。</li>
</ul>
<p>比如对于两个结点如果它们之间的网络断开了，我们假设需要满足分区容错性，那么一定要在一致性和可用性之间进行取舍(分区容错性满足的情况下，如果满足一致性那就必须等待网络恢复后数据进行同步后才能提供服务——放弃了可用性；反之，如果选择了可用性，那么两个结点提供的数据一定不能保证一致性——牺牲了一致性)</p>
<h3 id="9-1-3-Nacos下载-amp-运行"><a href="#9-1-3-Nacos下载-amp-运行" class="headerlink" title="9.1.3 Nacos下载&amp;运行"></a>9.1.3 Nacos下载&amp;运行</h3><h4 id="9-1-3-1-下载-https-github-com-alibaba-nacos-releases-tag-1-2-1"><a href="#9-1-3-1-下载-https-github-com-alibaba-nacos-releases-tag-1-2-1" class="headerlink" title="9.1.3.1 下载: https://github.com/alibaba/nacos/releases/tag/1.2.1"></a>9.1.3.1 下载: <a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos/releases/tag/1.2.1">https://github.com/alibaba/nacos/releases/tag/1.2.1</a></h4><h4 id="9-1-3-2-环境要求-Java8-x2F-Maven-3-2-x"><a href="#9-1-3-2-环境要求-Java8-x2F-Maven-3-2-x" class="headerlink" title="9.1.3.2 环境要求: Java8&#x2F;Maven 3.2.x+"></a>9.1.3.2 环境要求: Java8&#x2F;Maven 3.2.x+</h4><h4 id="9-1-3-3-解压"><a href="#9-1-3-3-解压" class="headerlink" title="9.1.3.3 解压"></a>9.1.3.3 解压</h4><p>在我的mac中执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /Applications/nacos/bin						//因为我把nacos放在了/Applications目录下</span><br><span class="line">sh startup.sh -m standalone						//在nacos/bin目录下执行该语句即可成功启动nacos服务</span><br><span class="line">sh shutdown.sh												//关闭nacos</span><br></pre></td></tr></table></figure>

<h4 id="9-1-3-4-浏览器-http-localhost-8848-nacos"><a href="#9-1-3-4-浏览器-http-localhost-8848-nacos" class="headerlink" title="9.1.3.4 浏览器 http://localhost:8848/nacos"></a>9.1.3.4 浏览器 <a target="_blank" rel="noopener" href="http://localhost:8848/nacos">http://localhost:8848/nacos</a></h4><h4 id="9-1-3-5-用户名-x2F-密码-为-nacos"><a href="#9-1-3-5-用户名-x2F-密码-为-nacos" class="headerlink" title="9.1.3.5 用户名&#x2F;密码 为 nacos"></a>9.1.3.5 用户名&#x2F;密码 为 nacos</h4><h2 id="9-2-创建-Nacos-服务提供者"><a href="#9-2-创建-Nacos-服务提供者" class="headerlink" title="9.2 创建 Nacos 服务提供者"></a>9.2 创建 Nacos 服务提供者</h2><h3 id="9-2-1-需求说明-x2F-图解"><a href="#9-2-1-需求说明-x2F-图解" class="headerlink" title="9.2.1 需求说明&#x2F;图解"></a>9.2.1 需求说明&#x2F;图解</h3><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230604111207532.png" alt="image-20230604111207532" style="zoom:50%;" />

<h3 id="9-2-2-创建-member-service-nacos-provider-10004-并注册到-NacosServer8848"><a href="#9-2-2-创建-member-service-nacos-provider-10004-并注册到-NacosServer8848" class="headerlink" title="9.2.2 创建 member-service-nacos-provider-10004 并注册到 NacosServer8848"></a><strong>9.2.2</strong> 创建 member-service-nacos-provider-10004 并注册到 NacosServer8848</h3><h4 id="9-2-2-1-创建-member-service-nacos-provider-10004"><a href="#9-2-2-1-创建-member-service-nacos-provider-10004" class="headerlink" title="9.2.2.1 创建 member-service-nacos-provider-10004"></a>9.2.2.1 创建 member-service-nacos-provider-10004</h4><ol>
<li><p>参考<strong>member-service-provider-10000</strong> 来创建 <strong>member-service-nacos-provider-10004</strong> 即可</p>
</li>
<li><p>创建好后，使用member-service-provider-10000 的源码和配置替换member-service-nacos-provider-10004 生成的代码</p>
</li>
<li><p>提醒，拷贝时不要忘记拷贝 resources&#x2F;mapper&#x2F;MernberrVapper.xml 这些xeox.xrl 文件</p>
</li>
</ol>
<h4 id="9-2-2-2-修改父项目-pom-xml"><a href="#9-2-2-2-修改父项目-pom-xml" class="headerlink" title="9.2.2.2 修改父项目 pom.xml"></a>9.2.2.2 修改父项目 pom.xml</h4><p><strong>1.</strong> 参考官方文档 <strong><a target="_blank" rel="noopener" href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery</a></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="9-2-2-3-修改本模块-pom-xml"><a href="#9-2-2-3-修改本模块-pom-xml" class="headerlink" title="9.2.2.3 修改本模块 pom.xml"></a>9.2.2.3 修改本模块 pom.xml</h4><p><strong>1.</strong> 将 <strong>member-service-provider-10000</strong> 的 <strong>pom.xml</strong> 的<dependencies>…</dependencies></p>
<p>拷贝过来，修改即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.study.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e-commerce-center<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>member-service-nacos-provider-10004<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引入nacos-start nacos场景启动器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--        使用版本仲裁，从父项目中获取版本--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        springboot程序的监控系统，实现系统健康检测</span></span><br><span class="line"><span class="comment">                    可以通过 http://localhost:10000/actuator 看到相关连接</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.31<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 引入 e_commerce_center-common-api --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.study.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e_commerce_center-common-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="9-2-2-4-创建-application-yml"><a href="#9-2-2-4-创建-application-yml" class="headerlink" title="9.2.2.4 创建 application.yml"></a>9.2.2.4 创建 application.yml</h4><p><strong>1.</strong> 将 <strong>member-service-provider-10000</strong> 的 <strong>application.xml</strong> 拷贝过来，修改即可</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10004</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-nacos-provider</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/e_commerce_center_db?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">QWEASDzxc123</span></span><br><span class="line"><span class="comment">#  配置nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#配置nacos server的地址</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.study.springcloud.entity</span></span><br><span class="line"><span class="comment">#配置暴露所有的监控点</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="9-2-2-5-创建主启动类"><a href="#9-2-2-5-创建主启动类" class="headerlink" title="9.2.2.5 创建主启动类"></a>9.2.2.5 创建主启动类</h4><p><strong>1.</strong> 创建主启动类 MemberNacosProviderApplication10004</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">//引入nacos发现的注解</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberNacosProviderApplication10004</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MemberNacosProviderApplication10004.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="9-2-2-6-为看到更好提示，修改-Controller"><a href="#9-2-2-6-为看到更好提示，修改-Controller" class="headerlink" title="9.2.2.6 为看到更好提示，修改 Controller"></a>9.2.2.6 为看到更好提示，修改 Controller</h4><p>……</p>
<h4 id="9-2-2-7-测试"><a href="#9-2-2-7-测试" class="headerlink" title="9.2.2.7 测试"></a>9.2.2.7 测试</h4><h5 id="9-2-2-7-1-启动-Nacos-Server-8848"><a href="#9-2-2-7-1-启动-Nacos-Server-8848" class="headerlink" title="9.2.2.7.1 启动 Nacos Server 8848"></a><strong>9.2.2.7.1</strong> 启动 Nacos Server 8848</h5><h5 id="9-2-2-7-2-启动-member-service-nacos-provider-10004"><a href="#9-2-2-7-2-启动-member-service-nacos-provider-10004" class="headerlink" title="9.2.2.7.2 启动 member-service-nacos-provider-10004"></a>9.2.2.7.2 启动 <strong>member-service-nacos-provider-10004</strong></h5><h5 id="9-2-2-7-3-观察-nacos-服务是否注册成功"><a href="#9-2-2-7-3-观察-nacos-服务是否注册成功" class="headerlink" title="9.2.2.7.3 观察 nacos 服务是否注册成功"></a><strong>9.2.2.7.3</strong> 观察 <strong>nacos</strong> 服务是否注册成功</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230604130757230.png" alt="image-20230604130757230"></p>
<h3 id="9-2-3-创建-member-service-nacos-provider-10006-并注册到-NacosServer8848"><a href="#9-2-3-创建-member-service-nacos-provider-10006-并注册到-NacosServer8848" class="headerlink" title="9.2.3 创建 member-service-nacos-provider-10006 并注册到 NacosServer8848"></a>9.2.3 创建 member-service-nacos-provider-10006 并注册到 NacosServer8848</h3><h4 id="9-2-3-1-创建-member-service-nacos-provider-10006"><a href="#9-2-3-1-创建-member-service-nacos-provider-10006" class="headerlink" title="9.2.3.1 创建 member-service-nacos-provider-10006"></a>9.2.3.1 创建 member-service-nacos-provider-10006</h4><ol>
<li><p>参考member-service-nacos-provider-10004 来创建 member-service-nacos-provider-10006 即可</p>
</li>
<li><p>创建好后，使用member-service-nacos-provider-10004 的源码和配罝替换member-service-nacos-provider-10006 生成的代码</p>
</li>
<li><p>提醒，拷贝时不要忘记拷贝 resources&#x2F;mapper&#x2F;MemberMapper.xml 这些xoxx.xml文件</p>
</li>
</ol>
<h4 id="9-2-3-2-修改本模块-pom-xml"><a href="#9-2-3-2-修改本模块-pom-xml" class="headerlink" title="9.2.3.2 修改本模块 pom.xml"></a>9.2.3.2 修改本模块 pom.xml</h4><p><strong>1.</strong> 将 <strong>member-service-provider-10000</strong> 的 <strong>pom.xml</strong> 的<dependencies>…</dependencies></p>
<p>拷贝过来，修改即可</p>
<h4 id="9-2-3-3-创建-application-yml"><a href="#9-2-3-3-创建-application-yml" class="headerlink" title="9.2.3.3 创建 application.yml"></a>9.2.3.3 创建 application.yml</h4><p><strong>1.</strong> 将 <strong>member-service-nacos-provider-10004</strong> 的 <strong>application.xml</strong> 拷贝过来，修改端口即可</p>
<h4 id="9-2-3-4-创建主启动类"><a href="#9-2-3-4-创建主启动类" class="headerlink" title="9.2.3.4 创建主启动类"></a>9.2.3.4 创建主启动类</h4><p><strong>1.</strong> 创建主启动类 MemberNacosProviderApplication10006 (也复制过来，改个名称即可)</p>
<h4 id="9-2-3-5-为看到更好提示，修改-Controller"><a href="#9-2-3-5-为看到更好提示，修改-Controller" class="headerlink" title="9.2.3.5 为看到更好提示，修改 Controller"></a>9.2.3.5 为看到更好提示，修改 Controller</h4><h4 id="9-2-3-6-测试"><a href="#9-2-3-6-测试" class="headerlink" title="9.2.3.6 测试"></a>9.2.3.6 测试</h4><h5 id="9-2-3-6-1-保证-Nacos-Server-8848-是启动的"><a href="#9-2-3-6-1-保证-Nacos-Server-8848-是启动的" class="headerlink" title="9.2.3.6.1 保证 Nacos Server 8848 是启动的"></a><strong>9.2.3.6.1</strong> 保证 <strong>Nacos Server 8848</strong> 是启动的</h5><h5 id="9-2-3-6-2-启动-member-service-nacos-provider-10006"><a href="#9-2-3-6-2-启动-member-service-nacos-provider-10006" class="headerlink" title="9.2.3.6.2 启动 **member-service-nacos-provider-10006 **"></a><strong>9.2.3.6.2</strong> 启动 **member-service-nacos-provider-10006 **</h5><h5 id="9-2-3-6-3-观察-nacos-服务是否注册成功"><a href="#9-2-3-6-3-观察-nacos-服务是否注册成功" class="headerlink" title="9.2.3.6.3 观察 nacos 服务是否注册成功"></a><strong>9.2.3.6.3</strong> 观察 <strong>nacos</strong> 服务是否注册成功</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230605235515301.png" alt="image-20230605235515301"></p>
<h5 id="9-2-3-6-4-浏览器-http-localhost-10006-member-get-1"><a href="#9-2-3-6-4-浏览器-http-localhost-10006-member-get-1" class="headerlink" title="9.2.3.6.4 浏览器**: http://localhost:10006/member/get/1**"></a><strong>9.2.3.6.4</strong> 浏览器**: <a target="_blank" rel="noopener" href="http://localhost:10006/member/get/1">http://localhost:10006/member/get/1</a>**</h5><h2 id="9-3-创建-Nacos-的服务消费者"><a href="#9-3-创建-Nacos-的服务消费者" class="headerlink" title="9.3 创建 Nacos 的服务消费者"></a>9.3 创建 Nacos 的服务消费者</h2><h3 id="9-3-1-需求说明-x2F-图解"><a href="#9-3-1-需求说明-x2F-图解" class="headerlink" title="9.3.1 需求说明**&#x2F;**图解"></a><strong>9.3.1</strong> 需求说明**&#x2F;**图解</h3><p><strong>–</strong> 示意图</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230619155537025.png" alt="image-20230619155537025" style="zoom:50%;" />

<h3 id="9-3-2-创建-member-service-nacos-consumer-80-并注册到-NacosServer8848"><a href="#9-3-2-创建-member-service-nacos-consumer-80-并注册到-NacosServer8848" class="headerlink" title="9.3.2 创建 member-service-nacos-consumer-80 并注册到 NacosServer8848"></a><strong>9.3.2</strong> 创建 <strong>member-service-nacos-consumer-80</strong> 并注册到 <strong>NacosServer8848</strong></h3><h4 id="9-3-2-1-创建-member-service-nacos-consumer-80"><a href="#9-3-2-1-创建-member-service-nacos-consumer-80" class="headerlink" title="9.3.2.1 创建 member-service-nacos-consumer-80"></a>9.3.2.1 创建 member-service-nacos-consumer-80</h4><ol>
<li>参考 member-service-consumer-80 来创建 member-service-nacos-consumer-80 即可</li>
</ol>
<h4 id="9-3-2-2-修改-pom-xml"><a href="#9-3-2-2-修改-pom-xml" class="headerlink" title="9.3.2.2 修改 pom.xml"></a>9.3.2.2 修改 pom.xml</h4><p>将 <strong>member-service-consumer-80</strong> 的 <strong>pom.xml</strong> 的<dependencies>…</dependencies> 拷 贝过来，修改即可</p>
<h4 id="9-3-2-3-创建-application-yml"><a href="#9-3-2-3-创建-application-yml" class="headerlink" title="9.3.2.3 创建 application.yml"></a>9.3.2.3 创建 application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-consumer-80</span></span><br><span class="line">    <span class="comment">#配置nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#启动nacos服务的ip以及端口</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br></pre></td></tr></table></figure>

<h4 id="9-3-2-4-创建主启动类"><a href="#9-3-2-4-创建主启动类" class="headerlink" title="9.3.2.4 创建主启动类"></a>9.3.2.4 创建主启动类</h4><p>……</p>
<h4 id="9-3-2-5-业务类"><a href="#9-3-2-5-业务类" class="headerlink" title="9.3.2.5 业务类"></a>9.3.2.5 业务类</h4><p><em>nacos</em> 本身就集成了 <em>Ribbon,</em> 直接支持 <em>Ribbon(负载均衡)+RestTemplate(远程调用)</em> 调用</p>
<p><strong>1.</strong> 创建配置类 <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;CustomizationBean.java</strong></p>
<p><strong>2.</strong> 创建 <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberNacosConsumerController.java</strong></p>
<h4 id="9-3-2-6-测试"><a href="#9-3-2-6-测试" class="headerlink" title="9.3.2.6 测试"></a>9.3.2.6 测试</h4><h5 id="9-3-2-6-1-启动-Nacos-Server-8848"><a href="#9-3-2-6-1-启动-Nacos-Server-8848" class="headerlink" title="9.3.2.6.1 启动 Nacos Server 8848"></a><strong>9.3.2.6.1</strong> 启动 Nacos Server 8848</h5><h5 id="9-3-2-6-2-启动-member-service-nacos-provider-10004-x2F-10006-9-3-2-6-3-启动-member-service-nacos-consumer-80"><a href="#9-3-2-6-2-启动-member-service-nacos-provider-10004-x2F-10006-9-3-2-6-3-启动-member-service-nacos-consumer-80" class="headerlink" title="9.3.2.6.2 启动 member-service-nacos-provider-10004&#x2F;10006 9.3.2.6.3 启动 member-service-nacos-	consumer-80"></a>9.3.2.6.2 启动 <strong>member-service-nacos-provider-10004&#x2F;10006 9.3.2.6.3</strong> 启动 member-service-nacos-	consumer-80</h5><h5 id="9-3-2-6-4-浏览器-http-localhost-member-nacos-consumer-get-1"><a href="#9-3-2-6-4-浏览器-http-localhost-member-nacos-consumer-get-1" class="headerlink" title="9.3.2.6.4 浏览器**: http://localhost/member/nacos/consumer/get/1**"></a>9.3.2.6.4 浏览器**: <a target="_blank" rel="noopener" href="http://localhost/member/nacos/consumer/get/1">http://localhost/member/nacos/consumer/get/1</a>**</h5><h4 id="9-3-2-7-配置自己的负载均衡算法，-测试完毕恢复成原来的轮询算法"><a href="#9-3-2-7-配置自己的负载均衡算法，-测试完毕恢复成原来的轮询算法" class="headerlink" title="9.3.2.7 配置自己的负载均衡算法， 测试完毕恢复成原来的轮询算法"></a>9.3.2.7 配置自己的负载均衡算法， 测试完毕恢复成原来的轮询算法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.netflix.loadbalancer.IRule;</span><br><span class="line"><span class="keyword">import</span> com.netflix.loadbalancer.RandomRule;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 浦原</span></span><br><span class="line"><span class="comment"> * 2023/6/19</span></span><br><span class="line"><span class="comment"> * 16:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * RibbonRule配置类，配置自己的负载均衡算法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RibbonRule</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IRule <span class="title function_">myRibbonRule</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-4-NacosAP和CP切换-理论"><a href="#9-4-NacosAP和CP切换-理论" class="headerlink" title="9.4 NacosAP和CP切换-理论"></a>9.4 NacosAP和CP切换-理论</h2><h3 id="9-4-1-各种注册中心对比"><a href="#9-4-1-各种注册中心对比" class="headerlink" title="9.4.1 各种注册中心对比"></a><strong>9.4.1</strong> 各种注册中心对比</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230619224742402.png" alt="image-20230619224742402"></p>
<h3 id="9-4-2-选择-AP-还是-CP"><a href="#9-4-2-选择-AP-还是-CP" class="headerlink" title="9.4.2 选择 AP 还是 CP?"></a><strong>9.4.2</strong> 选择 <strong>AP</strong> 还是 <strong>CP?</strong></h3><p> <strong>1</strong>、<strong>CP:</strong> 服务可以不能用，但必须要保证数据的一致性。<br> <strong>2</strong>、<strong>AP:</strong> 数据可以短暂不一致，但最终是需要一致的，无论如何都要保证服务的可用。<br> <strong>3</strong>、取舍:只能在 <strong>CP</strong> 和 <strong>AP</strong> 选择一个平衡点**,** 大多数都是选择 <strong>AP</strong> 模式</p>
<h3 id="9-4-3-AP和CP切换"><a href="#9-4-3-AP和CP切换" class="headerlink" title="9.4.3 AP和CP切换"></a><strong>9.4.3 AP</strong>和<strong>CP</strong>切换</h3><p><strong>Nacos</strong> 集群默认支持的是<strong>CAP</strong>原则中的<strong>AP</strong>原则，但是也可切换为<strong>CP</strong>原则**(<strong>一般不切换</strong>)**</p>
<h4 id="9-4-3-2-参考-https-www-jianshu-com-p-c56e22c222bb"><a href="#9-4-3-2-参考-https-www-jianshu-com-p-c56e22c222bb" class="headerlink" title="9.4.3.2 参考: https://www.jianshu.com/p/c56e22c222bb"></a>9.4.3.2 参考: <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c56e22c222bb">https://www.jianshu.com/p/c56e22c222bb</a></h4><h2 id="9-5-Nacos-配置中心实例"><a href="#9-5-Nacos-配置中心实例" class="headerlink" title="9.5 Nacos 配置中心实例"></a>9.5 Nacos 配置中心实例</h2><h3 id="9-5-1-需求分析-x2F-图解"><a href="#9-5-1-需求分析-x2F-图解" class="headerlink" title="9.5.1 需求分析**&#x2F;**图解"></a><strong>9.5.1</strong> 需求分析**&#x2F;**图解</h3><p>微服务各个模块中有许多配置是相同的，在配置中心进行统一的配置不仅配置更方便，也便于日后修改。</p>
<p><strong>–</strong> 示意图</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230619225914409.png" alt="image-20230619225914409" style="zoom: 33%;" />

<h3 id="9-5-2-在-Nacos-Server-加入配置"><a href="#9-5-2-在-Nacos-Server-加入配置" class="headerlink" title="9.5.2 在 Nacos Server 加入配置"></a><strong>9.5.2</strong> 在 <strong>Nacos Server</strong> 加入配置</h3><ol>
<li>进入到 Nacos Server</li>
<li>加入配置， 老韩特别提醒: 文件后缀.yaml 别忘了</li>
</ol>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230619230758715.png" alt="image-20230619230758715" style="zoom:50%;" />

<p><strong>Data ID: e-commerce-nacos-config-client-dev.yaml</strong></p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230619230855754.png" alt="image-20230619230855754" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230619230930267.png" alt="image-20230619230930267" style="zoom:50%;" />

<h3 id="9-5-3-创建-Nacos-配置客户端模块-e-commerce-nacos-config-client5000"><a href="#9-5-3-创建-Nacos-配置客户端模块-e-commerce-nacos-config-client5000" class="headerlink" title="9.5.3 创建 Nacos 配置客户端模块 e-commerce-nacos-config-client5000"></a><strong>9.5.3</strong> 创建 <strong>Nacos</strong> 配置客户端模块 <strong>e-commerce-nacos-config-client5000</strong></h3><h4 id="9-5-3-1-创建-Module"><a href="#9-5-3-1-创建-Module" class="headerlink" title="9.5.3.1 创建 Module"></a>9.5.3.1 创建 Module</h4><p>先创建 <strong>e-commerce-nacos-config-client5000</strong> 模块，参考以前的方法</p>
<h4 id="9-5-3-2-修改-pom-xml"><a href="#9-5-3-2-修改-pom-xml" class="headerlink" title="9.5.3.2 修改 pom.xml"></a>9.5.3.2 修改 pom.xml</h4><p><strong>1.</strong> 修改 <strong>pom.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">在之前的消费方xml文件的基础上添加：</span><br><span class="line"><span class="comment">&lt;!--nacos-config--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="9-5-3-3-创建-application-xml"><a href="#9-5-3-3-创建-application-xml" class="headerlink" title="9.5.3.3 创建 application.xml"></a>9.5.3.3 创建 application.xml</h4><p>创建 <strong>application.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment">#指定环境，常见的环境有 dev/test/prod 开发，测试，生产</span></span><br></pre></td></tr></table></figure>

<p>参考*: <a target="_blank" rel="noopener" href="https://blog.csdn.net/zsl131557/article/details/80886114">https://blog.csdn.net/zsl131557/article/details/80886114</a>*</p>
<h4 id="9-5-3-4-创建-bootstrap-yml"><a href="#9-5-3-4-创建-bootstrap-yml" class="headerlink" title="9.5.3.4 创建 bootstrap.yml"></a>9.5.3.4 创建 bootstrap.yml</h4><p>创建 <strong>bootstrap.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">5000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># 这里的name 需要参考nacos配置中心的DataId</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">e-commerce-nacos-config-client</span></span><br><span class="line">  <span class="comment">#配置nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacos服务注册中心地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacos配置中心地址</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#指定读取配置中心的yaml后缀的配置</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#老韩解读[重要]</span></span><br><span class="line"><span class="comment">#nacos 配置客户端，会根据配置，找到资源获取配置文件</span></span><br><span class="line"><span class="comment">#(1 config-server-addr)                       localhost:8848</span></span><br><span class="line"><span class="comment">#(2 spring.application.name/对应 DataId)       e-commerce-nacos-config-client </span></span><br><span class="line"><span class="comment">#(3 spring.profiles.active)                   dev</span></span><br><span class="line"><span class="comment">#(4 spring.cloud.nacos.config.file-extension 文件扩展名)    .yaml</span></span><br><span class="line"><span class="comment">#也就到 localhost:8848 下的 e-commerce-nacos-config-client-dev.yaml 获取配置信息</span></span><br><span class="line"><span class="comment">#规则总结: $&#123;spring.application.name&#125;-$&#123;spring.profile.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="9-5-3-5-主启动类"><a href="#9-5-3-5-主启动类" class="headerlink" title="9.5.3.5 主启动类"></a>9.5.3.5 主启动类</h4><p>……</p>
<h4 id="9-5-3-6-业务类"><a href="#9-5-3-6-业务类" class="headerlink" title="9.5.3.6 业务类"></a>9.5.3.6 业务类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 浦原</span></span><br><span class="line"><span class="comment"> * 2023/6/20</span></span><br><span class="line"><span class="comment"> * 15:32</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosConfigClientController</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 解读 <span class="doctag">@Value</span>(&quot;$&#123;config.ip&#125;&quot;)</span></span><br><span class="line"><span class="comment">    * 1. client 会拉取 Nacos Server 的 e-commerce-nacos-config-client-dev.yaml * config:</span></span><br><span class="line"><span class="comment">    * ip: &quot;122.11.11.11&quot;</span></span><br><span class="line"><span class="comment">    * name: &quot;韩顺平教育&quot;</span></span><br><span class="line"><span class="comment">    * 2. <span class="doctag">@Value</span>(&quot;$&#123;config.ip&#125;&quot;) 会将 config.ip 赋给 configIp</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.ip&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configIp;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/nacos/config/ip&quot;)</span> <span class="keyword">public</span> String <span class="title function_">getConfigIp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configIp; &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/nacos/config/name&quot;)</span> <span class="keyword">public</span> String <span class="title function_">getConfigName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configName; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="9-5-3-7-测试"><a href="#9-5-3-7-测试" class="headerlink" title="9.5.3.7 测试"></a>9.5.3.7 测试</h4><h5 id="9-5-3-7-1-启动-Nacos-Server"><a href="#9-5-3-7-1-启动-Nacos-Server" class="headerlink" title="9.5.3.7.1 启动 **Nacos Server"></a><strong>9.5.3.7.1</strong> 启动 **Nacos Server</h5><h5 id="9-5-3-7-2-启动-e-commerce-nacos-config-client5000"><a href="#9-5-3-7-2-启动-e-commerce-nacos-config-client5000" class="headerlink" title="9.5.3.7.2 启动 **e-commerce-nacos-config-client5000 **"></a>9.5.3.7.2 启动 **e-commerce-nacos-config-client5000 **</h5><h5 id="9-5-3-7-3-浏览器-http-localhost-5000-nacos-config-ip"><a href="#9-5-3-7-3-浏览器-http-localhost-5000-nacos-config-ip" class="headerlink" title="9.5.3.7.3 浏览器**: http://localhost:5000/nacos/config/ip**"></a><strong>9.5.3.7.3</strong> 浏览器**: <a target="_blank" rel="noopener" href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a>**</h5><p>​	浏览器输入**: <a target="_blank" rel="noopener" href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a>**</p>
<h4 id="9-5-3-8-注意事项和细节"><a href="#9-5-3-8-注意事项和细节" class="headerlink" title="9.5.3.8 注意事项和细节"></a>9.5.3.8 注意事项和细节</h4><p><strong>0. src\main\java\com\study\springcloud\controller\NacosConfigClientController.java</strong> 的 @Value(“${config.ip}”), 是 import org.springframework.beans.factory.annotation.Value; 而不是 lombok 包下的.</p>
<p><strong>1.</strong> <strong>配置文件</strong> <strong>application.yml</strong> <strong>和</strong> <strong>bootstrap.yml</strong> 结合会得到配置文件&#x2F;资源的地址</p>
<p> <strong>2.</strong> <strong>参考文档</strong>: <a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html">https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html</a></p>
<p><strong>3.</strong> <strong>注意在</strong> <strong>Nacos Server</strong> <strong>的配置文件的后缀是</strong> <strong>.yaml ,</strong> <strong>而不是</strong> <strong>.yml</strong></p>
<p><strong>4.</strong> <strong>在项目初始化时，要保证先从配置中心进行配置拉取，拉取配置之后，才能保证项目的正常启动</strong>, <strong>也就是说如果项目不能正确的获取到</strong> <strong>Nacos Server</strong> <strong>的配置数据，项目是启动不了的</strong>.[<strong>演示</strong>]</p>
<p><strong>5. springboot</strong> <strong>中配置文件的加载是存在优先级顺序的，</strong>bootstrap.yml <strong>优先级高于</strong> <strong>application.yml</strong></p>
<p>🌟<strong>6.</strong> <strong>@RefreshScope</strong> <strong>是</strong> <strong>springcloud</strong> <strong>原生注解，实现配置信息自动刷新</strong>, <strong>如果在</strong> <strong>Nacos Server</strong> <strong>修改了配置数据，</strong>Client <strong>端就会得到最新配置</strong></p>
<h2 id="9-6-Nacos-分类配置-实现配置隔离"><a href="#9-6-Nacos-分类配置-实现配置隔离" class="headerlink" title="9.6 Nacos 分类配置 (实现配置隔离)"></a>9.6 Nacos 分类配置 (实现配置隔离)</h2><h3 id="9-6-1-DataID方案"><a href="#9-6-1-DataID方案" class="headerlink" title="9.6.1 DataID方案"></a><strong>9.6.1 DataID</strong>方案</h3><h4 id="9-6-1-1-需求分析-x2F-图解"><a href="#9-6-1-1-需求分析-x2F-图解" class="headerlink" title="9.6.1.1 需求分析&#x2F;图解"></a>9.6.1.1 需求分析&#x2F;图解</h4><p><strong>–</strong> 示意图</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620155605713.png" alt="image-20230620155605713" style="zoom:50%;" />

<h4 id="9-6-1-2-解决方案分析"><a href="#9-6-1-2-解决方案分析" class="headerlink" title="9.6.1.2 解决方案分析"></a>9.6.1.2 解决方案分析</h4><h5 id="9-6-1-2-1-使用-Data-ID-方案解决"><a href="#9-6-1-2-1-使用-Data-ID-方案解决" class="headerlink" title="9.6.1.2.1 使用 Data ID 方案解决"></a><strong>9.6.1.2.1</strong> 使用 <strong>Data ID</strong> 方案解决</h5><h4 id="9-6-1-3-配置实现"><a href="#9-6-1-3-配置实现" class="headerlink" title="9.6.1.3 配置实现"></a>9.6.1.3 配置实现</h4><p><strong>1.</strong> 在 <strong>nacos server</strong> 创建新的配置:<strong>e-commerce-nacos-config-client-test.yaml</strong></p>
<h4 id="9-6-1-4-修改-application-yml"><a href="#9-6-1-4-修改-application-yml" class="headerlink" title="9.6.1.4 修改 application.yml"></a>9.6.1.4 修改 application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">test</span> <span class="comment">#指定环境，常见的环境有 dev/test/prod 开发，测试，生产</span></span><br></pre></td></tr></table></figure>

<h4 id="9-6-1-5-测试"><a href="#9-6-1-5-测试" class="headerlink" title="9.6.1.5 测试"></a>9.6.1.5 测试</h4><h5 id="9-6-1-5-1-浏览器-http-localhost-5000-nacos-config-ip"><a href="#9-6-1-5-1-浏览器-http-localhost-5000-nacos-config-ip" class="headerlink" title="9.6.1.5.1 浏览器**: http://localhost:5000/nacos/config/ip**"></a><strong>9.6.1.5.1</strong> 浏览器**: <a target="_blank" rel="noopener" href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a>**</h5><p>**1.**浏览器输入: <a target="_blank" rel="noopener" href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a></p>
<h3 id="9-6-2-Group方案"><a href="#9-6-2-Group方案" class="headerlink" title="9.6.2 Group方案"></a><strong>9.6.2 Group</strong>方案</h3><h4 id="9-6-2-1-需求分析-x2F-图解"><a href="#9-6-2-1-需求分析-x2F-图解" class="headerlink" title="9.6.2.1 需求分析&#x2F;图解"></a>9.6.2.1 需求分析&#x2F;图解</h4><p><strong>–</strong> 示意图</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620161153853.png" alt="image-20230620161153853" style="zoom:50%;" />

<h4 id="9-6-2-2-解决方案分析"><a href="#9-6-2-2-解决方案分析" class="headerlink" title="9.6.2.2 解决方案分析"></a>9.6.2.2 解决方案分析</h4><h5 id="9-6-2-2-1-使用-Group-方案解决"><a href="#9-6-2-2-1-使用-Group-方案解决" class="headerlink" title="9.6.2.2.1 使用 Group 方案解决"></a><strong>9.6.2.2.1</strong> 使用 <strong>Group</strong> 方案解决</h5><h4 id="9-6-2-3-配置实现"><a href="#9-6-2-3-配置实现" class="headerlink" title="9.6.2.3 配置实现"></a>9.6.2.3 配置实现</h4><p><strong>1.</strong> 在 <strong>nacos server</strong> 创建新的配置:<strong>order&#x2F;e-commerce-nacos-config-client-dev.yaml</strong></p>
<p><strong>2.</strong> <strong>在</strong> <strong>nacos server</strong> **创建新的配置:**seckill&#x2F;e-commerce-nacos-config-client-dev.yaml</p>
<img src="/Users/donn/Library/Application Support/typora-user-images/image-20230620161749751.png" alt="image-20230620161749751" style="zoom:50%;" />

<h4 id="9-6-2-4-修改-application-yml"><a href="#9-6-2-4-修改-application-yml" class="headerlink" title="9.6.2.4 修改 application.yml"></a>9.6.2.4 修改 application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment">#指定环境，常见的环境有 dev/test/prod 开发，测试，生产</span></span><br></pre></td></tr></table></figure>

<h4 id="9-6-2-5-修改-bootstrap-yml"><a href="#9-6-2-5-修改-bootstrap-yml" class="headerlink" title="9.6.2.5 修改 bootstrap.yml"></a>9.6.2.5 修改 bootstrap.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">20000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># 这里的name 需要参考nacos配置中心的DataId</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">e-commerce-nacos-config-client</span></span><br><span class="line">  <span class="comment">#配置nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacos服务注册中心地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacos配置中心地址</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#指定读取配置中心的yaml后缀的配置</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">order</span> <span class="comment">#指定order组，默认为DEFAULT_GROUP</span></span><br></pre></td></tr></table></figure>

<h4 id="9-6-2-6-测试"><a href="#9-6-2-6-测试" class="headerlink" title="9.6.2.6 测试"></a>9.6.2.6 测试</h4><h5 id="9-6-2-6-1-浏览器-http-localhost-5000-nacos-config-ip"><a href="#9-6-2-6-1-浏览器-http-localhost-5000-nacos-config-ip" class="headerlink" title="9.6.2.6.1 浏览器**: http://localhost:5000/nacos/config/ip**"></a><strong>9.6.2.6.1</strong> 浏览器**: <a target="_blank" rel="noopener" href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a>**</h5><p>**1.**浏览器输入: <a target="_blank" rel="noopener" href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a></p>
<h3 id="9-6-3-Namespace方案"><a href="#9-6-3-Namespace方案" class="headerlink" title="9.6.3 Namespace方案"></a><strong>9.6.3 Namespace</strong>方案</h3><h4 id="9-6-3-1-需求分析-x2F-图解"><a href="#9-6-3-1-需求分析-x2F-图解" class="headerlink" title="9.6.3.1 需求分析&#x2F;图解"></a>9.6.3.1 需求分析&#x2F;图解</h4><p><strong>–</strong> 示意图</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620162224978.png" alt="image-20230620162224978" style="zoom:50%;" />

<h4 id="9-6-3-2-解决方案分析"><a href="#9-6-3-2-解决方案分析" class="headerlink" title="9.6.3.2 解决方案分析"></a>9.6.3.2 解决方案分析</h4><h5 id="9-6-3-2-1-使用-Namespace-方案解决"><a href="#9-6-3-2-1-使用-Namespace-方案解决" class="headerlink" title="9.6.3.2.1 使用 Namespace 方案解决"></a><strong>9.6.3.2.1</strong> 使用 <strong>Namespace</strong> 方案解决</h5><h4 id="9-6-3-3-配置实现"><a href="#9-6-3-3-配置实现" class="headerlink" title="9.6.3.3 配置实现"></a>9.6.3.3 配置实现</h4><p><strong>1.</strong> 在 <strong>nacos server</strong> 创建新的 <strong>namespace , baidu</strong> 和 <strong>alibaba</strong></p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620162934242.png" alt="image-20230620162934242" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620163057931.png" alt="image-20230620163057931" style="zoom:50%;" />

<p><strong>2.</strong> <strong>在</strong> <strong>nacos server</strong> <strong>创建新的</strong> <strong>group&#x2F;dataid</strong></p>
<h4 id="9-6-3-4-修改-application-yml"><a href="#9-6-3-4-修改-application-yml" class="headerlink" title="9.6.3.4 修改 application.yml"></a>9.6.3.4 修改 application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment">#指定环境，常见的环境有 dev/test/prod 开发，测试，生产</span></span><br></pre></td></tr></table></figure>

<h4 id="9-6-3-5-修改-bootstrap-yml"><a href="#9-6-3-5-修改-bootstrap-yml" class="headerlink" title="9.6.3.5 修改 bootstrap.yml"></a>9.6.3.5 修改 bootstrap.yml</h4><p><strong>1.</strong> 增加 <strong>Namespace</strong> 参数</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">20000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># 这里的name 需要参考nacos配置中心的DataId</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">e-commerce-nacos-config-client</span></span><br><span class="line">  <span class="comment">#配置nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacos服务注册中心地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacos配置中心地址</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#指定读取配置中心的yaml后缀的配置</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">seckill</span> <span class="comment">#指定order组，默认为DEFAULT_GROUP</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">8b005a7a-89b9-40ba-a5da-aac3e6c7a564</span></span><br></pre></td></tr></table></figure>

<h4 id="9-6-3-6-测试"><a href="#9-6-3-6-测试" class="headerlink" title="9.6.3.6 测试"></a>9.6.3.6 测试</h4><h5 id="9-6-3-6-1-浏览器-http-localhost-5000-nacos-config-ip"><a href="#9-6-3-6-1-浏览器-http-localhost-5000-nacos-config-ip" class="headerlink" title="9.6.3.6.1 浏览器**: http://localhost:5000/nacos/config/ip**"></a><strong>9.6.3.6.1</strong> 浏览器**: <a target="_blank" rel="noopener" href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a>**</h5><p>**1.**浏览器输入: <a target="_blank" rel="noopener" href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a></p>
<h3 id="9-6-4-Namespace-x2F-Group-x2F-Data-ID-关系"><a href="#9-6-4-Namespace-x2F-Group-x2F-Data-ID-关系" class="headerlink" title="9.6.4 Namespace&#x2F;Group&#x2F;Data ID 关系"></a><strong>9.6.4 Namespace&#x2F;Group&#x2F;Data ID</strong> 关系</h3><h4 id="9-6-4-1-一图胜千言"><a href="#9-6-4-1-一图胜千言" class="headerlink" title="9.6.4.1 一图胜千言"></a>9.6.4.1 一图胜千言</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620164046357.png" alt="image-20230620164046357" style="zoom:50%;" />

<h4 id="9-6-4-2-详解介绍"><a href="#9-6-4-2-详解介绍" class="headerlink" title="9.6.4.2 详解介绍"></a>9.6.4.2 详解介绍</h4><p><strong>1. namespace &#x2F; group &#x2F; data id</strong> 的关系</p>
<p>2.梳理:</p>
<ul>
<li><p>Nacos默认的命名空间是public，Namespace主要用来实现配置隔离,隔离范围大</p>
</li>
<li><p>Group默认是DEFAULT GROUP, Group可以把不同的微服务划分到同一个分组里面去</p>
</li>
<li><p>Service就是微服务,相同的Service可以是一个Cluster(簇&#x2F;集群), Instance就是微服务的实例</p>
</li>
</ul>
<h1 id="10-SpringCloud-Alibaba-Sentinel——分布式系统的流量哨兵"><a href="#10-SpringCloud-Alibaba-Sentinel——分布式系统的流量哨兵" class="headerlink" title="10 SpringCloud Alibaba Sentinel——分布式系统的流量哨兵"></a>10 SpringCloud Alibaba Sentinel——分布式系统的流量哨兵</h1><h2 id="10-1-Sentinel基础"><a href="#10-1-Sentinel基础" class="headerlink" title="10.1 Sentinel基础"></a>10.1 Sentinel基础</h2><h3 id="10-1-1-官网"><a href="#10-1-1-官网" class="headerlink" title="10.1.1 官网"></a><strong>10.1.1</strong> 官网</h3><h4 id="10-1-1-1-Github-https-github-com-alibaba-Sentinel"><a href="#10-1-1-1-Github-https-github-com-alibaba-Sentinel" class="headerlink" title="10.1.1.1 Github: https://github.com/alibaba/Sentinel"></a>10.1.1.1 Github: <a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel">https://github.com/alibaba/Sentinel</a></h4><h4 id="10-1-1-2-快速开始-https-sentinelguard-io-zh-cn-docs-quick-start-html"><a href="#10-1-1-2-快速开始-https-sentinelguard-io-zh-cn-docs-quick-start-html" class="headerlink" title="10.1.1.2 快速开始: https://sentinelguard.io/zh-cn/docs/quick-start.html"></a>10.1.1.2 快速开始: <a target="_blank" rel="noopener" href="https://sentinelguard.io/zh-cn/docs/quick-start.html">https://sentinelguard.io/zh-cn/docs/quick-start.html</a></h4><h4 id="10-1-1-3-中文-https-github-com-alibaba-Sentinel-wiki-E4-BB-8B-E7-BB-8D"><a href="#10-1-1-3-中文-https-github-com-alibaba-Sentinel-wiki-E4-BB-8B-E7-BB-8D" class="headerlink" title="10.1.1.3 中文: https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D"></a>10.1.1.3 中文: <a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D">https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D</a></h4><h4 id="10-1-1-4-使-用-手-册-https-spring-cloud-alibaba-group-github-io-github-pages-greenwich-spring-cloud-alibaba-html-spring-cloud-alibaba-sentinel"><a href="#10-1-1-4-使-用-手-册-https-spring-cloud-alibaba-group-github-io-github-pages-greenwich-spring-cloud-alibaba-html-spring-cloud-alibaba-sentinel" class="headerlink" title="10.1.1.4 使 用 手 册 https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel"></a>10.1.1.4 使 用 手 册 <a target="_blank" rel="noopener" href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel</a></h4><h3 id="10-1-2-Sentinel是什么"><a href="#10-1-2-Sentinel是什么" class="headerlink" title="10.1.2 Sentinel是什么?"></a><strong>10.1.2 Sentinel</strong>是什么?</h3><h4 id="10-1-2-1-Sentinel-概述"><a href="#10-1-2-1-Sentinel-概述" class="headerlink" title="10.1.2.1 Sentinel 概述"></a>10.1.2.1 Sentinel 概述</h4><ol>
<li>Sentinel 是什么?</li>
</ol>
<p>随着微服务的流行，服务和服务之间的稳定性变得越来越重要。Sentinel 以流量为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。</p>
<ol start="2">
<li>Sentinel 的主要特性</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620201315601.png" alt="image-20230620201315601"></p>
<p><strong>梳理</strong>: sentinel **可以完成的功能 **: <strong>绿色方框</strong>列出的部分</p>
<ol start="3">
<li>Sentinel 的开源生态</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620201431927.png" alt="image-20230620201431927"></p>
<h4 id="10-1-2-2-一句话-Sentinel-分布式系统的流量防卫兵-保护你的微服务"><a href="#10-1-2-2-一句话-Sentinel-分布式系统的流量防卫兵-保护你的微服务" class="headerlink" title="10.1.2.2 一句话: Sentinel: 分布式系统的流量防卫兵, 保护你的微服务"></a>10.1.2.2 一句话: Sentinel: 分布式系统的流量防卫兵, 保护你的微服务</h4><h3 id="10-1-3-Sentinel核心功能"><a href="#10-1-3-Sentinel核心功能" class="headerlink" title="10.1.3 Sentinel核心功能"></a><strong>10.1.3 Sentinel</strong>核心功能</h3><h4 id="10-1-3-1-流量控制"><a href="#10-1-3-1-流量控制" class="headerlink" title="10.1.3.1 流量控制"></a>10.1.3.1 流量控制</h4><h4 id="10-1-3-2-熔断降级"><a href="#10-1-3-2-熔断降级" class="headerlink" title="10.1.3.2 熔断降级"></a>10.1.3.2 熔断降级</h4><p><strong>-</strong> 在调用系统的时候，如果调用链路中的某个资源出现了不稳定，最终会导致请求发生堆积，如下图：</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620201814295.png" alt="image-20230620201814295" style="zoom:50%;" />

<p><strong>解读</strong>：</p>
<p>​	<u>熔断降级可以解决这个问题</u>，所谓的熔断降级就是当检测到调用链路中某个资源出现不稳定的表现，例如请求响应时间长或异常比例升高的时候，则<u>对这个资源的调用进行限制，让请求快速失败，避免影响到其它的资源而导致级联故障</u>。</p>
<h4 id="10-1-3-3-系统负载保护"><a href="#10-1-3-3-系统负载保护" class="headerlink" title="10.1.3.3 系统负载保护"></a>10.1.3.3 系统负载保护</h4><p>​	根据系统能够处理的请求，和允许进来的请求，来做平衡，追求的目标是在系统不被拖垮的情况下**,** 提高系统的吞吐率</p>
<h4 id="10-1-3-4-消息削峰填谷"><a href="#10-1-3-4-消息削峰填谷" class="headerlink" title="10.1.3.4 消息削峰填谷"></a>10.1.3.4 消息削峰填谷</h4><p>​	某瞬时来了大流量的请求**,** 而如果此时要处理所有请求，很可能会导致系统负载过高，影响稳定性。</p>
<p>​	但其实可能后面几秒之内都没有消息投递，若直接把多余的消息丢掉则没有充分利用系统处理消息的能力</p>
<p><strong>- Sentinel 的Rate Limiter模式能在某一段时间间隔内以匀速方式处理这样的请求, 充分利用系统的处理能力, 也就是削峰填谷, 保证资源的稳定性</strong></p>
<h3 id="10-1-4-Sentinel两个组成部分"><a href="#10-1-4-Sentinel两个组成部分" class="headerlink" title="10.1.4 Sentinel两个组成部分"></a><strong>10.1.4 Sentinel</strong>两个组成部分</h3><h4 id="10-1-4-1-核心库-Java-客户端-不依赖任何框架-x2F-库，能够运行在所有-Java运行时环境，对-Spring-Cloud有较好的支持"><a href="#10-1-4-1-核心库-Java-客户端-不依赖任何框架-x2F-库，能够运行在所有-Java运行时环境，对-Spring-Cloud有较好的支持" class="headerlink" title="10.1.4.1 核心库:(Java 客户端)不依赖任何框架&#x2F;库，能够运行在所有 Java运行时环境，对 Spring Cloud有较好的支持"></a>10.1.4.1 核心库:(Java 客户端)不依赖任何框架&#x2F;库，能够运行在所有 Java运行时环境，对 Spring Cloud有较好的支持</h4><h4 id="10-1-4-2-控制台-Dashboard-基于-Spring-Boot-开发，打包后可以直接运行，不需要额外的-Tomcat-等应用容器-就跟nacos、eureka那种控制台那样"><a href="#10-1-4-2-控制台-Dashboard-基于-Spring-Boot-开发，打包后可以直接运行，不需要额外的-Tomcat-等应用容器-就跟nacos、eureka那种控制台那样" class="headerlink" title="10.1.4.2 控制台:(Dashboard)基于 Spring Boot 开发，打包后可以直接运行，不需要额外的 Tomcat 等应用容器(就跟nacos、eureka那种控制台那样)"></a>10.1.4.2 控制台:(Dashboard)基于 Spring Boot 开发，打包后可以直接运行，不需要额外的 Tomcat 等应用容器(就跟nacos、eureka那种控制台那样)</h4><h2 id="10-2-Sentinel控制台"><a href="#10-2-Sentinel控制台" class="headerlink" title="10.2 Sentinel控制台"></a>10.2 Sentinel控制台</h2><h3 id="10-2-1-需求分析-x2F-图解"><a href="#10-2-1-需求分析-x2F-图解" class="headerlink" title="10.2.1 需求分析**&#x2F;**图解"></a><strong>10.2.1</strong> 需求分析**&#x2F;**图解</h3><p><strong>1.</strong> 需求**:** 搭建 <strong>Sentinel</strong> 控制台，用于显示各个微服务的使用情况</p>
<h3 id="10-2-2-下载"><a href="#10-2-2-下载" class="headerlink" title="10.2.2 下载"></a><strong>10.2.2</strong> 下载</h3><h4 id="10-2-2-1-https-github-com-alibaba-Sentinel-releases-tag-v1-8-0"><a href="#10-2-2-1-https-github-com-alibaba-Sentinel-releases-tag-v1-8-0" class="headerlink" title="10.2.2.1 https://github.com/alibaba/Sentinel/releases/tag/v1.8.0"></a>10.2.2.1 <a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/releases/tag/v1.8.0">https://github.com/alibaba/Sentinel/releases/tag/v1.8.0</a></h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620203427041.png" alt="image-20230620203427041" style="zoom:50%;" />

<h3 id="10-2-3-运行"><a href="#10-2-3-运行" class="headerlink" title="10.2.3 运行"></a><strong>10.2.3</strong> 运行</h3><h4 id="10-2-3-1-指令"><a href="#10-2-3-1-指令" class="headerlink" title="10.2.3.1 指令:"></a>10.2.3.1 指令:</h4><p>我把下载的jar包放在 &#x2F;Applications&#x2F;Java&#x2F;jar包资源 此处了</p>
<p>因此在终端运行以下指令即可启动 Sentinel</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /Applications/Java/jar包资源</span><br><span class="line">java -jar sentinel-dashboard-1.8.0.jar 			//启动</span><br><span class="line">java -jar sentinel-dashboard-1.8.0.jar --server.port=9999	//也可以自定义端口运行该进程</span><br><span class="line">	Ctrl+C即可关闭服务</span><br></pre></td></tr></table></figure>

<h4 id="10-2-3-2-注意-Sentinel-控制台-默认端口是-8080"><a href="#10-2-3-2-注意-Sentinel-控制台-默认端口是-8080" class="headerlink" title="10.2.3.2 注意: Sentinel 控制台 默认端口是 8080"></a>10.2.3.2 注意: Sentinel 控制台 默认端口是 8080</h4><h3 id="10-2-4-访问"><a href="#10-2-4-访问" class="headerlink" title="10.2.4 访问"></a><strong>10.2.4</strong> 访问</h3><h4 id="10-2-4-1-浏览器-http-localhost-8080"><a href="#10-2-4-1-浏览器-http-localhost-8080" class="headerlink" title="10.2.4.1 浏览器: http://localhost:8080"></a>10.2.4.1 浏览器: <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a></h4><h4 id="10-2-4-2-控制台页面"><a href="#10-2-4-2-控制台页面" class="headerlink" title="10.2.4.2 控制台页面"></a>10.2.4.2 控制台页面</h4><p><strong>1.</strong> 浏览器输入**: <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a> ,** 用户**&#x2F;**密码都是 <strong>sentinel</strong></p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620203842208.png" alt="image-20230620203842208" style="zoom:25%;" />

<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620204626829.png" alt="image-20230620204626829" style="zoom:50%;" />

<p><strong>2.</strong> <strong>登录成功后的页面</strong>, <strong>目前是空的，因为</strong> <strong>sentinel</strong> <strong>还没有进行流量监控</strong></p>
<h2 id="10-3-Sentinel监控微服务"><a href="#10-3-Sentinel监控微服务" class="headerlink" title="10.3 Sentinel监控微服务"></a>10.3 Sentinel监控微服务</h2><h3 id="10-3-1-需求分析-x2F-图解"><a href="#10-3-1-需求分析-x2F-图解" class="headerlink" title="10.3.1 需求分析**&#x2F;**图解"></a><strong>10.3.1</strong> 需求分析**&#x2F;**图解</h3><ol>
<li>需求**:** 使用 <strong>Sentinel</strong> 控制台对 <strong>member-service-nacos-provider-10004</strong> 微服务 进行实时监控</li>
</ol>
<p><strong>–</strong> 示意图</p>
<img src="/Users/donn/Library/Application Support/typora-user-images/image-20230620204744222.png" alt="image-20230620204744222" style="zoom: 50%;" />

<ol start="2">
<li>当调用了member-service-nacos-provider-10004微服务时,可以监控到请求的<strong>url&#x2F;QPS(每秒查询率)&#x2F;响应时间&#x2F;流量</strong></li>
</ol>
<img src="/Users/donn/Library/Application Support/typora-user-images/image-20230620205650814.png" alt="image-20230620205650814" style="zoom:50%;" />

<h3 id="10-3-2-代码-x2F-配置实现"><a href="#10-3-2-代码-x2F-配置实现" class="headerlink" title="10.3.2 代码**&#x2F;**配置实现"></a><strong>10.3.2</strong> 代码**&#x2F;**配置实现</h3><p><strong>1.</strong> 修改 <strong>member-service-nacos-provider-10004</strong> 的 <strong>pom.xml,</strong> 引入 <strong>alibaba-sentinel</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    引入alibaba-sentinel starter    --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> <strong>修改</strong> <strong>member-service-nacos-provider-10004</strong> <strong>的</strong> <strong>application.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10004</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-nacos-provider</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/e_commerce_center_db?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">QWEASDzxc123</span></span><br><span class="line"><span class="comment">#  配置nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#配置nacos server的地址</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span> <span class="comment">#这个是 sentinel 控制台(sentinel dashboard)的地址 </span></span><br><span class="line">        <span class="comment">#解读 spring.cloud.sentinel.transport.port：</span></span><br><span class="line">        <span class="comment">#1. spring.cloud.sentinel.transport.port 端口配置会在被监控的微服务</span></span><br><span class="line">        <span class="comment"># 对应的机器上启动一个 Http Server</span></span><br><span class="line">        <span class="comment">#2. 该 Server 会与 Sentinel 控制台做交互</span></span><br><span class="line">        <span class="comment">#3. 比如 Sentinel 控制台添加了 1 个限流规则，会把规则数据 push 给这个</span></span><br><span class="line">        <span class="comment"># Http Server 接收，Http Server 再将规则注册到 微服务 中</span></span><br><span class="line">        <span class="comment">#4. 简单的说明: spring.cloud.sentinel.transport.port:指定被监控的微服务应用与</span></span><br><span class="line">        <span class="comment"># Sentinel 控制台交互的端口，微服务应用本地会起一个该端口占用的 Http Server</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span> <span class="comment">#默认 8719，假如被占用了, 会自动从 8719 开始依次+1 扫描。</span></span><br><span class="line">        <span class="comment">#直至找到未被占用的端口</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.study.springcloud.entity</span></span><br><span class="line"><span class="comment">#配置暴露所有的监控点</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>3.</strong> <strong>成功启动后</strong>, netstat -anb <strong>可以查看到该端口</strong>.</p>
<h3 id="10-3-3-测试"><a href="#10-3-3-测试" class="headerlink" title="10.3.3 测试"></a><strong>10.3.3</strong> 测试</h3><h4 id="10-3-3-1-启动-Nacos-Server-8848"><a href="#10-3-3-1-启动-Nacos-Server-8848" class="headerlink" title="10.3.3.1 启动 Nacos Server 8848"></a>10.3.3.1 启动 Nacos Server 8848</h4><h4 id="10-3-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard"><a href="#10-3-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.3.3.2 启动 Sentinel8080 控制台 &#x2F; Sentinel dashboard"></a>10.3.3.2 启动 Sentinel8080 控制台 &#x2F; Sentinel dashboard</h4><h4 id="10-3-3-3-启动-member-service-nacos-provider-10004"><a href="#10-3-3-3-启动-member-service-nacos-provider-10004" class="headerlink" title="10.3.3.3 启动 member-service-nacos-provider-10004"></a>10.3.3.3 启动 member-service-nacos-provider-10004</h4><h4 id="10-3-3-4-浏览器-localhost-10004-x2F-member-x2F-get-x2F-1"><a href="#10-3-3-4-浏览器-localhost-10004-x2F-member-x2F-get-x2F-1" class="headerlink" title="10.3.3.4 浏览器: localhost:10004&#x2F;member&#x2F;get&#x2F;1"></a>10.3.3.4 浏览器: localhost:10004&#x2F;member&#x2F;get&#x2F;1</h4><h4 id="10-3-3-5-Sentinel-控制台监控页面"><a href="#10-3-3-5-Sentinel-控制台监控页面" class="headerlink" title="10.3.3.5 Sentinel 控制台监控页面"></a>10.3.3.5 Sentinel 控制台监控页面</h4><p><strong>1.</strong> 浏览器输入**: <a target="_blank" rel="noopener" href="http://localhost:10004/member/get/1">http://localhost:10004/member/get/1</a>**</p>
<p><strong>2.</strong> <strong>进入到</strong> <strong>Sentinel</strong> <strong>查看实时监控效果</strong>, <a target="_blank" rel="noopener" href="http://localhost:8080/#/dashboard">http://localhost:8080/#/dashboard</a></p>
<img src="/Users/donn/Library/Application Support/typora-user-images/image-20230620211122568.png" alt="image-20230620211122568" style="zoom:50%;" />

<h3 id="10-3-4-注意事项和细节"><a href="#10-3-4-注意事项和细节" class="headerlink" title="10.3.4 注意事项和细节"></a><strong>10.3.4</strong> 注意事项和细节</h3><h4 id="10-3-4-1-QPS-Queries-Per-Second-每秒查询率-，是服务器每秒响应的查询次数"><a href="#10-3-4-1-QPS-Queries-Per-Second-每秒查询率-，是服务器每秒响应的查询次数" class="headerlink" title="10.3.4.1 QPS: Queries Per Second(每秒查询率)，是服务器每秒响应的查询次数"></a>10.3.4.1 QPS: Queries Per Second(每秒查询率)，是服务器每秒响应的查询次数</h4><h4 id="10-3-4-2-Sentinel采用的是懒加载，只有调用了某个接口-x2F-服务，才能看到监控数据"><a href="#10-3-4-2-Sentinel采用的是懒加载，只有调用了某个接口-x2F-服务，才能看到监控数据" class="headerlink" title="10.3.4.2 Sentinel采用的是懒加载，只有调用了某个接口&#x2F;服务，才能看到监控数据"></a>10.3.4.2 Sentinel采用的是懒加载，只有调用了某个接口&#x2F;服务，才能看到监控数据</h4><h2 id="10-4-Sentinel流量控制"><a href="#10-4-Sentinel流量控制" class="headerlink" title="10.4 Sentinel流量控制"></a>10.4 Sentinel流量控制</h2><h3 id="10-4-1-规则"><a href="#10-4-1-规则" class="headerlink" title="10.4.1 规则"></a><strong>10.4.1</strong> 规则</h3><p><strong>1.</strong> 先看一张图</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620211426555.png" alt="image-20230620211426555" style="zoom:40%;" />

<ol start="2">
<li>对上图的解读</li>
</ol>
<ul>
<li><p>资源名：唯一名称，默认请求路径</p>
</li>
<li><p>针对来源：Sentine可以<u>针对调用者进行限流，填写微服务名</u>，默认default（不区分来源）</p>
</li>
<li><p>阈值类型&#x2F;单机阈值：</p>
<ul>
<li>QPS（每秒钟的请求数量）：当调用该 api 的 QPS 达到阈值的时候，进行限流</li>
<li>线程数：当调用该 api 的线程数达到阈值的时候，进行限流</li>
</ul>
</li>
</ul>
<p>解读： <strong>QPS和线程数的区别</strong>，注意听，比如 QPS和线程我们都设置阈值为1</p>
<p>（1）对QPS而言，如果在1秒内，客户端发出了2 次请求，就达到阈值，从而限流</p>
<p>（2）对线程数而言，如果在1秒内，客户端发出了2 次请求，不一定达到线程限制的國值，为什么呢？假设我们1 次请求后台会创建一个线程，但是这个请求完成时间是 0.1 秒（可以视为该请求对应的线程存活 0.1 秒)，所以当客户端第2 次请求时(比如客户端是在0.3秒发出的），这时第 1个请求的线程就己经结束了，因此就没有达到线程的闻值，也不会限流。</p>
<p>（3）小伙伴可以这样理解，如果1个请求对应的线程平均执行时间为 0.1 那么，就相当于 QPS 为 10</p>
<ul>
<li><p>是否集群：不需要集群</p>
</li>
<li><p>流控模式：</p>
<ul>
<li>直接：api 达到限流条件时，直接限流</li>
<li>关联：当关联的资源达到闻值时，就限流自己</li>
<li>链路：当从某个接口过来的资源达到限流条件时，开启限流</li>
</ul>
</li>
<li><p>流控效果：</p>
<ul>
<li>快速失败：直接失败，抛异常</li>
<li>Warm Up：根据 code Factor（冷加载因子，默认3）的值，从阈值&#x2F;codeFactor，经过预热时长，才达到设置的 QPS 阈值</li>
<li>排队等待：匀速排队，让请求以匀速的速度通过，阈值类型必须设置为 QPS， 否则无效</li>
</ul>
</li>
</ul>
<h3 id="10-4-2-流量控制实例-QPS"><a href="#10-4-2-流量控制实例-QPS" class="headerlink" title="10.4.2 流量控制实例**-QPS**"></a><strong>10.4.2</strong> 流量控制实例**-QPS**</h3><h4 id="10-4-2-1-需求分析-x2F-图解"><a href="#10-4-2-1-需求分析-x2F-图解" class="headerlink" title="10.4.2.1 需求分析&#x2F;图解"></a>10.4.2.1 需求分析&#x2F;图解</h4><p> <strong>1.</strong> 需求**:** 通过 <strong>Sentinel</strong> 实现 流量控制<br> <strong>2.</strong> <strong>当调用</strong> <strong>member-service-nacos-provider-10004</strong> <strong>的</strong> <strong>&#x2F;member&#x2F;get&#x2F;</strong>   **API **时，限制 <strong>1</strong>秒内最多访问 <strong>1</strong> <strong>次，否则直接失败，抛异常</strong></p>
<h4 id="10-4-2-2-配置实现步骤"><a href="#10-4-2-2-配置实现步骤" class="headerlink" title="10.4.2.2 配置实现步骤"></a>10.4.2.2 配置实现步骤</h4><p> <strong>1.</strong> 为**&#x2F;member&#x2F;get&#x2F;1** 增加流控规则</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230622221155249.png" alt="image-20230622221155249"></p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230622221223336.png" alt="image-20230622221223336" style="zoom:40%;" />

<p><strong>2.</strong> <strong>在流控规则菜单，可以看到新增的流控规则</strong></p>
<img src="/Users/donn/Library/Application Support/typora-user-images/image-20230622221447805.png" alt="image-20230622221447805" style="zoom: 33%;" />

<h4 id="10-4-2-3-测试"><a href="#10-4-2-3-测试" class="headerlink" title="10.4.2.3 测试"></a>10.4.2.3 测试</h4><h5 id="10-4-2-3-1-启动-Nacos-Server-8848"><a href="#10-4-2-3-1-启动-Nacos-Server-8848" class="headerlink" title="10.4.2.3.1 启动 Nacos Server 8848"></a><strong>10.4.2.3.1</strong> 启动 Nacos Server 8848</h5><h5 id="10-4-2-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard-10-4-2-3-3-启动-member-service-nacos-provider-10004"><a href="#10-4-2-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard-10-4-2-3-3-启动-member-service-nacos-provider-10004" class="headerlink" title="10.4.2.3.2 启动 Sentinel8080 控制台**&#x2F;Sentinel dashboard 10.4.2.3.3** 启动 **member-service-nacos-provider-10004 **"></a>10.4.2.3.2 启动 <strong>Sentinel8080</strong> 控制台**&#x2F;Sentinel dashboard 10.4.2.3.3** 启动 **member-service-nacos-provider-10004 **</h5><h5 id="10-4-2-3-4-浏览器-localhost-10004-x2F-member-x2F-get-x2F-1"><a href="#10-4-2-3-4-浏览器-localhost-10004-x2F-member-x2F-get-x2F-1" class="headerlink" title="10.4.2.3.4 浏览器**: localhost:10004&#x2F;member&#x2F;get&#x2F;1 **"></a><strong>10.4.2.3.4</strong> 浏览器**: localhost:10004&#x2F;member&#x2F;get&#x2F;1 **</h5><h5 id="10-4-2-3-5-Sentinel-控制台监控页面"><a href="#10-4-2-3-5-Sentinel-控制台监控页面" class="headerlink" title="10.4.2.3.5 Sentinel 控制台监控页面"></a><strong>10.4.2.3.5 Sentinel</strong> 控制台监控页面</h5><p><strong>1.</strong> 浏览器输入**: <a target="_blank" rel="noopener" href="http://localhost:10004/member/get/1">http://localhost:10004/member/get/1</a> , 1** 秒钟内访问次数不超过 <strong>1</strong> 次**,** 页 面显示正常</p>
<p><strong>2.</strong> <strong>浏览器输入</strong>:<a target="_blank" rel="noopener" href="http://localhost:10004/member/get/1">http://localhost:10004/member/get/1</a> ,1秒钟内访问次数超过1次, <strong>页面出现错误提示</strong></p>
<img src="/Users/donn/Library/Application Support/typora-user-images/image-20230622221636917.png" alt="image-20230622221636917" style="zoom:33%;" />

<h4 id="10-4-2-4-注意事项和细节"><a href="#10-4-2-4-注意事项和细节" class="headerlink" title="10.4.2.4 注意事项和细节"></a>10.4.2.4 注意事项和细节</h4><h5 id="1-流量规则改动，实时生效，不需重启微服务-Sentinel-控制台"><a href="#1-流量规则改动，实时生效，不需重启微服务-Sentinel-控制台" class="headerlink" title="1. 流量规则改动，实时生效，不需重启微服务 , Sentinel 控制台"></a><strong>1.</strong> 流量规则改动，实时生效，<u>不需重启微服务 <strong>, Sentinel</strong> 控制台</u></h5><p>​			为什么？因为sentinel中规则一发生改动，就会将信息push到微服务主机监听sentinel服务的进程</p>
<h5 id="2-在-sentinel-配置流量规则时，如何配置通配符问题，-比如-x2F-member-x2F-get-x2F-1-x2F-member-x2F-get-x2F-2-统一使用一个规则"><a href="#2-在-sentinel-配置流量规则时，如何配置通配符问题，-比如-x2F-member-x2F-get-x2F-1-x2F-member-x2F-get-x2F-2-统一使用一个规则" class="headerlink" title="2. 在 sentinel 配置流量规则时，如何配置通配符问题， 比如 &#x2F;member&#x2F;get&#x2F;1 &#x2F;member&#x2F;get&#x2F;2 统一使用一个规则"></a><strong>2.</strong> 在 sentinel 配置流量规则时，如何配置通配符问题， 比如 &#x2F;member&#x2F;get&#x2F;1 &#x2F;member&#x2F;get&#x2F;2 统一使用一个规则</h5><ul>
<li>方案1: 在sentinel中 &#x2F;member&#x2F;get?id&#x3D;1 和 &#x2F;member&#x2F;get?id&#x3D;2 被统一认为是**&#x2F;member&#x2F;get** 所以只要对&#x2F;member&#x2F;get 限流就OK了.      (将要携带的参数放在载荷而不是路径中)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/member/get&quot;, params = &quot;id&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getgetMemberById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">    <span class="type">Member</span> <span class="variable">member</span> <span class="operator">=</span> memberService.queryMemberById(id);</span><br><span class="line">    <span class="keyword">if</span>(member != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;查询成功 member-service-nacos-provider-10004&quot;</span>,member);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;402&quot;</span>,<span class="string">&quot;ID = &quot;</span>+ id + <span class="string">&quot;不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/Users/donn/Library/Application Support/typora-user-images/image-20230622223803411.png" alt="image-20230622223803411" style="zoom: 50%;" />

<p>访问：<a target="_blank" rel="noopener" href="http://localhost:10004/member/get?id=3">http://localhost:10004/member/get?id=3</a></p>
<ul>
<li>方案2: URL资源清洗<br>可以通过 UrlCleaner 接口来实现资源清洗，也就是对于&#x2F;member&#x2F;get&#x2F;{id}这个 URL，我们可以统一归集到&#x2F;member&#x2F;get&#x2F;*资源下，具体配置代码如下，实现 UrlCleaner 接口，并重写 clean 方法即可</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加代码：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.study.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.adapter.servlet.callback.UrlCleaner;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 浦原</span></span><br><span class="line"><span class="comment"> * 2023/6/22</span></span><br><span class="line"><span class="comment"> * 22:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomUrlCleaner</span> <span class="keyword">implements</span> <span class="title class_">UrlCleaner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">clean</span><span class="params">(String originURL)</span> &#123;</span><br><span class="line">        <span class="comment">//资源清洗</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(originURL))&#123;</span><br><span class="line">            <span class="keyword">return</span> originURL;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (originURL.startsWith(<span class="string">&quot;/member/get&quot;</span>))&#123;</span><br><span class="line">            <span class="comment">// 1. 如果请求的是接口 /member/get 开头的, 比如/member/get/1</span></span><br><span class="line">            <span class="comment">// 2. 给 sentinel 的返回的资源名就是 /member/get/*</span></span><br><span class="line">            <span class="comment">// 3. 在 sentinel 对 /member/get/* 添加流控规则即可</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/member/get/*&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//否则 返回收到的URL即可</span></span><br><span class="line">        <span class="keyword">return</span> originURL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-如果-sentinel-流控规则没有持久化，当我们重启调用-API-所在微服务模块后，规则会丢失，需要重新加入"><a href="#3-如果-sentinel-流控规则没有持久化，当我们重启调用-API-所在微服务模块后，规则会丢失，需要重新加入" class="headerlink" title="3. 如果 sentinel 流控规则没有持久化，当我们重启调用 API 所在微服务模块后，规则会丢失，需要重新加入"></a><strong>3.</strong> <strong>如果</strong> <strong>sentinel</strong> <strong>流控规则没有持久化，当我们重启调用</strong> <strong>API</strong> <strong>所在微服务模块后，规则会丢失，需要重新加入</strong></h5><h3 id="10-4-3-流量控制实例-线程数"><a href="#10-4-3-流量控制实例-线程数" class="headerlink" title="10.4.3 流量控制实例**-**线程数"></a><strong>10.4.3</strong> 流量控制实例**-**线程数</h3><h4 id="10-4-3-1-需求分析-x2F-图解"><a href="#10-4-3-1-需求分析-x2F-图解" class="headerlink" title="10.4.3.1 需求分析&#x2F;图解"></a>10.4.3.1 需求分析&#x2F;图解</h4><p> <strong>1.</strong> 需求**:** 通过 <strong>Sentinel</strong> 实现 流量控制<br> <strong>2.</strong> 当调用 <strong>member-service-nacos-provider-10004</strong> 的 <strong>&#x2F;member&#x2F;get&#x2F;*</strong>   <strong>API</strong> 时，<u>限制只有一个工作线程</u>，否则直接失败，抛异常**.**</p>
<h4 id="10-4-3-2-配置实现步骤"><a href="#10-4-3-2-配置实现步骤" class="headerlink" title="10.4.3.2 配置实现步骤"></a>10.4.3.2 配置实现步骤</h4><p><strong>1.</strong> 为**&#x2F;member&#x2F;get&#x2F;*** 增加流控规则</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623143357430.png" alt="image-20230623143357430"></p>
<p><strong>2.</strong> <strong>在流控规则菜单，可以看到新增的流控规则</strong></p>
<h4 id="10-4-3-3-测试"><a href="#10-4-3-3-测试" class="headerlink" title="10.4.3.3 测试"></a>10.4.3.3 测试</h4><h5 id="10-4-3-3-1-启动-Nacos-Server-8848"><a href="#10-4-3-3-1-启动-Nacos-Server-8848" class="headerlink" title="10.4.3.3.1 启动 Nacos Server 8848"></a><strong>10.4.3.3.1</strong> 启动 Nacos Server 8848</h5><h5 id="10-4-3-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard"><a href="#10-4-3-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.4.3.3.2 启动 Sentinel8080 控制台**&#x2F;Sentinel dashboard **"></a>10.4.3.3.2 启动 <strong>Sentinel8080</strong> 控制台**&#x2F;Sentinel dashboard **</h5><h5 id="10-4-3-3-3-启动-member-service-nacos-provider-10004"><a href="#10-4-3-3-3-启动-member-service-nacos-provider-10004" class="headerlink" title="10.4.3.3.3 启动 **member-service-nacos-provider-10004 **"></a><strong>10.4.3.3.3</strong> 启动 **member-service-nacos-provider-10004 **</h5><h5 id="10-4-3-3-4-浏览器-localhost-10004-x2F-member-x2F-get-x2F-1"><a href="#10-4-3-3-4-浏览器-localhost-10004-x2F-member-x2F-get-x2F-1" class="headerlink" title="10.4.3.3.4 浏览器**: localhost:10004&#x2F;member&#x2F;get&#x2F;1 **"></a><strong>10.4.3.3.4</strong> 浏览器**: localhost:10004&#x2F;member&#x2F;get&#x2F;1 **</h5><h5 id="10-4-3-3-5-结果页面"><a href="#10-4-3-3-5-结果页面" class="headerlink" title="10.4.3.3.5 结果页面"></a><strong>10.4.3.3.5</strong> 结果页面</h5><p><strong>1.</strong> 浏览器输入**: <a target="_blank" rel="noopener" href="http://localhost:10004/member/get/1">http://localhost:10004/member/get/1</a> ,** 快速刷新**,** 页面显示正常**(<strong>原因是服务执行时间很短，刷新下一次的时候，启动的工作线程，已经完成</strong>)**</p>
<p><strong>2.</strong> <strong>为了看到效果，我们修改下</strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//让它睡眠一下</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    TimeUnit.MILLISECONDS.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.</strong> <strong>重启</strong> <strong>member-service-nacos-provider-10004 ,</strong> <strong>注意</strong>需要重新加入流控规则.</p>
<p><strong>4.</strong> <strong>浏览器输入</strong>: <a target="_blank" rel="noopener" href="http://localhost:10004/member/get/1">http://localhost:10004/member/get/1</a> , <strong>快速刷新</strong>, <strong>页面出现异常</strong></p>
<h4 id="10-4-3-4-注意事项和细节"><a href="#10-4-3-4-注意事项和细节" class="headerlink" title="10.4.3.4 注意事项和细节"></a>10.4.3.4 注意事项和细节</h4><p> <strong>1.</strong> <u>当我们请求一次微服务的 <strong>API</strong> 接口时，后台会启动一个线程</u></p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623144551449.png" alt="image-20230623144551449" style="zoom:50%;" />

<p>2.阈值类型 QPS 和 线程数的区别讨论</p>
<ul>
<li>如果一个线程平均执行时间为0.05秒，就说明在1秒钟，可以执行20次(相当于 QPS为20)</li>
<li>如果一个线程平均执行时间为1秒，说明1秒钟，可以执行1次(相当于 QPS为1)</li>
<li>如果一个线程平均执行时间为2秒，说明2秒钟内，才能执行1次请求</li>
</ul>
<h3 id="10-4-4-流量控制实例-关联"><a href="#10-4-4-流量控制实例-关联" class="headerlink" title="10.4.4 流量控制实例**-**关联"></a><strong>10.4.4</strong> 流量控制实例**-**关联</h3><h4 id="10-4-4-1-关联的含义"><a href="#10-4-4-1-关联的含义" class="headerlink" title="10.4.4.1 关联的含义"></a>10.4.4.1 关联的含义</h4><h5 id="10-4-4-1-1-当关联的资源达到阈值时，就限流自己"><a href="#10-4-4-1-1-当关联的资源达到阈值时，就限流自己" class="headerlink" title="10.4.4.1.1 当关联的资源达到阈值时，就限流自己"></a><strong>10.4.4.1.1</strong> <u>当关联的资源达到阈值时，就限流自己</u></h5><h4 id="10-4-4-2-需求分析-x2F-图解"><a href="#10-4-4-2-需求分析-x2F-图解" class="headerlink" title="10.4.4.2 需求分析&#x2F;图解"></a>10.4.4.2 需求分析&#x2F;图解</h4><p><strong>1.</strong> 需求**:** 通过 <strong>Sentinel</strong> 实现 流量控制</p>
<p><strong>2.</strong> 当调用 <strong>member-service-nacos-provider-10004</strong> 的 <strong>&#x2F;t2 API</strong> 接口时，如果 <strong>QPS</strong> 超过 <strong>1</strong>，这时调用 <strong>&#x2F;t1 API</strong> 接口 直接失败，抛异常**.** </p>
<p>​	梳理: <strong>&#x2F;t2</strong> 是关联的资源 <strong>,</strong> 限流的资源是**&#x2F;t1**</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/t1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;t1执行...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/t2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;t2执行...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-4-4-3-配置实现步骤"><a href="#10-4-4-3-配置实现步骤" class="headerlink" title="10.4.4.3 配置实现步骤"></a>10.4.4.3 配置实现步骤</h4><p> <strong>1.</strong> 为**&#x2F;t1** 增加流控规则</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623150310128.png" alt="image-20230623150310128" style="zoom:50%;" />

<p><strong>2.</strong> <strong>在流控规则菜单，可以看到新增的流控规则</strong></p>
<h4 id="10-4-4-4-测试"><a href="#10-4-4-4-测试" class="headerlink" title="10.4.4.4 测试"></a>10.4.4.4 测试</h4><h5 id="10-4-4-4-1-启动-Nacos-Server-8848"><a href="#10-4-4-4-1-启动-Nacos-Server-8848" class="headerlink" title="10.4.4.4.1 启动 Nacos Server 8848"></a><strong>10.4.4.4.1</strong> 启动 Nacos Server 8848</h5><h5 id="10-4-4-4-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard"><a href="#10-4-4-4-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.4.4.4.2 启动 Sentinel8080 控制台**&#x2F;Sentinel dashboard**"></a>10.4.4.4.2 启动 <strong>Sentinel8080</strong> 控制台**&#x2F;Sentinel dashboard**</h5><h5 id="10-4-4-4-3-启动-member-service-nacos-provider-10004"><a href="#10-4-4-4-3-启动-member-service-nacos-provider-10004" class="headerlink" title="10.4.4.4.3 启动 **member-service-nacos-provider-10004 **"></a>10.4.4.4.3 启动 **member-service-nacos-provider-10004 **</h5><h5 id="10-4-4-4-4-「Postman模拟高并发访问-x2F-t2-」"><a href="#10-4-4-4-4-「Postman模拟高并发访问-x2F-t2-」" class="headerlink" title="10.4.4.4.4 「Postman模拟高并发访问**&#x2F;t2**」"></a><strong>10.4.4.4.4 「Postman</strong>模拟高并发访问**&#x2F;t2**」</h5><p><strong>1.</strong> 创建新的 <strong>http request</strong>			</p>
<p><strong>2.</strong> <strong>保存</strong> <strong>request</strong> <strong>到 一个新的</strong> <strong>collection</strong> <strong>中</strong></p>
<p><strong>3.</strong> <strong>设置</strong> <strong>run collection</strong> <strong>参数</strong>, <strong>并运行</strong></p>
<p><strong>4.</strong> <strong>浏览器访问</strong>: <a target="_blank" rel="noopener" href="http://localhost:10004/t1">http://localhost:10004/t1</a></p>
<h5 id="10-4-4-4-5-浏览器-localhost-10004-x2F-t1"><a href="#10-4-4-4-5-浏览器-localhost-10004-x2F-t1" class="headerlink" title="10.4.4.4.5 浏览器: localhost:10004&#x2F;t1"></a><strong>10.4.4.4.5</strong> 浏览器: localhost:10004&#x2F;t1</h5><p><strong>1.</strong> 浏览器访问 <strong><a target="_blank" rel="noopener" href="http://localhost:10004/t1">http://localhost:10004/t1</a></strong> 的结果页面</p>
<h4 id="10-4-4-5-注意事项和细节"><a href="#10-4-4-5-注意事项和细节" class="headerlink" title="10.4.4.5 注意事项和细节"></a>10.4.4.5 注意事项和细节</h4><p> <strong>10.4.4.5.1</strong> 在 <strong>postman</strong> 执行 高并发访问 <strong>&#x2F;t2</strong> 没有结束时， 去访问 <strong>&#x2F;t1</strong> 才能看到流控异常出现</p>
<h3 id="10-4-5-流量控制实例-Warm-up"><a href="#10-4-5-流量控制实例-Warm-up" class="headerlink" title="10.4.5 流量控制实例**-Warm up**"></a>10.4.5 流量控制实例**-Warm up**</h3><h4 id="10-4-5-1-Warm-up-介绍"><a href="#10-4-5-1-Warm-up-介绍" class="headerlink" title="10.4.5.1 Warm up 介绍"></a>10.4.5.1 Warm up 介绍</h4><p><strong>1.</strong> 概述</p>
<ul>
<li><strong>当流量突然增大的时候，我们常常会希望系统从空闲状态到繁忙状态的切换的时间长 一些。即如果系统在此之前长期处于空闲的状态，我们希望处理请求的数量是缓步的 增多，经过预期的时间以后，到达系统处理请求个数的最大值。</strong>Warm Up(<strong>冷启动， 预热</strong>)<strong>模式就是为了实现这个目的的。</strong></li>
<li><strong>这个场景主要用于启动需要额外开销的场景，例如建立数据库连接等</strong></li>
</ul>
<p><strong>2.</strong> <strong>一张图</strong></p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623215536876.png" alt="image-20230623215536876" style="zoom:50%;" />

<ul>
<li><strong>通常冷启动的过程系统允许通过的</strong> <strong>QPS</strong> <strong>曲线图</strong>(上图)</li>
<li><strong>默认</strong> <strong>coldFactor</strong> <strong>为</strong> <strong>3</strong>，即请求 <strong>QPS</strong> <strong>从</strong> <strong>threshold &#x2F; 3</strong> <strong>开始，经预热时长逐渐升至设定的</strong> <strong>QPS</strong> <strong>阈值</strong></li>
<li><strong>这里的</strong>threshold <strong>就是最终要达到的</strong>QPS阈值.</li>
</ul>
<h5 id="10-4-5-1-1-文-档"><a href="#10-4-5-1-1-文-档" class="headerlink" title="10.4.5.1.1 文 档 :"></a><strong>10.4.5.1.1</strong> 文 档 <strong>:</strong></h5><p><strong><a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8">https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8</a></strong></p>
<h5 id="10-4-5-1-2-默认-coldFactor-为-3，即请求-QPS-从-threshold-x2F-3-开始，经预热时长逐渐升至设定的-QPS-阈值"><a href="#10-4-5-1-2-默认-coldFactor-为-3，即请求-QPS-从-threshold-x2F-3-开始，经预热时长逐渐升至设定的-QPS-阈值" class="headerlink" title="10.4.5.1.2 默认 coldFactor 为 3，即请求 QPS 从 threshold &#x2F; 3 开始，经预热时长逐渐升至设定的 QPS 阈值"></a><strong>10.4.5.1.2</strong> 默认 <strong>coldFactor</strong> 为 <strong>3</strong>，即请求 <strong>QPS</strong> 从 <strong>threshold &#x2F; 3</strong> 开始，经预热时长逐渐升至设定的 <strong>QPS</strong> 阈值</h5><h5 id="10-4-5-1-3-Warm-up-称为-冷启动-x2F-预热"><a href="#10-4-5-1-3-Warm-up-称为-冷启动-x2F-预热" class="headerlink" title="10.4.5.1.3 Warm up 称为 冷启动**&#x2F;**预热"></a><strong>10.4.5.1.3 Warm up</strong> 称为 冷启动**&#x2F;**预热</h5><h5 id="10-4-5-1-4-应用场景-秒杀在开启瞬间，大流量很容易造成冲垮系统，Warmup-可慢慢的把流量放入，最终将阀值增长到设置阀值"><a href="#10-4-5-1-4-应用场景-秒杀在开启瞬间，大流量很容易造成冲垮系统，Warmup-可慢慢的把流量放入，最终将阀值增长到设置阀值" class="headerlink" title="10.4.5.1.4 应用场景**:** 秒杀在开启瞬间，大流量很容易造成冲垮系统，Warmup 可慢慢的把流量放入，最终将阀值增长到设置阀值"></a><strong>10.4.5.1.4</strong> 应用场景**:** 秒杀在开启瞬间，大流量很容易造成冲垮系统，<strong>Warmup</strong> 可慢慢的把流量放入，最终将阀值增长到设置阀值</h5><h4 id="10-4-5-2-需求分析-x2F-图解"><a href="#10-4-5-2-需求分析-x2F-图解" class="headerlink" title="10.4.5.2 需求分析&#x2F;图解"></a>10.4.5.2 需求分析&#x2F;图解</h4><p><strong>1.</strong> 需求**:** 通过 <strong>Sentinel</strong> 实现流量控制**,**演示 <strong>Warm up</strong></p>
<p><strong>2.</strong> 调用 <strong>member-service-nacos-provider-10004</strong> 的 <strong>&#x2F;t2 API</strong> 接口，将 <strong>QPS</strong> 设置为 <strong>9,</strong> 设置 <strong>Warm up</strong> 值为 <strong>3</strong></p>
<p><strong>4.</strong> 含义为 请求 <strong>&#x2F;t2</strong> 的 <strong>QPS</strong> 从 <strong>threshold &#x2F; 3( 9 &#x2F;3 &#x3D; 3)</strong> 开始，经预热时长**(3** 秒**)<strong>逐渐升至 设定的 <strong>QPS</strong> 阈值</strong>(9)**</p>
<p><strong>5.</strong> 为什么是 <strong>9 &#x2F; 3,</strong> 这个是 <strong>3</strong> 就是默认冷启动启动加载因子 <strong>coldFactor&#x3D;3</strong></p>
<p><strong>6.</strong> 测试预期效果**:** 在前 <strong>3</strong> 秒，如果访问 <strong>&#x2F;t2</strong> 的 <strong>QPS</strong> 超过 <strong>3,</strong> 会直接报错，在 <strong>3</strong> 秒后 访问 <strong>&#x2F;t2</strong> 的 <strong>QPS</strong> 超过 <strong>3,</strong> 小于等于 <strong>9,</strong> 是正常访问</p>
<h4 id="10-4-5-3-配置实现步骤"><a href="#10-4-5-3-配置实现步骤" class="headerlink" title="10.4.5.3 配置实现步骤"></a>10.4.5.3 配置实现步骤</h4><p><strong>1.</strong> 为**&#x2F;t2** 增加流控规则</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623220623200.png" alt="image-20230623220623200" style="zoom:50%;" />

<p><strong>2.</strong> <strong>在流控规则菜单，可以看到新增的流控规则</strong></p>
<h4 id="10-4-5-4-测试"><a href="#10-4-5-4-测试" class="headerlink" title="10.4.5.4 测试"></a>10.4.5.4 测试</h4><h5 id="10-4-5-4-1-启动-Nacos-Server-8848"><a href="#10-4-5-4-1-启动-Nacos-Server-8848" class="headerlink" title="10.4.5.4.1 启动 Nacos Server 8848"></a><strong>10.4.5.4.1</strong> 启动 Nacos Server 8848</h5><h5 id="10-4-5-4-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard"><a href="#10-4-5-4-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.4.5.4.2 启动 Sentinel8080 控制台**&#x2F;Sentinel dashboard **"></a>10.4.5.4.2 启动 <strong>Sentinel8080</strong> 控制台**&#x2F;Sentinel dashboard **</h5><h5 id="10-4-5-4-3-启动-member-service-nacos-provider-10004"><a href="#10-4-5-4-3-启动-member-service-nacos-provider-10004" class="headerlink" title="10.4.5.4.3 启动 **member-service-nacos-provider-10004 **"></a><strong>10.4.5.4.3</strong> 启动 **member-service-nacos-provider-10004 **</h5><h5 id="10-4-5-4-4-浏览器-localhost-10004-x2F-t2"><a href="#10-4-5-4-4-浏览器-localhost-10004-x2F-t2" class="headerlink" title="10.4.5.4.4 浏览器**: localhost:10004&#x2F;t2**"></a><strong>10.4.5.4.4</strong> 浏览器**: localhost:10004&#x2F;t2**</h5><p><strong>1.</strong> 浏览器访问 <strong><a target="_blank" rel="noopener" href="http://localhost:10004/t2">http://localhost:10004/t2</a></strong> 快速刷新页面，在前 <strong>3</strong> 秒，会出现流控异常， 后 <strong>3</strong> 秒就正常了**(<strong>如果你刷新非常快 <strong>QPS&gt;9</strong> <strong>,</strong> 仍然会出现流控异常</strong>)**</p>
<h4 id="10-4-5-5-注意事项和细节"><a href="#10-4-5-5-注意事项和细节" class="headerlink" title="10.4.5.5 注意事项和细节"></a>10.4.5.5 注意事项和细节</h4><p> <strong>10.4.5.5.1</strong> 测试 <strong>Warm up</strong> 效果不是很好测，如果出不来可以尝试，调整流控规则**:** 比如 <strong>QPS</strong> 为 **11, Warm up 预热时间 **6 秒</p>
<h5 id="10-4-5-5-2-如果请求停止-即-一段时间没有达到阈值-Warm-up-过程将重复-小伙伴可以理解是一个弹性过程"><a href="#10-4-5-5-2-如果请求停止-即-一段时间没有达到阈值-Warm-up-过程将重复-小伙伴可以理解是一个弹性过程" class="headerlink" title="10.4.5.5.2 如果请求停止**(即:** 一段时间没有达到阈值**), Warm up** 过程将重复**,** 小伙伴可以理解是一个弹性过程"></a><strong>10.4.5.5.2</strong> 如果请求停止**(<strong>即</strong>:** 一段时间没有达到阈值**), Warm up** 过程将重复**,** 小伙伴可以理解是一个弹性过程</h5><h3 id="10-4-6-流量控制实例-排队"><a href="#10-4-6-流量控制实例-排队" class="headerlink" title="10.4.6 流量控制实例**-**排队"></a>10.4.6 流量控制实例**-**排队</h3><h4 id="10-4-6-1-排队-介绍"><a href="#10-4-6-1-排队-介绍" class="headerlink" title="10.4.6.1 排队 介绍"></a>10.4.6.1 排队 介绍</h4><p><strong>1.</strong> 排队方式:这种方式严格控制了请求通过的间隔时间，也即是让请求以均匀的速度通过，对应的是漏桶算法</p>
<p><strong>2.</strong> <strong>一张图</strong></p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623221119829.png" alt="image-20230623221119829" style="zoom:33%;" />

<p><strong>3.</strong> <strong>这种方式主要用于处理间隔性突发的流量，例如消息队列。比如这样的场景，在某一秒有大量的请求到来，而接下来的几秒则处于空闲状态，<u>我们希望系统能够在接下来的空闲期间逐渐处理这些请求</u>，而不是在第一秒直接拒绝多余的请求。-类似前面说的削峰填谷</strong></p>
<p><strong>4.</strong> <strong>匀速排队，阈值必须设置为QPS</strong></p>
<h4 id="10-4-6-2-需求分析-x2F-图解"><a href="#10-4-6-2-需求分析-x2F-图解" class="headerlink" title="10.4.6.2 需求分析&#x2F;图解"></a>10.4.6.2 需求分析&#x2F;图解</h4><p><strong>1.</strong> 需求**:** 通过 <strong>Sentinel</strong> 实现 流量控制**-<strong>排队<br><strong>2.</strong> 调用 <strong>member-service-nacos-provider-10004</strong> 的 <strong>&#x2F;t2 API</strong> 接口，将 <strong>QPS</strong> 设置为 <strong>1 **<br><strong>3.</strong> 当调用 <strong>&#x2F;t2</strong> 的 <strong>QPS</strong> 超过 <strong>1</strong> 时，不拒绝请求，而是排队等待</strong>,</strong> 依次执行<br><strong>4.<strong>当等待时间超过 <strong>10</strong> 秒，则为等待超时——</strong>等待超时就不要了</strong></p>
<h4 id="10-4-6-3-修改业务类"><a href="#10-4-6-3-修改业务类" class="headerlink" title="10.4.6.3 修改业务类"></a>10.4.6.3 修改业务类</h4><p><strong>1.</strong> 为了测试看到效果，修改 <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/t2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//模拟线程执行时间为1秒</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.MILLISECONDS.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  	log.info(<span class="string">&quot;执行 t2() 线程 id= &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;t2执行...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-4-6-4-配置实现步骤"><a href="#10-4-6-4-配置实现步骤" class="headerlink" title="10.4.6.4 配置实现步骤"></a>10.4.6.4 配置实现步骤</h4><p><strong>1.</strong> 为**&#x2F;t2** 增加流控规则</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623222712777.png" alt="image-20230623222712777" style="zoom:50%;" />

<p><strong>2.</strong> <strong>在流控规则菜单，可以看到新增的流控规则</strong></p>
<h4 id="10-4-6-5-测试"><a href="#10-4-6-5-测试" class="headerlink" title="10.4.6.5 测试"></a>10.4.6.5 测试</h4><h5 id="10-4-6-5-1-启动-Nacos-Server-8848"><a href="#10-4-6-5-1-启动-Nacos-Server-8848" class="headerlink" title="10.4.6.5.1 启动 Nacos Server 8848"></a><strong>10.4.6.5.1</strong> 启动 Nacos Server 8848</h5><h5 id="10-4-6-5-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard"><a href="#10-4-6-5-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.4.6.5.2 启动 Sentinel8080 控制台**&#x2F;Sentinel dashboard **"></a>10.4.6.5.2 启动 <strong>Sentinel8080</strong> 控制台**&#x2F;Sentinel dashboard **</h5><h5 id="10-4-6-5-3-启动-member-service-nacos-provider-10004"><a href="#10-4-6-5-3-启动-member-service-nacos-provider-10004" class="headerlink" title="10.4.6.5.3 启动 **member-service-nacos-provider-10004 **"></a><strong>10.4.6.5.3</strong> 启动 **member-service-nacos-provider-10004 **</h5><h5 id="10-4-6-5-4-浏览器-localhost-10004-x2F-t2"><a href="#10-4-6-5-4-浏览器-localhost-10004-x2F-t2" class="headerlink" title="10.4.6.5.4 浏览器**: localhost:10004&#x2F;t2**"></a><strong>10.4.6.5.4</strong> 浏览器**: localhost:10004&#x2F;t2**</h5><p><strong>1.</strong> 浏览器访问 <strong><a target="_blank" rel="noopener" href="http://localhost:10004/t2">http://localhost:10004/t2</a></strong> 快速刷新页面 <strong>9</strong> 次，观察前台**&#x2F;**后台输出的情况</p>
<p>输出结果分析：没有报错误，后台请求排队执行，每隔1s匀速执行</p>
<p><strong>2.</strong> <strong>浏览器访问</strong> <strong><a target="_blank" rel="noopener" href="http://localhost:10004/t2">http://localhost:10004/t2</a></strong> <strong>快速刷新页面</strong>20<strong>次，当请求等待时间超过</strong>10S, <strong>仍然出现流控异常</strong></p>
<h2 id="10-5-Sentinel熔断降级"><a href="#10-5-Sentinel熔断降级" class="headerlink" title="10.5 Sentinel熔断降级"></a>10.5 Sentinel熔断降级</h2><h3 id="10-5-1-线程堆积引出熔断降级"><a href="#10-5-1-线程堆积引出熔断降级" class="headerlink" title="10.5.1 线程堆积引出熔断降级"></a><strong>10.5.1</strong> 线程堆积引出熔断降级</h3><p><strong>1.</strong> 一个服务常常会调用别的模块，可能是另外的一个远程服务、数据库，或者第三方 API 等。</p>
<p><strong>2.</strong> 例如，支付的时候，可能需要远程调用银联提供的 API;查询某个商品的价格，可能需 要进行数据库查询。然而，这个被依赖服务的稳定性是不能保证的。如果依赖的服务出现 了不稳定的情况，请求的响应时间变长，那么调用服务的方法的响应时间也会变长，线程会产生堆积，最终可能耗尽业务自身的线程池，服务本身也变得不可用</p>
<p><strong>3.</strong> 这时，我们<u>对不稳定的服务进行熔断降级，让其快速返回结果，不要造成线程堆积</u></p>
<h3 id="10-5-2-文档地址-https-sentinelguard-io-zh-cn-docs-circuit-breaking-html"><a href="#10-5-2-文档地址-https-sentinelguard-io-zh-cn-docs-circuit-breaking-html" class="headerlink" title="10.5.2 文档地址**: https://sentinelguard.io/zh-cn/docs/circuit-breaking.html**"></a><strong>10.5.2</strong> 文档地址**: <a target="_blank" rel="noopener" href="https://sentinelguard.io/zh-cn/docs/circuit-breaking.html">https://sentinelguard.io/zh-cn/docs/circuit-breaking.html</a>**</h3><h3 id="10-5-3-基本介绍"><a href="#10-5-3-基本介绍" class="headerlink" title="10.5.3 基本介绍"></a><strong>10.5.3</strong> 基本介绍</h3><p><strong>1.</strong> 一张图</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623223928543.png" alt="image-20230623223928543" style="zoom:50%;" />



<p><strong>2.</strong> <strong>解读上图</strong>:</p>
<ul>
<li><strong>现代微服务架构都是分布式的，由非常多的服务组成。不同服务之间相互调用，组成复杂的调用链路。</strong></li>
<li><strong>链路调用中会产生放大的效果。复杂链路上的某一环不稳定，就可能会层层级联，最终导致整个链路都不可用。</strong></li>
<li><strong>因此需要对不稳定的弱依赖服务调用进行熔断降级，暂时切断不稳定调用，避免局部不稳定因素导致整体的雪崩</strong></li>
</ul>
<p><strong>3.</strong> <strong>熔断,降级,限流三者的关系</strong></p>
<ul>
<li><p>熔断：强调的是服务之间的调用能实现自我恢复的状态 </p>
</li>
<li><p>限流：是从系统的流量入口考虑, 从进入的流量上进行限制**, **达到保护系统的作用</p>
</li>
<li><p>降级：是从系统业务的维度考虑，流量大了或者频繁异常, 可以牺牲一些非核心业务，保护核心流程正常使用</p>
</li>
</ul>
<p>-熔断是降级方式的一种</p>
<p>-降级又是限流的一种方式  </p>
<p>-三者都是为了通过一定的方式<strong>在流量过大或者出现异常时,保护系统的手段</strong></p>
<h3 id="10-5-4-熔断策略"><a href="#10-5-4-熔断策略" class="headerlink" title="10.5.4 熔断策略"></a><strong>10.5.4</strong> 熔断策略</h3><h4 id="10-5-4-1-慢调用比例"><a href="#10-5-4-1-慢调用比例" class="headerlink" title="10.5.4.1 慢调用比例"></a>10.5.4.1 慢调用比例</h4><p>1、慢调用比例 (SLOW_REQUEST_RATIO):选择以慢调用比例作为阈值，需要设置允许的慢调用 <strong>RT</strong>(即最大的响应时间)，<strong>请求的响应时间大于该值则统计为<u>慢调用</u></strong></p>
<p>2、当<strong>单位统计时长(statIntervalMs)内请求数目大于设置的最小请求数目</strong>，并且<strong>慢调用的<u>比例</u>大于阈值</strong>，则接下来的熔断时长内请求会自动被熔断</p>
<p>3、熔断时长后,熔断器会进入探测恢复状态(HALF-OPEN 状态)，若接下来的一个请求响应时间小于设置的慢调用RT则结束熔断，若大于设置的慢调用RT 则会再次被熔断</p>
<p>4、配置参考</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623225930567.png" alt="image-20230623225930567" style="zoom:33%;" />

<h4 id="10-5-4-2-异常比例"><a href="#10-5-4-2-异常比例" class="headerlink" title="10.5.4.2 异常比例"></a>10.5.4.2 异常比例</h4><p>1、异常比例 (ERROR_RATIO):当单位统计时长(statIntervalMs)内请求数目大于设置的最小请求数目，并且异常的比例大于阈值，则接下来的熔断时长内请求会自动被熔断</p>
<p>2、经过熔断时长后熔断器会进入探测恢复状态(HALF-OPEN状态) </p>
<p>3、若接下来的一个请求成功完成(没有错误)则结束熔断,否则会再次被熔断</p>
<p>4、异常比率的阈值范围是[0.0, 1.0]，代表0% - 100%</p>
<p>5、配置参考</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623230152696.png" alt="image-20230623230152696" style="zoom:33%;" />

<p>6、工作示意图</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623230238823.png" alt="image-20230623230238823" style="zoom:33%;" />

<h4 id="10-5-4-3-异常数"><a href="#10-5-4-3-异常数" class="headerlink" title="10.5.4.3 异常数"></a>10.5.4.3 异常数</h4><p>1、异常数 (ERROR_COUNT):<u>当单位统计时长内的异常数目超过阈值之后会自动进行熔断</u></p>
<p>2、经过熔断时长后熔断器会进入探测恢复状态(HALF-OPEN 状态) </p>
<p>3、若接下来的一个请求成功完成(没有错误)则结束熔断，否则会再次被熔断</p>
<p>4、配置参考</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623230424805.png" alt="image-20230623230424805" style="zoom:33%;" />

<h3 id="10-5-5-熔断降级实例-慢调用比例"><a href="#10-5-5-熔断降级实例-慢调用比例" class="headerlink" title="10.5.5 熔断降级实例**-**慢调用比例"></a><strong>10.5.5</strong> 熔断降级实例**-**慢调用比例</h3><h4 id="10-5-5-1-需求分析-x2F-图解"><a href="#10-5-5-1-需求分析-x2F-图解" class="headerlink" title="10.5.5.1 需求分析&#x2F;图解"></a>10.5.5.1 需求分析&#x2F;图解</h4><p><strong>1.</strong> 需求**:** 通过 <strong>Sentinel</strong> 实现 熔断降级控制**-**<u>慢调用比例</u></p>
<p><strong>2.</strong> <strong>当调用</strong> <strong>member-service-nacos-provider-10004</strong> <strong>的</strong> <strong>&#x2F;t3 API</strong> <strong>接口时，如果在</strong> <strong>1s</strong> <strong>内持续进入了</strong> <strong>5</strong> <strong>个请求，并且请求的平均响应时间超过</strong> <strong>200ms,</strong> <strong>那么就在未来</strong> <strong>10</strong> <strong>秒钟内，断路器打开</strong>, <strong>让</strong> <strong>&#x2F;t3 API</strong> <strong>接口微服务不可用</strong></p>
<p><strong>3.</strong> <strong>后面对</strong>&#x2F;t3 API <strong>接口访问降到</strong> <strong>1S</strong> <strong>内</strong> <strong>1</strong> <strong>个请求，降低访问量了，断路器关闭，微服务恢复</strong></p>
<h4 id="10-5-5-2-修改业务类"><a href="#10-5-5-2-修改业务类" class="headerlink" title="10.5.5.2 修改业务类"></a>10.5.5.2 修改业务类</h4><p><strong>1.</strong> 修改 <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong> 增加方法 <strong>t3()</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/t3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t3</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//模拟线程执行时间为1秒</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;熔断降级测试 执行 t3() 线程 id= &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;t3执行...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-5-5-3-配置实现步骤"><a href="#10-5-5-3-配置实现步骤" class="headerlink" title="10.5.5.3 配置实现步骤"></a>10.5.5.3 配置实现步骤</h4><p><strong>1.</strong> 为**&#x2F;t3** 增加降级规则</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623231431243.png" alt="image-20230623231431243" style="zoom:50%;" />

<p><strong>2.</strong> <strong>在流控规则菜单，可以看到新增的降级规则</strong></p>
<h4 id="10-5-5-4-测试"><a href="#10-5-5-4-测试" class="headerlink" title="10.5.5.4 测试"></a>10.5.5.4 测试</h4><h5 id="10-5-5-4-1-启动-Nacos-Server-8848"><a href="#10-5-5-4-1-启动-Nacos-Server-8848" class="headerlink" title="10.5.5.4.1 启动 Nacos Server 8848"></a><strong>10.5.5.4.1</strong> 启动 Nacos Server 8848</h5><h5 id="10-5-5-4-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard"><a href="#10-5-5-4-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.5.5.4.2 启动 Sentinel8080 控制台**&#x2F;Sentinel dashboard **"></a>10.5.5.4.2 启动 <strong>Sentinel8080</strong> 控制台**&#x2F;Sentinel dashboard **</h5><h5 id="10-5-5-4-3-启动-member-service-nacos-provider-10004"><a href="#10-5-5-4-3-启动-member-service-nacos-provider-10004" class="headerlink" title="10.5.5.4.3 启动 member-service-nacos-provider-10004"></a><strong>10.5.5.4.3</strong> 启动 <strong>member-service-nacos-provider-10004</strong></h5><h5 id="10-5-5-4-4-Postman测试"><a href="#10-5-5-4-4-Postman测试" class="headerlink" title="10.5.5.4.4 Postman测试"></a><strong>10.5.5.4.4 Postman</strong>测试</h5><p><strong>1.</strong> 先创建 <strong>collection ,</strong> 也可以在已经存在的 <strong>collection</strong> 进行修改</p>
<p>…………</p>
<h4 id="10-5-5-5-注意事项和细节"><a href="#10-5-5-5-注意事项和细节" class="headerlink" title="10.5.5.5 注意事项和细节"></a>10.5.5.5 注意事项和细节</h4><h5 id="10-5-5-5-1-平均响应时间超出阈值且在-1s-内通过的请求-gt-x3D-5-，-两个条件同时满足后触发降级"><a href="#10-5-5-5-1-平均响应时间超出阈值且在-1s-内通过的请求-gt-x3D-5-，-两个条件同时满足后触发降级" class="headerlink" title="10.5.5.5.1 平均响应时间超出阈值且在 1s 内通过的请求**&gt;&#x3D;5**， 两个条件同时满足后触发降级"></a>10.5.5.5.1 平均响应时间超出阈值且在 <strong>1s</strong> 内通过的请求**&gt;&#x3D;5**， 两个条件同时满足后触发降级</h5><h5 id="10-5-5-5-2-熔断时间过后，关闭断路器，访问恢复正常"><a href="#10-5-5-5-2-熔断时间过后，关闭断路器，访问恢复正常" class="headerlink" title="10.5.5.5.2 熔断时间过后，关闭断路器，访问恢复正常"></a>10.5.5.5.2 熔断时间过后，关闭断路器，访问恢复正常</h5><h3 id="10-5-6-熔断降级实例-异常比例"><a href="#10-5-6-熔断降级实例-异常比例" class="headerlink" title="10.5.6 熔断降级实例-异常比例"></a>10.5.6 熔断降级实例-异常比例</h3><h4 id="10-5-6-1-需求分析-x2F-图解"><a href="#10-5-6-1-需求分析-x2F-图解" class="headerlink" title="10.5.6.1 需求分析&#x2F;图解"></a>10.5.6.1 需求分析&#x2F;图解</h4><p><strong>1.</strong> 需求**:** 通过 <strong>Sentinel</strong> 实现 熔断降级控制</p>
<p><strong>2.</strong> 当调用 <strong>member-service-nacos-provider-10004</strong> 的 <strong>&#x2F;t4 API</strong> 接口时，当资源的每秒请求量**&gt;&#x3D;5<strong>，并且每秒异常总数占通过量的比值超过</strong>20%(<strong>即异常比例到</strong>20%),** 断路器打开**(<strong>即</strong>:** 进入降级状态**),** 让 <strong>&#x2F;t4 API</strong> 接口微服务不可用</p>
<p><strong>3.</strong> 当对**&#x2F;t4 API** 接口 访问降到 <strong>1S</strong> 内 <strong>1</strong> 个请求，降低访问量了，断路器关闭，<strong>5</strong> 秒后微服务恢复</p>
<h4 id="10-5-6-2-修改业务类"><a href="#10-5-6-2-修改业务类" class="headerlink" title="10.5.6.2 修改业务类"></a>10.5.6.2 修改业务类</h4><p><strong>1.</strong> 修改 <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong> 增加方法 <strong>t4()</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>; </span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/t4&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t4</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((++num) % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//异常比例 50% System.out.println(3 / 0);</span></span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;熔断降级测试【异常比例】 执行 t4() 线程 id= &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;t4()执行&quot;</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-5-6-3-配置实现步骤"><a href="#10-5-6-3-配置实现步骤" class="headerlink" title="10.5.6.3 配置实现步骤"></a>10.5.6.3 配置实现步骤</h4><p><strong>1.</strong> 为**&#x2F;t4** 增加降级规则</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624094738411.png" alt="image-20230624094738411" style="zoom:50%;" />

<p><strong>2.</strong> <strong>在流控规则菜单，可以看到新增的降级规则</strong></p>
<h4 id="10-5-6-4-测试"><a href="#10-5-6-4-测试" class="headerlink" title="10.5.6.4 测试"></a>10.5.6.4 测试</h4><h5 id="10-5-6-4-1-启动-Nacos-Server-8848"><a href="#10-5-6-4-1-启动-Nacos-Server-8848" class="headerlink" title="10.5.6.4.1 启动 Nacos Server 8848"></a>10.5.6.4.1 启动 Nacos Server 8848</h5><h5 id="10-5-6-4-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard"><a href="#10-5-6-4-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.5.6.4.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard"></a>10.5.6.4.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard</h5><h5 id="10-5-6-4-3-启动-member-service-nacos-provider-10004"><a href="#10-5-6-4-3-启动-member-service-nacos-provider-10004" class="headerlink" title="10.5.6.4.3 启动 member-service-nacos-provider-10004"></a>10.5.6.4.3 启动 member-service-nacos-provider-10004</h5><h5 id="10-5-6-4-4-Postman测试"><a href="#10-5-6-4-4-Postman测试" class="headerlink" title="10.5.6.4.4 Postman测试"></a>10.5.6.4.4 Postman测试</h5><p><strong>1.</strong> 先创建给 <strong>collection ,</strong> 也可以在已经存在的 <strong>collection</strong> 进行修改**,** 一定确保更新成功**.**</p>
<p><strong>2.</strong> <strong>点击</strong> <strong>Run sentinel</strong></p>
<p><strong>3.</strong> 浏览器访问: <a target="_blank" rel="noopener" href="http://localhost:10004/t4">http://localhost:10004/t4</a> 			出现 Blocked by Sentinel (flow limiting)</p>
<p><strong>4.</strong> <strong>停止</strong> <strong>Postman</strong></p>
<p><strong>5.</strong> 浏览器访问: <a target="_blank" rel="noopener" href="http://localhost:10004/t4">http://localhost:10004/t4</a> , 结果正常了(一次返回异常，一次返回正确结 果)</p>
<h4 id="10-5-7-5注意事项和细节"><a href="#10-5-7-5注意事项和细节" class="headerlink" title="10.5.7.5注意事项和细节"></a>10.5.7.5注意事项和细节</h4><h5 id="10-5-7-5-1-资源在-1-分钟的异常数目超过阈值之后会进行熔断降级"><a href="#10-5-7-5-1-资源在-1-分钟的异常数目超过阈值之后会进行熔断降级" class="headerlink" title="10.5.7.5.1 资源在 1 分钟的异常数目超过阈值之后会进行熔断降级"></a><strong>10.5.7.5.1</strong> 资源在 <strong>1</strong> 分钟的异常数目超过阈值之后会进行熔断降级</h5><p><strong>10.5.7.5.2</strong> 异常数统计是分钟级别的，若 设置的时间窗口 小于 <strong>60s</strong>，则结束熔断状态后仍可能再进入熔断状态**,** 测试时，最好将时间窗口设置超过 <strong>60S</strong></p>
<h2 id="10-6-Sentinel-热点规则"><a href="#10-6-Sentinel-热点规则" class="headerlink" title="10.6 Sentinel 热点规则"></a>10.6 Sentinel 热点规则</h2><h3 id="10-6-1-一个问题引出热点-key-限流"><a href="#10-6-1-一个问题引出热点-key-限流" class="headerlink" title="10.6.1 一个问题引出热点 key 限流"></a><strong>10.6.1</strong> 一个问题引出热点 <strong>key</strong> 限流</h3><p><strong>1.</strong> 热点**:** 热点即经常访问的数据。很多时候我们希望统计热点数据中**,** 访问频次最高的 <strong>Top K</strong> 数据，并对其访问进行限制。</p>
<p><strong>2.</strong> 比如某条新闻上热搜 ，在某段时间内高频访问， 为了防止系统雪崩**,** 可以对该条新闻进行热点限流</p>
<h3 id="10-6-2文档地址"><a href="#10-6-2文档地址" class="headerlink" title="10.6.2文档地址 :"></a>10.6.2文档地址 :</h3><p> <a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81">https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81</a></p>
<h3 id="10-6-3-基本介绍"><a href="#10-6-3-基本介绍" class="headerlink" title="10.6.3 基本介绍"></a><strong>10.6.3</strong> 基本介绍</h3><p><strong>1.</strong> 一张图<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624102921499.png" alt="image-20230624102921499"></p>
<p><strong>2.</strong> 解读上图:</p>
<ul>
<li><p>热点参数限流会统计传入参数中的热点参数，并根据配置的限流阈值与模式，对包含热点参数的资源调用进行限流。</p>
</li>
<li><p>热点参数限流可以看做是一种特殊的流量控制，仅对包含热点参数的资源调用生效</p>
</li>
<li><p>Sentinel 利用 LRU 策略统计最近最常访问的热点参数，结合令牌桶算法来进行参数级别的流控 <strong><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34416331/article/details/106668747">https://blog.csdn.net/qq_34416331/article/details/106668747</a></strong></p>
</li>
<li><p>热点参数限流支持集群模式</p>
</li>
</ul>
<h3 id="10-6-4-热点-Key-限流-实例"><a href="#10-6-4-热点-Key-限流-实例" class="headerlink" title="10.6.4 热点 Key 限流**-**实例"></a><strong>10.6.4</strong> 热点 <strong>Key</strong> 限流**-**实例</h3><h4 id="10-6-4-1-需求分析-x2F-图解"><a href="#10-6-4-1-需求分析-x2F-图解" class="headerlink" title="10.6.4.1 需求分析&#x2F;图解"></a>10.6.4.1 需求分析&#x2F;图解</h4><p> <strong>1.</strong> 需求**:** 通过 <strong>Sentinel</strong> 实现热点 <strong>Key</strong> 限流<br> <strong>2.</strong> 对 <strong>member-service-nacos-provider-10004</strong> 的 <strong>&#x2F;news?id&#x3D;x&amp;type&#x3D;x API</strong> 接口进行热点限流<br> <strong>3.</strong> 假定 <strong>id&#x3D;10</strong> 这一条新闻是当前的热点新闻， 当查询新闻时，对通常的 <strong>id(<strong>非热点新闻</strong>)<strong>请求 <strong>QPS</strong> 限定为 <strong>2,</strong> 如果 <strong>id&#x3D;10 QPS</strong> 限定为 <strong>100<br> 4.</strong> 如果访问超出了规定的 <strong>QPS,</strong> 触发热点限流机制</strong>,</strong> 调用自定义的方法，给出提示信息**. **</p>
<p> <strong>5.</strong> 当对 <strong>&#x2F;news?id&#x3D;x&amp;type&#x3D;x API</strong> 接口降低访问量，<strong>QPS</strong> 达到规定范围**,** 服务恢复</p>
<h4 id="10-6-4-2-修改业务类"><a href="#10-6-4-2-修改业务类" class="headerlink" title="10.6.4.2 修改业务类"></a>10.6.4.2 修改业务类</h4><p><strong>1.</strong> 修 改 <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong> 增 加 方 法 <strong>queryNews()</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 注意 <span class="doctag">@GetMapping</span> 是 url 带有 / , <span class="doctag">@SentinelResource</span> 的 value 是没有 /的</span></span><br><span class="line"><span class="comment"> * * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment"> * * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/news&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;news&quot;,blockHandler = &quot;newsBlockHandler&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryNews</span><span class="params">(<span class="meta">@RequestParam(value = &quot;id&quot;,required = false)</span> String id,</span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam(value = &quot;type&quot;,required = false)</span> String type)</span></span><br><span class="line">&#123;</span><br><span class="line">    log.info(<span class="string">&quot;到 DB 查询数据库.... &quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;返回 id= &quot;</span> + id + <span class="string">&quot; 新闻 fromDB&quot;</span>); &#125;</span><br><span class="line"><span class="comment">//热点 key 限制异常处理方法</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">newsBlockHandler</span><span class="params">(String id, String type, BlockException exception)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;查询 id= &quot;</span> + id</span><br><span class="line">            + <span class="string">&quot; 新闻 触发热点 key 限制保护.. sorry&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-6-4-3-测试"><a href="#10-6-4-3-测试" class="headerlink" title="10.6.4.3 测试"></a>10.6.4.3 测试</h4><h5 id="10-6-4-3-1-启动-Nacos-Server-8848"><a href="#10-6-4-3-1-启动-Nacos-Server-8848" class="headerlink" title="10.6.4.3.1 启动 Nacos Server 8848"></a><strong>10.6.4.3.1</strong> 启动 Nacos Server 8848</h5><h5 id="10-6-4-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard"><a href="#10-6-4-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.6.4.3.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard"></a>10.6.4.3.2 启动 <strong>Sentinel8080</strong> 控制台&#x2F;Sentinel dashboard</h5><h5 id="10-6-4-3-3-启动-member-service-nacos-provider-10004"><a href="#10-6-4-3-3-启动-member-service-nacos-provider-10004" class="headerlink" title="10.6.4.3.3 启动 member-service-nacos-provider-10004"></a>10.6.4.3.3 启动 member-service-nacos-provider-10004</h5><h5 id="10-6-4-3-4-配置实现步骤"><a href="#10-6-4-3-4-配置实现步骤" class="headerlink" title="10.6.4.3.4 配置实现步骤"></a>10.6.4.3.4 配置实现步骤</h5><p><strong>1.</strong> 为资源 <strong>news</strong> 增加热点规则**,** 注意不是 <strong>&#x2F;news</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624104344763.png" alt="image-20230624104344763"></p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624104402958.png" alt="image-20230624104402958" style="zoom: 33%;" />

<p><strong>2.</strong> <strong>在热点参数限流规则菜单，可以看到新增规则</strong></p>
<h5 id="10-6-4-3-5-浏览器-http-localhost-10004-news-id-1-amp-type-E6-95-99-E8-82-B2"><a href="#10-6-4-3-5-浏览器-http-localhost-10004-news-id-1-amp-type-E6-95-99-E8-82-B2" class="headerlink" title="10.6.4.3.5 浏览器**: http://localhost:10004/news?id=1&amp;type=%E6%95%99%E8%82%B2**"></a>10.6.4.3.5 浏览器**: <a target="_blank" rel="noopener" href="http://localhost:10004/news?id=1&type=%E6%95%99%E8%82%B2">http://localhost:10004/news?id=1&amp;type=%E6%95%99%E8%82%B2</a>**</h5><p>如果QPS没有超过2,则返回正确结果</p>
<p>如果QPS超过2,则返回热点key处理信息</p>
<h5 id="10-6-4-3-6-独立设置热点-id-x3D-10-的-QPS-阈值-即添加例外"><a href="#10-6-4-3-6-独立设置热点-id-x3D-10-的-QPS-阈值-即添加例外" class="headerlink" title="10.6.4.3.6 独立设置热点 id&#x3D;10 的 QPS 阈值(即添加例外)"></a>10.6.4.3.6 独立设置热点 id&#x3D;10 的 QPS 阈值(即添加例外)</h5><p><strong>1.</strong> 独立设置热点 <strong>id&#x3D;10</strong> 的 <strong>QPS</strong> 阈值**(<strong>即添加例外</strong>)**</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624104744651.png" alt="image-20230624104744651" style="zoom: 50%;" />

<h5 id="10-6-4-3-7-浏览器-http-localhost-10004-news-id-10-amp-type-E6-95-99-E8-82-B2"><a href="#10-6-4-3-7-浏览器-http-localhost-10004-news-id-10-amp-type-E6-95-99-E8-82-B2" class="headerlink" title="10.6.4.3.7 浏览器: http://localhost:10004/news?id=10&amp;type=%E6%95%99%E8%82%B2"></a>10.6.4.3.7 浏览器: <a target="_blank" rel="noopener" href="http://localhost:10004/news?id=10&type=%E6%95%99%E8%82%B2">http://localhost:10004/news?id=10&amp;type=%E6%95%99%E8%82%B2</a></h5><p><strong>1.</strong> 浏览器输入: <a target="_blank" rel="noopener" href="http://localhost:10004/news?id=10&type=%E6%95%99%E8%82%B2">http://localhost:10004/news?id=10&amp;type=%E6%95%99%E8%82%B2</a> , 如果QPS没有超过 100,则返回正确结果</p>
<p><strong>2.</strong> <strong>浏览器访问的</strong> <strong>id</strong> <strong>不是</strong>10 <strong>的，仍然遵守</strong> <strong>QPS</strong> <strong>不能超过</strong> <strong>2</strong> <strong>的热点限制</strong></p>
<h3 id="10-6-5-注意事项和细节"><a href="#10-6-5-注意事项和细节" class="headerlink" title="10.6.5 注意事项和细节"></a>10.6.5 注意事项和细节</h3><h4 id="10-6-5-1-热点参数类型是-byte-x2F-int-x2F-long-x2F-float-x2F-double-x2F-char-x2F-String"><a href="#10-6-5-1-热点参数类型是-byte-x2F-int-x2F-long-x2F-float-x2F-double-x2F-char-x2F-String" class="headerlink" title="10.6.5.1 热点参数类型是(byte&#x2F;int&#x2F;long&#x2F;float&#x2F;double&#x2F;char&#x2F;String)"></a>10.6.5.1 热点参数类型是(byte&#x2F;int&#x2F;long&#x2F;float&#x2F;double&#x2F;char&#x2F;String)</h4><h4 id="10-6-5-2-热点参数值，可以配置多个"><a href="#10-6-5-2-热点参数值，可以配置多个" class="headerlink" title="10.6.5.2 热点参数值，可以配置多个"></a>10.6.5.2 热点参数值，可以配置多个</h4><h4 id="10-6-5-3-热点规则只对指定的参数生效-比如本实例对-id-生效-对-type-不生效"><a href="#10-6-5-3-热点规则只对指定的参数生效-比如本实例对-id-生效-对-type-不生效" class="headerlink" title="10.6.5.3 热点规则只对指定的参数生效 (比如本实例对 id 生效, 对 type 不生效)"></a>10.6.5.3 热点规则只对指定的参数生效 (比如本实例对 id 生效, 对 type 不生效)</h4><h2 id="10-7-系统规则"><a href="#10-7-系统规则" class="headerlink" title="10.7 系统规则"></a>10.7 系统规则</h2><h3 id="10-7-1-一个问题引出系统规则"><a href="#10-7-1-一个问题引出系统规则" class="headerlink" title="10.7.1 一个问题引出系统规则"></a><strong>10.7.1</strong> 一个问题引出系统规则</h3><p>1.如我们系统最大性能能抗 100QPS，如何分配 &#x2F;t1 &#x2F;t2 的 QPS?</p>
<p><strong>方案1:</strong> &#x2F;t1 分配 QPS&#x3D;50；&#x2F;t2 分配 QPS&#x3D;50，问题，如果&#x2F;t1 当前 QPS 达到 50，而&#x2F;t2 的 QPS 才 10，会造成没有充分利用服务器性能</p>
<p><strong>方案2:</strong> &#x2F;t1 分配 QPS&#x3D;100 &#x2F;t2 分配 QPS&#x3D;100，问题，容易造成系统没有流量保护造成请求线程堆积，形成雪崩</p>
<p><u><strong>有没有对各个资源请求的QPS弹性设置，只要总数不超过系统最大QPS的流量保护规则?&#x3D;&gt; 系统规则</strong></u></p>
<h3 id="10-7-2文-档-地-址"><a href="#10-7-2文-档-地-址" class="headerlink" title="10.7.2文 档 地 址 :"></a><strong>10.7.2</strong>文 档 地 址 <strong>:</strong></h3><p><strong><a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81">https://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81</a></strong></p>
<h3 id="10-7-3-一句话-系统规则作用-在系统稳定的前提下，保持系统的吞吐量"><a href="#10-7-3-一句话-系统规则作用-在系统稳定的前提下，保持系统的吞吐量" class="headerlink" title="10.7.3 一句话**:** 系统规则作用**,** 在系统稳定的前提下，保持系统的吞吐量"></a><strong>10.7.3</strong> 一句话**:** 系统规则作用**,** 在系统稳定的前提下，保持系统的吞吐量</h3><h3 id="10-7-4-基本介绍"><a href="#10-7-4-基本介绍" class="headerlink" title="10.7.4 基本介绍"></a><strong>10.7.4</strong> 基本介绍</h3><p><strong>1.</strong> 一张图<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624105741809.png" alt="image-20230624105741809" style="zoom:50%;" /></p>
<p>**2.**解读上图:</p>
<p>系统处理请求的过程想象为一个水管，到来的请求是往这个水管灌水，当系统处理顺畅的时候，请求不需要排队，直接从水管中穿过，这个请求的RT是最短的，反之，当请求堆积的时候，那么处理请求的时间则会变为:排队时间 + 最短处理时间</p>
<p>**3.**系统规则(参考以下五种数据来判断系统是否超负荷)</p>
<ul>
<li><p>Load 自适应(仅对 Linux&#x2F;Unix-like 机器生效): 系统的 load1 作为启发指标，进行自适应系统保护。当系统 <u>load1 超过设定的启发值</u>，且<u>系统当前的并发线程数超过估算的系统容量</u>时才会触发系统保护(BBR 阶段)。系统容量由系统的 maxQps * minRt 估算得出。设定参考值一般是 CPU cores *2.5</p>
</li>
<li><p>CPU usage (1.5.0+ 版本): 当系统 CPU 使用率超过阈值即触发系统保护 (取值范围0.0-1.0)，比较灵敏。</p>
</li>
<li><p>平均 RT: 当单台机器上所有入口流量的平均 RT 达到阈值即触发系统保护，单位是毫秒。</p>
</li>
<li><p>并发线程数:当单台机器上所有入口流量的并发线程数达到阈值即触发系统保护。</p>
</li>
<li><p>入口 QPS:当单台机器上所有入口流量的 QPS 达到阈值即触发系统保护。</p>
</li>
</ul>
<h3 id="10-7-5-实例"><a href="#10-7-5-实例" class="headerlink" title="10.7.5 实例"></a><strong>10.7.5</strong> 实例</h3><h4 id="10-7-5-1-需求分析-x2F-图解"><a href="#10-7-5-1-需求分析-x2F-图解" class="headerlink" title="10.7.5.1 需求分析&#x2F;图解"></a>10.7.5.1 需求分析&#x2F;图解</h4><p><strong>1.<strong>需求</strong>:</strong> 通过 <strong>Sentinel</strong> 实现 系统规则**-**入口 <strong>QPS</strong></p>
<p><strong>2.<strong>对 <strong>member-service-nacos-provider-10004</strong> 的 所有 <strong>API</strong> 接口进行流量保护，不管访问哪个 <strong>API</strong> 接口</strong>,</strong> 系统入口总的 <strong>QPS</strong> 不能大于 <strong>2,</strong> 大于 <strong>2</strong>，就进行限流控制 </p>
<p><strong>3.</strong> 提示**:** 上面的 <strong>QPS</strong> 是为了方便看效果**,** 设置的很小</p>
<h4 id="10-7-5-2-配置实现步骤"><a href="#10-7-5-2-配置实现步骤" class="headerlink" title="10.7.5.2 配置实现步骤"></a>10.7.5.2 配置实现步骤</h4><p><strong>1.</strong> 增加入口 <strong>QPS</strong> 系统规则</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624110601568.png" alt="image-20230624110601568"></p>
<h4 id="10-7-5-3-测试"><a href="#10-7-5-3-测试" class="headerlink" title="10.7.5.3 测试"></a>10.7.5.3 测试</h4><h5 id="10-7-5-3-1-启动-Nacos-Server-8848"><a href="#10-7-5-3-1-启动-Nacos-Server-8848" class="headerlink" title="10.7.5.3.1 启动 Nacos Server 8848"></a>10.7.5.3.1 启动 Nacos Server 8848</h5><h5 id="10-7-5-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard"><a href="#10-7-5-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.7.5.3.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard"></a>10.7.5.3.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard</h5><h5 id="10-7-5-3-3-启动-member-service-nacos-provider-10004"><a href="#10-7-5-3-3-启动-member-service-nacos-provider-10004" class="headerlink" title="10.7.5.3.3 启动 member-service-nacos-provider-10004"></a>10.7.5.3.3 启动 member-service-nacos-provider-10004</h5><h5 id="10-7-5-3-4-浏览器-http-localhost-10004-t1"><a href="#10-7-5-3-4-浏览器-http-localhost-10004-t1" class="headerlink" title="10.7.5.3.4 浏览器: http://localhost:10004/t1"></a>10.7.5.3.4 浏览器: <a target="_blank" rel="noopener" href="http://localhost:10004/t1">http://localhost:10004/t1</a></h5><p><strong>1.</strong> 浏览器输入**: <a target="_blank" rel="noopener" href="http://localhost:10004/t1">http://localhost:10004/t1</a> ,** 如果 <strong>QPS</strong> 超过 <strong>2,</strong> 打开断路器，返回流控信息</p>
<p><strong>2.</strong> 浏览器输入: <a target="_blank" rel="noopener" href="http://localhost:10004/news?id=1&type=%E6%95%99%E8%82%B2">http://localhost:10004/news?id=1&amp;type=%E6%95%99%E8%82%B2</a> , 如果QPS 超过2, 打开断路器，返回流控信息(说明: 项目的 &#x2F;t2 资源对应方法有休眠代码，所以使用 &#x2F;news?id&#x3D;x&amp;type&#x3D;x 测试)</p>
<h2 id="10-8-SentinelResource"><a href="#10-8-SentinelResource" class="headerlink" title="10.8 @SentinelResource"></a>10.8 @SentinelResource</h2><h3 id="10-8-1-自定义全局限流处理类"><a href="#10-8-1-自定义全局限流处理类" class="headerlink" title="10.8.1 自定义全局限流处理类"></a><strong>10.8.1</strong> 自定义全局限流处理类</h3><h4 id="10-8-1-1-需求分析-x2F-图解"><a href="#10-8-1-1-需求分析-x2F-图解" class="headerlink" title="10.8.1.1 需求分析&#x2F;图解"></a>10.8.1.1 需求分析&#x2F;图解</h4><p><strong>1.</strong> 先看前面的一段代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/news&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;news&quot;,blockHandler = &quot;newsBlockHandler&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryNews</span><span class="params">(<span class="meta">@RequestParam(value = &quot;id&quot;,required = false)</span> String id,</span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam(value = &quot;type&quot;,required = false)</span> String type)</span></span><br><span class="line">&#123;</span><br><span class="line">    log.info(<span class="string">&quot;到 DB 查询数据库.... &quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;返回 id= &quot;</span> + id + <span class="string">&quot; 新闻 fromDB&quot;</span>); &#125;</span><br><span class="line"><span class="comment">//热点 key 限制异常处理方法</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">newsBlockHandler</span><span class="params">(String id, String type, BlockException exception)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;查询 id= &quot;</span> + id</span><br><span class="line">            + <span class="string">&quot; 新闻 触发热点 key 限制保护.. sorry&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong>: <strong>当配置的资源名</strong> news <strong>触发限流机制时，会调用</strong> newsBlockHandler <strong>方法</strong></p>
<p><strong>2.</strong> <strong>上面的处理方案存在一些问题</strong></p>
<ul>
<li><p><strong>每个</strong>@SentinelResource <strong>对应一个异常处理方法，会造成方法很多</strong> </p>
</li>
<li><p>异常处理方法和资源请求方法在一起，不利于业务逻辑的分离</p>
</li>
</ul>
<ul>
<li><strong>解决方案</strong>-&gt; 自定义全局限流处理类</li>
</ul>
<p><strong>3.</strong> <strong>需求</strong>: <strong>请编写一个自定义全局限流处理类，完成对异常处理</strong>.</p>
<h4 id="10-8-1-2-代码实现"><a href="#10-8-1-2-代码实现" class="headerlink" title="10.8.1.2 代码实现"></a>10.8.1.2 代码实现</h4><p><strong>1.</strong> 修改 <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong> 增加方法 <strong>t6()</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解读：</span></span><br><span class="line"><span class="comment"> * value = &quot;t6&quot;: SentinelResource 资源名</span></span><br><span class="line"><span class="comment"> * blockHandlerClass = CustomGlobalBlockHandler.class: 全局限流处理类 * blockHandler = &quot;handlerMethod1&quot;: 全局限流处理类的哪个方法,可以指定. */</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/t6&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(</span></span><br><span class="line"><span class="meta">        value = &quot;t6&quot;,</span></span><br><span class="line"><span class="meta">        blockHandlerClass = CustomGlobalBlockHandler.class, blockHandler = &quot;handlerMethod1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t6</span><span class="params">()</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;执行 t6() 线程 id= &quot;</span> + Thread.currentThread().getId()); <span class="keyword">return</span> Result.success(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;t6()执行成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> <strong>创建</strong> com&#x2F;hspedu&#x2F;springcloud&#x2F;handler&#x2F;CustomGlobalBlockHandler.java </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.BlockException;</span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Result;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 浦原</span></span><br><span class="line"><span class="comment"> * 2023/6/24</span></span><br><span class="line"><span class="comment"> * 13:54</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * 创建的异常处理方法需要是 static</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomGlobalBlockHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">handlerMethod1</span> <span class="params">(BlockException exception)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;400&quot;</span>, <span class="string">&quot;客户自定义异常处理 handlerm1()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">handlerMethod2</span> <span class="params">(BlockException exception)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;401&quot;</span>, <span class="string">&quot;客户自定义异常处理 handlerm2()&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-8-1-3-配置实现步骤"><a href="#10-8-1-3-配置实现步骤" class="headerlink" title="10.8.1.3 配置实现步骤"></a>10.8.1.3 配置实现步骤</h4><p><strong>1.</strong> 为资源 <strong>&#x2F;t6</strong> 增加流控规则**,**方便测试</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624135913223.png" alt="image-20230624135913223" style="zoom:50%;" />

<p><strong>2.</strong> <strong>在流控规则菜单，可以看到新增规则</strong></p>
<h4 id="10-8-1-4-测试"><a href="#10-8-1-4-测试" class="headerlink" title="10.8.1.4 测试"></a>10.8.1.4 测试</h4><h5 id="10-8-1-4-1-启动-Nacos-Server-8848"><a href="#10-8-1-4-1-启动-Nacos-Server-8848" class="headerlink" title="10.8.1.4.1 启动 Nacos Server 8848"></a><strong>10.8.1.4.1</strong> 启动 Nacos Server 8848</h5><h5 id="10-8-1-4-2-启动-Sentinel8080控制台-x2F-Sentinel-dashboard"><a href="#10-8-1-4-2-启动-Sentinel8080控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.8.1.4.2 启动 Sentinel8080控制台&#x2F;Sentinel dashboard"></a>10.8.1.4.2 启动 Sentinel8080控制台&#x2F;Sentinel dashboard</h5><h5 id="10-8-1-4-3-启动-member-service-nacos-provider-10004"><a href="#10-8-1-4-3-启动-member-service-nacos-provider-10004" class="headerlink" title="10.8.1.4.3 启动 member-service-nacos-provider-10004"></a>10.8.1.4.3 启动 member-service-nacos-provider-10004</h5><h5 id="10-8-1-4-4-浏览器-http-localhost-10004-t6"><a href="#10-8-1-4-4-浏览器-http-localhost-10004-t6" class="headerlink" title="10.8.1.4.4 浏览器: http://localhost:10004/t6"></a>10.8.1.4.4 浏览器: <a target="_blank" rel="noopener" href="http://localhost:10004/t6">http://localhost:10004/t6</a></h5><p><strong>1.</strong> 浏览器输入**: <a target="_blank" rel="noopener" href="http://localhost:10004/t6">http://localhost:10004/t6</a> ,** 如果 <strong>QPS</strong> 没有超过 <strong>1,</strong> 返回正常结果</p>
<p><strong>2.</strong> 浏览器输入: <a target="_blank" rel="noopener" href="http://localhost:10004/t6">http://localhost:10004/t6</a> ,如果QPS 超过 1, 断路器打开，返回自定义限流处理方法信息</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624140131429.png" alt="image-20230624140131429" style="zoom:50%;" />



<h3 id="10-8-2-fallback自定义程序错误处理"><a href="#10-8-2-fallback自定义程序错误处理" class="headerlink" title="10.8.2 fallback	自定义程序错误处理"></a>10.8.2 fallback	自定义程序错误处理</h3><h4 id="10-8-2-1-看一段代码-引出-fallback"><a href="#10-8-2-1-看一段代码-引出-fallback" class="headerlink" title="10.8.2.1 看一段代码-引出 fallback"></a>10.8.2.1 看一段代码-引出 fallback</h4><p><strong>1.</strong> 修 改 <strong>member-service-nacos-provider-10004</strong> 的<strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong> 增加一段代码**.**</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/t6&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(</span></span><br><span class="line"><span class="meta">        value = &quot;t6&quot;,</span></span><br><span class="line"><span class="meta">        blockHandlerClass = CustomGlobalBlockHandler.class, blockHandler = &quot;handlerMethod1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t6</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//假定: 当访问 t6 资源次数是 5 的倍数时，就出现了一个 java 的异常</span></span><br><span class="line">    <span class="keyword">if</span> (++num % <span class="number">5</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;num 的值异常 num= &quot;</span> + num); &#125;</span><br><span class="line">        log.info(<span class="string">&quot;执行 t6() 线程 id= &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;t6()执行成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> 浏览器: <a target="_blank" rel="noopener" href="http://localhost:10004/t6">http://localhost:10004/t6</a> , 看效果当num为 5的整数时，返回的是error页面，不友好.</p>
<p><strong>3.</strong> 怎么解决&#x3D;&gt; 使用 fallback</p>
<h4 id="10-8-2-2-基本介绍"><a href="#10-8-2-2-基本介绍" class="headerlink" title="10.8.2.2 基本介绍"></a>10.8.2.2 基本介绍</h4><h5 id="10-8-2-2-1-blockHandler只负责sentinel控制台配置违规"><a href="#10-8-2-2-1-blockHandler只负责sentinel控制台配置违规" class="headerlink" title="10.8.2.2.1 blockHandler只负责sentinel控制台配置违规"></a>10.8.2.2.1 blockHandler只负责sentinel控制台配置违规</h5><h5 id="10-8-2-2-2-fallback负责Java异常-x2F-业务异常"><a href="#10-8-2-2-2-fallback负责Java异常-x2F-业务异常" class="headerlink" title="10.8.2.2.2 fallback负责Java异常&#x2F;业务异常"></a>10.8.2.2.2 fallback<strong>负责</strong>Java<strong>异常</strong>&#x2F;业务异常</h5><h4 id="10-8-2-3-需求分析-x2F-图解"><a href="#10-8-2-3-需求分析-x2F-图解" class="headerlink" title="10.8.2.3 需求分析&#x2F;图解"></a>10.8.2.3 需求分析&#x2F;图解</h4><p><strong>1.</strong> 需求**:** 请编写一个自定义全局 <strong>fallback</strong> 处理类**,** 处理 <strong>java</strong> 异常**&#x2F;**业务异常 </p>
<p><strong>2.</strong> 也就是解决前面我们提出的问题</p>
<h4 id="10-8-2-4-代码实现"><a href="#10-8-2-4-代码实现" class="headerlink" title="10.8.2.4 代码实现"></a>10.8.2.4 代码实现</h4><p><strong>1.</strong> 在 <strong>member-service-nacos-provider-10004</strong> 创建<strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;handler&#x2F;CustomGlobalFallbackHandler.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomGlobalFallbackHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">fallBackHandlerMethod1</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;400&quot;</span>, <span class="string">&quot;java 异常信息= &quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">fallBackHandlerMethod2</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;401&quot;</span>, <span class="string">&quot;java 异常信息= &quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.<strong>在 member-service-nacos-provider-10004修改</strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解读</span></span><br><span class="line"><span class="comment"> * value = &quot;t6&quot;: SentinelResource 资源名</span></span><br><span class="line"><span class="comment"> * blockHandlerClass = CustomGlobalBlockHandler.class: 全局限流处理类 * blockHandler = &quot;handlerMethod1&quot;: 全局限流处理类的哪个方法,可以指定. */</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/t6&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(</span></span><br><span class="line"><span class="meta">        value = &quot;t6&quot;,</span></span><br><span class="line"><span class="meta">        fallbackClass = CustomGlobalFallbackHandler.class,</span></span><br><span class="line"><span class="meta">        fallback = &quot;fallBackHandlerMethod1&quot;,</span></span><br><span class="line"><span class="meta">        blockHandlerClass = CustomGlobalBlockHandler.class,</span></span><br><span class="line"><span class="meta">        blockHandler = &quot;handlerMethod1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t6</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//假定: 当访问 t6 资源次数是 5 的倍数时，就出现了一个 java 的异常</span></span><br><span class="line">    <span class="keyword">if</span> (++num % <span class="number">5</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;num 的值异常 num= &quot;</span> + num); &#125;</span><br><span class="line">        log.info(<span class="string">&quot;执行 t6() 线程 id= &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;t6()执行成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-8-2-5-测试"><a href="#10-8-2-5-测试" class="headerlink" title="10.8.2.5 测试"></a>10.8.2.5 测试</h4><h5 id="10-8-2-5-1-启动-Nacos-Server-8848"><a href="#10-8-2-5-1-启动-Nacos-Server-8848" class="headerlink" title="10.8.2.5.1 启动 Nacos Server 8848"></a>10.8.2.5.1 启动 Nacos Server 8848</h5><h5 id="10-8-2-5-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard"><a href="#10-8-2-5-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.8.2.5.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard"></a>10.8.2.5.2 启动 <strong>Sentinel8080</strong> 控制台&#x2F;Sentinel dashboard</h5><h5 id="10-8-2-5-3-启动-member-service-nacos-provider-10004"><a href="#10-8-2-5-3-启动-member-service-nacos-provider-10004" class="headerlink" title="10.8.2.5.3 启动 member-service-nacos-provider-10004"></a>10.8.2.5.3 启动 member-service-nacos-provider-10004</h5><h5 id="10-8-2-5-4-浏览器-http-localhost-10004-t6"><a href="#10-8-2-5-4-浏览器-http-localhost-10004-t6" class="headerlink" title="10.8.2.5.4 浏览器: http://localhost:10004/t6"></a>10.8.2.5.4 浏览器: <a target="_blank" rel="noopener" href="http://localhost:10004/t6">http://localhost:10004/t6</a></h5><p><strong>1.</strong> 浏览器输入**: <a target="_blank" rel="noopener" href="http://localhost:10004/t6">http://localhost:10004/t6</a> ,** 访问次数不是 <strong>5</strong> 的倍数**,** 返回正常结果</p>
<p><strong>2.</strong> 浏览器输入: <a target="_blank" rel="noopener" href="http://localhost:10004/t6">http://localhost:10004/t6</a> , 访问次数是 5 的倍数, 返回 fallback指定方法信息</p>
<p><strong>3.</strong> <strong>为资源</strong> <strong>&#x2F;t6</strong> <strong>增加流控规则</strong>,方便测试</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624142029799.png" alt="image-20230624142029799" style="zoom:50%;" />

<p><strong>4.</strong> <strong>在流控规则菜单，可以看到新增规则</strong></p>
<p><strong>5.</strong> 浏览器输入: <a target="_blank" rel="noopener" href="http://localhost:10004/t6">http://localhost:10004/t6</a> , <strong>如果访问 QPS 大于1 , 由blockHandler指定的方法处理,访问次数是 5 的倍数, 由fallback指定方法处理,其它情况返回正常的结果.</strong></p>
<h3 id="10-8-3-exceptionsToIgnore-希望忽略某个异常"><a href="#10-8-3-exceptionsToIgnore-希望忽略某个异常" class="headerlink" title="10.8.3 exceptionsToIgnore  希望忽略某个异常"></a>10.8.3 exceptionsToIgnore  希望忽略某个异常</h3><h4 id="10-8-3-1-如果希望忽略某个异常，可以使用-exceptionsToIgnore"><a href="#10-8-3-1-如果希望忽略某个异常，可以使用-exceptionsToIgnore" class="headerlink" title="10.8.3.1 如果希望忽略某个异常，可以使用 exceptionsToIgnore"></a>10.8.3.1 如果希望忽略某个异常，可以使用 exceptionsToIgnore</h4><h4 id="10-8-3-2-应用实例"><a href="#10-8-3-2-应用实例" class="headerlink" title="10.8.3.2 应用实例"></a>10.8.3.2 应用实例</h4><p><strong>1.</strong> 如果希望忽略某个异常**(<strong>支持数组</strong>)**，可以使用 <strong>exceptionsToIgnore</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/t6&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(</span></span><br><span class="line"><span class="meta">        value = &quot;t6&quot;,</span></span><br><span class="line"><span class="meta">        fallbackClass = CustomGlobalFallbackHandler.class,</span></span><br><span class="line"><span class="meta">        fallback = &quot;fallBackHandlerMethod1&quot;,</span></span><br><span class="line"><span class="meta">        blockHandlerClass = CustomGlobalBlockHandler.class,</span></span><br><span class="line"><span class="meta">        blockHandler = &quot;handlerMethod1&quot;,</span></span><br><span class="line"><span class="meta">        exceptionsToIgnore = &#123;RuntimeException.class&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t6</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//假定: 当访问 t6 资源次数是 5 的倍数时，就出现了一个 java 的异常</span></span><br><span class="line">    <span class="keyword">if</span> (++num % <span class="number">5</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;num 的值异常 num= &quot;</span> + num);</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;执行 t6() 线程 id= &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;t6()执行成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> 浏览器输入: <a target="_blank" rel="noopener" href="http://localhost:10004/t6">http://localhost:10004/t6</a> , 你会发现访问次数为 5 的倍数时，不再调用 fallback 指定方法处理</p>
<p>​	而是使用RuntimeException.class中的方式(即默认方式)处理</p>
<h3 id="10-8-4-接入-Sentinel-的方式"><a href="#10-8-4-接入-Sentinel-的方式" class="headerlink" title="10.8.4 接入 Sentinel 的方式"></a>10.8.4 接入 Sentinel 的方式</h3><p><u>即(不进入sentinel控制台网页而使用sentinel)</u></p>
<h4 id="10-8-4-1-代码方式-硬编码，侵入性强-不推荐"><a href="#10-8-4-1-代码方式-硬编码，侵入性强-不推荐" class="headerlink" title="10.8.4.1 代码方式(硬编码，侵入性强, 不推荐)"></a>10.8.4.1 代码方式(硬编码，侵入性强, 不推荐)</h4><p><strong>1.</strong> 文档地址**:** <strong><a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D">https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D</a></strong></p>
<p><strong>2.</strong> 基本使用</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230629202935657.png" alt="image-20230629202935657" style="zoom:50%;" />

<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230629203105770.png" alt="image-20230629203105770"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230629203336858.png" alt="image-20230629203336858"></p>
<h4 id="10-8-4-2-注解方式-低侵入性-前面用过-推荐"><a href="#10-8-4-2-注解方式-低侵入性-前面用过-推荐" class="headerlink" title="10.8.4.2 注解方式(低侵入性, 前面用过, 推荐)"></a>10.8.4.2 注解方式(低侵入性, 前面用过, 推荐)</h4><p><strong>1.</strong> 注解方式埋点不支持 <strong>private</strong> 方法</p>
<p><a target="_blank" rel="noopener" href="https://xue.baidu.com/okam/pages/strategy-tp/index?strategyId=136707206360879&source=natural">https://xue.baidu.com/okam/pages/strategy-tp/index?strategyId=136707206360879&amp;source=natural</a></p>
<p><strong>2.</strong> @SentinelResource 用于定义资源，并提供可选的异常处理和fallback配置项。</p>
<p><strong>3. @SentinelResource</strong> <strong>注解包含以下属性</strong>(我们再梳理一下)</p>
<ul>
<li><p><strong>value</strong>:资源名称，必需项(不能为空)</p>
</li>
<li><p><strong>entryType</strong>:entry 类型，可选项(默认为EntryType.OUT)</p>
</li>
<li><p><strong>blockHandler &#x2F; blockHandlerClass</strong>: blockHandler <strong>对应处理</strong> <strong>BlockException</strong> 的函数名称，可选项blockHandler<u>函数访问范围需要是public</u>，返回类型需要与原方法相匹配，参数类型需要和原方法相匹配并且最后加一个额外的参数，类型为BlockException。blockHandler 函数默认需要和原方法在同一个类中。若希望使用其 他类的函数，则可以指定blockHandlerClass为对应的类的Class对象，注意对应的函数必需为 static 函数，否则无法解析。</p>
</li>
<li><p><strong>fallback &#x2F; fallbackClass</strong>:fallback 函数名称，可选项，<u>用于在抛出异常的时候提供fallback处理逻辑</u>。fallback函数可以针对所有类型的异常(除了exceptionsToIgnore里面排除掉的异常类型)进行处理。fallback 函数签名和位置要求:</p>
</li>
</ul>
<ol>
<li>返回值类型必须与原函数返回值类型一致;</li>
<li>方法参数列表需要和原函数一致，或者可以额外多一个Throwable类型的参数用于接收对应的异常。</li>
<li>fallback函数默认需要和原方法在同一个类中。若希望使用其他类的函数，则可以指定<u>fallbackClass</u>为对应的类的Class对象，注意对应的函数必需为static函数，否则无法解析。</li>
</ol>
<ul>
<li><strong>defaultFallback(since 1.6.0</strong>):默认的 fallback函数名称，可选项，通常用于通用的fallback逻辑(即可以用于很多服务或方法)。默认fallback函数可以针对所有类型 的异常(除了exceptionsToIgnore里面排除掉的异常类型)进行处理。若同时配置了fallback和defaultFallback，则只有fallback会生效。defaultFallback 函数签名要求:</li>
</ul>
<ol>
<li>返回值类型必须与原函数返回值类型一致;</li>
<li>方法参数列表需要为空，或者可以额外多一个Throwable类型的参数用于接收对应的异常。</li>
<li>defaultFallback函数默认需要和原方法在同一个类中。若希望使用其他类的函数， 则可以指定fallbackClass为对应的类的Class对象，注意对应的函数必需为static函数，否则无法解析。</li>
</ol>
<ul>
<li>exceptionsToIgnore(since 1.6.0)：用于指定哪些异常被排除掉，不会进入异常统计中，也不会进入fallback逻辑中，而是会原样抛出。</li>
</ul>
<h2 id="10-9-openFeign-sentinel-对远程调用熔断降级"><a href="#10-9-openFeign-sentinel-对远程调用熔断降级" class="headerlink" title="10.9 openFeign+sentinel 对远程调用熔断降级"></a>10.9 openFeign+sentinel 对远程调用熔断降级</h2><h3 id="10-9-1-当前微服务基础环境"><a href="#10-9-1-当前微服务基础环境" class="headerlink" title="10.9.1 当前微服务基础环境"></a><strong>10.9.1</strong> 当前微服务基础环境</h3><h4 id="10-9-1-1-当前微服务环境架构图"><a href="#10-9-1-1-当前微服务环境架构图" class="headerlink" title="10.9.1.1 当前微服务环境架构图"></a>10.9.1.1 当前微服务环境架构图</h4><p>– 示意图</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230629205804092.png" alt="image-20230629205804092"></p>
<h4 id="10-9-1-2-测试"><a href="#10-9-1-2-测试" class="headerlink" title="10.9.1.2 测试"></a>10.9.1.2 测试</h4><h5 id="10-9-1-2-1-启动-Nacos-Server-8848"><a href="#10-9-1-2-1-启动-Nacos-Server-8848" class="headerlink" title="10.9.1.2.1 启动 Nacos Server 8848"></a>10.9.1.2.1 启动 Nacos Server 8848</h5><h5 id="10-9-1-2-2-启动-member-service-nacos-provider-10004-x2F-10006"><a href="#10-9-1-2-2-启动-member-service-nacos-provider-10004-x2F-10006" class="headerlink" title="10.9.1.2.2 启动 member-service-nacos-provider-10004&#x2F;10006"></a>10.9.1.2.2 启动 member-service-nacos-provider-10004&#x2F;10006</h5><h5 id="10-9-1-2-3-启动-member-service-nacos-consumer-80"><a href="#10-9-1-2-3-启动-member-service-nacos-consumer-80" class="headerlink" title="10.9.1.2.3 启动 member-service-nacos-consumer-80"></a>10.9.1.2.3 启动 member-service-nacos-consumer-80</h5><h5 id="10-9-1-2-4-浏览器-http-localhost-member-nacos-consumer-get-1"><a href="#10-9-1-2-4-浏览器-http-localhost-member-nacos-consumer-get-1" class="headerlink" title="10.9.1.2.4 浏览器**: http://localhost/member/nacos/consumer/get/1**"></a>10.9.1.2.4 浏览器**: <a target="_blank" rel="noopener" href="http://localhost/member/nacos/consumer/get/1">http://localhost/member/nacos/consumer/get/1</a>**</h5><p><strong>1.</strong> 浏 览 器 输 入 <strong>: <a target="_blank" rel="noopener" href="http://localhost/member/nacos/consumer/get/1">http://localhost/member/nacos/consumer/get/1</a> ,</strong> 目 前 是 <strong>Ribbon+RestTemplate</strong></p>
<h3 id="10-9-2-服务消费者整合-Openfeign"><a href="#10-9-2-服务消费者整合-Openfeign" class="headerlink" title="10.9.2 服务消费者整合 Openfeign"></a><strong>10.9.2</strong> 服务消费者整合 Openfeign</h3><p><strong>1.</strong> 需求:在 <strong>member-service-nacos-consumer-80</strong> 整合 <strong>Openfeign</strong> 实现远程调用</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230629210226986.png" alt="image-20230629210226986"></p>
<h4 id="10-9-2-2-代码-配置实现步骤"><a href="#10-9-2-2-代码-配置实现步骤" class="headerlink" title="10.9.2.2 代码+配置实现步骤"></a>10.9.2.2 代码+配置实现步骤</h4><p><strong>1.</strong> 修改 <strong>member-service-nacos-consumer-80</strong> 的 <strong>pom.xml</strong> 加入 <strong>openfeign</strong> 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    引入openfeign-start，即场景启动器    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> <strong>在</strong> <strong>member-service-nacos-consumer-80</strong> <strong>创 建</strong>com&#x2F;study&#x2F;springcloud&#x2F;service&#x2F;MemberOpenFeignService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Member;</span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Result;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 浦原</span></span><br><span class="line"><span class="comment"> * 2023/6/29</span></span><br><span class="line"><span class="comment"> * 21:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;member-service-nacos-provider&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MemberOpenFeignService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 老韩解读</span></span><br><span class="line"><span class="comment">     * 1. 远程调用的方式为 get</span></span><br><span class="line"><span class="comment">     * 2. 远程调用的 url 为 http://member-service-nacos-provider/member/get/&#123;id&#125;</span></span><br><span class="line"><span class="comment">     * 3. member-service-nacos-provider 是 nacos 注册中心服务 member-service-nacos-provider:10004/10006 </span></span><br><span class="line"><span class="comment">     * 4. 会根据 OpenFeign 的均衡算法来决定是调用 10004 还是 10006</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/member/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Member&gt; <span class="title function_">getMembertById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.</strong> <strong>在</strong> <strong>member-service-nacos-consumer-80</strong> <strong>修改</strong> <strong>com&#x2F;study&#x2F;springcloud&#x2F;controller&#x2F;MemberNacosConsumerController.java</strong> 增加方法getMemberOpenfeignById()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/member/openfeign/consumer/get/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;Member&gt; <span class="title function_">getMemberOpenfeignById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//这里使用 Openfeign 接口方式远程调用服务</span></span><br><span class="line">    System.out.println(<span class="string">&quot;通过 openfeignd+负载均衡 调用服务&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> memberOpenFeignService.getMemberById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4.</strong> <strong>再在</strong> <strong>member-service-nacos-consumer-80</strong> <strong>的主启动类加入注解</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;MemberNacosConsumerApplication80.java</strong></p>
<p>「@EnableFeignClients」</p>
<h4 id="10-9-2-3-测试"><a href="#10-9-2-3-测试" class="headerlink" title="10.9.2.3 测试"></a>10.9.2.3 测试</h4><h5 id="10-9-2-3-1-启动-Nacos-Server-8848"><a href="#10-9-2-3-1-启动-Nacos-Server-8848" class="headerlink" title="10.9.2.3.1 启动 Nacos Server 8848"></a>10.9.2.3.1 启动 Nacos Server 8848</h5><h5 id="10-9-2-3-2-启动-member-service-nacos-provider-10004-x2F-10006"><a href="#10-9-2-3-2-启动-member-service-nacos-provider-10004-x2F-10006" class="headerlink" title="10.9.2.3.2 启动 **member-service-nacos-provider-10004&#x2F;10006 **"></a>10.9.2.3.2 启动 **member-service-nacos-provider-10004&#x2F;10006 **</h5><h5 id="10-9-2-3-3-启动-member-service-nacos-consumer-80"><a href="#10-9-2-3-3-启动-member-service-nacos-consumer-80" class="headerlink" title="10.9.2.3.3 启动 member-service-nacos-consumer-80"></a><strong>10.9.2.3.3</strong> 启动 member-service-nacos-consumer-80</h5><h5 id="10-9-2-3-4-浏览器-http-localhost-member-openfeign-consumer-get-1"><a href="#10-9-2-3-4-浏览器-http-localhost-member-openfeign-consumer-get-1" class="headerlink" title="10.9.2.3.4 浏览器**: http://localhost/member/openfeign/consumer/get/1**"></a>10.9.2.3.4 浏览器**: <a target="_blank" rel="noopener" href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a>**</h5><p><strong>1.</strong> 浏览器输入**: <a target="_blank" rel="noopener" href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a> , 目前是 <strong>Openfeign 调用</strong>(<strong>负载均衡</strong>)**</p>
<h3 id="10-9-3-服务消费者整合-Sentinel"><a href="#10-9-3-服务消费者整合-Sentinel" class="headerlink" title="10.9.3 服务消费者整合 Sentinel"></a>10.9.3 服务消费者整合 Sentinel</h3><h4 id="10-9-3-1-需求分析-x2F-图解"><a href="#10-9-3-1-需求分析-x2F-图解" class="headerlink" title="10.9.3.1 需求分析&#x2F;图解"></a>10.9.3.1 需求分析&#x2F;图解</h4><p><strong>1.</strong> 需求:在 <strong>member-service-nacos-consumer-80</strong> 整合 <strong>Sentinel</strong> 能被 <strong>Sentinel</strong> 监控</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630165412038.png" alt="image-20230630165412038" style="zoom:50%;" />

<h4 id="10-9-3-2-代码-配置实现步骤"><a href="#10-9-3-2-代码-配置实现步骤" class="headerlink" title="10.9.3.2 代码+配置实现步骤"></a>10.9.3.2 代码+配置实现步骤</h4><p><strong>1.</strong> 修改 <strong>member-service-nacos-consumer-80</strong> 的 <strong>pom.xml</strong> 加入 <strong>sentinel</strong> 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入 alibaba-sentinel --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> 修改 <strong>member-service-nacos-consumer-80</strong> 的 <strong>application.yml</strong> 配置 <strong>sentinel</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-consumer-80</span></span><br><span class="line">    <span class="comment">#配置nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#启动nacos服务的ip以及端口</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span> <span class="comment">#这个是 sentinel 控制台(sentinel dashboard)的地址</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span> <span class="comment">#默认 8719，假如被占用了, 会自动从 8719 开始依次+1 扫描。直至找到未被占用的端口</span></span><br><span class="line"><span class="attr">management:</span> <span class="comment">#暴露所有监控点</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="10-9-3-3-测试"><a href="#10-9-3-3-测试" class="headerlink" title="10.9.3.3 测试"></a>10.9.3.3 测试</h4><h5 id="10-9-3-3-1-启动-Nacos-Server-8848"><a href="#10-9-3-3-1-启动-Nacos-Server-8848" class="headerlink" title="10.9.3.3.1 启动 Nacos Server 8848"></a><strong>10.9.3.3.1</strong> 启动 Nacos Server 8848</h5><h5 id="10-9-3-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard"><a href="#10-9-3-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.9.3.3.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard"></a>10.9.3.3.2 启动 <strong>Sentinel8080</strong> 控制台&#x2F;Sentinel dashboard</h5><h5 id="10-9-3-3-3-启动-member-service-nacos-provider-10004-x2F-10006"><a href="#10-9-3-3-3-启动-member-service-nacos-provider-10004-x2F-10006" class="headerlink" title="10.9.3.3.3 启动 **member-service-nacos-provider-10004&#x2F;10006 **"></a>10.9.3.3.3 启动 **member-service-nacos-provider-10004&#x2F;10006 **</h5><h5 id="10-9-3-3-4-启动-member-service-nacos-consumer-80"><a href="#10-9-3-3-4-启动-member-service-nacos-consumer-80" class="headerlink" title="10.9.3.3.4 启动 member-service-nacos-consumer-80"></a><strong>10.9.3.3.4</strong> 启动 member-service-nacos-consumer-80</h5><h5 id="10-9-3-3-5-浏览器-http-localhost-member-openfeign-consumer-get-1"><a href="#10-9-3-3-5-浏览器-http-localhost-member-openfeign-consumer-get-1" class="headerlink" title="10.9.3.3.5 浏览器**: http://localhost/member/openfeign/consumer/get/1**"></a>10.9.3.3.5 浏览器**: <a target="_blank" rel="noopener" href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a>**</h5><p><strong>1.</strong> 浏览器输入**: <a target="_blank" rel="noopener" href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a> ,** 目前是 <strong>Openfeign</strong> 调用**(<strong>负载均衡</strong>)**</p>
<p><strong>2.</strong> <strong>登录</strong> <strong>sentinel</strong> <strong>控制台</strong>: <strong>可以看到已经监控到</strong> <strong>member-service-nacos-consumer</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630170804677.png" alt="image-20230630170804677"></p>
<h3 id="10-9-4-openFeign-sentinel-对远程调用熔断降级"><a href="#10-9-4-openFeign-sentinel-对远程调用熔断降级" class="headerlink" title="10.9.4 openFeign+sentinel 对远程调用熔断降级"></a>10.9.4 openFeign+sentinel 对远程调用熔断降级</h3><h4 id="10-9-4-1-需求分析-x2F-图解"><a href="#10-9-4-1-需求分析-x2F-图解" class="headerlink" title="10.9.4.1 需求分析&#x2F;图解"></a>10.9.4.1 需求分析&#x2F;图解</h4><p><strong>1.</strong> 需求**&#x2F;<strong>如图:在 <strong>member-service-nacos-consumer-80</strong> 调用某个无效服务时，启动 Sentinel 的熔断降级机制 <strong>,</strong> 能够快速返回响应，而不是使用默认的超时机制(因为超时机制容易线程堆积</strong>,** 从而导致雪崩)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630170956206.png" alt="image-20230630170956206"></p>
<p><strong>2.</strong> <strong>先测试一下，关闭</strong> <strong>10004&#x2F;10006,</strong> <strong>这时</strong> <strong>openfeign</strong> <strong>去调用会怎么样</strong>? (返回 <strong>time out)</strong></p>
<p><strong>3.</strong> <strong>还可以测试一下，让</strong> <strong>10004</strong> <strong>服务对应的</strong> <strong>API</strong> <strong>执行时间很长</strong>(比如休眠 <strong>2</strong> <strong>秒</strong>), <strong>这 时</strong> <strong>openfeign</strong> <strong>去调用会怎么样</strong>?</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630171235813.png" alt="image-20230630171235813"></p>
<h4 id="10-9-4-2-代码-配置实现步骤"><a href="#10-9-4-2-代码-配置实现步骤" class="headerlink" title="10.9.4.2 代码+配置实现步骤"></a>10.9.4.2 代码+配置实现步骤</h4><p><strong>1.</strong> 修 改 <strong>member-service-nacos-consumer-80</strong> 的</p>
<p><strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;MemberOpenFeignService.java,</strong> 加入 <strong>fallback</strong> 的处理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Member;</span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Result;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 浦原</span></span><br><span class="line"><span class="comment"> * 2023/6/29</span></span><br><span class="line"><span class="comment"> * 21:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;member-service-nacos-provider&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MemberOpenFeignService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 老韩解读</span></span><br><span class="line"><span class="comment">     * 1. 远程调用的方式为 get</span></span><br><span class="line"><span class="comment">     * 2. 远程调用的 url 为 http://member-service-nacos-provider/member/get/&#123;id&#125;</span></span><br><span class="line"><span class="comment">     * 3. member-service-nacos-provider 是</span></span><br><span class="line"><span class="comment">     * nacos 注册中心服务 member-service-nacos-provider:10004/10006 </span></span><br><span class="line"><span class="comment">     * 4. 会根据 OpenFeign 的均衡算法来决定是调用 10004 还是 10006</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/member/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Member&gt; <span class="title function_">getMemberById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> 创建 <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;MemberFeignFallbackService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Member;</span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Result;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 浦原</span></span><br><span class="line"><span class="comment"> * 2023/6/30</span></span><br><span class="line"><span class="comment"> * 17:15</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberFeignFallbackService</span> <span class="keyword">implements</span> <span class="title class_">MemberOpenFeignService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Member&gt; <span class="title function_">getMemberById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;500&quot;</span>, <span class="string">&quot;被调用服务异常, 熔断降级，快速返回结果, 防止线程堆 积&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.</strong> 修改 <strong>member-service-nacos-consumer-80</strong> 的 <strong>application.yml ,</strong> 加入 <strong>openfeign</strong> 和 <strong>sentinel</strong> 整合配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">末尾添加以下：</span></span><br><span class="line"><span class="comment">#openfeign 和 sentinel 整合，必须配</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="10-9-4-3-测试"><a href="#10-9-4-3-测试" class="headerlink" title="10.9.4.3 测试"></a>10.9.4.3 测试</h4><h5 id="10-9-4-3-1-启动-Nacos-Server-8848"><a href="#10-9-4-3-1-启动-Nacos-Server-8848" class="headerlink" title="10.9.4.3.1 启动 Nacos Server 8848"></a><strong>10.9.4.3.1</strong> 启动 Nacos Server 8848</h5><h5 id="10-9-4-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard"><a href="#10-9-4-3-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.9.4.3.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard"></a>10.9.4.3.2 启动 <strong>Sentinel8080</strong> 控制台&#x2F;Sentinel dashboard</h5><h5 id="10-9-4-3-3-关闭-member-service-nacos-provider-10004-x2F-10006"><a href="#10-9-4-3-3-关闭-member-service-nacos-provider-10004-x2F-10006" class="headerlink" title="10.9.4.3.3 关闭 **member-service-nacos-provider-10004&#x2F;10006 **"></a>10.9.4.3.3 关闭 **member-service-nacos-provider-10004&#x2F;10006 **</h5><h5 id="10-9-4-3-4-启动-member-service-nacos-consumer-80"><a href="#10-9-4-3-4-启动-member-service-nacos-consumer-80" class="headerlink" title="10.9.4.3.4 启动 member-service-nacos-consumer-80"></a><strong>10.9.4.3.4</strong> 启动 member-service-nacos-consumer-80</h5><h5 id="10-9-4-3-5-浏览器-http-localhost-member-openfeign-consumer-get-1"><a href="#10-9-4-3-5-浏览器-http-localhost-member-openfeign-consumer-get-1" class="headerlink" title="10.9.4.3.5 浏览器**: http://localhost/member/openfeign/consumer/get/1**"></a>10.9.4.3.5 浏览器**: <a target="_blank" rel="noopener" href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a>**</h5><p><strong>1.</strong> 浏览器输入**: <a target="_blank" rel="noopener" href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a> ,** 目前是 <strong>Openfeign</strong> 调用**(<strong>负载均衡</strong>)**</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630172238879.png" alt="image-20230630172238879" style="zoom:50%;" />

<h4 id="10-9-4-4-注意事项和细节说明"><a href="#10-9-4-4-注意事项和细节说明" class="headerlink" title="10.9.4.4 注意事项和细节说明"></a>10.9.4.4 注意事项和细节说明</h4><p><strong>1.</strong> 因为 <strong>member-service-nacos-consumer-80</strong> 已经被 <strong>sentinel</strong> 监控，所以我们可以加入相</p>
<p>关的流控规则**,** 比如为 <strong>&#x2F;member&#x2F;openfeign&#x2F;consumer&#x2F;get&#x2F;1</strong> 加入流控规则 <strong>qps &#x3D; 1</strong></p>
<p><strong>测试</strong>: <strong>如果</strong>&#x2F;member&#x2F;openfeign&#x2F;consumer&#x2F;get&#x2F;1 <strong>请求</strong> <strong>QPS</strong> <strong>超过</strong> <strong>1,</strong> <strong>会输出Blocked by Sentinel (flow limiting)</strong></p>
<p><strong>QPS</strong> <strong>没有超过</strong> <strong>1,</strong> <strong>会被</strong> <strong>fallback</strong> <strong>处理</strong></p>
<p><strong>2.</strong> <strong>如果远程服务恢复正常</strong>, <strong>又会正常调用</strong>.</p>
<h2 id="10-10-规则持久化"><a href="#10-10-规则持久化" class="headerlink" title="10.10 规则持久化"></a>10.10 规则持久化</h2><h3 id="10-10-1-规则没有持久化的问题"><a href="#10-10-1-规则没有持久化的问题" class="headerlink" title="10.10.1 规则没有持久化的问题"></a><strong>10.10.1</strong> 规则没有持久化的问题</h3><h4 id="10-10-1-1-如果-sentinel-流控规则没有持久化，当重启调用-API-x2F-接口-所在微服务后，规则就会丢失，需要-重新加入"><a href="#10-10-1-1-如果-sentinel-流控规则没有持久化，当重启调用-API-x2F-接口-所在微服务后，规则就会丢失，需要-重新加入" class="headerlink" title="10.10.1.1 如果 sentinel 流控规则没有持久化，当重启调用 API&#x2F;接口 所在微服务后，规则就会丢失，需要 重新加入"></a>10.10.1.1 如果 sentinel 流控规则没有持久化，当重启调用 API&#x2F;接口 所在微服务后，规则就会丢失，需要 重新加入</h4><h4 id="10-10-1-2-解决方案-通过-Nacos-进行持久化"><a href="#10-10-1-2-解决方案-通过-Nacos-进行持久化" class="headerlink" title="10.10.1.2 解决方案:通过 Nacos 进行持久化"></a>10.10.1.2 解决方案:通过 Nacos 进行持久化</h4><h3 id="10-10-2-规则持久化方案"><a href="#10-10-2-规则持久化方案" class="headerlink" title="10.10.2 规则持久化方案"></a><strong>10.10.2</strong> 规则持久化方案</h3><h4 id="10-10-2-1-阿里云-Ahas-最方便-x2F-付费"><a href="#10-10-2-1-阿里云-Ahas-最方便-x2F-付费" class="headerlink" title="10.10.2.1 阿里云 Ahas[最方便&#x2F;付费]"></a>10.10.2.1 阿里云 Ahas[最方便&#x2F;付费]</h4><p><strong>1.</strong> 官方文档 <strong>: <a target="_blank" rel="noopener" href="https://help.aliyun.com/product/87450.html?spm=5176.cnahas.0.0.78034bb7ef0y86">https://help.aliyun.com/product/87450.html?spm=5176.cnahas.0.0.78034bb7ef0y86</a></strong></p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630190919413.png" alt="image-20230630190919413" style="zoom:50%;" />

<h4 id="10-10-2-2-🌟在-Nacos-Server-配置规则-完成持久化-官方推荐"><a href="#10-10-2-2-🌟在-Nacos-Server-配置规则-完成持久化-官方推荐" class="headerlink" title="10.10.2.2 🌟在 Nacos Server 配置规则, 完成持久化 -官方推荐"></a>10.10.2.2 🌟在 Nacos Server 配置规则, 完成持久化 -官方推荐</h4><h4 id="10-10-2-3-将规则持久化到本地文件-定时同步"><a href="#10-10-2-3-将规则持久化到本地文件-定时同步" class="headerlink" title="10.10.2.3 将规则持久化到本地文件, 定时同步"></a>10.10.2.3 将规则持久化到本地文件, 定时同步</h4><h4 id="10-10-2-4-其它…"><a href="#10-10-2-4-其它…" class="headerlink" title="10.10.2.4 其它…"></a>10.10.2.4 其它…</h4><h3 id="10-10-3-Nacos-Server-配置中心-规则持久化实例"><a href="#10-10-3-Nacos-Server-配置中心-规则持久化实例" class="headerlink" title="10.10.3 Nacos Server 配置中心**-**规则持久化实例"></a><strong>10.10.3 Nacos Server</strong> 配置中心**-**规则持久化实例</h3><h4 id="10-10-3-1-工作原理示意图"><a href="#10-10-3-1-工作原理示意图" class="headerlink" title="10.10.3.1 工作原理示意图"></a>10.10.3.1 工作原理示意图</h4><p>其实就是靠把规则保存到nacos中，下次重启服务时再从nacos中获取先前设置的规则信息</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630191350485.png" alt="image-20230630191350485"></p>
<h4 id="10-10-3-2-需求分析-x2F-图解"><a href="#10-10-3-2-需求分析-x2F-图解" class="headerlink" title="10.10.3.2 需求分析&#x2F;图解"></a>10.10.3.2 需求分析&#x2F;图解</h4><p><strong>1.</strong> 需 求 <strong>:</strong> 为 <strong>member-service-nacos-consumer-80</strong> 微服务的**&#x2F;member&#x2F;openfeign&#x2F;consumer&#x2F;get&#x2F;1 API** 接口添加流控规则 **QPS&#x3D;1&#x2F;**快速失败 <strong>.</strong></p>
<p><strong>2.</strong> <strong>要求将该流控规则加入到</strong> <strong>nacos server</strong> <strong>配置中心，实现持久化</strong></p>
<h4 id="10-10-3-3-代码-配置实现步骤"><a href="#10-10-3-3-代码-配置实现步骤" class="headerlink" title="10.10.3.3 代码+配置实现步骤"></a>10.10.3.3 代码+配置实现步骤</h4><p><strong>1.</strong> 在 <strong>Nacos Server</strong> 配置中心增加 <strong>Sentinel</strong> 客户端**&#x2F;**微服务模块的流控规则</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630191715975.png" alt="image-20230630191715975" style="zoom:50%;" />



<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">  	<span class="attr">&quot;resource&quot;</span><span class="punctuation">:</span><span class="string">&quot;/member/openfeign/consumer/get/1&quot;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;limitApp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;grade&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;strategy&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;controlBehavior&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;clusterMode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630192956899.png" alt="image-20230630192956899"></p>
<p><strong>2.</strong> <strong>在</strong> <strong>Nacos Server</strong> <strong>配置中心增加</strong> <strong>Sentinel</strong> <strong>客户端</strong>&#x2F;微服务模块的流控规则参数说明</p>
<ul>
<li><strong>resource</strong> ∶ 资源名称;</li>
<li><strong>limlitApp</strong> ∶  来源应用;</li>
<li>**grade **∶ 阈值类型，0 表示线程数，1 表示QPS;</li>
<li><strong>count</strong> ∶ 单机阈值;</li>
<li>**strategy **∶ 流控模式，0 表示直接，1 表示关联，2 表示链路;</li>
<li>**controlBehavior **∶ 流控效果，0 表示快速失败，1 表示Warm Up，2 表示排队等待;</li>
<li>**clusterMode **∶ 是否集群</li>
</ul>
<p><strong>3.</strong> <strong>修改</strong> <strong>member-service-nacos-consumer-80</strong> <strong>的</strong> <strong>pom.xml,</strong> <strong>加入</strong> <strong>sentinel</strong> <strong>和</strong> <strong>nacos</strong> <strong>持久化整合依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加入 sentinel 和 nacos 持久化整合依赖 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>4.</strong> <strong>修改</strong> <strong>member-service-nacos-consumer-80</strong>的application.yml , 配置该微服务从Nacos  Server获取流控规则</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在原本的基础上添加以下代码：</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">    	<span class="comment"># 配置该微服务从 Nacos Server 获取流控规则</span></span><br><span class="line">      <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">ds1:</span></span><br><span class="line">          <span class="attr">nacos:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="attr">dataId:</span> <span class="string">member-service-nacos-consumer</span></span><br><span class="line">        <span class="attr">groupId:</span> <span class="string">DEFAULT_GROUP</span></span><br><span class="line">        <span class="attr">data-type:</span> <span class="string">json</span></span><br><span class="line">        <span class="attr">rule-type:</span> <span class="string">flow</span></span><br></pre></td></tr></table></figure>

<h4 id="10-10-3-4-测试"><a href="#10-10-3-4-测试" class="headerlink" title="10.10.3.4 测试"></a>10.10.3.4 测试</h4><h5 id="10-10-3-4-1-启动-Nacos-Server-8848"><a href="#10-10-3-4-1-启动-Nacos-Server-8848" class="headerlink" title="10.10.3.4.1 启动 Nacos Server 8848"></a><strong>10.10.3.4.1</strong> 启动 Nacos Server 8848</h5><h5 id="10-10-3-4-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard"><a href="#10-10-3-4-2-启动-Sentinel8080-控制台-x2F-Sentinel-dashboard" class="headerlink" title="10.10.3.4.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard"></a>10.10.3.4.2 启动 <strong>Sentinel8080</strong> 控制台&#x2F;Sentinel dashboard</h5><h5 id="10-10-3-4-3-启动-member-service-nacos-provider-10004-x2F-10006"><a href="#10-10-3-4-3-启动-member-service-nacos-provider-10004-x2F-10006" class="headerlink" title="10.10.3.4.3 启动 **member-service-nacos-provider-10004&#x2F;10006 **"></a>10.10.3.4.3 启动 **member-service-nacos-provider-10004&#x2F;10006 **</h5><h5 id="10-10-3-4-4-启动-member-service-nacos-consumer-80"><a href="#10-10-3-4-4-启动-member-service-nacos-consumer-80" class="headerlink" title="10.10.3.4.4 启动 member-service-nacos-consumer-80"></a><strong>10.10.3.4.4</strong> 启动 member-service-nacos-consumer-80</h5><h5 id="10-10-3-4-5-浏览器-http-localhost-member-openfeign-consumer-get-1"><a href="#10-10-3-4-5-浏览器-http-localhost-member-openfeign-consumer-get-1" class="headerlink" title="10.10.3.4.5 浏览器**: http://localhost/member/openfeign/consumer/get/1**"></a>10.10.3.4.5 浏览器**: <a target="_blank" rel="noopener" href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a>**</h5><p><strong>1.</strong> 浏览器输入**: <a target="_blank" rel="noopener" href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a> ,** 目前是 <strong>Openfeign</strong> 调用**(<strong>负载均衡</strong>),** <u><em><strong>而且流控规则已经生效了.</strong></em></u></p>
<p><strong>2.</strong> <strong>查看</strong> <strong>Sentinel</strong> <strong>控制台</strong>,<strong>发现已经同步了流控规则</strong></p>
<h4 id="10-10-3-5-注意事项和细节"><a href="#10-10-3-5-注意事项和细节" class="headerlink" title="10.10.3.5 注意事项和细节"></a>10.10.3.5 注意事项和细节</h4><p><strong>1.</strong> 在 <strong>nacos server</strong> 配置 <strong>sentinel</strong> 流控规则的 <strong>Data ID</strong> 也可以自己指定，比如写成 <strong>hsp-id,</strong> 只要在 **sentinel client&#x2F;**微服务 的 <strong>applicaion.yml</strong> 的 <strong>datasource.ds1.nacos.dataId</strong> 的值保持一致即可</p>
<p><strong>2.</strong> <strong>如图所示</strong></p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630194533516.png" alt="image-20230630194533516" style="zoom:50%;" />



<h1 id="11-SpringCloud-Alibaba-Seata全局事务"><a href="#11-SpringCloud-Alibaba-Seata全局事务" class="headerlink" title="11 SpringCloud Alibaba Seata全局事务"></a>11 SpringCloud Alibaba Seata全局事务</h1><p><strong>全局事务</strong>——保证一个牵扯修改多个数据库的操作由于意外情况导致数据库中数据不一致的情况</p>
<h2 id="11-1-Seata基础"><a href="#11-1-Seata基础" class="headerlink" title="11.1 Seata基础"></a>11.1 Seata基础</h2><h3 id="11-1-1-先看一个问题，引出-Seata"><a href="#11-1-1-先看一个问题，引出-Seata" class="headerlink" title="11.1.1 先看一个问题，引出 Seata"></a><strong>11.1.1</strong> 先看一个问题，引出 <strong>Seata</strong></h3><p><strong>1.</strong> 单机单库**(<strong>多表</strong>)**处理事务示意图</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630203651434.png" alt="image-20230630203651434"></p>
<p><strong>2.</strong> <strong>分布式微服务架构下的数据库事务示意图</strong>（RPC，远程过程调用）</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630204333902.png" alt="image-20230630204333902" style="zoom:50%;" />

<p><strong>3.</strong> <strong>梳理上图</strong></p>
<p>用户购买商品的业务逻辑。整个业务逻辑由3个微服务提供支持∶</p>
<ul>
<li><strong>仓储服务∶对给定的商品扣除仓库&#x2F;商品数量</strong></li>
<li><strong>订单服务;根据采购需求创建订单</strong></li>
<li><strong>帐户服务∶从用户帐户中扣除余额</strong></li>
</ul>
<p><strong>4.</strong> <strong>问题分析</strong></p>
<ul>
<li><p><strong>单体应用被拆分成微服务应用，原来的三个模块被拆分成三个独立的应用，分别使用三个独立的数据源</strong></p>
</li>
<li><p>业务操作需要调用三个服务来完成。此时<strong>每个服务内部的数据一致性由本地事务来保证</strong></p>
</li>
<li><p><strong>但是全局的数据—致性问题没法保证</strong></p>
</li>
<li><p>简单的说: <u>一次业务操作需要跨多个数据源或需要跨多个系统进行远程调用</u>，就会<strong>产生分布式事务问题</strong>—–</p>
<p>——-&gt;seata</p>
</li>
</ul>
<h3 id="11-1-2-分布式事务问题-amp-解决方案"><a href="#11-1-2-分布式事务问题-amp-解决方案" class="headerlink" title="11.1.2 分布式事务问题**&amp;**解决方案"></a><strong>11.1.2</strong> 分布式事务问题**&amp;**解决方案</h3><h4 id="11-1-2-1-分布式微服务架构下的全局数据一致性问题-即-分布式事务问题"><a href="#11-1-2-1-分布式微服务架构下的全局数据一致性问题-即-分布式事务问题" class="headerlink" title="11.1.2.1 分布式微服务架构下的全局数据一致性问题 [即: 分布式事务问题]"></a>11.1.2.1 分布式微服务架构下的全局数据一致性问题 [即: 分布式事务问题]</h4><h4 id="11-1-2-2-解决方案-Seata"><a href="#11-1-2-2-解决方案-Seata" class="headerlink" title="11.1.2.2 解决方案: Seata"></a>11.1.2.2 解决方案: Seata</h4><h3 id="11-1-3-官网"><a href="#11-1-3-官网" class="headerlink" title="11.1.3 官网"></a><strong>11.1.3</strong> 官网</h3><h4 id="11-1-3-1-http-seata-io-zh-cn"><a href="#11-1-3-1-http-seata-io-zh-cn" class="headerlink" title="11.1.3.1 http://seata.io/zh-cn/"></a>11.1.3.1 <a target="_blank" rel="noopener" href="http://seata.io/zh-cn/">http://seata.io/zh-cn/</a></h4><h4 id="11-1-3-2-使用手册-https-seata-io-zh-cn-docs-overview-what-is-seata-html"><a href="#11-1-3-2-使用手册-https-seata-io-zh-cn-docs-overview-what-is-seata-html" class="headerlink" title="11.1.3.2 使用手册: https://seata.io/zh-cn/docs/overview/what-is-seata.html"></a>11.1.3.2 使用手册: <a target="_blank" rel="noopener" href="https://seata.io/zh-cn/docs/overview/what-is-seata.html">https://seata.io/zh-cn/docs/overview/what-is-seata.html</a></h4><h3 id="11-1-4-Seata是什么"><a href="#11-1-4-Seata是什么" class="headerlink" title="11.1.4 Seata是什么?"></a>11.1.4 Seata是什么?</h3><p>Seata 是一款开源的分布式事务解决方案，致力于<strong>在微服务架构下提供<u>高性能和简单易用的分布式事务服务</u></strong></p>
<h2 id="11-2-🌟Seata-工作机制-x2F-返讲"><a href="#11-2-🌟Seata-工作机制-x2F-返讲" class="headerlink" title="11.2 🌟Seata 工作机制&#x2F;返讲"></a>11.2 🌟Seata 工作机制&#x2F;返讲</h2><h3 id="11-2-1-分布式事务过程分析"><a href="#11-2-1-分布式事务过程分析" class="headerlink" title="11.2.1 分布式事务过程分析"></a><strong>11.2.1</strong> 分布式事务过程分析</h3><p><strong>1. Seata</strong> 分布式事务处理过程-ID+三组件模型</p>
<p><strong>2.</strong> 一图胜千言</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703150121800.png" alt="image-20230703150121800"></p>
<p>上图展示了一个分布式事务在Seata的处理过程</p>
<ul>
<li>Transaction ID <strong>XID</strong>:全局唯一的事务ID</li>
<li>Transaction Coordinator(<strong>TC</strong>): 事务协调器，<u>维护全局事务的运行状态</u>，负责<u>协调并驱动全局事务的提交或回滚</u></li>
<li>Transaction Manager(<strong>TM</strong>): 控制<u>全局事务</u>的边界，负责开启一个全局事务，并最终发起全局提交或全局回滚的决议;</li>
<li>Resource Manager(<strong>RM</strong>):控制<u>分支事务</u>，负责分支注册，状态汇报，并接收事务协调器的指令，驱动分支 (本地)事务的<strong>提交和回滚</strong></li>
</ul>
<p>执行过程</p>
<ul>
<li>TM向 TC申请开启一个全局事务，全局事务创建成功并生成一个全局唯一的 XID</li>
<li>XID在微服务调用链路的上下文中传播</li>
<li>RM 向 TC注册分支事务，将其纳入 XID 对应全局事务的管辖</li>
<li>TM 向 TC 发起针对 XID 的全局提交或回滚决议。</li>
<li>TC 调度 XID下管辖的全部分支事务完成提交或回滚请求</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703152243363.png" alt="image-20230703152243363" style="zoom:150%;" />



<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703152337277.png" alt="image-20230703152337277"></p>
<h3 id="11-2-2-Seata-事务模式"><a href="#11-2-2-Seata-事务模式" class="headerlink" title="11.2.2 Seata 事务模式"></a>11.2.2 Seata 事务模式</h3><p><strong>1.</strong> <strong>地址</strong>: <a target="_blank" rel="noopener" href="https://seata.io/zh-cn/docs/overview/what-is-seata.html">https://seata.io/zh-cn/docs/overview/what-is-seata.html</a></p>
<h4 id="11-2-2-1-AT-默认模式"><a href="#11-2-2-1-AT-默认模式" class="headerlink" title="11.2.2.1 AT(默认模式)"></a>11.2.2.1 AT(默认模式)</h4><h4 id="11-2-2-2-TCC"><a href="#11-2-2-2-TCC" class="headerlink" title="11.2.2.2 TCC"></a>11.2.2.2 TCC</h4><h4 id="11-2-2-3-SAGA"><a href="#11-2-2-3-SAGA" class="headerlink" title="11.2.2.3 SAGA"></a>11.2.2.3 SAGA</h4><h4 id="11-2-2-4-XA"><a href="#11-2-2-4-XA" class="headerlink" title="11.2.2.4 XA"></a>11.2.2.4 XA</h4><h3 id="11-2-3-AT无侵入模式"><a href="#11-2-3-AT无侵入模式" class="headerlink" title="11.2.3 AT无侵入模式"></a>11.2.3 AT无侵入模式</h3><h4 id="11-2-3-1-文档-https-seata-io-zh-cn-docs-overview-what-is-seata-html"><a href="#11-2-3-1-文档-https-seata-io-zh-cn-docs-overview-what-is-seata-html" class="headerlink" title="11.2.3.1 文档: https://seata.io/zh-cn/docs/overview/what-is-seata.html"></a>11.2.3.1 文档: <a target="_blank" rel="noopener" href="https://seata.io/zh-cn/docs/overview/what-is-seata.html">https://seata.io/zh-cn/docs/overview/what-is-seata.html</a></h4><h4 id="11-2-3-2-一阶段加载"><a href="#11-2-3-2-一阶段加载" class="headerlink" title="11.2.3.2 一阶段加载"></a>11.2.3.2 一阶段加载</h4><p>在一阶段，<strong>Seata</strong> 会拦截**”**业务 <strong>SQL”</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703161643439.png" alt="image-20230703161643439"></p>
<ol>
<li><p>解析 SQL 语义，找到“业务SQL”要更新的业务数据，在业务数据被更新前，将其保存成”before image”(前罝镜像）</p>
</li>
<li><p>执行”业务 SQL”更新业务数据，在业务数据更新之后，其保存成”after image” &#x2F;后置镜像</p>
</li>
<li><p>最后生成行锁</p>
</li>
<li><p>以上操作全部在一个数据库事务内完成，这样保证了一阶段操作的原子性</p>
</li>
</ol>
<p>其中，<strong>前像与后像存于undo_log数据表中</strong></p>
<h4 id="11-2-3-3-二阶段提交"><a href="#11-2-3-3-二阶段提交" class="headerlink" title="11.2.3.3 二阶段提交"></a>11.2.3.3 二阶段提交</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703162629147.png" alt="image-20230703162629147" style="zoom: 40%;" />

<p><strong>1.</strong> <strong>二阶段如果是顺利提交</strong></p>
<p><strong>2.</strong> <strong>因为”业务 SQL”在一阶段已经提交至数据库，所以 Seata 框架只需将一阶段保存的快照数据和行锁删掉，完成数据清理即可</strong></p>
<h4 id="11-2-3-4-二阶段回滚"><a href="#11-2-3-4-二阶段回滚" class="headerlink" title="11.2.3.4 二阶段回滚"></a>11.2.3.4 二阶段回滚</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703162812449.png" alt="image-20230703162812449"></p>
<ol>
<li><p>二阶段如果是回滚的话，seata 就需要<strong>回滚一阶段己经执行的“业务 SQL”‘，还原业务数据</strong>。</p>
</li>
<li><p>回滚方式便是用”before image”还原业务数据;但在还原前要首先要校验脏号，对比”数据库当前业务数据”和”after image 如果两份数据完全一致就说明没有脏写，可以还原业务数据</p>
</li>
<li><p>如果不一致就说明有脏写，出现脏写就需要转人工处理</p>
</li>
</ol>
<h3 id="11-2-4-AT事务模式Debug验证"><a href="#11-2-4-AT事务模式Debug验证" class="headerlink" title="11.2.4 AT事务模式Debug验证"></a>11.2.4 AT<strong>事务模式</strong>Debug验证</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703163149523.png" alt="image-20230703163149523"></p>
<h3 id="11-2-5-SEATA的分布式交易解决方案"><a href="#11-2-5-SEATA的分布式交易解决方案" class="headerlink" title="11.2.5 SEATA的分布式交易解决方案"></a>11.2.5 SEATA的分布式交易解决方案</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703163341180.png" alt="image-20230703163341180"></p>
<h2 id="11-3-SeataServer安装"><a href="#11-3-SeataServer安装" class="headerlink" title="11.3 SeataServer安装"></a>11.3 SeataServer安装</h2><h3 id="11-3-1-下载"><a href="#11-3-1-下载" class="headerlink" title="11.3.1 下载"></a><strong>11.3.1</strong> 下载</h3><h4 id="11-3-1-1-https-github-com-seata-seata-releases-tag-v0-9-0"><a href="#11-3-1-1-https-github-com-seata-seata-releases-tag-v0-9-0" class="headerlink" title="11.3.1.1 https://github.com/seata/seata/releases/tag/v0.9.0"></a>11.3.1.1 <a target="_blank" rel="noopener" href="https://github.com/seata/seata/releases/tag/v0.9.0">https://github.com/seata/seata/releases/tag/v0.9.0</a></h4><h3 id="11-3-2-安装和配置"><a href="#11-3-2-安装和配置" class="headerlink" title="11.3.2 安装和配置"></a><strong>11.3.2</strong> 安装和配置</h3><p><strong>1.</strong> 将 <strong>seata-server-0.9.0.zip</strong> 解压到 指定目录，比如 <strong>d:\program</strong></p>
<p><strong>2.</strong> <strong>修改</strong> <strong>conf\file.conf</strong> <strong>文件</strong>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">transport &#123;</span><br><span class="line">  # tcp udt unix-domain-socket</span><br><span class="line">  type = <span class="string">&quot;TCP&quot;</span></span><br><span class="line">  #<span class="variable constant_">NIO</span> <span class="variable constant_">NATIVE</span></span><br><span class="line">  server = <span class="string">&quot;NIO&quot;</span></span><br><span class="line">  #enable heartbeat</span><br><span class="line">  heartbeat = <span class="literal">true</span></span><br><span class="line">  #thread factory <span class="keyword">for</span> netty</span><br><span class="line">  thread-factory &#123;</span><br><span class="line">    boss-thread-prefix = <span class="string">&quot;NettyBoss&quot;</span></span><br><span class="line">    worker-thread-prefix = <span class="string">&quot;NettyServerNIOWorker&quot;</span></span><br><span class="line">    server-executor-thread-prefix = <span class="string">&quot;NettyServerBizHandler&quot;</span></span><br><span class="line">    share-boss-worker = <span class="literal">false</span></span><br><span class="line">    client-selector-thread-prefix = <span class="string">&quot;NettyClientSelector&quot;</span></span><br><span class="line">    client-selector-thread-size = <span class="number">1</span></span><br><span class="line">    client-worker-thread-prefix = <span class="string">&quot;NettyClientWorkerThread&quot;</span></span><br><span class="line">    # netty boss thread size,will not be used <span class="keyword">for</span> <span class="variable constant_">UDT</span></span><br><span class="line">    boss-thread-size = <span class="number">1</span></span><br><span class="line">    #auto <span class="keyword">default</span> pin or <span class="number">8</span></span><br><span class="line">    worker-thread-size = <span class="number">8</span></span><br><span class="line">  &#125;</span><br><span class="line">  shutdown &#123;</span><br><span class="line">    # when destroy server, wait seconds</span><br><span class="line">    wait = <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">  serialization = <span class="string">&quot;seata&quot;</span></span><br><span class="line">  compressor = <span class="string">&quot;none&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">service &#123;</span><br><span class="line">  #vgroup-&gt;rgroup</span><br><span class="line">  #vgroup_mapping.<span class="property">my_test_tx_group</span> = <span class="string">&quot;default&quot;</span></span><br><span class="line">  vgroup_mapping.<span class="property">my_test_tx_group</span> = <span class="string">&quot;hspedu_order_tx_group&quot;</span></span><br><span class="line">  #only support single node</span><br><span class="line">  <span class="keyword">default</span>.<span class="property">grouplist</span> = <span class="string">&quot;127.0.0.1:8091&quot;</span></span><br><span class="line">  #degrade current not support</span><br><span class="line">  enableDegrade = <span class="literal">false</span></span><br><span class="line">  #disable</span><br><span class="line">  disable = <span class="literal">false</span></span><br><span class="line">  #unit ms,s,m,h,d represents milliseconds, seconds, minutes, hours, days, <span class="keyword">default</span> permanent</span><br><span class="line">  max.<span class="property">commit</span>.<span class="property">retry</span>.<span class="property">timeout</span> = <span class="string">&quot;-1&quot;</span></span><br><span class="line">  max.<span class="property">rollback</span>.<span class="property">retry</span>.<span class="property">timeout</span> = <span class="string">&quot;-1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">client &#123;</span><br><span class="line">  <span class="keyword">async</span>.<span class="property">commit</span>.<span class="property">buffer</span>.<span class="property">limit</span> = <span class="number">10000</span></span><br><span class="line">  lock &#123;</span><br><span class="line">    retry.<span class="property">internal</span> = <span class="number">10</span></span><br><span class="line">    retry.<span class="property">times</span> = <span class="number">30</span></span><br><span class="line">  &#125;</span><br><span class="line">  report.<span class="property">retry</span>.<span class="property">count</span> = <span class="number">5</span></span><br><span class="line">  tm.<span class="property">commit</span>.<span class="property">retry</span>.<span class="property">count</span> = <span class="number">1</span></span><br><span class="line">  tm.<span class="property">rollback</span>.<span class="property">retry</span>.<span class="property">count</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## transaction log store</span><br><span class="line">store &#123;</span><br><span class="line">  ## store <span class="attr">mode</span>: file、db</span><br><span class="line">  ##mode = <span class="string">&quot;file&quot;</span></span><br><span class="line">  mode = <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line">  ## file store</span><br><span class="line">  file &#123;</span><br><span class="line">    dir = <span class="string">&quot;sessionStore&quot;</span></span><br><span class="line"></span><br><span class="line">    # branch session size , <span class="keyword">if</span> exceeded first <span class="keyword">try</span> compress lockkey, still exceeded throws exceptions</span><br><span class="line">    max-branch-session-size = <span class="number">16384</span></span><br><span class="line">    # globe session size , <span class="keyword">if</span> exceeded throws exceptions</span><br><span class="line">    max-<span class="variable language_">global</span>-session-size = <span class="number">512</span></span><br><span class="line">    # file buffer size , <span class="keyword">if</span> exceeded allocate <span class="keyword">new</span> buffer</span><br><span class="line">    file-write-buffer-cache-size = <span class="number">16384</span></span><br><span class="line">    # when recover batch read size</span><br><span class="line">    session.<span class="property">reload</span>.<span class="property">read_size</span> = <span class="number">100</span></span><br><span class="line">    # <span class="keyword">async</span>, sync</span><br><span class="line">    flush-disk-mode = <span class="keyword">async</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ## database store</span><br><span class="line">  db &#123;</span><br><span class="line">    ## the implement <span class="keyword">of</span> javax.<span class="property">sql</span>.<span class="property">DataSource</span>, such <span class="keyword">as</span> <span class="title class_">DruidDataSource</span>(druid)/<span class="title class_">BasicDataSource</span>(dbcp) etc.</span><br><span class="line">    datasource = <span class="string">&quot;dbcp&quot;</span></span><br><span class="line">    ## mysql/oracle/h2/oceanbase etc.</span><br><span class="line">    db-type = <span class="string">&quot;mysql&quot;</span></span><br><span class="line">    driver-<span class="keyword">class</span>-name = <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span><br><span class="line">    url = <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/seata&quot;</span></span><br><span class="line">    ##user = <span class="string">&quot;mysql&quot;</span></span><br><span class="line">    user = <span class="string">&quot;root&quot;</span></span><br><span class="line">    ##password = <span class="string">&quot;mysql&quot;</span></span><br><span class="line">    password = <span class="string">&quot;QWEASDzxc123&quot;</span></span><br><span class="line">    min-conn = <span class="number">1</span></span><br><span class="line">    max-conn = <span class="number">3</span></span><br><span class="line">    <span class="variable language_">global</span>.<span class="property">table</span> = <span class="string">&quot;global_table&quot;</span></span><br><span class="line">    branch.<span class="property">table</span> = <span class="string">&quot;branch_table&quot;</span></span><br><span class="line">    lock-table = <span class="string">&quot;lock_table&quot;</span></span><br><span class="line">    query-limit = <span class="number">100</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">lock &#123;</span><br><span class="line">  ## the lock store <span class="attr">mode</span>: local、remote</span><br><span class="line">  mode = <span class="string">&quot;remote&quot;</span></span><br><span class="line"></span><br><span class="line">  local &#123;</span><br><span class="line">    ## store locks <span class="keyword">in</span> user<span class="string">&#x27;s database</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  remote &#123;</span></span><br><span class="line"><span class="string">    ## store locks in the seata&#x27;</span>s server</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">recovery &#123;</span><br><span class="line">  #schedule committing retry period <span class="keyword">in</span> milliseconds</span><br><span class="line">  committing-retry-period = <span class="number">1000</span></span><br><span class="line">  #schedule asyn committing retry period <span class="keyword">in</span> milliseconds</span><br><span class="line">  asyn-committing-retry-period = <span class="number">1000</span></span><br><span class="line">  #schedule rollbacking retry period <span class="keyword">in</span> milliseconds</span><br><span class="line">  rollbacking-retry-period = <span class="number">1000</span></span><br><span class="line">  #schedule timeout retry period <span class="keyword">in</span> milliseconds</span><br><span class="line">  timeout-retry-period = <span class="number">1000</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">transaction &#123;</span><br><span class="line">  undo.<span class="property">data</span>.<span class="property">validation</span> = <span class="literal">true</span></span><br><span class="line">  undo.<span class="property">log</span>.<span class="property">serialization</span> = <span class="string">&quot;jackson&quot;</span></span><br><span class="line">  undo.<span class="property">log</span>.<span class="property">save</span>.<span class="property">days</span> = <span class="number">7</span></span><br><span class="line">  #schedule <span class="keyword">delete</span> expired undo_log <span class="keyword">in</span> milliseconds</span><br><span class="line">  undo.<span class="property">log</span>.<span class="property">delete</span>.<span class="property">period</span> = <span class="number">86400000</span></span><br><span class="line">  undo.<span class="property">log</span>.<span class="property">table</span> = <span class="string">&quot;undo_log&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## metrics settings</span><br><span class="line">metrics &#123;</span><br><span class="line">  enabled = <span class="literal">false</span></span><br><span class="line">  registry-type = <span class="string">&quot;compact&quot;</span></span><br><span class="line">  # multi exporters use comma divided</span><br><span class="line">  exporter-list = <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">  exporter-prometheus-port = <span class="number">9898</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">support &#123;</span><br><span class="line">  ## spring</span><br><span class="line">  spring &#123;</span><br><span class="line">    # auto proxy the <span class="title class_">DataSource</span> bean</span><br><span class="line">    datasource.<span class="property">autoproxy</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.</strong> <strong>在</strong> <strong>mysql5.7</strong> <strong>创建</strong> <strong>seata</strong> <strong>数据库</strong></p>
<p><strong>4.</strong> <strong>修改</strong> <strong>seata</strong> <strong>的</strong> <strong>\conf\registry.conf ,</strong> <strong>配置注册中心</strong> <strong>nacos server</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">registry &#123;</span><br><span class="line">  # file 、nacos 、eureka、redis、zk、consul、etcd3、sofa</span><br><span class="line">  # type = <span class="string">&quot;file&quot;</span></span><br><span class="line">  type = <span class="string">&quot;nacos&quot;</span></span><br><span class="line"></span><br><span class="line">  nacos &#123;</span><br><span class="line">    # serverAddr = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;localhost:8848&quot;</span></span><br><span class="line">    namespace = <span class="string">&quot;&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  eureka &#123;</span><br><span class="line">    serviceUrl = <span class="string">&quot;http://localhost:8761/eureka&quot;</span></span><br><span class="line">    application = <span class="string">&quot;default&quot;</span></span><br><span class="line">    weight = <span class="string">&quot;1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  redis &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;localhost:6379&quot;</span></span><br><span class="line">    db = <span class="string">&quot;0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  zk &#123;</span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:2181&quot;</span></span><br><span class="line">    session.<span class="property">timeout</span> = <span class="number">6000</span></span><br><span class="line">    connect.<span class="property">timeout</span> = <span class="number">2000</span></span><br><span class="line">  &#125;</span><br><span class="line">  consul &#123;</span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:8500&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  etcd3 &#123;</span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;http://localhost:2379&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  sofa &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:9603&quot;</span></span><br><span class="line">    application = <span class="string">&quot;default&quot;</span></span><br><span class="line">    region = <span class="string">&quot;DEFAULT_ZONE&quot;</span></span><br><span class="line">    datacenter = <span class="string">&quot;DefaultDataCenter&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    group = <span class="string">&quot;SEATA_GROUP&quot;</span></span><br><span class="line">    addressWaitTime = <span class="string">&quot;3000&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  file &#123;</span><br><span class="line">    name = <span class="string">&quot;file.conf&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">config &#123;</span><br><span class="line">  # file、nacos 、apollo、zk、consul、etcd3</span><br><span class="line">  type = <span class="string">&quot;file&quot;</span></span><br><span class="line"></span><br><span class="line">  nacos &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">    namespace = <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  consul &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:8500&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  apollo &#123;</span><br><span class="line">    app.<span class="property">id</span> = <span class="string">&quot;seata-server&quot;</span></span><br><span class="line">    apollo.<span class="property">meta</span> = <span class="string">&quot;http://192.168.1.204:8801&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  zk &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:2181&quot;</span></span><br><span class="line">    session.<span class="property">timeout</span> = <span class="number">6000</span></span><br><span class="line">    connect.<span class="property">timeout</span> = <span class="number">2000</span></span><br><span class="line">  &#125;</span><br><span class="line">  etcd3 &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;http://localhost:2379&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  file &#123;</span><br><span class="line">    name = <span class="string">&quot;file.conf&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="11-3-3-启动"><a href="#11-3-3-启动" class="headerlink" title="11.3.3 启动"></a><strong>11.3.3</strong> 启动</h3><h4 id="11-3-3-1-启动-Nacos-Server-8848"><a href="#11-3-3-1-启动-Nacos-Server-8848" class="headerlink" title="11.3.3.1 启动 Nacos Server 8848"></a>11.3.3.1 启动 Nacos Server 8848</h4><h4 id="11-3-3-2-双击-Seata-的-bin-seata-server-bat-启动-Seata-Server"><a href="#11-3-3-2-双击-Seata-的-bin-seata-server-bat-启动-Seata-Server" class="headerlink" title="11.3.3.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server"></a>11.3.3.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server</h4><p><strong>1.</strong> 启动 <strong>seata-server.bat ,</strong> 看到如下界面说明成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /Applications/seata/bin</span><br><span class="line">./seata-server.sh -h 127.0.0.1 -p 8848 -m db -n 1 </span><br></pre></td></tr></table></figure>

<h4 id="11-3-3-3-登录-Nacos-Server-查看-Seata-Server-是否注册成功"><a href="#11-3-3-3-登录-Nacos-Server-查看-Seata-Server-是否注册成功" class="headerlink" title="11.3.3.3 登录 Nacos Server , 查看 Seata Server 是否注册成功"></a>11.3.3.3 登录 Nacos Server , 查看 Seata Server 是否注册成功</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230702162714540.png" alt="image-20230702162714540"></p>
<h2 id="11-4-Seata-分布式事务-应用实例"><a href="#11-4-Seata-分布式事务-应用实例" class="headerlink" title="11.4 Seata 分布式事务-应用实例"></a>11.4 Seata 分布式事务-应用实例</h2><h3 id="11-4-1-需求分析-x2F-图解"><a href="#11-4-1-需求分析-x2F-图解" class="headerlink" title="11.4.1 需求分析**&#x2F;**图解"></a><strong>11.4.1</strong> 需求分析**&#x2F;**图解</h3><p><strong>1.</strong> 需求:完成下订单功能，由三个微服务模块协同完成**,** 涉及到多数据库**,** 多张表</p>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230702164527518.png" alt="image-20230702164527518" style="zoom:50%;" />

<h3 id="11-4-2-创建数据库和表"><a href="#11-4-2-创建数据库和表" class="headerlink" title="11.4.2 创建数据库和表"></a>11.4.2 创建数据库和表</h3><p><strong>1.</strong> 创建业务数据库和表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 订单微服务的数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE order_micro_service </span><br><span class="line">USE order_micro_service</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">order</span>`(</span><br><span class="line">id <span class="type">BIGINT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">user_id <span class="type">BIGINT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">product_id <span class="type">BIGINT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">nums <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">money <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`status` <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;0:创建中; 1:已完结&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `<span class="keyword">order</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 库存微服务的数据库`storage``order` </span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE storage_micro_service </span><br><span class="line">USE storage_micro_service</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `storage`(</span><br><span class="line">	id <span class="type">BIGINT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY, </span><br><span class="line">  product_id <span class="type">BIGINT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">	amount <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;库存量&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 初始化库存表</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `storage` <span class="keyword">VALUES</span>(<span class="keyword">NULL</span>, <span class="number">1</span>, <span class="number">10</span>); </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `storage`</span><br><span class="line"><span class="comment">-- 账号微服务的数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE account_micro_service </span><br><span class="line">USE account_micro_service</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `account`(</span><br><span class="line">	id <span class="type">BIGINT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY , </span><br><span class="line">  user_id <span class="type">BIGINT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">	money <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;账户金额&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 初始化账户表</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `account` <span class="keyword">VALUES</span>(<span class="keyword">NULL</span>, <span class="number">666</span>, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> 分别为 <strong>3</strong> 库创建对应的回滚日志表**,** 说明回滚日志表在 <strong>seata</strong> 的 <strong>\conf\db_undo_log.sql</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">use order_micro_service </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT, </span><br><span class="line">  `branch_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	`xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	`context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `log_status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	`log_created` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `ext` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line"><span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">use storage_micro_service </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT, </span><br><span class="line">  `branch_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	`xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	`context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `log_status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	`log_created` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `ext` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">	<span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">use account_micro_service </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT, </span><br><span class="line">  `branch_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	`xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	`context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `log_status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	`log_created` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `ext` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line"><span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="11-4-3-开发-seata-storage-micro-service-10010-微服务"><a href="#11-4-3-开发-seata-storage-micro-service-10010-微服务" class="headerlink" title="11.4.3 开发 seata_storage_micro_service-10010 微服务"></a>11.4.3 开发 seata_storage_micro_service-10010 微服务</h3><p><strong>1.</strong> 参考以前的方式，创建 <strong>seata_storage_micro_service-10010</strong> 微服务模块</p>
<p><strong>2.</strong> <strong>修改</strong> <strong>pom.xml,</strong> <strong>添加相关的</strong> <strong>jar</strong> <strong>依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 提示 application.yml --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入 openfeign，因为可能需要用到远程调用 --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 在微服务模块引入 nacos-discovery starter --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--seata--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 排除自带的 seata-all --&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 引入指定版本的 io.seata --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 引入 e_commerce_center-common-api --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hspedu.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e_commerce_center-common-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- 这里我们重新指定一下 version --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>3.</strong> <strong>创建</strong> <strong>application.yml,</strong> <strong>进行相关的配置</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">seata_storage_micor_service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">alibaba:</span></span><br><span class="line">      <span class="attr">seata:</span></span><br><span class="line">        <span class="comment">#自定义事务组名称需要与 seata-server 中的对应,看 \conf\file.conf</span></span><br><span class="line">        <span class="attr">tx-service-group:</span> <span class="string">hspedu_order_tx_group</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#配置 Nacos Server</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/storage_micro_service</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">QWEASDzxc123</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">io:</span></span><br><span class="line">      <span class="attr">seata:</span> <span class="string">info</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure>

<p><strong>4.</strong> <strong>创建</strong> <strong>file.conf,</strong> <strong>进行相关的配置</strong>, <strong>说明:该文件从</strong> <strong>seata</strong> <strong>的</strong>\conf\file.conf <strong>拷贝，进行修改即可</strong></p>
<p><strong>5.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;entity&#x2F;Storage.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 浦原</span></span><br><span class="line"><span class="comment"> * 2023/7/2</span></span><br><span class="line"><span class="comment"> * 20:33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Storage</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line">    <span class="keyword">private</span> Integer amount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>6.</strong> <strong>创建</strong> com&#x2F;hspedu&#x2F;springcloud&#x2F;dao&#x2F;StorageDao.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StorageDao</span> &#123;</span><br><span class="line">    <span class="comment">//扣减库存信息</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(<span class="meta">@Param(&quot;productId&quot;)</span> Long productId, <span class="meta">@Param(&quot;nums&quot;)</span> Integer nums)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>7.</strong> <strong>创建</strong> **resources&#x2F;**mapper&#x2F;StorageMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.hspedu.springcloud.dao.StorageDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.hspedu.springcloud.entity.Storage&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;product_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;productId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;amount&quot;</span> <span class="attr">property</span>=<span class="string">&quot;amount&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 减少库存 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;reduce&quot;</span>&gt;</span></span><br><span class="line">        UPDATE</span><br><span class="line">            storage</span><br><span class="line">        SET</span><br><span class="line">            amount = amount - #&#123;nums&#125;</span><br><span class="line">        WHERE</span><br><span class="line">            product_id = #&#123;productId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>8.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;StorageService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StorageService</span> &#123;</span><br><span class="line">    <span class="comment">// 扣减库存</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Long productId, Integer nums)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>9.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;impl&#x2F;StorageServiceImpl.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StorageServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">StorageService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    private static final Logger LOGGER = LoggerFactory.getLogger(StorageServiceImpl.class);</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StorageDao storageDao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Long productId, Integer nums)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;==========seata_storage_micro_service-10010 扣 减 库 存 start==========&quot;</span>);</span><br><span class="line">        storageDao.reduce(productId, nums);</span><br><span class="line">        log.info(<span class="string">&quot;==========seata_storage_micro_service-10010 扣 减 库 存 end==========&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>10.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;StorageController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StorageController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StorageService storageService;</span><br><span class="line">    <span class="comment">//扣减库存</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/storage/reduce&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">reduce</span><span class="params">(Long productId, Integer nums)</span> &#123;</span><br><span class="line">        storageService.reduce(productId, nums);</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;扣减库存成功 ok&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>11.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;MyBatisConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&#123;&quot;com.hspedu.springcloud.dao&quot;&#125;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>12.</strong> <strong>创建com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;DataSourceProxyConfig.java ,常规配置(拿来使用即可)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.datasource.DataSourceProxy;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.transaction.SpringManagedTransactionFactory; <span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 浦原</span></span><br><span class="line"><span class="comment"> * 2023/7/3</span></span><br><span class="line"><span class="comment"> * 11:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProxyConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;mybatis.mapperLocations&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mapperLocations;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druidDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProxy <span class="title function_">dataSourceProxy</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProxy</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSourceProxy dataSourceProxy)</span></span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>(); sqlSessionFactoryBean.setDataSource(dataSourceProxy);</span><br><span class="line">                sqlSessionFactoryBean.setMapperLocations(<span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>().getResources(mapperLocations));</span><br><span class="line">        sqlSessionFactoryBean.setTransactionFactory(<span class="keyword">new</span> <span class="title class_">SpringManagedTransactionFactory</span>()); <span class="keyword">return</span> sqlSessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>13.</strong> <strong>创 建 主 启 动 类</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;SeataStorageMicroServiceApplication10010.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 浦原</span></span><br><span class="line"><span class="comment"> * 2023/7/3</span></span><br><span class="line"><span class="comment"> * 12:24</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeataStorageMicroServiceApplication10010</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SeataStorageMicroServiceApplication10010.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-4-4-测试-seata-storage-micro-service-10010-微服务"><a href="#11-4-4-测试-seata-storage-micro-service-10010-微服务" class="headerlink" title="11.4.4 测试 seata_storage_micro_service-10010 微服务"></a><strong>11.4.4</strong> 测试 <strong>seata_storage_micro_service-10010</strong> 微服务</h3><h4 id="11-4-4-1-启动-Nacos-Server-8848"><a href="#11-4-4-1-启动-Nacos-Server-8848" class="headerlink" title="11.4.4.1 启动 Nacos Server 8848"></a>11.4.4.1 启动 Nacos Server 8848</h4><h4 id="11-4-4-2-双击-Seata-的-bin-seata-server-bat-启动-Seata-Server"><a href="#11-4-4-2-双击-Seata-的-bin-seata-server-bat-启动-Seata-Server" class="headerlink" title="11.4.4.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server"></a>11.4.4.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server</h4><h4 id="11-4-4-3-启动-seata-storage-micro-service-10010"><a href="#11-4-4-3-启动-seata-storage-micro-service-10010" class="headerlink" title="11.4.4.3 启动 seata_storage_micro_service-10010"></a>11.4.4.3 启动 seata_storage_micro_service-10010</h4><h4 id="11-4-4-4-登录-Nacos-Server-查看-10010-微服务是否注册成功"><a href="#11-4-4-4-登录-Nacos-Server-查看-10010-微服务是否注册成功" class="headerlink" title="11.4.4.4 登录 Nacos Server , 查看 10010 微服务是否注册成功"></a>11.4.4.4 登录 Nacos Server , 查看 10010 微服务是否注册成功</h4><p><strong>1.</strong> 登录 <strong>Nacos Server,</strong> 查看 <strong>10010</strong> 是否注册成功</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703125536604.png" alt="image-20230703125536604"></p>
<h3 id="11-4-5-开发-seata-account-micro-service-10012-微服务"><a href="#11-4-5-开发-seata-account-micro-service-10012-微服务" class="headerlink" title="11.4.5 开发 seata_account_micro_service-10012 微服务"></a><strong>11.4.5</strong> 开发 <strong>seata_account_micro_service-10012</strong> 微服务</h3><p>(account模块，参照上面storage模块的创建过程即可)</p>
<p><strong>1.</strong> 参考以前的方式，创建 <strong>seata_account_micro_service-10012</strong> 微服务模块</p>
<p><strong>2.</strong> <strong>修改</strong> <strong>pom.xml,</strong> <strong>添加相关的</strong> <strong>jar</strong> <strong>依赖</strong></p>
<p><strong>3.</strong> <strong>创建</strong> <strong>application.yml,</strong> <strong>进行相关的配置</strong></p>
<p><strong>4.1</strong> <strong>创建</strong> <strong>file.conf,</strong> <strong>进行相关的配置</strong>, <strong>说明:该文件从</strong> <strong>seata</strong> <strong>的</strong>\conf\file.conf <strong>拷贝，进行修 改即可</strong></p>
<p><strong>4.2</strong> <strong>创建</strong> <strong>registry.conf,</strong> <strong>进行相关的配置</strong>, <strong>说明:该文件从</strong> <strong>seata</strong> <strong>的</strong>\conf\registry.conf <strong>拷贝， 进行修改即可</strong></p>
<p><strong>5.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;entity&#x2F;Account.java</strong></p>
<p><strong>6.</strong> <strong>创建</strong> com&#x2F;hspedu&#x2F;springcloud&#x2F;dao&#x2F;AccountDao.java</p>
<p><strong>7.</strong> <strong>创建</strong> **resources&#x2F;**mapper&#x2F;AccountMapper.xml</p>
<p><strong>8.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;AccountService.java</strong></p>
<p><strong>9.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;impl&#x2F;AccountServiceImpl.java</strong></p>
<p><strong>10.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;AccountController.java</strong></p>
<p><strong>11.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;MyBatisConfig.java</strong></p>
<p><strong>12.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;DataSourceProxyConfig.java ,</strong> <strong>常规配置</strong>(拿来使用即可)</p>
<p><strong>13.</strong> <strong>创 建 主 启 动 类</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;SeataAccountMicroServiceApplication10012.java</strong></p>
<h3 id="11-4-6-测试-seata-account-micro-service-10012-微服务"><a href="#11-4-6-测试-seata-account-micro-service-10012-微服务" class="headerlink" title="11.4.6 测试 seata_account_micro_service-10012 微服务"></a><strong>11.4.6</strong> 测试 <strong>seata_account_micro_service-10012</strong> 微服务</h3><h4 id="11-4-6-1-启动-Nacos-Server-8848"><a href="#11-4-6-1-启动-Nacos-Server-8848" class="headerlink" title="11.4.6.1 启动 Nacos Server 8848"></a>11.4.6.1 启动 Nacos Server 8848</h4><h4 id="11-4-6-2-双击-Seata-的-bin-seata-server-bat-启动-Seata-Server"><a href="#11-4-6-2-双击-Seata-的-bin-seata-server-bat-启动-Seata-Server" class="headerlink" title="11.4.6.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server"></a>11.4.6.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server</h4><h4 id="11-4-6-3-启动-seata-account-micro-service-10012"><a href="#11-4-6-3-启动-seata-account-micro-service-10012" class="headerlink" title="11.4.6.3 启动 seata_account_micro_service-10012"></a>11.4.6.3 启动 seata_account_micro_service-10012</h4><h4 id="11-4-6-4-登录-Nacos-Server-查看-10012-微服务是否注册成功"><a href="#11-4-6-4-登录-Nacos-Server-查看-10012-微服务是否注册成功" class="headerlink" title="11.4.6.4 登录 Nacos Server , 查看 10012 微服务是否注册成功"></a>11.4.6.4 登录 Nacos Server , 查看 10012 微服务是否注册成功</h4><p><strong>1.</strong> 登录 <strong>Nacos Server,</strong> 查看 <strong>10012</strong> 是否注册成功</p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703143135194.png" alt="image-20230703143135194"></p>
<p><strong>11.4.7</strong> 开发 <strong>seata-order-micro-service-10008</strong> 微服务</p>
<p>(Order模块，参照上面storage模块的创建过程即可)</p>
<p><strong>1.</strong> 参考以前的方式，创建 <strong>seata-order-micro-service-10008</strong> 微服务模块</p>
<p><strong>2.</strong> <strong>修改</strong> <strong>pom.xml,</strong> <strong>添加相关的</strong> <strong>jar</strong> <strong>依赖</strong></p>
<p><strong>3.</strong> <strong>创建</strong> <strong>application.yml,</strong> <strong>进行相关的配置</strong></p>
<p><strong>4.1</strong> <strong>创建</strong> <strong>file.conf,</strong> <strong>进行相关的配置</strong>, <strong>说明:该文件从</strong> <strong>seata</strong> <strong>的</strong>\conf\file.conf <strong>拷贝，进行修 改即可</strong></p>
<p><strong>4.2</strong> <strong>创建</strong> <strong>registry.conf,</strong> <strong>进行相关的配置</strong>, <strong>说明:该文件从</strong> <strong>seata</strong> <strong>的</strong>\conf\registry.conf <strong>拷贝， 进行修改即可</strong></p>
<p><strong>5.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;entity&#x2F;Order.java</strong></p>
<p><strong>6.</strong> <strong>创建</strong> com&#x2F;hspedu&#x2F;springcloud&#x2F;dao&#x2F;OrderDao.java</p>
<p><strong>7.</strong> <strong>创建</strong> **resources&#x2F;**mapper&#x2F;OrderMapper.xml</p>
<p><strong>8.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;OrderService.java</strong></p>
<p><strong>9.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;AccountService.java</strong></p>
<p><strong>10.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;impl&#x2F;OrderServiceImpl.java</strong></p>
<p><strong>11.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;OrderController.java</strong></p>
<p><strong>12.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;MyBatisConfig.java</strong></p>
<p><strong>13.</strong> <strong>创建</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;DataSourceProxyConfig.java ,</strong> <strong>常规配置</strong>(拿来使用即可)</p>
<p><strong>14.</strong> <strong>创 建 主 启 动 类</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;SeataOrderMicroServiceApplication10008.java</strong></p>
<h3 id="11-4-8-测试-seata-order-micro-service-10008-微服务"><a href="#11-4-8-测试-seata-order-micro-service-10008-微服务" class="headerlink" title="11.4.8 测试 seata-order-micro-service-10008 微服务"></a><strong>11.4.8</strong> 测试 <strong>seata-order-micro-service-10008</strong> 微服务</h3><p>……</p>
<h3 id="11-4-9-集成测试-1-三个微服务协同完成-正常下单"><a href="#11-4-9-集成测试-1-三个微服务协同完成-正常下单" class="headerlink" title="11.4.9 集成测试**(1)** 三个微服务协同完成**-**正常下单"></a><strong>11.4.9</strong> 集成测试**(1)** 三个微服务协同完成**-**正常下单</h3><h4 id="11-4-9-1-启动-Nacos-Server-8848"><a href="#11-4-9-1-启动-Nacos-Server-8848" class="headerlink" title="11.4.9.1 启动 Nacos Server 8848"></a>11.4.9.1 启动 Nacos Server 8848</h4><h4 id="11-4-9-2-双击-Seata-的-bin-seata-server-bat-启动-Seata-Server"><a href="#11-4-9-2-双击-Seata-的-bin-seata-server-bat-启动-Seata-Server" class="headerlink" title="11.4.9.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server"></a>11.4.9.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server</h4><h4 id="11-4-9-3-启动-seata-order-micro-service-10010-x2F-10012-x2F-10008-三个微服务"><a href="#11-4-9-3-启动-seata-order-micro-service-10010-x2F-10012-x2F-10008-三个微服务" class="headerlink" title="11.4.9.3 启动 seata-order-micro-service-10010 &#x2F;10012&#x2F;10008 三个微服务"></a>11.4.9.3 启动 seata-order-micro-service-10010 &#x2F;10012&#x2F;10008 三个微服务</h4><h4 id="11-4-9-4-浏览器-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100"><a href="#11-4-9-4-浏览器-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100" class="headerlink" title="11.4.9.4 浏览器 : http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100"></a>11.4.9.4 浏览器 : <a target="_blank" rel="noopener" href="http://localhost:10008/order/save?userId=666&productId=1&nums=1&money=100">http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100</a></h4><p><strong>1.</strong> 浏 览 器 <strong>: <a target="_blank" rel="noopener" href="http://localhost:10008/order/save?userId=666&productId=1&nums=1&money=100">http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100</a></strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703143712667.png" alt="image-20230703143712667"></p>
<p><strong>2.</strong> <strong>查看数据库&#x2F;表的情况是否正常,结论:如果没有异常出现，正常下单，数据库三张表 数据一致性是OK的</strong></p>
<h4 id="11-4-9-5-注意事项和细节"><a href="#11-4-9-5-注意事项和细节" class="headerlink" title="11.4.9.5 注意事项和细节"></a>11.4.9.5 注意事项和细节</h4><p><strong>1. MySQL</strong> 出现 <strong>too many connections</strong>(<strong>1040</strong>)错误解决方法：</p>
<p>在 <strong>my.ini</strong> 设置 </p>
<p><strong>max_connections&#x3D;1000</strong></p>
<p><strong>2.</strong> 如果出现**: service id not legal hostname<br>** 报错 <strong>Service id not legal hostname</strong> 的原因是服务名称不能带有下划线，可以使用中划线**,**</p>
<p><strong>springcloud</strong> 无法识别下划线，把下划线改成中划线就好</p>
<h3 id="11-4-10-集成测试-2-三个微服务协同完成-模拟异常"><a href="#11-4-10-集成测试-2-三个微服务协同完成-模拟异常" class="headerlink" title="11.4.10 集成测试**(2)** 三个微服务协同完成**-**模拟异常"></a><strong>11.4.10</strong> 集成测试**(2)** 三个微服务协同完成**-**模拟异常</h3><h4 id="11-4-10-1-启动-Nacos-Server-8848"><a href="#11-4-10-1-启动-Nacos-Server-8848" class="headerlink" title="11.4.10.1 启动 Nacos Server 8848"></a>11.4.10.1 启动 Nacos Server 8848</h4><h4 id="11-4-10-2-双击-Seata-的-bin-seata-server-bat-启动-Seata-Server"><a href="#11-4-10-2-双击-Seata-的-bin-seata-server-bat-启动-Seata-Server" class="headerlink" title="11.4.10.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server"></a>11.4.10.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server</h4><h4 id="11-4-10-3-启动-seata-order-micro-service-100010-x2F-10012-x2F-10008-三个微服务"><a href="#11-4-10-3-启动-seata-order-micro-service-100010-x2F-10012-x2F-10008-三个微服务" class="headerlink" title="11.4.10.3 启动 seata-order-micro-service-100010 &#x2F;10012&#x2F;10008 三个微服务"></a>11.4.10.3 启动 seata-order-micro-service-100010 &#x2F;10012&#x2F;10008 三个微服务</h4><h4 id="11-4-10-4-浏览器-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100"><a href="#11-4-10-4-浏览器-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100" class="headerlink" title="11.4.10.4 浏览器 : http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100"></a>11.4.10.4 浏览器 : <a target="_blank" rel="noopener" href="http://localhost:10008/order/save?userId=666&productId=1&nums=1&money=100">http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100</a></h4><p><strong>1.</strong> 修 改 <strong>seata_account_micro_service-10012</strong> 的<strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;AccountController.java</strong>， 模拟异常出现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/account/reduce&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">result</span><span class="params">(<span class="meta">@RequestParam(&quot;userId&quot;)</span> Long userId, <span class="meta">@RequestParam(&quot;money&quot;)</span> Integer money)</span>&#123;</span><br><span class="line"><span class="comment">//模拟异常, 超时</span></span><br><span class="line"><span class="comment">//openfeign 接口调用默认超时时间为 1s try &#123;</span></span><br><span class="line">TimeUnit.SECONDS.sleep(<span class="number">12</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace(); &#125;</span><br><span class="line">accountService.reduce(userId,money);</span><br><span class="line"><span class="keyword">return</span> Result.success(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;扣减账户余额 OK&quot;</span>); &#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.</strong> <strong>浏 览 器</strong> <strong>: <a target="_blank" rel="noopener" href="http://localhost:10008/order/save?userId=666&productId=1&nums=1&money=100">http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100</a></strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703143951841.png" alt="image-20230703143951841"></p>
<p><strong>3.</strong> <strong>查看数据库&#x2F;表的情况是否正常</strong></p>
<p><strong>结论</strong>:这时数据库&#x2F;表，出现数据不一致现象, 订单是<u>未支付</u>，但是<u>库存减少了</u>，账号<u>钱也扣了</u>(提示:等休眠时间完成后，再查看account表，会看到数据不一致)</p>
<h3 id="11-4-11-集成测试-3-三个微服务协同完成-使用-GlobalTransactional-完成分布式事务控制-出现异常，也能保证数据一致性"><a href="#11-4-11-集成测试-3-三个微服务协同完成-使用-GlobalTransactional-完成分布式事务控制-出现异常，也能保证数据一致性" class="headerlink" title="11.4.11 集成测试**(3)** 三个微服务协同完成**-使用@GlobalTransactional** 完成分布式事务控制(出现异常，也能保证数据一致性)"></a><strong>11.4.11</strong> 集成测试**(3)** 三个微服务协同完成**-<strong>使用</strong>@GlobalTransactional** 完成分布式事务控制(出现异常，也能保证数据一致性)</h3><h4 id="11-4-11-1-启动-Nacos-Server-8848"><a href="#11-4-11-1-启动-Nacos-Server-8848" class="headerlink" title="11.4.11.1 启动 Nacos Server 8848"></a>11.4.11.1 启动 Nacos Server 8848</h4><h4 id="11-4-11-2-双击-Seata-的-bin-seata-server-bat-启动-Seata-Server"><a href="#11-4-11-2-双击-Seata-的-bin-seata-server-bat-启动-Seata-Server" class="headerlink" title="11.4.11.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server"></a>11.4.11.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server</h4><h4 id="11-4-11-3-启动-seata-order-micro-service-10008-x2F-10010-x2F-10012-三个微服务"><a href="#11-4-11-3-启动-seata-order-micro-service-10008-x2F-10010-x2F-10012-三个微服务" class="headerlink" title="11.4.11.3 启动 seata-order-micro-service-10008 &#x2F;10010&#x2F;10012 三个微服务"></a>11.4.11.3 启动 seata-order-micro-service-10008 &#x2F;10010&#x2F;10012 三个微服务</h4><h4 id="11-4-11-4-浏览器-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100"><a href="#11-4-11-4-浏览器-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100" class="headerlink" title="11.4.11.4 浏览器 : http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100"></a>11.4.11.4 浏览器 : <a target="_blank" rel="noopener" href="http://localhost:10008/order/save?userId=666&productId=1&nums=1&money=100">http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100</a></h4><p><strong>1.</strong> 修 改 <strong>seata_account_micro_service-10012</strong> 的 <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;AccountController.java</strong>， 模拟异常出现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">AccountService accountService; </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 扣减账户余额</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/account/reduce&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">result</span><span class="params">(<span class="meta">@RequestParam(&quot;userId&quot;)</span> Long userId, <span class="meta">@RequestParam(&quot;money&quot;)</span> Integer money)</span>&#123;</span><br><span class="line">	<span class="comment">//模拟异常, 超时，或者 int i = 9 / 0; </span></span><br><span class="line">  <span class="comment">//openfeign 接口调用默认超时时间为 1s</span></span><br><span class="line">  <span class="comment">//说明 1. 也可以使用其它方式模拟异常, 但在 Debug 看 Seata 分布式事务机制不方便, 不好看效果 , 所以这里我们使用超时异常</span></span><br><span class="line">	<span class="comment">//说明 2. 因为是超时异常, 所以在 Debug 分析 Seata 机制时, 可能会发现某张表 被锁几条记录, 因为 seata 会做最终一致性操作(即尝试再提交上次超时的事务).</span></span><br><span class="line">	<span class="keyword">try</span> &#123; </span><br><span class="line">    TimeUnit.SECONDS.sleep(<span class="number">12</span>);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (InterruptedException e) &#123; </span><br><span class="line">    e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	accountService.reduce(userId,money);</span><br><span class="line">	<span class="keyword">return</span> Result.success(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;扣减账户余额 OK&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>**2.**修 改 <strong>seata-order-micro-service-10008</strong> <strong>的</strong>com&#x2F;study&#x2F;springcloud&#x2F;service&#x2F;impl&#x2F;OrderServicelmpl.java</p>
<p><strong>使用<u>@GlobalTransactional</u>控制分布式事务，保证数据一致性</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 创建订单-&gt;调用库存服务扣减库存-&gt;调用账户服务扣减账户余额-&gt;修改订单状态 </span></span><br><span class="line"><span class="comment">* 解读</span></span><br><span class="line"><span class="comment">* 1. <span class="doctag">@GlobalTransactional</span>: 分布式全局事务控制</span></span><br><span class="line"><span class="comment">* 2. name = &quot;hspedu-save-order&quot; 名称自己写，保证唯一即可</span></span><br><span class="line"><span class="comment">* 3. rollbackFor = Exception.class 指定发生什么异常就回滚，</span></span><br><span class="line"><span class="comment">* 这里指定只要发生异常就回滚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="comment">//下面这句话是做全局事务控制的, 如果没有，则没有分布式全局事务控制 </span></span><br><span class="line"><span class="meta">@GlobalTransactional(name = &quot;hspedu-save-order&quot;, rollbackFor = Exception.class)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">	log.info(<span class="string">&quot;=========开始新建订单 start ==========&quot;</span>); </span><br><span class="line">  <span class="comment">//新建订单</span></span><br><span class="line">	orderDao.save(order);</span><br><span class="line">	System.out.println(<span class="string">&quot;order=&quot;</span> + order); </span><br><span class="line">  log.info(<span class="string">&quot;=========减库存 start ==========&quot;</span>); 	</span><br><span class="line">  storageService.reduce(order.getProductId(), order.getNums()); </span><br><span class="line">  log.info(<span class="string">&quot;=========减库存 end ==========&quot;</span>);</span><br><span class="line">	log.info(<span class="string">&quot;=========减账户金额 start ==========&quot;</span>); </span><br><span class="line">  accountService.reduce(order.getUserId(), order.getMoney()); </span><br><span class="line">  log.info(<span class="string">&quot;=========减账户金额 end ==========&quot;</span>);</span><br><span class="line">	log.info(<span class="string">&quot;=========修改订单状态 start ==========&quot;</span>); </span><br><span class="line">  orderDao.update(order.getUserId(), <span class="number">0</span>); </span><br><span class="line">  log.info(<span class="string">&quot;=========修改订单状态 end ==========&quot;</span>); </span><br><span class="line">  log.info(<span class="string">&quot;=========下订单 end==========&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>3.</strong> <strong>重启</strong> <strong>seata-order-micro-service-10008</strong></p>
<p><strong>4.</strong> <strong>浏 览 器</strong> <strong>: <a target="_blank" rel="noopener" href="http://localhost:10008/order/save?userId=666&productId=1&nums=1&money=100">http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100</a></strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703143951841.png" alt="image-20230703143951841"></p>
<p><strong>5.</strong> 查看数据库&#x2F;表的情况是否正常, 结论:这时数据库&#x2F;表，数据不一致性得到保证.</p>
<h3 id="11-4-12-注意事项和细节"><a href="#11-4-12-注意事项和细节" class="headerlink" title="11.4.12 注意事项和细节"></a><strong>11.4.12</strong> 注意事项和细节</h3><h4 id="11-4-12-1-如果数据库-x2F-表使用到关键字，需要使用反引号"><a href="#11-4-12-1-如果数据库-x2F-表使用到关键字，需要使用反引号" class="headerlink" title="11.4.12.1 如果数据库&#x2F;表使用到关键字，需要使用反引号"></a>11.4.12.1 如果数据库&#x2F;表使用到关键字，需要使用反引号</h4><ul>
<li>举例说明**:** 比如<strong>mapper&#x2F;OrderMapper.xml ,</strong> 这里的 <strong>order</strong> 就要使用**&#96;&#96;,** 否则会报错</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;save&quot;</span>&gt;</span></span><br><span class="line">	insert into `order` (id,user_id,product_id,nums,money,status) </span><br><span class="line">  values (null,#&#123;userId&#125;,#	&#123;productId&#125;,#&#123;nums&#125;,#&#123;money&#125;,0);</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">	update `order` set status = 1</span><br><span class="line">	where user_id=#&#123;userId&#125; and status = #&#123;status&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="11-4-12-2-openfeign在远程调用api接口时，默认超时时间为1s"><a href="#11-4-12-2-openfeign在远程调用api接口时，默认超时时间为1s" class="headerlink" title="11.4.12.2 openfeign在远程调用api接口时，默认超时时间为1s"></a>11.4.12.2 openfeign在远程调用api接口时，默认超时时间为1s</h4></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://Tangjiayang.github.io">donn</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://tangjiayang.github.io/2023/06/02/SpringCloud/">https://tangjiayang.github.io/2023/06/02/SpringCloud/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringCloud/">SpringCloud</a><a class="post-meta__tags" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a><a class="post-meta__tags" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> Donate</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/06/02/SpringBoot/" title="SpringBoot"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">SpringBoot</div></div></a></div><div class="next-post pull-right"><a href="/2023/06/02/hexo-%E5%86%99%E6%96%87%E7%AB%A0%E6%AD%A5%E9%AA%A4/" title="hexo 写文章步骤"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">hexo 写文章步骤</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81ODUzNy8zNTAwMA=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/./img/bg.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">donn</div><div class="author-info__description">欢迎访问donn的博客!</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">12</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Tangjiayang"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Tangjiayang" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">小站成立于2023-5-27！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Spring-Cloud-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">1 Spring Cloud 基本介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="toc-text">1.1 官方文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-1"><span class="toc-text">1.1.1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80-https-spring-io-projects-spring-cloud"><span class="toc-text">地址**: https:&#x2F;&#x2F;spring.io&#x2F;projects&#x2F;spring-cloud**</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BC%95%E5%87%BA"><span class="toc-text">1.2 微服务引出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%B2%A1%E6%9C%89%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF-%E6%98%AF%E4%B8%8D%E6%98%AF%E7%A8%8B%E5%BA%8F%E5%91%98%E5%B0%B1%E4%B8%8D%E8%83%BD%E5%BC%80%E5%8F%91%E5%A4%A7%E5%9E%8B%E9%A1%B9%E7%9B%AE"><span class="toc-text">1.没有微服务技术**,是不是程序员就不能开发大型项目?**</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%A0%87%E5%87%86%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-springcloud-%E5%92%8Ccloud-alibaba-%E5%87%BA%E7%8E%B0%E5%8E%9F%E5%9B%A0%E5%92%8C%E4%BB%B7%E5%80%BC%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">2.标准的微服务解决方案(springcloud 和cloud alibaba)出现原因和价值是什么?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%B8%80%E5%9B%BE%E8%83%9C%E5%8D%83%E8%A8%80"><span class="toc-text">3. 一图胜千言</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E7%9A%84%E6%BC%94%E5%8F%98%E8%BF%87%E7%A8%8B"><span class="toc-text">1.3 系统架构的演变过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1%E5%8D%95%E4%BD%93%E6%9E%B6%E6%9E%84%EF%BC%9A"><span class="toc-text">1.3.1单体架构：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB%E6%9E%B6%E6%9E%84%EF%BC%9A"><span class="toc-text">1.3.2动静分离架构：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%EF%BC%9A"><span class="toc-text">1.3.3分布式架构：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-4%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%9A"><span class="toc-text">1.3.4微服务架构：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-Spring-Colud%E5%85%A8%E9%9D%A2%E8%AF%B4%E6%98%8E"><span class="toc-text">1.4 Spring Colud全面说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Springcloud-%E6%9D%A5%E6%BA%90%E4%BA%8E-Spring%EF%BC%8C%E6%98%AF%E6%9B%B4%E9%AB%98%E5%B1%82%E6%AC%A1%E7%9A%84%E3%80%81-%E6%9E%B6%E6%9E%84%E8%A7%86%E8%A7%92%E7%9A%84%E7%BB%BC%E5%90%88%E6%80%A7%E5%A4%A7%E5%9E%8B%E9%A1%B9%E7%9B%AE%EF%BC%8C-%E7%9B%AE%E6%A0%87%E6%97%A8%E5%9C%A8%E6%9E%84%E5%BB%BA%E4%B8%80%E5%A5%97%E6%A0%87%E5%87%86%E5%8C%96%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%8C%E8%AE%A9%E6%9E%B6%E6%9E%84%E5%B8%88%E5%9C%A8%E4%BD%BF%E7%94%A8%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%90%86%E5%BF%B5%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%97%B6%EF%BC%8C-%E9%9D%A2%E5%AF%B9%E5%90%84%E7%8E%AF%E8%8A%82%E7%9A%84%E9%97%AE%E9%A2%98%E9%83%BD%E5%8F%AF%E4%BB%A5%E6%89%BE%E5%88%B0%E7%9B%B8%E5%BA%94%E7%9A%84%E7%BB%84%E4%BB%B6%E6%9D%A5%E5%A4%84%E7%90%86"><span class="toc-text">1.Springcloud 来源于 Spring，是更高层次的、 架构视角的综合性大型项目， 目标旨在构建一套标准化的微服务解决方案，让架构师在使用微服务理念构建系统的时， 面对各环节的问题都可以找到相应的组件来处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Spring-Cloud-%E6%98%AFSpring-%E7%A4%BE%E5%8C%BA%E4%B8%BA%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%80%E4%B8%AA-%E2%80%9C%E5%85%A8%E5%AE%B6%E6%A1%B6%E2%80%9D-%E5%A5%97%E9%A4%90%E3%80%82%E5%A5%97%E9%A4%90%E4%B8%AD%E5%90%84%E4%B8%AA%E7%BB%84%E4%BB%B6%E4%B9%8B%E9%97%B4%E7%9A%84%E9%85%8D%E5%90%88%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%87%8F%E5%B0%91%E5%9C%A8%E7%BB%84%E4%BB%B6%E7%9A%84%E9%80%89%E5%9E%8B%E5%92%8C%E6%95%B4%E5%90%88%E4%B8%8A%E8%8A%B1%E8%B4%B9%E7%9A%84%E7%B2%BE%E5%8A%9B%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA%E8%B5%B7%E5%9F%BA%E7%A1%80%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%B3%BB%E7%BB%9F%EF%BC%8C%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%9A%84%E6%9C%80%E4%BD%B3%E8%90%BD%E5%9C%B0%E6%96%B9%E6%A1%88"><span class="toc-text">2.Spring Cloud 是Spring 社区为微服务架构提供的一个 “全家桶” 套餐。套餐中各个组件之间的配合，可以减少在组件的选型和整合上花费的精力，可以快速构建起基础的微服务架构系统，是微服务架构的最佳落地方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Spirng-Cloud-%E5%A4%A9%E7%84%B6%E6%94%AF%E6%8C%81-spring-Boot-%E6%9C%89%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E8%A6%81%E6%B1%82-%EF%BC%8C%E4%BD%BF%E7%94%A8%E9%97%A8%E6%A7%9B%E8%BE%83%E4%BD%8E"><span class="toc-text">3.Spirng Cloud 天然支持 spring Boot(有版本对应要求)，使用门槛较低</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%A7%A3%E5%86%B3%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3%E7%9A%84%E5%A4%8D%E6%9D%82%E6%80%A7-%E4%B8%80%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98%EF%BC%8C%E5%BB%B6%E8%BF%9F%E5%BC%80%E9%94%80%EF%BC%8C%E5%B8%A6%E5%AE%BD%E5%90%91%E9%A2%98%EF%BC%8C%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-text">4.解决与分布式系统相关的复杂性 一网络问题，延迟开销，带宽向题，安全问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%A4%84%E7%90%86%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E7%9A%84%E8%83%BD%E5%8A%9B-%E4%B8%80-%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E5%85%81%E8%AE%B8%E9%9B%86%E7%BE%A4%E4%B8%AD%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%92%8C%E6%9C%8D%E5%8A%A1%E6%89%BE%E5%88%B0%E5%BD%BC%E6%AD%A4%E5%B9%B6%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1"><span class="toc-text">5.处理服务发现的能力 一 服务发现允许集群中的进程和服务找到彼此并进行通信</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E8%A7%A3%E6%B1%BA%E5%86%97%E4%BD%99%E9%97%AE%E9%A2%98-%E4%B8%80-%E5%85%83%E4%BD%99%E9%97%AE%E9%A2%98%E7%BB%8F%E5%B8%B8%E5%8F%91%E7%94%9F%E5%9C%A8%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%AD"><span class="toc-text">6.解決冗余问题 一 元余问题经常发生在分布式系统中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E8%A7%A3%E5%86%B3%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1-%E4%B8%80-%E6%94%B9%E8%BF%9B%E8%B7%A8%E5%A4%9A%E4%B8%AA%E8%AE%A1%E7%AE%97%E8%B5%84%E6%BA%90%EF%BC%88%E4%BE%8B%E5%A6%82%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%9B%86%E7%BE%A4%EF%BC%8C%E7%BD%91%E7%BB%9C%E9%93%BE%E6%8E%A5%EF%BC%8C%E4%B8%AD%E5%A4%AE%E5%A4%84%E7%90%86%E5%8D%95%E5%85%83%EF%BC%89%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD%E5%88%86%E5%B8%83"><span class="toc-text">7.解决负载均衡 一 改进跨多个计算资源（例如计算机集群，网络链接，中央处理单元）的工作负载分布</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-Spring-Cloud-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E5%9B%BE"><span class="toc-text">1.5 Spring Cloud 核心组件图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-1-%E6%96%87%E6%A1%A3-https-spring-io-projects-spring-cloud"><span class="toc-text">1.5.1 文档 : https:&#x2F;&#x2F;spring.io&#x2F;projects&#x2F;spring-cloud</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-2%E4%B8%80%E5%9B%BE%E8%83%9C%E5%8D%83%E8%A8%80"><span class="toc-text">1.5.2一图胜千言</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-Spring-Cloud-%E5%88%86%E5%B8%83%E5%BC%8F%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="toc-text">1.6 Spring Cloud 分布式示意图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-1-%E6%96%87%E6%A1%A3-https-spring-io-microservices"><span class="toc-text">1.6.1 文档 : https:&#x2F;&#x2F;spring.io&#x2F;microservices</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-2-%E4%B8%80%E5%9B%BE%E8%83%9C%E5%8D%83%E8%A8%80"><span class="toc-text">1.6.2 一图胜千言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-3-SpringCloud%E5%92%8CSpringBoot%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB"><span class="toc-text">1.6.3 SpringCloud和SpringBoot版本对应关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-Spring-Cloud-%E7%BB%84%E4%BB%B6%E9%80%89%E5%9E%8B"><span class="toc-text">1.7 Spring Cloud 组件选型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Spring-Cloud-Alibaba-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">2 Spring Cloud Alibaba 基本介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="toc-text">2.1 官方文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E8%8B%B1%E6%96%87%E5%9C%B0%E5%9D%80-https-github-com-alibaba-spring-cloud-alibaba"><span class="toc-text">2.1.1 英文地址**: https:&#x2F;&#x2F;github.com&#x2F;alibaba&#x2F;spring-cloud-alibaba**</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2%E8%8B%B1-%E6%96%87-%E5%9C%B0-%E5%9D%80-%E4%B8%AD-%E6%96%87-%E6%96%87-%E6%A1%A3-https-github-com-alibaba-spring-cloud-alibaba-blob-master-README-zh-md"><span class="toc-text">2.1.2英 文 地 址 : 中 文 文 档 : https:&#x2F;&#x2F;github.com&#x2F;alibaba&#x2F;spring-cloud-alibaba&#x2F;blob&#x2F;master&#x2F;README-zh.md</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-SpringCloudAlibaba%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">2.2 SpringCloudAlibaba是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%E4%B8%80%E8%A7%88"><span class="toc-text">2.3 主要功能一览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-Spring-Cloud-Alibaba-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-text">2.4 Spring Cloud Alibaba 核心组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-text">2.5: 分布式微服务技术选型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%A2Spring-Cloud-%E5%8E%9F%E7%94%9F%E7%BB%84%E4%BB%B6%E7%9A%84%E5%87%A0%E5%A4%A7%E7%97%9B%E7%82%B9"><span class="toc-text">•Spring Cloud 原生组件的几大痛点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%A2Spring-Cloud-Alibaba-%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-text">•Spring Cloud Alibaba 的优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B%E5%BB%BA%E8%AE%AE"><span class="toc-text">分布式微服务技术选型建议</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">3 微服务基础环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%88%9B%E5%BB%BA%E7%88%B6%E5%B7%A5%E7%A8%8B-%EF%BC%8C%E7%94%A8%E4%BA%8E%E8%81%9A%E5%90%88%E5%85%B6%E5%AE%83%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97"><span class="toc-text">3.1 创建父工程 ，用于聚合其它微服务模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E9%9C%80%E6%B1%82%E8%AF%B4%E6%98%8E-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">3.1.1 需求说明**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">3.1.2 实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-1-%E5%88%9B%E5%BB%BA%E7%88%B6%E9%A1%B9%E7%9B%AE-%E4%BD%9C%E4%B8%BA%E8%81%9A%E5%90%88%E5%85%B6%E5%AE%83%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97"><span class="toc-text">3.1.2.1 创建父项目, 作为聚合其它微服务模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-2-%E9%A1%B9%E7%9B%AE%E8%AE%BE%E7%BD%AE"><span class="toc-text">3.1.2.2 项目设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-4-%E9%85%8D%E7%BD%AE%E7%88%B6%E5%B7%A5%E7%A8%8B-pom-xml-%E4%BD%9C%E4%B8%BA%E8%81%9A%E5%90%88%E5%85%B6%E5%AE%83%E6%A8%A1%E5%9D%97"><span class="toc-text">3.1.2.4 配置父工程 pom.xml, 作为聚合其它模块</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">3.1.3 注意事项和细节</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-1-Maven%E7%9A%84dependencyManagement%E8%AF%B4%E6%98%8E"><span class="toc-text">3.1.3.1 Maven的dependencyManagement说明</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%88%9B%E5%BB%BA%E4%BC%9A%E5%91%98%E4%B8%AD%E5%BF%83%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97-service-provider"><span class="toc-text">3.2 创建会员中心微服务模块 -service provider</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E9%9C%80%E6%B1%82%E8%AF%B4%E6%98%8E"><span class="toc-text">3.2.1 需求说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E9%80%9A%E8%BF%87%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%8F%96%E4%BC%9A%E5%91%98%E4%BF%A1%E6%81%AF-%E9%80%9A%E8%BF%87%E4%BC%9A%E5%91%98%E4%B8%AD%E5%BF%83%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97"><span class="toc-text">1、通过浏览器可以获取会员信息**(通过会员中心微服务模块)**</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90"><span class="toc-text">3.2.2 思路分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">3.2.3 实现步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4-%F0%9F%8C%9F%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">3.2.4 🌟注意事项和细节</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%88%9B%E5%BB%BA%E4%BD%BF%E7%94%A8%E4%BC%9A%E5%91%98%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97-service-consumer"><span class="toc-text">3.3 创建使用会员微服务模块 -service consumer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E9%9C%80%E6%B1%82%E8%AF%B4%E6%98%8E-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">3.3.1 需求说明**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">3.3.2 思路分析**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">3.3.3 实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-1-%E5%88%9B%E5%BB%BA-Moduel-amp-%E5%AE%8C%E6%88%90%E9%85%8D%E7%BD%AE"><span class="toc-text">3.3.3.1 创建 Moduel &amp; 完成配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAModuel%EF%BC%9A"><span class="toc-text">创建Moduel：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-text">完成配置：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5-RestTemplate%EF%BC%9A"><span class="toc-text">注入 RestTemplate：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#RestTemplate%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%EF%BC%9A"><span class="toc-text">RestTemplate基本介绍：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%98%E7%BD%91%E5%9C%B0%E5%9D%80%EF%BC%9A"><span class="toc-text">官网地址：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E7%B1%BB-com-x2F-hspedu-x2F-springcloud-x2F-config-x2F-CustomizationBean-java"><span class="toc-text">创建配置类: com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;CustomizationBean.java</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-com-x2F-hspedu-x2F-springcloud-x2F-controller-x2F-MemberConsumerController-java"><span class="toc-text">创建:com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberConsumerController.java</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-2-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E4%BD%BF%E7%94%A8%E7%BB%86%E8%8A%82"><span class="toc-text">3.3.3.2 注意事项和使用细节</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BC%9A%E5%91%98%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E4%B8%BA-null-%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">添加会员数据库中为 null 的解决方案</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%90%AF-Run-DashBoard"><span class="toc-text">开启 Run DashBoard</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E5%88%9B%E5%BB%BA%E5%85%B1%E7%94%A8%E6%A8%A1%E5%9D%97-%E4%BE%9B%E5%85%B6%E5%AE%83%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8"><span class="toc-text">3.4 创建共用模块-供其它模块使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-%E9%9C%80%E6%B1%82%E8%AF%B4%E6%98%8E-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">3.4.1 需求说明**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">3.4.2 思路分析**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">3.4.3 实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-3-1-%E5%88%9B%E5%BB%BA-Moduel-amp-%E5%AE%8C%E6%88%90%E9%85%8D%E7%BD%AE"><span class="toc-text">3.4.3.1 创建 Moduel &amp; 完成配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-3-1-1-%E5%88%9B%E5%BB%BA-e-commerce-center-common-api"><span class="toc-text">3.4.3.1.1 创建 e_commerce_center-common-api</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9C%A8pom-xml%E4%B8%AD%E6%8F%90%E5%8F%96%E5%85%AC%E5%85%B1%E4%BE%9D%E8%B5%96"><span class="toc-text">在pom.xml中提取公共依赖</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8A%BD%E5%8F%96%E5%85%B1%E7%94%A8-API-x2F-%E7%B1%BB"><span class="toc-text">抽取共用 API&#x2F;类</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Maven-%E6%89%93%E5%8C%85%E6%88%90-jar"><span class="toc-text">使用 Maven 打包成 jar</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E9%87%8D%E6%9E%84"><span class="toc-text">工程重构</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-SpringCloud-Eureka-%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-text">4 SpringCloud Eureka 服务注册中心</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-Eureka%E4%BB%8B%E7%BB%8D"><span class="toc-text">4.1 Eureka介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E5%AD%A6-Eureka-%E5%89%8D%E7%9A%84%E8%AF%B4%E6%98%8E"><span class="toc-text">4.1.1 学 Eureka 前的说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81Spring-Cloud-%E7%BB%84%E4%BB%B6%E9%80%89%E5%9E%8B%E5%9B%BE"><span class="toc-text">1、Spring Cloud 组件选型图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E4%BB%8E%E4%B8%8A%E5%9B%BE%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%87%BA%EF%BC%8C%E7%9B%AE%E5%89%8D%E4%B8%BB%E6%B5%81%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C-amp-%E5%8F%91%E7%8E%B0%E7%9A%84%E7%BB%84%E4%BB%B6%E6%98%AF-Nacos%EF%BC%8C-%E4%BD%86%E6%98%AF-Eureka-%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AA%E8%80%81%E7%89%8C%E7%BB%8F%E5%85%B8%E7%9A%84-%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C-amp-%E5%8F%91%E7%8E%B0%E6%8A%80%E6%9C%AF%E8%BF%98%E6%98%AF%E6%9C%89%E5%BF%85%E8%A6%81%E5%AD%A6%E4%B9%A0%E4%B8%80%E4%B8%8B%EF%BC%8C%E5%8E%9F%E5%9B%A0%EF%BC%9A"><span class="toc-text">2、从上图可以看出，目前主流的服务注册&amp;发现的组件是 Nacos， 但是 Eureka 作为一个老牌经典的 服务注册&amp;发现技术还是有必要学习一下，原因：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90-%E5%BC%95%E5%87%BA-Eureka"><span class="toc-text">4.1.2 当前项目架构问题分析 **-**引出 Eureka</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-3-%E5%BC%95%E5%85%A5-Eureka-%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84"><span class="toc-text">4.1.3 引入 Eureka 项目架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%9B%BE%E8%83%9C%E5%8D%83%E8%A8%80"><span class="toc-text">一图胜千言</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-4-%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E4%BB%8B%E7%BB%8D"><span class="toc-text">4.1.4 服务治理介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-4-1-Eureka%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86"><span class="toc-text">4.1.4.1 Eureka实现服务治理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-4-2-%E5%9C%A8%E4%BC%A0%E7%BB%9F%E7%9A%84-rpc-%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E6%A1%86%E6%9E%B6%E4%B8%AD%EF%BC%8C%E7%AE%A1%E7%90%86%E6%AF%8F%E4%B8%AA%E6%9C%8D%E5%8A%A1%E4%B8%8E%E6%9C%8D%E5%8A%A1%E4%B9%8B%E9%97%B4%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E6%AF%94%E8%BE%83%E5%A4%8D%E6%9D%82%EF%BC%8C%E7%AE%A1%E7%90%86%E5%9B%B0%E9%9A%BE%EF%BC%8C%E6%89%80%E4%BB%A5-%E9%9C%80%E8%A6%81%E6%B2%BB%E7%90%86%E6%9C%8D%E5%8A%A1%E4%B9%8B%E9%97%B4%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB"><span class="toc-text">4.1.4.2 在传统的 rpc 远程调用框架中，管理每个服务与服务之间依赖关系比较复杂，管理困难，所以 需要治理服务之间依赖关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-4-3-%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8%E3%80%81%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E3%80%81%E5%AE%B9%E9%94%99%E7%AD%89%EF%BC%8C%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E4%B8%8E%E6%B3%A8%E5%86%8C%E3%80%82"><span class="toc-text">4.1.4.3 服务治理实现服务调用、负载均衡、容错等，实现服务发现与注册。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-4-4-%E4%BA%8C%E8%AF%B4%E5%88%86%E5%B8%83%E5%BC%8F%E5%BC%80%E5%8F%91-https-jingyan-baidu-com-article-46650658def479f549e5f83e-html"><span class="toc-text">4.1.4.4 二说分布式开发: https:&#x2F;&#x2F;jingyan.baidu.com&#x2F;article&#x2F;46650658def479f549e5f83e.html</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-5-%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%92%8C%E5%8F%91%E7%8E%B0"><span class="toc-text">4.1.5 服务注册和发现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%88%9B%E5%BB%BA%E5%8D%95%E6%9C%BA-Eureka-Server-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-text">4.2 创建单机 Eureka Server-注册中心</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-%E9%9C%80%E6%B1%82%E8%AF%B4%E6%98%8E-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">4.2.1 需求说明**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">4.2.2 实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-1-%E5%88%9B%E5%BB%BA-Moduel-amp-%E5%AE%8C%E6%88%90%E9%85%8D%E7%BD%AE"><span class="toc-text">4.2.2.1 创建 Moduel &amp; 完成配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-2-1-1-%E5%88%9B%E5%BB%BA-e-commerce-eureka-server-9001-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97-%E4%BD%9C%E4%B8%BA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-text">4.2.2.1.1 创建 e-commerce-eureka-server-9001 微服务模块**[**作为注册中心]</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-module"><span class="toc-text">创建 module</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-2-2-1-2-%E4%BF%AE%E6%94%B9-e-commerce-eureka-server-9001-%E7%9A%84-pom-xml-%E5%8A%A0%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">4.2.2.1.2 修改 e-commerce-eureka-server-9001 的 pom.xml , 加入依赖</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-2-2-1-3-%E5%88%9B%E5%BB%BA-resources-x2F-application-yml"><span class="toc-text">4.2.2.1.3 创建 resources&#x2F;application.yml</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4-2-2-1-4-%E5%88%9B%E5%BB%BA%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB-com-x2F-hspedu-x2F-springcloud-x2F-EurekaApplication-java"><span class="toc-text">4.2.2.1.4 创建主启动类 com&#x2F;hspedu&#x2F;springcloud&#x2F;EurekaApplication.java</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-%E5%B0%86-member-service-provider-10000-%E4%BD%9C-%E4%B8%BA-EurekaClient-%E6%B3%A8-%E5%86%8C-%E5%88%B0-e-commerce-eureka-server-9001-%E6%88%90%E4%B8%BA%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85"><span class="toc-text">4.2.3 将 member-service-provider-10000 作 为 EurekaClient 注 册 到 e-commerce-eureka-server-9001 成为服务提供者</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-1-%E6%9E%B6%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="toc-text">4.2.3.1 架构示意图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-2-%E4%BF%AE%E6%94%B9-member-service-provider-10000-%E7%9A%84-pom-xml"><span class="toc-text">4.2.3.2 修改 member-service-provider-10000 的 pom.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-3-%E4%BF%AE%E6%94%B9-member-service-provider-10000-%E7%9A%84-resources-x2F-application-yml"><span class="toc-text">4.2.3.3 修改 member-service-provider-10000 的 resources&#x2F;application.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-4-%E4%BF%AE%E6%94%B9-member-service-provider-10000-%E7%9A%84-com-x2F-hspedu-x2F-springcloud-x2F-MemberApplication-java"><span class="toc-text">4.2.3.4 修改 member-service-provider-10000 的 com&#x2F;hspedu&#x2F;springcloud&#x2F;MemberApplication.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-5-%E5%AE%8C%E6%88%90%E6%B5%8B%E8%AF%95"><span class="toc-text">4.2.3.5 完成测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-3-5-1-%E5%90%AF%E5%8A%A8-e-commerce-eureka-server-9001"><span class="toc-text">4.2.3.5.1 启动 **e-commerce-eureka-server-9001 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-3-5-2-%E5%90%AF%E5%8A%A8-member-service-provider-10000"><span class="toc-text">4.2.3.5.2 启动 **member-service-provider-10000 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-3-5-3-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-9001"><span class="toc-text">4.2.3.5.3 浏览器**: http:&#x2F;&#x2F;localhost:9001**</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-3-5-4-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%90%8D%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E"><span class="toc-text">4.2.3.5.4 微服务注册名配置说明</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-%E9%85%8D-%E7%BD%AE-member-service-consumer-80-%E4%BD%9C-%E4%B8%BA-EurekaClient%EF%BC%8C-%E5%8F%AF-%E4%BB%A5-%E6%8B%89%E5%8F%96-x2F-%E8%8E%B7-%E5%8F%96e-commerce-eureka-server-9001-%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9C%8D%E5%8A%A1%E4%BF%A1%E6%81%AF"><span class="toc-text">4.2.4 配 置 member-service-consumer-80 作 为 EurekaClient， 可 以 拉取 &#x2F; 获 取e-commerce-eureka-server-9001 提供的服务信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-4-1-%E6%9E%B6%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="toc-text">4.2.4.1 架构示意图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-4-2-%E4%BF%AE%E6%94%B9-pom-xml"><span class="toc-text">4.2.4.2 修改 pom.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-4-3-%E4%BF%AE%E6%94%B9-application-yml"><span class="toc-text">4.2.4.3 修改 application.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-4-4-%E4%BF%AE%E6%94%B9-MemberConsumerApplication-java"><span class="toc-text">4.2.4.4 修改 MemberConsumerApplication.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-4-5-%E5%AE%8C%E6%88%90%E6%B5%8B%E8%AF%95"><span class="toc-text">4.2.4.5 完成测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-4-5-1-%E5%90%AF%E5%8A%A8-e-commerce-eureka-server-9001"><span class="toc-text">4.2.4.5.1 启动 **e-commerce-eureka-server-9001 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-4-5-2-%E5%90%AF%E5%8A%A8-member-service-consumer-80"><span class="toc-text">4.2.4.5.2 启动 **member-service-consumer-80 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-4-5-3-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-9001"><span class="toc-text">4.2.4.5.3 浏览器**: http:&#x2F;&#x2F;localhost:9001**</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5-Service-Consumer-%E3%80%81Service-Provider-%E3%80%81EurekaServer-%E7%9A%84%E7%BB%B4%E6%8A%A4%E6%9C%BA%E5%88%B6"><span class="toc-text">4.2.5 Service Consumer 、Service Provider 、EurekaServer 的维护机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-6-Eureka%E8%87%AA%E6%88%91%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F"><span class="toc-text">4.2.6 Eureka自我保护模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-6-1-%E8%87%AA%E6%88%91%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F%E7%90%86%E8%AE%BA"><span class="toc-text">4.2.6.1 自我保护模式理论</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E6%90%AD%E5%BB%BA-EurekaServer-%E9%9B%86%E7%BE%A4-%E5%AE%9E%E7%8E%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1-amp-%E6%95%85%E9%9A%9C%E5%AE%B9%E9%94%99"><span class="toc-text">4.3 搭建 EurekaServer 集群- 实现负载均衡&amp;故障容错</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E9%9B%86%E7%BE%A4-Eureka-Server"><span class="toc-text">4.3.1 为什么需要集群 Eureka Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">4.3.2需求分析**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-3-%E6%90%AD%E5%BB%BA-Eureka-Server-%E9%9B%86%E7%BE%A4"><span class="toc-text">4.3.3 搭建 Eureka Server 集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3-1-%E5%88%9B%E5%BB%BA-e-commerce-eureka-server-9002-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97-%E4%BD%9C%E4%B8%BA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-text">4.3.3.1 创建 e-commerce-eureka-server-9002 微服务模块[作为注册中心]</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3-1-1-%E5%88%9B%E5%BB%BA%E6%AD%A5%E9%AA%A4%E5%8F%82%E8%80%83-e-commerce-eureka-server-9001"><span class="toc-text">4.3.3.1.1 创建步骤参考 e-commerce-eureka-server-9001</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3-1-2-%E4%BF%AE%E6%94%B9-pom-xml-%E5%8A%A0%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">4.3.3.1.2 修改 pom.xml , 加入依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3-1-3-%E5%88%9B%E5%BB%BA-resources-x2F-application-yml"><span class="toc-text">4.3.3.1.3 创建 resources&#x2F;application.yml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3-1-4-%E5%88%9B%E5%BB%BA%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB-EurekaApplication9002-java"><span class="toc-text">4.3.3.1.4 创建主启动类 EurekaApplication9002.java</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3-2-%E4%BF%AE%E6%94%B9-e-commerce-eureka-server-9001-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97"><span class="toc-text">4.3.3.2 修改 e-commerce-eureka-server-9001 微服务模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3-2-1-%E4%BF%AE%E6%94%B9-resources-x2F-application-yml"><span class="toc-text">4.3.3.2.1 修改 resources&#x2F;application.yml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3-2-2-%E4%BF%AE%E6%94%B9%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB%E5%90%8D%E4%B8%BA-EurekaApplication9001-java"><span class="toc-text">4.3.3.2.2 修改主启动类名为 EurekaApplication9001.java</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3-3-%E4%BF%AE%E6%94%B9-hosts-%E6%96%87%E4%BB%B6"><span class="toc-text">4.3.3.3 修改 hosts 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3-4-%E5%AE%8C%E6%88%90%E6%B5%8B%E8%AF%95"><span class="toc-text">4.3.3.4 完成测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3-4-1-%E5%90%AF%E5%8A%A8-e-commerce-eureka-server-9001"><span class="toc-text">4.3.3.4.1 启动 **e-commerce-eureka-server-9001</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3-4-2-%E5%90%AF%E5%8A%A8-e-commerce-eureka-server-9002"><span class="toc-text">4.3.3.4.2** 启动 **e-commerce-eureka-server-9002</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3-4-3-%E6%B5%8F%E8%A7%88%E5%99%A8-http-eureka9001-com-9001-%E6%B5%8F%E8%A7%88%E5%99%A8-http-eureka9002-com-9002"><span class="toc-text">4.3.3.4.3** 浏览器**: http:&#x2F;&#x2F;eureka9001.com:9001** 浏览器**: http:&#x2F;&#x2F;eureka9002.com:9002**</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3-5-%E5%B0%86-member-service-provider-10000-%E6%B3%A8%E5%86%8C%E5%88%B0-EurekaServer-%E9%9B%86%E7%BE%A4-%E7%9B%AE%E5%89%8D-2-%E5%8F%B0"><span class="toc-text">4.3.3.5 将 member-service-provider-10000 注册到 EurekaServer 集群(目前 2 台)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3-5-1-%E4%BF%AE%E6%94%B9-resources-x2F-application-yml"><span class="toc-text">4.3.3.5.1 修改 resources&#x2F;application.yml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3-5-2-%E5%AE%8C%E6%88%90%E6%B5%8B%E8%AF%95"><span class="toc-text">4.3.3.5.2 完成测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3-6-%E5%B0%86-member-service-consumer-80-%E6%B3%A8%E5%86%8C%E5%88%B0-EurekaServer-%E9%9B%86%E7%BE%A4-%E7%9B%AE%E5%89%8D-2-%E5%8F%B0"><span class="toc-text">4.3.3.6 将 member-service-consumer-80 注册到 EurekaServer 集群(目前 2 台)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3-6-1-%E4%BF%AE%E6%94%B9-resources-x2F-application-yml"><span class="toc-text">4.3.3.6.1 修改 resources&#x2F;application.yml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-3-6-2-%E5%AE%8C%E6%88%90%E6%B5%8B%E8%AF%95"><span class="toc-text">4.3.3.6.2 完成测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-4-%E6%90%AD%E5%BB%BA%E4%BC%9A%E5%91%98%E4%B8%AD%E5%BF%83%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9-%E9%9B%86%E7%BE%A4"><span class="toc-text">4.3.4 搭建会员中心服务提供方**-**集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-4-1-%E6%9E%B6%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="toc-text">4.3.4.1 架构示意图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-4-2-%E5%88%9B%E5%BB%BAmember-service-provider-10002"><span class="toc-text">4.3.4.2 创建member-service-provider-10002</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-4-3-%E5%88%9B%E5%BB%BA-resources-x2F-application-yml"><span class="toc-text">4.3.4.3 创建 resources&#x2F;application.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-4-4-%E4%BF%AE%E6%94%B9%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB%E5%90%8D"><span class="toc-text">4.3.4.4 修改主启动类名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-4-5-%E5%AE%8C%E6%88%90%E6%B5%8B%E8%AF%95"><span class="toc-text">4.3.4.5 完成测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-4-6-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">4.3.4.6 注意事项和细节</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-5-%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E7%AB%AF-member-service-consumer-80-%E4%BD%BF%E7%94%A8%E4%BC%9A%E5%91%98%E4%B8%AD%E5%BF%83%E6%9C%8D%E5%8A%A1%E9%9B%86%E7%BE%A4"><span class="toc-text">4.3.5 配置服务消费端 member-service-consumer-80 使用会员中心服务集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-5-1-%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="toc-text">4.3.5.1 架构图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-5-2-%E4%BF%AE%E6%94%B9-MemberConsumerController-java"><span class="toc-text">4.3.5.2 修改 MemberConsumerController.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-5-3-%E4%BF%AE%E6%94%B9-CustomizationBean-java"><span class="toc-text">4.3.5.3 修改 CustomizationBean.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-5-5-%E5%AE%8C%E6%88%90%E6%B5%8B%E8%AF%95"><span class="toc-text">4.3.5.5 完成测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-5-5-1-%E5%90%AF%E5%8A%A8-eureka-server-%E9%9B%86%E7%BE%A4-%E7%9B%AE%E5%89%8D-2-%E5%8F%B0"><span class="toc-text">4.3.5.5.1 启动 eureka server 集群**(目前 2 台)**</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-5-5-2-%E5%90%AF%E5%8A%A8-member-service-provider-10000"><span class="toc-text">4.3.5.5.2 启动 member-service-provider-10000</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-5-5-3-%E5%90%AF%E5%8A%A8-member-service-provider-10002"><span class="toc-text">4.3.5.5.3 启动 member-service-provider-10002</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-5-5-4%E4%B8%8D%E6%80%A5%EF%BC%8C%E5%85%88%E6%B5%8B%E8%AF%95-http-localhost-10000-member-get-1-%E5%92%8C-http-localhost-10002-member-get-1"><span class="toc-text">4.3.5.5.4不急，先测试 : http:&#x2F;&#x2F;localhost:10000&#x2F;member&#x2F;get&#x2F;1 和 http:&#x2F;&#x2F;localhost:10002&#x2F;member&#x2F;get&#x2F;1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-5-5-5-%E5%90%AF%E5%8A%A8-member-service-consumer-80"><span class="toc-text">4.3.5.5.5 启动 member-service-consumer-80</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-5-5-6-%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE-http-localhost-member-consumer-get-1"><span class="toc-text">4.3.5.5.6 浏览器访问**: http:&#x2F;&#x2F;localhost&#x2F;member&#x2F;consumer&#x2F;get&#x2F;1**</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-5-6-%E4%BA%A4%E6%9B%BF%E8%AE%BF%E9%97%AEmember%E6%9C%8D%E5%8A%A1%E8%AF%B4%E6%98%8E"><span class="toc-text">4.3.5.6 交替访问member服务说明:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-6-%E8%8E%B7%E5%8F%96-Eureka-Server-%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%BF%A1%E6%81%AF-DiscoveryClient"><span class="toc-text">4.3.6 获取 Eureka Server 服务注册信息 -DiscoveryClient</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-6-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">4.3.6.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-6-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">4.3.6.2 代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-6-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">4.3.6.3 测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-6-4-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82%E8%AF%B4%E6%98%8E"><span class="toc-text">4.3.6.4 注意事项和细节说明</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-Eureka%E5%90%8E%E7%BB%AD%E8%AF%B4%E6%98%8E"><span class="toc-text">4.4 Eureka后续说明</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-SpringCloudRibbon%E6%9C%8D%E5%8A%A1%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-text">5 SpringCloudRibbon服务负载均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-Ribbon%E4%BB%8B%E7%BB%8D"><span class="toc-text">5.1 Ribbon介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-Ribbon%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">5.1.1 Ribbon是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-2-%E5%AE%98%E7%BD%91"><span class="toc-text">5.1.2 官网</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-1-https-github-com-Netflix-ribbon"><span class="toc-text">5.1.2.1 https:&#x2F;&#x2F;github.com&#x2F;Netflix&#x2F;ribbon</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-3-Ribbon%E8%BF%9B%E5%85%A5%E7%BB%B4%E6%8A%A4%E7%8A%B6%E6%80%81"><span class="toc-text">5.1.3 Ribbon进入维护状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-4-LB-Load-Balance"><span class="toc-text">5.1.4 LB(Load Balance)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-4-1-LB%E5%88%86%E7%B1%BB"><span class="toc-text">5.1.4.1 LB分类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9B%86%E4%B8%AD%E5%BC%8F-LB"><span class="toc-text">集中式 LB</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%86%85-LB"><span class="toc-text">进程内 LB</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-4-2-%E5%AE%9E%E4%BE%8B-%E5%89%8D%E9%9D%A2-member-consumer-%E8%BD%AE%E8%AF%A2%E8%B4%9F%E8%BD%BD%E8%AE%BF%E9%97%AE-10000-x2F-10002-%E5%BA%95%E5%B1%82%E5%B0%B1%E6%98%AF-Ribbon-%E9%BB%98%E8%AE%A4%E7%9A%84%E8%BD%AE%E8%AF%A2%E8%B4%9F%E8%BD%BD%E7%AE%97%E6%B3%95"><span class="toc-text">5.1.4.2 实例-前面 member-consumer 轮询负载访问 10000&#x2F;10002 底层就是 Ribbon 默认的轮询负载算法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-Ribbon%E5%8E%9F%E7%90%86"><span class="toc-text">5.2 Ribbon原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-Ribbon%E6%9E%B6%E6%9E%84%E5%9B%BE-amp-%E6%9C%BA%E5%88%B6"><span class="toc-text">5.2.1 Ribbon架构图**&amp;**机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-Ribbon%E5%B8%B8%E8%A7%81%E8%B4%9F%E8%BD%BD%E7%AE%97%E6%B3%95"><span class="toc-text">5.2.2 Ribbon常见负载算法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E6%9B%BF%E6%8D%A2%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95-%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="toc-text">5.3 替换负载均衡算法-应用实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">5.3.1 需求分析**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">5.3.2代码实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">5.3.3 测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-SpringCloud-Open-Feign%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8"><span class="toc-text">6 SpringCloud Open Feign服务调用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-OpenFeign%E4%BB%8B%E7%BB%8D"><span class="toc-text">6.1 OpenFeign介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-1-OpenFeign%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">6.1.1 OpenFeign是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-2-%E5%AE%98%E7%BD%91"><span class="toc-text">6.1.2 官网</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2-1-https-github-com-spring-cloud-spring-cloud-openfeign"><span class="toc-text">6.1.2.1 https:&#x2F;&#x2F;github.com&#x2F;spring-cloud&#x2F;spring-cloud-openfeign</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-3-Feign%E5%92%8COpenFeign%E5%8C%BA%E5%88%AB"><span class="toc-text">6.1.3 Feign和OpenFeign区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-OpenFeign-%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="toc-text">6.2 OpenFeign-应用实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">6.2.1 需求分析**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2-%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E6%A8%A1%E5%9D%97-%E9%80%9A%E8%BF%87-OpenFeigen-%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="toc-text">6.2.2 创建服务消费模块 **-**通过 OpenFeigen 实现远程调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">6.2.3 测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-4-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">6.2.4 注意事项和细节</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="toc-text">6.3 日志配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-1-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">6.3.1 基本介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-2-%E9%85%8D%E7%BD%AE%E6%97%A5%E5%BF%97-%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="toc-text">6.3.2 配置日志**-**应用实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">6.3.3 测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-OpenFeign%E8%B6%85%E6%97%B6"><span class="toc-text">6.4 OpenFeign超时</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-3-%E8%AE%BE%E7%BD%AEOpenFeign%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4"><span class="toc-text">6.4.3 设置OpenFeign超时时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-4-%E6%B5%8B%E8%AF%95"><span class="toc-text">6.4.4 测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%F0%9F%8C%9FSpringCloudGateway-%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3"><span class="toc-text">7 🌟SpringCloudGateway 服务网关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-Gateway%E4%BB%8B%E7%BB%8D"><span class="toc-text">7.1 Gateway介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-1-%E7%9C%8B%E4%B8%80%E4%B8%AA%E9%9C%80%E6%B1%82%EF%BC%8C%E5%BC%95%E5%87%BA%E7%BD%91%E5%85%B3%E6%9C%8D%E5%8A%A1"><span class="toc-text">7.1.1 看一个需求，引出网关服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-2-%F0%9F%8C%9FGateway-%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91%E5%9B%BE"><span class="toc-text">7.1.2 🌟Gateway 网络拓扑图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-3-Gateway%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">7.1.3 Gateway是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-4-%E5%AE%98%E7%BD%91"><span class="toc-text">7.1.4 官网</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-4-1-https-cloud-spring-io-spring-cloud-static-spring-cloud-gateway-2-2-1-RELEASE-reference-html"><span class="toc-text">7.1.4.1 https:&#x2F;&#x2F;cloud.spring.io&#x2F;spring-cloud-static&#x2F;spring-cloud-gateway&#x2F;2.2.1.RELEASE&#x2F;reference&#x2F;html&#x2F;</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-5-Gateway-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-text">7.1.5 Gateway 核心功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-5-1-%E9%89%B4%E6%9D%83"><span class="toc-text">7.1.5.1 鉴权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-5-2-%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="toc-text">7.1.5.2 流量控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-5-3-%E7%86%94%E6%96%AD"><span class="toc-text">7.1.5.3 熔断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-5-4-%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7"><span class="toc-text">7.1.5.4 日志监控</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-5-5-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-text">7.1.5.5 反向代理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-6-Gateway-vs-Zuul"><span class="toc-text">7.1.6 Gateway vs Zuul</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-6-1-Gateway-%E5%92%8C-Zuul-%E5%8C%BA%E5%88%AB"><span class="toc-text">7.1.6.1 Gateway 和 Zuul 区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-6-2-Gateway-%E7%89%B9%E6%80%A7"><span class="toc-text">7.1.6.2 Gateway 特性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-Gateway%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-text">7.2 Gateway基本原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-1-Gateway%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-text">7.2.1 Gateway核心组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-1-%E4%B8%80%E5%BC%A0%E5%9B%BE"><span class="toc-text">7.2.1.1 一张图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-2-Route-%E8%B7%AF%E7%94%B1"><span class="toc-text">7.2.1.2 Route(路由)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-3-Predicate-%E6%96%AD%E8%A8%80"><span class="toc-text">7.2.1.3 Predicate(断言)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-4-Filter-%E8%BF%87%E6%BB%A4"><span class="toc-text">7.2.1.4 Filter(过滤)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-2-HowItWorks%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="toc-text">7.2.2 HowItWorks工作机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-1-%E4%B8%80%E5%9B%BE%E8%83%9C%E5%8D%83%E8%A8%80"><span class="toc-text">7.2.2.1 一图胜千言</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E6%90%AD%E5%BB%BA-Gateway-%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">7.3 搭建 Gateway 微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-1-%E6%90%AD%E5%BB%BA-Gateway-%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="toc-text">7.3.1 搭建 **Gateway-**应用实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-1-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">7.3.1.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-1-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">7.3.1.2 代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-1-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">7.3.1.3 测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-1-4-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">7.3.1.4 注意事项和细节</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-2-%E4%BA%8C%E8%AF%B4-Gateway-%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE"><span class="toc-text">7.3.2 二说 Gateway 路由配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-2-1-%E6%96%B9%E5%BC%8F-1-application-yml-%E4%B8%AD%E9%85%8D%E7%BD%AE-%E5%89%8D%E9%9D%A2%E8%AE%B2%E8%BF%87"><span class="toc-text">7.3.2.1 方式 1: application.yml 中配置-前面讲过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-2-2-%E6%96%B9%E5%BC%8F-2-%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E7%B1%BB%E6%B3%A8%E5%85%A5%E3%80%90%E4%BA%86%E8%A7%A3%E3%80%91"><span class="toc-text">7.3.2.2 方式 2: 编写配置类注入【了解】</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-2-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">7.3.2.3 测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-3-%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-text">7.3.3 动态路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-3-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE"><span class="toc-text">7.3.3.1 需求分析&#x2F;图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-3-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">7.3.3.2 代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-3-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">7.3.3.3 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-3-3-3-1-%E5%90%AF%E5%8A%A8-e-commerce-eureka-server-9001"><span class="toc-text">7.3.3.3.1 启动 e-commerce-eureka-server-9001</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-3-3-3-2-%E5%90%AF%E5%8A%A8-member-service-provider-10000"><span class="toc-text">7.3.3.3.2 启动 member-service-provider-10000</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-3-3-3-3-%E5%90%AF%E5%8A%A8-member-service-provider-10002"><span class="toc-text">7.3.3.3.3 启动 member-service-provider-10002</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-3-3-3-4-%E5%90%AF%E5%8A%A8-e-commerce-gateway-20000"><span class="toc-text">7.3.3.3.4 启动 e-commerce-gateway-20000</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-3-3-3-5-%E6%B5%8F%E8%A7%88%E5%99%A8-%E9%80%9A%E8%BF%87%E7%BD%91%E5%85%B3%E8%AE%BF%E9%97%AE-http-localhost-20000-member-get-1"><span class="toc-text">7.3.3.3.5 浏览器**:(通过网关访问) http:&#x2F;&#x2F;localhost:20000&#x2F;member&#x2F;get&#x2F;1**</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-3-4-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">7.3.3.4 注意事项和细节</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-3-3-4-1-%E9%85%8D%E7%BD%AE%E5%A5%BD%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E5%90%8E-Gateway-%E4%BC%9A%E6%A0%B9%E6%8D%AE%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E4%B8%8A%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%90%8D%EF%BC%8C%E4%B8%BA%E8%AF%B7%E6%B1%82%E5%88%9B%E5%BB%BA%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%EF%BC%8C%E5%AE%9E%E7%8E%B0-%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1-%E5%8A%9F%E8%83%BD"><span class="toc-text">7.3.3.4.1 配置好动态路由后 Gateway 会根据注册中心上微服务名，为请求创建动态路由，实现 动态路由 功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-3-3-4-2-%E4%BD%BF%E7%94%A8%E7%9A%84-lb-%E5%8D%8F%E8%AE%AE%E6%94%AF%E6%8C%81%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1-%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95"><span class="toc-text">7.3.3.4.2 使用的 lb 协议支持负载均衡**-**轮询算法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-3-3-4-3-%E9%85%8D%E7%BD%AE%E8%87%AA%E5%B7%B1%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95%EF%BC%8C-%E6%B5%8B%E8%AF%95%E5%AE%8C%E6%AF%95%E6%81%A2%E5%A4%8D%E6%88%90%E5%8E%9F%E6%9D%A5%E7%9A%84%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95"><span class="toc-text">7.3.3.4.3 配置自己的负载均衡算法， 测试完毕恢复成原来的轮询算法</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-Predicate-x2F-%E6%96%AD%E8%A8%80"><span class="toc-text">7.4 Predicate&#x2F;断言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-1-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">7.4.1 基本介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-1-1-%E4%B8%80%E5%8F%A5%E8%AF%9D-Predicate-%E5%B0%B1%E6%98%AF%E4%B8%80%E7%BB%84%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99%EF%BC%8C%E5%BD%93%E8%AF%B7%E6%B1%82%E5%8C%B9%E9%85%8D%E6%88%90%E5%8A%9F%EF%BC%8C%E5%B0%B1%E6%89%A7%E8%A1%8C%E5%AF%B9%E5%BA%94Route-%E5%8C%B9%E9%85%8D%E5%A4%B1%E8%B4%A5%EF%BC%8C%E6%94%BE%E5%BC%83-%E5%A4%84%E7%90%86-x2F-%E8%BD%AC%E5%8F%91"><span class="toc-text">7.4.1.1 一句话: Predicate 就是一组匹配规则，当请求匹配成功，就执行对应Route, 匹配失败，放弃 处理&#x2F;转发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-1-2-RoutePredicateFactories"><span class="toc-text">7.4.1.2 RoutePredicateFactories</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-2-RoutePredicate%E5%AE%9E%E4%BE%8B-%E6%A0%B9%E6%8D%AE%E4%B8%8A%E8%BF%B0%E6%96%87%E6%A1%A3%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C%E6%BC%94%E7%A4%BA"><span class="toc-text">7.4.2 RoutePredicate实例(根据上述文档进行操作演示)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-1-AfterRoutePredicate"><span class="toc-text">7.4.2.1 AfterRoutePredicate</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-4-2-1-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">7.4.2.1.1 需求分析**&#x2F;**图解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-4-2-1-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">7.4.2.1.2 代码实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3-https-cloud-spring-io-spring-cloud-static-spring-cloud-gateway-2-2-1-RELEASE-reference-html-gateway-request-predicates-factories"><span class="toc-text">1. 参考文档 : https:&#x2F;&#x2F;cloud.spring.io&#x2F;spring-cloud-static&#x2F;spring-cloud-gateway&#x2F;2.2.1.RELEASE&#x2F;reference&#x2F;html&#x2F;#gateway-request-predicates-factories</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-2-BeforeRoutePredicate"><span class="toc-text">7.4.2.2 BeforeRoutePredicate</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-4-2-2-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">7.4.2.2.2 代码实现</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-3-BetweenRoutePredicate"><span class="toc-text">7.4.2.3 BetweenRoutePredicate</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-4-2-3-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">7.4.2.3.2 代码实现</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-4-CookieRoutePredicate"><span class="toc-text">7.4.2.4 CookieRoutePredicate</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-4-2-4-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">7.4.2.4.1 需求分析**&#x2F;**图解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-5-HeaderRoutePredicate"><span class="toc-text">7.4.2.5 HeaderRoutePredicate</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-4-2-5-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">7.4.2.5.1 需求分析**&#x2F;**图解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-6-HostRoutePredicate"><span class="toc-text">7.4.2.6 HostRoutePredicate</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-4-2-6-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">7.4.2.6.1 需求分析**&#x2F;**图解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-7-MethodRoutePredicate"><span class="toc-text">7.4.2.7 MethodRoutePredicate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-8-PathRoutePredicate"><span class="toc-text">7.4.2.8 PathRoutePredicate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-9-QueryRoutePredicate"><span class="toc-text">7.4.2.9 QueryRoutePredicate</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-4-2-9-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">1.4.2.9.1 需求分析**&#x2F;**图解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-10-RemoteAddr-Route-Predicate"><span class="toc-text">7.4.2.10 RemoteAddr Route Predicate</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-4-2-10-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">7.4.2.10.1 需求分析**&#x2F;**图解</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-Filter-x2F-%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-text">7.5 Filter&#x2F;过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-1-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">7.5.1 基本介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-2-%E7%B1%BB%E5%9E%8B"><span class="toc-text">7.5.2 类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-2-1-GatewayFilter"><span class="toc-text">7.5.2.1 GatewayFilter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-2-2-GlobalFilter"><span class="toc-text">7.5.2.2 GlobalFilter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-3-GatewayFilter%E4%BD%BF%E7%94%A8"><span class="toc-text">7.5.3 GatewayFilter使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-3-1-%E5%BC%80%E5%8F%91%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8-GatewayFilter-%E8%BE%83%E5%B0%91%EF%BC%8C%E4%B8%80%E8%88%AC%E6%98%AF%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-text">7.5.3.1 开发直接使用 GatewayFilter 较少，一般是自定义过滤器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-4-%E8%87%AA%E5%AE%9A%E4%B9%89-GlobalFilter"><span class="toc-text">7.5.4 自定义 GlobalFilter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-4-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">7.5.4.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-4-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">7.5.4.2 代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-4-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">7.5.4.3 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-5-4-3-1-%E5%90%AF%E5%8A%A8-e-commerce-eureka-server-9001"><span class="toc-text">7.5.4.3.1 启动 e-commerce-eureka-server-9001</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-5-4-3-2-%E5%90%AF%E5%8A%A8-member-service-provider-10000-x2F-10002"><span class="toc-text">7.5.4.3.2 启动 member-service-provider-10000&#x2F;10002</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-5-4-3-3-%E5%90%AF%E5%8A%A8-e-commerce-gateway-20000"><span class="toc-text">7.5.4.3.3 启动 e-commerce-gateway-20000</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-5-4-3-4-%E6%B5%8F%E8%A7%88%E5%99%A8-%E9%80%9A%E8%BF%87%E7%BD%91%E5%85%B3%E8%AE%BF%E9%97%AE-http-localhost-20000-member-get-1-user-hspedu-amp-pwd-123456-%E8%BE%93%E5%85%A5-http-localhost-20000-member-get-1-user-hspedu-amp-pwd-123456"><span class="toc-text">7.5.4.3.4 浏览器**:(通过网关访问) http:&#x2F;&#x2F;localhost:20000&#x2F;member&#x2F;get&#x2F;1?user&#x3D;hspedu&amp;pwd&#x3D;123456** 输入**: http:&#x2F;&#x2F;localhost:20000&#x2F;member&#x2F;get&#x2F;1?user&#x3D;hspedu&amp;pwd&#x3D;123456**</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-4-4-%E6%B5%8B%E8%AF%95%E5%AE%8C%E6%AF%95%EF%BC%8C%E8%AE%B0%E5%BE%97%E4%BB%A3%E7%A0%81%E6%81%A2%E5%A4%8D%E5%88%B0%E6%B5%8B%E8%AF%95%E5%89%8D"><span class="toc-text">7.5.4.4 测试完毕，记得代码恢复到测试前</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-SpringCloud-Sleuth-Zipkin-%E6%9C%8D%E5%8A%A1%E8%B7%9F%E8%B8%AA"><span class="toc-text">8 SpringCloud Sleuth+Zipkin 服务跟踪</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-Sleuth-x2F-ZipKin%E5%9F%BA%E7%A1%80"><span class="toc-text">8.1 Sleuth&#x2F;ZipKin基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-1-%E5%AE%98%E7%BD%91"><span class="toc-text">8.1.1 官网</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-1-1-https-github-com-spring-cloud-spring-cloud-sleuth"><span class="toc-text">8.1.1.1 https:&#x2F;&#x2F;github.com&#x2F;spring-cloud&#x2F;spring-cloud-sleuth</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-2-Sleuth-x2F-Zipkin%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">8.1.2 Sleuth&#x2F;Zipkin是什么?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-1-%E6%A6%82%E8%BF%B0-%E4%B8%A4%E5%BC%A0%E5%9B%BE"><span class="toc-text">8.1.2.1 概述(两张图)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-2-%E4%B8%80%E5%8F%A5%E8%AF%9D-Sleuth-%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E5%A5%97%E5%AE%8C%E6%95%B4%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%B7%9F%E8%B8%AA%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-%E5%B9%B6%E5%85%BC%E5%AE%B9-Zipkin"><span class="toc-text">8.1.2.2 一句话: Sleuth 提供了一套完整的服务跟踪的解决方案 并兼容 Zipkin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-3-%E6%A2%B3%E7%90%86-%F0%9F%8C%9FSleuth-%E5%81%9A%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA-Zipkin-%E5%81%9A%E6%95%B0%E6%8D%AE%E6%90%9C%E9%9B%86-x2F-%E5%AD%98%E5%82%A8-x2F-%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-text">8.1.2.3 梳理: 🌟Sleuth 做链路追踪 , Zipkin 做数据搜集&#x2F;存储&#x2F;可视化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-3-Sleuth%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">8.1.3 Sleuth工作原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-Sleuth-x2F-ZipKin-%E6%90%AD%E5%BB%BA%E9%93%BE%E8%B7%AF%E7%9B%91%E6%8E%A7%E5%AE%9E%E4%BE%8B"><span class="toc-text">8.2 Sleuth&#x2F;ZipKin-搭建链路监控实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-1-%E9%9C%80%E6%B1%82%E8%AF%B4%E6%98%8E-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">8.2.1 需求说明**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-2-%E5%AE%89%E8%A3%85-x2F-%E4%BD%BF%E7%94%A8-Zipkin"><span class="toc-text">8.2.2 安装**&#x2F;**使用 Zipkin</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-1-%E4%B8%8B%E8%BD%BD"><span class="toc-text">8.2.2.1 下载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-2-%E8%BF%90%E8%A1%8C"><span class="toc-text">8.2.2.2 运行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-3-%E8%AE%BF%E9%97%AE"><span class="toc-text">8.2.2.3 访问</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-3-%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%E9%9B%86%E6%88%90-Sleuth-x2F-Zipkin"><span class="toc-text">8.2.3 服务提供方集成 Sleuth&#x2F;Zipkin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-4-%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E6%96%B9%E9%9B%86%E6%88%90-Sleuth-x2F-Zipkin"><span class="toc-text">8.2.4 服务消费方集成 Sleuth&#x2F;Zipkin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-5-%E6%B5%8B%E8%AF%95"><span class="toc-text">8.2.5 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-5-1-%E5%90%AF%E5%8A%A8-e-commerce-eureka-server-9001"><span class="toc-text">8.2.5.1 启动 e-commerce-eureka-server-9001</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-5-2-%E5%90%AF%E5%8A%A8-member-service-provider-10000"><span class="toc-text">8.2.5.2 启动 member-service-provider-10000</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-5-3-%E5%90%AF%E5%8A%A8-member-service-consumer-80"><span class="toc-text">8.2.5.3 启动 member-service-consumer-80</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-5-4-%E6%B5%8F%E8%A7%88%E5%99%A8-%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BE%93%E5%85%A5-http-localhost-member-consumer-get-1"><span class="toc-text">8.2.5.4 浏览器: 浏览器输入: http:&#x2F;&#x2F;localhost&#x2F;member&#x2F;consumer&#x2F;get&#x2F;1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-6-%E6%9F%A5%E7%9C%8B%E7%9B%91%E6%8E%A7-amp-%E5%88%86%E6%9E%90%E7%BB%93%E6%9E%9C"><span class="toc-text">8.2.6 查看监控**&amp;**分析结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-6-1-%E6%9F%A5%E7%9C%8B%E7%9B%91%E6%8E%A7-amp-%E5%88%86%E6%9E%90%E7%BB%93%E6%9E%9C"><span class="toc-text">8.2.6.1 查看监控&amp;分析结果</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%F0%9F%8C%9FSpringCloudAlibabaNacos-%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83-%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE"><span class="toc-text">9 🌟SpringCloudAlibabaNacos 服务注册中心+服务配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-Nacos%E5%9F%BA%E7%A1%80"><span class="toc-text">9.1 Nacos基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-1-%E5%AE%98%E7%BD%91"><span class="toc-text">9.1.1 官网</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-1-1-https-github-com-alibaba-Nacos"><span class="toc-text">9.1.1.1 https:&#x2F;&#x2F;github.com&#x2F;alibaba&#x2F;Nacos</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-2-Nacos%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">9.1.2 Nacos是什么?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-2-1-%E4%B8%80%E5%8F%A5%E8%AF%9D-Nacos-%E5%B0%B1%E6%98%AF%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83-%E6%9B%BF%E4%BB%A3-Eureka-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E6%9B%BF%E4%BB%A3-Config"><span class="toc-text">9.1.2.1 一句话: Nacos 就是注册中心[替代 Eureka]+配置中心[替代 Config]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-2-2-Nacos-Dynamic-Naming-and-Configuration-Service"><span class="toc-text">9.1.2.2 Nacos:Dynamic Naming and Configuration Service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-2-3-Nacos-%E6%9E%B6%E6%9E%84%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80-CAP-%E7%90%86%E8%AE%BA-%E6%94%AF%E6%8C%81-AP-%E5%92%8C-CP-%E5%8F%AF%E4%BB%A5%E5%88%87%E6%8D%A2"><span class="toc-text">9.1.2.3 Nacos:架构理论基础: CAP 理论 (支持 AP 和 CP, 可以切换)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-3-Nacos%E4%B8%8B%E8%BD%BD-amp-%E8%BF%90%E8%A1%8C"><span class="toc-text">9.1.3 Nacos下载&amp;运行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-3-1-%E4%B8%8B%E8%BD%BD-https-github-com-alibaba-nacos-releases-tag-1-2-1"><span class="toc-text">9.1.3.1 下载: https:&#x2F;&#x2F;github.com&#x2F;alibaba&#x2F;nacos&#x2F;releases&#x2F;tag&#x2F;1.2.1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-3-2-%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82-Java8-x2F-Maven-3-2-x"><span class="toc-text">9.1.3.2 环境要求: Java8&#x2F;Maven 3.2.x+</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-3-3-%E8%A7%A3%E5%8E%8B"><span class="toc-text">9.1.3.3 解压</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-3-4-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-8848-nacos"><span class="toc-text">9.1.3.4 浏览器 http:&#x2F;&#x2F;localhost:8848&#x2F;nacos</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-3-5-%E7%94%A8%E6%88%B7%E5%90%8D-x2F-%E5%AF%86%E7%A0%81-%E4%B8%BA-nacos"><span class="toc-text">9.1.3.5 用户名&#x2F;密码 为 nacos</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-%E5%88%9B%E5%BB%BA-Nacos-%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85"><span class="toc-text">9.2 创建 Nacos 服务提供者</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-1-%E9%9C%80%E6%B1%82%E8%AF%B4%E6%98%8E-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">9.2.1 需求说明&#x2F;图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-2-%E5%88%9B%E5%BB%BA-member-service-nacos-provider-10004-%E5%B9%B6%E6%B3%A8%E5%86%8C%E5%88%B0-NacosServer8848"><span class="toc-text">9.2.2 创建 member-service-nacos-provider-10004 并注册到 NacosServer8848</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-2-1-%E5%88%9B%E5%BB%BA-member-service-nacos-provider-10004"><span class="toc-text">9.2.2.1 创建 member-service-nacos-provider-10004</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-2-2-%E4%BF%AE%E6%94%B9%E7%88%B6%E9%A1%B9%E7%9B%AE-pom-xml"><span class="toc-text">9.2.2.2 修改父项目 pom.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-2-3-%E4%BF%AE%E6%94%B9%E6%9C%AC%E6%A8%A1%E5%9D%97-pom-xml"><span class="toc-text">9.2.2.3 修改本模块 pom.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-2-4-%E5%88%9B%E5%BB%BA-application-yml"><span class="toc-text">9.2.2.4 创建 application.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-2-5-%E5%88%9B%E5%BB%BA%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-text">9.2.2.5 创建主启动类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-2-6-%E4%B8%BA%E7%9C%8B%E5%88%B0%E6%9B%B4%E5%A5%BD%E6%8F%90%E7%A4%BA%EF%BC%8C%E4%BF%AE%E6%94%B9-Controller"><span class="toc-text">9.2.2.6 为看到更好提示，修改 Controller</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-2-7-%E6%B5%8B%E8%AF%95"><span class="toc-text">9.2.2.7 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-2-2-7-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">9.2.2.7.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-2-2-7-2-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004"><span class="toc-text">9.2.2.7.2 启动 member-service-nacos-provider-10004</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-2-2-7-3-%E8%A7%82%E5%AF%9F-nacos-%E6%9C%8D%E5%8A%A1%E6%98%AF%E5%90%A6%E6%B3%A8%E5%86%8C%E6%88%90%E5%8A%9F"><span class="toc-text">9.2.2.7.3 观察 nacos 服务是否注册成功</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-3-%E5%88%9B%E5%BB%BA-member-service-nacos-provider-10006-%E5%B9%B6%E6%B3%A8%E5%86%8C%E5%88%B0-NacosServer8848"><span class="toc-text">9.2.3 创建 member-service-nacos-provider-10006 并注册到 NacosServer8848</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-3-1-%E5%88%9B%E5%BB%BA-member-service-nacos-provider-10006"><span class="toc-text">9.2.3.1 创建 member-service-nacos-provider-10006</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-3-2-%E4%BF%AE%E6%94%B9%E6%9C%AC%E6%A8%A1%E5%9D%97-pom-xml"><span class="toc-text">9.2.3.2 修改本模块 pom.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-3-3-%E5%88%9B%E5%BB%BA-application-yml"><span class="toc-text">9.2.3.3 创建 application.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-3-4-%E5%88%9B%E5%BB%BA%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-text">9.2.3.4 创建主启动类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-3-5-%E4%B8%BA%E7%9C%8B%E5%88%B0%E6%9B%B4%E5%A5%BD%E6%8F%90%E7%A4%BA%EF%BC%8C%E4%BF%AE%E6%94%B9-Controller"><span class="toc-text">9.2.3.5 为看到更好提示，修改 Controller</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-3-6-%E6%B5%8B%E8%AF%95"><span class="toc-text">9.2.3.6 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-2-3-6-1-%E4%BF%9D%E8%AF%81-Nacos-Server-8848-%E6%98%AF%E5%90%AF%E5%8A%A8%E7%9A%84"><span class="toc-text">9.2.3.6.1 保证 Nacos Server 8848 是启动的</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-2-3-6-2-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10006"><span class="toc-text">9.2.3.6.2 启动 **member-service-nacos-provider-10006 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-2-3-6-3-%E8%A7%82%E5%AF%9F-nacos-%E6%9C%8D%E5%8A%A1%E6%98%AF%E5%90%A6%E6%B3%A8%E5%86%8C%E6%88%90%E5%8A%9F"><span class="toc-text">9.2.3.6.3 观察 nacos 服务是否注册成功</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-2-3-6-4-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-10006-member-get-1"><span class="toc-text">9.2.3.6.4 浏览器**: http:&#x2F;&#x2F;localhost:10006&#x2F;member&#x2F;get&#x2F;1**</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-%E5%88%9B%E5%BB%BA-Nacos-%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-text">9.3 创建 Nacos 的服务消费者</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-1-%E9%9C%80%E6%B1%82%E8%AF%B4%E6%98%8E-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">9.3.1 需求说明**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-2-%E5%88%9B%E5%BB%BA-member-service-nacos-consumer-80-%E5%B9%B6%E6%B3%A8%E5%86%8C%E5%88%B0-NacosServer8848"><span class="toc-text">9.3.2 创建 member-service-nacos-consumer-80 并注册到 NacosServer8848</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-2-1-%E5%88%9B%E5%BB%BA-member-service-nacos-consumer-80"><span class="toc-text">9.3.2.1 创建 member-service-nacos-consumer-80</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-2-2-%E4%BF%AE%E6%94%B9-pom-xml"><span class="toc-text">9.3.2.2 修改 pom.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-2-3-%E5%88%9B%E5%BB%BA-application-yml"><span class="toc-text">9.3.2.3 创建 application.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-2-4-%E5%88%9B%E5%BB%BA%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-text">9.3.2.4 创建主启动类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-2-5-%E4%B8%9A%E5%8A%A1%E7%B1%BB"><span class="toc-text">9.3.2.5 业务类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-2-6-%E6%B5%8B%E8%AF%95"><span class="toc-text">9.3.2.6 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-3-2-6-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">9.3.2.6.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-3-2-6-2-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004-x2F-10006-9-3-2-6-3-%E5%90%AF%E5%8A%A8-member-service-nacos-consumer-80"><span class="toc-text">9.3.2.6.2 启动 member-service-nacos-provider-10004&#x2F;10006 9.3.2.6.3 启动 member-service-nacos-	consumer-80</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-3-2-6-4-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-member-nacos-consumer-get-1"><span class="toc-text">9.3.2.6.4 浏览器**: http:&#x2F;&#x2F;localhost&#x2F;member&#x2F;nacos&#x2F;consumer&#x2F;get&#x2F;1**</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-2-7-%E9%85%8D%E7%BD%AE%E8%87%AA%E5%B7%B1%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95%EF%BC%8C-%E6%B5%8B%E8%AF%95%E5%AE%8C%E6%AF%95%E6%81%A2%E5%A4%8D%E6%88%90%E5%8E%9F%E6%9D%A5%E7%9A%84%E8%BD%AE%E8%AF%A2%E7%AE%97%E6%B3%95"><span class="toc-text">9.3.2.7 配置自己的负载均衡算法， 测试完毕恢复成原来的轮询算法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4-NacosAP%E5%92%8CCP%E5%88%87%E6%8D%A2-%E7%90%86%E8%AE%BA"><span class="toc-text">9.4 NacosAP和CP切换-理论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-1-%E5%90%84%E7%A7%8D%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AF%B9%E6%AF%94"><span class="toc-text">9.4.1 各种注册中心对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-2-%E9%80%89%E6%8B%A9-AP-%E8%BF%98%E6%98%AF-CP"><span class="toc-text">9.4.2 选择 AP 还是 CP?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-3-AP%E5%92%8CCP%E5%88%87%E6%8D%A2"><span class="toc-text">9.4.3 AP和CP切换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-4-3-2-%E5%8F%82%E8%80%83-https-www-jianshu-com-p-c56e22c222bb"><span class="toc-text">9.4.3.2 参考: https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;c56e22c222bb</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5-Nacos-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%AE%9E%E4%BE%8B"><span class="toc-text">9.5 Nacos 配置中心实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">9.5.1 需求分析**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-2-%E5%9C%A8-Nacos-Server-%E5%8A%A0%E5%85%A5%E9%85%8D%E7%BD%AE"><span class="toc-text">9.5.2 在 Nacos Server 加入配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-3-%E5%88%9B%E5%BB%BA-Nacos-%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A8%A1%E5%9D%97-e-commerce-nacos-config-client5000"><span class="toc-text">9.5.3 创建 Nacos 配置客户端模块 e-commerce-nacos-config-client5000</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-3-1-%E5%88%9B%E5%BB%BA-Module"><span class="toc-text">9.5.3.1 创建 Module</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-3-2-%E4%BF%AE%E6%94%B9-pom-xml"><span class="toc-text">9.5.3.2 修改 pom.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-3-3-%E5%88%9B%E5%BB%BA-application-xml"><span class="toc-text">9.5.3.3 创建 application.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-3-4-%E5%88%9B%E5%BB%BA-bootstrap-yml"><span class="toc-text">9.5.3.4 创建 bootstrap.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-3-5-%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-text">9.5.3.5 主启动类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-3-6-%E4%B8%9A%E5%8A%A1%E7%B1%BB"><span class="toc-text">9.5.3.6 业务类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-3-7-%E6%B5%8B%E8%AF%95"><span class="toc-text">9.5.3.7 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-5-3-7-1-%E5%90%AF%E5%8A%A8-Nacos-Server"><span class="toc-text">9.5.3.7.1 启动 **Nacos Server</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-5-3-7-2-%E5%90%AF%E5%8A%A8-e-commerce-nacos-config-client5000"><span class="toc-text">9.5.3.7.2 启动 **e-commerce-nacos-config-client5000 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-5-3-7-3-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-5000-nacos-config-ip"><span class="toc-text">9.5.3.7.3 浏览器**: http:&#x2F;&#x2F;localhost:5000&#x2F;nacos&#x2F;config&#x2F;ip**</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-3-8-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">9.5.3.8 注意事项和细节</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-6-Nacos-%E5%88%86%E7%B1%BB%E9%85%8D%E7%BD%AE-%E5%AE%9E%E7%8E%B0%E9%85%8D%E7%BD%AE%E9%9A%94%E7%A6%BB"><span class="toc-text">9.6 Nacos 分类配置 (实现配置隔离)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-1-DataID%E6%96%B9%E6%A1%88"><span class="toc-text">9.6.1 DataID方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-1-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">9.6.1.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-1-2-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90"><span class="toc-text">9.6.1.2 解决方案分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-6-1-2-1-%E4%BD%BF%E7%94%A8-Data-ID-%E6%96%B9%E6%A1%88%E8%A7%A3%E5%86%B3"><span class="toc-text">9.6.1.2.1 使用 Data ID 方案解决</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-1-3-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0"><span class="toc-text">9.6.1.3 配置实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-1-4-%E4%BF%AE%E6%94%B9-application-yml"><span class="toc-text">9.6.1.4 修改 application.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-1-5-%E6%B5%8B%E8%AF%95"><span class="toc-text">9.6.1.5 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-6-1-5-1-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-5000-nacos-config-ip"><span class="toc-text">9.6.1.5.1 浏览器**: http:&#x2F;&#x2F;localhost:5000&#x2F;nacos&#x2F;config&#x2F;ip**</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-2-Group%E6%96%B9%E6%A1%88"><span class="toc-text">9.6.2 Group方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-2-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">9.6.2.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-2-2-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90"><span class="toc-text">9.6.2.2 解决方案分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-6-2-2-1-%E4%BD%BF%E7%94%A8-Group-%E6%96%B9%E6%A1%88%E8%A7%A3%E5%86%B3"><span class="toc-text">9.6.2.2.1 使用 Group 方案解决</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-2-3-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0"><span class="toc-text">9.6.2.3 配置实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-2-4-%E4%BF%AE%E6%94%B9-application-yml"><span class="toc-text">9.6.2.4 修改 application.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-2-5-%E4%BF%AE%E6%94%B9-bootstrap-yml"><span class="toc-text">9.6.2.5 修改 bootstrap.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-2-6-%E6%B5%8B%E8%AF%95"><span class="toc-text">9.6.2.6 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-6-2-6-1-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-5000-nacos-config-ip"><span class="toc-text">9.6.2.6.1 浏览器**: http:&#x2F;&#x2F;localhost:5000&#x2F;nacos&#x2F;config&#x2F;ip**</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-3-Namespace%E6%96%B9%E6%A1%88"><span class="toc-text">9.6.3 Namespace方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-3-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">9.6.3.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-3-2-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90"><span class="toc-text">9.6.3.2 解决方案分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-6-3-2-1-%E4%BD%BF%E7%94%A8-Namespace-%E6%96%B9%E6%A1%88%E8%A7%A3%E5%86%B3"><span class="toc-text">9.6.3.2.1 使用 Namespace 方案解决</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-3-3-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0"><span class="toc-text">9.6.3.3 配置实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-3-4-%E4%BF%AE%E6%94%B9-application-yml"><span class="toc-text">9.6.3.4 修改 application.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-3-5-%E4%BF%AE%E6%94%B9-bootstrap-yml"><span class="toc-text">9.6.3.5 修改 bootstrap.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-3-6-%E6%B5%8B%E8%AF%95"><span class="toc-text">9.6.3.6 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-6-3-6-1-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-5000-nacos-config-ip"><span class="toc-text">9.6.3.6.1 浏览器**: http:&#x2F;&#x2F;localhost:5000&#x2F;nacos&#x2F;config&#x2F;ip**</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-4-Namespace-x2F-Group-x2F-Data-ID-%E5%85%B3%E7%B3%BB"><span class="toc-text">9.6.4 Namespace&#x2F;Group&#x2F;Data ID 关系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-4-1-%E4%B8%80%E5%9B%BE%E8%83%9C%E5%8D%83%E8%A8%80"><span class="toc-text">9.6.4.1 一图胜千言</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-4-2-%E8%AF%A6%E8%A7%A3%E4%BB%8B%E7%BB%8D"><span class="toc-text">9.6.4.2 详解介绍</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-SpringCloud-Alibaba-Sentinel%E2%80%94%E2%80%94%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%B5%81%E9%87%8F%E5%93%A8%E5%85%B5"><span class="toc-text">10 SpringCloud Alibaba Sentinel——分布式系统的流量哨兵</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-Sentinel%E5%9F%BA%E7%A1%80"><span class="toc-text">10.1 Sentinel基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-1-%E5%AE%98%E7%BD%91"><span class="toc-text">10.1.1 官网</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-1-1-Github-https-github-com-alibaba-Sentinel"><span class="toc-text">10.1.1.1 Github: https:&#x2F;&#x2F;github.com&#x2F;alibaba&#x2F;Sentinel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-1-2-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B-https-sentinelguard-io-zh-cn-docs-quick-start-html"><span class="toc-text">10.1.1.2 快速开始: https:&#x2F;&#x2F;sentinelguard.io&#x2F;zh-cn&#x2F;docs&#x2F;quick-start.html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-1-3-%E4%B8%AD%E6%96%87-https-github-com-alibaba-Sentinel-wiki-E4-BB-8B-E7-BB-8D"><span class="toc-text">10.1.1.3 中文: https:&#x2F;&#x2F;github.com&#x2F;alibaba&#x2F;Sentinel&#x2F;wiki&#x2F;%E4%BB%8B%E7%BB%8D</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-1-4-%E4%BD%BF-%E7%94%A8-%E6%89%8B-%E5%86%8C-https-spring-cloud-alibaba-group-github-io-github-pages-greenwich-spring-cloud-alibaba-html-spring-cloud-alibaba-sentinel"><span class="toc-text">10.1.1.4 使 用 手 册 https:&#x2F;&#x2F;spring-cloud-alibaba-group.github.io&#x2F;github-pages&#x2F;greenwich&#x2F;spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-2-Sentinel%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">10.1.2 Sentinel是什么?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-2-1-Sentinel-%E6%A6%82%E8%BF%B0"><span class="toc-text">10.1.2.1 Sentinel 概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-2-2-%E4%B8%80%E5%8F%A5%E8%AF%9D-Sentinel-%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%B5%81%E9%87%8F%E9%98%B2%E5%8D%AB%E5%85%B5-%E4%BF%9D%E6%8A%A4%E4%BD%A0%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">10.1.2.2 一句话: Sentinel: 分布式系统的流量防卫兵, 保护你的微服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-3-Sentinel%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-text">10.1.3 Sentinel核心功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-3-1-%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="toc-text">10.1.3.1 流量控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-3-2-%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7"><span class="toc-text">10.1.3.2 熔断降级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-3-3-%E7%B3%BB%E7%BB%9F%E8%B4%9F%E8%BD%BD%E4%BF%9D%E6%8A%A4"><span class="toc-text">10.1.3.3 系统负载保护</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-3-4-%E6%B6%88%E6%81%AF%E5%89%8A%E5%B3%B0%E5%A1%AB%E8%B0%B7"><span class="toc-text">10.1.3.4 消息削峰填谷</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-4-Sentinel%E4%B8%A4%E4%B8%AA%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86"><span class="toc-text">10.1.4 Sentinel两个组成部分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-4-1-%E6%A0%B8%E5%BF%83%E5%BA%93-Java-%E5%AE%A2%E6%88%B7%E7%AB%AF-%E4%B8%8D%E4%BE%9D%E8%B5%96%E4%BB%BB%E4%BD%95%E6%A1%86%E6%9E%B6-x2F-%E5%BA%93%EF%BC%8C%E8%83%BD%E5%A4%9F%E8%BF%90%E8%A1%8C%E5%9C%A8%E6%89%80%E6%9C%89-Java%E8%BF%90%E8%A1%8C%E6%97%B6%E7%8E%AF%E5%A2%83%EF%BC%8C%E5%AF%B9-Spring-Cloud%E6%9C%89%E8%BE%83%E5%A5%BD%E7%9A%84%E6%94%AF%E6%8C%81"><span class="toc-text">10.1.4.1 核心库:(Java 客户端)不依赖任何框架&#x2F;库，能够运行在所有 Java运行时环境，对 Spring Cloud有较好的支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-4-2-%E6%8E%A7%E5%88%B6%E5%8F%B0-Dashboard-%E5%9F%BA%E4%BA%8E-Spring-Boot-%E5%BC%80%E5%8F%91%EF%BC%8C%E6%89%93%E5%8C%85%E5%90%8E%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E8%BF%90%E8%A1%8C%EF%BC%8C%E4%B8%8D%E9%9C%80%E8%A6%81%E9%A2%9D%E5%A4%96%E7%9A%84-Tomcat-%E7%AD%89%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8-%E5%B0%B1%E8%B7%9Fnacos%E3%80%81eureka%E9%82%A3%E7%A7%8D%E6%8E%A7%E5%88%B6%E5%8F%B0%E9%82%A3%E6%A0%B7"><span class="toc-text">10.1.4.2 控制台:(Dashboard)基于 Spring Boot 开发，打包后可以直接运行，不需要额外的 Tomcat 等应用容器(就跟nacos、eureka那种控制台那样)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-Sentinel%E6%8E%A7%E5%88%B6%E5%8F%B0"><span class="toc-text">10.2 Sentinel控制台</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.2.1 需求分析**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-2-%E4%B8%8B%E8%BD%BD"><span class="toc-text">10.2.2 下载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-2-1-https-github-com-alibaba-Sentinel-releases-tag-v1-8-0"><span class="toc-text">10.2.2.1 https:&#x2F;&#x2F;github.com&#x2F;alibaba&#x2F;Sentinel&#x2F;releases&#x2F;tag&#x2F;v1.8.0</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-3-%E8%BF%90%E8%A1%8C"><span class="toc-text">10.2.3 运行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-3-1-%E6%8C%87%E4%BB%A4"><span class="toc-text">10.2.3.1 指令:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-3-2-%E6%B3%A8%E6%84%8F-Sentinel-%E6%8E%A7%E5%88%B6%E5%8F%B0-%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A3%E6%98%AF-8080"><span class="toc-text">10.2.3.2 注意: Sentinel 控制台 默认端口是 8080</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-4-%E8%AE%BF%E9%97%AE"><span class="toc-text">10.2.4 访问</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-4-1-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-8080"><span class="toc-text">10.2.4.1 浏览器: http:&#x2F;&#x2F;localhost:8080</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-4-2-%E6%8E%A7%E5%88%B6%E5%8F%B0%E9%A1%B5%E9%9D%A2"><span class="toc-text">10.2.4.2 控制台页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3-Sentinel%E7%9B%91%E6%8E%A7%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">10.3 Sentinel监控微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.3.1 需求分析**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-2-%E4%BB%A3%E7%A0%81-x2F-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0"><span class="toc-text">10.3.2 代码**&#x2F;**配置实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.3.3 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3-3-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.3.3.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3-3-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.3.3.2 启动 Sentinel8080 控制台 &#x2F; Sentinel dashboard</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3-3-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004"><span class="toc-text">10.3.3.3 启动 member-service-nacos-provider-10004</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3-3-4-%E6%B5%8F%E8%A7%88%E5%99%A8-localhost-10004-x2F-member-x2F-get-x2F-1"><span class="toc-text">10.3.3.4 浏览器: localhost:10004&#x2F;member&#x2F;get&#x2F;1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3-3-5-Sentinel-%E6%8E%A7%E5%88%B6%E5%8F%B0%E7%9B%91%E6%8E%A7%E9%A1%B5%E9%9D%A2"><span class="toc-text">10.3.3.5 Sentinel 控制台监控页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-4-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">10.3.4 注意事项和细节</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3-4-1-QPS-Queries-Per-Second-%E6%AF%8F%E7%A7%92%E6%9F%A5%E8%AF%A2%E7%8E%87-%EF%BC%8C%E6%98%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%AF%8F%E7%A7%92%E5%93%8D%E5%BA%94%E7%9A%84%E6%9F%A5%E8%AF%A2%E6%AC%A1%E6%95%B0"><span class="toc-text">10.3.4.1 QPS: Queries Per Second(每秒查询率)，是服务器每秒响应的查询次数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3-4-2-Sentinel%E9%87%87%E7%94%A8%E7%9A%84%E6%98%AF%E6%87%92%E5%8A%A0%E8%BD%BD%EF%BC%8C%E5%8F%AA%E6%9C%89%E8%B0%83%E7%94%A8%E4%BA%86%E6%9F%90%E4%B8%AA%E6%8E%A5%E5%8F%A3-x2F-%E6%9C%8D%E5%8A%A1%EF%BC%8C%E6%89%8D%E8%83%BD%E7%9C%8B%E5%88%B0%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE"><span class="toc-text">10.3.4.2 Sentinel采用的是懒加载，只有调用了某个接口&#x2F;服务，才能看到监控数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-4-Sentinel%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="toc-text">10.4 Sentinel流量控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-1-%E8%A7%84%E5%88%99"><span class="toc-text">10.4.1 规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-2-%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E5%AE%9E%E4%BE%8B-QPS"><span class="toc-text">10.4.2 流量控制实例**-QPS**</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-2-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.4.2.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-2-2-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.4.2.2 配置实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-2-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.4.2.3 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-2-3-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.4.2.3.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-2-3-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard-10-4-2-3-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004"><span class="toc-text">10.4.2.3.2 启动 Sentinel8080 控制台**&#x2F;Sentinel dashboard 10.4.2.3.3** 启动 **member-service-nacos-provider-10004 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-2-3-4-%E6%B5%8F%E8%A7%88%E5%99%A8-localhost-10004-x2F-member-x2F-get-x2F-1"><span class="toc-text">10.4.2.3.4 浏览器**: localhost:10004&#x2F;member&#x2F;get&#x2F;1 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-2-3-5-Sentinel-%E6%8E%A7%E5%88%B6%E5%8F%B0%E7%9B%91%E6%8E%A7%E9%A1%B5%E9%9D%A2"><span class="toc-text">10.4.2.3.5 Sentinel 控制台监控页面</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-2-4-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">10.4.2.4 注意事项和细节</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%B5%81%E9%87%8F%E8%A7%84%E5%88%99%E6%94%B9%E5%8A%A8%EF%BC%8C%E5%AE%9E%E6%97%B6%E7%94%9F%E6%95%88%EF%BC%8C%E4%B8%8D%E9%9C%80%E9%87%8D%E5%90%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1-Sentinel-%E6%8E%A7%E5%88%B6%E5%8F%B0"><span class="toc-text">1. 流量规则改动，实时生效，不需重启微服务 , Sentinel 控制台</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%9C%A8-sentinel-%E9%85%8D%E7%BD%AE%E6%B5%81%E9%87%8F%E8%A7%84%E5%88%99%E6%97%B6%EF%BC%8C%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E9%80%9A%E9%85%8D%E7%AC%A6%E9%97%AE%E9%A2%98%EF%BC%8C-%E6%AF%94%E5%A6%82-x2F-member-x2F-get-x2F-1-x2F-member-x2F-get-x2F-2-%E7%BB%9F%E4%B8%80%E4%BD%BF%E7%94%A8%E4%B8%80%E4%B8%AA%E8%A7%84%E5%88%99"><span class="toc-text">2. 在 sentinel 配置流量规则时，如何配置通配符问题， 比如 &#x2F;member&#x2F;get&#x2F;1 &#x2F;member&#x2F;get&#x2F;2 统一使用一个规则</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%A6%82%E6%9E%9C-sentinel-%E6%B5%81%E6%8E%A7%E8%A7%84%E5%88%99%E6%B2%A1%E6%9C%89%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%8C%E5%BD%93%E6%88%91%E4%BB%AC%E9%87%8D%E5%90%AF%E8%B0%83%E7%94%A8-API-%E6%89%80%E5%9C%A8%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97%E5%90%8E%EF%BC%8C%E8%A7%84%E5%88%99%E4%BC%9A%E4%B8%A2%E5%A4%B1%EF%BC%8C%E9%9C%80%E8%A6%81%E9%87%8D%E6%96%B0%E5%8A%A0%E5%85%A5"><span class="toc-text">3. 如果 sentinel 流控规则没有持久化，当我们重启调用 API 所在微服务模块后，规则会丢失，需要重新加入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-3-%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E5%AE%9E%E4%BE%8B-%E7%BA%BF%E7%A8%8B%E6%95%B0"><span class="toc-text">10.4.3 流量控制实例**-**线程数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-3-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.4.3.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-3-2-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.4.3.2 配置实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-3-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.4.3.3 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-3-3-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.4.3.3.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-3-3-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.4.3.3.2 启动 Sentinel8080 控制台**&#x2F;Sentinel dashboard **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-3-3-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004"><span class="toc-text">10.4.3.3.3 启动 **member-service-nacos-provider-10004 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-3-3-4-%E6%B5%8F%E8%A7%88%E5%99%A8-localhost-10004-x2F-member-x2F-get-x2F-1"><span class="toc-text">10.4.3.3.4 浏览器**: localhost:10004&#x2F;member&#x2F;get&#x2F;1 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-3-3-5-%E7%BB%93%E6%9E%9C%E9%A1%B5%E9%9D%A2"><span class="toc-text">10.4.3.3.5 结果页面</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-3-4-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">10.4.3.4 注意事项和细节</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-4-%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E5%AE%9E%E4%BE%8B-%E5%85%B3%E8%81%94"><span class="toc-text">10.4.4 流量控制实例**-**关联</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-4-1-%E5%85%B3%E8%81%94%E7%9A%84%E5%90%AB%E4%B9%89"><span class="toc-text">10.4.4.1 关联的含义</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-4-1-1-%E5%BD%93%E5%85%B3%E8%81%94%E7%9A%84%E8%B5%84%E6%BA%90%E8%BE%BE%E5%88%B0%E9%98%88%E5%80%BC%E6%97%B6%EF%BC%8C%E5%B0%B1%E9%99%90%E6%B5%81%E8%87%AA%E5%B7%B1"><span class="toc-text">10.4.4.1.1 当关联的资源达到阈值时，就限流自己</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-4-2-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.4.4.2 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-4-3-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.4.4.3 配置实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-4-4-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.4.4.4 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-4-4-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.4.4.4.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-4-4-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.4.4.4.2 启动 Sentinel8080 控制台**&#x2F;Sentinel dashboard**</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-4-4-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004"><span class="toc-text">10.4.4.4.3 启动 **member-service-nacos-provider-10004 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-4-4-4-%E3%80%8CPostman%E6%A8%A1%E6%8B%9F%E9%AB%98%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE-x2F-t2-%E3%80%8D"><span class="toc-text">10.4.4.4.4 「Postman模拟高并发访问**&#x2F;t2**」</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-4-4-5-%E6%B5%8F%E8%A7%88%E5%99%A8-localhost-10004-x2F-t1"><span class="toc-text">10.4.4.4.5 浏览器: localhost:10004&#x2F;t1</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-4-5-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">10.4.4.5 注意事项和细节</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-5-%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E5%AE%9E%E4%BE%8B-Warm-up"><span class="toc-text">10.4.5 流量控制实例**-Warm up**</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-5-1-Warm-up-%E4%BB%8B%E7%BB%8D"><span class="toc-text">10.4.5.1 Warm up 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-5-1-1-%E6%96%87-%E6%A1%A3"><span class="toc-text">10.4.5.1.1 文 档 :</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-5-1-2-%E9%BB%98%E8%AE%A4-coldFactor-%E4%B8%BA-3%EF%BC%8C%E5%8D%B3%E8%AF%B7%E6%B1%82-QPS-%E4%BB%8E-threshold-x2F-3-%E5%BC%80%E5%A7%8B%EF%BC%8C%E7%BB%8F%E9%A2%84%E7%83%AD%E6%97%B6%E9%95%BF%E9%80%90%E6%B8%90%E5%8D%87%E8%87%B3%E8%AE%BE%E5%AE%9A%E7%9A%84-QPS-%E9%98%88%E5%80%BC"><span class="toc-text">10.4.5.1.2 默认 coldFactor 为 3，即请求 QPS 从 threshold &#x2F; 3 开始，经预热时长逐渐升至设定的 QPS 阈值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-5-1-3-Warm-up-%E7%A7%B0%E4%B8%BA-%E5%86%B7%E5%90%AF%E5%8A%A8-x2F-%E9%A2%84%E7%83%AD"><span class="toc-text">10.4.5.1.3 Warm up 称为 冷启动**&#x2F;**预热</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-5-1-4-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-%E7%A7%92%E6%9D%80%E5%9C%A8%E5%BC%80%E5%90%AF%E7%9E%AC%E9%97%B4%EF%BC%8C%E5%A4%A7%E6%B5%81%E9%87%8F%E5%BE%88%E5%AE%B9%E6%98%93%E9%80%A0%E6%88%90%E5%86%B2%E5%9E%AE%E7%B3%BB%E7%BB%9F%EF%BC%8CWarmup-%E5%8F%AF%E6%85%A2%E6%85%A2%E7%9A%84%E6%8A%8A%E6%B5%81%E9%87%8F%E6%94%BE%E5%85%A5%EF%BC%8C%E6%9C%80%E7%BB%88%E5%B0%86%E9%98%80%E5%80%BC%E5%A2%9E%E9%95%BF%E5%88%B0%E8%AE%BE%E7%BD%AE%E9%98%80%E5%80%BC"><span class="toc-text">10.4.5.1.4 应用场景**:** 秒杀在开启瞬间，大流量很容易造成冲垮系统，Warmup 可慢慢的把流量放入，最终将阀值增长到设置阀值</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-5-2-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.4.5.2 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-5-3-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.4.5.3 配置实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-5-4-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.4.5.4 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-5-4-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.4.5.4.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-5-4-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.4.5.4.2 启动 Sentinel8080 控制台**&#x2F;Sentinel dashboard **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-5-4-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004"><span class="toc-text">10.4.5.4.3 启动 **member-service-nacos-provider-10004 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-5-4-4-%E6%B5%8F%E8%A7%88%E5%99%A8-localhost-10004-x2F-t2"><span class="toc-text">10.4.5.4.4 浏览器**: localhost:10004&#x2F;t2**</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-5-5-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">10.4.5.5 注意事项和细节</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-5-5-2-%E5%A6%82%E6%9E%9C%E8%AF%B7%E6%B1%82%E5%81%9C%E6%AD%A2-%E5%8D%B3-%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E6%B2%A1%E6%9C%89%E8%BE%BE%E5%88%B0%E9%98%88%E5%80%BC-Warm-up-%E8%BF%87%E7%A8%8B%E5%B0%86%E9%87%8D%E5%A4%8D-%E5%B0%8F%E4%BC%99%E4%BC%B4%E5%8F%AF%E4%BB%A5%E7%90%86%E8%A7%A3%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BC%B9%E6%80%A7%E8%BF%87%E7%A8%8B"><span class="toc-text">10.4.5.5.2 如果请求停止**(即:** 一段时间没有达到阈值**), Warm up** 过程将重复**,** 小伙伴可以理解是一个弹性过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-6-%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E5%AE%9E%E4%BE%8B-%E6%8E%92%E9%98%9F"><span class="toc-text">10.4.6 流量控制实例**-**排队</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-6-1-%E6%8E%92%E9%98%9F-%E4%BB%8B%E7%BB%8D"><span class="toc-text">10.4.6.1 排队 介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-6-2-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.4.6.2 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-6-3-%E4%BF%AE%E6%94%B9%E4%B8%9A%E5%8A%A1%E7%B1%BB"><span class="toc-text">10.4.6.3 修改业务类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-6-4-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.4.6.4 配置实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-6-5-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.4.6.5 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-6-5-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.4.6.5.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-6-5-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.4.6.5.2 启动 Sentinel8080 控制台**&#x2F;Sentinel dashboard **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-6-5-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004"><span class="toc-text">10.4.6.5.3 启动 **member-service-nacos-provider-10004 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-4-6-5-4-%E6%B5%8F%E8%A7%88%E5%99%A8-localhost-10004-x2F-t2"><span class="toc-text">10.4.6.5.4 浏览器**: localhost:10004&#x2F;t2**</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-5-Sentinel%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7"><span class="toc-text">10.5 Sentinel熔断降级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-1-%E7%BA%BF%E7%A8%8B%E5%A0%86%E7%A7%AF%E5%BC%95%E5%87%BA%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7"><span class="toc-text">10.5.1 线程堆积引出熔断降级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-2-%E6%96%87%E6%A1%A3%E5%9C%B0%E5%9D%80-https-sentinelguard-io-zh-cn-docs-circuit-breaking-html"><span class="toc-text">10.5.2 文档地址**: https:&#x2F;&#x2F;sentinelguard.io&#x2F;zh-cn&#x2F;docs&#x2F;circuit-breaking.html**</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-3-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">10.5.3 基本介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-4-%E7%86%94%E6%96%AD%E7%AD%96%E7%95%A5"><span class="toc-text">10.5.4 熔断策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-4-1-%E6%85%A2%E8%B0%83%E7%94%A8%E6%AF%94%E4%BE%8B"><span class="toc-text">10.5.4.1 慢调用比例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-4-2-%E5%BC%82%E5%B8%B8%E6%AF%94%E4%BE%8B"><span class="toc-text">10.5.4.2 异常比例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-4-3-%E5%BC%82%E5%B8%B8%E6%95%B0"><span class="toc-text">10.5.4.3 异常数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-5-%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7%E5%AE%9E%E4%BE%8B-%E6%85%A2%E8%B0%83%E7%94%A8%E6%AF%94%E4%BE%8B"><span class="toc-text">10.5.5 熔断降级实例**-**慢调用比例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-5-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.5.5.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-5-2-%E4%BF%AE%E6%94%B9%E4%B8%9A%E5%8A%A1%E7%B1%BB"><span class="toc-text">10.5.5.2 修改业务类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-5-3-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.5.5.3 配置实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-5-4-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.5.5.4 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-5-5-4-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.5.5.4.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-5-5-4-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.5.5.4.2 启动 Sentinel8080 控制台**&#x2F;Sentinel dashboard **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-5-5-4-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004"><span class="toc-text">10.5.5.4.3 启动 member-service-nacos-provider-10004</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-5-5-4-4-Postman%E6%B5%8B%E8%AF%95"><span class="toc-text">10.5.5.4.4 Postman测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-5-5-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">10.5.5.5 注意事项和细节</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-5-5-5-1-%E5%B9%B3%E5%9D%87%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4%E8%B6%85%E5%87%BA%E9%98%88%E5%80%BC%E4%B8%94%E5%9C%A8-1s-%E5%86%85%E9%80%9A%E8%BF%87%E7%9A%84%E8%AF%B7%E6%B1%82-gt-x3D-5-%EF%BC%8C-%E4%B8%A4%E4%B8%AA%E6%9D%A1%E4%BB%B6%E5%90%8C%E6%97%B6%E6%BB%A1%E8%B6%B3%E5%90%8E%E8%A7%A6%E5%8F%91%E9%99%8D%E7%BA%A7"><span class="toc-text">10.5.5.5.1 平均响应时间超出阈值且在 1s 内通过的请求**&gt;&#x3D;5**， 两个条件同时满足后触发降级</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-5-5-5-2-%E7%86%94%E6%96%AD%E6%97%B6%E9%97%B4%E8%BF%87%E5%90%8E%EF%BC%8C%E5%85%B3%E9%97%AD%E6%96%AD%E8%B7%AF%E5%99%A8%EF%BC%8C%E8%AE%BF%E9%97%AE%E6%81%A2%E5%A4%8D%E6%AD%A3%E5%B8%B8"><span class="toc-text">10.5.5.5.2 熔断时间过后，关闭断路器，访问恢复正常</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-6-%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7%E5%AE%9E%E4%BE%8B-%E5%BC%82%E5%B8%B8%E6%AF%94%E4%BE%8B"><span class="toc-text">10.5.6 熔断降级实例-异常比例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-6-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.5.6.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-6-2-%E4%BF%AE%E6%94%B9%E4%B8%9A%E5%8A%A1%E7%B1%BB"><span class="toc-text">10.5.6.2 修改业务类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-6-3-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.5.6.3 配置实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-6-4-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.5.6.4 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-5-6-4-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.5.6.4.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-5-6-4-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.5.6.4.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-5-6-4-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004"><span class="toc-text">10.5.6.4.3 启动 member-service-nacos-provider-10004</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-5-6-4-4-Postman%E6%B5%8B%E8%AF%95"><span class="toc-text">10.5.6.4.4 Postman测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-7-5%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">10.5.7.5注意事项和细节</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-5-7-5-1-%E8%B5%84%E6%BA%90%E5%9C%A8-1-%E5%88%86%E9%92%9F%E7%9A%84%E5%BC%82%E5%B8%B8%E6%95%B0%E7%9B%AE%E8%B6%85%E8%BF%87%E9%98%88%E5%80%BC%E4%B9%8B%E5%90%8E%E4%BC%9A%E8%BF%9B%E8%A1%8C%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7"><span class="toc-text">10.5.7.5.1 资源在 1 分钟的异常数目超过阈值之后会进行熔断降级</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-6-Sentinel-%E7%83%AD%E7%82%B9%E8%A7%84%E5%88%99"><span class="toc-text">10.6 Sentinel 热点规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-1-%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%E5%BC%95%E5%87%BA%E7%83%AD%E7%82%B9-key-%E9%99%90%E6%B5%81"><span class="toc-text">10.6.1 一个问题引出热点 key 限流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-2%E6%96%87%E6%A1%A3%E5%9C%B0%E5%9D%80"><span class="toc-text">10.6.2文档地址 :</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-3-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">10.6.3 基本介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-4-%E7%83%AD%E7%82%B9-Key-%E9%99%90%E6%B5%81-%E5%AE%9E%E4%BE%8B"><span class="toc-text">10.6.4 热点 Key 限流**-**实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-6-4-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.6.4.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-6-4-2-%E4%BF%AE%E6%94%B9%E4%B8%9A%E5%8A%A1%E7%B1%BB"><span class="toc-text">10.6.4.2 修改业务类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-6-4-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.6.4.3 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-6-4-3-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.6.4.3.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-6-4-3-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.6.4.3.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-6-4-3-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004"><span class="toc-text">10.6.4.3.3 启动 member-service-nacos-provider-10004</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-6-4-3-4-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.6.4.3.4 配置实现步骤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-6-4-3-5-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-10004-news-id-1-amp-type-E6-95-99-E8-82-B2"><span class="toc-text">10.6.4.3.5 浏览器**: http:&#x2F;&#x2F;localhost:10004&#x2F;news?id&#x3D;1&amp;type&#x3D;%E6%95%99%E8%82%B2**</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-6-4-3-6-%E7%8B%AC%E7%AB%8B%E8%AE%BE%E7%BD%AE%E7%83%AD%E7%82%B9-id-x3D-10-%E7%9A%84-QPS-%E9%98%88%E5%80%BC-%E5%8D%B3%E6%B7%BB%E5%8A%A0%E4%BE%8B%E5%A4%96"><span class="toc-text">10.6.4.3.6 独立设置热点 id&#x3D;10 的 QPS 阈值(即添加例外)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-6-4-3-7-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-10004-news-id-10-amp-type-E6-95-99-E8-82-B2"><span class="toc-text">10.6.4.3.7 浏览器: http:&#x2F;&#x2F;localhost:10004&#x2F;news?id&#x3D;10&amp;type&#x3D;%E6%95%99%E8%82%B2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-5-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">10.6.5 注意事项和细节</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-6-5-1-%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B%E6%98%AF-byte-x2F-int-x2F-long-x2F-float-x2F-double-x2F-char-x2F-String"><span class="toc-text">10.6.5.1 热点参数类型是(byte&#x2F;int&#x2F;long&#x2F;float&#x2F;double&#x2F;char&#x2F;String)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-6-5-2-%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E5%80%BC%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AA"><span class="toc-text">10.6.5.2 热点参数值，可以配置多个</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-6-5-3-%E7%83%AD%E7%82%B9%E8%A7%84%E5%88%99%E5%8F%AA%E5%AF%B9%E6%8C%87%E5%AE%9A%E7%9A%84%E5%8F%82%E6%95%B0%E7%94%9F%E6%95%88-%E6%AF%94%E5%A6%82%E6%9C%AC%E5%AE%9E%E4%BE%8B%E5%AF%B9-id-%E7%94%9F%E6%95%88-%E5%AF%B9-type-%E4%B8%8D%E7%94%9F%E6%95%88"><span class="toc-text">10.6.5.3 热点规则只对指定的参数生效 (比如本实例对 id 生效, 对 type 不生效)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-7-%E7%B3%BB%E7%BB%9F%E8%A7%84%E5%88%99"><span class="toc-text">10.7 系统规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-7-1-%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%E5%BC%95%E5%87%BA%E7%B3%BB%E7%BB%9F%E8%A7%84%E5%88%99"><span class="toc-text">10.7.1 一个问题引出系统规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-7-2%E6%96%87-%E6%A1%A3-%E5%9C%B0-%E5%9D%80"><span class="toc-text">10.7.2文 档 地 址 :</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-7-3-%E4%B8%80%E5%8F%A5%E8%AF%9D-%E7%B3%BB%E7%BB%9F%E8%A7%84%E5%88%99%E4%BD%9C%E7%94%A8-%E5%9C%A8%E7%B3%BB%E7%BB%9F%E7%A8%B3%E5%AE%9A%E7%9A%84%E5%89%8D%E6%8F%90%E4%B8%8B%EF%BC%8C%E4%BF%9D%E6%8C%81%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%90%9E%E5%90%90%E9%87%8F"><span class="toc-text">10.7.3 一句话**:** 系统规则作用**,** 在系统稳定的前提下，保持系统的吞吐量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-7-4-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">10.7.4 基本介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-7-5-%E5%AE%9E%E4%BE%8B"><span class="toc-text">10.7.5 实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-7-5-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.7.5.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-7-5-2-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.7.5.2 配置实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-7-5-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.7.5.3 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-7-5-3-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.7.5.3.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-7-5-3-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.7.5.3.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-7-5-3-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004"><span class="toc-text">10.7.5.3.3 启动 member-service-nacos-provider-10004</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-7-5-3-4-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-10004-t1"><span class="toc-text">10.7.5.3.4 浏览器: http:&#x2F;&#x2F;localhost:10004&#x2F;t1</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-8-SentinelResource"><span class="toc-text">10.8 @SentinelResource</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-8-1-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%A8%E5%B1%80%E9%99%90%E6%B5%81%E5%A4%84%E7%90%86%E7%B1%BB"><span class="toc-text">10.8.1 自定义全局限流处理类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-1-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.8.1.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-1-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">10.8.1.2 代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-1-3-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.8.1.3 配置实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-1-4-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.8.1.4 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-8-1-4-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.8.1.4.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-8-1-4-2-%E5%90%AF%E5%8A%A8-Sentinel8080%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.8.1.4.2 启动 Sentinel8080控制台&#x2F;Sentinel dashboard</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-8-1-4-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004"><span class="toc-text">10.8.1.4.3 启动 member-service-nacos-provider-10004</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-8-1-4-4-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-10004-t6"><span class="toc-text">10.8.1.4.4 浏览器: http:&#x2F;&#x2F;localhost:10004&#x2F;t6</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-8-2-fallback%E8%87%AA%E5%AE%9A%E4%B9%89%E7%A8%8B%E5%BA%8F%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-text">10.8.2 fallback	自定义程序错误处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-2-1-%E7%9C%8B%E4%B8%80%E6%AE%B5%E4%BB%A3%E7%A0%81-%E5%BC%95%E5%87%BA-fallback"><span class="toc-text">10.8.2.1 看一段代码-引出 fallback</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-2-2-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">10.8.2.2 基本介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-8-2-2-1-blockHandler%E5%8F%AA%E8%B4%9F%E8%B4%A3sentinel%E6%8E%A7%E5%88%B6%E5%8F%B0%E9%85%8D%E7%BD%AE%E8%BF%9D%E8%A7%84"><span class="toc-text">10.8.2.2.1 blockHandler只负责sentinel控制台配置违规</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-8-2-2-2-fallback%E8%B4%9F%E8%B4%A3Java%E5%BC%82%E5%B8%B8-x2F-%E4%B8%9A%E5%8A%A1%E5%BC%82%E5%B8%B8"><span class="toc-text">10.8.2.2.2 fallback负责Java异常&#x2F;业务异常</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-2-3-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.8.2.3 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-2-4-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">10.8.2.4 代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-2-5-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.8.2.5 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-8-2-5-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.8.2.5.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-8-2-5-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.8.2.5.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-8-2-5-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004"><span class="toc-text">10.8.2.5.3 启动 member-service-nacos-provider-10004</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-8-2-5-4-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-10004-t6"><span class="toc-text">10.8.2.5.4 浏览器: http:&#x2F;&#x2F;localhost:10004&#x2F;t6</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-8-3-exceptionsToIgnore-%E5%B8%8C%E6%9C%9B%E5%BF%BD%E7%95%A5%E6%9F%90%E4%B8%AA%E5%BC%82%E5%B8%B8"><span class="toc-text">10.8.3 exceptionsToIgnore  希望忽略某个异常</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-3-1-%E5%A6%82%E6%9E%9C%E5%B8%8C%E6%9C%9B%E5%BF%BD%E7%95%A5%E6%9F%90%E4%B8%AA%E5%BC%82%E5%B8%B8%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8-exceptionsToIgnore"><span class="toc-text">10.8.3.1 如果希望忽略某个异常，可以使用 exceptionsToIgnore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-3-2-%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="toc-text">10.8.3.2 应用实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-8-4-%E6%8E%A5%E5%85%A5-Sentinel-%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">10.8.4 接入 Sentinel 的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-4-1-%E4%BB%A3%E7%A0%81%E6%96%B9%E5%BC%8F-%E7%A1%AC%E7%BC%96%E7%A0%81%EF%BC%8C%E4%BE%B5%E5%85%A5%E6%80%A7%E5%BC%BA-%E4%B8%8D%E6%8E%A8%E8%8D%90"><span class="toc-text">10.8.4.1 代码方式(硬编码，侵入性强, 不推荐)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-8-4-2-%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F-%E4%BD%8E%E4%BE%B5%E5%85%A5%E6%80%A7-%E5%89%8D%E9%9D%A2%E7%94%A8%E8%BF%87-%E6%8E%A8%E8%8D%90"><span class="toc-text">10.8.4.2 注解方式(低侵入性, 前面用过, 推荐)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-9-openFeign-sentinel-%E5%AF%B9%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7"><span class="toc-text">10.9 openFeign+sentinel 对远程调用熔断降级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-9-1-%E5%BD%93%E5%89%8D%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83"><span class="toc-text">10.9.1 当前微服务基础环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-1-1-%E5%BD%93%E5%89%8D%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="toc-text">10.9.1.1 当前微服务环境架构图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-1-2-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.9.1.2 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-1-2-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.9.1.2.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-1-2-2-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004-x2F-10006"><span class="toc-text">10.9.1.2.2 启动 member-service-nacos-provider-10004&#x2F;10006</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-1-2-3-%E5%90%AF%E5%8A%A8-member-service-nacos-consumer-80"><span class="toc-text">10.9.1.2.3 启动 member-service-nacos-consumer-80</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-1-2-4-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-member-nacos-consumer-get-1"><span class="toc-text">10.9.1.2.4 浏览器**: http:&#x2F;&#x2F;localhost&#x2F;member&#x2F;nacos&#x2F;consumer&#x2F;get&#x2F;1**</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-9-2-%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85%E6%95%B4%E5%90%88-Openfeign"><span class="toc-text">10.9.2 服务消费者整合 Openfeign</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-2-2-%E4%BB%A3%E7%A0%81-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.9.2.2 代码+配置实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-2-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.9.2.3 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-2-3-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.9.2.3.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-2-3-2-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004-x2F-10006"><span class="toc-text">10.9.2.3.2 启动 **member-service-nacos-provider-10004&#x2F;10006 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-2-3-3-%E5%90%AF%E5%8A%A8-member-service-nacos-consumer-80"><span class="toc-text">10.9.2.3.3 启动 member-service-nacos-consumer-80</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-2-3-4-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-member-openfeign-consumer-get-1"><span class="toc-text">10.9.2.3.4 浏览器**: http:&#x2F;&#x2F;localhost&#x2F;member&#x2F;openfeign&#x2F;consumer&#x2F;get&#x2F;1**</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-9-3-%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85%E6%95%B4%E5%90%88-Sentinel"><span class="toc-text">10.9.3 服务消费者整合 Sentinel</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-3-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.9.3.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-3-2-%E4%BB%A3%E7%A0%81-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.9.3.2 代码+配置实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-3-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.9.3.3 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-3-3-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.9.3.3.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-3-3-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.9.3.3.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-3-3-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004-x2F-10006"><span class="toc-text">10.9.3.3.3 启动 **member-service-nacos-provider-10004&#x2F;10006 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-3-3-4-%E5%90%AF%E5%8A%A8-member-service-nacos-consumer-80"><span class="toc-text">10.9.3.3.4 启动 member-service-nacos-consumer-80</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-3-3-5-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-member-openfeign-consumer-get-1"><span class="toc-text">10.9.3.3.5 浏览器**: http:&#x2F;&#x2F;localhost&#x2F;member&#x2F;openfeign&#x2F;consumer&#x2F;get&#x2F;1**</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-9-4-openFeign-sentinel-%E5%AF%B9%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7"><span class="toc-text">10.9.4 openFeign+sentinel 对远程调用熔断降级</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-4-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.9.4.1 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-4-2-%E4%BB%A3%E7%A0%81-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.9.4.2 代码+配置实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-4-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.9.4.3 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-4-3-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.9.4.3.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-4-3-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.9.4.3.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-4-3-3-%E5%85%B3%E9%97%AD-member-service-nacos-provider-10004-x2F-10006"><span class="toc-text">10.9.4.3.3 关闭 **member-service-nacos-provider-10004&#x2F;10006 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-4-3-4-%E5%90%AF%E5%8A%A8-member-service-nacos-consumer-80"><span class="toc-text">10.9.4.3.4 启动 member-service-nacos-consumer-80</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-9-4-3-5-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-member-openfeign-consumer-get-1"><span class="toc-text">10.9.4.3.5 浏览器**: http:&#x2F;&#x2F;localhost&#x2F;member&#x2F;openfeign&#x2F;consumer&#x2F;get&#x2F;1**</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-9-4-4-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82%E8%AF%B4%E6%98%8E"><span class="toc-text">10.9.4.4 注意事项和细节说明</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-10-%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">10.10 规则持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-10-1-%E8%A7%84%E5%88%99%E6%B2%A1%E6%9C%89%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">10.10.1 规则没有持久化的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-10-1-1-%E5%A6%82%E6%9E%9C-sentinel-%E6%B5%81%E6%8E%A7%E8%A7%84%E5%88%99%E6%B2%A1%E6%9C%89%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%8C%E5%BD%93%E9%87%8D%E5%90%AF%E8%B0%83%E7%94%A8-API-x2F-%E6%8E%A5%E5%8F%A3-%E6%89%80%E5%9C%A8%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%90%8E%EF%BC%8C%E8%A7%84%E5%88%99%E5%B0%B1%E4%BC%9A%E4%B8%A2%E5%A4%B1%EF%BC%8C%E9%9C%80%E8%A6%81-%E9%87%8D%E6%96%B0%E5%8A%A0%E5%85%A5"><span class="toc-text">10.10.1.1 如果 sentinel 流控规则没有持久化，当重启调用 API&#x2F;接口 所在微服务后，规则就会丢失，需要 重新加入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-10-1-2-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-%E9%80%9A%E8%BF%87-Nacos-%E8%BF%9B%E8%A1%8C%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">10.10.1.2 解决方案:通过 Nacos 进行持久化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-10-2-%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96%E6%96%B9%E6%A1%88"><span class="toc-text">10.10.2 规则持久化方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-10-2-1-%E9%98%BF%E9%87%8C%E4%BA%91-Ahas-%E6%9C%80%E6%96%B9%E4%BE%BF-x2F-%E4%BB%98%E8%B4%B9"><span class="toc-text">10.10.2.1 阿里云 Ahas[最方便&#x2F;付费]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-10-2-2-%F0%9F%8C%9F%E5%9C%A8-Nacos-Server-%E9%85%8D%E7%BD%AE%E8%A7%84%E5%88%99-%E5%AE%8C%E6%88%90%E6%8C%81%E4%B9%85%E5%8C%96-%E5%AE%98%E6%96%B9%E6%8E%A8%E8%8D%90"><span class="toc-text">10.10.2.2 🌟在 Nacos Server 配置规则, 完成持久化 -官方推荐</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-10-2-3-%E5%B0%86%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96%E5%88%B0%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6-%E5%AE%9A%E6%97%B6%E5%90%8C%E6%AD%A5"><span class="toc-text">10.10.2.3 将规则持久化到本地文件, 定时同步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-10-2-4-%E5%85%B6%E5%AE%83%E2%80%A6"><span class="toc-text">10.10.2.4 其它…</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-10-3-Nacos-Server-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E8%A7%84%E5%88%99%E6%8C%81%E4%B9%85%E5%8C%96%E5%AE%9E%E4%BE%8B"><span class="toc-text">10.10.3 Nacos Server 配置中心**-**规则持久化实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-10-3-1-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="toc-text">10.10.3.1 工作原理示意图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-10-3-2-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">10.10.3.2 需求分析&#x2F;图解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-10-3-3-%E4%BB%A3%E7%A0%81-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">10.10.3.3 代码+配置实现步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-10-3-4-%E6%B5%8B%E8%AF%95"><span class="toc-text">10.10.3.4 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-10-3-4-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">10.10.3.4.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-10-3-4-2-%E5%90%AF%E5%8A%A8-Sentinel8080-%E6%8E%A7%E5%88%B6%E5%8F%B0-x2F-Sentinel-dashboard"><span class="toc-text">10.10.3.4.2 启动 Sentinel8080 控制台&#x2F;Sentinel dashboard</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-10-3-4-3-%E5%90%AF%E5%8A%A8-member-service-nacos-provider-10004-x2F-10006"><span class="toc-text">10.10.3.4.3 启动 **member-service-nacos-provider-10004&#x2F;10006 **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-10-3-4-4-%E5%90%AF%E5%8A%A8-member-service-nacos-consumer-80"><span class="toc-text">10.10.3.4.4 启动 member-service-nacos-consumer-80</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-10-3-4-5-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-member-openfeign-consumer-get-1"><span class="toc-text">10.10.3.4.5 浏览器**: http:&#x2F;&#x2F;localhost&#x2F;member&#x2F;openfeign&#x2F;consumer&#x2F;get&#x2F;1**</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-10-3-5-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">10.10.3.5 注意事项和细节</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-SpringCloud-Alibaba-Seata%E5%85%A8%E5%B1%80%E4%BA%8B%E5%8A%A1"><span class="toc-text">11 SpringCloud Alibaba Seata全局事务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-1-Seata%E5%9F%BA%E7%A1%80"><span class="toc-text">11.1 Seata基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-1-%E5%85%88%E7%9C%8B%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8C%E5%BC%95%E5%87%BA-Seata"><span class="toc-text">11.1.1 先看一个问题，引出 Seata</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-2-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98-amp-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">11.1.2 分布式事务问题**&amp;**解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-1-2-1-%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%8B%E7%9A%84%E5%85%A8%E5%B1%80%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98-%E5%8D%B3-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98"><span class="toc-text">11.1.2.1 分布式微服务架构下的全局数据一致性问题 [即: 分布式事务问题]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-1-2-2-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-Seata"><span class="toc-text">11.1.2.2 解决方案: Seata</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-3-%E5%AE%98%E7%BD%91"><span class="toc-text">11.1.3 官网</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-1-3-1-http-seata-io-zh-cn"><span class="toc-text">11.1.3.1 http:&#x2F;&#x2F;seata.io&#x2F;zh-cn&#x2F;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-1-3-2-%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C-https-seata-io-zh-cn-docs-overview-what-is-seata-html"><span class="toc-text">11.1.3.2 使用手册: https:&#x2F;&#x2F;seata.io&#x2F;zh-cn&#x2F;docs&#x2F;overview&#x2F;what-is-seata.html</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-4-Seata%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">11.1.4 Seata是什么?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2-%F0%9F%8C%9FSeata-%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6-x2F-%E8%BF%94%E8%AE%B2"><span class="toc-text">11.2 🌟Seata 工作机制&#x2F;返讲</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-1-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-text">11.2.1 分布式事务过程分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-2-Seata-%E4%BA%8B%E5%8A%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text">11.2.2 Seata 事务模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-2-1-AT-%E9%BB%98%E8%AE%A4%E6%A8%A1%E5%BC%8F"><span class="toc-text">11.2.2.1 AT(默认模式)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-2-2-TCC"><span class="toc-text">11.2.2.2 TCC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-2-3-SAGA"><span class="toc-text">11.2.2.3 SAGA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-2-4-XA"><span class="toc-text">11.2.2.4 XA</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-3-AT%E6%97%A0%E4%BE%B5%E5%85%A5%E6%A8%A1%E5%BC%8F"><span class="toc-text">11.2.3 AT无侵入模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-3-1-%E6%96%87%E6%A1%A3-https-seata-io-zh-cn-docs-overview-what-is-seata-html"><span class="toc-text">11.2.3.1 文档: https:&#x2F;&#x2F;seata.io&#x2F;zh-cn&#x2F;docs&#x2F;overview&#x2F;what-is-seata.html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-3-2-%E4%B8%80%E9%98%B6%E6%AE%B5%E5%8A%A0%E8%BD%BD"><span class="toc-text">11.2.3.2 一阶段加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-3-3-%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4"><span class="toc-text">11.2.3.3 二阶段提交</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-3-4-%E4%BA%8C%E9%98%B6%E6%AE%B5%E5%9B%9E%E6%BB%9A"><span class="toc-text">11.2.3.4 二阶段回滚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-4-AT%E4%BA%8B%E5%8A%A1%E6%A8%A1%E5%BC%8FDebug%E9%AA%8C%E8%AF%81"><span class="toc-text">11.2.4 AT事务模式Debug验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-5-SEATA%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%A4%E6%98%93%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">11.2.5 SEATA的分布式交易解决方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-3-SeataServer%E5%AE%89%E8%A3%85"><span class="toc-text">11.3 SeataServer安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-1-%E4%B8%8B%E8%BD%BD"><span class="toc-text">11.3.1 下载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-3-1-1-https-github-com-seata-seata-releases-tag-v0-9-0"><span class="toc-text">11.3.1.1 https:&#x2F;&#x2F;github.com&#x2F;seata&#x2F;seata&#x2F;releases&#x2F;tag&#x2F;v0.9.0</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-2-%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE"><span class="toc-text">11.3.2 安装和配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-3-%E5%90%AF%E5%8A%A8"><span class="toc-text">11.3.3 启动</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-3-3-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">11.3.3.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-3-3-2-%E5%8F%8C%E5%87%BB-Seata-%E7%9A%84-bin-seata-server-bat-%E5%90%AF%E5%8A%A8-Seata-Server"><span class="toc-text">11.3.3.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-3-3-3-%E7%99%BB%E5%BD%95-Nacos-Server-%E6%9F%A5%E7%9C%8B-Seata-Server-%E6%98%AF%E5%90%A6%E6%B3%A8%E5%86%8C%E6%88%90%E5%8A%9F"><span class="toc-text">11.3.3.3 登录 Nacos Server , 查看 Seata Server 是否注册成功</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-4-Seata-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1-%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="toc-text">11.4 Seata 分布式事务-应用实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-x2F-%E5%9B%BE%E8%A7%A3"><span class="toc-text">11.4.1 需求分析**&#x2F;**图解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-2-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8"><span class="toc-text">11.4.2 创建数据库和表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-3-%E5%BC%80%E5%8F%91-seata-storage-micro-service-10010-%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">11.4.3 开发 seata_storage_micro_service-10010 微服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-4-%E6%B5%8B%E8%AF%95-seata-storage-micro-service-10010-%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">11.4.4 测试 seata_storage_micro_service-10010 微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-4-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">11.4.4.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-4-2-%E5%8F%8C%E5%87%BB-Seata-%E7%9A%84-bin-seata-server-bat-%E5%90%AF%E5%8A%A8-Seata-Server"><span class="toc-text">11.4.4.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-4-3-%E5%90%AF%E5%8A%A8-seata-storage-micro-service-10010"><span class="toc-text">11.4.4.3 启动 seata_storage_micro_service-10010</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-4-4-%E7%99%BB%E5%BD%95-Nacos-Server-%E6%9F%A5%E7%9C%8B-10010-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%98%AF%E5%90%A6%E6%B3%A8%E5%86%8C%E6%88%90%E5%8A%9F"><span class="toc-text">11.4.4.4 登录 Nacos Server , 查看 10010 微服务是否注册成功</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-5-%E5%BC%80%E5%8F%91-seata-account-micro-service-10012-%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">11.4.5 开发 seata_account_micro_service-10012 微服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-6-%E6%B5%8B%E8%AF%95-seata-account-micro-service-10012-%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">11.4.6 测试 seata_account_micro_service-10012 微服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-6-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">11.4.6.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-6-2-%E5%8F%8C%E5%87%BB-Seata-%E7%9A%84-bin-seata-server-bat-%E5%90%AF%E5%8A%A8-Seata-Server"><span class="toc-text">11.4.6.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-6-3-%E5%90%AF%E5%8A%A8-seata-account-micro-service-10012"><span class="toc-text">11.4.6.3 启动 seata_account_micro_service-10012</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-6-4-%E7%99%BB%E5%BD%95-Nacos-Server-%E6%9F%A5%E7%9C%8B-10012-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%98%AF%E5%90%A6%E6%B3%A8%E5%86%8C%E6%88%90%E5%8A%9F"><span class="toc-text">11.4.6.4 登录 Nacos Server , 查看 10012 微服务是否注册成功</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-8-%E6%B5%8B%E8%AF%95-seata-order-micro-service-10008-%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">11.4.8 测试 seata-order-micro-service-10008 微服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-9-%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95-1-%E4%B8%89%E4%B8%AA%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8D%8F%E5%90%8C%E5%AE%8C%E6%88%90-%E6%AD%A3%E5%B8%B8%E4%B8%8B%E5%8D%95"><span class="toc-text">11.4.9 集成测试**(1)** 三个微服务协同完成**-**正常下单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-9-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">11.4.9.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-9-2-%E5%8F%8C%E5%87%BB-Seata-%E7%9A%84-bin-seata-server-bat-%E5%90%AF%E5%8A%A8-Seata-Server"><span class="toc-text">11.4.9.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-9-3-%E5%90%AF%E5%8A%A8-seata-order-micro-service-10010-x2F-10012-x2F-10008-%E4%B8%89%E4%B8%AA%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">11.4.9.3 启动 seata-order-micro-service-10010 &#x2F;10012&#x2F;10008 三个微服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-9-4-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100"><span class="toc-text">11.4.9.4 浏览器 : http:&#x2F;&#x2F;localhost:10008&#x2F;order&#x2F;save?userId&#x3D;666&amp;productId&#x3D;1&amp;nums&#x3D;1&amp;money&#x3D;100</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-9-5-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">11.4.9.5 注意事项和细节</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-10-%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95-2-%E4%B8%89%E4%B8%AA%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8D%8F%E5%90%8C%E5%AE%8C%E6%88%90-%E6%A8%A1%E6%8B%9F%E5%BC%82%E5%B8%B8"><span class="toc-text">11.4.10 集成测试**(2)** 三个微服务协同完成**-**模拟异常</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-10-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">11.4.10.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-10-2-%E5%8F%8C%E5%87%BB-Seata-%E7%9A%84-bin-seata-server-bat-%E5%90%AF%E5%8A%A8-Seata-Server"><span class="toc-text">11.4.10.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-10-3-%E5%90%AF%E5%8A%A8-seata-order-micro-service-100010-x2F-10012-x2F-10008-%E4%B8%89%E4%B8%AA%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">11.4.10.3 启动 seata-order-micro-service-100010 &#x2F;10012&#x2F;10008 三个微服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-10-4-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100"><span class="toc-text">11.4.10.4 浏览器 : http:&#x2F;&#x2F;localhost:10008&#x2F;order&#x2F;save?userId&#x3D;666&amp;productId&#x3D;1&amp;nums&#x3D;1&amp;money&#x3D;100</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-11-%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95-3-%E4%B8%89%E4%B8%AA%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8D%8F%E5%90%8C%E5%AE%8C%E6%88%90-%E4%BD%BF%E7%94%A8-GlobalTransactional-%E5%AE%8C%E6%88%90%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6-%E5%87%BA%E7%8E%B0%E5%BC%82%E5%B8%B8%EF%BC%8C%E4%B9%9F%E8%83%BD%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-text">11.4.11 集成测试**(3)** 三个微服务协同完成**-使用@GlobalTransactional** 完成分布式事务控制(出现异常，也能保证数据一致性)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-11-1-%E5%90%AF%E5%8A%A8-Nacos-Server-8848"><span class="toc-text">11.4.11.1 启动 Nacos Server 8848</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-11-2-%E5%8F%8C%E5%87%BB-Seata-%E7%9A%84-bin-seata-server-bat-%E5%90%AF%E5%8A%A8-Seata-Server"><span class="toc-text">11.4.11.2 双击 Seata 的\bin\seata-server.bat , 启动 Seata Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-11-3-%E5%90%AF%E5%8A%A8-seata-order-micro-service-10008-x2F-10010-x2F-10012-%E4%B8%89%E4%B8%AA%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">11.4.11.3 启动 seata-order-micro-service-10008 &#x2F;10010&#x2F;10012 三个微服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-11-4-%E6%B5%8F%E8%A7%88%E5%99%A8-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100"><span class="toc-text">11.4.11.4 浏览器 : http:&#x2F;&#x2F;localhost:10008&#x2F;order&#x2F;save?userId&#x3D;666&amp;productId&#x3D;1&amp;nums&#x3D;1&amp;money&#x3D;100</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-12-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E7%BB%86%E8%8A%82"><span class="toc-text">11.4.12 注意事项和细节</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-12-1-%E5%A6%82%E6%9E%9C%E6%95%B0%E6%8D%AE%E5%BA%93-x2F-%E8%A1%A8%E4%BD%BF%E7%94%A8%E5%88%B0%E5%85%B3%E9%94%AE%E5%AD%97%EF%BC%8C%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%BC%95%E5%8F%B7"><span class="toc-text">11.4.12.1 如果数据库&#x2F;表使用到关键字，需要使用反引号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-12-2-openfeign%E5%9C%A8%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8api%E6%8E%A5%E5%8F%A3%E6%97%B6%EF%BC%8C%E9%BB%98%E8%AE%A4%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%E4%B8%BA1s"><span class="toc-text">11.4.12.2 openfeign在远程调用api接口时，默认超时时间为1s</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/08/18/2023%E7%A7%8B%E6%8B%9B%E6%80%BB%E7%BB%93-%E5%85%AB%E8%82%A1/" title="2023秋招总结-八股"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2023秋招总结-八股"/></a><div class="content"><a class="title" href="/2023/08/18/2023%E7%A7%8B%E6%8B%9B%E6%80%BB%E7%BB%93-%E5%85%AB%E8%82%A1/" title="2023秋招总结-八股">2023秋招总结-八股</a><time datetime="2023-08-18T07:55:02.000Z" title="Created 2023-08-18 15:55:02">2023-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/15/Redis%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/" title="Redis原理学习"><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230727134719639.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis原理学习"/></a><div class="content"><a class="title" href="/2023/08/15/Redis%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/" title="Redis原理学习">Redis原理学习</a><time datetime="2023-08-15T08:10:37.000Z" title="Created 2023-08-15 16:10:37">2023-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/10/java%E5%9F%BA%E7%A1%80%E5%A4%8D%E4%B9%A0/" title="java基础复习"><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230810141014749.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java基础复习"/></a><div class="content"><a class="title" href="/2023/08/10/java%E5%9F%BA%E7%A1%80%E5%A4%8D%E4%B9%A0/" title="java基础复习">java基础复习</a><time datetime="2023-08-10T06:08:10.000Z" title="Created 2023-08-10 14:08:10">2023-08-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/27/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="计算机网络"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机网络"/></a><div class="content"><a class="title" href="/2023/07/27/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="计算机网络">计算机网络</a><time datetime="2023-07-27T14:37:02.000Z" title="Created 2023-07-27 22:37:02">2023-07-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/27/MySQL%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/" title="MySQL原理学习"><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230727223615031.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL原理学习"/></a><div class="content"><a class="title" href="/2023/07/27/MySQL%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/" title="MySQL原理学习">MySQL原理学习</a><time datetime="2023-07-27T14:32:58.000Z" title="Created 2023-07-27 22:32:58">2023-07-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 By donn</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">很高兴认识你🤪</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>