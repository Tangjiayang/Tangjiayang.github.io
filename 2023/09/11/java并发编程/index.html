<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>javaå¹¶å‘ç¼–ç¨‹ | donnçš„åšå®¢</title><meta name="author" content="donn"><meta name="copyright" content="donn"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="JAVAå¹¶å‘ç¼–ç¨‹ThreadLocalå­¦ä¹ :â€‹	å¥½æ–‡æ¨è â€‹	ThreadLocal:é¡¾åæ€ä¹‰ï¼Œçº¿ç¨‹çš„â€œæœ¬åœ°å˜é‡â€ â€‹	è¿™ç§å˜é‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è®¿é—®(é€šè¿‡getå’Œsetæ–¹æ³•è®¿é—®)æ—¶èƒ½å¤Ÿä¿è¯å„ä¸ªçº¿ç¨‹çš„å˜é‡ç›¸å¯¹ç‹¬ç«‹äºå…¶ä»–çº¿ç¨‹å†…çš„å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œè¿™ç§å˜é‡åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…èµ·ä½œç”¨ï¼Œå‡å°‘åŒä¸€ä¸ªçº¿ç¨‹å†…å¤šä¸ªå‡½æ•°æˆ–ç»„ä»¶ä¹‹é—´ä¸€äº›å…¬å…±å˜é‡ä¼ é€’çš„å¤æ‚åº¦ã€‚ â€‹	set æ–¹æ³•ï¼š é€šè¿‡å½“å‰çº¿ç¨‹å¯¹è±¡ thread">
<meta property="og:type" content="article">
<meta property="og:title" content="javaå¹¶å‘ç¼–ç¨‹">
<meta property="og:url" content="https://tangjiayang.github.io/2023/09/11/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/index.html">
<meta property="og:site_name" content="donnçš„åšå®¢">
<meta property="og:description" content="JAVAå¹¶å‘ç¼–ç¨‹ThreadLocalå­¦ä¹ :â€‹	å¥½æ–‡æ¨è â€‹	ThreadLocal:é¡¾åæ€ä¹‰ï¼Œçº¿ç¨‹çš„â€œæœ¬åœ°å˜é‡â€ â€‹	è¿™ç§å˜é‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è®¿é—®(é€šè¿‡getå’Œsetæ–¹æ³•è®¿é—®)æ—¶èƒ½å¤Ÿä¿è¯å„ä¸ªçº¿ç¨‹çš„å˜é‡ç›¸å¯¹ç‹¬ç«‹äºå…¶ä»–çº¿ç¨‹å†…çš„å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œè¿™ç§å˜é‡åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…èµ·ä½œç”¨ï¼Œå‡å°‘åŒä¸€ä¸ªçº¿ç¨‹å†…å¤šä¸ªå‡½æ•°æˆ–ç»„ä»¶ä¹‹é—´ä¸€äº›å…¬å…±å˜é‡ä¼ é€’çš„å¤æ‚åº¦ã€‚ â€‹	set æ–¹æ³•ï¼š é€šè¿‡å½“å‰çº¿ç¨‹å¯¹è±¡ thread">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230810141014749.png">
<meta property="article:published_time" content="2023-09-11T03:08:03.000Z">
<meta property="article:modified_time" content="2023-09-11T15:10:44.473Z">
<meta property="article:author" content="donn">
<meta property="article:tag" content="java">
<meta property="article:tag" content="å¹¶å‘ç¼–ç¨‹">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230810141014749.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://tangjiayang.github.io/2023/09/11/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":30,"languages":{"author":"Author: donn","link":"Link: ","source":"Source: donnçš„åšå®¢","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'javaå¹¶å‘ç¼–ç¨‹',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-11 23:10:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/bg.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">12</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> é“¾æ¥</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230810141014749.png')"><nav id="nav"><span id="blog-info"><a href="/" title="donnçš„åšå®¢"><span class="site-name">donnçš„åšå®¢</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> é“¾æ¥</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">javaå¹¶å‘ç¼–ç¨‹</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-09-11T03:08:03.000Z" title="Created 2023-09-11 11:08:03">2023-09-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-09-11T15:10:44.473Z" title="Updated 2023-09-11 23:10:44">2023-09-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">å¹¶å‘ç¼–ç¨‹</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">18k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>57min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="javaå¹¶å‘ç¼–ç¨‹"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="JAVAå¹¶å‘ç¼–ç¨‹"><a href="#JAVAå¹¶å‘ç¼–ç¨‹" class="headerlink" title="JAVAå¹¶å‘ç¼–ç¨‹"></a>JAVAå¹¶å‘ç¼–ç¨‹</h1><h3 id="ThreadLocalå­¦ä¹ "><a href="#ThreadLocalå­¦ä¹ " class="headerlink" title="ThreadLocalå­¦ä¹ :"></a>ThreadLocalå­¦ä¹ :</h3><p>â€‹	<a target="_blank" rel="noopener" href="https://juejin.cn/post/7166202551782604837?searchId=20230911163742D2E0FFFACF74510D0A74#heading-10">å¥½æ–‡æ¨è</a></p>
<p>â€‹	ThreadLocal:é¡¾åæ€ä¹‰ï¼Œçº¿ç¨‹çš„â€œæœ¬åœ°å˜é‡â€</p>
<p>â€‹	è¿™ç§å˜é‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è®¿é—®(é€šè¿‡getå’Œsetæ–¹æ³•è®¿é—®)æ—¶èƒ½å¤Ÿä¿è¯å„ä¸ªçº¿ç¨‹çš„å˜é‡ç›¸å¯¹ç‹¬ç«‹äºå…¶ä»–çº¿ç¨‹å†…çš„å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œè¿™ç§å˜é‡åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…èµ·ä½œç”¨ï¼Œ<strong>å‡å°‘åŒä¸€ä¸ªçº¿ç¨‹å†…å¤šä¸ªå‡½æ•°æˆ–ç»„ä»¶ä¹‹é—´ä¸€äº›å…¬å…±å˜é‡ä¼ é€’çš„å¤æ‚åº¦ã€‚</strong></p>
<p>â€‹	<strong>set æ–¹æ³•ï¼š</strong></p>
<p>é€šè¿‡å½“å‰çº¿ç¨‹å¯¹è±¡ thread è·å–è¯¥ thread æ‰€ç»´æŠ¤çš„ ThreadLocalMapï¼Œå¦‚æœ ThreadLocalMap ä¸ä¸º nullï¼Œåˆ™ä»¥ ThreadLocal å®ä¾‹ä¸º keyï¼Œå€¼ä¸º value çš„é”®å€¼å¯¹å­˜å…¥ ThreadLocalMapï¼Œè‹¥ ThreadLocalMap ä¸º null çš„è¯ï¼Œå°±æ–°å»º ThreadLocalMapï¼Œç„¶åå†ä»¥ ThreadLocal ä¸ºé”®ï¼Œå€¼ä¸º value çš„é”®å€¼å¯¹å­˜å…¥å³å¯ã€‚</p>
<p>â€‹	<strong>get æ–¹æ³•ï¼š</strong></p>
<p>é€šè¿‡å½“å‰çº¿ç¨‹ thread å®ä¾‹è·å–åˆ°å®ƒæ‰€ç»´æŠ¤çš„ ThreadLocalMapï¼Œç„¶åä»¥å½“å‰ ThreadLocal å®ä¾‹ä¸º key è·å–è¯¥ map ä¸­çš„é”®å€¼å¯¹ï¼ˆEntryï¼‰ï¼Œå¦‚æœ Entry ä¸ä¸º null åˆ™è¿”å› Entry çš„ valueã€‚å¦‚æœè·å– ThreadLocalMap ä¸º null æˆ–è€… Entry ä¸º null çš„è¯ï¼Œå°±ä»¥å½“å‰ ThreadLocal ä¸º Keyï¼Œvalue ä¸º null å­˜å…¥ map åï¼Œå¹¶è¿”å› nullã€‚</p>
<p>ä½¿ç”¨å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">T</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºThreadLocalå¯¹è±¡, åšæˆpublic static.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;Object&gt; threadLocal1 = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;Object&gt; threadLocal2 = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Task æ˜¯çº¿ç¨‹ç±» -&gt; å†…éƒ¨ç±» / çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Task</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">            <span class="type">Pig</span> <span class="variable">pig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Pig</span>();</span><br><span class="line">            <span class="comment">//ç»™threadLocal1 å¯¹è±¡æ”¾å…¥set dog , éš”å±±æ‰“ç‰›</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Task æ”¾å…¥äº† dog= &quot;</span> + dog);</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                è§£è¯»:</span></span><br><span class="line"><span class="comment">                public void set(T value) &#123;</span></span><br><span class="line"><span class="comment">                    //1. è·å–å½“å‰çº¿ç¨‹, å…³è”åˆ°å½“å‰çº¿ç¨‹!</span></span><br><span class="line"><span class="comment">                    Thread t = Thread.currentThread();</span></span><br><span class="line"><span class="comment">                    //2. é€šè¿‡çº¿ç¨‹å¯¹è±¡, è·å–åˆ°ThreadLocalMap</span></span><br><span class="line"><span class="comment">                    //   ThreadLocalMap ç±»å‹ ThreadLocal.ThreadLocalMap</span></span><br><span class="line"><span class="comment">                    ThreadLocalMap map = getMap(t);</span></span><br><span class="line"><span class="comment">                    //3. å¦‚æœmapä¸ä¸ºnull, å°†æ•°æ®(dog,pig..) æ”¾å…¥map </span></span><br><span class="line"><span class="comment">                    			-key:threadLocal value:å­˜æ”¾çš„æ•°æ®</span></span><br><span class="line"><span class="comment">                    //ä»è¿™ä¸ªæºç æˆ‘ä»¬å·²ç„¶çœ‹å‡ºä¸€ä¸ªthreadlocalåªèƒ½å…³è”ä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœä½ set, å°±ä¼šæ›¿æ¢</span></span><br><span class="line"><span class="comment">                    //4. å¦‚æœmapä¸ºnull, å°±åˆ›å»ºä¸€ä¸ªå’Œå½“å‰çº¿ç¨‹å…³è”çš„ThreadLocalMap, å¹¶ä¸”è¯¥æ•°æ®æ”¾å…¥</span></span><br><span class="line"><span class="comment">                    if (map != null)</span></span><br><span class="line"><span class="comment">                        map.set(this, value);</span></span><br><span class="line"><span class="comment">                    else</span></span><br><span class="line"><span class="comment">                        createMap(t, value);</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            threadLocal1.set(dog);</span><br><span class="line">            <span class="comment">//threadLocal1.set(pig);//æ›¿æ¢</span></span><br><span class="line">            threadLocal2.set(pig);<span class="comment">//è¿™ä¸ªæ•°æ®å°±ä¼šthreadLocal2å…³è”ï¼Œå¹¶ä¸”éƒ½è¢«å½“å‰Threadç®¡ç†</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Task åœ¨run æ–¹æ³•ä¸­ çº¿ç¨‹=&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">T1Service</span>().update();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Task</span>()).start();<span class="comment">//ä¸»çº¿ç¨‹å¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹,æ³¨æ„ä¸æ˜¯ä¸»çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åˆ›å»ºstaticä¿®é¥°çš„ ThreadLocal å¯¹è±¡äº è¿è¡Œçº¿ç¨‹çš„ç±»ä¸­ï¼Œ</p>
<p>çº¿ç¨‹ Thread t ç»´æŠ¤ä¸€ä¸ªå±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Thread å¯¹è±¡çš„å®ä¾‹æ•°æ®</span></span><br><span class="line">ThreadLocal.<span class="type">ThreadLocalMap</span> <span class="variable">threadLocals</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>

<p> å®ƒæ˜¯ä¸€ä¸ªHashMapï¼Œé‡Œé¢çš„Entryçš„ç»“æ„ä¸º(key, value) â€”&gt; (çº¿ç¨‹idï¼Œ å€¼)</p>
<p>ğŸŒŸä¸€ä¸ªçº¿ç¨‹æ‰€åœ¨çš„ç±»å¯ä»¥æœ‰å¤šä¸ª<strong>ThreadLocal</strong>å¯¹è±¡ï¼Œæ¯ä¸ªthreadLocalå¯¹è±¡éƒ½ä¼š**<u>åœ¨çº¿ç¨‹ç»´æŠ¤çš„threadLocalsä¸­ä»¥é”®çš„å½¢å¼å­˜åœ¨</u>**ã€‚</p>
<h3 id="ReentrantLock-å’Œ-AQSï¼š"><a href="#ReentrantLock-å’Œ-AQSï¼š" class="headerlink" title="ReentrantLock å’Œ AQSï¼š"></a>ReentrantLock å’Œ AQSï¼š</h3><h4 id="1-ä»€ä¹ˆæ˜¯AQSï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯AQSï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯AQSï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯AQSï¼Ÿ</h4><p>â€‹	AQS ä¸­ä½¿ç”¨çš„æ˜¯ CLH å˜ä½“é˜Ÿåˆ—</p>
<h5 id="1-1ä»€ä¹ˆæ˜¯CLHé˜Ÿåˆ—ï¼Ÿ"><a href="#1-1ä»€ä¹ˆæ˜¯CLHé˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="1.1ä»€ä¹ˆæ˜¯CLHé˜Ÿåˆ—ï¼Ÿ"></a>1.1ä»€ä¹ˆæ˜¯CLHé˜Ÿåˆ—ï¼Ÿ</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230911112324020.png" alt="image-20230911112324020"></p>
<ul>
<li>CLHï¼šæ˜¯ <strong>å•å‘é“¾è¡¨å®ç°çš„é˜Ÿåˆ—</strong>ã€‚ç”³è¯·çº¿ç¨‹åªåœ¨æœ¬åœ°å˜é‡ä¸Šè‡ªæ—‹ï¼Œ<strong>å®ƒä¸æ–­è½®è¯¢å‰é©±çš„çŠ¶æ€</strong>ï¼Œå¦‚æœå‘ç° <strong>å‰é©±èŠ‚ç‚¹é‡Šæ”¾äº†é”å°±ç»“æŸè‡ªæ—‹ã€‚</strong><ul>
<li>CLH é˜Ÿåˆ—æ˜¯ä¸€ä¸ª<u>å•å‘é“¾è¡¨</u>ï¼Œä¿æŒ FIFO å…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ç‰¹æ€§</li>
<li>é€šè¿‡ tail å°¾èŠ‚ç‚¹ï¼ˆåŸå­å¼•ç”¨ï¼‰æ¥æ„å»ºé˜Ÿåˆ—ï¼Œæ€»æ˜¯æŒ‡å‘æœ€åä¸€ä¸ªèŠ‚ç‚¹</li>
<li>æœªè·å¾—é”èŠ‚ç‚¹ä¼šè¿›è¡Œ<strong>è‡ªæ—‹</strong>ï¼Œè€Œä¸æ˜¯åˆ‡æ¢çº¿ç¨‹çŠ¶æ€</li>
<li>å¹¶å‘é«˜æ—¶æ€§èƒ½è¾ƒå·®ï¼Œå› ä¸ºæœªè·å¾—é”èŠ‚ç‚¹ä¸æ–­è½®è®­å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€æ¥æŸ¥çœ‹æ˜¯å¦è·å¾—é”</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230911143653012.png" alt="image-20230911143653012"></p>
<p>ç›¸æ¯”äº CLH é˜Ÿåˆ—è€Œè¨€ï¼ŒAQS ä¸­çš„ CLH å˜ä½“ç­‰å¾…é˜Ÿåˆ—æ‹¥æœ‰ä»¥ä¸‹ç‰¹æ€§</p>
<ol>
<li>AQS ä¸­é˜Ÿåˆ—æ˜¯ä¸ª<strong>åŒå‘é“¾è¡¨</strong>ï¼Œä¹Ÿæ˜¯ FIFO å…ˆè¿›å…ˆå‡ºçš„ç‰¹æ€§</li>
<li>é€šè¿‡ Headã€Tail å¤´å°¾ä¸¤ä¸ªèŠ‚ç‚¹æ¥ç»„æˆé˜Ÿåˆ—ç»“æ„ï¼Œé€šè¿‡ volatile ä¿®é¥°ä¿è¯å¯è§æ€§</li>
<li>Head æŒ‡å‘èŠ‚ç‚¹ä¸ºå·²è·å¾—é”çš„èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹æœ¬èº«ä¸æŒæœ‰å…·ä½“çº¿ç¨‹</li>
<li>è·å–ä¸åˆ°åŒæ­¥çŠ¶æ€ï¼Œä¼šå°†èŠ‚ç‚¹è¿›è¡Œ<strong>è‡ªæ—‹</strong>è·å–é”ï¼Œè‡ªæ—‹ä¸€å®šæ¬¡æ•°å¤±è´¥åä¼šå°†çº¿ç¨‹é˜»å¡ï¼Œç›¸å¯¹äº CLH é˜Ÿåˆ—æ€§èƒ½è¾ƒå¥½</li>
</ol>
<p><strong>å½“å‰çº¿ç¨‹è·å–é”å¤±è´¥æ—¶ï¼ŒReentrantLocké¦–å…ˆå†tryAcquire()ä¸€ä¸‹ï¼ŒtryAcquireå¤±è´¥ï¼Œåˆ™AQSä¼šå°†å½“å‰çº¿ç¨‹ä»¥åŠç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯æ„é€ æˆä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeå¯¹è±¡ï¼‰å¹¶å°†å…¶åŠ å…¥AQSä¸­ï¼ŒåŒæ—¶ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚</strong></p>
<h4 id="2-æ¡ä»¶é˜Ÿåˆ—ä¸é˜»å¡é˜Ÿåˆ—ï¼š"><a href="#2-æ¡ä»¶é˜Ÿåˆ—ä¸é˜»å¡é˜Ÿåˆ—ï¼š" class="headerlink" title="2.æ¡ä»¶é˜Ÿåˆ—ä¸é˜»å¡é˜Ÿåˆ—ï¼š"></a>2.æ¡ä»¶é˜Ÿåˆ—ä¸é˜»å¡é˜Ÿåˆ—ï¼š</h4><p>â€‹	<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230911162425877.png" alt="image-20230911162425877"></p>
<ul>
<li>æ¡ä»¶é˜Ÿåˆ—å’Œé˜»å¡é˜Ÿåˆ—çš„èŠ‚ç‚¹ï¼Œéƒ½æ˜¯ Node çš„å®ä¾‹ï¼Œå› ä¸ºæ¡ä»¶é˜Ÿåˆ—çš„èŠ‚ç‚¹æ˜¯éœ€è¦è½¬ç§»åˆ°é˜»å¡é˜Ÿåˆ—ä¸­å»çš„ï¼›</li>
<li>æˆ‘ä»¬çŸ¥é“ä¸€ä¸ª ReentrantLock å®ä¾‹å¯ä»¥é€šè¿‡å¤šæ¬¡è°ƒç”¨ newCondition() æ¥äº§ç”Ÿå¤šä¸ª Condition å®ä¾‹ï¼Œè¿™é‡Œå¯¹åº” condition1 å’Œ condition2ã€‚æ³¨æ„ï¼ŒConditionObject åªæœ‰ä¸¤ä¸ªå±æ€§ firstWaiter å’Œ lastWaiterï¼›</li>
<li>æ¯ä¸ª condition æœ‰ä¸€ä¸ªå…³è”çš„<strong>æ¡ä»¶é˜Ÿåˆ—</strong>ï¼Œå¦‚çº¿ç¨‹ 1 è°ƒç”¨ <code>condition1.await()</code> æ–¹æ³•å³å¯å°†å½“å‰çº¿ç¨‹ 1 åŒ…è£…æˆ Node ååŠ å…¥åˆ°æ¡ä»¶é˜Ÿåˆ—ä¸­ï¼Œç„¶åé˜»å¡åœ¨è¿™é‡Œï¼Œä¸ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œ**<u>æ¡ä»¶é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨</u>**ï¼›</li>
<li>ğŸŒŸè°ƒç”¨<code>condition1.signal()</code> è§¦å‘ä¸€æ¬¡å”¤é†’ï¼Œæ­¤æ—¶å”¤é†’çš„æ˜¯é˜Ÿå¤´ï¼Œä¼šå°†condition1 å¯¹åº”çš„<strong>æ¡ä»¶é˜Ÿåˆ—</strong>çš„ firstWaiterï¼ˆé˜Ÿå¤´ï¼‰ ç§»åˆ°<strong>é˜»å¡é˜Ÿåˆ—çš„é˜Ÿå°¾</strong>ï¼Œç­‰å¾…è·å–é”ï¼Œè·å–é”å await æ–¹æ³•æ‰èƒ½è¿”å›ï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</li>
</ul>
<h2 id="è¯»ä¹¦ç¬”è®°æ•´ç†"><a href="#è¯»ä¹¦ç¬”è®°æ•´ç†" class="headerlink" title="è¯»ä¹¦ç¬”è®°æ•´ç†"></a>è¯»ä¹¦ç¬”è®°æ•´ç†</h2><p>æœ¬ç« èŠ‚æ˜¯è¯¥ç½‘ç«™æ–‡ç« çš„è¯»ä¹¦ç¬”è®°ï¼š<a target="_blank" rel="noopener" href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Java%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%2078%20%E8%AE%B2-%E5%AE%8C/">https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Java%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%2078%20%E8%AE%B2-%E5%AE%8C/</a></p>
<h3 id="3-1-JAVAçº¿ç¨‹å®ç°-x2F-åˆ›å»ºæ–¹å¼"><a href="#3-1-JAVAçº¿ç¨‹å®ç°-x2F-åˆ›å»ºæ–¹å¼" class="headerlink" title="3.1.JAVAçº¿ç¨‹å®ç°&#x2F;åˆ›å»ºæ–¹å¼"></a>3.1.JAVAçº¿ç¨‹å®ç°&#x2F;åˆ›å»ºæ–¹å¼</h3><ul>
<li><p>1.å®ç°<strong>Runnable</strong>æ¥å£ä¸­çš„<strong>run</strong>æ–¹æ³•</p>
<ul>
<li>ç„¶ååªè¦æŠŠå®ç°runæ–¹æ³•çš„å¯¹è±¡å®ä¾‹ä¼ å…¥Threadç±»ä¸­å³å¯</li>
</ul>
</li>
<li><p>2.ç»§æ‰¿Threadç±»</p>
<ul>
<li>ç»§æ‰¿Threadç±»ï¼Œé‡å†™runæ–¹æ³•â€¦â€¦</li>
</ul>
</li>
<li><p>3.çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹</p>
<ul>
<li><p>çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹æºç ï¼š</p>
</li>
<li><pre><code class="java">static class DefaultThreadFactory implements ThreadFactory &#123;
    DefaultThreadFactory() &#123;
        SecurityManager s = System.getSecurityManager();
        group = (s != null) ? s.getThreadGroup() :
            Thread.currentThread().getThreadGroup();
        namePrefix = &quot;pool-&quot; +
            poolNumber.getAndIncrement() +
            &quot;-thread-&quot;;
    &#125;
    public Thread newThread(Runnable r) &#123;
        Thread t = new Thread(group, r,
                    namePrefix + threadNumber.getAndIncrement(),
0);
        if (t.isDaemon())
            t.setDaemon(false);
        if (t.getPriority() != Thread.NORM_PRIORITY)
            t.setPriority(Thread.NORM_PRIORITY);
        return t;
    &#125;
&#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - æœ¬è´¨ä¸Šè¿˜æ˜¯é€šè¿‡ new Thread() åˆ›å»ºçº¿ç¨‹</span><br><span class="line"></span><br><span class="line">- 4.æœ‰è¿”å›å€¼çš„ Callable åˆ›å»ºçº¿ç¨‹</span><br><span class="line"></span><br><span class="line">  - æºç ï¼š</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    class CallableTask implements Callable&lt;Integer&gt; &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public Integer call() throws Exception &#123;</span><br><span class="line">            return new Random().nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //åˆ›å»ºçº¿ç¨‹æ±          æ‰§è¡Œå™¨(Executor)ä¸­æœ‰è®¸å¤šæ„é€ çº¿ç¨‹æ± çš„é™æ€å·¥å‚æ–¹æ³•ï¼Œå¯ä»¥æ„é€ å„ç§çº¿ç¨‹æ± </span><br><span class="line">    ExecutorService service = Executors.newFixedThreadPool(10);</span><br><span class="line">    //æäº¤ä»»åŠ¡ï¼Œå¹¶ç”¨ Futureæäº¤è¿”å›ç»“æœ</span><br><span class="line">    Future&lt;Integer&gt; future = service.submit(new CallableTask());</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>ç¬¬ 4 ç§çº¿ç¨‹åˆ›å»ºæ–¹å¼æ˜¯é€šè¿‡æœ‰è¿”å›å€¼çš„ Callable åˆ›å»ºçº¿ç¨‹ï¼Œ<u>Runnable åˆ›å»ºçº¿ç¨‹æ˜¯æ— è¿”å›å€¼çš„ï¼Œè€Œ Callable å’Œä¸ä¹‹ç›¸å…³çš„ Futureã€FutureTaskï¼Œå®ƒä»¬å¯ä»¥æŠŠçº¿ç¨‹æ‰§è¡Œçš„ç»“æœä½œä¸ºè¿”å›å€¼è¿”å›</u>ï¼Œå¦‚ä»£ç æ‰€ç¤ºï¼Œå®ç°äº† Callable æ¥å£ï¼Œå¹¶ä¸”ç»™å®ƒçš„æ³›å‹è®¾ç½®æˆ Integerï¼Œç„¶åå®ƒä¼šè¿”å›ä¸€ä¸ªéšæœºæ•°ã€‚</p>
</li>
<li><p>ä½†æ˜¯ï¼Œæ— è®ºæ˜¯ Callable è¿˜æ˜¯ FutureTaskï¼Œ<u>å®ƒä»¬é¦–å…ˆå’Œ Runnable ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œæ˜¯éœ€è¦è¢«æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯è¯´å®ƒä»¬æœ¬èº«å°±æ˜¯çº¿ç¨‹ã€‚</u>å®ƒä»¬å¯ä»¥æ”¾åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œå¦‚ä»£ç æ‰€ç¤ºï¼Œ <u><strong>submit() æ–¹æ³•æŠŠä»»åŠ¡æ”¾åˆ°çº¿ç¨‹æ± ä¸­ï¼Œå¹¶ç”±çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹ï¼Œä¸ç®¡ç”¨ä»€ä¹ˆæ–¹æ³•ï¼Œæœ€ç»ˆéƒ½æ˜¯é çº¿ç¨‹æ¥æ‰§è¡Œçš„ï¼Œè€Œå­çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼ä»è„±ç¦»ä¸äº†æœ€å¼€å§‹è®²çš„ä¸¤ç§åŸºæœ¬æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å®ç° Runnable æ¥å£å’Œç»§æ‰¿ Thread ç±»ã€‚</strong></u></p>
</li>
</ul>
</li>
<li><p>å…¶ä»–åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•åŒæ ·ä¹Ÿç¦»ä¸å¼€å®ç° Runnable æ¥å£å’Œç»§æ‰¿ Thread ç±»ï¼</p>
</li>
</ul>
<h4 id="âš ï¸æœ¬è´¨ä¸Šï¼Œçº¿ç¨‹åˆ›å»ºæ–¹å¼åªæœ‰ä¸€ç§-â€”â€”â€”-gt-æ„é€ ä¸€ä¸ªthreadç±»"><a href="#âš ï¸æœ¬è´¨ä¸Šï¼Œçº¿ç¨‹åˆ›å»ºæ–¹å¼åªæœ‰ä¸€ç§-â€”â€”â€”-gt-æ„é€ ä¸€ä¸ªthreadç±»" class="headerlink" title="âš ï¸æœ¬è´¨ä¸Šï¼Œçº¿ç¨‹åˆ›å»ºæ–¹å¼åªæœ‰ä¸€ç§ â€”â€”â€”&gt; æ„é€ ä¸€ä¸ªthreadç±»"></a>âš ï¸æœ¬è´¨ä¸Šï¼Œçº¿ç¨‹åˆ›å»ºæ–¹å¼åªæœ‰ä¸€ç§ â€”â€”â€”&gt; æ„é€ ä¸€ä¸ªthreadç±»</h4><p>â€‹	ç„¶åé€šè¿‡ï¼š1.ä¼ ç»™Runnableæ¥å£ä¸­targetã€Œtargetæ‰§è¡Œ target.run()ã€</p>
<p>â€‹					   2.ç»§æ‰¿Threadé‡å†™çš„runæ–¹æ³•</p>
<p>â€‹	è¿™ä¸¤ç§æ–¹å¼æ¥æŠŠæƒ³è®©çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ä¼ å…¥ï¼</p>
<h4 id="ä¸ºä»€ä¹ˆå®ç°-Runnable-æ¥å£æ¯”ç»§æ‰¿-Thread-ç±»å®ç°çº¿ç¨‹è¦å¥½ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå®ç°-Runnable-æ¥å£æ¯”ç»§æ‰¿-Thread-ç±»å®ç°çº¿ç¨‹è¦å¥½ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå®ç° Runnable æ¥å£æ¯”ç»§æ‰¿ Thread ç±»å®ç°çº¿ç¨‹è¦å¥½ï¼Ÿ"></a>ä¸ºä»€ä¹ˆå®ç° Runnable æ¥å£æ¯”ç»§æ‰¿ Thread ç±»å®ç°çº¿ç¨‹è¦å¥½ï¼Ÿ</h4><ol>
<li><p>ä»ä»£ç çš„æ¶æ„è€ƒè™‘ï¼Œå®é™…ä¸Šï¼ŒRunnable é‡Œåªæœ‰ä¸€ä¸ª run() æ–¹æ³•ï¼Œå®ƒå®šä¹‰äº†éœ€è¦æ‰§è¡Œçš„å†…å®¹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ç°äº† Runnable ä¸ Thread ç±»çš„è§£è€¦ï¼ŒThread ç±»è´Ÿè´£çº¿ç¨‹å¯åŠ¨å’Œå±æ€§è®¾ç½®ç­‰å†…å®¹ï¼Œæƒè´£åˆ†æ˜ã€‚</p>
</li>
<li><p>åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥æé«˜æ€§èƒ½ï¼Œ<u>ä½¿ç”¨ç»§æ‰¿ Thread ç±»æ–¹å¼ï¼Œæ¯æ¬¡æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼Œéƒ½éœ€è¦æ–°å»ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œæ‰§è¡Œå®Œä»»åŠ¡åçº¿ç¨‹èµ°åˆ°ç”Ÿå‘½å‘¨æœŸçš„å°½å¤´è¢«é”€æ¯ï¼Œå¦‚æœè¿˜æƒ³æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œå°±å¿…é¡»å†æ–°å»ºä¸€ä¸ªç»§æ‰¿äº† Thread ç±»çš„ç±»</u>ï¼Œå¦‚æœæ­¤æ—¶æ‰§è¡Œçš„å†…å®¹æ¯”è¾ƒå°‘ï¼Œæ¯”å¦‚åªæ˜¯åœ¨ run() æ–¹æ³•é‡Œç®€å•æ‰“å°ä¸€è¡Œæ–‡å­—ï¼Œé‚£ä¹ˆå®ƒæ‰€å¸¦æ¥çš„å¼€é”€å¹¶ä¸å¤§ï¼Œç›¸æ¯”äºæ•´ä¸ªçº¿ç¨‹ä»å¼€å§‹åˆ›å»ºåˆ°æ‰§è¡Œå®Œæ¯•è¢«é”€æ¯ï¼Œè¿™ä¸€ç³»åˆ—çš„æ“ä½œæ¯” run() æ–¹æ³•æ‰“å°æ–‡å­—æœ¬èº«å¸¦æ¥çš„å¼€é”€è¦å¤§å¾—å¤šï¼Œç›¸å½“äºæ¡äº†èŠéº»ä¸¢äº†è¥¿ç“œï¼Œå¾—ä¸å¿å¤±ã€‚å¦‚æœæˆ‘ä»¬<u><strong>ä½¿ç”¨å®ç° Runnable æ¥å£çš„æ–¹å¼ï¼Œå°±å¯ä»¥æŠŠä»»åŠ¡ç›´æ¥ä¼ å…¥çº¿ç¨‹æ± ï¼Œä½¿ç”¨ä¸€äº›å›ºå®šçš„çº¿ç¨‹æ¥å®Œæˆä»»åŠ¡ï¼Œä¸éœ€è¦æ¯æ¬¡æ–°å»ºé”€æ¯çº¿ç¨‹ï¼Œå¤§å¤§é™ä½äº†æ€§èƒ½å¼€é”€ã€‚</strong></u></p>
</li>
<li><p>Java è¯­è¨€ä¸æ”¯æŒåŒç»§æ‰¿ï¼Œå¦‚æœæˆ‘ä»¬çš„ç±»ä¸€æ—¦ç»§æ‰¿äº† Thread ç±»ï¼Œé‚£ä¹ˆå®ƒåç»­å°±æ²¡æœ‰åŠæ³•å†ç»§æ‰¿å…¶ä»–çš„ç±»ï¼Œ<strong>ä¸æ–¹ä¾¿ç±»çš„æ‹“å±•</strong></p>
</li>
</ol>
<h3 id="3-2-å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹"><a href="#3-2-å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹" class="headerlink" title="3.2.å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹"></a>3.2.å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹</h3><p>æœ¬èŠ‚æˆ‘ä»¬å°†è®¨è®º å¦‚ä½•æ­£ç¡®åœæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Ÿä»¥åŠä¸ºä»€ä¹ˆç”¨ volatile æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯é”™è¯¯çš„ï¼Ÿ</p>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šè®©çº¿ç¨‹è‡ªåŠ¨è¿è¡Œåˆ°å…¶ç»“æŸä¸ºæ­¢ã€‚</p>
<p>ä½†æ˜¯å¦‚æœä¸­é€”å‡ºäº†æ„å¤–æƒ…å†µæˆ‘ä»¬åˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>â€‹	åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³å°†åœæ­¢çš„çº¿ç¨‹åœ¨å¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸‹ä»ç„¶å¾ˆæœ‰ä»·å€¼ã€‚å°¤å…¶æ˜¯æˆ‘ä»¬æƒ³å†™ä¸€ä¸ªå¥å£®æ€§å¾ˆå¥½ï¼Œèƒ½å¤Ÿå®‰å…¨åº”å¯¹å„ç§åœºæ™¯çš„ç¨‹åºæ—¶ï¼Œæ­£ç¡®åœæ­¢çº¿ç¨‹å°±æ˜¾å¾—æ ¼å¤–é‡è¦ã€‚ä½†æ˜¯Java å¹¶æ²¡æœ‰æä¾›ç®€å•æ˜“ç”¨ï¼Œèƒ½å¤Ÿç›´æ¥å®‰å…¨åœæ­¢çº¿ç¨‹çš„èƒ½åŠ›ã€‚</p>
<h4 id="3-2-1-ä½¿ç”¨interruptåœæ­¢çº¿ç¨‹"><a href="#3-2-1-ä½¿ç”¨interruptåœæ­¢çº¿ç¨‹" class="headerlink" title="3.2.1.ä½¿ç”¨interruptåœæ­¢çº¿ç¨‹"></a>3.2.1.ä½¿ç”¨interruptåœæ­¢çº¿ç¨‹</h4><p>â€‹	å¯¹äº Java è€Œè¨€ï¼Œæœ€æ­£ç¡®çš„åœæ­¢çº¿ç¨‹çš„æ–¹å¼æ˜¯ä½¿ç”¨ interruptã€‚ä½† interrupt ä»…ä»…èµ·åˆ°é€šçŸ¥è¢«åœæ­¢çº¿ç¨‹çš„ä½œç”¨ã€‚è¢«é€šçŸ¥çš„çº¿ç¨‹ä¼šè€ƒè™‘è‡ªèº«å·¥ä½œæƒ…å†µ()ï¼Œé€‰æ‹©ç«‹å³åœæ­¢ã€ä¸€æ®µæ—¶é—´ååœæ­¢æˆ–ä¸åœæ­¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//java.lang.Threadç±»ä¸­çš„ç›¸å…³æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘çº¿ç¨‹å‘é€ä¸­æ–­è¯·æ±‚ï¼Œçº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€å°†è¢«è®¾ç½®ä¸ºtrueï¼Œæ­¤æ—¶å¦‚æœçº¿ç¨‹å·²ç»è¢«sleepæ–¹æ³•è°ƒç”¨é˜»å¡ï¼Œå°†ä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">interrupt</span><span class="params">()</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//æµ‹è¯•å½“å‰è¿›ç¨‹æ˜¯å¦è¢«ä¸­æ–­â€”â€”é™æ€æ–¹æ³•â€”â€”ä¼šå°†å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€é‡åˆ¶ä¸ºfalseï¼ï¼ï¼</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">interrupted</span><span class="params">()</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//æµ‹è¯•å½“å‰è¿›ç¨‹æ˜¯å¦è¢«ä¸­æ–­â€”â€”â€”â€”ä¸ä¼šæ”¹å˜çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isInterrupted</span><span class="params">()</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//è¿”å›å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹çš„Threadå¯¹è±¡</span></span><br><span class="line"><span class="keyword">static</span> Thread <span class="title function_">currentThread</span><span class="params">()</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//==============================ä½¿ç”¨interruptåœæ­¢çº¿ç¨‹==============================</span></span><br><span class="line"><span class="keyword">while</span> (!Thread.currentThread().isInterrupted() &amp;&amp; more work to <span class="keyword">do</span>) &#123;</span><br><span class="line">  <span class="keyword">do</span> more work</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸€æ—¦è°ƒç”¨æŸä¸ªçº¿ç¨‹çš„ interrupt() ä¹‹åï¼Œè¿™ä¸ªçº¿ç¨‹çš„<strong>ä¸­æ–­æ ‡è®°ä½</strong>å°±ä¼šè¢«è®¾ç½®æˆ trueã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è¿™æ ·çš„æ ‡è®°ä½ï¼Œå½“çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œåº”è¯¥å®šæœŸæ£€æŸ¥è¿™ä¸ªæ ‡è®°ä½ï¼Œ<u>å¦‚æœæ ‡è®°ä½è¢«è®¾ç½®æˆ trueï¼Œå°±è¯´æ˜æœ‰ç¨‹åºæƒ³ç»ˆæ­¢è¯¥çº¿ç¨‹ã€‚</u></p>
<p>å®ä¾‹ğŸŒ°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StopThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">      	<span class="comment">//ğŸŒŸè¿™é‡Œè¯´æ˜äº† çº¿ç¨‹èƒ½å¤Ÿé€šè¿‡ isInterrupted() æ–¹æ³•å¾—çŸ¥ç»ˆç«¯æ ‡è®°ä½çš„çŠ¶æ€</span></span><br><span class="line">      	<span class="comment">//ğŸŒŸç„¶åå†ç”±ç¨‹åºå‘˜ç¼–å†™ä¸­æ–­æ ‡è®°ä½ä¸ºtrue/falseæ—¶çš„é€»è¾‘ï¼</span></span><br><span class="line">        <span class="keyword">while</span> (!Thread.currentThread().isInterrupted() &amp;&amp; count &lt; <span class="number">1000</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;count = &quot;</span> + count++);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">StopThread</span>());</span><br><span class="line">        thread.start();</span><br><span class="line">        Thread.sleep(<span class="number">5</span>);</span><br><span class="line">        thread.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-sleep-æœŸé—´èƒ½å¦æ„Ÿå—åˆ°ä¸­æ–­ï¼Ÿ"><a href="#3-2-2-sleep-æœŸé—´èƒ½å¦æ„Ÿå—åˆ°ä¸­æ–­ï¼Ÿ" class="headerlink" title="3.2.2.sleep æœŸé—´èƒ½å¦æ„Ÿå—åˆ°ä¸­æ–­ï¼Ÿ"></a>3.2.2.sleep æœŸé—´èƒ½å¦æ„Ÿå—åˆ°ä¸­æ–­ï¼Ÿ</h4><p>â€”â€”å¦‚æœ sleepã€wait ç­‰å¯ä»¥è®©çº¿ç¨‹è¿›å…¥é˜»å¡çš„æ–¹æ³•ä½¿çº¿ç¨‹ä¼‘çœ äº†ï¼Œè€Œå¤„äºä¼‘çœ ä¸­çš„çº¿ç¨‹è¢«ä¸­æ–­ï¼Œé‚£ä¹ˆçº¿ç¨‹æ˜¯å¯ä»¥æ„Ÿå—åˆ°ä¸­æ–­ä¿¡å·çš„ï¼Œå¹¶ä¸”ä¼šæŠ›å‡ºä¸€ä¸ª InterruptedException å¼‚å¸¸ï¼ŒåŒæ—¶æ¸…é™¤ä¸­æ–­ä¿¡å·ï¼Œå°†ä¸­æ–­æ ‡è®°ä½è®¾ç½®æˆ falseã€‚è¿™æ ·ä¸€æ¥å°±ä¸ç”¨æ‹…å¿ƒé•¿æ—¶é—´ä¼‘çœ ä¸­çº¿ç¨‹æ„Ÿå—ä¸åˆ°ä¸­æ–­äº†ï¼Œå› ä¸ºå³ä¾¿çº¿ç¨‹è¿˜åœ¨ä¼‘çœ ï¼Œä»ç„¶èƒ½å¤Ÿå“åº”ä¸­æ–­é€šçŸ¥ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p><u>å› æ­¤å¦‚æœæˆ‘ä»¬éœ€è¦å¯¹æ­¤æƒ…å†µè¿›è¡Œå¤„ç†ï¼Œæˆ‘ä»¬éœ€è¦å¯¹InterruptedExceptionå¼‚å¸¸è¿›è¡Œæ•è·ï¼Œè€Œä¸æ˜¯æ£€æŸ¥ä¸­æ–­çŠ¶æ€</u></p>
<p>ğŸŒŸå¦‚æœæˆ‘ä»¬æƒ³è®©çº¿ç¨‹çš„è°ƒç”¨è€…å¯Ÿè§‰åˆ°â¬†ï¸ä¸Šé¢æƒ…å†µçš„å‘ç”Ÿï¼Œæœ‰2ç§æ–¹å¼ï¼š</p>
<ul>
<li>(æ–¹æ³•1)ï¼šcatch InterruptedExceptionå¼‚å¸¸åï¼Œå°†ä¸­æ–­çŠ¶æ€å†æ¬¡è®¾ç½®ä¸ºtrue(åœ¨try-catchä¸­å¤„ç†å¼‚å¸¸ä¼šå®é™…ä¸Šè¿˜æ˜¯åœ¨åŒä¸€classä¸­å¤„ç†ï¼Œè€¦åˆåº¦é«˜ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå› æ­¤æ¨èä¸‹é¢çš„æ–¹æ³•)</li>
<li>(æ–¹æ³•2)ï¼šğŸŒŸ**<u>throw InterruptedException å¼‚å¸¸å³å¯ï¼Œè°ƒç”¨è€…å†try-catchå³å¯æ•è·å¼‚å¸¸</u>**</li>
</ul>
<p>âš ï¸æ³¨æ„ï¼šæˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ä¸èƒ½ç›²ç›®åæ‰ä¸­æ–­ï¼Œ<u>å¦‚æœä¸åœ¨æ–¹æ³•ç­¾åä¸­å£°æ˜ï¼Œä¹Ÿä¸åœ¨ catch è¯­å¥å—ä¸­å†æ¬¡æ¢å¤ä¸­æ–­(æ–¹æ³•1)ï¼Œè€Œæ˜¯åœ¨ catch ä¸­ä¸ä½œå¤„ç†(æ–¹æ³•2)ï¼Œæˆ‘ä»¬ç§°è¿™ç§è¡Œä¸ºæ˜¯â€œå±è”½äº†ä¸­æ–­è¯·æ±‚â€</u>ã€‚å¦‚æœæˆ‘ä»¬ç›²ç›®åœ°å±è”½äº†ä¸­æ–­è¯·æ±‚ï¼Œä¼šå¯¼è‡´ä¸­æ–­ä¿¡å·è¢«å®Œå…¨å¿½ç•¥ï¼Œæœ€ç»ˆå¯¼è‡´çº¿ç¨‹æ— æ³•æ­£ç¡®åœæ­¢ã€‚</p>
<h4 id="3-2-3-ä¸ºä»€ä¹ˆç”¨-volatile-æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯é”™è¯¯çš„"><a href="#3-2-3-ä¸ºä»€ä¹ˆç”¨-volatile-æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯é”™è¯¯çš„" class="headerlink" title="3.2.3.ä¸ºä»€ä¹ˆç”¨ volatile æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯é”™è¯¯çš„?"></a>3.2.3.ä¸ºä»€ä¹ˆç”¨ volatile æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯é”™è¯¯çš„?</h4><h5 id="3-2-3-1-å¸¸è§çš„é”™è¯¯åœæ­¢æ–¹æ³•"><a href="#3-2-3-1-å¸¸è§çš„é”™è¯¯åœæ­¢æ–¹æ³•" class="headerlink" title="3.2.3.1.å¸¸è§çš„é”™è¯¯åœæ­¢æ–¹æ³•"></a>3.2.3.1.å¸¸è§çš„é”™è¯¯åœæ­¢æ–¹æ³•</h5><p>â€‹	é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹å‡ ç§åœæ­¢çº¿ç¨‹çš„é”™è¯¯æ–¹æ³•ã€‚æ¯”å¦‚ stop()ï¼Œsuspend() å’Œ resume()ï¼Œè¿™äº›æ–¹æ³•å·²ç»è¢« Java ç›´æ¥æ ‡è®°ä¸º @Deprecatedã€‚å¦‚æœå†è°ƒç”¨è¿™äº›æ–¹æ³•ï¼ŒIDE ä¼šå‹å¥½åœ°æç¤ºï¼Œæˆ‘ä»¬ä¸åº”è¯¥å†ä½¿ç”¨å®ƒä»¬äº†ã€‚ä½†ä¸ºä»€ä¹ˆå®ƒä»¬ä¸èƒ½ä½¿ç”¨äº†å‘¢ï¼Ÿ</p>
<ol>
<li><p>stop() ä¼šç›´æ¥æŠŠçº¿ç¨‹åœæ­¢ï¼Œè¿™æ ·å°±<u>æ²¡æœ‰ç»™çº¿ç¨‹è¶³å¤Ÿçš„æ—¶é—´æ¥å¤„ç†æƒ³è¦åœ¨åœæ­¢å‰ä¿å­˜æ•°æ®çš„é€»è¾‘</u>ï¼Œä»»åŠ¡æˆ›ç„¶è€Œæ­¢ï¼Œä¼šå¯¼è‡´å‡ºç°æ•°æ®å®Œæ•´æ€§ç­‰é—®é¢˜ã€‚</p>
</li>
<li><p>å¯¹äºsuspend() å’Œ resume() è€Œè¨€ï¼Œå®ƒä»¬çš„é—®é¢˜åœ¨äºå¦‚æœçº¿ç¨‹è°ƒç”¨ suspend()ï¼Œå®ƒå¹¶ä¸ä¼šé‡Šæ”¾é”ï¼Œå°±å¼€å§‹è¿›å…¥ä¼‘çœ ï¼Œä½†æ­¤æ—¶æœ‰å¯èƒ½ä»æŒæœ‰é”ï¼Œè¿™æ ·å°±<u>å®¹æ˜“å¯¼è‡´æ­»é”é—®é¢˜</u>ï¼Œå› ä¸ºè¿™æŠŠé”åœ¨çº¿ç¨‹è¢« resume() ä¹‹å‰ï¼Œæ˜¯ä¸ä¼šè¢«é‡Šæ”¾çš„ã€‚</p>
</li>
</ol>
<h5 id="3-2-3-2volatileæ ‡è®°ä½åœæ­¢çº¿ç¨‹"><a href="#3-2-3-2volatileæ ‡è®°ä½åœæ­¢çº¿ç¨‹" class="headerlink" title="3.2.3.2volatileæ ‡è®°ä½åœæ­¢çº¿ç¨‹"></a>3.2.3.2volatileæ ‡è®°ä½åœæ­¢çº¿ç¨‹</h5><p>volatile è¿™ç§æ–¹æ³•åœ¨æŸäº›ç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚çº¿ç¨‹è¢«é•¿æ—¶é—´é˜»å¡çš„æƒ…å†µï¼Œå°±æ— æ³•åŠæ—¶æ„Ÿå—ä¸­æ–­ï¼Œæ‰€ä»¥ volatile æ˜¯ä¸å¤Ÿå…¨é¢çš„åœæ­¢çº¿ç¨‹çš„æ–¹æ³•ã€‚</p>
<p><strong><u>çº¿ç¨‹è¢«é•¿æ—¶é—´é˜»å¡ï¼šå› ä¸ºä½ æ˜¯æ ¹æ®volatileå˜é‡çš„å€¼çš„æƒ…å†µå»åˆ¤æ–­æ˜¯å¦åœæ­¢è¿›ç¨‹ï¼Œä½†æ˜¯å¦‚æœä½ åœ¨å“ªé˜»å¡äº†ï¼Œå³ä½¿é‚£ä¸ªå˜é‡æ”¹å˜äº†ä¹Ÿæ²¡ç”¨ï¼Œvolatileæ ‡è®°ä½åœ¨ç¨‹åºè¿è¡Œåˆ°å¯¹è¯¥å˜é‡è¿›è¡Œåˆ¤æ–­çš„è¯­å¥æ—¶æ‰å¯¹çº¿ç¨‹äº§ç”Ÿå½±å“</u></strong></p>
<h3 id="3-3-çº¿ç¨‹æ˜¯å¦‚ä½•åœ¨-6-ç§çŠ¶æ€ä¹‹é—´è½¬æ¢çš„ï¼Ÿ"><a href="#3-3-çº¿ç¨‹æ˜¯å¦‚ä½•åœ¨-6-ç§çŠ¶æ€ä¹‹é—´è½¬æ¢çš„ï¼Ÿ" class="headerlink" title="3.3.çº¿ç¨‹æ˜¯å¦‚ä½•åœ¨ 6 ç§çŠ¶æ€ä¹‹é—´è½¬æ¢çš„ï¼Ÿ"></a>3.3.çº¿ç¨‹æ˜¯å¦‚ä½•åœ¨ 6 ç§çŠ¶æ€ä¹‹é—´è½¬æ¢çš„ï¼Ÿ</h3><p>çº¿ç¨‹å¯ä»¥æœ‰ä»¥ä¸‹6ç§çŠ¶æ€ï¼š</p>
<table>
<thead>
<tr>
<th>New(æ–°å»º)</th>
<th>Runnable(å¯è¿è¡Œ)</th>
<th>Blocked(é˜»å¡)</th>
<th>Waiting(ç­‰å¾…)</th>
<th>Time waiting(è®¡æ—¶ç­‰å¾…)</th>
<th>Terminated(ç»ˆæ­¢)</th>
</tr>
</thead>
</table>
<h4 id="3-3-1-new"><a href="#3-3-1-new" class="headerlink" title="3.3.1.new"></a>3.3.1.new</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230802141435013.png" alt="image-20230802141435013"></p>
<p>New è¡¨ç¤ºçº¿ç¨‹è¢«åˆ›å»ºä½†å°šæœªå¯åŠ¨çš„çŠ¶æ€ï¼šå½“æˆ‘ä»¬ç”¨ new Thread() æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œ<u>å¦‚æœçº¿ç¨‹æ²¡æœ‰å¼€å§‹è¿è¡Œ start() æ–¹æ³•ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰å¼€å§‹æ‰§è¡Œ run() æ–¹æ³•é‡Œé¢çš„ä»£ç ï¼Œé‚£ä¹ˆæ­¤æ—¶å®ƒçš„çŠ¶æ€å°±æ˜¯ New</u>ã€‚è€Œä¸€æ—¦çº¿ç¨‹è°ƒç”¨äº† start()ï¼Œå®ƒçš„çŠ¶æ€å°±ä¼šä» New å˜æˆ Runnableï¼Œä¹Ÿå°±æ˜¯çŠ¶æ€è½¬æ¢å›¾ä¸­ä¸­é—´çš„è¿™ä¸ªå¤§æ–¹æ¡†é‡Œçš„å†…å®¹ã€‚</p>
<h4 id="3-3-2-Runnable"><a href="#3-3-2-Runnable" class="headerlink" title="3.3.2.Runnable"></a>3.3.2.Runnable</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230802141522535.png" alt="image-20230802141522535"></p>
<p>Java ä¸­çš„ <u>Runable çŠ¶æ€å¯¹åº”æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ä¸­çš„ä¸¤ç§çŠ¶æ€</u>ï¼Œåˆ†<strong>åˆ«æ˜¯ Running å’Œ Readyï¼Œ</strong>ä¹Ÿå°±æ˜¯è¯´ï¼ŒJava ä¸­å¤„äº Runnable çŠ¶æ€çš„çº¿ç¨‹æœ‰å¯èƒ½æ­£åœ¨æ‰§è¡Œï¼Œä¹Ÿæœ‰å¯èƒ½æ²¡æœ‰æ­£åœ¨æ‰§è¡Œï¼Œæ­£åœ¨ç­‰å¾…è¢«åˆ†é… CPU èµ„æºã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ˜¯ Runnable çŠ¶æ€ï¼Œå½“å®ƒè¿è¡Œåˆ°ä»»åŠ¡çš„ä¸€åŠæ—¶ï¼Œæ‰§è¡Œè¯¥çº¿ç¨‹çš„ CPU è¢«è°ƒåº¦å»åšå…¶ä»–äº‹æƒ…ï¼Œå¯¼è‡´è¯¥çº¿ç¨‹æš‚æ—¶ä¸è¿è¡Œï¼Œå®ƒçš„çŠ¶æ€ä¾ç„¶ä¸å˜ï¼Œè¿˜æ˜¯ Runnableï¼Œå› ä¸ºå®ƒæœ‰å¯èƒ½éšæ—¶è¢«è°ƒåº¦å›æ¥ç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚</p>
<h4 id="3-3-3-é˜»å¡"><a href="#3-3-3-é˜»å¡" class="headerlink" title="3.3.3.é˜»å¡"></a>3.3.3.é˜»å¡</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230802141714716.png" alt="image-20230802141714716"></p>
<h5 id="3-3-3-1Blocked"><a href="#3-3-3-1Blocked" class="headerlink" title="3.3.3.1Blocked"></a>3.3.3.1Blocked</h5><p>â€‹	<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230802141755358.png" alt="image-20230802141755358"></p>
<p>é¦–å…ˆæ¥çœ‹æœ€ç®€å•çš„ Blockedï¼Œä»ç®­å¤´çš„æµè½¬æ–¹å‘å¯ä»¥çœ‹å‡ºï¼Œä» Runnable çŠ¶æ€è¿›å…¥ Blocked çŠ¶æ€åªæœ‰ä¸€ç§å¯èƒ½ï¼Œå°±æ˜¯è¿›å…¥ synchronized ä¿æŠ¤çš„ä»£ç æ—¶<u>æ²¡æœ‰æŠ¢åˆ° monitor é”</u>ï¼Œæ— è®ºæ˜¯è¿›å…¥ synchronized ä»£ç å—ï¼Œè¿˜æ˜¯ synchronized æ–¹æ³•ï¼Œéƒ½æ˜¯ä¸€æ ·ã€‚</p>
<p>æˆ‘ä»¬å†å¾€å³çœ‹ï¼Œå½“å¤„äº Blocked çš„çº¿ç¨‹<u>æŠ¢åˆ° monitor é”</u>ï¼Œå°±ä¼šä» Blocked çŠ¶æ€å›åˆ°Runnable çŠ¶æ€ã€‚</p>
<h5 id="3-3-3-2-Waiting"><a href="#3-3-3-2-Waiting" class="headerlink" title="3.3.3.2.Waiting"></a>3.3.3.2.Waiting</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230802141903651.png" alt="image-20230802141903651"></p>
<p>æˆ‘ä»¬å†çœ‹çœ‹ Waiting çŠ¶æ€ï¼Œçº¿ç¨‹è¿›å…¥ Waiting çŠ¶æ€æœ‰ä¸‰ç§å¯èƒ½æ€§ã€‚</p>
<ol>
<li>æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Object.wait() æ–¹æ³•ã€‚</li>
<li>æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Thread.join() æ–¹æ³•ã€‚</li>
<li>LockSupport.park() æ–¹æ³•ã€‚</li>
</ol>
<p>åˆšæ‰å¼ºè°ƒè¿‡ï¼ŒBlocked ä»…ä»…é’ˆå¯¹ synchronized monitor é”ï¼Œå¯æ˜¯åœ¨ Java ä¸­è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„é”ï¼Œæ¯”å¦‚ ReentrantLockï¼Œå¦‚æœçº¿ç¨‹åœ¨è·å–è¿™ç§é”æ—¶æ²¡æœ‰æŠ¢åˆ°è¯¥é”å°±ä¼šè¿›å…¥ Waiting çŠ¶æ€ï¼Œå› ä¸ºæœ¬è´¨ä¸Šå®ƒæ‰§è¡Œäº† LockSupport.park() æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ Waiting çŠ¶æ€ã€‚åŒæ ·ï¼ŒObject.wait() å’Œ Thread.join() ä¹Ÿä¼šè®©çº¿ç¨‹è¿›å…¥ Waiting çŠ¶æ€ã€‚</p>
<p><strong><u>Blocked ä¸ Waiting çš„åŒºåˆ«æ˜¯ Blocked åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾ monitor é”ï¼Œè€Œ Waiting åˆ™æ˜¯åœ¨ç­‰å¾…æŸä¸ªæ¡ä»¶ï¼Œæ¯”å¦‚ join çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œæˆ–è€…æ˜¯ notify()&#x2F;notifyAll() ã€‚</u></strong></p>
<h5 id="3-3-3-3-TimedWaiting"><a href="#3-3-3-3-TimedWaiting" class="headerlink" title="3.3.3.3.TimedWaiting"></a>3.3.3.3.TimedWaiting</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230802142019403.png" alt="image-20230802142019403"></p>
<p>åœ¨ Waiting ä¸Šé¢æ˜¯ Timed Waiting çŠ¶æ€ï¼Œè¿™ä¸¤ä¸ªçŠ¶æ€æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œ<u><strong>åŒºåˆ«ä»…åœ¨äºæœ‰æ²¡æœ‰æ—¶é—´é™åˆ¶</strong></u>ï¼ŒTimed Waiting ä¼šç­‰å¾…è¶…æ—¶ï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ï¼Œæˆ–è€…åœ¨è¶…æ—¶å‰è¢«å”¤é†’ä¿¡å·å”¤é†’ã€‚</p>
<p>ä»¥ä¸‹æƒ…å†µä¼šè®©çº¿ç¨‹è¿›å…¥ Timed Waiting çŠ¶æ€ã€‚</p>
<ol>
<li>è®¾ç½®äº†æ—¶é—´å‚æ•°çš„ Thread.sleep(long millis) æ–¹æ³•ï¼›</li>
<li>è®¾ç½®äº†æ—¶é—´å‚æ•°çš„ Object.wait(long timeout) æ–¹æ³•ï¼›</li>
<li>è®¾ç½®äº†æ—¶é—´å‚æ•°çš„ Thread.join(long millis) æ–¹æ³•ï¼›</li>
<li>è®¾ç½®äº†æ—¶é—´å‚æ•°çš„ LockSupport.parkNanos(long nanos) æ–¹æ³•å’Œ LockSupport.parkUntil(long deadline) æ–¹æ³•ã€‚</li>
</ol>
<h4 id="3-3-4-Terminated"><a href="#3-3-4-Terminated" class="headerlink" title="3.3.4.Terminated"></a>3.3.4.Terminated</h4><ul>
<li>run() æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹æ­£å¸¸é€€å‡ºã€‚</li>
<li>å‡ºç°ä¸€ä¸ªæ²¡æœ‰æ•è·çš„å¼‚å¸¸ï¼Œç»ˆæ­¢äº† run() æ–¹æ³•ï¼Œæœ€ç»ˆå¯¼è‡´æ„å¤–ç»ˆæ­¢ã€‚</li>
</ul>
<h4 id="3-3-5-çº¿ç¨‹çŠ¶æ€è½¬æ¢"><a href="#3-3-5-çº¿ç¨‹çŠ¶æ€è½¬æ¢" class="headerlink" title="3.3.5.çº¿ç¨‹çŠ¶æ€è½¬æ¢"></a>3.3.5.çº¿ç¨‹çŠ¶æ€è½¬æ¢</h4><ul>
<li>Blocked çŠ¶æ€è¿›å…¥ Runnable çŠ¶æ€ï¼Œè¦æ±‚çº¿ç¨‹è·å– monitor é”</li>
<li>Waiting çŠ¶æ€æµè½¬åˆ°å…¶ä»–çŠ¶æ€åˆ™æ¯”è¾ƒç‰¹æ®Šï¼Œå› ä¸ºé¦–å…ˆ Waiting æ˜¯ä¸é™æ—¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ— è®ºè¿‡äº†å¤šé•¿æ—¶é—´å®ƒéƒ½<u>ä¸ä¼šä¸»åŠ¨æ¢å¤</u>ã€‚<ul>
<li><strong>åªæœ‰å½“æ‰§è¡Œäº† LockSupport.unpark()ï¼Œæˆ–è€… join çš„çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæˆ–è€…è¢«ä¸­æ–­æ—¶æ‰å¯ä»¥è¿›å…¥ Runnable çŠ¶æ€ã€‚</strong></li>
<li><strong>å¦‚æœå…¶ä»–çº¿ç¨‹è°ƒç”¨ notify() æˆ– notifyAll()æ¥å”¤é†’å®ƒï¼Œå®ƒä¼šç›´æ¥è¿›å…¥ Blocked çŠ¶æ€ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºå”¤é†’ Waiting çº¿ç¨‹çš„çº¿ç¨‹å¦‚æœè°ƒç”¨ notify() æˆ– notifyAll()ï¼Œè¦æ±‚å¿…é¡»é¦–å…ˆæŒæœ‰è¯¥ monitor é”ï¼Œæ‰€ä»¥å¤„äº Waiting çŠ¶æ€çš„çº¿ç¨‹è¢«å”¤é†’æ—¶æ‹¿ä¸åˆ°è¯¥é”ï¼Œå°±ä¼šè¿›å…¥ Blocked çŠ¶æ€ï¼Œç›´åˆ°æ‰§è¡Œäº† notify()&#x2F;notifyAll() çš„å”¤é†’å®ƒçš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å¹¶é‡Šæ”¾ monitor é”ï¼Œæ‰å¯èƒ½è½®åˆ°å®ƒå»æŠ¢å¤ºè¿™æŠŠé”ï¼Œå¦‚æœå®ƒèƒ½æŠ¢åˆ°ï¼Œå°±ä¼šä» Blocked çŠ¶æ€å›åˆ° Runnable çŠ¶æ€ã€‚</strong></li>
</ul>
</li>
<li>Timed Waiting çŠ¶æ€åŒç†ï¼Œåªä¸è¿‡æ˜¯åœ¨è§„å®šæ—¶é—´èŒƒå›´å†…ä¸Waitingç›¸åŒ</li>
</ul>
<h3 id="3-4-waitã€notifyã€notifyAll-æ–¹æ³•çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼Ÿ"><a href="#3-4-waitã€notifyã€notifyAll-æ–¹æ³•çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼Ÿ" class="headerlink" title="3.4.waitã€notifyã€notifyAll æ–¹æ³•çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼Ÿ"></a>3.4.waitã€notifyã€notifyAll æ–¹æ³•çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼Ÿ</h3><h4 id="3-4-1ä¸ºä»€ä¹ˆ-wait-å¿…é¡»åœ¨-synchronized-ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Ÿ"><a href="#3-4-1ä¸ºä»€ä¹ˆ-wait-å¿…é¡»åœ¨-synchronized-ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Ÿ" class="headerlink" title="3.4.1ä¸ºä»€ä¹ˆ wait å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Ÿ"></a>3.4.1ä¸ºä»€ä¹ˆ wait å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Ÿ</h4><p>â€‹	è€ƒè™‘ä¸‹è¿°æƒ…å†µï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BlockingQueue</span> &#123;</span><br><span class="line">    Queue&lt;String&gt; buffer = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;String&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">give</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        buffer.add(data);</span><br><span class="line">        notify();  <span class="comment">// Since someone may be waiting in take</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (buffer.isEmpty()) &#123;</span><br><span class="line">            wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> buffer.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸èƒ½ç¡®ä¿ notify æ–¹æ³•æ°¸è¿œä¸ä¼šåœ¨ buffer.isEmpty å’Œ wait æ–¹æ³•ä¹‹é—´è¢«è°ƒç”¨ï¼Œå¦‚æœçœŸè¿™æ ·å‘ç”Ÿäº†ï¼Œç¨‹åºå°±ä¼šä¸€ç›´è¢«waitè€Œä¸èƒŒå”¤é†’ã€‚</p>
<h4 id="3-4-2-ä¸ºä»€ä¹ˆ-wait-x2F-notify-x2F-notifyAll-è¢«å®šä¹‰åœ¨-Object-ç±»ä¸­ï¼Œè€Œ-sleep-å®šä¹‰åœ¨-Thread-ç±»ä¸­ï¼Ÿ"><a href="#3-4-2-ä¸ºä»€ä¹ˆ-wait-x2F-notify-x2F-notifyAll-è¢«å®šä¹‰åœ¨-Object-ç±»ä¸­ï¼Œè€Œ-sleep-å®šä¹‰åœ¨-Thread-ç±»ä¸­ï¼Ÿ" class="headerlink" title="3.4.2.ä¸ºä»€ä¹ˆ wait&#x2F;notify&#x2F;notifyAll è¢«å®šä¹‰åœ¨ Object ç±»ä¸­ï¼Œè€Œ sleep å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Ÿ"></a>3.4.2.ä¸ºä»€ä¹ˆ wait&#x2F;notify&#x2F;notifyAll è¢«å®šä¹‰åœ¨ Object ç±»ä¸­ï¼Œè€Œ sleep å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Ÿ</h4><ol>
<li>å› ä¸º Java ä¸­<u>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€æŠŠç§°ä¹‹ä¸º monitor ç›‘è§†å™¨çš„é”</u>ï¼Œç”±äºæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä¸Šé”ï¼Œè¿™å°±è¦æ±‚åœ¨å¯¹è±¡å¤´ä¸­æœ‰ä¸€ä¸ªç”¨æ¥ä¿å­˜é”ä¿¡æ¯çš„ä½ç½®ã€‚è¿™ä¸ªé”æ˜¯å¯¹è±¡çº§åˆ«çš„ï¼Œè€Œéçº¿ç¨‹çº§åˆ«çš„ï¼Œwait&#x2F;notify&#x2F;notifyAll ä¹Ÿéƒ½æ˜¯é”çº§åˆ«çš„æ“ä½œï¼Œå®ƒä»¬çš„é”å±äºå¯¹è±¡ï¼Œæ‰€ä»¥æŠŠå®ƒä»¬å®šä¹‰åœ¨ Object ç±»ä¸­æ˜¯æœ€åˆé€‚ï¼Œå› ä¸º Object ç±»æ˜¯æ‰€æœ‰å¯¹è±¡çš„çˆ¶ç±»ã€‚</li>
<li>å› ä¸ºå¦‚æœæŠŠ wait&#x2F;notify&#x2F;notifyAll æ–¹æ³•å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Œä¼šå¸¦æ¥å¾ˆå¤§çš„å±€é™æ€§ï¼Œæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å¯èƒ½æŒæœ‰å¤šæŠŠé”ï¼Œä»¥ä¾¿å®ç°ç›¸äº’é…åˆçš„å¤æ‚é€»è¾‘ï¼Œå‡è®¾æ­¤æ—¶ wait æ–¹æ³•å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Œå¦‚ä½•å®ç°è®©ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å¤šæŠŠé”å‘¢ï¼Ÿåˆå¦‚ä½•æ˜ç¡®çº¿ç¨‹ç­‰å¾…çš„æ˜¯å“ªæŠŠé”å‘¢ï¼Ÿæ—¢ç„¶æˆ‘ä»¬æ˜¯è®©å½“å‰çº¿ç¨‹å»ç­‰å¾…æŸä¸ªå¯¹è±¡çš„é”ï¼Œè‡ªç„¶åº”è¯¥é€šè¿‡æ“ä½œå¯¹è±¡æ¥å®ç°ï¼Œè€Œä¸æ˜¯æ“ä½œçº¿ç¨‹ã€‚</li>
</ol>
<h4 id="3-4-5-wait-x2F-notify-å’Œ-sleep-æ–¹æ³•çš„å¼‚åŒï¼Ÿ"><a href="#3-4-5-wait-x2F-notify-å’Œ-sleep-æ–¹æ³•çš„å¼‚åŒï¼Ÿ" class="headerlink" title="3.4.5.wait&#x2F;notify å’Œ sleep æ–¹æ³•çš„å¼‚åŒï¼Ÿ"></a>3.4.5.wait&#x2F;notify å’Œ sleep æ–¹æ³•çš„å¼‚åŒï¼Ÿ</h4><h5 id="ç›¸åŒç‚¹ï¼š"><a href="#ç›¸åŒç‚¹ï¼š" class="headerlink" title="ç›¸åŒç‚¹ï¼š"></a>ç›¸åŒç‚¹ï¼š</h5><ol>
<li>å®ƒä»¬éƒ½å¯ä»¥è®©çº¿ç¨‹é˜»å¡ã€‚</li>
<li>å®ƒä»¬éƒ½å¯ä»¥å“åº” interrupt ä¸­æ–­ï¼šåœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­å¦‚æœæ”¶åˆ°ä¸­æ–­ä¿¡å·ï¼Œéƒ½å¯ä»¥è¿›è¡Œå“åº”ï¼Œå¹¶æŠ›å‡º InterruptedException å¼‚å¸¸ã€‚</li>
</ol>
<h5 id="ä¸åŒç‚¹ï¼š"><a href="#ä¸åŒç‚¹ï¼š" class="headerlink" title="ä¸åŒç‚¹ï¼š"></a>ä¸åŒç‚¹ï¼š</h5><ol>
<li><u><strong>wait æ–¹æ³•å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„ä»£ç ä¸­ä½¿ç”¨</strong></u>ï¼Œè€Œ sleep æ–¹æ³•å¹¶æ²¡æœ‰è¿™ä¸ªè¦æ±‚ã€‚</li>
<li>åœ¨åŒæ­¥ä»£ç ä¸­<strong>æ‰§è¡Œ sleep æ–¹æ³•æ—¶ï¼Œå¹¶ä¸ä¼šé‡Šæ”¾ monitor é”</strong>ï¼Œä½†<u>æ‰§è¡Œ wait æ–¹æ³•æ—¶ä¼šä¸»åŠ¨é‡Šæ”¾ monitor é”</u>ã€‚</li>
<li>sleep æ–¹æ³•ä¸­ä¼šè¦æ±‚å¿…é¡»å®šä¹‰ä¸€ä¸ªæ—¶é—´ï¼Œ<u>æ—¶é—´åˆ°æœŸåä¼šä¸»åŠ¨æ¢å¤</u>ï¼Œè€Œå¯¹äºæ²¡æœ‰å‚æ•°çš„ wait æ–¹æ³•è€Œè¨€ï¼Œæ„å‘³ç€æ°¸ä¹…ç­‰å¾…ï¼Œç›´åˆ°è¢«ä¸­æ–­æˆ–è¢«å”¤é†’æ‰èƒ½æ¢å¤ï¼Œå®ƒå¹¶<u>ä¸ä¼šä¸»åŠ¨æ¢å¤</u>ã€‚</li>
<li>wait&#x2F;notify æ˜¯ Object ç±»çš„æ–¹æ³•ï¼Œè€Œ sleep æ˜¯ Thread ç±»çš„æ–¹æ³•ã€‚</li>
</ol>
<h3 id="3-5-ä¸‰ç±»çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#3-5-ä¸‰ç±»çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="3.5.ä¸‰ç±»çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>3.5.ä¸‰ç±»çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><h4 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</h4><ul>
<li>å½“å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº›çº¿ç¨‹åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„è°ƒåº¦å’Œäº¤æ›¿æ‰§è¡Œé—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥ï¼Œè€Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºéƒ½å¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœï¼Œé‚£è¿™ä¸ªå¯¹è±¡ä¾¿æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
<li>å¦‚æœæŸä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé‚£ä¹ˆå¯¹äºä½¿ç”¨è€…è€Œè¨€ï¼Œåœ¨ä½¿ç”¨æ—¶å°±ä¸éœ€è¦è€ƒè™‘æ–¹æ³•é—´çš„åè°ƒé—®é¢˜ï¼Œæ¯”å¦‚ä¸éœ€è¦è€ƒè™‘ä¸èƒ½åŒæ—¶å†™å…¥æˆ–è¯»å†™ä¸èƒ½å¹¶è¡Œçš„é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘ä»»ä½•é¢å¤–çš„åŒæ­¥é—®é¢˜ï¼Œæ¯”å¦‚ä¸éœ€è¦é¢å¤–è‡ªå·±åŠ  synchronized é”ï¼Œé‚£ä¹ˆå®ƒæ‰æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥çœ‹å‡ºå¯¹çº¿ç¨‹å®‰å…¨çš„å®šä¹‰è¿˜æ˜¯éå¸¸è‹›åˆ»çš„ã€‚</li>
</ul>
<h4 id="ä¸‰ç§å…¸å‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#ä¸‰ç§å…¸å‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="ä¸‰ç§å…¸å‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>ä¸‰ç§å…¸å‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</h4><ol>
<li>è¿è¡Œç»“æœé”™è¯¯ï¼›</li>
<li>å‘å¸ƒå’Œåˆå§‹åŒ–å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›</li>
<li>æ´»è·ƒæ€§é—®é¢˜ã€‚</li>
</ol>
<h5 id="3-1-è¿è¡Œç»“æœé”™è¯¯"><a href="#3-1-è¿è¡Œç»“æœé”™è¯¯" class="headerlink" title="3.1.è¿è¡Œç»“æœé”™è¯¯"></a>3.1.è¿è¡Œç»“æœé”™è¯¯</h5><ul>
<li>å¤šçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªå˜é‡å¯¼è‡´çš„è¿è¡Œç»“æœé”™è¯¯]</li>
<li>æ˜¯å› ä¸ºåœ¨å¤šçº¿ç¨‹ä¸‹ï¼ŒCPU çš„è°ƒåº¦æ˜¯ä»¥<strong>æ—¶é—´ç‰‡ä¸ºå•ä½</strong>è¿›è¡Œåˆ†é…çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥å¾—åˆ°ä¸€å®šé‡çš„æ—¶é—´ç‰‡ã€‚ä½†å¦‚æœçº¿ç¨‹æ‹¥æœ‰çš„æ—¶é—´ç‰‡è€—å°½ï¼Œå®ƒå°†ä¼šè¢«æš‚åœæ‰§è¡Œå¹¶è®©å‡º CPU èµ„æºç»™å…¶ä»–çº¿ç¨‹ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å‘ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚æ¯”å¦‚ i++ æ“ä½œï¼Œè¡¨é¢ä¸Šçœ‹åªæ˜¯ä¸€è¡Œä»£ç ï¼Œä½†å®é™…ä¸Šå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå®ƒçš„æ‰§è¡Œæ­¥éª¤ä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼Œè€Œä¸”åœ¨æ¯æ­¥æ“ä½œä¹‹é—´éƒ½æœ‰å¯èƒ½è¢«æ‰“æ–­ã€‚</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230803190731854.png" alt="image-20230803190731854" style="zoom: 33%;" />



<h5 id="3-2-å‘å¸ƒå’Œåˆå§‹åŒ–å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#3-2-å‘å¸ƒå’Œåˆå§‹åŒ–å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="3.2.å‘å¸ƒå’Œåˆå§‹åŒ–å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>3.2.å‘å¸ƒå’Œåˆå§‹åŒ–å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜</h5><ul>
<li>æˆ‘ä»¬åˆ›å»ºå¯¹è±¡å¹¶è¿›è¡Œå‘å¸ƒå’Œåˆå§‹åŒ–ä¾›å…¶ä»–ç±»æˆ–å¯¹è±¡ä½¿ç”¨æ˜¯å¸¸è§çš„æ“ä½œï¼Œä½†å¦‚æœæˆ‘ä»¬æ“ä½œçš„æ—¶é—´æˆ–åœ°ç‚¹ä¸å¯¹ï¼Œå°±å¯èƒ½å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WrongInit</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, String&gt; students;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WrongInit</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                students = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                students.put(<span class="number">1</span>, <span class="string">&quot;ç‹å°ç¾&quot;</span>);</span><br><span class="line">                students.put(<span class="number">2</span>, <span class="string">&quot;é’±äºŒå®&quot;</span>);</span><br><span class="line">                students.put(<span class="number">3</span>, <span class="string">&quot;å‘¨ä¸‰&quot;</span>);</span><br><span class="line">                students.put(<span class="number">4</span>, <span class="string">&quot;èµµå››&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="keyword">public</span> Map&lt;Integer, String&gt; <span class="title function_">getStudents</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> students;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">WrongInit</span> <span class="variable">multiThreadsError6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WrongInit</span>();</span><br><span class="line">        System.out.println(multiThreadsError6.getStudents().get(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­ åˆ›å»ºmultiThreadsError6å¯¹è±¡åç«‹åˆ»å°±è¯•å›¾è¾“å‡ºstudentçš„ä¿¡æ¯ï¼Œè€Œå®é™…ä¸Šæ­¤æ—¶çº¿ç¨‹å¯èƒ½è¿˜æ²¡å¯åŠ¨å®Œæ¯•ï¼Œå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.NullPointerException</span><br><span class="line">at lesson6.WrongInit.main(WrongInit.java:32)</span><br></pre></td></tr></table></figure>



<h5 id="3-3-æ´»è·ƒæ€§é—®é¢˜"><a href="#3-3-æ´»è·ƒæ€§é—®é¢˜" class="headerlink" title="3.3.æ´»è·ƒæ€§é—®é¢˜"></a>3.3.æ´»è·ƒæ€§é—®é¢˜</h5><ul>
<li>æ­»é”<ul>
<li>â€¦â€¦</li>
</ul>
</li>
<li>æ´»é”<ul>
<li>æ´»é”ä¸æ­»é”éå¸¸ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ç¨‹åºä¸€ç›´ç­‰ä¸åˆ°ç»“æœï¼Œä½†å¯¹æ¯”äºæ­»é”ï¼Œæ´»é”æ˜¯æ´»çš„ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå› ä¸º<u>æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å¹¶æ²¡æœ‰é˜»å¡ï¼Œå®ƒå§‹ç»ˆåœ¨è¿è¡Œä¸­ï¼Œå´ä¸€ç›´å¾—ä¸åˆ°ç»“æœã€‚</u></li>
<li>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œæ”¾ç€å„ç§å„æ ·éœ€è¦è¢«å¤„ç†çš„æ¶ˆæ¯ï¼Œè€ŒæŸä¸ªæ¶ˆæ¯ç”±äºè‡ªèº«è¢«å†™é”™äº†å¯¼è‡´ä¸èƒ½è¢«æ­£ç¡®å¤„ç†ï¼Œæ‰§è¡Œæ—¶ä¼šæŠ¥é”™ï¼Œå¯æ˜¯é˜Ÿåˆ—çš„é‡è¯•æœºåˆ¶ä¼šé‡æ–°æŠŠå®ƒæ”¾åœ¨é˜Ÿåˆ—å¤´è¿›è¡Œä¼˜å…ˆé‡è¯•å¤„ç†ï¼Œä½†è¿™ä¸ªæ¶ˆæ¯æœ¬èº«æ— è®ºè¢«æ‰§è¡Œå¤šå°‘æ¬¡ï¼Œéƒ½æ— æ³•è¢«æ­£ç¡®å¤„ç†ï¼Œæ¯æ¬¡æŠ¥é”™ååˆä¼šè¢«æ”¾åˆ°é˜Ÿåˆ—å¤´è¿›è¡Œé‡è¯•ï¼Œå‘¨è€Œå¤å§‹ï¼Œæœ€ç»ˆå¯¼è‡´çº¿ç¨‹ä¸€ç›´å¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œä½†ç¨‹åºå§‹ç»ˆå¾—ä¸åˆ°ç»“æœï¼Œä¾¿å‘ç”Ÿäº†æ´»é”é—®é¢˜</li>
</ul>
</li>
<li>é¥¥é¥¿<ul>
<li>é¥¥é¥¿æ˜¯æŒ‡çº¿ç¨‹éœ€è¦æŸäº›èµ„æºæ—¶å§‹ç»ˆå¾—ä¸åˆ°ï¼Œå°¤å…¶æ˜¯CPU èµ„æºï¼Œå°±ä¼šå¯¼è‡´çº¿ç¨‹ä¸€ç›´ä¸èƒ½è¿è¡Œè€Œäº§ç”Ÿçš„é—®é¢˜ã€‚åœ¨ Java ä¸­æœ‰çº¿ç¨‹ä¼˜å…ˆçº§çš„æ¦‚å¿µï¼ŒJava ä¸­ä¼˜å…ˆçº§åˆ†ä¸º 1 åˆ° 10ï¼Œ1 æœ€ä½ï¼Œ10 æœ€é«˜ã€‚å¦‚æœæˆ‘ä»¬æŠŠæŸä¸ªçº¿ç¨‹çš„ä¼˜å…ˆçº§è®¾ç½®ä¸º 1ï¼Œè¿™æ˜¯æœ€ä½çš„ä¼˜å…ˆçº§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªçº¿ç¨‹å°±<u>æœ‰å¯èƒ½å§‹ç»ˆåˆ†é…ä¸åˆ° CPU èµ„æº</u>ï¼Œè€Œå¯¼è‡´é•¿æ—¶é—´æ— æ³•è¿è¡Œã€‚æˆ–è€…æ˜¯æŸä¸ªçº¿ç¨‹å§‹ç»ˆæŒæœ‰æŸä¸ªæ–‡ä»¶çš„é”ï¼Œè€Œå…¶ä»–çº¿ç¨‹æƒ³è¦ä¿®æ”¹æ–‡ä»¶å°±å¿…é¡»å…ˆè·å–é”ï¼Œè¿™æ ·æƒ³è¦ä¿®æ”¹æ–‡ä»¶çš„çº¿ç¨‹å°±ä¼šé™·å…¥é¥¥é¥¿ï¼Œé•¿æ—¶é—´ä¸èƒ½è¿è¡Œã€‚</li>
</ul>
</li>
</ul>
<h3 id="3-6-å“ªäº›åœºæ™¯éœ€è¦é¢å¤–æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ"><a href="#3-6-å“ªäº›åœºæ™¯éœ€è¦é¢å¤–æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ" class="headerlink" title="3.6.å“ªäº›åœºæ™¯éœ€è¦é¢å¤–æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ"></a>3.6.å“ªäº›åœºæ™¯éœ€è¦é¢å¤–æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ</h3><h4 id="3-6-1-è®¿é—®å…±äº«å˜é‡æˆ–èµ„æº"><a href="#3-6-1-è®¿é—®å…±äº«å˜é‡æˆ–èµ„æº" class="headerlink" title="3.6.1.è®¿é—®å…±äº«å˜é‡æˆ–èµ„æº"></a>3.6.1.è®¿é—®å…±äº«å˜é‡æˆ–èµ„æº</h4><p>â€‹	å…¸å‹çš„åœºæ™¯æœ‰è®¿é—®å…±äº«å¯¹è±¡çš„å±æ€§ï¼Œè®¿é—® static é™æ€å˜é‡ï¼Œè®¿é—®å…±äº«çš„ç¼“å­˜ï¼Œç­‰ç­‰ã€‚å› ä¸ºè¿™äº›ä¿¡æ¯ä¸ä»…ä¼šè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®åˆ°ï¼Œè¿˜æœ‰å¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œé‚£ä¹ˆå°±<u><strong>æœ‰å¯èƒ½åœ¨å¹¶å‘è¯»å†™çš„æƒ…å†µä¸‹å‘ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜</strong></u>ã€‚æ¯”å¦‚æˆ‘ä»¬ä¸Šä¸€è¯¾æ—¶è®²è¿‡çš„å¤šçº¿ç¨‹åŒæ—¶ i++ çš„ä¾‹å­</p>
<h4 id="3-6-2-ä¾èµ–æ—¶åºçš„æ“ä½œ"><a href="#3-6-2-ä¾èµ–æ—¶åºçš„æ“ä½œ" class="headerlink" title="3.6.2.ä¾èµ–æ—¶åºçš„æ“ä½œ"></a>3.6.2.ä¾èµ–æ—¶åºçš„æ“ä½œ</h4><p>â€‹	å¦‚æœæˆ‘ä»¬<u>æ“ä½œçš„æ­£ç¡®æ€§æ˜¯ä¾èµ–æ—¶åº</u>çš„ï¼Œè€Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹<u>åˆä¸èƒ½ä¿éšœæ‰§è¡Œçš„é¡ºåºå’Œæˆ‘ä»¬é¢„æƒ³çš„ä¸€è‡´</u>ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå‘ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//	ä¾‹å¦‚	å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä»¥ä¸‹ä»£ç ï¼š</span></span><br><span class="line"><span class="keyword">if</span> (x == <span class="number">1</span>) &#123;</span><br><span class="line">    x = <span class="number">7</span> * x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-6-3-ä¸åŒæ•°æ®ä¹‹é—´å­˜åœ¨ç»‘å®šå…³ç³»"><a href="#3-6-3-ä¸åŒæ•°æ®ä¹‹é—´å­˜åœ¨ç»‘å®šå…³ç³»" class="headerlink" title="3.6.3.ä¸åŒæ•°æ®ä¹‹é—´å­˜åœ¨ç»‘å®šå…³ç³»"></a>3.6.3.ä¸åŒæ•°æ®ä¹‹é—´å­˜åœ¨<u>ç»‘å®šå…³ç³»</u></h4><p>â€‹	æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬çš„ä¸åŒæ•°æ®ä¹‹é—´æ˜¯æˆç»„å‡ºç°çš„ï¼Œå­˜åœ¨ç€ç›¸äº’å¯¹åº”æˆ–ç»‘å®šçš„å…³ç³»ï¼Œ<u><strong>æœ€å…¸å‹çš„å°±æ˜¯ IP å’Œç«¯å£å·</strong></u>ã€‚æœ‰æ—¶å€™æˆ‘ä»¬æ›´æ¢äº† IPï¼Œå¾€å¾€éœ€è¦åŒæ—¶æ›´æ¢ç«¯å£å·ï¼Œå¦‚æœæ²¡æœ‰æŠŠè¿™ä¸¤ä¸ªæ“ä½œç»‘å®šåœ¨ä¸€èµ·ï¼Œå°±æœ‰å¯èƒ½å‡ºç°å•ç‹¬æ›´æ¢äº† IP æˆ–ç«¯å£å·çš„æƒ…å†µï¼Œè€Œæ­¤æ—¶ä¿¡æ¯å¦‚æœå·²ç»å¯¹å¤–å‘å¸ƒï¼Œä¿¡æ¯è·å–æ–¹å°±æœ‰å¯èƒ½è·å–ä¸€ä¸ªé”™è¯¯çš„ IP ä¸ç«¯å£ç»‘å®šæƒ…å†µï¼Œè¿™æ—¶å°±å‘ç”Ÿäº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹ŸåŒæ ·éœ€è¦ä¿éšœæ“ä½œçš„åŸå­æ€§ã€‚</p>
<h4 id="3-6-4-å¯¹æ–¹æ²¡æœ‰å£°æ˜è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„"><a href="#3-6-4-å¯¹æ–¹æ²¡æœ‰å£°æ˜è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„" class="headerlink" title="3.6.4.å¯¹æ–¹æ²¡æœ‰å£°æ˜è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„"></a>3.6.4.å¯¹æ–¹æ²¡æœ‰å£°æ˜è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„</h4><p>æˆ‘ä»¬ä½¿ç”¨å…¶ä»–ç±»æ—¶ï¼Œå¦‚æœå¯¹æ–¹æ²¡æœ‰å£°æ˜è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹å¯¹å…¶ä»–ç±»è¿›è¡Œå¤šçº¿ç¨‹çš„å¹¶å‘æ“ä½œï¼Œå°±æœ‰å¯èƒ½ä¼šå‘ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<p>å¦‚ï¼šArrayListå¦‚æœæˆ‘ä»¬æŠŠ ArrayList ç”¨åœ¨äº†å¤šçº¿ç¨‹çš„åœºæ™¯ï¼Œéœ€è¦åœ¨å¤–éƒ¨æ‰‹åŠ¨ç”¨ synchronized ç­‰æ–¹å¼ä¿è¯å¹¶å‘å®‰å…¨ã€‚</p>
<h3 id="3-7-ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ"><a href="#3-7-ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ" class="headerlink" title="3.7.ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ"></a>3.7.ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ</h3><h4 id="3-7-1ä»€ä¹ˆæ˜¯æ€§èƒ½é—®é¢˜ï¼Ÿ"><a href="#3-7-1ä»€ä¹ˆæ˜¯æ€§èƒ½é—®é¢˜ï¼Ÿ" class="headerlink" title="3.7.1ä»€ä¹ˆæ˜¯æ€§èƒ½é—®é¢˜ï¼Ÿ"></a>3.7.1ä»€ä¹ˆæ˜¯æ€§èƒ½é—®é¢˜ï¼Ÿ</h4><p>ä½¿ç”¨å¤šçº¿ç¨‹çš„æœ€å¤§ç›®çš„ä¸å°±æ˜¯ä¸ºäº†æé«˜æ€§èƒ½å—ï¼Ÿè®©å¤šä¸ªçº¿ç¨‹åŒæ—¶å·¥ä½œï¼ŒåŠ å¿«ç¨‹åºè¿è¡Œé€Ÿåº¦ï¼Œä¸ºä»€ä¹ˆåè€Œä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜å‘¢ï¼Ÿè¿™æ˜¯<u>å› ä¸ºå•çº¿ç¨‹ç¨‹åºæ˜¯ç‹¬ç«‹å·¥ä½œçš„ï¼Œä¸éœ€è¦ä¸å…¶ä»–çº¿ç¨‹è¿›è¡Œäº¤äº’ï¼Œä½†å¤šçº¿ç¨‹ä¹‹é—´åˆ™éœ€è¦è°ƒåº¦ä»¥åŠåˆä½œï¼Œè°ƒåº¦ä¸åˆä½œå°±ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ä»è€Œäº§ç”Ÿæ€§èƒ½é—®é¢˜ã€‚</u></p>
<h4 id="3-7-2-ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ"><a href="#3-7-2-ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ" class="headerlink" title="3.7.2.ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ"></a>3.7.2.ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ</h4><p>åˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š</p>
<h5 id="ğŸŒŸè°ƒåº¦å¼€é”€ï¼š"><a href="#ğŸŒŸè°ƒåº¦å¼€é”€ï¼š" class="headerlink" title="ğŸŒŸè°ƒåº¦å¼€é”€ï¼š"></a>ğŸŒŸè°ƒåº¦å¼€é”€ï¼š</h5><ul>
<li>âš ï¸ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š<ul>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹çº¿ç¨‹è°ƒåº¦ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œçº¿ç¨‹æ•°å¾€å¾€æ˜¯å¤§äº CPU æ ¸å¿ƒæ•°çš„ï¼Œæ¯”å¦‚ CPU æ ¸å¿ƒæ•°å¯èƒ½æ˜¯ 8 æ ¸ã€16 æ ¸ï¼Œç­‰ç­‰ï¼Œä½†çº¿ç¨‹æ•°å¯èƒ½è¾¾åˆ°æˆç™¾ä¸Šåƒä¸ªã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šæŒ‰ç…§ä¸€å®šçš„è°ƒåº¦ç®—æ³•ï¼Œç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡ï¼Œè®©æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰æœºä¼šå¾—åˆ°è¿è¡Œã€‚è€Œåœ¨è¿›è¡Œè°ƒåº¦æ—¶å°±ä¼šå¼•èµ·ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šæŒ‚èµ·å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¹¶ä¿å­˜å½“å‰çš„çŠ¶æ€ï¼Œç„¶åå¯»æ‰¾ä¸‹ä¸€å¤„å³å°†æ¢å¤æ‰§è¡Œçš„ä»£ç ï¼Œå”¤é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œä»¥æ­¤ç±»æ¨ï¼Œåå¤æ‰§è¡Œã€‚ä½†ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„å¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œå‡è®¾æˆ‘ä»¬çš„ä»»åŠ¡å†…å®¹éå¸¸çŸ­ï¼Œæ¯”å¦‚åªè¿›è¡Œç®€å•çš„è®¡ç®—ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å‘ç”Ÿæˆ‘ä»¬ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„æ€§èƒ½å¼€é”€æ¯”æ‰§è¡Œçº¿ç¨‹æœ¬èº«å†…å®¹å¸¦æ¥çš„å¼€é”€è¿˜è¦å¤§çš„æƒ…å†µã€‚</li>
</ul>
</li>
<li>âš ï¸ç¼“å­˜å¤±æ•ˆï¼š<ul>
<li>ç”±äºç¨‹åºæœ‰å¾ˆå¤§æ¦‚ç‡ä¼šå†æ¬¡è®¿é—®åˆšæ‰è®¿é—®è¿‡çš„æ•°æ®ï¼Œæ‰€ä»¥ä¸ºäº†åŠ é€Ÿæ•´ä¸ªç¨‹åºçš„è¿è¡Œï¼Œä¼šä½¿ç”¨ç¼“å­˜ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ä½¿ç”¨ç›¸åŒæ•°æ®æ—¶å°±å¯ä»¥å¾ˆå¿«åœ°è·å–æ•°æ®ã€‚å¯ä¸€æ—¦è¿›è¡Œäº†çº¿ç¨‹è°ƒåº¦ï¼Œåˆ‡æ¢åˆ°å…¶ä»–çº¿ç¨‹ï¼ŒCPUå°±ä¼šå»æ‰§è¡Œä¸åŒçš„ä»£ç ï¼ŒåŸæœ‰çš„ç¼“å­˜å°±å¾ˆå¯èƒ½å¤±æ•ˆäº†ï¼Œéœ€è¦é‡æ–°ç¼“å­˜æ–°çš„æ•°æ®ï¼Œè¿™ä¹Ÿä¼šé€ æˆä¸€å®šçš„å¼€é”€ï¼Œæ‰€ä»¥çº¿ç¨‹è°ƒåº¦å™¨ä¸ºäº†é¿å…é¢‘ç¹åœ°å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ<u><strong>é€šå¸¸ä¼šç»™è¢«è°ƒåº¦åˆ°çš„çº¿ç¨‹è®¾ç½®æœ€å°çš„æ‰§è¡Œæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯åªæœ‰æ‰§è¡Œå®Œè¿™æ®µæ—¶é—´ä¹‹åï¼Œæ‰å¯èƒ½è¿›è¡Œä¸‹ä¸€æ¬¡çš„è°ƒåº¦ï¼Œç”±æ­¤å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ã€‚</strong></u></li>
</ul>
</li>
</ul>
<h5 id="ğŸŒŸåä½œå¼€é”€ï¼š"><a href="#ğŸŒŸåä½œå¼€é”€ï¼š" class="headerlink" title="ğŸŒŸåä½œå¼€é”€ï¼š"></a>ğŸŒŸåä½œå¼€é”€ï¼š</h5><p>â€”-ç»´æŠ¤å…±äº«æ•°æ®çš„å¼€é”€</p>
<ul>
<li>é™¤äº†çº¿ç¨‹è°ƒåº¦ä¹‹å¤–ï¼Œçº¿ç¨‹åä½œåŒæ ·ä¹Ÿæœ‰å¯èƒ½å¸¦æ¥æ€§èƒ½é—®é¢˜ã€‚<u>å› ä¸ºçº¿ç¨‹ä¹‹é—´å¦‚æœæœ‰å…±äº«æ•°æ®ï¼Œä¸ºäº†é¿å…æ•°æ®é”™ä¹±ï¼Œä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå°±æœ‰å¯èƒ½ç¦æ­¢ç¼–è¯‘å™¨å’Œ CPU å¯¹å…¶è¿›è¡Œé‡æ’åºç­‰ä¼˜åŒ–</u>ï¼Œä¹Ÿå¯èƒ½å‡ºäºåŒæ­¥çš„ç›®çš„ï¼Œåå¤æŠŠçº¿ç¨‹å·¥ä½œå†…å­˜çš„æ•°æ® flush åˆ°ä¸»å­˜ä¸­ï¼Œç„¶åå†ä»ä¸»å†…å­˜ refresh åˆ°å…¶ä»–çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œç­‰ç­‰ã€‚è¿™äº›é—®é¢˜åœ¨å•çº¿ç¨‹ä¸­å¹¶ä¸å­˜åœ¨ï¼Œä½†åœ¨å¤šçº¿ç¨‹ä¸­ä¸ºäº†ç¡®ä¿æ•°æ®çš„æ­£ç¡®æ€§ï¼Œå°±ä¸å¾—ä¸é‡‡å–ä¸Šè¿°æ–¹æ³•ï¼Œå› ä¸ºçº¿ç¨‹å®‰å…¨çš„ä¼˜å…ˆçº§è¦æ¯”æ€§èƒ½ä¼˜å…ˆçº§æ›´é«˜ï¼Œè¿™ä¹Ÿé—´æ¥é™ä½äº†æˆ‘ä»¬çš„æ€§èƒ½ã€‚</li>
</ul>
<h3 id="3-8-ä½¿ç”¨çº¿ç¨‹æ± æ¯”æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å¥½åœ¨å“ªé‡Œï¼Ÿ"><a href="#3-8-ä½¿ç”¨çº¿ç¨‹æ± æ¯”æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å¥½åœ¨å“ªé‡Œï¼Ÿ" class="headerlink" title="3.8.ä½¿ç”¨çº¿ç¨‹æ± æ¯”æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å¥½åœ¨å“ªé‡Œï¼Ÿ"></a>3.8.ä½¿ç”¨çº¿ç¨‹æ± æ¯”æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å¥½åœ¨å“ªé‡Œï¼Ÿ</h3><h4 id="3-8-1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ"><a href="#3-8-1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ" class="headerlink" title="3.8.1.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ"></a>3.8.1.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ</h4><p>æ²¡æœ‰çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œæ¯å‘å¸ƒä¸€ä¸ªä»»åŠ¡å°±éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œè¿™æ ·åœ¨ä»»åŠ¡å°‘æ—¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå½“ä»»åŠ¡æ•°å¾ˆå¤šæ—¶ï¼Œæ¯”å¦‚ä»»åŠ¡é‡åˆ°è¾¾äº†10000ï¼Œå°±éœ€è¦åˆ›å»º10000ä¸ªçº¿ç¨‹æ¥åº”å¯¹ä»»åŠ¡ã€‚è€Œ J<u>ava ç¨‹åºä¸­çš„çº¿ç¨‹ä¸æ“ä½œç³»ç»Ÿä¸­çš„çº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”</u>çš„ï¼Œæ­¤æ—¶å‡è®¾çº¿ç¨‹ä¸­çš„ä»»åŠ¡éœ€è¦ä¸€å®šçš„è€—æ—¶æ‰èƒ½å¤Ÿå®Œæˆï¼Œä¾¿ä¼šäº§ç”Ÿå¾ˆå¤§çš„ç³»ç»Ÿå¼€é”€ä¸èµ„æºæµªè´¹ã€‚	</p>
<h5 id="ä¸ä½¿ç”¨çº¿ç¨‹æ± çš„é—®é¢˜ï¼š"><a href="#ä¸ä½¿ç”¨çº¿ç¨‹æ± çš„é—®é¢˜ï¼š" class="headerlink" title="ä¸ä½¿ç”¨çº¿ç¨‹æ± çš„é—®é¢˜ï¼š"></a>ä¸ä½¿ç”¨çº¿ç¨‹æ± çš„é—®é¢˜ï¼š</h5><ol>
<li>ç¬¬ä¸€ç‚¹ï¼Œ<u>åå¤åˆ›å»ºçº¿ç¨‹ç³»ç»Ÿå¼€é”€æ¯”è¾ƒå¤§</u>ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ›å»ºå’Œé”€æ¯éƒ½éœ€è¦æ—¶é—´ï¼Œ<u>å¦‚æœä»»åŠ¡æ¯”è¾ƒç®€å•ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å¯¼è‡´åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ¶ˆè€—çš„èµ„æºæ¯”çº¿ç¨‹æ‰§è¡Œä»»åŠ¡æœ¬èº«æ¶ˆè€—çš„èµ„æºè¿˜è¦å¤§ã€‚</u></li>
<li>ç¬¬äºŒç‚¹ï¼Œè¿‡å¤šçš„çº¿ç¨‹ä¼š<strong>å ç”¨è¿‡å¤šçš„å†…å­˜ç­‰èµ„æº</strong>ï¼Œè¿˜ä¼š<strong>å¸¦æ¥è¿‡å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ï¼ŒåŒæ—¶è¿˜ä¼š<strong>å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®š</strong>ã€‚(å¦‚ä¸Šä¸€å°èŠ‚æ‰€è¯´â€”â€”â€”ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ + ç¼“å­˜å¤±æ•ˆ)</li>
</ol>
<h4 id="3-8-2-çº¿ç¨‹æ± è§£å†³é—®é¢˜æ€è·¯ï¼š"><a href="#3-8-2-çº¿ç¨‹æ± è§£å†³é—®é¢˜æ€è·¯ï¼š" class="headerlink" title="3.8.2.çº¿ç¨‹æ± è§£å†³é—®é¢˜æ€è·¯ï¼š"></a>3.8.2.çº¿ç¨‹æ± è§£å†³é—®é¢˜æ€è·¯ï¼š</h4><ul>
<li><p>é’ˆå¯¹åå¤åˆ›å»ºçº¿ç¨‹å¼€é”€å¤§çš„é—®é¢˜ï¼Œ<u>çº¿ç¨‹æ± ç”¨ä¸€äº›å›ºå®šçš„çº¿ç¨‹ä¸€ç›´ä¿æŒå·¥ä½œçŠ¶æ€å¹¶åå¤æ‰§è¡Œä»»åŠ¡ã€‚</u></p>
</li>
<li><p>é’ˆå¯¹è¿‡å¤šçº¿ç¨‹å ç”¨å¤ªå¤šå†…å­˜èµ„æºçš„é—®é¢˜ï¼Œè§£å†³æ€è·¯æ›´ç›´æ¥ï¼Œ<u>çº¿ç¨‹æ± ä¼šæ ¹æ®éœ€è¦åˆ›å»ºçº¿ç¨‹ï¼Œæ§åˆ¶çº¿ç¨‹çš„æ€»æ•°é‡ï¼Œé¿å…å ç”¨è¿‡å¤šå†…å­˜èµ„æºã€‚</u></p>
</li>
</ul>
<h4 id="3-8-3-å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± "><a href="#3-8-3-å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± " class="headerlink" title="3.8.3.å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ?"></a>3.8.3.å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ?</h4><p>â€‹	æ‰§è¡Œå™¨(Executor)ä¸­æœ‰è®¸å¤šæ„é€ çº¿ç¨‹æ± çš„é™æ€å·¥å‚æ–¹æ³•ï¼Œå¯ä»¥æ„é€ å„ç§çº¿ç¨‹æ± ã€‚</p>
<p>â€‹	å…·ä½“ä½¿ç”¨æ–¹æ³•ä¸Šé¢å·²ç»è¯´æ¸…æ¥šäº†ï¼Œä¿è¯çº¿ç¨‹æ•°ä¸è¶…è¿‡æŸå€¼ï¼Œè¯·æ±‚å¤šäº†å°±æ’é˜Ÿæ’èµ·æ¥ã€‚</p>
<h4 id="3-8-4-ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ï¼š"><a href="#3-8-4-ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ï¼š" class="headerlink" title="3.8.4.ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ï¼š"></a>3.8.4.ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ï¼š</h4><ol>
<li>ç¬¬ä¸€ç‚¹ï¼Œçº¿ç¨‹æ± å¯ä»¥è§£å†³çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„ç³»ç»Ÿå¼€é”€é—®é¢˜ï¼ŒåŒæ—¶è¿˜å¯ä»¥åŠ å¿«å“åº”é€Ÿåº¦ã€‚<u>å› ä¸ºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œæˆ‘ä»¬åªç”¨å°‘é‡çš„çº¿ç¨‹å»æ‰§è¡Œå¤§é‡çš„ä»»åŠ¡ï¼Œè¿™å°±å¤§å¤§å‡å°äº†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„å¼€é”€ã€‚</u>è€Œä¸”çº¿ç¨‹é€šå¸¸ä¸æ˜¯ç­‰æ¥åˆ°ä»»åŠ¡åå†ä¸´æ—¶åˆ›å»ºï¼Œè€Œæ˜¯å·²ç»åˆ›å»ºå¥½æ—¶åˆ»å‡†å¤‡æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ ·å°±æ¶ˆé™¤äº†çº¿ç¨‹åˆ›å»ºæ‰€å¸¦æ¥çš„å»¶è¿Ÿï¼Œ<u>æå‡äº†å“åº”é€Ÿåº¦</u>ï¼Œå¢å¼ºäº†ç”¨æˆ·ä½“éªŒã€‚</li>
<li>ç¬¬äºŒç‚¹ï¼Œçº¿ç¨‹æ± å¯ä»¥ç»Ÿç­¹å†…å­˜å’Œ CPU çš„ä½¿ç”¨ï¼Œé¿å…èµ„æºä½¿ç”¨ä¸å½“ã€‚<u>çº¿ç¨‹æ± ä¼šæ ¹æ®é…ç½®å’Œä»»åŠ¡æ•°é‡çµæ´»åœ°æ§åˆ¶çº¿ç¨‹æ•°é‡ï¼Œä¸å¤Ÿçš„æ—¶å€™å°±åˆ›å»ºï¼Œå¤ªå¤šçš„æ—¶å€™å°±å›æ”¶ï¼Œé¿å…çº¿ç¨‹è¿‡å¤šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œæˆ–çº¿ç¨‹å¤ªå°‘å¯¼è‡´ CPU èµ„æºæµªè´¹ï¼Œè¾¾åˆ°äº†ä¸€ä¸ªå®Œç¾çš„å¹³è¡¡ã€‚</u></li>
<li>ç¬¬ä¸‰ç‚¹ï¼Œçº¿ç¨‹æ± å¯ä»¥ç»Ÿä¸€ç®¡ç†èµ„æºã€‚æ¯”å¦‚çº¿ç¨‹æ± å¯ä»¥ç»Ÿä¸€ç®¡ç†ä»»åŠ¡é˜Ÿåˆ—å’Œçº¿ç¨‹ï¼Œå¯ä»¥ç»Ÿä¸€å¼€å§‹æˆ–ç»“æŸä»»åŠ¡ï¼Œæ¯”å•ä¸ªçº¿ç¨‹é€ä¸€å¤„ç†ä»»åŠ¡è¦æ›´æ–¹ä¾¿ã€æ›´æ˜“äºç®¡ç†ï¼ŒåŒæ—¶ä¹Ÿæœ‰åˆ©äºæ•°æ®ç»Ÿè®¡ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç»Ÿè®¡å‡ºå·²ç»æ‰§è¡Œè¿‡çš„ä»»åŠ¡çš„æ•°é‡ã€‚</li>
</ol>
<h3 id="3-9-çº¿ç¨‹æ± çš„å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼Ÿ"><a href="#3-9-çº¿ç¨‹æ± çš„å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼Ÿ" class="headerlink" title="3.9.çº¿ç¨‹æ± çš„å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼Ÿ"></a>3.9.çº¿ç¨‹æ± çš„å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼Ÿ</h3><h4 id="å‚æ•°åˆ—è¡¨"><a href="#å‚æ•°åˆ—è¡¨" class="headerlink" title="å‚æ•°åˆ—è¡¨"></a>å‚æ•°åˆ—è¡¨</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230804151715352.png" alt="image-20230804151715352" style="zoom:50%;" />

<h4 id="ğŸŒŸçº¿ç¨‹æ± ä¸­çº¿ç¨‹åˆ›å»ºçš„æ—¶æœºï¼š"><a href="#ğŸŒŸçº¿ç¨‹æ± ä¸­çº¿ç¨‹åˆ›å»ºçš„æ—¶æœºï¼š" class="headerlink" title="ğŸŒŸçº¿ç¨‹æ± ä¸­çº¿ç¨‹åˆ›å»ºçš„æ—¶æœºï¼š"></a>ğŸŒŸçº¿ç¨‹æ± ä¸­çº¿ç¨‹åˆ›å»ºçš„æ—¶æœºï¼š</h4><p> ![image-20230804151848748](&#x2F;Users&#x2F;donn&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230804151848748.png)</p>
<h4 id="3-9-1-corePoolSize-ä¸-maximumPoolSize"><a href="#3-9-1-corePoolSize-ä¸-maximumPoolSize" class="headerlink" title="3.9.1.corePoolSize ä¸ maximumPoolSize"></a>3.9.1.corePoolSize ä¸ maximumPoolSize</h4><p>â€‹	âš ï¸é€šè¿‡ä¸Šé¢çš„æµç¨‹å›¾ï¼Œæˆ‘ä»¬äº†è§£äº† corePoolSize å’Œ maximumPoolSize çš„å…·ä½“å«ä¹‰ï¼ŒcorePoolSize æŒ‡çš„æ˜¯æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œçº¿ç¨‹æ± åˆå§‹åŒ–æ—¶çº¿ç¨‹æ•°é»˜è®¤ä¸º 0ï¼Œå½“æœ‰æ–°çš„ä»»åŠ¡æäº¤åï¼Œä¼šåˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœä¸åšç‰¹æ®Šè®¾ç½®ï¼Œæ­¤åçº¿ç¨‹æ•°é€šå¸¸ä¸ä¼šå†å°äº corePoolSize ï¼Œå› ä¸ºå®ƒä»¬æ˜¯æ ¸å¿ƒçº¿ç¨‹ï¼Œå³ä¾¿æœªæ¥å¯èƒ½æ²¡æœ‰å¯æ‰§è¡Œçš„ä»»åŠ¡ä¹Ÿä¸ä¼šè¢«é”€æ¯ã€‚éšç€ä»»åŠ¡é‡çš„å¢åŠ ï¼Œåœ¨ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ä¹‹åï¼Œçº¿ç¨‹æ± ä¼šè¿›ä¸€æ­¥åˆ›å»ºæ–°çº¿ç¨‹ï¼Œæœ€å¤šå¯ä»¥è¾¾åˆ° maximumPoolSize æ¥åº”å¯¹ä»»åŠ¡å¤šçš„åœºæ™¯ï¼Œå¦‚æœæœªæ¥çº¿ç¨‹æœ‰ç©ºé—²ï¼Œå¤§äº corePoolSize çš„çº¿ç¨‹ä¼šè¢«åˆç†å›æ”¶ã€‚æ‰€ä»¥æ­£å¸¸æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ä¼šå¤„åœ¨ corePoolSize ä¸ maximumPoolSize çš„é—­åŒºé—´å†…ã€‚</p>
<h4 id="å°ç»“ï¼š"><a href="#å°ç»“ï¼š" class="headerlink" title="å°ç»“ï¼š"></a>å°ç»“ï¼š</h4><ul>
<li>çº¿ç¨‹æ± å¸Œæœ›ä¿æŒè¾ƒå°‘çš„çº¿ç¨‹æ•°ï¼Œå¹¶ä¸”åªæœ‰åœ¨è´Ÿè½½å˜å¾—å¾ˆå¤§æ—¶æ‰å¢åŠ çº¿ç¨‹ã€‚</li>
<li>çº¿ç¨‹æ± åªæœ‰åœ¨ä»»åŠ¡é˜Ÿåˆ—å¡«æ»¡æ—¶æ‰åˆ›å»ºå¤šäº corePoolSize çš„çº¿ç¨‹ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯æ— ç•Œé˜Ÿåˆ—ï¼ˆä¾‹å¦‚ LinkedBlockingQueueï¼‰ï¼Œé‚£ä¹ˆç”±äºé˜Ÿåˆ—ä¸ä¼šæ»¡ï¼Œæ‰€ä»¥çº¿ç¨‹æ•°ä¸ä¼šè¶…è¿‡ corePoolSizeã€‚</li>
<li>é€šè¿‡è®¾ç½® corePoolSize å’Œ maximumPoolSize ä¸ºç›¸åŒçš„å€¼ï¼Œå°±å¯ä»¥åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚</li>
<li>é€šè¿‡è®¾ç½® maximumPoolSize ä¸ºå¾ˆé«˜çš„å€¼ï¼Œä¾‹å¦‚ Integer.MAX_VALUEï¼Œå°±å¯ä»¥å…è®¸çº¿ç¨‹æ± åˆ›å»ºä»»æ„å¤šçš„çº¿ç¨‹ã€‚</li>
</ul>
<h4 id="3-9-2-keepAliveTime-æ—¶é—´å•ä½"><a href="#3-9-2-keepAliveTime-æ—¶é—´å•ä½" class="headerlink" title="3.9.2.keepAliveTime+æ—¶é—´å•ä½"></a>3.9.2.keepAliveTime+æ—¶é—´å•ä½</h4><p>â€”-åœ¨ç©ºé—²æœŸé”€æ¯è¿‡å¤š(è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°)çš„çº¿ç¨‹</p>
<p>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ keepAliveTime + æ—¶é—´å•ä½ï¼Œ<u>å½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡å¤šäºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œè€Œæ­¤æ—¶åˆæ²¡æœ‰ä»»åŠ¡å¯åšï¼Œçº¿ç¨‹æ± å°±ä¼šæ£€æµ‹çº¿ç¨‹çš„ keepAliveTimeï¼Œå¦‚æœè¶…è¿‡è§„å®šçš„æ—¶é—´ï¼Œæ— äº‹å¯åšçš„çº¿ç¨‹å°±ä¼šè¢«é”€æ¯ï¼Œä»¥ä¾¿å‡å°‘å†…å­˜çš„å ç”¨å’Œèµ„æºæ¶ˆè€—ã€‚</u>å¦‚æœåæœŸä»»åŠ¡åˆå¤šäº†èµ·æ¥ï¼Œçº¿ç¨‹æ± ä¹Ÿä¼šæ ¹æ®è§„åˆ™é‡æ–°åˆ›å»ºçº¿ç¨‹ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©çš„è¿‡ç¨‹ï¼Œæ¯”è¾ƒçµæ´»ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ setKeepAliveTime æ–¹æ³•åŠ¨æ€æ”¹å˜ keepAliveTime çš„å‚æ•°å€¼ã€‚</p>
<h4 id="3-9-3-ThreadFactory"><a href="#3-9-3-ThreadFactory" class="headerlink" title="3.9.3.ThreadFactory"></a>3.9.3.ThreadFactory</h4><p>ç¬¬å››ä¸ªå‚æ•°æ˜¯ ThreadFactoryï¼ŒThreadFactory å®é™…ä¸Šæ˜¯ä¸€ä¸ªçº¿ç¨‹å·¥å‚ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç”Ÿäº§çº¿ç¨‹ä»¥ä¾¿æ‰§è¡Œä»»åŠ¡ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨é»˜è®¤çš„çº¿ç¨‹å·¥å‚ï¼Œåˆ›å»ºçš„çº¿ç¨‹éƒ½ä¼šåœ¨åŒä¸€ä¸ªçº¿ç¨‹ç»„ï¼Œå¹¶æ‹¥æœ‰ä¸€æ ·çš„ä¼˜å…ˆçº§ï¼Œä¸”éƒ½ä¸æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©è‡ªå·±å®šåˆ¶çº¿ç¨‹å·¥å‚ï¼Œä»¥æ–¹ä¾¿ç»™çº¿ç¨‹è‡ªå®šä¹‰å‘½åï¼Œä¸åŒçš„çº¿ç¨‹æ± å†…çš„çº¿ç¨‹é€šå¸¸ä¼šæ ¹æ®å…·ä½“ä¸šåŠ¡æ¥å®šåˆ¶ä¸åŒçš„çº¿ç¨‹åã€‚</p>
<h4 id="3-9-4-workQueue-å’Œ-Handler"><a href="#3-9-4-workQueue-å’Œ-Handler" class="headerlink" title="3.9.4.workQueue å’Œ Handler"></a>3.9.4.workQueue å’Œ Handler</h4><p>æœ€åä¸¤ä¸ªå‚æ•°æ˜¯ workQueue å’Œ Handlerï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”é˜»å¡é˜Ÿåˆ—å’Œä»»åŠ¡æ‹’ç»ç­–ç•¥ï¼Œåœ¨åé¢çš„è¯¾æ—¶ä¼šå¯¹å®ƒä»¬è¿›è¡Œè¯¦ç»†å±•å¼€è®²è§£ã€‚</p>
<h3 id="3-10-çº¿ç¨‹æ± æœ‰å“ª-4-ç§æ‹’ç»ç­–ç•¥ï¼Ÿ"><a href="#3-10-çº¿ç¨‹æ± æœ‰å“ª-4-ç§æ‹’ç»ç­–ç•¥ï¼Ÿ" class="headerlink" title="3.10.çº¿ç¨‹æ± æœ‰å“ª 4 ç§æ‹’ç»ç­–ç•¥ï¼Ÿ"></a>3.10.çº¿ç¨‹æ± æœ‰å“ª 4 ç§æ‹’ç»ç­–ç•¥ï¼Ÿ</h3><h4 id="3-10-1-çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„æ—¶æœºï¼š"><a href="#3-10-1-çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„æ—¶æœºï¼š" class="headerlink" title="3.10.1.çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„æ—¶æœºï¼š"></a>3.10.1.çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„æ—¶æœºï¼š</h4><p>æ–°å»ºçº¿ç¨‹æ± æ—¶å¯ä»¥æŒ‡å®šå®ƒçš„ä»»åŠ¡æ‹’ç»ç­–ç•¥ï¼Œä»¥ä¾¿åœ¨å¿…è¦çš„æ—¶å€™æŒ‰ç…§æˆ‘ä»¬çš„ç­–ç•¥æ¥æ‹’ç»ä»»åŠ¡ï¼Œé‚£ä¹ˆæ‹’ç»ä»»åŠ¡çš„æ—¶æœºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿçº¿ç¨‹æ± ä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹ä¼š**<u>æ‹’ç»æ–°æäº¤çš„ä»»åŠ¡ã€‚</u>**</p>
<ul>
<li>ç¬¬ä¸€ç§æƒ…å†µæ˜¯å½“æˆ‘ä»¬<u>è°ƒç”¨ shutdown ç­‰æ–¹æ³•å…³é—­çº¿ç¨‹æ± å</u>ï¼Œå³ä¾¿æ­¤æ—¶å¯èƒ½çº¿ç¨‹æ± å†…éƒ¨ä¾ç„¶æœ‰æ²¡æ‰§è¡Œå®Œçš„ä»»åŠ¡æ­£åœ¨æ‰§è¡Œï¼Œä½†æ˜¯ç”±äºçº¿ç¨‹æ± å·²ç»å…³é—­ï¼Œæ­¤æ—¶å¦‚æœå†å‘çº¿ç¨‹æ± å†…æäº¤ä»»åŠ¡ï¼Œå°±ä¼šé­åˆ°æ‹’ç»ã€‚</li>
<li>ç¬¬äºŒç§æƒ…å†µæ˜¯çº¿ç¨‹æ± æ²¡æœ‰èƒ½åŠ›ç»§ç»­å¤„ç†æ–°æäº¤çš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯<u>å·¥ä½œå·²ç»éå¸¸é¥±å’Œçš„æ—¶å€™</u>ã€‚</li>
</ul>
<h4 id="3-10-2-çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„ç­–ç•¥ï¼š"><a href="#3-10-2-çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„ç­–ç•¥ï¼š" class="headerlink" title="3.10.2.çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„ç­–ç•¥ï¼š"></a>3.10.2.çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„ç­–ç•¥ï¼š</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230804154232936.png" alt="image-20230804154232936"></p>
<ul>
<li>ç¬¬ä¸€ç§æ‹’ç»ç­–ç•¥æ˜¯ AbortPolicyï¼Œè¿™ç§æ‹’ç»ç­–ç•¥åœ¨æ‹’ç»ä»»åŠ¡æ—¶ï¼Œä¼šç›´æ¥<u><strong>æŠ›å‡ºä¸€ä¸ªç±»å‹ä¸º RejectedExecutionException çš„ RuntimeExceptionï¼Œè®©ä½ æ„ŸçŸ¥åˆ°ä»»åŠ¡è¢«æ‹’ç»äº†ï¼Œäºæ˜¯ä½ ä¾¿å¯ä»¥æ ¹æ®ä¸šåŠ¡é€»è¾‘é€‰æ‹©é‡è¯•æˆ–è€…æ”¾å¼ƒæäº¤ç­‰ç­–ç•¥ã€‚</strong></u></li>
<li>ç¬¬äºŒç§æ‹’ç»ç­–ç•¥æ˜¯ DiscardPolicyï¼Œè¿™ç§æ‹’ç»ç­–ç•¥æ­£å¦‚å®ƒçš„åå­—æ‰€æè¿°çš„ä¸€æ ·ï¼Œ<u><strong>å½“æ–°ä»»åŠ¡è¢«æäº¤åç›´æ¥è¢«ä¸¢å¼ƒæ‰ï¼Œä¹Ÿä¸ä¼šç»™ä½ ä»»ä½•çš„é€šçŸ¥ï¼Œç›¸å¯¹è€Œè¨€å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œå› ä¸ºæˆ‘ä»¬æäº¤çš„æ—¶å€™æ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªä»»åŠ¡ä¼šè¢«ä¸¢å¼ƒï¼Œå¯èƒ½é€ æˆæ•°æ®ä¸¢å¤±</strong></u>ã€‚</li>
<li>ç¬¬ä¸‰ç§æ‹’ç»ç­–ç•¥æ˜¯ DiscardOldestPolicyï¼Œå¦‚æœçº¿ç¨‹æ± æ²¡è¢«å…³é—­ä¸”æ²¡æœ‰èƒ½åŠ›æ‰§è¡Œï¼Œåˆ™ä¼š<u><strong>ä¸¢å¼ƒä»»åŠ¡é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹ï¼Œé€šå¸¸æ˜¯å­˜æ´»æ—¶é—´æœ€é•¿çš„ä»»åŠ¡</strong></u>ï¼Œè¿™ç§ç­–ç•¥ä¸ç¬¬äºŒç§ä¸åŒä¹‹å¤„åœ¨äºå®ƒä¸¢å¼ƒçš„ä¸æ˜¯æœ€æ–°æäº¤çš„ï¼Œè€Œæ˜¯é˜Ÿåˆ—ä¸­å­˜æ´»æ—¶é—´æœ€é•¿çš„ï¼Œè¿™æ ·å°±å¯ä»¥è…¾å‡ºç©ºé—´ç»™æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†åŒç†å®ƒä¹Ÿå­˜åœ¨ä¸€å®šçš„æ•°æ®ä¸¢å¤±é£é™©ã€‚</li>
<li>ç¬¬å››ç§æ‹’ç»ç­–ç•¥æ˜¯ CallerRunsPolicyï¼Œç›¸å¯¹è€Œè¨€å®ƒå°±æ¯”è¾ƒå®Œå–„äº†ï¼Œå½“æœ‰æ–°ä»»åŠ¡æäº¤åï¼Œå¦‚æœçº¿ç¨‹æ± æ²¡è¢«å…³é—­ä¸”æ²¡æœ‰èƒ½åŠ›æ‰§è¡Œï¼Œåˆ™<u><strong>æŠŠè¿™ä¸ªä»»åŠ¡äº¤äºæäº¤ä»»åŠ¡çš„çº¿ç¨‹æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è°æäº¤ä»»åŠ¡ï¼Œè°å°±è´Ÿè´£æ‰§è¡Œä»»åŠ¡</strong></u>ã€‚è¿™æ ·åšä¸»è¦æœ‰ä¸¤ç‚¹å¥½å¤„ã€‚<ul>
<li>ç¬¬ä¸€ç‚¹æ–°æäº¤çš„ä»»åŠ¡ä¸ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™æ ·ä¹Ÿå°±ä¸ä¼šé€ æˆä¸šåŠ¡æŸå¤±ã€‚</li>
<li>ç¬¬äºŒç‚¹å¥½å¤„æ˜¯ï¼Œç”±äºè°æäº¤ä»»åŠ¡è°å°±è¦è´Ÿè´£æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ ·æäº¤ä»»åŠ¡çš„çº¿ç¨‹å°±å¾—è´Ÿè´£æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ‰§è¡Œä»»åŠ¡åˆæ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œåœ¨è¿™æ®µæœŸé—´ï¼Œæäº¤ä»»åŠ¡çš„çº¿ç¨‹è¢«å ç”¨ï¼Œä¹Ÿå°±ä¸ä¼šå†æäº¤æ–°çš„ä»»åŠ¡ï¼Œå‡ç¼“äº†ä»»åŠ¡æäº¤çš„é€Ÿåº¦ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªè´Ÿåé¦ˆã€‚åœ¨æ­¤æœŸé—´ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¹Ÿå¯ä»¥å……åˆ†åˆ©ç”¨è¿™æ®µæ—¶é—´æ¥æ‰§è¡Œæ‰ä¸€éƒ¨åˆ†ä»»åŠ¡ï¼Œè…¾å‡ºä¸€å®šçš„ç©ºé—´ï¼Œç›¸å½“äºæ˜¯ç»™äº†çº¿ç¨‹æ± ä¸€å®šçš„ç¼“å†²æœŸã€‚</li>
</ul>
</li>
</ul>
<h3 id="3-11-æœ‰å“ª-6-ç§å¸¸è§çš„çº¿ç¨‹æ± ï¼Ÿä»€ä¹ˆæ˜¯-Java8-çš„-ForkJoinPoolï¼Ÿ"><a href="#3-11-æœ‰å“ª-6-ç§å¸¸è§çš„çº¿ç¨‹æ± ï¼Ÿä»€ä¹ˆæ˜¯-Java8-çš„-ForkJoinPoolï¼Ÿ" class="headerlink" title="3.11.æœ‰å“ª 6 ç§å¸¸è§çš„çº¿ç¨‹æ± ï¼Ÿä»€ä¹ˆæ˜¯ Java8 çš„ ForkJoinPoolï¼Ÿ"></a>3.11.æœ‰å“ª 6 ç§å¸¸è§çš„çº¿ç¨‹æ± ï¼Ÿä»€ä¹ˆæ˜¯ Java8 çš„ ForkJoinPoolï¼Ÿ</h3><h4 id="3-11-1-FixedThreadPool"><a href="#3-11-1-FixedThreadPool" class="headerlink" title="3.11.1.FixedThreadPool"></a>3.11.1.FixedThreadPool</h4><p>â€‹		å®ƒçš„æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ç›¸åŒï¼</p>
<h4 id="3-11-2-CachedThreadPool"><a href="#3-11-2-CachedThreadPool" class="headerlink" title="3.11.2.CachedThreadPool"></a>3.11.2.CachedThreadPool</h4><p>â€‹		å¯ä»¥ç§°ä½œå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå®ƒçš„ç‰¹ç‚¹åœ¨äº<u>çº¿ç¨‹æ•°æ˜¯å‡ ä¹å¯ä»¥æ— é™å¢åŠ çš„</u>ï¼ˆå®é™…æœ€å¤§å¯ä»¥è¾¾åˆ° Integer.MAX_VALUEï¼Œä¸º 2^31-1ï¼Œè¿™ä¸ªæ•°éå¸¸å¤§ï¼Œæ‰€ä»¥åŸºæœ¬ä¸å¯èƒ½è¾¾åˆ°ï¼‰ï¼Œ<u><strong>è€Œå½“çº¿ç¨‹é—²ç½®æ—¶è¿˜å¯ä»¥å¯¹çº¿ç¨‹è¿›è¡Œå›æ”¶ã€‚</strong></u>ä¹Ÿå°±æ˜¯è¯´è¯¥çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œå½“ç„¶å®ƒä¹Ÿæœ‰ä¸€ä¸ªç”¨äºå­˜å‚¨æäº¤ä»»åŠ¡çš„é˜Ÿåˆ—ï¼Œä½†è¿™ä¸ªé˜Ÿåˆ—æ˜¯ SynchronousQueueï¼Œé˜Ÿåˆ—çš„å®¹é‡ä¸º0ï¼Œå®é™…ä¸å­˜å‚¨ä»»ä½•ä»»åŠ¡ï¼Œå®ƒåªè´Ÿè´£å¯¹ä»»åŠ¡è¿›è¡Œä¸­è½¬å’Œä¼ é€’ï¼Œæ‰€ä»¥æ•ˆç‡æ¯”è¾ƒé«˜ã€‚</p>
<h4 id="3-11-3-ScheduledThreadPool"><a href="#3-11-3-ScheduledThreadPool" class="headerlink" title="3.11.3.ScheduledThreadPool"></a>3.11.3.ScheduledThreadPool</h4><p>â€‹		å®ƒæ”¯æŒå®šæ—¶æˆ–å‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡ã€‚æ¯”å¦‚æ¯éš” 10 ç§’é’Ÿæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</p>
<h4 id="3-11-4-SingleThreadExecutor"><a href="#3-11-4-SingleThreadExecutor" class="headerlink" title="3.11.4.SingleThreadExecutor"></a>3.11.4.SingleThreadExecutor</h4><p>â€‹		å®ƒä¼šä½¿ç”¨å”¯ä¸€çš„çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼ŒåŸç†å’Œ FixedThreadPool æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è¿™é‡Œçº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œå¦‚æœçº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡çš„è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œçº¿ç¨‹æ± ä¹Ÿä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œåç»­çš„ä»»åŠ¡ã€‚è¿™ç§çº¿ç¨‹æ± ç”±äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥éå¸¸é€‚åˆç”¨äºæ‰€æœ‰ä»»åŠ¡éƒ½éœ€è¦æŒ‰è¢«æäº¤çš„é¡ºåºä¾æ¬¡æ‰§è¡Œçš„åœºæ™¯ï¼Œè€Œå‰å‡ ç§çº¿ç¨‹æ± ä¸ä¸€å®šèƒ½å¤Ÿä¿éšœä»»åŠ¡çš„æ‰§è¡Œé¡ºåºç­‰äºè¢«æäº¤çš„é¡ºåºï¼Œå› ä¸ºå®ƒä»¬æ˜¯å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œçš„ã€‚</p>
<h4 id="3-11-5-SingleThreadScheduledExecutor"><a href="#3-11-5-SingleThreadScheduledExecutor" class="headerlink" title="3.11.5.SingleThreadScheduledExecutor"></a>3.11.5.SingleThreadScheduledExecutor</h4><p>â€‹		å®ƒåªæ˜¯å°† <u>ScheduledThreadPool</u> çš„æ ¸å¿ƒçº¿ç¨‹æ•°è®¾ç½®ä¸ºäº† 1ã€‚</p>
<h4 id="3-11-6-ForkJoinPool"><a href="#3-11-6-ForkJoinPool" class="headerlink" title="3.11.6.ForkJoinPool"></a>3.11.6.ForkJoinPool</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230804160403936.png" alt="image-20230804160403936" style="zoom: 33%;" />

<p>ç”¨ä¸€å¼ å…¨æ™¯å›¾æ¥æè¿° ForkJoinPool çº¿ç¨‹æ± çš„å†…éƒ¨ç»“æ„ï¼Œä½ å¯ä»¥çœ‹åˆ° ForkJoinPool çº¿ç¨‹æ± å’Œå…¶ä»–çº¿ç¨‹æ± å¾ˆå¤šåœ°æ–¹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†é‡ç‚¹åŒºåˆ«åœ¨äºå®ƒæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„åŒç«¯é˜Ÿåˆ—æ¥å­˜å‚¨åˆ†è£‚å‡ºæ¥çš„å­ä»»åŠ¡ã€‚ForkJoinPool éå¸¸é€‚åˆç”¨äºé€’å½’çš„åœºæ™¯ï¼Œä¾‹å¦‚æ ‘çš„éå†ã€æœ€ä¼˜è·¯å¾„æœç´¢ç­‰åœºæ™¯ã€‚</p>
<h3 id="3-12-çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æœ‰å“ªäº›ï¼Ÿ"><a href="#3-12-çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="3.12.çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æœ‰å“ªäº›ï¼Ÿ"></a>3.12.çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æœ‰å“ªäº›ï¼Ÿ</h3><p>çº¿ç¨‹æ± çš„å†…éƒ¨ç»“æ„ä¸»è¦ç”±å››éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>ç¬¬ä¸€éƒ¨åˆ†æ˜¯<strong>çº¿ç¨‹æ± ç®¡ç†å™¨</strong>ï¼Œå®ƒä¸»è¦è´Ÿè´£ç®¡ç†çº¿ç¨‹æ± çš„åˆ›å»ºã€é”€æ¯ã€æ·»åŠ ä»»åŠ¡ç­‰ç®¡ç†æ“ä½œï¼Œå®ƒæ˜¯æ•´ä¸ªçº¿ç¨‹æ± çš„ç®¡å®¶ã€‚</li>
<li>ç¬¬äºŒéƒ¨åˆ†æ˜¯<strong>å·¥ä½œçº¿ç¨‹</strong>ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„çº¿ç¨‹ t0~t9ï¼Œè¿™äº›çº¿ç¨‹å‹¤å‹¤æ³æ³åœ°ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡å¹¶æ‰§è¡Œã€‚</li>
<li>ç¬¬ä¸‰éƒ¨åˆ†æ˜¯<strong>ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼Œä½œä¸ºä¸€ç§ç¼“å†²æœºåˆ¶ï¼Œçº¿ç¨‹æ± ä¼šæŠŠå½“ä¸‹æ²¡æœ‰å¤„ç†çš„ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç”±äºå¤šçº¿ç¨‹åŒæ—¶ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡æ˜¯å¹¶å‘åœºæ™¯ï¼Œæ­¤æ—¶å°±éœ€è¦ä»»åŠ¡é˜Ÿåˆ—æ»¡è¶³çº¿ç¨‹å®‰å…¨çš„è¦æ±‚ï¼Œæ‰€ä»¥çº¿ç¨‹æ± ä¸­ä»»åŠ¡é˜Ÿåˆ—é‡‡ç”¨ BlockingQueue æ¥ä¿éšœçº¿ç¨‹å®‰å…¨ã€‚</li>
<li>ç¬¬å››éƒ¨åˆ†æ˜¯<strong>ä»»åŠ¡</strong>ï¼Œä»»åŠ¡è¦æ±‚å®ç°ç»Ÿä¸€çš„æ¥å£ï¼Œä»¥ä¾¿å·¥ä½œçº¿ç¨‹å¯ä»¥å¤„ç†å’Œæ‰§è¡Œã€‚</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230804161223490.png" alt="image-20230804161223490"></p>
<h4 id="3-12-1-LinkedBlockingQueue"><a href="#3-12-1-LinkedBlockingQueue" class="headerlink" title="3.12.1.LinkedBlockingQueue"></a>3.12.1.LinkedBlockingQueue</h4><p>â€“å¯¹åº”çš„çº¿ç¨‹æ± å¤§å°å›ºå®šï¼Œéœ€è¦æ— é™çš„é˜Ÿåˆ—</p>
<p>å¯¹äº FixedThreadPool å’Œ SingleThreadExector è€Œè¨€ï¼Œå®ƒä»¬ä½¿ç”¨çš„é˜»å¡é˜Ÿåˆ—æ˜¯å®¹é‡ä¸º Integer.MAX_VALUE çš„ LinkedBlockingQueueï¼Œå¯ä»¥è®¤ä¸ºæ˜¯<u>æ— ç•Œé˜Ÿåˆ—</u>ã€‚ç”±äº FixedThreadPool çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•å¢åŠ ç‰¹åˆ«å¤šçš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œè¿™æ—¶å°±éœ€è¦ <u><strong>LinkedBlockingQueue è¿™æ ·ä¸€ä¸ªæ²¡æœ‰å®¹é‡é™åˆ¶çš„é˜»å¡é˜Ÿåˆ—æ¥å­˜æ”¾ä»»åŠ¡</strong></u>ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œç”±äºçº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—æ°¸è¿œä¸ä¼šæ”¾æ»¡ï¼Œæ‰€ä»¥çº¿ç¨‹æ± åªä¼šåˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹ï¼Œæ‰€ä»¥æ­¤æ—¶çš„æœ€å¤§çº¿ç¨‹æ•°å¯¹çº¿ç¨‹æ± æ¥è¯´æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºå¹¶ä¸ä¼šè§¦å‘ç”Ÿæˆå¤šäºæ ¸å¿ƒçº¿ç¨‹æ•°çš„çº¿ç¨‹ã€‚</p>
<h4 id="3-12-2-SynchronousQueue"><a href="#3-12-2-SynchronousQueue" class="headerlink" title="3.12.2.SynchronousQueue"></a>3.12.2.SynchronousQueue</h4><p>â€“å¯¹åº”çš„çº¿ç¨‹æ± å¤§å°æ— é™ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦èƒ½å­˜æ”¾ä»»åŠ¡çš„é˜Ÿåˆ—(<strong>SynchronousQueue æœ¬èº«å¹¶ä¸å­˜å‚¨ä»»åŠ¡ï¼Œè€Œæ˜¯å¯¹ä»»åŠ¡ç›´æ¥è¿›è¡Œè½¬å‘</strong>)</p>
<p>ç¬¬äºŒç§é˜»å¡é˜Ÿåˆ—æ˜¯ SynchronousQueueï¼Œå¯¹åº”çš„çº¿ç¨‹æ± æ˜¯ CachedThreadPoolã€‚çº¿ç¨‹æ±  CachedThreadPool çš„æœ€å¤§çº¿ç¨‹æ•°æ˜¯ Integer çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ç†è§£ä¸ºçº¿ç¨‹æ•°æ˜¯å¯ä»¥æ— é™æ‰©å±•çš„ã€‚CachedThreadPool å’Œä¸Šä¸€ç§çº¿ç¨‹æ±  FixedThreadPool çš„æƒ…å†µæ°æ°ç›¸åï¼Œ<strong>FixedThreadPool çš„æƒ…å†µæ˜¯é˜»å¡é˜Ÿåˆ—çš„å®¹é‡æ˜¯æ— é™çš„</strong>ï¼Œ<u><strong>è€Œè¿™é‡Œ CachedThreadPool æ˜¯çº¿ç¨‹æ•°å¯ä»¥æ— é™æ‰©å±•</strong></u>ï¼Œæ‰€ä»¥ CachedThreadPool çº¿ç¨‹æ± å¹¶ä¸éœ€è¦ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—æ¥å­˜å‚¨ä»»åŠ¡ï¼Œå› ä¸ºä¸€æ—¦æœ‰ä»»åŠ¡è¢«æäº¤å°±ç›´æ¥è½¬å‘ç»™çº¿ç¨‹æˆ–è€…åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œï¼Œè€Œä¸éœ€è¦å¦å¤–ä¿å­˜å®ƒä»¬ã€‚</p>
<p>æˆ‘ä»¬è‡ªå·±åˆ›å»ºä½¿ç”¨ SynchronousQueue çš„çº¿ç¨‹æ± æ—¶ï¼Œå¦‚æœä¸å¸Œæœ›ä»»åŠ¡è¢«æ‹’ç»ï¼Œé‚£ä¹ˆå°±éœ€è¦æ³¨æ„è®¾ç½®æœ€å¤§çº¿ç¨‹æ•°è¦å°½å¯èƒ½å¤§ä¸€äº›ï¼Œä»¥å…å‘ç”Ÿä»»åŠ¡æ•°å¤§äºæœ€å¤§çº¿ç¨‹æ•°æ—¶ï¼Œæ²¡åŠæ³•æŠŠä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—ä¸­ä¹Ÿæ²¡æœ‰è¶³å¤Ÿçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡çš„æƒ…å†µã€‚</p>
<h4 id="3-12-3-DelayedWorkQueue"><a href="#3-12-3-DelayedWorkQueue" class="headerlink" title="3.12.3.DelayedWorkQueue"></a>3.12.3.DelayedWorkQueue</h4><p>ç¬¬ä¸‰ç§é˜»å¡é˜Ÿåˆ—æ˜¯DelayedWorkQueueï¼Œå®ƒå¯¹åº”çš„çº¿ç¨‹æ± åˆ†åˆ«æ˜¯ ScheduledThreadPool å’Œ SingleThreadScheduledExecutorï¼Œè¿™ä¸¤ç§<u>çº¿ç¨‹æ± çš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯å¯ä»¥å»¶è¿Ÿæ‰§è¡Œä»»åŠ¡</u>ï¼Œæ¯”å¦‚è¯´ä¸€å®šæ—¶é—´åæ‰§è¡Œä»»åŠ¡æˆ–æ˜¯æ¯éš”ä¸€å®šçš„æ—¶é—´æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ã€‚<u><strong>DelayedWorkQueue çš„ç‰¹ç‚¹æ˜¯å†…éƒ¨å…ƒç´ å¹¶ä¸æ˜¯æŒ‰ç…§æ”¾å…¥çš„æ—¶é—´æ’åºï¼Œè€Œæ˜¯ä¼šæŒ‰ç…§å»¶è¿Ÿçš„æ—¶é—´é•¿çŸ­å¯¹ä»»åŠ¡è¿›è¡Œæ’åºï¼Œå†…éƒ¨é‡‡ç”¨çš„æ˜¯â€œå †â€çš„æ•°æ®ç»“æ„ã€‚</strong></u>ä¹‹æ‰€ä»¥çº¿ç¨‹æ±  ScheduledThreadPool å’Œ SingleThreadScheduledExecutor é€‰æ‹© DelayedWorkQueueï¼Œæ˜¯å› ä¸ºå®ƒä»¬æœ¬èº«æ­£æ˜¯åŸºäºæ—¶é—´æ‰§è¡Œä»»åŠ¡çš„ï¼Œ<u>è€Œå»¶è¿Ÿé˜Ÿåˆ—æ­£å¥½å¯ä»¥æŠŠä»»åŠ¡æŒ‰æ—¶é—´è¿›è¡Œæ’åºï¼Œæ–¹ä¾¿ä»»åŠ¡çš„æ‰§è¡Œã€‚</u></p>
<h3 id="3-13-ä¸ºä»€ä¹ˆä¸åº”è¯¥è‡ªåŠ¨åˆ›å»ºçº¿ç¨‹æ± ï¼Ÿ"><a href="#3-13-ä¸ºä»€ä¹ˆä¸åº”è¯¥è‡ªåŠ¨åˆ›å»ºçº¿ç¨‹æ± ï¼Ÿ" class="headerlink" title="3.13.ä¸ºä»€ä¹ˆä¸åº”è¯¥è‡ªåŠ¨åˆ›å»ºçº¿ç¨‹æ± ï¼Ÿ"></a>3.13.ä¸ºä»€ä¹ˆä¸åº”è¯¥è‡ªåŠ¨åˆ›å»ºçº¿ç¨‹æ± ï¼Ÿ</h3><p>å› ä¸ºä¸Šè¿°çš„çº¿ç¨‹æ± ä¸­ï¼Œ<u>è¦ä¹ˆçº¿ç¨‹æ²¡æœ‰çº¦æŸï¼Œå¯ä»¥æ— é™å¤šï¼›è¦ä¹ˆé˜Ÿåˆ—æ²¡æœ‰çº¦æŸï¼Œå¯ä»¥æ— é™å¤§ï¼›</u></p>
<p>å½“é¢å¯¹éš¾äºå¤„ç†çš„å¤§é‡ä»»åŠ¡æ—¶ï¼š</p>
<ul>
<li><p>è¦ä¹ˆ<u>çº¿ç¨‹åˆ›å»ºå¾—å¤ªå¤š</u>ï¼Œå¯¼è‡´æœ€ç»ˆè¶…è¿‡äº†æ“ä½œç³»ç»Ÿçš„ä¸Šé™è€Œæ— æ³•åˆ›å»ºæ–°çº¿ç¨‹ï¼Œæˆ–è€…å¯¼è‡´å†…å­˜ä¸è¶³ã€‚</p>
</li>
<li><p>è¦ä¹ˆ<u>é˜Ÿåˆ—ä¸­å †ç§¯çš„ä»»åŠ¡å¤ªå¤š</u>ï¼Œæœ€ç»ˆå¤§é‡å †ç§¯çš„ä»»åŠ¡ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œå¹¶å‘ç”Ÿ OOM ï¼Œä¹Ÿå°±æ˜¯OutOfMemoryErrorï¼Œè¿™å‡ ä¹ä¼šå½±å“åˆ°æ•´ä¸ªç¨‹åºï¼Œä¼šé€ æˆå¾ˆä¸¥é‡çš„åæœã€‚</p>
</li>
</ul>
<h3 id="3-14åˆé€‚çš„çº¿ç¨‹æ•°é‡æ˜¯å¤šå°‘ï¼ŸCPU-æ ¸å¿ƒæ•°å’Œçº¿ç¨‹æ•°çš„å…³ç³»ï¼Ÿ"><a href="#3-14åˆé€‚çš„çº¿ç¨‹æ•°é‡æ˜¯å¤šå°‘ï¼ŸCPU-æ ¸å¿ƒæ•°å’Œçº¿ç¨‹æ•°çš„å…³ç³»ï¼Ÿ" class="headerlink" title="3.14åˆé€‚çš„çº¿ç¨‹æ•°é‡æ˜¯å¤šå°‘ï¼ŸCPU æ ¸å¿ƒæ•°å’Œçº¿ç¨‹æ•°çš„å…³ç³»ï¼Ÿ"></a>3.14åˆé€‚çš„çº¿ç¨‹æ•°é‡æ˜¯å¤šå°‘ï¼ŸCPU æ ¸å¿ƒæ•°å’Œçº¿ç¨‹æ•°çš„å…³ç³»ï¼Ÿ</h3><p>æˆ‘ä»¬è°ƒæ•´çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡çš„æœ€ä¸»è¦çš„ç›®çš„æ˜¯ä¸ºäº†<u>å……åˆ†å¹¶åˆç†åœ°ä½¿ç”¨ CPU å’Œå†…å­˜ç­‰èµ„æº</u>ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°æé«˜ç¨‹åºçš„æ€§èƒ½</p>
<h4 id="CPU-å¯†é›†å‹ä»»åŠ¡"><a href="#CPU-å¯†é›†å‹ä»»åŠ¡" class="headerlink" title="CPU å¯†é›†å‹ä»»åŠ¡"></a>CPU å¯†é›†å‹ä»»åŠ¡</h4><p><em><u>â€”ä¸èƒ½æ¥å¤ªå¤šï¼Œå› ä¸ºè¿™äº›ä»»åŠ¡ä¸€æ—¦æ‰§è¡Œï¼Œé‚£ä¹ˆä¼šä¸€ç›´ä½¿ç”¨CPUï¼Œä»»åŠ¡å¤šäº†çš„è¯CPUå¾ˆå¿«å°±ä¸å¤Ÿç”¨äº†ã€‚</u></em></p>
<p>â€‹	é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ CPU å¯†é›†å‹ä»»åŠ¡ï¼Œæ¯”å¦‚åŠ å¯†ã€è§£å¯†ã€å‹ç¼©ã€è®¡ç®—ç­‰ä¸€ç³»åˆ—éœ€è¦å¤§é‡è€—è´¹ CPU èµ„æºçš„ä»»åŠ¡ã€‚</p>
<p>â€‹	å¯¹äºè¿™æ ·çš„ä»»åŠ¡<u>æœ€ä½³çš„çº¿ç¨‹æ•°ä¸º CPU æ ¸å¿ƒæ•°çš„ 1~2 å€</u>ï¼Œå¦‚æœè®¾ç½®è¿‡å¤šçš„çº¿ç¨‹æ•°ï¼Œå®é™…ä¸Šå¹¶ä¸ä¼šèµ·åˆ°å¾ˆå¥½çš„æ•ˆæœã€‚æ­¤æ—¶å‡è®¾æˆ‘ä»¬è®¾ç½®çš„çº¿ç¨‹æ•°é‡æ˜¯ CPU æ ¸å¿ƒæ•°çš„ 2 å€ä»¥ä¸Šï¼Œå› **<u>ä¸ºè®¡ç®—ä»»åŠ¡éå¸¸é‡ï¼Œä¼šå ç”¨å¤§é‡çš„ CPU èµ„æºï¼Œæ‰€ä»¥è¿™æ—¶ CPU çš„æ¯ä¸ªæ ¸å¿ƒå·¥ä½œåŸºæœ¬éƒ½æ˜¯æ»¡è´Ÿè·çš„ï¼Œè€Œæˆ‘ä»¬åˆè®¾ç½®äº†è¿‡å¤šçš„çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æƒ³å»åˆ©ç”¨ CPU èµ„æºæ¥æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡ï¼Œè¿™å°±ä¼šé€ æˆä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ­¤æ—¶çº¿ç¨‹æ•°çš„å¢å¤šå¹¶æ²¡æœ‰è®©æ€§èƒ½æå‡ï¼Œåè€Œç”±äºçº¿ç¨‹æ•°é‡è¿‡å¤šä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</u>**</p>
<p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æœ€å¥½è¿˜è¦åŒæ—¶è€ƒè™‘åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿˜æœ‰å“ªäº›å…¶ä»–ä¼šå ç”¨è¿‡å¤š CPU èµ„æºçš„ç¨‹åºåœ¨è¿è¡Œï¼Œç„¶åå¯¹èµ„æºä½¿ç”¨åšæ•´ä½“çš„å¹³è¡¡ã€‚</p>
<h4 id="è€—æ—¶-IO-å‹ä»»åŠ¡"><a href="#è€—æ—¶-IO-å‹ä»»åŠ¡" class="headerlink" title="è€—æ—¶ IO å‹ä»»åŠ¡"></a>è€—æ—¶ IO å‹ä»»åŠ¡</h4><p><em><u>â€”å¯ä»¥å¤šæ¥ç‚¹ï¼Œå› ä¸ºè¿™äº›ä»»åŠ¡ä¸ä¼šä¸€ç›´å ç”¨CPUï¼Œå¤šæ¥ç‚¹æ‰èƒ½æœ€å¤§é™åº¦ä½¿ç”¨cpu</u></em></p>
<p>ç¬¬äºŒç§ä»»åŠ¡æ˜¯è€—æ—¶ IO å‹ï¼Œæ¯”å¦‚<u>æ•°æ®åº“ã€æ–‡ä»¶çš„è¯»å†™ï¼Œç½‘ç»œé€šä¿¡ç­‰ä»»åŠ¡</u>ï¼Œè¿™ç§ä»»åŠ¡çš„ç‰¹ç‚¹æ˜¯<u>å¹¶ä¸ä¼šç‰¹åˆ«æ¶ˆè€— CPU èµ„æºï¼Œä½†æ˜¯ IO æ“ä½œå¾ˆè€—æ—¶ï¼Œæ€»ä½“ä¼šå ç”¨æ¯”è¾ƒå¤šçš„æ—¶é—´ã€‚</u><strong><u>å¯¹äºè¿™ç§ä»»åŠ¡æœ€å¤§çº¿ç¨‹æ•°ä¸€èˆ¬ä¼šå¤§äº CPU æ ¸å¿ƒæ•°å¾ˆå¤šå€ï¼Œå› ä¸º IO è¯»å†™é€Ÿåº¦ç›¸æ¯”äº CPU çš„é€Ÿåº¦è€Œè¨€æ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®è¿‡å°‘çš„çº¿ç¨‹æ•°ï¼Œå°±å¯èƒ½å¯¼è‡´ CPU èµ„æºçš„æµªè´¹ã€‚è€Œå¦‚æœæˆ‘ä»¬è®¾ç½®æ›´å¤šçš„çº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆå½“ä¸€éƒ¨åˆ†çº¿ç¨‹æ­£åœ¨ç­‰å¾… IO çš„æ—¶å€™ï¼Œå®ƒä»¬æ­¤æ—¶å¹¶ä¸éœ€è¦ CPU æ¥è®¡ç®—ï¼Œé‚£ä¹ˆå¦å¤–çš„çº¿ç¨‹ä¾¿å¯ä»¥åˆ©ç”¨ CPU å»æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡ï¼Œäº’ä¸å½±å“ï¼Œè¿™æ ·çš„è¯åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…çš„ä»»åŠ¡å°±ä¼šå‡å°‘ï¼Œå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨èµ„æºã€‚</u></strong></p>
<h3 id="3-15-å¦‚ä½•æ ¹æ®å®é™…éœ€è¦ï¼Œå®šåˆ¶è‡ªå·±çš„çº¿ç¨‹æ± ï¼Ÿ"><a href="#3-15-å¦‚ä½•æ ¹æ®å®é™…éœ€è¦ï¼Œå®šåˆ¶è‡ªå·±çš„çº¿ç¨‹æ± ï¼Ÿ" class="headerlink" title="3.15.å¦‚ä½•æ ¹æ®å®é™…éœ€è¦ï¼Œå®šåˆ¶è‡ªå·±çš„çº¿ç¨‹æ± ï¼Ÿ"></a>3.15.å¦‚ä½•æ ¹æ®å®é™…éœ€è¦ï¼Œå®šåˆ¶è‡ªå·±çš„çº¿ç¨‹æ± ï¼Ÿ</h3><h4 id="æ ¸å¿ƒçº¿ç¨‹æ•°"><a href="#æ ¸å¿ƒçº¿ç¨‹æ•°" class="headerlink" title="æ ¸å¿ƒçº¿ç¨‹æ•°:"></a>æ ¸å¿ƒçº¿ç¨‹æ•°:</h4><p>â€‹	çº¿ç¨‹çš„å¹³å‡å·¥ä½œæ—¶é—´æ‰€å æ¯”ä¾‹è¶Šé«˜ï¼Œå°±éœ€è¦è¶Šå°‘çš„çº¿ç¨‹ï¼›çº¿ç¨‹çš„å¹³å‡ç­‰å¾…æ—¶é—´æ‰€å æ¯”ä¾‹è¶Šé«˜ï¼Œå°±éœ€è¦è¶Šå¤šçš„çº¿ç¨‹ã€‚</p>
<h4 id="æœ€å¤§çº¿ç¨‹æ•°ï¼š"><a href="#æœ€å¤§çº¿ç¨‹æ•°ï¼š" class="headerlink" title="æœ€å¤§çº¿ç¨‹æ•°ï¼š"></a>æœ€å¤§çº¿ç¨‹æ•°ï¼š</h4><p>â€‹	å¯¹äºæœ€å¤§çº¿ç¨‹æ•°è€Œè¨€ï¼Œå¦‚æœæˆ‘ä»¬æ‰§è¡Œçš„ä»»åŠ¡ç±»å‹ä¸æ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚å¯èƒ½ä¸€æ®µæ—¶é—´æ˜¯ CPU å¯†é›†å‹ï¼Œå¦ä¸€æ®µæ—¶é—´æ˜¯ IO å¯†é›†å‹ï¼Œæˆ–æ˜¯åŒæ—¶æœ‰ä¸¤ç§ä»»åŠ¡ç›¸äº’æ··æ­ã€‚é‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<u><strong>æˆ‘ä»¬å¯ä»¥æŠŠæœ€å¤§çº¿ç¨‹æ•°è®¾ç½®æˆæ ¸å¿ƒçº¿ç¨‹æ•°çš„å‡ å€ï¼Œä»¥ä¾¿åº”å¯¹ä»»åŠ¡çªå‘æƒ…å†µã€‚</strong></u></p>
<p>â€‹	æ›´å¥½çš„åŠæ³•æ˜¯<u><strong>ç”¨ä¸åŒçš„çº¿ç¨‹æ± æ‰§è¡Œä¸åŒç±»å‹çš„ä»»åŠ¡ï¼Œè®©ä»»åŠ¡æŒ‰ç…§ç±»å‹åŒºåˆ†å¼€ï¼Œè€Œä¸æ˜¯æ··æ‚åœ¨ä¸€èµ·ï¼Œ</strong></u>è¿™æ ·å°±å¯ä»¥æŒ‰ç…§ä¸Šä¸€è¯¾æ—¶ä¼°ç®—çš„çº¿ç¨‹æ•°æˆ–ç»è¿‡å‹æµ‹å¾—åˆ°çš„ç»“æœæ¥è®¾ç½®åˆç†çš„çº¿ç¨‹æ•°äº†ï¼Œè¾¾åˆ°æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<h4 id="é˜»å¡é˜Ÿåˆ—ï¼š"><a href="#é˜»å¡é˜Ÿåˆ—ï¼š" class="headerlink" title="é˜»å¡é˜Ÿåˆ—ï¼š"></a>é˜»å¡é˜Ÿåˆ—ï¼š</h4><p>â€‹	æœ‰ä¸€ç§å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—å« ArrayBlockingQueueï¼Œå®ƒä¹Ÿç»å¸¸è¢«ç”¨äºçº¿ç¨‹æ± ä¸­ï¼Œè¿™ç§é˜»å¡é˜Ÿåˆ—å†…éƒ¨æ˜¯ç”¨æ•°ç»„å®ç°çš„ï¼Œåœ¨æ–°å»ºå¯¹è±¡çš„æ—¶å€™è¦æ±‚ä¼ å…¥å®¹é‡å€¼ï¼Œä¸”åæœŸä¸èƒ½æ‰©å®¹ï¼Œæ‰€ä»¥ ArrayBlockingQueue çš„æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å®¹é‡æ˜¯æœ‰é™çš„ã€‚</p>
<p>â€‹	<u>è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœä»»åŠ¡é˜Ÿåˆ—æ”¾æ»¡äº†ä»»åŠ¡ï¼Œè€Œä¸”çº¿ç¨‹æ•°ä¹Ÿå·²ç»è¾¾åˆ°äº†æœ€å¤§å€¼ï¼Œçº¿ç¨‹æ± æ ¹æ®è§„åˆ™å°±ä¼šæ‹’ç»æ–°æäº¤çš„ä»»åŠ¡ï¼Œè¿™æ ·ä¸€æ¥å°±å¯èƒ½ä¼šäº§ç”Ÿä¸€å®šçš„æ•°æ®ä¸¢å¤±ã€‚ä½†ç›¸æ¯”äºæ— é™å¢åŠ ä»»åŠ¡æˆ–è€…çº¿ç¨‹æ•°å¯¼è‡´å†…å­˜ä¸è¶³ï¼Œè¿›è€Œå¯¼è‡´ç¨‹åºå´©æºƒï¼Œæ•°æ®ä¸¢å¤±è¿˜æ˜¯è¦æ›´å¥½ä¸€äº›çš„ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº† ArrayBlockingQueue è¿™ç§é˜»å¡é˜Ÿåˆ—ï¼Œå†åŠ ä¸Šæˆ‘ä»¬é™åˆ¶äº†æœ€å¤§çº¿ç¨‹æ•°é‡ï¼Œå°±å¯ä»¥éå¸¸æœ‰æ•ˆåœ°é˜²æ­¢èµ„æºè€—å°½çš„æƒ…å†µå‘ç”Ÿã€‚</u>æ­¤æ—¶çš„é˜Ÿåˆ—å®¹é‡å¤§å°å’Œ maxPoolSize æ˜¯ä¸€ä¸ª trade-offï¼Œå¦‚æœ<u><strong>æˆ‘ä»¬ä½¿ç”¨å®¹é‡æ›´å¤§çš„é˜Ÿåˆ—å’Œæ›´å°çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œå°±å¯ä»¥å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„å¼€é”€ï¼Œä½†ä¹Ÿå¯èƒ½å› æ­¤é™ä½æ•´ä½“çš„ååé‡ï¼›å¦‚æœæˆ‘ä»¬çš„ä»»åŠ¡æ˜¯ IO å¯†é›†å‹ï¼Œåˆ™å¯ä»¥é€‰æ‹©ç¨å°å®¹é‡çš„é˜Ÿåˆ—å’Œæ›´å¤§çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œè¿™æ ·æ•´ä½“çš„æ•ˆç‡å°±ä¼šæ›´é«˜ï¼Œä¸è¿‡ä¹Ÿä¼šå¸¦æ¥æ›´å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</strong></u></p>
<h4 id="çº¿ç¨‹å·¥å‚ï¼š"><a href="#çº¿ç¨‹å·¥å‚ï¼š" class="headerlink" title="çº¿ç¨‹å·¥å‚ï¼š"></a>çº¿ç¨‹å·¥å‚ï¼š</h4><p>â€‹	å¯¹äºçº¿ç¨‹å·¥å‚ threadFactory è¿™ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é»˜è®¤çš„ defaultThreadFactoryï¼Œä¹Ÿå¯ä»¥ä¼ å…¥è‡ªå®šä¹‰çš„æœ‰é¢å¤–èƒ½åŠ›çš„çº¿ç¨‹å·¥å‚ï¼Œå› ä¸º<u>æˆ‘ä»¬å¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹æ± ï¼Œè€Œä¸åŒçš„çº¿ç¨‹æ± ä¹‹é—´æœ‰å¿…è¦é€šè¿‡ä¸åŒçš„åå­—æ¥è¿›è¡ŒåŒºåˆ†ï¼Œæ‰€ä»¥å¯ä»¥ä¼ å…¥èƒ½æ ¹æ®ä¸šåŠ¡ä¿¡æ¯è¿›è¡Œå‘½åçš„çº¿ç¨‹å·¥å‚ï¼Œä»¥ä¾¿åç»­<strong>å¯ä»¥æ ¹æ®çº¿ç¨‹ååŒºåˆ†ä¸åŒçš„ä¸šåŠ¡è¿›è€Œå¿«é€Ÿå®šä½é—®é¢˜ä»£ç </strong>ã€‚</u></p>
<h4 id="æ‹’ç»ç­–ç•¥ï¼š"><a href="#æ‹’ç»ç­–ç•¥ï¼š" class="headerlink" title="æ‹’ç»ç­–ç•¥ï¼š"></a>æ‹’ç»ç­–ç•¥ï¼š</h4><p>é™¤äº†ä¹‹å‰è¯´çš„ï¼šè¿”å›å¼‚å¸¸ã€ç›´æ¥ä¸¢å¼ƒã€ä¸¢å¼ƒæœ€æ—©çš„èŠ‚ç‚¹ã€è°æäº¤ä»»åŠ¡è°æ‰§è¡Œ</p>
<p>è¿˜å¯ä»¥è¿˜å¯ä»¥é€šè¿‡<u><strong>å®ç° RejectedExecutionHandler æ¥å£æ¥å®ç°è‡ªå·±çš„æ‹’ç»ç­–ç•¥</strong></u>ï¼Œåœ¨æ¥å£ä¸­æˆ‘ä»¬éœ€è¦å®ç° rejectedExecution æ–¹æ³•ï¼Œåœ¨ rejectedExecution æ–¹æ³•ä¸­ï¼Œæ‰§è¡Œä¾‹å¦‚æ‰“å°æ—¥å¿—ã€æš‚å­˜ä»»åŠ¡ã€é‡æ–°æ‰§è¡Œç­‰è‡ªå®šä¹‰çš„æ‹’ç»ç­–ç•¥ï¼Œä»¥ä¾¿æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚	</p>
<h3 id="3-16-å¦‚ä½•æ­£ç¡®åœ°å…³é—­çº¿ç¨‹æ± ï¼Ÿshutdown-å’Œ-shutdownNow-çš„åŒºåˆ«ï¼Ÿ"><a href="#3-16-å¦‚ä½•æ­£ç¡®åœ°å…³é—­çº¿ç¨‹æ± ï¼Ÿshutdown-å’Œ-shutdownNow-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="3.16.å¦‚ä½•æ­£ç¡®åœ°å…³é—­çº¿ç¨‹æ± ï¼Ÿshutdown å’Œ shutdownNow çš„åŒºåˆ«ï¼Ÿ"></a>3.16.å¦‚ä½•æ­£ç¡®åœ°å…³é—­çº¿ç¨‹æ± ï¼Ÿshutdown å’Œ shutdownNow çš„åŒºåˆ«ï¼Ÿ</h3><h4 id="3-16-1-shutdown"><a href="#3-16-1-shutdown" class="headerlink" title="3.16.1.shutdown()"></a>3.16.1.shutdown()</h4><p>ç¬¬ä¸€ç§æ–¹æ³•å«ä½œ shutdown()ï¼Œå®ƒå¯ä»¥<u>å®‰å…¨åœ°å…³é—­ä¸€ä¸ªçº¿ç¨‹æ± </u>ï¼Œè°ƒç”¨ shutdown() æ–¹æ³•ä¹‹åçº¿ç¨‹æ± å¹¶ä¸æ˜¯ç«‹åˆ»å°±è¢«å…³é—­ï¼Œå› ä¸ºè¿™æ—¶çº¿ç¨‹æ± ä¸­å¯èƒ½è¿˜æœ‰å¾ˆå¤šä»»åŠ¡æ­£åœ¨è¢«æ‰§è¡Œï¼Œæˆ–æ˜¯ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰å¤§é‡æ­£åœ¨ç­‰å¾…è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè°ƒç”¨ shutdown() æ–¹æ³•åçº¿ç¨‹æ± ä¼šåœ¨æ‰§è¡Œå®Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å’Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„ä»»åŠ¡åæ‰å½»åº•å…³é—­ã€‚ä½†è¿™å¹¶ä¸ä»£è¡¨ shutdown() æ“ä½œæ˜¯æ²¡æœ‰ä»»ä½•æ•ˆæœçš„ï¼Œè°ƒç”¨ shutdown() æ–¹æ³•åå¦‚æœè¿˜æœ‰æ–°çš„ä»»åŠ¡è¢«æäº¤ï¼Œçº¿ç¨‹æ± åˆ™ä¼šæ ¹æ®æ‹’ç»ç­–ç•¥ç›´æ¥æ‹’ç»åç»­æ–°æäº¤çš„ä»»åŠ¡ã€‚</p>
<h4 id="3-16-2-isShutdown"><a href="#3-16-2-isShutdown" class="headerlink" title="3.16.2.isShutdown()"></a>3.16.2.isShutdown()</h4><p>ç¬¬äºŒä¸ªæ–¹æ³•å«ä½œ isShutdown()ï¼Œå®ƒå¯ä»¥è¿”å› true æˆ–è€… false æ¥åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦å·²ç»å¼€å§‹äº†å…³é—­å·¥ä½œï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦æ‰§è¡Œäº† shutdown æˆ–è€… shutdownNow æ–¹æ³•ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œ<u><strong>å¦‚æœè°ƒç”¨ isShutdown() æ–¹æ³•çš„è¿”å›çš„ç»“æœä¸º true å¹¶ä¸ä»£è¡¨çº¿ç¨‹æ± æ­¤æ—¶å·²ç»å½»åº•å…³é—­äº†ï¼Œè¿™ä»…ä»…ä»£è¡¨çº¿ç¨‹æ± å¼€å§‹äº†å…³é—­çš„æµç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤æ—¶å¯èƒ½çº¿ç¨‹æ± ä¸­ä¾ç„¶æœ‰çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œé˜Ÿåˆ—é‡Œä¹Ÿå¯èƒ½æœ‰ç­‰å¾…è¢«æ‰§è¡Œçš„ä»»åŠ¡ã€‚</strong></u></p>
<h4 id="3-16-3-isTerminated"><a href="#3-16-3-isTerminated" class="headerlink" title="3.16.3.isTerminated()"></a>3.16.3.isTerminated()</h4><p>ç¬¬ä¸‰ç§æ–¹æ³•å«ä½œ isTerminated()ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥æ£€æµ‹çº¿ç¨‹æ± æ˜¯å¦çœŸæ­£â€œç»ˆç»“â€äº†ï¼Œè¿™ä¸ä»…ä»£è¡¨çº¿ç¨‹æ± å·²å…³é—­ï¼ŒåŒæ—¶ä»£è¡¨çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰ä»»åŠ¡éƒ½å·²ç»éƒ½æ‰§è¡Œå®Œæ¯•äº†ï¼Œå› ä¸ºæˆ‘ä»¬åˆšæ‰è¯´è¿‡ï¼Œè°ƒç”¨ shutdown æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹æ± ä¼šç»§ç»­æ‰§è¡Œé‡Œé¢æœªå®Œæˆçš„ä»»åŠ¡ï¼Œä¸ä»…åŒ…æ‹¬çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿˜åŒ…æ‹¬æ­£åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…çš„ä»»åŠ¡ã€‚æ¯”å¦‚æ­¤æ—¶å·²ç»è°ƒç”¨äº† shutdown æ–¹æ³•ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªçº¿ç¨‹ä¾ç„¶åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œé‚£ä¹ˆæ­¤æ—¶è°ƒç”¨ isShutdown æ–¹æ³•è¿”å›çš„æ˜¯ true ï¼Œè€Œè°ƒç”¨ isTerminated æ–¹æ³•è¿”å›çš„ä¾¿æ˜¯ false ï¼Œå› ä¸ºçº¿ç¨‹æ± ä¸­è¿˜æœ‰ä»»åŠ¡æ­£åœ¨åœ¨è¢«æ‰§è¡Œï¼Œçº¿ç¨‹æ± å¹¶æ²¡æœ‰çœŸæ­£â€œç»ˆç»“â€ã€‚ç›´åˆ°æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•äº†ï¼Œè°ƒç”¨ isTerminated() æ–¹æ³•æ‰ä¼šè¿”å› trueï¼Œè¿™è¡¨ç¤ºçº¿ç¨‹æ± å·²å…³é—­å¹¶ä¸”çº¿ç¨‹æ± å†…éƒ¨æ˜¯ç©ºçš„ï¼Œæ‰€æœ‰å‰©ä½™çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•äº†ã€‚</p>
<h4 id="3-16-4-awaitTermination"><a href="#3-16-4-awaitTermination" class="headerlink" title="3.16.4.awaitTermination()"></a>3.16.4.awaitTermination()</h4><p>ç¬¬å››ä¸ªæ–¹æ³•å«ä½œ awaitTermination()ï¼Œå®ƒæœ¬èº«å¹¶ä¸æ˜¯ç”¨æ¥å…³é—­çº¿ç¨‹æ± çš„ï¼Œè€Œæ˜¯ä¸»è¦ç”¨æ¥åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€çš„ã€‚æ¯”å¦‚æˆ‘ä»¬ç»™ awaitTermination æ–¹æ³•ä¼ å…¥çš„å‚æ•°æ˜¯ 10 ç§’ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šé™·å…¥ 10 ç§’é’Ÿçš„ç­‰å¾…ï¼Œç›´åˆ°å‘ç”Ÿä»¥ä¸‹ä¸‰ç§æƒ…å†µä¹‹ä¸€ï¼š</p>
<ol>
<li>ç­‰å¾…æœŸé—´ï¼ˆåŒ…æ‹¬è¿›å…¥ç­‰å¾…çŠ¶æ€ä¹‹å‰ï¼‰çº¿ç¨‹æ± å·²å…³é—­å¹¶ä¸”æ‰€æœ‰å·²æäº¤çš„ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ­£åœ¨æ‰§è¡Œçš„å’Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„ï¼‰éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œç›¸å½“äºçº¿ç¨‹æ± å·²ç»â€œç»ˆç»“â€äº†ï¼Œæ–¹æ³•ä¾¿ä¼šè¿”å› trueï¼›</li>
<li>ç­‰å¾…è¶…æ—¶æ—¶é—´åˆ°åï¼Œç¬¬ä¸€ç§çº¿ç¨‹æ± â€œç»ˆç»“â€çš„æƒ…å†µå§‹ç»ˆæœªå‘ç”Ÿï¼Œæ–¹æ³•è¿”å› falseï¼›</li>
<li>ç­‰å¾…æœŸé—´çº¿ç¨‹è¢«ä¸­æ–­ï¼Œæ–¹æ³•ä¼šæŠ›å‡º InterruptedException å¼‚å¸¸ã€‚</li>
</ol>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨ awaitTermination æ–¹æ³•åå½“å‰çº¿ç¨‹ä¼šå°è¯•ç­‰å¾…ä¸€æ®µæŒ‡å®šçš„æ—¶é—´ï¼Œå¦‚æœåœ¨ç­‰å¾…æ—¶é—´å†…ï¼Œçº¿ç¨‹æ± å·²å…³é—­å¹¶ä¸”å†…éƒ¨çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•äº†ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹æ± çœŸæ­£â€œç»ˆç»“â€äº†ï¼Œé‚£ä¹ˆæ–¹æ³•å°±è¿”å› trueï¼Œå¦åˆ™è¶…æ—¶è¿”å› fasleã€‚</p>
<p>æˆ‘ä»¬åˆ™å¯ä»¥æ ¹æ® awaitTermination() è¿”å›çš„å¸ƒå°”å€¼æ¥åˆ¤æ–­ä¸‹ä¸€æ­¥åº”è¯¥æ‰§è¡Œçš„æ“ä½œã€‚</p>
<h4 id="3-16-5-shutdownNow"><a href="#3-16-5-shutdownNow" class="headerlink" title="3.16.5.shutdownNow()"></a>3.16.5.shutdownNow()</h4><p>æœ€åä¸€ä¸ªæ–¹æ³•æ˜¯ shutdownNow()ï¼Œä¹Ÿæ˜¯ 5 ç§æ–¹æ³•é‡ŒåŠŸèƒ½æœ€å¼ºå¤§çš„ï¼Œå®ƒä¸ç¬¬ä¸€ç§ shutdown æ–¹æ³•ä¸åŒä¹‹å¤„åœ¨äºåå­—ä¸­å¤šäº†ä¸€ä¸ªå•è¯ Nowï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤ºç«‹åˆ»å…³é—­çš„æ„æ€ã€‚åœ¨æ‰§è¡Œ shutdownNow æ–¹æ³•ä¹‹åï¼Œ<u><strong>é¦–å…ˆä¼šç»™æ‰€æœ‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å‘é€ interrupt ä¸­æ–­ä¿¡å·ï¼Œå°è¯•ä¸­æ–­è¿™äº›ä»»åŠ¡çš„æ‰§è¡Œï¼Œç„¶åä¼šå°†ä»»åŠ¡é˜Ÿåˆ—ä¸­æ­£åœ¨ç­‰å¾…çš„æ‰€æœ‰ä»»åŠ¡è½¬ç§»åˆ°ä¸€ä¸ª List ä¸­å¹¶è¿”å›ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿”å›çš„ä»»åŠ¡ List æ¥è¿›è¡Œä¸€äº›è¡¥æ•‘çš„æ“ä½œã€‚</strong></u></p>
<h3 id="3-17-çº¿ç¨‹æ± å®ç°â€œçº¿ç¨‹å¤ç”¨â€çš„åŸç†"><a href="#3-17-çº¿ç¨‹æ± å®ç°â€œçº¿ç¨‹å¤ç”¨â€çš„åŸç†" class="headerlink" title="3.17.çº¿ç¨‹æ± å®ç°â€œçº¿ç¨‹å¤ç”¨â€çš„åŸç†"></a>3.17.çº¿ç¨‹æ± å®ç°â€œçº¿ç¨‹å¤ç”¨â€çš„åŸç†</h3><p>æˆ‘ä»¬çŸ¥é“çº¿ç¨‹æ± ä¼šä½¿ç”¨å›ºå®šæ•°é‡æˆ–å¯å˜æ•°é‡çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä½†æ— è®ºæ˜¯å›ºå®šæ•°é‡æˆ–å¯å˜æ•°é‡çš„çº¿ç¨‹ï¼Œå…¶çº¿ç¨‹æ•°é‡éƒ½è¿œè¿œå°äºä»»åŠ¡æ•°é‡ï¼Œé¢å¯¹è¿™ç§æƒ…å†µçº¿ç¨‹æ± å¯ä»¥é€šè¿‡çº¿ç¨‹å¤ç”¨è®©åŒä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œé‚£ä¹ˆçº¿ç¨‹å¤ç”¨èƒŒåçš„åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>çº¿ç¨‹æ± å¯ä»¥æŠŠçº¿ç¨‹å’Œä»»åŠ¡è¿›è¡Œè§£è€¦ï¼Œçº¿ç¨‹å½’çº¿ç¨‹ï¼Œä»»åŠ¡å½’ä»»åŠ¡ï¼Œæ‘†è„±äº†ä¹‹å‰é€šè¿‡ Thread åˆ›å»ºçº¿ç¨‹æ—¶çš„ä¸€ä¸ªçº¿ç¨‹å¿…é¡»å¯¹åº”ä¸€ä¸ªä»»åŠ¡çš„é™åˆ¶ã€‚åœ¨çº¿ç¨‹æ± ä¸­ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥ä» BlockingQueue ä¸­ä¸æ–­æå–æ–°ä»»åŠ¡æ¥æ‰§è¡Œï¼Œå…¶æ ¸å¿ƒåŸç†åœ¨äº<u><strong>çº¿ç¨‹æ± å¯¹ Thread è¿›è¡Œäº†å°è£…ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡æ‰§è¡Œä»»åŠ¡éƒ½ä¼šè°ƒç”¨ Thread.start() æ¥åˆ›å»ºæ–°çº¿ç¨‹ï¼Œè€Œæ˜¯è®©æ¯ä¸ªçº¿ç¨‹å»æ‰§è¡Œä¸€ä¸ªâ€œå¾ªç¯ä»»åŠ¡â€ï¼Œåœ¨è¿™ä¸ªâ€œå¾ªç¯ä»»åŠ¡â€ä¸­ï¼Œä¸åœåœ°æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ä»»åŠ¡ç­‰å¾…è¢«æ‰§è¡Œï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ä»»åŠ¡çš„ run æ–¹æ³•ï¼ŒæŠŠ run æ–¹æ³•å½“ä½œå’Œæ™®é€šæ–¹æ³•ä¸€æ ·çš„åœ°ä½å»è°ƒç”¨ï¼Œç›¸å½“äºæŠŠæ¯ä¸ªä»»åŠ¡çš„ run() æ–¹æ³•ä¸²è”äº†èµ·æ¥ï¼Œæ‰€ä»¥çº¿ç¨‹æ•°é‡å¹¶ä¸å¢åŠ ã€‚</strong></u></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable command)</span> &#123; </span><br><span class="line">  	<span class="comment">//execute æ–¹æ³•ä¸­é€šè¿‡ if è¯­å¥åˆ¤æ–­ command ï¼Œä¹Ÿå°±æ˜¯ Runnable ä»»åŠ¡æ˜¯å¦ç­‰äº nullï¼Œå¦‚æœä¸º null å°±æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (command == <span class="literal">null</span>) </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> ctl.get();</span><br><span class="line">  	<span class="comment">//addWorker æ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨çº¿ç¨‹æ± ä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„ä»»åŠ¡ï¼Œå®ƒçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœå¸ƒå°”å€¼ä¼ å…¥ true ä»£è¡¨å¢åŠ çº¿ç¨‹æ—¶åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å°‘äº corePoolSizeï¼Œå°äºåˆ™å¢åŠ æ–°çº¿ç¨‹ï¼Œå¤§äºç­‰äºåˆ™ä¸å¢åŠ ï¼›åŒç†ï¼Œå¦‚æœä¼ å…¥ false ä»£è¡¨å¢åŠ çº¿ç¨‹æ—¶åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å°‘äº maxPoolSizeï¼Œå°äºåˆ™å¢åŠ æ–°çº¿ç¨‹ï¼Œå¤§äºç­‰äºåˆ™ä¸å¢åŠ ï¼Œæ‰€ä»¥è¿™é‡Œçš„å¸ƒå°”å€¼çš„å«ä¹‰æ˜¯ä»¥æ ¸å¿ƒçº¿ç¨‹æ•°ä¸ºç•Œé™è¿˜æ˜¯ä»¥æœ€å¤§çº¿ç¨‹æ•°ä¸ºç•Œé™è¿›è¡Œæ˜¯å¦æ–°å¢çº¿ç¨‹çš„åˆ¤æ–­ã€‚addWorker() æ–¹æ³•å¦‚æœè¿”å› true ä»£è¡¨æ·»åŠ æˆåŠŸï¼Œå¦‚æœè¿”å› false ä»£è¡¨æ·»åŠ å¤±è´¥ã€‚</span></span><br><span class="line">  	<span class="comment">//ç°æœ‰çº¿ç¨‹æ•°å°äºçº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123; </span><br><span class="line">        <span class="keyword">if</span> (addWorker(command, <span class="literal">true</span>)) </span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        c = ctl.get();</span><br><span class="line">    &#125; </span><br><span class="line">  	<span class="comment">//è¿è¡Œåˆ°æ­¤å¤„è¯´æ˜ ç°æœ‰çº¿ç¨‹æ•° &gt;= çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line">  	<span class="comment">//çº¿ç¨‹æ± æ˜¯runningçŠ¶æ€ &amp;&amp; èƒ½æŠŠä»»åŠ¡æ”¾è¿›é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; </span><br><span class="line">        <span class="type">int</span> <span class="variable">recheck</span> <span class="operator">=</span> ctl.get();</span><br><span class="line">        <span class="keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command)) </span><br><span class="line">            reject(command);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>) </span><br><span class="line">            addWorker(<span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="comment">//è¿è¡Œåˆ°æ­¤å¤„è¯´æ˜ ä¸æ˜¯runningçŠ¶æ€ || çº¿ç¨‹æ•°&gt;=æ ¸å¿ƒçº¿ç¨‹æ•° å¹¶ä¸” ä»»åŠ¡é˜Ÿåˆ—æ»¡</span></span><br><span class="line">  	<span class="comment">//é‚£ä¹ˆä»¥æœ€å¤§é˜Ÿçº¿ç¨‹æ•°ä¸ºæ ‡å‡†åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="literal">false</span>)) </span><br><span class="line">      <span class="comment">//è¿˜æ˜¯æ— æ³•åˆ›å»ºï¼Œåˆ™æ‹’ç»</span></span><br><span class="line">        reject(command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-18-ä½ çŸ¥é“å“ªå‡ ç§é”ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"><a href="#3-18-ä½ çŸ¥é“å“ªå‡ ç§é”ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="3.18.ä½ çŸ¥é“å“ªå‡ ç§é”ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"></a>3.18.ä½ çŸ¥é“å“ªå‡ ç§é”ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</h3><p>æ ¹æ®<u>åˆ†ç±»æ ‡å‡†</u>æˆ‘ä»¬æŠŠé”åˆ†ä¸ºä»¥ä¸‹ 7 å¤§ç±»åˆ«ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>åå‘é”&#x2F;è½»é‡çº§é”&#x2F;é‡é‡çº§é”ï¼›</li>
<li>å¯é‡å…¥é”&#x2F;éå¯é‡å…¥é”ï¼›</li>
<li>å…±äº«é”&#x2F;ç‹¬å é”ï¼›</li>
<li>å…¬å¹³é”&#x2F;éå…¬å¹³é”ï¼›</li>
<li>æ‚²è§‚é”&#x2F;ä¹è§‚é”ï¼›</li>
<li>è‡ªæ—‹é”&#x2F;éè‡ªæ—‹é”ï¼›</li>
<li>å¯ä¸­æ–­é”&#x2F;ä¸å¯ä¸­æ–­é”ã€‚</li>
</ul>
<h4 id="3-18-1-åå‘é”-x2F-è½»é‡çº§é”-x2F-é‡é‡çº§é”"><a href="#3-18-1-åå‘é”-x2F-è½»é‡çº§é”-x2F-é‡é‡çº§é”" class="headerlink" title="3.18.1.åå‘é”&#x2F;è½»é‡çº§é”&#x2F;é‡é‡çº§é”"></a>3.18.1.åå‘é”&#x2F;è½»é‡çº§é”&#x2F;é‡é‡çº§é”</h4><ul>
<li>åå‘é”</li>
</ul>
<p>å¦‚æœè‡ªå§‹è‡³ç»ˆï¼Œå¯¹äºè¿™æŠŠé”éƒ½ä¸å­˜åœ¨ç«äº‰ï¼Œé‚£ä¹ˆå…¶å®å°±æ²¡å¿…è¦ä¸Šé”ï¼Œåªéœ€è¦æ‰“ä¸ªæ ‡è®°å°±è¡Œäº†ï¼Œè¿™å°±æ˜¯åå‘é”çš„æ€æƒ³ã€‚ä¸€ä¸ªå¯¹è±¡è¢«åˆå§‹åŒ–åï¼Œè¿˜æ²¡æœ‰ä»»ä½•çº¿ç¨‹æ¥è·å–å®ƒçš„é”æ—¶ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å¯åå‘çš„ï¼Œ<u>å½“æœ‰ç¬¬ä¸€ä¸ªçº¿ç¨‹æ¥è®¿é—®å®ƒå¹¶å°è¯•è·å–é”çš„æ—¶å€™ï¼Œå®ƒå°±å°†è¿™ä¸ªçº¿ç¨‹è®°å½•ä¸‹æ¥ï¼Œä»¥åå¦‚æœå°è¯•è·å–é”çš„çº¿ç¨‹æ­£æ˜¯åå‘é”çš„æ‹¥æœ‰è€…ï¼Œå°±å¯ä»¥ç›´æ¥è·å¾—é”ï¼Œå¼€é”€å¾ˆå°ï¼Œæ€§èƒ½æœ€å¥½ã€‚</u></p>
<ul>
<li>è½»é‡çº§é”</li>
</ul>
<p>JVM å¼€å‘è€…å‘ç°åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œsynchronized ä¸­çš„ä»£ç æ˜¯è¢«å¤šä¸ªçº¿ç¨‹äº¤æ›¿æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯åŒæ—¶æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¹¶ä¸å­˜åœ¨å®é™…çš„ç«äº‰ï¼Œæˆ–è€…æ˜¯åªæœ‰çŸ­æ—¶é—´çš„é”ç«äº‰ï¼Œç”¨ CAS å°±å¯ä»¥è§£å†³ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œç”¨å®Œå…¨äº’æ–¥çš„é‡é‡çº§é”æ˜¯æ²¡å¿…è¦çš„ã€‚è½»é‡çº§é”æ˜¯æŒ‡å½“é”åŸæ¥æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œè¯´æ˜å­˜åœ¨ç«äº‰ï¼Œé‚£ä¹ˆåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œçº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹(ä¸€æ®µæ—¶é—´&#x2F;ä¸€å®šæ¬¡æ•°åå¤è¯·æ±‚)çš„å½¢å¼å°è¯•è·å–é”ï¼Œè€Œä¸ä¼šé™·å…¥é˜»å¡ã€‚</p>
<ul>
<li>é‡é‡çº§é”</li>
</ul>
<p>é‡é‡çº§é”æ˜¯äº’æ–¥é”ï¼Œå®ƒæ˜¯åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„åŒæ­¥æœºåˆ¶å®ç°çš„ï¼Œæ‰€ä»¥å¼€é”€ç›¸å¯¹æ¯”è¾ƒå¤§ã€‚å½“å¤šä¸ªçº¿ç¨‹ç›´æ¥æœ‰å®é™…ç«äº‰ï¼Œä¸”é”ç«äº‰æ—¶é—´é•¿çš„æ—¶å€™ï¼Œè½»é‡çº§é”ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œé”å°±ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚é‡é‡çº§é”ä¼šè®©å…¶ä»–ç”³è¯·å´æ‹¿ä¸åˆ°é”çš„çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p>
<p><img src="https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/Java%20%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b%2078%20%e8%ae%b2-%e5%ae%8c/assets/CgpOIF35yCGAGFBbAAAO9n9VgTQ034.png" alt="img"></p>
<p>ä½ å¯ä»¥å‘ç°é”å‡çº§çš„è·¯å¾„ï¼šæ— é”â†’åå‘é”â†’è½»é‡çº§é”â†’é‡é‡çº§é”ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œåå‘é”æ€§èƒ½æœ€å¥½ï¼Œå¯ä»¥é¿å…æ‰§è¡Œ CAS æ“ä½œã€‚è€Œè½»é‡çº§é”åˆ©ç”¨è‡ªæ—‹å’Œ CAS é¿å…äº†é‡é‡çº§é”å¸¦æ¥çš„çº¿ç¨‹é˜»å¡å’Œå”¤é†’ï¼Œæ€§èƒ½ä¸­ç­‰ã€‚é‡é‡çº§é”åˆ™ä¼šæŠŠè·å–ä¸åˆ°é”çš„çº¿ç¨‹é˜»å¡ï¼Œæ€§èƒ½æœ€å·®ã€‚</p>
<h4 id="3-18-2-å¯é‡å…¥é”-x2F-éå¯é‡å…¥é”"><a href="#3-18-2-å¯é‡å…¥é”-x2F-éå¯é‡å…¥é”" class="headerlink" title="3.18.2.å¯é‡å…¥é”&#x2F;éå¯é‡å…¥é”"></a>3.18.2.å¯é‡å…¥é”&#x2F;éå¯é‡å…¥é”</h4><p>â€‹	ç¬¬ 2 ä¸ªåˆ†ç±»æ˜¯å¯é‡å…¥é”å’Œéå¯é‡å…¥é”ã€‚<u>å¯é‡å…¥é”æŒ‡çš„æ˜¯çº¿ç¨‹å½“å‰å·²ç»æŒæœ‰è¿™æŠŠé”äº†ï¼Œèƒ½åœ¨ä¸é‡Šæ”¾è¿™æŠŠé”çš„æƒ…å†µä¸‹ï¼Œå†æ¬¡è·å–è¿™æŠŠé”</u>ã€‚åŒç†ï¼Œä¸å¯é‡å…¥é”æŒ‡çš„æ˜¯è™½ç„¶çº¿ç¨‹å½“å‰æŒæœ‰äº†è¿™æŠŠé”ï¼Œä½†æ˜¯å¦‚æœæƒ³å†æ¬¡è·å–è¿™æŠŠé”ï¼Œä¹Ÿå¿…é¡»è¦å…ˆé‡Šæ”¾é”åæ‰èƒ½å†æ¬¡å°è¯•è·å–ã€‚</p>
<p>â€‹	å¯¹äºå¯é‡å…¥é”è€Œè¨€ï¼Œæœ€å…¸å‹çš„å°±æ˜¯ ReentrantLock äº†ï¼Œæ­£å¦‚å®ƒçš„åå­—ä¸€æ ·ï¼Œreentrant çš„æ„æ€å°±æ˜¯å¯é‡å…¥ï¼Œå®ƒä¹Ÿæ˜¯ Lock æ¥å£æœ€ä¸»è¦çš„ä¸€ä¸ªå®ç°ç±»ã€‚</p>
<h4 id="3-18-3-å…±äº«é”-x2F-ç‹¬å é”"><a href="#3-18-3-å…±äº«é”-x2F-ç‹¬å é”" class="headerlink" title="3.18.3.å…±äº«é”&#x2F;ç‹¬å é”"></a>3.18.3.å…±äº«é”&#x2F;ç‹¬å é”</h4><p>â€‹	å…±äº«é”æŒ‡çš„æ˜¯æˆ‘ä»¬åŒä¸€æŠŠé”å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å¾—ï¼Œè€Œç‹¬å é”æŒ‡çš„å°±æ˜¯ï¼Œè¿™æŠŠé”åªèƒ½åŒæ—¶è¢«ä¸€ä¸ªçº¿ç¨‹è·å¾—ã€‚æˆ‘ä»¬çš„è¯»å†™é”ï¼Œå°±æœ€å¥½åœ°è¯ é‡Šäº†å…±äº«é”å’Œç‹¬å é”çš„ç†å¿µã€‚è¯»å†™é”ä¸­çš„è¯»é”ï¼Œæ˜¯å…±äº«é”ï¼Œè€Œå†™é”æ˜¯ç‹¬å é”ã€‚è¯»é”å¯ä»¥è¢«åŒæ—¶è¯»ï¼Œå¯ä»¥åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹æŒæœ‰ï¼Œè€Œå†™é”æœ€å¤šåªèƒ½åŒæ—¶è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚</p>
<h4 id="3-18-4-å…¬å¹³é”-x2F-éå…¬å¹³é”"><a href="#3-18-4-å…¬å¹³é”-x2F-éå…¬å¹³é”" class="headerlink" title="3.18.4.å…¬å¹³é”&#x2F;éå…¬å¹³é”"></a>3.18.4.å…¬å¹³é”&#x2F;éå…¬å¹³é”</h4><p>â€‹	å…¬å¹³é”çš„å…¬å¹³çš„å«ä¹‰åœ¨äºå¦‚æœçº¿ç¨‹ç°åœ¨æ‹¿ä¸åˆ°è¿™æŠŠé”ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±éƒ½ä¼šè¿›å…¥ç­‰å¾…ï¼Œå¼€å§‹æ’é˜Ÿï¼Œåœ¨ç­‰å¾…é˜Ÿåˆ—é‡Œç­‰å¾…æ—¶é—´é•¿çš„çº¿ç¨‹ä¼šä¼˜å…ˆæ‹¿åˆ°è¿™æŠŠé”ï¼Œæœ‰<u>å…ˆæ¥å…ˆå¾—</u>çš„æ„æ€ã€‚è€Œéå…¬å¹³é”å°±ä¸é‚£ä¹ˆâ€œå®Œç¾â€äº†ï¼Œå®ƒä¼šåœ¨ä¸€å®šæƒ…å†µä¸‹ï¼Œå¿½ç•¥æ‰å·²ç»åœ¨æ’é˜Ÿçš„çº¿ç¨‹ï¼Œ<u>å‘ç”Ÿæ’é˜Ÿç°è±¡</u>ã€‚</p>
<h4 id="3-18-5-æ‚²è§‚é”-x2F-ä¹è§‚é”"><a href="#3-18-5-æ‚²è§‚é”-x2F-ä¹è§‚é”" class="headerlink" title="3.18.5.æ‚²è§‚é”&#x2F;ä¹è§‚é”"></a>3.18.5.æ‚²è§‚é”&#x2F;ä¹è§‚é”</h4><p>â€‹	æ‚²è§‚é”çš„æ¦‚å¿µæ˜¯åœ¨è·å–èµ„æºä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‹¿åˆ°é”ï¼Œ<u>ä»¥ä¾¿è¾¾åˆ°â€œç‹¬å â€çš„çŠ¶æ€</u>ï¼Œå½“å‰çº¿ç¨‹åœ¨æ“ä½œèµ„æºçš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ç”±äºä¸èƒ½æ‹¿åˆ°é”ï¼Œæ‰€ä»¥å…¶ä»–çº¿ç¨‹ä¸èƒ½æ¥å½±å“æˆ‘ã€‚</p>
<p>â€‹	è€Œä¹è§‚é”æ°æ°ç›¸åï¼Œå®ƒå¹¶ä¸è¦æ±‚åœ¨è·å–èµ„æºå‰æ‹¿åˆ°é”ï¼Œä¹Ÿä¸ä¼šé”ä½èµ„æºï¼›ç›¸åï¼Œ<u>ä¹è§‚é”åˆ©ç”¨ CAS ç†å¿µï¼Œåœ¨ä¸ç‹¬å èµ„æºçš„æƒ…å†µä¸‹ï¼Œå®Œæˆäº†å¯¹èµ„æºçš„ä¿®æ”¹ã€‚</u></p>
<h4 id="3-18-6-è‡ªæ—‹é”-x2F-éè‡ªæ—‹é”"><a href="#3-18-6-è‡ªæ—‹é”-x2F-éè‡ªæ—‹é”" class="headerlink" title="3.18.6.è‡ªæ—‹é”&#x2F;éè‡ªæ—‹é”"></a>3.18.6.è‡ªæ—‹é”&#x2F;éè‡ªæ—‹é”</h4><p>â€‹	è‡ªæ—‹é”çš„ç†å¿µæ˜¯å¦‚æœçº¿ç¨‹ç°åœ¨æ‹¿ä¸åˆ°é”ï¼Œ<u>å¹¶ä¸ç›´æ¥é™·å…¥é˜»å¡æˆ–è€…é‡Šæ”¾ CPU èµ„æºï¼Œè€Œæ˜¯å¼€å§‹åˆ©ç”¨å¾ªç¯ï¼Œä¸åœåœ°å°è¯•è·å–é”ï¼Œè¿™ä¸ªå¾ªç¯è¿‡ç¨‹è¢«å½¢è±¡åœ°æ¯”å–»ä¸ºâ€œè‡ªæ—‹â€</u>ï¼Œå°±åƒæ˜¯çº¿ç¨‹åœ¨â€œè‡ªæˆ‘æ—‹è½¬â€ã€‚ç›¸åï¼Œéè‡ªæ—‹é”çš„ç†å¿µå°±æ˜¯æ²¡æœ‰è‡ªæ—‹çš„è¿‡ç¨‹ï¼Œå¦‚æœ<u>æ‹¿ä¸åˆ°é”å°±ç›´æ¥æ”¾å¼ƒ</u>ï¼Œæˆ–è€…è¿›è¡Œå…¶ä»–çš„å¤„ç†é€»è¾‘ï¼Œä¾‹å¦‚å»æ’é˜Ÿã€é™·å…¥é˜»å¡ç­‰ã€‚</p>
<h4 id="3-18-7-å¯ä¸­æ–­é”-x2F-ä¸å¯ä¸­æ–­é”"><a href="#3-18-7-å¯ä¸­æ–­é”-x2F-ä¸å¯ä¸­æ–­é”" class="headerlink" title="3.18.7.å¯ä¸­æ–­é”&#x2F;ä¸å¯ä¸­æ–­é”"></a>3.18.7.å¯ä¸­æ–­é”&#x2F;ä¸å¯ä¸­æ–­é”</h4><p>â€‹	åœ¨ Java ä¸­ï¼Œsynchronized å…³é”®å­—ä¿®é¥°çš„é”ä»£è¡¨çš„æ˜¯ä¸å¯ä¸­æ–­é”ï¼Œ<u>ä¸€æ—¦çº¿ç¨‹ç”³è¯·äº†é”ï¼Œå°±æ²¡æœ‰å›å¤´è·¯äº†ï¼Œåªèƒ½ç­‰åˆ°æ‹¿åˆ°é”ä»¥åæ‰èƒ½è¿›è¡Œå…¶ä»–çš„é€»è¾‘å¤„ç†</u>ã€‚</p>
<p>â€‹	è€Œæˆ‘ä»¬çš„ ReentrantLock æ˜¯ä¸€ç§å…¸å‹çš„å¯ä¸­æ–­é”ï¼Œä¾‹å¦‚ä½¿ç”¨ lockInterruptibly æ–¹æ³•åœ¨è·å–é”çš„è¿‡ç¨‹ä¸­ï¼Œ<u><strong>çªç„¶ä¸æƒ³è·å–äº†ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥åœ¨ä¸­æ–­ä¹‹åå»åšå…¶ä»–çš„äº‹æƒ…ï¼Œä¸éœ€è¦ä¸€ç›´å‚»ç­‰åˆ°è·å–åˆ°é”æ‰ç¦»å¼€ã€‚</strong></u></p>
<h3 id="3-19-æ‚²è§‚é”ä¸ä¹è§‚é”"><a href="#3-19-æ‚²è§‚é”ä¸ä¹è§‚é”" class="headerlink" title="3.19.æ‚²è§‚é”ä¸ä¹è§‚é”"></a>3.19.æ‚²è§‚é”ä¸ä¹è§‚é”</h3><ul>
<li>æ‚²è§‚é”ï¼šsynchronized å…³é”®å­—å’Œ Lock æ¥å£</li>
</ul>
<p>Java ä¸­æ‚²è§‚é”çš„å®ç°åŒ…æ‹¬ synchronized å…³é”®å­—å’Œ Lock ç›¸å…³ç±»ç­‰ï¼Œæˆ‘ä»¬ä»¥ Lock æ¥å£ä¸ºä¾‹ï¼Œä¾‹å¦‚ Lock çš„å®ç°ç±» ReentrantLockï¼Œç±»ä¸­çš„ lock() ç­‰æ–¹æ³•å°±æ˜¯æ‰§è¡ŒåŠ é”ï¼Œè€Œ unlock() æ–¹æ³•æ˜¯æ‰§è¡Œè§£é”ã€‚å¤„ç†èµ„æºä¹‹å‰å¿…é¡»è¦å…ˆåŠ é”å¹¶æ‹¿åˆ°é”ï¼Œç­‰åˆ°å¤„ç†å®Œäº†ä¹‹åå†è§£å¼€é”ï¼Œè¿™å°±æ˜¯éå¸¸å…¸å‹çš„æ‚²è§‚é”æ€æƒ³ã€‚</p>
<ul>
<li>ä¹è§‚é”ï¼šåŸå­ç±»</li>
</ul>
<p>ä¹è§‚é”çš„å…¸å‹æ¡ˆä¾‹å°±æ˜¯åŸå­ç±»ï¼Œä¾‹å¦‚ AtomicInteger åœ¨æ›´æ–°æ•°æ®æ—¶ï¼Œå°±ä½¿ç”¨äº†ä¹è§‚é”çš„æ€æƒ³ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ“ä½œåŒä¸€ä¸ªåŸå­å˜é‡ã€‚</p>
<ul>
<li>å¤§å–œå¤§æ‚²ï¼šæ•°æ®åº“</li>
</ul>
<p>æ•°æ®åº“ä¸­åŒæ—¶æ‹¥æœ‰æ‚²è§‚é”å’Œä¹è§‚é”çš„æ€æƒ³ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¦‚æœåœ¨ MySQL é€‰æ‹© <strong>select for update</strong> è¯­å¥ï¼Œé‚£å°±æ˜¯<u>æ‚²è§‚é”</u>ï¼Œåœ¨æäº¤ä¹‹å‰ä¸å…è®¸ç¬¬ä¸‰æ–¹æ¥ä¿®æ”¹è¯¥æ•°æ®ï¼Œè¿™å½“ç„¶ä¼šé€ æˆä¸€å®šçš„æ€§èƒ½æŸè€—ï¼Œåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹æ˜¯ä¸å¯å–çš„ã€‚</p>
<p>ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<strong>ä¸€ä¸ªç‰ˆæœ¬ version å­—æ®µåœ¨æ•°æ®åº“ä¸­å®ç°ä¹è§‚é”</strong>ã€‚åœ¨è·å–åŠä¿®æ”¹æ•°æ®æ—¶éƒ½ä¸éœ€è¦åŠ é”ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è·å–å®Œæ•°æ®å¹¶è®¡ç®—å®Œæ¯•ï¼Œå‡†å¤‡æ›´æ–°æ•°æ®æ—¶ï¼Œä¼šæ£€æŸ¥ç‰ˆæœ¬å·å’Œè·å–æ•°æ®æ—¶çš„ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´å°±ç›´æ¥æ›´æ–°ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œè¯´æ˜è®¡ç®—æœŸé—´å·²ç»æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡è¿™ä¸ªæ•°æ®äº†ï¼Œé‚£æˆ‘å°±å¯ä»¥é€‰æ‹©é‡æ–°è·å–æ•°æ®ï¼Œé‡æ–°è®¡ç®—ï¼Œç„¶åå†æ¬¡å°è¯•æ›´æ–°æ•°æ®ã€‚</p>
<h4 id="ä¸¤ç§é”å„è‡ªçš„ä½¿ç”¨åœºæ™¯"><a href="#ä¸¤ç§é”å„è‡ªçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä¸¤ç§é”å„è‡ªçš„ä½¿ç”¨åœºæ™¯"></a>ä¸¤ç§é”å„è‡ªçš„ä½¿ç”¨åœºæ™¯</h4><p>æ‚²è§‚é”é€‚åˆç”¨äº**<u>å¹¶å‘å†™å…¥å¤šã€ä¸´ç•ŒåŒºä»£ç å¤æ‚ã€ç«äº‰æ¿€çƒˆç­‰åœºæ™¯</u>**ï¼Œè¿™ç§åœºæ™¯ä¸‹æ‚²è§‚é”å¯ä»¥é¿å…å¤§é‡çš„æ— ç”¨çš„åå¤å°è¯•ç­‰æ¶ˆè€—ã€‚</p>
<p>ä¹è§‚é”é€‚ç”¨äºå¤§éƒ¨åˆ†æ˜¯è¯»å–ï¼Œå°‘éƒ¨åˆ†æ˜¯ä¿®æ”¹çš„åœºæ™¯ï¼Œä¹Ÿé€‚åˆè™½ç„¶è¯»å†™éƒ½å¾ˆå¤šï¼Œä½†æ˜¯<u>å¹¶å‘å¹¶ä¸æ¿€çƒˆçš„åœºæ™¯</u>ã€‚åœ¨è¿™äº›åœºæ™¯ä¸‹ï¼Œä¹è§‚é”ä¸åŠ é”çš„ç‰¹ç‚¹èƒ½è®©æ€§èƒ½å¤§å¹…æé«˜ã€‚</p>
<h3 id="3-20-å¦‚ä½•çœ‹åˆ°-synchronized-èƒŒåçš„â€œmonitor-é”â€ï¼Ÿ"><a href="#3-20-å¦‚ä½•çœ‹åˆ°-synchronized-èƒŒåçš„â€œmonitor-é”â€ï¼Ÿ" class="headerlink" title="3.20.å¦‚ä½•çœ‹åˆ° synchronized èƒŒåçš„â€œmonitor é”â€ï¼Ÿ"></a>3.20.å¦‚ä½•çœ‹åˆ° synchronized èƒŒåçš„â€œmonitor é”â€ï¼Ÿ</h3><h4 id="è·å–å’Œé‡Šæ”¾-monitor-é”çš„æ—¶æœº"><a href="#è·å–å’Œé‡Šæ”¾-monitor-é”çš„æ—¶æœº" class="headerlink" title="è·å–å’Œé‡Šæ”¾ monitor é”çš„æ—¶æœº"></a>è·å–å’Œé‡Šæ”¾ monitor é”çš„æ—¶æœº</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæœ€ç®€å•çš„åŒæ­¥æ–¹å¼å°±æ˜¯åˆ©ç”¨ synchronized å…³é”®å­—æ¥ä¿®é¥°ä»£ç å—æˆ–è€…ä¿®é¥°ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†è¢«ä¿æŠ¤çš„ä»£ç ï¼Œåœ¨åŒä¸€æ—¶åˆ»å°±æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿è¡Œï¼Œè€Œ synchronized çš„èƒŒåæ­£æ˜¯åˆ©ç”¨ monitor é”å®ç°çš„ã€‚</p>
<p>â€‹	æ‰€ä»¥é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹è·å–å’Œé‡Šæ”¾ monitor é”çš„æ—¶æœºï¼Œ<u>æ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥ç”¨ä½œä¸€ä¸ªå®ç°åŒæ­¥çš„é”ï¼Œè¿™ä¸ªé”ä¹Ÿè¢«ç§°ä¸ºå†…ç½®é”æˆ– monitor é”</u>ï¼Œè·å¾— monitor é”çš„å”¯ä¸€é€”å¾„å°±æ˜¯è¿›å…¥ç”±è¿™ä¸ªé”ä¿æŠ¤çš„åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ï¼Œçº¿ç¨‹åœ¨è¿›å…¥è¢« synchronized ä¿æŠ¤çš„ä»£ç å—ä¹‹å‰ï¼Œä¼šè‡ªåŠ¨è·å–é”ï¼Œå¹¶ä¸”æ— è®ºæ˜¯æ­£å¸¸è·¯å¾„é€€å‡ºï¼Œè¿˜æ˜¯é€šè¿‡æŠ›å‡ºå¼‚å¸¸é€€å‡ºï¼Œåœ¨é€€å‡ºçš„æ—¶å€™éƒ½ä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚	</p>
<p>â€‹	</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">    method body</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç­‰ä»·â¬‡ï¸</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.intrinsicLock.lock();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        method body</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.intrinsicLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§å†™æ³•ä¸­ï¼Œè¿›å…¥ method æ–¹æ³•åï¼Œç«‹åˆ»æ·»åŠ å†…ç½®é”ï¼Œå¹¶ä¸”ç”¨ try ä»£ç å—æŠŠæ–¹æ³•ä¿æŠ¤èµ·æ¥ï¼Œæœ€åç”¨ finally é‡Šæ”¾è¿™æŠŠé”ï¼Œè¿™é‡Œçš„ intrinsicLock å°±æ˜¯ monitor é”ã€‚</p>
<h4 id="synchronized-ä¿®é¥°çš„ä»£ç å—ï¼š"><a href="#synchronized-ä¿®é¥°çš„ä»£ç å—ï¼š" class="headerlink" title="synchronized ä¿®é¥°çš„ä»£ç å—ï¼š"></a>synchronized ä¿®é¥°çš„ä»£ç å—ï¼š</h4><p>åˆ©ç”¨monitorenterä¸monitorexitæŒ‡ä»¤å®ç°ï¼š</p>
<h5 id="monitorenterï¼š"><a href="#monitorenterï¼š" class="headerlink" title="monitorenterï¼š"></a>monitorenterï¼š</h5><p>æ‰§è¡Œ monitorenter çš„çº¿ç¨‹å°è¯•è·å¾— monitor çš„æ‰€æœ‰æƒï¼Œä¼šå‘ç”Ÿä»¥ä¸‹è¿™ä¸‰ç§æƒ…å†µä¹‹ä¸€ï¼š</p>
<p>a. å¦‚æœè¯¥ monitor çš„è®¡æ•°ä¸º 0ï¼Œåˆ™çº¿ç¨‹è·å¾—è¯¥ monitor å¹¶å°†å…¶è®¡æ•°è®¾ç½®ä¸º 1ã€‚ç„¶åï¼Œè¯¥çº¿ç¨‹å°±æ˜¯è¿™ä¸ª monitor çš„æ‰€æœ‰è€…ã€‚</p>
<p>b. å¦‚æœçº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ª monitor ï¼Œåˆ™å®ƒå°†é‡æ–°è¿›å…¥ï¼Œå¹¶ä¸”ç´¯åŠ è®¡æ•°ã€‚</p>
<p>c. å¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ª monitorï¼Œé‚£ä¸ªè¿™ä¸ªçº¿ç¨‹å°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°è¿™ä¸ª monitor çš„è®¡æ•°å˜æˆä¸º 0ï¼Œä»£è¡¨è¿™ä¸ª monitor å·²ç»è¢«é‡Šæ”¾äº†ï¼Œäºæ˜¯å½“å‰è¿™ä¸ªçº¿ç¨‹å°±ä¼šå†æ¬¡å°è¯•è·å–è¿™ä¸ª monitorã€‚</p>
<h5 id="monitorexitï¼š"><a href="#monitorexitï¼š" class="headerlink" title="monitorexitï¼š"></a>monitorexitï¼š</h5><p>monitorexit çš„ä½œç”¨æ˜¯å°† monitor çš„è®¡æ•°å™¨å‡ 1ï¼Œç›´åˆ°å‡ä¸º 0 ä¸ºæ­¢ã€‚ä»£è¡¨è¿™ä¸ª monitor å·²ç»è¢«é‡Šæ”¾äº†ï¼Œå·²ç»æ²¡æœ‰ä»»ä½•çº¿ç¨‹æ‹¥æœ‰å®ƒäº†ï¼Œä¹Ÿå°±ä»£è¡¨ç€è§£é”ï¼Œæ‰€ä»¥ï¼Œå…¶ä»–æ­£åœ¨ç­‰å¾…è¿™ä¸ª monitor çš„çº¿ç¨‹ï¼Œæ­¤æ—¶ä¾¿å¯ä»¥å†æ¬¡å°è¯•è·å–è¿™ä¸ª monitor çš„æ‰€æœ‰æƒã€‚</p>
<h4 id="synchronized-ä¿®é¥°çš„æ–¹æ³•ï¼š"><a href="#synchronized-ä¿®é¥°çš„æ–¹æ³•ï¼š" class="headerlink" title="synchronized ä¿®é¥°çš„æ–¹æ³•ï¼š"></a>synchronized ä¿®é¥°çš„æ–¹æ³•ï¼š</h4><p>â€”â€”åˆ©ç”¨flagå®ç°</p>
<p>â€‹	ä¼šæœ‰ä¸€ä¸ª ACC_SYNCHRONIZED æ ‡å¿—ã€‚å½“æŸä¸ªçº¿ç¨‹è¦è®¿é—®æŸä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šé¦–å…ˆæ£€æŸ¥æ–¹æ³•æ˜¯å¦æœ‰ ACC_SYNCHRONIZED æ ‡å¿—ï¼Œå¦‚æœæœ‰åˆ™éœ€è¦å…ˆè·å¾— monitor é”ï¼Œç„¶åæ‰èƒ½å¼€å§‹æ‰§è¡Œæ–¹æ³•ï¼Œæ–¹æ³•æ‰§è¡Œä¹‹åå†é‡Šæ”¾ monitor é”ã€‚</p>
<h3 id="3-21-synchronized-å’Œ-Lock-å­°ä¼˜å­°åŠ£ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ"><a href="#3-21-synchronized-å’Œ-Lock-å­°ä¼˜å­°åŠ£ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ" class="headerlink" title="3.21.synchronized å’Œ Lock å­°ä¼˜å­°åŠ£ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ"></a>3.21.synchronized å’Œ Lock å­°ä¼˜å­°åŠ£ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ</h3><p>synchronizedä¸å¤Ÿçµæ´»å¹¶åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼Œä½†æ˜¯ï¼š</p>
<ol>
<li>å¦‚æœèƒ½ä¸ç”¨æœ€å¥½æ—¢ä¸ä½¿ç”¨ Lock ä¹Ÿä¸ä½¿ç”¨ synchronizedã€‚å› ä¸ºåœ¨è®¸å¤šæƒ…å†µä¸‹ä½ å¯ä»¥ä½¿ç”¨ java.util.concurrent åŒ…ä¸­çš„æœºåˆ¶ï¼Œå®ƒä¼šä¸ºä½ å¤„ç†æ‰€æœ‰çš„åŠ é”å’Œè§£é”æ“ä½œï¼Œä¹Ÿå°±æ˜¯æ¨èä¼˜å…ˆä½¿ç”¨å·¥å…·ç±»æ¥åŠ è§£é”ã€‚</li>
<li>å¦‚æœ synchronized å…³é”®å­—é€‚åˆä½ çš„ç¨‹åºï¼Œ é‚£ä¹ˆè¯·å°½é‡ä½¿ç”¨å®ƒï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç¼–å†™ä»£ç çš„æ•°é‡ï¼Œå‡å°‘å‡ºé”™çš„æ¦‚ç‡ã€‚å› ä¸ºä¸€æ—¦å¿˜è®°åœ¨ finally é‡Œ unlockï¼Œä»£ç å¯èƒ½ä¼šå‡ºå¾ˆå¤§çš„é—®é¢˜ï¼Œè€Œä½¿ç”¨ synchronized æ›´å®‰å…¨ã€‚</li>
<li>å¦‚æœç‰¹åˆ«éœ€è¦ Lock çš„ç‰¹æ®ŠåŠŸèƒ½ï¼Œæ¯”å¦‚å°è¯•è·å–é”ã€å¯ä¸­æ–­ã€è¶…æ—¶åŠŸèƒ½ç­‰ï¼Œæ‰ä½¿ç”¨ Lockã€‚</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/Java%20%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b%2078%20%e8%ae%b2-%e5%ae%8c/23%20Lock%20%e6%9c%89%e5%93%aa%e5%87%a0%e4%b8%aa%e5%b8%b8%e7%94%a8%e6%96%b9%e6%b3%95%ef%bc%9f%e5%88%86%e5%88%ab%e6%9c%89%e4%bb%80%e4%b9%88%e7%94%a8%ef%bc%9f.md">https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/Java%20%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b%2078%20%e8%ae%b2-%e5%ae%8c/23%20Lock%20%e6%9c%89%e5%93%aa%e5%87%a0%e4%b8%aa%e5%b8%b8%e7%94%a8%e6%96%b9%e6%b3%95%ef%bc%9f%e5%88%86%e5%88%ab%e6%9c%89%e4%bb%80%e4%b9%88%e7%94%a8%ef%bc%9f.md</a></p>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Java%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%2078%20%E8%AE%B2-%E5%AE%8C/">https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Java%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%2078%20%E8%AE%B2-%E5%AE%8C/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6896278031317663751">https://juejin.cn/post/6896278031317663751</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://javadoop.com/post/AbstractQueuedSynchronizer-2">https://javadoop.com/post/AbstractQueuedSynchronizer-2</a></p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://Tangjiayang.github.io">donn</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://tangjiayang.github.io/2023/09/11/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">https://tangjiayang.github.io/2023/09/11/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">å¹¶å‘ç¼–ç¨‹</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230810141014749.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> Donate</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/09/09/MySQL%E9%AB%98%E5%8F%AF%E7%94%A8/" title="MySQLé«˜å¯ç”¨"><img class="cover" src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230727223615031.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">MySQLé«˜å¯ç”¨</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/05/26/java%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/" title="javaåŸç†å­¦ä¹ "><img class="cover" src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230810141014749.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-26</div><div class="title">javaåŸç†å­¦ä¹ </div></div></a></div><div><a href="/2023/08/10/java%E5%9F%BA%E7%A1%80%E5%A4%8D%E4%B9%A0/" title="javaåŸºç¡€å¤ä¹ "><img class="cover" src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230810141014749.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-10</div><div class="title">javaåŸºç¡€å¤ä¹ </div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81ODUzNy8zNTAwMA=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/./img/bg.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">donn</div><div class="author-info__description">æ¬¢è¿è®¿é—®donnçš„åšå®¢!</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">12</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Tangjiayang"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Tangjiayang" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">å°ç«™æˆç«‹äº2023-5-27ï¼</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JAVA%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B"><span class="toc-text">JAVAå¹¶å‘ç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ThreadLocal%E5%AD%A6%E4%B9%A0"><span class="toc-text">ThreadLocalå­¦ä¹ :</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReentrantLock-%E5%92%8C-AQS%EF%BC%9A"><span class="toc-text">ReentrantLock å’Œ AQSï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AFAQS%EF%BC%9F"><span class="toc-text">1.ä»€ä¹ˆæ˜¯AQSï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1%E4%BB%80%E4%B9%88%E6%98%AFCLH%E9%98%9F%E5%88%97%EF%BC%9F"><span class="toc-text">1.1ä»€ä¹ˆæ˜¯CLHé˜Ÿåˆ—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9D%A1%E4%BB%B6%E9%98%9F%E5%88%97%E4%B8%8E%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%EF%BC%9A"><span class="toc-text">2.æ¡ä»¶é˜Ÿåˆ—ä¸é˜»å¡é˜Ÿåˆ—ï¼š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86"><span class="toc-text">è¯»ä¹¦ç¬”è®°æ•´ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-JAVA%E7%BA%BF%E7%A8%8B%E5%AE%9E%E7%8E%B0-x2F-%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="toc-text">3.1.JAVAçº¿ç¨‹å®ç°&#x2F;åˆ›å»ºæ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%9A%A0%EF%B8%8F%E6%9C%AC%E8%B4%A8%E4%B8%8A%EF%BC%8C%E7%BA%BF%E7%A8%8B%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F%E5%8F%AA%E6%9C%89%E4%B8%80%E7%A7%8D-%E2%80%94%E2%80%94%E2%80%94-gt-%E6%9E%84%E9%80%A0%E4%B8%80%E4%B8%AAthread%E7%B1%BB"><span class="toc-text">âš ï¸æœ¬è´¨ä¸Šï¼Œçº¿ç¨‹åˆ›å»ºæ–¹å¼åªæœ‰ä¸€ç§ â€”â€”â€”&gt; æ„é€ ä¸€ä¸ªthreadç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AE%9E%E7%8E%B0-Runnable-%E6%8E%A5%E5%8F%A3%E6%AF%94%E7%BB%A7%E6%89%BF-Thread-%E7%B1%BB%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E8%A6%81%E5%A5%BD%EF%BC%9F"><span class="toc-text">ä¸ºä»€ä¹ˆå®ç° Runnable æ¥å£æ¯”ç»§æ‰¿ Thread ç±»å®ç°çº¿ç¨‹è¦å¥½ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E5%81%9C%E6%AD%A2%E7%BA%BF%E7%A8%8B"><span class="toc-text">3.2.å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E4%BD%BF%E7%94%A8interrupt%E5%81%9C%E6%AD%A2%E7%BA%BF%E7%A8%8B"><span class="toc-text">3.2.1.ä½¿ç”¨interruptåœæ­¢çº¿ç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-sleep-%E6%9C%9F%E9%97%B4%E8%83%BD%E5%90%A6%E6%84%9F%E5%8F%97%E5%88%B0%E4%B8%AD%E6%96%AD%EF%BC%9F"><span class="toc-text">3.2.2.sleep æœŸé—´èƒ½å¦æ„Ÿå—åˆ°ä¸­æ–­ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8-volatile-%E6%A0%87%E8%AE%B0%E4%BD%8D%E7%9A%84%E5%81%9C%E6%AD%A2%E6%96%B9%E6%B3%95%E6%98%AF%E9%94%99%E8%AF%AF%E7%9A%84"><span class="toc-text">3.2.3.ä¸ºä»€ä¹ˆç”¨ volatile æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯é”™è¯¯çš„?</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-3-1-%E5%B8%B8%E8%A7%81%E7%9A%84%E9%94%99%E8%AF%AF%E5%81%9C%E6%AD%A2%E6%96%B9%E6%B3%95"><span class="toc-text">3.2.3.1.å¸¸è§çš„é”™è¯¯åœæ­¢æ–¹æ³•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-3-2volatile%E6%A0%87%E8%AE%B0%E4%BD%8D%E5%81%9C%E6%AD%A2%E7%BA%BF%E7%A8%8B"><span class="toc-text">3.2.3.2volatileæ ‡è®°ä½åœæ­¢çº¿ç¨‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E7%BA%BF%E7%A8%8B%E6%98%AF%E5%A6%82%E4%BD%95%E5%9C%A8-6-%E7%A7%8D%E7%8A%B6%E6%80%81%E4%B9%8B%E9%97%B4%E8%BD%AC%E6%8D%A2%E7%9A%84%EF%BC%9F"><span class="toc-text">3.3.çº¿ç¨‹æ˜¯å¦‚ä½•åœ¨ 6 ç§çŠ¶æ€ä¹‹é—´è½¬æ¢çš„ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-new"><span class="toc-text">3.3.1.new</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-Runnable"><span class="toc-text">3.3.2.Runnable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-%E9%98%BB%E5%A1%9E"><span class="toc-text">3.3.3.é˜»å¡</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-3-1Blocked"><span class="toc-text">3.3.3.1Blocked</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-3-2-Waiting"><span class="toc-text">3.3.3.2.Waiting</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-3-3-TimedWaiting"><span class="toc-text">3.3.3.3.TimedWaiting</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-Terminated"><span class="toc-text">3.3.4.Terminated</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-5-%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2"><span class="toc-text">3.3.5.çº¿ç¨‹çŠ¶æ€è½¬æ¢</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-wait%E3%80%81notify%E3%80%81notifyAll-%E6%96%B9%E6%B3%95%E7%9A%84%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%9F"><span class="toc-text">3.4.waitã€notifyã€notifyAll æ–¹æ³•çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-1%E4%B8%BA%E4%BB%80%E4%B9%88-wait-%E5%BF%85%E9%A1%BB%E5%9C%A8-synchronized-%E4%BF%9D%E6%8A%A4%E7%9A%84%E5%90%8C%E6%AD%A5%E4%BB%A3%E7%A0%81%E4%B8%AD%E4%BD%BF%E7%94%A8%EF%BC%9F"><span class="toc-text">3.4.1ä¸ºä»€ä¹ˆ wait å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-2-%E4%B8%BA%E4%BB%80%E4%B9%88-wait-x2F-notify-x2F-notifyAll-%E8%A2%AB%E5%AE%9A%E4%B9%89%E5%9C%A8-Object-%E7%B1%BB%E4%B8%AD%EF%BC%8C%E8%80%8C-sleep-%E5%AE%9A%E4%B9%89%E5%9C%A8-Thread-%E7%B1%BB%E4%B8%AD%EF%BC%9F"><span class="toc-text">3.4.2.ä¸ºä»€ä¹ˆ wait&#x2F;notify&#x2F;notifyAll è¢«å®šä¹‰åœ¨ Object ç±»ä¸­ï¼Œè€Œ sleep å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-5-wait-x2F-notify-%E5%92%8C-sleep-%E6%96%B9%E6%B3%95%E7%9A%84%E5%BC%82%E5%90%8C%EF%BC%9F"><span class="toc-text">3.4.5.wait&#x2F;notify å’Œ sleep æ–¹æ³•çš„å¼‚åŒï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%90%8C%E7%82%B9%EF%BC%9A"><span class="toc-text">ç›¸åŒç‚¹ï¼š</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E7%82%B9%EF%BC%9A"><span class="toc-text">ä¸åŒç‚¹ï¼š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E4%B8%89%E7%B1%BB%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-text">3.5.ä¸‰ç±»çº¿ç¨‹å®‰å…¨é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E5%85%B8%E5%9E%8B%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-text">ä¸‰ç§å…¸å‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C%E9%94%99%E8%AF%AF"><span class="toc-text">3.1.è¿è¡Œç»“æœé”™è¯¯</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-%E5%8F%91%E5%B8%83%E5%92%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AF%BC%E8%87%B4%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-text">3.2.å‘å¸ƒå’Œåˆå§‹åŒ–å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-%E6%B4%BB%E8%B7%83%E6%80%A7%E9%97%AE%E9%A2%98"><span class="toc-text">3.3.æ´»è·ƒæ€§é—®é¢˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E5%93%AA%E4%BA%9B%E5%9C%BA%E6%99%AF%E9%9C%80%E8%A6%81%E9%A2%9D%E5%A4%96%E6%B3%A8%E6%84%8F%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-text">3.6.å“ªäº›åœºæ™¯éœ€è¦é¢å¤–æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-1-%E8%AE%BF%E9%97%AE%E5%85%B1%E4%BA%AB%E5%8F%98%E9%87%8F%E6%88%96%E8%B5%84%E6%BA%90"><span class="toc-text">3.6.1.è®¿é—®å…±äº«å˜é‡æˆ–èµ„æº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-2-%E4%BE%9D%E8%B5%96%E6%97%B6%E5%BA%8F%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">3.6.2.ä¾èµ–æ—¶åºçš„æ“ä½œ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-3-%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E4%B9%8B%E9%97%B4%E5%AD%98%E5%9C%A8%E7%BB%91%E5%AE%9A%E5%85%B3%E7%B3%BB"><span class="toc-text">3.6.3.ä¸åŒæ•°æ®ä¹‹é—´å­˜åœ¨ç»‘å®šå…³ç³»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-4-%E5%AF%B9%E6%96%B9%E6%B2%A1%E6%9C%89%E5%A3%B0%E6%98%8E%E8%87%AA%E5%B7%B1%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84"><span class="toc-text">3.6.4.å¯¹æ–¹æ²¡æœ‰å£°æ˜è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%BC%9A%E5%B8%A6%E6%9D%A5%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-text">3.7.ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-1%E4%BB%80%E4%B9%88%E6%98%AF%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-text">3.7.1ä»€ä¹ˆæ˜¯æ€§èƒ½é—®é¢˜ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%BC%9A%E5%B8%A6%E6%9D%A5%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-text">3.7.2.ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%8C%9F%E8%B0%83%E5%BA%A6%E5%BC%80%E9%94%80%EF%BC%9A"><span class="toc-text">ğŸŒŸè°ƒåº¦å¼€é”€ï¼š</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%F0%9F%8C%9F%E5%8D%8F%E4%BD%9C%E5%BC%80%E9%94%80%EF%BC%9A"><span class="toc-text">ğŸŒŸåä½œå¼€é”€ï¼š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%AF%94%E6%89%8B%E5%8A%A8%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E5%A5%BD%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F"><span class="toc-text">3.8.ä½¿ç”¨çº¿ç¨‹æ± æ¯”æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å¥½åœ¨å“ªé‡Œï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9F"><span class="toc-text">3.8.1.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8D%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-text">ä¸ä½¿ç”¨çº¿ç¨‹æ± çš„é—®é¢˜ï¼š</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-2-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E6%80%9D%E8%B7%AF%EF%BC%9A"><span class="toc-text">3.8.2.çº¿ç¨‹æ± è§£å†³é—®é¢˜æ€è·¯ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-3-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="toc-text">3.8.3.å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-4-%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%A5%BD%E5%A4%84%EF%BC%9A"><span class="toc-text">3.8.4.ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ï¼š</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%90%84%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84%E5%90%AB%E4%B9%89%EF%BC%9F"><span class="toc-text">3.9.çº¿ç¨‹æ± çš„å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8"><span class="toc-text">å‚æ•°åˆ—è¡¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%8C%9F%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%AD%E7%BA%BF%E7%A8%8B%E5%88%9B%E5%BB%BA%E7%9A%84%E6%97%B6%E6%9C%BA%EF%BC%9A"><span class="toc-text">ğŸŒŸçº¿ç¨‹æ± ä¸­çº¿ç¨‹åˆ›å»ºçš„æ—¶æœºï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-9-1-corePoolSize-%E4%B8%8E-maximumPoolSize"><span class="toc-text">3.9.1.corePoolSize ä¸ maximumPoolSize</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93%EF%BC%9A"><span class="toc-text">å°ç»“ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-9-2-keepAliveTime-%E6%97%B6%E9%97%B4%E5%8D%95%E4%BD%8D"><span class="toc-text">3.9.2.keepAliveTime+æ—¶é—´å•ä½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-9-3-ThreadFactory"><span class="toc-text">3.9.3.ThreadFactory</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-9-4-workQueue-%E5%92%8C-Handler"><span class="toc-text">3.9.4.workQueue å’Œ Handler</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-10-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%9C%89%E5%93%AA-4-%E7%A7%8D%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5%EF%BC%9F"><span class="toc-text">3.10.çº¿ç¨‹æ± æœ‰å“ª 4 ç§æ‹’ç»ç­–ç•¥ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-10-1-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%8B%92%E7%BB%9D%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%97%B6%E6%9C%BA%EF%BC%9A"><span class="toc-text">3.10.1.çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„æ—¶æœºï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-10-2-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%8B%92%E7%BB%9D%E4%BB%BB%E5%8A%A1%E7%9A%84%E7%AD%96%E7%95%A5%EF%BC%9A"><span class="toc-text">3.10.2.çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„ç­–ç•¥ï¼š</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-11-%E6%9C%89%E5%93%AA-6-%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9F%E4%BB%80%E4%B9%88%E6%98%AF-Java8-%E7%9A%84-ForkJoinPool%EF%BC%9F"><span class="toc-text">3.11.æœ‰å“ª 6 ç§å¸¸è§çš„çº¿ç¨‹æ± ï¼Ÿä»€ä¹ˆæ˜¯ Java8 çš„ ForkJoinPoolï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-11-1-FixedThreadPool"><span class="toc-text">3.11.1.FixedThreadPool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-11-2-CachedThreadPool"><span class="toc-text">3.11.2.CachedThreadPool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-11-3-ScheduledThreadPool"><span class="toc-text">3.11.3.ScheduledThreadPool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-11-4-SingleThreadExecutor"><span class="toc-text">3.11.4.SingleThreadExecutor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-11-5-SingleThreadScheduledExecutor"><span class="toc-text">3.11.5.SingleThreadScheduledExecutor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-11-6-ForkJoinPool"><span class="toc-text">3.11.6.ForkJoinPool</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-12-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%B8%B8%E7%94%A8%E7%9A%84%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-text">3.12.çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æœ‰å“ªäº›ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-12-1-LinkedBlockingQueue"><span class="toc-text">3.12.1.LinkedBlockingQueue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-12-2-SynchronousQueue"><span class="toc-text">3.12.2.SynchronousQueue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-12-3-DelayedWorkQueue"><span class="toc-text">3.12.3.DelayedWorkQueue</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-13-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%BA%94%E8%AF%A5%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9F"><span class="toc-text">3.13.ä¸ºä»€ä¹ˆä¸åº”è¯¥è‡ªåŠ¨åˆ›å»ºçº¿ç¨‹æ± ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-14%E5%90%88%E9%80%82%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%95%B0%E9%87%8F%E6%98%AF%E5%A4%9A%E5%B0%91%EF%BC%9FCPU-%E6%A0%B8%E5%BF%83%E6%95%B0%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%95%B0%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9F"><span class="toc-text">3.14åˆé€‚çš„çº¿ç¨‹æ•°é‡æ˜¯å¤šå°‘ï¼ŸCPU æ ¸å¿ƒæ•°å’Œçº¿ç¨‹æ•°çš„å…³ç³»ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CPU-%E5%AF%86%E9%9B%86%E5%9E%8B%E4%BB%BB%E5%8A%A1"><span class="toc-text">CPU å¯†é›†å‹ä»»åŠ¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%80%97%E6%97%B6-IO-%E5%9E%8B%E4%BB%BB%E5%8A%A1"><span class="toc-text">è€—æ—¶ IO å‹ä»»åŠ¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-15-%E5%A6%82%E4%BD%95%E6%A0%B9%E6%8D%AE%E5%AE%9E%E9%99%85%E9%9C%80%E8%A6%81%EF%BC%8C%E5%AE%9A%E5%88%B6%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9F"><span class="toc-text">3.15.å¦‚ä½•æ ¹æ®å®é™…éœ€è¦ï¼Œå®šåˆ¶è‡ªå·±çš„çº¿ç¨‹æ± ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BA%BF%E7%A8%8B%E6%95%B0"><span class="toc-text">æ ¸å¿ƒçº¿ç¨‹æ•°:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E5%A4%A7%E7%BA%BF%E7%A8%8B%E6%95%B0%EF%BC%9A"><span class="toc-text">æœ€å¤§çº¿ç¨‹æ•°ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%EF%BC%9A"><span class="toc-text">é˜»å¡é˜Ÿåˆ—ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%B7%A5%E5%8E%82%EF%BC%9A"><span class="toc-text">çº¿ç¨‹å·¥å‚ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5%EF%BC%9A"><span class="toc-text">æ‹’ç»ç­–ç•¥ï¼š</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-16-%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E5%9C%B0%E5%85%B3%E9%97%AD%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9Fshutdown-%E5%92%8C-shutdownNow-%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">3.16.å¦‚ä½•æ­£ç¡®åœ°å…³é—­çº¿ç¨‹æ± ï¼Ÿshutdown å’Œ shutdownNow çš„åŒºåˆ«ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-16-1-shutdown"><span class="toc-text">3.16.1.shutdown()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-16-2-isShutdown"><span class="toc-text">3.16.2.isShutdown()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-16-3-isTerminated"><span class="toc-text">3.16.3.isTerminated()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-16-4-awaitTermination"><span class="toc-text">3.16.4.awaitTermination()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-16-5-shutdownNow"><span class="toc-text">3.16.5.shutdownNow()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-17-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%AE%9E%E7%8E%B0%E2%80%9C%E7%BA%BF%E7%A8%8B%E5%A4%8D%E7%94%A8%E2%80%9D%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-text">3.17.çº¿ç¨‹æ± å®ç°â€œçº¿ç¨‹å¤ç”¨â€çš„åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-18-%E4%BD%A0%E7%9F%A5%E9%81%93%E5%93%AA%E5%87%A0%E7%A7%8D%E9%94%81%EF%BC%9F%E5%88%86%E5%88%AB%E6%9C%89%E4%BB%80%E4%B9%88%E7%89%B9%E7%82%B9%EF%BC%9F"><span class="toc-text">3.18.ä½ çŸ¥é“å“ªå‡ ç§é”ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-18-1-%E5%81%8F%E5%90%91%E9%94%81-x2F-%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81-x2F-%E9%87%8D%E9%87%8F%E7%BA%A7%E9%94%81"><span class="toc-text">3.18.1.åå‘é”&#x2F;è½»é‡çº§é”&#x2F;é‡é‡çº§é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-18-2-%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81-x2F-%E9%9D%9E%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81"><span class="toc-text">3.18.2.å¯é‡å…¥é”&#x2F;éå¯é‡å…¥é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-18-3-%E5%85%B1%E4%BA%AB%E9%94%81-x2F-%E7%8B%AC%E5%8D%A0%E9%94%81"><span class="toc-text">3.18.3.å…±äº«é”&#x2F;ç‹¬å é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-18-4-%E5%85%AC%E5%B9%B3%E9%94%81-x2F-%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81"><span class="toc-text">3.18.4.å…¬å¹³é”&#x2F;éå…¬å¹³é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-18-5-%E6%82%B2%E8%A7%82%E9%94%81-x2F-%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-text">3.18.5.æ‚²è§‚é”&#x2F;ä¹è§‚é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-18-6-%E8%87%AA%E6%97%8B%E9%94%81-x2F-%E9%9D%9E%E8%87%AA%E6%97%8B%E9%94%81"><span class="toc-text">3.18.6.è‡ªæ—‹é”&#x2F;éè‡ªæ—‹é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-18-7-%E5%8F%AF%E4%B8%AD%E6%96%AD%E9%94%81-x2F-%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E9%94%81"><span class="toc-text">3.18.7.å¯ä¸­æ–­é”&#x2F;ä¸å¯ä¸­æ–­é”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-19-%E6%82%B2%E8%A7%82%E9%94%81%E4%B8%8E%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-text">3.19.æ‚²è§‚é”ä¸ä¹è§‚é”</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A4%E7%A7%8D%E9%94%81%E5%90%84%E8%87%AA%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">ä¸¤ç§é”å„è‡ªçš„ä½¿ç”¨åœºæ™¯</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-20-%E5%A6%82%E4%BD%95%E7%9C%8B%E5%88%B0-synchronized-%E8%83%8C%E5%90%8E%E7%9A%84%E2%80%9Cmonitor-%E9%94%81%E2%80%9D%EF%BC%9F"><span class="toc-text">3.20.å¦‚ä½•çœ‹åˆ° synchronized èƒŒåçš„â€œmonitor é”â€ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%92%8C%E9%87%8A%E6%94%BE-monitor-%E9%94%81%E7%9A%84%E6%97%B6%E6%9C%BA"><span class="toc-text">è·å–å’Œé‡Šæ”¾ monitor é”çš„æ—¶æœº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#synchronized-%E4%BF%AE%E9%A5%B0%E7%9A%84%E4%BB%A3%E7%A0%81%E5%9D%97%EF%BC%9A"><span class="toc-text">synchronized ä¿®é¥°çš„ä»£ç å—ï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#monitorenter%EF%BC%9A"><span class="toc-text">monitorenterï¼š</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#monitorexit%EF%BC%9A"><span class="toc-text">monitorexitï¼š</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#synchronized-%E4%BF%AE%E9%A5%B0%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-text">synchronized ä¿®é¥°çš„æ–¹æ³•ï¼š</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-21-synchronized-%E5%92%8C-Lock-%E5%AD%B0%E4%BC%98%E5%AD%B0%E5%8A%A3%EF%BC%8C%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%EF%BC%9F"><span class="toc-text">3.21.synchronized å’Œ Lock å­°ä¼˜å­°åŠ£ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/09/11/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" title="javaå¹¶å‘ç¼–ç¨‹"><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230810141014749.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="javaå¹¶å‘ç¼–ç¨‹"/></a><div class="content"><a class="title" href="/2023/09/11/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" title="javaå¹¶å‘ç¼–ç¨‹">javaå¹¶å‘ç¼–ç¨‹</a><time datetime="2023-09-11T03:08:03.000Z" title="Created 2023-09-11 11:08:03">2023-09-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/09/MySQL%E9%AB%98%E5%8F%AF%E7%94%A8/" title="MySQLé«˜å¯ç”¨"><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230727223615031.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQLé«˜å¯ç”¨"/></a><div class="content"><a class="title" href="/2023/09/09/MySQL%E9%AB%98%E5%8F%AF%E7%94%A8/" title="MySQLé«˜å¯ç”¨">MySQLé«˜å¯ç”¨</a><time datetime="2023-09-09T08:30:38.000Z" title="Created 2023-09-09 16:30:38">2023-09-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/15/Redis%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/" title="RedisåŸç†å­¦ä¹ "><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230727134719639.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RedisåŸç†å­¦ä¹ "/></a><div class="content"><a class="title" href="/2023/08/15/Redis%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/" title="RedisåŸç†å­¦ä¹ ">RedisåŸç†å­¦ä¹ </a><time datetime="2023-08-15T08:10:37.000Z" title="Created 2023-08-15 16:10:37">2023-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/10/java%E5%9F%BA%E7%A1%80%E5%A4%8D%E4%B9%A0/" title="javaåŸºç¡€å¤ä¹ "><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230810141014749.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="javaåŸºç¡€å¤ä¹ "/></a><div class="content"><a class="title" href="/2023/08/10/java%E5%9F%BA%E7%A1%80%E5%A4%8D%E4%B9%A0/" title="javaåŸºç¡€å¤ä¹ ">javaåŸºç¡€å¤ä¹ </a><time datetime="2023-08-10T06:08:10.000Z" title="Created 2023-08-10 14:08:10">2023-08-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/27/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="è®¡ç®—æœºç½‘ç»œ"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è®¡ç®—æœºç½‘ç»œ"/></a><div class="content"><a class="title" href="/2023/07/27/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="è®¡ç®—æœºç½‘ç»œ">è®¡ç®—æœºç½‘ç»œ</a><time datetime="2023-07-27T14:37:02.000Z" title="Created 2023-07-27 22:37:02">2023-07-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230810141014749.png')"><div id="footer-wrap"><div class="copyright">&copy;2023 By donn</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">å¾ˆé«˜å…´è®¤è¯†ä½ ğŸ¤ª</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>