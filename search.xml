<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ·±åº¦å­¦ä¹ å…¥é—¨</title>
      <link href="/2024/01/21/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8/"/>
      <url>/2024/01/21/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>å®‰è£…anacondaåï¼Œä½¿ç”¨condaæŒ‡ä»¤åˆ›å»ºpytorchç¯å¢ƒï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">conda create -n pytorch python=3.8.18</span><br><span class="line"></span><br><span class="line">åˆ›å»ºå®Œæ¯•åï¼Œä½¿ç”¨å‘½ä»¤æ¿€æ´»/å…³é—­ç¯å¢ƒï¼š</span><br><span class="line">conda activate pytorch</span><br><span class="line">conda deactivate</span><br></pre></td></tr></table></figure><img src="/Users/donn/Library/Application Support/typora-user-images/image-20240123093149437.png" alt="image-20240123093149437" style="zoom:50%;" /><p>åœ¨pytorchå‘½ä»¤è¡Œç¯å¢ƒä¸‹å®‰è£…pytorchï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(pytorch) donn@Macc ~ % pip3 install torch torchvision torchaudio</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æ˜¯å¦å®‰è£…å®Œæˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.è¿›å…¥pythonç¯å¢ƒ</span><br><span class="line">2.import torch è‹¥æœªæŠ¥é”™ï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸ</span><br></pre></td></tr></table></figure><p>tensorboardä½¿ç”¨ï¼š</p><p>â€“æ–¹ä¾¿åœ°ç”¨äºè®°å½•è®­ç»ƒè¿‡ç¨‹ä¸­å„ä¸ªé˜¶æ®µçš„è¾“å…¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensorboard --logdir=logs --port=6007       </span><br></pre></td></tr></table></figure><p>å®‰è£…opencvï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install opencv-python</span><br></pre></td></tr></table></figure><p>è·å–numpyç±»å‹çš„å›¾åƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">image_path = <span class="string">&quot;dataset/train/ants_image/0013035.jpg&quot;</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.<span class="built_in">open</span>(image_path)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(img))</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;PIL.JpegImagePlugin.JpegImageFile&#x27;</span>&gt;</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">img_array = np.array(img)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(img_array))</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;numpy.ndarray&#x27;</span>&gt;</span><br></pre></td></tr></table></figure><p>transformsç»“æ„åŠç”¨æ³•ï¼š</p><p><u>å°±æ˜¯ä¸€ä¸ªå°è£…äº†å¯¹å›¾ç‰‡è¿›è¡Œæ“ä½œçš„å·¥å…·åº“</u></p><p>â€‹transforms.pyå·¥å…·ç®±ï¼š</p><ul><li>totensor</li><li>resize</li><li>â€¦â€¦</li></ul><p>tensoræ•°æ®ç±»å‹ï¼š</p><p>â€‹tensoræ•°æ®ç±»å‹å«æœ‰ç¥ç»ç½‘ç»œä¸­éœ€è¦çš„å„ç§å‚æ•°</p><p>å¦‚ä½•è¯»å–Numpyå‹å›¾åƒæ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line">cv_img = cv2.imread(img_path)</span><br></pre></td></tr></table></figure><p>è¯»å–PILç±»å‹å›¾åƒæ•°æ®å®ä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyData</span>(<span class="title class_ inherited__">Dataset</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, root_dir, label_dir</span>):</span><br><span class="line">        self.root_dir = root_dir</span><br><span class="line">        self.label_dir = label_dir</span><br><span class="line">        self.path = os.path.join(self.root_dir, self.label_dir)</span><br><span class="line">        self.img_path = os.listdir(self.path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, idx</span>):</span><br><span class="line">        img_name = self.img_path[idx]</span><br><span class="line">        img_item_path = os.path.join(self.root_dir, self.label_dir, img_name)</span><br><span class="line">        img = Image.<span class="built_in">open</span>(img_item_path)</span><br><span class="line">        label = self.label_dir</span><br><span class="line">        <span class="keyword">return</span> img, label</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.img_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root_dir = <span class="string">&quot;dataset/train&quot;</span></span><br><span class="line">ants_label_dir = <span class="string">&quot;ants_image&quot;</span></span><br><span class="line">bees_label_dir = <span class="string">&quot;bees_image&quot;</span></span><br><span class="line">ants_dataset = MyData(root_dir, ants_label_dir)</span><br><span class="line">bees_dataset = MyData(root_dir, bees_label_dir)</span><br><span class="line">train_dataset = ants_dataset + bees_dataset</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¸¸è§çš„transformsï¼š"><a href="#å¸¸è§çš„transformsï¼š" class="headerlink" title="å¸¸è§çš„transformsï¼š"></a>å¸¸è§çš„transformsï¼š</h2><h4 id="Normalize"><a href="#Normalize" class="headerlink" title="Normalize:"></a>Normalize:</h4><p>å½’ä¸€åŒ–æ“ä½œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># output[channel] = (input[channel] - mean[channel]) / std[channel]</span></span><br><span class="line"><span class="comment"># print(img_tensor[0][0][0])</span></span><br><span class="line">trans_norm = transforms.Normalize([<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>], [<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>])</span><br><span class="line">img_norm = trans_norm(img_tensor)</span><br><span class="line"><span class="comment"># print(img_norm[0][0][0])</span></span><br><span class="line">writer.add_image(<span class="string">&quot;Normalize&quot;</span>, img_norm, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h4 id="Resizeï¼š"><a href="#Resizeï¼š" class="headerlink" title="Resizeï¼š"></a>Resizeï¼š</h4><p>ç¼©æ”¾ï¼Œ<strong>è¾“å…¥ä¸ºPILæ•°æ®ç±»å‹</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Resize</span></span><br><span class="line"><span class="built_in">print</span>(img.size)</span><br><span class="line">trans_resize = transforms.Resize((<span class="number">512</span>, <span class="number">512</span>))</span><br><span class="line">img_resize = trans_resize(img)</span><br><span class="line">img_resize = trans_totensor(img_resize)</span><br><span class="line">writer.add_image(<span class="string">&quot;Resize&quot;</span>, img_resize, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(img_resize)</span><br></pre></td></tr></table></figure><h4 id="Composeï¼š"><a href="#Composeï¼š" class="headerlink" title="Composeï¼š"></a>Composeï¼š</h4><p>ç­‰æ¯”ç¼©æ”¾(é”å®šé•¿å®½æ¯”)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Compose</span></span><br><span class="line">trans_resize_2 = transforms.Resize(<span class="number">256</span>)</span><br><span class="line">trans_compose = transforms.Compose([trans_resize_2, trans_totensor])</span><br><span class="line">img_resize_2 = trans_compose(img)</span><br><span class="line">writer.add_image(<span class="string">&quot;Resize&quot;</span>, img_resize_2, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>æ€»ç»“ç”¨æ³•ï¼š</p><ul><li>ä½¿ç”¨æ—¶å…ˆçœ‹æºç ï¼Œå…³æ³¨æ–¹æ³•è¾“å…¥å’Œè¾“å‡ºçš„æ•°æ®ç±»å‹<ul><li>ä¸çŸ¥é“è¿”å›å€¼æ•°æ®ç±»å‹æ—¶ï¼Œprintè¯•è¯•æˆ–è€…debugçœ‹çœ‹å‚æ•°</li></ul></li><li>å¤šçœ‹å®˜æ–¹æ–‡æ¡£</li><li>å…³æ³¨æ–¹æ³•éœ€è¦çš„å‚æ•°</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ·±åº¦å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntuå®‰è£…yum</title>
      <link href="/2023/12/20/ubuntu%E5%AE%89%E8%A3%85yum/"/>
      <url>/2023/12/20/ubuntu%E5%AE%89%E8%A3%85yum/</url>
      
        <content type="html"><![CDATA[<h3 id="ubuntuå®‰è£…yum"><a href="#ubuntuå®‰è£…yum" class="headerlink" title="ubuntuå®‰è£…yum"></a>ubuntuå®‰è£…yum</h3><p>æœ€è¿‘æäº†ä¸€å°æœåŠ¡å™¨ï¼Œè‡ªå·±æŠ˜è…¾çš„æ—¶å€™ç”¨åˆ°äº†yumï¼Œå‘ç°ä½¿ç”¨apt-getä¸‹è½½yumæ—¶ä¸€ç›´æŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@iZbp1cml7iso80jlaxx2uZ:/tjy# apt-get install yum</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">E: Unable to locate package yum</span><br></pre></td></tr></table></figure><p>ç½‘ä¸Šæœäº†åŠå¤©ï¼Œè§£å†³æ–¹æ¡ˆæ— éæ˜¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get upgrade</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ ¹æ®æˆ‘çš„å®é™…æƒ…å†µï¼Œæ›´æ–°aptçš„åº“åæ²¡æœ‰ç”¨</p><p>æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼š</p><ol><li>å¤‡ä»½sources.listæ–‡ä»¶</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> /etc/apt/sources.list /etc/apt/sources.list.backup</span><br></pre></td></tr></table></figure><ol start="2"><li>ä¿®æ”¹æº</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure><p>â€‹è¿›å…¥vimå</p><ul><li><p>è¿›å…¥Normalæ¨¡å¼ï¼ˆæŒ‰Escé”®ï¼‰ã€‚</p></li><li><p>è¾“å…¥ggdGå¹¶æŒ‰Enteré”®ã€‚è¿™å°†ä¼šä»å½“å‰å…‰æ ‡ä½ç½®å¼€å§‹åˆ°æ–‡ä»¶çš„æœ€åè¡Œéƒ½è¢«åˆ é™¤ã€‚</p></li><li><p>åˆ é™¤è¿‡åï¼Œæˆ‘ä»¬å…ˆæŸ¥çœ‹æœåŠ¡å™¨çš„ubuntuç‰ˆæœ¬</p></li><li><p>è¿›å…¥<a href="https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/">æ¸…åé•œåƒæº</a>è·å–é•œåƒå†…å®¹ï¼Œ</p><ul><li><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231220143915710.png" alt="image-20231220143915710"></p></li><li><p>é€‰å¥½ubuntuç‰ˆæœ¬åå¤åˆ¶æ¡†ä¸­å†…å®¹è‡³&#x2F;etc&#x2F;apt&#x2F;sources.list</p></li><li><p>åœ¨&#x2F;etc&#x2F;apt&#x2F;sources.listçš„ç¬¬ä¸€è¡Œå†åŠ å…¥ï¼š</p><ul><li><pre><code class="sh">deb http://archive.ubuntu.com/ubuntu/ trusty main universe restricted multiverse<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- åœ¨æˆ‘çš„æœºå­ä¸Šï¼Œsources.listå†…å®¹å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">  ```sh</span><br><span class="line">  deb http://archive.ubuntu.com/ubuntu/ trusty main universe restricted multiverse</span><br><span class="line">  # é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š</span><br><span class="line">  deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse</span><br><span class="line">  # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse</span><br><span class="line">  deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse</span><br><span class="line">  # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse</span><br><span class="line">  deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse</span><br><span class="line">  # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse</span><br><span class="line">  </span><br><span class="line">  deb http://security.ubuntu.com/ubuntu/ jammy-security main restricted universe multiverse</span><br><span class="line">  # deb-src http://security.ubuntu.com/ubuntu/ jammy-security main restricted universe multiverse</span><br><span class="line">  </span><br><span class="line">  # é¢„å‘å¸ƒè½¯ä»¶æºï¼Œä¸å»ºè®®å¯ç”¨</span><br><span class="line">  # deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse</span><br><span class="line">  # # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul></li><li><p>æœ€åè¾“å…¥â€:wqâ€å†å›è½¦å°±ä¿®æ”¹å®Œæ¯•äº†</p></li></ul><ol start="3"><li>ä¿®æ”¹è¿‡åï¼Œéœ€è¦ä»æ–°çš„æºåŠ è½½</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><ol start="4"><li>ä¹‹åæˆ‘ä»¬å†å®‰è£…yumï¼š</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install yum</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™æˆ‘é‡åˆ°äº†æŠ¥é”™ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@iZbp1cmlu7iso80jlaxx2uZ:/etc/apt<span class="comment"># sudo apt-get install yum</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">E: Unable to locate package yum</span><br><span class="line">root@iZbp1cmlu7iso80jlaxx2uZ:/etc/apt<span class="comment"># sudo apt-key adv â€“keyserver keyserver.ubuntu.com â€“recv-keys 40976EAF437D05B5</span></span><br><span class="line">Warning: apt-key is deprecated. Manage keyring files <span class="keyword">in</span> trusted.gpg.d instead (see apt-key(8)).</span><br><span class="line">Executing: /tmp/apt-key-gpghome.J976Sq2yFx/gpg.1.sh â€“keyserver keyserver.ubuntu.com â€“recv-keys 40976EAF437D05B5</span><br><span class="line">gpg: WARNING: no <span class="built_in">command</span> supplied.  Trying to guess what you mean ...</span><br><span class="line">usage: gpg [options] [filename]</span><br><span class="line">root@iZbp1cmlu7iso80jlaxx2uZ:/etc/apt<span class="comment"># sudo apt-key adv â€“keyserver keyserver.ubuntu.com â€“recv-keys 3B4FE6ACC0B21F32</span></span><br><span class="line">Warning: apt-key is deprecated. Manage keyring files <span class="keyword">in</span> trusted.gpg.d instead (see apt-key(8)).</span><br><span class="line">Executing: /tmp/apt-key-gpghome.1L1qF3G0X7/gpg.1.sh â€“keyserver keyserver.ubuntu.com â€“recv-keys 3B4FE6ACC0B21F32</span><br><span class="line">gpg: WARNING: no <span class="built_in">command</span> supplied.  Trying to guess what you mean ...</span><br><span class="line">usage: gpg [options] [filename]</span><br></pre></td></tr></table></figure><p>ä»æŠ¥é”™æç¤ºå¯çœ‹å‡º æ²¡æœ‰æŒ‡å®šçš„å…¬é’¥ï¼Œæ‰§è¡Œå‘½ä»¤å®‰è£…æŒ‡å®šçš„å…¬é’¥å³å¯</p><ol start="5"><li><strong>å®‰è£…å…¬é’¥</strong>(å8ä½å³å¯ä»£è¡¨å…¬é’¥)ï¼š</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-key adv --recv-keys --keyserver keyserver.Ubuntu.com 437D05B5</span><br><span class="line">sudo apt-key adv --recv-keys --keyserver keyserver.Ubuntu.com C0B21F32</span><br></pre></td></tr></table></figure><ol start="6"><li>å®‰è£…å…¬é’¥åï¼Œé‡æ–°åŠ è½½aptåº“</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get upgrade</span><br></pre></td></tr></table></figure><p>å‡ºç°äº†ä»¥ä¸‹è­¦å‘Šï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">The following packages have unmet dependencies:</span><br><span class="line"> python3-six : Breaks: libpython-stdlib (&lt; 2.7.18) but 2.7.5-5ubuntu3 is to be installed</span><br><span class="line">               Breaks: python-minimal (&lt; 2.7.18) but 2.7.5-5ubuntu3 is to be installed</span><br><span class="line"> python3-yaml : Breaks: libpython-stdlib (&lt; 2.7.18) but 2.7.5-5ubuntu3 is to be installed</span><br><span class="line">                Breaks: python-minimal (&lt; 2.7.18) but 2.7.5-5ubuntu3 is to be installed</span><br><span class="line">E: Error, pkgProblemResolver::Resolve generated breaks, this may be caused by held packages.</span><br></pre></td></tr></table></figure><ol start="7"><li><p>æˆ‘ä»¬æ ¹æ®æç¤ºå®‰è£…æ‰€éœ€å³å¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libpython-stdlib</span><br><span class="line">sudo apt install python-minimal</span><br></pre></td></tr></table></figure></li><li><p>æœ€åï¼Œç»ˆäºå®‰è£…æˆåŠŸï¼</p></li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install yum</span><br></pre></td></tr></table></figure><p>æˆæœå±•ç¤ºï¼š</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231220144907106.png" alt="image-20231220144907106" style="zoom:50%;" /><h3 id="åç»­é—®é¢˜ï¼š"><a href="#åç»­é—®é¢˜ï¼š" class="headerlink" title="åç»­é—®é¢˜ï¼š"></a>åç»­é—®é¢˜ï¼š</h3><p>å®‰è£…å¥½yumåï¼Œå°è¯•ä½¿ç”¨yumå®‰è£…ä¸€äº›åº”ç”¨ï¼Œç»“æœæŠ¥é”™ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@iZbp1cmlu7iso80jlaxx2uZ:/tjy<span class="comment"># yum -y install mlocate</span></span><br><span class="line">There are no enabled repos.</span><br><span class="line"> Run <span class="string">&quot;yum repolist all&quot;</span> to see the repos you have.</span><br><span class="line"> You can <span class="built_in">enable</span> repos with yum-config-manager --<span class="built_in">enable</span> &lt;repo&gt;</span><br><span class="line">root@iZbp1cmlu7iso80jlaxx2uZ:/tjy<span class="comment"># yum repolist all</span></span><br><span class="line">repolist: 0</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰repoæ–‡ä»¶â€¦.</p><p>å…¶å®Linuxç³»ç»ŸåŸºæœ¬ä¸Šåˆ†ä¸ºä¸¤å¤§ç±»:</p><p>RedHatç³»åˆ—ï¼šRedhatã€Centosã€Fedoraç­‰</p><ul><li>ä½¿ç”¨ <code>yum</code> å‘½ä»¤å®‰è£…è½¯ä»¶åŒ…</li></ul><p>Debianç³»åˆ—ï¼šDebianã€Ubuntuç­‰</p><ul><li>ä½¿ç”¨ <code>apt-get</code> å‘½ä»¤å®‰è£…è½¯ä»¶åŒ…</li></ul><p>âš ï¸å› æ­¤ç”±äº<code>Ubuntu</code>å±äº<code>Debianç³»åˆ—</code>ä¸­ç›´æ¥ç”¨<code>apt-get</code>è¿›è¡Œè½¯ä»¶åŒ…ä¸‹è½½å³å¯ï¼Œè‡³äºåœ¨Ubuntuä¸­å®‰è£…yumåˆ™æ˜¯ä¸€ä¸ªååˆ†æ„šè ¢çš„æ“ä½œï¼Œè¿™çœŸçš„ç»™æœ¬äººå¥½å¥½ä¸Šäº†ä¸€è¯¾ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ“ä½œç³»ç»ŸåŸç†å­¦ä¹ </title>
      <link href="/2023/10/09/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/10/09/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¡¬ä»¶ç»“æ„ï¼š"><a href="#ç¡¬ä»¶ç»“æ„ï¼š" class="headerlink" title="ç¡¬ä»¶ç»“æ„ï¼š"></a>ç¡¬ä»¶ç»“æ„ï¼š</h1>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
            <tag> åŸç†å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå­¦ä¹ </title>
      <link href="/2023/09/28/Docker%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/09/28/Docker%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>åŸºæœ¬æ¦‚å¿µï¼š</p><p>é•œåƒï¼š</p><p>å®¹å™¨ï¼š</p><p>ä»“åº“ï¼š</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java8æ–°ç‰¹æ€§å­¦ä¹ </title>
      <link href="/2023/09/21/java8%E6%96%B0%E7%89%B9%E6%80%A7%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/09/21/java8%E6%96%B0%E7%89%B9%E6%80%A7%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/language/enhancements.html#javase8">Java8å®˜æ–¹æ–‡æ¡£</a></p><h1 id="Lambdaè¡¨è¾¾å¼ï¼š"><a href="#Lambdaè¡¨è¾¾å¼ï¼š" class="headerlink" title="Lambdaè¡¨è¾¾å¼ï¼š"></a>Lambdaè¡¨è¾¾å¼ï¼š</h1><h3 id="Lambdaè¡¨è¾¾å¼è¯­æ³•åŸºç¡€ï¼š"><a href="#Lambdaè¡¨è¾¾å¼è¯­æ³•åŸºç¡€ï¼š" class="headerlink" title="Lambdaè¡¨è¾¾å¼è¯­æ³•åŸºç¡€ï¼š"></a>Lambdaè¡¨è¾¾å¼è¯­æ³•åŸºç¡€ï¼š</h3><p>â€‹å…³é”®è¿ç®—ç¬¦ï¼š <code>-&gt;</code> (ç®­å¤´æ“ä½œç¬¦æˆ–Lambda æ“ä½œç¬¦)</p><p>æ ¼å¼ï¼šLambda è¡¨è¾¾å¼å‚æ•°åˆ—è¡¨ -&gt; Lambda è¡¨è¾¾å¼ä¸­æ‰€éœ€è¦æ‰§è¡Œçš„åŠŸèƒ½ï¼Œå³Lambda ä½“</p><p><strong>è¯­æ³•æ ¼å¼ä¸€ï¼šæ— å‚æ•°ï¼Œæ— è¿”å›å€¼ã€‚</strong></p><p>â€‹    () -&gt;System.out.println(â€œHelloâ€);</p><p><strong>è¯­æ³•æ ¼å¼äºŒï¼šæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¸”æ— è¿”å›å€¼ã€‚</strong></p><p>â€‹    (e) -&gt; System.out.println(e);</p><p><strong>è¯­æ³•æ ¼å¼ä¸‰ï¼šè‹¥åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå‚æ•°çš„å°æ‹¬å·å¯ä»¥çœç•¥ã€‚</strong></p><p>â€‹    e -&gt; System.out.println(e);</p><p><strong>è¯­æ³•æ ¼å¼å››ï¼šæœ‰ä¸¤ä¸ªä»¥ä¸Šçš„å‚æ•°ï¼Œåˆè¿”å›å€¼ï¼Œæœ‰å¤šæ¡æ‰§è¡Œè¯­å¥ã€‚</strong></p><p>â€‹    (x,y)-&gt; {</p><p>â€‹      System.out.println(â€œLambdaâ€);</p><p>â€‹      return Integer.compare(x,y);</p><p>â€‹    };</p><p><strong>è¯­æ³•æ ¼å¼äº”ï¼šå¦‚æœæœ‰ä¸¤ä¸ªä»¥ä¸Šçš„å‚æ•°ï¼Œåˆè¿”å›å€¼ï¼Œåªæœ‰ä¸€æ¡æ‰§è¡Œè¯­å¥ï¼ŒLambda ä½“çš„å¤§æ‹¬å·å’Œreturnå¯ä»¥çœç•¥ã€‚</strong></p><p>â€‹    Comparator<Integer>con&#x3D;(x,y)-&gt;Integer.compare(x,y);</p><p><strong>è¯­æ³•æ ¼å¼å…­ï¼šLambdaè¡¨è¾¾å¼çš„å‚æ•°åˆ—è¡¨çš„æ•°æ®ç±»å‹å¯ä»¥çœç•¥ä¸å†™ï¼Œå› ä¸ºJVMç¼–è¯‘å™¨å¯ä»¥é€šè¿‡ä¸Šä¸‹æ–‡æ¨æ–­å‡ºæ•°æ®ç±»å‹ï¼Œå³â€œç±»å‹æ¨æ–­â€ã€‚</strong></p><p>â€‹    (Integer x,Integery)-&gt;Integer.compare(x,y);</p><h1 id="å‡½æ•°å¼æ¥å£ï¼š"><a href="#å‡½æ•°å¼æ¥å£ï¼š" class="headerlink" title="å‡½æ•°å¼æ¥å£ï¼š"></a>å‡½æ•°å¼æ¥å£ï¼š</h1><p>Lambdaè¡¨è¾¾å¼å‡½æ•°å¼æ¥å£çš„ä½¿ç”¨æƒ…æ™¯ï¼š</p><p>å‡½æ•°å¼æ¥å£ï¼šåªå®šä¹‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£</p><p>å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Comparator</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">compare</span><span class="params">(T o1, T o2)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨æ¡ˆä¾‹</span></span><br><span class="line">Comparator&lt;Integer&gt; cmp = (o1, o2) -&gt; o2 - o1;</span><br></pre></td></tr></table></figure><h1 id="Streamï¼š"><a href="#Streamï¼š" class="headerlink" title="Streamï¼š"></a>Streamï¼š</h1><p>Streamï¼ˆæµï¼‰æ˜¯ä¸€ä¸ªæ¥è‡ªæ•°æ®æºçš„å…ƒç´ é˜Ÿåˆ—å¹¶æ”¯æŒèšåˆæ“ä½œ</p><p>æˆ‘ä»¬é€šå¸¸å¯¹<code>æ•°ç»„</code>ã€<code>é›†åˆ</code>ç­‰æ•°æ®è¿›è¡Œstreamæ“ä½œ</p><ol><li><p>åœ¨è¿›è¡Œæµæ“ä½œå‰ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›æ•°æ®æµåŒ–ï¼Œå³data.stream()</p></li><li><p>å¾—åˆ°æ•°æ®çš„æµå¯¹è±¡åï¼Œæˆ‘ä»¬æ‰èƒ½ä½¿ç”¨Streamä¸­çš„APIå¯¹å…¶è¿›è¡Œæ“ä½œï¼</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„APIï¼š</p><ul><li><p><strong>map</strong></p><p>map æ–¹æ³•ç”¨äºæ˜ å°„æ¯ä¸ªå…ƒç´ åˆ°å¯¹åº”çš„ç»“æœï¼Œä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ map è¾“å‡ºäº†å…ƒç´ å¯¹åº”çš„å¹³æ–¹æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line"><span class="comment">// è·å–å¯¹åº”çš„å¹³æ–¹æ•°</span></span><br><span class="line">List&lt;Integer&gt; squaresList = numbers.stream().map( i -&gt; i*i).distinct().collect(Collectors.toList());</span><br></pre></td></tr></table></figure></li><li><p><strong>filter</strong></p><p>filter æ–¹æ³•ç”¨äºé€šè¿‡è®¾ç½®çš„æ¡ä»¶è¿‡æ»¤å‡ºå…ƒç´ ã€‚ä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ filter æ–¹æ³•è¿‡æ»¤å‡ºç©ºå­—ç¬¦ä¸²ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt;strings = Arrays.asList(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;bc&quot;</span>, <span class="string">&quot;efg&quot;</span>, <span class="string">&quot;abcd&quot;</span>,<span class="string">&quot;&quot;</span>, <span class="string">&quot;jkl&quot;</span>);</span><br><span class="line"><span class="comment">// è·å–ç©ºå­—ç¬¦ä¸²çš„æ•°é‡</span></span><br><span class="line"><span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> strings.stream().filter(string -&gt; string.isEmpty()).count();</span><br></pre></td></tr></table></figure></li><li><p><strong>limit</strong></p><p>limit æ–¹æ³•ç”¨äºè·å–æŒ‡å®šæ•°é‡çš„æµã€‚ ä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ limit æ–¹æ³•æ‰“å°å‡º 10 æ¡æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">random.ints().limit(<span class="number">10</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure></li><li><p><strong>sorted</strong></p><p>sorted æ–¹æ³•ç”¨äºå¯¹æµè¿›è¡Œæ’åºã€‚ä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ sorted æ–¹æ³•å¯¹è¾“å‡ºçš„ 10 ä¸ªéšæœºæ•°è¿›è¡Œæ’åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">random.ints().limit(<span class="number">10</span>).sorted().forEach(System.out::println);</span><br></pre></td></tr></table></figure></li></ul></li></ol><p>ç»¼åˆä¾‹å­ğŸŒ°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;People&gt; <span class="title function_">createPeople</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Arrays.asList(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">People</span>(<span class="string">&quot;Bob&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">People</span>(<span class="string">&quot;Zlan&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">People</span>(<span class="string">&quot;Clerk&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">People</span>(<span class="string">&quot;Don&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">People</span>(<span class="string">&quot;Eric&quot;</span>, <span class="number">0</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List&lt;People&gt; people = createPeople();</span><br><span class="line">  List&lt;String&gt; name = people.stream()</span><br><span class="line">          .filter(o1 -&gt; o1.getSex() == <span class="number">0</span>)</span><br><span class="line">          .map(o1 -&gt; o1.getName().toUpperCase())</span><br><span class="line">          .sorted(Comparator.reverseOrder())</span><br><span class="line">          .limit(<span class="number">2</span>)</span><br><span class="line">          .collect(Collectors.toList());</span><br><span class="line">  System.out.println(name);</span><br></pre></td></tr></table></figure><p>æœ¬æ–‡ä¸ºå°ç™½ä½œè€…å¯¹java8æ–°ç‰¹æ€§ä¸­çš„Lambdaè¡¨è¾¾å¼ä»¥åŠStreamç›¸å…³APIçš„ç²—æµ…äº†è§£ï¼Œä»…ä»…ä»‹ç»äº†ä¸€äº›å¸¸è§çš„ç”¨æ³•ï¼Œè¯¦ç»†çš„ç”¨æ³•ä»¥åŠåº•å±‚å®ç°åŸç†å¹¶æœªæ·±ç©¶ï¼Œ</p><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://developer.aliyun.com/article/1113942?accounttraceid=a69383829bf74e65a0a1ee91fd532b96ceru">Java 8 æ–°ç‰¹æ€§</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> javaåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> è¯­è¨€åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaå¹¶å‘ç¼–ç¨‹</title>
      <link href="/2023/09/11/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
      <url>/2023/09/11/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="JAVAå¹¶å‘ç¼–ç¨‹"><a href="#JAVAå¹¶å‘ç¼–ç¨‹" class="headerlink" title="JAVAå¹¶å‘ç¼–ç¨‹"></a>JAVAå¹¶å‘ç¼–ç¨‹</h1><h3 id="synchronizeçš„ä½œç”¨èŒƒå›´ï¼š"><a href="#synchronizeçš„ä½œç”¨èŒƒå›´ï¼š" class="headerlink" title="synchronizeçš„ä½œç”¨èŒƒå›´ï¼š"></a>synchronizeçš„ä½œç”¨èŒƒå›´ï¼š</h3><ul><li><strong>ä¿®é¥°å®ä¾‹æ–¹æ³•:</strong> å¯¹å½“å‰<u>å¯¹è±¡å®ä¾‹åŠ é”</u>ï¼Œ<u>è¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰å¯¹è±¡å®ä¾‹çš„é”</u></li><li><strong>ä¿®é¥°é™æ€æ–¹æ³•:</strong> ä¹Ÿå°±æ˜¯ç»™å½“å‰<u>ç±»åŠ é”</u>ï¼Œä¼šä½œç”¨äºç±»çš„æ‰€æœ‰å¯¹è±¡å®ä¾‹ï¼Œå› ä¸ºé™æ€æˆå‘˜ä¸å±äºä»»ä½•ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ˜¯ç±»æˆå‘˜ï¼ˆ static è¡¨æ˜è¿™æ˜¯è¯¥ç±»çš„ä¸€ä¸ªé™æ€èµ„æºï¼Œä¸ç®¡newäº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œåªæœ‰ä¸€ä»½ï¼‰ã€‚**<u>ğŸŒŸæ‰€ä»¥å¦‚æœä¸€ä¸ªçº¿ç¨‹Aè°ƒç”¨ä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„éé™æ€ synchronized æ–¹æ³•ï¼Œè€Œçº¿ç¨‹Béœ€è¦è°ƒç”¨è¿™ä¸ªå®ä¾‹å¯¹è±¡æ‰€å±ç±»çš„é™æ€ synchronized æ–¹æ³•ï¼Œæ˜¯å…è®¸çš„</u><strong>ï¼Œä¸ä¼šå‘ç”Ÿäº’æ–¥ç°è±¡ï¼Œ</strong>å› ä¸ºè®¿é—®é™æ€ synchronized æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰ç±»çš„é”ï¼Œè€Œè®¿é—®éé™æ€ synchronized æ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡é”**ã€‚</li><li><strong>ä¿®é¥°ä»£ç å—:</strong> æŒ‡å®šåŠ é”<u>å¯¹è±¡</u>ï¼Œå¯¹ç»™å®šå¯¹è±¡åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç åº“å‰è¦è·å¾—ç»™å®šå¯¹è±¡çš„é”ã€‚</li></ul><h4 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h4><p>synchronize å¯ä»¥é”ä½ç±»ï¼Œä¹Ÿå¯ä»¥é”ä½ç±»çš„æŸä¸ªå¯¹è±¡ï¼ŒäºŒè€…ç›¸äº’ç‹¬ç«‹ï¼Œä¸å†²çªã€‚</p><h3 id="æ·±å…¥ç†è§£volatileå…³é”®å­—ï¼š"><a href="#æ·±å…¥ç†è§£volatileå…³é”®å­—ï¼š" class="headerlink" title="æ·±å…¥ç†è§£volatileå…³é”®å­—ï¼š"></a>æ·±å…¥ç†è§£volatileå…³é”®å­—ï¼š</h3><h4 id="çŸ¥è¯†é¢„å¤‡ï¼šå¯è§æ€§å’ŒåŸå­æ€§"><a href="#çŸ¥è¯†é¢„å¤‡ï¼šå¯è§æ€§å’ŒåŸå­æ€§" class="headerlink" title="çŸ¥è¯†é¢„å¤‡ï¼šå¯è§æ€§å’ŒåŸå­æ€§"></a>çŸ¥è¯†é¢„å¤‡ï¼šå¯è§æ€§å’ŒåŸå­æ€§</h4><ul><li><strong>åŸå­æ€§</strong>ï¼š<u>ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŒæœ‰æŸä¸ªç‰¹å®šçš„é”ï¼Œä¸€æ¬¡å°±åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿä½¿ç”¨å…±äº«æ•°æ®</u>ã€‚</li><li><strong>å¯è§æ€§</strong>ï¼šå¿…é¡»<u>ç¡®ä¿é‡Šæ”¾é”ä¹‹å‰å¯¹å…±äº«æ•°æ®åšå‡ºçš„æ›´æ”¹å¯¹äºéšåè·å¾—è¯¥é”çš„å¦ä¸€ä¸ªçº¿ç¨‹æ˜¯å¯è§çš„</u> ã€‚</li></ul><h4 id="volatileèƒ½å¤Ÿä¿è¯å¯è§æ€§ï¼š"><a href="#volatileèƒ½å¤Ÿä¿è¯å¯è§æ€§ï¼š" class="headerlink" title="volatileèƒ½å¤Ÿä¿è¯å¯è§æ€§ï¼š"></a>volatileèƒ½å¤Ÿä¿è¯å¯è§æ€§ï¼š</h4><p>â€‹ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œè¿™æ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯ç«‹å³å¯è§çš„</p><h4 id="è€Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼š"><a href="#è€Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼š" class="headerlink" title="è€Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼š"></a>è€Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼š</h4><p>â€‹ä¸èƒ½ä¿è¯<code>volatile</code>å˜é‡å¤åˆæ“ä½œçš„åŸå­æ€§ï¼Œå› ä¸ºåŒä¸€å®ç°å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹å¯¹å˜é‡è¿›è¡Œä¿®æ”¹ã€‚</p><p>ä¸€ä¸ªä¾‹å­è¯´æ˜ä½“ç°volatileçš„å¯è§æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileVisibilityExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// çº¿ç¨‹Aä¿®æ”¹flagçš„å€¼ä¸ºtrue</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            flag = <span class="literal">true</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread A sets flag to true&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// çº¿ç¨‹Bæ£€æŸ¥flagçš„å€¼ï¼Œå¦‚æœä¸ºtrueåˆ™è¾“å‡ºæ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (!flag) &#123;</span><br><span class="line">                <span class="comment">// å¾ªç¯ç­‰å¾…ï¼Œç›´åˆ°flagçš„å€¼å˜ä¸ºtrue</span></span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread B detects flag is now true&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">VolatileVisibilityExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VolatileVisibilityExample</span>();</span><br><span class="line">        example.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æŒ‡ä»¤é‡æ’åºï¼š"><a href="#æŒ‡ä»¤é‡æ’åºï¼š" class="headerlink" title="æŒ‡ä»¤é‡æ’åºï¼š"></a>æŒ‡ä»¤é‡æ’åºï¼š</h4><p>â€‹æŒ‡ä»¤é‡æ’åºå¯ä»¥ä¼˜åŒ–ä»£ç çš„æ‰§è¡Œé¡ºåºï¼Œä½†ä¸èƒ½æ”¹å˜å˜é‡çš„æœ€ç»ˆç»“æœã€‚</p><p>â€‹<strong>æ¯”å¦‚ï¼š</strong>å¯¹ä¸€ä¸ªå˜é‡çš„ä¸¤æ¬¡å†™æ“ä½œçš„ç›¸å¯¹ä½ç½®ä¸èƒ½æ”¹å˜ï¼Œè‹¥æ”¹å˜äº†çš„è¯ï¼Œå°±å¯¼è‡´æœ€ç»ˆçš„ç»“æœä¹Ÿå‘ç”Ÿæ”¹å˜äº†ã€‚ã€‚ã€‚</p><p>ä¾‹å­ğŸŒ°ï¼š<u>å•ä¾‹æ¨¡å¼åŒé‡æ£€æŸ¥æ–¹å¼ä¸ºä»€ä¹ˆè¦ç»™å•ä¾‹å±æ€§æ·»åŠ volatileä¿®é¥°ï¼Ÿ</u></p><p>new å…³é”®å­—åˆ›å»ºå¯¹è±¡ä¸æ˜¯åŸâ¼¦æ“ä½œï¼Œåˆ›å»ºâ¼€ä¸ªå¯¹è±¡ä¼šç»å†ä¸‹â¾¯çš„æ­¥éª¤ï¼š</p><ol><li>åœ¨å †å†…å­˜å¼€è¾Ÿå†…å­˜ç©ºé—´</li><li>è°ƒâ½¤æ„é€ â½…æ³•ï¼Œåˆå§‹åŒ–å¯¹è±¡</li><li>å¼•â½¤å˜é‡æŒ‡å‘å †å†…å­˜ç©ºé—´</li></ol><p>â€‹ä¸ºäº†æâ¾¼æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æ—¢å®šçš„ä»£ç æ‰§â¾é¡ºåºè¿›â¾æŒ‡ä»¤é‡æ’åºï¼Œä»æºç åˆ°æœ€ç»ˆæ‰§â¾æŒ‡ä»¤ä¼šç»å†å¦‚ä¸‹æµç¨‹ï¼š</p><ul><li>æºç ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’åºæŒ‡ä»¤çº§å¹¶â¾é‡æ’åºå†…å­˜ç³»ç»Ÿé‡æ’åºæœ€ç»ˆæ‰§â¾æŒ‡ä»¤åºåˆ—æ‰€ä»¥ç»è¿‡**<u>æŒ‡ä»¤é‡æ’åº</u><strong>ä¹‹åï¼Œåˆ›å»ºå¯¹è±¡çš„æ‰§â¾é¡ºåºå¯èƒ½ä¸º 1 2 3 æˆ–è€… 1 3 2 ï¼Œå› æ­¤å½“æŸä¸ªçº¿ç¨‹åœ¨ä¹±åºè¿â¾ 1 3 2 æŒ‡ä»¤çš„æ—¶å€™ï¼Œå¼•â½¤å˜é‡æŒ‡å‘å †å†…å­˜ç©ºé—´ï¼Œè¿™ä¸ªå¯¹è±¡ä¸ä¸º nullï¼Œä½†æ˜¯æ²¡æœ‰åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹æœ‰å¯èƒ½è¿™ä¸ªæ—¶å€™è¿›â¼Šäº† getInstance çš„ç¬¬â¼€ä¸ª if(instance &#x3D;&#x3D; null) åˆ¤æ–­ä¸ä¸º nulll ï¼Œå¯¼è‡´</strong>é”™è¯¯ä½¿â½¤äº†æ²¡æœ‰åˆå§‹åŒ–çš„â¾® null å®ä¾‹**ï¼Œè¿™æ ·çš„è¯å°±ä¼šå‡ºç°å¼‚å¸¸ï¼Œè¿™ä¸ªå°±æ˜¯è‘—åçš„</li><li>DCL å¤±æ•ˆé—®é¢˜ã€‚</li><li>å½“æˆ‘ä»¬åœ¨å¼•â½¤å˜é‡ä¸Šâ¾¯æ·»åŠ  volatile å…³é”®å­—ä»¥åï¼Œä¼šé€šè¿‡åœ¨åˆ›å»ºå¯¹è±¡æŒ‡ä»¤çš„å‰åæ·»åŠ å†…å­˜å±éšœæ¥ç¦â½ŒæŒ‡ä»¤é‡æ’åºï¼Œå°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œâ½½ä¸”å¯¹volatile ä¿®é¥°çš„å˜é‡çš„ä¿®æ”¹å¯¹å…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½æ˜¯å¯â»…çš„ã€‚</li></ul><h3 id="ThreadLocalå­¦ä¹ "><a href="#ThreadLocalå­¦ä¹ " class="headerlink" title="ThreadLocalå­¦ä¹ :"></a>ThreadLocalå­¦ä¹ :</h3><p>â€‹<a href="https://juejin.cn/post/7166202551782604837?searchId=20230911163742D2E0FFFACF74510D0A74#heading-10">å¥½æ–‡æ¨è</a></p><p>â€‹ThreadLocal:é¡¾åæ€ä¹‰ï¼Œçº¿ç¨‹çš„â€œæœ¬åœ°å˜é‡â€</p><p>â€‹è¿™ç§å˜é‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è®¿é—®(é€šè¿‡getå’Œsetæ–¹æ³•è®¿é—®)æ—¶èƒ½å¤Ÿä¿è¯å„ä¸ªçº¿ç¨‹çš„å˜é‡ç›¸å¯¹ç‹¬ç«‹äºå…¶ä»–çº¿ç¨‹å†…çš„å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰°ï¼Œè¿™ç§å˜é‡åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…èµ·ä½œç”¨ï¼Œ<strong>å‡å°‘åŒä¸€ä¸ªçº¿ç¨‹å†…å¤šä¸ªå‡½æ•°æˆ–ç»„ä»¶ä¹‹é—´ä¸€äº›å…¬å…±å˜é‡ä¼ é€’çš„å¤æ‚åº¦ã€‚</strong></p><p>â€‹<strong>set æ–¹æ³•ï¼š</strong></p><p>é€šè¿‡å½“å‰çº¿ç¨‹å¯¹è±¡ thread è·å–è¯¥ thread æ‰€ç»´æŠ¤çš„ ThreadLocalMapï¼Œå¦‚æœ ThreadLocalMap ä¸ä¸º nullï¼Œåˆ™ä»¥ ThreadLocal å®ä¾‹ä¸º keyï¼Œå€¼ä¸º value çš„é”®å€¼å¯¹å­˜å…¥ ThreadLocalMapï¼Œè‹¥ ThreadLocalMap ä¸º null çš„è¯ï¼Œå°±æ–°å»º ThreadLocalMapï¼Œç„¶åå†ä»¥ ThreadLocal ä¸ºé”®ï¼Œå€¼ä¸º value çš„é”®å€¼å¯¹å­˜å…¥å³å¯ã€‚</p><p>â€‹<strong>get æ–¹æ³•ï¼š</strong></p><p>é€šè¿‡å½“å‰çº¿ç¨‹ thread å®ä¾‹è·å–åˆ°å®ƒæ‰€ç»´æŠ¤çš„ ThreadLocalMapï¼Œç„¶åä»¥å½“å‰ ThreadLocal å®ä¾‹ä¸º key è·å–è¯¥ map ä¸­çš„é”®å€¼å¯¹ï¼ˆEntryï¼‰ï¼Œå¦‚æœ Entry ä¸ä¸º null åˆ™è¿”å› Entry çš„ valueã€‚å¦‚æœè·å– ThreadLocalMap ä¸º null æˆ–è€… Entry ä¸º null çš„è¯ï¼Œå°±ä»¥å½“å‰ ThreadLocal ä¸º Keyï¼Œvalue ä¸º null å­˜å…¥ map åï¼Œå¹¶è¿”å› nullã€‚</p><p>ä½¿ç”¨å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">T</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºThreadLocalå¯¹è±¡, åšæˆpublic static.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;Object&gt; threadLocal1 = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;Object&gt; threadLocal2 = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Task æ˜¯çº¿ç¨‹ç±» -&gt; å†…éƒ¨ç±» / çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Task</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">            <span class="type">Pig</span> <span class="variable">pig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Pig</span>();</span><br><span class="line">            <span class="comment">//ç»™threadLocal1 å¯¹è±¡æ”¾å…¥set dog , éš”å±±æ‰“ç‰›</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Task æ”¾å…¥äº† dog= &quot;</span> + dog);</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                è§£è¯»:</span></span><br><span class="line"><span class="comment">                public void set(T value) &#123;</span></span><br><span class="line"><span class="comment">                    //1. è·å–å½“å‰çº¿ç¨‹, å…³è”åˆ°å½“å‰çº¿ç¨‹!</span></span><br><span class="line"><span class="comment">                    Thread t = Thread.currentThread();</span></span><br><span class="line"><span class="comment">                    //2. é€šè¿‡çº¿ç¨‹å¯¹è±¡, è·å–åˆ°ThreadLocalMap</span></span><br><span class="line"><span class="comment">                    //   ThreadLocalMap ç±»å‹ ThreadLocal.ThreadLocalMap</span></span><br><span class="line"><span class="comment">                    ThreadLocalMap map = getMap(t);</span></span><br><span class="line"><span class="comment">                    //3. å¦‚æœmapä¸ä¸ºnull, å°†æ•°æ®(dog,pig..) æ”¾å…¥map </span></span><br><span class="line"><span class="comment">                    -key:threadLocal value:å­˜æ”¾çš„æ•°æ®</span></span><br><span class="line"><span class="comment">                    //ä»è¿™ä¸ªæºç æˆ‘ä»¬å·²ç„¶çœ‹å‡ºä¸€ä¸ªthreadlocalåªèƒ½å…³è”ä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœä½ set, å°±ä¼šæ›¿æ¢</span></span><br><span class="line"><span class="comment">                    //4. å¦‚æœmapä¸ºnull, å°±åˆ›å»ºä¸€ä¸ªå’Œå½“å‰çº¿ç¨‹å…³è”çš„ThreadLocalMap, å¹¶ä¸”è¯¥æ•°æ®æ”¾å…¥</span></span><br><span class="line"><span class="comment">                    if (map != null)</span></span><br><span class="line"><span class="comment">                        map.set(this, value);</span></span><br><span class="line"><span class="comment">                    else</span></span><br><span class="line"><span class="comment">                        createMap(t, value);</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            threadLocal1.set(dog);</span><br><span class="line">            <span class="comment">//threadLocal1.set(pig);//æ›¿æ¢</span></span><br><span class="line">            threadLocal2.set(pig);<span class="comment">//è¿™ä¸ªæ•°æ®å°±ä¼šthreadLocal2å…³è”ï¼Œå¹¶ä¸”éƒ½è¢«å½“å‰Threadç®¡ç†</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Task åœ¨run æ–¹æ³•ä¸­ çº¿ç¨‹=&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">T1Service</span>().update();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Task</span>()).start();<span class="comment">//ä¸»çº¿ç¨‹å¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹,æ³¨æ„ä¸æ˜¯ä¸»çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºstaticä¿®é¥°çš„ ThreadLocal å¯¹è±¡äºè¿è¡Œçº¿ç¨‹çš„ç±»ä¸­ï¼Œ</p><p>çº¿ç¨‹ Thread t ç»´æŠ¤ä¸€ä¸ªå±æ€§ï¼š(æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¸åŒçš„HashMap)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Thread å¯¹è±¡çš„å®ä¾‹æ•°æ®</span></span><br><span class="line">ThreadLocal.<span class="type">ThreadLocalMap</span> <span class="variable">threadLocals</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p> å®ƒæ˜¯ä¸€ä¸ªHashMapï¼Œé‡Œé¢çš„Entryçš„ç»“æ„ä¸º(key, value) â€”&gt; (çº¿ç¨‹idï¼Œ å€¼)</p><p>ğŸŒŸä¸€ä¸ªçº¿ç¨‹æ‰€åœ¨çš„ç±»å¯ä»¥æœ‰å¤šä¸ª<strong>ThreadLocal</strong>å¯¹è±¡ï¼Œæ¯ä¸ªthreadLocalå¯¹è±¡éƒ½ä¼š**<u>åœ¨çº¿ç¨‹ç»´æŠ¤çš„threadLocalsä¸­ä»¥é”®çš„å½¢å¼å­˜åœ¨</u>**ã€‚</p><h3 id="ReentrantLock-å’Œ-AQSï¼š"><a href="#ReentrantLock-å’Œ-AQSï¼š" class="headerlink" title="ReentrantLock å’Œ AQSï¼š"></a>ReentrantLock å’Œ AQSï¼š</h3><h4 id="1-ä»€ä¹ˆæ˜¯AQSï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯AQSï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯AQSï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯AQSï¼Ÿ</h4><p>â€‹AQS ä¸­ä½¿ç”¨çš„æ˜¯ CLH å˜ä½“é˜Ÿåˆ—</p><h5 id="1-1ä»€ä¹ˆæ˜¯CLHé˜Ÿåˆ—ï¼Ÿ"><a href="#1-1ä»€ä¹ˆæ˜¯CLHé˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="1.1ä»€ä¹ˆæ˜¯CLHé˜Ÿåˆ—ï¼Ÿ"></a>1.1ä»€ä¹ˆæ˜¯CLHé˜Ÿåˆ—ï¼Ÿ</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230911112324020.png" alt="image-20230911112324020"></p><ul><li>CLHï¼šæ˜¯ <strong>å•å‘é“¾è¡¨å®ç°çš„é˜Ÿåˆ—</strong>ã€‚ç”³è¯·çº¿ç¨‹åªåœ¨æœ¬åœ°å˜é‡ä¸Šè‡ªæ—‹ï¼Œ<strong>å®ƒä¸æ–­è½®è¯¢å‰é©±çš„çŠ¶æ€</strong>ï¼Œå¦‚æœå‘ç° <strong>å‰é©±èŠ‚ç‚¹é‡Šæ”¾äº†é”å°±ç»“æŸè‡ªæ—‹ã€‚</strong><ul><li>CLH é˜Ÿåˆ—æ˜¯ä¸€ä¸ª<u>å•å‘é“¾è¡¨</u>ï¼Œä¿æŒ FIFO å…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ç‰¹æ€§</li><li>é€šè¿‡ tail å°¾èŠ‚ç‚¹ï¼ˆåŸå­å¼•ç”¨ï¼‰æ¥æ„å»ºé˜Ÿåˆ—ï¼Œæ€»æ˜¯æŒ‡å‘æœ€åä¸€ä¸ªèŠ‚ç‚¹</li><li>æœªè·å¾—é”èŠ‚ç‚¹ä¼šè¿›è¡Œ<strong>è‡ªæ—‹</strong>ï¼Œè€Œä¸æ˜¯åˆ‡æ¢çº¿ç¨‹çŠ¶æ€</li><li>å¹¶å‘é«˜æ—¶æ€§èƒ½è¾ƒå·®ï¼Œå› ä¸ºæœªè·å¾—é”èŠ‚ç‚¹ä¸æ–­è½®è®­å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€æ¥æŸ¥çœ‹æ˜¯å¦è·å¾—é”</li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230911143653012.png" alt="image-20230911143653012"></p><p>ç›¸æ¯”äº CLH é˜Ÿåˆ—è€Œè¨€ï¼ŒAQS ä¸­çš„ CLH å˜ä½“ç­‰å¾…é˜Ÿåˆ—æ‹¥æœ‰ä»¥ä¸‹ç‰¹æ€§</p><ol><li>AQS ä¸­é˜Ÿåˆ—æ˜¯ä¸ª<strong>åŒå‘é“¾è¡¨</strong>ï¼Œä¹Ÿæ˜¯ FIFO å…ˆè¿›å…ˆå‡ºçš„ç‰¹æ€§</li><li>é€šè¿‡ Headã€Tail å¤´å°¾ä¸¤ä¸ªèŠ‚ç‚¹æ¥ç»„æˆé˜Ÿåˆ—ç»“æ„ï¼Œé€šè¿‡ volatile ä¿®é¥°ä¿è¯å¯è§æ€§</li><li>Head æŒ‡å‘èŠ‚ç‚¹ä¸ºå·²è·å¾—é”çš„èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹æœ¬èº«ä¸æŒæœ‰å…·ä½“çº¿ç¨‹</li><li>è·å–ä¸åˆ°åŒæ­¥çŠ¶æ€ï¼Œä¼šå°†èŠ‚ç‚¹è¿›è¡Œ<strong>è‡ªæ—‹</strong>è·å–é”ï¼Œè‡ªæ—‹ä¸€å®šæ¬¡æ•°å¤±è´¥åä¼šå°†çº¿ç¨‹é˜»å¡ï¼Œç›¸å¯¹äº CLH é˜Ÿåˆ—æ€§èƒ½è¾ƒå¥½</li></ol><p><strong>å½“å‰çº¿ç¨‹è·å–é”å¤±è´¥æ—¶ï¼ŒReentrantLocké¦–å…ˆå†tryAcquire()ä¸€ä¸‹ï¼ŒtryAcquireå¤±è´¥ï¼Œåˆ™AQSä¼šå°†å½“å‰çº¿ç¨‹ä»¥åŠç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯æ„é€ æˆä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeå¯¹è±¡ï¼‰å¹¶å°†å…¶åŠ å…¥AQSä¸­ï¼ŒåŒæ—¶ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚</strong></p><h4 id="2-æ¡ä»¶é˜Ÿåˆ—ä¸é˜»å¡é˜Ÿåˆ—ï¼š"><a href="#2-æ¡ä»¶é˜Ÿåˆ—ä¸é˜»å¡é˜Ÿåˆ—ï¼š" class="headerlink" title="2.æ¡ä»¶é˜Ÿåˆ—ä¸é˜»å¡é˜Ÿåˆ—ï¼š"></a>2.æ¡ä»¶é˜Ÿåˆ—ä¸é˜»å¡é˜Ÿåˆ—ï¼š</h4><p>â€‹<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230911162425877.png" alt="image-20230911162425877"></p><ul><li>æ¡ä»¶é˜Ÿåˆ—å’Œé˜»å¡é˜Ÿåˆ—çš„èŠ‚ç‚¹ï¼Œéƒ½æ˜¯ Node çš„å®ä¾‹ï¼Œå› ä¸ºæ¡ä»¶é˜Ÿåˆ—çš„èŠ‚ç‚¹æ˜¯éœ€è¦è½¬ç§»åˆ°é˜»å¡é˜Ÿåˆ—ä¸­å»çš„ï¼›</li><li>æˆ‘ä»¬çŸ¥é“ä¸€ä¸ª ReentrantLock å®ä¾‹å¯ä»¥é€šè¿‡å¤šæ¬¡è°ƒç”¨ newCondition() æ¥äº§ç”Ÿå¤šä¸ª Condition å®ä¾‹ï¼Œè¿™é‡Œå¯¹åº” condition1 å’Œ condition2ã€‚æ³¨æ„ï¼ŒConditionObject åªæœ‰ä¸¤ä¸ªå±æ€§ firstWaiter å’Œ lastWaiterï¼›</li><li>æ¯ä¸ª condition æœ‰ä¸€ä¸ªå…³è”çš„<strong>æ¡ä»¶é˜Ÿåˆ—</strong>ï¼Œå¦‚çº¿ç¨‹ 1 è°ƒç”¨ <code>condition1.await()</code> æ–¹æ³•å³å¯å°†å½“å‰çº¿ç¨‹ 1 åŒ…è£…æˆ Node ååŠ å…¥åˆ°æ¡ä»¶é˜Ÿåˆ—ä¸­ï¼Œç„¶åé˜»å¡åœ¨è¿™é‡Œï¼Œä¸ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œ**<u>æ¡ä»¶é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨</u>**ï¼›</li><li>ğŸŒŸè°ƒç”¨<code>condition1.signal()</code> è§¦å‘ä¸€æ¬¡å”¤é†’ï¼Œæ­¤æ—¶å”¤é†’çš„æ˜¯é˜Ÿå¤´ï¼Œä¼šå°†condition1 å¯¹åº”çš„<strong>æ¡ä»¶é˜Ÿåˆ—</strong>çš„ firstWaiterï¼ˆé˜Ÿå¤´ï¼‰ ç§»åˆ°<strong>é˜»å¡é˜Ÿåˆ—çš„é˜Ÿå°¾</strong>ï¼Œç­‰å¾…è·å–é”ï¼Œè·å–é”å await æ–¹æ³•æ‰èƒ½è¿”å›ï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</li></ul><h3 id="çº¿ç¨‹æ± ï¼š"><a href="#çº¿ç¨‹æ± ï¼š" class="headerlink" title="çº¿ç¨‹æ± ï¼š"></a>çº¿ç¨‹æ± ï¼š</h3><h4 id="çº¿ç¨‹æ± å‚æ•°ï¼š"><a href="#çº¿ç¨‹æ± å‚æ•°ï¼š" class="headerlink" title="çº¿ç¨‹æ± å‚æ•°ï¼š"></a>çº¿ç¨‹æ± å‚æ•°ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a new &#123;<span class="doctag">@code</span> ThreadPoolExecutor&#125; with the given initial</span></span><br><span class="line"><span class="comment"> * parameters.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> corePoolSize the number of threads to keep in the pool, even</span></span><br><span class="line"><span class="comment"> *        if they are idle, unless &#123;<span class="doctag">@code</span> allowCoreThreadTimeOut&#125; is set</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> maximumPoolSize the maximum number of threads to allow in the</span></span><br><span class="line"><span class="comment"> *        pool</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> keepAliveTime when the number of threads is greater than</span></span><br><span class="line"><span class="comment"> *        the core, this is the maximum time that excess idle threads</span></span><br><span class="line"><span class="comment"> *        will wait for new tasks before terminating.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> unit the time unit for the &#123;<span class="doctag">@code</span> keepAliveTime&#125; argument</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> workQueue the queue to use for holding tasks before they are</span></span><br><span class="line"><span class="comment"> *        executed.  This queue will hold only the &#123;<span class="doctag">@code</span> Runnable&#125;</span></span><br><span class="line"><span class="comment"> *        tasks submitted by the &#123;<span class="doctag">@code</span> execute&#125; method.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> threadFactory the factory to use when the executor</span></span><br><span class="line"><span class="comment"> *        creates a new thread</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> handler the handler to use when execution is blockedæ‹’ç»ç­–ç•¥</span></span><br><span class="line"><span class="comment"> *        because the thread bounds and queue capacities are reached</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException if one of the following holds: ä¸åˆæ³•å‚æ•°å€¼å¼‚å¸¸</span></span><br><span class="line"><span class="comment"> *         &#123;<span class="doctag">@code</span> corePoolSize &lt; 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment"> *         &#123;<span class="doctag">@code</span> keepAliveTime &lt; 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment"> *         &#123;<span class="doctag">@code</span> maximumPoolSize &lt;= 0&#125;&lt;br&gt;</span></span><br><span class="line"><span class="comment"> *         &#123;<span class="doctag">@code</span> maximumPoolSize &lt; corePoolSize&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NullPointerException if &#123;<span class="doctag">@code</span> workQueue&#125;ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line"><span class="comment"> *         or &#123;<span class="doctag">@code</span> threadFactory&#125; or &#123;<span class="doctag">@code</span> handler&#125; is null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize, //æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line"><span class="params">                          <span class="type">int</span> maximumPoolSize, //æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line"><span class="params">                          <span class="type">long</span> keepAliveTime, //ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´</span></span><br><span class="line"><span class="params">                          TimeUnit unit, //å­˜æ´»æ—¶é—´å•ä½</span></span><br><span class="line"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue, //ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="params">                          ThreadFactory threadFactory, //æ–°çº¿ç¨‹çš„äº§ç”Ÿæ–¹å¼</span></span><br><span class="line"><span class="params">                          RejectedExecutionHandler handler //æ‹’ç»ç­–ç•¥)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="literal">null</span> || threadFactory == <span class="literal">null</span> || handler == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="built_in">this</span>.acc = System.getSecurityManager() == <span class="literal">null</span> ?</span><br><span class="line">            <span class="literal">null</span> :</span><br><span class="line">            AccessController.getContext();</span><br><span class="line">    <span class="built_in">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="built_in">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="built_in">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="built_in">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="built_in">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="built_in">this</span>.handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‘çº¿ç¨‹æ± ä¸­æ·»åŠ ä»»åŠ¡ï¼š"><a href="#å‘çº¿ç¨‹æ± ä¸­æ·»åŠ ä»»åŠ¡ï¼š" class="headerlink" title="å‘çº¿ç¨‹æ± ä¸­æ·»åŠ ä»»åŠ¡ï¼š"></a>å‘çº¿ç¨‹æ± ä¸­æ·»åŠ ä»»åŠ¡ï¼š</h4><p>ThreadPoolExecutor.execute(Runnable command)æ–¹æ³•ï¼Œå³å¯å‘çº¿ç¨‹æ± å†…æ·»åŠ ä¸€ä¸ªä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Executes the given task sometime in the future.  The task</span></span><br><span class="line"><span class="comment"> * may execute in a new thread or in an existing pooled thread.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If the task cannot be submitted for execution, either because this</span></span><br><span class="line"><span class="comment"> * executor has been shutdown or because its capacity has been reached,</span></span><br><span class="line"><span class="comment"> * the task is handled by the current &#123;<span class="doctag">@code</span> RejectedExecutionHandler&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> command the task to execute</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> RejectedExecutionException at discretion of</span></span><br><span class="line"><span class="comment"> *         &#123;<span class="doctag">@code</span> RejectedExecutionHandler&#125;, if the task</span></span><br><span class="line"><span class="comment"> *         cannot be accepted for execution</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NullPointerException if &#123;<span class="doctag">@code</span> command&#125; is null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable command)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (command == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Proceed in 3 steps:</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 1. If fewer than corePoolSize threads are running, try to</span></span><br><span class="line"><span class="comment">     * start a new thread with the given command as its first</span></span><br><span class="line"><span class="comment">     * task.  The call to addWorker atomically checks runState and</span></span><br><span class="line"><span class="comment">     * workerCount, and so prevents false alarms that would add</span></span><br><span class="line"><span class="comment">     * threads when it shouldn&#x27;t, by returning false.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 2. If a task can be successfully queued, then we still need</span></span><br><span class="line"><span class="comment">     * to double-check whether we should have added a thread</span></span><br><span class="line"><span class="comment">     * (because existing ones died since last checking) or that</span></span><br><span class="line"><span class="comment">     * the pool shut down since entry into this method. So we</span></span><br><span class="line"><span class="comment">     * recheck state and if necessary roll back the enqueuing if</span></span><br><span class="line"><span class="comment">     * stopped, or start a new thread if there are none.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 3. If we cannot queue task, then we try to add a new</span></span><br><span class="line"><span class="comment">     * thread.  If it fails, we know we are shut down or saturated</span></span><br><span class="line"><span class="comment">     * and so reject the task.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="comment">//è·å–å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> ctl.get();</span><br><span class="line"><span class="comment">//è‹¥å½“å‰çº¿ç¨‹æ•°é‡å°äºcorePoolSizeï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class="line">        <span class="keyword">if</span> (addWorker(command, <span class="literal">true</span>))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        c = ctl.get();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä¸”å†™å…¥ä»»åŠ¡é˜»å¡é˜Ÿåˆ—æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">recheck</span> <span class="operator">=</span> ctl.get();</span><br><span class="line"><span class="comment">//å†æ¬¡è·å–çº¿ç¨‹çŠ¶æ€è¿›è¡ŒåŒé‡æ£€æŸ¥ï¼›å¦‚æœçº¿ç¨‹å˜æˆéè¿è¡ŒçŠ¶æ€ï¼Œåˆ™ä»é˜»å¡é˜Ÿåˆ—ç§»é™¤ä»»åŠ¡ï¼›</span></span><br><span class="line">        <span class="keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class="line"><span class="comment">//æ‰§è¡Œæ‹’ç»ç­–ç•¥</span></span><br><span class="line">            reject(command);</span><br><span class="line"><span class="comment">//è‹¥å½“å‰çº¿ç¨‹æ± ä¸ºç©ºï¼Œåˆ™æ–°å»ºä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>)</span><br><span class="line">            addWorker(<span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//å½“å‰çº¿ç¨‹ä¸ºéè¿è¡ŒçŠ¶æ€å¹¶ä¸”å°è¯•æ–°å»ºçº¿ç¨‹ï¼Œè‹¥å¤±è´¥åˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="literal">false</span>))</span><br><span class="line">        reject(command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å…³é—­çº¿ç¨‹æ± ï¼š"><a href="#å…³é—­çº¿ç¨‹æ± ï¼š" class="headerlink" title="å…³é—­çº¿ç¨‹æ± ï¼š"></a>å…³é—­çº¿ç¨‹æ± ï¼š</h4><ul><li>**shutdown()**ï¼š æ‰§è¡Œååœæ­¢æ¥å—æ–°ä»»åŠ¡ï¼Œä¼šæŠŠé˜Ÿåˆ—çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚</li><li>**shutdownNow()**ï¼š æ‰§è¡Œååœæ­¢æ¥å—æ–°ä»»åŠ¡ï¼Œä½†ä¼šä¸­æ–­æ‰€æœ‰çš„ä»»åŠ¡ï¼ˆä¸ç®¡æ˜¯å¦æ­£åœ¨æ‰§è¡Œä¸­ï¼‰ï¼Œå°†çº¿ç¨‹æ± çŠ¶æ€å˜ä¸º STOPçŠ¶æ€ã€‚</li></ul><h4 id="æ‹’ç»ç­–ç•¥ï¼š"><a href="#æ‹’ç»ç­–ç•¥ï¼š" class="headerlink" title="æ‹’ç»ç­–ç•¥ï¼š"></a>æ‹’ç»ç­–ç•¥ï¼š</h4><ul><li>ç¬¬ä¸€ç§æ‹’ç»ç­–ç•¥æ˜¯ AbortPolicyï¼Œè¿™ç§æ‹’ç»ç­–ç•¥åœ¨æ‹’ç»ä»»åŠ¡æ—¶ï¼Œä¼šç›´æ¥<u><strong>æŠ›å‡ºä¸€ä¸ªç±»å‹ä¸º RejectedExecutionException çš„ RuntimeExceptionï¼Œè®©ä½ æ„ŸçŸ¥åˆ°ä»»åŠ¡è¢«æ‹’ç»äº†ï¼Œäºæ˜¯ä½ ä¾¿å¯ä»¥æ ¹æ®ä¸šåŠ¡é€»è¾‘é€‰æ‹©é‡è¯•æˆ–è€…æ”¾å¼ƒæäº¤ç­‰ç­–ç•¥ã€‚</strong></u></li><li>ç¬¬äºŒç§æ‹’ç»ç­–ç•¥æ˜¯ DiscardPolicyï¼Œè¿™ç§æ‹’ç»ç­–ç•¥æ­£å¦‚å®ƒçš„åå­—æ‰€æè¿°çš„ä¸€æ ·ï¼Œ<u><strong>å½“æ–°ä»»åŠ¡è¢«æäº¤åç›´æ¥è¢«ä¸¢å¼ƒæ‰ï¼Œä¹Ÿä¸ä¼šç»™ä½ ä»»ä½•çš„é€šçŸ¥ï¼Œç›¸å¯¹è€Œè¨€å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œå› ä¸ºæˆ‘ä»¬æäº¤çš„æ—¶å€™æ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªä»»åŠ¡ä¼šè¢«ä¸¢å¼ƒï¼Œå¯èƒ½é€ æˆæ•°æ®ä¸¢å¤±</strong></u>ã€‚</li><li>ç¬¬ä¸‰ç§æ‹’ç»ç­–ç•¥æ˜¯ DiscardOldestPolicyï¼Œå¦‚æœçº¿ç¨‹æ± æ²¡è¢«å…³é—­ä¸”æ²¡æœ‰èƒ½åŠ›æ‰§è¡Œï¼Œåˆ™ä¼š<u><strong>ä¸¢å¼ƒä»»åŠ¡é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹ï¼Œé€šå¸¸æ˜¯å­˜æ´»æ—¶é—´æœ€é•¿çš„ä»»åŠ¡</strong></u>ï¼Œè¿™ç§ç­–ç•¥ä¸ç¬¬äºŒç§ä¸åŒä¹‹å¤„åœ¨äºå®ƒä¸¢å¼ƒçš„ä¸æ˜¯æœ€æ–°æäº¤çš„ï¼Œè€Œæ˜¯é˜Ÿåˆ—ä¸­å­˜æ´»æ—¶é—´æœ€é•¿çš„ï¼Œè¿™æ ·å°±å¯ä»¥è…¾å‡ºç©ºé—´ç»™æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†åŒç†å®ƒä¹Ÿå­˜åœ¨ä¸€å®šçš„æ•°æ®ä¸¢å¤±é£é™©ã€‚</li><li>ç¬¬å››ç§æ‹’ç»ç­–ç•¥æ˜¯ CallerRunsPolicyï¼Œè°ƒç”¨è€…æ‰§è¡Œï¼Œç›¸å¯¹è€Œè¨€å®ƒå°±æ¯”è¾ƒå®Œå–„äº†ï¼Œå½“æœ‰æ–°ä»»åŠ¡æäº¤åï¼Œå¦‚æœçº¿ç¨‹æ± æ²¡è¢«å…³é—­ä¸”æ²¡æœ‰èƒ½åŠ›æ‰§è¡Œï¼Œåˆ™<u><strong>æŠŠè¿™ä¸ªä»»åŠ¡äº¤äºæäº¤ä»»åŠ¡çš„çº¿ç¨‹æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è°æäº¤ä»»åŠ¡ï¼Œè°å°±è´Ÿè´£æ‰§è¡Œä»»åŠ¡</strong></u>ã€‚è¿™æ ·åšä¸»è¦æœ‰ä¸¤ç‚¹å¥½å¤„ã€‚<ul><li>ç¬¬ä¸€ç‚¹æ–°æäº¤çš„ä»»åŠ¡ä¸ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™æ ·ä¹Ÿå°±ä¸ä¼šé€ æˆä¸šåŠ¡æŸå¤±ã€‚</li><li>ç¬¬äºŒç‚¹å¥½å¤„æ˜¯ï¼Œç”±äºè°æäº¤ä»»åŠ¡è°å°±è¦è´Ÿè´£æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ ·æäº¤ä»»åŠ¡çš„çº¿ç¨‹å°±å¾—è´Ÿè´£æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ‰§è¡Œä»»åŠ¡åˆæ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œåœ¨è¿™æ®µæœŸé—´ï¼Œæäº¤ä»»åŠ¡çš„çº¿ç¨‹è¢«å ç”¨ï¼Œä¹Ÿå°±ä¸ä¼šå†æäº¤æ–°çš„ä»»åŠ¡ï¼Œå‡ç¼“äº†ä»»åŠ¡æäº¤çš„é€Ÿåº¦ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªè´Ÿåé¦ˆã€‚åœ¨æ­¤æœŸé—´ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¹Ÿå¯ä»¥å……åˆ†åˆ©ç”¨è¿™æ®µæ—¶é—´æ¥æ‰§è¡Œæ‰ä¸€éƒ¨åˆ†ä»»åŠ¡ï¼Œè…¾å‡ºä¸€å®šçš„ç©ºé—´ï¼Œç›¸å½“äºæ˜¯ç»™äº†çº¿ç¨‹æ± ä¸€å®šçš„ç¼“å†²æœŸã€‚</li></ul></li></ul><h2 id="è¯»ä¹¦ç¬”è®°æ•´ç†"><a href="#è¯»ä¹¦ç¬”è®°æ•´ç†" class="headerlink" title="è¯»ä¹¦ç¬”è®°æ•´ç†"></a>è¯»ä¹¦ç¬”è®°æ•´ç†</h2><p>æœ¬ç« èŠ‚æ˜¯è¯¥ç½‘ç«™æ–‡ç« çš„è¯»ä¹¦ç¬”è®°ï¼š<a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Java%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%2078%20%E8%AE%B2-%E5%AE%8C/">https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Java%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%2078%20%E8%AE%B2-%E5%AE%8C/</a></p><h3 id="3-1-JAVAçº¿ç¨‹å®ç°-x2F-åˆ›å»ºæ–¹å¼"><a href="#3-1-JAVAçº¿ç¨‹å®ç°-x2F-åˆ›å»ºæ–¹å¼" class="headerlink" title="3.1.JAVAçº¿ç¨‹å®ç°&#x2F;åˆ›å»ºæ–¹å¼"></a>3.1.JAVAçº¿ç¨‹å®ç°&#x2F;åˆ›å»ºæ–¹å¼</h3><ul><li><p>1.å®ç°<strong>Runnable</strong>æ¥å£ä¸­çš„<strong>run</strong>æ–¹æ³•</p><ul><li>ç„¶ååªè¦æŠŠå®ç°runæ–¹æ³•çš„å¯¹è±¡å®ä¾‹ä¼ å…¥Threadç±»ä¸­å³å¯</li></ul></li><li><p>2.ç»§æ‰¿Threadç±»</p><ul><li>ç»§æ‰¿Threadç±»ï¼Œé‡å†™runæ–¹æ³•â€¦â€¦</li></ul></li><li><p>3.çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹</p><ul><li><p>çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹æºç ï¼š</p></li><li><pre><code class="java">static class DefaultThreadFactory implements ThreadFactory &#123;    DefaultThreadFactory() &#123;        SecurityManager s = System.getSecurityManager();        group = (s != null) ? s.getThreadGroup() :            Thread.currentThread().getThreadGroup();        namePrefix = &quot;pool-&quot; +            poolNumber.getAndIncrement() +            &quot;-thread-&quot;;    &#125;    public Thread newThread(Runnable r) &#123;        Thread t = new Thread(group, r,                    namePrefix + threadNumber.getAndIncrement(),0);        if (t.isDaemon())            t.setDaemon(false);        if (t.getPriority() != Thread.NORM_PRIORITY)            t.setPriority(Thread.NORM_PRIORITY);        return t;    &#125;&#125;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  - æœ¬è´¨ä¸Šè¿˜æ˜¯é€šè¿‡ new Thread() åˆ›å»ºçº¿ç¨‹</span><br><span class="line"></span><br><span class="line">- 4.æœ‰è¿”å›å€¼çš„ Callable åˆ›å»ºçº¿ç¨‹</span><br><span class="line"></span><br><span class="line">  - æºç ï¼š</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    class CallableTask implements Callable&lt;Integer&gt; &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public Integer call() throws Exception &#123;</span><br><span class="line">            return new Random().nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //åˆ›å»ºçº¿ç¨‹æ±          æ‰§è¡Œå™¨(Executor)ä¸­æœ‰è®¸å¤šæ„é€ çº¿ç¨‹æ± çš„é™æ€å·¥å‚æ–¹æ³•ï¼Œå¯ä»¥æ„é€ å„ç§çº¿ç¨‹æ± </span><br><span class="line">    ExecutorService service = Executors.newFixedThreadPool(10);</span><br><span class="line">    //æäº¤ä»»åŠ¡ï¼Œå¹¶ç”¨ Futureæäº¤è¿”å›ç»“æœ</span><br><span class="line">    Future&lt;Integer&gt; future = service.submit(new CallableTask());</span><br></pre></td></tr></table></figure></code></pre></li><li><p>ç¬¬ 4 ç§çº¿ç¨‹åˆ›å»ºæ–¹å¼æ˜¯é€šè¿‡æœ‰è¿”å›å€¼çš„ Callable åˆ›å»ºçº¿ç¨‹ï¼Œ<u>Runnable åˆ›å»ºçº¿ç¨‹æ˜¯æ— è¿”å›å€¼çš„ï¼Œè€Œ Callable å’Œä¸ä¹‹ç›¸å…³çš„ Futureã€FutureTaskï¼Œå®ƒä»¬å¯ä»¥æŠŠçº¿ç¨‹æ‰§è¡Œçš„ç»“æœä½œä¸ºè¿”å›å€¼è¿”å›</u>ï¼Œå¦‚ä»£ç æ‰€ç¤ºï¼Œå®ç°äº† Callable æ¥å£ï¼Œå¹¶ä¸”ç»™å®ƒçš„æ³›å‹è®¾ç½®æˆ Integerï¼Œç„¶åå®ƒä¼šè¿”å›ä¸€ä¸ªéšæœºæ•°ã€‚</p></li><li><p>ä½†æ˜¯ï¼Œæ— è®ºæ˜¯ Callable è¿˜æ˜¯ FutureTaskï¼Œ<u>å®ƒä»¬é¦–å…ˆå’Œ Runnable ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œæ˜¯éœ€è¦è¢«æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯è¯´å®ƒä»¬æœ¬èº«å°±æ˜¯çº¿ç¨‹ã€‚</u>å®ƒä»¬å¯ä»¥æ”¾åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œå¦‚ä»£ç æ‰€ç¤ºï¼Œ <u><strong>submit() æ–¹æ³•æŠŠä»»åŠ¡æ”¾åˆ°çº¿ç¨‹æ± ä¸­ï¼Œå¹¶ç”±çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹ï¼Œä¸ç®¡ç”¨ä»€ä¹ˆæ–¹æ³•ï¼Œæœ€ç»ˆéƒ½æ˜¯é çº¿ç¨‹æ¥æ‰§è¡Œçš„ï¼Œè€Œå­çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼ä»è„±ç¦»ä¸äº†æœ€å¼€å§‹è®²çš„ä¸¤ç§åŸºæœ¬æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å®ç° Runnable æ¥å£å’Œç»§æ‰¿ Thread ç±»ã€‚</strong></u></p></li></ul></li><li><p>å…¶ä»–åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•åŒæ ·ä¹Ÿç¦»ä¸å¼€å®ç° Runnable æ¥å£å’Œç»§æ‰¿ Thread ç±»ï¼</p></li></ul><h4 id="âš ï¸æœ¬è´¨ä¸Šï¼Œçº¿ç¨‹åˆ›å»ºæ–¹å¼åªæœ‰ä¸€ç§-â€”â€”â€”-gt-æ„é€ ä¸€ä¸ªthreadç±»"><a href="#âš ï¸æœ¬è´¨ä¸Šï¼Œçº¿ç¨‹åˆ›å»ºæ–¹å¼åªæœ‰ä¸€ç§-â€”â€”â€”-gt-æ„é€ ä¸€ä¸ªthreadç±»" class="headerlink" title="âš ï¸æœ¬è´¨ä¸Šï¼Œçº¿ç¨‹åˆ›å»ºæ–¹å¼åªæœ‰ä¸€ç§ â€”â€”â€”&gt; æ„é€ ä¸€ä¸ªthreadç±»"></a>âš ï¸æœ¬è´¨ä¸Šï¼Œçº¿ç¨‹åˆ›å»ºæ–¹å¼åªæœ‰ä¸€ç§ â€”â€”â€”&gt; æ„é€ ä¸€ä¸ªthreadç±»</h4><p>â€‹ç„¶åé€šè¿‡ï¼š1.ä¼ ç»™Runnableæ¥å£ä¸­targetã€Œtargetæ‰§è¡Œ target.run()ã€</p><p>â€‹   2.ç»§æ‰¿Threadé‡å†™çš„runæ–¹æ³•</p><p>â€‹è¿™ä¸¤ç§æ–¹å¼æ¥æŠŠæƒ³è®©çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ä¼ å…¥ï¼</p><h4 id="ä¸ºä»€ä¹ˆå®ç°-Runnable-æ¥å£æ¯”ç»§æ‰¿-Thread-ç±»å®ç°çº¿ç¨‹è¦å¥½ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå®ç°-Runnable-æ¥å£æ¯”ç»§æ‰¿-Thread-ç±»å®ç°çº¿ç¨‹è¦å¥½ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå®ç° Runnable æ¥å£æ¯”ç»§æ‰¿ Thread ç±»å®ç°çº¿ç¨‹è¦å¥½ï¼Ÿ"></a>ä¸ºä»€ä¹ˆå®ç° Runnable æ¥å£æ¯”ç»§æ‰¿ Thread ç±»å®ç°çº¿ç¨‹è¦å¥½ï¼Ÿ</h4><ol><li><p>ä»ä»£ç çš„æ¶æ„è€ƒè™‘ï¼Œå®é™…ä¸Šï¼ŒRunnable é‡Œåªæœ‰ä¸€ä¸ª run() æ–¹æ³•ï¼Œå®ƒå®šä¹‰äº†éœ€è¦æ‰§è¡Œçš„å†…å®¹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ç°äº† Runnable ä¸ Thread ç±»çš„è§£è€¦ï¼ŒThread ç±»è´Ÿè´£çº¿ç¨‹å¯åŠ¨å’Œå±æ€§è®¾ç½®ç­‰å†…å®¹ï¼Œæƒè´£åˆ†æ˜ã€‚</p></li><li><p>åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥æé«˜æ€§èƒ½ï¼Œ<u>ä½¿ç”¨ç»§æ‰¿ Thread ç±»æ–¹å¼ï¼Œæ¯æ¬¡æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼Œéƒ½éœ€è¦æ–°å»ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œæ‰§è¡Œå®Œä»»åŠ¡åçº¿ç¨‹èµ°åˆ°ç”Ÿå‘½å‘¨æœŸçš„å°½å¤´è¢«é”€æ¯ï¼Œå¦‚æœè¿˜æƒ³æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œå°±å¿…é¡»å†æ–°å»ºä¸€ä¸ªç»§æ‰¿äº† Thread ç±»çš„ç±»</u>ï¼Œå¦‚æœæ­¤æ—¶æ‰§è¡Œçš„å†…å®¹æ¯”è¾ƒå°‘ï¼Œæ¯”å¦‚åªæ˜¯åœ¨ run() æ–¹æ³•é‡Œç®€å•æ‰“å°ä¸€è¡Œæ–‡å­—ï¼Œé‚£ä¹ˆå®ƒæ‰€å¸¦æ¥çš„å¼€é”€å¹¶ä¸å¤§ï¼Œç›¸æ¯”äºæ•´ä¸ªçº¿ç¨‹ä»å¼€å§‹åˆ›å»ºåˆ°æ‰§è¡Œå®Œæ¯•è¢«é”€æ¯ï¼Œè¿™ä¸€ç³»åˆ—çš„æ“ä½œæ¯” run() æ–¹æ³•æ‰“å°æ–‡å­—æœ¬èº«å¸¦æ¥çš„å¼€é”€è¦å¤§å¾—å¤šï¼Œç›¸å½“äºæ¡äº†èŠéº»ä¸¢äº†è¥¿ç“œï¼Œå¾—ä¸å¿å¤±ã€‚å¦‚æœæˆ‘ä»¬<u><strong>ä½¿ç”¨å®ç° Runnable æ¥å£çš„æ–¹å¼ï¼Œå°±å¯ä»¥æŠŠä»»åŠ¡ç›´æ¥ä¼ å…¥çº¿ç¨‹æ± ï¼Œä½¿ç”¨ä¸€äº›å›ºå®šçš„çº¿ç¨‹æ¥å®Œæˆä»»åŠ¡ï¼Œä¸éœ€è¦æ¯æ¬¡æ–°å»ºé”€æ¯çº¿ç¨‹ï¼Œå¤§å¤§é™ä½äº†æ€§èƒ½å¼€é”€ã€‚</strong></u></p></li><li><p>Java è¯­è¨€ä¸æ”¯æŒåŒç»§æ‰¿ï¼Œå¦‚æœæˆ‘ä»¬çš„ç±»ä¸€æ—¦ç»§æ‰¿äº† Thread ç±»ï¼Œé‚£ä¹ˆå®ƒåç»­å°±æ²¡æœ‰åŠæ³•å†ç»§æ‰¿å…¶ä»–çš„ç±»ï¼Œ<strong>ä¸æ–¹ä¾¿ç±»çš„æ‹“å±•</strong></p></li></ol><h3 id="3-2-å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹"><a href="#3-2-å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹" class="headerlink" title="3.2.å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹"></a>3.2.å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹</h3><p>æœ¬èŠ‚æˆ‘ä»¬å°†è®¨è®º å¦‚ä½•æ­£ç¡®åœæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Ÿä»¥åŠä¸ºä»€ä¹ˆç”¨ volatile æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯é”™è¯¯çš„ï¼Ÿ</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šè®©çº¿ç¨‹è‡ªåŠ¨è¿è¡Œåˆ°å…¶ç»“æŸä¸ºæ­¢ã€‚</p><p>ä½†æ˜¯å¦‚æœä¸­é€”å‡ºäº†æ„å¤–æƒ…å†µæˆ‘ä»¬åˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>â€‹åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³å°†åœæ­¢çš„çº¿ç¨‹åœ¨å¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸‹ä»ç„¶å¾ˆæœ‰ä»·å€¼ã€‚å°¤å…¶æ˜¯æˆ‘ä»¬æƒ³å†™ä¸€ä¸ªå¥å£®æ€§å¾ˆå¥½ï¼Œèƒ½å¤Ÿå®‰å…¨åº”å¯¹å„ç§åœºæ™¯çš„ç¨‹åºæ—¶ï¼Œæ­£ç¡®åœæ­¢çº¿ç¨‹å°±æ˜¾å¾—æ ¼å¤–é‡è¦ã€‚ä½†æ˜¯Java å¹¶æ²¡æœ‰æä¾›ç®€å•æ˜“ç”¨ï¼Œèƒ½å¤Ÿç›´æ¥å®‰å…¨åœæ­¢çº¿ç¨‹çš„èƒ½åŠ›ã€‚</p><h4 id="3-2-1-ä½¿ç”¨interruptåœæ­¢çº¿ç¨‹"><a href="#3-2-1-ä½¿ç”¨interruptåœæ­¢çº¿ç¨‹" class="headerlink" title="3.2.1.ä½¿ç”¨interruptåœæ­¢çº¿ç¨‹"></a>3.2.1.ä½¿ç”¨interruptåœæ­¢çº¿ç¨‹</h4><p>â€‹å¯¹äº Java è€Œè¨€ï¼Œæœ€æ­£ç¡®çš„åœæ­¢çº¿ç¨‹çš„æ–¹å¼æ˜¯ä½¿ç”¨ interruptã€‚ä½† interrupt ä»…ä»…èµ·åˆ°é€šçŸ¥è¢«åœæ­¢çº¿ç¨‹çš„ä½œç”¨ã€‚è¢«é€šçŸ¥çš„çº¿ç¨‹ä¼šè€ƒè™‘è‡ªèº«å·¥ä½œæƒ…å†µ()ï¼Œé€‰æ‹©ç«‹å³åœæ­¢ã€ä¸€æ®µæ—¶é—´ååœæ­¢æˆ–ä¸åœæ­¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//java.lang.Threadç±»ä¸­çš„ç›¸å…³æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘çº¿ç¨‹å‘é€ä¸­æ–­è¯·æ±‚ï¼Œçº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€å°†è¢«è®¾ç½®ä¸ºtrueï¼Œæ­¤æ—¶å¦‚æœçº¿ç¨‹å·²ç»è¢«sleepæ–¹æ³•è°ƒç”¨é˜»å¡ï¼Œå°†ä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">interrupt</span><span class="params">()</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//æµ‹è¯•å½“å‰è¿›ç¨‹æ˜¯å¦è¢«ä¸­æ–­â€”â€”é™æ€æ–¹æ³•â€”â€”ä¼šå°†å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€é‡åˆ¶ä¸ºfalseï¼ï¼ï¼</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">interrupted</span><span class="params">()</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//æµ‹è¯•å½“å‰è¿›ç¨‹æ˜¯å¦è¢«ä¸­æ–­â€”â€”â€”â€”ä¸ä¼šæ”¹å˜çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isInterrupted</span><span class="params">()</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//è¿”å›å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹çš„Threadå¯¹è±¡</span></span><br><span class="line"><span class="keyword">static</span> Thread <span class="title function_">currentThread</span><span class="params">()</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//==============================ä½¿ç”¨interruptåœæ­¢çº¿ç¨‹==============================</span></span><br><span class="line"><span class="keyword">while</span> (!Thread.currentThread().isInterrupted() &amp;&amp; more work to <span class="keyword">do</span>) &#123;</span><br><span class="line">  <span class="keyword">do</span> more work</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸€æ—¦è°ƒç”¨æŸä¸ªçº¿ç¨‹çš„ interrupt() ä¹‹åï¼Œè¿™ä¸ªçº¿ç¨‹çš„<strong>ä¸­æ–­æ ‡è®°ä½</strong>å°±ä¼šè¢«è®¾ç½®æˆ trueã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è¿™æ ·çš„æ ‡è®°ä½ï¼Œå½“çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œåº”è¯¥å®šæœŸæ£€æŸ¥è¿™ä¸ªæ ‡è®°ä½ï¼Œ<u>å¦‚æœæ ‡è®°ä½è¢«è®¾ç½®æˆ trueï¼Œå°±è¯´æ˜æœ‰ç¨‹åºæƒ³ç»ˆæ­¢è¯¥çº¿ç¨‹ã€‚</u></p><p>å®ä¾‹ğŸŒ°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StopThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">      <span class="comment">//ğŸŒŸè¿™é‡Œè¯´æ˜äº† çº¿ç¨‹èƒ½å¤Ÿé€šè¿‡ isInterrupted() æ–¹æ³•å¾—çŸ¥ç»ˆç«¯æ ‡è®°ä½çš„çŠ¶æ€</span></span><br><span class="line">      <span class="comment">//ğŸŒŸç„¶åå†ç”±ç¨‹åºå‘˜ç¼–å†™ä¸­æ–­æ ‡è®°ä½ä¸ºtrue/falseæ—¶çš„é€»è¾‘ï¼</span></span><br><span class="line">        <span class="keyword">while</span> (!Thread.currentThread().isInterrupted() &amp;&amp; count &lt; <span class="number">1000</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;count = &quot;</span> + count++);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">StopThread</span>());</span><br><span class="line">        thread.start();</span><br><span class="line">        Thread.sleep(<span class="number">5</span>);</span><br><span class="line">        thread.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-2-sleep-æœŸé—´èƒ½å¦æ„Ÿå—åˆ°ä¸­æ–­ï¼Ÿ"><a href="#3-2-2-sleep-æœŸé—´èƒ½å¦æ„Ÿå—åˆ°ä¸­æ–­ï¼Ÿ" class="headerlink" title="3.2.2.sleep æœŸé—´èƒ½å¦æ„Ÿå—åˆ°ä¸­æ–­ï¼Ÿ"></a>3.2.2.sleep æœŸé—´èƒ½å¦æ„Ÿå—åˆ°ä¸­æ–­ï¼Ÿ</h4><p>â€”â€”å¦‚æœ sleepã€wait ç­‰å¯ä»¥è®©çº¿ç¨‹è¿›å…¥é˜»å¡çš„æ–¹æ³•ä½¿çº¿ç¨‹ä¼‘çœ äº†ï¼Œè€Œå¤„äºä¼‘çœ ä¸­çš„çº¿ç¨‹è¢«ä¸­æ–­ï¼Œé‚£ä¹ˆçº¿ç¨‹æ˜¯å¯ä»¥æ„Ÿå—åˆ°ä¸­æ–­ä¿¡å·çš„ï¼Œå¹¶ä¸”ä¼šæŠ›å‡ºä¸€ä¸ª InterruptedException å¼‚å¸¸ï¼ŒåŒæ—¶æ¸…é™¤ä¸­æ–­ä¿¡å·ï¼Œå°†ä¸­æ–­æ ‡è®°ä½è®¾ç½®æˆ falseã€‚è¿™æ ·ä¸€æ¥å°±ä¸ç”¨æ‹…å¿ƒé•¿æ—¶é—´ä¼‘çœ ä¸­çº¿ç¨‹æ„Ÿå—ä¸åˆ°ä¸­æ–­äº†ï¼Œå› ä¸ºå³ä¾¿çº¿ç¨‹è¿˜åœ¨ä¼‘çœ ï¼Œä»ç„¶èƒ½å¤Ÿå“åº”ä¸­æ–­é€šçŸ¥ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</p><p><u>å› æ­¤å¦‚æœæˆ‘ä»¬éœ€è¦å¯¹æ­¤æƒ…å†µè¿›è¡Œå¤„ç†ï¼Œæˆ‘ä»¬éœ€è¦å¯¹InterruptedExceptionå¼‚å¸¸è¿›è¡Œæ•è·ï¼Œè€Œä¸æ˜¯æ£€æŸ¥ä¸­æ–­çŠ¶æ€</u></p><p>ğŸŒŸå¦‚æœæˆ‘ä»¬æƒ³è®©çº¿ç¨‹çš„è°ƒç”¨è€…å¯Ÿè§‰åˆ°â¬†ï¸ä¸Šé¢æƒ…å†µçš„å‘ç”Ÿï¼Œæœ‰2ç§æ–¹å¼ï¼š</p><ul><li>(æ–¹æ³•1)ï¼šcatch InterruptedExceptionå¼‚å¸¸åï¼Œå°†ä¸­æ–­çŠ¶æ€å†æ¬¡è®¾ç½®ä¸ºtrue(åœ¨try-catchä¸­å¤„ç†å¼‚å¸¸ä¼šå®é™…ä¸Šè¿˜æ˜¯åœ¨åŒä¸€classä¸­å¤„ç†ï¼Œè€¦åˆåº¦é«˜ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå› æ­¤æ¨èä¸‹é¢çš„æ–¹æ³•)</li><li>(æ–¹æ³•2)ï¼šğŸŒŸ**<u>throw InterruptedException å¼‚å¸¸å³å¯ï¼Œè°ƒç”¨è€…å†try-catchå³å¯æ•è·å¼‚å¸¸</u>**</li></ul><p>âš ï¸æ³¨æ„ï¼šæˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ä¸èƒ½ç›²ç›®åæ‰ä¸­æ–­ï¼Œ<u>å¦‚æœä¸åœ¨æ–¹æ³•ç­¾åä¸­å£°æ˜ï¼Œä¹Ÿä¸åœ¨ catch è¯­å¥å—ä¸­å†æ¬¡æ¢å¤ä¸­æ–­(æ–¹æ³•1)ï¼Œè€Œæ˜¯åœ¨ catch ä¸­ä¸ä½œå¤„ç†(æ–¹æ³•2)ï¼Œæˆ‘ä»¬ç§°è¿™ç§è¡Œä¸ºæ˜¯â€œå±è”½äº†ä¸­æ–­è¯·æ±‚â€</u>ã€‚å¦‚æœæˆ‘ä»¬ç›²ç›®åœ°å±è”½äº†ä¸­æ–­è¯·æ±‚ï¼Œä¼šå¯¼è‡´ä¸­æ–­ä¿¡å·è¢«å®Œå…¨å¿½ç•¥ï¼Œæœ€ç»ˆå¯¼è‡´çº¿ç¨‹æ— æ³•æ­£ç¡®åœæ­¢ã€‚</p><h4 id="3-2-3-ä¸ºä»€ä¹ˆç”¨-volatile-æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯é”™è¯¯çš„"><a href="#3-2-3-ä¸ºä»€ä¹ˆç”¨-volatile-æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯é”™è¯¯çš„" class="headerlink" title="3.2.3.ä¸ºä»€ä¹ˆç”¨ volatile æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯é”™è¯¯çš„?"></a>3.2.3.ä¸ºä»€ä¹ˆç”¨ volatile æ ‡è®°ä½çš„åœæ­¢æ–¹æ³•æ˜¯é”™è¯¯çš„?</h4><h5 id="3-2-3-1-å¸¸è§çš„é”™è¯¯åœæ­¢æ–¹æ³•"><a href="#3-2-3-1-å¸¸è§çš„é”™è¯¯åœæ­¢æ–¹æ³•" class="headerlink" title="3.2.3.1.å¸¸è§çš„é”™è¯¯åœæ­¢æ–¹æ³•"></a>3.2.3.1.å¸¸è§çš„é”™è¯¯åœæ­¢æ–¹æ³•</h5><p>â€‹é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹å‡ ç§åœæ­¢çº¿ç¨‹çš„é”™è¯¯æ–¹æ³•ã€‚æ¯”å¦‚ stop()ï¼Œsuspend() å’Œ resume()ï¼Œè¿™äº›æ–¹æ³•å·²ç»è¢« Java ç›´æ¥æ ‡è®°ä¸º @Deprecatedã€‚å¦‚æœå†è°ƒç”¨è¿™äº›æ–¹æ³•ï¼ŒIDE ä¼šå‹å¥½åœ°æç¤ºï¼Œæˆ‘ä»¬ä¸åº”è¯¥å†ä½¿ç”¨å®ƒä»¬äº†ã€‚ä½†ä¸ºä»€ä¹ˆå®ƒä»¬ä¸èƒ½ä½¿ç”¨äº†å‘¢ï¼Ÿ</p><ol><li><p>stop() ä¼šç›´æ¥æŠŠçº¿ç¨‹åœæ­¢ï¼Œè¿™æ ·å°±<u>æ²¡æœ‰ç»™çº¿ç¨‹è¶³å¤Ÿçš„æ—¶é—´æ¥å¤„ç†æƒ³è¦åœ¨åœæ­¢å‰ä¿å­˜æ•°æ®çš„é€»è¾‘</u>ï¼Œä»»åŠ¡æˆ›ç„¶è€Œæ­¢ï¼Œä¼šå¯¼è‡´å‡ºç°æ•°æ®å®Œæ•´æ€§ç­‰é—®é¢˜ã€‚</p></li><li><p>å¯¹äºsuspend() å’Œ resume() è€Œè¨€ï¼Œå®ƒä»¬çš„é—®é¢˜åœ¨äºå¦‚æœçº¿ç¨‹è°ƒç”¨ suspend()ï¼Œå®ƒå¹¶ä¸ä¼šé‡Šæ”¾é”ï¼Œå°±å¼€å§‹è¿›å…¥ä¼‘çœ ï¼Œä½†æ­¤æ—¶æœ‰å¯èƒ½ä»æŒæœ‰é”ï¼Œè¿™æ ·å°±<u>å®¹æ˜“å¯¼è‡´æ­»é”é—®é¢˜</u>ï¼Œå› ä¸ºè¿™æŠŠé”åœ¨çº¿ç¨‹è¢« resume() ä¹‹å‰ï¼Œæ˜¯ä¸ä¼šè¢«é‡Šæ”¾çš„ã€‚</p></li></ol><h5 id="3-2-3-2volatileæ ‡è®°ä½åœæ­¢çº¿ç¨‹"><a href="#3-2-3-2volatileæ ‡è®°ä½åœæ­¢çº¿ç¨‹" class="headerlink" title="3.2.3.2volatileæ ‡è®°ä½åœæ­¢çº¿ç¨‹"></a>3.2.3.2volatileæ ‡è®°ä½åœæ­¢çº¿ç¨‹</h5><p>volatile è¿™ç§æ–¹æ³•åœ¨æŸäº›ç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚çº¿ç¨‹è¢«é•¿æ—¶é—´é˜»å¡çš„æƒ…å†µï¼Œå°±æ— æ³•åŠæ—¶æ„Ÿå—ä¸­æ–­ï¼Œæ‰€ä»¥ volatile æ˜¯ä¸å¤Ÿå…¨é¢çš„åœæ­¢çº¿ç¨‹çš„æ–¹æ³•ã€‚</p><p><strong><u>çº¿ç¨‹è¢«é•¿æ—¶é—´é˜»å¡ï¼šå› ä¸ºä½ æ˜¯æ ¹æ®volatileå˜é‡çš„å€¼çš„æƒ…å†µå»åˆ¤æ–­æ˜¯å¦åœæ­¢è¿›ç¨‹ï¼Œä½†æ˜¯å¦‚æœä½ åœ¨å“ªé˜»å¡äº†ï¼Œå³ä½¿é‚£ä¸ªå˜é‡æ”¹å˜äº†ä¹Ÿæ²¡ç”¨ï¼Œvolatileæ ‡è®°ä½åœ¨ç¨‹åºè¿è¡Œåˆ°å¯¹è¯¥å˜é‡è¿›è¡Œåˆ¤æ–­çš„è¯­å¥æ—¶æ‰å¯¹çº¿ç¨‹äº§ç”Ÿå½±å“</u></strong></p><h3 id="3-3-çº¿ç¨‹æ˜¯å¦‚ä½•åœ¨-6-ç§çŠ¶æ€ä¹‹é—´è½¬æ¢çš„ï¼Ÿ"><a href="#3-3-çº¿ç¨‹æ˜¯å¦‚ä½•åœ¨-6-ç§çŠ¶æ€ä¹‹é—´è½¬æ¢çš„ï¼Ÿ" class="headerlink" title="3.3.çº¿ç¨‹æ˜¯å¦‚ä½•åœ¨ 6 ç§çŠ¶æ€ä¹‹é—´è½¬æ¢çš„ï¼Ÿ"></a>3.3.çº¿ç¨‹æ˜¯å¦‚ä½•åœ¨ 6 ç§çŠ¶æ€ä¹‹é—´è½¬æ¢çš„ï¼Ÿ</h3><p>çº¿ç¨‹å¯ä»¥æœ‰ä»¥ä¸‹6ç§çŠ¶æ€ï¼š</p><table><thead><tr><th>New(æ–°å»º)</th><th>Runnable(å¯è¿è¡Œ)</th><th>Blocked(é˜»å¡)</th><th>Waiting(ç­‰å¾…)</th><th>Time waiting(è®¡æ—¶ç­‰å¾…)</th><th>Terminated(ç»ˆæ­¢)</th></tr></thead></table><h4 id="3-3-1-new"><a href="#3-3-1-new" class="headerlink" title="3.3.1.new"></a>3.3.1.new</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230802141435013.png" alt="image-20230802141435013"></p><p>New è¡¨ç¤ºçº¿ç¨‹è¢«åˆ›å»ºä½†å°šæœªå¯åŠ¨çš„çŠ¶æ€ï¼šå½“æˆ‘ä»¬ç”¨ new Thread() æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œ<u>å¦‚æœçº¿ç¨‹æ²¡æœ‰å¼€å§‹è¿è¡Œ start() æ–¹æ³•ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰å¼€å§‹æ‰§è¡Œ run() æ–¹æ³•é‡Œé¢çš„ä»£ç ï¼Œé‚£ä¹ˆæ­¤æ—¶å®ƒçš„çŠ¶æ€å°±æ˜¯ New</u>ã€‚è€Œä¸€æ—¦çº¿ç¨‹è°ƒç”¨äº† start()ï¼Œå®ƒçš„çŠ¶æ€å°±ä¼šä» New å˜æˆ Runnableï¼Œä¹Ÿå°±æ˜¯çŠ¶æ€è½¬æ¢å›¾ä¸­ä¸­é—´çš„è¿™ä¸ªå¤§æ–¹æ¡†é‡Œçš„å†…å®¹ã€‚</p><h4 id="3-3-2-Runnable"><a href="#3-3-2-Runnable" class="headerlink" title="3.3.2.Runnable"></a>3.3.2.Runnable</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230802141522535.png" alt="image-20230802141522535"></p><p>Java ä¸­çš„ <u>Runable çŠ¶æ€å¯¹åº”æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ä¸­çš„ä¸¤ç§çŠ¶æ€</u>ï¼Œåˆ†<strong>åˆ«æ˜¯ Running å’Œ Readyï¼Œ</strong>ä¹Ÿå°±æ˜¯è¯´ï¼ŒJava ä¸­å¤„äº Runnable çŠ¶æ€çš„çº¿ç¨‹æœ‰å¯èƒ½æ­£åœ¨æ‰§è¡Œï¼Œä¹Ÿæœ‰å¯èƒ½æ²¡æœ‰æ­£åœ¨æ‰§è¡Œï¼Œæ­£åœ¨ç­‰å¾…è¢«åˆ†é… CPU èµ„æºã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ˜¯ Runnable çŠ¶æ€ï¼Œå½“å®ƒè¿è¡Œåˆ°ä»»åŠ¡çš„ä¸€åŠæ—¶ï¼Œæ‰§è¡Œè¯¥çº¿ç¨‹çš„ CPU è¢«è°ƒåº¦å»åšå…¶ä»–äº‹æƒ…ï¼Œå¯¼è‡´è¯¥çº¿ç¨‹æš‚æ—¶ä¸è¿è¡Œï¼Œå®ƒçš„çŠ¶æ€ä¾ç„¶ä¸å˜ï¼Œè¿˜æ˜¯ Runnableï¼Œå› ä¸ºå®ƒæœ‰å¯èƒ½éšæ—¶è¢«è°ƒåº¦å›æ¥ç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚</p><h4 id="3-3-3-é˜»å¡"><a href="#3-3-3-é˜»å¡" class="headerlink" title="3.3.3.é˜»å¡"></a>3.3.3.é˜»å¡</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230802141714716.png" alt="image-20230802141714716"></p><h5 id="3-3-3-1Blocked"><a href="#3-3-3-1Blocked" class="headerlink" title="3.3.3.1Blocked"></a>3.3.3.1Blocked</h5><p>â€‹<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230802141755358.png" alt="image-20230802141755358"></p><p>é¦–å…ˆæ¥çœ‹æœ€ç®€å•çš„ Blockedï¼Œä»ç®­å¤´çš„æµè½¬æ–¹å‘å¯ä»¥çœ‹å‡ºï¼Œä» Runnable çŠ¶æ€è¿›å…¥ Blocked çŠ¶æ€åªæœ‰ä¸€ç§å¯èƒ½ï¼Œå°±æ˜¯è¿›å…¥ synchronized ä¿æŠ¤çš„ä»£ç æ—¶<u>æ²¡æœ‰æŠ¢åˆ° monitor é”</u>ï¼Œæ— è®ºæ˜¯è¿›å…¥ synchronized ä»£ç å—ï¼Œè¿˜æ˜¯ synchronized æ–¹æ³•ï¼Œéƒ½æ˜¯ä¸€æ ·ã€‚</p><p>æˆ‘ä»¬å†å¾€å³çœ‹ï¼Œå½“å¤„äº Blocked çš„çº¿ç¨‹<u>æŠ¢åˆ° monitor é”</u>ï¼Œå°±ä¼šä» Blocked çŠ¶æ€å›åˆ°Runnable çŠ¶æ€ã€‚</p><h5 id="3-3-3-2-Waiting"><a href="#3-3-3-2-Waiting" class="headerlink" title="3.3.3.2.Waiting"></a>3.3.3.2.Waiting</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230802141903651.png" alt="image-20230802141903651"></p><p>æˆ‘ä»¬å†çœ‹çœ‹ Waiting çŠ¶æ€ï¼Œçº¿ç¨‹è¿›å…¥ Waiting çŠ¶æ€æœ‰ä¸‰ç§å¯èƒ½æ€§ã€‚</p><ol><li>æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Object.wait() æ–¹æ³•ã€‚</li><li>æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Thread.join() æ–¹æ³•ã€‚</li><li>LockSupport.park() æ–¹æ³•ã€‚</li></ol><p>åˆšæ‰å¼ºè°ƒè¿‡ï¼ŒBlocked ä»…ä»…é’ˆå¯¹ synchronized monitor é”ï¼Œå¯æ˜¯åœ¨ Java ä¸­è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„é”ï¼Œæ¯”å¦‚ ReentrantLockï¼Œå¦‚æœçº¿ç¨‹åœ¨è·å–è¿™ç§é”æ—¶æ²¡æœ‰æŠ¢åˆ°è¯¥é”å°±ä¼šè¿›å…¥ Waiting çŠ¶æ€ï¼Œå› ä¸ºæœ¬è´¨ä¸Šå®ƒæ‰§è¡Œäº† LockSupport.park() æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ Waiting çŠ¶æ€ã€‚åŒæ ·ï¼ŒObject.wait() å’Œ Thread.join() ä¹Ÿä¼šè®©çº¿ç¨‹è¿›å…¥ Waiting çŠ¶æ€ã€‚</p><p><strong><u>Blocked ä¸ Waiting çš„åŒºåˆ«æ˜¯ Blocked åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾ monitor é”ï¼Œè€Œ Waiting åˆ™æ˜¯åœ¨ç­‰å¾…æŸä¸ªæ¡ä»¶ï¼Œæ¯”å¦‚ join çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œæˆ–è€…æ˜¯ notify()&#x2F;notifyAll() ã€‚</u></strong></p><h5 id="3-3-3-3-TimedWaiting"><a href="#3-3-3-3-TimedWaiting" class="headerlink" title="3.3.3.3.TimedWaiting"></a>3.3.3.3.TimedWaiting</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230802142019403.png" alt="image-20230802142019403"></p><p>åœ¨ Waiting ä¸Šé¢æ˜¯ Timed Waiting çŠ¶æ€ï¼Œè¿™ä¸¤ä¸ªçŠ¶æ€æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œ<u><strong>åŒºåˆ«ä»…åœ¨äºæœ‰æ²¡æœ‰æ—¶é—´é™åˆ¶</strong></u>ï¼ŒTimed Waiting ä¼šç­‰å¾…è¶…æ—¶ï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ï¼Œæˆ–è€…åœ¨è¶…æ—¶å‰è¢«å”¤é†’ä¿¡å·å”¤é†’ã€‚</p><p>ä»¥ä¸‹æƒ…å†µä¼šè®©çº¿ç¨‹è¿›å…¥ Timed Waiting çŠ¶æ€ã€‚</p><ol><li>è®¾ç½®äº†æ—¶é—´å‚æ•°çš„ Thread.sleep(long millis) æ–¹æ³•ï¼›</li><li>è®¾ç½®äº†æ—¶é—´å‚æ•°çš„ Object.wait(long timeout) æ–¹æ³•ï¼›</li><li>è®¾ç½®äº†æ—¶é—´å‚æ•°çš„ Thread.join(long millis) æ–¹æ³•ï¼›</li><li>è®¾ç½®äº†æ—¶é—´å‚æ•°çš„ LockSupport.parkNanos(long nanos) æ–¹æ³•å’Œ LockSupport.parkUntil(long deadline) æ–¹æ³•ã€‚</li></ol><h4 id="3-3-4-Terminated"><a href="#3-3-4-Terminated" class="headerlink" title="3.3.4.Terminated"></a>3.3.4.Terminated</h4><ul><li>run() æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹æ­£å¸¸é€€å‡ºã€‚</li><li>å‡ºç°ä¸€ä¸ªæ²¡æœ‰æ•è·çš„å¼‚å¸¸ï¼Œç»ˆæ­¢äº† run() æ–¹æ³•ï¼Œæœ€ç»ˆå¯¼è‡´æ„å¤–ç»ˆæ­¢ã€‚</li></ul><h4 id="3-3-5-çº¿ç¨‹çŠ¶æ€è½¬æ¢"><a href="#3-3-5-çº¿ç¨‹çŠ¶æ€è½¬æ¢" class="headerlink" title="3.3.5.çº¿ç¨‹çŠ¶æ€è½¬æ¢"></a>3.3.5.çº¿ç¨‹çŠ¶æ€è½¬æ¢</h4><ul><li>Blocked çŠ¶æ€è¿›å…¥ Runnable çŠ¶æ€ï¼Œè¦æ±‚çº¿ç¨‹è·å– monitor é”</li><li>Waiting çŠ¶æ€æµè½¬åˆ°å…¶ä»–çŠ¶æ€åˆ™æ¯”è¾ƒç‰¹æ®Šï¼Œå› ä¸ºé¦–å…ˆ Waiting æ˜¯ä¸é™æ—¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ— è®ºè¿‡äº†å¤šé•¿æ—¶é—´å®ƒéƒ½<u>ä¸ä¼šä¸»åŠ¨æ¢å¤</u>ã€‚<ul><li><strong>åªæœ‰å½“æ‰§è¡Œäº† LockSupport.unpark()ï¼Œæˆ–è€… join çš„çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæˆ–è€…è¢«ä¸­æ–­æ—¶æ‰å¯ä»¥è¿›å…¥ Runnable çŠ¶æ€ã€‚</strong></li><li><strong>å¦‚æœå…¶ä»–çº¿ç¨‹è°ƒç”¨ notify() æˆ– notifyAll()æ¥å”¤é†’å®ƒï¼Œå®ƒä¼šç›´æ¥è¿›å…¥ Blocked çŠ¶æ€ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºå”¤é†’ Waiting çº¿ç¨‹çš„çº¿ç¨‹å¦‚æœè°ƒç”¨ notify() æˆ– notifyAll()ï¼Œè¦æ±‚å¿…é¡»é¦–å…ˆæŒæœ‰è¯¥ monitor é”ï¼Œæ‰€ä»¥å¤„äº Waiting çŠ¶æ€çš„çº¿ç¨‹è¢«å”¤é†’æ—¶æ‹¿ä¸åˆ°è¯¥é”ï¼Œå°±ä¼šè¿›å…¥ Blocked çŠ¶æ€ï¼Œç›´åˆ°æ‰§è¡Œäº† notify()&#x2F;notifyAll() çš„å”¤é†’å®ƒçš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å¹¶é‡Šæ”¾ monitor é”ï¼Œæ‰å¯èƒ½è½®åˆ°å®ƒå»æŠ¢å¤ºè¿™æŠŠé”ï¼Œå¦‚æœå®ƒèƒ½æŠ¢åˆ°ï¼Œå°±ä¼šä» Blocked çŠ¶æ€å›åˆ° Runnable çŠ¶æ€ã€‚</strong></li></ul></li><li>Timed Waiting çŠ¶æ€åŒç†ï¼Œåªä¸è¿‡æ˜¯åœ¨è§„å®šæ—¶é—´èŒƒå›´å†…ä¸Waitingç›¸åŒ</li></ul><h3 id="3-4-waitã€notifyã€notifyAll-æ–¹æ³•çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼Ÿ"><a href="#3-4-waitã€notifyã€notifyAll-æ–¹æ³•çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼Ÿ" class="headerlink" title="3.4.waitã€notifyã€notifyAll æ–¹æ³•çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼Ÿ"></a>3.4.waitã€notifyã€notifyAll æ–¹æ³•çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼Ÿ</h3><h4 id="3-4-1ä¸ºä»€ä¹ˆ-wait-å¿…é¡»åœ¨-synchronized-ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Ÿ"><a href="#3-4-1ä¸ºä»€ä¹ˆ-wait-å¿…é¡»åœ¨-synchronized-ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Ÿ" class="headerlink" title="3.4.1ä¸ºä»€ä¹ˆ wait å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Ÿ"></a>3.4.1ä¸ºä»€ä¹ˆ wait å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ï¼Ÿ</h4><p>â€‹è€ƒè™‘ä¸‹è¿°æƒ…å†µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BlockingQueue</span> &#123;</span><br><span class="line">    Queue&lt;String&gt; buffer = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;String&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">give</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        buffer.add(data);</span><br><span class="line">        notify();  <span class="comment">// Since someone may be waiting in take</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (buffer.isEmpty()) &#123;</span><br><span class="line">            wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> buffer.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸èƒ½ç¡®ä¿ notify æ–¹æ³•æ°¸è¿œä¸ä¼šåœ¨ buffer.isEmpty å’Œ wait æ–¹æ³•ä¹‹é—´è¢«è°ƒç”¨ï¼Œå¦‚æœçœŸè¿™æ ·å‘ç”Ÿäº†ï¼Œç¨‹åºå°±ä¼šä¸€ç›´è¢«waitè€Œä¸èƒŒå”¤é†’ã€‚</p><h4 id="3-4-2-ä¸ºä»€ä¹ˆ-wait-x2F-notify-x2F-notifyAll-è¢«å®šä¹‰åœ¨-Object-ç±»ä¸­ï¼Œè€Œ-sleep-å®šä¹‰åœ¨-Thread-ç±»ä¸­ï¼Ÿ"><a href="#3-4-2-ä¸ºä»€ä¹ˆ-wait-x2F-notify-x2F-notifyAll-è¢«å®šä¹‰åœ¨-Object-ç±»ä¸­ï¼Œè€Œ-sleep-å®šä¹‰åœ¨-Thread-ç±»ä¸­ï¼Ÿ" class="headerlink" title="3.4.2.ä¸ºä»€ä¹ˆ wait&#x2F;notify&#x2F;notifyAll è¢«å®šä¹‰åœ¨ Object ç±»ä¸­ï¼Œè€Œ sleep å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Ÿ"></a>3.4.2.ä¸ºä»€ä¹ˆ wait&#x2F;notify&#x2F;notifyAll è¢«å®šä¹‰åœ¨ Object ç±»ä¸­ï¼Œè€Œ sleep å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Ÿ</h4><ol><li>å› ä¸º Java ä¸­<u>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€æŠŠç§°ä¹‹ä¸º monitor ç›‘è§†å™¨çš„é”</u>ï¼Œç”±äºæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä¸Šé”ï¼Œè¿™å°±è¦æ±‚åœ¨å¯¹è±¡å¤´ä¸­æœ‰ä¸€ä¸ªç”¨æ¥ä¿å­˜é”ä¿¡æ¯çš„ä½ç½®ã€‚è¿™ä¸ªé”æ˜¯å¯¹è±¡çº§åˆ«çš„ï¼Œè€Œéçº¿ç¨‹çº§åˆ«çš„ï¼Œwait&#x2F;notify&#x2F;notifyAll ä¹Ÿéƒ½æ˜¯é”çº§åˆ«çš„æ“ä½œï¼Œå®ƒä»¬çš„é”å±äºå¯¹è±¡ï¼Œæ‰€ä»¥æŠŠå®ƒä»¬å®šä¹‰åœ¨ Object ç±»ä¸­æ˜¯æœ€åˆé€‚ï¼Œå› ä¸º Object ç±»æ˜¯æ‰€æœ‰å¯¹è±¡çš„çˆ¶ç±»ã€‚</li><li>å› ä¸ºå¦‚æœæŠŠ wait&#x2F;notify&#x2F;notifyAll æ–¹æ³•å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Œä¼šå¸¦æ¥å¾ˆå¤§çš„å±€é™æ€§ï¼Œæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å¯èƒ½æŒæœ‰å¤šæŠŠé”ï¼Œä»¥ä¾¿å®ç°ç›¸äº’é…åˆçš„å¤æ‚é€»è¾‘ï¼Œå‡è®¾æ­¤æ—¶ wait æ–¹æ³•å®šä¹‰åœ¨ Thread ç±»ä¸­ï¼Œå¦‚ä½•å®ç°è®©ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å¤šæŠŠé”å‘¢ï¼Ÿåˆå¦‚ä½•æ˜ç¡®çº¿ç¨‹ç­‰å¾…çš„æ˜¯å“ªæŠŠé”å‘¢ï¼Ÿæ—¢ç„¶æˆ‘ä»¬æ˜¯è®©å½“å‰çº¿ç¨‹å»ç­‰å¾…æŸä¸ªå¯¹è±¡çš„é”ï¼Œè‡ªç„¶åº”è¯¥é€šè¿‡æ“ä½œå¯¹è±¡æ¥å®ç°ï¼Œè€Œä¸æ˜¯æ“ä½œçº¿ç¨‹ã€‚</li></ol><h4 id="3-4-5-wait-x2F-notify-å’Œ-sleep-æ–¹æ³•çš„å¼‚åŒï¼Ÿ"><a href="#3-4-5-wait-x2F-notify-å’Œ-sleep-æ–¹æ³•çš„å¼‚åŒï¼Ÿ" class="headerlink" title="3.4.5.wait&#x2F;notify å’Œ sleep æ–¹æ³•çš„å¼‚åŒï¼Ÿ"></a>3.4.5.wait&#x2F;notify å’Œ sleep æ–¹æ³•çš„å¼‚åŒï¼Ÿ</h4><h5 id="ç›¸åŒç‚¹ï¼š"><a href="#ç›¸åŒç‚¹ï¼š" class="headerlink" title="ç›¸åŒç‚¹ï¼š"></a>ç›¸åŒç‚¹ï¼š</h5><ol><li>å®ƒä»¬éƒ½å¯ä»¥è®©çº¿ç¨‹é˜»å¡ã€‚</li><li>å®ƒä»¬éƒ½å¯ä»¥å“åº” interrupt ä¸­æ–­ï¼šåœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­å¦‚æœæ”¶åˆ°ä¸­æ–­ä¿¡å·ï¼Œéƒ½å¯ä»¥è¿›è¡Œå“åº”ï¼Œå¹¶æŠ›å‡º InterruptedException å¼‚å¸¸ã€‚</li></ol><h5 id="ä¸åŒç‚¹ï¼š"><a href="#ä¸åŒç‚¹ï¼š" class="headerlink" title="ä¸åŒç‚¹ï¼š"></a>ä¸åŒç‚¹ï¼š</h5><ol><li><u><strong>wait æ–¹æ³•å¿…é¡»åœ¨ synchronized ä¿æŠ¤çš„ä»£ç ä¸­ä½¿ç”¨</strong></u>ï¼Œè€Œ sleep æ–¹æ³•å¹¶æ²¡æœ‰è¿™ä¸ªè¦æ±‚ã€‚</li><li>åœ¨åŒæ­¥ä»£ç ä¸­<strong>æ‰§è¡Œ sleep æ–¹æ³•æ—¶ï¼Œå¹¶ä¸ä¼šé‡Šæ”¾ monitor é”</strong>ï¼Œä½†<u>æ‰§è¡Œ wait æ–¹æ³•æ—¶ä¼šä¸»åŠ¨é‡Šæ”¾ monitor é”</u>ã€‚</li><li>sleep æ–¹æ³•ä¸­ä¼šè¦æ±‚å¿…é¡»å®šä¹‰ä¸€ä¸ªæ—¶é—´ï¼Œ<u>æ—¶é—´åˆ°æœŸåä¼šä¸»åŠ¨æ¢å¤</u>ï¼Œè€Œå¯¹äºæ²¡æœ‰å‚æ•°çš„ wait æ–¹æ³•è€Œè¨€ï¼Œæ„å‘³ç€æ°¸ä¹…ç­‰å¾…ï¼Œç›´åˆ°è¢«ä¸­æ–­æˆ–è¢«å”¤é†’æ‰èƒ½æ¢å¤ï¼Œå®ƒå¹¶<u>ä¸ä¼šä¸»åŠ¨æ¢å¤</u>ã€‚</li><li>wait&#x2F;notify æ˜¯ Object ç±»çš„æ–¹æ³•ï¼Œè€Œ sleep æ˜¯ Thread ç±»çš„æ–¹æ³•ã€‚</li></ol><h3 id="3-5-ä¸‰ç±»çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#3-5-ä¸‰ç±»çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="3.5.ä¸‰ç±»çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>3.5.ä¸‰ç±»çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><h4 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</h4><ul><li>å½“å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº›çº¿ç¨‹åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„è°ƒåº¦å’Œäº¤æ›¿æ‰§è¡Œé—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥ï¼Œè€Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºéƒ½å¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœï¼Œé‚£è¿™ä¸ªå¯¹è±¡ä¾¿æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li>å¦‚æœæŸä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé‚£ä¹ˆå¯¹äºä½¿ç”¨è€…è€Œè¨€ï¼Œåœ¨ä½¿ç”¨æ—¶å°±ä¸éœ€è¦è€ƒè™‘æ–¹æ³•é—´çš„åè°ƒé—®é¢˜ï¼Œæ¯”å¦‚ä¸éœ€è¦è€ƒè™‘ä¸èƒ½åŒæ—¶å†™å…¥æˆ–è¯»å†™ä¸èƒ½å¹¶è¡Œçš„é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘ä»»ä½•é¢å¤–çš„åŒæ­¥é—®é¢˜ï¼Œæ¯”å¦‚ä¸éœ€è¦é¢å¤–è‡ªå·±åŠ  synchronized é”ï¼Œé‚£ä¹ˆå®ƒæ‰æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥çœ‹å‡ºå¯¹çº¿ç¨‹å®‰å…¨çš„å®šä¹‰è¿˜æ˜¯éå¸¸è‹›åˆ»çš„ã€‚</li></ul><h4 id="ä¸‰ç§å…¸å‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#ä¸‰ç§å…¸å‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="ä¸‰ç§å…¸å‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>ä¸‰ç§å…¸å‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</h4><ol><li>è¿è¡Œç»“æœé”™è¯¯ï¼›</li><li>å‘å¸ƒå’Œåˆå§‹åŒ–å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›</li><li>æ´»è·ƒæ€§é—®é¢˜ã€‚</li></ol><h5 id="3-1-è¿è¡Œç»“æœé”™è¯¯"><a href="#3-1-è¿è¡Œç»“æœé”™è¯¯" class="headerlink" title="3.1.è¿è¡Œç»“æœé”™è¯¯"></a>3.1.è¿è¡Œç»“æœé”™è¯¯</h5><ul><li>å¤šçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªå˜é‡å¯¼è‡´çš„è¿è¡Œç»“æœé”™è¯¯]</li><li>æ˜¯å› ä¸ºåœ¨å¤šçº¿ç¨‹ä¸‹ï¼ŒCPU çš„è°ƒåº¦æ˜¯ä»¥<strong>æ—¶é—´ç‰‡ä¸ºå•ä½</strong>è¿›è¡Œåˆ†é…çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥å¾—åˆ°ä¸€å®šé‡çš„æ—¶é—´ç‰‡ã€‚ä½†å¦‚æœçº¿ç¨‹æ‹¥æœ‰çš„æ—¶é—´ç‰‡è€—å°½ï¼Œå®ƒå°†ä¼šè¢«æš‚åœæ‰§è¡Œå¹¶è®©å‡º CPU èµ„æºç»™å…¶ä»–çº¿ç¨‹ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å‘ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚æ¯”å¦‚ i++ æ“ä½œï¼Œè¡¨é¢ä¸Šçœ‹åªæ˜¯ä¸€è¡Œä»£ç ï¼Œä½†å®é™…ä¸Šå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå®ƒçš„æ‰§è¡Œæ­¥éª¤ä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼Œè€Œä¸”åœ¨æ¯æ­¥æ“ä½œä¹‹é—´éƒ½æœ‰å¯èƒ½è¢«æ‰“æ–­ã€‚</li></ul><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230803190731854.png" alt="image-20230803190731854" style="zoom: 33%;" /><h5 id="3-2-å‘å¸ƒå’Œåˆå§‹åŒ–å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#3-2-å‘å¸ƒå’Œåˆå§‹åŒ–å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="3.2.å‘å¸ƒå’Œåˆå§‹åŒ–å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>3.2.å‘å¸ƒå’Œåˆå§‹åŒ–å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜</h5><ul><li>æˆ‘ä»¬åˆ›å»ºå¯¹è±¡å¹¶è¿›è¡Œå‘å¸ƒå’Œåˆå§‹åŒ–ä¾›å…¶ä»–ç±»æˆ–å¯¹è±¡ä½¿ç”¨æ˜¯å¸¸è§çš„æ“ä½œï¼Œä½†å¦‚æœæˆ‘ä»¬æ“ä½œçš„æ—¶é—´æˆ–åœ°ç‚¹ä¸å¯¹ï¼Œå°±å¯èƒ½å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WrongInit</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, String&gt; students;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WrongInit</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                students = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                students.put(<span class="number">1</span>, <span class="string">&quot;ç‹å°ç¾&quot;</span>);</span><br><span class="line">                students.put(<span class="number">2</span>, <span class="string">&quot;é’±äºŒå®&quot;</span>);</span><br><span class="line">                students.put(<span class="number">3</span>, <span class="string">&quot;å‘¨ä¸‰&quot;</span>);</span><br><span class="line">                students.put(<span class="number">4</span>, <span class="string">&quot;èµµå››&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="keyword">public</span> Map&lt;Integer, String&gt; <span class="title function_">getStudents</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> students;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">WrongInit</span> <span class="variable">multiThreadsError6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WrongInit</span>();</span><br><span class="line">        System.out.println(multiThreadsError6.getStudents().get(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­ åˆ›å»ºmultiThreadsError6å¯¹è±¡åç«‹åˆ»å°±è¯•å›¾è¾“å‡ºstudentçš„ä¿¡æ¯ï¼Œè€Œå®é™…ä¸Šæ­¤æ—¶çº¿ç¨‹å¯èƒ½è¿˜æ²¡å¯åŠ¨å®Œæ¯•ï¼Œå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.NullPointerException</span><br><span class="line">at lesson6.WrongInit.main(WrongInit.java:32)</span><br></pre></td></tr></table></figure><h5 id="3-3-æ´»è·ƒæ€§é—®é¢˜"><a href="#3-3-æ´»è·ƒæ€§é—®é¢˜" class="headerlink" title="3.3.æ´»è·ƒæ€§é—®é¢˜"></a>3.3.æ´»è·ƒæ€§é—®é¢˜</h5><ul><li>æ­»é”<ul><li>â€¦â€¦</li></ul></li><li>æ´»é”<ul><li>æ´»é”ä¸æ­»é”éå¸¸ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ç¨‹åºä¸€ç›´ç­‰ä¸åˆ°ç»“æœï¼Œä½†å¯¹æ¯”äºæ­»é”ï¼Œæ´»é”æ˜¯æ´»çš„ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå› ä¸º<u>æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å¹¶æ²¡æœ‰é˜»å¡ï¼Œå®ƒå§‹ç»ˆåœ¨è¿è¡Œä¸­ï¼Œå´ä¸€ç›´å¾—ä¸åˆ°ç»“æœã€‚</u></li><li>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œæ”¾ç€å„ç§å„æ ·éœ€è¦è¢«å¤„ç†çš„æ¶ˆæ¯ï¼Œè€ŒæŸä¸ªæ¶ˆæ¯ç”±äºè‡ªèº«è¢«å†™é”™äº†å¯¼è‡´ä¸èƒ½è¢«æ­£ç¡®å¤„ç†ï¼Œæ‰§è¡Œæ—¶ä¼šæŠ¥é”™ï¼Œå¯æ˜¯é˜Ÿåˆ—çš„é‡è¯•æœºåˆ¶ä¼šé‡æ–°æŠŠå®ƒæ”¾åœ¨é˜Ÿåˆ—å¤´è¿›è¡Œä¼˜å…ˆé‡è¯•å¤„ç†ï¼Œä½†è¿™ä¸ªæ¶ˆæ¯æœ¬èº«æ— è®ºè¢«æ‰§è¡Œå¤šå°‘æ¬¡ï¼Œéƒ½æ— æ³•è¢«æ­£ç¡®å¤„ç†ï¼Œæ¯æ¬¡æŠ¥é”™ååˆä¼šè¢«æ”¾åˆ°é˜Ÿåˆ—å¤´è¿›è¡Œé‡è¯•ï¼Œå‘¨è€Œå¤å§‹ï¼Œæœ€ç»ˆå¯¼è‡´çº¿ç¨‹ä¸€ç›´å¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œä½†ç¨‹åºå§‹ç»ˆå¾—ä¸åˆ°ç»“æœï¼Œä¾¿å‘ç”Ÿäº†æ´»é”é—®é¢˜</li></ul></li><li>é¥¥é¥¿<ul><li>é¥¥é¥¿æ˜¯æŒ‡çº¿ç¨‹éœ€è¦æŸäº›èµ„æºæ—¶å§‹ç»ˆå¾—ä¸åˆ°ï¼Œå°¤å…¶æ˜¯CPU èµ„æºï¼Œå°±ä¼šå¯¼è‡´çº¿ç¨‹ä¸€ç›´ä¸èƒ½è¿è¡Œè€Œäº§ç”Ÿçš„é—®é¢˜ã€‚åœ¨ Java ä¸­æœ‰çº¿ç¨‹ä¼˜å…ˆçº§çš„æ¦‚å¿µï¼ŒJava ä¸­ä¼˜å…ˆçº§åˆ†ä¸º 1 åˆ° 10ï¼Œ1 æœ€ä½ï¼Œ10 æœ€é«˜ã€‚å¦‚æœæˆ‘ä»¬æŠŠæŸä¸ªçº¿ç¨‹çš„ä¼˜å…ˆçº§è®¾ç½®ä¸º 1ï¼Œè¿™æ˜¯æœ€ä½çš„ä¼˜å…ˆçº§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªçº¿ç¨‹å°±<u>æœ‰å¯èƒ½å§‹ç»ˆåˆ†é…ä¸åˆ° CPU èµ„æº</u>ï¼Œè€Œå¯¼è‡´é•¿æ—¶é—´æ— æ³•è¿è¡Œã€‚æˆ–è€…æ˜¯æŸä¸ªçº¿ç¨‹å§‹ç»ˆæŒæœ‰æŸä¸ªæ–‡ä»¶çš„é”ï¼Œè€Œå…¶ä»–çº¿ç¨‹æƒ³è¦ä¿®æ”¹æ–‡ä»¶å°±å¿…é¡»å…ˆè·å–é”ï¼Œè¿™æ ·æƒ³è¦ä¿®æ”¹æ–‡ä»¶çš„çº¿ç¨‹å°±ä¼šé™·å…¥é¥¥é¥¿ï¼Œé•¿æ—¶é—´ä¸èƒ½è¿è¡Œã€‚</li></ul></li></ul><h3 id="3-6-å“ªäº›åœºæ™¯éœ€è¦é¢å¤–æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ"><a href="#3-6-å“ªäº›åœºæ™¯éœ€è¦é¢å¤–æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ" class="headerlink" title="3.6.å“ªäº›åœºæ™¯éœ€è¦é¢å¤–æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ"></a>3.6.å“ªäº›åœºæ™¯éœ€è¦é¢å¤–æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ</h3><h4 id="3-6-1-è®¿é—®å…±äº«å˜é‡æˆ–èµ„æº"><a href="#3-6-1-è®¿é—®å…±äº«å˜é‡æˆ–èµ„æº" class="headerlink" title="3.6.1.è®¿é—®å…±äº«å˜é‡æˆ–èµ„æº"></a>3.6.1.è®¿é—®å…±äº«å˜é‡æˆ–èµ„æº</h4><p>â€‹å…¸å‹çš„åœºæ™¯æœ‰è®¿é—®å…±äº«å¯¹è±¡çš„å±æ€§ï¼Œè®¿é—® static é™æ€å˜é‡ï¼Œè®¿é—®å…±äº«çš„ç¼“å­˜ï¼Œç­‰ç­‰ã€‚å› ä¸ºè¿™äº›ä¿¡æ¯ä¸ä»…ä¼šè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®åˆ°ï¼Œè¿˜æœ‰å¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œé‚£ä¹ˆå°±<u><strong>æœ‰å¯èƒ½åœ¨å¹¶å‘è¯»å†™çš„æƒ…å†µä¸‹å‘ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜</strong></u>ã€‚æ¯”å¦‚æˆ‘ä»¬ä¸Šä¸€è¯¾æ—¶è®²è¿‡çš„å¤šçº¿ç¨‹åŒæ—¶ i++ çš„ä¾‹å­</p><h4 id="3-6-2-ä¾èµ–æ—¶åºçš„æ“ä½œ"><a href="#3-6-2-ä¾èµ–æ—¶åºçš„æ“ä½œ" class="headerlink" title="3.6.2.ä¾èµ–æ—¶åºçš„æ“ä½œ"></a>3.6.2.ä¾èµ–æ—¶åºçš„æ“ä½œ</h4><p>â€‹å¦‚æœæˆ‘ä»¬<u>æ“ä½œçš„æ­£ç¡®æ€§æ˜¯ä¾èµ–æ—¶åº</u>çš„ï¼Œè€Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹<u>åˆä¸èƒ½ä¿éšœæ‰§è¡Œçš„é¡ºåºå’Œæˆ‘ä»¬é¢„æƒ³çš„ä¸€è‡´</u>ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå‘ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¾‹å¦‚å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä»¥ä¸‹ä»£ç ï¼š</span></span><br><span class="line"><span class="keyword">if</span> (x == <span class="number">1</span>) &#123;</span><br><span class="line">    x = <span class="number">7</span> * x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-6-3-ä¸åŒæ•°æ®ä¹‹é—´å­˜åœ¨ç»‘å®šå…³ç³»"><a href="#3-6-3-ä¸åŒæ•°æ®ä¹‹é—´å­˜åœ¨ç»‘å®šå…³ç³»" class="headerlink" title="3.6.3.ä¸åŒæ•°æ®ä¹‹é—´å­˜åœ¨ç»‘å®šå…³ç³»"></a>3.6.3.ä¸åŒæ•°æ®ä¹‹é—´å­˜åœ¨<u>ç»‘å®šå…³ç³»</u></h4><p>â€‹æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬çš„ä¸åŒæ•°æ®ä¹‹é—´æ˜¯æˆç»„å‡ºç°çš„ï¼Œå­˜åœ¨ç€ç›¸äº’å¯¹åº”æˆ–ç»‘å®šçš„å…³ç³»ï¼Œ<u><strong>æœ€å…¸å‹çš„å°±æ˜¯ IP å’Œç«¯å£å·</strong></u>ã€‚æœ‰æ—¶å€™æˆ‘ä»¬æ›´æ¢äº† IPï¼Œå¾€å¾€éœ€è¦åŒæ—¶æ›´æ¢ç«¯å£å·ï¼Œå¦‚æœæ²¡æœ‰æŠŠè¿™ä¸¤ä¸ªæ“ä½œç»‘å®šåœ¨ä¸€èµ·ï¼Œå°±æœ‰å¯èƒ½å‡ºç°å•ç‹¬æ›´æ¢äº† IP æˆ–ç«¯å£å·çš„æƒ…å†µï¼Œè€Œæ­¤æ—¶ä¿¡æ¯å¦‚æœå·²ç»å¯¹å¤–å‘å¸ƒï¼Œä¿¡æ¯è·å–æ–¹å°±æœ‰å¯èƒ½è·å–ä¸€ä¸ªé”™è¯¯çš„ IP ä¸ç«¯å£ç»‘å®šæƒ…å†µï¼Œè¿™æ—¶å°±å‘ç”Ÿäº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹ŸåŒæ ·éœ€è¦ä¿éšœæ“ä½œçš„åŸå­æ€§ã€‚</p><h4 id="3-6-4-å¯¹æ–¹æ²¡æœ‰å£°æ˜è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„"><a href="#3-6-4-å¯¹æ–¹æ²¡æœ‰å£°æ˜è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„" class="headerlink" title="3.6.4.å¯¹æ–¹æ²¡æœ‰å£°æ˜è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„"></a>3.6.4.å¯¹æ–¹æ²¡æœ‰å£°æ˜è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„</h4><p>æˆ‘ä»¬ä½¿ç”¨å…¶ä»–ç±»æ—¶ï¼Œå¦‚æœå¯¹æ–¹æ²¡æœ‰å£°æ˜è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹å¯¹å…¶ä»–ç±»è¿›è¡Œå¤šçº¿ç¨‹çš„å¹¶å‘æ“ä½œï¼Œå°±æœ‰å¯èƒ½ä¼šå‘ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>å¦‚ï¼šArrayListå¦‚æœæˆ‘ä»¬æŠŠ ArrayList ç”¨åœ¨äº†å¤šçº¿ç¨‹çš„åœºæ™¯ï¼Œéœ€è¦åœ¨å¤–éƒ¨æ‰‹åŠ¨ç”¨ synchronized ç­‰æ–¹å¼ä¿è¯å¹¶å‘å®‰å…¨ã€‚</p><h3 id="3-7-ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ"><a href="#3-7-ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ" class="headerlink" title="3.7.ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ"></a>3.7.ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ</h3><h4 id="3-7-1ä»€ä¹ˆæ˜¯æ€§èƒ½é—®é¢˜ï¼Ÿ"><a href="#3-7-1ä»€ä¹ˆæ˜¯æ€§èƒ½é—®é¢˜ï¼Ÿ" class="headerlink" title="3.7.1ä»€ä¹ˆæ˜¯æ€§èƒ½é—®é¢˜ï¼Ÿ"></a>3.7.1ä»€ä¹ˆæ˜¯æ€§èƒ½é—®é¢˜ï¼Ÿ</h4><p>ä½¿ç”¨å¤šçº¿ç¨‹çš„æœ€å¤§ç›®çš„ä¸å°±æ˜¯ä¸ºäº†æé«˜æ€§èƒ½å—ï¼Ÿè®©å¤šä¸ªçº¿ç¨‹åŒæ—¶å·¥ä½œï¼ŒåŠ å¿«ç¨‹åºè¿è¡Œé€Ÿåº¦ï¼Œä¸ºä»€ä¹ˆåè€Œä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜å‘¢ï¼Ÿè¿™æ˜¯<u>å› ä¸ºå•çº¿ç¨‹ç¨‹åºæ˜¯ç‹¬ç«‹å·¥ä½œçš„ï¼Œä¸éœ€è¦ä¸å…¶ä»–çº¿ç¨‹è¿›è¡Œäº¤äº’ï¼Œä½†å¤šçº¿ç¨‹ä¹‹é—´åˆ™éœ€è¦è°ƒåº¦ä»¥åŠåˆä½œï¼Œè°ƒåº¦ä¸åˆä½œå°±ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ä»è€Œäº§ç”Ÿæ€§èƒ½é—®é¢˜ã€‚</u></p><h4 id="3-7-2-ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ"><a href="#3-7-2-ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ" class="headerlink" title="3.7.2.ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ"></a>3.7.2.ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Ÿ</h4><p>åˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š</p><h5 id="ğŸŒŸè°ƒåº¦å¼€é”€ï¼š"><a href="#ğŸŒŸè°ƒåº¦å¼€é”€ï¼š" class="headerlink" title="ğŸŒŸè°ƒåº¦å¼€é”€ï¼š"></a>ğŸŒŸè°ƒåº¦å¼€é”€ï¼š</h5><ul><li>âš ï¸ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š<ul><li>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹çº¿ç¨‹è°ƒåº¦ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œçº¿ç¨‹æ•°å¾€å¾€æ˜¯å¤§äº CPU æ ¸å¿ƒæ•°çš„ï¼Œæ¯”å¦‚ CPU æ ¸å¿ƒæ•°å¯èƒ½æ˜¯ 8 æ ¸ã€16 æ ¸ï¼Œç­‰ç­‰ï¼Œä½†çº¿ç¨‹æ•°å¯èƒ½è¾¾åˆ°æˆç™¾ä¸Šåƒä¸ªã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šæŒ‰ç…§ä¸€å®šçš„è°ƒåº¦ç®—æ³•ï¼Œç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡ï¼Œè®©æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰æœºä¼šå¾—åˆ°è¿è¡Œã€‚è€Œåœ¨è¿›è¡Œè°ƒåº¦æ—¶å°±ä¼šå¼•èµ·ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šæŒ‚èµ·å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¹¶ä¿å­˜å½“å‰çš„çŠ¶æ€ï¼Œç„¶åå¯»æ‰¾ä¸‹ä¸€å¤„å³å°†æ¢å¤æ‰§è¡Œçš„ä»£ç ï¼Œå”¤é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œä»¥æ­¤ç±»æ¨ï¼Œåå¤æ‰§è¡Œã€‚ä½†ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„å¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œå‡è®¾æˆ‘ä»¬çš„ä»»åŠ¡å†…å®¹éå¸¸çŸ­ï¼Œæ¯”å¦‚åªè¿›è¡Œç®€å•çš„è®¡ç®—ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å‘ç”Ÿæˆ‘ä»¬ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„æ€§èƒ½å¼€é”€æ¯”æ‰§è¡Œçº¿ç¨‹æœ¬èº«å†…å®¹å¸¦æ¥çš„å¼€é”€è¿˜è¦å¤§çš„æƒ…å†µã€‚</li></ul></li><li>âš ï¸ç¼“å­˜å¤±æ•ˆï¼š<ul><li>ç”±äºç¨‹åºæœ‰å¾ˆå¤§æ¦‚ç‡ä¼šå†æ¬¡è®¿é—®åˆšæ‰è®¿é—®è¿‡çš„æ•°æ®ï¼Œæ‰€ä»¥ä¸ºäº†åŠ é€Ÿæ•´ä¸ªç¨‹åºçš„è¿è¡Œï¼Œä¼šä½¿ç”¨ç¼“å­˜ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ä½¿ç”¨ç›¸åŒæ•°æ®æ—¶å°±å¯ä»¥å¾ˆå¿«åœ°è·å–æ•°æ®ã€‚å¯ä¸€æ—¦è¿›è¡Œäº†çº¿ç¨‹è°ƒåº¦ï¼Œåˆ‡æ¢åˆ°å…¶ä»–çº¿ç¨‹ï¼ŒCPUå°±ä¼šå»æ‰§è¡Œä¸åŒçš„ä»£ç ï¼ŒåŸæœ‰çš„ç¼“å­˜å°±å¾ˆå¯èƒ½å¤±æ•ˆäº†ï¼Œéœ€è¦é‡æ–°ç¼“å­˜æ–°çš„æ•°æ®ï¼Œè¿™ä¹Ÿä¼šé€ æˆä¸€å®šçš„å¼€é”€ï¼Œæ‰€ä»¥çº¿ç¨‹è°ƒåº¦å™¨ä¸ºäº†é¿å…é¢‘ç¹åœ°å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ<u><strong>é€šå¸¸ä¼šç»™è¢«è°ƒåº¦åˆ°çš„çº¿ç¨‹è®¾ç½®æœ€å°çš„æ‰§è¡Œæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯åªæœ‰æ‰§è¡Œå®Œè¿™æ®µæ—¶é—´ä¹‹åï¼Œæ‰å¯èƒ½è¿›è¡Œä¸‹ä¸€æ¬¡çš„è°ƒåº¦ï¼Œç”±æ­¤å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ã€‚</strong></u></li></ul></li></ul><h5 id="ğŸŒŸåä½œå¼€é”€ï¼š"><a href="#ğŸŒŸåä½œå¼€é”€ï¼š" class="headerlink" title="ğŸŒŸåä½œå¼€é”€ï¼š"></a>ğŸŒŸåä½œå¼€é”€ï¼š</h5><p>â€”-ç»´æŠ¤å…±äº«æ•°æ®çš„å¼€é”€</p><ul><li>é™¤äº†çº¿ç¨‹è°ƒåº¦ä¹‹å¤–ï¼Œçº¿ç¨‹åä½œåŒæ ·ä¹Ÿæœ‰å¯èƒ½å¸¦æ¥æ€§èƒ½é—®é¢˜ã€‚<u>å› ä¸ºçº¿ç¨‹ä¹‹é—´å¦‚æœæœ‰å…±äº«æ•°æ®ï¼Œä¸ºäº†é¿å…æ•°æ®é”™ä¹±ï¼Œä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå°±æœ‰å¯èƒ½ç¦æ­¢ç¼–è¯‘å™¨å’Œ CPU å¯¹å…¶è¿›è¡Œé‡æ’åºç­‰ä¼˜åŒ–</u>ï¼Œä¹Ÿå¯èƒ½å‡ºäºåŒæ­¥çš„ç›®çš„ï¼Œåå¤æŠŠçº¿ç¨‹å·¥ä½œå†…å­˜çš„æ•°æ® flush åˆ°ä¸»å­˜ä¸­ï¼Œç„¶åå†ä»ä¸»å†…å­˜ refresh åˆ°å…¶ä»–çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œç­‰ç­‰ã€‚è¿™äº›é—®é¢˜åœ¨å•çº¿ç¨‹ä¸­å¹¶ä¸å­˜åœ¨ï¼Œä½†åœ¨å¤šçº¿ç¨‹ä¸­ä¸ºäº†ç¡®ä¿æ•°æ®çš„æ­£ç¡®æ€§ï¼Œå°±ä¸å¾—ä¸é‡‡å–ä¸Šè¿°æ–¹æ³•ï¼Œå› ä¸ºçº¿ç¨‹å®‰å…¨çš„ä¼˜å…ˆçº§è¦æ¯”æ€§èƒ½ä¼˜å…ˆçº§æ›´é«˜ï¼Œè¿™ä¹Ÿé—´æ¥é™ä½äº†æˆ‘ä»¬çš„æ€§èƒ½ã€‚</li></ul><h3 id="3-8-ä½¿ç”¨çº¿ç¨‹æ± æ¯”æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å¥½åœ¨å“ªé‡Œï¼Ÿ"><a href="#3-8-ä½¿ç”¨çº¿ç¨‹æ± æ¯”æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å¥½åœ¨å“ªé‡Œï¼Ÿ" class="headerlink" title="3.8.ä½¿ç”¨çº¿ç¨‹æ± æ¯”æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å¥½åœ¨å“ªé‡Œï¼Ÿ"></a>3.8.ä½¿ç”¨çº¿ç¨‹æ± æ¯”æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹å¥½åœ¨å“ªé‡Œï¼Ÿ</h3><h4 id="3-8-1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ"><a href="#3-8-1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ" class="headerlink" title="3.8.1.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ"></a>3.8.1.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ</h4><p>æ²¡æœ‰çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œæ¯å‘å¸ƒä¸€ä¸ªä»»åŠ¡å°±éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œè¿™æ ·åœ¨ä»»åŠ¡å°‘æ—¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå½“ä»»åŠ¡æ•°å¾ˆå¤šæ—¶ï¼Œæ¯”å¦‚ä»»åŠ¡é‡åˆ°è¾¾äº†10000ï¼Œå°±éœ€è¦åˆ›å»º10000ä¸ªçº¿ç¨‹æ¥åº”å¯¹ä»»åŠ¡ã€‚è€Œ J<u>ava ç¨‹åºä¸­çš„çº¿ç¨‹ä¸æ“ä½œç³»ç»Ÿä¸­çš„çº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”</u>çš„ï¼Œæ­¤æ—¶å‡è®¾çº¿ç¨‹ä¸­çš„ä»»åŠ¡éœ€è¦ä¸€å®šçš„è€—æ—¶æ‰èƒ½å¤Ÿå®Œæˆï¼Œä¾¿ä¼šäº§ç”Ÿå¾ˆå¤§çš„ç³»ç»Ÿå¼€é”€ä¸èµ„æºæµªè´¹ã€‚</p><h5 id="ä¸ä½¿ç”¨çº¿ç¨‹æ± çš„é—®é¢˜ï¼š"><a href="#ä¸ä½¿ç”¨çº¿ç¨‹æ± çš„é—®é¢˜ï¼š" class="headerlink" title="ä¸ä½¿ç”¨çº¿ç¨‹æ± çš„é—®é¢˜ï¼š"></a>ä¸ä½¿ç”¨çº¿ç¨‹æ± çš„é—®é¢˜ï¼š</h5><ol><li>ç¬¬ä¸€ç‚¹ï¼Œ<u>åå¤åˆ›å»ºçº¿ç¨‹ç³»ç»Ÿå¼€é”€æ¯”è¾ƒå¤§</u>ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ›å»ºå’Œé”€æ¯éƒ½éœ€è¦æ—¶é—´ï¼Œ<u>å¦‚æœä»»åŠ¡æ¯”è¾ƒç®€å•ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å¯¼è‡´åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ¶ˆè€—çš„èµ„æºæ¯”çº¿ç¨‹æ‰§è¡Œä»»åŠ¡æœ¬èº«æ¶ˆè€—çš„èµ„æºè¿˜è¦å¤§ã€‚</u></li><li>ç¬¬äºŒç‚¹ï¼Œè¿‡å¤šçš„çº¿ç¨‹ä¼š<strong>å ç”¨è¿‡å¤šçš„å†…å­˜ç­‰èµ„æº</strong>ï¼Œè¿˜ä¼š<strong>å¸¦æ¥è¿‡å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ï¼ŒåŒæ—¶è¿˜ä¼š<strong>å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®š</strong>ã€‚(å¦‚ä¸Šä¸€å°èŠ‚æ‰€è¯´â€”â€”â€”ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ + ç¼“å­˜å¤±æ•ˆ)</li></ol><h4 id="3-8-2-çº¿ç¨‹æ± è§£å†³é—®é¢˜æ€è·¯ï¼š"><a href="#3-8-2-çº¿ç¨‹æ± è§£å†³é—®é¢˜æ€è·¯ï¼š" class="headerlink" title="3.8.2.çº¿ç¨‹æ± è§£å†³é—®é¢˜æ€è·¯ï¼š"></a>3.8.2.çº¿ç¨‹æ± è§£å†³é—®é¢˜æ€è·¯ï¼š</h4><ul><li><p>é’ˆå¯¹åå¤åˆ›å»ºçº¿ç¨‹å¼€é”€å¤§çš„é—®é¢˜ï¼Œ<u>çº¿ç¨‹æ± ç”¨ä¸€äº›å›ºå®šçš„çº¿ç¨‹ä¸€ç›´ä¿æŒå·¥ä½œçŠ¶æ€å¹¶åå¤æ‰§è¡Œä»»åŠ¡ã€‚</u></p></li><li><p>é’ˆå¯¹è¿‡å¤šçº¿ç¨‹å ç”¨å¤ªå¤šå†…å­˜èµ„æºçš„é—®é¢˜ï¼Œè§£å†³æ€è·¯æ›´ç›´æ¥ï¼Œ<u>çº¿ç¨‹æ± ä¼šæ ¹æ®éœ€è¦åˆ›å»ºçº¿ç¨‹ï¼Œæ§åˆ¶çº¿ç¨‹çš„æ€»æ•°é‡ï¼Œé¿å…å ç”¨è¿‡å¤šå†…å­˜èµ„æºã€‚</u></p></li></ul><h4 id="3-8-3-å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± "><a href="#3-8-3-å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± " class="headerlink" title="3.8.3.å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ?"></a>3.8.3.å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ?</h4><p>â€‹æ‰§è¡Œå™¨(Executor)ä¸­æœ‰è®¸å¤šæ„é€ çº¿ç¨‹æ± çš„é™æ€å·¥å‚æ–¹æ³•ï¼Œå¯ä»¥æ„é€ å„ç§çº¿ç¨‹æ± ã€‚</p><p>â€‹å…·ä½“ä½¿ç”¨æ–¹æ³•ä¸Šé¢å·²ç»è¯´æ¸…æ¥šäº†ï¼Œä¿è¯çº¿ç¨‹æ•°ä¸è¶…è¿‡æŸå€¼ï¼Œè¯·æ±‚å¤šäº†å°±æ’é˜Ÿæ’èµ·æ¥ã€‚</p><h4 id="3-8-4-ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ï¼š"><a href="#3-8-4-ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ï¼š" class="headerlink" title="3.8.4.ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ï¼š"></a>3.8.4.ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ï¼š</h4><ol><li>ç¬¬ä¸€ç‚¹ï¼Œçº¿ç¨‹æ± å¯ä»¥è§£å†³çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„ç³»ç»Ÿå¼€é”€é—®é¢˜ï¼ŒåŒæ—¶è¿˜å¯ä»¥åŠ å¿«å“åº”é€Ÿåº¦ã€‚<u>å› ä¸ºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œæˆ‘ä»¬åªç”¨å°‘é‡çš„çº¿ç¨‹å»æ‰§è¡Œå¤§é‡çš„ä»»åŠ¡ï¼Œè¿™å°±å¤§å¤§å‡å°äº†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„å¼€é”€ã€‚</u>è€Œä¸”çº¿ç¨‹é€šå¸¸ä¸æ˜¯ç­‰æ¥åˆ°ä»»åŠ¡åå†ä¸´æ—¶åˆ›å»ºï¼Œè€Œæ˜¯å·²ç»åˆ›å»ºå¥½æ—¶åˆ»å‡†å¤‡æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ ·å°±æ¶ˆé™¤äº†çº¿ç¨‹åˆ›å»ºæ‰€å¸¦æ¥çš„å»¶è¿Ÿï¼Œ<u>æå‡äº†å“åº”é€Ÿåº¦</u>ï¼Œå¢å¼ºäº†ç”¨æˆ·ä½“éªŒã€‚</li><li>ç¬¬äºŒç‚¹ï¼Œçº¿ç¨‹æ± å¯ä»¥ç»Ÿç­¹å†…å­˜å’Œ CPU çš„ä½¿ç”¨ï¼Œé¿å…èµ„æºä½¿ç”¨ä¸å½“ã€‚<u>çº¿ç¨‹æ± ä¼šæ ¹æ®é…ç½®å’Œä»»åŠ¡æ•°é‡çµæ´»åœ°æ§åˆ¶çº¿ç¨‹æ•°é‡ï¼Œä¸å¤Ÿçš„æ—¶å€™å°±åˆ›å»ºï¼Œå¤ªå¤šçš„æ—¶å€™å°±å›æ”¶ï¼Œé¿å…çº¿ç¨‹è¿‡å¤šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œæˆ–çº¿ç¨‹å¤ªå°‘å¯¼è‡´ CPU èµ„æºæµªè´¹ï¼Œè¾¾åˆ°äº†ä¸€ä¸ªå®Œç¾çš„å¹³è¡¡ã€‚</u></li><li>ç¬¬ä¸‰ç‚¹ï¼Œçº¿ç¨‹æ± å¯ä»¥ç»Ÿä¸€ç®¡ç†èµ„æºã€‚æ¯”å¦‚çº¿ç¨‹æ± å¯ä»¥ç»Ÿä¸€ç®¡ç†ä»»åŠ¡é˜Ÿåˆ—å’Œçº¿ç¨‹ï¼Œå¯ä»¥ç»Ÿä¸€å¼€å§‹æˆ–ç»“æŸä»»åŠ¡ï¼Œæ¯”å•ä¸ªçº¿ç¨‹é€ä¸€å¤„ç†ä»»åŠ¡è¦æ›´æ–¹ä¾¿ã€æ›´æ˜“äºç®¡ç†ï¼ŒåŒæ—¶ä¹Ÿæœ‰åˆ©äºæ•°æ®ç»Ÿè®¡ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç»Ÿè®¡å‡ºå·²ç»æ‰§è¡Œè¿‡çš„ä»»åŠ¡çš„æ•°é‡ã€‚</li></ol><h3 id="3-9-çº¿ç¨‹æ± çš„å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼Ÿ"><a href="#3-9-çº¿ç¨‹æ± çš„å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼Ÿ" class="headerlink" title="3.9.çº¿ç¨‹æ± çš„å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼Ÿ"></a>3.9.çº¿ç¨‹æ± çš„å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼Ÿ</h3><h4 id="å‚æ•°åˆ—è¡¨"><a href="#å‚æ•°åˆ—è¡¨" class="headerlink" title="å‚æ•°åˆ—è¡¨"></a>å‚æ•°åˆ—è¡¨</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230804151715352.png" alt="image-20230804151715352" style="zoom:50%;" /><h4 id="ğŸŒŸçº¿ç¨‹æ± ä¸­çº¿ç¨‹åˆ›å»ºçš„æ—¶æœºï¼š"><a href="#ğŸŒŸçº¿ç¨‹æ± ä¸­çº¿ç¨‹åˆ›å»ºçš„æ—¶æœºï¼š" class="headerlink" title="ğŸŒŸçº¿ç¨‹æ± ä¸­çº¿ç¨‹åˆ›å»ºçš„æ—¶æœºï¼š"></a>ğŸŒŸçº¿ç¨‹æ± ä¸­çº¿ç¨‹åˆ›å»ºçš„æ—¶æœºï¼š</h4><p> ![image-20230804151848748](&#x2F;Users&#x2F;donn&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230804151848748.png)</p><h4 id="3-9-1-corePoolSize-ä¸-maximumPoolSize"><a href="#3-9-1-corePoolSize-ä¸-maximumPoolSize" class="headerlink" title="3.9.1.corePoolSize ä¸ maximumPoolSize"></a>3.9.1.corePoolSize ä¸ maximumPoolSize</h4><p>â€‹âš ï¸é€šè¿‡ä¸Šé¢çš„æµç¨‹å›¾ï¼Œæˆ‘ä»¬äº†è§£äº† corePoolSize å’Œ maximumPoolSize çš„å…·ä½“å«ä¹‰ï¼ŒcorePoolSize æŒ‡çš„æ˜¯æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œçº¿ç¨‹æ± åˆå§‹åŒ–æ—¶çº¿ç¨‹æ•°é»˜è®¤ä¸º 0ï¼Œå½“æœ‰æ–°çš„ä»»åŠ¡æäº¤åï¼Œä¼šåˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœä¸åšç‰¹æ®Šè®¾ç½®ï¼Œæ­¤åçº¿ç¨‹æ•°é€šå¸¸ä¸ä¼šå†å°äº corePoolSize ï¼Œå› ä¸ºå®ƒä»¬æ˜¯æ ¸å¿ƒçº¿ç¨‹ï¼Œå³ä¾¿æœªæ¥å¯èƒ½æ²¡æœ‰å¯æ‰§è¡Œçš„ä»»åŠ¡ä¹Ÿä¸ä¼šè¢«é”€æ¯ã€‚éšç€ä»»åŠ¡é‡çš„å¢åŠ ï¼Œåœ¨ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ä¹‹åï¼Œçº¿ç¨‹æ± ä¼šè¿›ä¸€æ­¥åˆ›å»ºæ–°çº¿ç¨‹ï¼Œæœ€å¤šå¯ä»¥è¾¾åˆ° maximumPoolSize æ¥åº”å¯¹ä»»åŠ¡å¤šçš„åœºæ™¯ï¼Œå¦‚æœæœªæ¥çº¿ç¨‹æœ‰ç©ºé—²ï¼Œå¤§äº corePoolSize çš„çº¿ç¨‹ä¼šè¢«åˆç†å›æ”¶ã€‚æ‰€ä»¥æ­£å¸¸æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ä¼šå¤„åœ¨ corePoolSize ä¸ maximumPoolSize çš„é—­åŒºé—´å†…ã€‚</p><h4 id="å°ç»“ï¼š"><a href="#å°ç»“ï¼š" class="headerlink" title="å°ç»“ï¼š"></a>å°ç»“ï¼š</h4><ul><li>çº¿ç¨‹æ± å¸Œæœ›ä¿æŒè¾ƒå°‘çš„çº¿ç¨‹æ•°ï¼Œå¹¶ä¸”åªæœ‰åœ¨è´Ÿè½½å˜å¾—å¾ˆå¤§æ—¶æ‰å¢åŠ çº¿ç¨‹ã€‚</li><li>çº¿ç¨‹æ± åªæœ‰åœ¨ä»»åŠ¡é˜Ÿåˆ—å¡«æ»¡æ—¶æ‰åˆ›å»ºå¤šäº corePoolSize çš„çº¿ç¨‹ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯æ— ç•Œé˜Ÿåˆ—ï¼ˆä¾‹å¦‚ LinkedBlockingQueueï¼‰ï¼Œé‚£ä¹ˆç”±äºé˜Ÿåˆ—ä¸ä¼šæ»¡ï¼Œæ‰€ä»¥çº¿ç¨‹æ•°ä¸ä¼šè¶…è¿‡ corePoolSizeã€‚</li><li>é€šè¿‡è®¾ç½® corePoolSize å’Œ maximumPoolSize ä¸ºç›¸åŒçš„å€¼ï¼Œå°±å¯ä»¥åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚</li><li>é€šè¿‡è®¾ç½® maximumPoolSize ä¸ºå¾ˆé«˜çš„å€¼ï¼Œä¾‹å¦‚ Integer.MAX_VALUEï¼Œå°±å¯ä»¥å…è®¸çº¿ç¨‹æ± åˆ›å»ºä»»æ„å¤šçš„çº¿ç¨‹ã€‚</li></ul><h4 id="3-9-2-keepAliveTime-æ—¶é—´å•ä½"><a href="#3-9-2-keepAliveTime-æ—¶é—´å•ä½" class="headerlink" title="3.9.2.keepAliveTime+æ—¶é—´å•ä½"></a>3.9.2.keepAliveTime+æ—¶é—´å•ä½</h4><p>â€”-åœ¨ç©ºé—²æœŸé”€æ¯è¿‡å¤š(è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°)çš„çº¿ç¨‹</p><p>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ keepAliveTime + æ—¶é—´å•ä½ï¼Œ<u>å½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡å¤šäºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œè€Œæ­¤æ—¶åˆæ²¡æœ‰ä»»åŠ¡å¯åšï¼Œçº¿ç¨‹æ± å°±ä¼šæ£€æµ‹çº¿ç¨‹çš„ keepAliveTimeï¼Œå¦‚æœè¶…è¿‡è§„å®šçš„æ—¶é—´ï¼Œæ— äº‹å¯åšçš„çº¿ç¨‹å°±ä¼šè¢«é”€æ¯ï¼Œä»¥ä¾¿å‡å°‘å†…å­˜çš„å ç”¨å’Œèµ„æºæ¶ˆè€—ã€‚</u>å¦‚æœåæœŸä»»åŠ¡åˆå¤šäº†èµ·æ¥ï¼Œçº¿ç¨‹æ± ä¹Ÿä¼šæ ¹æ®è§„åˆ™é‡æ–°åˆ›å»ºçº¿ç¨‹ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©çš„è¿‡ç¨‹ï¼Œæ¯”è¾ƒçµæ´»ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ setKeepAliveTime æ–¹æ³•åŠ¨æ€æ”¹å˜ keepAliveTime çš„å‚æ•°å€¼ã€‚</p><h4 id="3-9-3-ThreadFactory"><a href="#3-9-3-ThreadFactory" class="headerlink" title="3.9.3.ThreadFactory"></a>3.9.3.ThreadFactory</h4><p>ç¬¬å››ä¸ªå‚æ•°æ˜¯ ThreadFactoryï¼ŒThreadFactory å®é™…ä¸Šæ˜¯ä¸€ä¸ªçº¿ç¨‹å·¥å‚ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç”Ÿäº§çº¿ç¨‹ä»¥ä¾¿æ‰§è¡Œä»»åŠ¡ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨é»˜è®¤çš„çº¿ç¨‹å·¥å‚ï¼Œåˆ›å»ºçš„çº¿ç¨‹éƒ½ä¼šåœ¨åŒä¸€ä¸ªçº¿ç¨‹ç»„ï¼Œå¹¶æ‹¥æœ‰ä¸€æ ·çš„ä¼˜å…ˆçº§ï¼Œä¸”éƒ½ä¸æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©è‡ªå·±å®šåˆ¶çº¿ç¨‹å·¥å‚ï¼Œä»¥æ–¹ä¾¿ç»™çº¿ç¨‹è‡ªå®šä¹‰å‘½åï¼Œä¸åŒçš„çº¿ç¨‹æ± å†…çš„çº¿ç¨‹é€šå¸¸ä¼šæ ¹æ®å…·ä½“ä¸šåŠ¡æ¥å®šåˆ¶ä¸åŒçš„çº¿ç¨‹åã€‚</p><h4 id="3-9-4-workQueue-å’Œ-Handler"><a href="#3-9-4-workQueue-å’Œ-Handler" class="headerlink" title="3.9.4.workQueue å’Œ Handler"></a>3.9.4.workQueue å’Œ Handler</h4><p>æœ€åä¸¤ä¸ªå‚æ•°æ˜¯ workQueue å’Œ Handlerï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”é˜»å¡é˜Ÿåˆ—å’Œä»»åŠ¡æ‹’ç»ç­–ç•¥ï¼Œåœ¨åé¢çš„è¯¾æ—¶ä¼šå¯¹å®ƒä»¬è¿›è¡Œè¯¦ç»†å±•å¼€è®²è§£ã€‚</p><h3 id="3-10-çº¿ç¨‹æ± æœ‰å“ª-4-ç§æ‹’ç»ç­–ç•¥ï¼Ÿ"><a href="#3-10-çº¿ç¨‹æ± æœ‰å“ª-4-ç§æ‹’ç»ç­–ç•¥ï¼Ÿ" class="headerlink" title="3.10.çº¿ç¨‹æ± æœ‰å“ª 4 ç§æ‹’ç»ç­–ç•¥ï¼Ÿ"></a>3.10.çº¿ç¨‹æ± æœ‰å“ª 4 ç§æ‹’ç»ç­–ç•¥ï¼Ÿ</h3><h4 id="3-10-1-çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„æ—¶æœºï¼š"><a href="#3-10-1-çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„æ—¶æœºï¼š" class="headerlink" title="3.10.1.çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„æ—¶æœºï¼š"></a>3.10.1.çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„æ—¶æœºï¼š</h4><p>æ–°å»ºçº¿ç¨‹æ± æ—¶å¯ä»¥æŒ‡å®šå®ƒçš„ä»»åŠ¡æ‹’ç»ç­–ç•¥ï¼Œä»¥ä¾¿åœ¨å¿…è¦çš„æ—¶å€™æŒ‰ç…§æˆ‘ä»¬çš„ç­–ç•¥æ¥æ‹’ç»ä»»åŠ¡ï¼Œé‚£ä¹ˆæ‹’ç»ä»»åŠ¡çš„æ—¶æœºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿçº¿ç¨‹æ± ä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹ä¼š**<u>æ‹’ç»æ–°æäº¤çš„ä»»åŠ¡ã€‚</u>**</p><ul><li>ç¬¬ä¸€ç§æƒ…å†µæ˜¯å½“æˆ‘ä»¬<u>è°ƒç”¨ shutdown ç­‰æ–¹æ³•å…³é—­çº¿ç¨‹æ± å</u>ï¼Œå³ä¾¿æ­¤æ—¶å¯èƒ½çº¿ç¨‹æ± å†…éƒ¨ä¾ç„¶æœ‰æ²¡æ‰§è¡Œå®Œçš„ä»»åŠ¡æ­£åœ¨æ‰§è¡Œï¼Œä½†æ˜¯ç”±äºçº¿ç¨‹æ± å·²ç»å…³é—­ï¼Œæ­¤æ—¶å¦‚æœå†å‘çº¿ç¨‹æ± å†…æäº¤ä»»åŠ¡ï¼Œå°±ä¼šé­åˆ°æ‹’ç»ã€‚</li><li>ç¬¬äºŒç§æƒ…å†µæ˜¯çº¿ç¨‹æ± æ²¡æœ‰èƒ½åŠ›ç»§ç»­å¤„ç†æ–°æäº¤çš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯<u>å·¥ä½œå·²ç»éå¸¸é¥±å’Œçš„æ—¶å€™</u>ã€‚</li></ul><h4 id="3-10-2-çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„ç­–ç•¥ï¼š"><a href="#3-10-2-çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„ç­–ç•¥ï¼š" class="headerlink" title="3.10.2.çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„ç­–ç•¥ï¼š"></a>3.10.2.çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„ç­–ç•¥ï¼š</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230804154232936.png" alt="image-20230804154232936"></p><ul><li>ç¬¬ä¸€ç§æ‹’ç»ç­–ç•¥æ˜¯ AbortPolicyï¼Œè¿™ç§æ‹’ç»ç­–ç•¥åœ¨æ‹’ç»ä»»åŠ¡æ—¶ï¼Œä¼šç›´æ¥<u><strong>æŠ›å‡ºä¸€ä¸ªç±»å‹ä¸º RejectedExecutionException çš„ RuntimeExceptionï¼Œè®©ä½ æ„ŸçŸ¥åˆ°ä»»åŠ¡è¢«æ‹’ç»äº†ï¼Œäºæ˜¯ä½ ä¾¿å¯ä»¥æ ¹æ®ä¸šåŠ¡é€»è¾‘é€‰æ‹©é‡è¯•æˆ–è€…æ”¾å¼ƒæäº¤ç­‰ç­–ç•¥ã€‚</strong></u></li><li>ç¬¬äºŒç§æ‹’ç»ç­–ç•¥æ˜¯ DiscardPolicyï¼Œè¿™ç§æ‹’ç»ç­–ç•¥æ­£å¦‚å®ƒçš„åå­—æ‰€æè¿°çš„ä¸€æ ·ï¼Œ<u><strong>å½“æ–°ä»»åŠ¡è¢«æäº¤åç›´æ¥è¢«ä¸¢å¼ƒæ‰ï¼Œä¹Ÿä¸ä¼šç»™ä½ ä»»ä½•çš„é€šçŸ¥ï¼Œç›¸å¯¹è€Œè¨€å­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œå› ä¸ºæˆ‘ä»¬æäº¤çš„æ—¶å€™æ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªä»»åŠ¡ä¼šè¢«ä¸¢å¼ƒï¼Œå¯èƒ½é€ æˆæ•°æ®ä¸¢å¤±</strong></u>ã€‚</li><li>ç¬¬ä¸‰ç§æ‹’ç»ç­–ç•¥æ˜¯ DiscardOldestPolicyï¼Œå¦‚æœçº¿ç¨‹æ± æ²¡è¢«å…³é—­ä¸”æ²¡æœ‰èƒ½åŠ›æ‰§è¡Œï¼Œåˆ™ä¼š<u><strong>ä¸¢å¼ƒä»»åŠ¡é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹ï¼Œé€šå¸¸æ˜¯å­˜æ´»æ—¶é—´æœ€é•¿çš„ä»»åŠ¡</strong></u>ï¼Œè¿™ç§ç­–ç•¥ä¸ç¬¬äºŒç§ä¸åŒä¹‹å¤„åœ¨äºå®ƒä¸¢å¼ƒçš„ä¸æ˜¯æœ€æ–°æäº¤çš„ï¼Œè€Œæ˜¯é˜Ÿåˆ—ä¸­å­˜æ´»æ—¶é—´æœ€é•¿çš„ï¼Œè¿™æ ·å°±å¯ä»¥è…¾å‡ºç©ºé—´ç»™æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†åŒç†å®ƒä¹Ÿå­˜åœ¨ä¸€å®šçš„æ•°æ®ä¸¢å¤±é£é™©ã€‚</li><li>ç¬¬å››ç§æ‹’ç»ç­–ç•¥æ˜¯ CallerRunsPolicyï¼Œç›¸å¯¹è€Œè¨€å®ƒå°±æ¯”è¾ƒå®Œå–„äº†ï¼Œå½“æœ‰æ–°ä»»åŠ¡æäº¤åï¼Œå¦‚æœçº¿ç¨‹æ± æ²¡è¢«å…³é—­ä¸”æ²¡æœ‰èƒ½åŠ›æ‰§è¡Œï¼Œåˆ™<u><strong>æŠŠè¿™ä¸ªä»»åŠ¡äº¤äºæäº¤ä»»åŠ¡çš„çº¿ç¨‹æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è°æäº¤ä»»åŠ¡ï¼Œè°å°±è´Ÿè´£æ‰§è¡Œä»»åŠ¡</strong></u>ã€‚è¿™æ ·åšä¸»è¦æœ‰ä¸¤ç‚¹å¥½å¤„ã€‚<ul><li>ç¬¬ä¸€ç‚¹æ–°æäº¤çš„ä»»åŠ¡ä¸ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™æ ·ä¹Ÿå°±ä¸ä¼šé€ æˆä¸šåŠ¡æŸå¤±ã€‚</li><li>ç¬¬äºŒç‚¹å¥½å¤„æ˜¯ï¼Œç”±äºè°æäº¤ä»»åŠ¡è°å°±è¦è´Ÿè´£æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ ·æäº¤ä»»åŠ¡çš„çº¿ç¨‹å°±å¾—è´Ÿè´£æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ‰§è¡Œä»»åŠ¡åˆæ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œåœ¨è¿™æ®µæœŸé—´ï¼Œæäº¤ä»»åŠ¡çš„çº¿ç¨‹è¢«å ç”¨ï¼Œä¹Ÿå°±ä¸ä¼šå†æäº¤æ–°çš„ä»»åŠ¡ï¼Œå‡ç¼“äº†ä»»åŠ¡æäº¤çš„é€Ÿåº¦ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªè´Ÿåé¦ˆã€‚åœ¨æ­¤æœŸé—´ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¹Ÿå¯ä»¥å……åˆ†åˆ©ç”¨è¿™æ®µæ—¶é—´æ¥æ‰§è¡Œæ‰ä¸€éƒ¨åˆ†ä»»åŠ¡ï¼Œè…¾å‡ºä¸€å®šçš„ç©ºé—´ï¼Œç›¸å½“äºæ˜¯ç»™äº†çº¿ç¨‹æ± ä¸€å®šçš„ç¼“å†²æœŸã€‚</li></ul></li></ul><h3 id="3-11-æœ‰å“ª-6-ç§å¸¸è§çš„çº¿ç¨‹æ± ï¼Ÿä»€ä¹ˆæ˜¯-Java8-çš„-ForkJoinPoolï¼Ÿ"><a href="#3-11-æœ‰å“ª-6-ç§å¸¸è§çš„çº¿ç¨‹æ± ï¼Ÿä»€ä¹ˆæ˜¯-Java8-çš„-ForkJoinPoolï¼Ÿ" class="headerlink" title="3.11.æœ‰å“ª 6 ç§å¸¸è§çš„çº¿ç¨‹æ± ï¼Ÿä»€ä¹ˆæ˜¯ Java8 çš„ ForkJoinPoolï¼Ÿ"></a>3.11.æœ‰å“ª 6 ç§å¸¸è§çš„çº¿ç¨‹æ± ï¼Ÿä»€ä¹ˆæ˜¯ Java8 çš„ ForkJoinPoolï¼Ÿ</h3><h4 id="3-11-1-FixedThreadPool"><a href="#3-11-1-FixedThreadPool" class="headerlink" title="3.11.1.FixedThreadPool"></a>3.11.1.FixedThreadPool</h4><p>â€‹å®ƒçš„æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ç›¸åŒï¼</p><h4 id="3-11-2-CachedThreadPool"><a href="#3-11-2-CachedThreadPool" class="headerlink" title="3.11.2.CachedThreadPool"></a>3.11.2.CachedThreadPool</h4><p>â€‹å¯ä»¥ç§°ä½œå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå®ƒçš„ç‰¹ç‚¹åœ¨äº<u>çº¿ç¨‹æ•°æ˜¯å‡ ä¹å¯ä»¥æ— é™å¢åŠ çš„</u>ï¼ˆå®é™…æœ€å¤§å¯ä»¥è¾¾åˆ° Integer.MAX_VALUEï¼Œä¸º 2^31-1ï¼Œè¿™ä¸ªæ•°éå¸¸å¤§ï¼Œæ‰€ä»¥åŸºæœ¬ä¸å¯èƒ½è¾¾åˆ°ï¼‰ï¼Œ<u><strong>è€Œå½“çº¿ç¨‹é—²ç½®æ—¶è¿˜å¯ä»¥å¯¹çº¿ç¨‹è¿›è¡Œå›æ”¶ã€‚</strong></u>ä¹Ÿå°±æ˜¯è¯´è¯¥çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œå½“ç„¶å®ƒä¹Ÿæœ‰ä¸€ä¸ªç”¨äºå­˜å‚¨æäº¤ä»»åŠ¡çš„é˜Ÿåˆ—ï¼Œä½†è¿™ä¸ªé˜Ÿåˆ—æ˜¯ SynchronousQueueï¼Œé˜Ÿåˆ—çš„å®¹é‡ä¸º0ï¼Œå®é™…ä¸å­˜å‚¨ä»»ä½•ä»»åŠ¡ï¼Œå®ƒåªè´Ÿè´£å¯¹ä»»åŠ¡è¿›è¡Œä¸­è½¬å’Œä¼ é€’ï¼Œæ‰€ä»¥æ•ˆç‡æ¯”è¾ƒé«˜ã€‚</p><h4 id="3-11-3-ScheduledThreadPool"><a href="#3-11-3-ScheduledThreadPool" class="headerlink" title="3.11.3.ScheduledThreadPool"></a>3.11.3.ScheduledThreadPool</h4><p>â€‹å®ƒæ”¯æŒå®šæ—¶æˆ–å‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡ã€‚æ¯”å¦‚æ¯éš” 10 ç§’é’Ÿæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡</p><h4 id="3-11-4-SingleThreadExecutor"><a href="#3-11-4-SingleThreadExecutor" class="headerlink" title="3.11.4.SingleThreadExecutor"></a>3.11.4.SingleThreadExecutor</h4><p>â€‹å®ƒä¼šä½¿ç”¨å”¯ä¸€çš„çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼ŒåŸç†å’Œ FixedThreadPool æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è¿™é‡Œçº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œå¦‚æœçº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡çš„è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œçº¿ç¨‹æ± ä¹Ÿä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œåç»­çš„ä»»åŠ¡ã€‚è¿™ç§çº¿ç¨‹æ± ç”±äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥éå¸¸é€‚åˆç”¨äºæ‰€æœ‰ä»»åŠ¡éƒ½éœ€è¦æŒ‰è¢«æäº¤çš„é¡ºåºä¾æ¬¡æ‰§è¡Œçš„åœºæ™¯ï¼Œè€Œå‰å‡ ç§çº¿ç¨‹æ± ä¸ä¸€å®šèƒ½å¤Ÿä¿éšœä»»åŠ¡çš„æ‰§è¡Œé¡ºåºç­‰äºè¢«æäº¤çš„é¡ºåºï¼Œå› ä¸ºå®ƒä»¬æ˜¯å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œçš„ã€‚</p><h4 id="3-11-5-SingleThreadScheduledExecutor"><a href="#3-11-5-SingleThreadScheduledExecutor" class="headerlink" title="3.11.5.SingleThreadScheduledExecutor"></a>3.11.5.SingleThreadScheduledExecutor</h4><p>â€‹å®ƒåªæ˜¯å°† <u>ScheduledThreadPool</u> çš„æ ¸å¿ƒçº¿ç¨‹æ•°è®¾ç½®ä¸ºäº† 1ã€‚</p><h4 id="3-11-6-ForkJoinPool"><a href="#3-11-6-ForkJoinPool" class="headerlink" title="3.11.6.ForkJoinPool"></a>3.11.6.ForkJoinPool</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230804160403936.png" alt="image-20230804160403936" style="zoom: 33%;" /><p>ç”¨ä¸€å¼ å…¨æ™¯å›¾æ¥æè¿° ForkJoinPool çº¿ç¨‹æ± çš„å†…éƒ¨ç»“æ„ï¼Œä½ å¯ä»¥çœ‹åˆ° ForkJoinPool çº¿ç¨‹æ± å’Œå…¶ä»–çº¿ç¨‹æ± å¾ˆå¤šåœ°æ–¹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†é‡ç‚¹åŒºåˆ«åœ¨äºå®ƒæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„åŒç«¯é˜Ÿåˆ—æ¥å­˜å‚¨åˆ†è£‚å‡ºæ¥çš„å­ä»»åŠ¡ã€‚ForkJoinPool éå¸¸é€‚åˆç”¨äºé€’å½’çš„åœºæ™¯ï¼Œä¾‹å¦‚æ ‘çš„éå†ã€æœ€ä¼˜è·¯å¾„æœç´¢ç­‰åœºæ™¯ã€‚</p><h3 id="3-12-çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æœ‰å“ªäº›ï¼Ÿ"><a href="#3-12-çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="3.12.çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æœ‰å“ªäº›ï¼Ÿ"></a>3.12.çº¿ç¨‹æ± å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—æœ‰å“ªäº›ï¼Ÿ</h3><p>çº¿ç¨‹æ± çš„å†…éƒ¨ç»“æ„ä¸»è¦ç”±å››éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>ç¬¬ä¸€éƒ¨åˆ†æ˜¯<strong>çº¿ç¨‹æ± ç®¡ç†å™¨</strong>ï¼Œå®ƒä¸»è¦è´Ÿè´£ç®¡ç†çº¿ç¨‹æ± çš„åˆ›å»ºã€é”€æ¯ã€æ·»åŠ ä»»åŠ¡ç­‰ç®¡ç†æ“ä½œï¼Œå®ƒæ˜¯æ•´ä¸ªçº¿ç¨‹æ± çš„ç®¡å®¶ã€‚</li><li>ç¬¬äºŒéƒ¨åˆ†æ˜¯<strong>å·¥ä½œçº¿ç¨‹</strong>ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„çº¿ç¨‹ t0~t9ï¼Œè¿™äº›çº¿ç¨‹å‹¤å‹¤æ³æ³åœ°ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡å¹¶æ‰§è¡Œã€‚</li><li>ç¬¬ä¸‰éƒ¨åˆ†æ˜¯<strong>ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼Œä½œä¸ºä¸€ç§ç¼“å†²æœºåˆ¶ï¼Œçº¿ç¨‹æ± ä¼šæŠŠå½“ä¸‹æ²¡æœ‰å¤„ç†çš„ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç”±äºå¤šçº¿ç¨‹åŒæ—¶ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡æ˜¯å¹¶å‘åœºæ™¯ï¼Œæ­¤æ—¶å°±éœ€è¦ä»»åŠ¡é˜Ÿåˆ—æ»¡è¶³çº¿ç¨‹å®‰å…¨çš„è¦æ±‚ï¼Œæ‰€ä»¥çº¿ç¨‹æ± ä¸­ä»»åŠ¡é˜Ÿåˆ—é‡‡ç”¨ BlockingQueue æ¥ä¿éšœçº¿ç¨‹å®‰å…¨ã€‚</li><li>ç¬¬å››éƒ¨åˆ†æ˜¯<strong>ä»»åŠ¡</strong>ï¼Œä»»åŠ¡è¦æ±‚å®ç°ç»Ÿä¸€çš„æ¥å£ï¼Œä»¥ä¾¿å·¥ä½œçº¿ç¨‹å¯ä»¥å¤„ç†å’Œæ‰§è¡Œã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230804161223490.png" alt="image-20230804161223490"></p><h4 id="3-12-1-LinkedBlockingQueue"><a href="#3-12-1-LinkedBlockingQueue" class="headerlink" title="3.12.1.LinkedBlockingQueue"></a>3.12.1.LinkedBlockingQueue</h4><p>â€“å¯¹åº”çš„çº¿ç¨‹æ± å¤§å°å›ºå®šï¼Œéœ€è¦æ— é™çš„é˜Ÿåˆ—</p><p>å¯¹äº FixedThreadPool å’Œ SingleThreadExector è€Œè¨€ï¼Œå®ƒä»¬ä½¿ç”¨çš„é˜»å¡é˜Ÿåˆ—æ˜¯å®¹é‡ä¸º Integer.MAX_VALUE çš„ LinkedBlockingQueueï¼Œå¯ä»¥è®¤ä¸ºæ˜¯<u>æ— ç•Œé˜Ÿåˆ—</u>ã€‚ç”±äº FixedThreadPool çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•å¢åŠ ç‰¹åˆ«å¤šçš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œè¿™æ—¶å°±éœ€è¦ <u><strong>LinkedBlockingQueue è¿™æ ·ä¸€ä¸ªæ²¡æœ‰å®¹é‡é™åˆ¶çš„é˜»å¡é˜Ÿåˆ—æ¥å­˜æ”¾ä»»åŠ¡</strong></u>ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œç”±äºçº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—æ°¸è¿œä¸ä¼šæ”¾æ»¡ï¼Œæ‰€ä»¥çº¿ç¨‹æ± åªä¼šåˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹ï¼Œæ‰€ä»¥æ­¤æ—¶çš„æœ€å¤§çº¿ç¨‹æ•°å¯¹çº¿ç¨‹æ± æ¥è¯´æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºå¹¶ä¸ä¼šè§¦å‘ç”Ÿæˆå¤šäºæ ¸å¿ƒçº¿ç¨‹æ•°çš„çº¿ç¨‹ã€‚</p><h4 id="3-12-2-SynchronousQueue"><a href="#3-12-2-SynchronousQueue" class="headerlink" title="3.12.2.SynchronousQueue"></a>3.12.2.SynchronousQueue</h4><p>â€“å¯¹åº”çš„çº¿ç¨‹æ± å¤§å°æ— é™ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦èƒ½å­˜æ”¾ä»»åŠ¡çš„é˜Ÿåˆ—(<strong>SynchronousQueue æœ¬èº«å¹¶ä¸å­˜å‚¨ä»»åŠ¡ï¼Œè€Œæ˜¯å¯¹ä»»åŠ¡ç›´æ¥è¿›è¡Œè½¬å‘</strong>)</p><p>ç¬¬äºŒç§é˜»å¡é˜Ÿåˆ—æ˜¯ SynchronousQueueï¼Œå¯¹åº”çš„çº¿ç¨‹æ± æ˜¯ CachedThreadPoolã€‚çº¿ç¨‹æ±  CachedThreadPool çš„æœ€å¤§çº¿ç¨‹æ•°æ˜¯ Integer çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ç†è§£ä¸ºçº¿ç¨‹æ•°æ˜¯å¯ä»¥æ— é™æ‰©å±•çš„ã€‚CachedThreadPool å’Œä¸Šä¸€ç§çº¿ç¨‹æ±  FixedThreadPool çš„æƒ…å†µæ°æ°ç›¸åï¼Œ<strong>FixedThreadPool çš„æƒ…å†µæ˜¯é˜»å¡é˜Ÿåˆ—çš„å®¹é‡æ˜¯æ— é™çš„</strong>ï¼Œ<u><strong>è€Œè¿™é‡Œ CachedThreadPool æ˜¯çº¿ç¨‹æ•°å¯ä»¥æ— é™æ‰©å±•</strong></u>ï¼Œæ‰€ä»¥ CachedThreadPool çº¿ç¨‹æ± å¹¶ä¸éœ€è¦ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—æ¥å­˜å‚¨ä»»åŠ¡ï¼Œå› ä¸ºä¸€æ—¦æœ‰ä»»åŠ¡è¢«æäº¤å°±ç›´æ¥è½¬å‘ç»™çº¿ç¨‹æˆ–è€…åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œï¼Œè€Œä¸éœ€è¦å¦å¤–ä¿å­˜å®ƒä»¬ã€‚</p><p>æˆ‘ä»¬è‡ªå·±åˆ›å»ºä½¿ç”¨ SynchronousQueue çš„çº¿ç¨‹æ± æ—¶ï¼Œå¦‚æœä¸å¸Œæœ›ä»»åŠ¡è¢«æ‹’ç»ï¼Œé‚£ä¹ˆå°±éœ€è¦æ³¨æ„è®¾ç½®æœ€å¤§çº¿ç¨‹æ•°è¦å°½å¯èƒ½å¤§ä¸€äº›ï¼Œä»¥å…å‘ç”Ÿä»»åŠ¡æ•°å¤§äºæœ€å¤§çº¿ç¨‹æ•°æ—¶ï¼Œæ²¡åŠæ³•æŠŠä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—ä¸­ä¹Ÿæ²¡æœ‰è¶³å¤Ÿçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡çš„æƒ…å†µã€‚</p><h4 id="3-12-3-DelayedWorkQueue"><a href="#3-12-3-DelayedWorkQueue" class="headerlink" title="3.12.3.DelayedWorkQueue"></a>3.12.3.DelayedWorkQueue</h4><p>ç¬¬ä¸‰ç§é˜»å¡é˜Ÿåˆ—æ˜¯DelayedWorkQueueï¼Œå®ƒå¯¹åº”çš„çº¿ç¨‹æ± åˆ†åˆ«æ˜¯ ScheduledThreadPool å’Œ SingleThreadScheduledExecutorï¼Œè¿™ä¸¤ç§<u>çº¿ç¨‹æ± çš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯å¯ä»¥å»¶è¿Ÿæ‰§è¡Œä»»åŠ¡</u>ï¼Œæ¯”å¦‚è¯´ä¸€å®šæ—¶é—´åæ‰§è¡Œä»»åŠ¡æˆ–æ˜¯æ¯éš”ä¸€å®šçš„æ—¶é—´æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ã€‚<u><strong>DelayedWorkQueue çš„ç‰¹ç‚¹æ˜¯å†…éƒ¨å…ƒç´ å¹¶ä¸æ˜¯æŒ‰ç…§æ”¾å…¥çš„æ—¶é—´æ’åºï¼Œè€Œæ˜¯ä¼šæŒ‰ç…§å»¶è¿Ÿçš„æ—¶é—´é•¿çŸ­å¯¹ä»»åŠ¡è¿›è¡Œæ’åºï¼Œå†…éƒ¨é‡‡ç”¨çš„æ˜¯â€œå †â€çš„æ•°æ®ç»“æ„ã€‚</strong></u>ä¹‹æ‰€ä»¥çº¿ç¨‹æ±  ScheduledThreadPool å’Œ SingleThreadScheduledExecutor é€‰æ‹© DelayedWorkQueueï¼Œæ˜¯å› ä¸ºå®ƒä»¬æœ¬èº«æ­£æ˜¯åŸºäºæ—¶é—´æ‰§è¡Œä»»åŠ¡çš„ï¼Œ<u>è€Œå»¶è¿Ÿé˜Ÿåˆ—æ­£å¥½å¯ä»¥æŠŠä»»åŠ¡æŒ‰æ—¶é—´è¿›è¡Œæ’åºï¼Œæ–¹ä¾¿ä»»åŠ¡çš„æ‰§è¡Œã€‚</u></p><h3 id="3-13-ä¸ºä»€ä¹ˆä¸åº”è¯¥è‡ªåŠ¨åˆ›å»ºçº¿ç¨‹æ± ï¼Ÿ"><a href="#3-13-ä¸ºä»€ä¹ˆä¸åº”è¯¥è‡ªåŠ¨åˆ›å»ºçº¿ç¨‹æ± ï¼Ÿ" class="headerlink" title="3.13.ä¸ºä»€ä¹ˆä¸åº”è¯¥è‡ªåŠ¨åˆ›å»ºçº¿ç¨‹æ± ï¼Ÿ"></a>3.13.ä¸ºä»€ä¹ˆä¸åº”è¯¥è‡ªåŠ¨åˆ›å»ºçº¿ç¨‹æ± ï¼Ÿ</h3><p>å› ä¸ºä¸Šè¿°çš„çº¿ç¨‹æ± ä¸­ï¼Œ<u>è¦ä¹ˆçº¿ç¨‹æ²¡æœ‰çº¦æŸï¼Œå¯ä»¥æ— é™å¤šï¼›è¦ä¹ˆé˜Ÿåˆ—æ²¡æœ‰çº¦æŸï¼Œå¯ä»¥æ— é™å¤§ï¼›</u></p><p>å½“é¢å¯¹éš¾äºå¤„ç†çš„å¤§é‡ä»»åŠ¡æ—¶ï¼š</p><ul><li><p>è¦ä¹ˆ<u>çº¿ç¨‹åˆ›å»ºå¾—å¤ªå¤š</u>ï¼Œå¯¼è‡´æœ€ç»ˆè¶…è¿‡äº†æ“ä½œç³»ç»Ÿçš„ä¸Šé™è€Œæ— æ³•åˆ›å»ºæ–°çº¿ç¨‹ï¼Œæˆ–è€…å¯¼è‡´å†…å­˜ä¸è¶³ã€‚</p></li><li><p>è¦ä¹ˆ<u>é˜Ÿåˆ—ä¸­å †ç§¯çš„ä»»åŠ¡å¤ªå¤š</u>ï¼Œæœ€ç»ˆå¤§é‡å †ç§¯çš„ä»»åŠ¡ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œå¹¶å‘ç”Ÿ OOM ï¼Œä¹Ÿå°±æ˜¯OutOfMemoryErrorï¼Œè¿™å‡ ä¹ä¼šå½±å“åˆ°æ•´ä¸ªç¨‹åºï¼Œä¼šé€ æˆå¾ˆä¸¥é‡çš„åæœã€‚</p></li></ul><h3 id="3-14åˆé€‚çš„çº¿ç¨‹æ•°é‡æ˜¯å¤šå°‘ï¼ŸCPU-æ ¸å¿ƒæ•°å’Œçº¿ç¨‹æ•°çš„å…³ç³»ï¼Ÿ"><a href="#3-14åˆé€‚çš„çº¿ç¨‹æ•°é‡æ˜¯å¤šå°‘ï¼ŸCPU-æ ¸å¿ƒæ•°å’Œçº¿ç¨‹æ•°çš„å…³ç³»ï¼Ÿ" class="headerlink" title="3.14åˆé€‚çš„çº¿ç¨‹æ•°é‡æ˜¯å¤šå°‘ï¼ŸCPU æ ¸å¿ƒæ•°å’Œçº¿ç¨‹æ•°çš„å…³ç³»ï¼Ÿ"></a>3.14åˆé€‚çš„çº¿ç¨‹æ•°é‡æ˜¯å¤šå°‘ï¼ŸCPU æ ¸å¿ƒæ•°å’Œçº¿ç¨‹æ•°çš„å…³ç³»ï¼Ÿ</h3><p>æˆ‘ä»¬è°ƒæ•´çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡çš„æœ€ä¸»è¦çš„ç›®çš„æ˜¯ä¸ºäº†<u>å……åˆ†å¹¶åˆç†åœ°ä½¿ç”¨ CPU å’Œå†…å­˜ç­‰èµ„æº</u>ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°æé«˜ç¨‹åºçš„æ€§èƒ½</p><h4 id="CPU-å¯†é›†å‹ä»»åŠ¡"><a href="#CPU-å¯†é›†å‹ä»»åŠ¡" class="headerlink" title="CPU å¯†é›†å‹ä»»åŠ¡"></a>CPU å¯†é›†å‹ä»»åŠ¡</h4><p><em><u>â€”ä¸èƒ½æ¥å¤ªå¤šï¼Œå› ä¸ºè¿™äº›ä»»åŠ¡ä¸€æ—¦æ‰§è¡Œï¼Œé‚£ä¹ˆä¼šä¸€ç›´ä½¿ç”¨CPUï¼Œä»»åŠ¡å¤šäº†çš„è¯CPUå¾ˆå¿«å°±ä¸å¤Ÿç”¨äº†ã€‚</u></em></p><p>â€‹é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ CPU å¯†é›†å‹ä»»åŠ¡ï¼Œæ¯”å¦‚åŠ å¯†ã€è§£å¯†ã€å‹ç¼©ã€è®¡ç®—ç­‰ä¸€ç³»åˆ—éœ€è¦å¤§é‡è€—è´¹ CPU èµ„æºçš„ä»»åŠ¡ã€‚</p><p>â€‹å¯¹äºè¿™æ ·çš„ä»»åŠ¡<u>æœ€ä½³çš„çº¿ç¨‹æ•°ä¸º CPU æ ¸å¿ƒæ•°çš„ 1~2 å€</u>ï¼Œå¦‚æœè®¾ç½®è¿‡å¤šçš„çº¿ç¨‹æ•°ï¼Œå®é™…ä¸Šå¹¶ä¸ä¼šèµ·åˆ°å¾ˆå¥½çš„æ•ˆæœã€‚æ­¤æ—¶å‡è®¾æˆ‘ä»¬è®¾ç½®çš„çº¿ç¨‹æ•°é‡æ˜¯ CPU æ ¸å¿ƒæ•°çš„ 2 å€ä»¥ä¸Šï¼Œå› **<u>ä¸ºè®¡ç®—ä»»åŠ¡éå¸¸é‡ï¼Œä¼šå ç”¨å¤§é‡çš„ CPU èµ„æºï¼Œæ‰€ä»¥è¿™æ—¶ CPU çš„æ¯ä¸ªæ ¸å¿ƒå·¥ä½œåŸºæœ¬éƒ½æ˜¯æ»¡è´Ÿè·çš„ï¼Œè€Œæˆ‘ä»¬åˆè®¾ç½®äº†è¿‡å¤šçš„çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æƒ³å»åˆ©ç”¨ CPU èµ„æºæ¥æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡ï¼Œè¿™å°±ä¼šé€ æˆä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ­¤æ—¶çº¿ç¨‹æ•°çš„å¢å¤šå¹¶æ²¡æœ‰è®©æ€§èƒ½æå‡ï¼Œåè€Œç”±äºçº¿ç¨‹æ•°é‡è¿‡å¤šä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</u>**</p><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æœ€å¥½è¿˜è¦åŒæ—¶è€ƒè™‘åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿˜æœ‰å“ªäº›å…¶ä»–ä¼šå ç”¨è¿‡å¤š CPU èµ„æºçš„ç¨‹åºåœ¨è¿è¡Œï¼Œç„¶åå¯¹èµ„æºä½¿ç”¨åšæ•´ä½“çš„å¹³è¡¡ã€‚</p><h4 id="è€—æ—¶-IO-å‹ä»»åŠ¡"><a href="#è€—æ—¶-IO-å‹ä»»åŠ¡" class="headerlink" title="è€—æ—¶ IO å‹ä»»åŠ¡"></a>è€—æ—¶ IO å‹ä»»åŠ¡</h4><p><em><u>â€”å¯ä»¥å¤šæ¥ç‚¹ï¼Œå› ä¸ºè¿™äº›ä»»åŠ¡ä¸ä¼šä¸€ç›´å ç”¨CPUï¼Œå¤šæ¥ç‚¹æ‰èƒ½æœ€å¤§é™åº¦ä½¿ç”¨cpu</u></em></p><p>ç¬¬äºŒç§ä»»åŠ¡æ˜¯è€—æ—¶ IO å‹ï¼Œæ¯”å¦‚<u>æ•°æ®åº“ã€æ–‡ä»¶çš„è¯»å†™ï¼Œç½‘ç»œé€šä¿¡ç­‰ä»»åŠ¡</u>ï¼Œè¿™ç§ä»»åŠ¡çš„ç‰¹ç‚¹æ˜¯<u>å¹¶ä¸ä¼šç‰¹åˆ«æ¶ˆè€— CPU èµ„æºï¼Œä½†æ˜¯ IO æ“ä½œå¾ˆè€—æ—¶ï¼Œæ€»ä½“ä¼šå ç”¨æ¯”è¾ƒå¤šçš„æ—¶é—´ã€‚</u><strong><u>å¯¹äºè¿™ç§ä»»åŠ¡æœ€å¤§çº¿ç¨‹æ•°ä¸€èˆ¬ä¼šå¤§äº CPU æ ¸å¿ƒæ•°å¾ˆå¤šå€ï¼Œå› ä¸º IO è¯»å†™é€Ÿåº¦ç›¸æ¯”äº CPU çš„é€Ÿåº¦è€Œè¨€æ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®è¿‡å°‘çš„çº¿ç¨‹æ•°ï¼Œå°±å¯èƒ½å¯¼è‡´ CPU èµ„æºçš„æµªè´¹ã€‚è€Œå¦‚æœæˆ‘ä»¬è®¾ç½®æ›´å¤šçš„çº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆå½“ä¸€éƒ¨åˆ†çº¿ç¨‹æ­£åœ¨ç­‰å¾… IO çš„æ—¶å€™ï¼Œå®ƒä»¬æ­¤æ—¶å¹¶ä¸éœ€è¦ CPU æ¥è®¡ç®—ï¼Œé‚£ä¹ˆå¦å¤–çš„çº¿ç¨‹ä¾¿å¯ä»¥åˆ©ç”¨ CPU å»æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡ï¼Œäº’ä¸å½±å“ï¼Œè¿™æ ·çš„è¯åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…çš„ä»»åŠ¡å°±ä¼šå‡å°‘ï¼Œå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨èµ„æºã€‚</u></strong></p><h3 id="3-15-å¦‚ä½•æ ¹æ®å®é™…éœ€è¦ï¼Œå®šåˆ¶è‡ªå·±çš„çº¿ç¨‹æ± ï¼Ÿ"><a href="#3-15-å¦‚ä½•æ ¹æ®å®é™…éœ€è¦ï¼Œå®šåˆ¶è‡ªå·±çš„çº¿ç¨‹æ± ï¼Ÿ" class="headerlink" title="3.15.å¦‚ä½•æ ¹æ®å®é™…éœ€è¦ï¼Œå®šåˆ¶è‡ªå·±çš„çº¿ç¨‹æ± ï¼Ÿ"></a>3.15.å¦‚ä½•æ ¹æ®å®é™…éœ€è¦ï¼Œå®šåˆ¶è‡ªå·±çš„çº¿ç¨‹æ± ï¼Ÿ</h3><h4 id="æ ¸å¿ƒçº¿ç¨‹æ•°"><a href="#æ ¸å¿ƒçº¿ç¨‹æ•°" class="headerlink" title="æ ¸å¿ƒçº¿ç¨‹æ•°:"></a>æ ¸å¿ƒçº¿ç¨‹æ•°:</h4><p>â€‹çº¿ç¨‹çš„å¹³å‡å·¥ä½œæ—¶é—´æ‰€å æ¯”ä¾‹è¶Šé«˜ï¼Œå°±éœ€è¦è¶Šå°‘çš„çº¿ç¨‹ï¼›çº¿ç¨‹çš„å¹³å‡ç­‰å¾…æ—¶é—´æ‰€å æ¯”ä¾‹è¶Šé«˜ï¼Œå°±éœ€è¦è¶Šå¤šçš„çº¿ç¨‹ã€‚</p><h4 id="æœ€å¤§çº¿ç¨‹æ•°ï¼š"><a href="#æœ€å¤§çº¿ç¨‹æ•°ï¼š" class="headerlink" title="æœ€å¤§çº¿ç¨‹æ•°ï¼š"></a>æœ€å¤§çº¿ç¨‹æ•°ï¼š</h4><p>â€‹å¯¹äºæœ€å¤§çº¿ç¨‹æ•°è€Œè¨€ï¼Œå¦‚æœæˆ‘ä»¬æ‰§è¡Œçš„ä»»åŠ¡ç±»å‹ä¸æ˜¯å›ºå®šçš„ï¼Œæ¯”å¦‚å¯èƒ½ä¸€æ®µæ—¶é—´æ˜¯ CPU å¯†é›†å‹ï¼Œå¦ä¸€æ®µæ—¶é—´æ˜¯ IO å¯†é›†å‹ï¼Œæˆ–æ˜¯åŒæ—¶æœ‰ä¸¤ç§ä»»åŠ¡ç›¸äº’æ··æ­ã€‚é‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<u><strong>æˆ‘ä»¬å¯ä»¥æŠŠæœ€å¤§çº¿ç¨‹æ•°è®¾ç½®æˆæ ¸å¿ƒçº¿ç¨‹æ•°çš„å‡ å€ï¼Œä»¥ä¾¿åº”å¯¹ä»»åŠ¡çªå‘æƒ…å†µã€‚</strong></u></p><p>â€‹æ›´å¥½çš„åŠæ³•æ˜¯<u><strong>ç”¨ä¸åŒçš„çº¿ç¨‹æ± æ‰§è¡Œä¸åŒç±»å‹çš„ä»»åŠ¡ï¼Œè®©ä»»åŠ¡æŒ‰ç…§ç±»å‹åŒºåˆ†å¼€ï¼Œè€Œä¸æ˜¯æ··æ‚åœ¨ä¸€èµ·ï¼Œ</strong></u>è¿™æ ·å°±å¯ä»¥æŒ‰ç…§ä¸Šä¸€è¯¾æ—¶ä¼°ç®—çš„çº¿ç¨‹æ•°æˆ–ç»è¿‡å‹æµ‹å¾—åˆ°çš„ç»“æœæ¥è®¾ç½®åˆç†çš„çº¿ç¨‹æ•°äº†ï¼Œè¾¾åˆ°æ›´å¥½çš„æ€§èƒ½ã€‚</p><h4 id="é˜»å¡é˜Ÿåˆ—ï¼š"><a href="#é˜»å¡é˜Ÿåˆ—ï¼š" class="headerlink" title="é˜»å¡é˜Ÿåˆ—ï¼š"></a>é˜»å¡é˜Ÿåˆ—ï¼š</h4><p>â€‹æœ‰ä¸€ç§å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—å« ArrayBlockingQueueï¼Œå®ƒä¹Ÿç»å¸¸è¢«ç”¨äºçº¿ç¨‹æ± ä¸­ï¼Œè¿™ç§é˜»å¡é˜Ÿåˆ—å†…éƒ¨æ˜¯ç”¨æ•°ç»„å®ç°çš„ï¼Œåœ¨æ–°å»ºå¯¹è±¡çš„æ—¶å€™è¦æ±‚ä¼ å…¥å®¹é‡å€¼ï¼Œä¸”åæœŸä¸èƒ½æ‰©å®¹ï¼Œæ‰€ä»¥ ArrayBlockingQueue çš„æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å®¹é‡æ˜¯æœ‰é™çš„ã€‚</p><p>â€‹<u>è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœä»»åŠ¡é˜Ÿåˆ—æ”¾æ»¡äº†ä»»åŠ¡ï¼Œè€Œä¸”çº¿ç¨‹æ•°ä¹Ÿå·²ç»è¾¾åˆ°äº†æœ€å¤§å€¼ï¼Œçº¿ç¨‹æ± æ ¹æ®è§„åˆ™å°±ä¼šæ‹’ç»æ–°æäº¤çš„ä»»åŠ¡ï¼Œè¿™æ ·ä¸€æ¥å°±å¯èƒ½ä¼šäº§ç”Ÿä¸€å®šçš„æ•°æ®ä¸¢å¤±ã€‚ä½†ç›¸æ¯”äºæ— é™å¢åŠ ä»»åŠ¡æˆ–è€…çº¿ç¨‹æ•°å¯¼è‡´å†…å­˜ä¸è¶³ï¼Œè¿›è€Œå¯¼è‡´ç¨‹åºå´©æºƒï¼Œæ•°æ®ä¸¢å¤±è¿˜æ˜¯è¦æ›´å¥½ä¸€äº›çš„ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº† ArrayBlockingQueue è¿™ç§é˜»å¡é˜Ÿåˆ—ï¼Œå†åŠ ä¸Šæˆ‘ä»¬é™åˆ¶äº†æœ€å¤§çº¿ç¨‹æ•°é‡ï¼Œå°±å¯ä»¥éå¸¸æœ‰æ•ˆåœ°é˜²æ­¢èµ„æºè€—å°½çš„æƒ…å†µå‘ç”Ÿã€‚</u>æ­¤æ—¶çš„é˜Ÿåˆ—å®¹é‡å¤§å°å’Œ maxPoolSize æ˜¯ä¸€ä¸ª trade-offï¼Œå¦‚æœ<u><strong>æˆ‘ä»¬ä½¿ç”¨å®¹é‡æ›´å¤§çš„é˜Ÿåˆ—å’Œæ›´å°çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œå°±å¯ä»¥å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„å¼€é”€ï¼Œä½†ä¹Ÿå¯èƒ½å› æ­¤é™ä½æ•´ä½“çš„ååé‡ï¼›å¦‚æœæˆ‘ä»¬çš„ä»»åŠ¡æ˜¯ IO å¯†é›†å‹ï¼Œåˆ™å¯ä»¥é€‰æ‹©ç¨å°å®¹é‡çš„é˜Ÿåˆ—å’Œæ›´å¤§çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œè¿™æ ·æ•´ä½“çš„æ•ˆç‡å°±ä¼šæ›´é«˜ï¼Œä¸è¿‡ä¹Ÿä¼šå¸¦æ¥æ›´å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</strong></u></p><h4 id="çº¿ç¨‹å·¥å‚ï¼š"><a href="#çº¿ç¨‹å·¥å‚ï¼š" class="headerlink" title="çº¿ç¨‹å·¥å‚ï¼š"></a>çº¿ç¨‹å·¥å‚ï¼š</h4><p>â€‹å¯¹äºçº¿ç¨‹å·¥å‚ threadFactory è¿™ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é»˜è®¤çš„ defaultThreadFactoryï¼Œä¹Ÿå¯ä»¥ä¼ å…¥è‡ªå®šä¹‰çš„æœ‰é¢å¤–èƒ½åŠ›çš„çº¿ç¨‹å·¥å‚ï¼Œå› ä¸º<u>æˆ‘ä»¬å¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹æ± ï¼Œè€Œä¸åŒçš„çº¿ç¨‹æ± ä¹‹é—´æœ‰å¿…è¦é€šè¿‡ä¸åŒçš„åå­—æ¥è¿›è¡ŒåŒºåˆ†ï¼Œæ‰€ä»¥å¯ä»¥ä¼ å…¥èƒ½æ ¹æ®ä¸šåŠ¡ä¿¡æ¯è¿›è¡Œå‘½åçš„çº¿ç¨‹å·¥å‚ï¼Œä»¥ä¾¿åç»­<strong>å¯ä»¥æ ¹æ®çº¿ç¨‹ååŒºåˆ†ä¸åŒçš„ä¸šåŠ¡è¿›è€Œå¿«é€Ÿå®šä½é—®é¢˜ä»£ç </strong>ã€‚</u></p><h4 id="æ‹’ç»ç­–ç•¥ï¼š-1"><a href="#æ‹’ç»ç­–ç•¥ï¼š-1" class="headerlink" title="æ‹’ç»ç­–ç•¥ï¼š"></a>æ‹’ç»ç­–ç•¥ï¼š</h4><p>é™¤äº†ä¹‹å‰è¯´çš„ï¼šè¿”å›å¼‚å¸¸ã€ç›´æ¥ä¸¢å¼ƒã€ä¸¢å¼ƒæœ€æ—©çš„èŠ‚ç‚¹ã€è°æäº¤ä»»åŠ¡è°æ‰§è¡Œ</p><p>è¿˜å¯ä»¥è¿˜å¯ä»¥é€šè¿‡<u><strong>å®ç° RejectedExecutionHandler æ¥å£æ¥å®ç°è‡ªå·±çš„æ‹’ç»ç­–ç•¥</strong></u>ï¼Œåœ¨æ¥å£ä¸­æˆ‘ä»¬éœ€è¦å®ç° rejectedExecution æ–¹æ³•ï¼Œåœ¨ rejectedExecution æ–¹æ³•ä¸­ï¼Œæ‰§è¡Œä¾‹å¦‚æ‰“å°æ—¥å¿—ã€æš‚å­˜ä»»åŠ¡ã€é‡æ–°æ‰§è¡Œç­‰è‡ªå®šä¹‰çš„æ‹’ç»ç­–ç•¥ï¼Œä»¥ä¾¿æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚</p><h3 id="3-16-å¦‚ä½•æ­£ç¡®åœ°å…³é—­çº¿ç¨‹æ± ï¼Ÿshutdown-å’Œ-shutdownNow-çš„åŒºåˆ«ï¼Ÿ"><a href="#3-16-å¦‚ä½•æ­£ç¡®åœ°å…³é—­çº¿ç¨‹æ± ï¼Ÿshutdown-å’Œ-shutdownNow-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="3.16.å¦‚ä½•æ­£ç¡®åœ°å…³é—­çº¿ç¨‹æ± ï¼Ÿshutdown å’Œ shutdownNow çš„åŒºåˆ«ï¼Ÿ"></a>3.16.å¦‚ä½•æ­£ç¡®åœ°å…³é—­çº¿ç¨‹æ± ï¼Ÿshutdown å’Œ shutdownNow çš„åŒºåˆ«ï¼Ÿ</h3><h4 id="3-16-1-shutdown"><a href="#3-16-1-shutdown" class="headerlink" title="3.16.1.shutdown()"></a>3.16.1.shutdown()</h4><p>ç¬¬ä¸€ç§æ–¹æ³•å«ä½œ shutdown()ï¼Œå®ƒå¯ä»¥<u>å®‰å…¨åœ°å…³é—­ä¸€ä¸ªçº¿ç¨‹æ± </u>ï¼Œè°ƒç”¨ shutdown() æ–¹æ³•ä¹‹åçº¿ç¨‹æ± å¹¶ä¸æ˜¯ç«‹åˆ»å°±è¢«å…³é—­ï¼Œå› ä¸ºè¿™æ—¶çº¿ç¨‹æ± ä¸­å¯èƒ½è¿˜æœ‰å¾ˆå¤šä»»åŠ¡æ­£åœ¨è¢«æ‰§è¡Œï¼Œæˆ–æ˜¯ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰å¤§é‡æ­£åœ¨ç­‰å¾…è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè°ƒç”¨ shutdown() æ–¹æ³•åçº¿ç¨‹æ± ä¼šåœ¨æ‰§è¡Œå®Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å’Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„ä»»åŠ¡åæ‰å½»åº•å…³é—­ã€‚ä½†è¿™å¹¶ä¸ä»£è¡¨ shutdown() æ“ä½œæ˜¯æ²¡æœ‰ä»»ä½•æ•ˆæœçš„ï¼Œè°ƒç”¨ shutdown() æ–¹æ³•åå¦‚æœè¿˜æœ‰æ–°çš„ä»»åŠ¡è¢«æäº¤ï¼Œçº¿ç¨‹æ± åˆ™ä¼šæ ¹æ®æ‹’ç»ç­–ç•¥ç›´æ¥æ‹’ç»åç»­æ–°æäº¤çš„ä»»åŠ¡ã€‚</p><h4 id="3-16-2-isShutdown"><a href="#3-16-2-isShutdown" class="headerlink" title="3.16.2.isShutdown()"></a>3.16.2.isShutdown()</h4><p>ç¬¬äºŒä¸ªæ–¹æ³•å«ä½œ isShutdown()ï¼Œå®ƒå¯ä»¥è¿”å› true æˆ–è€… false æ¥åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦å·²ç»å¼€å§‹äº†å…³é—­å·¥ä½œï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦æ‰§è¡Œäº† shutdown æˆ–è€… shutdownNow æ–¹æ³•ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œ<u><strong>å¦‚æœè°ƒç”¨ isShutdown() æ–¹æ³•çš„è¿”å›çš„ç»“æœä¸º true å¹¶ä¸ä»£è¡¨çº¿ç¨‹æ± æ­¤æ—¶å·²ç»å½»åº•å…³é—­äº†ï¼Œè¿™ä»…ä»…ä»£è¡¨çº¿ç¨‹æ± å¼€å§‹äº†å…³é—­çš„æµç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤æ—¶å¯èƒ½çº¿ç¨‹æ± ä¸­ä¾ç„¶æœ‰çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œé˜Ÿåˆ—é‡Œä¹Ÿå¯èƒ½æœ‰ç­‰å¾…è¢«æ‰§è¡Œçš„ä»»åŠ¡ã€‚</strong></u></p><h4 id="3-16-3-isTerminated"><a href="#3-16-3-isTerminated" class="headerlink" title="3.16.3.isTerminated()"></a>3.16.3.isTerminated()</h4><p>ç¬¬ä¸‰ç§æ–¹æ³•å«ä½œ isTerminated()ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥æ£€æµ‹çº¿ç¨‹æ± æ˜¯å¦çœŸæ­£â€œç»ˆç»“â€äº†ï¼Œè¿™ä¸ä»…ä»£è¡¨çº¿ç¨‹æ± å·²å…³é—­ï¼ŒåŒæ—¶ä»£è¡¨çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰ä»»åŠ¡éƒ½å·²ç»éƒ½æ‰§è¡Œå®Œæ¯•äº†ï¼Œå› ä¸ºæˆ‘ä»¬åˆšæ‰è¯´è¿‡ï¼Œè°ƒç”¨ shutdown æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹æ± ä¼šç»§ç»­æ‰§è¡Œé‡Œé¢æœªå®Œæˆçš„ä»»åŠ¡ï¼Œä¸ä»…åŒ…æ‹¬çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿˜åŒ…æ‹¬æ­£åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…çš„ä»»åŠ¡ã€‚æ¯”å¦‚æ­¤æ—¶å·²ç»è°ƒç”¨äº† shutdown æ–¹æ³•ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªçº¿ç¨‹ä¾ç„¶åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œé‚£ä¹ˆæ­¤æ—¶è°ƒç”¨ isShutdown æ–¹æ³•è¿”å›çš„æ˜¯ true ï¼Œè€Œè°ƒç”¨ isTerminated æ–¹æ³•è¿”å›çš„ä¾¿æ˜¯ false ï¼Œå› ä¸ºçº¿ç¨‹æ± ä¸­è¿˜æœ‰ä»»åŠ¡æ­£åœ¨åœ¨è¢«æ‰§è¡Œï¼Œçº¿ç¨‹æ± å¹¶æ²¡æœ‰çœŸæ­£â€œç»ˆç»“â€ã€‚ç›´åˆ°æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•äº†ï¼Œè°ƒç”¨ isTerminated() æ–¹æ³•æ‰ä¼šè¿”å› trueï¼Œè¿™è¡¨ç¤ºçº¿ç¨‹æ± å·²å…³é—­å¹¶ä¸”çº¿ç¨‹æ± å†…éƒ¨æ˜¯ç©ºçš„ï¼Œæ‰€æœ‰å‰©ä½™çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•äº†ã€‚</p><h4 id="3-16-4-awaitTermination"><a href="#3-16-4-awaitTermination" class="headerlink" title="3.16.4.awaitTermination()"></a>3.16.4.awaitTermination()</h4><p>ç¬¬å››ä¸ªæ–¹æ³•å«ä½œ awaitTermination()ï¼Œå®ƒæœ¬èº«å¹¶ä¸æ˜¯ç”¨æ¥å…³é—­çº¿ç¨‹æ± çš„ï¼Œè€Œæ˜¯ä¸»è¦ç”¨æ¥åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€çš„ã€‚æ¯”å¦‚æˆ‘ä»¬ç»™ awaitTermination æ–¹æ³•ä¼ å…¥çš„å‚æ•°æ˜¯ 10 ç§’ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šé™·å…¥ 10 ç§’é’Ÿçš„ç­‰å¾…ï¼Œç›´åˆ°å‘ç”Ÿä»¥ä¸‹ä¸‰ç§æƒ…å†µä¹‹ä¸€ï¼š</p><ol><li>ç­‰å¾…æœŸé—´ï¼ˆåŒ…æ‹¬è¿›å…¥ç­‰å¾…çŠ¶æ€ä¹‹å‰ï¼‰çº¿ç¨‹æ± å·²å…³é—­å¹¶ä¸”æ‰€æœ‰å·²æäº¤çš„ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ­£åœ¨æ‰§è¡Œçš„å’Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„ï¼‰éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œç›¸å½“äºçº¿ç¨‹æ± å·²ç»â€œç»ˆç»“â€äº†ï¼Œæ–¹æ³•ä¾¿ä¼šè¿”å› trueï¼›</li><li>ç­‰å¾…è¶…æ—¶æ—¶é—´åˆ°åï¼Œç¬¬ä¸€ç§çº¿ç¨‹æ± â€œç»ˆç»“â€çš„æƒ…å†µå§‹ç»ˆæœªå‘ç”Ÿï¼Œæ–¹æ³•è¿”å› falseï¼›</li><li>ç­‰å¾…æœŸé—´çº¿ç¨‹è¢«ä¸­æ–­ï¼Œæ–¹æ³•ä¼šæŠ›å‡º InterruptedException å¼‚å¸¸ã€‚</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨ awaitTermination æ–¹æ³•åå½“å‰çº¿ç¨‹ä¼šå°è¯•ç­‰å¾…ä¸€æ®µæŒ‡å®šçš„æ—¶é—´ï¼Œå¦‚æœåœ¨ç­‰å¾…æ—¶é—´å†…ï¼Œçº¿ç¨‹æ± å·²å…³é—­å¹¶ä¸”å†…éƒ¨çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•äº†ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹æ± çœŸæ­£â€œç»ˆç»“â€äº†ï¼Œé‚£ä¹ˆæ–¹æ³•å°±è¿”å› trueï¼Œå¦åˆ™è¶…æ—¶è¿”å› fasleã€‚</p><p>æˆ‘ä»¬åˆ™å¯ä»¥æ ¹æ® awaitTermination() è¿”å›çš„å¸ƒå°”å€¼æ¥åˆ¤æ–­ä¸‹ä¸€æ­¥åº”è¯¥æ‰§è¡Œçš„æ“ä½œã€‚</p><h4 id="3-16-5-shutdownNow"><a href="#3-16-5-shutdownNow" class="headerlink" title="3.16.5.shutdownNow()"></a>3.16.5.shutdownNow()</h4><p>æœ€åä¸€ä¸ªæ–¹æ³•æ˜¯ shutdownNow()ï¼Œä¹Ÿæ˜¯ 5 ç§æ–¹æ³•é‡ŒåŠŸèƒ½æœ€å¼ºå¤§çš„ï¼Œå®ƒä¸ç¬¬ä¸€ç§ shutdown æ–¹æ³•ä¸åŒä¹‹å¤„åœ¨äºåå­—ä¸­å¤šäº†ä¸€ä¸ªå•è¯ Nowï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤ºç«‹åˆ»å…³é—­çš„æ„æ€ã€‚åœ¨æ‰§è¡Œ shutdownNow æ–¹æ³•ä¹‹åï¼Œ<u><strong>é¦–å…ˆä¼šç»™æ‰€æœ‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å‘é€ interrupt ä¸­æ–­ä¿¡å·ï¼Œå°è¯•ä¸­æ–­è¿™äº›ä»»åŠ¡çš„æ‰§è¡Œï¼Œç„¶åä¼šå°†ä»»åŠ¡é˜Ÿåˆ—ä¸­æ­£åœ¨ç­‰å¾…çš„æ‰€æœ‰ä»»åŠ¡è½¬ç§»åˆ°ä¸€ä¸ª List ä¸­å¹¶è¿”å›ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿”å›çš„ä»»åŠ¡ List æ¥è¿›è¡Œä¸€äº›è¡¥æ•‘çš„æ“ä½œã€‚</strong></u></p><h3 id="3-17-çº¿ç¨‹æ± å®ç°â€œçº¿ç¨‹å¤ç”¨â€çš„åŸç†"><a href="#3-17-çº¿ç¨‹æ± å®ç°â€œçº¿ç¨‹å¤ç”¨â€çš„åŸç†" class="headerlink" title="3.17.çº¿ç¨‹æ± å®ç°â€œçº¿ç¨‹å¤ç”¨â€çš„åŸç†"></a>3.17.çº¿ç¨‹æ± å®ç°â€œçº¿ç¨‹å¤ç”¨â€çš„åŸç†</h3><p>æˆ‘ä»¬çŸ¥é“çº¿ç¨‹æ± ä¼šä½¿ç”¨å›ºå®šæ•°é‡æˆ–å¯å˜æ•°é‡çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä½†æ— è®ºæ˜¯å›ºå®šæ•°é‡æˆ–å¯å˜æ•°é‡çš„çº¿ç¨‹ï¼Œå…¶çº¿ç¨‹æ•°é‡éƒ½è¿œè¿œå°äºä»»åŠ¡æ•°é‡ï¼Œé¢å¯¹è¿™ç§æƒ…å†µçº¿ç¨‹æ± å¯ä»¥é€šè¿‡çº¿ç¨‹å¤ç”¨è®©åŒä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œé‚£ä¹ˆçº¿ç¨‹å¤ç”¨èƒŒåçš„åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>çº¿ç¨‹æ± å¯ä»¥æŠŠçº¿ç¨‹å’Œä»»åŠ¡è¿›è¡Œè§£è€¦ï¼Œçº¿ç¨‹å½’çº¿ç¨‹ï¼Œä»»åŠ¡å½’ä»»åŠ¡ï¼Œæ‘†è„±äº†ä¹‹å‰é€šè¿‡ Thread åˆ›å»ºçº¿ç¨‹æ—¶çš„ä¸€ä¸ªçº¿ç¨‹å¿…é¡»å¯¹åº”ä¸€ä¸ªä»»åŠ¡çš„é™åˆ¶ã€‚åœ¨çº¿ç¨‹æ± ä¸­ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥ä» BlockingQueue ä¸­ä¸æ–­æå–æ–°ä»»åŠ¡æ¥æ‰§è¡Œï¼Œå…¶æ ¸å¿ƒåŸç†åœ¨äº<u><strong>çº¿ç¨‹æ± å¯¹ Thread è¿›è¡Œäº†å°è£…ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡æ‰§è¡Œä»»åŠ¡éƒ½ä¼šè°ƒç”¨ Thread.start() æ¥åˆ›å»ºæ–°çº¿ç¨‹ï¼Œè€Œæ˜¯è®©æ¯ä¸ªçº¿ç¨‹å»æ‰§è¡Œä¸€ä¸ªâ€œå¾ªç¯ä»»åŠ¡â€ï¼Œåœ¨è¿™ä¸ªâ€œå¾ªç¯ä»»åŠ¡â€ä¸­ï¼Œä¸åœåœ°æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ä»»åŠ¡ç­‰å¾…è¢«æ‰§è¡Œï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ä»»åŠ¡çš„ run æ–¹æ³•ï¼ŒæŠŠ run æ–¹æ³•å½“ä½œå’Œæ™®é€šæ–¹æ³•ä¸€æ ·çš„åœ°ä½å»è°ƒç”¨ï¼Œç›¸å½“äºæŠŠæ¯ä¸ªä»»åŠ¡çš„ run() æ–¹æ³•ä¸²è”äº†èµ·æ¥ï¼Œæ‰€ä»¥çº¿ç¨‹æ•°é‡å¹¶ä¸å¢åŠ ã€‚</strong></u></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable command)</span> &#123; </span><br><span class="line">  <span class="comment">//execute æ–¹æ³•ä¸­é€šè¿‡ if è¯­å¥åˆ¤æ–­ command ï¼Œä¹Ÿå°±æ˜¯ Runnable ä»»åŠ¡æ˜¯å¦ç­‰äº nullï¼Œå¦‚æœä¸º null å°±æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (command == <span class="literal">null</span>) </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> ctl.get();</span><br><span class="line">  <span class="comment">//addWorker æ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨çº¿ç¨‹æ± ä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„ä»»åŠ¡ï¼Œå®ƒçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœå¸ƒå°”å€¼ä¼ å…¥ true ä»£è¡¨å¢åŠ çº¿ç¨‹æ—¶åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å°‘äº corePoolSizeï¼Œå°äºåˆ™å¢åŠ æ–°çº¿ç¨‹ï¼Œå¤§äºç­‰äºåˆ™ä¸å¢åŠ ï¼›åŒç†ï¼Œå¦‚æœä¼ å…¥ false ä»£è¡¨å¢åŠ çº¿ç¨‹æ—¶åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å°‘äº maxPoolSizeï¼Œå°äºåˆ™å¢åŠ æ–°çº¿ç¨‹ï¼Œå¤§äºç­‰äºåˆ™ä¸å¢åŠ ï¼Œæ‰€ä»¥è¿™é‡Œçš„å¸ƒå°”å€¼çš„å«ä¹‰æ˜¯ä»¥æ ¸å¿ƒçº¿ç¨‹æ•°ä¸ºç•Œé™è¿˜æ˜¯ä»¥æœ€å¤§çº¿ç¨‹æ•°ä¸ºç•Œé™è¿›è¡Œæ˜¯å¦æ–°å¢çº¿ç¨‹çš„åˆ¤æ–­ã€‚addWorker() æ–¹æ³•å¦‚æœè¿”å› true ä»£è¡¨æ·»åŠ æˆåŠŸï¼Œå¦‚æœè¿”å› false ä»£è¡¨æ·»åŠ å¤±è´¥ã€‚</span></span><br><span class="line">  <span class="comment">//ç°æœ‰çº¿ç¨‹æ•°å°äºçº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123; </span><br><span class="line">        <span class="keyword">if</span> (addWorker(command, <span class="literal">true</span>)) </span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        c = ctl.get();</span><br><span class="line">    &#125; </span><br><span class="line">  <span class="comment">//è¿è¡Œåˆ°æ­¤å¤„è¯´æ˜ ç°æœ‰çº¿ç¨‹æ•° &gt;= çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line">  <span class="comment">//çº¿ç¨‹æ± æ˜¯runningçŠ¶æ€ &amp;&amp; èƒ½æŠŠä»»åŠ¡æ”¾è¿›é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; </span><br><span class="line">        <span class="type">int</span> <span class="variable">recheck</span> <span class="operator">=</span> ctl.get();</span><br><span class="line">        <span class="keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command)) </span><br><span class="line">            reject(command);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>) </span><br><span class="line">            addWorker(<span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//è¿è¡Œåˆ°æ­¤å¤„è¯´æ˜ ä¸æ˜¯runningçŠ¶æ€ || çº¿ç¨‹æ•°&gt;=æ ¸å¿ƒçº¿ç¨‹æ•° å¹¶ä¸” ä»»åŠ¡é˜Ÿåˆ—æ»¡</span></span><br><span class="line">  <span class="comment">//é‚£ä¹ˆä»¥æœ€å¤§é˜Ÿçº¿ç¨‹æ•°ä¸ºæ ‡å‡†åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="literal">false</span>)) </span><br><span class="line">      <span class="comment">//è¿˜æ˜¯æ— æ³•åˆ›å»ºï¼Œåˆ™æ‹’ç»</span></span><br><span class="line">        reject(command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-18-ä½ çŸ¥é“å“ªå‡ ç§é”ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"><a href="#3-18-ä½ çŸ¥é“å“ªå‡ ç§é”ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="3.18.ä½ çŸ¥é“å“ªå‡ ç§é”ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"></a>3.18.ä½ çŸ¥é“å“ªå‡ ç§é”ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</h3><p>æ ¹æ®<u>åˆ†ç±»æ ‡å‡†</u>æˆ‘ä»¬æŠŠé”åˆ†ä¸ºä»¥ä¸‹ 7 å¤§ç±»åˆ«ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>åå‘é”&#x2F;è½»é‡çº§é”&#x2F;é‡é‡çº§é”ï¼›</li><li>å¯é‡å…¥é”&#x2F;éå¯é‡å…¥é”ï¼›</li><li>å…±äº«é”&#x2F;ç‹¬å é”ï¼›</li><li>å…¬å¹³é”&#x2F;éå…¬å¹³é”ï¼›</li><li>æ‚²è§‚é”&#x2F;ä¹è§‚é”ï¼›</li><li>è‡ªæ—‹é”&#x2F;éè‡ªæ—‹é”ï¼›</li><li>å¯ä¸­æ–­é”&#x2F;ä¸å¯ä¸­æ–­é”ã€‚</li></ul><h4 id="3-18-1-åå‘é”-x2F-è½»é‡çº§é”-x2F-é‡é‡çº§é”"><a href="#3-18-1-åå‘é”-x2F-è½»é‡çº§é”-x2F-é‡é‡çº§é”" class="headerlink" title="3.18.1.åå‘é”&#x2F;è½»é‡çº§é”&#x2F;é‡é‡çº§é”"></a>3.18.1.åå‘é”&#x2F;è½»é‡çº§é”&#x2F;é‡é‡çº§é”</h4><ul><li>åå‘é”</li></ul><p>å¦‚æœè‡ªå§‹è‡³ç»ˆï¼Œå¯¹äºè¿™æŠŠé”éƒ½ä¸å­˜åœ¨ç«äº‰ï¼Œé‚£ä¹ˆå…¶å®å°±æ²¡å¿…è¦ä¸Šé”ï¼Œåªéœ€è¦æ‰“ä¸ªæ ‡è®°å°±è¡Œäº†ï¼Œè¿™å°±æ˜¯åå‘é”çš„æ€æƒ³ã€‚ä¸€ä¸ªå¯¹è±¡è¢«åˆå§‹åŒ–åï¼Œè¿˜æ²¡æœ‰ä»»ä½•çº¿ç¨‹æ¥è·å–å®ƒçš„é”æ—¶ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å¯åå‘çš„ï¼Œ<u>å½“æœ‰ç¬¬ä¸€ä¸ªçº¿ç¨‹æ¥è®¿é—®å®ƒå¹¶å°è¯•è·å–é”çš„æ—¶å€™ï¼Œå®ƒå°±å°†è¿™ä¸ªçº¿ç¨‹è®°å½•ä¸‹æ¥ï¼Œä»¥åå¦‚æœå°è¯•è·å–é”çš„çº¿ç¨‹æ­£æ˜¯åå‘é”çš„æ‹¥æœ‰è€…ï¼Œå°±å¯ä»¥ç›´æ¥è·å¾—é”ï¼Œå¼€é”€å¾ˆå°ï¼Œæ€§èƒ½æœ€å¥½ã€‚</u></p><ul><li>è½»é‡çº§é”</li></ul><p>JVM å¼€å‘è€…å‘ç°åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œsynchronized ä¸­çš„ä»£ç æ˜¯è¢«å¤šä¸ªçº¿ç¨‹äº¤æ›¿æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯åŒæ—¶æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¹¶ä¸å­˜åœ¨å®é™…çš„ç«äº‰ï¼Œæˆ–è€…æ˜¯åªæœ‰çŸ­æ—¶é—´çš„é”ç«äº‰ï¼Œç”¨ CAS å°±å¯ä»¥è§£å†³ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œç”¨å®Œå…¨äº’æ–¥çš„é‡é‡çº§é”æ˜¯æ²¡å¿…è¦çš„ã€‚è½»é‡çº§é”æ˜¯æŒ‡å½“é”åŸæ¥æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œè¯´æ˜å­˜åœ¨ç«äº‰ï¼Œé‚£ä¹ˆåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œçº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹(ä¸€æ®µæ—¶é—´&#x2F;ä¸€å®šæ¬¡æ•°åå¤è¯·æ±‚)çš„å½¢å¼å°è¯•è·å–é”ï¼Œè€Œä¸ä¼šé™·å…¥é˜»å¡ã€‚</p><ul><li>é‡é‡çº§é”</li></ul><p>é‡é‡çº§é”æ˜¯äº’æ–¥é”ï¼Œå®ƒæ˜¯åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„åŒæ­¥æœºåˆ¶å®ç°çš„ï¼Œæ‰€ä»¥å¼€é”€ç›¸å¯¹æ¯”è¾ƒå¤§ã€‚å½“å¤šä¸ªçº¿ç¨‹ç›´æ¥æœ‰å®é™…ç«äº‰ï¼Œä¸”é”ç«äº‰æ—¶é—´é•¿çš„æ—¶å€™ï¼Œè½»é‡çº§é”ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œé”å°±ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚é‡é‡çº§é”ä¼šè®©å…¶ä»–ç”³è¯·å´æ‹¿ä¸åˆ°é”çš„çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p><p><img src="https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/Java%20%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b%2078%20%e8%ae%b2-%e5%ae%8c/assets/CgpOIF35yCGAGFBbAAAO9n9VgTQ034.png" alt="img"></p><p>ä½ å¯ä»¥å‘ç°é”å‡çº§çš„è·¯å¾„ï¼šæ— é”â†’åå‘é”â†’è½»é‡çº§é”â†’é‡é‡çº§é”ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œåå‘é”æ€§èƒ½æœ€å¥½ï¼Œå¯ä»¥é¿å…æ‰§è¡Œ CAS æ“ä½œã€‚è€Œè½»é‡çº§é”åˆ©ç”¨è‡ªæ—‹å’Œ CAS é¿å…äº†é‡é‡çº§é”å¸¦æ¥çš„çº¿ç¨‹é˜»å¡å’Œå”¤é†’ï¼Œæ€§èƒ½ä¸­ç­‰ã€‚é‡é‡çº§é”åˆ™ä¼šæŠŠè·å–ä¸åˆ°é”çš„çº¿ç¨‹é˜»å¡ï¼Œæ€§èƒ½æœ€å·®ã€‚</p><h4 id="3-18-2-å¯é‡å…¥é”-x2F-éå¯é‡å…¥é”"><a href="#3-18-2-å¯é‡å…¥é”-x2F-éå¯é‡å…¥é”" class="headerlink" title="3.18.2.å¯é‡å…¥é”&#x2F;éå¯é‡å…¥é”"></a>3.18.2.å¯é‡å…¥é”&#x2F;éå¯é‡å…¥é”</h4><p>â€‹ç¬¬ 2 ä¸ªåˆ†ç±»æ˜¯å¯é‡å…¥é”å’Œéå¯é‡å…¥é”ã€‚<u>å¯é‡å…¥é”æŒ‡çš„æ˜¯çº¿ç¨‹å½“å‰å·²ç»æŒæœ‰è¿™æŠŠé”äº†ï¼Œèƒ½åœ¨ä¸é‡Šæ”¾è¿™æŠŠé”çš„æƒ…å†µä¸‹ï¼Œå†æ¬¡è·å–è¿™æŠŠé”</u>ã€‚åŒç†ï¼Œä¸å¯é‡å…¥é”æŒ‡çš„æ˜¯è™½ç„¶çº¿ç¨‹å½“å‰æŒæœ‰äº†è¿™æŠŠé”ï¼Œä½†æ˜¯å¦‚æœæƒ³å†æ¬¡è·å–è¿™æŠŠé”ï¼Œä¹Ÿå¿…é¡»è¦å…ˆé‡Šæ”¾é”åæ‰èƒ½å†æ¬¡å°è¯•è·å–ã€‚</p><p>â€‹å¯¹äºå¯é‡å…¥é”è€Œè¨€ï¼Œæœ€å…¸å‹çš„å°±æ˜¯ ReentrantLock äº†ï¼Œæ­£å¦‚å®ƒçš„åå­—ä¸€æ ·ï¼Œreentrant çš„æ„æ€å°±æ˜¯å¯é‡å…¥ï¼Œå®ƒä¹Ÿæ˜¯ Lock æ¥å£æœ€ä¸»è¦çš„ä¸€ä¸ªå®ç°ç±»ã€‚</p><h4 id="3-18-3-å…±äº«é”-x2F-ç‹¬å é”"><a href="#3-18-3-å…±äº«é”-x2F-ç‹¬å é”" class="headerlink" title="3.18.3.å…±äº«é”&#x2F;ç‹¬å é”"></a>3.18.3.å…±äº«é”&#x2F;ç‹¬å é”</h4><p>â€‹å…±äº«é”æŒ‡çš„æ˜¯æˆ‘ä»¬åŒä¸€æŠŠé”å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å¾—ï¼Œè€Œç‹¬å é”æŒ‡çš„å°±æ˜¯ï¼Œè¿™æŠŠé”åªèƒ½åŒæ—¶è¢«ä¸€ä¸ªçº¿ç¨‹è·å¾—ã€‚æˆ‘ä»¬çš„è¯»å†™é”ï¼Œå°±æœ€å¥½åœ°è¯ é‡Šäº†å…±äº«é”å’Œç‹¬å é”çš„ç†å¿µã€‚è¯»å†™é”ä¸­çš„è¯»é”ï¼Œæ˜¯å…±äº«é”ï¼Œè€Œå†™é”æ˜¯ç‹¬å é”ã€‚è¯»é”å¯ä»¥è¢«åŒæ—¶è¯»ï¼Œå¯ä»¥åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹æŒæœ‰ï¼Œè€Œå†™é”æœ€å¤šåªèƒ½åŒæ—¶è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚</p><h4 id="3-18-4-å…¬å¹³é”-x2F-éå…¬å¹³é”"><a href="#3-18-4-å…¬å¹³é”-x2F-éå…¬å¹³é”" class="headerlink" title="3.18.4.å…¬å¹³é”&#x2F;éå…¬å¹³é”"></a>3.18.4.å…¬å¹³é”&#x2F;éå…¬å¹³é”</h4><p>â€‹å…¬å¹³é”çš„å…¬å¹³çš„å«ä¹‰åœ¨äºå¦‚æœçº¿ç¨‹ç°åœ¨æ‹¿ä¸åˆ°è¿™æŠŠé”ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±éƒ½ä¼šè¿›å…¥ç­‰å¾…ï¼Œå¼€å§‹æ’é˜Ÿï¼Œåœ¨ç­‰å¾…é˜Ÿåˆ—é‡Œç­‰å¾…æ—¶é—´é•¿çš„çº¿ç¨‹ä¼šä¼˜å…ˆæ‹¿åˆ°è¿™æŠŠé”ï¼Œæœ‰<u>å…ˆæ¥å…ˆå¾—</u>çš„æ„æ€ã€‚è€Œéå…¬å¹³é”å°±ä¸é‚£ä¹ˆâ€œå®Œç¾â€äº†ï¼Œå®ƒä¼šåœ¨ä¸€å®šæƒ…å†µä¸‹ï¼Œå¿½ç•¥æ‰å·²ç»åœ¨æ’é˜Ÿçš„çº¿ç¨‹ï¼Œ<u>å‘ç”Ÿæ’é˜Ÿç°è±¡</u>ã€‚</p><h4 id="3-18-5-æ‚²è§‚é”-x2F-ä¹è§‚é”"><a href="#3-18-5-æ‚²è§‚é”-x2F-ä¹è§‚é”" class="headerlink" title="3.18.5.æ‚²è§‚é”&#x2F;ä¹è§‚é”"></a>3.18.5.æ‚²è§‚é”&#x2F;ä¹è§‚é”</h4><p>â€‹æ‚²è§‚é”çš„æ¦‚å¿µæ˜¯åœ¨è·å–èµ„æºä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‹¿åˆ°é”ï¼Œ<u>ä»¥ä¾¿è¾¾åˆ°â€œç‹¬å â€çš„çŠ¶æ€</u>ï¼Œå½“å‰çº¿ç¨‹åœ¨æ“ä½œèµ„æºçš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ç”±äºä¸èƒ½æ‹¿åˆ°é”ï¼Œæ‰€ä»¥å…¶ä»–çº¿ç¨‹ä¸èƒ½æ¥å½±å“æˆ‘ã€‚</p><p>â€‹è€Œä¹è§‚é”æ°æ°ç›¸åï¼Œå®ƒå¹¶ä¸è¦æ±‚åœ¨è·å–èµ„æºå‰æ‹¿åˆ°é”ï¼Œä¹Ÿä¸ä¼šé”ä½èµ„æºï¼›ç›¸åï¼Œ<u>ä¹è§‚é”åˆ©ç”¨ CAS ç†å¿µï¼Œåœ¨ä¸ç‹¬å èµ„æºçš„æƒ…å†µä¸‹ï¼Œå®Œæˆäº†å¯¹èµ„æºçš„ä¿®æ”¹ã€‚</u></p><h4 id="3-18-6-è‡ªæ—‹é”-x2F-éè‡ªæ—‹é”"><a href="#3-18-6-è‡ªæ—‹é”-x2F-éè‡ªæ—‹é”" class="headerlink" title="3.18.6.è‡ªæ—‹é”&#x2F;éè‡ªæ—‹é”"></a>3.18.6.è‡ªæ—‹é”&#x2F;éè‡ªæ—‹é”</h4><p>â€‹è‡ªæ—‹é”çš„ç†å¿µæ˜¯å¦‚æœçº¿ç¨‹ç°åœ¨æ‹¿ä¸åˆ°é”ï¼Œ<u>å¹¶ä¸ç›´æ¥é™·å…¥é˜»å¡æˆ–è€…é‡Šæ”¾ CPU èµ„æºï¼Œè€Œæ˜¯å¼€å§‹åˆ©ç”¨å¾ªç¯ï¼Œä¸åœåœ°å°è¯•è·å–é”ï¼Œè¿™ä¸ªå¾ªç¯è¿‡ç¨‹è¢«å½¢è±¡åœ°æ¯”å–»ä¸ºâ€œè‡ªæ—‹â€</u>ï¼Œå°±åƒæ˜¯çº¿ç¨‹åœ¨â€œè‡ªæˆ‘æ—‹è½¬â€ã€‚ç›¸åï¼Œéè‡ªæ—‹é”çš„ç†å¿µå°±æ˜¯æ²¡æœ‰è‡ªæ—‹çš„è¿‡ç¨‹ï¼Œå¦‚æœ<u>æ‹¿ä¸åˆ°é”å°±ç›´æ¥æ”¾å¼ƒ</u>ï¼Œæˆ–è€…è¿›è¡Œå…¶ä»–çš„å¤„ç†é€»è¾‘ï¼Œä¾‹å¦‚å»æ’é˜Ÿã€é™·å…¥é˜»å¡ç­‰ã€‚</p><h4 id="3-18-7-å¯ä¸­æ–­é”-x2F-ä¸å¯ä¸­æ–­é”"><a href="#3-18-7-å¯ä¸­æ–­é”-x2F-ä¸å¯ä¸­æ–­é”" class="headerlink" title="3.18.7.å¯ä¸­æ–­é”&#x2F;ä¸å¯ä¸­æ–­é”"></a>3.18.7.å¯ä¸­æ–­é”&#x2F;ä¸å¯ä¸­æ–­é”</h4><p>â€‹åœ¨ Java ä¸­ï¼Œsynchronized å…³é”®å­—ä¿®é¥°çš„é”ä»£è¡¨çš„æ˜¯ä¸å¯ä¸­æ–­é”ï¼Œ<u>ä¸€æ—¦çº¿ç¨‹ç”³è¯·äº†é”ï¼Œå°±æ²¡æœ‰å›å¤´è·¯äº†ï¼Œåªèƒ½ç­‰åˆ°æ‹¿åˆ°é”ä»¥åæ‰èƒ½è¿›è¡Œå…¶ä»–çš„é€»è¾‘å¤„ç†</u>ã€‚</p><p>â€‹è€Œæˆ‘ä»¬çš„ ReentrantLock æ˜¯ä¸€ç§å…¸å‹çš„å¯ä¸­æ–­é”ï¼Œä¾‹å¦‚ä½¿ç”¨ lockInterruptibly æ–¹æ³•åœ¨è·å–é”çš„è¿‡ç¨‹ä¸­ï¼Œ<u><strong>çªç„¶ä¸æƒ³è·å–äº†ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥åœ¨ä¸­æ–­ä¹‹åå»åšå…¶ä»–çš„äº‹æƒ…ï¼Œä¸éœ€è¦ä¸€ç›´å‚»ç­‰åˆ°è·å–åˆ°é”æ‰ç¦»å¼€ã€‚</strong></u></p><h3 id="3-19-æ‚²è§‚é”ä¸ä¹è§‚é”"><a href="#3-19-æ‚²è§‚é”ä¸ä¹è§‚é”" class="headerlink" title="3.19.æ‚²è§‚é”ä¸ä¹è§‚é”"></a>3.19.æ‚²è§‚é”ä¸ä¹è§‚é”</h3><ul><li>æ‚²è§‚é”ï¼šsynchronized å…³é”®å­—å’Œ Lock æ¥å£</li></ul><p>Java ä¸­æ‚²è§‚é”çš„å®ç°åŒ…æ‹¬ synchronized å…³é”®å­—å’Œ Lock ç›¸å…³ç±»ç­‰ï¼Œæˆ‘ä»¬ä»¥ Lock æ¥å£ä¸ºä¾‹ï¼Œä¾‹å¦‚ Lock çš„å®ç°ç±» ReentrantLockï¼Œç±»ä¸­çš„ lock() ç­‰æ–¹æ³•å°±æ˜¯æ‰§è¡ŒåŠ é”ï¼Œè€Œ unlock() æ–¹æ³•æ˜¯æ‰§è¡Œè§£é”ã€‚å¤„ç†èµ„æºä¹‹å‰å¿…é¡»è¦å…ˆåŠ é”å¹¶æ‹¿åˆ°é”ï¼Œç­‰åˆ°å¤„ç†å®Œäº†ä¹‹åå†è§£å¼€é”ï¼Œè¿™å°±æ˜¯éå¸¸å…¸å‹çš„æ‚²è§‚é”æ€æƒ³ã€‚</p><ul><li>ä¹è§‚é”ï¼šåŸå­ç±»</li></ul><p>ä¹è§‚é”çš„å…¸å‹æ¡ˆä¾‹å°±æ˜¯åŸå­ç±»ï¼Œä¾‹å¦‚ AtomicInteger åœ¨æ›´æ–°æ•°æ®æ—¶ï¼Œå°±ä½¿ç”¨äº†ä¹è§‚é”çš„æ€æƒ³ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ“ä½œåŒä¸€ä¸ªåŸå­å˜é‡ã€‚</p><ul><li>å¤§å–œå¤§æ‚²ï¼šæ•°æ®åº“</li></ul><p>æ•°æ®åº“ä¸­åŒæ—¶æ‹¥æœ‰æ‚²è§‚é”å’Œä¹è§‚é”çš„æ€æƒ³ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¦‚æœåœ¨ MySQL é€‰æ‹© <strong>select for update</strong> è¯­å¥ï¼Œé‚£å°±æ˜¯<u>æ‚²è§‚é”</u>ï¼Œåœ¨æäº¤ä¹‹å‰ä¸å…è®¸ç¬¬ä¸‰æ–¹æ¥ä¿®æ”¹è¯¥æ•°æ®ï¼Œè¿™å½“ç„¶ä¼šé€ æˆä¸€å®šçš„æ€§èƒ½æŸè€—ï¼Œåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹æ˜¯ä¸å¯å–çš„ã€‚</p><p>ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<strong>ä¸€ä¸ªç‰ˆæœ¬ version å­—æ®µåœ¨æ•°æ®åº“ä¸­å®ç°ä¹è§‚é”</strong>ã€‚åœ¨è·å–åŠä¿®æ”¹æ•°æ®æ—¶éƒ½ä¸éœ€è¦åŠ é”ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è·å–å®Œæ•°æ®å¹¶è®¡ç®—å®Œæ¯•ï¼Œå‡†å¤‡æ›´æ–°æ•°æ®æ—¶ï¼Œä¼šæ£€æŸ¥ç‰ˆæœ¬å·å’Œè·å–æ•°æ®æ—¶çš„ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´å°±ç›´æ¥æ›´æ–°ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œè¯´æ˜è®¡ç®—æœŸé—´å·²ç»æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡è¿™ä¸ªæ•°æ®äº†ï¼Œé‚£æˆ‘å°±å¯ä»¥é€‰æ‹©é‡æ–°è·å–æ•°æ®ï¼Œé‡æ–°è®¡ç®—ï¼Œç„¶åå†æ¬¡å°è¯•æ›´æ–°æ•°æ®ã€‚</p><h4 id="ä¸¤ç§é”å„è‡ªçš„ä½¿ç”¨åœºæ™¯"><a href="#ä¸¤ç§é”å„è‡ªçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä¸¤ç§é”å„è‡ªçš„ä½¿ç”¨åœºæ™¯"></a>ä¸¤ç§é”å„è‡ªçš„ä½¿ç”¨åœºæ™¯</h4><p>æ‚²è§‚é”é€‚åˆç”¨äº**<u>å¹¶å‘å†™å…¥å¤šã€ä¸´ç•ŒåŒºä»£ç å¤æ‚ã€ç«äº‰æ¿€çƒˆç­‰åœºæ™¯</u>**ï¼Œè¿™ç§åœºæ™¯ä¸‹æ‚²è§‚é”å¯ä»¥é¿å…å¤§é‡çš„æ— ç”¨çš„åå¤å°è¯•ç­‰æ¶ˆè€—ã€‚</p><p>ä¹è§‚é”é€‚ç”¨äºå¤§éƒ¨åˆ†æ˜¯è¯»å–ï¼Œå°‘éƒ¨åˆ†æ˜¯ä¿®æ”¹çš„åœºæ™¯ï¼Œä¹Ÿé€‚åˆè™½ç„¶è¯»å†™éƒ½å¾ˆå¤šï¼Œä½†æ˜¯<u>å¹¶å‘å¹¶ä¸æ¿€çƒˆçš„åœºæ™¯</u>ã€‚åœ¨è¿™äº›åœºæ™¯ä¸‹ï¼Œä¹è§‚é”ä¸åŠ é”çš„ç‰¹ç‚¹èƒ½è®©æ€§èƒ½å¤§å¹…æé«˜ã€‚</p><h3 id="3-20-å¦‚ä½•çœ‹åˆ°-synchronized-èƒŒåçš„â€œmonitor-é”â€ï¼Ÿ"><a href="#3-20-å¦‚ä½•çœ‹åˆ°-synchronized-èƒŒåçš„â€œmonitor-é”â€ï¼Ÿ" class="headerlink" title="3.20.å¦‚ä½•çœ‹åˆ° synchronized èƒŒåçš„â€œmonitor é”â€ï¼Ÿ"></a>3.20.å¦‚ä½•çœ‹åˆ° synchronized èƒŒåçš„â€œmonitor é”â€ï¼Ÿ</h3><h4 id="è·å–å’Œé‡Šæ”¾-monitor-é”çš„æ—¶æœº"><a href="#è·å–å’Œé‡Šæ”¾-monitor-é”çš„æ—¶æœº" class="headerlink" title="è·å–å’Œé‡Šæ”¾ monitor é”çš„æ—¶æœº"></a>è·å–å’Œé‡Šæ”¾ monitor é”çš„æ—¶æœº</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæœ€ç®€å•çš„åŒæ­¥æ–¹å¼å°±æ˜¯åˆ©ç”¨ synchronized å…³é”®å­—æ¥ä¿®é¥°ä»£ç å—æˆ–è€…ä¿®é¥°ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†è¢«ä¿æŠ¤çš„ä»£ç ï¼Œåœ¨åŒä¸€æ—¶åˆ»å°±æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿è¡Œï¼Œè€Œ synchronized çš„èƒŒåæ­£æ˜¯åˆ©ç”¨ monitor é”å®ç°çš„ã€‚</p><p>â€‹æ‰€ä»¥é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹è·å–å’Œé‡Šæ”¾ monitor é”çš„æ—¶æœºï¼Œ<u>æ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥ç”¨ä½œä¸€ä¸ªå®ç°åŒæ­¥çš„é”ï¼Œè¿™ä¸ªé”ä¹Ÿè¢«ç§°ä¸ºå†…ç½®é”æˆ– monitor é”</u>ï¼Œè·å¾— monitor é”çš„å”¯ä¸€é€”å¾„å°±æ˜¯è¿›å…¥ç”±è¿™ä¸ªé”ä¿æŠ¤çš„åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ï¼Œçº¿ç¨‹åœ¨è¿›å…¥è¢« synchronized ä¿æŠ¤çš„ä»£ç å—ä¹‹å‰ï¼Œä¼šè‡ªåŠ¨è·å–é”ï¼Œå¹¶ä¸”æ— è®ºæ˜¯æ­£å¸¸è·¯å¾„é€€å‡ºï¼Œè¿˜æ˜¯é€šè¿‡æŠ›å‡ºå¼‚å¸¸é€€å‡ºï¼Œåœ¨é€€å‡ºçš„æ—¶å€™éƒ½ä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚</p><p>â€‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">    method body</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç­‰ä»·â¬‡ï¸</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.intrinsicLock.lock();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        method body</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.intrinsicLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§å†™æ³•ä¸­ï¼Œè¿›å…¥ method æ–¹æ³•åï¼Œç«‹åˆ»æ·»åŠ å†…ç½®é”ï¼Œå¹¶ä¸”ç”¨ try ä»£ç å—æŠŠæ–¹æ³•ä¿æŠ¤èµ·æ¥ï¼Œæœ€åç”¨ finally é‡Šæ”¾è¿™æŠŠé”ï¼Œè¿™é‡Œçš„ intrinsicLock å°±æ˜¯ monitor é”ã€‚</p><h4 id="synchronized-ä¿®é¥°çš„ä»£ç å—ï¼š"><a href="#synchronized-ä¿®é¥°çš„ä»£ç å—ï¼š" class="headerlink" title="synchronized ä¿®é¥°çš„ä»£ç å—ï¼š"></a>synchronized ä¿®é¥°çš„ä»£ç å—ï¼š</h4><p>åˆ©ç”¨monitorenterä¸monitorexitæŒ‡ä»¤å®ç°ï¼š</p><h5 id="monitorenterï¼š"><a href="#monitorenterï¼š" class="headerlink" title="monitorenterï¼š"></a>monitorenterï¼š</h5><p>æ‰§è¡Œ monitorenter çš„çº¿ç¨‹å°è¯•è·å¾— monitor çš„æ‰€æœ‰æƒï¼Œä¼šå‘ç”Ÿä»¥ä¸‹è¿™ä¸‰ç§æƒ…å†µä¹‹ä¸€ï¼š</p><p>a. å¦‚æœè¯¥ monitor çš„è®¡æ•°ä¸º 0ï¼Œåˆ™çº¿ç¨‹è·å¾—è¯¥ monitor å¹¶å°†å…¶è®¡æ•°è®¾ç½®ä¸º 1ã€‚ç„¶åï¼Œè¯¥çº¿ç¨‹å°±æ˜¯è¿™ä¸ª monitor çš„æ‰€æœ‰è€…ã€‚</p><p>b. å¦‚æœçº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ª monitor ï¼Œåˆ™å®ƒå°†é‡æ–°è¿›å…¥ï¼Œå¹¶ä¸”ç´¯åŠ è®¡æ•°ã€‚</p><p>c. å¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ª monitorï¼Œé‚£ä¸ªè¿™ä¸ªçº¿ç¨‹å°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°è¿™ä¸ª monitor çš„è®¡æ•°å˜æˆä¸º 0ï¼Œä»£è¡¨è¿™ä¸ª monitor å·²ç»è¢«é‡Šæ”¾äº†ï¼Œäºæ˜¯å½“å‰è¿™ä¸ªçº¿ç¨‹å°±ä¼šå†æ¬¡å°è¯•è·å–è¿™ä¸ª monitorã€‚</p><h5 id="monitorexitï¼š"><a href="#monitorexitï¼š" class="headerlink" title="monitorexitï¼š"></a>monitorexitï¼š</h5><p>monitorexit çš„ä½œç”¨æ˜¯å°† monitor çš„è®¡æ•°å™¨å‡ 1ï¼Œç›´åˆ°å‡ä¸º 0 ä¸ºæ­¢ã€‚ä»£è¡¨è¿™ä¸ª monitor å·²ç»è¢«é‡Šæ”¾äº†ï¼Œå·²ç»æ²¡æœ‰ä»»ä½•çº¿ç¨‹æ‹¥æœ‰å®ƒäº†ï¼Œä¹Ÿå°±ä»£è¡¨ç€è§£é”ï¼Œæ‰€ä»¥ï¼Œå…¶ä»–æ­£åœ¨ç­‰å¾…è¿™ä¸ª monitor çš„çº¿ç¨‹ï¼Œæ­¤æ—¶ä¾¿å¯ä»¥å†æ¬¡å°è¯•è·å–è¿™ä¸ª monitor çš„æ‰€æœ‰æƒã€‚</p><h4 id="synchronized-ä¿®é¥°çš„æ–¹æ³•ï¼š"><a href="#synchronized-ä¿®é¥°çš„æ–¹æ³•ï¼š" class="headerlink" title="synchronized ä¿®é¥°çš„æ–¹æ³•ï¼š"></a>synchronized ä¿®é¥°çš„æ–¹æ³•ï¼š</h4><p>â€”â€”åˆ©ç”¨flagå®ç°</p><p>â€‹ä¼šæœ‰ä¸€ä¸ª ACC_SYNCHRONIZED æ ‡å¿—ã€‚å½“æŸä¸ªçº¿ç¨‹è¦è®¿é—®æŸä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šé¦–å…ˆæ£€æŸ¥æ–¹æ³•æ˜¯å¦æœ‰ ACC_SYNCHRONIZED æ ‡å¿—ï¼Œå¦‚æœæœ‰åˆ™éœ€è¦å…ˆè·å¾— monitor é”ï¼Œç„¶åæ‰èƒ½å¼€å§‹æ‰§è¡Œæ–¹æ³•ï¼Œæ–¹æ³•æ‰§è¡Œä¹‹åå†é‡Šæ”¾ monitor é”ã€‚</p><h3 id="3-21-synchronized-å’Œ-Lock-å­°ä¼˜å­°åŠ£ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ"><a href="#3-21-synchronized-å’Œ-Lock-å­°ä¼˜å­°åŠ£ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ" class="headerlink" title="3.21.synchronized å’Œ Lock å­°ä¼˜å­°åŠ£ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ"></a>3.21.synchronized å’Œ Lock å­°ä¼˜å­°åŠ£ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ</h3><p>synchronizedä¸å¤Ÿçµæ´»å¹¶åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼Œä½†æ˜¯ï¼š</p><ol><li>å¦‚æœèƒ½ä¸ç”¨æœ€å¥½æ—¢ä¸ä½¿ç”¨ Lock ä¹Ÿä¸ä½¿ç”¨ synchronizedã€‚å› ä¸ºåœ¨è®¸å¤šæƒ…å†µä¸‹ä½ å¯ä»¥ä½¿ç”¨ java.util.concurrent åŒ…ä¸­çš„æœºåˆ¶ï¼Œå®ƒä¼šä¸ºä½ å¤„ç†æ‰€æœ‰çš„åŠ é”å’Œè§£é”æ“ä½œï¼Œä¹Ÿå°±æ˜¯æ¨èä¼˜å…ˆä½¿ç”¨å·¥å…·ç±»æ¥åŠ è§£é”ã€‚</li><li>å¦‚æœ synchronized å…³é”®å­—é€‚åˆä½ çš„ç¨‹åºï¼Œ é‚£ä¹ˆè¯·å°½é‡ä½¿ç”¨å®ƒï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç¼–å†™ä»£ç çš„æ•°é‡ï¼Œå‡å°‘å‡ºé”™çš„æ¦‚ç‡ã€‚å› ä¸ºä¸€æ—¦å¿˜è®°åœ¨ finally é‡Œ unlockï¼Œä»£ç å¯èƒ½ä¼šå‡ºå¾ˆå¤§çš„é—®é¢˜ï¼Œè€Œä½¿ç”¨ synchronized æ›´å®‰å…¨ã€‚</li><li>å¦‚æœç‰¹åˆ«éœ€è¦ Lock çš„ç‰¹æ®ŠåŠŸèƒ½ï¼Œæ¯”å¦‚å°è¯•è·å–é”ã€å¯ä¸­æ–­ã€è¶…æ—¶åŠŸèƒ½ç­‰ï¼Œæ‰ä½¿ç”¨ Lockã€‚</li></ol><p><a href="https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/Java%20%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b%2078%20%e8%ae%b2-%e5%ae%8c/23%20Lock%20%e6%9c%89%e5%93%aa%e5%87%a0%e4%b8%aa%e5%b8%b8%e7%94%a8%e6%96%b9%e6%b3%95%ef%bc%9f%e5%88%86%e5%88%ab%e6%9c%89%e4%bb%80%e4%b9%88%e7%94%a8%ef%bc%9f.md">https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/Java%20%e5%b9%b6%e5%8f%91%e7%bc%96%e7%a8%8b%2078%20%e8%ae%b2-%e5%ae%8c/23%20Lock%20%e6%9c%89%e5%93%aa%e5%87%a0%e4%b8%aa%e5%b8%b8%e7%94%a8%e6%96%b9%e6%b3%95%ef%bc%9f%e5%88%86%e5%88%ab%e6%9c%89%e4%bb%80%e4%b9%88%e7%94%a8%ef%bc%9f.md</a></p><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><p><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Java%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%2078%20%E8%AE%B2-%E5%AE%8C/">https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Java%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%2078%20%E8%AE%B2-%E5%AE%8C/</a></p></li><li><p><a href="https://juejin.cn/post/6896278031317663751">https://juejin.cn/post/6896278031317663751</a></p></li><li><p><a href="https://javadoop.com/post/AbstractQueuedSynchronizer-2">https://javadoop.com/post/AbstractQueuedSynchronizer-2</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¹¶å‘ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLé«˜å¯ç”¨</title>
      <link href="/2023/09/09/MySQL%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
      <url>/2023/09/09/MySQL%E9%AB%98%E5%8F%AF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="MySQLé«˜å¯ç”¨ï¼š"><a href="#MySQLé«˜å¯ç”¨ï¼š" class="headerlink" title="MySQLé«˜å¯ç”¨ï¼š"></a>MySQLé«˜å¯ç”¨ï¼š</h1><h3 id="è¯»å†™åˆ†ç¦»ï¼š"><a href="#è¯»å†™åˆ†ç¦»ï¼š" class="headerlink" title="è¯»å†™åˆ†ç¦»ï¼š"></a>è¯»å†™åˆ†ç¦»ï¼š</h3><p>â€‹<u>åœ¨<strong>è¯»å¤šå†™å°‘</strong>çš„æƒ…æ™¯ä¸‹ï¼Œç»™æ•°æ®åº“æ·»åŠ ç¼“å­˜å¾€å¾€ä¸èƒ½èµ·åˆ°å¾ˆå¥½çš„æ•ˆæœï¼šå› ä¸ºåœ¨å¤§é‡çš„è¯»è¯·æ±‚ä¸‹ï¼Œç¼“å­˜çš„å‘½ä¸­ç‡ä¸é«˜ï¼Œå¾ˆå¤šè¯·æ±‚ä¼š <strong>ç©¿é€</strong> ç¼“å­˜ï¼Œæœ€ç»ˆæ‰“åˆ°æ•°æ®åº“ä¸Šã€‚</u></p><p>â€‹æ¯”å¦‚åœ¨â€œè®¢å•ä¸­å¿ƒâ€è¿™æ ·çš„åœºæ™¯ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·çš„è®¢å•éƒ½ä¸åŒï¼Œé™¤éå…¨é‡ç¼“å­˜æ•°æ®åº“è®¢å•ä¿¡æ¯ï¼ˆåˆä¼šå¸¦æ¥æ¶æ„çš„å¤æ‚åº¦ï¼‰ï¼Œä¸ç„¶ç¼“å­˜çš„å‘½ä¸­ç‡ä¾æ—§å¾ˆä½ã€‚</p><h4 id="MySQL-ä¸»ä»å¤åˆ¶çš„åŸç†ï¼š"><a href="#MySQL-ä¸»ä»å¤åˆ¶çš„åŸç†ï¼š" class="headerlink" title="MySQL ä¸»ä»å¤åˆ¶çš„åŸç†ï¼š"></a>MySQL ä¸»ä»å¤åˆ¶çš„åŸç†ï¼š</h4><p>â€‹å°†mysqlæ‹†åˆ†æˆä¸»åº“ã€ä»åº“ï¼Œé€šè¿‡ä¸»ä»å¤åˆ¶å®ç°æ•°æ®åŒæ­¥ã€‚</p><h5 id="ä¸‰ä¸ªæ­¥éª¤ï¼š"><a href="#ä¸‰ä¸ªæ­¥éª¤ï¼š" class="headerlink" title="ä¸‰ä¸ªæ­¥éª¤ï¼š"></a>ä¸‰ä¸ªæ­¥éª¤ï¼š</h5><ul><li><strong>å†™å…¥ Binlog</strong>ï¼šä¸»åº“å†™ binlog æ—¥å¿—ï¼Œæäº¤äº‹åŠ¡ï¼Œå¹¶æ›´æ–°æœ¬åœ°å­˜å‚¨æ•°æ®ã€‚<ul><li>MySQL ä¸»åº“åœ¨æ”¶åˆ°å®¢æˆ·ç«¯æäº¤äº‹åŠ¡çš„è¯·æ±‚ä¹‹åï¼Œä¼šå…ˆå†™å…¥ binlogï¼Œå†æäº¤äº‹åŠ¡ï¼Œæ›´æ–°å­˜å‚¨å¼•æ“ä¸­çš„æ•°æ®ï¼Œäº‹åŠ¡æäº¤å®Œæˆåï¼Œè¿”å›ç»™å®¢æˆ·ç«¯â€œæ“ä½œæˆåŠŸâ€çš„å“åº”ã€‚</li></ul></li><li><strong>åŒæ­¥ Binlog</strong>ï¼šæŠŠ binlog å¤åˆ¶åˆ°æ‰€æœ‰ä»åº“ä¸Šï¼Œæ¯ä¸ªä»åº“æŠŠ binlog å†™åˆ°æš‚å­˜æ—¥å¿—ä¸­ã€‚<ul><li>ä»åº“ä¼šåˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ I&#x2F;O çº¿ç¨‹ï¼Œè¿æ¥ä¸»åº“çš„ log dump çº¿ç¨‹ï¼Œæ¥æ¥æ”¶ä¸»åº“çš„ binlog æ—¥å¿—ï¼Œå†æŠŠ binlog ä¿¡æ¯å†™å…¥ relay log çš„ä¸­ç»§æ—¥å¿—é‡Œï¼Œå†è¿”å›ç»™ä¸»åº“â€œå¤åˆ¶æˆåŠŸâ€çš„å“åº”ã€‚</li></ul></li><li><strong>å›æ”¾ Binlog</strong>ï¼šå›æ”¾ binlogï¼Œå¹¶æ›´æ–°å­˜å‚¨æ•°æ®ã€‚<ul><li>ä»åº“ä¼šåˆ›å»ºä¸€ä¸ªç”¨äºå›æ”¾ binlog çš„çº¿ç¨‹ï¼Œå»è¯» relay log ä¸­ç»§æ—¥å¿—ï¼Œç„¶åå›æ”¾ binlog æ›´æ–°å­˜å‚¨å¼•æ“ä¸­çš„æ•°æ®ï¼Œæœ€ç»ˆå®ç°ä¸»ä»çš„æ•°æ®ä¸€è‡´æ€§ã€‚</li></ul></li></ul><p>âš ï¸å½“ç„¶ï¼Œ<strong>ä»åº“è¿‡å¤šä¹Ÿä¸æ˜¯ä¸€å‘³çš„å¥½</strong>ï¼Œå› ä¸ºä¸»åº“å°† binlog ä¼ è¾“åˆ°æ¯ä¸€ä¸ªä»åº“æ—¶éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ª log dump çº¿ç¨‹æ¥å¤„ç†å¤åˆ¶çš„è¯·æ±‚ï¼Œä»åº“è¿‡å¤šä¼šå¯¼è‡´ä¸»åº“çš„èµ„æºæ¶ˆè€—å¢åŠ ï¼Œå¹¶ä¸”ä¹Ÿä¼šå—é™äºä¸»åº“çš„å¸¦å®½è€Œå‡æ…¢ä¼ è¾“é€Ÿåº¦ã€‚</p><h4 id="MySQL-ä¸»ä»å¤åˆ¶è¿˜æœ‰å“ªäº›æ¨¡å‹ï¼Ÿ"><a href="#MySQL-ä¸»ä»å¤åˆ¶è¿˜æœ‰å“ªäº›æ¨¡å‹ï¼Ÿ" class="headerlink" title="MySQL ä¸»ä»å¤åˆ¶è¿˜æœ‰å“ªäº›æ¨¡å‹ï¼Ÿ"></a>MySQL ä¸»ä»å¤åˆ¶è¿˜æœ‰å“ªäº›æ¨¡å‹ï¼Ÿ</h4><ul><li><strong>åŒæ­¥å¤åˆ¶</strong>ï¼šäº‹åŠ¡çº¿ç¨‹è¦ç­‰å¾…æ‰€æœ‰ä»åº“çš„å¤åˆ¶æˆåŠŸå“åº”ã€‚</li><li><strong>å¼‚æ­¥å¤åˆ¶</strong>ï¼šäº‹åŠ¡çº¿ç¨‹å®Œå…¨ä¸ç­‰å¾…ä»åº“çš„å¤åˆ¶æˆåŠŸå“åº”ã€‚</li><li><strong>åŠåŒæ­¥å¤åˆ¶</strong>ï¼šMySQL 5.7 ç‰ˆæœ¬ä¹‹åå¢åŠ çš„ä¸€ç§å¤åˆ¶æ–¹å¼ï¼Œä»‹äºä¸¤è€…ä¹‹é—´ï¼Œäº‹åŠ¡çº¿ç¨‹ä¸ç”¨ç­‰å¾…æ‰€æœ‰çš„ä»åº“å¤åˆ¶æˆåŠŸå“åº”ï¼Œåªè¦ä¸€éƒ¨åˆ†å¤åˆ¶æˆåŠŸå“åº”å›æ¥å°±è¡Œï¼Œæ¯”å¦‚ä¸€ä¸»äºŒä»çš„é›†ç¾¤ï¼Œåªè¦æ•°æ®æˆåŠŸå¤åˆ¶åˆ°ä»»æ„ä¸€ä¸ªä»åº“ä¸Šï¼Œä¸»åº“çš„äº‹åŠ¡çº¿ç¨‹å°±å¯ä»¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ul><h4 id="åœ¨ç³»ç»Ÿè®¾è®¡ä¸Šæœ‰å“ªäº›æ–¹æ¡ˆå¯ä»¥è§£å†³ä¸»ä»å¤åˆ¶çš„å»¶è¿Ÿé—®é¢˜ï¼Ÿ"><a href="#åœ¨ç³»ç»Ÿè®¾è®¡ä¸Šæœ‰å“ªäº›æ–¹æ¡ˆå¯ä»¥è§£å†³ä¸»ä»å¤åˆ¶çš„å»¶è¿Ÿé—®é¢˜ï¼Ÿ" class="headerlink" title="åœ¨ç³»ç»Ÿè®¾è®¡ä¸Šæœ‰å“ªäº›æ–¹æ¡ˆå¯ä»¥è§£å†³ä¸»ä»å¤åˆ¶çš„å»¶è¿Ÿé—®é¢˜ï¼Ÿ"></a>åœ¨ç³»ç»Ÿè®¾è®¡ä¸Šæœ‰å“ªäº›æ–¹æ¡ˆå¯ä»¥è§£å†³ä¸»ä»å¤åˆ¶çš„å»¶è¿Ÿé—®é¢˜ï¼Ÿ</h4><h5 id="1-ä½¿ç”¨æ•°æ®å†—ä½™ï¼š"><a href="#1-ä½¿ç”¨æ•°æ®å†—ä½™ï¼š" class="headerlink" title="1.ä½¿ç”¨æ•°æ®å†—ä½™ï¼š"></a>1.ä½¿ç”¨æ•°æ®å†—ä½™ï¼š</h5><p>â€‹å¯¹äºåˆšæ›´æ–°å®Œä¸»åº“åçš„æ•°æ®çš„æŸ¥è¯¢ï¼Œä¸»åº“ç›´æ¥è‡ªå·±å‘ä¸€æ¡åŒ…å«æ›´æ–°ä¿¡æ¯çš„æ•°æ®ç»™ä¸šåŠ¡ç«¯ï¼Œè¿™æ ·å°±ä¸éœ€è¦æŸ¥è¯¢ä»åº“äº†ã€‚</p><h5 id="2-ä½¿ç”¨ç¼“å­˜è§£å†³ï¼š"><a href="#2-ä½¿ç”¨ç¼“å­˜è§£å†³ï¼š" class="headerlink" title="2.ä½¿ç”¨ç¼“å­˜è§£å†³ï¼š"></a>2.ä½¿ç”¨ç¼“å­˜è§£å†³ï¼š</h5><p>â€‹ä¸»åº“åˆšæ›´æ–°çš„åŒæ—¶å°†æ•°æ®å†™å…¥redisç¼“å­˜ä¸­</p><p><u>ä»¥ä¸Šä¸¤ç§æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ(Aæƒ³æ›´ï¼ŒBæƒ³æ›´ï¼ŒBæ›´æ–°ï¼ŒAæ›´æ–°)ï¼Œéœ€è¦<strong>åˆ†å¸ƒå¼é”</strong>çš„ååŠ©</u></p><h5 id="3-ç›´æ¥æŸ¥è¯¢ä¸»åº“ï¼š"><a href="#3-ç›´æ¥æŸ¥è¯¢ä¸»åº“ï¼š" class="headerlink" title="3.ç›´æ¥æŸ¥è¯¢ä¸»åº“ï¼š"></a>3.ç›´æ¥æŸ¥è¯¢ä¸»åº“ï¼š</h5><p>â€‹è¯¥æ–¹æ¡ˆåœ¨ä½¿ç”¨æ—¶ä¸€å®šè¦è°¨æ…ï¼Œä½ è¦æå‰æ˜ç¡®æŸ¥è¯¢çš„æ•°æ®é‡ä¸å¤§ï¼Œä¸ç„¶ä¼šå‡ºç°ä¸»åº“å†™è¯·æ±‚é”è¡Œï¼Œå½±å“è¯»è¯·æ±‚çš„æ‰§è¡Œï¼Œæœ€ç»ˆå¯¹ä¸»åº“é€ æˆæ¯”è¾ƒå¤§çš„å‹åŠ›ã€‚</p><h3 id="åˆ†åº“åˆ†è¡¨ï¼š"><a href="#åˆ†åº“åˆ†è¡¨ï¼š" class="headerlink" title="åˆ†åº“åˆ†è¡¨ï¼š"></a>åˆ†åº“åˆ†è¡¨ï¼š</h3><p>â€‹åŸåˆ™ï¼šèƒ½ä¸åˆ†è¡¨åˆ†åº“å°±ä¸è¦åˆ†è¡¨åˆ†åº“ï¼Œè¿™æ˜¯æœ€åçš„æ‰‹æ®µï¼</p><h4 id="ğŸŒ³å‚ç›´åˆ’åˆ†ï¼š"><a href="#ğŸŒ³å‚ç›´åˆ’åˆ†ï¼š" class="headerlink" title="ğŸŒ³å‚ç›´åˆ’åˆ†ï¼š"></a>ğŸŒ³å‚ç›´åˆ’åˆ†ï¼š</h4><h5 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h5><ol><li>ä¸ºäº†é¿å… IO äº‰æŠ¢å¹¶å‡å°‘é”è¡¨çš„å‡ ç‡ï¼ŒæŸ¥çœ‹è¯¦æƒ…çš„ç”¨æˆ·ä¸å•†å“ä¿¡æ¯æµè§ˆäº’ä¸å½±å“</li><li>å……åˆ†å‘æŒ¥çƒ­é—¨æ•°æ®çš„æ“ä½œæ•ˆç‡ï¼Œå•†å“ä¿¡æ¯çš„æ“ä½œçš„é«˜æ•ˆç‡ä¸ä¼šè¢«å•†å“æè¿°çš„ä½æ•ˆç‡æ‰€æ‹–ç´¯</li></ol><h5 id="æ‹†åˆ†åŸåˆ™ï¼š"><a href="#æ‹†åˆ†åŸåˆ™ï¼š" class="headerlink" title="æ‹†åˆ†åŸåˆ™ï¼š"></a>æ‹†åˆ†åŸåˆ™ï¼š</h5><ol><li>æŠŠä¸å¸¸ç”¨çš„å­—æ®µå•ç‹¬æ”¾åœ¨ä¸€å¼ è¡¨</li><li>æŠŠtextï¼Œblobç­‰å¤§å­—æ®µæ‹†åˆ†å‡ºæ¥æ”¾åœ¨é™„è¡¨ä¸­</li><li>ç»å¸¸ç»„åˆæŸ¥è¯¢çš„åˆ—æ”¾åœ¨ä¸€å¼ è¡¨ä¸­</li></ol><p>â€‹<u>å°†ä¸€å¼ è¡¨çš„æ•°æ®ï¼Œæ ¹æ®åœºæ™¯åˆ‡åˆ†æˆå¤šå¼ è¡¨ï¼Œæœ¬è´¨æ˜¯ç”±äºå‰æœŸæŠ½è±¡ä¸è¶³ï¼Œéœ€è¦å°†ä¸šåŠ¡æ•°æ®è¿›ä¸€æ­¥æ‹†åˆ†ã€‚</u></p><p>â€‹å¦‚æœä¸€å¼ è¡¨ä¸­ä¸€äº›è®°å½•ä¸ºçƒ­ç‚¹ï¼Œå¸¸è¢«è®¿é—®ï¼Œä½†æ˜¯ä¸€äº›æ•°æ®å¾ˆå°‘è¢«æŸ¥è¯¢ï¼Œå°±å¯ä»¥æ ¹æ®è®¿é—®é¢‘æ¬¡è¿›è¡Œå‚ç›´åˆ†è¡¨ã€‚</p><p>â€‹å¯ä»¥æŠŠä¸€äº›ä¸å¸¸ç”¨çš„åˆ—åˆ’åˆ†åˆ°æ–°è¡¨ä¸­ï¼Œå‡å°‘åŸè¡¨çš„å¤§å°ã€‚</p><h4 id="ğŸŒŠæ°´å¹³åˆ’åˆ†ï¼š"><a href="#ğŸŒŠæ°´å¹³åˆ’åˆ†ï¼š" class="headerlink" title="ğŸŒŠæ°´å¹³åˆ’åˆ†ï¼š"></a>ğŸŒŠæ°´å¹³åˆ’åˆ†ï¼š</h4><p>â€‹æ°´å¹³åˆ†è¡¨æœ¬è´¨æ˜¯<u>å°†ä¸€å¼ å¤§è¡¨æ‹†æˆå¤šä¸ªç»“æ„ç›¸åŒçš„å­è¡¨</u>ã€‚</p><p>åˆ†ç‰‡ç®—æ³•(è·¯ç”±è§„åˆ™)ï¼š</p><ul><li><p>èŒƒå›´åˆ†ç‰‡</p><ul><li>æ ¹æ®æ—¶é—´ã€æŸå…³é”®å­—çš„èŒƒå›´</li><li>ä»¥ä¸Šä¸¤ç§æ–¹å¼å®¹æ˜“äº§ç”Ÿçƒ­ç‚¹é—®é¢˜ï¼Œä½†æ˜¯æ‰©å±•æ—¶æ¯”è¾ƒæ–¹ä¾¿</li></ul></li><li><p>hashåˆ†ç‰‡</p><ul><li>hash(æœ€ç®€å•çš„ï¼Œå¯ä»¥å¯¹åˆ†ç‰‡æ•°è¿›è¡Œå–ä½™)</li><li><strong>å“ˆå¸Œå–æ¨¡çš„è·¯ç”±æ–¹å¼èƒ½å¤Ÿä½¿æ•°æ®è®¿é—®å‡åŒ€ï¼Œä½†æ˜¯ä¸ä¾¿äºæ‰©å±•(å› ä¸ºæ”¹äº†hashå‡½æ•°ï¼Œé‚£ä¹ˆæ¯ä¸ªåº“é‡Œçš„æ•°æ®å¯èƒ½éœ€è¦ç§»åŠ¨)</strong></li></ul></li><li><p>æŸ¥è¡¨æ³•(è‡ªå®šä¹‰)</p><ul><li>æŸ¥è¡¨åˆ™æ˜¯äººä¸ºåœ°æ„å»ºæ¯æ¡è®°å½•ä¸åˆ†ç‰‡çš„æ˜ å°„å…³ç³»</li></ul></li><li><p>ğŸŒŸhashå–æ¨¡ + èŒƒå›´</p><ul><li>å…ˆæ ¹æ®å­—æ®µçš„hashå€¼ç¡®å®šè¯¥è®°å½•åœ¨å“ªä¸ªæ•°æ®åº“ä¸­ï¼Œåœ¨æ¯ä¸ªæ•°æ®åº“ä¸­å†æ ¹æ®idçš„èŒƒå›´è¿›è¡Œåˆ†è¡¨</li><li><u>è¿™ç§æ–¹å¼é¿å…äº†å•çº¯åŸºäºæ•°æ®èŒƒå›´å¯èƒ½å‡ºç°çš„çƒ­ç‚¹å­˜å‚¨ï¼Œå¹¶ä¸”åœ¨åæœŸæ‰©å±•æ—¶ï¼Œå¯ä»¥ç›´æ¥å¢åŠ å¯¹åº”çš„æ‰©å±•è¡¨ï¼Œé¿å…äº†å¤æ‚çš„æ•°æ®è¿ç§»å·¥ä½œã€‚</u></li></ul></li></ul><h5 id="æ ¹æ®å…³é”®å­—åˆ’åˆ†ï¼š"><a href="#æ ¹æ®å…³é”®å­—åˆ’åˆ†ï¼š" class="headerlink" title="æ ¹æ®å…³é”®å­—åˆ’åˆ†ï¼š"></a>æ ¹æ®å…³é”®å­—åˆ’åˆ†ï¼š</h5><p>â€‹æŸå…³é”®å­—åˆ—ç›¸åŒçš„è®°å½•è¢«æ”¾åœ¨åŒä¸€è¡¨ä¸­</p><h6 id="ä¾‹å­ğŸŒ°ï¼š"><a href="#ä¾‹å­ğŸŒ°ï¼š" class="headerlink" title="ä¾‹å­ğŸŒ°ï¼š"></a>ä¾‹å­ğŸŒ°ï¼š</h6><p>â€‹user_scoreè¡¨å¯ä»¥ç”¨user_idè¿™ä¸ªå…³é”®å­—æ¥åˆ†è¡¨çš„ï¼šä½¿ç”¨user_id mod 10ï¼Œå³å¯æŠŠuser_scoreè¡¨åˆ†ä¸º10ä¸ªå°è¡¨ï¼Œå°è¡¨çš„åå­—ä¸ºuser_score_{user_id%10} è¿™ç§å½¢å¼ã€‚</p><h6 id="ä¼˜ç‚¹ï¼š-1"><a href="#ä¼˜ç‚¹ï¼š-1" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h6><p>â€‹è¿™ç§æ–¹æ¡ˆ<u>é€‚ç”¨äºæŒ‰å…³é”®å­—æŸ¥è¯¢é¢‘ç¹çš„åœºæ™¯</u>ï¼Œå…³é”®å­—ç›¸åŒçš„æ•°æ®ï¼Œå¿…é¡»è½åœ¨åŒå¼ è¡¨ï¼Œä¸ç„¶è¦æ˜¯æœ‰åˆ—è¡¨åˆ†é¡µæŸ¥è¯¢ï¼Œå°±ä¼šå¾ˆéº»çƒ¦ã€‚</p><h6 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h6><p>â€‹ä¸è¶³ä¹‹å¤„åœ¨äºï¼Œ**<u>å¯èƒ½æœ‰æ¯”è¾ƒå¤šçš„å¤§å®¢æˆ·è½åœ¨åŒä¸€å¼ è¡¨ï¼Œåˆ†è¡¨æ•°æ®ä¸å‡åŒ€</u>**ã€‚å‡è®¾åœ¨æˆ‘ä»¬çš„åœºæ™¯ï¼Œæ”¯æŒä»£ç†æœºæ„æ³¨å†Œä¸€ä¸ªç”¨æˆ·idï¼Œå¤šä¸ªå­¦ç”Ÿå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç”¨æˆ·idå‚åŠ è€ƒè¯•ï¼Œé‚£ä¹ˆæŸä¸ªç”¨æˆ·çš„æ•°æ®é‡æœ‰å¯èƒ½éå¸¸å¤§ã€‚</p><h5 id="æ ¹æ®å¤§å°åˆ’åˆ†ï¼š"><a href="#æ ¹æ®å¤§å°åˆ’åˆ†ï¼š" class="headerlink" title="æ ¹æ®å¤§å°åˆ’åˆ†ï¼š"></a>æ ¹æ®å¤§å°åˆ’åˆ†ï¼š</h5><p>â€‹æ¯”å¦‚æ¯200wè®°å½•ï¼Œå°±è‡ªåŠ¨ç”Ÿæˆä¸€å¼ æ–°è¡¨ã€‚</p><h6 id="ä¼˜ç‚¹ï¼š-2"><a href="#ä¼˜ç‚¹ï¼š-2" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h6><p>â€‹å¤§å°å‡åŒ€ï¼Œæ€§èƒ½å¯æ§ã€‚è¿™é‡Œå»ºè®®æ¯ä¸ªåˆ†è¡¨ä¸è¶…è¿‡500ä¸‡è¡Œæ•°æ®ï¼Œè¿™æ ·å¯¹æ•°æ®åº“é€ æˆçš„å‹åŠ›ä¸ä¼šå¤ªå¤§ï¼›é€‚ç”¨äºæµæ°´è®°è´¦ç­‰åœºæ™¯ã€‚</p><h6 id="ç¼ºç‚¹ï¼š-1"><a href="#ç¼ºç‚¹ï¼š-1" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h6><p>â€‹å¦‚æœæŸ¥è¯¢çš„åœºæ™¯ä¸æŸä¸ªå…³é”®å­—æœ‰å…³ï¼Œé‚£ä¹ˆæœ¬æ–¹æ¡ˆå°±æœ‰æ¯”è¾ƒå¤§çš„å±€é™æ€§ï¼Œä¸çŸ¥é“å…³é”®å­— &#x3D; xxxçš„è®°å½•æ¨ªè·¨äº†å¤šå°‘è¡¨ã€‚</p><h5 id="æ ¹æ®æ—¶é—´åˆ’åˆ†ï¼š"><a href="#æ ¹æ®æ—¶é—´åˆ’åˆ†ï¼š" class="headerlink" title="æ ¹æ®æ—¶é—´åˆ’åˆ†ï¼š"></a>æ ¹æ®æ—¶é—´åˆ’åˆ†ï¼š</h5><p>â€‹è¿™ç§æ–¹æ¡ˆé€‚ç”¨äºæ•°æ®å’Œæ—¶é—´æˆå…³è”ï¼Œçƒ­åº¦ä¹Ÿè·Ÿæ—¶é—´æˆå…³è”çš„åœºæ™¯ã€‚</p><h6 id="ä¼˜ç‚¹ï¼š-3"><a href="#ä¼˜ç‚¹ï¼š-3" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h6><p>â€‹æ€è·¯ç®€å•ï¼Œä¸”å¾ˆå®¹æ˜“æ¸…ç†æ‰æ—§æ•°æ®ï¼Œæ•´ä¸ªè¡¨èƒ½è‡ªåŠ¨å˜å†·ã€‚</p><h6 id="ç¼ºç‚¹ï¼š-2"><a href="#ç¼ºç‚¹ï¼š-2" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h6><p>â€‹ç¼ºç‚¹åœ¨äºä¸šåŠ¡åˆæœŸï¼Œå¯¹ä¸šåŠ¡é‡çš„é¢„ä¼°ï¼Œä¼šå­˜åœ¨éš¾åº¦ï¼šå¯èƒ½ä¸€å¼€å§‹æœˆè¡¨ç»°ç»°æœ‰ä½™ï¼ŒåæœŸéšç€ä¸šåŠ¡é‡çªé£çŒ›è¿›ï¼Œä¸€ä¸ªæœˆéƒ½æœ‰åƒä¸‡æ¡ç”šè‡³ä¸Šäº¿æ¡æ•°æ®ï¼Œæ­¤æ—¶åˆå¾—è¿›è¡Œæ‹†åˆ†ã€‚å¦å¤–ï¼Œç”¨è¯¥æ–¹æ¡ˆæ—¶ä¸€å®šè¦æ³¨æ„æ—¶é—´åˆ†å‰²çš„èŠ‚ç‚¹ï¼Œä¼šä¸ä¼šé€ æˆæœ‰ç›¸å…³è”çš„æ•°æ®å‡ºç°ä¸ä¸€è‡´ã€‚</p><h4 id="å°ç»“ï¼š"><a href="#å°ç»“ï¼š" class="headerlink" title="å°ç»“ï¼š"></a>å°ç»“ï¼š</h4><h5 id="å„ç§æ–¹å¼çš„ç‰¹ç‚¹ï¼š"><a href="#å„ç§æ–¹å¼çš„ç‰¹ç‚¹ï¼š" class="headerlink" title="å„ç§æ–¹å¼çš„ç‰¹ç‚¹ï¼š"></a>å„ç§æ–¹å¼çš„ç‰¹ç‚¹ï¼š</h5><ul><li><strong>å‚ç›´åˆ†è¡¨ï¼š</strong> å¯ä»¥æŠŠä¸€ä¸ªå®½è¡¨çš„å­—æ®µæŒ‰<u>è®¿é—®é¢‘æ¬¡</u>ã€<u>æ˜¯å¦æ˜¯å¤§å­—æ®µ</u>çš„åŸåˆ™æ‹†åˆ†ä¸ºå¤šä¸ªè¡¨ï¼Œè¿™æ ·æ—¢èƒ½ä½¿ä¸šåŠ¡æ¸…æ™°ï¼Œè¿˜èƒ½æå‡éƒ¨åˆ†æ€§èƒ½ã€‚æ‹†åˆ†åï¼Œå°½é‡ä»ä¸šåŠ¡è§’åº¦é¿å…è”æŸ¥ï¼Œå¦åˆ™æ€§èƒ½æ–¹é¢å°†å¾—ä¸å¿å¤±ã€‚</li><li><strong>å‚ç›´åˆ†åº“ï¼š</strong> å¯ä»¥æŠŠå¤šä¸ªè¡¨<u>æŒ‰ä¸šåŠ¡è€¦åˆæ¾ç´§å½’ç±»</u>ï¼Œåˆ†åˆ«å­˜æ”¾åœ¨ä¸åŒçš„åº“ï¼Œè¿™äº›åº“å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒæœåŠ¡å™¨ï¼Œä»è€Œä½¿è®¿é—®å‹åŠ›è¢«å¤šæœåŠ¡å™¨è´Ÿè½½ï¼Œå¤§å¤§æå‡æ€§èƒ½ï¼ŒåŒæ—¶èƒ½<strong>æé«˜æ•´ä½“æ¶æ„çš„ä¸šåŠ¡æ¸…æ™°åº¦</strong>ï¼Œä¸åŒçš„ä¸šåŠ¡åº“å¯æ ¹æ®è‡ªèº«æƒ…å†µå®šåˆ¶ä¼˜åŒ–æ–¹æ¡ˆã€‚ä½†æ˜¯å®ƒéœ€è¦è§£å†³è·¨åº“å¸¦æ¥çš„æ‰€æœ‰å¤æ‚é—®é¢˜ã€‚</li><li><strong>æ°´å¹³åˆ†åº“ï¼š</strong> å¯ä»¥æŠŠä¸€ä¸ªè¡¨çš„æ•°æ®(æŒ‰æ•°æ®è¡Œ)åˆ†åˆ°å¤šä¸ªä¸åŒçš„åº“ï¼Œæ¯ä¸ªåº“åªæœ‰è¿™ä¸ªè¡¨çš„éƒ¨åˆ†æ•°æ®ï¼Œè¿™äº›åº“å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒæœåŠ¡å™¨ï¼Œä»è€Œä½¿è®¿é—®å‹åŠ›è¢«å¤šæœåŠ¡å™¨è´Ÿè½½ï¼Œå¤§å¤§æå‡æ€§èƒ½ã€‚å®ƒä¸ä»…éœ€è¦è§£å†³è·¨åº“å¸¦æ¥çš„æ‰€æœ‰å¤æ‚é—®é¢˜ï¼Œè¿˜è¦è§£å†³æ•°æ®è·¯ç”±çš„é—®é¢˜ã€‚</li><li><strong>æ°´å¹³åˆ†è¡¨ï¼š</strong> å¯ä»¥æŠŠä¸€ä¸ªè¡¨çš„æ•°æ®(æŒ‰æ•°æ®è¡Œ)åˆ†åˆ°å¤šä¸ªåŒä¸€ä¸ªæ•°æ®åº“çš„å¤šå¼ è¡¨ä¸­ï¼Œæ¯ä¸ªè¡¨åªæœ‰è¿™ä¸ªè¡¨çš„éƒ¨åˆ†æ•°æ®ï¼Œè¿™æ ·åšèƒ½å°å¹…æå‡æ€§èƒ½ï¼Œå®ƒä»…ä»…ä½œä¸ºæ°´å¹³åˆ†åº“çš„ä¸€ä¸ªè¡¥å……ä¼˜åŒ–ã€‚</li></ul><p>â€‹</p><h5 id="ğŸŒŸé€šè¿‡åˆ†åº“ã€åˆ†è¡¨çš„æ ¹æºæ¥åˆ†æä½•æ—¶åˆ†åº“ã€ä½•æ—¶åˆ†è¡¨ï¼š"><a href="#ğŸŒŸé€šè¿‡åˆ†åº“ã€åˆ†è¡¨çš„æ ¹æºæ¥åˆ†æä½•æ—¶åˆ†åº“ã€ä½•æ—¶åˆ†è¡¨ï¼š" class="headerlink" title="ğŸŒŸé€šè¿‡åˆ†åº“ã€åˆ†è¡¨çš„æ ¹æºæ¥åˆ†æä½•æ—¶åˆ†åº“ã€ä½•æ—¶åˆ†è¡¨ï¼š"></a>ğŸŒŸé€šè¿‡åˆ†åº“ã€åˆ†è¡¨çš„æ ¹æºæ¥åˆ†æä½•æ—¶åˆ†åº“ã€ä½•æ—¶åˆ†è¡¨ï¼š</h5><h6 id="ç¬¬ä¸€ï¼Œæ˜¯æ•°æ®é‡å¤ªå¤§æŸ¥è¯¢æ…¢çš„é—®é¢˜ã€‚"><a href="#ç¬¬ä¸€ï¼Œæ˜¯æ•°æ®é‡å¤ªå¤§æŸ¥è¯¢æ…¢çš„é—®é¢˜ã€‚" class="headerlink" title="ç¬¬ä¸€ï¼Œæ˜¯æ•°æ®é‡å¤ªå¤§æŸ¥è¯¢æ…¢çš„é—®é¢˜ã€‚"></a>ç¬¬ä¸€ï¼Œæ˜¯<u>æ•°æ®é‡å¤ªå¤§</u>æŸ¥è¯¢æ…¢çš„é—®é¢˜ã€‚</h6><p>â€‹å› ä¸ºMySQLåœ¨æ‰§è¡Œäº‹åŠ¡æ—¶éœ€è¦å¯¹è¡¨è¿›è¡Œé”å®šï¼Œä»¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚ç„¶è€Œï¼Œå½“æ•°æ®é‡è¿‡å¤§æ—¶ï¼Œé”å®šæ•´ä¸ªè¡¨å¯èƒ½ä¼šå¯¼è‡´äº‹åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œä»è€Œé™ä½ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚</p><p>â€‹<strong>è§£å†³æŸ¥è¯¢æ…¢ï¼Œåªè¦å‡å°‘æ¯æ¬¡æŸ¥è¯¢çš„æ•°æ®æ€»é‡å°±å¯ä»¥äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ†è¡¨å°±å¯ä»¥è§£å†³é—®é¢˜</strong>ã€‚(<u>å°†ç»“æœunionå³å¯</u>)</p><h6 id="ç¬¬äºŒï¼Œæ˜¯ä¸ºäº†åº”å¯¹é«˜å¹¶å‘çš„é—®é¢˜ã€‚-å†™å¤šè¯»å°‘çš„æƒ…å†µ"><a href="#ç¬¬äºŒï¼Œæ˜¯ä¸ºäº†åº”å¯¹é«˜å¹¶å‘çš„é—®é¢˜ã€‚-å†™å¤šè¯»å°‘çš„æƒ…å†µ" class="headerlink" title="ç¬¬äºŒï¼Œæ˜¯ä¸ºäº†åº”å¯¹é«˜å¹¶å‘çš„é—®é¢˜ã€‚(å†™å¤šè¯»å°‘çš„æƒ…å†µ)"></a>ç¬¬äºŒï¼Œæ˜¯ä¸ºäº†<u>åº”å¯¹é«˜å¹¶å‘</u>çš„é—®é¢˜ã€‚(å†™å¤šè¯»å°‘çš„æƒ…å†µ)</h6><p>â€‹åº”å¯¹é«˜å¹¶å‘çš„æ€æƒ³æˆ‘ä»¬ä¹‹å‰ä¹Ÿè¯´è¿‡ï¼Œä¸€ä¸ªæ•°æ®åº“å®ä¾‹æ’‘ä¸ä½ï¼Œå°±æŠŠå¹¶å‘è¯·æ±‚åˆ†æ•£åˆ°å¤šä¸ªå®ä¾‹ä¸­å»ï¼Œæ‰€ä»¥ï¼Œ<strong>è§£å†³é«˜å¹¶å‘çš„é—®é¢˜æ˜¯éœ€è¦åˆ†åº“çš„</strong>ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼š<strong>æ•°æ®é‡å¤§ï¼Œå°±åˆ†è¡¨ï¼›å¹¶å‘é«˜ï¼Œå°±åˆ†åº“</strong>ã€‚</p><h5 id="åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„é—®é¢˜ï¼š"><a href="#åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„é—®é¢˜ï¼š" class="headerlink" title="åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„é—®é¢˜ï¼š"></a>åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„é—®é¢˜ï¼š</h5><h6 id="1-åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"><a href="#1-åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜" class="headerlink" title="1 åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"></a>1 åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</h6><p>â€‹ç”±äºåˆ†åº“åˆ†è¡¨æŠŠæ•°æ®åˆ†å¸ƒåœ¨ä¸åŒåº“ç”šè‡³ä¸åŒæœåŠ¡å™¨ï¼Œä¸å¯é¿å…ä¼šå¸¦æ¥**<u>åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</u>**ã€‚</p><h6 id="2-è·¨èŠ‚ç‚¹-JOIN-æŸ¥è¯¢é—®é¢˜"><a href="#2-è·¨èŠ‚ç‚¹-JOIN-æŸ¥è¯¢é—®é¢˜" class="headerlink" title="2 è·¨èŠ‚ç‚¹ JOIN æŸ¥è¯¢é—®é¢˜"></a>2 è·¨èŠ‚ç‚¹ JOIN æŸ¥è¯¢é—®é¢˜</h6><p>â€‹å¦‚æœä¸šåŠ¡æ•°æ®æŸ¥è¯¢çš„ SQL å­˜åœ¨å¤šè¡¨å…³è”æŸ¥è¯¢ï¼Œåœ¨åˆ†åº“åˆ†è¡¨æƒ…å†µä¸‹ï¼ŒSQL æ— æ³•æ­£å¸¸æ‰§è¡Œã€‚æˆ‘ä»¬éœ€è¦è°ƒæ•´ SQLï¼šå…ˆæŸ¥è¯¢ä¸»è¡¨æ•°æ®ï¼Œå†é€šè¿‡ä¸»è¡¨æ•°æ® id æŸ¥è¯¢ä»è¡¨æ•°æ®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">solutionï¼š</span><br><span class="line">â€‹é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šå†—ä½™è¡¨æˆ–å†—ä½™å­—æ®µæ¥ä¼˜åŒ–è·¨åº“ JOIN æŸ¥è¯¢ã€‚å¯¹äºä¸€äº›åŸºç¡€è¡¨ï¼Œä¾‹å¦‚å•†å“ä¿¡æ¯è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸€ä¸ªè®¢å•åˆ†åº“ä¸­å¤åˆ¶ä¸€å¼ åŸºç¡€è¡¨ï¼Œé¿å…è·¨åº“ JOIN æŸ¥è¯¢ã€‚è€Œå¯¹äºä¸€ä¸¤ä¸ªå­—æ®µçš„æŸ¥è¯¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å°‘é‡å­—æ®µå†—ä½™åœ¨è¡¨ä¸­ï¼Œä»è€Œé¿å… JOIN æŸ¥è¯¢ï¼Œä¹Ÿå°±é¿å…äº†è·¨åº“ JOIN æŸ¥è¯¢ã€‚</span><br></pre></td></tr></table></figure><h6 id="3-è·¨èŠ‚ç‚¹åˆ†é¡µã€æ’åºå‡½æ•°"><a href="#3-è·¨èŠ‚ç‚¹åˆ†é¡µã€æ’åºå‡½æ•°" class="headerlink" title="3 è·¨èŠ‚ç‚¹åˆ†é¡µã€æ’åºå‡½æ•°"></a>3 è·¨èŠ‚ç‚¹åˆ†é¡µã€æ’åºå‡½æ•°</h6><p>â€‹è·¨èŠ‚ç‚¹å¤šåº“è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œ<strong>limit</strong> åˆ†é¡µã€<strong>order by</strong> æ’åºç­‰é—®é¢˜ï¼Œå°±å˜å¾—æ¯”è¾ƒå¤æ‚äº†ã€‚éœ€è¦å…ˆåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸­å°†æ•°æ®è¿›è¡Œæ’åºå¹¶è¿”å›ï¼Œç„¶åå°†ä¸åŒèŠ‚ç‚¹è¿”å›çš„ç»“æœé›†è¿›è¡Œæ±‡æ€»å’Œå†æ¬¡æ’åºã€‚</p><h6 id="4-å…¨å±€ä¸»é”®-ID-é—®é¢˜"><a href="#4-å…¨å±€ä¸»é”®-ID-é—®é¢˜" class="headerlink" title="4 å…¨å±€ä¸»é”® ID é—®é¢˜"></a>4 å…¨å±€ä¸»é”® ID é—®é¢˜</h6><p>â€‹åœ¨åˆ†åº“åˆ†è¡¨ç¯å¢ƒä¸­ï¼Œç”±äºè¡¨ä¸­æ•°æ®åŒæ—¶ä¿å­˜åœ¨ä¸åŒæ•°æ®åº“ä¸­ï¼Œä¸»é”®å€¼å¹³æ—¶ä½¿ç”¨çš„è‡ªå¢é•¿å°†æ— ç”¨æ­¦ä¹‹åœ°ï¼ŒæŸä¸ªåˆ†åŒºæ•°æ®åº“ç”Ÿæˆçš„ ID æ— æ³•ä¿è¯å…¨å±€å”¯ä¸€ã€‚å› æ­¤éœ€è¦å•ç‹¬è®¾è®¡å…¨å±€ä¸»é”®ï¼Œä»¥é¿å…è·¨åº“ä¸»é”®é‡å¤é—®é¢˜ã€‚</p><h6 id="5-å…¬å…±è¡¨"><a href="#5-å…¬å…±è¡¨" class="headerlink" title="5 å…¬å…±è¡¨"></a>5 å…¬å…±è¡¨</h6><p>â€‹å‚æ•°è¡¨ã€æ•°æ®å­—å…¸è¡¨ç­‰éƒ½æ˜¯æ•°æ®é‡è¾ƒå°ï¼Œå˜åŠ¨å°‘çš„å…¬å…±è¡¨ï¼Œå±äºé«˜é¢‘è”åˆæŸ¥è¯¢çš„ä¾èµ–è¡¨ã€‚åˆ†åº“åˆ†è¡¨åï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ç±»è¡¨åœ¨æ¯ä¸ªæ•°æ®åº“éƒ½ä¿å­˜ä¸€ä»½ï¼Œæ‰€æœ‰å¯¹å…¬å…±è¡¨çš„æ›´æ–°æ“ä½œéƒ½åŒæ—¶å‘é€åˆ°æ‰€æœ‰åˆ†åº“æ‰§è¡Œã€‚</p><h6 id="6-æ‰©å®¹é—®é¢˜"><a href="#6-æ‰©å®¹é—®é¢˜" class="headerlink" title="6 æ‰©å®¹é—®é¢˜"></a>6 æ‰©å®¹é—®é¢˜</h6><p>â€‹éšç€ç”¨æˆ·çš„è®¢å•é‡å¢åŠ ï¼Œæ ¹æ®ç”¨æˆ· ID Hash å–æ¨¡çš„åˆ†è¡¨ä¸­ï¼Œæ•°æ®é‡ä¹Ÿåœ¨é€æ¸ç´¯ç§¯ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘åŠ¨æ€å¢åŠ è¡¨ï¼Œä¸€æ—¦åŠ¨æ€å¢åŠ è¡¨äº†ï¼Œå°±ä¼šæ¶‰åŠåˆ°æ•°æ®è¿ç§»é—®é¢˜ã€‚</p><p>â€‹æˆ‘ä»¬åœ¨æœ€å¼€å§‹è®¾è®¡è¡¨æ•°æ®é‡æ—¶ï¼Œå°½é‡ä½¿ç”¨ 2 çš„å€æ•°æ¥è®¾ç½®è¡¨æ•°é‡ã€‚å½“æˆ‘ä»¬éœ€è¦æ‰©å®¹æ—¶ï¼Œä¹ŸåŒæ ·æŒ‰ç…§ 2 çš„å€æ•°æ¥æ‰©å®¹ï¼Œè¿™ç§æ–¹å¼å¯ä»¥å‡å°‘æ•°æ®çš„è¿ç§»é‡ã€‚</p><h4 id="åˆ†è¡¨çš„å®ç°æ–¹æ¡ˆï¼š"><a href="#åˆ†è¡¨çš„å®ç°æ–¹æ¡ˆï¼š" class="headerlink" title="åˆ†è¡¨çš„å®ç°æ–¹æ¡ˆï¼š"></a>åˆ†è¡¨çš„å®ç°æ–¹æ¡ˆï¼š</h4><h5 id="å…¬å…±åŒ…å®ç°"><a href="#å…¬å…±åŒ…å®ç°" class="headerlink" title="å…¬å…±åŒ…å®ç°"></a>å…¬å…±åŒ…å®ç°</h5><p>â€‹æœ¬åœ°ä¾èµ–åŒ…ï¼Œå³å°†åˆ†è¡¨é€»è¾‘å†™åœ¨å…¬å…±çš„ä»£ç åº“é‡Œï¼Œæ¯ä¸ªéœ€è¦è°ƒç”¨æœåŠ¡çš„å®¢æˆ·æ–¹éƒ½é›†æˆè¯¥å…¬å…±åŒ…ï¼Œå°±æ¥å…¥äº†è‡ªåŠ¨åˆ†è¡¨çš„èƒ½åŠ›ã€‚</p><h5 id="ä¸­é—´ä»¶å®ç°"><a href="#ä¸­é—´ä»¶å®ç°" class="headerlink" title="ä¸­é—´ä»¶å®ç°"></a>ä¸­é—´ä»¶å®ç°</h5><p>â€‹å¯ä»¥æ˜¯æœåŠ¡çº§åˆ«çš„ä¸­é—´ä»¶ï¼Œæœ‰è‡ªå·±ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œé€šè¿‡è¯¥è¿›ç¨‹æ¥è°ƒç”¨æ•°æ®åº“ï¼Œè¿™æ ·åˆ†è¡¨é€»è¾‘å°±æ˜¯ä¸­å¿ƒåŒ–ï¼Œå®Œå…¨å¯æ§çš„ï¼Œä»£ç†æœåŠ¡å°±å±äºè¿™ç±»ã€‚å¦‚**<u>Mycatã€ShardingSphere</u>**</p><p>â€‹</p><h4 id="å¦‚ä½•é’ˆå¯¹ç°æœ‰è¡¨åšæ‹†åˆ†ï¼Œå³æ‰©å®¹ï¼š"><a href="#å¦‚ä½•é’ˆå¯¹ç°æœ‰è¡¨åšæ‹†åˆ†ï¼Œå³æ‰©å®¹ï¼š" class="headerlink" title="å¦‚ä½•é’ˆå¯¹ç°æœ‰è¡¨åšæ‹†åˆ†ï¼Œå³æ‰©å®¹ï¼š"></a>å¦‚ä½•é’ˆå¯¹ç°æœ‰è¡¨åšæ‹†åˆ†ï¼Œå³æ‰©å®¹ï¼š</h4><pre><code>1. åŒå†™è¯»è€é˜¶æ®µï¼šé€šè¿‡ä¸­é—´ä»¶ï¼Œå¯¹write sqlåŒæ—¶è¿›è¡Œä¸¤æ¬¡è½¬å‘ï¼Œä¹Ÿå°±æ˜¯åŒå†™ï¼Œä¿æŒæ–°æ•°æ®ä¸€è‡´ï¼ŒåŒæ—¶å¼€å§‹å†å²æ•°æ®æ‹·è´ã€‚æœ¬é˜¶æ®µå»ºè®®æ–½è¡Œä¸€å‘¨ï¼›1. åŒå†™åŒè¯»é˜¶æ®µï¼šé‡‡ç”¨ç°åº¦ç­–ç•¥ï¼Œä¸€éƒ¨åˆ†æµé‡è¯»è€è¡¨ï¼Œä¸€éƒ¨åˆ†æµé‡è¯»æ–°è¡¨ï¼Œè¯»æ–°è¡¨çš„éƒ¨åˆ†åœ¨ä¸€å¼€å§‹ï¼Œè¿˜å¯ä»¥åŒæ—¶å¤šè¯»ä¸€æ¬¡è€è¡¨æ•°æ®ï¼Œè¿›è¡Œæ¯”å¯¹æ£€æŸ¥ï¼Œè§‚å¯Ÿæ— è¯¯åï¼Œéšç€æ—¶é—´æ…¢æ…¢åˆ‡é‡åˆ°æ–°è¡¨ã€‚æœ¬é˜¶æ®µå»ºè®®æ–½è¡Œè‡³å°‘ä¸¤å‘¨ï¼›1. åŒå†™è¯»æ–°é˜¶æ®µï¼šæ­¤æ—¶åŸºæœ¬å·²ç»ç¨³å®šï¼Œå¯ä»¥åªè¯»æ–°è¡¨ï¼Œä¸ºäº†å®‰å…¨ä¿è¯ï¼Œå»ºè®®è¿˜æ˜¯å¤šåŒå†™ä¸€æ®µæ—¶é—´ï¼Œé˜²æ­¢æœ‰é—®é¢˜é—æ¼ã€‚æœ¬é˜¶æ®µå»ºè®®å‘¨æœŸä¸€ä¸ªæœˆï¼›1. å†™æ–°è¯»æ–°é˜¶æ®µï¼šæ­¤æ—¶å·²ç»å®Œæˆäº†åˆ†è¡¨çš„è¿ç§»ï¼Œè€è¡¨æ•°æ®å¯ä»¥åšä¸ªå†·å¤‡ã€‚</code></pre><h3 id="åˆ†å¸ƒå¼IDï¼š"><a href="#åˆ†å¸ƒå¼IDï¼š" class="headerlink" title="åˆ†å¸ƒå¼IDï¼š"></a>åˆ†å¸ƒå¼IDï¼š</h3><p>åˆ†å¸ƒå¼idéœ€è¦å…·æœ‰çš„ç‰¹æ€§</p><ol><li><strong>å…¨å±€å”¯ä¸€æ€§</strong> ï¼š ä¸èƒ½å‡ºç°é‡å¤çš„ ID å·ï¼Œæ—¢ç„¶æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„è¦æ±‚ã€‚</li><li><strong>è¶‹åŠ¿é€’å¢</strong> ï¼š åœ¨ MySQL InnoDB å¼•æ“ä¸­ä½¿ç”¨çš„æ˜¯èšé›†ç´¢å¼•ï¼Œç”±äºå¤šæ•° RDBMS ä½¿ç”¨ B-tree çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨ç´¢å¼•æ•°æ®ï¼Œåœ¨ä¸»é”®çš„é€‰æ‹©ä¸Šé¢æˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨æœ‰åºçš„ä¸»é”®ä¿è¯å†™å…¥æ€§èƒ½ã€‚</li><li><strong>å•è°ƒé€’å¢</strong> ï¼š ä¿è¯ä¸‹ä¸€ä¸ª ID ä¸€å®šå¤§äºä¸Šä¸€ä¸ª IDï¼Œä¾‹å¦‚äº‹åŠ¡ç‰ˆæœ¬å·ã€IM å¢é‡æ¶ˆæ¯ã€æ’åºç­‰ç‰¹æ®Šéœ€æ±‚ã€‚</li><li><strong>ä¿¡æ¯å®‰å…¨</strong> ï¼š å¦‚æœ ID æ˜¯è¿ç»­çš„ï¼Œæ¶æ„ç”¨æˆ·çš„æ‰’å–å·¥ä½œå°±éå¸¸å®¹æ˜“åšäº†ï¼Œç›´æ¥æŒ‰ç…§é¡ºåºä¸‹è½½æŒ‡å®š URL å³å¯ï¼›å¦‚æœæ˜¯è®¢å•å·å°±æ›´å±é™©äº†ï¼Œç«å¯¹å¯ä»¥ç›´æ¥çŸ¥é“æˆ‘ä»¬ä¸€å¤©çš„å•é‡ã€‚æ‰€ä»¥åœ¨ä¸€äº›åº”ç”¨åœºæ™¯ä¸‹ï¼Œä¼šéœ€è¦ ID æ— è§„åˆ™ã€ä¸è§„åˆ™ã€‚</li></ol><h4 id="1-UUIDï¼š"><a href="#1-UUIDï¼š" class="headerlink" title="1.UUIDï¼š"></a>1.UUIDï¼š</h4><p>â€‹Javaä¸­çš„UUIDç±»å¯ä»¥ç”ŸæˆUUIDï¼Œå‡ ç§ä¸åŒçš„ç”Ÿæˆæ–¹å¼åˆ†åˆ«æ ¹æ® åŸºäºéšæœºæ•°ã€æ—¶é—´ã€åç§°ç­‰æ–¹å¼ç”ŸæˆUUID</p><p>â€‹</p><h5 id="ä¼˜ç‚¹ï¼š-4"><a href="#ä¼˜ç‚¹ï¼š-4" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h5><p>â€‹é€šè¿‡æœ¬åœ°ç”Ÿæˆï¼Œæ²¡æœ‰ç»è¿‡ç½‘ç»œ I&#x2F;Oï¼Œæ€§èƒ½è¾ƒé«˜ã€‚</p><h5 id="ç¼ºç‚¹ï¼š-3"><a href="#ç¼ºç‚¹ï¼š-3" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><ul><li><strong>é•¿åº¦è¿‡é•¿</strong> - UUID å¤ªé•¿ï¼Œ16 å­—èŠ‚ 128 ä½ï¼Œé€šå¸¸ä»¥ 36 é•¿åº¦çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¾ˆå¤šåœºæ™¯ä¸é€‚ç”¨ã€‚ä¾‹å¦‚ï¼šMysql å®˜æ–¹æ˜ç¡®å»ºè®®ä¸»é”®è¶ŠçŸ­è¶Šå¥½ï¼Œ36 ä¸ªå­—ç¬¦é•¿åº¦çš„ UUID ä¸ç¬¦åˆè¦æ±‚ã€‚</li><li><strong>ä¿¡æ¯ä¸å®‰å…¨</strong> - åŸºäº MAC åœ°å€ç”Ÿæˆ UUID çš„ç®—æ³•å¯èƒ½ä¼šé€ æˆ MAC åœ°å€æ³„éœ²ï¼Œè¿™ä¸ªæ¼æ´æ›¾è¢«ç”¨äºå¯»æ‰¾æ¢…ä¸½èç—…æ¯’çš„åˆ¶ä½œè€…ä½ç½®ã€‚</li><li><strong>æ— åºæ€§</strong> - ä¸èƒ½ç”Ÿæˆé€’å¢æœ‰åºçš„æ•°å­—ã€‚è¿™å¯¹äºä¸€äº›ç‰¹å®šåœºæ™¯ä¸åˆ©ã€‚ä¾‹å¦‚ï¼šMySQL InnoDB å­˜å‚¨å¼•æ“ä½¿ç”¨ B+ æ ‘å­˜å‚¨ç´¢å¼•æ•°æ®ï¼Œè€Œä¸»é”®ä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•ã€‚<u>ç´¢å¼•æ•°æ®åœ¨ B+ æ ‘ä¸­æ˜¯æœ‰åºæ’åˆ—çš„ã€‚UUID çš„æ— åºæ€§å¯èƒ½ä¼šå¼•èµ·æ•°æ®ä½ç½®é¢‘ç¹å˜åŠ¨ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚</u></li></ul><h4 id="2-æ•°æ®åº“æ–¹æ¡ˆç”Ÿæˆé”®"><a href="#2-æ•°æ®åº“æ–¹æ¡ˆç”Ÿæˆé”®" class="headerlink" title="2.æ•°æ®åº“æ–¹æ¡ˆç”Ÿæˆé”®"></a>2.æ•°æ®åº“æ–¹æ¡ˆç”Ÿæˆé”®</h4><p>â€‹å†å¼€ä¸€ä¸ªæ•°æ®è¡¨ï¼Œåˆ©ç”¨å…¶è‡ªå¢é”®å®ç°åˆ†å¸ƒå¼id</p><p>å¯ä»¥ä½¿ç”¨æ¯”å¦‚ MySQL çš„è‡ªå¢é”®ï¼ŒOracle çš„è‡ªå¢åºåˆ—ç­‰ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘æ˜¯ç”¨ Redis è¿™æ ·çš„ Nosqlï¼Œç”šè‡³ ZooKeeper å»ç”Ÿæˆé”®ã€‚</p><p>ä¾‹ğŸŒ°ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231010134746596.png" alt="image-20231010134746596"></p><h5 id="ä¼˜ç‚¹ï¼š-5"><a href="#ä¼˜ç‚¹ï¼š-5" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h5><ul><li>éå¸¸<u>ç®€å•</u>ï¼Œåˆ©ç”¨ç°æœ‰çš„åŠŸèƒ½å®ç°ï¼Œ<u>æˆæœ¬å°</u></li><li><u>æœ‰åºé€’å¢</u></li><li><u>æ–¹ä¾¿æ’åºå’Œåˆ†é¡µ</u></li></ul><h5 id="ç¼ºç‚¹ï¼š-4"><a href="#ç¼ºç‚¹ï¼š-4" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><ul><li><p>å¼ºä¾èµ–ç¬¬ä¸‰æ–¹å­˜å‚¨ï¼Œå¦‚æœç¬¬ä¸‰æ–¹å­˜å‚¨éé«˜å¯ç”¨ç³»ç»Ÿï¼Œ<u><strong>è‹¥å‡ºç°ä¸¢å¤±æ•°æ®çš„æƒ…å†µï¼Œå°±å¯èƒ½å‡ºç°é‡å¤ç”Ÿæˆ ID çš„é—®é¢˜ã€‚</strong></u></p></li><li><p>ç”Ÿæˆ ID æ€§èƒ½<u>ç“¶é¢ˆä¾èµ–äºç¬¬ä¸‰æ–¹å­˜å‚¨çš„æ€§èƒ½</u>ã€‚</p></li><li><p>å¢åŠ äº†å¯¹ç¬¬ä¸‰æ–¹å­˜å‚¨è¿ç»´çš„æˆæœ¬ã€‚</p></li></ul><h4 id="3-é›ªèŠ±ç®—æ³•"><a href="#3-é›ªèŠ±ç®—æ³•" class="headerlink" title="3.é›ªèŠ±ç®—æ³•"></a>3.é›ªèŠ±ç®—æ³•</h4><p>â€‹<strong>ç”Ÿæˆä¸€ä¸ª <code>64 bit</code> çš„æ•´æ•°</strong></p><p>â€‹æ ¹æ®æ—¶é—´æˆ³ã€åºåˆ—ä½è®¡ç®—å¾—ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒå¯ä»¥è®¤ä¸ºæ˜¯æ€»ä½“æœ‰åºçš„ï¼Œè¿™å°±ä¿è¯äº†å¯¹ç´¢å¼•å­—æ®µçš„æ’å…¥çš„é«˜æ•ˆæ€§ã€‚</p><h5 id="é”®çš„ç»„æˆ-é»˜è®¤æƒ…å†µ-ï¼š"><a href="#é”®çš„ç»„æˆ-é»˜è®¤æƒ…å†µ-ï¼š" class="headerlink" title="é”®çš„ç»„æˆ(é»˜è®¤æƒ…å†µ)ï¼š"></a>é”®çš„ç»„æˆ(é»˜è®¤æƒ…å†µ)ï¼š</h5><ul><li><strong>ç¬¦å·ä½(1bit)</strong></li></ul><p>â€‹é¢„ç•™çš„ç¬¦å·ä½ï¼Œæ’ä¸ºé›¶ã€‚</p><ul><li><p><strong>æ—¶é—´æˆ³ä½(41bit)</strong></p><p>æ ¹æ®è·ç¦» 2016 å¹´ 11 æœˆ 1 æ—¥é›¶ç‚¹ çš„æ—¶é—´ä»¥æ¯«ç§’æ•°è®¡ç®—è€Œå¾—</p></li><li><p><strong>å·¥ä½œè¿›ç¨‹ä½(10bit)</strong></p><p>è¯¥æ ‡å¿—åœ¨ Java è¿›ç¨‹å†…æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœæ˜¯åˆ†å¸ƒå¼åº”ç”¨éƒ¨ç½²åº”ä¿è¯æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„ id æ˜¯ä¸åŒçš„ã€‚è¯¥å€¼é»˜è®¤ä¸º 0ï¼Œå¯é€šè¿‡å±æ€§è®¾ç½®ã€‚</p></li><li><p><strong>åºåˆ—å·ä½(12bit)</strong></p><p>è¯¥åºåˆ—æ˜¯ç”¨æ¥åœ¨åŒä¸€ä¸ªæ¯«ç§’å†…ç”Ÿæˆä¸åŒçš„ IDã€‚å¦‚æœåœ¨è¿™ä¸ªæ¯«ç§’å†…ç”Ÿæˆçš„æ•°é‡è¶…è¿‡ 4096(2 çš„ 12 æ¬¡å¹‚)ï¼Œé‚£ä¹ˆç”Ÿæˆå™¨ä¼šç­‰å¾…åˆ°ä¸‹ä¸ªæ¯«ç§’ç»§ç»­ç”Ÿæˆã€‚</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230916154529588.png" alt="image-20230916154529588"></p><h5 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul><li>ç”Ÿæˆçš„ ID éƒ½æ˜¯è¶‹åŠ¿é€’å¢çš„ã€‚</li><li>ä¸ä¾èµ–æ•°æ®åº“ç­‰ç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼Œä»¥æœåŠ¡çš„æ–¹å¼éƒ¨ç½²ï¼Œç¨³å®šæ€§æ›´é«˜ï¼Œç”Ÿæˆ ID çš„æ€§èƒ½ä¹Ÿæ˜¯éå¸¸é«˜çš„ã€‚</li><li>å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹æ€§åˆ†é… bit ä½ï¼Œéå¸¸çµæ´»ã€‚</li></ul><h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li><u>å¼ºä¾èµ–æœºå™¨æ—¶é’Ÿï¼Œå¦‚æœæœºå™¨ä¸Šæ—¶é’Ÿå›æ‹¨ï¼Œä¼šå¯¼è‡´å‘å·é‡å¤æˆ–è€…æœåŠ¡ä¼šå¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚</u></li></ul><h5 id="å¤„ç†æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼š"><a href="#å¤„ç†æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼š" class="headerlink" title="å¤„ç†æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼š"></a>å¤„ç†æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼š</h5><p>â€‹ç”¨å½“å‰æ—¶é—´å’Œä¸Šä¸€æ¬¡çš„æ—¶é—´è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ—¶é—´å°äºä¸Šä¸€æ¬¡çš„æ—¶é—´é‚£ä¹ˆè‚¯å®šæ˜¯å‘ç”Ÿäº†å›æ‹¨ã€‚æ™®é€šçš„ç®—æ³•ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸¤ä¸ªæƒ…å†µ:</p><ul><li>å¦‚æœæ—¶é—´å›æ‹¨æ—¶é—´è¾ƒçŸ­ï¼Œæ¯”å¦‚é…ç½® <code>5ms</code> ä»¥å†…ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œè®©æœºå™¨çš„æ—¶é—´è¿½ä¸Šæ¥ã€‚</li><li>å¦‚æœæ—¶é—´çš„å›æ‹¨æ—¶é—´è¾ƒé•¿ï¼Œæˆ‘ä»¬ä¸èƒ½æ¥å—è¿™ä¹ˆé•¿çš„é˜»å¡ç­‰å¾…ï¼Œé‚£ä¹ˆåˆæœ‰ä¸¤ä¸ªç­–ç•¥:<ul><li>ç›´æ¥æ‹’ç»ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚æ‰“æ—¥å¿—ï¼Œé€šçŸ¥ RD æ—¶é’Ÿå›æ»šã€‚</li><li>åˆ©ç”¨æ‰©å±•ä½ã€‚ä¸Šé¢æˆ‘ä»¬è®¨è®ºè¿‡ï¼Œä¸åŒä¸šåŠ¡åœºæ™¯ä½æ•°å¯èƒ½ç”¨ä¸åˆ°é‚£ä¹ˆå¤šæ¯”ç‰¹ä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠæ‰©å±•ä½æ•°åˆ©ç”¨èµ·æ¥ã€‚æ¯”å¦‚ï¼šå½“è¿™ä¸ªæ—¶é—´å›æ‹¨æ¯”è¾ƒé•¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸éœ€è¦ç­‰å¾…ï¼Œç›´æ¥åœ¨æ‰©å±•ä½åŠ  1ã€‚ä¸¤ä½çš„æ‰©å±•ä½å…è®¸æˆ‘ä»¬æœ‰ä¸‰æ¬¡å¤§çš„æ—¶é’Ÿå›æ‹¨ï¼Œä¸€èˆ¬æ¥è¯´å°±å¤Ÿäº†ï¼Œå¦‚æœå…¶è¶…è¿‡ä¸‰æ¬¡æˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰“æ—¥å¿—ã€‚</li></ul></li></ul><p><strong>ç¾å›¢</strong>æä¾›äº†ä¸€ç§åˆ†å¸ƒå¼ ID è§£å†³æ–¹æ¡ˆ Leafï¼Œå…¶æœ¬è´¨å¯ä»¥è§†ä¸º<u>æ•°æ®åº“åˆ†æ®µ+æœåŠ¡ç¼“å­˜ ID</u>ã€‚</p><h4 id="4-1Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆ"><a href="#4-1Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆ" class="headerlink" title="4.1Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆ"></a>4.1Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆ</h4><p>â€‹<u>ç›¸è¾ƒäºä¼ ç»Ÿçš„æ•°æ®åº“æ–¹æ¡ˆï¼ŒLeaf-segmentæ•°æ®åº“æ–¹æ¡ˆæ¯æ¬¡ç»™æ¯ä¸ªä¸šåŠ¡ä¼ è¾“ä¸€ä¸ªsegmentçš„è‡ªå¢id(å…·ä½“ä¸€ä¸ªsegmentä¸­idçš„æ•°é‡å¯è‡ªå®šä¹‰)ï¼Œç›¸è¾ƒäºåŸæ¥çš„å–ä¸€ä¸ªidå°±è¦æŸ¥è¯¢ã€ä¿®æ”¹ä¸€æ¬¡dbï¼Œå¦‚ä»Šç”¨å®Œsegmentä¸­æä¾›çš„idåæ‰ä¼šå†æ¬¡è®¿é—®dbï¼Œè·å–æ–°çš„segment</u></p><h6 id="å®˜æ–¹è§£é‡Šï¼š"><a href="#å®˜æ–¹è§£é‡Šï¼š" class="headerlink" title="å®˜æ–¹è§£é‡Šï¼š"></a>å®˜æ–¹è§£é‡Šï¼š</h6><p>â€‹åŸæ¥è·å–IDæ¯æ¬¡éƒ½éœ€è¦å†™æ•°æ®åº“ï¼Œç°åœ¨åªéœ€è¦æŠŠstepè®¾ç½®å¾—è¶³å¤Ÿå¤§ï¼Œæ¯”å¦‚1000ã€‚é‚£ä¹ˆåªæœ‰å½“1000ä¸ªå·è¢«æ¶ˆè€—å®Œäº†ä¹‹åæ‰ä¼šå»é‡æ–°è¯»å†™ä¸€æ¬¡æ•°æ®åº“ã€‚è¯»å†™æ•°æ®åº“çš„é¢‘ç‡ä»1å‡å°åˆ°äº†1&#x2F;step</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+--------------+------+-----+-------------------+-----------------------------+</span></span><br><span class="line"><span class="operator">|</span> Field       <span class="operator">|</span> Type         <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span>           <span class="operator">|</span> Extra                       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+--------------+------+-----+-------------------+-----------------------------+</span></span><br><span class="line"><span class="operator">|</span> biz_tag     <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">128</span>) <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span>                   <span class="operator">|</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> max_id      <span class="operator">|</span> <span class="type">bigint</span>(<span class="number">20</span>)   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="number">1</span>                 <span class="operator">|</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> step        <span class="operator">|</span> <span class="type">int</span>(<span class="number">11</span>)      <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>              <span class="operator">|</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">desc</span>        <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">256</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>              <span class="operator">|</span>                             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> update_time <span class="operator">|</span> <span class="type">timestamp</span>    <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="operator">|</span> <span class="keyword">on</span> <span class="keyword">update</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+--------------+------+-----+-------------------+-----------------------------</span></span><br><span class="line">biz_tagç”¨æ¥åŒºåˆ†ä¸šåŠ¡ï¼Œ(æ¯ç§ä¸šåŠ¡åº”å½“æœ‰è‡ªå·±ç‹¬æœ‰çš„è‡ªå¢id)</span><br><span class="line">max_idè¡¨ç¤ºè¯¥biz_tagç›®å‰æ‰€è¢«åˆ†é…çš„IDå·æ®µçš„æœ€å¤§å€¼ï¼Œ</span><br><span class="line">stepè¡¨ç¤ºæ¯æ¬¡åˆ†é…çš„å·æ®µé•¿åº¦ã€‚(å†³å®šäº†segmentçš„å¤§å°)</span><br></pre></td></tr></table></figure><h6 id="æ¶æ„ç¤ºæ„å›¾ï¼š"><a href="#æ¶æ„ç¤ºæ„å›¾ï¼š" class="headerlink" title="æ¶æ„ç¤ºæ„å›¾ï¼š"></a>æ¶æ„ç¤ºæ„å›¾ï¼š</h6><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230916163456886.png" alt="image-20230916163456886"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Begin</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">table</span> <span class="keyword">SET</span> max_id<span class="operator">=</span>max_id<span class="operator">+</span>step <span class="keyword">WHERE</span> biz_tag<span class="operator">=</span>xxx</span><br><span class="line"><span class="keyword">SELECT</span> tag, max_id, step <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> biz_tag<span class="operator">=</span>xxx</span><br><span class="line"><span class="keyword">Commit</span></span><br></pre></td></tr></table></figure><h6 id="ä¼˜ç‚¹ï¼š-6"><a href="#ä¼˜ç‚¹ï¼š-6" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h6><ul><li>LeafæœåŠ¡å¯ä»¥å¾ˆæ–¹ä¾¿çš„çº¿æ€§æ‰©å±•ï¼Œæ€§èƒ½å®Œå…¨èƒ½å¤Ÿæ”¯æ’‘å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ã€‚</li><li>IDå·ç æ˜¯è¶‹åŠ¿é€’å¢çš„8byteçš„64ä½æ•°å­—ï¼Œæ»¡è¶³ä¸Šè¿°æ•°æ®åº“å­˜å‚¨çš„ä¸»é”®è¦æ±‚ã€‚</li><li>å®¹ç¾æ€§é«˜ï¼šLeafæœåŠ¡å†…éƒ¨æœ‰å·æ®µç¼“å­˜ï¼Œå³ä½¿DBå®•æœºï¼ŒçŸ­æ—¶é—´å†…Leafä»èƒ½æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ã€‚</li><li>å¯ä»¥è‡ªå®šä¹‰max_idçš„å¤§å°ï¼Œéå¸¸æ–¹ä¾¿ä¸šåŠ¡ä»åŸæœ‰çš„IDæ–¹å¼ä¸Šè¿ç§»è¿‡æ¥ã€‚</li></ul><h6 id="ç¼ºç‚¹ï¼š-5"><a href="#ç¼ºç‚¹ï¼š-5" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h6><ul><li><ol><li>IDå·ç ä¸å¤Ÿéšæœºï¼Œèƒ½å¤Ÿæ³„éœ²å‘å·æ•°é‡çš„ä¿¡æ¯ï¼Œä¸å¤ªå®‰å…¨ã€‚</li></ol></li><li><ol start="2"><li>TP999æ•°æ®æ³¢åŠ¨å¤§ï¼Œå½“å·æ®µä½¿ç”¨å®Œä¹‹åè¿˜æ˜¯ä¼šhangåœ¨æ›´æ–°æ•°æ®åº“çš„I&#x2F;Oä¸Šï¼Œtg999æ•°æ®ä¼šå‡ºç°å¶å°”çš„å°–åˆºã€‚<ul><li>é€šä¿—ç‰ˆæœ¬ï¼šå½“ä¸€ä¸ªsegmentç”¨å®Œï¼Œåœ¨è¯·æ±‚ä¸‹ä¸€ä¸ªsegmentæœŸé—´ï¼Œä¼šé˜»å¡çº¿ç¨‹</li></ul></li></ol></li><li><ol start="3"><li>DBå®•æœºä¼šé€ æˆæ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚</li></ol></li></ul><h5 id="4-1-2-Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆçš„-åŒbufferä¼˜åŒ–"><a href="#4-1-2-Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆçš„-åŒbufferä¼˜åŒ–" class="headerlink" title="4.1.2 Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆçš„ åŒbufferä¼˜åŒ–"></a>4.1.2 Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆçš„ <u>åŒbufferä¼˜åŒ–</u></h5><p>â€‹å¯¹äº ç¼ºç‚¹2 åšäº†ä¸€äº›ä¼˜åŒ–</p><p>â€‹æˆ‘ä»¬å¸Œæœ›DBå–å·æ®µçš„è¿‡ç¨‹èƒ½å¤Ÿåšåˆ°æ— é˜»å¡ï¼Œä¸éœ€è¦åœ¨DBå–å·æ®µçš„æ—¶å€™é˜»å¡è¯·æ±‚çº¿ç¨‹ï¼Œå³å½“<u>å·æ®µæ¶ˆè´¹åˆ°æŸä¸ªç‚¹æ—¶å°±å¼‚æ­¥çš„æŠŠä¸‹ä¸€ä¸ªå·æ®µåŠ è½½åˆ°å†…å­˜ä¸­ã€‚è€Œä¸éœ€è¦ç­‰åˆ°å·æ®µç”¨å°½çš„æ—¶å€™æ‰å»æ›´æ–°å·æ®µã€‚</u></p><p>æ¶æ„å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230916164536591.png" alt="image-20230916164536591"></p><p>é‡‡ç”¨åŒbufferçš„æ–¹å¼ï¼ŒLeafæœåŠ¡å†…éƒ¨æœ‰ä¸¤ä¸ªå·æ®µç¼“å­˜åŒºsegmentã€‚**<u>å½“å‰å·æ®µå·²ä¸‹å‘10%æ—¶ï¼Œå¦‚æœä¸‹ä¸€ä¸ªå·æ®µæœªæ›´æ–°ï¼Œåˆ™å¦å¯ä¸€ä¸ªæ›´æ–°çº¿ç¨‹å»æ›´æ–°ä¸‹ä¸€ä¸ªå·æ®µã€‚å½“å‰å·æ®µå…¨éƒ¨ä¸‹å‘å®Œåï¼Œå¦‚æœä¸‹ä¸ªå·æ®µå‡†å¤‡å¥½äº†åˆ™åˆ‡æ¢åˆ°ä¸‹ä¸ªå·æ®µä¸ºå½“å‰segmentæ¥ç€ä¸‹å‘ï¼Œå¾ªç¯å¾€å¤ã€‚</u>**</p><ul><li>æ¯ä¸ªbiz-tagéƒ½æœ‰æ¶ˆè´¹é€Ÿåº¦ç›‘æ§ï¼Œé€šå¸¸æ¨èsegmenté•¿åº¦è®¾ç½®ä¸ºæœåŠ¡é«˜å³°æœŸå‘å·QPSçš„600å€ï¼ˆ10åˆ†é’Ÿï¼‰ï¼Œè¿™æ ·å³ä½¿DBå®•æœºï¼ŒLeafä»èƒ½æŒç»­å‘å·10-20åˆ†é’Ÿä¸å—å½±å“ã€‚</li><li>æ¯æ¬¡è¯·æ±‚æ¥ä¸´æ—¶éƒ½ä¼šåˆ¤æ–­ä¸‹ä¸ªå·æ®µçš„çŠ¶æ€ï¼Œä»è€Œæ›´æ–°æ­¤å·æ®µï¼Œæ‰€ä»¥å¶å°”çš„ç½‘ç»œæŠ–åŠ¨ä¸ä¼šå½±å“ä¸‹ä¸ªå·æ®µçš„æ›´æ–°ã€‚</li></ul><h5 id="4-1-3-Leaf-é«˜å¯ç”¨å®¹ç¾"><a href="#4-1-3-Leaf-é«˜å¯ç”¨å®¹ç¾" class="headerlink" title="4.1.3 Leaf é«˜å¯ç”¨å®¹ç¾"></a>4.1.3 Leaf é«˜å¯ç”¨å®¹ç¾</h5><p>â€‹æš‚ä¸æ·±å…¥ï¼Œæ”¾æ¶æ„å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230916165133518.png" alt="image-20230916165133518"></p><h4 id="4-2Leaf-snowflakeæ–¹æ¡ˆ"><a href="#4-2Leaf-snowflakeæ–¹æ¡ˆ" class="headerlink" title="4.2Leaf-snowflakeæ–¹æ¡ˆ"></a>4.2Leaf-snowflakeæ–¹æ¡ˆ</h4><p>â€‹Leaf-segmentæ–¹æ¡ˆå¯ä»¥ç”Ÿæˆè¶‹åŠ¿é€’å¢çš„IDï¼ŒåŒæ—¶IDå·æ˜¯å¯è®¡ç®—çš„ï¼Œä¸é€‚ç”¨äºè®¢å•IDç”Ÿæˆåœºæ™¯ï¼Œæ¯”å¦‚ç«å¯¹åœ¨ä¸¤å¤©ä¸­åˆ12ç‚¹åˆ†åˆ«ä¸‹å•ï¼Œé€šè¿‡è®¢å•idå·ç›¸å‡å°±èƒ½å¤§è‡´è®¡ç®—å‡ºå…¬å¸ä¸€å¤©çš„è®¢å•é‡ï¼Œè¿™ä¸ªæ˜¯ä¸èƒ½å¿å—çš„ã€‚é¢å¯¹è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬æä¾›äº† Leaf-snowflakeæ–¹æ¡ˆã€‚</p><p>â€‹å¤§ä½“ç±»ä¼¼é›ªèŠ±ç®—æ³•ï¼Œç”¨åˆ°äº†ZooKeeperï¼Œç¬”è€…æš‚æ—¶æ²¡æœ‰å­¦è¿‡ZooKeeperï¼Œæ•…ä¸æ·±ç©¶ï¼Œç•™ä¸ªå‘ï¼</p><p>*æ•°æ®è¿ç§»ï¼š</p><p>*åˆ†å¸ƒå¼äº‹åŠ¡</p><p>*åˆ†å¸ƒå¼é”</p><p>*é«˜å¯ç”¨</p><p>*åˆ†å¸ƒå¼æ•°æ®åº“</p><p>æœ¬åšå®¢å¯¹ä»¥ä¸‹æ–‡ç« æœ‰å‚è€ƒå€Ÿé‰´ï¼Œååˆ†æ„Ÿè°¢è¿™äº›ä½œè€…çš„æ–‡ç« ğŸ™ï¼š</p><ul><li><p><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E9%9D%A2%E8%AF%95%E7%B2%BE%E8%AE%B2">æ¶æ„è®¾è®¡é¢è¯•ç²¾è®²</a></p></li><li><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg5ODU2ODczMQ==&mid=2247483759&idx=1&sn=517652050f22e8309a58bd33d250fe74&chksm=c061c61bf7164f0defd8d784110230600b9f686785dd76bff5b047cae824fc0fdf2c771c27b7&token=1429342161&lang=zh_CN#rd">åˆ†åº“åˆ†è¡¨</a></p></li><li><p><a href="https://www.extlight.com/2021/04/13/5%E5%88%86%E9%92%9F%E5%B8%A6%E4%BD%A0%E4%BA%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/">5åˆ†é’Ÿå¸¦ä½ äº†è§£æ•°æ®åº“åˆ†åº“åˆ†è¡¨</a></p></li><li><p><a href="https://zq99299.github.io/note-book/back-end-storage/03/01.html">MySQL å­˜å‚¨æµ·é‡æ•°æ®çš„æœ€åä¸€æ‹›ï¼šåˆ†åº“åˆ†è¡¨</a></p></li><li><p><a href="https://dunwu.github.io/blog/pages/3ae455/">åˆ†å¸ƒå¼ ID åŸºæœ¬åŸç†</a></p></li><li><p><a href="https://tech.meituan.com/2017/04/21/mt-leaf.html">Leafâ€”â€”ç¾å›¢ç‚¹è¯„åˆ†å¸ƒå¼IDç”Ÿæˆç³»ç»Ÿ</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ç›¸å…³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> é«˜å¯ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RedisåŸç†å­¦ä¹ </title>
      <link href="/2023/08/15/Redis%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/08/15/Redis%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="Redisæ•°æ®ç»“æ„ï¼š"><a href="#Redisæ•°æ®ç»“æ„ï¼š" class="headerlink" title="Redisæ•°æ®ç»“æ„ï¼š"></a>Redisæ•°æ®ç»“æ„ï¼š</h2><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://javaguide.cn/database/redis/redis-common-blocking-problems-summary.html#aof-%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E9%98%BB%E5%A1%9E">javaguide Redisç›¸å…³éƒ¨åˆ†</a></li><li><a href="https://xiaolincoding.com/redis/data_struct/data_struct.html">redis æ•°æ®ç»“æ„</a></li></ul><h3 id="ğŸŒŸrediså¯¹è±¡ä¸æ•°æ®ç»“æ„çš„å…³ç³»å›¾ï¼š"><a href="#ğŸŒŸrediså¯¹è±¡ä¸æ•°æ®ç»“æ„çš„å…³ç³»å›¾ï¼š" class="headerlink" title="ğŸŒŸrediså¯¹è±¡ä¸æ•°æ®ç»“æ„çš„å…³ç³»å›¾ï¼š"></a>ğŸŒŸrediså¯¹è±¡ä¸æ•°æ®ç»“æ„çš„å…³ç³»å›¾ï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230925105926664.png" alt="image-20230925105926664"></p><h3 id="redisObjectç»“æ„ï¼š"><a href="#redisObjectç»“æ„ï¼š" class="headerlink" title="redisObjectç»“æ„ï¼š"></a>redisObjectç»“æ„ï¼š</h3><p>â€‹redisçš„æ¯ä¸ªvalue<strong>åº•å±‚æ˜¯ç”± <code>redisObject</code>æŒ‡å‘å…·ä½“çš„æ•°æ®ç»“æ„</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> LRU_BITS 24</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">redisObject</span> &#123;</span></span><br><span class="line">  <span class="type">unsigned</span> type:<span class="number">4</span>;</span><br><span class="line">  <span class="type">unsigned</span> encoding:<span class="number">4</span>;</span><br><span class="line">  <span class="type">unsigned</span> lru:LRU_BITS;</span><br><span class="line">  </span><br><span class="line">  <span class="type">int</span> refcount;</span><br><span class="line">  <span class="type">void</span> *ptr;</span><br><span class="line">&#125;robj;</span><br></pre></td></tr></table></figure><p><strong>type</strong>ï¼šæ˜¯å“ªç§Redliså¯¹è±¡</p><p><strong>encoding</strong> ï¼š è¡¨ç¤ºç”¨å“ªç§åº•å±‚ç¼–ç ï¼Œç”¨OBJECT ENCODING [key] å¯ä»¥çœ‹åˆ°å¯¹åº”çš„ç¼–ç æ–¹å¼</p><p><strong>Iru</strong>ï¼šè®°å½•å¯¹è±¡è®¿é—®ä¿¡æ¯ï¼Œç”¨äºå†…å­˜æ·˜æ±°ã€‚</p><p><strong>refcount</strong>ï¼šå¼•ç”¨è®¡æ•°ï¼Œç”¨æ¥æè¿°æœ‰å¤šå°‘ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥å¯¹è±¡</p><p><strong>ptr</strong>ï¼šå†…å®¹æŒ‡é’ˆï¼ŒæŒ‡å‘å®é™…å†…å®¹</p><h4 id="å…¶ä¸­ï¼š-ptræŒ‡å‘å„ç§æ•°æ®ç»“æ„å¯¹è±¡å†…å®¹"><a href="#å…¶ä¸­ï¼š-ptræŒ‡å‘å„ç§æ•°æ®ç»“æ„å¯¹è±¡å†…å®¹" class="headerlink" title="å…¶ä¸­ï¼š*ptræŒ‡å‘å„ç§æ•°æ®ç»“æ„å¯¹è±¡å†…å®¹"></a>å…¶ä¸­ï¼š*ptræŒ‡å‘å„ç§æ•°æ®ç»“æ„å¯¹è±¡å†…å®¹</h4><ul><li><strong>5 ç§åŸºç¡€æ•°æ®ç»“æ„</strong>ï¼šStringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Listï¼ˆåˆ—è¡¨ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€Hashï¼ˆæ•£åˆ—ï¼‰ã€Zsetï¼ˆæœ‰åºé›†åˆï¼‰</li></ul><h3 id="SDSï¼š"><a href="#SDSï¼š" class="headerlink" title="SDSï¼š"></a>SDSï¼š</h3><p>ç”±äºåœ¨Cä¸­ï¼š</p><ol><li>è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦éœ€è¦éå†å­—ç¬¦ä¸²æ•°ç»„ï¼Œç›´åˆ°é‡åˆ° â€˜ \0 â€™ ,å› æ­¤æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼›</li><li>å­—ç¬¦ä¸²çš„ç»“å°¾æ˜¯ä»¥ â€œ\0â€ å­—ç¬¦æ ‡è¯†ï¼Œå­—ç¬¦ä¸²é‡Œé¢ä¸èƒ½åŒ…å«æœ‰ â€œ\0â€ å­—ç¬¦ï¼Œå› æ­¤ä¸èƒ½ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼›</li><li>å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ä¸é«˜æ•ˆä¸”ä¸å®‰å…¨ï¼Œæ¯”å¦‚æœ‰ç¼“å†²åŒºæº¢å‡ºçš„é£é™©ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆç¨‹åºè¿è¡Œç»ˆæ­¢ï¼›</li></ol><p>ç”±äºè·å–å­—ç¬¦ä¸²é•¿åº¦ã€ä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹çš„æ“ä½œç†åº”é¢‘ç¹ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼Œåœ¨redisä¸­ï¼Œè‡ªå®šä¹‰äº†ä¸€ä¸ªSDSçš„å­—ç¬¦ä¸²ç»“æ„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span> ((__<span class="title">packed__</span>)) <span class="title">sdshdr8</span> &#123;</span></span><br><span class="line"><span class="type">uint8_t</span> len;</span><br><span class="line"><span class="type">uint8_t</span> alloc;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> flags;</span><br><span class="line"><span class="type">char</span> buf[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹<strong>len</strong>ï¼šå­—ç¬¦ä¸²é•¿åº¦</p><p>â€‹<strong>alloc</strong>ï¼šåˆ†é…ç»™å­—ç¬¦æ•°ç»„çš„ç©ºé—´é•¿åº¦</p><p>â€‹<strong>flags</strong>ï¼šè¡¨ç¤ºæ˜¯å“ªç§sdshdråˆ†ç±»ï¼Œæœ‰sdshdr5ã€sdshdr8ã€sdshdr16ã€sdshdr32ã€sdshdr64ç­‰å¤šç§ç±»å‹ï¼Œå®ƒä»¬çš„ä¸»è¦<strong>åŒºåˆ«å°±åœ¨äºï¼Œå®ƒä»¬æ•°æ®ç»“æ„ä¸­çš„ len å’Œ alloc æˆå‘˜å˜é‡çš„æ•°æ®ç±»å‹ä¸åŒ</strong>ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸¾ä¾‹ğŸŒ°</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span> ((__<span class="title">packed__</span>)) <span class="title">sdshdr16</span> &#123;</span></span><br><span class="line">    <span class="type">uint16_t</span> len;</span><br><span class="line">    <span class="type">uint16_t</span> alloc; </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> flags; </span><br><span class="line">    <span class="type">char</span> buf[];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span> ((__<span class="title">packed__</span>)) <span class="title">sdshdr32</span> &#123;</span></span><br><span class="line">    <span class="type">uint32_t</span> len;</span><br><span class="line">    <span class="type">uint32_t</span> alloc; </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> flags;</span><br><span class="line">    <span class="type">char</span> buf[];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>â€‹**buf[]**ï¼šå­˜æ•°æ®çš„charæ•°ç»„ï¼Œä¸ä»…å¯ä»¥ä¿å­˜å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ã€‚</p><p>è¿™æ ·ï¼Œå°±å¯ä»¥é€šè¿‡æŸ¥è¯¢lenï¼Œä»è€Œåœ¨O(1)çš„æ—¶é—´ä¸‹æŸ¥è¯¢å¾—stringçš„é•¿åº¦ï¼Œ</p><p>å¹¶ä¸”ï¼Œç”±äºæœ‰alloc - lenå¤§å°çš„é¢„ç•™ç©ºé—´ï¼Œå¯ä»¥ä¸ºåç»­è¿½åŠ æ•°æ®ç•™ä½™åœ°ã€‚</p><h4 id="SDSæ‰©å®¹æœºåˆ¶ç®€è¿°ï¼š"><a href="#SDSæ‰©å®¹æœºåˆ¶ç®€è¿°ï¼š" class="headerlink" title="SDSæ‰©å®¹æœºåˆ¶ç®€è¿°ï¼š"></a>SDSæ‰©å®¹æœºåˆ¶ç®€è¿°ï¼š</h4><ul><li>å¦‚æœæ‰€éœ€çš„ sds é•¿åº¦<strong>å°äº 1 MB</strong>ï¼Œé‚£ä¹ˆæœ€åçš„æ‰©å®¹æ˜¯æŒ‰ç…§<strong>ç¿»å€æ‰©å®¹</strong>æ¥æ‰§è¡Œçš„ï¼Œå³ 2 å€çš„newlen</li><li>å¦‚æœæ‰€éœ€çš„ sds é•¿åº¦<strong>è¶…è¿‡ 1 MB</strong>ï¼Œé‚£ä¹ˆæœ€åçš„æ‰©å®¹é•¿åº¦åº”è¯¥æ˜¯ newlen <strong>+ 1MB</strong>ã€‚</li></ul><h3 id="é“¾è¡¨ï¼š"><a href="#é“¾è¡¨ï¼š" class="headerlink" title="é“¾è¡¨ï¼š"></a>é“¾è¡¨ï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// redisä¸­ï¼Œé“¾è¡¨çš„å®šä¹‰</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> &#123;</span></span><br><span class="line">    <span class="comment">//å‰ç½®èŠ‚ç‚¹</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> *<span class="title">prev</span>;</span></span><br><span class="line">    <span class="comment">//åç½®èŠ‚ç‚¹</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">listNode</span> *<span class="title">next</span>;</span></span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">    <span class="type">void</span> *value;</span><br><span class="line">&#125; listNode;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä¸è¿‡ï¼ŒRedis åœ¨ listNode ç»“æ„ä½“åŸºç¡€ä¸Šåˆå°è£…äº† <span class="built_in">list</span> è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œè¿™æ ·æ“ä½œèµ·æ¥ä¼šæ›´æ–¹ä¾¿ï¼Œé“¾è¡¨ç»“æ„å¦‚ä¸‹ï¼š</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">list</span> &#123;</span></span><br><span class="line">    <span class="comment">//é“¾è¡¨å¤´èŠ‚ç‚¹</span></span><br><span class="line">    listNode *head;</span><br><span class="line">    <span class="comment">//é“¾è¡¨å°¾èŠ‚ç‚¹</span></span><br><span class="line">    listNode *tail;</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹å€¼å¤åˆ¶å‡½æ•°</span></span><br><span class="line">    <span class="type">void</span> *(*dup)(<span class="type">void</span> *ptr);</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹å€¼é‡Šæ”¾å‡½æ•°</span></span><br><span class="line">    <span class="type">void</span> (*<span class="built_in">free</span>)(<span class="type">void</span> *ptr);</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹å€¼æ¯”è¾ƒå‡½æ•°</span></span><br><span class="line">    <span class="type">int</span> (*match)(<span class="type">void</span> *ptr, <span class="type">void</span> *key);</span><br><span class="line">    <span class="comment">//é“¾è¡¨èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> len;</span><br><span class="line">&#125; <span class="built_in">list</span>;</span><br></pre></td></tr></table></figure><p>list ç»“æ„ä¸ºé“¾è¡¨æä¾›äº†é“¾è¡¨å¤´æŒ‡é’ˆ headã€é“¾è¡¨å°¾èŠ‚ç‚¹ tailã€é“¾è¡¨èŠ‚ç‚¹æ•°é‡ lenã€ä»¥åŠå¯ä»¥è‡ªå®šä¹‰å®ç°çš„ dupã€freeã€match å‡½æ•°ã€‚</p><p><strong>å…¶å®å°±æ˜¯ç®€å•çš„é“¾è¡¨ç»“æ„ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230920160330614.png" alt="image-20230920160330614"></p><p>ä¼˜ç‚¹ï¼š</p><p>â€‹ç•¥</p><p>ç¼ºç‚¹ï¼š</p><ul><li>é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„å†…å­˜éƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œæ„å‘³ç€<strong>æ— æ³•å¾ˆå¥½åˆ©ç”¨ CPU ç¼“å­˜</strong>ã€‚èƒ½å¾ˆå¥½åˆ©ç”¨ CPU ç¼“å­˜çš„æ•°æ®ç»“æ„å°±æ˜¯æ•°ç»„ï¼Œå› ä¸ºæ•°ç»„çš„å†…å­˜æ˜¯è¿ç»­çš„ï¼Œè¿™æ ·å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU ç¼“å­˜æ¥åŠ é€Ÿè®¿é—®ã€‚</li><li>è¿˜æœ‰ä¸€ç‚¹ï¼Œä¿å­˜ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹çš„å€¼éƒ½<u>éœ€è¦ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ç»“æ„å¤´</u>çš„åˆ†é…ï¼Œ<strong>å†…å­˜å¼€é”€è¾ƒå¤§</strong>ã€‚</li></ul><h3 id="å‹ç¼©åˆ—è¡¨-æ—©æœŸç‰ˆæœ¬ä½¿ç”¨-ï¼š"><a href="#å‹ç¼©åˆ—è¡¨-æ—©æœŸç‰ˆæœ¬ä½¿ç”¨-ï¼š" class="headerlink" title="å‹ç¼©åˆ—è¡¨(æ—©æœŸç‰ˆæœ¬ä½¿ç”¨)ï¼š"></a>å‹ç¼©åˆ—è¡¨(æ—©æœŸç‰ˆæœ¬ä½¿ç”¨)ï¼š</h3><p><strong><u>â€”-æ ¸å¿ƒæ€æƒ³ï¼šæ ¹æ®æ•°æ®å¤§å°å’Œç±»å‹è¿›è¡Œä¸åŒçš„ç©ºé—´å¤§å°åˆ†é…çš„è®¾è®¡æ€æƒ³</u></strong></p><p>â€‹Redis 3.0 çš„ List å¯¹è±¡åœ¨æ•°æ®é‡æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œä¼šé‡‡ç”¨ã€Œå‹ç¼©åˆ—è¡¨ã€ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„çš„å®ç°ï¼Œå®ƒçš„ä¼˜åŠ¿æ˜¯èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”æ˜¯å†…å­˜ç´§å‡‘å‹çš„æ•°æ®ç»“æ„ã€‚</p><p>â€‹ç‰¹ç‚¹ï¼šä¸ä»…<strong>å¯ä»¥åˆ©ç”¨ CPU ç¼“å­˜</strong>ï¼Œè€Œä¸”ä¼š<strong>é’ˆå¯¹ä¸åŒé•¿åº¦çš„æ•°æ®ï¼Œè¿›è¡Œç›¸åº”ç¼–ç </strong>ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°èŠ‚çœå†…å­˜å¼€é”€ã€‚</p><p>å› æ­¤ï¼ŒRedis å¯¹è±¡ï¼ˆList å¯¹è±¡ã€Hash å¯¹è±¡ã€Zset å¯¹è±¡ï¼‰åŒ…å«çš„<strong>å…ƒç´ æ•°é‡è¾ƒå°‘</strong>ï¼Œæˆ–è€…å…ƒç´ å€¼ä¸å¤§çš„æƒ…å†µæ‰ä¼šä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„ã€‚</p><h4 id="å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡ï¼š"><a href="#å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡ï¼š" class="headerlink" title="å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡ï¼š"></a>å‹ç¼©åˆ—è¡¨ç»“æ„è®¾è®¡ï¼š</h4><p>â€‹<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230920170011757.png" alt="image-20230920170011757" style="zoom:50%;" /></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ziplist</span>&lt;</span>T&gt; &#123;</span><br><span class="line">    int32 zlbytes;</span><br><span class="line">    int32 zltail_offset;</span><br><span class="line">    int16 zllength;</span><br><span class="line">    T[] entries;</span><br><span class="line">    int8 zlend;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><em><strong>zlbytes</strong></em>ï¼šæ•´ä¸ªå‹ç¼©åˆ—è¡¨å ç”¨çš„å­—èŠ‚æ•°ï¼Œå 4Byte</li><li><em><strong>zltail_offset</strong></em>ï¼šæœ€åä¸€ä¸ªå…ƒç´ è·ç¦»å‹ç¼©åˆ—è¡¨èµ·å§‹ä½ç½®çš„åç§»é‡ï¼Œ<strong>ç”¨äºå¿«é€Ÿå®šä½åˆ°æœ€åä¸€ä¸ªå…ƒç´ </strong>ï¼Œå 4Byte</li><li><em><strong>zllen</strong></em>ï¼šå‹ç¼©åˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°ï¼Œå 2Byte</li><li><em><strong>entries</strong></em>ï¼šå‹ç¼©åˆ—è¡¨çš„å…ƒç´ ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä¿å­˜ä¸€ä¸ªå­—èŠ‚æ•°ç»„æˆ–è€…ä¸€ä¸ªæ•´æ•°å€¼</li><li><em><strong>zlend</strong></em>ï¼šå‹ç¼©åˆ—è¡¨ç»“æŸæ ‡å¿—ï¼Œå€¼ç­‰äº 0xFFï¼Œå 1Byte</li></ul><h4 id="å‹ç¼©åˆ—è¡¨çš„èŠ‚ç‚¹ç»“æ„ï¼š"><a href="#å‹ç¼©åˆ—è¡¨çš„èŠ‚ç‚¹ç»“æ„ï¼š" class="headerlink" title="å‹ç¼©åˆ—è¡¨çš„èŠ‚ç‚¹ç»“æ„ï¼š"></a>å‹ç¼©åˆ—è¡¨çš„<u>èŠ‚ç‚¹</u>ç»“æ„ï¼š</h4><ul><li><em><strong>prevlen</strong></em>ï¼Œè®°å½•äº†ã€Œå‰ä¸€ä¸ªèŠ‚ç‚¹ã€çš„<strong>é•¿åº¦</strong>ï¼Œ<u>ç›®çš„æ˜¯ä¸ºäº†å®ç°ä»åå‘å‰éå†</u>ï¼›</li><li><em><strong>encoding</strong></em>ï¼Œè®°å½•äº†å½“å‰èŠ‚ç‚¹å®é™…æ•°æ®çš„ã€Œ<strong>ç±»å‹å’Œé•¿åº¦</strong>ã€ï¼Œç±»å‹ä¸»è¦æœ‰ä¸¤ç§ï¼šå­—ç¬¦ä¸²å’Œæ•´æ•°ã€‚</li><li><em><strong>data</strong></em>ï¼Œè®°å½•äº†å½“å‰èŠ‚ç‚¹çš„å®é™…æ•°æ®ï¼Œç±»å‹å’Œé•¿åº¦éƒ½ç”± <code>encoding</code> å†³å®šï¼›</li></ul><h5 id="prevlené•¿åº¦ï¼š"><a href="#prevlené•¿åº¦ï¼š" class="headerlink" title="prevlené•¿åº¦ï¼š"></a>prevlené•¿åº¦ï¼š</h5><p>å‹ç¼©åˆ—è¡¨é‡Œçš„æ¯ä¸ªèŠ‚ç‚¹ä¸­çš„ prevlen å±æ€§éƒ½è®°å½•äº†ã€Œå‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ã€ï¼Œè€Œä¸” **<u>prevlen å±æ€§çš„ç©ºé—´å¤§å°è·Ÿå‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦å€¼æœ‰å…³</u>**ï¼Œæ¯”å¦‚ï¼š</p><ul><li>å¦‚æœ<strong>å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦å°äº 254 å­—èŠ‚</strong>ï¼Œé‚£ä¹ˆ prevlen å±æ€§éœ€è¦ç”¨ <strong>1 å­—èŠ‚çš„ç©ºé—´</strong>æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼›</li><li>å¦‚æœ<strong>å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦å¤§äºç­‰äº 254 å­—èŠ‚</strong>ï¼Œé‚£ä¹ˆ prevlen å±æ€§éœ€è¦ç”¨ <strong>5 å­—èŠ‚çš„ç©ºé—´</strong>æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼›</li></ul><h5 id="encodingé•¿åº¦ï¼š"><a href="#encodingé•¿åº¦ï¼š" class="headerlink" title="encodingé•¿åº¦ï¼š"></a>encodingé•¿åº¦ï¼š</h5><p>å½“æˆ‘ä»¬å¾€å‹ç¼©åˆ—è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå‹ç¼©åˆ—è¡¨å°±ä¼šæ ¹æ®æ•°æ®ç±»å‹æ˜¯å­—ç¬¦ä¸²è¿˜æ˜¯æ•´æ•°ï¼Œä»¥åŠæ•°æ®çš„å¤§å°ï¼Œä¼šä½¿ç”¨ä¸åŒç©ºé—´å¤§å°çš„ prevlen å’Œ encoding è¿™ä¸¤ä¸ªå…ƒç´ é‡Œä¿å­˜çš„ä¿¡æ¯ï¼Œ<strong>è¿™ç§æ ¹æ®æ•°æ®å¤§å°å’Œç±»å‹è¿›è¡Œä¸åŒçš„ç©ºé—´å¤§å°åˆ†é…çš„è®¾è®¡æ€æƒ³ï¼Œæ­£æ˜¯ Redis ä¸ºäº†èŠ‚çœå†…å­˜è€Œé‡‡ç”¨çš„</strong>ã€‚</p><ul><li>å¦‚æœ<strong>å½“å‰èŠ‚ç‚¹çš„æ•°æ®æ˜¯æ•´æ•°</strong>ï¼Œåˆ™ encoding ä¼šä½¿ç”¨ <strong>1 å­—èŠ‚çš„ç©ºé—´</strong>è¿›è¡Œç¼–ç ï¼Œä¹Ÿå°±æ˜¯ encoding é•¿åº¦ä¸º 1 å­—èŠ‚ã€‚é€šè¿‡ encoding ç¡®è®¤äº†æ•´æ•°ç±»å‹ï¼Œå°±å¯ä»¥ç¡®è®¤æ•´æ•°æ•°æ®çš„å®é™…å¤§å°äº†ï¼Œæ¯”å¦‚å¦‚æœ encoding ç¼–ç ç¡®è®¤äº†æ•°æ®æ˜¯ int16 æ•´æ•°ï¼Œé‚£ä¹ˆ data çš„é•¿åº¦å°±æ˜¯ int16 çš„å¤§å°ã€‚</li><li>å¦‚æœ<strong>å½“å‰èŠ‚ç‚¹çš„æ•°æ®æ˜¯å­—ç¬¦ä¸²ï¼Œæ ¹æ®å­—ç¬¦ä¸²çš„é•¿åº¦å¤§å°</strong>ï¼Œencoding ä¼šä½¿ç”¨ <strong>1 å­—èŠ‚&#x2F;2å­—èŠ‚&#x2F;5å­—èŠ‚çš„ç©ºé—´</strong>è¿›è¡Œç¼–ç ï¼Œencoding ç¼–ç çš„å‰ä¸¤ä¸ª bit è¡¨ç¤ºæ•°æ®çš„ç±»å‹ï¼Œåç»­çš„å…¶ä»– bit æ ‡è¯†å­—ç¬¦ä¸²æ•°æ®çš„å®é™…é•¿åº¦ï¼Œå³ data çš„é•¿åº¦ã€‚</li></ul><h4 id="å‹ç¼©åˆ—è¡¨çš„ç‰¹æ€§ï¼š"><a href="#å‹ç¼©åˆ—è¡¨çš„ç‰¹æ€§ï¼š" class="headerlink" title="å‹ç¼©åˆ—è¡¨çš„ç‰¹æ€§ï¼š"></a>å‹ç¼©åˆ—è¡¨çš„ç‰¹æ€§ï¼š</h4><p>â€‹åœ¨å‹ç¼©åˆ—è¡¨ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦æŸ¥æ‰¾å®šä½ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥é€šè¿‡è¡¨å¤´ä¸‰ä¸ªå­—æ®µï¼ˆzllenï¼‰çš„é•¿åº¦ç›´æ¥å®šä½ï¼Œå¤æ‚åº¦æ˜¯ O(1)ã€‚è€Œ<strong>æŸ¥æ‰¾å…¶ä»–å…ƒç´ æ—¶ï¼Œå°±æ²¡æœ‰è¿™ä¹ˆé«˜æ•ˆäº†ï¼Œåªèƒ½é€ä¸ªæŸ¥æ‰¾ï¼Œæ­¤æ—¶çš„å¤æ‚åº¦å°±æ˜¯ O(N) äº†ï¼Œå› æ­¤å‹ç¼©åˆ—è¡¨ä¸é€‚åˆä¿å­˜è¿‡å¤šçš„å…ƒç´ </strong>ã€‚</p><h4 id="å‹ç¼©åˆ—è¡¨çš„ç¼ºç‚¹ï¼š"><a href="#å‹ç¼©åˆ—è¡¨çš„ç¼ºç‚¹ï¼š" class="headerlink" title="å‹ç¼©åˆ—è¡¨çš„ç¼ºç‚¹ï¼š"></a>å‹ç¼©åˆ—è¡¨çš„ç¼ºç‚¹ï¼š</h4><h5 id="è¿é”æ›´æ–°ï¼š"><a href="#è¿é”æ›´æ–°ï¼š" class="headerlink" title="è¿é”æ›´æ–°ï¼š"></a><a href="https://xiaolincoding.com/redis/data_struct/data_struct.html#%E8%BF%9E%E9%94%81%E6%9B%B4%E6%96%B0">è¿é”æ›´æ–°</a>ï¼š</h5><p>â€‹å‡å¦‚å·²çŸ¥çš„å„ä¸ªèŠ‚ç‚¹çš„é•¿åº¦éƒ½ä¸º250ï½253ï¼Œç„¶ååœ¨è¡¨å¤´èŠ‚ç‚¹çš„å·¦è¾¹æ·»åŠ ä¸€ä¸ªé•¿åº¦&gt;&#x3D;254çš„èŠ‚ç‚¹ï¼Œç”±äºè¡¨å¤´èŠ‚ç‚¹çš„prevlenå­—æ®µçš„é•¿åº¦é»˜è®¤ä¸º1å­—èŠ‚ï¼Œéœ€è¦æ‰©å®¹åˆ°5å­—èŠ‚ï¼Œè¿™å°±ä¼šå¯¼è‡´è¡¨å¤´èŠ‚ç‚¹çš„é•¿åº¦ä¹Ÿ &gt;&#x3D; 254ï¼Œå¯¼è‡´ç¬¬äºŒä¸ªèŠ‚ç‚¹çš„prevlenä¹Ÿéœ€è¦æ‰©å®¹â€¦â€¦(ç›´åˆ°å½±å“äº†æ‰€æœ‰çš„èŠ‚ç‚¹)</p><p>ç©ºé—´æ‰©å±•æ“ä½œéœ€è¦é‡æ–°åˆ†é…å†…å­˜ï¼Œå› æ­¤<strong>è¿é”æ›´æ–°ä¸€æ—¦å‘ç”Ÿï¼Œå°±ä¼šå¯¼è‡´å‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜ç©ºé—´è¦å¤šæ¬¡é‡æ–°åˆ†é…ï¼Œè¿™å°±ä¼šç›´æ¥å½±å“åˆ°å‹ç¼©åˆ—è¡¨çš„è®¿é—®æ€§èƒ½</strong>ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œ<strong>è™½ç„¶å‹ç¼©åˆ—è¡¨ç´§å‡‘å‹çš„å†…å­˜å¸ƒå±€èƒ½èŠ‚çœå†…å­˜å¼€é”€ï¼Œä½†æ˜¯å¦‚æœä¿å­˜çš„å…ƒç´ æ•°é‡å¢åŠ äº†ï¼Œæˆ–æ˜¯å…ƒç´ å˜å¤§äº†ï¼Œä¼šå¯¼è‡´å†…å­˜é‡æ–°åˆ†é…ï¼Œæœ€ç³Ÿç³•çš„æ˜¯ä¼šæœ‰ã€Œè¿é”æ›´æ–°ã€çš„é—®é¢˜</strong>ã€‚</p><p>å› æ­¤ï¼Œ<strong>å‹ç¼©åˆ—è¡¨åªä¼šç”¨äºä¿å­˜çš„èŠ‚ç‚¹æ•°é‡ä¸å¤šçš„åœºæ™¯</strong>ï¼Œåªè¦èŠ‚ç‚¹æ•°é‡è¶³å¤Ÿå°ï¼Œå³ä½¿å‘ç”Ÿè¿é”æ›´æ–°ï¼Œä¹Ÿæ˜¯èƒ½æ¥å—çš„ã€‚</p><p>è™½è¯´å¦‚æ­¤ï¼ŒRedis é’ˆå¯¹å‹ç¼©åˆ—è¡¨åœ¨è®¾è®¡ä¸Šçš„ä¸è¶³ï¼Œåœ¨åæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œæ–°å¢è®¾è®¡äº†ä¸¤ç§æ•°æ®ç»“æ„ï¼šquicklistï¼ˆRedis 3.2 å¼•å…¥ï¼‰ å’Œ listpackï¼ˆRedis 5.0 å¼•å…¥ï¼‰ã€‚è¿™ä¸¤ç§æ•°æ®ç»“æ„çš„è®¾è®¡ç›®æ ‡ï¼Œå°±æ˜¯å°½å¯èƒ½åœ°ä¿æŒå‹ç¼©åˆ—è¡¨èŠ‚çœå†…å­˜çš„ä¼˜åŠ¿ï¼ŒåŒæ—¶è§£å†³å‹ç¼©åˆ—è¡¨çš„ã€Œè¿é”æ›´æ–°ã€çš„é—®é¢˜ã€‚</p><h3 id="hashè¡¨ï¼š"><a href="#hashè¡¨ï¼š" class="headerlink" title="hashè¡¨ï¼š"></a>hashè¡¨ï¼š</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dictht</span> &#123;</span></span><br><span class="line">    <span class="comment">//å“ˆå¸Œè¡¨æ•°ç»„</span></span><br><span class="line">    dictEntry **table;</span><br><span class="line">    <span class="comment">//å“ˆå¸Œè¡¨å¤§å°</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> size;  </span><br><span class="line">    <span class="comment">//å“ˆå¸Œè¡¨å¤§å°æ©ç ï¼Œç”¨äºè®¡ç®—ç´¢å¼•å€¼</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> sizemask;</span><br><span class="line">    <span class="comment">//è¯¥å“ˆå¸Œè¡¨å·²æœ‰çš„èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> used;</span><br><span class="line">  <span class="comment">//ä¸¤ä¸ªHashè¡¨ï¼Œäº¤æ›¿ä½¿ç”¨ï¼Œç”¨äºrehash(æ‰©å®¹)æ“ä½œ</span></span><br><span class="line">    dictht ht[<span class="number">2</span>]; </span><br><span class="line">&#125; dictht;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…¶ä¸­ table ä¸º dictEntry[] æ•°ç»„ï¼Œæ¯ä¸ªdictEntryçš„ç»“æ„å¦‚ä¸‹â¬‡ï¸ï¼š</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dictEntry</span> &#123;</span></span><br><span class="line">    <span class="comment">//é”®å€¼å¯¹ä¸­çš„é”®</span></span><br><span class="line">    <span class="type">void</span> *key;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//é”®å€¼å¯¹ä¸­çš„å€¼</span></span><br><span class="line">  <span class="comment">//é”®å€¼å¯¹ä¸­çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªæŒ‡å‘å®é™…å€¼çš„æŒ‡é’ˆï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„ 64 ä½æ•´æ•°æˆ–æœ‰ç¬¦å·çš„ 64 ä½æ•´æ•°æˆ–double ç±»çš„å€¼ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå› ä¸ºå½“ã€Œå€¼ã€æ˜¯æ•´æ•°æˆ–æµ®ç‚¹æ•°æ—¶ï¼Œå°±å¯ä»¥å°†å€¼çš„æ•°æ®å†…åµŒåœ¨ dictEntry ç»“æ„é‡Œï¼Œæ— éœ€å†ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®é™…çš„å€¼ï¼Œä»è€ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        <span class="type">void</span> *val;</span><br><span class="line">        <span class="type">uint64_t</span> u64;</span><br><span class="line">        <span class="type">int64_t</span> s64;</span><br><span class="line">        <span class="type">double</span> d;</span><br><span class="line">    &#125; v;</span><br><span class="line">    <span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œå½¢æˆé“¾è¡¨</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dictEntry</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; dictEntry;</span><br></pre></td></tr></table></figure><p>ç»“æ„è·Ÿjavaä¸­çš„HashMapå¾ˆåƒï¼Œæ•…ä¸åšè¿‡å¤šä»‹ç»</p><p><strong>å”¯ä¸€éœ€è¦å¼ºè°ƒçš„å°±æ˜¯</strong>ï¼šhashmapä¸­çš„æ¯ä¸ªdictEntryä¸­ï¼Œå¦‚æœå­˜å‚¨çš„æ˜¯<u>ä¸€ä¸ªæ— ç¬¦å·çš„ 64 ä½æ•´æ•°æˆ–æœ‰ç¬¦å·çš„ 64 ä½æ•´æ•°æˆ–double ç±»çš„å€¼</u>ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†æ•°æ®ç›´æ¥å†™åœ¨dictEntryä¸­çš„unionç»“æ„ä½“ä¸­ï¼Œæ— éœ€ä½¿ç”¨å…¶ä»–å­˜å‚¨çš„ç»“æ„è€Œåªæ˜¯ä½¿ç”¨ä¸€ä¸ªå­—æ®µï¼ŒèŠ‚çœäº†ç©ºé—´ï¼</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230921102950618.png" alt="image-20230921102950618"></p><p>â€‹</p><h4 id="hashå†²çªï¼š"><a href="#hashå†²çªï¼š" class="headerlink" title="hashå†²çªï¼š"></a>hashå†²çªï¼š</h4><p>â€‹ä¸jdk1.7ä¸­hashmapä¸€æ ·ï¼Œ**<u>ä½¿ç”¨é“¾å¼hashå­˜å‚¨</u>**ã€‚</p><h4 id="rehashï¼š"><a href="#rehashï¼š" class="headerlink" title="rehashï¼š"></a>rehashï¼š</h4><p>â€‹rehashæŒ‡ï¼šhashè¡¨çš„æ‰©å®¹æ“ä½œ</p><p>â€‹è§¦å‘ rehash æ“ä½œçš„æ¡ä»¶ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p><ul><li><strong>å½“è´Ÿè½½å› å­å¤§äºç­‰äº 1 ï¼Œå¹¶ä¸” Redis æ²¡æœ‰åœ¨æ‰§è¡Œ bgsave å‘½ä»¤æˆ–è€… bgrewiteaof å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æ‰§è¡Œ RDB å¿«ç…§æˆ–æ²¡æœ‰è¿›è¡Œ AOF é‡å†™çš„æ—¶å€™ï¼Œå°±ä¼šè¿›è¡Œ rehash æ“ä½œã€‚</strong></li><li><strong>å½“è´Ÿè½½å› å­å¤§äºç­‰äº 5 æ—¶ï¼Œæ­¤æ—¶è¯´æ˜å“ˆå¸Œå†²çªéå¸¸ä¸¥é‡äº†ï¼Œä¸ç®¡æœ‰æ²¡æœ‰æœ‰åœ¨æ‰§è¡Œ RDB å¿«ç…§æˆ– AOF é‡å†™ï¼Œéƒ½ä¼šå¼ºåˆ¶è¿›è¡Œ rehash æ“ä½œã€‚</strong></li></ul><h4 id="å¸¸è§„rehashæ“ä½œï¼š"><a href="#å¸¸è§„rehashæ“ä½œï¼š" class="headerlink" title="å¸¸è§„rehashæ“ä½œï¼š"></a>å¸¸è§„rehashæ“ä½œï¼š</h4><p>â€‹rehash æ“ä½œï¼Œå…¶è¿‡ç¨‹åˆ†ä¸ºä¸‰æ­¥ï¼š(æœ‰ç‚¹åƒæ–°ç”Ÿä»£åƒåœ¾å›æ”¶ã€‚ã€‚ã€‚)</p><ul><li>ç»™ã€Œå“ˆå¸Œè¡¨ 2ã€ åˆ†é…ç©ºé—´ï¼Œä¸€èˆ¬ä¼šæ¯”ã€Œå“ˆå¸Œè¡¨ 1ã€ å¤§ 2 å€ï¼›</li><li>å°†ã€Œå“ˆå¸Œè¡¨ 1 ã€çš„æ•°æ®è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ ä¸­ï¼›</li><li>è¿ç§»å®Œæˆåï¼Œã€Œå“ˆå¸Œè¡¨ 1 ã€çš„ç©ºé—´ä¼šè¢«é‡Šæ”¾ï¼Œå¹¶æŠŠã€Œå“ˆå¸Œè¡¨ 2ã€ è®¾ç½®ä¸ºã€Œå“ˆå¸Œè¡¨ 1ã€ï¼Œç„¶ååœ¨ã€Œå“ˆå¸Œè¡¨ 2ã€ æ–°åˆ›å»ºä¸€ä¸ªç©ºç™½çš„å“ˆå¸Œè¡¨ï¼Œä¸ºä¸‹æ¬¡ rehash åšå‡†å¤‡ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230921104216278.png" alt="image-20230921104216278"></p><p>è¿™ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥ç®€å•ï¼Œä½†æ˜¯å…¶å®ç¬¬äºŒæ­¥å¾ˆæœ‰é—®é¢˜ï¼Œ<strong>å¦‚æœã€Œå“ˆå¸Œè¡¨ 1 ã€çš„æ•°æ®é‡éå¸¸å¤§ï¼Œé‚£ä¹ˆåœ¨è¿ç§»è‡³ã€Œå“ˆå¸Œè¡¨ 2 ã€çš„æ—¶å€™ï¼Œå› ä¸ºä¼šæ¶‰åŠå¤§é‡çš„æ•°æ®æ‹·è´ï¼Œæ­¤æ—¶å¯èƒ½ä¼šå¯¹ Redis é€ æˆé˜»å¡ï¼Œæ— æ³•æœåŠ¡å…¶ä»–è¯·æ±‚</strong>ã€‚</p><h4 id="æ¸è¿›å¼-rehashæ“ä½œï¼š"><a href="#æ¸è¿›å¼-rehashæ“ä½œï¼š" class="headerlink" title="æ¸è¿›å¼ rehashæ“ä½œï¼š"></a>æ¸è¿›å¼ rehashæ“ä½œï¼š</h4><p>â€‹ä¸ºäº†é¿å… rehash åœ¨æ•°æ®è¿ç§»è¿‡ç¨‹ä¸­ï¼Œå› æ‹·è´æ•°æ®çš„è€—æ—¶ï¼Œå½±å“ Redis æ€§èƒ½çš„æƒ…å†µï¼Œæ‰€ä»¥ Redis é‡‡ç”¨äº†<strong>æ¸è¿›å¼ rehash</strong>ï¼Œä¹Ÿå°±æ˜¯<u>å°†æ•°æ®çš„è¿ç§»çš„å·¥ä½œä¸å†æ˜¯ä¸€æ¬¡æ€§è¿ç§»å®Œæˆï¼Œè€Œæ˜¯åˆ†å¤šæ¬¡è¿ç§»ã€‚</u></p><p>â€‹æ¸è¿›å¼ rehash æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li><p>ç»™ã€Œå“ˆå¸Œè¡¨ 2ã€ åˆ†é…ç©ºé—´ï¼›</p></li><li><p><strong>åœ¨ rehash è¿›è¡ŒæœŸé—´ï¼Œæ¯æ¬¡å“ˆå¸Œè¡¨å…ƒç´ è¿›è¡Œæ–°å¢ã€åˆ é™¤ã€æŸ¥æ‰¾æˆ–è€…æ›´æ–°æ“ä½œæ—¶ï¼ŒRedis é™¤äº†ä¼šæ‰§è¡Œå¯¹åº”çš„æ“ä½œä¹‹å¤–ï¼Œè¿˜ä¼šé¡ºåºå°†ã€Œå“ˆå¸Œè¡¨ 1 ã€ä¸­ç´¢å¼•ä½ç½®ä¸Šçš„æ‰€æœ‰ key-value è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ ä¸Š</strong>ï¼›</p></li><li><p>éšç€å¤„ç†å®¢æˆ·ç«¯å‘èµ·çš„å“ˆå¸Œè¡¨æ“ä½œè¯·æ±‚æ•°é‡è¶Šå¤šï¼Œæœ€ç»ˆåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¼šæŠŠã€Œå“ˆå¸Œè¡¨ 1 ã€çš„æ‰€æœ‰ key-value è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ï¼Œä»è€Œå®Œæˆ rehash æ“ä½œã€‚</p></li><li><p>âš ï¸åœ¨è¿›è¡Œæ¸è¿›å¼ rehash çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œæ‰€ä»¥åœ¨æ¸è¿›å¼ rehash è¿›è¡ŒæœŸé—´ï¼Œå“ˆå¸Œè¡¨å…ƒç´ çš„åˆ é™¤ã€æŸ¥æ‰¾ã€æ›´æ–°ç­‰æ“ä½œéƒ½ä¼šåœ¨è¿™ä¸¤ä¸ªå“ˆå¸Œè¡¨è¿›è¡Œã€‚</p></li><li><p>âš ï¸åœ¨æ¸è¿›å¼ rehash è¿›è¡ŒæœŸé—´ï¼Œæ–°å¢ä¸€ä¸ª key-value æ—¶ï¼Œä¼šè¢«ä¿å­˜åˆ°ã€Œå“ˆå¸Œè¡¨ 2 ã€é‡Œé¢ï¼Œè€Œã€Œå“ˆå¸Œè¡¨ 1ã€ åˆ™ä¸å†è¿›è¡Œä»»ä½•æ·»åŠ æ“ä½œï¼Œè¿™æ ·ä¿è¯äº†ã€Œå“ˆå¸Œè¡¨ 1 ã€çš„ key-value æ•°é‡åªä¼šå‡å°‘ï¼Œéšç€ rehash æ“ä½œçš„å®Œæˆï¼Œæœ€ç»ˆã€Œå“ˆå¸Œè¡¨ 1 ã€å°±ä¼šå˜æˆç©ºè¡¨</p></li></ul><h3 id="æ•´æ•°é›†åˆï¼š"><a href="#æ•´æ•°é›†åˆï¼š" class="headerlink" title="æ•´æ•°é›†åˆï¼š"></a>æ•´æ•°é›†åˆï¼š</h3><p>â€‹æ•´æ•°é›†åˆæ˜¯ Set å¯¹è±¡çš„åº•å±‚å®ç°ä¹‹ä¸€ã€‚å½“ä¸€ä¸ª Set å¯¹è±¡åªåŒ…å«æ•´æ•°å€¼å…ƒç´ ï¼Œå¹¶ä¸”å…ƒç´ æ•°é‡ä¸å¤§æ—¶ï¼Œå°±ä¼šä½¿ç”¨æ•´æ•°é›†è¿™ä¸ªæ•°æ®ç»“æ„ä½œä¸ºåº•å±‚å®ç°ã€‚</p><p>æ•´æ•°é›†åˆæœ¬è´¨ä¸Šæ˜¯ä¸€å—è¿ç»­å†…å­˜ç©ºé—´ï¼Œå®ƒçš„ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">intset</span> &#123;</span></span><br><span class="line">    <span class="comment">//ç¼–ç æ–¹å¼</span></span><br><span class="line">    <span class="type">uint32_t</span> encoding;</span><br><span class="line">    <span class="comment">//é›†åˆåŒ…å«çš„å…ƒç´ æ•°é‡</span></span><br><span class="line">    <span class="type">uint32_t</span> length;</span><br><span class="line">    <span class="comment">//ä¿å­˜å…ƒç´ çš„æ•°ç»„</span></span><br><span class="line">    <span class="type">int8_t</span> contents[];</span><br><span class="line">&#125; intset;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„ contents[]æ•°ç»„ çš„æ•°æ®ç±»å‹æ ¹æ®encoding å±æ€§å€¼ï¼Œencoding å±æ€§å€¼æ˜¯ä»€ä¹ˆï¼Œcontentæ•°ç»„ç±»å‹å°±æ˜¯ä»€ä¹ˆã€‚</p><h4 id="æ•´æ•°é›†åˆçš„å‡çº§æ“ä½œï¼š"><a href="#æ•´æ•°é›†åˆçš„å‡çº§æ“ä½œï¼š" class="headerlink" title="æ•´æ•°é›†åˆçš„å‡çº§æ“ä½œï¼š"></a>æ•´æ•°é›†åˆçš„å‡çº§æ“ä½œï¼š</h4><h5 id="è¯¦ç»†å®šä¹‰ï¼š"><a href="#è¯¦ç»†å®šä¹‰ï¼š" class="headerlink" title="è¯¦ç»†å®šä¹‰ï¼š"></a>è¯¦ç»†å®šä¹‰ï¼š</h5><p>â€‹æ•´æ•°é›†åˆä¼šæœ‰ä¸€ä¸ªå‡çº§è§„åˆ™ï¼Œå°±æ˜¯å½“æˆ‘ä»¬å°†ä¸€ä¸ªæ–°å…ƒç´ åŠ å…¥åˆ°æ•´æ•°é›†åˆé‡Œé¢ï¼Œå¦‚æœæ–°å…ƒç´ çš„ç±»å‹ï¼ˆint32_tï¼‰æ¯”æ•´æ•°é›†åˆç°æœ‰æ‰€æœ‰å…ƒç´ çš„ç±»å‹ï¼ˆint16_tï¼‰éƒ½è¦é•¿æ—¶ï¼Œæ•´æ•°é›†åˆéœ€è¦å…ˆè¿›è¡Œå‡çº§ï¼Œä¹Ÿå°±æ˜¯æŒ‰æ–°å…ƒç´ çš„ç±»å‹ï¼ˆint32_tï¼‰æ‰©å±• contents æ•°ç»„çš„ç©ºé—´å¤§å°ï¼Œç„¶åæ‰èƒ½å°†æ–°å…ƒç´ åŠ å…¥åˆ°æ•´æ•°é›†åˆé‡Œï¼Œå½“ç„¶å‡çº§çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿè¦ç»´æŒæ•´æ•°é›†åˆçš„æœ‰åºæ€§ã€‚</p><p>æ‰©å®¹è¿‡ç¨‹ï¼š</p><pre><code>1. åœ¨åŸæœ¬ç©ºé—´çš„åŸºç¡€ä¸Šå¼€è¾Ÿéœ€è¦çš„ç©ºé—´ éœ€è¦æ–°å¢çš„ç©ºé—´ = n * æ–°çš„å¤§å° - (n - 1) * åŸæœ¬å¤§å°2. ä»åå¾€å‰ä¾æ¬¡å°†æ¯ä¸ªå…ƒç´ æ‰©å®¹ï¼Œå¦‚å›¾ï¼š</code></pre><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230921110447679.png" alt="image-20230921110447679" style="zoom:50%;" /><p>æ•´æ•°é›†åˆå‡çº§æœºåˆ¶çš„ä¼˜ç‚¹æ˜¯ï¼šå¦‚æœä¸€ç›´æ·»åŠ å°å…ƒç´ (å¦‚ int16_t)ï¼Œå°±ä¼šä½¿ç”¨16ä½å­˜å‚¨ä¸€ä¸ªå…ƒç´ ï¼Œç›´åˆ°æœ‰å­˜å‚¨æ›´å¤§çš„æ•°æ®ç±»å‹çš„éœ€æ±‚æ—¶æ‰ä¼šå‡çº§ï¼Œèƒ½å¤Ÿ**<u>èŠ‚çœå†…å­˜èµ„æº(æŒ‰éœ€å¼€è¾Ÿå†…å­˜ç©ºé—´)</u>**</p><p>æ•´æ•°é›†åˆ<strong>ä¸æ”¯æŒé™çº§æ“ä½œ</strong>ï¼Œä¸€æ—¦å¯¹æ•°ç»„è¿›è¡Œäº†å‡çº§ï¼Œå°±ä¼šä¸€ç›´ä¿æŒå‡çº§åçš„çŠ¶æ€ã€‚</p><h3 id="è·³è¡¨ï¼š"><a href="#è·³è¡¨ï¼š" class="headerlink" title="è·³è¡¨ï¼š"></a>è·³è¡¨ï¼š</h3><p>â€‹Redis åªæœ‰ Zset(sorted set) å¯¹è±¡çš„åº•å±‚å®ç°ç”¨åˆ°äº†è·³è¡¨ï¼Œè·³è¡¨çš„ä¼˜åŠ¿æ˜¯èƒ½æ”¯æŒå¹³å‡ O(logN) å¤æ‚åº¦çš„èŠ‚ç‚¹æŸ¥æ‰¾ã€‚</p><p>â€‹zset ç»“æ„ä½“é‡Œæœ‰ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼šä¸€ä¸ªæ˜¯è·³è¡¨(for èŒƒå›´æŸ¥è¯¢)ï¼Œä¸€ä¸ªæ˜¯å“ˆå¸Œè¡¨(for å•ç‚¹æŸ¥è¯¢)ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯æ—¢èƒ½è¿›è¡Œé«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢ï¼Œä¹Ÿèƒ½è¿›è¡Œé«˜æ•ˆå•ç‚¹æŸ¥è¯¢ã€‚**<u>Zset å¯¹è±¡åœ¨æ‰§è¡Œæ•°æ®æ’å…¥æˆ–æ˜¯æ•°æ®æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä¾æ¬¡åœ¨è·³è¡¨å’Œå“ˆå¸Œè¡¨ä¸­æ’å…¥æˆ–æ›´æ–°ç›¸åº”çš„æ•°æ®ï¼Œä»è€Œä¿è¯äº†è·³è¡¨å’Œå“ˆå¸Œè¡¨ä¸­è®°å½•çš„ä¿¡æ¯ä¸€è‡´ã€‚</u>**</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zset</span> &#123;</span></span><br><span class="line">  <span class="comment">//hashè¡¨</span></span><br><span class="line">    dict *dict;</span><br><span class="line">  <span class="comment">//è·³è¡¨</span></span><br><span class="line">    zskiplist *zsl;</span><br><span class="line">&#125; zset;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230921141533670.png" alt="image-20230921141533670"></p><h4 id="è·³è¡¨ç»“æ„ä½“ï¼š"><a href="#è·³è¡¨ç»“æ„ä½“ï¼š" class="headerlink" title="è·³è¡¨ç»“æ„ä½“ï¼š"></a>è·³è¡¨ç»“æ„ä½“ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplist</span> &#123;</span></span><br><span class="line">  <span class="comment">//è·³è¡¨çš„å¤´å°¾èŠ‚ç‚¹ï¼Œä¾¿äºåœ¨O(1)æ—¶é—´å¤æ‚åº¦å†…è®¿é—®è·³è¡¨çš„å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹ï¼›</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">header</span>, *<span class="title">tail</span>;</span></span><br><span class="line">  <span class="comment">//è·³è¡¨çš„é•¿åº¦ï¼Œä¾¿äºåœ¨O(1)æ—¶é—´å¤æ‚åº¦è·å–è·³è¡¨èŠ‚ç‚¹çš„æ•°é‡ï¼›</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> length;</span><br><span class="line">  <span class="comment">//è·³è¡¨çš„æœ€å¤§å±‚æ•°ï¼Œä¾¿äºåœ¨O(1)æ—¶é—´å¤æ‚åº¦è·å–è·³è¡¨ä¸­å±‚é«˜æœ€å¤§çš„é‚£ä¸ªèŠ‚ç‚¹çš„å±‚æ•°é‡ï¼›</span></span><br><span class="line">    <span class="type">int</span> level;</span><br><span class="line">&#125; zskiplist;</span><br></pre></td></tr></table></figure><h4 id="è·³è¡¨çš„èŠ‚ç‚¹ç»“æ„ï¼š"><a href="#è·³è¡¨çš„èŠ‚ç‚¹ç»“æ„ï¼š" class="headerlink" title="è·³è¡¨çš„èŠ‚ç‚¹ç»“æ„ï¼š"></a>è·³è¡¨çš„èŠ‚ç‚¹ç»“æ„ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> &#123;</span></span><br><span class="line">    <span class="comment">//Zset å¯¹è±¡çš„å…ƒç´ å€¼</span></span><br><span class="line">    sds ele;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//å…ƒç´ æƒé‡å€¼</span></span><br><span class="line">    <span class="type">double</span> score;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//åå‘æŒ‡é’ˆ</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">backward</span>;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹çš„levelæ•°ç»„ï¼Œä¿å­˜æ¯å±‚ä¸Šçš„å‰å‘æŒ‡é’ˆå’Œè·¨åº¦</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistLevel</span> &#123;</span></span><br><span class="line">      <span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªè·³è¡¨èŠ‚ç‚¹çš„æŒ‡é’ˆ</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">forward</span>;</span></span><br><span class="line">        <span class="comment">//å…ƒç´ ä¹‹é—´çš„è·¨åº¦</span></span><br><span class="line">      <span class="type">unsigned</span> <span class="type">long</span> span;</span><br><span class="line">    &#125; level[];</span><br><span class="line">&#125; zskiplistNode;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œspan(è·¨åº¦)ç”¨äºæŸ¥æ‰¾æ’åä¸ºkçš„å…ƒç´ </p><h4 id="è·³è¡¨èŠ‚ç‚¹æŸ¥è¯¢è¿‡ç¨‹"><a href="#è·³è¡¨èŠ‚ç‚¹æŸ¥è¯¢è¿‡ç¨‹" class="headerlink" title="è·³è¡¨èŠ‚ç‚¹æŸ¥è¯¢è¿‡ç¨‹"></a>è·³è¡¨èŠ‚ç‚¹æŸ¥è¯¢è¿‡ç¨‹</h4><p>æŸ¥æ‰¾ä¸€ä¸ªè·³è¡¨èŠ‚ç‚¹çš„è¿‡ç¨‹æ—¶ï¼Œè·³è¡¨ä¼š<strong>ä»å¤´èŠ‚ç‚¹çš„æœ€é«˜å±‚å¼€å§‹</strong>ï¼Œé€ä¸€éå†æ¯ä¸€å±‚ã€‚åœ¨éå†æŸä¸€å±‚çš„è·³è¡¨èŠ‚ç‚¹æ—¶ï¼Œä¼šç”¨è·³è¡¨èŠ‚ç‚¹ä¸­çš„ SDS ç±»å‹çš„å…ƒç´ å’Œå…ƒç´ çš„æƒé‡æ¥è¿›è¡Œåˆ¤æ–­ï¼Œå…±æœ‰ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶ï¼š</p><ul><li>å¦‚æœå½“å‰èŠ‚ç‚¹çš„æƒé‡ã€Œå°äºã€è¦æŸ¥æ‰¾çš„æƒé‡(ä¹Ÿå°±æ˜¯score)æ—¶ï¼Œè·³è¡¨å°±ä¼šè®¿é—®è¯¥å±‚ä¸Šçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li><li>å¦‚æœå½“å‰èŠ‚ç‚¹çš„æƒé‡ã€Œç­‰äºã€è¦æŸ¥æ‰¾çš„æƒé‡æ—¶ï¼Œå¹¶ä¸”å½“å‰èŠ‚ç‚¹çš„ SDS ç±»å‹æ•°æ®ã€Œå°äºã€è¦æŸ¥æ‰¾çš„æ•°æ®æ—¶ï¼Œè·³è¡¨å°±ä¼šè®¿é—®è¯¥å±‚ä¸Šçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li></ul><p>å¦‚æœä¸Šé¢ä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºæ—¶ï¼Œè·³è¡¨å°±ä¼šä½¿ç”¨ç›®å‰éå†åˆ°çš„èŠ‚ç‚¹çš„ level æ•°ç»„é‡Œçš„ä¸‹ä¸€å±‚æŒ‡é’ˆï¼Œç„¶åæ²¿ç€ä¸‹ä¸€å±‚æŒ‡é’ˆç»§ç»­æŸ¥æ‰¾ï¼Œè¿™å°±ç›¸å½“äºè·³åˆ°äº†ä¸‹ä¸€å±‚æ¥ç€æŸ¥æ‰¾ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230921142002848.png" alt="image-20230921142002848"></p><h4 id="è·³è¡¨èŠ‚ç‚¹å±‚æ•°è®¾ç½®ï¼š"><a href="#è·³è¡¨èŠ‚ç‚¹å±‚æ•°è®¾ç½®ï¼š" class="headerlink" title="è·³è¡¨èŠ‚ç‚¹å±‚æ•°è®¾ç½®ï¼š"></a>è·³è¡¨èŠ‚ç‚¹å±‚æ•°è®¾ç½®ï¼š</h4><p>â€‹è·³è¡¨çš„ç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡çš„æ¯”ä¾‹ä¼šå½±å“è·³è¡¨çš„æŸ¥è¯¢æ€§èƒ½ã€‚</p><p>â€‹**è·³è¡¨çš„ç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡æœ€ç†æƒ³çš„æ¯”ä¾‹æ˜¯ 2:1ï¼ŒæŸ¥æ‰¾å¤æ‚åº¦å¯ä»¥é™ä½åˆ° O(logN)**ã€‚</p><p>â€‹ä½†æ˜¯2:1çš„èŠ‚ç‚¹æ•°é‡æ¯”å€¼ä¸æ˜“ç»´æŠ¤ï¼Œå¦‚æœé‡‡ç”¨æ–°å¢èŠ‚ç‚¹æˆ–è€…åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œæ¥è°ƒæ•´è·³è¡¨èŠ‚ç‚¹ä»¥ç»´æŒæ¯”ä¾‹çš„æ–¹æ³•çš„è¯ï¼Œä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ã€‚</p><p>redisä½¿ç”¨ä¸€ç§å·§å¦™çš„æ–¹æ³•ï¼š</p><ul><li><strong>è·³è¡¨åœ¨åˆ›å»ºèŠ‚ç‚¹çš„æ—¶å€™ï¼Œéšæœºç”Ÿæˆæ¯ä¸ªèŠ‚ç‚¹çš„å±‚æ•°</strong>ï¼Œå¹¶æ²¡æœ‰ä¸¥æ ¼ç»´æŒç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡æ¯”ä¾‹ä¸º 2 : 1 çš„æƒ…å†µã€‚</li><li>å…·ä½“çš„åšæ³•æ˜¯ï¼Œ<strong>è·³è¡¨åœ¨åˆ›å»ºèŠ‚ç‚¹æ—¶å€™ï¼Œä¼šç”ŸæˆèŒƒå›´ä¸º[0-1]çš„ä¸€ä¸ªéšæœºæ•°ï¼Œå¦‚æœè¿™ä¸ªéšæœºæ•°å°äº 0.25ï¼ˆç›¸å½“äºæ¦‚ç‡ 25%ï¼‰ï¼Œé‚£ä¹ˆå±‚æ•°å°±å¢åŠ  1 å±‚ï¼Œç„¶åç»§ç»­ç”Ÿæˆä¸‹ä¸€ä¸ªéšæœºæ•°ï¼Œç›´åˆ°éšæœºæ•°çš„ç»“æœå¤§äº 0.25 ç»“æŸï¼Œæœ€ç»ˆç¡®å®šè¯¥èŠ‚ç‚¹çš„å±‚æ•°</strong>ã€‚</li></ul><h4 id="ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ"></a>ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ</h4><ul><li><strong>ä»å†…å­˜å ç”¨ä¸Šæ¥æ¯”è¾ƒï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘æ›´çµæ´»ä¸€äº›</strong>ã€‚å¹³è¡¡æ ‘æ¯ä¸ªèŠ‚ç‚¹åŒ…å« 2 ä¸ªæŒ‡é’ˆï¼ˆåˆ†åˆ«æŒ‡å‘å·¦å³å­æ ‘ï¼‰ï¼Œè€Œè·³è¡¨æ¯ä¸ªèŠ‚ç‚¹åŒ…å«çš„æŒ‡é’ˆæ•°ç›®å¹³å‡ä¸º 1&#x2F;(1-p)ï¼Œå…·ä½“å–å†³äºå‚æ•° p çš„å¤§å°ã€‚å¦‚æœåƒ Redisé‡Œçš„å®ç°ä¸€æ ·ï¼Œå– p&#x3D;1&#x2F;4ï¼Œé‚£ä¹ˆå¹³å‡æ¯ä¸ªèŠ‚ç‚¹åŒ…å« 1.33 ä¸ªæŒ‡é’ˆï¼Œæ¯”å¹³è¡¡æ ‘æ›´æœ‰ä¼˜åŠ¿ã€‚</li><li><strong>åœ¨åš<u>èŒƒå›´æŸ¥æ‰¾</u>çš„æ—¶å€™ï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘æ“ä½œè¦ç®€å•</strong>ã€‚åœ¨å¹³è¡¡æ ‘ä¸Šï¼Œæˆ‘ä»¬æ‰¾åˆ°æŒ‡å®šèŒƒå›´çš„å°å€¼ä¹‹åï¼Œè¿˜éœ€è¦ä»¥ä¸­åºéå†çš„é¡ºåºç»§ç»­å¯»æ‰¾å…¶å®ƒä¸è¶…è¿‡å¤§å€¼çš„èŠ‚ç‚¹ã€‚å¦‚æœä¸å¯¹å¹³è¡¡æ ‘è¿›è¡Œä¸€å®šçš„æ”¹é€ ï¼Œè¿™é‡Œçš„ä¸­åºéå†å¹¶ä¸å®¹æ˜“å®ç°ã€‚è€Œåœ¨è·³è¡¨ä¸Šè¿›è¡ŒèŒƒå›´æŸ¥æ‰¾å°±éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨æ‰¾åˆ°å°å€¼ä¹‹åï¼Œå¯¹ç¬¬ 1 å±‚é“¾è¡¨è¿›è¡Œè‹¥å¹²æ­¥çš„éå†å°±å¯ä»¥å®ç°ã€‚</li><li><strong>ä»ç®—æ³•å®ç°éš¾åº¦ä¸Šæ¥æ¯”è¾ƒï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘è¦ç®€å•å¾—å¤š</strong>ã€‚å¹³è¡¡æ ‘çš„æ’å…¥å’Œåˆ é™¤æ“ä½œå¯èƒ½å¼•å‘å­æ ‘çš„è°ƒæ•´ï¼Œé€»è¾‘å¤æ‚ï¼Œè€Œè·³è¡¨çš„æ’å…¥å’Œåˆ é™¤åªéœ€è¦ä¿®æ”¹ç›¸é‚»èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæ“ä½œç®€å•åˆå¿«é€Ÿã€‚</li></ul><h4 id="ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸åƒinnodbä¸­ä½¿ç”¨B-æ ‘ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸åƒinnodbä¸­ä½¿ç”¨B-æ ‘ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸åƒinnodbä¸­ä½¿ç”¨B+æ ‘ï¼Ÿ"></a>ä¸ºä»€ä¹ˆç”¨è·³è¡¨è€Œä¸åƒinnodbä¸­ä½¿ç”¨B+æ ‘ï¼Ÿ</h4><ul><li>å®ç°ç®€å•ï¼šè·³è¡¨æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„æ•°æ®ç»“æ„ï¼Œå®ç°èµ·æ¥æ¯”B+æ ‘è¦ç®€å•ã€‚å®ƒä¸éœ€è¦åƒB+æ ‘é‚£æ ·éœ€è¦å¤æ‚çš„å¹³è¡¡æ“ä½œï¼ˆå¦‚æ—‹è½¬ã€åˆå¹¶ç­‰ï¼‰ï¼Œå› æ­¤ä»£ç å®ç°ä¹Ÿç›¸å¯¹è¾ƒç®€å•ã€‚</li><li>å†…å­˜å ç”¨å°‘ï¼šè·³è¡¨ç›¸å¯¹äºB+æ ‘æ¥è¯´ï¼Œåœ¨ç›¸åŒæœ‰åºé›†åˆçš„æƒ…å†µä¸‹ï¼Œå ç”¨çš„å†…å­˜æ›´å°‘ã€‚è·³è¡¨ä¸éœ€è¦å­˜å‚¨é¢å¤–çš„ç´¢å¼•ï¼Œä»…ä½¿ç”¨ä¸€çº§ç´¢å¼•å³å¯ï¼Œè€ŒB+æ ‘éœ€è¦å­˜å‚¨å¤šå±‚ç´¢å¼•ã€‚</li><li>æŸ¥è¯¢æ•ˆç‡é«˜ï¼šè™½ç„¶B+æ ‘åœ¨å¤§è§„æ¨¡æ•°æ®ä¸Šçš„æŸ¥è¯¢æ•ˆç‡æ›´é«˜ï¼Œä½†åœ¨å®é™…çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œæœ‰åºé›†åˆçš„è§„æ¨¡é€šå¸¸ä¸ä¼šå¾ˆå¤§ï¼Œè€Œè·³è¡¨åœ¨å°è§„æ¨¡æ•°æ®ä¸Šçš„æŸ¥è¯¢æ•ˆç‡æ›´é«˜ã€‚<ul><li>å¹¶ä¸”ï¼Œè™½ç„¶è·³è¡¨çš„å±‚æ•°é€šå¸¸æƒ…å†µä¸‹ä¼šå¤§äºB+æ ‘ï¼Œä½†æ˜¯ç”±äºredisæ•°æ®å­˜å‚¨äºå†…å­˜ä¸­ï¼Œä¸ä¼šåƒmysqlä¸€æ ·è¯»å–å…ƒç´ æ—¶è¿˜éœ€è¦èŠ±è´¹IOæ—¶é—´ï¼Œæ‰€ä»¥å¿«è¡¨åˆè½»åˆå¿«ï¼Œå½“ç„¶å¥½å•¦ã€‚</li></ul></li><li>ç®€å•çš„åˆ†å¸ƒç®—æ³•ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œè·³è¡¨çš„åˆ’åˆ†å’Œæ’åºç®—æ³•ç›¸å¯¹æ¥è¯´è¾ƒä¸ºç®€å•ï¼Œä¸éœ€è¦å¤æ‚çš„åˆ†å‰²å’Œåˆå¹¶æ“ä½œï¼Œå¯ä»¥æ›´è½»æ¾åœ°å®ç°å’Œç»´æŠ¤åˆ†å¸ƒå¼çš„æœ‰åºé›†åˆã€‚</li></ul><h3 id="quicklistï¼š"><a href="#quicklistï¼š" class="headerlink" title="quicklistï¼š"></a>quicklistï¼š</h3><p>â€‹åœ¨ Redis 3.0 ä¹‹å‰ï¼ŒList å¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯åŒå‘é“¾è¡¨æˆ–è€…å‹ç¼©åˆ—è¡¨ã€‚ç„¶ååœ¨ Redis 3.2 çš„æ—¶å€™ï¼ŒList å¯¹è±¡çš„åº•å±‚æ”¹ç”± quicklist æ•°æ®ç»“æ„å®ç°ã€‚</p><p>ç®€å•æ¥è¯´quicklistä¸º åŒå‘é“¾è¡¨+å‹ç¼©åˆ—è¡¨çš„ç»„åˆï¼</p><p>â€‹<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230921151653568.png" alt="image-20230921151653568" style="zoom:50%;" /></p><p>quicklist<strong>é€šè¿‡æ§åˆ¶æ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹ä¸­çš„å‹ç¼©åˆ—è¡¨çš„å¤§å°æˆ–è€…å…ƒç´ ä¸ªæ•°ï¼Œæ¥è§„é¿è¿é”æ›´æ–°çš„é—®é¢˜ã€‚å› ä¸ºå‹ç¼©åˆ—è¡¨å…ƒç´ è¶Šå°‘æˆ–è¶Šå°ï¼Œè¿é”æ›´æ–°å¸¦æ¥çš„å½±å“å°±è¶Šå°ï¼Œä»è€Œæä¾›äº†æ›´å¥½çš„è®¿é—®æ€§èƒ½ã€‚</strong></p><p>åœ¨å‘ quicklist æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œä¸ä¼šåƒæ™®é€šçš„é“¾è¡¨é‚£æ ·ï¼Œç›´æ¥æ–°å»ºä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ã€‚è€Œæ˜¯ä¼š<u>æ£€æŸ¥æ’å…¥ä½ç½®çš„å‹ç¼©åˆ—è¡¨æ˜¯å¦èƒ½å®¹çº³è¯¥å…ƒç´ ï¼Œå¦‚æœèƒ½å®¹çº³å°±ç›´æ¥ä¿å­˜åˆ° quicklistNode ç»“æ„é‡Œçš„å‹ç¼©åˆ—è¡¨ï¼Œå¦‚æœä¸èƒ½å®¹çº³ï¼Œæ‰ä¼šæ–°å»ºä¸€ä¸ªæ–°çš„ quicklistNode ç»“æ„ã€‚</u></p><p>quicklist ä¼šæ§åˆ¶ quicklistNode ç»“æ„é‡Œçš„å‹ç¼©åˆ—è¡¨çš„å¤§å°æˆ–è€…å…ƒç´ ä¸ªæ•°ï¼Œæ¥è§„é¿æ½œåœ¨çš„è¿é”æ›´æ–°çš„é£é™©ï¼Œä½†æ˜¯è¿™å¹¶æ²¡æœ‰å®Œå…¨è§£å†³è¿é”æ›´æ–°çš„é—®é¢˜ã€‚</p><h3 id="listpackï¼š"><a href="#listpackï¼š" class="headerlink" title="listpackï¼š"></a>listpackï¼š</h3><p>â€‹æ˜¯å‹ç¼©è¡¨çš„æ–°ç‰ˆæœ¬å®ç°æ–¹å¼</p><p>â€‹å› ä¸ºåŸæ¥ç‰ˆæœ¬çš„å‹ç¼©åˆ—è¡¨ä¸­<strong>è®°å½•äº†å‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦ï¼Œå³prevlenå­—æ®µ</strong>(è®¾ç½®è¿™ä¸ªå­—æ®µæ˜¯ä¸ºäº†å®ç°èŠ‚ç‚¹ä»åå¾€å‰éå†)ï¼Œä¼šå› ä¸ºå‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦ &gt;&#x3D; 254è€Œäº§ç”Ÿè¿é”æ›´æ–°çš„éšæ‚£ï¼Œåœ¨listpackä¸­ï¼Œå–æ¶ˆäº†è¿™ä¸€å­—æ®µï¼Œå› æ­¤æ¶ˆé™¤äº†è¿™ä¸€éšæ‚£ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230921151534614.png" alt="image-20230921151534614"></p><p><code>listpack</code>é‡‡ç”¨äº†ä¸€ç§é€†åºéå†çš„æ–¹å¼æ¥ä½¿èŠ‚ç‚¹èƒ½å¤Ÿä»åå¾€å‰è®¿é—®ã€‚ä¸»è¦é€šè¿‡é€†åºéå†listpackï¼Œé€šè¿‡listpackçš„ç»“å°¾æ ‡è¯†æ¥å¾—åˆ°å‰é¢èŠ‚ç‚¹çš„é•¿åº¦ï¼Œä»è€Œå®ç°é€†åºéå†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">åœ¨`listpack`ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„æœ«å°¾éƒ½ä¼šæœ‰ä¸€ä¸ªå­—èŠ‚ï¼Œç”¨äºæŒ‡ç¤ºå½“å‰èŠ‚ç‚¹çš„ç±»å‹ã€‚å¦‚æœè¯¥å­—èŠ‚å¤§äºç­‰äº240ï¼Œå®ƒå°†ä½œä¸ºä¸€ä¸ªç‰¹æ®Šå­—èŠ‚ï¼Œè¡¨ç¤ºå½“å‰èŠ‚ç‚¹æ˜¯åˆ—è¡¨ä¸­çš„ä¸€ä¸ªç¨€ç–å€¼æˆ–å“¨å…µèŠ‚ç‚¹ã€‚å¯¹äºæ­£å¸¸çš„åˆ—è¡¨é¡¹èŠ‚ç‚¹ï¼Œè¯¥å­—èŠ‚çš„å–å€¼èŒƒå›´æ˜¯0åˆ°239ã€‚</span><br><span class="line"></span><br><span class="line">é€†åºéå†`listpack`ä¸­çš„èŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š</span><br><span class="line"></span><br><span class="line">1. è·å–`listpack`çš„æ€»é•¿åº¦ `total_length`ã€‚</span><br><span class="line">2. ä» `total_length - 1` å¼€å§‹ï¼ŒæŒ‰ç…§å­—èŠ‚é€’å‡çš„æ–¹å¼ä¾æ¬¡å¤„ç†æ¯ä¸ªèŠ‚ç‚¹ã€‚</span><br><span class="line">3. å¦‚æœé‡åˆ°ä¸€ä¸ªç‰¹æ®Šå­—èŠ‚ï¼ˆå¤§äºç­‰äº240ï¼‰ï¼Œåˆ™è¡¨ç¤ºå½“å‰èŠ‚ç‚¹æ˜¯ä¸€ä¸ªç¨€ç–å€¼æˆ–å“¨å…µèŠ‚ç‚¹ï¼Œå¯ä»¥æ ¹æ®æƒ…å†µè¿›è¡Œå¤„ç†ã€‚</span><br><span class="line">4. å¦‚æœé‡åˆ°ä¸€ä¸ªæ­£å¸¸çš„åˆ—è¡¨é¡¹èŠ‚ç‚¹ï¼ˆå­—èŠ‚å€¼åœ¨0åˆ°239ä¹‹é—´ï¼‰ï¼Œåˆ™è§£æå‡ºèŠ‚ç‚¹çš„æ•°æ®ï¼Œå¹¶æŒ‰ç…§ç›¸åº”çš„é•¿åº¦è¿›è¡Œå¤„ç†ã€‚</span><br></pre></td></tr></table></figure><h2 id="Redisæ•°æ®å„ç±»å‹åº•å±‚å®ç°ï¼š"><a href="#Redisæ•°æ®å„ç±»å‹åº•å±‚å®ç°ï¼š" class="headerlink" title="Redisæ•°æ®å„ç±»å‹åº•å±‚å®ç°ï¼š"></a>Redisæ•°æ®å„ç±»å‹åº•å±‚å®ç°ï¼š</h2><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/%E6%9C%AA%E5%91%BD%E5%90%8D.png" alt="æœªå‘½å"></p><h3 id="Stringï¼š"><a href="#Stringï¼š" class="headerlink" title="Stringï¼š"></a>Stringï¼š</h3><p>â€‹<u>Stringæœ€å¤§ä¸º512MB</u></p><h4 id="Stringçš„ä¸‰ç§ç¼–ç æ–¹å¼ï¼š"><a href="#Stringçš„ä¸‰ç§ç¼–ç æ–¹å¼ï¼š" class="headerlink" title="Stringçš„ä¸‰ç§ç¼–ç æ–¹å¼ï¼š"></a>Stringçš„ä¸‰ç§ç¼–ç æ–¹å¼ï¼š</h4><h5 id="1-intï¼š"><a href="#1-intï¼š" class="headerlink" title="1. intï¼š"></a>1. intï¼š</h5><p>â€‹å½“stringçš„valueæ‰§è¡Œè‡ªå¢ç­‰æ•°æ®æ“ä½œæ—¶ï¼Œä¼šè‡ªåŠ¨è½¬æ¢æˆintç±»å‹ã€‚</p><ul><li><u>intåªèƒ½å­˜æ•´æ•°ï¼Œå°æ•°ç­‰ä¼šä»¥å­—ç¬¦ä¸²å½¢å¼ä¿å­˜</u></li></ul><h5 id="2-embstrï¼š"><a href="#2-embstrï¼š" class="headerlink" title="2. embstrï¼š"></a>2. embstrï¼š</h5><p>â€‹å½“å­—ç¬¦ä¸²é•¿åº¦ &lt;&#x3D; è®¾å®šé˜ˆå€¼å­—èŠ‚æ—¶ï¼Œä½¿ç”¨embstrç¼–ç </p><h5 id="3-rawï¼š"><a href="#3-rawï¼š" class="headerlink" title="3. rawï¼š"></a>3. rawï¼š</h5><p>â€‹å½“å­—ç¬¦ä¸²é•¿åº¦ &gt; è®¾å®šé˜ˆå€¼å­—èŠ‚æ—¶ï¼Œä½¿ç”¨rawç¼–ç </p><p>Â· é˜ˆå€¼ï¼šredis3.2ä¹‹å‰ä¸º39å­—èŠ‚ï¼›redis3.2ä¹‹åä¸º44å­—èŠ‚</p><p>â“ä¸ºä»€ä¹ˆé˜ˆå€¼æ˜¯44Bï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Redisæ˜¯ä½¿ç”¨jemallocå†…å­˜åˆ†é…å™¨ï¼ŒRedisä»¥64å­—èŠ‚ä¸ºé˜ˆå€¼åŒºåˆ†å¤§å°å­—ç¬¦ä¸²ã€‚æ‰€ä»¥EMBSTRçš„è¾¹ç•Œæ•°å€¼ï¼Œå…¶å®æ˜¯å—64è¿™ä¸ªé˜ˆå€¼å½±å“ã€‚rediså¯¹è±¡å ç”¨çš„å†…å­˜å¤§å°ç”±redisObjectå’Œsdshdrè¿™ä¸¤éƒ¨åˆ†ç»„æˆï¼ŒredisObject 16å­—èŠ‚ï¼Œsdshdrä¸­å·²åˆ†é…ã€å·²ç”³è¯·ã€æ ‡è®°ä¸‰ä¸ªå­—æ®µå›ºå®šå äº†3ä¸ªå­—èŠ‚ï¼Œ&#x27;\0&#x27;å äº†ä¸€ä¸ªå­—èŠ‚ï¼Œ</span><br><span class="line">èƒ½å­˜æ”¾çš„æ•°æ®å°±æ˜¯ 64- (16+4ï¼‰ = 44 B</span><br></pre></td></tr></table></figure><h4 id="stringåº•å±‚æ„é€ ï¼š"><a href="#stringåº•å±‚æ„é€ ï¼š" class="headerlink" title="stringåº•å±‚æ„é€ ï¼š"></a>stringåº•å±‚æ„é€ ï¼š</h4><p>EMBSTRå’ŒRAWéƒ½æ˜¯ç”±redisObjectå’ŒSDSä¸¤ä¸ªç»“æ„ç»„æˆï¼Œå®ƒä»¬çš„å·®å¼‚åœ¨äºï¼š</p><ul><li>EMBSTRä¸‹redisObject å’Œ SDSæ˜¯è¿ç»­çš„å†…å­˜ï¼Œ</li><li>RAWç¼–ç ä¸‹redisObject å’Œ SDSçš„å†…å­˜æ˜¯åˆ†å¼€çš„ã€‚</li></ul><p>EMBSTRä¼˜ç‚¹æ˜¯redisObjectå’ŒSDSä¸¤ä¸ªç»“æ„å¯ä»¥ä¸€æ¬¡æ€§åˆ†é…ç©ºé—´ï¼Œç¼ºç‚¹åœ¨äºå¦‚æœé‡æ–°åˆ†é…ç©ºé—´ï¼Œæ•´ä½“éƒ½éœ€è¦å†åˆ†é…ï¼Œæ‰€ä»¥EMBSTRè®¾è®¡ä¸ºåªè¯»ï¼Œä»»ä½•å†™æ“ä½œä¹‹åEMBSTRéƒ½ä¼šå˜æˆRAWï¼Œç†å¿µæ˜¯å‘ç”Ÿè¿‡ä¿®æ”¹çš„å­—ç¬¦ä¸²é€šå¸¸ä¼šè®¤ä¸ºæ˜¯æ˜“å˜çš„ã€‚</p><p>éšç€æˆ‘ä»¬çš„æ“ä½œï¼Œç¼–ç å¯èƒ½ä¼šè½¬æ¢ï¼š</p><p>INT-&gt; RAWï¼š å½“å­˜çš„å†…å®¹ä¸å†æ˜¯æ•´æ•°ï¼Œæˆ–è€…å¤§å°è¶…è¿‡äº†longçš„æ—¶å€™ï¼›</p><p>EMBSTR-&gt;RAWï¼šä»»ä½•å†™æ“ä½œä¹‹åEMBSTRéƒ½ä¼šå˜æˆRAWï¼›</p><h3 id="Listï¼š"><a href="#Listï¼š" class="headerlink" title="Listï¼š"></a>Listï¼š</h3><p>â€‹â€“List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±<strong>åŒå‘é“¾è¡¨æˆ–å‹ç¼©åˆ—è¡¨</strong>å®ç°çš„ï¼š</p><ul><li>å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°å°äº <code>512</code> ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± <code>list-max-ziplist-entries</code> é…ç½®ï¼‰ï¼Œåˆ—è¡¨æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½å°äº <code>64</code> å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± <code>list-max-ziplist-value</code> é…ç½®ï¼‰ï¼ŒRedis ä¼šä½¿ç”¨<strong>å‹ç¼©åˆ—è¡¨</strong>ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li><li>å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>åŒå‘é“¾è¡¨</strong>ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li></ul><p>ä½†æ˜¯<strong>åœ¨ Redis 3.2 ç‰ˆæœ¬ä¹‹åï¼ŒList æ•°æ®ç±»å‹åº•å±‚æ•°æ®ç»“æ„å°±åªç”± <u>quicklist</u> å®ç°äº†ï¼Œæ›¿ä»£äº†åŒå‘é“¾è¡¨å’Œå‹ç¼©åˆ—è¡¨</strong>ã€‚</p><p>â€‹</p><h3 id="Hashï¼š"><a href="#Hashï¼š" class="headerlink" title="Hashï¼š"></a>Hashï¼š</h3><p>â€‹â€“Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±<strong>å‹ç¼©åˆ—è¡¨æˆ–å“ˆå¸Œè¡¨</strong>å®ç°çš„ï¼š</p><ul><li>å¦‚æœå“ˆå¸Œç±»å‹å…ƒç´ ä¸ªæ•°å°äº <code>512</code> ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± <code>hash-max-ziplist-entries</code> é…ç½®ï¼‰ï¼Œæ‰€æœ‰å€¼å°äº <code>64</code> å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± <code>hash-max-ziplist-value</code> é…ç½®ï¼‰çš„è¯ï¼ŒRedis ä¼šä½¿ç”¨<strong>å‹ç¼©åˆ—è¡¨</strong>ä½œä¸º Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li><li>å¦‚æœå“ˆå¸Œç±»å‹å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>å“ˆå¸Œè¡¨</strong>ä½œä¸º Hash ç±»å‹çš„ åº•å±‚æ•°æ®ç»“æ„ã€‚</li></ul><p><strong>åœ¨ Redis 7.0 ä¸­ï¼Œå‹ç¼©åˆ—è¡¨æ•°æ®ç»“æ„å·²ç»åºŸå¼ƒäº†ï¼Œäº¤ç”± <u>listpack</u> æ•°æ®ç»“æ„æ¥å®ç°äº†</strong>ã€‚</p><h3 id="Setï¼š"><a href="#Setï¼š" class="headerlink" title="Setï¼š"></a>Setï¼š</h3><p>â€‹â€“Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±<strong>å“ˆå¸Œè¡¨æˆ–æ•´æ•°é›†åˆ</strong>å®ç°çš„ï¼š</p><ul><li>å¦‚æœé›†åˆä¸­çš„å…ƒç´ éƒ½æ˜¯æ•´æ•°ä¸”å…ƒç´ ä¸ªæ•°å°äº <code>512</code> ï¼ˆé»˜è®¤å€¼ï¼Œ<code>set-maxintset-entries</code>é…ç½®ï¼‰ä¸ªï¼ŒRedis ä¼šä½¿ç”¨<strong>æ•´æ•°é›†åˆ</strong>ä½œä¸º Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li><li>å¦‚æœé›†åˆä¸­çš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢æ¡ä»¶ï¼Œåˆ™ Redis ä½¿ç”¨<strong>å“ˆå¸Œè¡¨</strong>ä½œä¸º Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ã€‚</li></ul><h3 id="Zsetï¼š"><a href="#Zsetï¼š" class="headerlink" title="Zsetï¼š"></a>Zsetï¼š</h3><p>â€‹â€“Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±<strong>å‹ç¼©åˆ—è¡¨æˆ–è·³è¡¨</strong>å®ç°çš„ï¼š</p><ul><li>å¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸ªæ•°å°äº <code>128</code> ä¸ªï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ çš„å€¼å°äº <code>64</code> å­—èŠ‚æ—¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>å‹ç¼©åˆ—è¡¨</strong>ä½œä¸º Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li><li>å¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>è·³è¡¨</strong>ä½œä¸º Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li></ul><p><strong>åœ¨ Redis 7.0 ä¸­ï¼Œå‹ç¼©åˆ—è¡¨æ•°æ®ç»“æ„å·²ç»åºŸå¼ƒäº†ï¼Œäº¤ç”± listpack æ•°æ®ç»“æ„æ¥å®ç°äº†ã€‚</strong></p><h3 id="Redis-å­˜å‚¨å¯¹è±¡ä¿¡æ¯æ˜¯ç”¨-Hash-è¿˜æ˜¯-String"><a href="#Redis-å­˜å‚¨å¯¹è±¡ä¿¡æ¯æ˜¯ç”¨-Hash-è¿˜æ˜¯-String" class="headerlink" title="Redis å­˜å‚¨å¯¹è±¡ä¿¡æ¯æ˜¯ç”¨ Hash è¿˜æ˜¯ String"></a>Redis å­˜å‚¨å¯¹è±¡ä¿¡æ¯æ˜¯ç”¨ Hash è¿˜æ˜¯ String</h3><h4 id="Stringï¼š-1"><a href="#Stringï¼š-1" class="headerlink" title="Stringï¼š"></a>Stringï¼š</h4><p>ç”±äº Redis çš„å­—ç¬¦ä¸²æ˜¯åŠ¨æ€å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä¿®æ”¹ï¼Œå†…éƒ¨ç»“æ„ç±»ä¼¼äº Java çš„ ArrayListï¼Œé‡‡ç”¨é¢„åˆ†é…å†—ä½™ç©ºé—´çš„æ–¹å¼æ¥å‡å°‘å†…å­˜çš„é¢‘ç¹åˆ†é…ã€‚</p><p>å¦‚æœæ­¤æ—¶å°†æ­¤ç”¨æˆ·ä¿¡æ¯çš„æŸä¸ªå±æ€§å€¼ä¿®æ”¹ï¼Œå†å­˜åˆ° Redis ä¸­ï¼ŒRedis æ˜¯ä¸éœ€è¦é‡æ–°åˆ†é…ç©ºé—´çš„</p><p>â€‹</p><h4 id="Hashï¼š-1"><a href="#Hashï¼š-1" class="headerlink" title="Hashï¼š"></a>Hashï¼š</h4><p>Hash ç»“æ„ä¹Ÿå¯ä»¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œä¸è¿‡æ˜¯<u>å¯¹æ¯ä¸ªå­—æ®µå•ç‹¬å­˜å‚¨ï¼Œå› æ­¤å¯ä»¥åœ¨æŸ¥è¯¢æ—¶è·å–éƒ¨åˆ†å­—æ®µçš„ä¿¡æ¯ï¼ŒèŠ‚çœç½‘ç»œæµé‡</u>ã€‚</p><p>but å¤„ç†ç±»ä¸­å±æ€§ä¸ºåˆ«çš„å¼•ç”¨å¯¹è±¡çš„åµŒå¥—çš„æƒ…å†µæ—¶æ¯”è¾ƒå¤æ‚ã€‚</p><h4 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h4><p>å»ºè®®æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½¿ç”¨ String å­˜å‚¨å°±å¥½ï¼Œæ¯•ç«Ÿåœ¨å­˜å‚¨å…·æœ‰å¤šå±‚åµŒå¥—çš„å¯¹è±¡æ—¶æ–¹ä¾¿å¾ˆå¤šï¼Œå ç”¨çš„ç©ºé—´ä¹Ÿæ¯” Hash å°ã€‚å½“æˆ‘ä»¬éœ€è¦å­˜å‚¨ä¸€ä¸ªç‰¹åˆ«å¤§çš„å¯¹è±¡æ—¶ï¼Œè€Œä¸”åœ¨å¤§å¤šæ•°æƒ…å†µä¸­åªéœ€è¦è®¿é—®è¯¥å¯¹è±¡å°‘é‡çš„å­—æ®µæ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Hashã€‚</p><h3 id="RDBä¸AOF"><a href="#RDBä¸AOF" class="headerlink" title="RDBä¸AOF"></a>RDBä¸AOF</h3><p>RDBä¸ºå¿«ç…§</p><p>AOFè®°å½•æ¯æ¡æŒ‡ä»¤</p><ul><li>Redis ä¿å­˜çš„æ•°æ®ä¸¢å¤±ä¸€äº›ä¹Ÿæ²¡ä»€ä¹ˆå½±å“çš„è¯ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ RDBã€‚</li><li>ä¸å»ºè®®å•ç‹¬ä½¿ç”¨ AOFï¼Œå› ä¸ºæ—¶ä¸æ—¶åœ°åˆ›å»ºä¸€ä¸ª RDB å¿«ç…§å¯ä»¥è¿›è¡Œæ•°æ®åº“å¤‡ä»½ã€æ›´å¿«çš„é‡å¯ä»¥åŠè§£å†³ AOF å¼•æ“é”™è¯¯ã€‚</li><li>å¦‚æœä¿å­˜çš„æ•°æ®è¦æ±‚å®‰å…¨æ€§æ¯”è¾ƒé«˜çš„è¯ï¼Œå»ºè®®åŒæ—¶å¼€å¯ RDB å’Œ AOF æŒä¹…åŒ–æˆ–è€…å¼€å¯ RDB å’Œ AOF æ··åˆæŒä¹…åŒ–ã€‚</li></ul><h3 id="Redisé˜»å¡çš„åŸå› ï¼š"><a href="#Redisé˜»å¡çš„åŸå› ï¼š" class="headerlink" title="Redisé˜»å¡çš„åŸå› ï¼š"></a>Redisé˜»å¡çš„åŸå› ï¼š</h3><ol><li><p>æ‰§è¡Œæ—¶é—´å¤æ‚åº¦ O(n)ä»¥ä¸Šçš„å‘½ä»¤ï¼Œå¦‚ï¼š</p><ul><li><p>KEYS ï¼šä¼šè¿”å›æ‰€æœ‰ç¬¦åˆè§„åˆ™çš„ keyã€‚</p></li><li><p>HGETALLï¼šä¼šè¿”å›ä¸€ä¸ª Hash ä¸­æ‰€æœ‰çš„é”®å€¼å¯¹ã€‚</p></li><li><p>LRANGEï¼šä¼šè¿”å› List ä¸­æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ã€‚</p></li><li><p>SMEMBERSï¼šè¿”å› Set ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</p></li><li><p>SINTER&#x2F;SUNION&#x2F;SDIFFï¼šè®¡ç®—å¤šä¸ª Set çš„äº¤é›†&#x2F;å¹¶é›†&#x2F;å·®é›†ã€‚</p></li></ul></li><li><p>ä½¿ç”¨saveå‘½ä»¤ç”ŸæˆRDBå¿«ç…§</p><ul><li><code>save</code> : åŒæ­¥ä¿å­˜æ“ä½œï¼Œä¼šé˜»å¡ Redis ä¸»çº¿ç¨‹ï¼›</li><li><code>bgsave</code> : fork å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡ Redis ä¸»çº¿ç¨‹ï¼Œ<strong>é»˜è®¤é€‰é¡¹</strong>ã€‚</li></ul></li><li><p>AOFé˜»å¡</p><ol><li><p>æ—¥å¿—è®°å½•é˜»å¡ï¼š</p><ul><li>å› ä¸ºAOF è®°å½•æ—¥å¿—æ˜¯åœ¨ Redis ä¸»çº¿ç¨‹ä¸­è¿›è¡Œ</li></ul></li><li><p>åˆ·ç›˜é˜»å¡ï¼š</p><ul><li>AOFæ—¥å¿—ä» AOFç¼“å†²åŒº-&gt;å†…æ ¸ç¼“å†²åŒºæ—¶ï¼Œéœ€è¦è°ƒç”¨writeå‡½æ•°ï¼Œ(ä¸»çº¿ç¨‹è°ƒç”¨ <code>write</code> å‡½æ•°æ—¶ä¹Ÿä¼šè¢«é˜»å¡)</li></ul></li><li><p>AOFé‡å†™é˜»å¡ï¼š</p><ul><li>fork å‡ºä¸€æ¡å­çº¿ç¨‹æ¥å°†æ–‡ä»¶é‡å†™ï¼Œåœ¨æ‰§è¡Œ <code>BGREWRITEAOF</code> å‘½ä»¤æ—¶ï¼ŒRedis æœåŠ¡å™¨ä¼šç»´æŠ¤ä¸€ä¸ª AOF é‡å†™ç¼“å†²åŒºï¼Œè¯¥ç¼“å†²åŒºä¼šåœ¨å­çº¿ç¨‹åˆ›å»ºæ–° AOF æ–‡ä»¶æœŸé—´ï¼Œè®°å½•æœåŠ¡å™¨æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ã€‚</li><li>å½“å­çº¿ç¨‹å®Œæˆåˆ›å»ºæ–° AOF æ–‡ä»¶çš„å·¥ä½œä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå°†é‡å†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶çš„æœ«å°¾ï¼Œä½¿å¾—æ–°çš„ AOF æ–‡ä»¶ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸ç°æœ‰çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ã€‚</li><li>æœ€åï¼ŒæœåŠ¡å™¨ç”¨æ–°çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„ AOF æ–‡ä»¶ï¼Œä»¥æ­¤æ¥å®Œæˆ AOF æ–‡ä»¶é‡å†™æ“ä½œã€‚</li></ul><p>é˜»å¡å°±æ˜¯å‡ºç°åœ¨ç¬¬ 2 æ­¥çš„è¿‡ç¨‹ä¸­ï¼Œå°†ç¼“å†²åŒºä¸­æ–°æ•°æ®å†™åˆ°æ–°æ–‡ä»¶çš„è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿ<strong>é˜»å¡</strong>ã€‚</p></li></ol></li><li><p>å¤§Key</p></li></ol><ul><li>å®¢æˆ·ç«¯è¶…æ—¶é˜»å¡ï¼šç”±äº Redis æ‰§è¡Œå‘½ä»¤æ˜¯å•çº¿ç¨‹å¤„ç†ï¼Œç„¶ååœ¨æ“ä½œå¤§ key æ—¶ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œé‚£ä¹ˆå°±ä¼šé˜»å¡ Redisï¼Œä»å®¢æˆ·ç«¯è¿™ä¸€è§†è§’çœ‹ï¼Œå°±æ˜¯å¾ˆä¹…å¾ˆä¹…éƒ½æ²¡æœ‰å“åº”ã€‚</li><li>å¼•å‘ç½‘ç»œé˜»å¡ï¼šæ¯æ¬¡è·å–å¤§ key äº§ç”Ÿçš„ç½‘ç»œæµé‡è¾ƒå¤§ï¼Œå¦‚æœä¸€ä¸ª key çš„å¤§å°æ˜¯ 1 MBï¼Œæ¯ç§’è®¿é—®é‡ä¸º 1000ï¼Œé‚£ä¹ˆæ¯ç§’ä¼šäº§ç”Ÿ 1000MB çš„æµé‡ï¼Œè¿™å¯¹äºæ™®é€šåƒå…†ç½‘å¡çš„æœåŠ¡å™¨æ¥è¯´æ˜¯ç¾éš¾æ€§çš„ã€‚</li><li>é˜»å¡å·¥ä½œçº¿ç¨‹ï¼šå¦‚æœä½¿ç”¨ del åˆ é™¤å¤§ key æ—¶ï¼Œä¼šé˜»å¡å·¥ä½œçº¿ç¨‹ï¼Œè¿™æ ·å°±æ²¡åŠæ³•å¤„ç†åç»­çš„å‘½ä»¤ã€‚</li></ul><ol start="5"><li><p>æ¸…ç©ºæ•°æ®åº“</p></li><li><p>é›†ç¾¤æ‰©å®¹</p></li><li><p>å†…å­˜äº¤æ¢</p></li><li><p>CPUç«äº‰</p></li><li><p>ç½‘ç»œå»¶è¿Ÿ</p></li></ol><h3 id="Redis-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ"><a href="#Redis-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ"></a>Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</h3><ol><li><p>Redis åŸºäºå†…å­˜ï¼Œå†…å­˜çš„è®¿é—®é€Ÿåº¦æ˜¯ç£ç›˜çš„ä¸Šåƒå€ï¼›</p></li><li><p>Redis åŸºäº Reactor æ¨¡å¼è®¾è®¡å¼€å‘äº†ä¸€å¥—é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å‹ï¼Œä¸»è¦æ˜¯å•çº¿ç¨‹äº‹ä»¶å¾ªç¯å’Œ IO å¤šè·¯å¤ç”¨ï¼›</p></li><li><p>Redis å†…ç½®äº†å¤šç§ä¼˜åŒ–è¿‡åçš„æ•°æ®ç»“æ„å®ç°(å¦‚hashè¡¨å’Œè·³è¡¨)ï¼Œæ€§èƒ½éå¸¸é«˜ã€‚</p></li></ol><h2 id="Rediså•çº¿ç¨‹ï¼š"><a href="#Rediså•çº¿ç¨‹ï¼š" class="headerlink" title="Rediså•çº¿ç¨‹ï¼š"></a>Rediså•çº¿ç¨‹ï¼š</h2><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Redis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/03%20%20%E9%AB%98%E6%80%A7%E8%83%BDIO%E6%A8%A1%E5%9E%8B%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8D%95%E7%BA%BF%E7%A8%8BRedis%E8%83%BD%E9%82%A3%E4%B9%88%E5%BF%AB%EF%BC%9F.md">é«˜æ€§èƒ½IOæ¨¡å‹ï¼šä¸ºä»€ä¹ˆå•çº¿ç¨‹Redisèƒ½é‚£ä¹ˆå¿«ï¼Ÿ</a></li></ul><h3 id="ä»€ä¹ˆæ˜¯rediså•çº¿ç¨‹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯rediså•çº¿ç¨‹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯rediså•çº¿ç¨‹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯rediså•çº¿ç¨‹ï¼Ÿ</h3><p>â€‹Redis å•çº¿ç¨‹æŒ‡çš„æ˜¯<strong>ã€Œæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚-&gt;è§£æè¯·æ±‚ -&gt;è¿›è¡Œæ•°æ®è¯»å†™ç­‰æ“ä½œ-&gt;å‘ç”Ÿæ•°æ®ç»™å®¢æˆ·ç«¯ã€</strong>è¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰æ¥å®Œæˆçš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´ Redis æ˜¯å•çº¿ç¨‹çš„åŸå› ã€‚</p><h3 id="åŸºäºå¤šè·¯å¤ç”¨çš„é«˜æ€§èƒ½-I-x2F-O-æ¨¡å‹ç¤ºæ„å›¾ï¼š"><a href="#åŸºäºå¤šè·¯å¤ç”¨çš„é«˜æ€§èƒ½-I-x2F-O-æ¨¡å‹ç¤ºæ„å›¾ï¼š" class="headerlink" title="åŸºäºå¤šè·¯å¤ç”¨çš„é«˜æ€§èƒ½ I&#x2F;O æ¨¡å‹ç¤ºæ„å›¾ï¼š"></a>åŸºäºå¤šè·¯å¤ç”¨çš„é«˜æ€§èƒ½ I&#x2F;O æ¨¡å‹ç¤ºæ„å›¾ï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230925145105519.png" alt="image-20230925145105519"></p><p>â€‹åœ¨ Redis åªè¿è¡Œ<u>å•çº¿ç¨‹</u>çš„æƒ…å†µä¸‹ï¼Œè¯¥æœºåˆ¶å…è®¸å†…æ ¸ä¸­ï¼ŒåŒæ—¶å­˜åœ¨å¤šä¸ªç›‘å¬å¥—æ¥å­—å’Œå·²è¿æ¥å¥—æ¥å­—ã€‚å†…æ ¸ä¼šä¸€ç›´ç›‘å¬è¿™äº›å¥—æ¥å­—ä¸Šçš„è¿æ¥è¯·æ±‚æˆ–æ•°æ®è¯·æ±‚ã€‚</p><ul><li>ä¸ºäº†åœ¨è¯·æ±‚åˆ°è¾¾æ—¶èƒ½é€šçŸ¥åˆ° Redis çº¿ç¨‹ï¼Œselect&#x2F;epoll æä¾›äº†åŸºäºäº‹ä»¶çš„å›è°ƒæœºåˆ¶ï¼Œå³é’ˆå¯¹ä¸åŒäº‹ä»¶çš„å‘ç”Ÿï¼Œè°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°ã€‚é‚£ä¹ˆï¼Œå›è°ƒæœºåˆ¶æ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢ï¼Ÿå…¶å®ï¼Œselect&#x2F;epoll ä¸€æ—¦ç›‘æµ‹åˆ° FD ä¸Šæœ‰è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå°±ä¼šè§¦å‘ç›¸åº”çš„äº‹ä»¶ã€‚<ul><li>å¦‚æœæ˜¯ <strong>è¿æ¥äº‹ä»¶</strong>åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨ <strong>è¿æ¥äº‹ä»¶å¤„ç†å‡½æ•°</strong>ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šè°ƒç”¨ accpet è·å–å·²è¿æ¥çš„ socket -&gt;è°ƒç”¨ epoll_ctr å°†å·²è¿æ¥çš„ socket åŠ å…¥åˆ° epoll -&gt; æ³¨å†Œã€Œè¯»äº‹ä»¶ã€å¤„ç†å‡½æ•°ï¼›</li><li>å¦‚æœæ˜¯ <strong>è¯»äº‹ä»¶</strong>åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨ <strong>è¯»äº‹ä»¶å¤„ç†å‡½æ•°</strong>ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šè°ƒç”¨ read è·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ® -&gt; è§£æå‘½ä»¤ -&gt; å¤„ç†å‘½ä»¤ -&gt; å°†å®¢æˆ·ç«¯å¯¹è±¡æ·»åŠ åˆ°å‘é€é˜Ÿåˆ— -&gt; å°†æ‰§è¡Œç»“æœå†™åˆ°å‘é€ç¼“å­˜åŒºç­‰å¾…å‘é€ï¼›</li><li>å¦‚æœæ˜¯ <strong>å†™äº‹ä»¶</strong>åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨ <strong>å†™äº‹ä»¶å¤„ç†å‡½æ•°</strong>ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šé€šè¿‡ write å‡½æ•°å°†å®¢æˆ·ç«¯å‘é€ç¼“å­˜åŒºé‡Œçš„æ•°æ®å‘é€å‡ºå»ï¼Œå¦‚æœè¿™ä¸€è½®æ•°æ®æ²¡æœ‰å‘ç”Ÿå®Œï¼Œå°±ä¼šç»§ç»­æ³¨å†Œå†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç­‰å¾… epoll_wait å‘ç°å¯å†™åå†å¤„ç† ã€‚</li></ul></li><li>è¿™äº›äº‹ä»¶ä¼šè¢«æ”¾è¿›ä¸€ä¸ªäº‹ä»¶é˜Ÿåˆ—ï¼ŒRedis å•çº¿ç¨‹å¯¹è¯¥äº‹ä»¶é˜Ÿåˆ—ä¸æ–­è¿›è¡Œå¤„ç†ã€‚è¿™æ ·ä¸€æ¥ï¼ŒRedis æ— éœ€ä¸€ç›´è½®è¯¢æ˜¯å¦æœ‰è¯·æ±‚å®é™…å‘ç”Ÿï¼Œè¿™å°±å¯ä»¥é¿å…é€ æˆ CPU èµ„æºæµªè´¹ã€‚åŒæ—¶ï¼ŒRedis åœ¨å¯¹äº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶è¿›è¡Œå¤„ç†æ—¶ï¼Œä¼šè°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°ï¼Œè¿™å°±å®ç°äº†åŸºäºäº‹ä»¶çš„å›è°ƒã€‚å› ä¸º Redis ä¸€ç›´åœ¨å¯¹äº‹ä»¶é˜Ÿåˆ—è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥èƒ½åŠæ—¶å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæå‡ Redis çš„å“åº”æ€§èƒ½ã€‚</li></ul><h3 id="æ€»ç»“ï¼š-1"><a href="#æ€»ç»“ï¼š-1" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>â€‹Redis å•çº¿ç¨‹æ˜¯æŒ‡å®ƒå¯¹ç½‘ç»œ IO å’Œæ•°æ®è¯»å†™çš„æ“ä½œé‡‡ç”¨äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œé‡‡ç”¨å•çº¿ç¨‹çš„ä¸€ä¸ªæ ¸å¿ƒåŸå› æ˜¯é¿å…å¤šçº¿ç¨‹å¼€å‘çš„å¹¶å‘æ§åˆ¶é—®é¢˜ã€‚å•çº¿ç¨‹çš„ Redis ä¹Ÿèƒ½è·å¾—é«˜æ€§èƒ½ï¼Œè·Ÿå¤šè·¯å¤ç”¨çš„ IO æ¨¡å‹å¯†åˆ‡ç›¸å…³ï¼Œå› ä¸ºè¿™é¿å…äº† accept() å’Œ send()&#x2F;recv() æ½œåœ¨çš„ç½‘ç»œ IO æ“ä½œé˜»å¡ç‚¹ã€‚</p><h2 id="Rediså¤šçº¿ç¨‹ï¼š"><a href="#Rediså¤šçº¿ç¨‹ï¼š" class="headerlink" title="Rediså¤šçº¿ç¨‹ï¼š"></a>Rediså¤šçº¿ç¨‹ï¼š</h2><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://juejin.cn/post/6989109527886954527">Redis 6.0 æ–°ç‰¹æ€§ï¼šå¸¦ä½  100% æŒæ¡å¤šçº¿ç¨‹æ¨¡å‹</a></li></ul><h4 id="rediså¹¶éåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼š"><a href="#rediså¹¶éåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼š" class="headerlink" title="rediså¹¶éåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼š"></a>rediså¹¶éåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼š</h4><p>â€‹å¯¹äºä¸€äº›é•¿è€—æ—¶çš„æ“ä½œï¼Œä¸ºäº†ä¸å½±å“æ€§èƒ½ï¼ŒRedisé‡‡ç”¨å¤šçº¿ç¨‹æ–¹å¼å¤„ç†ã€‚</p><p>â€‹ Redis ä¸º<strong>ã€Œå…³é—­æ–‡ä»¶ã€AOF åˆ·ç›˜ã€é‡Šæ”¾å†…å­˜ã€</strong>è¿™äº›ä»»åŠ¡åˆ›å»ºå•ç‹¬çš„çº¿ç¨‹æ¥å¤„ç†</p><h3 id="Redis-6-0-æ–°ç‰¹æ€§ï¼š"><a href="#Redis-6-0-æ–°ç‰¹æ€§ï¼š" class="headerlink" title="Redis 6.0 æ–°ç‰¹æ€§ï¼š"></a>Redis 6.0 æ–°ç‰¹æ€§ï¼š</h3><p>â€‹Redis6.0å **<u>å…è®¸</u>**é‡‡ç”¨å¤šä¸ª IO çº¿ç¨‹æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œæé«˜ç½‘ç»œè¯·æ±‚å¤„ç†çš„å¹¶è¡Œåº¦ã€‚</p><p>â€‹<strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRedis å¤š IO çº¿ç¨‹æ¨¡å‹åªç”¨æ¥å¤„ç†<u>ç½‘ç»œè¯»å†™è¯·æ±‚</u>ï¼Œå¯¹äº Redis çš„è¯»å†™å‘½ä»¤ï¼Œä¾ç„¶æ˜¯å•çº¿ç¨‹å¤„ç†</strong>ã€‚</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230925155107569.png" alt="image-20230925155107569" style="zoom: 40%;" /><p><strong>ä¸»çº¿ç¨‹ä¸ IO å¤šçº¿ç¨‹å®ç°åä½œç¤ºæ„å›¾ï¼š</strong></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230925155243715.png" alt="image-20230925155243715" style="zoom:50%;" /><h2 id="Redisè¿‡æœŸåˆ é™¤ç­–ç•¥å’Œå†…å­˜æ·˜æ±°ç­–ç•¥ï¼š"><a href="#Redisè¿‡æœŸåˆ é™¤ç­–ç•¥å’Œå†…å­˜æ·˜æ±°ç­–ç•¥ï¼š" class="headerlink" title="Redisè¿‡æœŸåˆ é™¤ç­–ç•¥å’Œå†…å­˜æ·˜æ±°ç­–ç•¥ï¼š"></a>Redisè¿‡æœŸåˆ é™¤ç­–ç•¥å’Œå†…å­˜æ·˜æ±°ç­–ç•¥ï¼š</h2><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://xiaolincoding.com/redis/module/strategy.html#redis-%E8%BF%87%E6%9C%9F%E5%88%A0%E9%99%A4%E7%AD%96%E7%95%A5%E5%92%8C%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">Redis è¿‡æœŸåˆ é™¤ç­–ç•¥å’Œå†…å­˜æ·˜æ±°ç­–ç•¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li></ul><h4 id="è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼š"><a href="#è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼š" class="headerlink" title="è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼š"></a>è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼š</h4><p>â€‹ä¸ºkeyè®¾ç½®è¿‡æœŸæ—¶é—´ (é€šè¿‡expireã€pexpireå‘½ä»¤è®¾ç½®)</p><h5 id="å¦‚ä½•åˆ¤å®š-key-å·²è¿‡æœŸäº†ï¼Ÿ"><a href="#å¦‚ä½•åˆ¤å®š-key-å·²è¿‡æœŸäº†ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ¤å®š key å·²è¿‡æœŸäº†ï¼Ÿ"></a>å¦‚ä½•åˆ¤å®š key å·²è¿‡æœŸäº†ï¼Ÿ</h5><p>â€‹æ¯å½“æˆ‘ä»¬å¯¹ä¸€ä¸ª key è®¾ç½®äº†è¿‡æœŸæ—¶é—´æ—¶ï¼ŒRedis ä¼šæŠŠè¯¥ key å¸¦ä¸Šè¿‡æœŸæ—¶é—´å­˜å‚¨åˆ°ä¸€ä¸ª<strong>è¿‡æœŸå­—å…¸</strong>ï¼ˆexpires dictï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªhashè¡¨ï¼‰ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ã€Œè¿‡æœŸå­—å…¸ã€ä¿å­˜äº†æ•°æ®åº“ä¸­æ‰€æœ‰ key çš„è¿‡æœŸæ—¶é—´ã€‚</p><ul><li>è¿‡æœŸå­—å…¸çš„ key æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æŸä¸ªé”®å¯¹è±¡ï¼›</li><li>è¿‡æœŸå­—å…¸çš„ value æ˜¯ä¸€ä¸ª long long ç±»å‹çš„æ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°ä¿å­˜äº† key çš„è¿‡æœŸæ—¶é—´ï¼›</li></ul><h5 id="è¿‡æœŸåˆ é™¤ç­–ç•¥ä»‹ç»ï¼š"><a href="#è¿‡æœŸåˆ é™¤ç­–ç•¥ä»‹ç»ï¼š" class="headerlink" title="è¿‡æœŸåˆ é™¤ç­–ç•¥ä»‹ç»ï¼š"></a>è¿‡æœŸåˆ é™¤ç­–ç•¥ä»‹ç»ï¼š</h5><ul><li>å®šæ—¶åˆ é™¤<ul><li><strong>åœ¨è®¾ç½® key çš„è¿‡æœŸæ—¶é—´æ—¶ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªå®šæ—¶äº‹ä»¶ï¼Œå½“æ—¶é—´åˆ°è¾¾æ—¶ï¼Œç”±äº‹ä»¶å¤„ç†å™¨è‡ªåŠ¨æ‰§è¡Œ key çš„åˆ é™¤æ“ä½œã€‚</strong></li><li>å®šæ—¶åˆ é™¤ç­–ç•¥çš„<strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>å¯ä»¥ä¿è¯è¿‡æœŸ key ä¼šè¢«å°½å¿«åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯å†…å­˜å¯ä»¥è¢«å°½å¿«åœ°é‡Šæ”¾ã€‚å› æ­¤ï¼Œå®šæ—¶åˆ é™¤å¯¹å†…å­˜æ˜¯æœ€å‹å¥½çš„ã€‚</li></ul></li><li>å®šæ—¶åˆ é™¤ç­–ç•¥çš„<strong>ç¼ºç‚¹</strong>ï¼š<ul><li>åœ¨è¿‡æœŸ key æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œåˆ é™¤è¿‡æœŸ key å¯èƒ½ä¼šå ç”¨ç›¸å½“ä¸€éƒ¨åˆ† CPU æ—¶é—´ï¼Œåœ¨å†…å­˜ä¸ç´§å¼ ä½† CPU æ—¶é—´ç´§å¼ çš„æƒ…å†µä¸‹ï¼Œå°† CPU æ—¶é—´ç”¨äºåˆ é™¤å’Œå½“å‰ä»»åŠ¡æ— å…³çš„è¿‡æœŸé”®ä¸Šï¼Œæ— ç–‘ä¼šå¯¹æœåŠ¡å™¨çš„å“åº”æ—¶é—´å’Œååé‡é€ æˆå½±å“ã€‚æ‰€ä»¥ï¼Œå®šæ—¶åˆ é™¤ç­–ç•¥å¯¹ CPU ä¸å‹å¥½ã€‚</li></ul></li></ul></li><li>æƒ°æ€§åˆ é™¤<ul><li><strong>ä¸ä¸»åŠ¨åˆ é™¤è¿‡æœŸé”®ï¼Œ<u>æ¯æ¬¡ä»æ•°æ®åº“è®¿é—® key æ—¶ï¼Œéƒ½æ£€æµ‹ key æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤è¯¥ key</u>ã€‚</strong></li><li>æƒ°æ€§åˆ é™¤ç­–ç•¥çš„<strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>å› ä¸ºæ¯æ¬¡è®¿é—®æ—¶ï¼Œæ‰ä¼šæ£€æŸ¥ key æ˜¯å¦è¿‡æœŸï¼Œæ‰€ä»¥æ­¤ç­–ç•¥åªä¼šä½¿ç”¨å¾ˆå°‘çš„ç³»ç»Ÿèµ„æºï¼Œå› æ­¤ï¼Œæƒ°æ€§åˆ é™¤ç­–ç•¥å¯¹ CPU æ—¶é—´æœ€å‹å¥½ã€‚</li></ul></li><li>æƒ°æ€§åˆ é™¤ç­–ç•¥çš„<strong>ç¼ºç‚¹</strong>ï¼š<ul><li>å¦‚æœä¸€ä¸ª key å·²ç»è¿‡æœŸï¼Œè€Œè¿™ä¸ª key åˆä»ç„¶ä¿ç•™åœ¨æ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆåªè¦è¿™ä¸ªè¿‡æœŸ key ä¸€ç›´æ²¡æœ‰è¢«è®¿é—®ï¼Œå®ƒæ‰€å ç”¨çš„å†…å­˜å°±ä¸ä¼šé‡Šæ”¾ï¼Œé€ æˆäº†ä¸€å®šçš„å†…å­˜ç©ºé—´æµªè´¹ã€‚æ‰€ä»¥ï¼Œæƒ°æ€§åˆ é™¤ç­–ç•¥å¯¹å†…å­˜ä¸å‹å¥½ã€‚</li></ul></li></ul></li><li>å®šæœŸåˆ é™¤<ul><li><strong>æ¯éš”ä¸€æ®µæ—¶é—´ã€Œéšæœºã€ä»æ•°æ®åº“ä¸­å–å‡ºä¸€å®šæ•°é‡çš„ key è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶åˆ é™¤å…¶ä¸­çš„è¿‡æœŸkeyã€‚</strong></li><li>å®šæœŸåˆ é™¤ç­–ç•¥çš„<strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>é€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡ï¼Œæ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹ CPU çš„å½±å“ï¼ŒåŒæ—¶ä¹Ÿèƒ½åˆ é™¤ä¸€éƒ¨åˆ†è¿‡æœŸçš„æ•°æ®å‡å°‘äº†è¿‡æœŸé”®å¯¹ç©ºé—´çš„æ— æ•ˆå ç”¨ã€‚</li></ul></li><li>å®šæœŸåˆ é™¤ç­–ç•¥çš„<strong>ç¼ºç‚¹</strong>ï¼š<ul><li>å†…å­˜æ¸…ç†æ–¹é¢æ²¡æœ‰å®šæ—¶åˆ é™¤æ•ˆæœå¥½ï¼ŒåŒæ—¶æ²¡æœ‰æƒ°æ€§åˆ é™¤ä½¿ç”¨çš„ç³»ç»Ÿèµ„æºå°‘ã€‚</li><li>éš¾ä»¥ç¡®å®šåˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡ã€‚å¦‚æœæ‰§è¡Œçš„å¤ªé¢‘ç¹ï¼Œå®šæœŸåˆ é™¤ç­–ç•¥å˜å¾—å’Œå®šæ—¶åˆ é™¤ç­–ç•¥ä¸€æ ·ï¼Œå¯¹CPUä¸å‹å¥½ï¼›å¦‚æœæ‰§è¡Œçš„å¤ªå°‘ï¼Œé‚£åˆå’Œæƒ°æ€§åˆ é™¤ä¸€æ ·äº†ï¼Œè¿‡æœŸ key å ç”¨çš„å†…å­˜ä¸ä¼šåŠæ—¶å¾—åˆ°é‡Šæ”¾ã€‚</li></ul></li></ul></li></ul><h5 id="Redisçš„è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼š"><a href="#Redisçš„è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼š" class="headerlink" title="Redisçš„è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼š"></a>Redisçš„è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼š</h5><p>â€‹<strong>Redis é€‰æ‹©ã€Œæƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤ã€è¿™ä¸¤ç§ç­–ç•¥é…å’Œä½¿ç”¨</strong>ï¼Œä»¥æ±‚åœ¨åˆç†ä½¿ç”¨ CPU æ—¶é—´å’Œé¿å…å†…å­˜æµªè´¹ä¹‹é—´å–å¾—å¹³è¡¡ã€‚</p><p>â€‹</p><h6 id="æƒ°æ€§åˆ é™¤ï¼š"><a href="#æƒ°æ€§åˆ é™¤ï¼š" class="headerlink" title="æƒ°æ€§åˆ é™¤ï¼š"></a>æƒ°æ€§åˆ é™¤ï¼š</h6><p>â€‹Redis åœ¨è®¿é—®æˆ–è€…ä¿®æ”¹ key ä¹‹å‰ï¼Œéƒ½ä¼šè°ƒç”¨ expireIfNeeded å‡½æ•°å¯¹å…¶è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥ key æ˜¯å¦è¿‡æœŸï¼š</p><ul><li>å¦‚æœè¿‡æœŸï¼Œåˆ™åˆ é™¤è¯¥ keyï¼Œè‡³äºé€‰æ‹©å¼‚æ­¥åˆ é™¤ï¼Œè¿˜æ˜¯é€‰æ‹©åŒæ­¥åˆ é™¤ï¼Œæ ¹æ® <code>lazyfree_lazy_expire</code> å‚æ•°é…ç½®å†³å®šï¼ˆRedis 4.0ç‰ˆæœ¬å¼€å§‹æä¾›å‚æ•°ï¼‰ï¼Œç„¶åè¿”å› null å®¢æˆ·ç«¯ï¼›</li><li>å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œä¸åšä»»ä½•å¤„ç†ï¼Œç„¶åè¿”å›æ­£å¸¸çš„é”®å€¼å¯¹ç»™å®¢æˆ·ç«¯ï¼›</li></ul><h6 id="å®šæœŸåˆ é™¤ï¼š"><a href="#å®šæœŸåˆ é™¤ï¼š" class="headerlink" title="å®šæœŸåˆ é™¤ï¼š"></a>å®šæœŸåˆ é™¤ï¼š</h6><ol><li>ä»è¿‡æœŸå­—å…¸ä¸­éšæœºæŠ½å– 20ä¸ª (é»˜è®¤å€¼ï¼Œå¯ä¿®æ”¹) keyï¼›</li><li>æ£€æŸ¥è¿™ 20 ä¸ª key æ˜¯å¦è¿‡æœŸï¼Œå¹¶åˆ é™¤å·²è¿‡æœŸçš„ keyï¼›</li><li>å¦‚æœæœ¬è½®æ£€æŸ¥çš„å·²è¿‡æœŸ key çš„æ•°é‡ï¼Œè¶…è¿‡ 5 ä¸ªï¼ˆ20&#x2F;4ï¼‰ï¼Œä¹Ÿå°±æ˜¯ã€Œå·²è¿‡æœŸ key çš„æ•°é‡ã€å æ¯”ã€ŒéšæœºæŠ½å– key çš„æ•°é‡ã€å¤§äº 25%ï¼Œåˆ™ç»§ç»­é‡å¤æ­¥éª¤ 1ï¼›å¦‚æœå·²è¿‡æœŸçš„ key æ¯”ä¾‹å°äº 25%ï¼Œåˆ™åœæ­¢ç»§ç»­åˆ é™¤è¿‡æœŸ keyï¼Œç„¶åç­‰å¾…ä¸‹ä¸€è½®å†æ£€æŸ¥ã€‚</li></ol><p>å®šæœŸåˆ é™¤çš„ä¼ªä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">//å·²è¿‡æœŸçš„æ•°é‡</span></span><br><span class="line">    expired = <span class="number">0</span>ï¼›</span><br><span class="line">    <span class="comment">//éšæœºæŠ½å–çš„æ•°é‡</span></span><br><span class="line">    num = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">while</span> (num--) &#123;</span><br><span class="line">        <span class="comment">//1. ä»è¿‡æœŸå­—å…¸ä¸­éšæœºæŠ½å– 1 ä¸ª key</span></span><br><span class="line">        <span class="comment">//2. åˆ¤æ–­è¯¥ key æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœå·²è¿‡æœŸåˆ™è¿›è¡Œåˆ é™¤ï¼ŒåŒæ—¶å¯¹ expired++</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¶…è¿‡æ—¶é—´é™åˆ¶åˆ™é€€å‡º</span></span><br><span class="line">    <span class="keyword">if</span> (timelimit_exit) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* å¦‚æœæœ¬è½®æ£€æŸ¥çš„å·²è¿‡æœŸ key çš„æ•°é‡ï¼Œè¶…è¿‡ 25%ï¼Œåˆ™ç»§ç»­éšæœºæŠ½æŸ¥ï¼Œå¦åˆ™é€€å‡ºæœ¬è½®æ£€æŸ¥ */</span></span><br><span class="line">&#125; <span class="keyword">while</span> (expired &gt; <span class="number">20</span>/<span class="number">4</span>); </span><br></pre></td></tr></table></figure><h4 id="å†…å­˜æ·˜æ±°ç­–ç•¥ï¼š"><a href="#å†…å­˜æ·˜æ±°ç­–ç•¥ï¼š" class="headerlink" title="å†…å­˜æ·˜æ±°ç­–ç•¥ï¼š"></a>å†…å­˜æ·˜æ±°ç­–ç•¥ï¼š</h4><p><u>å½“ Redis çš„è¿è¡Œå†…å­˜å·²ç»è¶…è¿‡ Redis è®¾ç½®çš„æœ€å¤§å†…å­˜ä¹‹åï¼Œåˆ™ä¼šä½¿ç”¨å†…å­˜æ·˜æ±°ç­–ç•¥åˆ é™¤ç¬¦åˆæ¡ä»¶çš„ keyï¼Œä»¥æ­¤æ¥ä¿éšœ Redis é«˜æ•ˆçš„è¿è¡Œã€‚</u></p><p><em>1ã€ä¸è¿›è¡Œæ•°æ®æ·˜æ±°çš„ç­–ç•¥</em></p><ul><li><strong>noeviction</strong>ï¼ˆRedis3.0ä¹‹åï¼Œé»˜è®¤çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ ï¼šå®ƒè¡¨ç¤ºå½“è¿è¡Œå†…å­˜è¶…è¿‡æœ€å¤§è®¾ç½®å†…å­˜æ—¶ï¼Œä¸æ·˜æ±°ä»»ä½•æ•°æ®ï¼Œè¿™æ—¶å¦‚æœæœ‰æ–°çš„æ•°æ®å†™å…¥ï¼Œä¼šæŠ¥é”™é€šçŸ¥ç¦æ­¢å†™å…¥ï¼Œä¸æ·˜æ±°ä»»ä½•æ•°æ®ï¼Œä½†æ˜¯å¦‚æœæ²¡ç”¨æ•°æ®å†™å…¥çš„è¯ï¼Œåªæ˜¯å•çº¯çš„æŸ¥è¯¢æˆ–è€…åˆ é™¤æ“ä½œçš„è¯ï¼Œè¿˜æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</li></ul><p><em>2ã€è¿›è¡Œæ•°æ®æ·˜æ±°çš„ç­–ç•¥</em></p><p>â€‹é’ˆå¯¹ã€Œè¿›è¡Œæ•°æ®æ·˜æ±°ã€è¿™ä¸€ç±»ç­–ç•¥ï¼Œåˆå¯ä»¥ç»†åˆ†ä¸ºã€Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­è¿›è¡Œæ·˜æ±°ã€å’Œã€Œåœ¨æ‰€æœ‰æ•°æ®èŒƒå›´å†…è¿›è¡Œæ·˜æ±°ã€è¿™ä¸¤ç±»ç­–ç•¥ã€‚</p><p>åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­è¿›è¡Œæ·˜æ±°ï¼š</p><ul><li><strong>volatile-random</strong>ï¼šéšæœºæ·˜æ±°è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ä»»æ„é”®å€¼ï¼›</li><li><strong>volatile-ttl</strong>ï¼šä¼˜å…ˆæ·˜æ±°æ›´æ—©è¿‡æœŸçš„é”®å€¼ã€‚</li><li><strong>volatile-lru</strong>ï¼ˆRedis3.0 ä¹‹å‰ï¼Œé»˜è®¤çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ï¼šæ·˜æ±°æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼ä¸­ï¼Œæœ€ä¹…æœªä½¿ç”¨çš„é”®å€¼ï¼›</li><li><strong>volatile-lfu</strong>ï¼ˆRedis 4.0 åæ–°å¢çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ï¼šæ·˜æ±°æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼ä¸­ï¼Œæœ€å°‘ä½¿ç”¨çš„é”®å€¼ï¼›</li></ul><p>åœ¨æ‰€æœ‰æ•°æ®èŒƒå›´å†…è¿›è¡Œæ·˜æ±°ï¼š</p><ul><li><strong>allkeys-random</strong>ï¼šéšæœºæ·˜æ±°ä»»æ„é”®å€¼;</li><li><strong>allkeys-lru</strong>ï¼šæ·˜æ±°æ•´ä¸ªé”®å€¼ä¸­æœ€ä¹…æœªä½¿ç”¨çš„é”®å€¼ï¼›</li><li><strong>allkeys-lfu</strong>ï¼ˆRedis 4.0 åæ–°å¢çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ï¼šæ·˜æ±°æ•´ä¸ªé”®å€¼ä¸­æœ€å°‘ä½¿ç”¨çš„é”®å€¼ã€‚</li></ul><p>å¯ä»¥ä½¿ç”¨ <code>config get maxmemory-policy</code> å‘½ä»¤ï¼Œæ¥æŸ¥çœ‹å½“å‰ Redis çš„å†…å­˜æ·˜æ±°ç­–ç•¥</p><h5 id="Redisä¸­çš„LRUï¼š"><a href="#Redisä¸­çš„LRUï¼š" class="headerlink" title="Redisä¸­çš„LRUï¼š"></a>Redisä¸­çš„LRUï¼š</h5><p>â€‹Redis å®ç°çš„æ˜¯ä¸€ç§<strong>è¿‘ä¼¼ LRU ç®—æ³•</strong>ï¼Œç›®çš„æ˜¯ä¸ºäº†æ›´å¥½çš„èŠ‚çº¦å†…å­˜ï¼Œå®ƒçš„<strong>å®ç°æ–¹å¼æ˜¯åœ¨ Redis çš„å¯¹è±¡ç»“æ„ä½“ä¸­æ·»åŠ ä¸€ä¸ªé¢å¤–çš„å­—æ®µï¼Œç”¨äºè®°å½•æ­¤æ•°æ®çš„æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´</strong>ã€‚</p><p><u>å½“ Redis è¿›è¡Œå†…å­˜æ·˜æ±°æ—¶ï¼Œä¼šä½¿ç”¨<strong>éšæœºé‡‡æ ·çš„æ–¹å¼æ¥æ·˜æ±°æ•°æ®</strong>ï¼Œå®ƒæ˜¯éšæœºå– 5 ä¸ªå€¼ï¼ˆæ­¤å€¼å¯é…ç½®ï¼‰ï¼Œç„¶å<strong>æ·˜æ±°æœ€ä¹…æ²¡æœ‰ä½¿ç”¨çš„é‚£ä¸ª</strong>ã€‚</u></p><p>Redis å®ç°çš„ LRU ç®—æ³•çš„ä¼˜ç‚¹ï¼š</p><ul><li>ä¸ç”¨ä¸ºæ‰€æœ‰çš„æ•°æ®ç»´æŠ¤ä¸€ä¸ªå¤§é“¾è¡¨ï¼ŒèŠ‚çœäº†ç©ºé—´å ç”¨ï¼›</li><li>ä¸ç”¨åœ¨æ¯æ¬¡æ•°æ®è®¿é—®æ—¶éƒ½ç§»åŠ¨é“¾è¡¨é¡¹ï¼Œæå‡äº†ç¼“å­˜çš„æ€§èƒ½ï¼›</li></ul><p>ä½†æ˜¯ LRU ç®—æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ<strong>æ— æ³•è§£å†³ç¼“å­˜æ±¡æŸ“é—®é¢˜</strong>ï¼Œæ¯”å¦‚<u>åº”ç”¨ä¸€æ¬¡è¯»å–äº†å¤§é‡çš„æ•°æ®ï¼Œè€Œè¿™äº›æ•°æ®åªä¼šè¢«è¯»å–è¿™ä¸€æ¬¡ï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®ä¼šç•™å­˜åœ¨ Redis ç¼“å­˜ä¸­å¾ˆé•¿ä¸€æ®µæ—¶é—´</u>ï¼Œé€ æˆç¼“å­˜æ±¡æŸ“ã€‚</p><p><strong>Redisä¸­çš„LFUï¼š</strong></p><p>â€‹<strong>åœ¨ LFU ç®—æ³•ä¸­</strong>ï¼ŒRediså¯¹è±¡å¤´çš„ 24 bits çš„ lru å­—æ®µè¢«åˆ†æˆä¸¤æ®µæ¥å­˜å‚¨ï¼Œé«˜ 16bit å­˜å‚¨ ldt(Last Decrement Time)ï¼Œä½ 8bit å­˜å‚¨ logc(Logistic Counter)ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/lru%E5%AD%97%E6%AE%B5.png" alt="img"></p><ul><li>ldt æ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®æ—¶é—´æˆ³ï¼›</li><li>logc æ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®é¢‘æ¬¡ï¼Œå®ƒçš„å€¼è¶Šå°è¡¨ç¤ºä½¿ç”¨é¢‘ç‡è¶Šä½ï¼Œè¶Šå®¹æ˜“æ·˜æ±°ï¼Œæ¯ä¸ªæ–°åŠ å…¥çš„ key çš„logc åˆå§‹å€¼ä¸º 5ã€‚</li></ul><p>æ³¨æ„ï¼Œlogc å¹¶ä¸æ˜¯å•çº¯çš„è®¿é—®æ¬¡æ•°ï¼Œè€Œæ˜¯è®¿é—®é¢‘æ¬¡ï¼ˆè®¿é—®é¢‘ç‡ï¼‰ï¼Œå› ä¸º <strong>logc ä¼šéšæ—¶é—´æ¨ç§»è€Œè¡°å‡çš„</strong>ã€‚</p><p>åœ¨æ¯æ¬¡ key è¢«è®¿é—®æ—¶ï¼Œ<u>ä¼šå…ˆå¯¹ logc åšä¸€ä¸ªè¡°å‡æ“ä½œï¼Œè¡°å‡çš„å€¼è·Ÿå‰åè®¿é—®æ—¶é—´çš„å·®è·æœ‰å…³ç³»ï¼Œå¦‚æœä¸Šä¸€æ¬¡è®¿é—®çš„æ—¶é—´ä¸è¿™ä¸€æ¬¡è®¿é—®çš„æ—¶é—´å·®è·å¾ˆå¤§ï¼Œé‚£ä¹ˆè¡°å‡çš„å€¼å°±è¶Šå¤§ï¼Œè¿™æ ·å®ç°çš„ LFU ç®—æ³•æ˜¯æ ¹æ®<strong>è®¿é—®é¢‘ç‡</strong>æ¥æ·˜æ±°æ•°æ®çš„ï¼Œè€Œä¸åªæ˜¯è®¿é—®æ¬¡æ•°ã€‚è®¿é—®é¢‘ç‡éœ€è¦è€ƒè™‘ key çš„è®¿é—®æ˜¯å¤šé•¿æ—¶é—´æ®µå†…å‘ç”Ÿçš„</u>ã€‚key çš„å…ˆå‰è®¿é—®è·ç¦»å½“å‰æ—¶é—´è¶Šé•¿ï¼Œé‚£ä¹ˆè¿™ä¸ª key çš„è®¿é—®é¢‘ç‡ç›¸åº”åœ°ä¹Ÿå°±ä¼šé™ä½ï¼Œè¿™æ ·è¢«æ·˜æ±°çš„æ¦‚ç‡ä¹Ÿä¼šæ›´å¤§ã€‚</p><p>å¯¹ logc åšå®Œè¡°å‡æ“ä½œåï¼Œå°±å¼€å§‹å¯¹ logc è¿›è¡Œå¢åŠ æ“ä½œï¼Œå¢åŠ æ“ä½œå¹¶ä¸æ˜¯å•çº¯çš„ + 1ï¼Œè€Œæ˜¯æ ¹æ®æ¦‚ç‡å¢åŠ ï¼Œå¦‚æœ logc è¶Šå¤§çš„ keyï¼Œå®ƒçš„ logc å°±è¶Šéš¾å†å¢åŠ ã€‚</p><p>æ‰€ä»¥ï¼ŒRedis åœ¨è®¿é—® key æ—¶ï¼Œå¯¹äº logc æ˜¯è¿™æ ·å˜åŒ–çš„ï¼š</p><ol><li>å…ˆæŒ‰ç…§ä¸Šæ¬¡è®¿é—®è·ç¦»å½“å‰çš„æ—¶é•¿ï¼Œæ¥å¯¹ logc è¿›è¡Œè¡°å‡ï¼›</li><li>ç„¶åï¼Œå†æŒ‰ç…§ä¸€å®šæ¦‚ç‡å¢åŠ  logc çš„å€¼</li></ol><p>redis.conf æä¾›äº†ä¸¤ä¸ªé…ç½®é¡¹ï¼Œç”¨äºè°ƒæ•´ LFU ç®—æ³•ä»è€Œæ§åˆ¶ logc çš„å¢é•¿å’Œè¡°å‡ï¼š</p><ul><li><code>lfu-decay-time</code> ç”¨äºè°ƒæ•´ logc çš„è¡°å‡é€Ÿåº¦ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»¥åˆ†é’Ÿä¸ºå•ä½çš„æ•°å€¼ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œlfu-decay-time å€¼è¶Šå¤§ï¼Œè¡°å‡è¶Šæ…¢ï¼›</li><li><code>lfu-log-factor</code> ç”¨äºè°ƒæ•´ logc çš„å¢é•¿é€Ÿåº¦ï¼Œlfu-log-factor å€¼è¶Šå¤§ï¼Œlogc å¢é•¿è¶Šæ…¢ã€‚</li></ul><h2 id="RedisæŒä¹…åŒ–ï¼š"><a href="#RedisæŒä¹…åŒ–ï¼š" class="headerlink" title="RedisæŒä¹…åŒ–ï¼š"></a>RedisæŒä¹…åŒ–ï¼š</h2><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://xiaolincoding.com/redis/storage/aof.html">AOFæŒä¹…åŒ–æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</a></li><li><a href="https://xiaolincoding.com/redis/storage/rdb.html">RDB å¿«ç…§æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</a></li></ul><h3 id="AOFï¼š"><a href="#AOFï¼š" class="headerlink" title="AOFï¼š"></a>AOFï¼š</h3><p>â€‹rediså°†<u><strong>å†™æ“ä½œå‘½ä»¤</strong></u>ä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥AOFæ–‡ä»¶ä¸­ï¼Œå®ç°æ•°æ®æŒä¹…åŒ–(å­˜æ”¾æ“ä½œå‘½ä»¤)ã€‚AOFæ—¥å¿—æ–‡ä»¶ä¸­çš„å†…å®¹æ˜¯æ ¹æ®æ“ä½œå‘½ä»¤å¾—å‡ºçš„ã€‚</p><p>â€‹</p><h4 id="ä¸ºä»€ä¹ˆrediså…ˆæ‰§è¡Œå†™æ“ä½œï¼Œå†å°†å‘½ä»¤è®°å½•åˆ°AOFæ—¥å¿—ä¸­ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆrediså…ˆæ‰§è¡Œå†™æ“ä½œï¼Œå†å°†å‘½ä»¤è®°å½•åˆ°AOFæ—¥å¿—ä¸­ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆrediså…ˆæ‰§è¡Œå†™æ“ä½œï¼Œå†å°†å‘½ä»¤è®°å½•åˆ°AOFæ—¥å¿—ä¸­ï¼Ÿ"></a>ä¸ºä»€ä¹ˆrediså…ˆæ‰§è¡Œå†™æ“ä½œï¼Œå†å°†å‘½ä»¤è®°å½•åˆ°AOFæ—¥å¿—ä¸­ï¼Ÿ</h4><ul><li>è¿™æ ·å¯ä»¥é¿å…ä¸€äº›è¯­æ³•é”™è¯¯çš„å‘½ä»¤è¢«å†™å…¥ï¼Œé€ æˆé¢å¤–çš„æ£€æŸ¥å¼€é”€</li><li>å¹¶ä¸”ï¼Œå¦‚æœå…ˆæ‰§è¡Œå†™æ“ä½œã€å†æ‰§è¡Œæ—¥å¿—å†™å…¥çš„è¯ï¼Œå’±ä»¬å†™æ“ä½œè¿™ä¸ªæµç¨‹å°±ä¸ä¼šè¢«å†™å…¥æ—¥å¿—è¿™ä¸ªæ“ä½œå½±å“ï¼Œå³<strong>ä¸ä¼šé˜»å¡å½“å‰å†™æ“ä½œå‘½ä»¤çš„æ‰§è¡Œ</strong></li></ul><h4 id="æ½œåœ¨é£é™©ï¼š"><a href="#æ½œåœ¨é£é™©ï¼š" class="headerlink" title="æ½œåœ¨é£é™©ï¼š"></a>æ½œåœ¨é£é™©ï¼š</h4><ul><li>ä¸»æœºå®•æœºæ—¶ï¼Œæœªå†™å…¥AOFæ—¥å¿—æ–‡ä»¶ä¸­çš„è®°å½•ä¿¡æ¯ä¸¢å¤±ã€‚</li><li>è™½ç„¶<code>å†™å…¥æ—¥å¿—</code>åœ¨<code>å†™æ“ä½œ</code>åæ‰§è¡Œï¼Œä½†æ˜¯ <code>å†™å…¥æ—¥å¿—</code> è¿™ä¸ªæ“ä½œä¼šé˜»å¡ä¸‹ä¸€æ¬¡<code>å†™æ“ä½œ</code>çš„æ‰§è¡Œã€‚</li></ul><h4 id="Rediså†™å…¥AOFæ—¥å¿—çš„è¿‡ç¨‹ï¼š"><a href="#Rediså†™å…¥AOFæ—¥å¿—çš„è¿‡ç¨‹ï¼š" class="headerlink" title="Rediså†™å…¥AOFæ—¥å¿—çš„è¿‡ç¨‹ï¼š"></a>Rediså†™å…¥AOFæ—¥å¿—çš„è¿‡ç¨‹ï¼š</h4><p>![image-20230929161854043](&#x2F;Users&#x2F;donn&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230929161854043.png)</p><ol><li>Redis æ‰§è¡Œå®Œå†™æ“ä½œå‘½ä»¤åï¼Œä¼šå°†å‘½ä»¤è¿½åŠ åˆ° <code>server.aof_buf</code> ç¼“å†²åŒºï¼›</li><li>ç„¶åé€šè¿‡ write() ç³»ç»Ÿè°ƒç”¨ï¼Œå°† aof_buf ç¼“å†²åŒºçš„æ•°æ®æœ€ç»ˆå†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œæ­¤æ—¶æ•°æ®å¹¶æ²¡æœ‰å†™å…¥åˆ°ç¡¬ç›˜ï¼Œè€Œæ˜¯æ‹·è´åˆ°äº†å†…æ ¸ç¼“å†²åŒº page cacheï¼Œç­‰å¾…å†…æ ¸å°†æ•°æ®å†™å…¥ç¡¬ç›˜ï¼›</li><li>å…·ä½“å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®ä»€ä¹ˆæ—¶å€™å†™å…¥åˆ°ç¡¬ç›˜ï¼Œç”±å†…æ ¸å†³å®šã€‚</li></ol><p>Redisæä¾›äº†ä¸‰ç§å†™å›ç¡¬ç›˜çš„ç­–ç•¥ï¼š</p><ul><li><strong>Always</strong>ï¼šæ¯æ¬¡å†™æ“ä½œå‘½ä»¤æ‰§è¡Œå®Œåï¼ŒåŒæ­¥å°† AOF æ—¥å¿—æ•°æ®å†™å›ç¡¬ç›˜(ä»å†…æ ¸ç¼“å†²åŒºä¸­å†™å›ç¡¬ç›˜)ï¼›</li><li><strong>Everysec</strong>ï¼šæ¯æ¬¡å†™æ“ä½œå‘½ä»¤æ‰§è¡Œå®Œåï¼Œå…ˆå°†å‘½ä»¤å†™å…¥åˆ° AOF æ–‡ä»¶çš„å†…æ ¸ç¼“å†²åŒºï¼Œç„¶åæ¯éš”ä¸€ç§’å°†ç¼“å†²åŒºé‡Œçš„å†…å®¹å†™å›åˆ°ç¡¬ç›˜ï¼›</li><li><strong>No</strong>ï¼šæ„å‘³ç€ä¸ç”± Redis æ§åˆ¶å†™å›ç¡¬ç›˜çš„æ—¶æœºï¼Œè½¬äº¤ç»™æ“ä½œç³»ç»Ÿæ§åˆ¶å†™å›çš„æ—¶æœºï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡å†™æ“ä½œå‘½ä»¤æ‰§è¡Œå®Œåï¼Œå…ˆå°†å‘½ä»¤å†™å…¥åˆ° AOF æ–‡ä»¶çš„å†…æ ¸ç¼“å†²åŒºï¼Œå†ç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç¡¬ç›˜ã€‚</li></ul><p>ç†è§£èµ·æ¥ä¹Ÿå’Œç®€å•ï¼š</p><p>â€‹æƒ³è¦é«˜æ€§èƒ½-&gt;ä½¿ç”¨Noç­–ç•¥</p><p>â€‹æƒ³è¦é«˜å¯é -&gt;ä½¿ç”¨Alwaysç­–ç•¥</p><p>â€‹ä¸­åº¸-&gt;ä½¿ç”¨Everysecç­–ç•¥</p><p>ğŸŒŸåœ¨OSå­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼š</p><p>â€‹<strong>å½“åº”ç”¨ç¨‹åºå‘æ–‡ä»¶å†™å…¥æ•°æ®æ—¶ï¼Œå†…æ ¸é€šå¸¸å…ˆå°†æ•°æ®å¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œç„¶å<u>æ’å…¥é˜Ÿåˆ—</u>ï¼Œç„¶åç”±å†…æ ¸å†³å®šä½•æ—¶å†™å…¥ç¡¬ç›˜ã€‚</strong>ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦è®©æŸä¸ªå†™å…¥ç¡¬ç›˜çš„æ“ä½œç«‹å³æ‰§è¡Œï¼Œ<u>æˆ‘ä»¬å¯ä»¥ä¸»åŠ¨è°ƒç”¨fsync()å‡½æ•°æ¥ç«‹å³å°†æ•°æ®å†™å…¥ç¡¬ç›˜</u>ï¼</p><p>å› æ­¤ï¼š</p><ul><li>Always ç­–ç•¥å°±æ˜¯æ¯æ¬¡å†™å…¥ AOF æ–‡ä»¶æ•°æ®åï¼Œå°±æ‰§è¡Œ fsync() å‡½æ•°ï¼›</li><li>Everysec ç­–ç•¥å°±ä¼šåˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ¥æ‰§è¡Œ fsync() å‡½æ•°ï¼›</li><li>No ç­–ç•¥å°±æ˜¯æ°¸ä¸æ‰§è¡Œ fsync() å‡½æ•°;</li></ul><h4 id="AOFé‡å†™æœºåˆ¶ï¼š"><a href="#AOFé‡å†™æœºåˆ¶ï¼š" class="headerlink" title="AOFé‡å†™æœºåˆ¶ï¼š"></a>AOFé‡å†™æœºåˆ¶ï¼š</h4><p>â€‹éšç€æ‰§è¡Œçš„å†™æ“ä½œå‘½ä»¤è¶Šæ¥è¶Šå¤šï¼ŒAOFæ–‡ä»¶çš„å¤§å°ä¼šè¶Šæ¥è¶Šå¤§ã€‚</p><p>å½“ AOF æ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼åï¼ŒRedis å°±ä¼šå¯ç”¨ AOF é‡å†™æœºåˆ¶ï¼Œæ¥å‹ç¼© AOF æ–‡ä»¶ã€‚</p><p>â€‹</p><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š</p><h5 id="1-ä¸ºä»€ä¹ˆAOFé‡å†™èƒ½å¤Ÿå‡å°AOFæ–‡ä»¶çš„å¤§å°ï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆAOFé‡å†™èƒ½å¤Ÿå‡å°AOFæ–‡ä»¶çš„å¤§å°ï¼Ÿ" class="headerlink" title="1.ä¸ºä»€ä¹ˆAOFé‡å†™èƒ½å¤Ÿå‡å°AOFæ–‡ä»¶çš„å¤§å°ï¼Ÿ"></a>1.ä¸ºä»€ä¹ˆAOFé‡å†™èƒ½å¤Ÿå‡å°AOFæ–‡ä»¶çš„å¤§å°ï¼Ÿ</h5><p>â€‹é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“AOFæ–‡ä»¶ä¸­éƒ½æ˜¯å¯¹Redisæ•°æ®åº“çš„å†™æ“ä½œã€‚</p><p>â€‹å…¶æ¬¡ï¼ŒRedisä¸­å­˜å‚¨çš„æ•°æ®å€¼ä¸º<strong>æœ€åä¸€æ¬¡</strong>å†™æ“ä½œèµ‹äºˆçš„å€¼ã€‚</p><p>â€‹å› æ­¤ï¼Œå¯¹äºAOFç¼“å­˜ä¸­çš„å†™å‘½ä»¤ï¼Œæˆ‘ä»¬åªéœ€è¦ç•™ä¸‹å¯¹æ¯ä¸ªkeyçš„æœ€åä¸€æ¬¡å†™æ“ä½œå°±å¯ä»¥å®ç°æ•°æ®çš„æŒä¹…åŒ–äº†ï¼</p><h5 id="2-Redisæ˜¯æ€ä¹ˆå®ç°AOFé‡å†™çš„ï¼Ÿ"><a href="#2-Redisæ˜¯æ€ä¹ˆå®ç°AOFé‡å†™çš„ï¼Ÿ" class="headerlink" title="2.Redisæ˜¯æ€ä¹ˆå®ç°AOFé‡å†™çš„ï¼Ÿ"></a>2.Redisæ˜¯æ€ä¹ˆå®ç°AOFé‡å†™çš„ï¼Ÿ</h5><p>â€‹Redisçš„ <u>å°†å‘½ä»¤å†™å…¥æ—¥å¿—</u> è¿™ä¸€æ“ä½œåœ¨Redisä¸»è¿›ç¨‹å®Œæˆï¼Œè¿™æ˜¯ç”±äºå†™å…¥çš„åªæ˜¯å‡ æ¡å‘½ä»¤ï¼Œå› æ­¤ä¸ä¼šå¯¹ä¸»è¿›ç¨‹çš„å…¶ä»–æ“ä½œé€ æˆå¤ªå¤§å½±å“ã€‚</p><p>â€‹ç„¶è€Œï¼ŒAOFé‡å†™çš„è¿‡ç¨‹éœ€è¦å°†AOFæ—¥å¿—ä¸­çš„æ‰€æœ‰è¯­å¥éƒ½è¿›è¡Œåˆ¤æ–­ï¼Œå†™å…¥åˆ°æ–°çš„AOFæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ“ä½œæ¯”è¾ƒè€—æ—¶ï¼Œå› æ­¤å°†é‡å†™AOFçš„æ“ä½œæ”¾åœ¨ä¸»è¿›ç¨‹ä¸­æ‰§è¡Œæ˜¯ä¸åˆç†çš„ã€‚</p><h6 id="Redisçš„è§£å†³æ–¹æ¡ˆï¼š"><a href="#Redisçš„è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="Redisçš„è§£å†³æ–¹æ¡ˆï¼š"></a>Redisçš„è§£å†³æ–¹æ¡ˆï¼š</h6><p>â€‹Redis çš„<strong>é‡å†™ AOF è¿‡ç¨‹é€šè¿‡æ‰§è¡Œrediså‘½ä»¤<code>bgrewriteaof</code> åˆ©ç”¨åˆ›å»ºçš„å­è¿›ç¨‹æ¥å®ç°</strong>ï¼Œå…·ä½“å®ç°æ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>å­è¿›ç¨‹åœ¨é‡å†™AOFæœŸé—´ä¸ä¼šé˜»å¡ä¸»è¿›ç¨‹</li><li>è¿™é‡Œä¸ºä»€ä¹ˆæ˜¯å­**<u>è¿›ç¨‹</u><strong>è€Œä¸æ˜¯å­</strong><u>çº¿ç¨‹</u>**ï¼š<ul><li>å› ä¸ºå¦‚æœæ˜¯åŒä¸€è¿›ç¨‹ä¸­çš„ä¸¤ä¸ª<u>çº¿ç¨‹</u>çš„è¯ï¼Œçº¿ç¨‹ä¹‹é—´ä¼š<u>å…±äº«å†…å­˜</u>ï¼Œé‚£ä¹ˆåœ¨æœ‰ä¸€æ–¹è¦å¯¹å…±äº«æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå°±éœ€è¦é€šè¿‡åŠ é”çš„æ–¹å¼ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé™ä½äº†æ€§èƒ½ã€‚</li><li>å¦‚æœä½¿ç”¨å­<u>è¿›ç¨‹</u>ï¼Œåˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œçˆ¶å­è¿›ç¨‹æ˜¯å…±äº«å†…å­˜æ•°æ®çš„ï¼Œä¸è¿‡è¿™ä¸ªå…±äº«çš„å†…å­˜åªèƒ½ä»¥åªè¯»çš„æ–¹å¼ï¼Œè€Œå½“çˆ¶å­è¿›ç¨‹ä»»æ„ä¸€æ–¹ä¿®æ”¹äº†è¯¥å…±äº«å†…å­˜ï¼Œå°±ä¼šå‘ç”Ÿã€Œ<strong>å†™æ—¶å¤åˆ¶</strong>ã€ï¼Œäºæ˜¯çˆ¶å­è¿›ç¨‹å°±æœ‰äº†ç‹¬ç«‹çš„æ•°æ®å‰¯æœ¬ï¼Œå°±ä¸ç”¨åŠ é”æ¥ä¿è¯æ•°æ®å®‰å…¨ã€‚</li></ul></li></ul><h6 id="æ–¹æ¡ˆçš„å…·ä½“å®ç°ï¼š"><a href="#æ–¹æ¡ˆçš„å…·ä½“å®ç°ï¼š" class="headerlink" title="æ–¹æ¡ˆçš„å…·ä½“å®ç°ï¼š"></a>æ–¹æ¡ˆçš„å…·ä½“å®ç°ï¼š</h6><p>â€‹ä¸»è¿›ç¨‹é€šè¿‡ <code>fork</code> ç³»ç»Ÿè°ƒç”¨ç”Ÿæˆå­è¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠä¸»è¿›ç¨‹çš„ã€Œ<strong>é¡µè¡¨</strong>ã€å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ï¼Œè¿™ä¸ªé¡µè¡¨è®°å½•ç€è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€æ˜ å°„å…³ç³»ï¼Œè€Œä¸ä¼šå¤åˆ¶ç‰©ç†å†…å­˜ï¼Œ<u>ç„¶åè®©å­è¿›ç¨‹è¯»å–æ•°æ®åº“é‡Œçš„æ‰€æœ‰æ•°æ®ï¼Œå¹¶é€ä¸€æŠŠå†…å­˜æ•°æ®çš„é”®å€¼å¯¹è½¬æ¢æˆä¸€æ¡å‘½ä»¤ï¼Œå†å°†å‘½ä»¤è®°å½•åˆ°é‡å†™æ—¥å¿—ï¼ˆæ–°çš„ AOF æ–‡ä»¶ï¼‰ã€‚</u></p><p>â€‹ç°åœ¨ï¼Œçˆ¶å­è¿›ç¨‹çš„é¡µè¡¨ä¸­çš„å†…å®¹ç›¸åŒï¼Œä¸”çˆ¶å­è¿›ç¨‹å¯¹é¡µè¡¨è®°å½•çš„ç‰©ç†å†…å­˜çš„æƒé™ä¸ºã€Œåªè¯»ã€ï¼Œ</p><p>â€‹å½“çˆ¶è¿›ç¨‹æˆ–è€…å­è¿›ç¨‹åœ¨å‘è¿™ä¸ªå†…å­˜å‘èµ·å†™æ“ä½œæ—¶ï¼ŒCPU å°±ä¼šè§¦å‘<strong>å†™ä¿æŠ¤ä¸­æ–­</strong>ï¼Œä¼šå‘ç”Ÿã€Œ<strong>å†™æ—¶å¤åˆ¶</strong>ã€</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231007092622299.png" alt="image-20231007092622299"></p><p>å†™æ—¶å¤åˆ¶é¡¾åæ€ä¹‰ï¼Œ<strong>åœ¨å‘ç”Ÿå†™æ“ä½œçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¼šå»å¤åˆ¶ç‰©ç†å†…å­˜</strong>ï¼Œè¿™æ ·æ˜¯ä¸ºäº†<u>é˜²æ­¢ fork åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œç”±äºç‰©ç†å†…å­˜æ•°æ®çš„å¤åˆ¶æ—¶é—´è¿‡é•¿è€Œå¯¼è‡´çˆ¶è¿›ç¨‹é•¿æ—¶é—´é˜»å¡çš„é—®é¢˜ã€‚(å³ï¼Œå¯¹äºä¿®æ”¹äº†çš„æ•°æ®ï¼Œæ‰å¼€è¾Ÿæ–°çš„ç©ºé—´å­˜å‚¨ï¼Œå¯¹äºæ²¡æœ‰ä¿®æ”¹çš„æ•°æ®ï¼Œåˆ™æŒ‡å‘åŸæ¥çš„åœ°å€è€Œä¸å»é‡æ–°å¤åˆ¶ä¸€ä»½)</u></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æŸçº¿ç¨‹ä¿®æ”¹èµ„æºæ—¶ï¼Œå†™æ—¶å¤åˆ¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</span><br><span class="line">é¦–å…ˆï¼Œçº¿ç¨‹ä¼šåœ¨å†…å­˜ä¸­ä¸ºè¦ä¿®æ”¹çš„èµ„æºåˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨åŸå§‹èµ„æºä¸Šè¿›è¡Œä¿®æ”¹ã€‚è¿™ä¸ªå‰¯æœ¬æ˜¯ä¸åŸå§‹èµ„æºå…±äº«å†…å­˜ç©ºé—´çš„ï¼Œå¹¶ä¸”åˆå§‹çŠ¶æ€ä¸åŸå§‹èµ„æºç›¸åŒã€‚</span><br><span class="line">æ¥ä¸‹æ¥ï¼Œè¯¥çº¿ç¨‹å¯ä»¥åœ¨å‰¯æœ¬ä¸Šè¿›è¡Œä¿®æ”¹æ“ä½œï¼Œè€Œæ— éœ€æ‹…å¿ƒå…¶ä»–çº¿ç¨‹çš„å½±å“ã€‚è¿™æ„å‘³ç€åœ¨ä¿®æ”¹æœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹ä»ç„¶å¯ä»¥è®¿é—®å’Œè¯»å–åŸå§‹èµ„æºï¼Œè€Œä¸ä¼šè¢«é˜»å¡ã€‚</span><br></pre></td></tr></table></figure><p>æœ‰ä¸¤ä¸ªé˜¶æ®µä¼šå¯¼è‡´é˜»å¡çˆ¶è¿›ç¨‹ï¼š</p><ul><li>åˆ›å»ºå­è¿›ç¨‹çš„é€”ä¸­ï¼Œç”±äºè¦<strong>å¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨</strong>ç­‰æ•°æ®ç»“æ„ï¼Œé˜»å¡çš„æ—¶é—´è·Ÿé¡µè¡¨çš„å¤§å°æœ‰å…³ï¼Œé¡µè¡¨è¶Šå¤§ï¼Œé˜»å¡çš„æ—¶é—´ä¹Ÿè¶Šé•¿ï¼›</li><li>åˆ›å»ºå®Œå­è¿›ç¨‹åï¼Œå¦‚æœå­è¿›ç¨‹æˆ–è€…çˆ¶è¿›ç¨‹ä¿®æ”¹äº†å…±äº«æ•°æ®ï¼Œå°±ä¼š<strong>å‘ç”Ÿå†™æ—¶å¤åˆ¶</strong>ï¼Œè¿™æœŸé—´ä¼šæ‹·è´ç‰©ç†å†…å­˜ï¼Œå¦‚æœå†…å­˜è¶Šå¤§ï¼Œè‡ªç„¶é˜»å¡çš„æ—¶é—´ä¹Ÿè¶Šé•¿ï¼›</li></ul><p>é‡å†™ AOF æ—¥å¿—è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸»è¿›ç¨‹ä¿®æ”¹äº†å·²ç»å­˜åœ¨ key-valueï¼Œæ­¤æ—¶è¿™ä¸ª key-value æ•°æ®åœ¨å­è¿›ç¨‹çš„å†…å­˜æ•°æ®å°±è·Ÿä¸»è¿›ç¨‹çš„å†…å­˜æ•°æ®ä¸ä¸€è‡´äº†ï¼Œè¿™æ—¶è¦æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ä¸ºäº†è§£å†³è¿™ç§æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼ŒRedis è®¾ç½®äº†ä¸€ä¸ª <strong>AOF é‡å†™ç¼“å†²åŒº</strong>ï¼Œè¿™ä¸ªç¼“å†²åŒºåœ¨åˆ›å»º bgrewriteaof å­è¿›ç¨‹ä¹‹åå¼€å§‹ä½¿ç”¨ã€‚</p><p><u>åœ¨é‡å†™ AOF æœŸé—´</u>ï¼Œå½“ Redis æ‰§è¡Œå®Œä¸€ä¸ªå†™å‘½ä»¤ä¹‹åï¼Œå®ƒä¼š<strong>åŒæ—¶å°†è¿™ä¸ªå†™å‘½ä»¤å†™å…¥åˆ° ã€ŒAOF ç¼“å†²åŒºã€å’Œ ã€ŒAOF é‡å†™ç¼“å†²åŒºã€</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231007094049811.png" alt="image-20231007094049811"></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ bgrewriteaof å­è¿›ç¨‹æ‰§è¡Œ AOF é‡å†™æœŸé—´ï¼Œä¸»è¿›ç¨‹éœ€è¦æ‰§è¡Œä»¥ä¸‹ä¸‰ä¸ªå·¥ä½œ:</p><ul><li>æ‰§è¡Œå®¢æˆ·ç«¯å‘æ¥çš„å‘½ä»¤ï¼›</li><li>å°†æ‰§è¡Œåçš„å†™å‘½ä»¤è¿½åŠ åˆ° ã€ŒAOF ç¼“å†²åŒºã€ï¼›</li><li>å°†æ‰§è¡Œåçš„å†™å‘½ä»¤è¿½åŠ åˆ° ã€ŒAOF é‡å†™ç¼“å†²åŒºã€ï¼›</li></ul><p>å½“å­è¿›ç¨‹å®Œæˆ AOF é‡å†™å·¥ä½œï¼ˆ<em>æ‰«ææ•°æ®åº“ä¸­æ‰€æœ‰æ•°æ®ï¼Œé€ä¸€æŠŠå†…å­˜æ•°æ®çš„é”®å€¼å¯¹è½¬æ¢æˆä¸€æ¡å‘½ä»¤ï¼Œå†å°†å‘½ä»¤è®°å½•åˆ°é‡å†™æ—¥å¿—</em>ï¼‰åï¼Œä¼šå‘ä¸»è¿›ç¨‹<strong>å‘é€ä¸€æ¡ä¿¡å·</strong>ï¼Œä¿¡å·æ˜¯è¿›ç¨‹é—´é€šè®¯çš„ä¸€ç§æ–¹å¼ï¼Œä¸”æ˜¯å¼‚æ­¥çš„ã€‚</p><p>ä¸»è¿›ç¨‹æ”¶åˆ°è¯¥ä¿¡å·åï¼Œä¼šè°ƒç”¨ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸»è¦åšä»¥ä¸‹å·¥ä½œï¼š</p><ul><li>å°† AOF é‡å†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹è¿½åŠ åˆ°æ–°çš„ AOF çš„æ–‡ä»¶ä¸­ï¼Œä½¿å¾—æ–°æ—§ä¸¤ä¸ª AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ï¼›</li><li>æ–°çš„ AOF çš„æ–‡ä»¶è¿›è¡Œæ”¹åï¼Œè¦†ç›–ç°æœ‰çš„ AOF æ–‡ä»¶ã€‚</li></ul><p>ä¿¡å·å‡½æ•°æ‰§è¡Œå®Œåï¼Œä¸»è¿›ç¨‹å°±å¯ä»¥ç»§ç»­åƒå¾€å¸¸ä¸€æ ·å¤„ç†å‘½ä»¤äº†ã€‚</p><p>åœ¨æ•´ä¸ª AOF åå°é‡å†™è¿‡ç¨‹ä¸­ï¼Œé™¤äº†å‘ç”Ÿå†™æ—¶å¤åˆ¶ä¼šå¯¹ä¸»è¿›ç¨‹é€ æˆé˜»å¡ï¼Œè¿˜æœ‰ä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œæ—¶ä¹Ÿä¼šå¯¹ä¸»è¿›ç¨‹é€ æˆé˜»å¡ï¼Œåœ¨å…¶ä»–æ—¶å€™ï¼ŒAOF åå°é‡å†™éƒ½ä¸ä¼šé˜»å¡ä¸»è¿›ç¨‹ã€‚</p><h3 id="RDBï¼š"><a href="#RDBï¼š" class="headerlink" title="RDBï¼š"></a>RDBï¼š</h3><p>RDB å¿«ç…§è®°å½•æŸä¸€ä¸ªç¬é—´çš„å†…å­˜æ•°æ®ï¼Œè®°å½•çš„æ˜¯å®é™…æ•°æ®ã€‚</p><p>Redis æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ <code>save</code> å’Œ <code>bgsave</code>ï¼Œä»–ä»¬çš„åŒºåˆ«å°±åœ¨äºæ˜¯å¦åœ¨ã€Œä¸»çº¿ç¨‹ã€é‡Œæ‰§è¡Œï¼š</p><ul><li>æ‰§è¡Œäº† save å‘½ä»¤ï¼Œå°±ä¼šåœ¨ä¸»çº¿ç¨‹ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œç”±äºå’Œæ‰§è¡Œæ“ä½œå‘½ä»¤åœ¨åŒä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥å¦‚æœå†™å…¥ RDB æ–‡ä»¶çš„æ—¶é—´å¤ªé•¿ï¼Œ<strong>ä¼šé˜»å¡ä¸»çº¿ç¨‹</strong>ï¼›</li><li>æ‰§è¡Œäº† bgsave å‘½ä»¤ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥<strong>é¿å…ä¸»çº¿ç¨‹çš„é˜»å¡</strong>ï¼›</li></ul><p>Redis çš„å¿«ç…§æ˜¯<strong>å…¨é‡å¿«ç…§</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡æ‰§è¡Œå¿«ç…§ï¼Œéƒ½æ˜¯æŠŠå†…å­˜ä¸­çš„ã€Œæ‰€æœ‰æ•°æ®ã€éƒ½è®°å½•åˆ°ç£ç›˜ä¸­ã€‚</p><p>æ‰€ä»¥å¯ä»¥è®¤ä¸ºï¼Œæ‰§è¡Œå¿«ç…§æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡çš„æ“ä½œï¼Œå¦‚æœé¢‘ç‡å¤ªé«˜ï¼Œå¯èƒ½ä¼šå¯¹ Redis æ€§èƒ½äº§ç”Ÿå½±å“ã€‚å¦‚æœé¢‘ç‡å¤ªä½ï¼ŒæœåŠ¡å™¨æ•…éšœæ—¶ï¼Œä¸¢å¤±çš„æ•°æ®ä¼šæ›´å¤šã€‚</p><p>æ‰§è¡Œå¿«ç…§æ—¶ï¼Œredisä¸­çš„æ•°æ®ä¹Ÿèƒ½å¤Ÿè¢«ä¿®æ”¹ï¼Œé çš„ä¾ç„¶æ˜¯å†™æ—¶å¤åˆ¶æŠ€æœ¯<strong>ï¼ˆCopy-On-Write, COWï¼‰</strong></p><p>çˆ¶å­è¿›ç¨‹å…±äº«é¡µè¡¨ï¼Œçˆ¶è¿›ç¨‹è‹¥è¦ä¿®æ”¹ï¼Œåˆ™å¤åˆ¶ä¸€ä¸ªå‰¯æœ¬åå¯¹å‰¯æœ¬è¿›è¡Œä¿®æ”¹ã€‚è¿™æ ·çš„è¯ï¼ŒRDBå¿«ç…§ä¸­çš„æ•°æ®åªèƒ½æ˜¯å¼€å§‹æ‰§è¡Œå¤åˆ¶æ—¶çš„Redisä¸­åŸæœ¬çš„æ•°æ®ï¼Œä¸­é€”ä¿®æ”¹çš„æ•°æ®ä¸ä¼šè¢«è®°å½•ï¼Œè€Œæ˜¯éœ€è¦ä¸‹ä¸€æ¬¡ä¿å­˜RDBå¿«ç…§æ¥è®°å½•ã€‚</p><p>åœ¨ Redis æ‰§è¡Œ RDB æŒä¹…åŒ–æœŸé—´ï¼Œåˆš fork æ—¶ï¼Œä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹å…±äº«åŒä¸€ç‰©ç†å†…å­˜ï¼Œä½†æ˜¯é€”ä¸­ä¸»è¿›ç¨‹å¤„ç†äº†å†™æ“ä½œï¼Œä¿®æ”¹äº†å…±äº«å†…å­˜ï¼Œäºæ˜¯å½“å‰è¢«ä¿®æ”¹çš„æ•°æ®çš„ç‰©ç†å†…å­˜å°±ä¼šè¢«å¤åˆ¶ä¸€ä»½ã€‚é‚£ä¹ˆæç«¯æƒ…å†µä¸‹ï¼Œ<strong>å¦‚æœæ‰€æœ‰çš„å…±äº«å†…å­˜éƒ½è¢«ä¿®æ”¹ï¼Œåˆ™æ­¤æ—¶çš„å†…å­˜å ç”¨æ˜¯åŸå…ˆçš„ 2 å€ã€‚</strong></p><p>æ‰€ä»¥ï¼Œé’ˆå¯¹å†™æ“ä½œå¤šçš„åœºæ™¯ï¼Œæˆ‘ä»¬è¦ç•™æ„ä¸‹å¿«ç…§è¿‡ç¨‹ä¸­å†…å­˜çš„å˜åŒ–ï¼Œé˜²æ­¢å†…å­˜è¢«å æ»¡äº†ã€‚</p><h3 id="RDBå’ŒAOFæ··åˆï¼š"><a href="#RDBå’ŒAOFæ··åˆï¼š" class="headerlink" title="RDBå’ŒAOFæ··åˆï¼š"></a>RDBå’ŒAOFæ··åˆï¼š</h3><p>â€‹å°½ç®¡ RDB æ¯” AOF çš„æ•°æ®æ¢å¤é€Ÿåº¦å¿«ï¼Œä½†æ˜¯å¿«ç…§çš„é¢‘ç‡ä¸å¥½æŠŠæ¡ï¼š</p><p>åœ¨ Redis 4.0 æå‡ºä¸€ç§æ–¹æ³•ï¼š<strong>æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§</strong>ï¼Œä¹Ÿå«æ··åˆæŒä¹…åŒ–ã€‚</p><p>â€‹å½“å¼€å¯äº†æ··åˆæŒä¹…åŒ–æ—¶ï¼Œåœ¨ AOF é‡å†™æ—¥å¿—æ—¶ï¼Œ<code>fork</code> å‡ºæ¥çš„é‡å†™å­è¿›ç¨‹ä¼šå…ˆå°†ä¸ä¸»çº¿ç¨‹å…±äº«çš„å†…å­˜æ•°æ®ä»¥ RDB æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œç„¶åä¸»çº¿ç¨‹å¤„ç†çš„æ“ä½œå‘½ä»¤ä¼šè¢«è®°å½•åœ¨é‡å†™ç¼“å†²åŒºé‡Œï¼Œé‡å†™ç¼“å†²åŒºé‡Œçš„å¢é‡å‘½ä»¤ä¼šä»¥ AOF æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œå†™å…¥å®Œæˆåé€šçŸ¥ä¸»è¿›ç¨‹å°†æ–°çš„å«æœ‰ RDB æ ¼å¼å’Œ AOF æ ¼å¼çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„çš„ AOF æ–‡ä»¶ã€‚</p><p>â€‹ä½¿ç”¨äº†æ··åˆæŒä¹…åŒ–ï¼ŒAOF æ–‡ä»¶çš„<strong>å‰åŠéƒ¨åˆ†æ˜¯ RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼ŒååŠéƒ¨åˆ†æ˜¯ AOF æ ¼å¼çš„å¢é‡æ•°æ®</strong>ã€‚</p><p>â€‹è¿™æ ·çš„å¥½å¤„åœ¨äºï¼Œé‡å¯ Redis åŠ è½½æ•°æ®çš„æ—¶å€™ï¼Œç”±äºå‰åŠéƒ¨åˆ†æ˜¯ RDB å†…å®¹ï¼Œè¿™æ ·<strong>åŠ è½½çš„æ—¶å€™é€Ÿåº¦ä¼šå¾ˆå¿«</strong>ã€‚åŠ è½½å®Œ RDB çš„å†…å®¹åï¼Œæ‰ä¼šåŠ è½½ååŠéƒ¨åˆ†çš„ AOF å†…å®¹ï¼Œè¿™é‡Œçš„å†…å®¹æ˜¯ Redis åå°å­è¿›ç¨‹é‡å†™ AOF æœŸé—´ï¼Œä¸»çº¿ç¨‹å¤„ç†çš„æ“ä½œå‘½ä»¤ï¼Œå¯ä»¥ä½¿å¾—<strong>æ•°æ®æ›´å°‘çš„ä¸¢å¤±</strong>ã€‚</p><h2 id="Redisé«˜å¯ç”¨ï¼š"><a href="#Redisé«˜å¯ç”¨ï¼š" class="headerlink" title="Redisé«˜å¯ç”¨ï¼š"></a>Redisé«˜å¯ç”¨ï¼š</h2><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://segmentfault.com/a/1190000022808576">ä½ äº†è§£ Redis çš„ä¸‰ç§é›†ç¾¤æ¨¡å¼å—ï¼Ÿ</a></li><li><a href="https://security.feishu.cn/link/safety?target=https://xiaolincoding.com/redis/cluster/master_slave_replication.html&scene=ccm&logParams=%7B%22location%22:%22ccm_default%22%7D&lang=zh-CN">ä¸»ä»å¤åˆ¶æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</a></li><li><a href="https://xiaolincoding.com/redis/cluster/sentinel.html">ä¸ºä»€ä¹ˆè¦æœ‰å“¨å…µ</a></li><li><a href="https://z.itpub.net/article/detail/D63884E646552F22E025E7F50BE5C7CB">æ·±å…¥åˆ†æCluster é›†ç¾¤æ¨¡å¼</a></li></ul><h3 id="ä¸»ä»æ¨¡å¼ï¼š"><a href="#ä¸»ä»æ¨¡å¼ï¼š" class="headerlink" title="ä¸»ä»æ¨¡å¼ï¼š"></a>ä¸»ä»æ¨¡å¼ï¼š</h3><p>â€‹ä¸MySQLä¸­çš„æ–¹æ¡ˆç±»ä¼¼ï¼Œä¸»æ•°æ®åº“å¯ä»¥è¯»å†™ã€ä»æ•°æ®åº“åªè¯»ã€Œè¯»å†™åˆ†ç¦»ã€ã€‚</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20231008145357993.png" alt="image-20231008145357993" style="zoom:50%;" /><h4 id="ä¸»ä»å¤åˆ¶è¿è¡ŒåŸç†ï¼š"><a href="#ä¸»ä»å¤åˆ¶è¿è¡ŒåŸç†ï¼š" class="headerlink" title="ä¸»ä»å¤åˆ¶è¿è¡ŒåŸç†ï¼š"></a>ä¸»ä»å¤åˆ¶è¿è¡ŒåŸç†ï¼š</h4><p>â€‹åœ¨ä»æœåŠ¡å™¨ä¸Šæ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼š<u>replicaof &lt;æœåŠ¡å™¨ A çš„ IP åœ°å€&gt; &lt;æœåŠ¡å™¨ A çš„ Redis ç«¯å£å·&gt;</u></p><p>â€‹è¿™æ ·ï¼Œè¯¥æœåŠ¡å™¨çš„redisæœåŠ¡å°±æˆä¸ºæœåŠ¡å™¨Açš„ä»æœåŠ¡å™¨</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231008140330120.png" alt="image-20231008140330120" style="zoom:50%;" /><h4 id="å…·ä½“æµç¨‹ï¼š"><a href="#å…·ä½“æµç¨‹ï¼š" class="headerlink" title="å…·ä½“æµç¨‹ï¼š"></a>å…·ä½“æµç¨‹ï¼š</h4><ul><li>ä»æ•°æ®åº“å¯åŠ¨æˆåŠŸåï¼Œè¿æ¥ä¸»æ•°æ®åº“ï¼Œå‘é€ SYNC å‘½ä»¤ï¼›</li><li>ä¸»æ•°æ®åº“æ¥æ”¶åˆ° SYNC å‘½ä»¤åï¼Œå¼€å§‹æ‰§è¡Œ BGSAVE å‘½ä»¤<strong>ç”Ÿæˆ RDB æ–‡ä»¶</strong>å¹¶<strong>ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ­¤åæ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤</strong>ï¼›</li><li>ä¸»æ•°æ®åº“ BGSAVE æ‰§è¡Œå®Œåï¼Œå‘æ‰€æœ‰ä»æ•°æ®åº“<strong>å‘é€å¿«ç…§æ–‡ä»¶</strong>ï¼Œå¹¶åœ¨å‘é€æœŸé—´ç»§ç»­<strong>è®°å½•è¢«æ‰§è¡Œçš„å†™å‘½ä»¤</strong>ï¼›</li><li>ä»æ•°æ®åº“æ”¶åˆ°å¿«ç…§æ–‡ä»¶åä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥æ”¶åˆ°çš„å¿«ç…§ï¼›</li><li>ä¸»æ•°æ®åº“å¿«ç…§å‘é€å®Œæ¯•åå¼€å§‹å‘ä»æ•°æ®åº“å‘é€<strong>ç¼“å†²åŒº</strong>ä¸­çš„å†™<strong>å‘½ä»¤</strong>ï¼›</li><li>ä»æ•°æ®åº“å®Œæˆå¯¹å¿«ç…§çš„è½½å…¥ï¼Œå¼€å§‹æ¥æ”¶å‘½ä»¤è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ¥è‡ªä¸»æ•°æ®åº“ç¼“å†²åŒºçš„å†™å‘½ä»¤ï¼›ï¼ˆ<strong>ä»æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ</strong>ï¼‰</li><li>ä¸»æ•°æ®åº“æ¯æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤å°±ä¼šå‘ä»æ•°æ®åº“å‘é€ç›¸åŒçš„å†™å‘½ä»¤ï¼Œä»æ•°æ®åº“æ¥æ”¶å¹¶æ‰§è¡Œæ”¶åˆ°çš„å†™å‘½ä»¤ï¼ˆ<strong>ä»æ•°æ®åº“åˆå§‹åŒ–å®Œæˆåçš„æ“ä½œ</strong>ï¼‰</li><li><strong>ç”±äºä¸»æœåŠ¡å™¨ä¸ä»æœåŠ¡å™¨ä¹‹é—´å®Œæˆå…¨é‡å¤åˆ¶åï¼Œä¼šç»´æŒä¸€ä¸ªTCPè¿æ¥ç”¨äºå®ç°åç»­çš„å¢é‡å¤åˆ¶ï¼Œå¦‚æœTCPè¿æ¥ç”±äºç½‘ç»œæ³¢åŠ¨å‡ºç°æ–­å¼€é‡è¿çš„æƒ…å†µï¼ŒRedis2.8ä¹‹åçš„ç‰ˆæœ¬ä¼šå°†æ–­çº¿æœŸé—´çš„å‘½ä»¤ä¼ ç»™ä»æ•°æ®åº“ï¼Œå³ä»ä½¿ç”¨å¢é‡å¤åˆ¶æ¥è¿›è¡ŒåŒæ­¥ã€‚</strong><ul><li>è¿™ç§ç½‘ç»œæ–­å¼€çš„æƒ…å†µä¸‹ï¼Œå…¶å®ä¹Ÿæ˜¯æœ‰å¢é‡å¤åˆ¶ã€å…¨é‡å¤åˆ¶ä¸¤ç§æƒ…å†µçš„ï¼š<ul><li><u>rediså¯¹äºå†™å‘½ä»¤ä¼šæœ‰ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼Œä¸»ã€ä»æœåŠ¡å™¨å„æœ‰ä¸€ä¸ªoffsetæŒ‡é’ˆæŒ‡å‘ç¼“å†²åŒºä¸­çš„æŸæ¡æŒ‡ä»¤ï¼Œè¡¨ç¤ºæ‰§è¡Œåˆ°äº†å“ªæ¡ï¼Œå¦‚æœä»æœåŠ¡å™¨ç½‘ç»œæ¢å¤æ—¶ï¼Œå…¶offsetæŒ‡é’ˆæŒ‡å‘çš„ä½ç½®åœ¨ç¼“å†²åŒºä¸­ä¸å­˜åœ¨(è¯´æ˜æ‰çº¿å¤ªä¹…äº†ï¼Œç¯å½¢ç¼“å†²åŒºå·²ç»è¢«è¦†ç›–ä¸€åœˆäº†ï¼Œä¸èƒ½å¤Ÿå†é€šè¿‡è¿™ä¸ªç¼“å†²åŒºæ¥åŒæ­¥è¿›åº¦äº†ï¼Œè¿™æ—¶å€™ä¼šé‡‡ç”¨å…¨é‡å¤åˆ¶æ¥åŒæ­¥æ•°æ®ï¼›å¦åˆ™ï¼Œä¼šä½¿ç”¨å¢é‡å¤åˆ¶æ¥åŒæ­¥æ•°æ®ã€‚)</u></li></ul></li></ul></li><li>ä¸»ä»æ•°æ®åº“åˆšåˆšè¿æ¥çš„æ—¶å€™ï¼Œè¿›è¡Œå…¨é‡åŒæ­¥ï¼›å…¨åŒæ­¥ç»“æŸåï¼Œè¿›è¡Œå¢é‡åŒæ­¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œslave åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥å‘èµ·å…¨é‡åŒæ­¥ã€‚Redis çš„ç­–ç•¥æ˜¯ï¼Œæ— è®ºå¦‚ä½•ï¼Œé¦–å…ˆä¼šå°è¯•è¿›è¡Œå¢é‡åŒæ­¥ï¼Œå¦‚ä¸æˆåŠŸï¼Œè¦æ±‚ä»æœºè¿›è¡Œå…¨é‡åŒæ­¥ã€‚</li></ul><h4 id="é—®é¢˜ï¼šä»æœåŠ¡å™¨æ•°é‡è¾ƒå¤šï¼š"><a href="#é—®é¢˜ï¼šä»æœåŠ¡å™¨æ•°é‡è¾ƒå¤šï¼š" class="headerlink" title="é—®é¢˜ï¼šä»æœåŠ¡å™¨æ•°é‡è¾ƒå¤šï¼š"></a>é—®é¢˜ï¼šä»æœåŠ¡å™¨æ•°é‡è¾ƒå¤šï¼š</h4><p>å¦‚æœä»æœåŠ¡å™¨è¾ƒå¤šï¼Œè€Œä¸”éƒ½ä¸ä¸»æœåŠ¡å™¨è¿›è¡Œå…¨é‡åŒæ­¥çš„è¯ï¼Œå°±ä¼šå¸¦æ¥ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>ç”±äºæ˜¯é€šè¿‡ bgsave å‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶çš„ï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°±ä¼šå¿™äºä½¿ç”¨ fork() åˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚æœä¸»æœåŠ¡å™¨çš„å†…å­˜æ•°æ®éå¤§ï¼Œåœ¨æ‰§è¡Œ fork() å‡½æ•°æ—¶æ˜¯ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„ï¼Œä»è€Œä½¿å¾— Redis æ— æ³•æ­£å¸¸å¤„ç†è¯·æ±‚ï¼›</li><li>ä¼ è¾“ RDB æ–‡ä»¶ä¼šå ç”¨ä¸»æœåŠ¡å™¨çš„ç½‘ç»œå¸¦å®½ï¼Œä¼šå¯¹ä¸»æœåŠ¡å™¨å“åº”å‘½ä»¤è¯·æ±‚äº§ç”Ÿå½±å“ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥æ„å»ºæ ‘çŠ¶ç»“æ„çš„ä¸»ä»å…³ç³»ï¼Œè®©ä¸»æœåŠ¡å™¨ç®¡ç†ä¸ªåˆ«ä»æœåŠ¡å™¨ï¼Œå†è®©è¿™å‡ ä¸ªä»æœåŠ¡å™¨ç®¡ç†å…¶ä»–çš„ä»æœåŠ¡å™¨ï¼Œä»¥è¾¾åˆ°åˆ†æ•£ä¸»æœåŠ¡å™¨å‹åŠ›çš„ç›®çš„ã€‚</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20231008150658511.png" alt="image-20231008150658511" style="zoom:50%;" /><h4 id="ä¸»ä»å¤åˆ¶ä¼˜ç‚¹ï¼š"><a href="#ä¸»ä»å¤åˆ¶ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¸»ä»å¤åˆ¶ä¼˜ç‚¹ï¼š"></a>ä¸»ä»å¤åˆ¶ä¼˜ç‚¹ï¼š</h4><ul><li>æ”¯æŒä¸»ä»å¤åˆ¶ï¼Œä¸»æœºä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»æœºï¼Œå¯ä»¥è¿›è¡Œ<u>è¯»å†™åˆ†ç¦»</u>ï¼›</li><li>ä¸ºäº†<u>åˆ†æ•£ Master çš„è¯»æ“ä½œå‹åŠ›</u>ï¼ŒSlave æœåŠ¡å™¨å¯ä»¥ä¸ºå®¢æˆ·ç«¯æä¾›åªè¯»æ“ä½œçš„æœåŠ¡ï¼Œå†™æœåŠ¡ä»ç„¶å¿…é¡»ç”±Masteræ¥å®Œæˆï¼›</li><li><u>Slave åŒæ ·å¯ä»¥æ¥å—å…¶å®ƒ Slaves çš„è¿æ¥å’ŒåŒæ­¥è¯·æ±‚</u>ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„åˆ†æ•£ Master çš„åŒæ­¥å‹åŠ›ï¼›</li><li>Master Server æ˜¯ä»¥éé˜»å¡çš„æ–¹å¼ä¸º Slaves æä¾›æœåŠ¡ã€‚æ‰€ä»¥<u>åœ¨ Master-Slave åŒæ­¥æœŸé—´ï¼Œå®¢æˆ·ç«¯ä»ç„¶å¯ä»¥æäº¤æŸ¥è¯¢æˆ–ä¿®æ”¹è¯·æ±‚</u>ï¼›</li><li>Slave Server åŒæ ·æ˜¯ä»¥éé˜»å¡çš„æ–¹å¼å®Œæˆæ•°æ®åŒæ­¥ã€‚åœ¨åŒæ­¥æœŸé—´ï¼Œå¦‚æœæœ‰å®¢æˆ·ç«¯æäº¤æŸ¥è¯¢è¯·æ±‚ï¼ŒRedisåˆ™è¿”å›åŒæ­¥ä¹‹å‰çš„æ•°æ®ï¼›</li></ul><h4 id="ä¸»ä»å¤åˆ¶ç¼ºç‚¹ï¼š"><a href="#ä¸»ä»å¤åˆ¶ç¼ºç‚¹ï¼š" class="headerlink" title="ä¸»ä»å¤åˆ¶ç¼ºç‚¹ï¼š"></a>ä¸»ä»å¤åˆ¶ç¼ºç‚¹ï¼š</h4><ul><li>Redisä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½ï¼Œä¸»æœºä»æœºçš„å®•æœºéƒ½ä¼šå¯¼è‡´å‰ç«¯éƒ¨åˆ†è¯»å†™è¯·æ±‚å¤±è´¥ï¼Œéœ€è¦ç­‰å¾…æœºå™¨é‡å¯æˆ–è€…æ‰‹åŠ¨åˆ‡æ¢å‰ç«¯çš„IP(æ‰‹åŠ¨é‡æ–°è®¾ç½®ä¸»æ•°æ®åº“)æ‰èƒ½æ¢å¤ï¼ˆ<strong>ä¹Ÿå°±æ˜¯è¦äººå·¥ä»‹å…¥</strong>ï¼‰ï¼›</li><li>ä¸»æœºå®•æœºï¼Œå®•æœºå‰æœ‰éƒ¨åˆ†æ•°æ®æœªèƒ½åŠæ—¶åŒæ­¥åˆ°ä»æœºï¼Œåˆ‡æ¢IPåè¿˜ä¼šå¼•å…¥æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé™ä½äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼›</li><li>å¦‚æœå¤šä¸ª Slave æ–­çº¿äº†ï¼Œéœ€è¦é‡å¯çš„æ—¶å€™ï¼Œå°½é‡ä¸è¦åœ¨åŒä¸€æ—¶é—´æ®µè¿›è¡Œé‡å¯ã€‚å› ä¸ºåªè¦ Slave å¯åŠ¨ï¼Œå°±ä¼šå‘é€sync è¯·æ±‚å’Œä¸»æœºå…¨é‡åŒæ­¥ï¼Œå½“å¤šä¸ª Slave é‡å¯çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¯¼è‡´ Master IO å‰§å¢ä»è€Œå®•æœºã€‚</li><li>Redis è¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ï¼›</li></ul><h3 id="å“¨å…µæ¨¡å¼-Sentinel-æ¨¡å¼-ï¼š"><a href="#å“¨å…µæ¨¡å¼-Sentinel-æ¨¡å¼-ï¼š" class="headerlink" title="å“¨å…µæ¨¡å¼(Sentinel æ¨¡å¼)ï¼š"></a>å“¨å…µæ¨¡å¼(Sentinel æ¨¡å¼)ï¼š</h3><p>â€‹Redis æä¾›äº†å“¨å…µçš„å‘½ä»¤ï¼Œ<strong>å“¨å…µæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä½œä¸ºè¿›ç¨‹ï¼Œå®ƒä¼šç‹¬ç«‹è¿è¡Œã€‚å…¶åŸç†æ˜¯å“¨å…µé€šè¿‡å‘é€å‘½ä»¤ï¼Œç­‰å¾…RedisæœåŠ¡å™¨å“åº”ï¼Œä»è€Œç›‘æ§è¿è¡Œçš„å¤šä¸ª Redis å®ä¾‹</strong>ã€‚</p><p>â€‹ç®€å•å“¨å…µæ¨¡å¼ï¼š</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20231008141843134.png" alt="image-20231008141843134" style="zoom:50%;" /><p>â€‹å¤šå“¨å…µæ¨¡å¼ï¼š</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20231008141935130.png" alt="image-20231008141935130" style="zoom:50%;" /><h4 id="å“¨å…µæ¨¡å¼çš„å·¥ä½œæ–¹å¼ï¼š"><a href="#å“¨å…µæ¨¡å¼çš„å·¥ä½œæ–¹å¼ï¼š" class="headerlink" title="å“¨å…µæ¨¡å¼çš„å·¥ä½œæ–¹å¼ï¼š"></a>å“¨å…µæ¨¡å¼çš„å·¥ä½œæ–¹å¼ï¼š</h4><p>â€‹ä¸‰æ­¥éª¤ï¼š<strong>ç›‘æ§ã€é€‰ä¸»ã€é€šçŸ¥</strong></p><ul><li>æ¯ä¸ªSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä»¥æ¯ç§’é’Ÿä¸€æ¬¡çš„é¢‘ç‡å‘æ•´ä¸ªé›†ç¾¤ä¸­çš„ Master ä¸»æœåŠ¡å™¨ã€Slave ä»æœåŠ¡å™¨ä»¥åŠå…¶ä»–Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ä¸€ä¸ª PING å‘½ä»¤ã€‚</li><li>å¦‚æœä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åä¸€æ¬¡æœ‰æ•ˆå›å¤ PING å‘½ä»¤çš„æ—¶é—´è¶…è¿‡ down-after-milliseconds é€‰é¡¹æ‰€æŒ‡å®šçš„å€¼ï¼Œ åˆ™è¿™ä¸ªå®ä¾‹ä¼šè¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸º<strong>ä¸»è§‚ä¸‹çº¿</strong>ï¼ˆSDOWNï¼‰</li><li>å¦‚æœä¸€ä¸ª Master ä¸»æœåŠ¡å™¨è¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰ï¼Œåˆ™æ­£åœ¨ç›‘è§†è¿™ä¸ª Master ä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹è¦ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ç¡®è®¤ Master ä¸»æœåŠ¡å™¨çš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€</li><li>å½“æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ï¼ˆå¤§äºç­‰äºé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼‰åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤ Master ä¸»æœåŠ¡å™¨è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼ˆSDOWNï¼‰ï¼Œ åˆ™ Master ä¸»æœåŠ¡å™¨ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰<ul><li>ğŸŒŸ</li><li>æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿åï¼Œå“¨å…µä»¬å‘èµ·<u>æŠ•ç¥¨</u>ï¼Œå…ˆæŠ•ç¥¨<strong>é€‰å‡ºä¸€ä¸ªLeaderå“¨å…µ</strong>æ¥å¤„ç†æœ¬æ¬¡æ•…éšœè½¬ç§»çš„æµç¨‹ï¼</li><li>é€‰å‡ºLeaderå“¨å…µåï¼Œå®è¡Œä¸»ä»æ•…éšœè½¬ç§»ï¼š<ul><li>ç¬¬ä¸€æ­¥ï¼šåœ¨å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹ï¼ˆæ—§ä¸»èŠ‚ç‚¹ï¼‰å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€é‡Œé¢ï¼ŒæŒ‘é€‰å‡ºä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸»èŠ‚ç‚¹ã€‚</li><li>ç¬¬äºŒæ­¥ï¼šè®©å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€ä¿®æ”¹å¤åˆ¶ç›®æ ‡ï¼Œä¿®æ”¹ä¸ºå¤åˆ¶ã€Œæ–°ä¸»èŠ‚ç‚¹ã€ï¼›</li><li>ç¬¬ä¸‰æ­¥ï¼šå°†æ–°ä¸»èŠ‚ç‚¹çš„ IP åœ°å€å’Œä¿¡æ¯ï¼Œé€šè¿‡ã€Œå‘å¸ƒè€…&#x2F;è®¢é˜…è€…æœºåˆ¶ã€é€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼›</li><li>ç¬¬å››æ­¥ï¼šç»§ç»­ç›‘è§†æ—§ä¸»èŠ‚ç‚¹ï¼Œå½“è¿™ä¸ªæ—§ä¸»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œå°†å®ƒè®¾ç½®ä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼›</li></ul></li></ul></li><li>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ä¸ª Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä¼šä»¥æ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘é›†ç¾¤ä¸­çš„æ‰€æœ‰ Master ä¸»æœåŠ¡å™¨ã€Slave ä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤ã€‚</li><li>å½“ Master ä¸»æœåŠ¡å™¨è¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰æ—¶ï¼ŒSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘ä¸‹çº¿çš„ Master ä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Slave ä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤çš„é¢‘ç‡ä¼šä» 10 ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡ã€‚</li><li>è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹åŒæ„ Masterä¸»æœåŠ¡å™¨ä¸‹çº¿ï¼Œ Master ä¸»æœåŠ¡å™¨çš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚è‹¥ Master ä¸»æœåŠ¡å™¨é‡æ–°å‘ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ PING å‘½ä»¤è¿”å›æœ‰æ•ˆå›å¤ï¼ŒMasterä¸»æœåŠ¡å™¨çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚</li></ul><p>å“¨å…µæ¨¡å¼<strong>å¯ä»¥çœ‹ä½œè‡ªåŠ¨ç‰ˆçš„ä¸»ä»å¤åˆ¶</strong>ï¼Œä½†æ˜¯ä»è¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ã€‚</p><h4 id="æ€»ç»“ï¼š-2"><a href="#æ€»ç»“ï¼š-2" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h4><h5 id="1ã€ç¬¬ä¸€è½®æŠ•ç¥¨ï¼šåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸‹çº¿"><a href="#1ã€ç¬¬ä¸€è½®æŠ•ç¥¨ï¼šåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸‹çº¿" class="headerlink" title="1ã€ç¬¬ä¸€è½®æŠ•ç¥¨ï¼šåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸‹çº¿"></a><em>1ã€ç¬¬ä¸€è½®æŠ•ç¥¨ï¼šåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸‹çº¿</em></h5><p>â€‹å½“å“¨å…µé›†ç¾¤ä¸­çš„æŸä¸ªå“¨å…µåˆ¤å®šä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼ˆä¸»è§‚ä¸‹çº¿ï¼‰åï¼Œå°±ä¼šå‘å…¶ä»–å“¨å…µå‘èµ·å‘½ä»¤ï¼Œå…¶ä»–å“¨å…µæ”¶åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œå°±ä¼šæ ¹æ®è‡ªèº«å’Œä¸»èŠ‚ç‚¹çš„ç½‘ç»œçŠ¶å†µï¼Œåšå‡ºèµæˆæŠ•ç¥¨æˆ–è€…æ‹’ç»æŠ•ç¥¨çš„å“åº”ã€‚</p><p>å½“è¿™ä¸ªå“¨å…µçš„èµåŒç¥¨æ•°è¾¾åˆ°å“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum é…ç½®é¡¹è®¾å®šçš„å€¼åï¼Œè¿™æ—¶ä¸»èŠ‚ç‚¹å°±ä¼šè¢«è¯¥å“¨å…µæ ‡è®°ä¸ºã€Œå®¢è§‚ä¸‹çº¿ã€ã€‚</p><h5 id="2ã€ç¬¬äºŒè½®æŠ•ç¥¨ï¼šé€‰å‡ºå“¨å…µleader"><a href="#2ã€ç¬¬äºŒè½®æŠ•ç¥¨ï¼šé€‰å‡ºå“¨å…µleader" class="headerlink" title="2ã€ç¬¬äºŒè½®æŠ•ç¥¨ï¼šé€‰å‡ºå“¨å…µleader"></a><em>2ã€ç¬¬äºŒè½®æŠ•ç¥¨ï¼šé€‰å‡ºå“¨å…µleader</em></h5><p>â€‹æŸä¸ªå“¨å…µåˆ¤å®šä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿åï¼Œè¯¥å“¨å…µå°±ä¼šå‘èµ·æŠ•ç¥¨ï¼Œå‘Šè¯‰å…¶ä»–å“¨å…µï¼Œå®ƒæƒ³æˆä¸º leaderï¼Œæƒ³æˆä¸º leader çš„å“¨å…µèŠ‚ç‚¹ï¼Œè¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>ç¬¬ä¸€ï¼Œæ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµæˆç¥¨ï¼›</li><li>ç¬¬äºŒï¼Œæ‹¿åˆ°çš„ç¥¨æ•°åŒæ—¶è¿˜éœ€è¦å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum å€¼ã€‚</li></ul><h5 id="3ã€ç”±å“¨å…µ-leader-è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»"><a href="#3ã€ç”±å“¨å…µ-leader-è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»" class="headerlink" title="3ã€ç”±å“¨å…µ leader è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»"></a><em>3ã€ç”±å“¨å…µ leader è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»</em></h5><p>â€‹é€‰ä¸¾å‡ºäº†å“¨å…µ leader åï¼Œå°±å¯ä»¥è¿›è¡Œä¸»ä»æ•…éšœè½¬ç§»çš„è¿‡ç¨‹äº†ã€‚è¯¥æ“ä½œåŒ…å«ä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼šåœ¨å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹ï¼ˆæ—§ä¸»èŠ‚ç‚¹ï¼‰å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€é‡Œé¢ï¼ŒæŒ‘é€‰å‡ºä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œé€‰æ‹©çš„è§„åˆ™ï¼š<ul><li>è¿‡æ»¤æ‰å·²ç»ç¦»çº¿çš„ä»èŠ‚ç‚¹ï¼›</li><li>è¿‡æ»¤æ‰å†å²ç½‘ç»œè¿æ¥çŠ¶æ€ä¸å¥½çš„ä»èŠ‚ç‚¹ï¼›</li><li>å°†å‰©ä¸‹çš„ä»èŠ‚ç‚¹ï¼Œè¿›è¡Œä¸‰è½®è€ƒå¯Ÿï¼šä¼˜å…ˆçº§ã€å¤åˆ¶è¿›åº¦ã€ID å·ã€‚åœ¨æ¯ä¸€è½®è€ƒå¯Ÿè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ‰¾åˆ°äº†ä¸€ä¸ªèƒœå‡ºçš„ä»èŠ‚ç‚¹ï¼Œå°±å°†å…¶ä½œä¸ºæ–°ä¸»èŠ‚ç‚¹ã€‚</li></ul></li><li>ç¬¬äºŒæ­¥ï¼šè®©å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹å±ä¸‹çš„æ‰€æœ‰ã€Œä»èŠ‚ç‚¹ã€ä¿®æ”¹å¤åˆ¶ç›®æ ‡ï¼Œä¿®æ”¹ä¸ºå¤åˆ¶ã€Œæ–°ä¸»èŠ‚ç‚¹ã€ï¼›</li><li>ç¬¬ä¸‰æ­¥ï¼šå°†æ–°ä¸»èŠ‚ç‚¹çš„ IP åœ°å€å’Œä¿¡æ¯ï¼Œé€šè¿‡ã€Œå‘å¸ƒè€…&#x2F;è®¢é˜…è€…æœºåˆ¶ã€é€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼›</li><li>ç¬¬å››æ­¥ï¼šç»§ç»­ç›‘è§†æ—§ä¸»èŠ‚ç‚¹ï¼Œå½“è¿™ä¸ªæ—§ä¸»èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œå°†å®ƒè®¾ç½®ä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼›</li></ul><h3 id="é›†ç¾¤æ¨¡å¼-Cluster-æ¨¡å¼-ï¼š"><a href="#é›†ç¾¤æ¨¡å¼-Cluster-æ¨¡å¼-ï¼š" class="headerlink" title="é›†ç¾¤æ¨¡å¼(Cluster æ¨¡å¼)ï¼š"></a>é›†ç¾¤æ¨¡å¼(Cluster æ¨¡å¼)ï¼š</h3><p>â€‹Cluster é›†ç¾¤æ¨¡å¼ï¼Œå®ç°äº† Redis çš„åˆ†å¸ƒå¼å­˜å‚¨ï¼Œ<strong>æ¯å° Redis èŠ‚ç‚¹ä¸Šå­˜å‚¨ä¸åŒçš„å†…å®¹</strong>ã€‚</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20231008143654026.png" alt="image-20231008143654026" style="zoom:50%;" /><p>â€‹åœ¨è¿™ä¸ªå›¾ä¸­ï¼Œæ¯ä¸€ä¸ªè“è‰²çš„åœˆéƒ½ä»£è¡¨ç€ä¸€ä¸ª redis çš„æœåŠ¡å™¨èŠ‚ç‚¹ã€‚å®ƒä»¬ä»»ä½•ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´éƒ½æ˜¯ç›¸äº’è¿é€šçš„ã€‚å®¢æˆ·ç«¯å¯ä»¥ä¸ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ç›¸è¿æ¥ï¼Œç„¶åå°±å¯ä»¥è®¿é—®é›†ç¾¤ä¸­çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¯¹å…¶è¿›è¡Œå­˜å–å’Œå…¶ä»–æ“ä½œã€‚</p><p>â€‹</p><h4 id="é›†ç¾¤çš„æ•°æ®åˆ†ç‰‡ï¼š"><a href="#é›†ç¾¤çš„æ•°æ®åˆ†ç‰‡ï¼š" class="headerlink" title="é›†ç¾¤çš„æ•°æ®åˆ†ç‰‡ï¼š"></a>é›†ç¾¤çš„æ•°æ®åˆ†ç‰‡ï¼š</h4><p>Redis é›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§ hashï¼Œè€Œæ˜¯å¼•å…¥äº†å“ˆå¸Œæ§½ã€hash slotã€‘çš„æ¦‚å¿µã€‚</p><p>Redis é›†ç¾¤æœ‰16384 ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ª key é€šè¿‡ CRC16 æ ¡éªŒåå¯¹ 16384 å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ã€‚é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚å½“å‰é›†ç¾¤æœ‰3ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆï¼š</p><ul><li>èŠ‚ç‚¹ A åŒ…å« 0 åˆ° 5460 å·å“ˆå¸Œæ§½</li><li>èŠ‚ç‚¹ B åŒ…å« 5461 åˆ° 10922 å·å“ˆå¸Œæ§½</li><li>èŠ‚ç‚¹ C åŒ…å« 10923 åˆ° 16383 å·å“ˆå¸Œæ§½</li></ul><p>è¿™ç§ç»“æ„å¾ˆå®¹æ˜“æ·»åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹ã€‚æ¯”å¦‚å¦‚æœæˆ‘æƒ³æ–°æ·»åŠ ä¸ªèŠ‚ç‚¹ D ï¼Œ æˆ‘éœ€è¦ä»èŠ‚ç‚¹ Aï¼Œ Bï¼Œ C ä¸­å¾—éƒ¨åˆ†æ§½åˆ° D ä¸Šã€‚å¦‚æœæˆ‘æƒ³ç§»é™¤èŠ‚ç‚¹ A ï¼Œéœ€è¦å°† A ä¸­çš„æ§½ç§»åˆ° B å’Œ C èŠ‚ç‚¹ä¸Šï¼Œç„¶åå°†æ²¡æœ‰ä»»ä½•æ§½çš„ A èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤å³å¯ã€‚ç”±äºä»ä¸€ä¸ªèŠ‚ç‚¹å°†å“ˆå¸Œæ§½ç§»åŠ¨åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹å¹¶ä¸ä¼šåœæ­¢æœåŠ¡ï¼Œæ‰€ä»¥æ— è®ºæ·»åŠ åˆ é™¤æˆ–è€…æ”¹å˜æŸä¸ªèŠ‚ç‚¹çš„å“ˆå¸Œæ§½çš„æ•°é‡éƒ½ä¸ä¼šé€ æˆé›†ç¾¤ä¸å¯ç”¨çš„çŠ¶æ€ã€‚</p><p>åœ¨ Redis çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œéƒ½æœ‰è¿™ä¹ˆä¸¤ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯æ’æ§½ï¼ˆslotï¼‰ï¼Œå®ƒçš„çš„å–å€¼èŒƒå›´æ˜¯ï¼š0-16383ã€‚è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯ clusterï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªé›†ç¾¤ç®¡ç†çš„æ’ä»¶ã€‚å½“æˆ‘ä»¬çš„å­˜å–çš„ Keyåˆ°è¾¾çš„æ—¶å€™ï¼ŒRedis ä¼šæ ¹æ® CRC16 çš„ç®—æ³•å¾—å‡ºä¸€ä¸ªç»“æœï¼Œç„¶åæŠŠç»“æœå¯¹ 16384 æ±‚ä½™æ•°ï¼Œè¿™æ ·æ¯ä¸ª key éƒ½ä¼šå¯¹åº”ä¸€ä¸ªç¼–å·åœ¨ 0-16383 ä¹‹é—´çš„å“ˆå¸Œæ§½ï¼Œé€šè¿‡è¿™ä¸ªå€¼ï¼Œå»æ‰¾åˆ°å¯¹åº”çš„æ’æ§½æ‰€å¯¹åº”çš„èŠ‚ç‚¹ï¼Œç„¶åç›´æ¥è‡ªåŠ¨è·³è½¬åˆ°è¿™ä¸ªå¯¹åº”çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œå­˜å–æ“ä½œã€‚</p><h4 id="Redis-é›†ç¾¤-ä¸»ä»å¤åˆ¶æ¨¡å‹ï¼š"><a href="#Redis-é›†ç¾¤-ä¸»ä»å¤åˆ¶æ¨¡å‹ï¼š" class="headerlink" title="Redis é›†ç¾¤ + ä¸»ä»å¤åˆ¶æ¨¡å‹ï¼š"></a>Redis é›†ç¾¤ + ä¸»ä»å¤åˆ¶æ¨¡å‹ï¼š</h4><p>â€‹æ³¨æ„ï¼šè¿™é‡Œçš„ä¸»ä»æ¨¡å¼å¹¶ä¸å®Œå…¨æ˜¯ä¹‹å‰è¯´çš„ä¸»ä»æ¨¡å¼ï¼Œè€Œæ˜¯å•çº¯çš„å°†ä»èŠ‚ç‚¹ä½œä¸ºä¸»èŠ‚ç‚¹çš„å¤‡ä»½ï¼Œä¸»èŠ‚ç‚¹å¦‚æœæ²¡æŒ‚æ‰ï¼Œå°±ç”¨ä¸åˆ°ä»èŠ‚ç‚¹ã€‚</p><p>â€‹ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œ<u>redis-clusteré›†ç¾¤å¼•å…¥äº†ä¸»ä»å¤åˆ¶æ¨¡å‹</u>ï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªæˆ–è€…å¤šä¸ªä»èŠ‚ç‚¹ï¼Œå½“ä¸»èŠ‚ç‚¹å®•æœºçš„æ—¶å€™ï¼Œå°±ä¼šå¯ç”¨ä»èŠ‚ç‚¹ã€‚å½“å…¶å®ƒä¸»èŠ‚ç‚¹ ping ä¸€ä¸ªä¸»èŠ‚ç‚¹ A æ—¶ï¼Œå¦‚æœåŠæ•°ä»¥ä¸Šçš„ä¸»èŠ‚ç‚¹ä¸ A é€šä¿¡è¶…æ—¶ï¼Œé‚£ä¹ˆè®¤ä¸ºä¸»èŠ‚ç‚¹ A å®•æœºäº†ã€‚å¦‚æœä¸»èŠ‚ç‚¹ A å’Œå®ƒçš„ä»èŠ‚ç‚¹ A1 éƒ½å®•æœºäº†ï¼Œé‚£ä¹ˆè¯¥é›†ç¾¤å°±æ‰è¢«è®¤ä¸ºæ— æ³•å†æä¾›æœåŠ¡ã€‚</p><h4 id="æ•…éšœæ£€æµ‹ï¼š"><a href="#æ•…éšœæ£€æµ‹ï¼š" class="headerlink" title="æ•…éšœæ£€æµ‹ï¼š"></a>æ•…éšœæ£€æµ‹ï¼š</h4><p>ä¸€ä¸ªèŠ‚ç‚¹è®¤ä¸ºæŸä¸ªèŠ‚ç‚¹å®•æœºä¸èƒ½è¯´æ˜è¿™ä¸ªèŠ‚ç‚¹çœŸçš„æŒ‚èµ·äº†ï¼Œæ— æ³•æä¾›æœåŠ¡äº†ã€‚åªæœ‰å æ®å¤šæ•°çš„å®ä¾‹èŠ‚ç‚¹éƒ½è®¤ä¸ºæŸä¸ªèŠ‚ç‚¹æŒ‚èµ·äº†ï¼Œè¿™æ—¶å€™clusteræ‰è¿›è¡Œä¸‹çº¿å’Œä¸»ä»åˆ‡æ¢çš„å·¥ä½œã€‚<br>Redis é›†ç¾¤çš„èŠ‚ç‚¹é‡‡ç”¨ Gossip åè®®æ¥å¹¿æ’­ä¿¡æ¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå®šæœŸå‘å…¶ä»–èŠ‚ç‚¹å‘é€pingå‘½ä»¤ï¼Œå¦‚æœæ¥å—pingæ¶ˆæ¯çš„èŠ‚ç‚¹åœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰å›å¤pongï¼Œåˆ™ä¼šè®¤ä¸ºè¯¥èŠ‚ç‚¹å¤±è”äº†ï¼ˆPFailï¼‰ï¼Œåˆ™å‘é€pingçš„èŠ‚ç‚¹å°±æŠŠæ¥å—pingçš„èŠ‚ç‚¹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ã€‚<br><u>å¦‚æœé›†ç¾¤åŠæ•°ä»¥ä¸Šçš„ä¸»èŠ‚ç‚¹éƒ½å°†ä¸»èŠ‚ç‚¹ xxx æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼Œåˆ™èŠ‚ç‚¹ xxx å°†è¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼Œç„¶åå‘æ•´ä¸ªé›†ç¾¤å¹¿æ’­ï¼Œè®©å…¶å®ƒèŠ‚ç‚¹ä¹ŸçŸ¥é“è¯¥èŠ‚ç‚¹å·²ç»ä¸‹çº¿ï¼Œå¹¶ç«‹å³å¯¹ä¸‹çº¿çš„èŠ‚ç‚¹è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚</u></p><h4 id="ä¸»ä»æ•…éšœè½¬ç§»ï¼š"><a href="#ä¸»ä»æ•…éšœè½¬ç§»ï¼š" class="headerlink" title="ä¸»ä»æ•…éšœè½¬ç§»ï¼š"></a>ä¸»ä»æ•…éšœè½¬ç§»ï¼š</h4><p>å½“ä¸€ä¸ªä»èŠ‚ç‚¹å‘ç°è‡ªå·±æ­£åœ¨å¤åˆ¶çš„ä¸»èŠ‚ç‚¹è¿›å…¥äº†å·²ä¸‹çº¿ï¼Œåˆ™å¼€å§‹å¯¹ä¸‹çº¿ä¸»èŠ‚ç‚¹è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œæ•…éšœè½¬ç§»çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœåªæœ‰ä¸€ä¸ªslaveèŠ‚ç‚¹ï¼Œåˆ™ä»èŠ‚ç‚¹ä¼šæ‰§è¡ŒSLAVEOF no oneå‘½ä»¤ï¼Œæˆä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚</li><li>å¦‚æœæ˜¯å¤šä¸ªslaveèŠ‚ç‚¹ï¼Œåˆ™é‡‡ç”¨é€‰ä¸¾æ¨¡å¼è¿›è¡Œï¼Œç«é€‰å‡ºæ–°çš„Master<ul><li>é›†ç¾¤ä¸­è®¾ç«‹ä¸€ä¸ªè‡ªå¢è®¡æ•°å™¨ï¼Œåˆå§‹å€¼ä¸º 0 ï¼Œæ¯æ¬¡æ‰§è¡Œæ•…éšœè½¬ç§»é€‰ä¸¾ï¼Œè®¡æ•°å°±ä¼š+1ã€‚</li><li>æ£€æµ‹åˆ°ä¸»èŠ‚ç‚¹ä¸‹çº¿çš„ä»èŠ‚ç‚¹å‘é›†ç¾¤æ‰€æœ‰masterå¹¿æ’­ä¸€æ¡CLUSTERMSG_TYPE_FAILOVER_AUTH_REQUESTæ¶ˆæ¯ï¼Œæ‰€æœ‰æ”¶åˆ°æ¶ˆæ¯ã€å¹¶å…·å¤‡æŠ•ç¥¨æƒçš„ä¸»èŠ‚ç‚¹éƒ½å‘è¿™ä¸ªä»èŠ‚ç‚¹æŠ•ç¥¨ã€‚</li><li>å¦‚æœæ”¶åˆ°æ¶ˆæ¯ã€å¹¶å…·å¤‡æŠ•ç¥¨æƒçš„ä¸»èŠ‚ç‚¹æœªæŠ•ç¥¨ç»™å…¶ä»–ä»èŠ‚ç‚¹ï¼ˆåªèƒ½æŠ•ä¸€ç¥¨å“¦ï¼Œæ‰€ä»¥æŠ•è¿‡äº†ä¸è¡Œï¼‰ï¼Œåˆ™è¿”å›ä¸€æ¡CLUSTERMSG_TYPE_FAILOVER_AUTH_ACKæ¶ˆæ¯ï¼Œè¡¨ç¤ºæ”¯æŒã€‚</li><li>å‚ä¸é€‰ä¸¾çš„ä»èŠ‚ç‚¹éƒ½ä¼šæ¥æ”¶CLUSTERMSG_TYPE_FAILOVER_AUTH_ACKæ¶ˆæ¯ï¼Œå¦‚æœæ”¶é›†åˆ°çš„é€‰ç¥¨ å¤§äºç­‰äº (n&#x2F;2) + 1 æ”¯æŒï¼Œnä»£è¡¨æ‰€æœ‰å…·å¤‡é€‰ä¸¾æƒçš„masterï¼Œé‚£ä¹ˆè¿™ä¸ªä»èŠ‚ç‚¹å°±è¢«é€‰ä¸¾ä¸ºæ–°ä¸»èŠ‚ç‚¹ã€‚</li><li>å¦‚æœè¿™ä¸€è½®ä»èŠ‚ç‚¹éƒ½æ²¡èƒ½äº‰å–åˆ°è¶³å¤Ÿå¤šçš„ç¥¨æ•°ï¼Œåˆ™å‘èµ·å†ä¸€è½®é€‰ä¸¾ï¼ˆè‡ªå¢è®¡æ•°å™¨+1ï¼‰ï¼Œç›´è‡³é€‰å‡ºæ–°çš„masterã€‚</li></ul></li><li>æ–°çš„ä¸»èŠ‚ç‚¹ä¼šæ’¤é”€æ‰€æœ‰å¯¹å·²ä¸‹çº¿ä¸»èŠ‚ç‚¹çš„slotsæŒ‡æ´¾ï¼Œå¹¶å°†è¿™äº›slotså…¨éƒ¨æŒ‡æ´¾ç»™è‡ªå·±ã€‚</li><li>æ–°çš„ä¸»èŠ‚ç‚¹å‘é›†ç¾¤å¹¿æ’­ä¸€æ¡PONGæ¶ˆæ¯ï¼Œè¿™æ¡PONGæ¶ˆæ¯å¯ä»¥è®©é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹ç«‹å³çŸ¥é“è¿™ä¸ªèŠ‚ç‚¹å·²ç»ç”±ä»èŠ‚ç‚¹å˜æˆäº†ä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿™ä¸ªä¸»èŠ‚ç‚¹å·²ç»æ¥ç®¡äº†åŸæœ¬ç”±å·²ä¸‹çº¿èŠ‚ç‚¹è´Ÿè´£å¤„ç†çš„æ§½ã€‚</li><li>æ–°çš„ä¸»èŠ‚ç‚¹å¼€å§‹æ¥æ”¶å’Œè‡ªå·±è´Ÿè´£å¤„ç†çš„æ§½æœ‰å…³çš„å‘½ä»¤è¯·æ±‚ï¼Œæ•…éšœè½¬ç§»å®Œæˆã€‚</li></ul><h4 id="é›†ç¾¤çš„ç‰¹ç‚¹ï¼š"><a href="#é›†ç¾¤çš„ç‰¹ç‚¹ï¼š" class="headerlink" title="é›†ç¾¤çš„ç‰¹ç‚¹ï¼š"></a><strong>é›†ç¾¤çš„ç‰¹ç‚¹</strong>ï¼š</h4><ul><li>æ‰€æœ‰çš„ redis èŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONGæœºåˆ¶)ï¼Œå†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½ã€‚</li><li>èŠ‚ç‚¹çš„ fail æ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆã€‚</li><li>å®¢æˆ·ç«¯ä¸ Redis èŠ‚ç‚¹ç›´è¿ï¼Œä¸éœ€è¦ä¸­é—´ä»£ç†å±‚.å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚</li></ul><h2 id="Redisç¼“å­˜ï¼š"><a href="#Redisç¼“å­˜ï¼š" class="headerlink" title="Redisç¼“å­˜ï¼š"></a>Redisç¼“å­˜ï¼š</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ç›¸å…³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> åŸç†å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaåŸºç¡€å¤ä¹ </title>
      <link href="/2023/08/10/java%E5%9F%BA%E7%A1%80%E5%A4%8D%E4%B9%A0/"/>
      <url>/2023/08/10/java%E5%9F%BA%E7%A1%80%E5%A4%8D%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ ¹æ®ä½œè€…å¯¹javaåŸºç¡€çš„æŒæ¡ç¨‹åº¦è€Œå†™ï¼Œåªè®°å½•äº†æˆ‘è‡ªå·±å®¹æ˜“é—å¿˜çš„ç‚¹ï¼Œå¯èƒ½å¹¶ä¸é€‚åˆjavaæ–°æ‰‹å­¦ä¹ ğŸ˜µâ€ğŸ’«</p><h3 id="1-æ·±æ‹·è´ã€æµ…æ‹·è´ä»¥åŠå¼•ç”¨æ‹·è´ï¼š"><a href="#1-æ·±æ‹·è´ã€æµ…æ‹·è´ä»¥åŠå¼•ç”¨æ‹·è´ï¼š" class="headerlink" title="1.æ·±æ‹·è´ã€æµ…æ‹·è´ä»¥åŠå¼•ç”¨æ‹·è´ï¼š"></a>1.æ·±æ‹·è´ã€æµ…æ‹·è´ä»¥åŠå¼•ç”¨æ‹·è´ï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230810141303963.png" alt="image-20230810141303963"></p><h3 id="2-Objectç±»ä¸­çš„å¸¸è§æ–¹æ³•ï¼š"><a href="#2-Objectç±»ä¸­çš„å¸¸è§æ–¹æ³•ï¼š" class="headerlink" title="2.Objectç±»ä¸­çš„å¸¸è§æ–¹æ³•ï¼š"></a>2.Objectç±»ä¸­çš„å¸¸è§æ–¹æ³•ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native æ–¹æ³•ï¼Œç”¨äºè¿”å›å½“å‰è¿è¡Œæ—¶å¯¹è±¡çš„ Class å¯¹è±¡ï¼Œä½¿ç”¨äº† final å…³é”®å­—ä¿®é¥°ï¼Œæ•…ä¸å…è®¸å­ç±»é‡å†™ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> Class&lt;?&gt; getClass()</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native æ–¹æ³•ï¼Œç”¨äºè¿”å›å¯¹è±¡çš„å“ˆå¸Œç ï¼Œä¸»è¦ä½¿ç”¨åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œæ¯”å¦‚ JDK ä¸­çš„HashMapã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨äºæ¯”è¾ƒ 2 ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ï¼ŒString ç±»å¯¹è¯¥æ–¹æ³•è¿›è¡Œäº†é‡å†™ä»¥ç”¨äºæ¯”è¾ƒå­—ç¬¦ä¸²çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * naitive æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå¹¶è¿”å›å½“å‰å¯¹è±¡çš„ä¸€ä»½æ‹·è´ã€‚ âš ï¸æµ…æ‹·è´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">native</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›ç±»çš„åå­—å®ä¾‹çš„å“ˆå¸Œç çš„ 16 è¿›åˆ¶çš„å­—ç¬¦ä¸²ã€‚å»ºè®® Object æ‰€æœ‰çš„å­ç±»éƒ½é‡å†™è¿™ä¸ªæ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚å”¤é†’ä¸€ä¸ªåœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„çº¿ç¨‹(ç›‘è§†å™¨ç›¸å½“äºå°±æ˜¯é”çš„æ¦‚å¿µ)ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åªä¼šä»»æ„å”¤é†’ä¸€ä¸ªã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">()</span></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚è·Ÿ notify ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ä¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">notifyAll</span><span class="params">()</span></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * nativeæ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚æš‚åœçº¿ç¨‹çš„æ‰§è¡Œã€‚æ³¨æ„ï¼šsleep æ–¹æ³•æ²¡æœ‰é‡Šæ”¾é”ï¼Œè€Œ wait æ–¹æ³•é‡Šæ”¾äº†é” ï¼Œtimeout æ˜¯ç­‰å¾…æ—¶é—´ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">(<span class="type">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤šäº† nanos å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°è¡¨ç¤ºé¢å¤–æ—¶é—´ï¼ˆä»¥æ¯«å¾®ç§’ä¸ºå•ä½ï¼ŒèŒƒå›´æ˜¯ 0-999999ï¼‰ã€‚ æ‰€ä»¥è¶…æ—¶çš„æ—¶é—´è¿˜éœ€è¦åŠ ä¸Š nanos æ¯«ç§’ã€‚ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">(<span class="type">long</span> timeout, <span class="type">int</span> nanos)</span> <span class="keyword">throws</span> InterruptedException</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·Ÿä¹‹å‰çš„2ä¸ªwaitæ–¹æ³•ä¸€æ ·ï¼Œåªä¸è¿‡è¯¥æ–¹æ³•ä¸€ç›´ç­‰å¾…ï¼Œæ²¡æœ‰è¶…æ—¶æ—¶é—´è¿™ä¸ªæ¦‚å¿µ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®ä¾‹è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„æ—¶å€™è§¦å‘çš„æ“ä½œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123; &#125;</span><br></pre></td></tr></table></figure><h3 id="3-hashCode-å’Œ-equals"><a href="#3-hashCode-å’Œ-equals" class="headerlink" title="3.hashCode() å’Œ equals()"></a>3.hashCode() å’Œ equals()</h3><p><a href="https://www.cnblogs.com/skywang12345/p/3324958.html">Java hashCode() å’Œ equals()çš„è‹¥å¹²é—®é¢˜è§£ç­”</a></p><h3 id="4-å­—ç¬¦ä¸²ç›¸å…³"><a href="#4-å­—ç¬¦ä¸²ç›¸å…³" class="headerlink" title="4.å­—ç¬¦ä¸²ç›¸å…³"></a>4.å­—ç¬¦ä¸²ç›¸å…³</h3><p>â€‹</p><h4 id="String-ä¸å¯å˜"><a href="#String-ä¸å¯å˜" class="headerlink" title="String:ä¸å¯å˜"></a>String:ä¸å¯å˜</h4><p>â€‹åŸå› æ˜¯Stringåº•å±‚ä½¿ç”¨privateã€finalä¿®é¥°ä¸€ä¸ªchar[]ï¼Œè€Œä¸”å¹¶ä¸æŠŠä¿®æ”¹è¯¥char[]çš„æ–¹æ³•æš´éœ²ï¼Œå› æ­¤ä¸å¯å˜</p><p>â€‹java9ä¹‹åï¼ŒStringä½¿ç”¨ byte[] å­˜å‚¨å†…å®¹ â€”â€”åŸå› æ˜¯ï¼š</p><ul><li>byteçš„å­˜å‚¨ç©ºé—´ä¸º1Bï¼›charä¸º2B<ul><li>å¤§å¤šæ•°æƒ…å†µä¸‹ 1Bçš„ç©ºé—´èƒ½è¡¨ç¤ºæˆ‘ä»¬ä½¿ç”¨çš„å­—ç¬¦â€”-ä½¿ç”¨Latin-1ç¼–ç æ–¹å¼</li><li>å½“æˆ‘ä»¬ä½¿ç”¨åˆ°ä¸€äº›ç‰¹æ®Šå­—ç¬¦æ—¶ï¼Œæ‰ä¼šç”¨2ä¸ªbyteå­˜å‚¨ä¸€ä¸ªå­—ç¬¦(æ­¤æ—¶å­˜å‚¨æ•ˆç‡ä¸ä½¿ç”¨charä¸€æ ·)</li></ul></li></ul><p>â€‹</p><h4 id="å­—ç¬¦ä¸²æ‹¼æ¥ï¼š"><a href="#å­—ç¬¦ä¸²æ‹¼æ¥ï¼š" class="headerlink" title="å­—ç¬¦ä¸²æ‹¼æ¥ï¼š"></a>å­—ç¬¦ä¸²æ‹¼æ¥ï¼š</h4><p>Java è¯­è¨€æœ¬èº«å¹¶ä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½ï¼Œâ€œ+â€å’Œâ€œ+&#x3D;â€æ˜¯ä¸“é—¨ä¸º String ç±»é‡è½½è¿‡çš„è¿ç®—ç¬¦ï¼Œä¹Ÿæ˜¯ Java ä¸­ä»…æœ‰çš„ä¸¤ä¸ªé‡è½½è¿‡çš„è¿ç®—ç¬¦ã€‚</p><p>â€‹ğŸŒŸString å¯¹è±¡é€šè¿‡â€œ+â€çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ <code>StringBuilder</code> è°ƒç”¨ <code>append()</code> æ–¹æ³•å®ç°çš„ï¼Œæ‹¼æ¥å®Œæˆä¹‹åè°ƒç”¨ <code>toString()</code> å¾—åˆ°ä¸€ä¸ª <code>String</code> å¯¹è±¡ ã€‚</p><p>â€‹ğŸŒŸä¸è¿‡ï¼Œåœ¨å¾ªç¯å†…ä½¿ç”¨â€œ+â€è¿›è¡Œå­—ç¬¦ä¸²çš„æ‹¼æ¥çš„è¯ï¼Œå­˜åœ¨æ¯”è¾ƒæ˜æ˜¾çš„ç¼ºé™·ï¼š<strong>ç¼–è¯‘å™¨ä¸ä¼šåˆ›å»ºå•ä¸ª</strong> <strong><code>StringBuilder</code></strong> <strong>ä»¥å¤ç”¨ï¼Œä¼šå¯¼è‡´åˆ›å»ºè¿‡å¤šçš„</strong> <strong><code>StringBuilder</code></strong> <strong>å¯¹è±¡</strong>ã€‚</p><h4 id="å­—ç¬¦ä¸²å¸¸é‡æ± çš„ä½œç”¨äº†è§£å—ï¼Ÿ"><a href="#å­—ç¬¦ä¸²å¸¸é‡æ± çš„ä½œç”¨äº†è§£å—ï¼Ÿ" class="headerlink" title="å­—ç¬¦ä¸²å¸¸é‡æ± çš„ä½œç”¨äº†è§£å—ï¼Ÿ"></a>å­—ç¬¦ä¸²å¸¸é‡æ± çš„ä½œç”¨äº†è§£å—ï¼Ÿ</h4><p>JDK1.7åï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± åœ¨å †ä¸­</p><p>â€‹<strong>å­—ç¬¦ä¸²å¸¸é‡æ± </strong> æ˜¯ JVM ä¸ºäº†æå‡æ€§èƒ½å’Œå‡å°‘å†…å­˜æ¶ˆè€—é’ˆå¯¹å­—ç¬¦ä¸²ï¼ˆString ç±»ï¼‰ä¸“é—¨å¼€è¾Ÿçš„ä¸€å—åŒºåŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†<u>é¿å…å­—ç¬¦ä¸²çš„é‡å¤åˆ›å»ºã€‚</u></p><p>ğŸ“<strong>å­—ç¬¦ä¸²å¸¸é‡æ± ä¿å­˜çš„æ˜¯</strong>ï¼š<u>å­—ç¬¦ä¸²ï¼ˆkeyï¼‰</u>å’Œ <u>å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼ˆvalueï¼‰</u>çš„æ˜ å°„å…³ç³»(ç»´æŠ¤äº†ä¸€ä¸ªHashMap)ï¼Œå­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨æŒ‡å‘å †ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚</p><p>å› æ­¤å¦‚æœåœ¨å¸¸é‡æ± ä¸­æ‰¾ä¸åˆ°æŸå­—ç¬¦ä¸²ï¼Œä¼š<u>åœ¨å †ä¸­åˆ›å»ºä»¥è¯¥å­—ç¬¦ä¸²ç”Ÿæˆçš„Stringå¯¹è±¡ï¼Œå†å°†å…¶åœ°å€å­˜å‚¨åˆ°å¸¸é‡æ± HashMapçš„Valueä¸­</u>ï¼</p><p>è‡³æ­¤ï¼Œå¸¸é‡æ± ä¸­å¢åŠ äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ã€‚</p><p>å› æ­¤é¢å¯¹é—®é¢˜ï¼šString s1 &#x3D; new String(â€œabcâ€);åˆ›å»ºäº†å‡ ä¸ªStringå¯¹è±¡ï¼Ÿ</p><p>â€”1.ä¸ºs1åˆ›å»ºä¸€ä¸ªç©ºçš„Stringå¯¹è±¡ï¼Œ</p><ul><li>å¦‚æœå¸¸é‡æ± ä¸­æ²¡æœ‰â€œabcâ€ï¼Œé‚£ä¹ˆé¦–å…ˆè¿˜éœ€è¦åœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå­˜å‚¨äº†â€œabcâ€çš„Stringå¯¹è±¡ï¼Œå°†è¯¥å¯¹è±¡çš„å¼•ç”¨å­˜å…¥å¸¸é‡æ± ï¼Œå†ä¸º ä¸ºs1åˆ›å»ºçš„å¯¹è±¡ èµ‹å€¼ï¼Œå› æ­¤åˆ›å»ºäº†2ä¸ªStringå¯¹è±¡</li><li>å¦‚æœå¸¸é‡æ± ä¸­æœ‰â€œabcâ€ï¼Œé‚£ä¹ˆç›´æ¥ä¸º ä¸ºs1åˆ›å»ºçš„å¯¹è±¡ èµ‹å€¼å³å¯ï¼Œåªåˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ã€‚</li></ul><h4 id="intern-æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨"><a href="#intern-æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨" class="headerlink" title="intern æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨?"></a>intern æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨?</h4><p>â€‹<code>String.intern()</code> æ˜¯ä¸€ä¸ª nativeï¼ˆæœ¬åœ°ï¼‰æ–¹æ³•ï¼Œå…¶ä½œç”¨æ˜¯**<u>å°†æŒ‡å®šçš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­</u>**ï¼Œå¯ä»¥ç®€å•åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¿å­˜äº†å¯¹åº”çš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œå°±ç›´æ¥è¿”å›è¯¥å¼•ç”¨ã€‚</li><li>å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰ä¿å­˜äº†å¯¹åº”çš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£å°±åœ¨å¸¸é‡æ± ä¸­åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨å¹¶è¿”å›ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨å †ä¸­åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œ</span></span><br><span class="line"><span class="comment">// å°†å­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œçš„å¼•ç”¨ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;Java&quot;</span>;</span><br><span class="line"><span class="comment">// ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œå¯¹åº”çš„å¼•ç”¨</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> s1.intern();</span><br><span class="line"><span class="comment">// ä¼šåœ¨å †ä¸­åœ¨å•ç‹¬åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Java&quot;</span>);</span><br><span class="line"><span class="comment">// ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œå¯¹åº”çš„å¼•ç”¨</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> s3.intern();</span><br><span class="line"><span class="comment">// s1 å’Œ s2 æŒ‡å‘çš„æ˜¯å †ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">System.out.println(s1 == s2); </span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="comment">// s3 å’Œ s4 æŒ‡å‘çš„æ˜¯å †ä¸­ä¸åŒçš„å¯¹è±¡</span></span><br><span class="line">System.out.println(s3 == s4); </span><br><span class="line"><span class="comment">// false</span></span><br><span class="line"><span class="comment">// s1 å’Œ s4 æŒ‡å‘çš„æ˜¯å †ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">System.out.println(s1 == s4); </span><br><span class="line"><span class="comment">//true</span></span><br></pre></td></tr></table></figure><h3 id="5-åŒ…è£…ç±»å‹çš„ç¼“å­˜æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ"><a href="#5-åŒ…è£…ç±»å‹çš„ç¼“å­˜æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ" class="headerlink" title="5.åŒ…è£…ç±»å‹çš„ç¼“å­˜æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ"></a>5.åŒ…è£…ç±»å‹çš„ç¼“å­˜æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ</h3><p>Java åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»å‹çš„å¤§éƒ¨åˆ†éƒ½ç”¨åˆ°äº†ç¼“å­˜æœºåˆ¶æ¥æå‡æ€§èƒ½ã€‚</p><p><code>Byte</code>,<code>Short</code>,<code>Integer</code>,<code>Long</code> è¿™ 4 ç§åŒ…è£…ç±»é»˜è®¤åˆ›å»ºäº†æ•°å€¼ <strong>[-128ï¼Œ127]</strong> çš„ç›¸åº”ç±»å‹çš„ç¼“å­˜æ•°æ®ï¼Œ<code>Character</code> åˆ›å»ºäº†æ•°å€¼åœ¨ <strong>[0,127]</strong> èŒƒå›´çš„ç¼“å­˜æ•°æ®ï¼Œ<code>Boolean</code> ç›´æ¥è¿”å› <code>True</code> or <code>False</code>ã€‚</p><h4 id="âš ï¸åŒ…è£…ç±»ç­‰å€¼æ¯”è¾ƒçš„æ³¨æ„ç‚¹ï¼š"><a href="#âš ï¸åŒ…è£…ç±»ç­‰å€¼æ¯”è¾ƒçš„æ³¨æ„ç‚¹ï¼š" class="headerlink" title="âš ï¸åŒ…è£…ç±»ç­‰å€¼æ¯”è¾ƒçš„æ³¨æ„ç‚¹ï¼š"></a>âš ï¸åŒ…è£…ç±»ç­‰å€¼æ¯”è¾ƒçš„æ³¨æ„ç‚¹ï¼š<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230811093744235.png" alt="image-20230811093744235"></h4><h3 id="6-ä¸ºä»€ä¹ˆæµ®ç‚¹æ•°è¿ç®—çš„æ—¶å€™ä¼šæœ‰ç²¾åº¦ä¸¢å¤±çš„é£é™©ï¼Ÿ"><a href="#6-ä¸ºä»€ä¹ˆæµ®ç‚¹æ•°è¿ç®—çš„æ—¶å€™ä¼šæœ‰ç²¾åº¦ä¸¢å¤±çš„é£é™©ï¼Ÿ" class="headerlink" title="6.ä¸ºä»€ä¹ˆæµ®ç‚¹æ•°è¿ç®—çš„æ—¶å€™ä¼šæœ‰ç²¾åº¦ä¸¢å¤±çš„é£é™©ï¼Ÿ"></a>6.ä¸ºä»€ä¹ˆæµ®ç‚¹æ•°è¿ç®—çš„æ—¶å€™ä¼šæœ‰ç²¾åº¦ä¸¢å¤±çš„é£é™©ï¼Ÿ</h3><p>æµ®ç‚¹æ•°è¿ç®—ç²¾åº¦ä¸¢å¤±ä»£ç æ¼”ç¤ºï¼š</p><p>float a &#x3D; 2.0f - 1.9f; float b &#x3D; 1.8f - 1.7f;</p><p>System.out.println(a);&#x2F;&#x2F; 0.100000024 </p><p>System.out.println(b);&#x2F;&#x2F; 0.099999905 </p><p>System.out.println(a &#x3D;&#x3D; b);&#x2F;&#x2F; false</p><p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><p>è¿™ä¸ªå’Œè®¡ç®—æœºä¿å­˜æµ®ç‚¹æ•°çš„æœºåˆ¶æœ‰å¾ˆå¤§å…³ç³»ã€‚æˆ‘ä»¬çŸ¥é“è®¡ç®—æœºæ˜¯äºŒè¿›åˆ¶çš„ï¼Œè€Œä¸”è®¡ç®—æœºåœ¨è¡¨ç¤ºä¸€ä¸ªæ•°å­—æ—¶ï¼Œå®½åº¦æ˜¯æœ‰é™çš„ï¼Œæ— é™å¾ªç¯çš„å°æ•°å­˜å‚¨åœ¨è®¡ç®—æœºæ—¶ï¼Œåªèƒ½è¢«æˆªæ–­ï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´å°æ•°ç²¾åº¦å‘ç”ŸæŸå¤±çš„æƒ…å†µã€‚è¿™ä¹Ÿå°±æ˜¯è§£é‡Šäº†ä¸ºä»€ä¹ˆæµ®ç‚¹æ•°æ²¡æœ‰åŠæ³•ç”¨äºŒè¿›åˆ¶ç²¾ç¡®è¡¨ç¤ºã€‚</p><h3 id="7-å¦‚ä½•è§£å†³æµ®ç‚¹æ•°è¿ç®—çš„ç²¾åº¦ä¸¢å¤±é—®é¢˜ï¼Ÿ"><a href="#7-å¦‚ä½•è§£å†³æµ®ç‚¹æ•°è¿ç®—çš„ç²¾åº¦ä¸¢å¤±é—®é¢˜ï¼Ÿ" class="headerlink" title="7.å¦‚ä½•è§£å†³æµ®ç‚¹æ•°è¿ç®—çš„ç²¾åº¦ä¸¢å¤±é—®é¢˜ï¼Ÿ"></a>7.å¦‚ä½•è§£å†³æµ®ç‚¹æ•°è¿ç®—çš„ç²¾åº¦ä¸¢å¤±é—®é¢˜ï¼Ÿ</h3><p><code>BigDecimal</code> å¯ä»¥å®ç°å¯¹æµ®ç‚¹æ•°çš„è¿ç®—ï¼Œä¸ä¼šé€ æˆç²¾åº¦ä¸¢å¤±ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¤§éƒ¨åˆ†éœ€è¦æµ®ç‚¹æ•°ç²¾ç¡®è¿ç®—ç»“æœçš„ä¸šåŠ¡åœºæ™¯ï¼ˆæ¯”å¦‚æ¶‰åŠåˆ°é’±çš„åœºæ™¯ï¼‰éƒ½æ˜¯é€šè¿‡ <code>BigDecimal</code> æ¥åšçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BigDecimal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;1.0&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0.9&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0.8&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">x</span> <span class="operator">=</span> a.subtract(b); </span><br><span class="line"></span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">y</span> <span class="operator">=</span> b.subtract(c); </span><br><span class="line"></span><br><span class="line">System.out.println(x);   <span class="comment">//0.1</span></span><br><span class="line"></span><br><span class="line">System.out.println(y);   <span class="comment">//0.1</span></span><br><span class="line"></span><br><span class="line">System.out.println(Objects.equals(x, y));  <span class="comment">//true </span></span><br></pre></td></tr></table></figure><h3 id="8-å¦‚ä½•å®ç°æ•°ç»„å’Œ-List-ä¹‹é—´çš„è½¬æ¢ï¼Ÿ"><a href="#8-å¦‚ä½•å®ç°æ•°ç»„å’Œ-List-ä¹‹é—´çš„è½¬æ¢ï¼Ÿ" class="headerlink" title="8.å¦‚ä½•å®ç°æ•°ç»„å’Œ List ä¹‹é—´çš„è½¬æ¢ï¼Ÿ"></a>8.å¦‚ä½•å®ç°æ•°ç»„å’Œ List ä¹‹é—´çš„è½¬æ¢ï¼Ÿ</h3><ul><li>æ•°ç»„è½¬ Listï¼šä½¿ç”¨ Arrays. asList(array) è¿›è¡Œè½¬æ¢ã€‚</li><li>List è½¬æ•°ç»„ï¼šä½¿ç”¨ List è‡ªå¸¦çš„ toArray() æ–¹æ³•ã€‚</li></ul><h3 id="9-CASåŸç†"><a href="#9-CASåŸç†" class="headerlink" title="9.CASåŸç†"></a>9.CASåŸç†</h3><p>å†…å­˜ä¸­ï¼š</p><ul><li>å¾…ä¿®æ”¹çš„å€¼</li></ul><p>çº¿ç¨‹æŒæœ‰ï¼š</p><ul><li>é¢„æœŸå€¼</li><li>æ–°å€¼</li></ul><p>å·¥ä½œæ–¹å¼ï¼šçº¿ç¨‹æƒ³è¦ä¿®æ”¹å†…å­˜ä¸­çš„ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å…ˆ**<u>ä»å†…å­˜ä¸­è¯»å–è¯¥å€¼ï¼Œä½œä¸ºé¢„æœŸå€¼</u><strong>ï¼Œåœ¨è¿›è¡Œä¸šåŠ¡æµç¨‹å</strong><u>ç”Ÿæˆæ–°å€¼</u>**ï¼Œåœ¨ä¿®æ”¹å†…å­˜ä¸­å€¼ä¹‹å‰è¿›è¡Œåˆ¤æ–­ï¼š</p><p><em>1.å¦‚æœé¢„æœŸå€¼ &#x3D;&#x3D; å¾…ä¿®æ”¹çš„å€¼</em>ï¼Œè¯´æ˜åœ¨æ­¤æœŸé—´è¯¥â€˜å€¼â€™æœªå‘ç”Ÿæ”¹å˜ï¼Œçº¿ç¨‹ä¾¿å¯ä»¥å°†å†…å­˜ä¸­çš„æ—§å€¼æ›¿æ¢ä¸ºæ–°å€¼ã€‚</p><p><em>2.å¦‚æœé¢„æœŸå€¼ !&#x3D; å¾…ä¿®æ”¹çš„å€¼</em>ï¼Œè¯´æ˜åœ¨æ­¤æœŸé—´å€¼å‘ç”Ÿäº†æ”¹å˜ï¼Œçº¿ç¨‹ä¸èƒ½è¿›è¡Œä¿®æ”¹ï¼Œå¸¸è§çš„åº”å¯¹æªæ–½æ˜¯ï¼š<u>é‡æ–°è·å–é¢„æœŸå€¼å’Œè®¡ç®—æ–°å€¼ï¼Œå†æ¬¡è¿›è¡Œåˆ¤æ–­ã€‚ã€‚</u></p><p>â€‹âš ï¸åœ¨*1.*ä¸­ï¼Œåœ¨æ­¤æœŸé—´è¯¥â€˜å€¼â€™æœªå‘ç”Ÿæ”¹å˜çš„æƒ…å†µä¸‹ å¯èƒ½å‘ç”ŸABAé—®é¢˜ï¼Œè¿™ç§æƒ…å†µä¸‹æœ¬åº”é‡è¯•ï¼Œä¸å…è®¸ä¿®æ”¹ï¼Œä½†æ˜¯CASå´æ£€æµ‹ä¸å‡ºæ¥</p><p>è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ ä¸€ä¸ªåºå·(æˆ– æ—¶é—´æˆ³)</p><h1 id="é›†åˆç±»"><a href="#é›†åˆç±»" class="headerlink" title="é›†åˆç±»"></a>é›†åˆç±»</h1><h3 id="ArrayListæºç å­¦ä¹ "><a href="#ArrayListæºç å­¦ä¹ " class="headerlink" title="ArrayListæºç å­¦ä¹ "></a>ArrayListæºç å­¦ä¹ </h3><p><a href="https://juejin.cn/post/7056709563860385822?searchId=20230913151916438B638FBB6D1628A413">å‚è€ƒæ–‡ç« </a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åºåˆ—åŒ– ID</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">8683452581122892189L</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤åˆå§‹å®¹é‡å¤§å°</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_CAPACITY</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç©ºæ•°ç»„ï¼Œç”¨äºç©ºå®ä¾‹</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºé»˜è®¤å¤§å°ç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ã€‚</span></span><br><span class="line"><span class="comment">// æˆ‘ä»¬æŠŠå®ƒä» EMPTY_ELEMENTDATA æ•°ç»„ä¸­åŒºåˆ†å‡ºæ¥ï¼Œä»¥çŸ¥é“åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶å®¹é‡éœ€è¦å¢åŠ å¤šå°‘</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿å­˜æ•°æ®çš„æ•°ç»„ï¼Œæ‰€ä»¥è¯´ ArrayList çš„åº•å±‚æ˜¯æ•°ç»„ï¼Œåªä¸è¿‡èƒ½åŠ¨æ€å¢é•¿è€Œå·²</span></span><br><span class="line"><span class="keyword">transient</span> Object[] elementData;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> size;</span><br></pre></td></tr></table></figure><h4 id="ArrayList-ä¸­çš„elementDataå¯¹è±¡è¢«transientä¿®é¥°ï¼ŒåŸå› æ˜¯ï¼š"><a href="#ArrayList-ä¸­çš„elementDataå¯¹è±¡è¢«transientä¿®é¥°ï¼ŒåŸå› æ˜¯ï¼š" class="headerlink" title="ArrayList ä¸­çš„elementDataå¯¹è±¡è¢«transientä¿®é¥°ï¼ŒåŸå› æ˜¯ï¼š"></a>ArrayList ä¸­çš„elementDataå¯¹è±¡è¢«transientä¿®é¥°ï¼ŒåŸå› æ˜¯ï¼š</h4><ul><li>transientä¿®é¥°çš„å˜é‡ä¸ä¼šè¢«åºåˆ—åŒ–ï¼Œä½†æ˜¯ArrayListåº•å±‚åœ¨åºåˆ—åŒ–æ—¶ï¼Œä¼šè°ƒç”¨è‡ªå·±é‡æ–°å®ç°çš„ <code>writeObject()</code> å’Œ <code>readObject()</code> è¿™ä¸¤ä¸ªæ–¹æ³•æ¥åºåˆ—åŒ–æ•°ç»„å…ƒç´ ï¼Œ<u>ç›®çš„æ˜¯é˜²æ­¢ArrayListä¸­å¼€è¾Ÿäº†ç©ºé—´ä½†æ˜¯æ²¡æœ‰è¢«ä½¿ç”¨çš„ç©ºé—´ä¹Ÿè¢«åºåˆ—åŒ–</u></li><li>ArrayListåº•å±‚é‡æ–°å®ç°çš„ <code>writeObject()</code> å’Œ <code>readObject()</code> ä¸­ï¼Œåºåˆ—åŒ–elementDataæ—¶æ˜¯è¯»å–äº†sizeç„¶åä¸€ä¸ªä¸€ä¸ªè¿›è¡Œåºåˆ—åŒ–ä¼ è¾“çš„ã€‚å³ï¼š**<u>ArrayList é‡å†™äº† JDK åºåˆ—åŒ–çš„é€»è¾‘ï¼ŒåªæŠŠ elementData æ•°ç»„ä¸­æœ‰æ•ˆå…ƒç´ çš„éƒ¨åˆ†åºåˆ—åŒ–ï¼Œè€Œä¸ä¼šåºåˆ—åŒ–æ•´ä¸ªæ•°ç»„ã€‚</u>**</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ·»åŠ å…ƒç´ æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * åœ¨æ·»åŠ å…ƒç´ å‰ä¼šå…ˆè°ƒç”¨ ensureCapacityInternal() æ–¹æ³•åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class="line"><span class="comment"> * ç„¶åå†å°†å…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„å°¾éƒ¨</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹æ–¹æ³•ï¼Œæ³¨æ„è¿™é‡Œä¼ çš„å‚æ•°æ˜¯ å…ƒç´ ä¸ªæ•° + 1</span></span><br><span class="line">    <span class="comment">// 1 ä»£è¡¨çš„æ˜¯æ–°æ·»åŠ çš„å…ƒç´ </span></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    <span class="comment">// è¿½åŠ çš„æ•°ç»„çš„å°¾éƒ¨</span></span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…ˆè°ƒç”¨ calculateCapacity åˆ¤æ–­æ˜¯å¦æ˜¯ç©ºæ•°ç»„ï¼</span></span><br><span class="line"><span class="comment"> * å†è°ƒç”¨ ensureExplicitCapacity() æ–¹æ³•è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureCapacityInternal</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­æ˜¯å¦æ˜¯ç©ºæ•°ç»„ï¼Œå¦‚æœæ˜¯ç©ºæ•°ç»„ï¼Œåˆ™æ¯”è¾ƒé»˜è®¤å®¹é‡ 10 å’Œ å…ƒç´ ä¸ªæ•° + 1 çš„å¤§å°</span></span><br><span class="line"><span class="comment"> * äºŒè€…å–æœ€å¤§å€¼ï¼Œç„¶åè¿”å›</span></span><br><span class="line"><span class="comment"> * å¾—åˆ°æœ€å°æ‰©å®¹é‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">calculateCapacity</span><span class="params">(Object[] elementData, <span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> minCapacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ArrayListæ‰©å®¹æœºåˆ¶ï¼š"><a href="#ArrayListæ‰©å®¹æœºåˆ¶ï¼š" class="headerlink" title="ArrayListæ‰©å®¹æœºåˆ¶ï¼š"></a>ArrayListæ‰©å®¹æœºåˆ¶ï¼š</h4><p>ArrayListé€šè¿‡ç©ºæ„é€ æ–¹æ³•æ—¶å¹¶ä¸ä¼šåˆ›å»ºé»˜è®¤å¤§å°çš„elementDataï¼Œè€Œæ˜¯è®©elementData &#x3D; DEFAULTCAPACITY_EMPTY_ELEMENTDATAè¿™ä¸ªç©ºæ•°ç»„ï¼Œ<strong>åœ¨æ·»åŠ å…ƒç´ æ—¶ï¼ŒArrayListä¼šå…ˆçœ‹çœ‹elementDataæ˜¯å¦ä¸ºç©ºæ•°ç»„ï¼Œæ˜¯çš„è¯å°±ç»™ä»–èµ‹å€¼ä¸ºé»˜è®¤å¤§å°çš„æ•°ç»„ï¼Œå†ä½¿ç”¨ensureCapacityInternal(size + 1) æ¥åˆ¤æ–­ç°åœ¨elementDataçš„å¤§å°æ˜¯å¦èƒ½æ”¾å…¥size + 1ä¸ªå…ƒç´ ï¼Œå¦‚æœä¸è¡Œåˆ™æ‰©å®¹ã€‚</strong></p><h4 id="ğŸŒŸArrayListæºç ä¸­æœ‰ä¸ªå‚æ•°å«åš-modCountï¼Œå®ƒæœ‰ä»€ä¹ˆç”¨ï¼Ÿ"><a href="#ğŸŒŸArrayListæºç ä¸­æœ‰ä¸ªå‚æ•°å«åš-modCountï¼Œå®ƒæœ‰ä»€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="ğŸŒŸArrayListæºç ä¸­æœ‰ä¸ªå‚æ•°å«åš modCountï¼Œå®ƒæœ‰ä»€ä¹ˆç”¨ï¼Ÿ"></a>ğŸŒŸArrayListæºç ä¸­æœ‰ä¸ªå‚æ•°å«åš modCountï¼Œå®ƒæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h4><p>â€‹å®ƒå¾ˆåƒä¹è§‚é”çš„ç‰ˆæœ¬æ£€æµ‹çš„è¿‡ç¨‹</p><ul><li><p>modcountï¼ˆmodification countï¼‰æ˜¯ä¸€ç§ç”¨äºè®°å½•æ•°æ®ç»“æ„å˜åŒ–çŠ¶æ€çš„è®¡æ•°å™¨ï¼Œé€šå¸¸ç”¨äºåœ¨è¿­ä»£å™¨ä¸­å®ç°å¿«é€Ÿå¤±è´¥ï¼ˆfail-fastï¼‰æœºåˆ¶ã€‚</p></li><li><p>åœ¨ä¸€äº›æ•°æ®ç»“æ„ï¼ˆå¦‚ArrayListã€HashMapç­‰ï¼‰ä¸­ï¼Œå½“æ•°æ®ç»“æ„å‘ç”Ÿå˜åŒ–ï¼ˆå¦‚å¢åˆ å…ƒç´ ï¼‰æ—¶ï¼Œä¼šå¢åŠ modcountçš„å€¼ã€‚<strong>å½“è¿­ä»£å™¨å¼€å§‹éå†æ•°æ®ç»“æ„æ—¶ï¼Œä¼šå°†å½“å‰çš„modcountå€¼ä¿å­˜ä¸‹æ¥ã€‚åœ¨æ¯æ¬¡è¿­ä»£å™¨æ‰§è¡Œæ“ä½œæ—¶ï¼Œä¼šæ£€æŸ¥å½“å‰çš„modcountå€¼æ˜¯å¦ä¸ä¿å­˜çš„å€¼ç›¸ç­‰ã€‚</strong>å¦‚æœä¸ç›¸ç­‰ï¼Œå°±è¡¨ç¤ºæ•°æ®ç»“æ„å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿­ä»£å™¨ä¼šç«‹å³æŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼Œå®ç°äº†å¿«é€Ÿå¤±è´¥ã€‚</p></li><li><p>modcountçš„ä½œç”¨æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œä¿è¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´ä¸ä¼šäº§ç”Ÿéšæ‚£çš„è®¿é—®ç«æ€æ¡ä»¶ã€‚é€šè¿‡æ£€æŸ¥modcountå€¼ï¼Œå¯ä»¥æ£€æµ‹åˆ°å…¶ä»–çº¿ç¨‹å¯¹æ•°æ®ç»“æ„çš„ä¿®æ”¹ï¼Œä»è€ŒåŠæ—¶å‘ç°å¹¶é˜²æ­¢éå†è¿‡ç¨‹ä¸­çš„å¼‚å¸¸æƒ…å†µå‘ç”Ÿã€‚</p></li><li><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œmodcountå¹¶ä¸æä¾›çº¿ç¨‹å®‰å…¨æ€§ã€‚åœ¨å¹¶å‘ç¯å¢ƒä¸­æ“ä½œmodcountå’Œæ•°æ®ç»“æ„ä»ç„¶éœ€è¦ä½¿ç”¨é€‚å½“çš„åŒæ­¥æœºåˆ¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚modcountçš„ä¸»è¦ä½œç”¨æ˜¯å®ç°å¿«é€Ÿå¤±è´¥æœºåˆ¶ï¼ŒåŠæ—¶æ£€æµ‹å¹¶å‘ä¿®æ”¹ï¼Œè€Œä¸æ˜¯ä½œä¸ºçº¿ç¨‹åŒæ­¥çš„æ–¹æ³•ã€‚</p></li></ul><h3 id="ConcurrentHashMapï¼š"><a href="#ConcurrentHashMapï¼š" class="headerlink" title="ConcurrentHashMapï¼š"></a>ConcurrentHashMapï¼š</h3><h4 id="JDK1-7"><a href="#JDK1-7" class="headerlink" title="JDK1.7:"></a>JDK1.7:</h4><h5 id="1-Segment-æ®µï¼š"><a href="#1-Segment-æ®µï¼š" class="headerlink" title="1.Segment æ®µï¼š"></a>1.Segment æ®µï¼š</h5><p>â€‹ConcurrentHashMap å’Œ HashMap æ€è·¯æ˜¯å·®ä¸å¤šçš„ï¼Œä½†æ˜¯å› ä¸ºå®ƒæ”¯æŒå¹¶å‘æ“ä½œï¼Œæ‰€ä»¥è¦å¤æ‚ä¸€äº›ã€‚</p><p>â€‹æ•´ä¸ª ConcurrentHashMap ç”±ä¸€ä¸ªä¸ª Segment ç»„æˆï¼Œ Segment ä»£è¡¨â€éƒ¨åˆ†â€œæˆ–â€ä¸€æ®µâ€œçš„æ„æ€ï¼Œæ‰€ä»¥å¾ˆå¤šåœ°æ–¹éƒ½ä¼šå°†å…¶æè¿°ä¸º<strong>åˆ†æ®µé”</strong>ã€‚æ³¨æ„ï¼Œè¡Œæ–‡ä¸­ï¼Œæˆ‘å¾ˆå¤šåœ°æ–¹ç”¨äº†â€œæ§½â€æ¥ä»£è¡¨ä¸€ä¸ªsegmentã€‚</p><h5 id="2-çº¿ç¨‹å®‰å…¨ï¼ˆSegment-ç»§æ‰¿-ReentrantLock-åŠ é”ï¼‰ï¼š"><a href="#2-çº¿ç¨‹å®‰å…¨ï¼ˆSegment-ç»§æ‰¿-ReentrantLock-åŠ é”ï¼‰ï¼š" class="headerlink" title="2.çº¿ç¨‹å®‰å…¨ï¼ˆSegment ç»§æ‰¿ ReentrantLock åŠ é”ï¼‰ï¼š"></a>2.çº¿ç¨‹å®‰å…¨ï¼ˆSegment ç»§æ‰¿ ReentrantLock åŠ é”ï¼‰ï¼š</h5><p>â€‹ç®€å•ç†è§£å°±æ˜¯ï¼Œ <u>ConcurrentHashMap æ˜¯ä¸€ä¸ª Segment æ•°ç»„ï¼Œ Segment é€šè¿‡ç»§æ‰¿ReentrantLock æ¥è¿›è¡ŒåŠ é”ï¼Œæ‰€ä»¥æ¯æ¬¡éœ€è¦åŠ é”çš„æ“ä½œé”ä½çš„æ˜¯ä¸€ä¸ª segmentï¼Œè¿™æ ·åªè¦ä¿è¯æ¯ä¸ª Segment æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿå°±å®ç°äº†å…¨å±€çš„çº¿ç¨‹å®‰å…¨ã€‚</u></p><h5 id="3-å¹¶è¡Œåº¦ï¼ˆé»˜è®¤-16ï¼‰ï¼š"><a href="#3-å¹¶è¡Œåº¦ï¼ˆé»˜è®¤-16ï¼‰ï¼š" class="headerlink" title="3.å¹¶è¡Œåº¦ï¼ˆé»˜è®¤ 16ï¼‰ï¼š"></a>3.å¹¶è¡Œåº¦ï¼ˆé»˜è®¤ 16ï¼‰ï¼š</h5><p>â€‹concurrencyLevelï¼šå¹¶è¡Œçº§åˆ«ã€å¹¶å‘æ•°ã€ Segment æ•°ï¼Œé»˜è®¤æ˜¯ 16ï¼Œ</p><p>â€‹å³ <strong>ConcurrentHashMap æœ‰ 16 ä¸ª Segments</strong>ï¼Œæ‰€ä»¥ç†è®ºä¸Šï¼Œ<u>æœ€å¤šå¯ä»¥åŒæ—¶æ”¯æŒ 16 ä¸ªçº¿ç¨‹å¹¶å‘å†™ï¼Œåªè¦å®ƒä»¬çš„æ“ä½œåˆ†åˆ«åˆ†å¸ƒåœ¨ä¸åŒçš„ Segment ä¸Š</u>ã€‚è¿™ä¸ªå€¼å¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™è®¾ç½®ä¸ºå…¶ä»–å€¼<u>ï¼Œä½†æ˜¯ä¸€æ—¦åˆå§‹åŒ–ä»¥åï¼Œå®ƒæ˜¯ä¸å¯ä»¥æ‰©å®¹çš„</u>ã€‚å†å…·ä½“åˆ°æ¯ä¸ª Segment å†…éƒ¨ï¼Œå…¶å®æ¯ä¸ª Segment å¾ˆåƒä¹‹å‰ä»‹ç»çš„ HashMapï¼Œä¸è¿‡å®ƒè¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥å¤„ç†èµ·æ¥è¦éº»çƒ¦äº›ã€‚</p><h5 id="ğŸŒŸsegment-æ•°é‡åœ¨-ConcurrentHashMap-åˆå§‹åŒ–åå°±ä¸å¯æ”¹å˜"><a href="#ğŸŒŸsegment-æ•°é‡åœ¨-ConcurrentHashMap-åˆå§‹åŒ–åå°±ä¸å¯æ”¹å˜" class="headerlink" title="ğŸŒŸsegment æ•°é‡åœ¨ ConcurrentHashMap åˆå§‹åŒ–åå°±ä¸å¯æ”¹å˜"></a>ğŸŒŸsegment æ•°é‡åœ¨ ConcurrentHashMap åˆå§‹åŒ–åå°±ä¸å¯æ”¹å˜</h5><h5 id="ğŸŒŸæ¯ä¸ª-segment-ä¸­çš„hashmapå¤§å°å¯æ‰©å®¹ï¼Œç±»ä¼¼HashMap"><a href="#ğŸŒŸæ¯ä¸ª-segment-ä¸­çš„hashmapå¤§å°å¯æ‰©å®¹ï¼Œç±»ä¼¼HashMap" class="headerlink" title="ğŸŒŸæ¯ä¸ª segment ä¸­çš„hashmapå¤§å°å¯æ‰©å®¹ï¼Œç±»ä¼¼HashMap"></a>ğŸŒŸæ¯ä¸ª segment ä¸­çš„hashmapå¤§å°å¯æ‰©å®¹ï¼Œç±»ä¼¼HashMap</h5><p>â€‹çº¿ç¨‹<strong>å†™</strong>ä¸€ä¸ªsegmentæ—¶ï¼Œéœ€è¦è·å–è¯¥segmentä»£è¡¨çš„ReentrantLockï¼Œ**<u>è¯»å–æ•°æ®å¹¶ä¸éœ€è¦è·å–é”</u>**ï¼Œå› æ­¤<u>åªæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶åœ¨å†™ä¸€ä¸ªsegmentæ—¶æ‰ä¼šå‘ç”Ÿå†²çªï¼Œè¿™æ—¶æœªæŠ¢åˆ°é”çš„çº¿ç¨‹å°†è¢«é˜»å¡ï¼ï¼ï¼</u></p><h4 id="JDK1-8"><a href="#JDK1-8" class="headerlink" title="JDK1.8:"></a>JDK1.8:</h4><p>â€‹ç”±äºJDK1.7ä¸­segmentä½¿ç”¨æ‹‰é“¾æ³•è§£å†³hashå†²çªï¼Œé“¾è¡¨è¿‡é•¿ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p><p>â€‹JDK1.8ä¸­å½“é“¾è¡¨é•¿åº¦&gt;8æ—¶ï¼Œä¼šè‡ªåŠ¨è½¬æ¢æˆçº¢é»‘æ ‘å­˜å‚¨</p><p>å¹¶ä¸”ä½¿ç”¨ <strong>CAS + synchronized</strong> æ¥ä¿è¯å¹¶å‘çš„å®‰å…¨æ€§ï¼Œ**<u>åªé”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„é¦–èŠ‚ç‚¹</u>**ï¼Œåªè¦èŠ‚ç‚¹ hash ä¸å†²çªï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘ï¼Œç›¸æ¯” JDK1.7 çš„ ConcurrentHashMap æ•ˆç‡åˆæå‡äº† N å€ï¼</p><p><a href="https://security.feishu.cn/link/safety?target=https://pdai.tech/md/java/thread/java-thread-x-juc-collection-ConcurrentHashMap.html%23juc%E9%9B%86%E5%90%88-concurrenthashmap%E8%AF%A6%E8%A7%A3&scene=ccm&logParams=%7B%22location%22:%22ccm_default%22%7D&lang=zh-CN">JUCé›†åˆ: ConcurrentHashMapè¯¦è§£</a></p><h1 id="æšä¸¾ç±»ï¼š"><a href="#æšä¸¾ç±»ï¼š" class="headerlink" title="æšä¸¾ç±»ï¼š"></a>æšä¸¾ç±»ï¼š</h1><p>demo Code:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">DemoEnum</span> &#123;</span><br><span class="line">    RED(<span class="string">&quot;r&quot;</span>, <span class="string">&quot;ğŸŒ¹&quot;</span>),</span><br><span class="line">    BLUE(<span class="string">&quot;g&quot;</span>, <span class="string">&quot;wdwd&quot;</span>),</span><br><span class="line">    GREEN(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;ewdwdwdadw&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    DemoEnum(String color, String desc) &#123;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(DemoEnum.RED.color);</span><br><span class="line">        System.out.println(DemoEnum.RED.desc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">  r</span><br><span class="line">  ğŸŒ¹</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼šRedã€Blueã€Greenè¢«ç§°ä¸º**<u>æšä¸¾å¸¸é‡</u>**</p><p>æšä¸¾å¸¸é‡å¯ä»¥å¯¹åº”æœ‰å¤šä¸ªå±æ€§ï¼Œå¦‚ä¸Šè¿°æšä¸¾ç±»ä¸­çš„â€œcolorâ€ï¼Œâ€œdescâ€</p><p>âš ï¸ï¼šåœ¨å¤–éƒ¨ç±»æƒ³è¦è®¿é—®å¦‚<code>DemoEnum.Red.color</code>çš„è¯ï¼Œç”±äºcolorã€descéƒ½æ˜¯privateå±æ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨DemoEnumä¸­è‡ªå®šä¹‰æœ‰å…³ç§æœ‰å±æ€§çš„è®¿é—®æ–¹æ³•ã€‚</p><ul><li>æšä¸¾å¸¸é‡ï¼šREDã€BLUEã€GREEN  æ˜¯æšä¸¾ç±» DemoEnum çš„ä¸‰ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œå®ƒä»¬æ˜¯å”¯ä¸€çš„ã€å·²å‘½åçš„å¸¸é‡ã€‚( è€Œ(â€œrâ€, â€œğŸŒ¹â€) å°±æ˜¯æ„é€ REDè¿™ä¸ªå®ä¾‹åŒ–å¯¹è±¡çš„åˆå§‹å˜é‡ )</li><li>æ„é€ æ–¹æ³•ï¼šæšä¸¾ç±»çš„æ„é€ æ–¹æ³•<strong>é»˜è®¤æ˜¯ç§æœ‰</strong>çš„ï¼Œåªèƒ½åœ¨æšä¸¾ç±»å†…éƒ¨ä½¿ç”¨ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ç§æœ‰æ„é€ æ–¹æ³•æ¥ä¸ºæ¯ä¸ªæšä¸¾å¸¸é‡è®¾ç½®å¯¹åº”çš„é¢œè‰²å’ŒåŸå§‹å€¼ã€‚</li><li>values() æ–¹æ³•ï¼šè¿™ä¸ªç¤ºä¾‹åœ¨ main() æ–¹æ³•ä¸­ä½¿ç”¨ TestEnum.values() æ–¹æ³•<strong>è·å– DemoEnum æšä¸¾ç±»ä¸­çš„æ‰€æœ‰æšä¸¾å¸¸é‡ï¼Œ</strong>å¹¶è¿›è¡Œéå†è¾“å‡ºã€‚</li><li>valueOf(String name) æ–¹æ³•ï¼šé€šè¿‡ TestEnum.valueOf(â€œREDâ€) å¯ä»¥è·å–æšä¸¾å¸¸é‡åä¸º â€œREDâ€ çš„<strong>æšä¸¾å¯¹è±¡</strong>ã€‚</li><li>ordinal() æ–¹æ³•ï¼šæšä¸¾å¸¸é‡çš„ ordinal() æ–¹æ³•è¿”å›å®ƒä»¬åœ¨æšä¸¾ç±»å‹ä¸­å®šä¹‰çš„é¡ºåºå€¼ï¼ˆ<strong>ä¸‹æ ‡</strong>ï¼Œä»0å¼€å§‹ï¼‰ã€‚</li><li>compareTo() æ–¹æ³•ï¼šé€šè¿‡ RED.compareTo(BLACK) å’Œ BLACK.compareTo(GREEN) å¯ä»¥æ¯”è¾ƒä¸¤ä¸ªæšä¸¾å¸¸é‡çš„é¡ºåºï¼Œè¿”å›ä¸€ä¸ªæ•´æ•°å€¼ã€‚</li></ul><h3 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h3><ul><li><p>æ˜“è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼šæšä¸¾ç±»å‹ä¸­çš„å¸¸é‡æ˜¯æœ‰æ„ä¹‰çš„ã€è‡ªæè¿°çš„ï¼Œä½¿å¾—ä»£ç æ›´æ˜“è¯»ã€æ˜“ç†è§£å’Œæ˜“äºç»´æŠ¤ã€‚æšä¸¾å¸¸é‡å…·æœ‰å”¯ä¸€çš„åç§°ï¼Œæä¾›äº†æ›´å¥½çš„æ–‡æ¡£å’Œæ³¨é‡Šã€‚</p></li><li><p>ç±»å‹å®‰å…¨ï¼šæšä¸¾ç±»å‹åœ¨ç¼–è¯‘æ—¶è¿›è¡Œé™æ€ç±»å‹æ£€æŸ¥ï¼Œè¿™æ„å‘³ç€ç¼–è¯‘å™¨å¯ä»¥ç¡®ä¿åªä½¿ç”¨æœ‰æ•ˆçš„æšä¸¾å¸¸é‡ï¼Œæä¾›äº†æ›´é«˜çš„ç±»å‹å®‰å…¨æ€§ã€‚</p></li><li><p>å¯é™å®šçš„å€¼é›†åˆï¼šæšä¸¾ç±»å‹å®šä¹‰äº†ä¸€ä¸ªæœ‰é™çš„å€¼é›†åˆï¼Œé™å®šäº†æœ‰æ•ˆçš„å–å€¼èŒƒå›´ã€‚è¿™å¯ä»¥å¸®åŠ©é¿å…ç¨‹åºä¸­å‡ºç°æ— æ•ˆæˆ–æ„å¤–çš„å–å€¼ã€‚</p></li><li><p>é¿å…é­”æ³•æ•°å€¼ï¼šä½¿ç”¨æšä¸¾ç±»å‹å¯ä»¥é¿å…ä½¿ç”¨ç¡¬ç¼–ç çš„é­”æ³•æ•°å€¼ï¼Œæä¾›äº†æ›´å¥½çš„ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p></li><li><p>å¢å¼ºçš„ç¼–è¯‘å™¨æ”¯æŒï¼šæšä¸¾ç±»å‹åœ¨ç¼–è¯‘å™¨å±‚é¢æä¾›äº†ä¸€äº›é¢å¤–çš„æ”¯æŒï¼Œå¦‚è‡ªåŠ¨æ·»åŠ å¸¸ç”¨æ–¹æ³•ï¼ˆå¦‚values()ã€valueOf()ï¼‰ã€æšä¸¾å¸¸é‡çš„é¡ºåºç­‰ã€‚</p></li><li><p>é€‚ç”¨äºçŠ¶æ€å’Œé€‰é¡¹çš„è¡¨ç¤ºï¼šæšä¸¾ç±»å‹éå¸¸é€‚ç”¨äºè¡¨ç¤ºçŠ¶æ€ã€é€‰é¡¹å’Œå›ºå®šé›†åˆï¼Œå¦‚å­£èŠ‚ã€é¢œè‰²ã€æ˜ŸæœŸå‡ ç­‰ã€‚</p></li></ul><h3 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h3><ul><li><p>ä¸é€‚ç”¨äºåŠ¨æ€å˜åŒ–çš„æ•°æ®ï¼šæšä¸¾ç±»å‹æ˜¯åœ¨ç¼–è¯‘æ—¶å®šä¹‰çš„ï¼Œå…¶å¸¸é‡é›†åˆæ˜¯å›ºå®šçš„ã€‚å¦‚æœéœ€è¦è¡¨ç¤ºåŠ¨æ€å˜åŒ–çš„æ•°æ®é›†åˆï¼Œæšä¸¾ç±»å‹å¯èƒ½ä¸é€‚åˆã€‚</p></li><li><p>ä¸é€‚ç”¨äºå¤§å‹æ•°æ®é›†åˆï¼šå¦‚æœéœ€è¦è¡¨ç¤ºå¤§å‹çš„æ•°æ®é›†åˆï¼Œæšä¸¾ç±»å‹çš„å¸¸é‡å®šä¹‰å¯èƒ½ä¼šå˜å¾—å†—é•¿å’Œç¹çã€‚</p></li><li><p>ç¼ºä¹æ‰©å±•æ€§ï¼šæšä¸¾ç±»å‹çš„å¸¸é‡æ˜¯åœ¨ç¼–è¯‘æ—¶ç¡®å®šçš„ï¼Œä¸æ”¯æŒåŠ¨æ€æ·»åŠ æˆ–åˆ é™¤å¸¸é‡ã€‚å› æ­¤ï¼Œå¦‚æœéœ€è¦é¢‘ç¹åœ°ä¿®æ”¹å¸¸é‡é›†åˆï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»£ç çš„æ”¹åŠ¨å’Œç»´æŠ¤æˆæœ¬çš„å¢åŠ ã€‚</p></li><li><p>ä¸æ”¯æŒç»§æ‰¿ï¼šæšä¸¾ç±»å‹ä¸æ”¯æŒç»§æ‰¿ï¼Œæ— æ³•å®ç°æšä¸¾ç±»å‹ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ã€‚</p></li></ul><h1 id="å¼‚å¸¸åˆ†ç±»åŠå¤„ç†"><a href="#å¼‚å¸¸åˆ†ç±»åŠå¤„ç†" class="headerlink" title="å¼‚å¸¸åˆ†ç±»åŠå¤„ç†"></a>å¼‚å¸¸åˆ†ç±»åŠå¤„ç†</h1><h4 id="4-1-1-å¼‚å¸¸æ¦‚å¿µ"><a href="#4-1-1-å¼‚å¸¸æ¦‚å¿µ" class="headerlink" title="4.1.1. å¼‚å¸¸æ¦‚å¿µ"></a>4.1.1. å¼‚å¸¸æ¦‚å¿µ</h4><p>â€‹å¦‚æœæŸä¸ªæ–¹æ³•ä¸èƒ½æŒ‰ç…§æ­£å¸¸çš„é€”å¾„å®Œæˆä»»åŠ¡ï¼Œå°±å¯ä»¥é€šè¿‡å¦ä¸€ç§è·¯å¾„é€€å‡ºæ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šæŠ›å‡ºä¸€ä¸ªå°è£…äº†é”™è¯¯ä¿¡æ¯çš„å¯¹è±¡ã€‚æ­¤æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šç«‹åˆ»é€€å‡ºåŒæ—¶ä¸è¿”å›ä»»ä½•å€¼ã€‚å¦å¤–ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å…¶ä»–ä»£ç ä¹Ÿæ— æ³•ç»§ç»­æ‰§è¡Œï¼Œå¼‚å¸¸å¤„ç†æœºåˆ¶ä¼šå°†ä»£ç æ‰§è¡Œäº¤ç»™å¼‚å¸¸å¤„ç†å™¨ã€‚</p><h4 id="4-1-2-å¼‚å¸¸åˆ†ç±»"><a href="#4-1-2-å¼‚å¸¸åˆ†ç±»" class="headerlink" title="4.1.2. å¼‚å¸¸åˆ†ç±»"></a>4.1.2. å¼‚å¸¸åˆ†ç±»</h4><p><strong><u>Throwable</u></strong> æ˜¯ Java è¯­è¨€ä¸­æ‰€æœ‰é”™è¯¯æˆ–å¼‚å¸¸çš„è¶…ç±»ã€‚ä¸‹ä¸€å±‚åˆ†ä¸º <u>Error å’Œ Exception</u></p><h5 id="Error-éæ£€æŸ¥å¼‚å¸¸-ï¼š"><a href="#Error-éæ£€æŸ¥å¼‚å¸¸-ï¼š" class="headerlink" title="Error (éæ£€æŸ¥å¼‚å¸¸)ï¼š"></a>Error (éæ£€æŸ¥å¼‚å¸¸)ï¼š</h5><ul><li>Error ç±»æ˜¯æŒ‡ java <u>è¿è¡Œæ—¶ç³»ç»Ÿçš„å†…éƒ¨é”™è¯¯å’Œèµ„æºè€—å°½é”™è¯¯</u>ã€‚åº”ç”¨ç¨‹åºä¸ä¼šæŠ›å‡ºè¯¥ç±»å¯¹è±¡ã€‚å¦‚æœå‡ºç°äº†è¿™æ ·çš„é”™è¯¯ï¼Œé™¤äº†å‘ŠçŸ¥ç”¨æˆ·ï¼Œå‰©ä¸‹çš„å°±æ˜¯å°½åŠ›ä½¿ç¨‹åºå®‰å…¨çš„ç»ˆæ­¢ã€‚</li></ul><h5 id="Exceptionï¼ˆ-RuntimeException-éæ£€æŸ¥å¼‚å¸¸-ã€-CheckedException-æ£€æŸ¥å¼‚å¸¸-ï¼‰ï¼š"><a href="#Exceptionï¼ˆ-RuntimeException-éæ£€æŸ¥å¼‚å¸¸-ã€-CheckedException-æ£€æŸ¥å¼‚å¸¸-ï¼‰ï¼š" class="headerlink" title="Exceptionï¼ˆ RuntimeException(éæ£€æŸ¥å¼‚å¸¸)ã€ CheckedException(æ£€æŸ¥å¼‚å¸¸) ï¼‰ï¼š"></a>Exceptionï¼ˆ RuntimeException(éæ£€æŸ¥å¼‚å¸¸)ã€ CheckedException(æ£€æŸ¥å¼‚å¸¸) ï¼‰ï¼š</h5><ul><li><p>Exception åˆ æœ‰ ä¸¤ ä¸ª åˆ† æ”¯ ï¼Œ <u>è¿è¡Œæ—¶å¼‚å¸¸(éæ£€æŸ¥å¼‚å¸¸)</u> RuntimeException ï¼Œ <u>æ£€æŸ¥å¼‚å¸¸</u>CheckedExceptionã€‚</p><ul><li><p>RuntimeException å¦‚ ï¼š NullPointerException ã€ ClassCastException ï¼› <u><strong>RuntimeException æ˜¯é‚£äº›å¯èƒ½åœ¨ Java è™šæ‹Ÿæœºæ­£å¸¸è¿è¡ŒæœŸé—´æŠ›å‡ºçš„å¼‚å¸¸çš„è¶…ç±»ã€‚ å¦‚æœå‡ºç° RuntimeExceptionï¼Œé‚£ä¹ˆä¸€å®šæ˜¯ç¨‹åºå‘˜çš„é”™è¯¯ã€‚</strong></u></p><ul><li>æ¯”å¦‚é™¤æ•°ä¸º 0 é”™è¯¯ ArithmeticExceptionï¼Œå¼ºåˆ¶ç±»å‹è½¬æ¢é”™è¯¯ ClassCastExceptionï¼Œæ•°ç»„ç´¢å¼•è¶Šç•ŒArrayIndexOutOfBoundsExceptionï¼Œä½¿ç”¨äº†ç©ºå¯¹è±¡NullPointerExceptionç­‰ç­‰</li></ul></li><li><p>CheckedExceptionå¦‚ ï¼š I&#x2F;O é”™è¯¯å¯¼è‡´çš„ IOExceptionã€ SQLExceptionã€‚ä¸€èˆ¬æ˜¯å¤–éƒ¨é”™è¯¯ï¼Œ<u>è¿™ç§å¼‚å¸¸éƒ½å‘ç”Ÿåœ¨ç¼–è¯‘é˜¶æ®µ</u>ï¼Œ **<u>Java ç¼–è¯‘å™¨ä¼šå¼ºåˆ¶ç¨‹åºå»æ•è·æ­¤ç±»å¼‚å¸¸ï¼Œå³ä¼šå‡ºç°è¦æ±‚ä½ æŠŠè¿™æ®µå¯èƒ½å‡ºç°å¼‚å¸¸çš„ç¨‹åºè¿›è¡Œ try catch</u>**ï¼Œè¯¥ç±»å¼‚å¸¸ä¸€èˆ¬åŒ…æ‹¬å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li>è¯•å›¾åœ¨æ–‡ä»¶å°¾éƒ¨è¯»å–æ•°æ®</li><li>è¯•å›¾æ‰“å¼€ä¸€ä¸ªé”™è¯¯æ ¼å¼çš„ URL</li><li>è¯•å›¾æ ¹æ®ç»™å®šçš„å­—ç¬¦ä¸²æŸ¥æ‰¾ class å¯¹è±¡ï¼Œè€Œè¿™ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºçš„ç±»å¹¶ä¸å­˜åœ¨</li></ul></li></ul></li></ul><h4 id="4-1-3-ä¸‰ç§å¤„ç†æ–¹å¼"><a href="#4-1-3-ä¸‰ç§å¤„ç†æ–¹å¼" class="headerlink" title="4.1.3.ä¸‰ç§å¤„ç†æ–¹å¼"></a>4.1.3.ä¸‰ç§å¤„ç†æ–¹å¼</h4><ul><li>åœ¨try-catchä¸­è‡ªå®šä¹‰throwé”™è¯¯ä¿¡æ¯</li><li>throwsç»™ä¸Šå±‚</li><li>å•¥ä¹Ÿä¸åšï¼Œç³»ç»Ÿé»˜è®¤å¸®ä½ æŠ›å¼‚å¸¸</li></ul><h4 id="4-1-4-Throw-å’Œ-throws-çš„åŒºåˆ«ï¼š"><a href="#4-1-4-Throw-å’Œ-throws-çš„åŒºåˆ«ï¼š" class="headerlink" title="4.1.4. Throw å’Œ throws çš„åŒºåˆ«ï¼š"></a>4.1.4. Throw å’Œ throws çš„åŒºåˆ«ï¼š</h4><h5 id="ä½ç½®ä¸åŒï¼š"><a href="#ä½ç½®ä¸åŒï¼š" class="headerlink" title="ä½ç½®ä¸åŒï¼š"></a>ä½ç½®ä¸åŒï¼š</h5><pre><code>1. throws ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œåé¢è·Ÿçš„æ˜¯&lt;u&gt;å¼‚å¸¸ç±»ï¼Œå¯ä»¥è·Ÿå¤šä¸ª&lt;/u&gt;ï¼› è€Œ throw ç”¨åœ¨å‡½æ•°å†…ï¼Œåé¢è·Ÿçš„æ˜¯&lt;u&gt;å¼‚å¸¸å¯¹è±¡&lt;/u&gt;ã€‚</code></pre><h5 id="åŠŸèƒ½ä¸åŒï¼š"><a href="#åŠŸèƒ½ä¸åŒï¼š" class="headerlink" title="åŠŸèƒ½ä¸åŒï¼š"></a>åŠŸèƒ½ä¸åŒï¼š</h5><ol start="2"><li><p>throws ç”¨æ¥<u><strong>å£°æ˜å¼‚å¸¸ï¼Œè®©è°ƒç”¨è€…åªçŸ¥é“è¯¥åŠŸèƒ½å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œå¯ä»¥ç»™å‡ºé¢„å…ˆçš„å¤„ç†æ–¹å¼</strong></u>ï¼› throw <u><strong>æŠ›å‡ºå…·ä½“çš„é—®é¢˜å¯¹è±¡ï¼Œæ‰§è¡Œåˆ° throwï¼ŒåŠŸèƒ½å°±å·²ç»ç»“æŸäº†ï¼Œè·³è½¬åˆ°è°ƒç”¨è€…ï¼Œå¹¶å°†å…·ä½“çš„é—®é¢˜å¯¹è±¡æŠ›ç»™è°ƒç”¨è€…</strong></u>ã€‚ä¹Ÿå°±æ˜¯è¯´ throw è¯­å¥ç‹¬ç«‹å­˜åœ¨æ—¶ï¼Œä¸‹é¢ä¸è¦å®šä¹‰å…¶ä»–è¯­å¥ï¼Œå› ä¸ºæ‰§è¡Œä¸åˆ°ã€‚</p></li><li><p>ğŸŒŸthrows è¡¨ç¤ºå‡ºç°å¼‚å¸¸çš„ä¸€ç§<strong>å¯èƒ½æ€§</strong>ï¼Œå¹¶<strong>ä¸ä¸€å®šä¼šå‘ç”Ÿè¿™äº›å¼‚å¸¸</strong>ï¼› throw åˆ™æ˜¯<u>æŠ›å‡ºäº†å¼‚å¸¸</u>ï¼Œ<u>æ‰§è¡Œ throw åˆ™ä¸€å®šæŠ›å‡ºäº†æŸç§å¼‚å¸¸å¯¹è±¡ã€‚</u></p></li><li><p>ä¸¤è€…éƒ½æ˜¯æ¶ˆæå¤„ç†å¼‚å¸¸çš„æ–¹å¼ï¼Œ<u>åªæ˜¯æŠ›å‡ºæˆ–è€…å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯ä¸ä¼šç”±å‡½æ•°å»å¤„ç†å¼‚å¸¸ï¼ŒçœŸæ­£çš„å¤„ç†å¼‚å¸¸ç”±å‡½æ•°çš„ä¸Šå±‚è°ƒç”¨å¤„ç†</u>ã€‚</p></li></ol><h4 id="4-1-5-try-cache-finally-ä¸try-with-resources"><a href="#4-1-5-try-cache-finally-ä¸try-with-resources" class="headerlink" title="4.1.5 try-cache-finally ä¸try-with-resources"></a>4.1.5 try-cache-finally ä¸try-with-resources</h4><p><code>try-finally</code> æ˜¯java SE7ä¹‹å‰æˆ‘ä»¬å¤„ç†ä¸€äº›éœ€è¦å…³é—­çš„èµ„æºçš„åšæ³•ï¼Œæ— è®ºæ˜¯å¦å‡ºç°å¼‚å¸¸éƒ½è¦å¯¹èµ„æºè¿›è¡Œå…³é—­ã€‚</p><p><strong>å¦‚æœtryå—å’Œfinallyå—ä¸­çš„æ–¹æ³•éƒ½æŠ›å‡ºå¼‚å¸¸é‚£ä¹ˆtryå—ä¸­çš„å¼‚å¸¸ä¼šè¢«æŠ‘åˆ¶ï¼ˆsuppressï¼‰ï¼Œåªä¼šæŠ›å‡ºfinallyä¸­çš„å¼‚å¸¸ï¼Œè€ŒæŠŠtryå—çš„å¼‚å¸¸å®Œå…¨å¿½ç•¥ã€‚</strong></p><p>è¿™é‡Œå¦‚æœæˆ‘ä»¬ç”¨<code>catch</code>è¯­å¥å»è·å¾—<code>try</code>å—çš„å¼‚å¸¸ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå½±å“ï¼Œ<code>catch</code>å—è™½ç„¶èƒ½è·å–åˆ°<code>try</code>å—çš„å¼‚å¸¸ä½†æ˜¯å¯¹å‡½æ•°è¿è¡Œç»“æŸæŠ›å‡ºçš„å¼‚å¸¸å¹¶æ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚</p><p>try-with-resourcesè¯­å¥èƒ½å¤Ÿå¸®ä½ è‡ªåŠ¨è°ƒç”¨èµ„æºçš„close()å‡½æ•°å…³é—­èµ„æºä¸ç”¨åˆ°finallyå—ã€‚<br>å‰ææ˜¯<strong>åªæœ‰å®ç°äº†Closeableæ¥å£çš„æ‰èƒ½è‡ªåŠ¨å…³é—­</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clean</span><span class="params">(String path, Consumer&lt;String&gt; consumer)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(path))) &#123;</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span>((line = br.readLine()) != <span class="literal">null</span> )&#123;</span><br><span class="line">            consumer.accept(line);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯<code>try-with-resources</code>è¯­å¥çš„ç»“æ„ï¼Œåœ¨tryå…³é”®å­—åé¢çš„( )é‡Œ<code>new</code>ä¸€äº›éœ€è¦è‡ªåŠ¨å…³é—­çš„èµ„æºã€‚</p><p>è¿™ä¸ªæ—¶å€™å¦‚æœæ–¹æ³• <code>readLine</code> å’Œè‡ªåŠ¨å…³é—­èµ„æºçš„è¿‡ç¨‹éƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆï¼š</p><ul><li><strong>å‡½æ•°æ‰§è¡Œç»“æŸä¹‹åæŠ›å‡ºçš„æ˜¯tryå—çš„å¼‚å¸¸</strong>ï¼Œè€Œtry-with-resourcesè¯­å¥<u>å…³é—­è¿‡ç¨‹ä¸­çš„å¼‚å¸¸</u>ä¼šè¢«æŠ‘åˆ¶ï¼Œæ”¾åœ¨tryå—æŠ›å‡ºçš„å¼‚å¸¸çš„ä¸€ä¸ªæ•°ç»„é‡Œã€‚ï¼ˆä¸Šé¢çš„étry-with-resourcesä¾‹å­æŠ›å‡ºçš„æ˜¯finallyçš„å¼‚å¸¸ï¼Œè€Œä¸”tryå—çš„å¼‚å¸¸ä¹Ÿä¸ä¼šæ”¾åœ¨fianllyæŠ›å‡ºçš„å¼‚å¸¸çš„æŠ‘åˆ¶æ•°ç»„é‡Œï¼‰</li><li>å¯ä»¥é€šè¿‡å¼‚å¸¸çš„<code>public final synchronized Throwable[] getSuppressed()</code> æ–¹æ³•è·å¾—ä¸€ä¸ªè¢«æŠ‘åˆ¶å¼‚å¸¸çš„æ•°ç»„ã€‚</li><li><code>try</code>å—æŠ›å‡ºçš„å¼‚å¸¸è°ƒç”¨<code>getSuppressed()</code>æ–¹æ³•è·å¾—ä¸€ä¸ªè¢«å®ƒæŠ‘åˆ¶çš„å¼‚å¸¸çš„æ•°ç»„ï¼Œå…¶ä¸­å°±æœ‰å…³é—­èµ„æºçš„è¿‡ç¨‹äº§ç”Ÿçš„å¼‚å¸¸ã€‚</li></ul><h5 id="try-with-resources-è¯­å¥èƒ½æ”¾å¤šä¸ªèµ„æº-ä½¿ç”¨-åˆ†å‰²"><a href="#try-with-resources-è¯­å¥èƒ½æ”¾å¤šä¸ªèµ„æº-ä½¿ç”¨-åˆ†å‰²" class="headerlink" title="try-with-resources è¯­å¥èƒ½æ”¾å¤šä¸ªèµ„æº,ä½¿ç”¨ ; åˆ†å‰²"></a>try-with-resources è¯­å¥èƒ½æ”¾å¤šä¸ªèµ„æº,ä½¿ç”¨ <code>;</code> åˆ†å‰²</h5><p>â€‹æœ€åä»»åŠ¡æ‰§è¡Œå®Œæ¯•æˆ–è€…å‡ºç°å¼‚å¸¸ä¸­æ–­ä¹‹åæ˜¯æ ¹æ®<code>new</code>çš„åå‘é¡ºåºè°ƒç”¨å„èµ„æºçš„<code>close()</code>çš„ã€‚å<code>new</code>çš„å…ˆå…³ã€‚</p><h1 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h1><h4 id="4-2-1-åå°„æœºåˆ¶æ¦‚å¿µ"><a href="#4-2-1-åå°„æœºåˆ¶æ¦‚å¿µ" class="headerlink" title="4.2.1.åå°„æœºåˆ¶æ¦‚å¿µ"></a>4.2.1.åå°„æœºåˆ¶æ¦‚å¿µ</h4><p>åœ¨ Java ä¸­çš„åå°„æœºåˆ¶æ˜¯æŒ‡<u>åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»éƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼›</u>å¹¶ä¸”<u>å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•</u>ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½æˆä¸º Java è¯­è¨€çš„åå°„æœºåˆ¶ã€‚</p><h4 id="4-2-2-åå°„çš„åº”ç”¨åœºåˆ"><a href="#4-2-2-åå°„çš„åº”ç”¨åœºåˆ" class="headerlink" title="4.2.2. åå°„çš„åº”ç”¨åœºåˆ"></a>4.2.2. åå°„çš„åº”ç”¨åœºåˆ</h4><p>ğŸŒŸï¼š</p><p>â€‹<u>ç¨‹åºåœ¨è¿è¡Œæ—¶è¿˜å¯èƒ½æ¥æ”¶åˆ°å¤–éƒ¨ä¼ å…¥çš„å¯¹è±¡ï¼Œ è¯¥å¯¹è±¡çš„ç¼–è¯‘æ—¶ç±»å‹ä¸º Object,ä½†æ˜¯ç¨‹åºæœ‰éœ€è¦è°ƒç”¨è¯¥å¯¹è±¡çš„è¿è¡Œæ—¶ç±»å‹çš„æ–¹æ³•</u>ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œ ç¨‹åºéœ€è¦åœ¨è¿è¡Œæ—¶å‘ç°å¯¹è±¡å’Œç±»çš„çœŸå®ä¿¡æ¯ã€‚ç„¶è€Œï¼Œå¦‚æœç¼–è¯‘æ—¶æ ¹æœ¬æ— æ³•é¢„çŸ¥è¯¥å¯¹è±¡å’Œç±»å±äºå“ªäº›ç±»ï¼Œç¨‹åºåªèƒ½ä¾é è¿è¡Œæ—¶ä¿¡æ¯æ¥å‘ç°è¯¥å¯¹è±¡å’Œç±»çš„çœŸå®ä¿¡æ¯ï¼Œæ­¤æ—¶å°±å¿…é¡»ä½¿ç”¨åˆ°åå°„äº†ã€‚</p><h4 id="4-2-3-Java-åå°„"><a href="#4-2-3-Java-åå°„" class="headerlink" title="4.2.3. Java åå°„"></a>4.2.3. Java åå°„</h4><p>APIåå°„ API ç”¨æ¥ç”Ÿæˆ JVM ä¸­çš„ç±»ã€æ¥å£æˆ–åˆ™å¯¹è±¡çš„ä¿¡æ¯ã€‚</p><pre><code>1. Class ç±»ï¼šåå°„çš„æ ¸å¿ƒç±»ï¼Œå¯ä»¥è·å–ç±»çš„å±æ€§ï¼Œæ–¹æ³•ç­‰ä¿¡æ¯ã€‚</code></pre><ol start="2"><li><p>Field ç±»ï¼š Java.lang.reflec åŒ…ä¸­çš„ç±»ï¼Œ è¡¨ç¤ºç±»çš„<u><strong>æˆå‘˜å˜é‡</strong></u>ï¼Œå¯ä»¥ç”¨æ¥è·å–å’Œè®¾ç½®ç±»ä¹‹ä¸­çš„å±æ€§å€¼ã€‚</p></li><li><p>Method ç±»ï¼š Java.lang.reflec åŒ…ä¸­çš„ç±»ï¼Œè¡¨ç¤º<u><strong>ç±»çš„æ–¹æ³•</strong></u>ï¼Œå®ƒå¯ä»¥ç”¨æ¥è·å–ç±»ä¸­çš„æ–¹æ³•ä¿¡æ¯æˆ–è€…æ‰§è¡Œæ–¹æ³•ã€‚</p></li><li><p>Constructor ç±»ï¼š Java.lang.reflec åŒ…ä¸­çš„ç±»ï¼Œè¡¨ç¤º<u><strong>ç±»çš„æ„é€ æ–¹æ³•</strong></u>ã€‚</p></li></ol><h4 id="4-2-4-åå°„ä½¿ç”¨æ­¥éª¤ï¼ˆè·å–-Class-å¯¹è±¡ã€è°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼‰"><a href="#4-2-4-åå°„ä½¿ç”¨æ­¥éª¤ï¼ˆè·å–-Class-å¯¹è±¡ã€è°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼‰" class="headerlink" title="4.2.4. åå°„ä½¿ç”¨æ­¥éª¤ï¼ˆè·å– Class å¯¹è±¡ã€è°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼‰"></a>4.2.4. åå°„ä½¿ç”¨æ­¥éª¤ï¼ˆè·å– Class å¯¹è±¡ã€è°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼‰</h4><ol><li><p><u>è·å–æƒ³è¦æ“ä½œçš„ç±»çš„ Class å¯¹è±¡</u>ï¼Œä»–æ˜¯åå°„çš„æ ¸å¿ƒï¼Œé€šè¿‡ Class å¯¹è±¡æˆ‘ä»¬å¯ä»¥ä»»æ„è°ƒç”¨ç±»çš„æ–¹æ³•ã€‚</p></li><li><p><u>è°ƒç”¨ Class ç±»ä¸­çš„æ–¹æ³•</u>ï¼Œæ—¢å°±æ˜¯åå°„çš„ä½¿ç”¨é˜¶æ®µã€‚</p></li><li><p>ä½¿ç”¨åå°„ API æ¥æ“ä½œè¿™äº›ä¿¡æ¯ã€‚</p></li></ol><p>å…·ä½“ä½¿ç”¨çœ‹javaåŸºç¡€</p><p>åå°„ã€æ³¨è§£ã€å†…éƒ¨ç±»ã€æ³›å‹ã€åºåˆ—åŒ–ç­‰çœ‹javaguideå§</p>]]></content>
      
      
      <categories>
          
          <category> javaåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> è¯­è¨€åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºç½‘ç»œ</title>
      <link href="/2023/07/27/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
      <url>/2023/07/27/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="åº”ç”¨å±‚ï¼š"><a href="#åº”ç”¨å±‚ï¼š" class="headerlink" title="åº”ç”¨å±‚ï¼š"></a>åº”ç”¨å±‚ï¼š</h2><h3 id="HTTPåè®®ï¼š"><a href="#HTTPåè®®ï¼š" class="headerlink" title="HTTPåè®®ï¼š"></a>HTTPåè®®ï¼š</h3><p><strong>å‚è€ƒæ–‡ç« ï¼š</strong></p><ul><li><a href="https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html">JSON Web Token å…¥é—¨æ•™ç¨‹</a></li><li><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E9%80%8F%E8%A7%86HTTP%E5%8D%8F%E8%AE%AE">é€è§†HTTPåè®®</a></li><li><a href="https://juejin.cn/post/7064953803564384263">å›¾è§£|cookieã€sessionã€tokençš„é‚£äº›äº‹å„¿</a></li></ul><h4 id="HTTPæŠ¥æ–‡æ ¼å¼ï¼š"><a href="#HTTPæŠ¥æ–‡æ ¼å¼ï¼š" class="headerlink" title="HTTPæŠ¥æ–‡æ ¼å¼ï¼š"></a>HTTPæŠ¥æ–‡æ ¼å¼ï¼š</h4><h5 id="HTTP-è¯·æ±‚çš„æ ¼å¼ï¼š"><a href="#HTTP-è¯·æ±‚çš„æ ¼å¼ï¼š" class="headerlink" title="HTTP è¯·æ±‚çš„æ ¼å¼ï¼š"></a>HTTP è¯·æ±‚çš„æ ¼å¼ï¼š</h5><ul><li>è¯·æ±‚è¡Œï¼ˆRequest Lineï¼‰ï¼š</li></ul><p>â€‹        <strong>&lt;è¯·æ±‚æ–¹æ³•&gt; &lt;ç›®æ ‡èµ„æºè·¯å¾„&gt; &lt;åè®®ç‰ˆæœ¬&gt;</strong></p><ul><li>è¯·æ±‚å¤´ï¼ˆRequest Headersï¼‰ï¼šåŒ…å«äº†å…³äºè¯·æ±‚çš„ä¸€äº›é™„åŠ ä¿¡æ¯ï¼Œæ ¼å¼ä¸ºé”®å€¼å¯¹ï¼Œæ¯ä¸ªé”®å€¼å¯¹å æ®ä¸€è¡Œã€‚</li></ul><p>â€‹        &lt;é”®1&gt;: &lt;å€¼1&gt;</p><p>â€‹        &lt;é”®2&gt;: &lt;å€¼2&gt;</p><p>â€‹        â€¦</p><p>ç©ºè¡Œï¼ˆç©ºæ ¼ + å›è½¦æ¢è¡Œï¼‰ï¼š</p><p>â€‹        ç”¨äºåˆ†éš”è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“ã€‚</p><ul><li>è¯·æ±‚ä½“ï¼ˆRequest Bodyï¼‰ï¼š</li></ul><p>â€‹        å¯é€‰çš„ï¼Œé€‚ç”¨äºä¸€äº›ç‰¹å®šçš„è¯·æ±‚ï¼Œå¦‚ POST è¯·æ±‚ï¼Œç”¨äºä¼ è¾“ç”¨æˆ·æäº¤çš„æ•°æ®ã€‚</p><hr><h5 id="HTTP-å“åº”çš„æ ¼å¼ï¼š"><a href="#HTTP-å“åº”çš„æ ¼å¼ï¼š" class="headerlink" title="HTTP å“åº”çš„æ ¼å¼ï¼š"></a>HTTP å“åº”çš„æ ¼å¼ï¼š</h5><ul><li>çŠ¶æ€è¡Œï¼ˆStatus Lineï¼‰ï¼š</li></ul><p>â€‹        <strong>&lt;åè®®ç‰ˆæœ¬&gt; &lt;çŠ¶æ€ç &gt; &lt;çŠ¶æ€ä¿¡æ¯&gt;</strong></p><ul><li>å“åº”å¤´ï¼ˆResponse Headersï¼‰ï¼š</li></ul><p>â€‹        åŒ…å«äº†å…³äºå“åº”çš„ä¸€äº›é™„åŠ ä¿¡æ¯ï¼Œæ ¼å¼ä¸ºé”®å€¼å¯¹ï¼Œæ¯ä¸ªé”®å€¼å¯¹å æ®ä¸€è¡Œã€‚</p><p>â€‹        &lt;é”®1&gt;: &lt;å€¼1&gt;</p><p>â€‹        &lt;é”®2&gt;: &lt;å€¼2&gt;</p><p>â€‹        â€¦</p><ul><li>ç©ºè¡Œï¼ˆç©ºæ ¼ + å›è½¦æ¢è¡Œï¼‰ï¼š</li></ul><p>â€‹        ç”¨äºåˆ†éš”å“åº”å¤´å’Œå“åº”ä½“ã€‚</p><ul><li>å“åº”ä½“ï¼ˆResponse Bodyï¼‰ï¼š</li></ul><p>â€‹        åŒ…å«äº†æœåŠ¡å™¨å“åº”çš„æ•°æ®ã€‚</p><hr><p>HTTP&#x2F;1.1 é‡Œå”¯ä¸€è¦æ±‚å¿…é¡»æä¾›çš„å¤´å­—æ®µæ˜¯ Hostï¼Œå®ƒ<strong>å¿…é¡»å‡ºç°åœ¨è¯·æ±‚å¤´</strong>é‡Œï¼Œæ ‡è®°è™šæ‹Ÿä¸»æœºåã€‚</p><h4 id="HTTPè¯·æ±‚æ–¹æ³•ï¼š"><a href="#HTTPè¯·æ±‚æ–¹æ³•ï¼š" class="headerlink" title="HTTPè¯·æ±‚æ–¹æ³•ï¼š"></a>HTTPè¯·æ±‚æ–¹æ³•ï¼š</h4><p>ä»…ä»‹ç»è¾ƒä¸ºå¸¸ç”¨çš„å››ç§è¯·æ±‚æ–¹æ³•ï¼š</p><hr><h5 id="GETï¼š"><a href="#GETï¼š" class="headerlink" title="GETï¼š"></a>GETï¼š</h5><p>â€‹è·å–èµ„æºï¼Œå¯ä»¥ç†è§£ä¸ºè¯»å–æˆ–è€…ä¸‹è½½æ•°æ®ï¼›</p><p>GETçš„å«ä¹‰æ˜¯è¯·æ±‚<strong>ä»æœåŠ¡å™¨è·å–èµ„æº</strong>ï¼Œè¿™ä¸ªèµ„æºæ—¢å¯ä»¥æ˜¯é™æ€çš„æ–‡æœ¬ã€é¡µé¢ã€å›¾ç‰‡ã€è§†é¢‘ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”± PHPã€Java åŠ¨æ€ç”Ÿæˆçš„é¡µé¢æˆ–è€…å…¶ä»–æ ¼å¼çš„æ•°æ®ã€‚</p><hr><h5 id="HEADï¼š"><a href="#HEADï¼š" class="headerlink" title="HEADï¼š"></a>HEADï¼š</h5><p>â€‹<strong>HEAD</strong>æ–¹æ³•ä¸ GET æ–¹æ³•ç±»ä¼¼ï¼Œä¹Ÿæ˜¯è¯·æ±‚ä»æœåŠ¡å™¨è·å–èµ„æºï¼ŒæœåŠ¡å™¨çš„å¤„ç†æœºåˆ¶ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä½†<u>æœåŠ¡å™¨ä¸ä¼šè¿”å›è¯·æ±‚çš„å®ä½“æ•°æ®ï¼Œåªä¼šä¼ å›å“åº”å¤´ï¼Œä¹Ÿå°±æ˜¯èµ„æºçš„â€œå…ƒä¿¡æ¯â€ã€‚</u></p><p>â€‹HEAD æ–¹æ³•å¯ä»¥çœ‹åšæ˜¯ GET æ–¹æ³•çš„ä¸€ä¸ªâ€œç®€åŒ–ç‰ˆâ€æˆ–è€…â€œè½»é‡ç‰ˆâ€ã€‚å› ä¸ºå®ƒçš„å“åº”å¤´ä¸ GET å®Œå…¨ç›¸åŒï¼Œæ‰€ä»¥å¯ä»¥ç”¨åœ¨å¾ˆå¤šå¹¶ä¸çœŸæ­£éœ€è¦èµ„æºçš„åœºåˆï¼Œé¿å…ä¼ è¾“ body æ•°æ®çš„æµªè´¹ã€‚</p><p>åº”ç”¨åœºæ™¯ï¼š</p><ul><li><p>æƒ³è¦æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œåªè¦å‘ä¸ª HEAD è¯·æ±‚å°±å¯ä»¥äº†ï¼Œæ²¡æœ‰å¿…è¦ç”¨ GET æŠŠæ•´ä¸ªæ–‡ä»¶éƒ½å–ä¸‹æ¥ã€‚</p></li><li><p>è¦æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æœ‰æœ€æ–°ç‰ˆæœ¬ï¼ŒåŒæ ·ä¹Ÿåº”è¯¥ç”¨ HEADï¼ŒæœåŠ¡å™¨ä¼šåœ¨å“åº”å¤´é‡ŒæŠŠæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ä¼ å›æ¥ã€‚</p></li></ul><hr><h5 id="POSTï¼š"><a href="#POSTï¼š" class="headerlink" title="POSTï¼š"></a>POSTï¼š</h5><p>â€‹åªè¦å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œç”¨çš„å¤§å¤šæ•°éƒ½æ˜¯ POSTã€‚</p><hr><h5 id="PUTï¼š"><a href="#PUTï¼š" class="headerlink" title="PUTï¼š"></a>PUTï¼š</h5><p>â€‹PUT çš„ä½œç”¨ä¸ POST ç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥å‘æœåŠ¡å™¨æäº¤æ•°æ®ï¼Œä½†ä¸ POST å­˜åœ¨å¾®å¦™çš„ä¸åŒï¼Œé€šå¸¸ POST è¡¨ç¤ºçš„æ˜¯â€œæ–°å»ºâ€â€œcreateâ€çš„å«ä¹‰ï¼Œè€Œ PUT åˆ™æ˜¯â€œä¿®æ”¹â€â€œupdateâ€çš„å«ä¹‰ã€‚</p><p>â€‹åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒPUT ç”¨åˆ°çš„æ¯”è¾ƒå°‘ã€‚è€Œä¸”<u>ï¼Œå› ä¸ºå®ƒä¸ POST çš„è¯­ä¹‰ã€åŠŸèƒ½å¤ªè¿‡è¿‘ä¼¼ï¼Œæœ‰çš„æœåŠ¡å™¨ç”šè‡³å°±ç›´æ¥ç¦æ­¢ä½¿ç”¨ PUT æ–¹æ³•ï¼Œåªç”¨ POST æ–¹æ³•ä¸Šä¼ æ•°æ®ã€‚</u></p><h4 id="HTTP-URIå’ŒURLï¼š"><a href="#HTTP-URIå’ŒURLï¼š" class="headerlink" title="HTTP URIå’ŒURLï¼š"></a>HTTP URIå’ŒURLï¼š</h4><p>URIï¼ˆ<strong>U</strong>niform <strong>R</strong>esource <strong>I</strong>dentifierï¼‰ï¼š<strong>ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦</strong></p><p>URIæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼šURLå’ŒURN</p><p>URL &#x3D; Uniform Resource Locator ç»Ÿä¸€èµ„æºå®šä½ç¬¦</p><ul><li>ä»¥**<u>ä½ç½®</u>**å®šä½èµ„æº</li></ul><p>URN &#x3D; Uniform Resource Name ç»Ÿä¸€èµ„æºåç§°</p><ul><li>ä»¥**<u>åç§°å®š</u>**ä½èµ„æº</li></ul><h5 id="URIåŸºæœ¬ç»„æˆï¼š"><a href="#URIåŸºæœ¬ç»„æˆï¼š" class="headerlink" title="URIåŸºæœ¬ç»„æˆï¼š"></a>URIåŸºæœ¬ç»„æˆï¼š</h5><p>scheme:&#x2F;&#x2F;authorityç´§è·Ÿç€path?query</p><ul><li><p>schemeï¼šè¡¨ç¤ºåè®®åç§°</p></li><li><p>authorityï¼šèµ„æºæ‰€åœ¨çš„ä¸»æœºå(æˆ–åŸŸå) + ç«¯å£å·(å¦‚æœè¦ä½¿ç”¨åè®®çš„é»˜è®¤ç«¯å£ï¼Œåˆ™ç«¯å£å·å¯ä»¥çœç•¥)</p></li><li><p>pathï¼šæ ‡è®°èµ„æºæ‰€åœ¨çš„ä½ç½®çš„è·¯å¾„ï¼Œ<strong>ä»¥&#x2F;å¼€å¤´</strong></p></li><li><p>queryï¼šå¤šä¸ª<strong>key&#x3D;value</strong>çš„é”®å€¼å¯¹å½¢å¼ï¼Œé”®å€¼å¯¹é—´ä½¿ç”¨&amp;åˆ†éš”</p></li></ul><p>ğŸŒŸåœ¨ URI é‡Œå¯¹â€œ@&amp;&#x2F;â€ç­‰ç‰¹æ®Šå­—ç¬¦å’Œæ±‰å­—å¿…é¡»è¦åšç¼–ç ï¼Œå¦åˆ™æœåŠ¡å™¨æ”¶åˆ° HTTP æŠ¥æ–‡åä¼šæ— æ³•æ­£ç¡®å¤„ç†ã€‚</p><h4 id="HTTPå“åº”ç -çŠ¶æ€ç -ï¼š"><a href="#HTTPå“åº”ç -çŠ¶æ€ç -ï¼š" class="headerlink" title="HTTPå“åº”ç (çŠ¶æ€ç )ï¼š"></a>HTTPå“åº”ç (çŠ¶æ€ç )ï¼š</h4><p><a href="https://tsejx.github.io/javascript-guidebook/computer-networks/http/http-status-code/">è¯¦ç»†çŠ¶æ€ç è®°å½•</a></p><ul><li><p>1Ã—Ã—ï¼šæç¤ºä¿¡æ¯ï¼Œè¡¨ç¤ºç›®å‰æ˜¯åè®®å¤„ç†çš„ä¸­é—´çŠ¶æ€ï¼Œè¿˜éœ€è¦åç»­çš„æ“ä½œï¼›</p></li><li><p>2Ã—Ã—ï¼šæˆåŠŸï¼ŒæŠ¥æ–‡å·²ç»æ”¶åˆ°å¹¶è¢«æ­£ç¡®å¤„ç†ï¼›</p><ul><li>200 OKï¼šè¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼ŒæœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚ã€‚</li></ul></li><li><p>3Ã—Ã—ï¼šé‡å®šå‘ï¼Œèµ„æºä½ç½®å‘ç”Ÿå˜åŠ¨ï¼Œéœ€è¦å®¢æˆ·ç«¯é‡æ–°å‘é€è¯·æ±‚ï¼›</p><ul><li><p>301 Moved Permanentlyï¼šæ°¸ä¹…é‡å®šå‘ï¼Œè¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²ç»è¢«ç§»åŠ¨åˆ°äº†æ–°çš„URLã€‚</p></li><li><p>302 Foundï¼šä¸´æ—¶é‡å®šå‘ï¼Œè¡¨ç¤ºè¯·æ±‚çš„èµ„æºæš‚æ—¶è¢«ç§»åŠ¨åˆ°äº†æ–°çš„URLã€‚</p></li></ul></li><li><p>4Ã—Ã—ï¼šå®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚æŠ¥æ–‡æœ‰è¯¯ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ï¼›</p><ul><li>400 Bad Requestï¼šè¡¨ç¤ºå®¢æˆ·ç«¯çš„è¯·æ±‚è¯­æ³•é”™è¯¯æˆ–æ— æ•ˆï¼ŒæœåŠ¡å™¨æ— æ³•ç†è§£ã€‚</li><li>401 Unauthorizedï¼šè¡¨ç¤ºè¯·æ±‚éœ€è¦èº«ä»½éªŒè¯ï¼Œå®¢æˆ·ç«¯éœ€è¦æä¾›æœ‰æ•ˆçš„å‡­æ®ã€‚</li><li>403 Forbiddenï¼šè¡¨ç¤ºæœåŠ¡å™¨ç†è§£è¯·æ±‚ï¼Œä½†æ‹’ç»æ‰§è¡Œï¼Œå®¢æˆ·ç«¯æ²¡æœ‰è®¿é—®æƒé™ã€‚</li><li>404 Not Foundï¼šè¡¨ç¤ºæœåŠ¡å™¨æ— æ³•æ‰¾åˆ°è¯·æ±‚çš„èµ„æºã€‚</li></ul></li><li><p>5Ã—Ã—ï¼šæœåŠ¡å™¨é”™è¯¯ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶å†…éƒ¨å‘ç”Ÿäº†é”™è¯¯ã€‚</p><ul><li><p>500 Internal Server Errorï¼šè¡¨ç¤ºæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ã€‚</p></li><li><p>502 Bad Gatewayæ˜¯æŒ‡ä½œä¸ºä»£ç†æˆ–ç½‘å…³çš„æœåŠ¡å™¨ä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ªæ— æ•ˆçš„å“åº”ï¼Œå¯¼è‡´æ— æ³•å®Œæˆè¯·æ±‚ã€‚</p></li><li><p>503 Service Unavailableï¼šè¡¨ç¤ºæœåŠ¡å™¨æš‚æ—¶æ— æ³•å¤„ç†è¯·æ±‚ï¼Œé€šå¸¸æ˜¯ç”±äºæœåŠ¡å™¨è¿‡è½½æˆ–ç»´æŠ¤ã€‚</p></li></ul></li></ul><h4 id="HTTPè¿æ¥ï¼š"><a href="#HTTPè¿æ¥ï¼š" class="headerlink" title="HTTPè¿æ¥ï¼š"></a>HTTPè¿æ¥ï¼š</h4><h5 id="çŸ­è¿æ¥ï¼š"><a href="#çŸ­è¿æ¥ï¼š" class="headerlink" title="çŸ­è¿æ¥ï¼š"></a>çŸ­è¿æ¥ï¼š</h5><p>â€‹æ¯æ¬¡å‘é€è¯·æ±‚å‰éœ€è¦å…ˆä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œæ”¶åˆ°å“åº”æŠ¥æ–‡åä¼šç«‹å³å…³é—­è¿æ¥ã€‚</p><p>â€‹å»ºç«‹ã€å…³é—­è¿æ¥æ¶ˆè€—å¤§ï¼Œæ•ˆç‡ä½ï¼</p><h5 id="é•¿è¿æ¥ï¼š"><a href="#é•¿è¿æ¥ï¼š" class="headerlink" title="é•¿è¿æ¥ï¼š"></a>é•¿è¿æ¥ï¼š</h5><p>â€‹ä¸€ä¸ªè¿æ¥æ‰§è¡Œå¤šä¸ªè¯·æ±‚</p><p>â€‹é€šè¿‡è®¾ç½®è¿‡æœŸæ—¶é—´(å¤šå°‘æ—¶é•¿å†…æœªæ”¶åˆ°è¯·æ±‚ï¼Œåˆ™å…³é—­è¿æ¥)ã€è®¾ç½®<code>æœ€å¤§è¯·æ±‚æ‰§è¡Œæ¬¡æ•°</code>æ¥å…³é—­è¿æ¥ï¼Œ<u>é˜²æ­¢è¿‡å¤šçš„ç©ºé—²é•¿è¿æ¥å ç”¨æœåŠ¡å™¨èµ„æºã€‚</u></p><h5 id="é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼š"><a href="#é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼š" class="headerlink" title="é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼š"></a>é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼š</h5><p>â€‹é•¿è¿æ¥å°†å…¶è¦æ‰§è¡Œçš„ä»»åŠ¡ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä¾æ¬¡æ‰§è¡Œï¼Œå¦‚æœæ­£åœ¨æ‰§è¡Œçš„è¯·æ±‚é•¿æ—¶é—´ä¸èƒ½æ‰§è¡ŒæˆåŠŸï¼Œè¿™ä¼šå¯¼è‡´åé¢æ’é˜Ÿçš„è¯·æ±‚é•¿æ—¶é—´ç­‰å¾…ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›å‘ç”Ÿçš„ã€‚</p><p>â€‹å¯¹ç­–ï¼š</p><pre><code>æ¯ä¸ªè¯·æ±‚éƒ½å»ºç«‹å¤šä¸ªé•¿è¿æ¥ï¼Œé˜²æ­¢å•ä¸€é•¿è¿æ¥å¦‚æœé˜»å¡å¯¼è‡´æ•ˆç‡ä½(æ¯ä¸ªè¯·æ±‚éƒ½å‘é€åˆ°å¤šä¸ªé•¿è¿æ¥ä¸­ï¼Œä¼šå¯¼è‡´æœåŠ¡å™¨å‹åŠ›è¿‡å¤§ï¼Œä¸æ˜¯ä¸ªå¥½åŠæ³•)é€šè¿‡åŸŸååˆ†ç‰‡ï¼Œå°†æœåŠ¡å™¨ä¸Šçš„èµ„æºåˆ†ç±»ååˆ†æ•£åˆ°ä¸åŒçš„å­æœåŠ¡å™¨ä¸­ï¼Œåˆ†æ‘Šè¯·æ±‚çš„è´Ÿæ‹…ã€‚</code></pre><h4 id="HTTPçŠ¶æ€ï¼š"><a href="#HTTPçŠ¶æ€ï¼š" class="headerlink" title="HTTPçŠ¶æ€ï¼š"></a>HTTPçŠ¶æ€ï¼š</h4><h5 id="ç™»å½•ä¸€ä¸ªé¡µé¢ï¼ŒæœåŠ¡å™¨æ€ä¹ˆçŸ¥é“ä½ æ˜¯è°ï¼Ÿ"><a href="#ç™»å½•ä¸€ä¸ªé¡µé¢ï¼ŒæœåŠ¡å™¨æ€ä¹ˆçŸ¥é“ä½ æ˜¯è°ï¼Ÿ" class="headerlink" title="ç™»å½•ä¸€ä¸ªé¡µé¢ï¼ŒæœåŠ¡å™¨æ€ä¹ˆçŸ¥é“ä½ æ˜¯è°ï¼Ÿ"></a>ç™»å½•ä¸€ä¸ªé¡µé¢ï¼ŒæœåŠ¡å™¨æ€ä¹ˆçŸ¥é“ä½ æ˜¯è°ï¼Ÿ</h5><h5 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie:"></a>Cookie:</h5><p>â€‹å¸¸ç”¨äºä¿å­˜ä¸€äº›è®©æœåŠ¡å™¨è¾¨è¯†çš„ä¿¡æ¯ï¼Œä»è€Œä½¿æœåŠ¡å™¨è®¤è¯†å®¢æˆ·ç«¯</p><h6 id="Cookieç”±æµè§ˆå™¨ç»´æŠ¤ï¼Œå¸¸è§å­˜å‚¨æ–¹å¼ï¼š"><a href="#Cookieç”±æµè§ˆå™¨ç»´æŠ¤ï¼Œå¸¸è§å­˜å‚¨æ–¹å¼ï¼š" class="headerlink" title="Cookieç”±æµè§ˆå™¨ç»´æŠ¤ï¼Œå¸¸è§å­˜å‚¨æ–¹å¼ï¼š"></a>Cookieç”±æµè§ˆå™¨ç»´æŠ¤ï¼Œå¸¸è§å­˜å‚¨æ–¹å¼ï¼š</h6><ul><li>å†…å­˜å­˜å‚¨â€”â€”éæŒä¹…åŒ–å­˜å‚¨</li><li>ç£ç›˜å­˜å‚¨â€”â€”æŒä¹…åŒ–å­˜å‚¨</li></ul><p>æœåŠ¡å™¨å‘é€Set-Cookieå‘½ä»¤ï¼Œå®¢æˆ·ç«¯æŒ‰è¦æ±‚åˆ›å»ºCookieï¼Œä¹‹åæ¯æ¬¡è®¿é—®è¯¥æœåŠ¡å™¨éƒ½æºå¸¦Cookieä¿¡æ¯ï¼Œä»¥ä¾¿äºè®©æœåŠ¡å™¨è¾¨è¯†ã€‚</p><h6 id="ä½¿ç”¨åœºæ™¯ï¼š"><a href="#ä½¿ç”¨åœºæ™¯ï¼š" class="headerlink" title="ä½¿ç”¨åœºæ™¯ï¼š"></a>ä½¿ç”¨åœºæ™¯ï¼š</h6><ul><li>ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ã€æ¸¸æˆåˆ†æ•°æˆ–å…¶å®ƒéœ€è¦è®°å½•çš„ä¿¡æ¯ï¼‰</li><li>ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå¦‚ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®ã€ä¸»é¢˜ç­‰ï¼‰</li><li>æµè§ˆå™¨è¡Œä¸ºè·Ÿè¸ªï¼ˆå¦‚è·Ÿè¸ªåˆ†æç”¨æˆ·è¡Œä¸ºç­‰ï¼‰</li></ul><h6 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h6><p>â€‹Cookieä¸­ä¿¡æ¯ä¸ºæ˜æ–‡ï¼Œå®¹æ˜“äº§ç”Ÿå®‰å…¨é—®é¢˜ã€‚</p><h5 id="Session"><a href="#Session" class="headerlink" title="Session:"></a>Session:</h5><p>â€‹Sessionæœºåˆ¶å°†ç”¨æˆ·çš„æ‰€æœ‰æ´»åŠ¨ä¿¡æ¯ã€ä¸Šä¸‹æ–‡ä¿¡æ¯ã€ç™»å½•<strong>ä¿¡æ¯ç­‰éƒ½å­˜å‚¨åœ¨æœåŠ¡ç«¯</strong>ï¼Œåªæ˜¯<u>ç”Ÿæˆä¸€ä¸ªå”¯ä¸€æ ‡è¯†IDå‘é€ç»™å®¢æˆ·ç«¯ï¼Œåç»­çš„äº¤äº’å°†æ²¡æœ‰é‡å¤çš„ç”¨æˆ·ä¿¡æ¯ä¼ è¾“ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å”¯ä¸€æ ‡è¯†ID</u>ï¼Œæš‚ä¸”ç§°ä¹‹ä¸ºSession-IDå§ã€‚</p><p>â€‹å½“æµè§ˆå™¨ä¸‹æ¬¡è¯·æ±‚åˆ«çš„èµ„æºçš„æ—¶å€™ï¼Œ<u>æµè§ˆå™¨ä¼šå°†sessionIDæ”¾ç½®åˆ°è¯·æ±‚å¤´ä¸­ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åè§£æå¾—åˆ°sessionIDï¼ŒæœåŠ¡å™¨æ‰¾åˆ°è¯¥idçš„sessionæ¥ç¡®å®šè¯·æ±‚æ–¹çš„èº«ä»½å’Œä¸€äº›ä¸Šä¸‹æ–‡ä¿¡æ¯</u>ã€‚</p><p>â€‹è¿™ä¸ªsessionIDå¯ä»¥æ”¾åœ¨Cookieä¸­ä¼ è¾“ï¼ŒSessionä¸Cookieä¹‹é—´çš„å…³ç³»ä»…æ­¤è€Œå·²ã€‚</p><p>â€‹<strong>å¦‚æœæµè§ˆå™¨è¢«ç¦ç”¨äº†Cookie</strong>ï¼ŒæœåŠ¡ç«¯è¿˜å¯ä»¥ç›´æ¥å°†sessionIDé™„åŠ åœ¨URLå<u>ä½œä¸ºå‚æ•°ä¼ è¾“</u>ã€‚â€”-<strong>URLé‡å†™</strong></p><h6 id="ç¼ºç‚¹ï¼š-1"><a href="#ç¼ºç‚¹ï¼š-1" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h6><ul><li>æµ·é‡ç”¨æˆ·çš„å·¨å¤§å­˜å‚¨å‹åŠ›</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¿¡æ¯å…±äº«é—®é¢˜</li><li>æ¯ä¸ªç”¨æˆ·çš„ä¿¡æ¯å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œä¸å¯é¿å…å­˜åœ¨ä¸€äº› åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¸¸è§çš„é—®é¢˜</li></ul><h5 id="Token"><a href="#Token" class="headerlink" title="Token:"></a>Token:</h5><p>â€‹Tokenæ˜¯ä»¤ç‰Œçš„æ„æ€ï¼Œç”±æœåŠ¡ç«¯ç”Ÿæˆå¹¶å‘æ”¾ç»™å®¢æˆ·ç«¯ï¼Œæ˜¯å…·æœ‰æ—¶æ•ˆæ€§çš„ä¸€ç§éªŒè¯èº«ä»½çš„æ‰‹æ®µã€‚</p><p>Tokené¿å…äº†Sessionæœºåˆ¶å¸¦æ¥çš„æµ·é‡ä¿¡æ¯å­˜å‚¨é—®é¢˜ï¼Œä¹Ÿé¿å…äº†Cookieæœºåˆ¶çš„ä¸€äº›å®‰å…¨æ€§é—®é¢˜ï¼Œå±äºå…¸å‹çš„æ—¶é—´æ¢ç©ºé—´çš„æ€è·¯ã€‚åœ¨ç°ä»£ç§»åŠ¨äº’è”ç½‘åœºæ™¯ã€è·¨åŸŸè®¿é—®ç­‰åœºæ™¯æœ‰å¹¿æ³›çš„ç”¨é€”ã€‚</p><p>â€‹å¸¸ä½¿ç”¨ **JWT ** (<strong>JSON Web Token</strong>)</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231007152733214.png" alt="image-20231007152733214"></p><h6 id="Tokenè®¾è®¡ï¼š"><a href="#Tokenè®¾è®¡ï¼š" class="headerlink" title="Tokenè®¾è®¡ï¼š"></a>Tokenè®¾è®¡ï¼š</h6><p>â€‹<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231007153219035.png" alt="image-20231007153219035"></p><ul><li>Headerï¼š<ul><li>ä»¤ç‰Œå¤´ï¼šå­˜æ”¾ä»¤ç‰Œç±»å‹ã€ä½¿ç”¨çš„ç­¾å(åŠ å¯†)ç®—æ³•</li></ul></li><li>Payloadï¼š<ul><li>è´Ÿè½½ï¼šå­˜æ”¾çœŸæ­£éœ€è¦å‘æœåŠ¡ç«¯ä¼ é€’çš„ä¿¡æ¯â€”â€”ï¼ˆé’ˆå¯¹è®¤è¯é—®é¢˜ï¼Œè´Ÿè½½è‡³å°‘åº”è¯¥åŒ…å«èƒ½å¤Ÿå‘ŠçŸ¥æœåŠ¡ç«¯â€œè¿™ä¸ªç”¨æˆ·æ˜¯è°â€çš„ä¿¡æ¯ï¼Œé’ˆå¯¹æˆæƒé—®é¢˜ï¼Œä»¤ç‰Œè‡³å°‘åº”è¯¥åŒ…å«èƒ½å¤Ÿå‘ŠçŸ¥æœåŠ¡ç«¯â€œè¿™ä¸ªç”¨æˆ·æ‹¥æœ‰ä»€ä¹ˆè§’è‰²&#x2F;æƒé™â€çš„ä¿¡æ¯ã€‚ï¼‰<ul><li>issï¼ˆIssuerï¼‰ï¼šç­¾å‘äººã€‚</li><li>expï¼ˆExpiration Timeï¼‰ï¼šä»¤ç‰Œè¿‡æœŸæ—¶é—´ã€‚</li><li>subï¼ˆSubjectï¼‰ï¼šä¸»é¢˜ã€‚</li><li>aud ï¼ˆAudienceï¼‰ï¼šä»¤ç‰Œå—ä¼—ã€‚</li><li>nbf ï¼ˆNot Beforeï¼‰ï¼šä»¤ç‰Œç”Ÿæ•ˆæ—¶é—´ã€‚</li><li>iat ï¼ˆIssued Atï¼‰ï¼šä»¤ç‰Œç­¾å‘æ—¶é—´ã€‚</li><li>jti ï¼ˆJWT IDï¼‰ï¼šä»¤ç‰Œç¼–å·ã€‚</li><li>è¿˜å¯ä»¥æ”¾ä¸€äº›è‡ªå®šä¹‰ä¿¡æ¯</li><li>âš ï¸JWT é»˜è®¤æ˜¯ä¸åŠ å¯†çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥è¯»åˆ°ï¼Œæ‰€ä»¥ä¸è¦æŠŠç§˜å¯†ä¿¡æ¯æ”¾åœ¨è¿™ä¸ªéƒ¨åˆ†</li></ul></li></ul></li><li><strong>Signature</strong>ï¼š<ul><li>ç­¾åï¼šå¯¹ä¸Šè¿°çš„ (Headerä»¥åŠPayload) æ ¹æ®headerä¸­æŒ‡å®šçš„ç­¾åç®—æ³• ä¸å¯†é’¥è¿›è¡Œç­¾åè¿ç®—å¾—åˆ°çš„ç»“æœã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> + base64UrlEncode(payload) , secret)</span><br><span class="line"><span class="comment">//HMACSHA256ä¸ºä¸€ç§ç­¾åç®—æ³•</span></span><br></pre></td></tr></table></figure><p>headerå’Œpayloadçš„ä¿¡æ¯ä¸åšåŠ å¯†ï¼Œåªåšä¸€èˆ¬çš„base64ç¼–ç </p><p><strong>å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨</strong>ï¼šæœªæºå¸¦Tokenï¼ŒæœåŠ¡ç«¯æ ¹æ®å®¢æˆ·ç«¯ä¼ æ¥çš„ä¿¡æ¯è¿›è¡Œèº«ä»½è®¤è¯ï¼Œè‹¥éªŒè¯æˆåŠŸï¼Œåˆ™ç”ŸæˆTokenå‘å›ç»™ç”¨æˆ·ä½¿ç”¨ã€‚</p><p><strong>å®¢æˆ·ç«¯æºå¸¦Tokenåè¯·æ±‚æœåŠ¡å™¨</strong>ï¼šæœåŠ¡ç«¯æ”¶åˆ°tokenåå‰¥ç¦»å‡ºheaderå’Œpayloadè·å–ç®—æ³•ã€ç”¨æˆ·ã€è¿‡æœŸæ—¶é—´ç­‰ä¿¡æ¯ï¼Œç„¶åæ ¹æ®è‡ªå·±çš„åŠ å¯†å¯†é’¥æ¥ç”Ÿæˆsignatureï¼Œå¹¶ä¸å®¢æˆ·ç«¯çš„signè¿›è¡Œä¸€è‡´æ€§éªŒè¯ã€‚</p><p>è¿™æ ·å°±å®ç°äº†ç”¨CPUåŠ è§£å¯†çš„æ—¶é—´æ¢å–å­˜å‚¨ç©ºé—´ï¼Œå¹²å‡€åˆ©è½ï¼ŒåŒæ—¶<strong>æœåŠ¡ç«¯å¯†é’¥</strong>çš„é‡è¦æ€§å°±æ˜¾è€Œæ˜“è§ï¼Œä¸€æ—¦æ³„éœ²æ•´ä¸ªæœºåˆ¶å°±å´©å¡Œäº†ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦è€ƒè™‘HTTPSäº†ã€‚</p><h6 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h6><ul><li>Tokenå¯ä»¥è·¨ç«™å…±äº«ï¼Œå®ç°å•ç‚¹ç™»å½•</li><li>Tokenæœºåˆ¶æ— éœ€å¤ªå¤šå­˜å‚¨ç©ºé—´ï¼ŒTokenåŒ…å«äº†ç”¨æˆ·çš„ä¿¡æ¯ï¼Œåªéœ€åœ¨å®¢æˆ·ç«¯å­˜å‚¨çŠ¶æ€ä¿¡æ¯å³å¯ï¼Œå¯¹äºæœåŠ¡ç«¯çš„æ‰©å±•æ€§å¾ˆå¥½</li><li>Tokenæœºåˆ¶çš„å®‰å…¨æ€§ä¾èµ–äºæœåŠ¡ç«¯åŠ å¯†ç®—æ³•å’Œå¯†é’¥çš„å®‰å…¨æ€§</li></ul><h6 id="ç¼ºç‚¹ï¼š-2"><a href="#ç¼ºç‚¹ï¼š-2" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h6><ul><li>å®‰å…¨æ€§éšæ‚£ï¼šå¦‚æœTokenè¢«æ³„éœ²æˆ–è€…è¢«åŠ«æŒï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåˆ©ç”¨Tokenæ¥å†’å……ç”¨æˆ·æˆ–è€…è¿›è¡Œéæ³•æ“ä½œã€‚ä¸ºäº†å‡å°‘è¿™ç§é£é™©ï¼Œéœ€è¦é‡‡å–é€‚å½“çš„åŠ å¯†å’Œä¿æŠ¤æªæ–½ï¼Œä¾‹å¦‚ä½¿ç”¨HTTPSè¿›è¡Œé€šä¿¡ä»¥åŠä½¿ç”¨å®‰å…¨çš„Tokenå­˜å‚¨å’Œä¼ è¾“æ–¹å¼ã€‚</li><li><strong>éš¾ä»¥æ’¤é”€å’Œå¤±æ•ˆ</strong>ï¼šä¸€æ—¦Tokenè¢«é¢å‘ï¼Œé™¤éè¿‡æœŸæ—¶é—´åˆ°æœŸæˆ–è€…æ‰‹åŠ¨æ’¤é”€ï¼Œå¦åˆ™Tokenå°†ä¸€ç›´æœ‰æ•ˆã€‚è¿™å¯èƒ½å¯¼è‡´ä¸€äº›å®‰å…¨é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨Tokenè¢«å·çªƒæˆ–è€…ç”¨æˆ·æƒé™éœ€è¦ç«‹å³æ’¤é”€çš„æƒ…å†µä¸‹ã€‚</li><li>éš¾ä»¥ç®¡ç†å’Œç»´æŠ¤ï¼šåœ¨å¤§è§„æ¨¡ç³»ç»Ÿä¸­ï¼Œéœ€è¦å¯¹å¤§é‡çš„Tokenè¿›è¡Œç®¡ç†å’Œç»´æŠ¤ã€‚è¿™å¯èƒ½åŒ…æ‹¬Tokené¢å‘ã€æ’¤é”€å’Œæ›´æ–°ç­‰æ“ä½œï¼Œéœ€è¦æŠ•å…¥ç›¸åº”çš„èµ„æºå’Œå·¥å…·è¿›è¡Œç®¡ç†ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚</li><li>æ€§èƒ½é—®é¢˜ï¼šTokenéªŒè¯å¯èƒ½éœ€è¦è¿›è¡Œå¯†é’¥è§£å¯†ã€ç­¾åéªŒè¯å’ŒçŠ¶æ€æ£€æŸ¥ç­‰æ“ä½œï¼Œè¿™äº›æ“ä½œå¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„è´Ÿè½½å¹¶ä¸”æ¶ˆè€—ä¸€å®šçš„è®¡ç®—èµ„æºã€‚ç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿä¸€å®šå½±å“ã€‚</li></ul><h5 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h5><p>â€‹Sessionæ–¹å¼å°†ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯å­˜æ”¾äºæœåŠ¡ç«¯æ•°æ®åº“ä¸­ï¼Œä¸å¯é¿å…ä¼šå¸¦æ¥åˆ†å¸ƒå¼é—®é¢˜ï¼Œè€ŒTokené€šè¿‡æœåŠ¡å™¨ä½¿ç”¨è‡ªå·±ç§æœ‰çš„å¯†é’¥æ¥å¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡ŒåŠ å¯†ç”ŸæˆTokenç»™å®¢æˆ·ç«¯ï¼Œé€šè¿‡å¯¹å®¢æˆ·ç«¯å‘æ¥çš„Tokenè¿›è¡Œå†æ¬¡è¿ç®—(æ£€æŸ¥æ”¶åˆ°çš„å’Œç®—å‡ºçš„ç­¾åæ˜¯å¦ä¸€è‡´)æ¥åˆ¤æ–­è¯¥Tokenæ˜¯å¦æœ‰æ•ˆï¼Œå³ç”¨æˆ·æ˜¯å¦æœ‰æƒé™ï¼Œé¿å…äº†ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®åº“ã€‚</p><h4 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS:"></a>HTTPS:</h4><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://xiaolincoding.com/network/2_http/https_rsa.html#_3-3-https-rsa-%E6%8F%A1%E6%89%8B%E8%A7%A3%E6%9E%90">HTTPS RSA æ¡æ‰‹è§£æ</a></li></ul><p>â€‹ç”±äºHTTPåè®®åœ¨ä¼ è¾“ä¿¡æ¯æ—¶æœ‰ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼š<u>æ•°æ®é­å—ç›‘å¬</u>ã€<u>æ•°æ®æ˜“è¢«ç¯¡æ”¹</u>ã€<u>æ˜“è¢«å†’å……</u></p><p>æ‰€ä»¥å¯ä»¥åœ¨HTTPä¸TCPä¹‹é—´åŠ å…¥TLSåè®®ï¼Œæ¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚HTTPS &#x3D; æœ‰TLSä¿éšœçš„HTTP</p><h5 id="TLS-åè®®æ˜¯å¦‚ä½•è§£å†³-HTTP-çš„é£é™©çš„å‘¢ï¼Ÿ"><a href="#TLS-åè®®æ˜¯å¦‚ä½•è§£å†³-HTTP-çš„é£é™©çš„å‘¢ï¼Ÿ" class="headerlink" title="TLS åè®®æ˜¯å¦‚ä½•è§£å†³ HTTP çš„é£é™©çš„å‘¢ï¼Ÿ"></a>TLS åè®®æ˜¯å¦‚ä½•è§£å†³ HTTP çš„é£é™©çš„å‘¢ï¼Ÿ</h5><ul><li><em>ä¿¡æ¯åŠ å¯†</em>ï¼š HTTP äº¤äº’ä¿¡æ¯æ˜¯è¢«åŠ å¯†çš„ï¼Œç¬¬ä¸‰æ–¹å°±æ— æ³•è¢«çªƒå–ï¼›</li><li><em>æ ¡éªŒæœºåˆ¶</em>ï¼šæ ¡éªŒä¿¡æ¯ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰è¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹è¿‡ï¼Œå¦‚æœè¢«ç¯¡æ”¹è¿‡ï¼Œåˆ™ä¼šæœ‰è­¦å‘Šæç¤ºï¼›</li><li><em>èº«ä»½è¯ä¹¦</em>ï¼šè¯æ˜æ·˜å®æ˜¯çœŸçš„æ·˜å®ç½‘ï¼›</li></ul><p>TLSåè®®ä¸€èˆ¬ä½¿ç”¨RSAç®—æ³•å®ç°å¯†é’¥äº¤æ¢ï¼Œç®€è€Œè¨€ä¹‹ï¼š</p><p>â€‹å®¢æˆ·ç«¯ä¼šç”Ÿæˆéšæœºå¯†é’¥ï¼Œå¹¶ä½¿ç”¨æœåŠ¡ç«¯çš„å…¬é’¥åŠ å¯†åå†ä¼ ç»™æœåŠ¡ç«¯ã€‚æ ¹æ®éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå…¬é’¥åŠ å¯†çš„æ¶ˆæ¯ä»…èƒ½é€šè¿‡ç§é’¥è§£å¯†ï¼Œè¿™æ ·æœåŠ¡ç«¯è§£å¯†åï¼ŒåŒæ–¹å°±å¾—åˆ°äº†ç›¸åŒçš„å¯†é’¥ï¼Œå†ç”¨å®ƒåŠ å¯†åº”ç”¨æ¶ˆæ¯ã€‚</p><h5 id="å…·ä½“æµç¨‹å›¾ç¤ºğŸŒŸï¼š"><a href="#å…·ä½“æµç¨‹å›¾ç¤ºğŸŒŸï¼š" class="headerlink" title="å…·ä½“æµç¨‹å›¾ç¤ºğŸŒŸï¼š"></a>å…·ä½“æµç¨‹å›¾ç¤ºğŸŒŸï¼š</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231009150718081.png" alt="image-20231009150718081"></p><p>pre-master : å®¢æˆ·ç«¯å¯†é’¥</p><h5 id="ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦ï¼Œè¯ä¹¦ä¸­æœ‰ä»€ä¹ˆï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦ï¼Œè¯ä¹¦ä¸­æœ‰ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦ï¼Œè¯ä¹¦ä¸­æœ‰ä»€ä¹ˆï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦ï¼Œè¯ä¹¦ä¸­æœ‰ä»€ä¹ˆï¼Ÿ</h5><ul><li>å…¬é’¥ï¼›</li><li>æŒæœ‰è€…ä¿¡æ¯ï¼›</li><li>è¯ä¹¦è®¤è¯æœºæ„ï¼ˆCAï¼‰çš„ä¿¡æ¯ï¼›</li><li>CA å¯¹è¿™ä»½æ–‡ä»¶çš„æ•°å­—ç­¾ååŠä½¿ç”¨çš„ç®—æ³•ï¼›</li><li>è¯ä¹¦æœ‰æ•ˆæœŸï¼›</li><li>è¿˜æœ‰ä¸€äº›å…¶ä»–é¢å¤–ä¿¡æ¯ï¼›</li></ul><p>â€‹æ•°å­—è¯ä¹¦çš„ä½œç”¨ï¼Œæ˜¯ç”¨æ¥è®¤è¯å…¬é’¥æŒæœ‰è€…çš„èº«ä»½ï¼Œä»¥é˜²æ­¢ç¬¬ä¸‰æ–¹è¿›è¡Œå†’å……ã€‚è¯´ç®€å•äº›ï¼Œè¯ä¹¦å°±æ˜¯ç”¨æ¥å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œè¯¥æœåŠ¡ç«¯æ˜¯å¦æ˜¯åˆæ³•çš„ï¼Œå› ä¸ºåªæœ‰è¯ä¹¦åˆæ³•ï¼Œæ‰ä»£è¡¨æœåŠ¡ç«¯èº«ä»½æ˜¯å¯ä¿¡çš„ã€‚</p><h4 id="HTTPç‰ˆæœ¬ï¼š"><a href="#HTTPç‰ˆæœ¬ï¼š" class="headerlink" title="HTTPç‰ˆæœ¬ï¼š"></a>HTTPç‰ˆæœ¬ï¼š</h4><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://xiaolincoding.com/network/2_http/http2.html#_3-6-http-2-%E7%89%9B%E9%80%BC%E5%9C%A8%E5%93%AA">http-2-ç‰›é€¼åœ¨å“ª</a></li><li><a href="https://xiaolincoding.com/network/2_http/http3.html#_3-7-http-3-%E5%BC%BA%E5%8A%BF%E6%9D%A5%E8%A2%AD">http-3-å¼ºåŠ¿æ¥è¢­</a></li></ul><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231018151006871.png" alt="image-20231018151006871"></p><h5 id="HTTP2"><a href="#HTTP2" class="headerlink" title="HTTP2:"></a>HTTP2:</h5><ul><li>ç¬¬ä¸€ç‚¹ï¼Œå¯¹äºå¸¸è§çš„ HTTP å¤´éƒ¨é€šè¿‡<strong>é™æ€è¡¨å’Œ Huffman ç¼–ç </strong>çš„æ–¹å¼ï¼Œå°†ä½“ç§¯å‹ç¼©äº†è¿‘ä¸€åŠï¼Œè€Œä¸”é’ˆå¯¹åç»­çš„è¯·æ±‚å¤´éƒ¨ï¼Œè¿˜å¯ä»¥å»ºç«‹<strong>åŠ¨æ€è¡¨</strong>ï¼Œå°†ä½“ç§¯å‹ç¼©è¿‘ 90%ï¼Œå¤§å¤§æé«˜äº†ç¼–ç æ•ˆç‡ï¼ŒåŒæ—¶èŠ‚çº¦äº†å¸¦å®½èµ„æºã€‚</li></ul><p>â€‹ä¸è¿‡ï¼ŒåŠ¨æ€è¡¨å¹¶éå¯ä»¥æ— é™å¢å¤§ï¼Œ å› ä¸ºåŠ¨æ€è¡¨æ˜¯ä¼šå ç”¨å†…å­˜çš„ï¼ŒåŠ¨æ€è¡¨è¶Šå¤§ï¼Œå†…å­˜ä¹Ÿè¶Šå¤§ï¼Œå®¹æ˜“å½±å“æœåŠ¡å™¨æ€»ä½“çš„å¹¶å‘èƒ½åŠ›ï¼Œå› æ­¤æœåŠ¡å™¨éœ€è¦é™åˆ¶ HTTP&#x2F;2 è¿æ¥æ—¶é•¿æˆ–è€…è¯·æ±‚æ¬¡æ•°ã€‚</p><ul><li>ç¬¬äºŒç‚¹ï¼Œ<strong>HTTP&#x2F;2 å®ç°äº† Stream å¹¶å‘</strong>ï¼Œå¤šä¸ª Stream åªéœ€å¤ç”¨ 1 ä¸ª TCP è¿æ¥ï¼ŒèŠ‚çº¦äº† TCP å’Œ TLS æ¡æ‰‹æ—¶é—´ï¼Œä»¥åŠå‡å°‘äº† TCP æ…¢å¯åŠ¨é˜¶æ®µå¯¹æµé‡çš„å½±å“ã€‚ä¸åŒçš„ Stream ID å¯ä»¥å¹¶å‘ï¼Œå³ä½¿ä¹±åºå‘é€å¸§ä¹Ÿæ²¡é—®é¢˜ï¼Œæ¯”å¦‚å‘é€ A è¯·æ±‚å¸§ 1 -&gt; B è¯·æ±‚å¸§ 1 -&gt; A è¯·æ±‚å¸§ 2 -&gt; B è¯·æ±‚å¸§2ï¼Œä½†æ˜¯åŒä¸€ä¸ª Stream é‡Œçš„å¸§å¿…é¡»ä¸¥æ ¼æœ‰åºã€‚</li></ul><p>â€‹å¦å¤–ï¼Œå¯ä»¥æ ¹æ®èµ„æºçš„æ¸²æŸ“é¡ºåºæ¥è®¾ç½® Stream çš„<strong>ä¼˜å…ˆçº§</strong>ï¼Œä»è€Œæé«˜ç”¨æˆ·ä½“éªŒã€‚</p><ul><li>ç¬¬ä¸‰ç‚¹ï¼Œ<strong>æœåŠ¡å™¨æ”¯æŒä¸»åŠ¨æ¨é€èµ„æº</strong>ï¼Œå¤§å¤§æå‡äº†æ¶ˆæ¯çš„ä¼ è¾“æ€§èƒ½ï¼ŒæœåŠ¡å™¨æ¨é€èµ„æºæ—¶ï¼Œä¼šå…ˆå‘é€ PUSH_PROMISE å¸§ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯æ¥ä¸‹æ¥åœ¨å“ªä¸ª Stream å‘é€èµ„æºï¼Œç„¶åç”¨å¶æ•°å· Stream å‘é€èµ„æºç»™å®¢æˆ·ç«¯ã€‚</li></ul><p>â€‹HTTP&#x2F;2 é€šè¿‡ Stream çš„å¹¶å‘èƒ½åŠ›ï¼Œè§£å†³äº† HTTP&#x2F;1 é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ï¼Œçœ‹ä¼¼å¾ˆå®Œç¾äº†ï¼Œä½†æ˜¯ HTTP&#x2F;2 è¿˜æ˜¯å­˜åœ¨â€œé˜Ÿå¤´é˜»å¡â€çš„é—®é¢˜ï¼Œåªä¸è¿‡é—®é¢˜ä¸æ˜¯åœ¨ HTTP è¿™ä¸€å±‚é¢ï¼Œè€Œæ˜¯åœ¨ TCP è¿™ä¸€å±‚ã€‚</p><p>â€‹<strong>HTTP&#x2F;2 æ˜¯åŸºäº TCP åè®®æ¥ä¼ è¾“æ•°æ®çš„ï¼ŒTCP æ˜¯å­—èŠ‚æµåè®®ï¼ŒTCP å±‚å¿…é¡»ä¿è¯æ”¶åˆ°çš„å­—èŠ‚æ•°æ®æ˜¯å®Œæ•´ä¸”è¿ç»­çš„ï¼Œè¿™æ ·å†…æ ¸æ‰ä¼šå°†ç¼“å†²åŒºé‡Œçš„æ•°æ®è¿”å›ç»™ HTTP åº”ç”¨ï¼Œé‚£ä¹ˆå½“ã€Œå‰ 1 ä¸ªå­—èŠ‚æ•°æ®ã€æ²¡æœ‰åˆ°è¾¾æ—¶ï¼Œåæ”¶åˆ°çš„å­—èŠ‚æ•°æ®åªèƒ½å­˜æ”¾åœ¨å†…æ ¸ç¼“å†²åŒºé‡Œï¼Œåªæœ‰ç­‰åˆ°è¿™ 1 ä¸ªå­—èŠ‚æ•°æ®åˆ°è¾¾æ—¶ï¼ŒHTTP&#x2F;2 åº”ç”¨å±‚æ‰èƒ½ä»å†…æ ¸ä¸­æ‹¿åˆ°æ•°æ®ï¼Œè¿™å°±æ˜¯ HTTP&#x2F;2 é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚</strong></p><p>â€‹</p><h5 id="HTTP-x2F-3ï¼š"><a href="#HTTP-x2F-3ï¼š" class="headerlink" title="HTTP&#x2F;3ï¼š"></a>HTTP&#x2F;3ï¼š</h5><p>HTTP&#x2F;2 è™½ç„¶å…·æœ‰å¤šä¸ªæµå¹¶å‘ä¼ è¾“çš„èƒ½åŠ›ï¼Œä½†æ˜¯ä¼ è¾“å±‚æ˜¯ TCP åè®®ï¼Œäºæ˜¯å­˜åœ¨ä»¥ä¸‹ç¼ºé™·ï¼š</p><ul><li><strong>é˜Ÿå¤´é˜»å¡</strong>ï¼ŒHTTP&#x2F;2 å¤šä¸ªè¯·æ±‚è·‘åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸­ï¼Œå¦‚æœåºåˆ—å·è¾ƒä½çš„ TCP æ®µåœ¨ç½‘ç»œä¼ è¾“ä¸­ä¸¢å¤±äº†ï¼Œå³ä½¿åºåˆ—å·è¾ƒé«˜çš„ TCP æ®µå·²ç»è¢«æ¥æ”¶äº†ï¼Œåº”ç”¨å±‚ä¹Ÿæ— æ³•ä»å†…æ ¸ä¸­è¯»å–åˆ°è¿™éƒ¨åˆ†æ•°æ®ï¼Œä» HTTP è§†è§’çœ‹ï¼Œå°±æ˜¯å¤šä¸ªè¯·æ±‚è¢«é˜»å¡äº†ï¼›</li><li><strong>TCP å’Œ TLS æ¡æ‰‹æ—¶å»¶</strong>ï¼ŒTCP ä¸‰æ¬¡æ¡æ‰‹å’Œ TLS å››æ¬¡æ¡æ‰‹ï¼Œå…±æœ‰ 3-RTT çš„æ—¶å»¶ï¼›</li><li><strong>è¿æ¥è¿ç§»éœ€è¦é‡æ–°è¿æ¥</strong>ï¼Œç§»åŠ¨è®¾å¤‡ä» 4G ç½‘ç»œç¯å¢ƒåˆ‡æ¢åˆ° WiFi æ—¶ï¼Œç”±äº TCP æ˜¯åŸºäºå››å…ƒç»„æ¥ç¡®è®¤ä¸€æ¡ TCP è¿æ¥çš„ï¼Œé‚£ä¹ˆç½‘ç»œç¯å¢ƒå˜åŒ–åï¼Œå°±ä¼šå¯¼è‡´ IP åœ°å€æˆ–ç«¯å£å˜åŒ–ï¼Œäºæ˜¯ TCP åªèƒ½æ–­å¼€è¿æ¥ï¼Œç„¶åå†é‡æ–°å»ºç«‹è¿æ¥ï¼Œåˆ‡æ¢ç½‘ç»œç¯å¢ƒçš„æˆæœ¬é«˜ï¼›</li></ul><p>HTTP&#x2F;3 å°±å°†ä¼ è¾“å±‚ä» TCP æ›¿æ¢æˆäº† UDPï¼Œå¹¶åœ¨ UDP åè®®ä¸Šå¼€å‘äº† QUIC åè®®ï¼Œæ¥ä¿è¯æ•°æ®çš„å¯é ä¼ è¾“ã€‚</p><p>QUIC åè®®çš„ç‰¹ç‚¹ï¼š</p><ul><li><strong>æ— é˜Ÿå¤´é˜»å¡</strong>ï¼ŒQUIC è¿æ¥ä¸Šçš„å¤šä¸ª Stream ä¹‹é—´å¹¶æ²¡æœ‰ä¾èµ–ï¼Œéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¹Ÿä¸ä¼šæœ‰åº•å±‚åè®®é™åˆ¶ï¼ŒæŸä¸ªæµå‘ç”Ÿä¸¢åŒ…äº†ï¼Œåªä¼šå½±å“è¯¥æµï¼Œå…¶ä»–æµä¸å—å½±å“ï¼›</li><li><strong>å»ºç«‹è¿æ¥é€Ÿåº¦å¿«</strong>ï¼Œå› ä¸º QUIC å†…éƒ¨åŒ…å« TLS 1.3ï¼Œå› æ­¤ä»…éœ€ 1 ä¸ª RTT å°±å¯ä»¥ã€ŒåŒæ—¶ã€å®Œæˆå»ºç«‹è¿æ¥ä¸ TLS å¯†é’¥åå•†ï¼Œç”šè‡³åœ¨ç¬¬äºŒæ¬¡è¿æ¥çš„æ—¶å€™ï¼Œåº”ç”¨æ•°æ®åŒ…å¯ä»¥å’Œ QUIC æ¡æ‰‹ä¿¡æ¯ï¼ˆè¿æ¥ä¿¡æ¯ + TLS ä¿¡æ¯ï¼‰ä¸€èµ·å‘é€ï¼Œè¾¾åˆ° 0-RTT çš„æ•ˆæœã€‚</li><li><strong>è¿æ¥è¿ç§»</strong>ï¼ŒQUIC åè®®æ²¡æœ‰ç”¨å››å…ƒç»„çš„æ–¹å¼æ¥â€œç»‘å®šâ€è¿æ¥ï¼Œè€Œæ˜¯é€šè¿‡ã€Œè¿æ¥ ID ã€æ¥æ ‡è®°é€šä¿¡çš„ä¸¤ä¸ªç«¯ç‚¹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥å„è‡ªé€‰æ‹©ä¸€ç»„ ID æ¥æ ‡è®°è‡ªå·±ï¼Œå› æ­¤å³ä½¿ç§»åŠ¨è®¾å¤‡çš„ç½‘ç»œå˜åŒ–åï¼Œå¯¼è‡´ IP åœ°å€å˜åŒ–äº†ï¼Œåªè¦ä»ä¿æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆæ¯”å¦‚è¿æ¥ IDã€TLS å¯†é’¥ç­‰ï¼‰ï¼Œå°±å¯ä»¥â€œæ— ç¼â€åœ°å¤ç”¨åŸè¿æ¥ï¼Œæ¶ˆé™¤é‡è¿çš„æˆæœ¬ï¼›</li></ul><h3 id="DNSåè®®ï¼š"><a href="#DNSåè®®ï¼š" class="headerlink" title="DNSåè®®ï¼š"></a>DNSåè®®ï¼š</h3><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E9%80%8F%E8%A7%86HTTP%E5%8D%8F%E8%AE%AE/06%20%20%E5%9F%9F%E5%90%8D%E9%87%8C%E6%9C%89%E5%93%AA%E4%BA%9B%E9%97%A8%E9%81%93%EF%BC%9F.md">åŸŸåé‡Œæœ‰å“ªäº›é—¨é“ï¼Ÿ</a></li><li><a href="https://juejin.cn/post/7035659937166393375">DNSé¢è¯•ä¹Ÿä¼šé—®ï¼Œèµ¶ç´§æ¥çœ‹çœ‹</a></li></ul><p>â€‹åŸŸå &lt;&#x3D;&#x3D;&#x3D;&gt; ipåœ°å€çš„æ˜ å°„è¡¨</p><h4 id="åŸŸåæœåŠ¡å™¨çš„å±‚çº§ï¼š"><a href="#åŸŸåæœåŠ¡å™¨çš„å±‚çº§ï¼š" class="headerlink" title="åŸŸåæœåŠ¡å™¨çš„å±‚çº§ï¼š"></a>åŸŸåæœåŠ¡å™¨çš„å±‚çº§ï¼š</h4><h5 id="æ ¹åŸŸåæœåŠ¡å™¨ï¼ˆRoot-DNS-Serverï¼‰ï¼š"><a href="#æ ¹åŸŸåæœåŠ¡å™¨ï¼ˆRoot-DNS-Serverï¼‰ï¼š" class="headerlink" title="æ ¹åŸŸåæœåŠ¡å™¨ï¼ˆRoot DNS Serverï¼‰ï¼š"></a>æ ¹åŸŸåæœåŠ¡å™¨ï¼ˆRoot DNS Serverï¼‰ï¼š</h5><p>â€‹ç®¡ç†é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼Œè¿”å›â€œcomâ€ã€â€œnetâ€ã€â€œcnâ€ç­‰é¡¶çº§åŸŸåæœåŠ¡å™¨çš„ IP åœ°å€ï¼›</p><h5 id="é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼ˆTop-level-DNS-Serverï¼‰ï¼š"><a href="#é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼ˆTop-level-DNS-Serverï¼‰ï¼š" class="headerlink" title="é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼ˆTop-level DNS Serverï¼‰ï¼š"></a>é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼ˆTop-level DNS Serverï¼‰ï¼š</h5><p>â€‹ç®¡ç†å„è‡ªåŸŸåä¸‹çš„æƒå¨åŸŸåæœåŠ¡å™¨ï¼Œæ¯”å¦‚ com é¡¶çº§åŸŸåæœåŠ¡å™¨å¯ä»¥è¿”å› apple.com åŸŸåæœåŠ¡å™¨çš„ IP åœ°å€ï¼›</p><h5 id="æƒå¨åŸŸåæœåŠ¡å™¨ï¼ˆAuthoritative-DNS-Serverï¼‰ï¼š"><a href="#æƒå¨åŸŸåæœåŠ¡å™¨ï¼ˆAuthoritative-DNS-Serverï¼‰ï¼š" class="headerlink" title="æƒå¨åŸŸåæœåŠ¡å™¨ï¼ˆAuthoritative DNS Serverï¼‰ï¼š"></a>æƒå¨åŸŸåæœåŠ¡å™¨ï¼ˆAuthoritative DNS Serverï¼‰ï¼š</h5><p>â€‹ç®¡ç†è‡ªå·±åŸŸåä¸‹ä¸»æœºçš„ IP åœ°å€ï¼Œæ¯”å¦‚ apple.com æƒå¨åŸŸåæœåŠ¡å™¨å¯ä»¥è¿”å› <a href="http://www.apple.com/">www.apple.com</a> çš„ IP åœ°å€ã€‚</p><p>å¯¹äºä¸€æ®µåŸŸåï¼šæœ€å³è¾¹çš„è¢«ç§°ä¸ºâ€œé¡¶çº§åŸŸåâ€ï¼Œç„¶åæ˜¯â€œäºŒçº§åŸŸåâ€ï¼Œå±‚çº§å…³ç³»å‘å·¦ä¾æ¬¡é™ä½ã€‚</p><p>å¦‚æœä½ è¦è®¿é—®â€œ<a href="http://www.apple.comâ€ï¼Œå°±è¦è¿›è¡Œä¸‹é¢çš„ä¸‰æ¬¡æŸ¥è¯¢ï¼š">www.apple.comâ€ï¼Œå°±è¦è¿›è¡Œä¸‹é¢çš„ä¸‰æ¬¡æŸ¥è¯¢ï¼š</a></p><ol><li><p>è®¿é—®æ ¹åŸŸåæœåŠ¡å™¨ï¼Œåœ¨å…¶ä¸­å¯ä»¥æŸ¥è¯¢åˆ°â€œcomâ€é¡¶çº§åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼›</p><ul><li><p>æ‰€æœ‰åŸŸåéƒ½æ˜¯ <code>æ ¹åŸŸå</code> çš„ <code>å­åŸŸå</code>ï¼Œæ ¹åŸŸåä¸º <code>.root</code>ï¼Œä¸€èˆ¬ç®€å†™ä¸º <code>.</code>  ä½†æ˜¯æ‰€æœ‰åŸŸåçš„æ ¹åŸŸåéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½çœç•¥æ ¹åŸŸåä¸å†™ï¼ŒDNSè§£ææ—¶è®¡ç®—æœºä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åŠ ä¸Šæ ¹åŸŸåã€‚</p><p>ä¾‹å¦‚:  <code>www.baidu.com</code> çš„å®Œæ•´åŸŸååº”è¯¥æ˜¯ <code>www.baidu.com.</code> æˆ–è€… <code>www.baidu.com.root</code></p></li></ul></li><li><p>è®¿é—®â€œcomâ€é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼Œå¯ä»¥æŸ¥è¯¢åˆ°â€œapple.comâ€åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼›</p></li><li><p>æœ€åè®¿é—®â€œapple.comâ€åŸŸåæœåŠ¡å™¨ï¼Œå°±å¾—åˆ°äº†â€œ<a href="http://www.apple.comâ€çš„åœ°å€!/">www.apple.comâ€çš„åœ°å€ï¼</a></p></li></ol><ul><li>è®¸å¤šå¤§å…¬å¸ã€ç½‘ç»œè¿è¡Œå•†éƒ½ä¼šå»ºç«‹è‡ªå·±çš„ DNS æœåŠ¡å™¨ï¼Œä½œä¸ºç”¨æˆ· DNS æŸ¥è¯¢çš„ä»£ç†ï¼Œä»£æ›¿ç”¨æˆ·è®¿é—®æ ¸å¿ƒ DNS ç³»ç»Ÿã€‚è¿™äº›â€œé‡ç”Ÿâ€æœåŠ¡å™¨è¢«ç§°ä¸ºâ€œéæƒå¨åŸŸåæœåŠ¡å™¨â€ï¼Œå¯ä»¥ç¼“å­˜ä¹‹å‰çš„æŸ¥è¯¢ç»“æœï¼Œå¦‚æœå·²ç»æœ‰äº†è®°å½•ï¼Œå°±æ— éœ€å†å‘æ ¹æœåŠ¡å™¨å‘èµ·æŸ¥è¯¢ï¼Œç›´æ¥è¿”å›å¯¹åº”çš„ IP åœ°å€ã€‚</li><li>è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¹Ÿä¼šå¯¹DNSæŸ¥è¯¢çš„ç»“æœè¿›è¡Œç¼“å­˜ï¼Œä»¥æå‡æŸ¥è¯¢æ•ˆç‡</li><li>æ“ä½œç³»ç»Ÿé‡Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„â€œä¸»æœºæ˜ å°„â€æ–‡ä»¶ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¯ç¼–è¾‘çš„æ–‡æœ¬ï¼Œåœ¨ Linux é‡Œæ˜¯â€œ&#x2F;etc&#x2F;hostsâ€ï¼Œåœ¨ Windows é‡Œæ˜¯â€œC:\WINDOWS\system32\drivers\etc\hostsâ€ï¼Œå¦‚æœæ“ä½œç³»ç»Ÿåœ¨ç¼“å­˜é‡Œæ‰¾ä¸åˆ° DNS è®°å½•ï¼Œå°±ä¼šæ‰¾è¿™ä¸ªæ–‡ä»¶ã€‚</li></ul><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231116092454845.png" alt="image-20231116092454845" style="zoom:50%;" /><h4 id="åŸŸåçš„åº”ç”¨ï¼š"><a href="#åŸŸåçš„åº”ç”¨ï¼š" class="headerlink" title="åŸŸåçš„åº”ç”¨ï¼š"></a>åŸŸåçš„åº”ç”¨ï¼š</h4><ol><li>â€œé‡å®šå‘â€œï¼Œå¯ç”¨äºç³»ç»Ÿç»´æŠ¤æ—¶åˆ‡æ¢ipï¼Œè®©åŒä¸€åŸŸåæŒ‡å‘ä¸åŒçš„ä¸»æœºï¼Œä¿è¯æœåŠ¡çš„è¿ç»­æ€§ã€‚</li><li>ç”¨åŸŸåè¿›è¡Œå¼€å‘ï¼Œå„ç§æœåŠ¡çš„ipä¸ç”¨å†™æ­»</li><li>è´Ÿè½½å‡è¡¡</li></ol><h4 id="è¿­ä»£æŸ¥è¯¢ï¼š"><a href="#è¿­ä»£æŸ¥è¯¢ï¼š" class="headerlink" title="è¿­ä»£æŸ¥è¯¢ï¼š"></a>è¿­ä»£æŸ¥è¯¢ï¼š</h4><p>è¿­ä»£æŸ¥è¯¢çš„è¿‡ç¨‹å…¶å®å°±æ˜¯ï¼šå½“åŸŸåæœåŠ¡å™¨æ”¶åˆ°è¿­ä»£æŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡æ—¶ï¼Œéœ€æ±‚ç»™å‡ºä¸»æœºâ€œä½ ä¸‹ä¸€æ­¥åº”å½“å‘å“ªä¸€ä¸ªåŸŸåæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢â€çš„å»ºè®®ï¼Œç„¶åç”±ä¸»æœºè¿›è¡Œä¸‹ä¸€æ­¥çš„æŸ¥è¯¢ï¼Œå½“è¿”å›å†…å®¹å³æ²¡æœ‰ç¡®åˆ‡çš„ç»“æœä¹Ÿæ²¡æœ‰ä¸‹ä¸€æ­¥çš„å»ºè®®æ—¶ï¼ŒDNSå¤±è´¥ã€‚</p><h4 id="é€’å½’æŸ¥è¯¢ï¼š"><a href="#é€’å½’æŸ¥è¯¢ï¼š" class="headerlink" title="é€’å½’æŸ¥è¯¢ï¼š"></a>é€’å½’æŸ¥è¯¢ï¼š</h4><p>æ‰€è°“é€’å½’æŸ¥è¯¢å°±æ˜¯ï¼šå¦‚æœä¸»æœºæ‰€è¯¢é—®çš„æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸çŸ¥é“è¢«æŸ¥è¯¢çš„åŸŸåçš„ <code>IPåœ°å€</code>ï¼Œé‚£ä¹ˆæœ¬åœ°åŸŸåæœåŠ¡å™¨å°±ä»¥ <code>DNS</code> å®¢æˆ·çš„èº«ä»½ï¼Œå‘å…¶å®ƒæ ¹åŸŸåæœåŠ¡å™¨ç»§ç»­å‘å‡ºæŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡(å³æ›¿ä¸»æœºç»§ç»­æŸ¥è¯¢)ï¼Œè€Œä¸æ˜¯è®©ä¸»æœºè‡ªå·±è¿›è¡Œä¸‹ä¸€æ­¥æŸ¥è¯¢ã€‚å› æ­¤ï¼Œé€’å½’æŸ¥è¯¢è¿”å›çš„æŸ¥è¯¢ç»“æœæ˜¯æ‰€è¦æŸ¥è¯¢çš„ <code>IPåœ°å€</code> ï¼Œæˆ–è€…æ˜¯æŠ¥é”™ï¼Œè¡¨ç¤ºæ— æ³•æŸ¥è¯¢åˆ°æ‰€éœ€çš„ <code>IPåœ°å€</code>ã€‚</p><h4 id="ğŸŒŸDNSæŸ¥è¯¢çš„å®Œæ•´è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ"><a href="#ğŸŒŸDNSæŸ¥è¯¢çš„å®Œæ•´è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ" class="headerlink" title="ğŸŒŸDNSæŸ¥è¯¢çš„å®Œæ•´è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ"></a>ğŸŒŸDNSæŸ¥è¯¢çš„å®Œæ•´è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</h4><ol><li>æµè§ˆå™¨å°†ä¼šæ£€æŸ¥ç¼“å­˜ä¸­æœ‰æ²¡æœ‰è¿™ä¸ªåŸŸåå¯¹åº”çš„è§£æè¿‡çš„ IP åœ°å€ï¼Œå¦‚æœæœ‰è¯¥è§£æè¿‡ç¨‹å°†ä¼šç»“æŸã€‚æµè§ˆå™¨ç¼“å­˜åŸŸåä¹Ÿæ˜¯æœ‰é™åˆ¶çš„ï¼ŒåŒ…æ‹¬ç¼“å­˜çš„æ—¶é—´ã€å¤§å°ï¼Œå¯ä»¥é€šè¿‡ TTL å±æ€§æ¥è®¾ç½®ã€‚</li><li>å¦‚æœç”¨æˆ·çš„æµè§ˆå™¨ä¸­ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œæ“ä½œç³»ç»Ÿä¼šå…ˆæ£€æŸ¥è‡ªå·±æœ¬åœ°çš„ DNS è§£æå™¨ç¼“å­˜å’Œ hosts æ–‡ä»¶æ˜¯å¦æœ‰è¿™ä¸ªç½‘å€æ˜ å°„å…³ç³»ï¼Œå¦‚æœæœ‰ï¼Œå°±å…ˆè°ƒç”¨è¿™ä¸ª IP åœ°å€æ˜ å°„ï¼Œå®ŒæˆåŸŸåè§£æã€‚</li><li>å¦‚æœéƒ½æ²¡æœ‰ï¼Œä¼šæ‰¾ TCP&#x2F;IP å‚æ•°ä¸­è®¾ç½®çš„é¦–é€‰ DNS æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å«å®ƒæœ¬åœ° DNS æœåŠ¡å™¨ã€‚é€šè¿‡é€’å½’æŸ¥è¯¢çš„æ–¹å¼å‘æœ¬åœ° DNS æœåŠ¡å™¨å‘èµ·æŸ¥è¯¢ï¼Œå¦‚æœæœ¬åœ° DNS æœåŠ¡å™¨ä¸­æœ‰ Aè®°å½• æˆ–è€…è¯¥åŸŸåçš„æ˜ å°„ç¼“å­˜ï¼Œåˆ™è¿”å›</li><li>å¦‚æœéƒ½æ²¡æœ‰ï¼Œæœ¬åœ°åŸŸåæœåŠ¡å™¨ä¼šå¼€å§‹è¿­ä»£æŸ¥è¯¢çš„è¿‡ç¨‹ï¼Œä¼šå…ˆå‘ 13 å°æ ¹åŸŸåæœåŠ¡å™¨æŸ¥è¯¢è¯¥åŸŸåï¼Œæ ¹åŸŸåæœåŠ¡å™¨ä¼šè¿”å›è¯¥åŸŸåçš„é¡¶çº§åŸŸåæœåŠ¡å™¨çš„ IP åœ°å€ï¼Œä¹Ÿå°±æ˜¯ NS è®°å½•ã€‚ç„¶åæœ¬åœ°åŸŸåæœåŠ¡å™¨å†å‘é¡¶çº§åŸŸåæœåŠ¡å™¨å‘èµ·æŸ¥è¯¢ï¼Œé¡¶çº§åŸŸåæœåŠ¡å™¨è¿”å›äºŒçº§åŸŸåæœåŠ¡å™¨çš„ NS è®°å½•ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°è¿”å› A è®°å½•ä¸ºæ­¢ï¼Œæœ€åæŠŠ A è®°å½•ä¸­çš„ IP åœ°å€è¿”å›ç»™ä¸»æœº</li></ol><h3 id="RPC-è¿œç¨‹è°ƒç”¨-ï¼š"><a href="#RPC-è¿œç¨‹è°ƒç”¨-ï¼š" class="headerlink" title="RPC(è¿œç¨‹è°ƒç”¨)ï¼š"></a>RPC(è¿œç¨‹è°ƒç”¨)ï¼š</h3><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><p><a href="https://xiaolincoding.com/network/2_http/http_rpc.html#_3-8-%E6%97%A2%E7%84%B6%E6%9C%89-http-%E5%8D%8F%E8%AE%AE-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E6%9C%89-rpc">æ—¢ç„¶æœ‰ HTTP åè®®ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ RPCï¼Ÿ</a></p></li><li><p>çº¯è£¸ TCP æ˜¯èƒ½æ”¶å‘æ•°æ®ï¼Œä½†å®ƒæ˜¯ä¸ª<strong>æ— è¾¹ç•Œ</strong>çš„æ•°æ®æµï¼Œä¸Šå±‚éœ€è¦å®šä¹‰<strong>æ¶ˆæ¯æ ¼å¼</strong>ç”¨äºå®šä¹‰<strong>æ¶ˆæ¯è¾¹ç•Œ</strong>ã€‚äºæ˜¯å°±æœ‰äº†å„ç§åè®®ï¼ŒHTTP å’Œå„ç±» RPC åè®®å°±æ˜¯åœ¨ TCP ä¹‹ä¸Šå®šä¹‰çš„åº”ç”¨å±‚åè®®ã€‚</p></li><li><p><strong>RPC æœ¬è´¨ä¸Šä¸ç®—æ˜¯åè®®ï¼Œè€Œæ˜¯ä¸€ç§è°ƒç”¨æ–¹å¼</strong>ï¼Œè€Œåƒ gRPC å’Œ Thrift è¿™æ ·çš„å…·ä½“å®ç°ï¼Œæ‰æ˜¯åè®®ï¼Œå®ƒä»¬æ˜¯å®ç°äº† RPC è°ƒç”¨çš„åè®®ã€‚ç›®çš„æ˜¯å¸Œæœ›ç¨‹åºå‘˜èƒ½åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•é‚£æ ·å»è°ƒç”¨è¿œç«¯çš„æœåŠ¡æ–¹æ³•ã€‚åŒæ—¶ RPC æœ‰å¾ˆå¤šç§å®ç°æ–¹å¼ï¼Œ<strong>ä¸ä¸€å®šéå¾—åŸºäº TCP åè®®</strong>ã€‚</p></li><li><p>ä»å‘å±•å†å²æ¥è¯´ï¼Œ<strong>HTTP ä¸»è¦ç”¨äº B&#x2F;S æ¶æ„ï¼Œè€Œ RPC æ›´å¤šç”¨äº C&#x2F;S æ¶æ„ã€‚ä½†ç°åœ¨å…¶å®å·²ç»æ²¡åˆ†é‚£ä¹ˆæ¸…äº†ï¼ŒB&#x2F;S å’Œ C&#x2F;S åœ¨æ…¢æ…¢èåˆ</strong>ã€‚å¾ˆå¤šè½¯ä»¶åŒæ—¶æ”¯æŒå¤šç«¯ï¼Œæ‰€ä»¥å¯¹å¤–ä¸€èˆ¬ç”¨ HTTP åè®®ï¼Œè€Œå†…éƒ¨é›†ç¾¤çš„å¾®æœåŠ¡ä¹‹é—´åˆ™é‡‡ç”¨ RPC åè®®è¿›è¡Œé€šè®¯ã€‚</p></li><li><p>RPC å…¶å®æ¯” HTTP å‡ºç°çš„è¦æ—©ï¼Œä¸”æ¯”ç›®å‰ä¸»æµçš„ HTTP&#x2F;1.1 <strong>æ€§èƒ½</strong>è¦æ›´å¥½ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†å…¬å¸å†…éƒ¨éƒ½è¿˜åœ¨ä½¿ç”¨ RPCã€‚</p></li><li><p><strong>HTTP&#x2F;2.0</strong> åœ¨ <strong>HTTP&#x2F;1.1</strong> çš„åŸºç¡€ä¸Šåšäº†ä¼˜åŒ–ï¼Œæ€§èƒ½å¯èƒ½æ¯”å¾ˆå¤š RPC åè®®éƒ½è¦å¥½ï¼Œä½†ç”±äºæ˜¯è¿™å‡ å¹´æ‰å‡ºæ¥çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸å¤ªå¯èƒ½å–ä»£æ‰ RPCã€‚</p></li></ul><p>â€‹</p><h2 id="ä¼ è¾“å±‚ï¼š"><a href="#ä¼ è¾“å±‚ï¼š" class="headerlink" title="ä¼ è¾“å±‚ï¼š"></a>ä¼ è¾“å±‚ï¼š</h2><h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP:"></a>TCP:</h3><p>â€‹</p><h2 id="ç½‘ç»œå±‚ï¼š"><a href="#ç½‘ç»œå±‚ï¼š" class="headerlink" title="ç½‘ç»œå±‚ï¼š"></a>ç½‘ç»œå±‚ï¼š</h2>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLåŸç†å­¦ä¹ </title>
      <link href="/2023/07/27/MySQL%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/07/27/MySQL%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="MySQLåŸç†"><a href="#MySQLåŸç†" class="headerlink" title="MySQLåŸç†"></a>MySQLåŸç†</h1><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728105935995.png" alt="image-20230728105935995"></p><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><h3 id="MySQLæ¶æ„"><a href="#MySQLæ¶æ„" class="headerlink" title="MySQLæ¶æ„"></a>MySQLæ¶æ„</h3><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728111959688.png" alt="image-20230728111959688" style="zoom: 67%;" /><h4 id="MySQLæœåŠ¡å™¨é€»è¾‘æ¶æ„ï¼š"><a href="#MySQLæœåŠ¡å™¨é€»è¾‘æ¶æ„ï¼š" class="headerlink" title="MySQLæœåŠ¡å™¨é€»è¾‘æ¶æ„ï¼š"></a>MySQLæœåŠ¡å™¨é€»è¾‘æ¶æ„ï¼š</h4><ul><li>æœ€ä¸Šå±‚çš„æœåŠ¡å¹¶ä¸æ˜¯ MySQL æ‰€ç‹¬æœ‰çš„ï¼Œå¤§å¤šæ•°åŸºäºç½‘ç»œçš„å®¢æˆ·ç«¯&#x2F;æœåŠ¡å™¨çš„å·¥å…·æˆ–è€…æœåŠ¡éƒ½æœ‰ç±»ä¼¼çš„æ¶æ„ã€‚æ¯”å¦‚è¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€å®‰å…¨ç­‰ç­‰ã€‚</li><li>ç¬¬äºŒå±‚æ¶æ„æ˜¯ MySQL æ¯”è¾ƒæœ‰æ„æ€çš„éƒ¨åˆ†ã€‚å¤§å¤šæ•° MySQL çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚ï¼ŒåŒ…æ‹¬<strong>æŸ¥è¯¢è§£æã€åˆ†æã€ä¼˜åŒ–ã€ç¼“å­˜ä»¥åŠæ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼ˆä¾‹å¦‚ï¼Œæ—¥æœŸã€æ—¶é—´ã€æ•°å­¦å’ŒåŠ å¯†å‡½æ•°ï¼‰</strong>ï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ï¼š<strong>å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾</strong>ç­‰ã€‚</li><li>ç¬¬ä¸‰å±‚åŒ…å«äº†å­˜å‚¨å¼•æ“ã€‚å­˜å‚¨å¼•æ“è´Ÿè´£ MySQL ä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚å’Œ GNU&#x2F;Linux ä¸‹çš„å„ç§æ–‡ä»¶ç³»ç»Ÿä¸€æ ·ï¼Œæ¯ä¸ªå­˜å‚¨å¼•æ“éƒ½æœ‰å®ƒçš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚<strong>æœåŠ¡å™¨é€šè¿‡ API ä¸å­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ã€‚è¿™äº›æ¥å£å±è”½äº†ä¸åŒå­˜å‚¨å¼•æ“ä¹‹é—®çš„å·®å¼‚ï¼Œä½¿å¾—è¿™äº›å·®å¼‚å¯¹ä¸Šå±‚çš„æŸ¥è¯¢è¿‡ç¨‹é€æ˜</strong>ã€‚å­˜å‚¨å¼•æ“APIåŒ…åˆå‡ åä¸ªåº•å±‚å‡½æ•°ï¼Œç”¨äºæ‰§è¡Œè¯¸å¦‚â€œå¼€å§‹ä¸€ä¸ªäº‹åŠ¡â€æˆ–è€…â€œæ ¹æ®ä¸»é”®æå–ä¸€è¡Œè®°å½•â€ ç­‰æ“ä½œã€‚ä½†å­˜å‚¨å¼•æ“ä¸ä¼šå»è§£æ SQLï¼Œä¸åŒå­˜å‚¨å¼•æ“ä¹‹é—´ä¹Ÿä¸ä¼šç›¸äº’é€šä¿¡ï¼Œè€Œåªæ˜¯ç®€å•åœ°å“åº”ä¸Šå±‚æœåŠ¡å™¨çš„è¯·æ±‚ã€‚</li></ul><h4 id="è¿æ¥ç®¡ç†ä¸å®‰å…¨æ€§"><a href="#è¿æ¥ç®¡ç†ä¸å®‰å…¨æ€§" class="headerlink" title="è¿æ¥ç®¡ç†ä¸å®‰å…¨æ€§"></a>è¿æ¥ç®¡ç†ä¸å®‰å…¨æ€§</h4><ul><li><u>æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥éƒ½ä¼šåœ¨æœåŠ¡å™¨è¿›ç¨‹ä¸­æ‹¥æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªè¿æ¥çš„æŸ¥è¯¢åªä¼šåœ¨è¿™ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œ</u>ï¼Œè¯¥çº¿ç¨‹åªèƒ½è½®æµåœ¨æœåŠ¡å™¨çš„CPUä¸­è¿è¡Œã€‚</li><li>å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨å¯¹å…¶è¿›è¡Œè®¤è¯(ç”¨æˆ·åã€ä¸»æœºä¿¡æ¯ã€å¯†ç )ï¼Œè®¤è¯æˆåŠŸåè¿›ä¸€æ­¥éªŒè¯è¯¥å®¢æˆ·ç«¯æ˜¯å¦å…·æœ‰æ‰§è¡ŒæŸä¸ªæŸ¥è¯¢çš„æƒé™</li></ul><h4 id="ä¼˜åŒ–ä¸æ‰§è¡Œ"><a href="#ä¼˜åŒ–ä¸æ‰§è¡Œ" class="headerlink" title="ä¼˜åŒ–ä¸æ‰§è¡Œ"></a>ä¼˜åŒ–ä¸æ‰§è¡Œ</h4><ul><li>MysQLä¼š<strong>è§£ææŸ¥è¯¢ï¼Œå¹¶åˆ›å»ºå†…éƒ¨æ•°æ®ç»“æ„ï¼ˆè§£ææ ‘ï¼‰ï¼Œç„¶åå¯¹å…¶è¿›è¡Œå„ç§ä¼˜åŒ–ï¼ŒåŒ…æ‹¬é‡å†™æŸ¥è¯¢ã€å†³å®šè¡¨çš„è¯»å–é¡ºåºï¼Œä»¥åŠé€‰æ‹©åˆé€‚ç´¢å¼•ç­‰</strong>ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ç‰¹æ®Šçš„å…³é”®å®‡æç¤º(hintï¼‰ ä¼˜åŒ–å™¨ï¼Œå½±å“å®ƒçš„å†³ç­–è¿‡ç¨‹ã€‚ä¹Ÿå¯ä»¥è¯·æ±‚ä¼˜åŒ–å™¨è§£é‡Š (explainï¼‰ä¼˜åŒ–è¿‡ç¨‹çš„å„ä¸ªå› ç´ ï¼Œä½¿ç”¨æˆ·å¯ä»¥çŸ¥é“æœåŠ¡å™¨æ˜¯å¦‚ä½•è¿›è¡Œä¼˜åŒ–å†³ç­–çš„ï¼Œå¹¶æä¾›ä¸€ä¸ªå‚è€ƒåŸºå‡†ï¼Œä¾¿äºç”¨æˆ¶é‡æ„æŸ¥è¯¢å’Œ schetnaã€ä¿®æ”¹ç›¸å…³é…ç½®ï¼Œä½¿åº”ç”¨å°½å¯èƒ½é«˜æ•ˆè¿è¡Œã€‚</li><li>ä¼˜åŒ–å™¨å¹¶ä¸å…³å¿ƒè¡¨ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆå­˜å‚¨å¼•æ“ï¼Œä½†å­˜å‚¨å¼•æ“å¯¹äºä¼˜åŒ–æŸ¥è¯¢æ˜¯æœ‰å½±å“çš„ã€‚ä¼˜åŒ–å™¨ä¼šè¯·æ±‚å­˜å‚¨å¼•æ“æä¾›å®¹é‡æˆ–æŸä¸ªå…·ä½“æ“ä½œçš„å¼€é”€ä¿¡æ¯ï¼Œä»¥åŠè¡¨æ•°æ®çš„ç»Ÿè®¡ä¿¡æ¯ç­‰ã€‚ä¾‹å¦‚ï¼ŒæŸäº›å­˜å‚¨å¼•æ“çš„æŸç§ç´¢å¼•ï¼Œå¯èƒ½å¯¹ä¸€äº›ç‰¹å®šçš„æŸ¥è¯¢æœ‰ä¼˜åŒ–ã€‚</li><li>å¯¹äº SELECT è¯­å‘ï¼Œåœ¨è§£ææŸ¥è¯¢ä¹‹å‰ï¼ŒæœåŠ¡å™¨ä¼šå…ˆæ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ (Query Cache)ï¼Œ<strong>å¦‚æœèƒ½å¤Ÿåœ¨å…¶ä¸­æ‰¾åˆ°å¯¹åº”çš„æŸ¥è¯¢ï¼ŒæœåŠ¡å™¨å°±ä¸å¿…å†æ‰§è¡ŒæŸ¥è¯¢è§£æã€ä¼˜åŒ–å’Œæ‰§è¡Œçš„æ•´ä¸ªè¿‡ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›æŸ¥è¯¢ç¼“å­˜ä¸­çš„ç»“æœé›†</strong>ã€‚</li></ul><h3 id="ä¸€æ¡SQLçš„æ‰§è¡Œè¿‡ç¨‹"><a href="#ä¸€æ¡SQLçš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="ä¸€æ¡SQLçš„æ‰§è¡Œè¿‡ç¨‹"></a>ä¸€æ¡SQLçš„æ‰§è¡Œè¿‡ç¨‹</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728122544760.png" alt="image-20230728122544760"></p><p>MySQLæ‰§è¡ŒSQLæŸ¥è¯¢çš„æµç¨‹å›¾â¬†ï¸ï¼š</p><p>å¯ä»¥çœ‹åˆ°ï¼Œ MySQL çš„æ¶æ„å…±åˆ†ä¸ºä¸¤å±‚ï¼š<strong>Server å±‚å’Œå­˜å‚¨å¼•æ“å±‚</strong>ï¼Œ</p><ul><li>**Server å±‚è´Ÿè´£<u>å»ºç«‹è¿æ¥ã€åˆ†æå’Œæ‰§è¡Œ SQL</u> **ã€‚MySQL å¤§å¤šæ•°çš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—éƒ½åœ¨è¿™å®ç°ï¼Œä¸»è¦åŒ…æ‹¬è¿æ¥å™¨ï¼ŒæŸ¥è¯¢ç¼“å­˜ã€è§£æå™¨ã€é¢„å¤„ç†å™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ã€‚å¦å¤–ï¼Œæ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼ˆå¦‚æ—¥æœŸã€æ—¶é—´ã€æ•°å­¦å’ŒåŠ å¯†å‡½æ•°ç­‰ï¼‰å’Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ï¼ˆå¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ç­‰ã€‚ï¼‰éƒ½åœ¨ Server å±‚å®ç°ã€‚</li><li><strong>å­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–</strong>ã€‚æ”¯æŒ InnoDBã€MyISAMã€Memory ç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“å…±ç”¨ä¸€ä¸ª Server å±‚ã€‚ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDBï¼Œä» MySQL 5.5 ç‰ˆæœ¬å¼€å§‹ï¼Œ InnoDB æˆä¸ºäº† MySQL çš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚æˆ‘ä»¬å¸¸è¯´çš„ç´¢å¼•æ•°æ®ç»“æ„ï¼Œå°±æ˜¯ç”±å­˜å‚¨å¼•æ“å±‚å®ç°çš„ï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“æ”¯æŒçš„ç´¢å¼•ç±»å‹ä¹Ÿä¸ç›¸åŒï¼Œæ¯”å¦‚ InnoDB æ”¯æŒç´¢å¼•ç±»å‹æ˜¯ B+æ ‘ ï¼Œä¸”æ˜¯é»˜è®¤ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æ•°æ®è¡¨ä¸­åˆ›å»ºçš„ä¸»é”®ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•é»˜è®¤ä½¿ç”¨çš„æ˜¯ B+ æ ‘ç´¢å¼•ã€‚</li></ul><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¯¹ Server å±‚å’Œå­˜å‚¨å¼•æ“å±‚æœ‰äº†ä¸€ä¸ªç®€å•è®¤è¯†ï¼Œæ¥ä¸‹æ¥ï¼Œå°±è¯¦ç»†è¯´ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹ï¼Œä¾æ¬¡çœ‹çœ‹æ¯ä¸€ä¸ªåŠŸèƒ½æ¨¡å—çš„ä½œç”¨ã€‚</p><h4 id="Step1-è¿æ¥å™¨"><a href="#Step1-è¿æ¥å™¨" class="headerlink" title="Step1: è¿æ¥å™¨"></a>Step1: è¿æ¥å™¨</h4><p>æœåŠ¡å™¨(é€šå¸¸ï¼Œæˆ‘ä»¬çš„æ—¥å¸¸å­¦ä¹ ä¸­ï¼Œä½¿ç”¨æœ¬æœºæä¾›mysqlæœåŠ¡ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦åœ¨æœ¬æœºå¯åŠ¨mysql)å¯åŠ¨MySQLåï¼Œç”¨æˆ·ç«¯è¿æ¥MySQL</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># -h æŒ‡å®š MySQL æœåŠ¡å¾— IP åœ°å€ï¼Œå¦‚æœæ˜¯è¿æ¥æœ¬åœ°çš„ MySQLæœåŠ¡ï¼Œå¯ä»¥ä¸ç”¨è¿™ä¸ªå‚æ•°ï¼›</span><br><span class="line"># -u æŒ‡å®šç”¨æˆ·åï¼Œç®¡ç†å‘˜è§’è‰²åä¸º rootï¼›</span><br><span class="line"># -p æŒ‡å®šå¯†ç ï¼Œå¦‚æœå‘½ä»¤è¡Œä¸­ä¸å¡«å†™å¯†ç ï¼ˆä¸ºäº†å¯†ç å®‰å…¨ï¼Œå»ºè®®ä¸è¦åœ¨å‘½ä»¤è¡Œå†™å¯†ç ï¼‰ï¼Œå°±éœ€è¦åœ¨äº¤äº’å¯¹è¯é‡Œé¢è¾“å…¥å¯†ç </span><br><span class="line">mysql -h$ip -u$user -p</span><br></pre></td></tr></table></figure><ol><li><p><strong>æœåŠ¡å™¨æœªå¯åŠ¨mysql</strong>ï¼šè¿æ¥çš„è¿‡ç¨‹éœ€è¦å…ˆç»è¿‡ TCP ä¸‰æ¬¡æ¡æ‰‹ï¼Œå› ä¸º **<u>MySQL æ˜¯åŸºäº TCP åè®®è¿›è¡Œä¼ è¾“çš„</u>**ï¼Œå¦‚æœ <strong>MySQL æœåŠ¡å¹¶æ²¡æœ‰å¯åŠ¨</strong>ï¼Œåˆ™ä¼šæ”¶åˆ°æŠ¥é”™</p></li><li><p><strong>å®¢æˆ·ç«¯ç”¨æˆ·å&#x2F;å¯†ç é”™è¯¯</strong>ï¼šå¦‚æœ MySQL æœåŠ¡æ­£å¸¸è¿è¡Œï¼Œå®Œæˆ TCP è¿æ¥çš„å»ºç«‹åï¼Œè¿æ¥å™¨å°±è¦å¼€å§‹éªŒè¯ä½ çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœç”¨æˆ·åæˆ–å¯†ç ä¸å¯¹ï¼Œå°±æ”¶åˆ°ä¸€ä¸ªâ€Access denied for userâ€çš„é”™è¯¯ï¼Œç„¶åå®¢æˆ·ç«¯ç¨‹åºç»“æŸæ‰§è¡Œã€‚</p></li></ol><p>ğŸŒŸ<strong>å¦‚æœç”¨æˆ·å¯†ç éƒ½æ²¡æœ‰é—®é¢˜ï¼Œè¿æ¥å™¨å°±ä¼šè·å–è¯¥ç”¨æˆ·çš„æƒé™ï¼Œç„¶åä¿å­˜èµ·æ¥ï¼Œåç»­è¯¥ç”¨æˆ·åœ¨æ­¤è¿æ¥é‡Œçš„ä»»ä½•æ“ä½œï¼Œéƒ½ä¼šåŸºäºè¿æ¥å¼€å§‹æ—¶è¯»åˆ°çš„æƒé™è¿›è¡Œæƒé™é€»è¾‘çš„åˆ¤æ–­ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªç”¨æˆ·å·²ç»å»ºç«‹äº†è¿æ¥ï¼Œå³ä½¿ç®¡ç†å‘˜ä¸­é€”ä¿®æ”¹äº†è¯¥ç”¨æˆ·çš„æƒé™ï¼Œä¹Ÿä¸ä¼šå½±å“å·²ç»å­˜åœ¨è¿æ¥çš„æƒé™ã€‚ä¿®æ”¹å®Œæˆåï¼Œåªæœ‰å†æ–°å»ºçš„è¿æ¥æ‰ä¼šä½¿ç”¨æ–°çš„æƒé™è®¾ç½®ã€‚</strong>â€”â€”ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹åï¼Œæœ¬æ¬¡è¿æ¥ä¸ç”Ÿæ•ˆï¼Œéœ€é‡æ–°è¿æ¥</p><h5 id="å¦‚ä½•æŸ¥çœ‹-MySQL-æœåŠ¡è¢«å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿æ¥äº†ï¼Ÿ"><a href="#å¦‚ä½•æŸ¥çœ‹-MySQL-æœåŠ¡è¢«å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿æ¥äº†ï¼Ÿ" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹ MySQL æœåŠ¡è¢«å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿æ¥äº†ï¼Ÿ"></a>å¦‚ä½•æŸ¥çœ‹ MySQL æœåŠ¡è¢«å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿æ¥äº†ï¼Ÿ</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show processlist;</span><br></pre></td></tr></table></figure><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728123837566.png" alt="image-20230728123837566" style="zoom:50%;" /><h5 id="ç©ºé—²è¿æ¥ä¼šä¸€ç›´å ç”¨ç€å—ï¼Ÿ"><a href="#ç©ºé—²è¿æ¥ä¼šä¸€ç›´å ç”¨ç€å—ï¼Ÿ" class="headerlink" title="ç©ºé—²è¿æ¥ä¼šä¸€ç›´å ç”¨ç€å—ï¼Ÿ"></a>ç©ºé—²è¿æ¥ä¼šä¸€ç›´å ç”¨ç€å—ï¼Ÿ</h5><p>ä¸ä¼šï¼ŒMySQL å®šä¹‰äº†ç©ºé—²è¿æ¥çš„æœ€å¤§ç©ºé—²æ—¶é•¿ï¼Œç”± <strong>wait_timeout å‚æ•°æ§åˆ¶</strong>çš„ï¼Œé»˜è®¤å€¼æ˜¯ 8 å°æ—¶ï¼ˆ28880ç§’ï¼‰ï¼Œå¦‚æœç©ºé—²è¿æ¥è¶…è¿‡äº†è¿™ä¸ªæ—¶é—´ï¼Œè¿æ¥å™¨å°±ä¼šè‡ªåŠ¨å°†å®ƒæ–­å¼€ã€‚</p><p>æˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ–­å¼€ç©ºé—²çš„è¿æ¥ï¼Œä½¿ç”¨çš„æ˜¯ kill connection + id çš„å‘½ä»¤ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; kill connection +6;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå¤„äºç©ºé—²çŠ¶æ€çš„è¿æ¥è¢«æœåŠ¡ç«¯ä¸»åŠ¨æ–­å¼€åï¼Œ<strong>è¿™ä¸ªå®¢æˆ·ç«¯å¹¶ä¸ä¼šé©¬ä¸ŠçŸ¥é“</strong>ï¼Œç­‰åˆ°å®¢æˆ·ç«¯åœ¨å‘èµ·ä¸‹ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œæ‰ä¼šæ”¶åˆ°è¿™æ ·çš„æŠ¥é”™â€œERROR 2013 (HY000): Lost connection to MySQL server during queryâ€</p><h5 id="MySQL-çš„è¿æ¥æ•°æœ‰é™åˆ¶å—ï¼Ÿ"><a href="#MySQL-çš„è¿æ¥æ•°æœ‰é™åˆ¶å—ï¼Ÿ" class="headerlink" title="MySQL çš„è¿æ¥æ•°æœ‰é™åˆ¶å—ï¼Ÿ"></a>MySQL çš„è¿æ¥æ•°æœ‰é™åˆ¶å—ï¼Ÿ</h5><p><u>MySQL æœåŠ¡æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ç”± max_connections å‚æ•°æ§åˆ¶</u>ï¼Œæ¯”å¦‚æˆ‘çš„ MySQL æœåŠ¡é»˜è®¤æ˜¯ 151 ä¸ª,è¶…è¿‡è¿™ä¸ªå€¼ï¼Œç³»ç»Ÿå°±ä¼šæ‹’ç»æ¥ä¸‹æ¥çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶æŠ¥é”™æç¤ºâ€œToo many connectionsâ€ã€‚</p><h5 id="MySQL-çŸ­è¿æ¥å’Œé•¿è¿æ¥ï¼š"><a href="#MySQL-çŸ­è¿æ¥å’Œé•¿è¿æ¥ï¼š" class="headerlink" title="MySQL çŸ­è¿æ¥å’Œé•¿è¿æ¥ï¼š"></a>MySQL çŸ­è¿æ¥å’Œé•¿è¿æ¥ï¼š</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// çŸ­è¿æ¥</span><br><span class="line">è¿æ¥ mysql æœåŠ¡ï¼ˆTCP ä¸‰æ¬¡æ¡æ‰‹ï¼‰</span><br><span class="line">æ‰§è¡Œsql</span><br><span class="line">æ–­å¼€ mysql æœåŠ¡ï¼ˆTCP å››æ¬¡æŒ¥æ‰‹ï¼‰</span><br><span class="line"></span><br><span class="line">// é•¿è¿æ¥</span><br><span class="line">è¿æ¥ mysql æœåŠ¡ï¼ˆTCP ä¸‰æ¬¡æ¡æ‰‹ï¼‰</span><br><span class="line">æ‰§è¡Œsql</span><br><span class="line">æ‰§è¡Œsql</span><br><span class="line">æ‰§è¡Œsql</span><br><span class="line">....</span><br><span class="line">æ–­å¼€ mysql æœåŠ¡ï¼ˆTCP å››æ¬¡æŒ¥æ‰‹ï¼‰</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨<strong>é•¿è¿æ¥</strong>çš„å¥½å¤„å°±æ˜¯å¯ä»¥<strong>å‡å°‘å»ºç«‹è¿æ¥å’Œæ–­å¼€è¿æ¥çš„è¿‡ç¨‹</strong>ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯æ¨èä½¿ç”¨é•¿è¿æ¥ã€‚</p><p>ä½†æ˜¯ï¼Œ<u>ä½¿ç”¨é•¿è¿æ¥åå¯èƒ½ä¼šå ç”¨å†…å­˜å¢å¤š</u>ï¼Œå› ä¸º MySQL åœ¨æ‰§è¡ŒæŸ¥è¯¢è¿‡ç¨‹ä¸­ä¸´æ—¶ä½¿ç”¨å†…å­˜ç®¡ç†è¿æ¥å¯¹è±¡ï¼Œ<u>è¿™äº›è¿æ¥å¯¹è±¡èµ„æºåªæœ‰åœ¨è¿æ¥æ–­å¼€æ—¶æ‰ä¼šé‡Šæ”¾</u>ã€‚å¦‚æœé•¿è¿æ¥ç´¯è®¡å¾ˆå¤šï¼Œå°†å¯¼è‡´ MySQL æœåŠ¡å ç”¨å†…å­˜å¤ªå¤§ï¼Œæœ‰å¯èƒ½ä¼šè¢«ç³»ç»Ÿå¼ºåˆ¶æ€æ‰ï¼Œè¿™æ ·ä¼šå‘ç”Ÿ MySQL æœåŠ¡å¼‚å¸¸é‡å¯çš„ç°è±¡ã€‚</p><h5 id="æ€ä¹ˆè§£å†³é•¿è¿æ¥å ç”¨å†…å­˜çš„é—®é¢˜ï¼Ÿ"><a href="#æ€ä¹ˆè§£å†³é•¿è¿æ¥å ç”¨å†…å­˜çš„é—®é¢˜ï¼Ÿ" class="headerlink" title="æ€ä¹ˆè§£å†³é•¿è¿æ¥å ç”¨å†…å­˜çš„é—®é¢˜ï¼Ÿ"></a>æ€ä¹ˆè§£å†³é•¿è¿æ¥å ç”¨å†…å­˜çš„é—®é¢˜ï¼Ÿ</h5><p>ç¬¬ä¸€ç§ï¼Œ<strong>å®šæœŸæ–­å¼€é•¿è¿æ¥</strong>ã€‚æ—¢ç„¶æ–­å¼€è¿æ¥åå°±ä¼šé‡Šæ”¾è¿æ¥å ç”¨çš„å†…å­˜èµ„æºï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å®šæœŸæ–­å¼€é•¿è¿æ¥ã€‚</p><p>ç¬¬äºŒç§ï¼Œ<strong>å®¢æˆ·ç«¯ä¸»åŠ¨é‡ç½®è¿æ¥</strong>ã€‚MySQL 5.7 ç‰ˆæœ¬å®ç°äº† mysql_reset_connection() å‡½æ•°çš„æ¥å£ï¼Œæ³¨æ„è¿™æ˜¯æ¥å£å‡½æ•°ä¸æ˜¯å‘½ä»¤ï¼Œé‚£ä¹ˆå½“å®¢æˆ·ç«¯æ‰§è¡Œäº†ä¸€ä¸ªå¾ˆå¤§çš„æ“ä½œåï¼Œåœ¨ä»£ç é‡Œè°ƒç”¨ mysql_reset_connection å‡½æ•°æ¥é‡ç½®è¿æ¥ï¼Œè¾¾åˆ°é‡Šæ”¾å†…å­˜çš„æ•ˆæœã€‚è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦é‡è¿å’Œé‡æ–°åšæƒé™éªŒè¯ï¼Œä½†æ˜¯ä¼šå°†è¿æ¥æ¢å¤åˆ°åˆšåˆšåˆ›å»ºå®Œæ—¶çš„çŠ¶æ€ã€‚ğŸ‘</p><h5 id="è¿æ¥å™¨å·¥ä½œæ€»ç»“ï¼š"><a href="#è¿æ¥å™¨å·¥ä½œæ€»ç»“ï¼š" class="headerlink" title="è¿æ¥å™¨å·¥ä½œæ€»ç»“ï¼š"></a>è¿æ¥å™¨å·¥ä½œæ€»ç»“ï¼š</h5><ul><li>ä¸å®¢æˆ·ç«¯è¿›è¡Œ TCP ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹<strong>è¿æ¥</strong>ï¼›</li><li><strong>æ ¡éªŒå®¢æˆ·ç«¯çš„ç”¨æˆ·åå’Œå¯†ç </strong>ï¼Œå¦‚æœç”¨æˆ·åæˆ–å¯†ç ä¸å¯¹ï¼Œåˆ™ä¼šæŠ¥é”™ï¼›</li><li>å¦‚æœç”¨æˆ·åå’Œå¯†ç éƒ½å¯¹äº†ï¼Œä¼š<strong>è¯»å–è¯¥ç”¨æˆ·çš„æƒé™</strong>ï¼Œç„¶ååé¢çš„æƒé™é€»è¾‘åˆ¤æ–­éƒ½åŸºäºæ­¤æ—¶è¯»å–åˆ°çš„æƒé™ï¼›</li></ul><h4 id="Step2-æŸ¥è¯¢ç¼“å­˜"><a href="#Step2-æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="Step2: æŸ¥è¯¢ç¼“å­˜"></a>Step2: æŸ¥è¯¢ç¼“å­˜</h4><p>MySQL æœåŠ¡æ”¶åˆ° SQL è¯­å¥åï¼Œå°±ä¼šè§£æå‡º SQL è¯­å¥çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼Œçœ‹çœ‹æ˜¯ä»€ä¹ˆç±»å‹çš„è¯­å¥ã€‚</p><p>å¦‚æœ SQL æ˜¯æŸ¥è¯¢è¯­å¥ï¼ˆselect è¯­å¥ï¼‰ï¼ŒMySQL å°±ä¼šå…ˆå»æŸ¥è¯¢ç¼“å­˜ï¼ˆ Query Cache ï¼‰é‡ŒæŸ¥æ‰¾ç¼“å­˜æ•°æ®ï¼Œçœ‹çœ‹ä¹‹å‰æœ‰æ²¡æœ‰æ‰§è¡Œè¿‡è¿™ä¸€æ¡å‘½ä»¤ï¼Œ<strong>è¿™ä¸ªæŸ¥è¯¢ç¼“å­˜æ˜¯ä»¥ key-value å½¢å¼ä¿å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œkey ä¸º SQL æŸ¥è¯¢è¯­å¥ï¼Œvalue ä¸º SQL è¯­å¥æŸ¥è¯¢çš„ç»“æœã€‚</strong></p><p>ä½†æ˜¯æŸ¥è¯¢ç¼“å­˜è¢«å‘½ä¸­çš„å‡ ç‡å¾ˆä½ï¼ŒåŸºæœ¬ä¸ä¼šå‘½ä¸­ï¼Œå› æ­¤ MySQL 8.0 å¼€å§‹(è¢«ç§»é™¤äº†)ï¼Œæ‰§è¡Œä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥ï¼Œä¸ä¼šå†èµ°åˆ°æŸ¥è¯¢ç¼“å­˜è¿™ä¸ªé˜¶æ®µäº†ã€‚</p><p>å¯¹äº MySQL 8.0 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¦‚æœæƒ³å…³é—­æŸ¥è¯¢ç¼“å­˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å‚æ•° query_cache_type è®¾ç½®æˆ DEMANDã€‚</p><h4 id="Step3-è§£æSQL"><a href="#Step3-è§£æSQL" class="headerlink" title="Step3: è§£æSQL"></a>Step3: è§£æSQL</h4><p>åœ¨æ­£å¼æ‰§è¡Œ SQL æŸ¥è¯¢è¯­å¥ä¹‹å‰ï¼Œ MySQL ä¼šå…ˆ<strong>å¯¹ SQL è¯­å¥åšè§£æ</strong>ï¼Œè¿™ä¸ªå·¥ä½œäº¤ç”±ã€Œè§£æå™¨ã€æ¥å®Œæˆã€‚</p><h5 id=""><a href="#" class="headerlink" title=""></a></h5><h5 id="è§£æå™¨ï¼š"><a href="#è§£æå™¨ï¼š" class="headerlink" title="è§£æå™¨ï¼š"></a>è§£æå™¨ï¼š</h5><ul><li><p><strong>è¯æ³•åˆ†æ</strong>ã€‚MySQL ä¼šæ ¹æ®ä½ è¾“å…¥çš„å­—ç¬¦ä¸²<strong>è¯†åˆ«å‡ºå…³é”®å­—</strong>å‡ºæ¥ï¼Œæ„å»ºå‡º SQL è¯­æ³•æ ‘ï¼Œè¿™æ ·æ–¹ä¾¿åé¢æ¨¡å—è·å– SQL ç±»å‹ã€è¡¨åã€å­—æ®µåã€ where æ¡ä»¶ç­‰ç­‰ã€‚</p></li><li><p><strong>è¯­æ³•åˆ†æ</strong>ã€‚æ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•è§£æå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ª SQL è¯­å¥æ˜¯å¦æ»¡è¶³ MySQL è¯­æ³•ã€‚</p></li></ul><p><u>å¦‚æœæˆ‘ä»¬è¾“å…¥çš„ SQL è¯­å¥è¯­æ³•ä¸å¯¹ï¼Œå°±ä¼šåœ¨è§£æå™¨è¿™ä¸ªé˜¶æ®µæŠ¥é”™</u>ã€‚æ¯”å¦‚ï¼Œæˆ‘ä¸‹é¢è¿™æ¡æŸ¥è¯¢è¯­å¥ï¼ŒæŠŠ from å†™æˆäº† formï¼Œè¿™æ—¶ MySQL è§£æå™¨å°±ä¼šç»™æŠ¥é”™ã€‚</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/sql%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B/%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF.png" alt="img"></p><p>âš ï¸ä½†æ˜¯æ³¨æ„ï¼Œ<strong>è¡¨ä¸å­˜åœ¨æˆ–è€…å­—æ®µä¸å­˜åœ¨ï¼Œå¹¶ä¸æ˜¯åœ¨è§£æå™¨é‡Œåšçš„</strong></p><h4 id="Step4-æ‰§è¡ŒSQL"><a href="#Step4-æ‰§è¡ŒSQL" class="headerlink" title="Step4: æ‰§è¡ŒSQL"></a>Step4: æ‰§è¡ŒSQL</h4><p>â€‹ç»è¿‡è§£æå™¨åï¼Œæ¥ç€å°±è¦è¿›å…¥æ‰§è¡Œ SQL æŸ¥è¯¢è¯­å¥çš„æµç¨‹äº†ï¼Œæ¯æ¡<strong>SELECT æŸ¥è¯¢è¯­å¥</strong>æµç¨‹ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸‹é¢è¿™ä¸‰ä¸ªé˜¶æ®µï¼š</p><ul><li>prepare é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯<strong>é¢„å¤„ç†é˜¶æ®µï¼›</strong></li><li>optimize é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯<strong>ä¼˜åŒ–é˜¶æ®µï¼›</strong></li><li>execute é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯<strong>æ‰§è¡Œé˜¶æ®µï¼›</strong></li></ul><h5 id="ğŸŒŸé¢„å¤„ç†é˜¶æ®µï¼š"><a href="#ğŸŒŸé¢„å¤„ç†é˜¶æ®µï¼š" class="headerlink" title="ğŸŒŸé¢„å¤„ç†é˜¶æ®µï¼š"></a>ğŸŒŸé¢„å¤„ç†é˜¶æ®µï¼š</h5><p>é¢„å¤„ç†å™¨ä¸»è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ol><li><p><strong>æ£€æŸ¥ SQL æŸ¥è¯¢è¯­å¥ä¸­çš„è¡¨æˆ–è€…å­—æ®µæ˜¯å¦å­˜åœ¨ï¼›</strong></p></li><li><p>å°† select * ä¸­çš„ * ç¬¦å·ï¼Œæ‰©å±•ä¸ºè¡¨ä¸Šçš„æ‰€æœ‰åˆ—ï¼›</p></li></ol><h5 id="ğŸŒŸä¼˜åŒ–é˜¶æ®µï¼š"><a href="#ğŸŒŸä¼˜åŒ–é˜¶æ®µï¼š" class="headerlink" title="ğŸŒŸä¼˜åŒ–é˜¶æ®µï¼š"></a>ğŸŒŸä¼˜åŒ–é˜¶æ®µï¼š</h5><p>ä¼˜åŒ–å™¨ä¸»è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><p>â€‹<strong>ä¼˜åŒ–å™¨ä¸»è¦è´Ÿè´£å°† SQL æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæ–¹æ¡ˆç¡®å®šä¸‹æ¥</strong>ï¼Œæ¯”å¦‚åœ¨è¡¨é‡Œé¢æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œä¼˜åŒ–å™¨ä¼šåŸºäºæŸ¥è¯¢æˆæœ¬çš„è€ƒè™‘ï¼Œæ¥å†³å®šé€‰æ‹©ä½¿ç”¨å“ªä¸ªç´¢å¼•ã€‚</p><p>è¦æƒ³çŸ¥é“ä¼˜åŒ–å™¨é€‰æ‹©äº†å“ªä¸ªç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æŸ¥è¯¢è¯­å¥æœ€å‰é¢åŠ ä¸ª explain å‘½ä»¤ï¼Œè¿™æ ·å°±ä¼šè¾“å‡ºè¿™æ¡ SQL è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œç„¶åæ‰§è¡Œè®¡åˆ’ä¸­çš„ key å°±è¡¨ç¤ºæ‰§è¡Œè¿‡ç¨‹ä¸­ä½¿ç”¨äº†å“ªä¸ªç´¢å¼•</p><h5 id="ğŸŒŸæ‰§è¡Œé˜¶æ®µï¼š"><a href="#ğŸŒŸæ‰§è¡Œé˜¶æ®µï¼š" class="headerlink" title="ğŸŒŸæ‰§è¡Œé˜¶æ®µï¼š"></a>ğŸŒŸæ‰§è¡Œé˜¶æ®µï¼š</h5><p>æ‰§è¡Œå™¨ä¸»è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><p><strong>æ‰§è¡Œå‰è¦å¯¹æ“ä½œç”¨æˆ·çš„æƒé™è¿›è¡Œåˆ¤æ–­ï¼</strong></p><p><strong>æ‰§è¡Œå™¨å°†ä¸å­˜å‚¨å¼•æ“äº¤äº’ï¼Œæ‰§è¡ŒSQLè¯­å¥(äº¤äº’æ˜¯ä»¥è®°å½•ä¸ºå•ä½çš„)</strong></p><p>â€‹å…±æœ‰ä¸‰ç§æ‰§è¡Œæ–¹å¼ï¼š</p><ol><li><strong>ä¸»é”®ç´¢å¼•æŸ¥è¯¢</strong></li></ol><p>â€‹æ ¹æ®ä¸»é”®å­—æ®µçš„å€¼æ¥æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>â€‹è¿™æ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢æ¡ä»¶ç”¨åˆ°äº†ä¸»é”®ç´¢å¼•ï¼Œè€Œä¸”æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼ŒåŒæ—¶ä¸»é”® id æ˜¯å”¯ä¸€ï¼Œä¸ä¼šæœ‰ id ç›¸åŒçš„è®°å½•ï¼Œæ‰€ä»¥ä¼˜åŒ–å™¨å†³å®šé€‰ç”¨è®¿é—®ç±»å‹ä¸º const è¿›è¡ŒæŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸»é”®ç´¢å¼•æŸ¥è¯¢ä¸€æ¡è®°å½•ï¼Œé‚£ä¹ˆæ‰§è¡Œå™¨ä¸å­˜å‚¨å¼•æ“çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>æ‰§è¡Œå™¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œä¼šè°ƒç”¨ read_first_record å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°ï¼Œå› ä¸ºä¼˜åŒ–å™¨é€‰æ‹©çš„è®¿é—®ç±»å‹ä¸º constï¼Œè¿™ä¸ªå‡½æ•°æŒ‡é’ˆè¢«æŒ‡å‘ä¸º InnoDB å¼•æ“ç´¢å¼•æŸ¥è¯¢çš„æ¥å£ï¼ŒæŠŠæ¡ä»¶ id &#x3D; 1 äº¤ç»™å­˜å‚¨å¼•æ“ï¼Œ<strong>è®©å­˜å‚¨å¼•æ“å®šä½ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•</strong>ã€‚</li><li>å­˜å‚¨å¼•æ“é€šè¿‡ä¸»é”®ç´¢å¼•çš„ B+ æ ‘ç»“æ„å®šä½åˆ° id &#x3D; 1çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œå¦‚æœè®°å½•æ˜¯ä¸å­˜åœ¨çš„ï¼Œå°±ä¼šå‘æ‰§è¡Œå™¨ä¸ŠæŠ¥è®°å½•æ‰¾ä¸åˆ°çš„é”™è¯¯ï¼Œç„¶åæŸ¥è¯¢ç»“æŸã€‚å¦‚æœè®°å½•æ˜¯å­˜åœ¨çš„ï¼Œå°±ä¼šå°†è®°å½•è¿”å›ç»™æ‰§è¡Œå™¨ï¼›</li><li>æ‰§è¡Œå™¨ä»å­˜å‚¨å¼•æ“è¯»åˆ°è®°å½•åï¼Œæ¥ç€åˆ¤æ–­è®°å½•æ˜¯å¦ç¬¦åˆæŸ¥è¯¢æ¡ä»¶ï¼Œå¦‚æœç¬¦åˆåˆ™å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå¦‚æœä¸ç¬¦åˆåˆ™è·³è¿‡è¯¥è®°å½•ã€‚</li><li>æ‰§è¡Œå™¨æŸ¥è¯¢çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ª while å¾ªç¯ï¼Œæ‰€ä»¥è¿˜ä¼šå†æŸ¥ä¸€æ¬¡ï¼Œä½†æ˜¯è¿™æ¬¡å› ä¸ºä¸æ˜¯ç¬¬ä¸€æ¬¡æŸ¥è¯¢äº†ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ read_record å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°ï¼Œå› ä¸ºä¼˜åŒ–å™¨é€‰æ‹©çš„è®¿é—®ç±»å‹ä¸º constï¼Œè¿™ä¸ªå‡½æ•°æŒ‡é’ˆè¢«æŒ‡å‘ä¸ºä¸€ä¸ªæ°¸è¿œè¿”å› - 1 çš„å‡½æ•°ï¼Œæ‰€ä»¥å½“è°ƒç”¨è¯¥å‡½æ•°çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨å°±é€€å‡ºå¾ªç¯ï¼Œä¹Ÿå°±æ˜¯ç»“æŸæŸ¥è¯¢äº†ã€‚</li></ul><p>è‡³æ­¤ï¼Œè¿™ä¸ªè¯­å¥å°±æ‰§è¡Œå®Œæˆäº†ã€‚</p><ol start="2"><li><strong>å…¨è¡¨æ‰«æ</strong></li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from product where name = &#x27;iphone&#x27;;</span><br></pre></td></tr></table></figure><p>è¿™æ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢æ¡ä»¶æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œæ‰€ä»¥ä¼˜åŒ–å™¨å†³å®šé€‰ç”¨è®¿é—®ç±»å‹ä¸º ALL è¿›è¡ŒæŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯å…¨è¡¨æ‰«æçš„æ–¹å¼æŸ¥è¯¢ï¼Œé‚£ä¹ˆè¿™æ—¶æ‰§è¡Œå™¨ä¸å­˜å‚¨å¼•æ“çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>æ‰§è¡Œå™¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼Œä¼šè°ƒç”¨ read_first_record å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°ï¼Œå› ä¸ºä¼˜åŒ–å™¨é€‰æ‹©çš„è®¿é—®ç±»å‹ä¸º allï¼Œè¿™ä¸ªå‡½æ•°æŒ‡é’ˆè¢«æŒ‡å‘ä¸º InnoDB å¼•æ“å…¨æ‰«æçš„æ¥å£ï¼Œ<strong>è®©å­˜å‚¨å¼•æ“è¯»å–è¡¨ä¸­çš„ç¬¬ä¸€æ¡è®°å½•</strong>ï¼›</li><li>æ‰§è¡Œå™¨ä¼šåˆ¤æ–­è¯»åˆ°çš„è¿™æ¡è®°å½•çš„ name æ˜¯ä¸æ˜¯ iphoneï¼Œå¦‚æœä¸æ˜¯åˆ™è·³è¿‡ï¼›<strong>å¦‚æœæ˜¯åˆ™å°†è®°å½•å‘ç»™å®¢æˆ·</strong>ï¼ˆæ˜¯çš„æ²¡é”™ï¼ŒS<u>erver å±‚æ¯ä»å­˜å‚¨å¼•æ“è¯»åˆ°ä¸€æ¡è®°å½•å°±ä¼šå‘é€ç»™å®¢æˆ·ç«¯</u>ï¼Œä¹‹æ‰€ä»¥å®¢æˆ·ç«¯æ˜¾ç¤ºçš„æ—¶å€™æ˜¯ç›´æ¥æ˜¾ç¤ºæ‰€æœ‰è®°å½•çš„ï¼Œæ˜¯å› ä¸ºå®¢æˆ·ç«¯æ˜¯ç­‰æŸ¥è¯¢è¯­å¥æŸ¥è¯¢å®Œæˆåï¼Œæ‰ä¼šæ˜¾ç¤ºå‡ºæ‰€æœ‰çš„è®°å½•ï¼‰ã€‚</li><li>æ‰§è¡Œå™¨æŸ¥è¯¢çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ª while å¾ªç¯ï¼Œæ‰€ä»¥è¿˜ä¼šå†æŸ¥ä¸€æ¬¡ï¼Œä¼šè°ƒç”¨ read_record å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°ï¼Œå› ä¸ºä¼˜åŒ–å™¨é€‰æ‹©çš„è®¿é—®ç±»å‹ä¸º allï¼Œread_record å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„è¿˜æ˜¯ InnoDB å¼•æ“å…¨æ‰«æçš„æ¥å£ï¼Œæ‰€ä»¥æ¥ç€å‘å­˜å‚¨å¼•æ“å±‚è¦æ±‚ç»§ç»­è¯»åˆšæ‰é‚£æ¡è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•ï¼Œå­˜å‚¨å¼•æ“æŠŠä¸‹ä¸€æ¡è®°å½•å–å‡ºåå°±å°†å…¶è¿”å›ç»™æ‰§è¡Œå™¨ï¼ˆServerå±‚ï¼‰ï¼Œæ‰§è¡Œå™¨ç»§ç»­åˆ¤æ–­æ¡ä»¶ï¼Œä¸ç¬¦åˆæŸ¥è¯¢æ¡ä»¶å³è·³è¿‡è¯¥è®°å½•ï¼Œå¦åˆ™å‘é€åˆ°å®¢æˆ·ç«¯ï¼›</li><li>ä¸€ç›´é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°å­˜å‚¨å¼•æ“æŠŠè¡¨ä¸­çš„æ‰€æœ‰è®°å½•è¯»å®Œï¼Œç„¶åå‘æ‰§è¡Œå™¨ï¼ˆServerå±‚ï¼‰ è¿”å›äº†è¯»å–å®Œæ¯•çš„ä¿¡æ¯ï¼›</li><li>æ‰§è¡Œå™¨æ”¶åˆ°å­˜å‚¨å¼•æ“æŠ¥å‘Šçš„æŸ¥è¯¢å®Œæ¯•çš„ä¿¡æ¯ï¼Œé€€å‡ºå¾ªç¯ï¼Œåœæ­¢æŸ¥è¯¢ã€‚</li></ul><p>è‡³æ­¤ï¼Œè¿™ä¸ªè¯­å¥å°±æ‰§è¡Œå®Œæˆäº†</p><ol start="3"><li><strong>ç´¢å¼•ä¸‹æ¨</strong></li></ol><p>ç´¢å¼•ä¸‹æ¨èƒ½å¤Ÿå‡å°‘<strong>äºŒçº§ç´¢å¼•</strong>åœ¨æŸ¥è¯¢æ—¶çš„å›è¡¨æ“ä½œï¼Œæé«˜æŸ¥è¯¢çš„æ•ˆç‡ï¼Œå› ä¸ºå®ƒå°† Server å±‚éƒ¨åˆ†è´Ÿè´£çš„äº‹æƒ…(å›è¡¨æ“ä½œ)ï¼Œäº¤ç»™å­˜å‚¨å¼•æ“å±‚å»å¤„ç†äº†ã€‚</p><p>ã€Œ<strong>ç´¢å¼•ä¸‹æ¨æš‚æ—¶ä¸å¿…äº†è§£</strong>ã€åé¢ä¼šè®²</p><h4 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h4><p>â€‹æ‰§è¡Œä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥ï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p><ul><li>è¿æ¥å™¨ï¼šå»ºç«‹è¿æ¥ï¼Œç®¡ç†è¿æ¥ã€æ ¡éªŒç”¨æˆ·èº«ä»½ï¼›</li><li>æŸ¥è¯¢ç¼“å­˜ï¼šæŸ¥è¯¢è¯­å¥å¦‚æœå‘½ä¸­æŸ¥è¯¢ç¼“å­˜åˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚MySQL 8.0 å·²åˆ é™¤è¯¥æ¨¡å—ï¼›</li><li>è§£æ SQLï¼Œé€šè¿‡è§£æå™¨å¯¹ SQL æŸ¥è¯¢è¯­å¥è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æï¼Œç„¶åæ„å»ºè¯­æ³•æ ‘ï¼Œæ–¹ä¾¿åç»­æ¨¡å—è¯»å–è¡¨åã€å­—æ®µã€è¯­å¥ç±»å‹ï¼›</li><li>æ‰§è¡Œ SQLï¼šæ‰§è¡Œ SQL å…±æœ‰ä¸‰ä¸ªé˜¶æ®µï¼š<ul><li>é¢„å¤„ç†é˜¶æ®µï¼š<u>æ£€æŸ¥è¡¨æˆ–å­—æ®µ</u>æ˜¯å¦å­˜åœ¨ï¼›å°† select * ä¸­çš„ * ç¬¦å·æ‰©å±•ä¸ºè¡¨ä¸Šçš„æ‰€æœ‰åˆ—ã€‚</li><li>ä¼˜åŒ–é˜¶æ®µï¼šåŸºäºæŸ¥è¯¢æˆæœ¬çš„è€ƒè™‘ï¼Œ é€‰æ‹©æŸ¥è¯¢æˆæœ¬æœ€å°çš„æ‰§è¡Œè®¡åˆ’ï¼›</li><li>æ‰§è¡Œé˜¶æ®µï¼šæ ¹æ®æ‰§è¡Œè®¡åˆ’æ‰§è¡Œ SQL æŸ¥è¯¢è¯­å¥ï¼Œä»å­˜å‚¨å¼•æ“è¯»å–è®°å½•ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼›</li></ul></li></ul><h3 id="å¼•æ“åˆ†ç±»ï¼š"><a href="#å¼•æ“åˆ†ç±»ï¼š" class="headerlink" title="å¼•æ“åˆ†ç±»ï¼š"></a>å¼•æ“åˆ†ç±»ï¼š</h3><h4 id="MySQLå­˜å‚¨å¼•æ“æœ‰å“ªäº›ï¼Ÿ"><a href="#MySQLå­˜å‚¨å¼•æ“æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="MySQLå­˜å‚¨å¼•æ“æœ‰å“ªäº›ï¼Ÿ"></a>MySQLå­˜å‚¨å¼•æ“æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>InnoDB</li><li>MyISAM</li><li>â€¦â€¦(ä¸Šé¢ä¸¤æ¬¾æœ€å¸¸ç”¨)</li></ul><h4 id="Innodb-å’Œ-MyISAM-å­˜å‚¨å¼•æ“æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#Innodb-å’Œ-MyISAM-å­˜å‚¨å¼•æ“æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="Innodb å’Œ MyISAM å­˜å‚¨å¼•æ“æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>Innodb å’Œ MyISAM å­˜å‚¨å¼•æ“æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><h5 id="1-ç£ç›˜æ–‡ä»¶çš„å¯¹æ¯”"><a href="#1-ç£ç›˜æ–‡ä»¶çš„å¯¹æ¯”" class="headerlink" title="1. ç£ç›˜æ–‡ä»¶çš„å¯¹æ¯”"></a>1. ç£ç›˜æ–‡ä»¶çš„å¯¹æ¯”</h5><p>åˆ›å»ºä¸¤å¼ è¡¨ï¼šzz_myisam_indexã€zz_innodb_indexï¼Œåˆ†åˆ«ä½¿ç”¨äº†ä¸åŒçš„å¼•æ“</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728163011906.png" alt="image-20230728163011906"></p><h6 id="1-1-ä½¿ç”¨MyISAMå¼•æ“çš„è¡¨"><a href="#1-1-ä½¿ç”¨MyISAMå¼•æ“çš„è¡¨" class="headerlink" title="1.1 ä½¿ç”¨MyISAMå¼•æ“çš„è¡¨"></a>1.1 ä½¿ç”¨MyISAMå¼•æ“çš„è¡¨</h6><p>zz_myisam_indexè¿™å¼ è¡¨æ˜¯ä½¿ç”¨MyISAMå¼•æ“çš„è¡¨ï¼Œåœ¨ç£ç›˜ä¸­æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><ul><li>zz_myisam_index.frmï¼šè¯¥æ–‡ä»¶ä¸­<strong>å­˜å‚¨è¡¨çš„ç»“æ„ä¿¡æ¯</strong>ã€‚</li><li>zz_myisam_index.MYDï¼šè¯¥æ–‡ä»¶ä¸­<strong>å­˜å‚¨è¡¨çš„è¡Œæ•°æ®</strong>ã€‚</li><li>zz_myisam_index.MYIï¼šè¯¥æ–‡ä»¶ä¸­<strong>å­˜å‚¨è¡¨çš„ç´¢å¼•æ•°æ®</strong>ã€‚</li></ul><h6 id="1-2-ä½¿ç”¨InnoDBå¼•æ“çš„è¡¨"><a href="#1-2-ä½¿ç”¨InnoDBå¼•æ“çš„è¡¨" class="headerlink" title="1.2 ä½¿ç”¨InnoDBå¼•æ“çš„è¡¨"></a>1.2 ä½¿ç”¨InnoDBå¼•æ“çš„è¡¨</h6><p>zz_innodb_indexè¿™å¼ è¡¨æ˜¯ä½¿ç”¨InnoDBå¼•æ“çš„è¡¨ï¼Œåœ¨ç£ç›˜ä¸­ä»…æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p><ul><li>zz_innodb_index.frmï¼šè¯¥æ–‡ä»¶ä¸­å­˜å‚¨è¡¨çš„<strong>ç»“æ„ä¿¡æ¯</strong>ã€‚</li><li>zz_innodb_index.ibdï¼šè¯¥æ–‡ä»¶ä¸­å­˜å‚¨è¡¨çš„<strong>è¡Œæ•°æ®å’Œç´¢å¼•æ•°æ®</strong>ã€‚</li></ul><h5 id="2-ç´¢å¼•æ”¯æŒçš„å¯¹æ¯”"><a href="#2-ç´¢å¼•æ”¯æŒçš„å¯¹æ¯”" class="headerlink" title="2.ç´¢å¼•æ”¯æŒçš„å¯¹æ¯”"></a>2.ç´¢å¼•æ”¯æŒçš„å¯¹æ¯”</h5><ul><li>å› ä¸ºMyISAMå¼•æ“åœ¨è®¾è®¡ä¹‹åˆï¼Œä¼šå°†è¡¨åˆ†ä¸º.frmã€.MYDã€.MYIä¸‰ä¸ªæ–‡ä»¶æ”¾åœ¨ç£ç›˜å­˜å‚¨ï¼Œ<strong>è¡¨æ•°æ®å’Œç´¢å¼•æ•°æ®æ˜¯åˆ†åˆ«æ”¾åœ¨.MYDã€.MYIæ–‡ä»¶ä¸­</strong>ï¼Œæ‰€ä»¥æ³¨å®šäº†<u>MyISAMå¼•æ“åªæ”¯æŒéèšç°‡ç´¢å¼•</u>ã€‚</li><li>è€ŒInnoDBå¼•æ“çš„<strong>è¡¨æ•°æ®ã€ç´¢å¼•æ•°æ®éƒ½æ”¾åœ¨.ibdæ–‡ä»¶ä¸­å­˜å‚¨</strong>ï¼Œå› æ­¤<u>InnoDBæ˜¯æ”¯æŒèšç°‡ç´¢å¼•</u>çš„ã€‚</li></ul><p><strong>èšç°‡ç´¢å¼•çš„è¦æ±‚</strong>æ˜¯ï¼šç´¢å¼•é”®å’Œè¡Œæ•°æ®å¿…é¡»åœ¨ç‰©ç†ç©ºé—´ä¸Šä¹Ÿæ˜¯è¿ç»­çš„ï¼Œè€ŒMyISAMè¡¨æ•°æ®å’Œç´¢å¼•æ•°æ®ï¼Œåˆ†åˆ«ä½äºä¸¤ä¸ªç£ç›˜æ–‡ä»¶ä¸­ï¼Œè¿™ä¹Ÿå°±æ³¨å®šäº†å®ƒæ— æ³•æ»¡è¶³èšç°‡ç´¢å¼•çš„è¦æ±‚ã€‚</p><p>ä½†<strong>ä¸æ”¯æŒèšç°‡ç´¢å¼•ä¹Ÿæœ‰å¥½å¤„</strong>ï¼Œä¹Ÿå°±æ˜¯<u>æ— è®ºèµ°ä»»ä½•ç´¢å¼•ï¼Œéƒ½åªéœ€è¦ä¸€éæŸ¥è¯¢å³å¯è·å¾—æ•°æ®</u>ï¼Œè€ŒInnoDBå¼•æ“çš„è¡¨ä¸­ï¼Œ<u>å¦‚æœä¸èµ°èšç°‡ï¼ˆä¸»é”®ï¼‰ç´¢å¼•æŸ¥è¯¢æ•°æ®ï¼Œèµ°å…¶ä»–ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œéƒ½éœ€è¦ç»è¿‡ä¸¤éï¼ˆå›è¡¨ï¼‰æŸ¥è¯¢æ‰èƒ½è·å¾—æ•°æ®ã€‚</u></p><h5 id="3-äº‹åŠ¡æœºåˆ¶çš„å¯¹æ¯”"><a href="#3-äº‹åŠ¡æœºåˆ¶çš„å¯¹æ¯”" class="headerlink" title="3.äº‹åŠ¡æœºåˆ¶çš„å¯¹æ¯”"></a>3.äº‹åŠ¡æœºåˆ¶çš„å¯¹æ¯”</h5><ul><li><strong>InnoDBå¼•æ“ä¸­æœ‰ä¸¤ä¸ªè‡ªå·±ä¸“äº«çš„æ—¥å¿—ï¼Œå³ undo-logã€redo-log</strong>ï¼Œä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“çš„è¡¨ï¼Œå¯ä»¥å€ŸåŠ©undo-logæ—¥å¿—å®ç°äº‹åŠ¡æœºåˆ¶ï¼Œæ”¯æŒå¤šæ¡SQLç»„æˆä¸€ä¸ªäº‹åŠ¡ï¼Œå¯ä»¥ä¿è¯å‘ç”Ÿå¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œç»„æˆè¿™ä¸ªäº‹åŠ¡çš„SQLåˆ°åº•å›æ»šè¿˜æ˜¯æäº¤ã€‚</li><li>è€ŒMyISAMå¹¶æœªè®¾è®¡ç±»ä¼¼çš„æŠ€æœ¯ï¼Œåœ¨å¯åŠ¨æ—¶ä¸ä¼šåœ¨å†…å­˜ä¸­æ„å»ºundo_log_bufferç¼“å†²åŒºï¼Œç£ç›˜ä¸­ä¹Ÿæ²¡æœ‰ç›¸åº”çš„æ—¥å¿—æ–‡ä»¶ï¼Œå› æ­¤MyISAMå¹¶<strong>ä¸æ”¯æŒäº‹åŠ¡æœºåˆ¶</strong></li></ul><p>&#x3D;&#x3D;&#x3D;&#x3D;&gt; ä¸€ä¸ªå¼•æ“æ˜¯å¦æ”¯æŒäº‹åŠ¡ï¼Œè¿™ç‚¹å°¤ä¸ºé‡è¦</p><h5 id="4-æ•…éšœæ¢å¤çš„å¯¹æ¯”"><a href="#4-æ•…éšœæ¢å¤çš„å¯¹æ¯”" class="headerlink" title="4.æ•…éšœæ¢å¤çš„å¯¹æ¯”"></a>4.æ•…éšœæ¢å¤çš„å¯¹æ¯”</h5><ul><li>InnoDBåœ¨å¯åŠ¨æ—¶ï¼ŒåŒæ ·ä¼šåœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ªredo_log_bufferç¼“å†²åŒºï¼Œåœ¨ç£ç›˜ä¸­ä¹Ÿä¼šæœ‰ç›¸åº”çš„redo-logæ—¥å¿—æ–‡ä»¶ï¼Œæ‰€ä»¥å½“ä¸€æ¡æˆ–å¤šæ¡SQLè¯­å¥æ‰§è¡ŒæˆåŠŸåï¼Œä¸è®ºMySQLåœ¨ä½•æ—¶å®•æœºï¼Œ<strong>åªè¦è¿™ä¸ªäº‹åŠ¡æäº¤äº†ï¼ŒInnoDBå¼•æ“éƒ½èƒ½ç¡®ä¿è¯¥äº‹åŠ¡çš„æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œä¹Ÿå°±ä»¥æ­¤ä¿éšœäº†äº‹åŠ¡çš„æŒä¹…æ€§ã€‚</strong></li><li>ä½†MyISAMå¼•æ“åŒæ ·<strong>æ²¡æœ‰redo-logæ—¥å¿—ï¼Œæ‰€ä»¥å¹¶ä¸æ”¯æŒæ•°æ®çš„æ•…éšœæ¢å¤</strong>ï¼Œå¦‚æœè¡¨æ˜¯ä½¿ç”¨MyISAMå¼•æ“åˆ›å»ºçš„ï¼Œå½“ä¸€æ¡SQLå°†æ•°æ®å†™å…¥åˆ°äº†ç¼“å†²åŒºåï¼ŒSQLè¿˜æœªè¢«å†™åˆ°bin-logæ—¥å¿—ï¼Œæ­¤æ—¶æœºå™¨æ–­ç”µã€DBå®•æœºäº†ï¼Œé‡å¯ä¹‹åç”±äºæ•°æ®åœ¨å®•æœºå‰è¿˜æœªè½ç›˜ï¼Œæ‰€ä»¥ä¸¢äº†ä¹Ÿå°±æ— æ³•æ‰¾å›ã€‚</li></ul><h5 id="5-é”ç²’åº¦çš„å¯¹æ¯”"><a href="#5-é”ç²’åº¦çš„å¯¹æ¯”" class="headerlink" title="5.é”ç²’åº¦çš„å¯¹æ¯”"></a>5.é”ç²’åº¦çš„å¯¹æ¯”</h5><p>MyISAMä»…æ”¯æŒè¡¨é”ï¼Œè€ŒInnoDBåŒæ—¶æ”¯æŒè¡¨é”ã€è¡Œé”ï¼Œä½†ä¸ºå•¥MyISAMå¼•æ“ä¸æ”¯æŒè¡Œé”å‘¢ï¼Ÿä¸æ˜¯ä¸æƒ³ï¼Œè€Œæ˜¯åšä¸åˆ°!</p><p>â€”-ç”±äºMyISAMæ¯ä¸ªç´¢å¼•éƒ½ä¼šå¯¹åº”ä¸€æ£µB+æ ‘ï¼Œé‚£ä¹ˆå¯¹å¯èƒ½å¯¼è‡´åŸºäºä¸åŒç´¢å¼•æŸ¥è¯¢æ•°æ®æ—¶ï¼Œä¸€è¡Œæ•°æ®ä¸ŠåŠ å¤šä¸ªé”ï¼Œå¯¼è‡´é”å¤±æ•ˆã€‚</p><h5 id="6-å¹¶å‘æ€§èƒ½çš„å¯¹æ¯”"><a href="#6-å¹¶å‘æ€§èƒ½çš„å¯¹æ¯”" class="headerlink" title="6.å¹¶å‘æ€§èƒ½çš„å¯¹æ¯”"></a>6.å¹¶å‘æ€§èƒ½çš„å¯¹æ¯”</h5><p>â€‹MyISAMä»…æ”¯æŒè¡¨é”ï¼ŒInnoDBåŒæ—¶æ”¯æŒè¡¨é”ã€è¡Œé”ï¼Œç”±äºè¿™ç‚¹åŸå› ï¼Œå…¶å®<strong>InnoDBå¼•æ“çš„å¹¶å‘æ”¯æŒæ€§æ—©å·²è¿œè¶…MyISAMäº†ï¼Œæ¯•ç«Ÿé”çš„ç²’åº¦è¶Šå°ï¼Œå¹¶å‘å†²çªçš„æ¦‚ç‡ä¹Ÿå°±è¶Šä½ï¼Œå› æ­¤å¹¶å‘æ”¯æ’‘å°±è¶Šé«˜ã€‚</strong></p><h5 id="7-å†…å­˜åˆ©ç”¨åº¦çš„å¯¹æ¯”"><a href="#7-å†…å­˜åˆ©ç”¨åº¦çš„å¯¹æ¯”" class="headerlink" title="7.å†…å­˜åˆ©ç”¨åº¦çš„å¯¹æ¯”"></a>7.å†…å­˜åˆ©ç”¨åº¦çš„å¯¹æ¯”</h5><p>InnoDBå¼•æ“çš„åˆ›å§‹äººHeikki Tuuriæ—©æ—©æƒ³åˆ°äº†è¿™ç‚¹ï¼Œé€šè¿‡ç¼“å†²æ± ç»“åˆå¼‚æ­¥IOæŠ€æœ¯ï¼Œæ´»ç”Ÿç”Ÿå°†ä¸€æ¬¾åŸºäºç£ç›˜çš„å¼•æ“ï¼Œæ¼”å˜æˆäº†åŠå†…å­˜å¼çš„å¼•æ“ã€‚åè§‚MyISAMå¼•æ“ï¼Œå†…éƒ¨è™½ç„¶ä¹Ÿæœ‰ç¼“å†²æ± ä»¥åŠå¼‚æ­¥IOæŠ€æœ¯ï¼Œä½†å¯¹å†…å­˜çš„å¼€å‘åº¦è¿œä¸è¶³äºInnoDBå¼•æ“ï¼Œè¿è¡ŒæœŸé—´å¤§é‡æ“ä½œä¾æ—§ä¼šèµ°ç£ç›˜å®Œæˆã€‚</p><p>â€”-InnoDBå¼•æ“çš„å†…å­˜åˆ©ç”¨ç‡å¾ˆé«˜</p><h4 id="ğŸŒŸä¸ºä»€ä¹ˆInnoDBä»£æ›¿äº†MyISAMï¼Ÿ"><a href="#ğŸŒŸä¸ºä»€ä¹ˆInnoDBä»£æ›¿äº†MyISAMï¼Ÿ" class="headerlink" title="ğŸŒŸä¸ºä»€ä¹ˆInnoDBä»£æ›¿äº†MyISAMï¼Ÿ"></a>ğŸŒŸä¸ºä»€ä¹ˆInnoDBä»£æ›¿äº†MyISAMï¼Ÿ</h4><p>â‘ å­˜å‚¨æ–¹å¼ï¼š<code>MyISAM</code>å¼•æ“ä¼šå°†è¡¨æ•°æ®å’Œç´¢å¼•æ•°æ®åˆ†æˆä¸¤ä¸ªæ–‡ä»¶å­˜å‚¨ã€‚</p><p>â‘¡ç´¢å¼•æ”¯æŒï¼šå› ä¸º<code>MyISAM</code>å¼•æ“çš„è¡¨æ•°æ®å’Œç´¢å¼•æ•°æ®æ˜¯åˆ†å¼€çš„ï¼Œå› æ­¤ä¸æ”¯æŒèšç°‡ç´¢å¼•ã€‚</p><p>â‘¢äº‹åŠ¡æ”¯æŒï¼šç”±äº<code>MyISAM</code>å¼•æ“æ²¡æœ‰<code>undo-log</code>æ—¥å¿—ï¼Œæ‰€ä»¥ä¸æ”¯æŒå¤šæ¡<code>SQL</code>ç»„æˆäº‹åŠ¡å¹¶å›æ»šã€‚</p><p>â‘£æ•…éšœæ¢å¤ï¼š<code>MyISAM</code>å¼•æ“ä¾é <code>bin-log</code>æ—¥å¿—å®ç°ï¼Œ<code>bin-log</code>ä¸­æœªå†™å…¥çš„æ•°æ®ä¼šæ°¸ä¹…ä¸¢å¤±ã€‚</p><p>â‘¤é”ç²’åº¦æ”¯æŒï¼šå› ä¸º<code>MyISAM</code>ä¸æ”¯æŒèšç°‡ç´¢å¼•ï¼Œå› æ­¤æ— æ³•å®ç°è¡Œé”ï¼Œæ‰€æœ‰å¹¶å‘æ“ä½œåªèƒ½åŠ è¡¨é”ã€‚</p><p>â‘¥å¹¶å‘æ€§èƒ½ï¼š<code>MyISAM</code>å¼•æ“ä»…æ”¯æŒè¡¨é”ï¼Œæ‰€ä»¥å¤šæ¡çº¿ç¨‹å‡ºç°è¯»-å†™å¹¶å‘åœºæ™¯æ—¶ä¼šé˜»å¡ã€‚</p><p>â‘¦å†…å­˜åˆ©ç”¨åº¦ï¼š<code>MyISAM</code>å¼•æ“è¿‡äºä¾èµ–<code>MySQL Server</code>ï¼Œå¯¹ç¼“å†²æ± ã€å¼‚æ­¥<code>IO</code>æŠ€æœ¯å¼€å‘åº¦ä¸å¤Ÿã€‚</p><h4 id="MyISAMå¼•æ“çš„å¯å–ä¹‹å¤„ï¼š"><a href="#MyISAMå¼•æ“çš„å¯å–ä¹‹å¤„ï¼š" class="headerlink" title="MyISAMå¼•æ“çš„å¯å–ä¹‹å¤„ï¼š"></a>MyISAMå¼•æ“çš„å¯å–ä¹‹å¤„ï¼š</h4><ol><li><p>ç»Ÿè®¡æ€»æ•°çš„ä¼˜åŒ–ï¼š</p><p>ä»…ä»…æ˜¯å¯¹äº<code>select count(*) from table_name;</code>è¿™æ¡è¯­å¥ï¼ŒMyISAMå¼•æ“æœ‰æ›´å¥½çš„è¡¨ç°â€”â€”å› ä¸ºå…¶ç»´æŠ¤äº†ä¸€ä¸ªå˜é‡â€”â€”å…¶å­˜å‚¨äº†è¡¨ä¸­çš„è®°å½•æ€»æ•°ï¼Œä»…æ­¤è€Œå·²ï¼Œä¸Šè¿°è¯­å¥æ·»åŠ ä»»ä½•æ¡ä»¶éƒ½ä¼šåŸå½¢æ¯•éœ²ã€‚</p></li><li><p>åˆ é™¤æ•°æ®&#x2F;è¡¨çš„ä¼˜åŒ–ï¼š</p></li></ol><p>â€‹å½“ä½¿ç”¨<code>delete</code>å‘½ä»¤æ¸…ç©ºè¡¨æ•°æ®æ—¶ï¼Œ<code>MyISAM</code>ä¼šç›´æ¥<strong>é‡æ–°åˆ›å»ºè¡¨æ•°æ®æ–‡ä»¶</strong>ï¼Œè€Œ<code>InnoDB</code>åˆ™æ˜¯ä¸€è¡Œè¡Œåˆ é™¤æ•°æ®ï¼Œå› æ­¤å¯¹äºæ¸…ç©ºè¡¨æ•°æ®çš„æ“ä½œï¼Œ<code>MyISAM</code>æ¯”<code>InnoDB</code>å¿«ä¸Šæ— æ•°å€ã€‚</p><p>â€‹åŒæ—¶<code>MyISAM</code>å¼•æ“çš„è¡¨ï¼Œå¯¹äº<code>delete</code>è¿‡çš„æ•°æ®ä¸ä¼šç«‹å³åˆ é™¤ï¼Œè€Œä¸”å…ˆéšè—èµ·æ¥ï¼Œåç»­å®šæ—¶åˆ é™¤æˆ–æ‰‹åŠ¨åˆ é™¤ï¼Œ</p><ol start="3"><li>CRUDé€Ÿåº¦æ›´å¿«</li></ol><p>â€‹<code>InnoDB</code>çš„èšç°‡ç´¢å¼•ï¼Œä¼šå½±å“è¯»å†™æ•°æ®çš„æ€§èƒ½ï¼šåŸºäºéèšç°‡ç´¢å¼•æŸ¥æ‰¾æ•°æ®ï¼Œå°±ç®—æŸ¥åˆ°äº†ä¹Ÿéœ€è¦ç»è¿‡ä¸€æ¬¡å›è¡¨æ‰èƒ½å¾—åˆ°æ•°æ®ï¼ŒåŒæ—¶æ’å…¥æ•°æ®ã€ä¿®æ”¹æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦ç»´æŠ¤èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ä¹‹é—´çš„å…³ç³»</p><p>â€‹è€Œ<code>MyISAM</code>å¼•æ“ä¸­ï¼Œæ‰€æœ‰å·²åˆ›å»ºçš„ç´¢å¼•éƒ½æ˜¯éèšç°‡ç´¢å¼•ï¼Œæ¯ä¸ªç´¢å¼•ä¹‹é—´éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œåœ¨ç´¢å¼•ä¸­å­˜å‚¨çš„æ˜¯ç›´æ¥æŒ‡å‘è¡Œæ•°æ®çš„åœ°å€ï¼Œè€Œå¹¶éèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®ï¼Œå› æ­¤æ— è®ºèµ°ä»»ä½•ç´¢å¼•ï¼Œéƒ½ä»…éœ€ä¸€æ¬¡å³å¯è·å¾—æ•°æ®ï¼Œæ— éœ€åšå›è¡¨æŸ¥è¯¢ã€‚</p><p><strong>but</strong>ï¼šä»¥å•è¿æ¥çš„æ–¹å¼æµ‹è¯•ï¼Œç¡®å®<code>MyISAM</code>ä¼šè¿œè¶…<code>InnoDB</code>ï¼Œæ¯•ç«Ÿå•ä¸ªè¿æ¥æ„å‘³ç€åªæœ‰ä¸€æ¡çº¿ç¨‹ï¼Œä¸€æ¡çº¿ç¨‹å°±ä¸ä¼šå‡ºç°é”ç«äº‰ï¼Œè¡¨é”ä¼šä¸€ç›´ç”±è¿™æ¡çº¿ç¨‹æŒæœ‰ã€‚ä½†æ˜¯åœ¨å¤šè¿æ¥çš„æƒ…å†µä¸‹ï¼Œç”±äºMyISAMåªæ”¯æŒè¡¨é”ï¼Œå› æ­¤æ€§èƒ½ä¼šå¤§å¤§é™ä½ï¼Œè¿œä½äºInnoDBï¼</p><h2 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h2><h3 id="ä¸€è¡Œè®°å½•çš„å­˜å‚¨æ ¼å¼"><a href="#ä¸€è¡Œè®°å½•çš„å­˜å‚¨æ ¼å¼" class="headerlink" title="ä¸€è¡Œè®°å½•çš„å­˜å‚¨æ ¼å¼"></a>ä¸€è¡Œè®°å½•çš„å­˜å‚¨æ ¼å¼</h3><h4 id="MySQL-çš„æ•°æ®å­˜æ”¾åœ¨å“ªä¸ªæ–‡ä»¶ï¼Ÿ"><a href="#MySQL-çš„æ•°æ®å­˜æ”¾åœ¨å“ªä¸ªæ–‡ä»¶ï¼Ÿ" class="headerlink" title="MySQL çš„æ•°æ®å­˜æ”¾åœ¨å“ªä¸ªæ–‡ä»¶ï¼Ÿ"></a>MySQL çš„æ•°æ®å­˜æ”¾åœ¨å“ªä¸ªæ–‡ä»¶ï¼Ÿ</h4><p>â€”-MySQL å­˜å‚¨çš„è¡Œä¸ºæ˜¯ç”±å­˜å‚¨å¼•æ“å®ç°çš„ï¼ŒMySQL æ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œ<strong>ä¸åŒçš„å­˜å‚¨å¼•æ“ä¿å­˜çš„æ–‡ä»¶è‡ªç„¶ä¹Ÿä¸åŒ</strong></p><p>æœ¬å°èŠ‚é’ˆå¯¹InnoDBå±•å¼€è®¨è®ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æˆ‘ä»¬å¯ä»¥åœ¨MySQLä¸­ä½¿ç”¨ä¸‹é¢çš„æŒ‡ä»¤æ¥è·å–mysqlå­˜å‚¨è¡¨ä¿¡æ¯çš„è·¯å¾„ï¼Œæ‰€æœ‰çš„è¡¨ç»“æ„å’Œè¡¨æ•°æ®éƒ½ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;datadir&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¿›å…¥è¯¥ç›®å½•ï¼Œmysqlä¸­çš„æ¯ä¸ªæ•°æ®åº“éƒ½ä¼šåœ¨è¯¥ç›®å½•ä¸­å¯¹åº”ä¸€ä¸ªå­ç›®å½•ï¼Œè¿›å…¥æ•°æ®åº“å¯¹åº”çš„å­ç›®å½•ï¼Œæˆ‘ä»¬å‘ç°å…¶ä¸­ç»“æ„ä¸ºï¼š</p><ul><li><strong>db.opt</strong> : å­˜æ”¾å½“å‰æ•°æ®åº“çš„é»˜è®¤å­—ç¬¦é›†å’Œå­—idbç¬¦æ ¡éªŒè§„åˆ™</li><li><strong>è¡¨å.frm</strong> : <strong>è¡¨ç»“æ„</strong>ä¼šä¿å­˜åœ¨è¿™ä¸ªæ–‡ä»¶ã€‚åœ¨ <u>MySQL ä¸­å»ºç«‹ä¸€å¼ è¡¨éƒ½ä¼šç”Ÿæˆä¸€ä¸ª.frm æ–‡ä»¶</u>ï¼Œè¯¥æ–‡ä»¶æ˜¯ç”¨æ¥ä¿å­˜æ¯ä¸ªè¡¨çš„å…ƒæ•°æ®ä¿¡æ¯çš„ï¼Œä¸»è¦åŒ…å«è¡¨ç»“æ„å®šä¹‰ã€‚ </li><li><strong>è¡¨å.ibd</strong> : <strong>è¡¨æ•°æ®</strong>ä¼šä¿å­˜åœ¨è¿™ä¸ªæ–‡ä»¶ï¼ŒInnoDBå¼•æ“é»˜è®¤å°†æ¯ä¸ªè¡¨çš„<u>æ•°æ®</u>åˆ†å¼€å­˜æ”¾ï¼Œ <strong>è¡¨å.ibd æ–‡ä»¶ä¹Ÿç§°ä¸ºç‹¬å è¡¨ç©ºé—´æ–‡ä»¶</strong></li></ul><h5 id="è¡¨ç©ºé—´æ–‡ä»¶-å­˜æ”¾è¡¨ä¸­æ•°æ®çš„æ–‡ä»¶-çš„ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ"><a href="#è¡¨ç©ºé—´æ–‡ä»¶-å­˜æ”¾è¡¨ä¸­æ•°æ®çš„æ–‡ä»¶-çš„ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ" class="headerlink" title="è¡¨ç©ºé—´æ–‡ä»¶(å­˜æ”¾è¡¨ä¸­æ•°æ®çš„æ–‡ä»¶)çš„ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ"></a>è¡¨ç©ºé—´æ–‡ä»¶(å­˜æ”¾è¡¨ä¸­æ•°æ®çš„æ–‡ä»¶)çš„ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</h5><p>â€‹<strong>è¡¨ç©ºé—´ç”±æ®µï¼ˆsegmentï¼‰ã€åŒºï¼ˆextentï¼‰ã€é¡µï¼ˆpageï¼‰ã€è¡Œï¼ˆrowï¼‰ç»„æˆ</strong>ï¼ŒInnoDBå­˜å‚¨å¼•æ“çš„é€»è¾‘å­˜å‚¨ç»“æ„å¤§è‡´å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230730144124140.png" alt="image-20230730144124140"></p><h6 id="1ã€è¡Œï¼ˆrowï¼‰"><a href="#1ã€è¡Œï¼ˆrowï¼‰" class="headerlink" title="1ã€è¡Œï¼ˆrowï¼‰"></a>1ã€è¡Œï¼ˆrowï¼‰</h6><p>æ•°æ®åº“è¡¨ä¸­çš„è®°å½•éƒ½æ˜¯æŒ‰è¡Œï¼ˆrowï¼‰è¿›è¡Œå­˜æ”¾çš„ï¼Œæ¯è¡Œè®°å½•æ ¹æ®ä¸åŒçš„è¡Œæ ¼å¼ï¼Œæœ‰ä¸åŒçš„å­˜å‚¨ç»“æ„ã€‚</p><h6 id="2ã€é¡µï¼ˆpageï¼‰"><a href="#2ã€é¡µï¼ˆpageï¼‰" class="headerlink" title="2ã€é¡µï¼ˆpageï¼‰"></a>2ã€é¡µï¼ˆpageï¼‰</h6><p>è®°å½•æ˜¯æŒ‰ç…§è¡Œæ¥å­˜å‚¨çš„ï¼Œä½†æ˜¯æ•°æ®åº“çš„è¯»å–å¹¶ä¸ä»¥ã€Œè¡Œã€ä¸ºå•ä½ï¼Œå¦åˆ™ä¸€æ¬¡è¯»å–ï¼ˆä¹Ÿå°±æ˜¯ä¸€æ¬¡ I&#x2F;O æ“ä½œï¼‰åªèƒ½å¤„ç†ä¸€è¡Œæ•°æ®ï¼Œæ•ˆç‡ä¼šéå¸¸ä½ã€‚</p><p>å› æ­¤ï¼Œ<strong>InnoDB çš„æ•°æ®æ˜¯æŒ‰ã€Œé¡µã€ä¸ºå•ä½æ¥è¯»å†™çš„</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“éœ€è¦è¯»ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯å°†è¿™ä¸ªè¡Œè®°å½•ä»ç£ç›˜è¯»å‡ºæ¥ï¼Œè€Œæ˜¯ä»¥é¡µä¸ºå•ä½ï¼Œå°†å…¶æ•´ä½“è¯»å…¥å†…å­˜ã€‚</p><p><strong>é»˜è®¤æ¯ä¸ªé¡µçš„å¤§å°ä¸º 16KB</strong>ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šèƒ½ä¿è¯ 16KB çš„è¿ç»­å­˜å‚¨ç©ºé—´ã€‚</p><p>é¡µæ˜¯ InnoDB å­˜å‚¨å¼•æ“ç£ç›˜ç®¡ç†çš„æœ€å°å•å…ƒï¼Œæ„å‘³ç€æ•°æ®åº“æ¯æ¬¡è¯»å†™éƒ½æ˜¯ä»¥ 16KB ä¸ºå•ä½çš„ï¼Œä¸€æ¬¡æœ€å°‘ä»ç£ç›˜ä¸­è¯»å– 16K çš„å†…å®¹åˆ°å†…å­˜ä¸­ï¼Œä¸€æ¬¡æœ€å°‘æŠŠå†…å­˜ä¸­çš„ 16K å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚</p><h6 id="3ã€åŒºï¼ˆextentï¼‰"><a href="#3ã€åŒºï¼ˆextentï¼‰" class="headerlink" title="3ã€åŒºï¼ˆextentï¼‰"></a>3ã€åŒºï¼ˆextentï¼‰</h6><p>æˆ‘ä»¬çŸ¥é“ InnoDB å­˜å‚¨å¼•æ“æ˜¯ç”¨ B+ æ ‘æ¥ç»„ç»‡æ•°æ®çš„ã€‚</p><p>B+ æ ‘ä¸­æ¯ä¸€å±‚éƒ½æ˜¯é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥èµ·æ¥çš„ï¼Œå¦‚æœæ˜¯ä»¥é¡µä¸ºå•ä½æ¥åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œé‚£ä¹ˆé“¾è¡¨ä¸­ç›¸é‚»çš„ä¸¤ä¸ªé¡µä¹‹é—´çš„ç‰©ç†ä½ç½®å¹¶ä¸æ˜¯è¿ç»­çš„ï¼Œå¯èƒ½ç¦»å¾—éå¸¸è¿œï¼Œé‚£ä¹ˆç£ç›˜æŸ¥è¯¢æ—¶å°±ä¼šæœ‰å¤§é‡çš„éšæœºI&#x2F;Oï¼Œéšæœº I&#x2F;O æ˜¯éå¸¸æ…¢çš„ã€‚</p><p>è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯è®©é“¾è¡¨ä¸­ç›¸é‚»çš„é¡µçš„ç‰©ç†ä½ç½®ä¹Ÿç›¸é‚»ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨é¡ºåº I&#x2F;O äº†ï¼Œé‚£ä¹ˆåœ¨èŒƒå›´æŸ¥è¯¢ï¼ˆæ‰«æå¶å­èŠ‚ç‚¹ï¼‰çš„æ—¶å€™æ€§èƒ½å°±ä¼šå¾ˆé«˜ã€‚</p><p>é‚£å…·ä½“æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p><strong>åœ¨è¡¨ä¸­æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œä¸ºæŸä¸ªç´¢å¼•åˆ†é…ç©ºé—´çš„æ—¶å€™å°±ä¸å†æŒ‰ç…§é¡µä¸ºå•ä½åˆ†é…äº†ï¼Œè€Œæ˜¯æŒ‰ç…§åŒºï¼ˆextentï¼‰ä¸ºå•ä½åˆ†é…ã€‚æ¯ä¸ªåŒºçš„å¤§å°ä¸º 1MBï¼Œå¯¹äº 16KB çš„é¡µæ¥è¯´ï¼Œè¿ç»­çš„ 64 ä¸ªé¡µä¼šè¢«åˆ’ä¸ºä¸€ä¸ªåŒºï¼Œè¿™æ ·å°±ä½¿å¾—é“¾è¡¨ä¸­ç›¸é‚»çš„é¡µçš„ç‰©ç†ä½ç½®ä¹Ÿç›¸é‚»ï¼Œå°±èƒ½ä½¿ç”¨é¡ºåº I&#x2F;O äº†</strong>ã€‚</p><h6 id="4ã€æ®µï¼ˆsegmentï¼‰"><a href="#4ã€æ®µï¼ˆsegmentï¼‰" class="headerlink" title="4ã€æ®µï¼ˆsegmentï¼‰"></a>4ã€æ®µï¼ˆsegmentï¼‰</h6><p>è¡¨ç©ºé—´æ˜¯ç”±å„ä¸ªæ®µï¼ˆsegmentï¼‰ç»„æˆçš„ï¼Œæ®µæ˜¯ç”±å¤šä¸ªåŒºï¼ˆextentï¼‰ç»„æˆçš„ã€‚æ®µä¸€èˆ¬åˆ†ä¸ºæ•°æ®æ®µã€ç´¢å¼•æ®µå’Œå›æ»šæ®µç­‰ã€‚</p><ul><li><strong>ç´¢å¼•æ®µ</strong>ï¼šå­˜æ”¾ B + æ ‘çš„éå¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆï¼›</li><li><strong>æ•°æ®æ®µ</strong>ï¼šå­˜æ”¾ B + æ ‘çš„å¶å­èŠ‚ç‚¹çš„åŒºçš„é›†åˆï¼›</li><li><strong>å›æ»šæ®µ</strong>ï¼šå­˜æ”¾çš„æ˜¯å›æ»šæ•°æ®çš„åŒºçš„é›†åˆï¼›</li></ul><h4 id="InnoDB-è¡Œæ ¼å¼å­¦ä¹ ï¼š"><a href="#InnoDB-è¡Œæ ¼å¼å­¦ä¹ ï¼š" class="headerlink" title="InnoDB è¡Œæ ¼å¼å­¦ä¹ ï¼š"></a>InnoDB è¡Œæ ¼å¼å­¦ä¹ ï¼š</h4><p><u>è¡Œæ ¼å¼ï¼ˆrow_formatï¼‰ï¼Œå°±æ˜¯ä¸€æ¡è®°å½•çš„å­˜å‚¨ç»“æ„ã€‚</u></p><p><strong>COMPACTè¡Œæ ¼å¼</strong>â€”â€”æ˜¯ä¸€ç§ç´§å‡‘çš„è¡Œæ ¼å¼ï¼Œè®¾è®¡çš„åˆè¡·å°±æ˜¯ä¸ºäº†è®©ä¸€ä¸ªæ•°æ®é¡µä¸­å¯ä»¥å­˜æ”¾æ›´å¤šçš„è¡Œè®°å½•ï¼Œä» MySQL 5.1 ç‰ˆæœ¬ä¹‹åï¼Œè¡Œæ ¼å¼é»˜è®¤è®¾ç½®æˆ Compactã€‚</p><p>å…¶ä»–è¡Œæ ¼å¼è¦ä¹ˆå°±æ˜¯å¤ªè½åå·²ç»è¢«æ·˜æ±°ã€è¦ä¹ˆå°±æ˜¯åœ¨COMPACTæ ¼å¼ä¸Šè¿›è¡Œå¢å¼ºï¼Œæ‰€ä»¥é€‰æ‹©äº†è§£<strong>COMPACT</strong>è¡Œæ ¼å¼ã€‚</p><h5 id="COMPACTè¡Œæ ¼å¼ï¼š"><a href="#COMPACTè¡Œæ ¼å¼ï¼š" class="headerlink" title="COMPACTè¡Œæ ¼å¼ï¼š"></a>COMPACTè¡Œæ ¼å¼ï¼š</h5><p>â€‹<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230730145223318.png" alt="image-20230730145223318"></p><h6 id="1-å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨"><a href="#1-å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨" class="headerlink" title="1. å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨"></a>1. å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨</h6><ul><li><p>ã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€åªå‡ºç°åœ¨<strong>æ•°æ®è¡¨æœ‰å˜é•¿å­—æ®µçš„æ—¶å€™</strong></p></li><li><p>æ ¹æ®åˆ—çš„é¡ºåºï¼Œ<strong>é€†åº</strong>å­˜æ”¾æ¯æ¡è®°å½•ä¸­å„ä¸ªå˜é•¿å­—æ®µçš„çœŸå®é•¿åº¦</p></li></ul><p>â€” ğŸŒŸä¸ºä»€ä¹ˆè¦é€†åºï¼Ÿ</p><ol><li><p>ã€Œè®°å½•å¤´ä¿¡æ¯ã€ä¸­æŒ‡å‘ä¸‹ä¸€ä¸ªè®°å½•çš„æŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯ä¸‹ä¸€æ¡è®°å½•çš„<strong>ã€Œè®°å½•å¤´ä¿¡æ¯ã€å’Œã€ŒçœŸå®æ•°æ®ã€ä¹‹é—´çš„ä½ç½®</strong>ï¼Œè¿™æ ·å‘å·¦è¯»å°±æ˜¯è®°å½•å¤´ä¿¡æ¯ï¼Œå‘å³è¯»å°±æ˜¯çœŸå®æ•°æ®ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚</p></li><li><p>ã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€ä¸­çš„ä¿¡æ¯ä¹‹æ‰€ä»¥è¦é€†åºå­˜æ”¾ï¼Œæ˜¯å› ä¸ºè¿™æ ·å¯ä»¥<strong>ä½¿å¾—ä½ç½®é å‰çš„è®°å½•çš„çœŸå®æ•°æ®å’Œæ•°æ®å¯¹åº”çš„å­—æ®µé•¿åº¦ä¿¡æ¯å¯ä»¥åŒæ—¶åœ¨ä¸€ä¸ª CPU Cache Line ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥æé«˜ CPU Cache çš„å‘½ä¸­ç‡</strong>ã€‚</p></li><li><p>ğŸ§ <u><em>é€šä¿—æ˜“æ‡‚ï¼Œä½†ä¸å‡†ç¡®çš„è¯´æ˜</em></u>ï¼š ä½ åˆå§‹æŒ‡å‘çš„æ˜¯ä¸­é—´çš„ä½ç½®ï¼Œå¾€å·¦ä¸€æ ¼æ›´å®¹æ˜“è¯»åˆ°å­—æ®µé•¿åº¦ä¿¡æ¯ï¼Œå¾€å³ä¸€æ ¼èƒ½å¤Ÿè¯»åˆ°è¯¥å­—æ®µçš„çœŸå®æ•°æ®ä¿¡æ¯(ä»ä¸­é—´å‘ä¸¤è¾¹æ‰©å¼ åœ°è¯»å–ï¼Œæ›´å®¹æ˜“åˆ©ç”¨åŒä¸€ä¸ªæŒ‡é’ˆå®ç°åœ¨ä¸€æ¬¡æŒ‡é’ˆç§»åŠ¨ï¼Œè¯»åˆ°åŒä¸€å­—æ®µçš„æ•°æ® &amp; é•¿åº¦ä¿¡æ¯)</p></li></ol><p>åŒæ ·çš„é“ç†ï¼Œ NULL å€¼åˆ—è¡¨çš„ä¿¡æ¯ä¹Ÿéœ€è¦é€†åºå­˜æ”¾ã€‚</p><h6 id="2-NULL-å€¼åˆ—è¡¨"><a href="#2-NULL-å€¼åˆ—è¡¨" class="headerlink" title="2. NULL å€¼åˆ—è¡¨"></a>2. NULL å€¼åˆ—è¡¨</h6><p>NULL å€¼åˆ—è¡¨ä¹Ÿä¸æ˜¯å¿…é¡»çš„ã€‚</p><p><strong>å½“æ•°æ®è¡¨çš„å­—æ®µéƒ½å®šä¹‰æˆ NOT NULL çš„æ—¶å€™ï¼Œè¿™æ—¶å€™è¡¨é‡Œçš„è¡Œæ ¼å¼å°±ä¸ä¼šæœ‰ NULL å€¼åˆ—è¡¨äº†</strong>ã€‚</p><p>æ‰€ä»¥åœ¨è®¾è®¡æ•°æ®åº“è¡¨çš„æ—¶å€™ï¼Œé€šå¸¸éƒ½æ˜¯å»ºè®®å°†å­—æ®µè®¾ç½®ä¸º NOT NULLï¼Œè¿™æ ·å¯ä»¥è‡³å°‘èŠ‚çœ 1 å­—èŠ‚çš„ç©ºé—´ï¼ˆNULL å€¼åˆ—è¡¨è‡³å°‘å ç”¨ 1 å­—èŠ‚ç©ºé—´ï¼‰ã€‚</p><p>è¡¨ä¸­çš„æŸäº›åˆ—å¯èƒ½ä¼šå­˜å‚¨ NULL å€¼ï¼Œå¦‚æœæŠŠè¿™äº› NULL å€¼éƒ½æ”¾åˆ°è®°å½•çš„çœŸå®æ•°æ®ä¸­ä¼šæ¯”è¾ƒæµªè´¹ç©ºé—´ï¼Œæ‰€ä»¥ Compact è¡Œæ ¼å¼æŠŠè¿™äº›å€¼ä¸º NULL çš„åˆ—å­˜å‚¨åˆ° NULLå€¼åˆ—è¡¨ä¸­ã€‚</p><p><u>å¦‚æœå­˜åœ¨å…è®¸ NULL å€¼çš„åˆ—ï¼Œåˆ™æ¯ä¸ªåˆ—å¯¹åº”ä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼ˆbitï¼‰</u>ï¼ŒäºŒè¿›åˆ¶ä½<strong>æŒ‰ç…§åˆ—çš„é¡ºåº<u>é€†åº</u>æ’åˆ—</strong>ã€‚</p><ul><li>äºŒè¿›åˆ¶ä½çš„å€¼ä¸º<code>1</code>æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸ºNULL</li><li>äºŒè¿›åˆ¶ä½çš„å€¼ä¸º<code>0</code>æ—¶ï¼Œä»£è¡¨è¯¥åˆ—çš„å€¼ä¸ä¸ºNULL</li></ul><p>NULL å€¼åˆ—è¡¨å¿…é¡»ç”¨æ•´æ•°ä¸ªå­—èŠ‚çš„ä½è¡¨ç¤ºï¼ˆ1å­—èŠ‚8ä½ï¼‰ï¼Œ<strong>å¦‚æœä½¿ç”¨çš„äºŒè¿›åˆ¶ä½ä¸ªæ•°ä¸è¶³æ•´æ•°ä¸ªå­—èŠ‚ï¼Œåˆ™åœ¨å­—èŠ‚çš„é«˜ä½è¡¥ 0</strong>â€”â€”â€“&gt;æ„æ€å°±æ˜¯ï¼Œå¦‚æœä½ çš„å…è®¸ä¸ºnullçš„å­—æ®µæ•°é‡ä¸è¶³8çš„å€æ•°ï¼Œä¹Ÿä¼šå¼€è¾Ÿ 8 çš„å€æ•°çš„ç©ºé—´æ¥å­˜å‚¨(é«˜ä½è¡¥0)ï¼Œå³InnoDBçš„åŸºæœ¬å­˜å‚¨å•å…ƒä¸º1B</p><h6 id="3-è®°å½•å¤´ä¿¡æ¯"><a href="#3-è®°å½•å¤´ä¿¡æ¯" class="headerlink" title="3. è®°å½•å¤´ä¿¡æ¯"></a>3. è®°å½•å¤´ä¿¡æ¯</h6><p>è®°å½•å¤´ä¿¡æ¯ä¸­åŒ…å«çš„å†…å®¹å¾ˆå¤šï¼Œä¸¾ä¾‹å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ï¼š</p><ul><li><strong>delete_mask</strong> ï¼šæ ‡è¯†æ­¤æ¡æ•°æ®æ˜¯å¦è¢«åˆ é™¤ã€‚ä»è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬æ‰§è¡Œ detele åˆ é™¤è®°å½•çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šçœŸæ­£çš„åˆ é™¤è®°å½•ï¼Œåªæ˜¯å°†è¿™ä¸ªè®°å½•çš„ delete_mask æ ‡è®°ä¸º 1ã€‚</li><li><strong>next_record</strong>ï¼šä¸‹ä¸€æ¡è®°å½•çš„ä½ç½®ã€‚ä»è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œè®°å½•ä¸è®°å½•ä¹‹é—´æ˜¯é€šè¿‡é“¾è¡¨ç»„ç»‡çš„ã€‚åœ¨å‰é¢æˆ‘ä¹Ÿæåˆ°äº†ï¼ŒæŒ‡å‘çš„æ˜¯ä¸‹ä¸€æ¡è®°å½•çš„ã€Œè®°å½•å¤´ä¿¡æ¯ã€å’Œã€ŒçœŸå®æ•°æ®ã€ä¹‹é—´çš„ä½ç½®ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å‘å·¦è¯»å°±æ˜¯è®°å½•å¤´ä¿¡æ¯ï¼Œå‘å³è¯»å°±æ˜¯çœŸå®æ•°æ®ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚</li><li><strong>record_type</strong>ï¼šè¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹ï¼Œ0è¡¨ç¤ºæ™®é€šè®°å½•ï¼Œ1è¡¨ç¤ºB+æ ‘éå¶å­èŠ‚ç‚¹è®°å½•ï¼Œ2è¡¨ç¤ºæœ€å°è®°å½•ï¼Œ3è¡¨ç¤ºæœ€å¤§è®°å½•</li></ul><h6 id="4-è®°å½•çš„çœŸå®æ•°æ®"><a href="#4-è®°å½•çš„çœŸå®æ•°æ®" class="headerlink" title="4. è®°å½•çš„çœŸå®æ•°æ®"></a>4. è®°å½•çš„çœŸå®æ•°æ®</h6><p>â€‹è®°å½•çœŸå®æ•°æ®éƒ¨åˆ†é™¤äº†æˆ‘ä»¬å®šä¹‰çš„å­—æ®µï¼Œè¿˜æœ‰**<u>ä¸‰ä¸ªéšè—å­—æ®µ</u><strong>ï¼Œåˆ†åˆ«ä¸ºï¼š</strong>row_idã€trx_idã€roll_pointer**ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸‰ä¸ªå­—æ®µæ˜¯ä»€ä¹ˆã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230730152307044.png" alt="image-20230730152307044"></p><ul><li>row_id</li></ul><p>â€‹å¦‚æœæˆ‘ä»¬å»ºè¡¨çš„æ—¶å€™æŒ‡å®šäº†ä¸»é”®æˆ–è€…å”¯ä¸€çº¦æŸåˆ—ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰ row_id éšè—å­—æ®µäº†ã€‚å¦‚æœæ—¢æ²¡æœ‰æŒ‡å®šä¸»é”®ï¼Œåˆæ²¡æœ‰å”¯ä¸€çº¦æŸï¼Œé‚£ä¹ˆ InnoDB å°±ä¼šä¸ºè®°å½•æ·»åŠ  row_id éšè—å­—æ®µã€‚row_id<strong>ä¸æ˜¯å¿…éœ€çš„</strong>ï¼Œå ç”¨ 6 ä¸ªå­—èŠ‚ã€‚</p><p>â€‹æ²¡æœ‰ä¸»é”®æˆ–å”¯ä¸€çº¦æŸåˆ—æ—¶ï¼Œä¼šè‡ªåŠ¨å¸®ä½ ç”Ÿæˆä¸€ä¸ªéšè—ä¸»é”®(ç”¨äºèšç°‡ç´¢å¼•ï¼)</p><ul><li>trx_id</li></ul><p>â€‹äº‹åŠ¡idï¼Œè¡¨ç¤º<strong>è¿™ä¸ªæ•°æ®æ˜¯ç”±å“ªä¸ªäº‹åŠ¡ç”Ÿæˆçš„</strong>ã€‚ trx_idæ˜¯<strong>å¿…éœ€çš„</strong>ï¼Œå ç”¨ 6 ä¸ªå­—èŠ‚ã€‚</p><ul><li>roll_pointer</li></ul><p>â€‹<strong>è¿™æ¡è®°å½•ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æŒ‡é’ˆ</strong>ã€‚roll_pointer æ˜¯<strong>å¿…éœ€çš„</strong>ï¼Œå ç”¨ 7 ä¸ªå­—èŠ‚ã€‚â€”â€”-åé¢æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè¿™ç”¨äºMVCCçš„å®ç°</p><h4 id="varchar-n-ä¸­-n-æœ€å¤§å–å€¼ä¸ºå¤šå°‘ï¼Ÿ"><a href="#varchar-n-ä¸­-n-æœ€å¤§å–å€¼ä¸ºå¤šå°‘ï¼Ÿ" class="headerlink" title="varchar(n) ä¸­ n æœ€å¤§å–å€¼ä¸ºå¤šå°‘ï¼Ÿ"></a>varchar(n) ä¸­ n æœ€å¤§å–å€¼ä¸ºå¤šå°‘ï¼Ÿ</h4><p>æˆ‘ä»¬è¦æ¸…æ¥šä¸€ç‚¹ï¼Œ<strong>MySQL è§„å®šé™¤äº† TEXTã€BLOBs è¿™ç§å¤§å¯¹è±¡ç±»å‹ä¹‹å¤–ï¼Œå…¶ä»–æ‰€æœ‰çš„åˆ—ï¼ˆä¸åŒ…æ‹¬éšè—åˆ—å’Œè®°å½•å¤´ä¿¡æ¯ï¼‰å ç”¨çš„å­—èŠ‚é•¿åº¦<u>åŠ èµ·æ¥</u>ä¸èƒ½è¶…è¿‡ 65535 ä¸ªå­—èŠ‚</strong>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€è¡Œè®°å½•é™¤äº† TEXTã€BLOBs ç±»å‹çš„åˆ—ï¼Œé™åˆ¶æœ€å¤§ä¸º 65535 å­—èŠ‚ï¼Œ<u>æ³¨æ„æ˜¯ä¸€è¡Œçš„æ€»é•¿åº¦</u>ï¼Œä¸æ˜¯ä¸€åˆ—ã€‚</p><p>çŸ¥é“äº†è¿™ä¸ªå‰æä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ªé—®é¢˜ï¼šã€Œvarchar(n) ä¸­ n æœ€å¤§å–å€¼ä¸ºå¤šå°‘ï¼Ÿã€</p><p>varchar(n) å­—æ®µç±»å‹çš„ n ä»£è¡¨çš„æ˜¯æœ€å¤šå­˜å‚¨çš„å­—ç¬¦æ•°é‡ï¼Œå¹¶ä¸æ˜¯å­—èŠ‚å¤§å°å“¦ã€‚</p><p>è¦ç®— varchar(n) æœ€å¤§èƒ½å…è®¸å­˜å‚¨çš„å­—èŠ‚æ•°ï¼Œè¿˜è¦çœ‹æ•°æ®åº“è¡¨çš„å­—ç¬¦é›†ï¼Œå› ä¸ºå­—ç¬¦é›†ä»£è¡¨ç€ï¼Œ1ä¸ªå­—ç¬¦è¦å ç”¨å¤šå°‘å­—èŠ‚ï¼Œæ¯”å¦‚ ascii å­—ç¬¦é›†ï¼Œ 1 ä¸ªå­—ç¬¦å ç”¨ 1 å­—èŠ‚ï¼Œé‚£ä¹ˆ varchar(100) æ„å‘³ç€æœ€å¤§èƒ½å…è®¸å­˜å‚¨ 100 å­—èŠ‚çš„æ•°æ®ã€‚</p><p>ç­”ï¼šä¸€æ¡è®°å½•æ‰€æœ‰å­—æ®µçš„ã€ŒçœŸå®æ•°æ® + å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ + NULLå€¼åˆ—è¡¨ã€é•¿åº¦å’Œ &lt;&#x3D; 65535 B</p><h4 id="è¡Œæº¢å‡ºåï¼ŒMySQL-æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ"><a href="#è¡Œæº¢å‡ºåï¼ŒMySQL-æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ" class="headerlink" title="è¡Œæº¢å‡ºåï¼ŒMySQL æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ"></a>è¡Œæº¢å‡ºåï¼ŒMySQL æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ</h4><p>MySQL ä¸­ç£ç›˜å’Œå†…å­˜äº¤äº’çš„åŸºæœ¬å•ä½æ˜¯é¡µï¼Œä¸€ä¸ªé¡µçš„å¤§å°ä¸€èˆ¬æ˜¯ <code>16KB</code>ï¼Œä¹Ÿå°±æ˜¯ <code>16384å­—èŠ‚</code>ï¼Œè€Œä¸€ä¸ª varchar(n) ç±»å‹çš„åˆ—æœ€å¤šå¯ä»¥å­˜å‚¨ <code>65532å­—èŠ‚</code>ï¼Œä¸€äº›å¤§å¯¹è±¡å¦‚ TEXTã€BLOB å¯èƒ½å­˜å‚¨æ›´å¤šçš„æ•°æ®ï¼Œè¿™æ—¶ä¸€ä¸ªé¡µå¯èƒ½å°±å­˜ä¸äº†ä¸€æ¡è®°å½•ã€‚è¿™ä¸ªæ—¶å€™å°±ä¼š<strong>å‘ç”Ÿè¡Œæº¢å‡ºï¼Œå¤šçš„æ•°æ®å°±ä¼šå­˜åˆ°å¦å¤–çš„ã€Œæº¢å‡ºé¡µã€ä¸­</strong>ã€‚</p><p>ğŸŒŸå½“å‘ç”Ÿè¡Œæº¢å‡ºæ—¶ï¼Œåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„åªä¼šä¿å­˜è¯¥åˆ—çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œè€ŒæŠŠå‰©ä½™çš„æ•°æ®æ”¾åœ¨ã€Œæº¢å‡ºé¡µã€ä¸­ï¼Œç„¶åçœŸå®æ•°æ®å¤„ç”¨ 20 å­—èŠ‚å­˜å‚¨æŒ‡å‘æº¢å‡ºé¡µçš„åœ°å€ï¼Œä»è€Œå¯ä»¥æ‰¾åˆ°å‰©ä½™æ•°æ®æ‰€åœ¨çš„é¡µã€‚å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230730153621037.png" alt="image-20230730153621037"></p><p>æ³¨æ„ï¼šCompressed å’Œ Dynamic è¿™ä¸¤ç§è¡Œæ ¼å¼(COMPACTçš„æ”¹è¿›ç‰ˆ)ï¼Œå®ƒä»¬å¯¹äºè¡Œæº¢å‡ºçš„å¤„ç†ä¸ºï¼š</p><ul><li>é‡‡ç”¨å®Œå…¨çš„è¡Œæº¢å‡ºæ–¹å¼ï¼Œè®°å½•çš„çœŸå®æ•°æ®å¤„ä¸ä¼šå­˜å‚¨è¯¥åˆ—çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œ<strong>åªå­˜å‚¨ 20 ä¸ªå­—èŠ‚çš„æŒ‡é’ˆæ¥æŒ‡å‘æº¢å‡ºé¡µï¼è€Œå®é™…çš„æ•°æ®éƒ½å­˜å‚¨åœ¨æº¢å‡ºé¡µä¸­ï¼›</strong></li></ul><h4 id="æ€»ç»“ï¼š-1"><a href="#æ€»ç»“ï¼š-1" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h4><h5 id="MySQL-çš„-NULL-å€¼æ˜¯æ€ä¹ˆå­˜æ”¾çš„ï¼Ÿ"><a href="#MySQL-çš„-NULL-å€¼æ˜¯æ€ä¹ˆå­˜æ”¾çš„ï¼Ÿ" class="headerlink" title="MySQL çš„ NULL å€¼æ˜¯æ€ä¹ˆå­˜æ”¾çš„ï¼Ÿ"></a>MySQL çš„ NULL å€¼æ˜¯æ€ä¹ˆå­˜æ”¾çš„ï¼Ÿ</h5><p>â€‹MySQL çš„ Compact è¡Œæ ¼å¼ä¸­ä¼šç”¨ã€ŒNULLå€¼åˆ—è¡¨ã€æ¥æ ‡è®°å€¼ä¸º NULL çš„åˆ—ï¼ŒNULL å€¼å¹¶ä¸ä¼šå­˜å‚¨åœ¨è¡Œæ ¼å¼ä¸­çš„çœŸå®æ•°æ®éƒ¨åˆ†ã€‚</p><p>â€‹NULLå€¼åˆ—è¡¨ä¼šå ç”¨ 1 å­—èŠ‚ç©ºé—´ï¼Œå½“è¡¨ä¸­æ‰€æœ‰å­—æ®µéƒ½å®šä¹‰æˆ NOT NULLï¼Œè¡Œæ ¼å¼ä¸­å°±ä¸ä¼šæœ‰ NULLå€¼åˆ—è¡¨ï¼Œè¿™æ ·å¯èŠ‚çœ 1 å­—èŠ‚çš„ç©ºé—´ã€‚</p><h5 id="MySQL-æ€ä¹ˆçŸ¥é“-varchar-n-å®é™…å ç”¨æ•°æ®çš„å¤§å°ï¼Ÿ"><a href="#MySQL-æ€ä¹ˆçŸ¥é“-varchar-n-å®é™…å ç”¨æ•°æ®çš„å¤§å°ï¼Ÿ" class="headerlink" title="MySQL æ€ä¹ˆçŸ¥é“ varchar(n) å®é™…å ç”¨æ•°æ®çš„å¤§å°ï¼Ÿ"></a>MySQL æ€ä¹ˆçŸ¥é“ varchar(n) å®é™…å ç”¨æ•°æ®çš„å¤§å°ï¼Ÿ</h5><p>â€‹MySQL çš„ Compact è¡Œæ ¼å¼ä¸­ä¼šç”¨ã€Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€å­˜å‚¨å˜é•¿å­—æ®µå®é™…å ç”¨çš„æ•°æ®å¤§å°ã€‚</p><h5 id="varchar-n-ä¸­-n-æœ€å¤§å–å€¼ä¸ºå¤šå°‘ï¼Ÿ-1"><a href="#varchar-n-ä¸­-n-æœ€å¤§å–å€¼ä¸ºå¤šå°‘ï¼Ÿ-1" class="headerlink" title="varchar(n) ä¸­ n æœ€å¤§å–å€¼ä¸ºå¤šå°‘ï¼Ÿ"></a>varchar(n) ä¸­ n æœ€å¤§å–å€¼ä¸ºå¤šå°‘ï¼Ÿ</h5><p>â€‹æ‰€æœ‰å­—æ®µçš„é•¿åº¦ + å˜é•¿å­—æ®µå­—èŠ‚æ•°åˆ—è¡¨æ‰€å ç”¨çš„å­—èŠ‚æ•° + NULLå€¼åˆ—è¡¨æ‰€å ç”¨çš„å­—èŠ‚æ•° &lt;&#x3D; 65535ã€‚</p><h5 id="è¡Œæº¢å‡ºåï¼ŒMySQL-æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ-1"><a href="#è¡Œæº¢å‡ºåï¼ŒMySQL-æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ-1" class="headerlink" title="è¡Œæº¢å‡ºåï¼ŒMySQL æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ"></a>è¡Œæº¢å‡ºåï¼ŒMySQL æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ</h5><p>â€‹å­˜åˆ°æº¢å‡ºé¡µä¸­ï¼ŒçœŸå®æ•°æ®åŒºå­˜æ”¾æº¢å‡ºé¡µåœ°å€(éå®Œå…¨è¡Œæº¢å‡ºæ–¹å¼ã€å®Œå…¨è¡Œæº¢å‡ºæ–¹å¼)</p><h3 id="charå’Œvarchar"><a href="#charå’Œvarchar" class="headerlink" title="charå’Œvarchar"></a>charå’Œvarchar</h3><h4 id="å­˜å‚¨æœºåˆ¶åŒºåˆ«ï¼š"><a href="#å­˜å‚¨æœºåˆ¶åŒºåˆ«ï¼š" class="headerlink" title="å­˜å‚¨æœºåˆ¶åŒºåˆ«ï¼š"></a>å­˜å‚¨æœºåˆ¶åŒºåˆ«ï¼š</h4><ul><li><strong>æœ€å¤§é•¿åº¦</strong>ï¼šcharæ˜¯255ï¼Œvarcharæ˜¯65535ï¼Œå•ä½æ˜¯å­—ç¬¦ï¼ˆè€Œä¸æ˜¯å­—èŠ‚ï¼‰ã€‚</li><li><strong>å°¾éšç©ºæ ¼</strong>ï¼šcharä¼šå°†å°¾éšç©ºæ ¼å»æ‰ï¼Œè€Œvarcharä¸ä¼šã€‚<br>å› ä¸ºå­˜å‚¨æ—¶ï¼Œcharä¼šç”¨ç©ºæ ¼å¡«å……è‡³æŒ‡å®šé•¿åº¦ï¼Œæ‰€ä»¥å–å‡ºæ—¶éœ€è¦å»é™¤<strong>å¡«å……çš„</strong>ç©ºæ ¼ã€‚å¦‚æœcharå­—æ®µæœ‰å”¯ä¸€ç´¢å¼•ï¼Œ<code>a</code> å’Œ <code>aç©ºæ ¼</code> ä¼šæç¤ºå”¯ä¸€ç´¢å¼•å†²çªã€‚</li><li><strong>å­˜å‚¨ç©ºé—´å ç”¨</strong>ï¼š<u>varcharä¼šå ç”¨é¢å¤–çš„1~2å­—èŠ‚æ¥<strong>å­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦</strong></u>ã€‚å¦‚æœæœ€å¤§é•¿åº¦è¶…è¿‡255ï¼Œå°±éœ€è¦2å­—èŠ‚ï¼Œå¦åˆ™1å­—èŠ‚ã€‚</li></ul><h4 id="æ€§èƒ½å·®å¼‚ï¼š"><a href="#æ€§èƒ½å·®å¼‚ï¼š" class="headerlink" title="æ€§èƒ½å·®å¼‚ï¼š"></a>æ€§èƒ½å·®å¼‚ï¼š</h4><p>ä»charå’Œvarcharçš„å­˜å‚¨ç»“æ„å¯¹æ¯”ï¼Œå¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼š<strong>charå¡«å……ç©ºæ ¼å¯èƒ½å¯¼è‡´æµªè´¹å­˜å‚¨ç©ºé—´ï¼Œè¿›è€Œå¯¼è‡´æ€§èƒ½ä¸‹é™</strong>ã€‚å› ä¸ºcharå¤šå­˜å‚¨ä¸€äº›ç©ºæ ¼ï¼Œæ„å‘³ç€éœ€è¦<u>ä»ç£ç›˜è¯»å†™æ›´å¤šçš„æ•°æ®ã€è€—è´¹æ›´å¤šå†…å­˜ã€æŸ¥æ‰¾æ•°æ®æ—¶åˆ é™¤ç©ºæ ¼å¯èƒ½ä¹Ÿä¼šè€—è´¹ä¸€äº›CPUæ€§èƒ½</u>ã€‚</p><p><strong>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œvarcharçš„æ€§èƒ½ä¼˜äºcharï¼Œæœ€å¥½ä½¿ç”¨varcharã€‚</strong></p><p>ä¸è¿‡è€ƒè™‘ä¸€ä¸ªæç«¯çš„åœºæ™¯ï¼šæŸä¸ªå­—æ®µçš„æœ€å¤§é•¿åº¦æ˜¯100å­—èŠ‚ï¼Œä½†æ˜¯ä¼šé¢‘ç¹ä¿®æ”¹ã€‚å¦‚æœä½¿ç”¨<code>char(100)</code>ï¼Œåˆ™æ’å…¥è®°å½•åå°±åˆ†é…äº†100ä¸ªå­—èŠ‚ï¼Œåç»­ä¿®æ”¹ä¸ä¼šé€ æˆé¡µåˆ†è£‚ã€é¡µç©ºéš™ç­‰é—®é¢˜ï¼Œè€Œ<code>varchar(100)</code>ç”±äºæ²¡æœ‰æå‰åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œåç»­ä¿®æ”¹æ—¶å¯èƒ½å‡ºç°é¡µåˆ†è£‚ï¼Œè¿›è€Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p><h4 id="å³ç„¶varcharæ˜¯å˜é•¿ï¼Œé‚£æ˜¯ä¸æ˜¯è®¾ç½®varcharï¼ˆ1000ï¼‰ä¸€å®šæ¯”varcharï¼ˆ100ï¼‰å¥½ï¼Ÿ"><a href="#å³ç„¶varcharæ˜¯å˜é•¿ï¼Œé‚£æ˜¯ä¸æ˜¯è®¾ç½®varcharï¼ˆ1000ï¼‰ä¸€å®šæ¯”varcharï¼ˆ100ï¼‰å¥½ï¼Ÿ" class="headerlink" title="å³ç„¶varcharæ˜¯å˜é•¿ï¼Œé‚£æ˜¯ä¸æ˜¯è®¾ç½®varcharï¼ˆ1000ï¼‰ä¸€å®šæ¯”varcharï¼ˆ100ï¼‰å¥½ï¼Ÿ"></a>å³ç„¶varcharæ˜¯å˜é•¿ï¼Œé‚£æ˜¯ä¸æ˜¯è®¾ç½®varcharï¼ˆ1000ï¼‰ä¸€å®šæ¯”varcharï¼ˆ100ï¼‰å¥½ï¼Ÿ</h4><p>è™½ç„¶varcharæ˜¯å˜é•¿ï¼Œåœ¨ç›¸åŒé•¿åº¦ä¸‹ï¼Œç£ç›˜ç©ºé—´å ç”¨ä¸€æ ·ï¼Œå°†å€¼è®¾ç½®æ›´å¤§ä¸€äº›ï¼Œå¼¹æ€§ç©ºé—´ä¹Ÿæ›´å¤§ã€‚ä½†ä¹Ÿä¸æ˜¯å®Œå…¨æ²¡æœ‰ä»£ä»·çš„ï¼š</p><p><strong>åœ¨å†…å­˜åŠ è½½çš„æ—¶å€™ï¼Œæ¯æ¬¡éƒ½æ˜¯æŒ‰æœ€å¤§ç©ºé—´æ¥åˆ†é…çš„ã€‚æ˜¾ç„¶ï¼Œåœ¨æ’åºåœºæ™¯ï¼Œæˆ–è€…ä¸€äº›ä¸´æ—¶è¡¨èšåˆåœºæ™¯ï¼Œæ›´å¤§ç©ºé—´ä¼šäº§ç”Ÿæ˜æ˜¾çš„ä¸åˆ©å½±å“ã€‚</strong></p><h3 id="æ•°æ®é¡µ"><a href="#æ•°æ®é¡µ" class="headerlink" title="æ•°æ®é¡µ"></a>æ•°æ®é¡µ</h3><h4 id="InnoDB-æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„ï¼Ÿ"><a href="#InnoDB-æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„ï¼Ÿ" class="headerlink" title="InnoDB æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„ï¼Ÿ"></a>InnoDB æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„ï¼Ÿ</h4><p>â€”â€”æŒ‰è¡Œå­˜å‚¨æ•°æ®ï¼Œä½†æ˜¯è¯»å–æ•°æ®æ—¶ï¼Œä¸€æ¬¡ä¼šè¯»å–ç›®æ ‡è¡Œæ‰€åœ¨çš„æ•´é¡µ</p><p>æ•°æ®åº“çš„ I&#x2F;O æ“ä½œçš„æœ€å°å•ä½æ˜¯é¡µï¼Œ<strong>InnoDB æ•°æ®é¡µçš„é»˜è®¤å¤§å°æ˜¯ 16KB</strong>ï¼Œæ„å‘³ç€æ•°æ®åº“æ¯æ¬¡è¯»å†™éƒ½æ˜¯ä»¥ 16KB ä¸ºå•ä½çš„ï¼Œä¸€æ¬¡æœ€å°‘ä»ç£ç›˜ä¸­è¯»å– 16K çš„å†…å®¹åˆ°å†…å­˜ä¸­ï¼Œä¸€æ¬¡æœ€å°‘æŠŠå†…å­˜ä¸­çš„ 16K å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚</p><p>æ•°æ®é¡µåŒ…æ‹¬ä¸ƒä¸ªéƒ¨åˆ†ï¼Œç»“æ„å¦‚ä¸‹å›¾ï¼š</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731110101701.png" alt="image-20230731110101701" style="zoom: 33%;" /><p><strong>è¯´æ˜ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731110642767.png" alt="image-20230731110642767"></p><h5 id="File-Headerï¼š"><a href="#File-Headerï¼š" class="headerlink" title="File Headerï¼š"></a>File Headerï¼š</h5><p>åœ¨ File Header ä¸­æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘ä¸Šä¸€ä¸ªæ•°æ®é¡µå’Œä¸‹ä¸€ä¸ªæ•°æ®é¡µï¼Œè¿æ¥èµ·æ¥çš„é¡µç›¸å½“äºä¸€ä¸ªåŒå‘çš„é“¾è¡¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731110737757.png" alt="image-20230731110737757"></p><p>é‡‡ç”¨é“¾è¡¨çš„ç»“æ„æ˜¯è®©æ•°æ®é¡µä¹‹é—´ä¸éœ€è¦æ˜¯ç‰©ç†ä¸Šçš„è¿ç»­çš„ï¼Œè€Œæ˜¯é€»è¾‘ä¸Šçš„è¿ç»­ã€‚(è€Œå®é™…ä¸Šinnodbä¹Ÿ<strong>å°½é‡</strong>è®©ä¸åŒé¡µå­˜å‚¨åœ¨ä¸€ä¸ªæ®µä¸­ï¼Œä½¿å…¶ç‰©ç†ä¸Šè¿ç»­)</p><h5 id="User-Recordsï¼š"><a href="#User-Recordsï¼š" class="headerlink" title="User Recordsï¼š"></a>User Recordsï¼š</h5><p><strong>æ•°æ®é¡µä¸­çš„è®°å½•æŒ‰ç…§ã€Œä¸»é”®ã€é¡ºåºç»„æˆå•å‘é“¾è¡¨</strong>ï¼Œå•å‘é“¾è¡¨çš„ç‰¹ç‚¹å°±æ˜¯æ’å…¥ã€åˆ é™¤éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯æ£€ç´¢æ•ˆç‡ä¸é«˜ï¼Œæœ€å·®çš„æƒ…å†µä¸‹éœ€è¦éå†é“¾è¡¨ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹æ‰èƒ½å®Œæˆæ£€ç´¢ã€‚</p><p>å› æ­¤ï¼Œæ•°æ®é¡µä¸­æœ‰ä¸€ä¸ª<strong>é¡µç›®å½•</strong>ï¼Œèµ·åˆ°è®°å½•çš„ç´¢å¼•ä½œç”¨ï¼Œå°±åƒæˆ‘ä»¬ä¹¦é‚£æ ·ï¼Œé’ˆå¯¹ä¹¦ä¸­å†…å®¹çš„æ¯ä¸ªç« èŠ‚è®¾ç«‹äº†ä¸€ä¸ªç›®å½•ï¼Œæƒ³çœ‹æŸä¸ªç« èŠ‚çš„æ—¶å€™ï¼Œå¯ä»¥æŸ¥çœ‹ç›®å½•ï¼Œå¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„ç« èŠ‚çš„é¡µæ•°ï¼Œè€Œæ•°æ®é¡µä¸­çš„é¡µç›®å½•å°±æ˜¯ä¸ºäº†èƒ½å¿«é€Ÿæ‰¾åˆ°è®°å½•ã€‚</p><h5 id="Page-Directoryï¼š"><a href="#Page-Directoryï¼š" class="headerlink" title="Page Directoryï¼š"></a>Page Directoryï¼š</h5><p>é¡µç›®å½•åˆ›å»ºçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å°†æ‰€æœ‰çš„è®°å½•åˆ’åˆ†æˆå‡ ä¸ªç»„ï¼Œè¿™äº›è®°å½•åŒ…æ‹¬æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•ï¼Œä½†ä¸åŒ…æ‹¬æ ‡è®°ä¸ºâ€œå·²åˆ é™¤â€çš„è®°å½•ï¼›</li><li><u>æ¯ä¸ªè®°å½•ç»„çš„æœ€åä¸€æ¡è®°å½•å°±æ˜¯ç»„å†…æœ€å¤§çš„é‚£æ¡è®°å½•</u>ï¼Œå¹¶ä¸”æœ€åä¸€æ¡è®°å½•çš„å¤´ä¿¡æ¯ä¸­ä¼šå­˜å‚¨è¯¥ç»„ä¸€å…±æœ‰å¤šå°‘æ¡è®°å½•ï¼Œä½œä¸º n_owned å­—æ®µ</li><li>é¡µç›®å½•ç”¨æ¥å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼Œè¿™äº›åœ°å€åç§»é‡ä¼šæŒ‰ç…§å…ˆåé¡ºåºå­˜å‚¨èµ·æ¥ï¼Œæ¯ç»„çš„åœ°å€åç§»é‡ä¹Ÿè¢«ç§°ä¹‹ä¸ºæ§½ï¼ˆslotï¼‰ï¼Œ<strong>æ¯ä¸ªæ§½ç›¸å½“äºæŒ‡é’ˆæŒ‡å‘äº†ä¸åŒç»„çš„æœ€åä¸€ä¸ªè®°å½•</strong>ã€‚</li></ol><p><strong>é¡µç›®å½•å°±æ˜¯ç”±å¤šä¸ªæ§½ç»„æˆçš„ï¼Œæ§½ç›¸å½“äºåˆ†ç»„è®°å½•çš„ç´¢å¼•</strong>ã€‚ç„¶åï¼Œå› ä¸ºè®°å½•æ˜¯æŒ‰ç…§ã€Œä¸»é”®å€¼ã€ä»å°åˆ°å¤§æ’åºçš„ï¼Œæ‰€ä»¥<strong>æˆ‘ä»¬é€šè¿‡æ§½æŸ¥æ‰¾è®°å½•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•å¿«é€Ÿå®šä½è¦æŸ¥è¯¢çš„è®°å½•åœ¨å“ªä¸ªæ§½ï¼ˆå“ªä¸ªè®°å½•åˆ†ç»„ï¼‰ï¼Œå®šä½åˆ°æ§½åï¼Œå†éå†æ§½å†…çš„æ‰€æœ‰è®°å½•ï¼Œæ‰¾åˆ°å¯¹åº”çš„è®°å½•</strong>ï¼Œæ— éœ€ä»æœ€å°è®°å½•å¼€å§‹éå†æ•´ä¸ªé¡µä¸­çš„è®°å½•é“¾è¡¨ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œ5 ä¸ªæ§½çš„ç¼–å·åˆ†åˆ«ä¸º 0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œæˆ‘æƒ³æŸ¥æ‰¾ä¸»é”®ä¸º 11 çš„ç”¨æˆ·è®°å½•ï¼š</p><ul><li>å…ˆäºŒåˆ†å¾—å‡ºæ§½ä¸­é—´ä½æ˜¯ (0+4)&#x2F;2&#x3D;2 ï¼Œ2å·æ§½é‡Œæœ€å¤§çš„è®°å½•ä¸º 8ã€‚å› ä¸º 11 &gt; 8ï¼Œæ‰€ä»¥éœ€è¦ä» 2 å·æ§½åç»§ç»­æœç´¢è®°å½•ï¼›</li><li>å†ä½¿ç”¨äºŒåˆ†æœç´¢å‡º 2 å·å’Œ 4 æ§½çš„ä¸­é—´ä½æ˜¯ (2+4)&#x2F;2&#x3D; 3ï¼Œ3 å·æ§½é‡Œæœ€å¤§çš„è®°å½•ä¸º 12ã€‚å› ä¸º 11 &lt; 12ï¼Œæ‰€ä»¥ä¸»é”®ä¸º 11 çš„è®°å½•åœ¨ 3 å·æ§½é‡Œï¼›</li><li>è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œ<strong>ã€Œæ§½å¯¹åº”çš„å€¼éƒ½æ˜¯è¿™ä¸ªç»„çš„ä¸»é”®æœ€å¤§çš„è®°å½•ï¼Œå¦‚ä½•æ‰¾åˆ°ç»„é‡Œæœ€å°çš„è®°å½•ã€</strong>ï¼Ÿ<ul><li>æ‰¾å‰ä¸€ä¸ªæ§½æœ€å¤§è®°å½•+1å³å¯</li></ul></li></ul><p>çœ‹åˆ°ç¬¬ä¸‰æ­¥çš„æ—¶å€™ï¼Œå¯èƒ½æœ‰çš„åŒå­¦ä¼šç–‘é—®ï¼Œå¦‚æœæŸä¸ªæ§½å†…çš„è®°å½•å¾ˆå¤šï¼Œç„¶åå› ä¸ºè®°å½•éƒ½æ˜¯å•å‘é“¾è¡¨ä¸²èµ·æ¥çš„ï¼Œé‚£è¿™æ ·åœ¨æ§½å†…æŸ¥æ‰¾æŸä¸ªè®°å½•çš„æ—¶é—´å¤æ‚åº¦ä¸å°±æ˜¯ O(n) äº†å—ï¼Ÿ</p><p>è¿™ç‚¹ä¸ç”¨æ‹…å¿ƒï¼ŒInnoDB å¯¹æ¯ä¸ªåˆ†ç»„ä¸­çš„è®°å½•æ¡æ•°éƒ½æ˜¯æœ‰è§„å®šçš„ï¼Œæ§½å†…çš„è®°å½•å°±åªæœ‰å‡ æ¡ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªåˆ†ç»„ä¸­çš„è®°å½•åªèƒ½æœ‰ 1 æ¡è®°å½•ï¼›</li><li>æœ€åä¸€ä¸ªåˆ†ç»„ä¸­çš„è®°å½•æ¡æ•°èŒƒå›´åªèƒ½åœ¨ 1-8 æ¡ä¹‹é—´ï¼›</li><li>å‰©ä¸‹çš„åˆ†ç»„ä¸­è®°å½•æ¡æ•°èŒƒå›´åªèƒ½åœ¨ 4-8 æ¡ä¹‹é—´ã€‚</li></ul><h5 id="æ€»ç»“â€”â€”å•æ•°æ®é¡µå†…çš„æŸ¥è¯¢æ­¥éª¤ï¼š"><a href="#æ€»ç»“â€”â€”å•æ•°æ®é¡µå†…çš„æŸ¥è¯¢æ­¥éª¤ï¼š" class="headerlink" title="æ€»ç»“â€”â€”å•æ•°æ®é¡µå†…çš„æŸ¥è¯¢æ­¥éª¤ï¼š"></a>æ€»ç»“â€”â€”å•æ•°æ®é¡µå†…çš„æŸ¥è¯¢æ­¥éª¤ï¼š</h5><p>ä¸Šé¢æˆ‘ä»¬éƒ½æ˜¯åœ¨è¯´ä¸€ä¸ªæ•°æ®é¡µä¸­çš„è®°å½•æ£€ç´¢ï¼Œå› ä¸ºä¸€ä¸ªæ•°æ®é¡µä¸­çš„è®°å½•æ˜¯æœ‰é™çš„ï¼Œä¸”ä¸»é”®å€¼æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥é€šè¿‡å¯¹æ‰€æœ‰è®°å½•è¿›è¡Œåˆ†ç»„ï¼Œç„¶åå°†ç»„å·ï¼ˆæ§½å·ï¼‰å­˜å‚¨åˆ°é¡µç›®å½•ï¼Œä½¿å…¶èµ·åˆ°ç´¢å¼•ä½œç”¨ï¼Œé€šè¿‡äºŒåˆ†æŸ¥æ‰¾çš„æ–¹æ³•å¿«é€Ÿæ£€ç´¢åˆ°è®°å½•åœ¨å“ªä¸ªåˆ†ç»„ï¼Œæ¥é™ä½æ£€ç´¢çš„æ—¶é—´å¤æ‚åº¦ã€‚</p><h4 id="B-æ ‘æ˜¯å¦‚ä½•è¿›è¡ŒæŸ¥è¯¢çš„ï¼Ÿ"><a href="#B-æ ‘æ˜¯å¦‚ä½•è¿›è¡ŒæŸ¥è¯¢çš„ï¼Ÿ" class="headerlink" title="B+ æ ‘æ˜¯å¦‚ä½•è¿›è¡ŒæŸ¥è¯¢çš„ï¼Ÿ"></a>B+ æ ‘æ˜¯å¦‚ä½•è¿›è¡ŒæŸ¥è¯¢çš„ï¼Ÿ</h4><p>å½“æˆ‘ä»¬éœ€è¦å­˜å‚¨å¤§é‡çš„è®°å½•æ—¶ï¼Œå°±éœ€è¦å¤šä¸ªæ•°æ®é¡µã€‚<strong>InnoDB é‡‡ç”¨äº† B+ æ ‘ä½œä¸ºç´¢å¼•</strong>ã€‚ç£ç›˜çš„ I&#x2F;O æ“ä½œæ¬¡æ•°å¯¹ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡è‡³å…³é‡è¦ï¼Œå› æ­¤åœ¨æ„é€ ç´¢å¼•çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ›´å€¾å‘äºé‡‡ç”¨â€œçŸ®èƒ–â€çš„ B+ æ ‘æ•°æ®ç»“æ„ï¼Œè¿™æ ·æ‰€éœ€è¦è¿›è¡Œçš„ç£ç›˜ I&#x2F;O æ¬¡æ•°æ›´å°‘ï¼Œè€Œä¸” B+ æ ‘ æ›´é€‚åˆè¿›è¡Œå…³é”®å­—çš„èŒƒå›´æŸ¥è¯¢ã€‚</p><p>InnoDB é‡Œçš„ B+ æ ‘ä¸­çš„<strong>æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ•°æ®é¡µ</strong>ï¼Œç»“æ„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731111828591.png" alt="image-20230731111828591"></p><p>é€šè¿‡ä¸Šå›¾ï¼Œæˆ‘ä»¬çœ‹å‡º B+ æ ‘çš„ç‰¹ç‚¹ï¼š</p><ul><li><u>åªæœ‰å¶å­èŠ‚ç‚¹ï¼ˆæœ€åº•å±‚çš„èŠ‚ç‚¹ï¼‰æ‰å­˜æ”¾äº†æ•°æ®</u>ï¼Œéå¶å­èŠ‚ç‚¹ï¼ˆå…¶ä»–ä¸Šå±‚èŠ‚ï¼‰ä»…ç”¨æ¥å­˜æ”¾ç›®å½•é¡¹ä½œä¸ºç´¢å¼•ã€‚</li><li>éå¶å­èŠ‚ç‚¹åˆ†ä¸ºä¸åŒå±‚æ¬¡ï¼Œé€šè¿‡åˆ†å±‚æ¥é™ä½æ¯ä¸€å±‚çš„æœç´¢é‡ï¼›</li><li>æ‰€æœ‰èŠ‚ç‚¹æŒ‰ç…§ç´¢å¼•é”®å¤§å°æ’åºï¼Œæ„æˆä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œä¾¿äºèŒƒå›´æŸ¥è¯¢ï¼›</li></ul><p>ğŸŒ°æˆ‘ä»¬å†çœ‹çœ‹ B+ æ ‘å¦‚ä½•å®ç°å¿«é€ŸæŸ¥æ‰¾ä¸»é”®ä¸º 6 çš„è®°å½•ï¼Œä»¥ä¸Šå›¾ä¸ºä¾‹å­ï¼š</p><ul><li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°ç¬¦åˆé¡µå†…èŒƒå›´åŒ…å«æŸ¥è¯¢å€¼çš„é¡µï¼Œå› ä¸ºæŸ¥è¯¢çš„ä¸»é”®å€¼ä¸º 6ï¼Œåœ¨[1, 7)èŒƒå›´ä¹‹é—´ï¼Œæ‰€ä»¥åˆ°é¡µ 30 ä¸­æŸ¥æ‰¾æ›´è¯¦ç»†çš„ç›®å½•é¡¹ï¼›</li><li>åœ¨éå¶å­èŠ‚ç‚¹ï¼ˆé¡µ30ï¼‰ä¸­ï¼Œç»§ç»­é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°ç¬¦åˆé¡µå†…èŒƒå›´åŒ…å«æŸ¥è¯¢å€¼çš„é¡µï¼Œä¸»é”®å€¼å¤§äº 5ï¼Œæ‰€ä»¥å°±åˆ°å¶å­èŠ‚ç‚¹ï¼ˆé¡µ16ï¼‰æŸ¥æ‰¾è®°å½•ï¼›</li><li>æ¥ç€ï¼Œåœ¨å¶å­èŠ‚ç‚¹ï¼ˆé¡µ16ï¼‰ä¸­ï¼Œé€šè¿‡æ§½æŸ¥æ‰¾è®°å½•æ—¶ï¼Œä½¿ç”¨äºŒåˆ†æ³•å¿«é€Ÿå®šä½è¦æŸ¥è¯¢çš„è®°å½•åœ¨å“ªä¸ªæ§½ï¼ˆå“ªä¸ªè®°å½•åˆ†ç»„ï¼‰ï¼Œå®šä½åˆ°æ§½åï¼Œå†éå†æ§½å†…çš„æ‰€æœ‰è®°å½•ï¼Œæ‰¾åˆ°ä¸»é”®ä¸º 6 çš„è®°å½•ã€‚</li></ul><p>ğŸŒŸ<strong>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å®šä½è®°å½•æ‰€åœ¨å“ªä¸€ä¸ªé¡µæ—¶ï¼Œä¹Ÿæ˜¯é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°åŒ…å«è¯¥è®°å½•çš„é¡µã€‚å®šä½åˆ°è¯¥é¡µåï¼Œåˆä¼šåœ¨è¯¥é¡µå†…è¿›è¡ŒäºŒåˆ†æ³•å¿«é€Ÿå®šä½è®°å½•æ‰€åœ¨çš„åˆ†ç»„ï¼ˆæ§½å·ï¼‰ï¼Œæœ€ååœ¨åˆ†ç»„å†…è¿›è¡Œéå†æŸ¥æ‰¾ã€‚</strong></p><h5 id="æ€»ç»“ï¼š-2"><a href="#æ€»ç»“ï¼š-2" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h5><ol><li><p>æ„å»ºæ•°æ®é¡µçš„B+æ ‘</p></li><li><p>å°†è¦æŸ¥è¯¢çš„ä¸»é”®å€¼ä¸B+æ ‘èŠ‚ç‚¹çš„æœ€å¤§ã€æœ€å°è®°å½•æ¯”è¾ƒï¼Œè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°è®°å½•æ‰€åœ¨çš„æ•°æ®é¡µ</p></li><li><p>åœ¨æ•°æ®é¡µä¸­ï¼Œå†ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ‰¾åˆ°è®°å½•åœ¨å“ªä¸ªæ§½ï¼Œåœ¨æ§½ä¸­é¡ºåºéå†æ‰¾åˆ°ç»“æœ</p></li></ol><h4 id="èšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•"></a>èšç°‡ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•</h4><p>å¦å¤–ï¼Œç´¢å¼•åˆå¯ä»¥åˆ†æˆèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰ï¼Œå®ƒä»¬<strong>åŒºåˆ«å°±åœ¨äºå¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä»€ä¹ˆæ•°æ®</strong>ï¼š</p><ul><li><u>èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯å®é™…æ•°æ®ï¼Œæ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½å­˜æ”¾åœ¨èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹</u>ï¼›(InnoDB,ç´¢å¼•ä¸æ•°æ®éƒ½å­˜åœ¨.idbæ–‡ä»¶ä¸­)</li><li>äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œè€Œä¸æ˜¯å®é™…æ•°æ®ã€‚</li></ul><p>å› ä¸ºè¡¨çš„æ•°æ®éƒ½æ˜¯å­˜æ”¾åœ¨èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹é‡Œï¼Œæ‰€ä»¥ InnoDB å­˜å‚¨å¼•æ“ä¸€å®šä¼šä¸ºè¡¨åˆ›å»ºä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œä¸”ç”±äºæ•°æ®åœ¨ç‰©ç†ä¸Šåªä¼šä¿å­˜ä¸€ä»½ï¼Œæ‰€ä»¥èšç°‡ç´¢å¼•åªèƒ½æœ‰ä¸€ä¸ªã€‚</p><p>InnoDB åœ¨åˆ›å»ºèšç°‡ç´¢å¼•æ—¶ï¼Œä¼šæ ¹æ®ä¸åŒçš„åœºæ™¯é€‰æ‹©ä¸åŒçš„åˆ—ä½œä¸ºç´¢å¼•ï¼š</p><ul><li>å¦‚æœæœ‰ä¸»é”®ï¼Œé»˜è®¤ä¼šä½¿ç”¨<strong>ä¸»é”®</strong>ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®ï¼›</li><li>å¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œå°±é€‰æ‹©ç¬¬ä¸€ä¸ª<strong>ä¸åŒ…å« NULL å€¼çš„å”¯ä¸€åˆ—</strong>ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®ï¼›</li><li>åœ¨ä¸Šé¢ä¸¤ä¸ªéƒ½æ²¡æœ‰çš„æƒ…å†µä¸‹ï¼ŒInnoDB å°†è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª<strong>éšå¼è‡ªå¢ id åˆ—</strong>ä½œä¸ºèšç°‡ç´¢å¼•çš„ç´¢å¼•é”®ï¼›</li></ul><p>ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œé‚£ä¸ºäº†å®ç°éä¸»é”®å­—æ®µçš„å¿«é€Ÿæœç´¢ï¼Œå°±å¼•å‡ºäº†<u>äºŒçº§ç´¢å¼•ï¼ˆéèšç°‡ç´¢å¼•&#x2F;è¾…åŠ©ç´¢å¼•ï¼‰ï¼Œå®ƒä¹Ÿæ˜¯åˆ©ç”¨äº† B+ æ ‘çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œä¸æ˜¯å®é™…æ•°æ®ã€‚</u></p><p>äºŒçº§ç´¢å¼•çš„ B+ æ ‘å¦‚ä¸‹å›¾ï¼Œæ•°æ®éƒ¨åˆ†ä¸ºä¸»é”®å€¼ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731112821532.png" alt="image-20230731112821532"></p><p>å› æ­¤ï¼Œ<strong>å¦‚æœæŸä¸ªæŸ¥è¯¢è¯­å¥ä½¿ç”¨äº†äºŒçº§ç´¢å¼•ï¼Œä½†æ˜¯æŸ¥è¯¢çš„æ•°æ®ä¸æ˜¯ä¸»é”®å€¼ï¼Œè¿™æ—¶åœ¨äºŒçº§ç´¢å¼•æ‰¾åˆ°ä¸»é”®å€¼åï¼Œéœ€è¦å»èšç°‡ç´¢å¼•ä¸­è·å¾—æ•°æ®è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«ä½œã€Œå›è¡¨ã€ï¼Œä¹Ÿå°±æ˜¯è¯´è¦æŸ¥ä¸¤ä¸ª B+ æ ‘æ‰èƒ½æŸ¥åˆ°æ•°æ®ã€‚ä¸è¿‡ï¼Œå½“æŸ¥è¯¢çš„æ•°æ®æ˜¯ä¸»é”®å€¼æ—¶ï¼Œå› ä¸ºåªåœ¨äºŒçº§ç´¢å¼•å°±èƒ½æŸ¥è¯¢åˆ°ï¼Œä¸ç”¨å†å»èšç°‡ç´¢å¼•æŸ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«ä½œã€Œç´¢å¼•è¦†ç›–ã€ï¼Œä¹Ÿå°±æ˜¯åªéœ€è¦æŸ¥ä¸€ä¸ª B+ æ ‘å°±èƒ½æ‰¾åˆ°æ•°æ®ã€‚</strong></p><h4 id="æ€»ç»“ï¼š-3"><a href="#æ€»ç»“ï¼š-3" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h4><ul><li>InnoDB çš„æ•°æ®æ˜¯æŒ‰ã€Œæ•°æ®é¡µã€ä¸ºå•ä½æ¥è¯»å†™çš„ï¼Œé»˜è®¤æ•°æ®é¡µå¤§å°ä¸º 16 KBã€‚<u>æ¯ä¸ªæ•°æ®é¡µä¹‹é—´é€šè¿‡åŒå‘é“¾è¡¨çš„å½¢å¼ç»„ç»‡èµ·æ¥ï¼Œç‰©ç†ä¸Šä¸è¿ç»­ï¼Œä½†æ˜¯é€»è¾‘ä¸Šè¿ç»­ã€‚</u></li><li>æ•°æ®é¡µå†…åŒ…å«ç”¨æˆ·è®°å½•ï¼Œæ¯ä¸ªè®°å½•ä¹‹é—´ç”¨å•å‘é“¾è¡¨çš„æ–¹å¼ç»„ç»‡èµ·æ¥ï¼Œä¸ºäº†åŠ å¿«åœ¨æ•°æ®é¡µå†…é«˜æ•ˆæŸ¥è¯¢è®°å½•ï¼Œè®¾è®¡äº†ä¸€ä¸ªé¡µç›®å½•ï¼Œé¡µç›®å½•å­˜å‚¨å„ä¸ªæ§½ï¼ˆåˆ†ç»„ï¼‰ï¼Œä¸”ä¸»é”®å€¼æ˜¯æœ‰åºçš„ï¼Œäºæ˜¯å¯ä»¥é€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ³•çš„æ–¹å¼è¿›è¡Œæ£€ç´¢ä»è€Œæé«˜æ•ˆç‡ã€‚</li><li>ä¸ºäº†é«˜æ•ˆæŸ¥è¯¢è®°å½•æ‰€åœ¨çš„æ•°æ®é¡µï¼ŒInnoDB é‡‡ç”¨ b+ æ ‘ä½œä¸ºç´¢å¼•ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ•°æ®é¡µã€‚</li><li>å¶å­èŠ‚ç‚¹å­˜å‚¨å®é™…æ•°æ®ï¼Œå°±æ˜¯èšç°‡ç´¢å¼•ï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼›å¦‚æœå¶å­èŠ‚ç‚¹å­˜å‚¨çš„ä¸æ˜¯å®é™…æ•°æ®ï¼Œè€Œæ˜¯ä¸»é”®å€¼åˆ™å°±æ˜¯äºŒçº§ç´¢å¼•ï¼Œä¸€ä¸ªè¡¨ä¸­å¯ä»¥æœ‰å¤šä¸ªäºŒçº§ç´¢å¼•ã€‚</li><li>åœ¨ä½¿ç”¨äºŒçº§ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾æ•°æ®æ—¶ï¼Œå¦‚æœæŸ¥è¯¢çš„æ•°æ®èƒ½åœ¨äºŒçº§ç´¢å¼•æ‰¾åˆ°(ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸ¥æ‰¾çš„æ•°æ®æ˜¯å»ºç«‹èšç°‡ç´¢å¼•çš„åˆ—)ï¼Œé‚£ä¹ˆå°±æ˜¯ã€Œç´¢å¼•è¦†ç›–ã€æ“ä½œï¼Œå¦‚æœæŸ¥è¯¢çš„æ•°æ®ä¸åœ¨äºŒçº§ç´¢å¼•é‡Œï¼Œå°±éœ€è¦å…ˆåœ¨äºŒçº§ç´¢å¼•æ‰¾åˆ°ä¸»é”®å€¼ï¼Œéœ€è¦å»èšç°‡ç´¢å¼•ä¸­è·å¾—æ•°æ®è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«ä½œã€Œå›è¡¨ã€ã€‚</li></ul><h3 id="Buffer-Pool"><a href="#Buffer-Pool" class="headerlink" title="Buffer Pool"></a>Buffer Pool</h3><h4 id="å¼•å‡ºï¼š"><a href="#å¼•å‡ºï¼š" class="headerlink" title="å¼•å‡ºï¼š"></a>å¼•å‡ºï¼š</h4><p><strong>â€”â€”å°±æ˜¯ä¸€ä¸ªcacheï¼Œä¸ºäº†å‡å°‘è¯»ç£ç›˜çš„æ¬¡æ•°</strong></p><p>è™½ç„¶è¯´ MySQL çš„æ•°æ®æ˜¯å­˜å‚¨åœ¨ç£ç›˜é‡Œçš„ï¼Œä½†å¦‚æœæ¯æ¬¡éƒ½ä»ç£ç›˜ä¸­è¯»å–æ•°æ®ï¼Œæ€§èƒ½å·®ï¼›</p><p>è¦æƒ³æå‡æŸ¥è¯¢æ€§èƒ½ï¼ŒåŠ ä¸ªç¼“å­˜å°±è¡Œäº†å˜›ã€‚æ‰€ä»¥ï¼Œ<u>å½“æ•°æ®ä»ç£ç›˜ä¸­å–å‡ºåï¼Œç¼“å­˜å†…å­˜ä¸­ï¼Œä¸‹æ¬¡æŸ¥è¯¢åŒæ ·çš„æ•°æ®çš„æ—¶å€™ï¼Œç›´æ¥ä»å†…å­˜ä¸­è¯»å–</u>ã€‚</p><p>ä¸ºæ­¤ï¼ŒInnodb å­˜å‚¨å¼•æ“è®¾è®¡äº†ä¸€ä¸ª<strong>ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰</strong>ï¼Œæ¥æé«˜æ•°æ®åº“çš„è¯»å†™æ€§èƒ½</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230801091252147.png" alt="image-20230801091252147" style="zoom: 33%;" /><ul><li>å½“è¯»å–æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å­˜åœ¨äº Buffer Pool ä¸­ï¼Œå®¢æˆ·ç«¯å°±ä¼šç›´æ¥è¯»å– Buffer Pool ä¸­çš„æ•°æ®ï¼Œå¦åˆ™å†å»ç£ç›˜ä¸­è¯»å–ã€‚</li><li>å½“ä¿®æ”¹æ•°æ®æ—¶ï¼Œé¦–å…ˆæ˜¯ä¿®æ”¹ Buffer Pool ä¸­æ•°æ®æ‰€åœ¨çš„é¡µï¼Œç„¶åå°†å…¶é¡µè®¾ç½®ä¸ºè„é¡µï¼Œæœ€å<u>ç”±åå°çº¿ç¨‹å°†è„é¡µå†™å…¥åˆ°ç£ç›˜</u>ã€‚</li></ul><h4 id="Buffer-Pool-æœ‰å¤šå¤§ï¼Ÿ"><a href="#Buffer-Pool-æœ‰å¤šå¤§ï¼Ÿ" class="headerlink" title="Buffer Pool æœ‰å¤šå¤§ï¼Ÿ"></a>Buffer Pool æœ‰å¤šå¤§ï¼Ÿ</h4><p>â€”-é»˜è®¤128MBï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´ <code>innodb_buffer_pool_size</code> å‚æ•°æ¥è®¾ç½® Buffer Pool çš„å¤§å°ï¼Œä¸€èˆ¬å»ºè®®è®¾ç½®æˆå¯ç”¨ç‰©ç†å†…å­˜çš„ 60%~80%</p><h4 id="Buffer-Pool-ç¼“å­˜ä»€ä¹ˆï¼Ÿ"><a href="#Buffer-Pool-ç¼“å­˜ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Buffer Pool ç¼“å­˜ä»€ä¹ˆï¼Ÿ"></a>Buffer Pool ç¼“å­˜ä»€ä¹ˆï¼Ÿ</h4><p>â€“<u><strong>ä¸€é¡µä¸€é¡µè¿›è¡Œç¼“å­˜</strong></u></p><p>â€‹åœ¨ MySQL å¯åŠ¨çš„æ—¶å€™ï¼Œ<strong>InnoDB ä¼šä¸º Buffer Pool ç”³è¯·ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œç„¶åæŒ‰ç…§é»˜è®¤çš„<code>16KB</code>çš„å¤§å°åˆ’åˆ†å‡ºä¸€ä¸ªä¸ªçš„é¡µï¼Œ Buffer Pool ä¸­çš„é¡µå°±å«åšç¼“å­˜é¡µ</strong>ã€‚æ­¤æ—¶è¿™äº›ç¼“å­˜é¡µéƒ½æ˜¯ç©ºé—²çš„ï¼Œä¹‹åéšç€ç¨‹åºçš„è¿è¡Œï¼Œæ‰ä¼šæœ‰ç£ç›˜ä¸Šçš„é¡µè¢«ç¼“å­˜åˆ° Buffer Pool ä¸­ã€‚</p><p>ä¸ºäº†æ›´å¥½çš„ç®¡ç†è¿™äº›åœ¨ Buffer Pool ä¸­çš„ç¼“å­˜é¡µï¼ŒInnoDB ä¸ºæ¯ä¸€ä¸ªç¼“å­˜é¡µéƒ½åˆ›å»ºäº†ä¸€ä¸ª<strong>æ§åˆ¶å—</strong>ï¼Œæ§åˆ¶å—ä¿¡æ¯åŒ…æ‹¬ã€Œç¼“å­˜é¡µçš„è¡¨ç©ºé—´ã€é¡µå·ã€ç¼“å­˜é¡µåœ°å€ã€é“¾è¡¨èŠ‚ç‚¹ã€ç­‰ç­‰ã€‚</p><p>æ§åˆ¶å—ä¹Ÿæ˜¯å æœ‰å†…å­˜ç©ºé—´çš„ï¼Œå®ƒæ˜¯æ”¾åœ¨ Buffer Pool çš„æœ€å‰é¢ï¼Œæ¥ç€æ‰æ˜¯ç¼“å­˜é¡µï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230801095607789.png" alt="image-20230801095607789" style="zoom:50%;" /><p>ä¸Šå›¾ä¸­æ§åˆ¶å—å’Œç¼“å­˜é¡µä¹‹é—´ç™½è‰²éƒ¨åˆ†ç§°ä¸ºç¢ç‰‡ç©ºé—´ã€‚</p><h4 id="å¦‚ä½•ç®¡ç†-Buffer-Poolï¼Ÿ"><a href="#å¦‚ä½•ç®¡ç†-Buffer-Poolï¼Ÿ" class="headerlink" title="å¦‚ä½•ç®¡ç† Buffer Poolï¼Ÿ"></a>å¦‚ä½•ç®¡ç† Buffer Poolï¼Ÿ</h4><h5 id="å¦‚ä½•ç®¡ç†ç©ºé—²é¡µï¼Ÿ"><a href="#å¦‚ä½•ç®¡ç†ç©ºé—²é¡µï¼Ÿ" class="headerlink" title="å¦‚ä½•ç®¡ç†ç©ºé—²é¡µï¼Ÿ"></a>å¦‚ä½•ç®¡ç†ç©ºé—²é¡µï¼Ÿ</h5><p>ä½¿ç”¨ä¸€ä¸ªFreeé“¾è¡¨ï¼Œä¸“é—¨ç®¡ç†ç©ºé—²é¡µ(ä½¿ç©ºé—²é¡µæ–¹ä¾¿è¢«è·å–)</p> <img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230801100926879.png" alt="image-20230801100926879" style="zoom:50%;" /><h6 id="å·¥ä½œåŸç†ï¼š"><a href="#å·¥ä½œåŸç†ï¼š" class="headerlink" title="å·¥ä½œåŸç†ï¼š"></a>å·¥ä½œåŸç†ï¼š</h6><ul><li><p>Free é“¾è¡¨ä¸Šé™¤äº†æœ‰æ§åˆ¶å—ï¼Œè¿˜æœ‰ä¸€ä¸ªå¤´èŠ‚ç‚¹ï¼Œè¯¥<u>å¤´èŠ‚ç‚¹åŒ…å«é“¾è¡¨çš„å¤´èŠ‚ç‚¹åœ°å€ï¼Œå°¾èŠ‚ç‚¹åœ°å€ï¼Œä»¥åŠå½“å‰é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡ç­‰ä¿¡æ¯</u>ã€‚</p></li><li><p><u>Free é“¾è¡¨èŠ‚ç‚¹æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„æ§åˆ¶å—ï¼Œè€Œæ¯ä¸ªæ§åˆ¶å—åŒ…å«ç€å¯¹åº”ç¼“å­˜é¡µçš„åœ°å€ï¼Œæ‰€ä»¥ç›¸å½“äº Free é“¾è¡¨èŠ‚ç‚¹éƒ½å¯¹åº”ä¸€ä¸ªç©ºé—²çš„ç¼“å­˜é¡µã€‚</u></p></li><li><p>æœ‰äº† Free é“¾è¡¨åï¼Œæ¯å½“éœ€è¦ä»ç£ç›˜ä¸­åŠ è½½ä¸€ä¸ªé¡µåˆ° Buffer Pool ä¸­æ—¶ï¼Œå°±<u>ä» Freeé“¾è¡¨ä¸­å–ä¸€ä¸ªç©ºé—²çš„ç¼“å­˜é¡µï¼Œå¹¶ä¸”æŠŠè¯¥ç¼“å­˜é¡µå¯¹åº”çš„æ§åˆ¶å—çš„ä¿¡æ¯å¡«ä¸Šï¼Œç„¶åæŠŠè¯¥ç¼“å­˜é¡µå¯¹åº”çš„æ§åˆ¶å—ä» Free é“¾è¡¨ä¸­ç§»é™¤ã€‚</u></p></li></ul><h5 id="å¦‚ä½•ç®¡ç†è„é¡µï¼Ÿ"><a href="#å¦‚ä½•ç®¡ç†è„é¡µï¼Ÿ" class="headerlink" title="å¦‚ä½•ç®¡ç†è„é¡µï¼Ÿ"></a>å¦‚ä½•ç®¡ç†è„é¡µï¼Ÿ</h5><p>â€”Flush é“¾è¡¨ï¼Œè¡¨ä¸­èŠ‚ç‚¹éƒ½æ˜¯è„é¡µçš„æ§åˆ¶å—ï¼Œæ–¹ä¾¿ç®¡ç†æ‰€æœ‰è„é¡µï¼</p><p>â€‹è®¾è®¡ Buffer Pool é™¤äº†èƒ½æé«˜è¯»æ€§èƒ½ï¼Œè¿˜èƒ½æé«˜å†™æ€§èƒ½ï¼Œä¹Ÿå°±æ˜¯<u>æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½è¦å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯å°† Buffer Pool å¯¹åº”çš„ç¼“å­˜é¡µæ ‡è®°ä¸º<strong>è„é¡µ</strong>ï¼Œç„¶åå†ç”±åå°çº¿ç¨‹å°†è„é¡µå†™å…¥åˆ°ç£ç›˜ã€‚</u></p><p>â€‹é‚£ä¸ºäº†èƒ½å¿«é€ŸçŸ¥é“å“ªäº›ç¼“å­˜é¡µæ˜¯è„çš„ï¼Œäºæ˜¯å°±è®¾è®¡å‡º <strong>Flush é“¾è¡¨</strong>ï¼Œå®ƒè·Ÿ Free é“¾è¡¨ç±»ä¼¼çš„ï¼Œé“¾è¡¨çš„èŠ‚ç‚¹ä¹Ÿæ˜¯æ§åˆ¶å—ï¼ŒåŒºåˆ«åœ¨äº Flush é“¾è¡¨çš„å…ƒç´ éƒ½æ˜¯è„é¡µã€‚</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230801101340605.png" alt="image-20230801101340605" style="zoom:45%;" /><p>æœ‰äº† Flush é“¾è¡¨åï¼Œåå°çº¿ç¨‹å°±å¯ä»¥éå† Flush é“¾è¡¨ï¼Œå°†è„é¡µå†™å…¥åˆ°ç£ç›˜ã€‚</p><h5 id="å¦‚ä½•æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Ÿ"><a href="#å¦‚ä½•æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Ÿ"></a>å¦‚ä½•æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Ÿ</h5><p>â€‹Buffer Pool çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œ<u>å¯¹äºä¸€äº›é¢‘ç¹è®¿é—®çš„æ•°æ®æˆ‘ä»¬å¸Œæœ›å¯ä»¥ä¸€ç›´ç•™åœ¨ Buffer Pool ä¸­ï¼Œè€Œä¸€äº›å¾ˆå°‘è®¿é—®çš„æ•°æ®å¸Œæœ›å¯ä»¥åœ¨æŸäº›æ—¶æœºå¯ä»¥æ·˜æ±°æ‰ï¼›</u></p><p>â€‹â€”â€”ä½¿ç”¨ç®€å•çš„LRUç®—æ³•</p><ul><li>å½“è®¿é—®çš„é¡µåœ¨ Buffer Pool é‡Œï¼Œå°±ç›´æ¥æŠŠè¯¥é¡µå¯¹åº”çš„ LRU é“¾è¡¨èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨çš„å¤´éƒ¨ã€‚</li><li>å½“è®¿é—®çš„é¡µä¸åœ¨ Buffer Pool é‡Œï¼Œé™¤äº†è¦æŠŠé¡µæ”¾å…¥åˆ° LRU é“¾è¡¨çš„å¤´éƒ¨ï¼Œè¿˜è¦æ·˜æ±° LRU é“¾è¡¨æœ«å°¾çš„èŠ‚ç‚¹ã€‚</li></ul><p>âš ï¸ç®€å•çš„ LRU ç®—æ³•å¹¶æ²¡æœ‰è¢« MySQL ä½¿ç”¨ï¼Œå› ä¸ºç®€å•çš„ LRU ç®—æ³•æ— æ³•é¿å…ä¸‹é¢è¿™ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>é¢„è¯»å¤±æ•ˆï¼›</li><li>Buffer Pool æ±¡æŸ“ï¼›</li></ul><h6 id="é¢„è¯»å¤±æ•ˆï¼š"><a href="#é¢„è¯»å¤±æ•ˆï¼š" class="headerlink" title="é¢„è¯»å¤±æ•ˆï¼š"></a>é¢„è¯»å¤±æ•ˆï¼š</h6><p>â€‹å…ˆæ¥è¯´è¯´ MySQL çš„é¢„è¯»æœºåˆ¶ã€‚ç¨‹åºæ˜¯æœ‰ç©ºé—´å±€éƒ¨æ€§çš„ï¼Œé è¿‘å½“å‰è¢«è®¿é—®æ•°æ®çš„æ•°æ®ï¼Œåœ¨æœªæ¥å¾ˆå¤§æ¦‚ç‡ä¼šè¢«è®¿é—®åˆ°ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>MySQL åœ¨åŠ è½½æ•°æ®é¡µæ—¶ï¼Œä¼šæå‰æŠŠå®ƒ <u><em>ç›¸é‚»çš„</em></u> æ•°æ®é¡µä¸€å¹¶åŠ è½½è¿›æ¥ï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘ç£ç›˜ IOã€‚</strong></p><p>ä½†æ˜¯å¯èƒ½è¿™äº›<strong>è¢«æå‰åŠ è½½è¿›æ¥çš„æ•°æ®é¡µï¼Œå¹¶æ²¡æœ‰è¢«è®¿é—®</strong>ï¼Œç›¸å½“äºè¿™ä¸ªé¢„è¯»æ˜¯ç™½åšäº†ï¼Œè¿™ä¸ªå°±æ˜¯<strong>é¢„è¯»å¤±æ•ˆ</strong>ã€‚</p><p>â€‹å¦‚æœè¿™äº›é¢„è¯»é¡µå¦‚æœä¸€ç›´ä¸ä¼šè¢«è®¿é—®åˆ°ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼šä¸ä¼šè¢«è®¿é—®çš„é¢„è¯»é¡µå´å ç”¨äº† LRU é“¾è¡¨å‰æ’çš„ä½ç½®ï¼Œè€Œæœ«å°¾æ·˜æ±°çš„é¡µï¼Œå¯èƒ½æ˜¯é¢‘ç¹è®¿é—®çš„é¡µï¼Œè¿™æ ·å°±å¤§å¤§é™ä½äº†ç¼“å­˜å‘½ä¸­ç‡ã€‚</p><h6 id="ğŸŒŸé¢„è¯»å¤±æ•ˆè§£å†³æ–¹æ¡ˆï¼š"><a href="#ğŸŒŸé¢„è¯»å¤±æ•ˆè§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="ğŸŒŸé¢„è¯»å¤±æ•ˆè§£å†³æ–¹æ¡ˆï¼š"></a>ğŸŒŸé¢„è¯»å¤±æ•ˆè§£å†³æ–¹æ¡ˆï¼š</h6><p>â€‹è¦é¿å…é¢„è¯»å¤±æ•ˆå¸¦æ¥å½±å“ï¼Œæœ€å¥½å°±æ˜¯**<u>è®©é¢„è¯»çš„é¡µåœç•™åœ¨ Buffer Pool é‡Œçš„æ—¶é—´è¦å°½å¯èƒ½çš„çŸ­</u>ï¼Œè®©çœŸæ­£è¢«è®¿é—®çš„é¡µæ‰ç§»åŠ¨åˆ° LRU é“¾è¡¨çš„å¤´éƒ¨ï¼Œä»è€Œä¿è¯çœŸæ­£è¢«è¯»å–çš„çƒ­æ•°æ®ç•™åœ¨ Buffer Pool é‡Œçš„æ—¶é—´å°½å¯èƒ½é•¿**ã€‚</p><p>MySQL æ˜¯è¿™æ ·åšçš„ï¼Œå®ƒæ”¹è¿›äº† LRU ç®—æ³•ï¼Œå°† LRU åˆ’åˆ†äº† 2 ä¸ªåŒºåŸŸï¼š<strong>old åŒºåŸŸ å’Œ young åŒºåŸŸ</strong>ã€‚</p><p>young åŒºåŸŸåœ¨ LRU é“¾è¡¨çš„å‰åŠéƒ¨åˆ†ï¼Œold åŒºåŸŸåˆ™æ˜¯åœ¨ååŠéƒ¨åˆ†ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230801102129142.png" alt="image-20230801102129142" style="zoom: 33%;" /><p>**åˆ’åˆ†è¿™ä¸¤ä¸ªåŒºåŸŸåï¼Œé¢„è¯»çš„é¡µ(æ‰€æœ‰ä»ç£ç›˜è¯»å…¥çš„é¡µéƒ½å…ˆæ”¾åˆ°oldåŒºå¤´éƒ¨)å°±åªéœ€è¦åŠ å…¥åˆ° old åŒºåŸŸçš„å¤´éƒ¨ï¼Œ<u>å½“é¡µè¢«çœŸæ­£è®¿é—®çš„æ—¶å€™ï¼Œæ‰å°†é¡µæ’å…¥ young åŒºåŸŸçš„å¤´éƒ¨</u>**ã€‚å¦‚æœé¢„è¯»çš„é¡µä¸€ç›´æ²¡æœ‰è¢«è®¿é—®ï¼Œå°±ä¼šä» old åŒºåŸŸç§»é™¤ï¼Œè¿™æ ·å°±ä¸ä¼šå½±å“ young åŒºåŸŸä¸­çš„çƒ­ç‚¹æ•°æ®ã€‚</p><p>â€”-youngã€oldåŒºåŸŸæ¯”ä¾‹å…³ç³»å¯æ‰‹åŠ¨è®¾è®¡</p><h6 id="Buffer-Pool-æ±¡æŸ“ï¼š"><a href="#Buffer-Pool-æ±¡æŸ“ï¼š" class="headerlink" title="Buffer Pool æ±¡æŸ“ï¼š"></a>Buffer Pool æ±¡æŸ“ï¼š</h6><p>â€‹å½“æŸä¸€ä¸ª SQL è¯­å¥<strong>æ‰«æäº†å¤§é‡çš„æ•°æ®</strong>æ—¶ï¼Œåœ¨ Buffer Pool ç©ºé—´æ¯”è¾ƒæœ‰é™çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå°† <strong>Buffer Pool é‡Œçš„æ‰€æœ‰é¡µéƒ½æ›¿æ¢å‡ºå»ï¼Œå¯¼è‡´å¤§é‡çƒ­æ•°æ®è¢«æ·˜æ±°äº†</strong>ï¼Œç­‰è¿™äº›çƒ­æ•°æ®åˆè¢«å†æ¬¡è®¿é—®çš„æ—¶å€™ï¼Œç”±äºç¼“å­˜æœªå‘½ä¸­ï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡çš„ç£ç›˜ IOï¼ŒMySQL æ€§èƒ½å°±ä¼šæ€¥å‰§ä¸‹é™ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸º <strong>Buffer Pool æ±¡æŸ“</strong>ã€‚</p><h6 id="Buffer-Pool-æ±¡æŸ“è§£å†³æ–¹æ¡ˆï¼š"><a href="#Buffer-Pool-æ±¡æŸ“è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="Buffer Pool æ±¡æŸ“è§£å†³æ–¹æ¡ˆï¼š"></a>Buffer Pool æ±¡æŸ“è§£å†³æ–¹æ¡ˆï¼š</h6><p>â€‹åƒå‰é¢è¿™ç§å…¨è¡¨æ‰«æçš„æŸ¥è¯¢ï¼Œ<u>å¾ˆå¤šç¼“å†²é¡µå…¶å®åªä¼šè¢«è®¿é—®ä¸€æ¬¡ï¼Œä½†æ˜¯å®ƒå´åªå› ä¸ºè¢«è®¿é—®äº†ä¸€æ¬¡è€Œè¿›å…¥åˆ° young åŒºåŸŸï¼Œä»è€Œå¯¼è‡´çƒ­ç‚¹æ•°æ®è¢«æ›¿æ¢äº†ã€‚</u></p><p>LRU é“¾è¡¨ä¸­ young åŒºåŸŸå°±æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œåªè¦æˆ‘ä»¬<u>æé«˜è¿›å…¥åˆ° young åŒºåŸŸçš„é—¨æ§›</u>ï¼Œå°±èƒ½æœ‰æ•ˆåœ°ä¿è¯ young åŒºåŸŸé‡Œçš„çƒ­ç‚¹æ•°æ®ä¸ä¼šè¢«æ›¿æ¢æ‰ã€‚</p><p>MySQL æ˜¯è¿™æ ·åšçš„ï¼Œè¿›å…¥åˆ° young åŒºåŸŸæ¡ä»¶å¢åŠ äº†ä¸€ä¸ª<strong>åœç•™åœ¨ old åŒºåŸŸçš„æ—¶é—´åˆ¤æ–­</strong>ã€‚</p><p>å…·ä½“æ˜¯è¿™æ ·åšçš„ï¼Œåœ¨å¯¹æŸä¸ªå¤„åœ¨ old åŒºåŸŸçš„ç¼“å­˜é¡µè¿›è¡Œç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œå°±åœ¨å®ƒå¯¹åº”çš„æ§åˆ¶å—ä¸­è®°å½•ä¸‹æ¥è¿™ä¸ªè®¿é—®æ—¶é—´ï¼š</p><ul><li>å¦‚æœåç»­çš„è®¿é—®æ—¶é—´ä¸ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶é—´<strong>åœ¨æŸä¸ªæ—¶é—´é—´éš”å†…</strong>ï¼Œé‚£ä¹ˆ<strong>è¯¥ç¼“å­˜é¡µå°±ä¸ä¼šè¢«ä» old åŒºåŸŸç§»åŠ¨åˆ° young åŒºåŸŸçš„å¤´éƒ¨</strong>ï¼›</li><li>å¦‚æœåç»­çš„è®¿é—®æ—¶é—´ä¸ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶é—´<strong>ä¸åœ¨æŸä¸ªæ—¶é—´é—´éš”å†…</strong>ï¼Œé‚£ä¹ˆ<strong>è¯¥ç¼“å­˜é¡µç§»åŠ¨åˆ° young åŒºåŸŸçš„å¤´éƒ¨</strong>ï¼›</li></ul><p>è¿™ä¸ªé—´éš”æ—¶é—´æ˜¯ç”± <code>innodb_old_blocks_time</code> æ§åˆ¶çš„ï¼Œé»˜è®¤æ˜¯ 1000 msã€‚</p><p>ä¹Ÿå°±è¯´ï¼Œ<strong>åªæœ‰åŒæ—¶æ»¡è¶³ã€Œè¢«è®¿é—®ã€ä¸ã€Œåœ¨ old åŒºåŸŸåœç•™æ—¶é—´è¶…è¿‡ 1 ç§’ã€ä¸¤ä¸ªæ¡ä»¶ï¼Œæ‰ä¼šè¢«æ’å…¥åˆ° young åŒºåŸŸå¤´éƒ¨</strong>ï¼Œè¿™æ ·å°±è§£å†³äº† Buffer Pool æ±¡æŸ“çš„é—®é¢˜ ã€‚</p><h5 id="è„é¡µä»€ä¹ˆæ—¶å€™ä¼šè¢«åˆ·å…¥ç£ç›˜ï¼Ÿ"><a href="#è„é¡µä»€ä¹ˆæ—¶å€™ä¼šè¢«åˆ·å…¥ç£ç›˜ï¼Ÿ" class="headerlink" title="è„é¡µä»€ä¹ˆæ—¶å€™ä¼šè¢«åˆ·å…¥ç£ç›˜ï¼Ÿ"></a>è„é¡µä»€ä¹ˆæ—¶å€™ä¼šè¢«åˆ·å…¥ç£ç›˜ï¼Ÿ</h5><p>å¦‚æœæ¯æ¬¡éƒ½è¦æŠŠè„é¡µå†™å…¥ç£ç›˜åŒæ­¥æ•°æ®çš„è¯æ€§èƒ½ä¼šå¾ˆä½ï¼Œä½†æ˜¯å¦‚æœä¸ç«‹å³åŒæ­¥çš„è¯ï¼Œå¦‚æœmysqlå®•æœºäº†å°±ä¼šä¸¢å¤±æ•°æ®ï¼Ÿ</p><p>â€‹è¿™ä¸ªä¸ç”¨æ‹…å¿ƒï¼ŒInnoDB çš„æ›´æ–°æ“ä½œé‡‡ç”¨çš„æ˜¯ Write Ahead Log ç­–ç•¥ï¼Œå³å…ˆå†™æ—¥å¿—ï¼Œå†å†™å…¥ç£ç›˜ï¼Œé€šè¿‡ redo log æ—¥å¿—è®© MySQL æ‹¥æœ‰äº†å´©æºƒæ¢å¤èƒ½åŠ›ã€‚</p><p>ä¸‹é¢å‡ ç§æƒ…å†µä¼š**<u>è§¦å‘è„é¡µçš„åˆ·æ–°</u>**ï¼š</p><ul><li>å½“ redo log æ—¥å¿—æ»¡äº†çš„æƒ…å†µä¸‹ï¼Œä¼šä¸»åŠ¨è§¦å‘è„é¡µåˆ·æ–°åˆ°ç£ç›˜ï¼›</li><li>Buffer Pool ç©ºé—´ä¸è¶³æ—¶ï¼Œéœ€è¦å°†ä¸€éƒ¨åˆ†æ•°æ®é¡µæ·˜æ±°æ‰ï¼Œå¦‚æœæ·˜æ±°çš„æ˜¯è„é¡µï¼Œéœ€è¦å…ˆå°†è„é¡µåŒæ­¥åˆ°ç£ç›˜ï¼›</li><li>MySQL è®¤ä¸ºç©ºé—²æ—¶ï¼Œåå°çº¿ç¨‹ä¼šå®šæœŸå°†é€‚é‡çš„è„é¡µåˆ·å…¥åˆ°ç£ç›˜ï¼›</li><li>MySQL æ­£å¸¸å…³é—­ä¹‹å‰ï¼Œä¼šæŠŠæ‰€æœ‰çš„è„é¡µåˆ·å…¥åˆ°ç£ç›˜ï¼›</li></ul><p>åœ¨æˆ‘ä»¬å¼€å¯äº†æ…¢ SQL ç›‘æ§åï¼Œå¦‚æœä½ å‘ç°<strong>ã€Œå¶å°”ã€ä¼šå‡ºç°ä¸€äº›ç”¨æ—¶ç¨é•¿çš„ SQL</strong>ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºè„é¡µåœ¨åˆ·æ–°åˆ°ç£ç›˜æ—¶å¯èƒ½ä¼šç»™æ•°æ®åº“å¸¦æ¥æ€§èƒ½å¼€é”€ï¼Œå¯¼è‡´æ•°æ®åº“æ“ä½œæŠ–åŠ¨ã€‚</p><p>åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…å¤šæ¬¡å‡ºç°è¿™ç§ç°è±¡ï¼Œå°±éœ€è¦è°ƒå¤§ Buffer Pool ç©ºé—´æˆ– redo log æ—¥å¿—çš„å¤§å°ã€‚</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>Innodb å­˜å‚¨å¼•æ“è®¾è®¡äº†ä¸€ä¸ª<strong>ç¼“å†²æ± ï¼ˆ<em>Buffer Pool</em>ï¼‰</strong>ï¼Œæ¥æé«˜æ•°æ®åº“çš„è¯»å†™æ€§èƒ½ã€‚</p><p>Buffer Pool ä»¥é¡µä¸ºå•ä½ç¼“å†²æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ <code>innodb_buffer_pool_size</code> å‚æ•°è°ƒæ•´ç¼“å†²æ± çš„å¤§å°ï¼Œé»˜è®¤æ˜¯ 128 Mã€‚</p><p>Innodb é€šè¿‡ä¸‰ç§é“¾è¡¨æ¥ç®¡ç†ç¼“é¡µï¼š</p><ul><li>Free List ï¼ˆç©ºé—²é¡µé“¾è¡¨ï¼‰ï¼Œç®¡ç†ç©ºé—²é¡µï¼›</li><li>Flush List ï¼ˆè„é¡µé“¾è¡¨ï¼‰ï¼Œç®¡ç†è„é¡µï¼›</li><li>LRU Listï¼Œç®¡ç†è„é¡µ+å¹²å‡€é¡µï¼Œå°†æœ€è¿‘ä¸”ç»å¸¸æŸ¥è¯¢çš„æ•°æ®ç¼“å­˜åœ¨å…¶ä¸­ï¼Œè€Œä¸å¸¸æŸ¥è¯¢çš„æ•°æ®å°±æ·˜æ±°å‡ºå»ã€‚ï¼›</li></ul><p>InnoDB å¯¹ LRU åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰çš„ LRU ç®—æ³•é€šå¸¸æ˜¯å°†æœ€è¿‘æŸ¥è¯¢çš„æ•°æ®æ”¾åˆ° LRU é“¾è¡¨çš„å¤´éƒ¨ï¼Œè€Œ InnoDB åš 2 ç‚¹ä¼˜åŒ–ï¼š</p><ul><li>å°† LRU é“¾è¡¨ åˆ†ä¸º<strong>young å’Œ old ä¸¤ä¸ªåŒºåŸŸ</strong>ï¼ŒåŠ å…¥ç¼“å†²æ± çš„é¡µï¼Œä¼˜å…ˆæ’å…¥ old åŒºåŸŸï¼›é¡µè¢«è®¿é—®æ—¶ï¼Œæ‰è¿›å…¥ young åŒºåŸŸï¼Œç›®çš„æ˜¯ä¸ºäº†è§£å†³é¢„è¯»å¤±æ•ˆçš„é—®é¢˜ã€‚</li><li>å½“<strong>ã€Œé¡µè¢«è®¿é—®ã€ä¸”ã€Œ old åŒºåŸŸåœç•™æ—¶é—´è¶…è¿‡ <code>innodb_old_blocks_time</code> é˜ˆå€¼ï¼ˆé»˜è®¤ä¸º1ç§’ï¼‰ã€</strong>æ—¶ï¼Œæ‰ä¼šå°†é¡µæ’å…¥åˆ° young åŒºåŸŸï¼Œå¦åˆ™è¿˜æ˜¯æ’å…¥åˆ° old åŒºåŸŸï¼Œç›®çš„æ˜¯ä¸ºäº†è§£å†³æ‰¹é‡æ•°æ®è®¿é—®ï¼Œå¤§é‡çƒ­æ•°æ®æ·˜æ±°çš„é—®é¢˜ã€‚</li></ul><p>å¯ä»¥é€šè¿‡è°ƒæ•´ <code>innodb_old_blocks_pct</code> å‚æ•°ï¼Œè®¾ç½® young åŒºåŸŸå’Œ old åŒºåŸŸæ¯”ä¾‹ã€‚</p><p>åœ¨å¼€å¯äº†æ…¢ SQL ç›‘æ§åï¼Œå¦‚æœä½ å‘ç°ã€Œå¶å°”ã€ä¼šå‡ºç°ä¸€äº›ç”¨æ—¶ç¨é•¿çš„ SQLï¼Œè¿™å¯èƒ½å› ä¸ºè„é¡µåœ¨åˆ·æ–°åˆ°ç£ç›˜æ—¶å¯¼è‡´æ•°æ®åº“æ€§èƒ½æŠ–åŠ¨ã€‚å¦‚æœåœ¨å¾ˆçŸ­çš„æ—¶é—´å†…å¤šæ¬¡å‡ºç°è¿™ç§ç°è±¡ï¼Œå°±éœ€è¦è°ƒå¤§ Buffer Pool ç©ºé—´æˆ– redo log æ—¥å¿—çš„å¤§å°ã€‚</p><h3 id="Change-Buffer"><a href="#Change-Buffer" class="headerlink" title="Change Buffer"></a>Change Buffer</h3><p>â€‹å½“éœ€è¦æ›´æ–°ä¸€ä¸ªæ•°æ®é¡µæ—¶ï¼Œå¦‚æœæ•°æ®é¡µåœ¨å†…å­˜ä¸­å°±ç›´æ¥æ›´æ–°ï¼Œè€Œ<u>å¦‚æœè¿™ä¸ªæ•°æ®é¡µè¿˜æ²¡æœ‰åœ¨å†…å­˜ä¸­</u>çš„è¯ï¼Œåœ¨ä¸å½±å“æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼ŒInooDB ä¼š<u>å°†è¿™äº›æ›´æ–°æ“ä½œç¼“å­˜åœ¨ change buffer ä¸­</u>ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä»ç£ç›˜ä¸­è¯»å…¥è¿™ä¸ªæ•°æ®é¡µäº†ã€‚åœ¨<u>ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œå°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œç„¶åæ‰§è¡Œ change buffer ä¸­ä¸è¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œ</u>ã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½ä¿è¯è¿™ä¸ªæ•°æ®é€»è¾‘çš„æ­£ç¡®æ€§ã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè™½ç„¶åå­—å«ä½œ change bufferï¼Œå®é™…ä¸Šå®ƒæ˜¯å¯ä»¥æŒä¹…åŒ–çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œchange buffer åœ¨å†…å­˜ä¸­æœ‰æ‹·è´ï¼Œä¹Ÿä¼šè¢«å†™å…¥åˆ°ç£ç›˜ä¸Šã€‚</p><p><strong>å°† change buffer ä¸­çš„æ“ä½œåº”ç”¨åˆ°åŸæ•°æ®é¡µ</strong>ï¼Œå¾—åˆ°æœ€æ–°ç»“æœçš„è¿‡ç¨‹ç§°ä¸º <strong>merge</strong>ã€‚</p><p>æ‰§è¡Œmergeï¼š</p><ol><li>è®¿é—®è¿™ä¸ªæ•°æ®é¡µä¼šè§¦å‘ merge</li><li>ç³»ç»Ÿæœ‰åå°çº¿ç¨‹ä¼šå®šæœŸ merge</li><li>åœ¨æ•°æ®åº“æ­£å¸¸å…³é—­ï¼ˆshutdownï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ‰§è¡Œ merge æ“ä½œ</li></ol><h4 id="ä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥ä½¿ç”¨-change-bufferï¼Ÿ"><a href="#ä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥ä½¿ç”¨-change-bufferï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥ä½¿ç”¨ change bufferï¼Ÿ"></a>ä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥ä½¿ç”¨ change bufferï¼Ÿ</h4><h5 id="ä¾‹1ğŸŒ°ï¼š"><a href="#ä¾‹1ğŸŒ°ï¼š" class="headerlink" title="ä¾‹1ğŸŒ°ï¼š"></a>ä¾‹1ğŸŒ°ï¼š</h5><p>â€‹å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œ<u>æ‰€æœ‰çš„æ›´æ–°æ“ä½œéƒ½è¦å…ˆåˆ¤æ–­è¿™ä¸ªæ“ä½œæ˜¯å¦è¿åå”¯ä¸€æ€§çº¦æŸ</u>ã€‚æ¯”å¦‚ï¼Œè¦æ’å…¥ (4,400) è¿™ä¸ªè®°å½•ï¼Œå°±è¦å…ˆåˆ¤æ–­ç°åœ¨è¡¨ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ k&#x3D;4 çš„è®°å½•ï¼Œ<u>è€Œè¿™å¿…é¡»è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜æ‰èƒ½åˆ¤æ–­</u>ã€‚å¦‚æœéƒ½å·²ç»è¯»å…¥åˆ°å†…å­˜äº†ï¼Œé‚£ç›´æ¥æ›´æ–°å†…å­˜ä¼šæ›´å¿«ï¼Œå°±æ²¡å¿…è¦ä½¿ç”¨ change buffer äº†ã€‚</p><p>âš ï¸å› æ­¤ï¼Œå”¯ä¸€ç´¢å¼•çš„æ›´æ–°å°±ä¸èƒ½ä½¿ç”¨ change bufferï¼Œå®é™…ä¸Šä¹Ÿåªæœ‰æ™®é€šç´¢å¼•(ä¸ç”¨åˆ¤æ–­å”¯ä¸€æ€§ï¼Œå› æ­¤æ›´æ–°æ“ä½œä¸å¯èƒ½æŠ¥é”™)å¯ä»¥ä½¿ç”¨ã€‚</p><h5 id="ä¾‹2ğŸŒ°ï¼š"><a href="#ä¾‹2ğŸŒ°ï¼š" class="headerlink" title="ä¾‹2ğŸŒ°ï¼š"></a>ä¾‹2ğŸŒ°ï¼š</h5><p>å¦‚æœè¦åœ¨è¿™å¼ è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ–°è®°å½• (4 {ç´¢å¼•åˆ—} ,400 {æ™®é€šåˆ—}) çš„è¯ï¼ŒInnoDB çš„å¤„ç†æµç¨‹æ˜¯æ€æ ·çš„ã€‚</p><p>ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼Œ<strong>è¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µåœ¨å†…å­˜ä¸­</strong>ã€‚è¿™æ—¶ï¼ŒInnoDB çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œæ‰¾åˆ° 3 å’Œ 5 ä¹‹é—´çš„ä½ç½®ï¼Œåˆ¤æ–­åˆ°æ²¡æœ‰å†²çªï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸï¼›</li><li>å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œæ‰¾åˆ° 3 å’Œ 5 ä¹‹é—´çš„ä½ç½®ï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸã€‚</li></ul><p>è¿™æ ·çœ‹æ¥ï¼Œæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¯¹æ›´æ–°è¯­å¥æ€§èƒ½å½±å“çš„å·®åˆ«ï¼Œåªæ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œåªä¼šè€—è´¹å¾®å°çš„ CPU æ—¶é—´ã€‚</p><p>ä½†ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹ã€‚</p><p>ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œ<strong>è¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µä¸åœ¨å†…å­˜ä¸­</strong>ã€‚è¿™æ—¶ï¼ŒInnoDB çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œéœ€è¦<u>å°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œåˆ¤æ–­åˆ°æ²¡æœ‰å†²çªï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸ</u>ï¼›</li><li>å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œåˆ™æ˜¯<u>å°†æ›´æ–°è®°å½•åœ¨ change bufferï¼Œè¯­å¥æ‰§è¡Œå°±ç»“æŸäº†</u>ã€‚</li></ul><p>å°†æ•°æ®ä»ç£ç›˜è¯»å…¥å†…å­˜æ¶‰åŠéšæœº IO çš„è®¿é—®ï¼Œæ˜¯æ•°æ®åº“é‡Œé¢æˆæœ¬æœ€é«˜çš„æ“ä½œä¹‹ä¸€ã€‚change buffer å› ä¸ºå‡å°‘äº†éšæœºç£ç›˜è®¿é—®ï¼Œæ‰€ä»¥å¯¹æ›´æ–°æ€§èƒ½çš„æå‡æ˜¯ä¼šå¾ˆæ˜æ˜¾çš„ã€‚</p><h4 id="change-buffer-çš„ä½¿ç”¨åœºæ™¯"><a href="#change-buffer-çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="change buffer çš„ä½¿ç”¨åœºæ™¯"></a>change buffer çš„ä½¿ç”¨åœºæ™¯</h4><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æ¸…æ¥šäº†ä½¿ç”¨ change buffer å¯¹æ›´æ–°è¿‡ç¨‹çš„åŠ é€Ÿä½œç”¨ï¼Œä¹Ÿæ¸…æ¥šäº† change buffer <u>åªé™äºç”¨åœ¨æ™®é€šç´¢å¼•çš„åœºæ™¯ä¸‹ï¼Œè€Œä¸é€‚ç”¨äºå”¯ä¸€ç´¢å¼•ã€‚</u></p><p>â€‹<strong>é‚£ä¹ˆæ™®é€šç´¢å¼•çš„æ‰€æœ‰åœºæ™¯ï¼Œä½¿ç”¨ change buffer éƒ½å¯ä»¥èµ·åˆ°åŠ é€Ÿä½œç”¨å—ï¼Ÿ</strong></p><p>â€‹å› ä¸º merge çš„æ—¶å€™æ˜¯çœŸæ­£è¿›è¡Œæ•°æ®æ›´æ–°çš„æ—¶åˆ»ï¼Œè€Œ change buffer çš„ä¸»è¦ç›®çš„å°±æ˜¯å°†è®°å½•çš„å˜æ›´åŠ¨ä½œç¼“å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥<u><strong>åœ¨ä¸€ä¸ªæ•°æ®é¡µåš merge ä¹‹å‰ï¼Œchange buffer è®°å½•çš„å˜æ›´è¶Šå¤šï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªé¡µé¢ä¸Šè¦æ›´æ–°çš„æ¬¡æ•°è¶Šå¤šï¼‰ï¼Œæ”¶ç›Šå°±è¶Šå¤§ã€‚</strong></u></p><p>â€‹å› æ­¤ï¼Œå¯¹äº<u>å†™å¤šè¯»å°‘</u>çš„ä¸šåŠ¡æ¥è¯´ï¼Œé¡µé¢åœ¨å†™å®Œä»¥åé©¬ä¸Šè¢«è®¿é—®åˆ°çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶ <u>change buffer çš„ä½¿ç”¨æ•ˆæœæœ€å¥½</u>ã€‚è¿™ç§ä¸šåŠ¡æ¨¡å‹å¸¸è§çš„å°±æ˜¯è´¦å•ç±»ã€æ—¥å¿—ç±»çš„ç³»ç»Ÿã€‚</p><p>â€‹åè¿‡æ¥ï¼Œå‡è®¾ä¸€ä¸ªä¸šåŠ¡çš„æ›´æ–°æ¨¡å¼æ˜¯å†™å…¥ä¹‹åé©¬ä¸Šä¼šåšæŸ¥è¯¢ï¼Œé‚£ä¹ˆå³ä½¿æ»¡è¶³äº†æ¡ä»¶ï¼Œå°†æ›´æ–°å…ˆè®°å½•åœ¨ change bufferï¼Œä½†ä¹‹åç”±äºé©¬ä¸Šè¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µï¼Œä¼šç«‹å³è§¦å‘ merge è¿‡ç¨‹ã€‚<u>è¿™æ ·éšæœºè®¿é—® IO çš„æ¬¡æ•°ä¸ä¼šå‡å°‘ï¼Œåè€Œå¢åŠ äº† change buffer çš„ç»´æŠ¤ä»£ä»·</u>ã€‚æ‰€ä»¥ï¼Œå¯¹äºè¿™ç§ä¸šåŠ¡æ¨¡å¼æ¥è¯´ï¼Œchange buffer åè€Œèµ·åˆ°äº†å‰¯ä½œç”¨ã€‚</p><h4 id="æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•åº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿ"><a href="#æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•åº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿ" class="headerlink" title="æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•åº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿ"></a>æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•åº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿ</h4><p>â€‹å…¶å®ï¼Œè¿™ä¸¤ç±»ç´¢å¼•åœ¨æŸ¥è¯¢èƒ½åŠ›ä¸Šæ˜¯æ²¡å·®åˆ«çš„ï¼Œä¸»è¦è€ƒè™‘çš„æ˜¯å¯¹æ›´æ–°æ€§èƒ½çš„å½±å“ã€‚æ‰€ä»¥ï¼Œå»ºè®®å°½é‡é€‰æ‹©æ™®é€šç´¢å¼•ã€‚</p><p>â€‹å¦‚æœæ‰€æœ‰çš„æ›´æ–°åé¢ï¼Œéƒ½<u>é©¬ä¸Šä¼´éšç€å¯¹è¿™ä¸ªè®°å½•çš„æŸ¥è¯¢</u>ï¼Œé‚£ä¹ˆä½ åº”è¯¥å…³é—­ change bufferã€‚è€Œåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œchange buffer éƒ½èƒ½æå‡æ›´æ–°æ€§èƒ½ã€‚</p><p>â€‹åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä½ ä¼šå‘ç°ï¼Œæ™®é€šç´¢å¼•å’Œ change buffer çš„é…åˆä½¿ç”¨ï¼Œå¯¹äºæ•°æ®é‡å¤§çš„è¡¨çš„æ›´æ–°ä¼˜åŒ–è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚</p><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><h3 id="ç´¢å¼•æ•°æ®ç»“æ„"><a href="#ç´¢å¼•æ•°æ®ç»“æ„" class="headerlink" title="ç´¢å¼•æ•°æ®ç»“æ„"></a>ç´¢å¼•æ•°æ®ç»“æ„</h3><h4 id="B-æ ‘ç´¢å¼•ç»“æ„-æœ€å¹¿æ³›"><a href="#B-æ ‘ç´¢å¼•ç»“æ„-æœ€å¹¿æ³›" class="headerlink" title="B+æ ‘ç´¢å¼•ç»“æ„(æœ€å¹¿æ³›)"></a>B+æ ‘ç´¢å¼•ç»“æ„(æœ€å¹¿æ³›)</h4><h5 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h5><p>â€‹åŸºäº<strong>ç£ç›˜</strong>çš„å¹³è¡¡æ ‘ï¼Œä½†<u>æ ‘éå¸¸çŸ®ï¼Œé€šå¸¸ä¸º 3~4 å±‚</u>ï¼Œèƒ½å­˜æ”¾åƒä¸‡åˆ°ä¸Šäº¿çš„æ’åºæ•°æ®ã€‚æ ‘çŸ®æ„å‘³ç€è®¿é—®æ•ˆç‡é«˜ï¼Œä»åƒä¸‡æˆ–ä¸Šäº¿æ•°æ®é‡ŒæŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œåªç”¨ 3ã€4 æ¬¡ I&#x2F;Oã€‚</p><h5 id="ç»„æˆï¼š"><a href="#ç»„æˆï¼š" class="headerlink" title="ç»„æˆï¼š"></a>ç»„æˆï¼š</h5><ul><li>B+ æ ‘ç´¢å¼•ç”±æ ¹èŠ‚ç‚¹ï¼ˆroot nodeï¼‰ã€ä¸­é—´èŠ‚ç‚¹ï¼ˆnon leaf nodeï¼‰ã€å¶å­èŠ‚ç‚¹ï¼ˆleaf nodeï¼‰ç»„æˆï¼Œå…¶ä¸­<strong>å¶å­èŠ‚ç‚¹å­˜æ”¾æ‰€æœ‰æ’åºåçš„æ•°æ®</strong>ã€‚</li><li>å› æ­¤åœ¨å…¶å¶å­ç»“ç‚¹å¯»æ‰¾æ•°æ®åªéœ€è¦lognçš„æ—¶é—´å¤æ‚åº¦ï¼</li></ul><p>âš ï¸ï¼šå½“ B+ æ ‘çš„é«˜åº¦å¤§äºç­‰äº 2 æ—¶ï¼Œ<u><strong>æ ¹èŠ‚ç‚¹å’Œä¸­é—´èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ç´¢å¼•é”®å¯¹</strong>(ä»…ç”¨æ¥å½“ä½œâ€˜è·¯æ ‡â€™ï¼Œåˆ’åˆ†ä¸åŒç´¢å¼•å€¼çš„å¶å­ç»“ç‚¹)</u>ï¼Œç”±ï¼ˆç´¢å¼•é”®ã€æŒ‡é’ˆï¼‰ç»„æˆã€‚</p><h5 id="ä¼˜åŒ–-B-æ ‘ç´¢å¼•çš„æ’å…¥æ€§èƒ½ï¼š"><a href="#ä¼˜åŒ–-B-æ ‘ç´¢å¼•çš„æ’å…¥æ€§èƒ½ï¼š" class="headerlink" title="ä¼˜åŒ– B+ æ ‘ç´¢å¼•çš„æ’å…¥æ€§èƒ½ï¼š"></a>ä¼˜åŒ– B+ æ ‘ç´¢å¼•çš„æ’å…¥æ€§èƒ½ï¼š</h5><p>B+ æ ‘åœ¨æ’å…¥æ—¶å°±å¯¹è¦å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œä½†æ’åºçš„å¼€é”€å…¶å®å¹¶æ²¡æœ‰ä½ æƒ³è±¡å¾—é‚£ä¹ˆå¤§ï¼Œå› ä¸ºæ’åºæ˜¯ CPU æ“ä½œï¼ˆå½“å‰ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸ CPU èƒ½å¤„ç†ä¸Šäº¿æŒ‡ä»¤ï¼‰ã€‚</p><p><strong>çœŸæ­£çš„å¼€é”€åœ¨äº B+ æ ‘ç´¢å¼•çš„ç»´æŠ¤ï¼Œä¿è¯æ•°æ®æ’åºï¼Œè¿™é‡Œå­˜åœ¨ä¸¤ç§ä¸åŒæ•°æ®ç±»å‹çš„æ’å…¥æƒ…å†µ</strong>ã€‚</p><ul><li><strong>æ•°æ®é¡ºåºï¼ˆæˆ–é€†åºï¼‰æ’å…¥ï¼š</strong> B+ æ ‘ç´¢å¼•çš„ç»´æŠ¤ä»£ä»·éå¸¸å°ï¼Œå¶å­èŠ‚ç‚¹éƒ½æ˜¯ä»å·¦å¾€å³è¿›è¡Œæ’å…¥ï¼Œæ¯”è¾ƒå…¸å‹çš„æ˜¯è‡ªå¢ ID çš„æ’å…¥ã€æ—¶é—´çš„æ’å…¥ï¼ˆè‹¥åœ¨è‡ªå¢ ID ä¸Šåˆ›å»ºç´¢å¼•ï¼Œæ—¶é—´åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œåˆ™ B+ æ ‘æ’å…¥é€šå¸¸æ˜¯æ¯”è¾ƒå¿«çš„ï¼‰ã€‚</li><li><strong>æ•°æ®æ— åºæ’å…¥ï¼š</strong> B+ æ ‘ä¸ºäº†ç»´æŠ¤æ’åºï¼Œéœ€è¦å¯¹é¡µè¿›è¡Œåˆ†è£‚ã€æ—‹è½¬ç­‰å¼€é”€è¾ƒå¤§çš„æ“ä½œï¼Œå¦å¤–ï¼Œå³ä¾¿å¯¹äºå›ºæ€ç¡¬ç›˜ï¼Œéšæœºå†™çš„æ€§èƒ½ä¹Ÿä¸å¦‚é¡ºåºå†™ï¼Œæ‰€ä»¥ç£ç›˜æ€§èƒ½ä¹Ÿä¼šæ”¶åˆ°è¾ƒå¤§å½±å“ã€‚æ¯”è¾ƒå…¸å‹çš„æ˜¯ç”¨æˆ·æ˜µç§°ï¼Œæ¯ä¸ªç”¨æˆ·æ³¨å†Œæ—¶ï¼Œæ˜µç§°æ˜¯éšæ„å–çš„ï¼Œè‹¥åœ¨æ˜µç§°ä¸Šåˆ›å»ºç´¢å¼•ï¼Œæ’å…¥æ˜¯æ— åºçš„ï¼Œç´¢å¼•ç»´æŠ¤éœ€è¦çš„å¼€é”€ä¼šæ¯”è¾ƒå¤§ã€‚</li></ul><p>ä½ ä¸å¯èƒ½è¦æ±‚æ‰€æœ‰æ’å…¥çš„æ•°æ®éƒ½æ˜¯æœ‰åºçš„ï¼Œå› ä¸ºç´¢å¼•çš„æœ¬èº«å°±æ˜¯ç”¨äºæ•°æ®çš„æ’åºï¼Œæ’å…¥æ•°æ®éƒ½å·²ç»æ˜¯æ’åºçš„ï¼Œé‚£ä¹ˆä½ å°±ä¸éœ€è¦ B+ æ ‘ç´¢å¼•è¿›è¡Œæ•°æ®æŸ¥è¯¢äº†ã€‚</p><p>æ‰€ä»¥å¯¹äº B+ æ ‘ç´¢å¼•ï¼Œåœ¨ MySQL æ•°æ®åº“è®¾è®¡ä¸­ï¼Œä»…<u>è¦æ±‚ä¸»é”®çš„ç´¢å¼•è®¾è®¡ä¸ºé¡ºåº</u>ï¼Œæ¯”å¦‚ä½¿ç”¨è‡ªå¢ï¼Œæˆ–ä½¿ç”¨å‡½æ•° UUID_TO_BIN æ’åºçš„ UUIDï¼Œè€Œä¸ç”¨æ— åºå€¼åšä¸»é”®ã€‚</p><h4 id="ä¸ºä»€ä¹ˆ-MySQL-é‡‡ç”¨-B-æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-MySQL-é‡‡ç”¨-B-æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ MySQL é‡‡ç”¨ B+ æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ MySQL é‡‡ç”¨ B+ æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿ</h4><p>â€‹æ•°æ®åº“çš„ç´¢å¼•æ˜¯ä¿å­˜åˆ°ç£ç›˜ä¸Šçš„ï¼Œå› æ­¤å½“æˆ‘ä»¬é€šè¿‡ç´¢å¼•æŸ¥æ‰¾æŸè¡Œæ•°æ®çš„æ—¶å€™ï¼Œå°±éœ€è¦å…ˆä»ç£ç›˜è¯»å–ç´¢å¼•åˆ°å†…å­˜ï¼Œå†é€šè¿‡ç´¢å¼•ä»ç£ç›˜ä¸­æ‰¾åˆ°æŸè¡Œæ•°æ®ï¼Œç„¶åè¯»å…¥åˆ°å†…å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥è¯¢è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿå¤šæ¬¡ç£ç›˜ I&#x2F;Oï¼Œè€Œç£ç›˜ I&#x2F;O æ¬¡æ•°è¶Šå¤šï¼Œæ‰€æ¶ˆè€—çš„æ—¶é—´ä¹Ÿå°±è¶Šå¤§ã€‚</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230802111506165.png" alt="image-20230802111506165" style="zoom:50%;" /><h5 id="MySQL-é»˜è®¤çš„å­˜å‚¨å¼•æ“-InnoDB-é‡‡ç”¨çš„æ˜¯-B-ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ŒåŸå› æœ‰ï¼š"><a href="#MySQL-é»˜è®¤çš„å­˜å‚¨å¼•æ“-InnoDB-é‡‡ç”¨çš„æ˜¯-B-ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ŒåŸå› æœ‰ï¼š" class="headerlink" title="MySQL é»˜è®¤çš„å­˜å‚¨å¼•æ“ InnoDB é‡‡ç”¨çš„æ˜¯ B+ ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ŒåŸå› æœ‰ï¼š"></a>MySQL é»˜è®¤çš„å­˜å‚¨å¼•æ“ InnoDB é‡‡ç”¨çš„æ˜¯ B+ ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼ŒåŸå› æœ‰ï¼š</h5><ul><li>B+ æ ‘çš„éå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾å®é™…çš„è®°å½•æ•°æ®ï¼Œä»…å­˜æ”¾ç´¢å¼•ï¼Œå› æ­¤æ•°æ®é‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œç›¸æ¯”å­˜å‚¨å³å­˜ç´¢å¼•åˆå­˜è®°å½•çš„ B æ ‘ï¼ŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹å¯ä»¥å­˜æ”¾æ›´å¤šçš„ç´¢å¼•ï¼Œå› æ­¤ B+ æ ‘å¯ä»¥æ¯” B æ ‘æ›´ã€ŒçŸ®èƒ–ã€ï¼ŒæŸ¥è¯¢åº•å±‚èŠ‚ç‚¹çš„ç£ç›˜ I&#x2F;Oæ¬¡æ•°ä¼šæ›´å°‘ã€‚</li><li>B+ æ ‘æœ‰å¤§é‡çš„å†—ä½™èŠ‚ç‚¹ï¼ˆæ‰€æœ‰éå¶å­èŠ‚ç‚¹éƒ½æ˜¯å†—ä½™ç´¢å¼•ï¼‰ï¼Œè¿™äº›å†—ä½™ç´¢å¼•è®© B+ æ ‘åœ¨æ’å…¥ã€åˆ é™¤çš„æ•ˆç‡éƒ½æ›´é«˜ï¼Œæ¯”å¦‚åˆ é™¤æ ¹èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¸ä¼šåƒ B æ ‘é‚£æ ·ä¼šå‘ç”Ÿå¤æ‚çš„æ ‘çš„å˜åŒ–ï¼›</li><li>B+ æ ‘å¶å­èŠ‚ç‚¹ä¹‹é—´ç”¨é“¾è¡¨è¿æ¥äº†èµ·æ¥ï¼Œæœ‰åˆ©äºèŒƒå›´æŸ¥è¯¢ï¼Œè€Œ B æ ‘è¦å®ç°èŒƒå›´æŸ¥è¯¢ï¼Œå› æ­¤åªèƒ½é€šè¿‡æ ‘çš„éå†æ¥å®ŒæˆèŒƒå›´æŸ¥è¯¢ï¼Œè¿™ä¼šæ¶‰åŠå¤šä¸ªèŠ‚ç‚¹çš„ç£ç›˜ I&#x2F;O æ“ä½œï¼ŒèŒƒå›´æŸ¥è¯¢æ•ˆç‡ä¸å¦‚ B+ æ ‘ã€‚</li></ul><h5 id="Innodb-é‡Œçš„-B-æ ‘ï¼š"><a href="#Innodb-é‡Œçš„-B-æ ‘ï¼š" class="headerlink" title="Innodb é‡Œçš„ B+ æ ‘ï¼š"></a>Innodb é‡Œçš„ B+ æ ‘ï¼š</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731111828591.png" alt="image-20230731111828591"></p><p>ä½†æ˜¯ Innodb ä½¿ç”¨çš„ B+ æ ‘æœ‰ä¸€äº›ç‰¹åˆ«çš„ç‚¹ï¼Œæ¯”å¦‚ï¼š</p><ul><li>B+ æ ‘çš„å¶å­èŠ‚ç‚¹ä¹‹é—´æ˜¯ç”¨ã€ŒåŒå‘é“¾è¡¨ã€è¿›è¡Œè¿æ¥ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯æ—¢èƒ½å‘å³éå†ï¼Œä¹Ÿèƒ½å‘å·¦éå†ã€‚</li><li>B+ æ ‘ç‚¹èŠ‚ç‚¹å†…å®¹æ˜¯æ•°æ®é¡µï¼Œæ•°æ®é¡µé‡Œå­˜æ”¾äº†ç”¨æˆ·çš„è®°å½•ä»¥åŠå„ç§ä¿¡æ¯ï¼Œæ¯ä¸ªæ•°æ®é¡µé»˜è®¤å¤§å°æ˜¯ 16 KBã€‚</li></ul><p>Innodb æ ¹æ®ç´¢å¼•ç±»å‹ä¸åŒï¼Œåˆ†ä¸ºèšç°‡å’ŒäºŒçº§ç´¢å¼•ã€‚ä»–ä»¬åŒºåˆ«åœ¨äºï¼Œèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯å®é™…æ•°æ®ï¼Œæ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½å­˜æ”¾åœ¨èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ï¼Œè€ŒäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œè€Œä¸æ˜¯å®é™…æ•°æ®ã€‚</p><p>å› ä¸ºè¡¨çš„æ•°æ®éƒ½æ˜¯å­˜æ”¾åœ¨èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹é‡Œï¼Œæ‰€ä»¥ InnoDB å­˜å‚¨å¼•æ“ä¸€å®šä¼šä¸ºè¡¨åˆ›å»ºä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œä¸”ç”±äºæ•°æ®åœ¨ç‰©ç†ä¸Šåªä¼šä¿å­˜ä¸€ä»½ï¼Œæ‰€ä»¥èšç°‡ç´¢å¼•åªèƒ½æœ‰ä¸€ä¸ªï¼Œè€ŒäºŒçº§ç´¢å¼•å¯ä»¥åˆ›å»ºå¤šä¸ªã€‚</p><h3 id="ç´¢å¼•å­˜å‚¨"><a href="#ç´¢å¼•å­˜å‚¨" class="headerlink" title="ç´¢å¼•å­˜å‚¨"></a>ç´¢å¼•å­˜å‚¨</h3><h4 id="å †è¡¨ï¼š-æ€§èƒ½å·®"><a href="#å †è¡¨ï¼š-æ€§èƒ½å·®" class="headerlink" title="å †è¡¨ï¼š(æ€§èƒ½å·®)"></a>å †è¡¨ï¼š(æ€§èƒ½å·®)</h4><p>å †è¡¨çš„ç»„ç»‡ç»“æ„ä¸­ï¼Œæ•°æ®å’Œç´¢å¼•åˆ†å¼€å­˜å‚¨ã€‚ç´¢å¼•æ˜¯æ’åºåçš„æ•°æ®ï¼Œè€Œå †è¡¨ä¸­çš„æ•°æ®æ˜¯æ— åºçš„ï¼Œç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾äº†æ•°æ®åœ¨å †è¡¨ä¸­çš„åœ°å€ï¼Œå½“å †è¡¨çš„æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œä¸”ä½ç½®å‘ç”Ÿäº†å˜æ›´ï¼Œæ‰€æœ‰ç´¢å¼•ä¸­çš„åœ°å€éƒ½è¦æ›´æ–°ï¼Œè¿™éå¸¸å½±å“æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å¯¹äº OLTP ä¸šåŠ¡ã€‚</p><h4 id="ç´¢å¼•ç»„ç»‡è¡¨ï¼š"><a href="#ç´¢å¼•ç»„ç»‡è¡¨ï¼š" class="headerlink" title="ç´¢å¼•ç»„ç»‡è¡¨ï¼š"></a>ç´¢å¼•ç»„ç»‡è¡¨ï¼š</h4><p><strong>MySQL InnoDB å­˜å‚¨å¼•æ“æ˜¯ç´¢å¼•ç»„ç»‡è¡¨</strong></p><p>â€‹<strong>æ•°æ®æ ¹æ®ä¸»é”®æ’åºå­˜æ”¾åœ¨ç´¢å¼•ä¸­</strong>ï¼Œ<u>ä¸»é”®ç´¢å¼•ä¹Ÿå«èšç°‡ç´¢å¼•ï¼ˆClustered Indexï¼‰</u>ã€‚åœ¨ç´¢å¼•ç»„ç»‡è¡¨ä¸­ï¼Œæ•°æ®å³ç´¢å¼•ï¼Œç´¢å¼•å³æ•°æ®ã€‚</p><h4 id="äºŒçº§ç´¢å¼•ï¼š"><a href="#äºŒçº§ç´¢å¼•ï¼š" class="headerlink" title="äºŒçº§ç´¢å¼•ï¼š"></a>äºŒçº§ç´¢å¼•ï¼š</h4><p>â€‹InnoDB å­˜å‚¨å¼•æ“çš„æ•°æ®æ˜¯æ ¹æ®ä¸»é”®ç´¢å¼•æ’åºå­˜å‚¨çš„ï¼Œé™¤äº†ä¸»é”®ç´¢å¼•å¤–ï¼Œ<strong>å…¶ä»–çš„ç´¢å¼•éƒ½ç§°ä¹‹ä¸ºäºŒçº§ç´¢å¼•ï¼ˆSecondeary Indexï¼‰ï¼Œ</strong> æˆ–éèšç°‡ç´¢å¼•ï¼ˆNone Clustered Indexï¼‰ã€‚</p><p>äºŒçº§ç´¢å¼•ä¹Ÿæ˜¯ä¸€é¢— B+ æ ‘ç´¢å¼•ï¼Œä½†å®ƒå’Œä¸»é”®ç´¢å¼•ä¸åŒçš„æ˜¯<u>å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ç´¢å¼•é”®å€¼ã€ä¸»é”®<strong>å€¼</strong></u>ã€‚</p><p>ç´¢å¼•ç»„ç»‡è¡¨è¿™æ ·çš„äºŒçº§ç´¢å¼•è®¾è®¡æœ‰ä¸€ä¸ªéå¸¸å¤§çš„å¥½å¤„ï¼š<u>è‹¥è®°å½•å‘ç”Ÿäº†ä¿®æ”¹ï¼Œåˆ™å…¶ä»–ç´¢å¼•æ— é¡»è¿›è¡Œç»´æŠ¤ï¼Œé™¤éè®°å½•çš„ä¸»é”®å‘ç”Ÿäº†ä¿®æ”¹ã€‚</u></p><p>ä¸å †è¡¨çš„ç´¢å¼•å®ç°å¯¹æ¯”ç€çœ‹ï¼Œä½ ä¼šå‘ç°ç´¢å¼•ç»„ç»‡è¡¨åœ¨å­˜åœ¨å¤§é‡å˜æ›´çš„åœºæ™¯ä¸‹ï¼Œæ€§èƒ½ä¼˜åŠ¿ä¼šéå¸¸æ˜æ˜¾ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½ä¸éœ€è¦ç»´æŠ¤å…¶ä»–äºŒçº§ç´¢å¼•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ ¹æ® name è¿›è¡ŒæŸ¥è¯¢çš„ SQL å¯ä»¥ç†è§£ä¸ºæ‹†åˆ†æˆäº†ä¸¤ä¸ªæ­¥éª¤ï¼š(idä¸ºä¸»é”®ï¼Œnameä¸ºæ™®é€šç´¢å¼•)</span></span><br><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">FROM</span> idx_name <span class="keyword">WHERE</span> name <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">User</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> _id; <span class="comment">-- å›è¡¨</span></span><br></pre></td></tr></table></figure><p>åœ¨å®é™…æ ¸å¿ƒä¸šåŠ¡ä¸­ï¼Œå¼€å‘åŒå­¦è¿˜æœ‰å¾ˆå¤§å¯èƒ½ä¼š<u>è®¾è®¡å¸¦æœ‰ä¸šåŠ¡å±æ€§çš„ä¸»é”®</u>ï¼Œä½†è¯·ç‰¢è®°ä»¥ä¸‹ä¸¤ç‚¹è®¾è®¡åŸåˆ™ï¼š</p><ul><li>è¦æ¯”è¾ƒé¡ºåºï¼Œå¯¹èšç°‡ç´¢å¼•æ€§èƒ½å‹å¥½ï¼›</li><li>å°½å¯èƒ½ç´§å‡‘ï¼Œå¯¹äºŒçº§ç´¢å¼•çš„æ€§èƒ½å’Œå­˜å‚¨å‹å¥½ï¼›</li></ul><h4 id="ç´¢å¼•ç»„ç»‡è¡¨å’Œå †è¡¨ä¹‹é—´çš„åŒºåˆ«æ€»ç»“ï¼š"><a href="#ç´¢å¼•ç»„ç»‡è¡¨å’Œå †è¡¨ä¹‹é—´çš„åŒºåˆ«æ€»ç»“ï¼š" class="headerlink" title="ç´¢å¼•ç»„ç»‡è¡¨å’Œå †è¡¨ä¹‹é—´çš„åŒºåˆ«æ€»ç»“ï¼š"></a><u>ç´¢å¼•ç»„ç»‡è¡¨å’Œå †è¡¨</u>ä¹‹é—´çš„åŒºåˆ«æ€»ç»“ï¼š</h4><ul><li>ç´¢å¼•ç»„ç»‡è¡¨ä¸»é”®æ˜¯èšç°‡ç´¢å¼•ï¼Œç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾è¡¨ä¸­ä¸€æ•´è¡Œå®Œæ•´è®°å½•ï¼›</li><li>é™¤ä¸»é”®ç´¢å¼•å¤–çš„ç´¢å¼•éƒ½æ˜¯äºŒçº§ç´¢å¼•ï¼Œç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ï¼ˆç´¢å¼•é”®å€¼ï¼Œä¸»é”®å€¼ï¼‰ï¼›</li><li>ç”±äºäºŒçº§ç´¢å¼•ä¸å­˜æ”¾å®Œæ•´è®°å½•ï¼Œå› æ­¤éœ€è¦é€šè¿‡ä¸»é”®å€¼å†è¿›è¡Œä¸€æ¬¡å›è¡¨æ‰èƒ½å®šä½åˆ°å®Œæ•´æ•°æ®ï¼›</li><li>ç´¢å¼•ç»„ç»‡è¡¨å¯¹æ¯”å †è¡¨ï¼Œåœ¨æµ·é‡å¹¶å‘çš„OLTPä¸šåŠ¡ä¸­èƒ½æœ‰æ›´å¥½çš„æ€§èƒ½è¡¨ç°ï¼›</li><li>æ¯ç§ä¸åŒæ•°æ®ï¼Œå¯¹äºŒçº§ç´¢å¼•çš„æ€§èƒ½å¼€é”€å½±å“æ˜¯ä¸ä¸€æ ·çš„ï¼›(æœ‰åºçš„äºŒçº§ç´¢å¼•æ€§èƒ½æ›´å¥½)</li><li>æœ‰æ—¶é€šè¿‡å‡½æ•°ç´¢å¼•å¯ä»¥å¿«é€Ÿè§£å†³çº¿ä¸ŠSQLçš„æ€§èƒ½é—®é¢˜ï¼›</li><li>è™šæ‹Ÿåˆ—ä¸å ç”¨å®é™…å­˜å‚¨ç©ºé—´ï¼Œåœ¨è™šæ‹Ÿåˆ—ä¸Šåˆ›å»ºç´¢å¼•æœ¬è´¨å°±æ˜¯å‡½æ•°ç´¢å¼•ã€‚</li></ul><h3 id="è”åˆç´¢å¼•"><a href="#è”åˆç´¢å¼•" class="headerlink" title="è”åˆç´¢å¼•"></a>è”åˆç´¢å¼•</h3><h4 id="èƒŒæ™¯ï¼š"><a href="#èƒŒæ™¯ï¼š" class="headerlink" title="èƒŒæ™¯ï¼š"></a>èƒŒæ™¯ï¼š</h4><p>â€‹åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å¾ˆå¤šå¤æ‚çš„åœºæ™¯ï¼Œæ¯”å¦‚å¯¹å¤šä¸ªåˆ—è¿›è¡ŒæŸ¥è¯¢ã€‚è¿™æ—¶ï¼Œå¯èƒ½ä¼šè¦æ±‚ç”¨æˆ·åˆ›å»ºå¤šä¸ªåˆ—ç»„æˆçš„ç´¢å¼•ï¼Œå¦‚åˆ— a å’Œ b åˆ›å»ºçš„ç»„åˆç´¢å¼•ï¼Œä½†ç©¶ç«Ÿæ˜¯åˆ›å»ºï¼ˆaï¼Œbï¼‰çš„ç´¢å¼•ï¼Œè¿˜æ˜¯ï¼ˆbï¼Œaï¼‰çš„ç´¢å¼•ï¼Œç»“æœå´æ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p><p>ç»„åˆç´¢å¼•ï¼ˆCompound Indexï¼‰æ˜¯æŒ‡<u>ç”±å¤šä¸ªåˆ—æ‰€ç»„åˆè€Œæˆçš„ B+æ ‘ç´¢å¼•</u>ï¼Œè¿™å’Œæˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„B+ æ ‘ç´¢å¼•çš„åŸç†å®Œå…¨ä¸€æ ·ï¼Œåªæ˜¯<u><strong>ä¹‹å‰æ˜¯å¯¹ä¸€ä¸ªåˆ—æ’åºï¼Œç°åœ¨æ˜¯å¯¹å¤šä¸ªåˆ—æ’åº</strong></u>ã€‚</p><p>ç»„åˆç´¢å¼•æ—¢å¯ä»¥æ˜¯ä¸»é”®ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒçº§ç´¢å¼•ï¼Œä¸‹å›¾æ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ªäºŒçº§ç»„åˆç´¢å¼•ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230803090636470.png" alt="image-20230803090636470"></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œç»„åˆç´¢å¼•åªæ˜¯æ’åºçš„é”®å€¼ä» 1 ä¸ªå˜æˆäº†å¤šä¸ªï¼Œæœ¬è´¨è¿˜æ˜¯ä¸€é¢— B+ æ ‘ç´¢å¼•ã€‚ä½†æ˜¯ä½ <u>ä¸€å®šè¦æ„è¯†åˆ°ï¼ˆaï¼Œbï¼‰å’Œï¼ˆbï¼Œaï¼‰è¿™æ ·çš„ç»„åˆç´¢å¼•ï¼Œå…¶æ’åºç»“æœæ˜¯å®Œå…¨ä¸ä¸€æ ·çš„</u>ã€‚è€Œç´¢å¼•çš„å­—æ®µå˜å¤šäº†ï¼Œè®¾è®¡ä¸Šæ›´å®¹æ˜“å‡ºé—®é¢˜ï¼Œå¦‚ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230803090754475.png" alt="image-20230803090754475"></p><h4 id="ç¤ºä¾‹ğŸŒ°ï¼š"><a href="#ç¤ºä¾‹ğŸŒ°ï¼š" class="headerlink" title="ç¤ºä¾‹ğŸŒ°ï¼š"></a>ç¤ºä¾‹ğŸŒ°ï¼š</h4><p><strong>å¯¹ç»„åˆç´¢å¼•ï¼ˆaï¼Œbï¼‰æ¥è¯´ï¼Œå› ä¸ºå…¶å¯¹åˆ— aã€b åšäº†æ’åºï¼Œæ‰€ä»¥å®ƒå¯ä»¥å¯¹ä¸‹é¢ä¸¤ä¸ªæŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> ?</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> ï¼Ÿ <span class="keyword">AND</span> b <span class="operator">=</span> ï¼Ÿ</span><br></pre></td></tr></table></figure><p>ä¸Šè¿° SQL æŸ¥è¯¢ä¸­ï¼ŒWHERE åæŸ¥è¯¢åˆ— a å’Œ b çš„é¡ºåºæ— å…³ï¼Œå³ä½¿å…ˆå†™ b &#x3D; ? AND a &#x3D; ï¼Ÿä¾ç„¶å¯ä»¥ä½¿ç”¨ç»„åˆç´¢å¼•ï¼ˆaï¼Œbï¼‰ã€‚</p><p>ä½†æ˜¯ä¸‹é¢çš„ SQL æ— æ³•ä½¿ç”¨ç»„åˆç´¢å¼•ï¼ˆaï¼Œbï¼‰ï¼Œå› ä¸ºï¼ˆaï¼Œbï¼‰æ’åºå¹¶ä¸èƒ½æ¨å‡ºï¼ˆbï¼Œaï¼‰æ’åºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> b <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼ŒåŒæ ·ç”±äºç´¢å¼•ï¼ˆaï¼Œbï¼‰å·²æ’åºï¼Œå› æ­¤ä¸‹é¢è¿™æ¡ SQL ä¾ç„¶å¯ä»¥ä½¿ç”¨ç»„åˆç´¢å¼•ï¼ˆaï¼Œbï¼‰ï¼Œä»¥æ­¤æå‡æŸ¥è¯¢çš„æ•ˆç‡ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> ï¼Ÿ <span class="keyword">ORDER</span> <span class="keyword">BY</span> b <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure><p>åŒæ ·çš„åŸå› ï¼Œç´¢å¼•ï¼ˆaï¼Œbï¼‰æ’åºä¸èƒ½å¾—å‡ºï¼ˆbï¼Œaï¼‰æ’åºï¼Œå› æ­¤ä¸‹é¢çš„ SQL æ— æ³•ä½¿ç”¨ç»„åˆç´¢å¼•ï¼ˆaï¼Œbï¼‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> b <span class="operator">=</span> ï¼Ÿ <span class="keyword">ORDER</span> <span class="keyword">BY</span> a <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure><h4 id="é¿å…å›è¡¨å¯ä»¥æå¤§æå‡æ€§èƒ½ï¼šï¼ï¼ï¼"><a href="#é¿å…å›è¡¨å¯ä»¥æå¤§æå‡æ€§èƒ½ï¼šï¼ï¼ï¼" class="headerlink" title="é¿å…å›è¡¨å¯ä»¥æå¤§æå‡æ€§èƒ½ï¼šï¼ï¼ï¼"></a>é¿å…å›è¡¨å¯ä»¥æå¤§æå‡æ€§èƒ½ï¼šï¼ï¼ï¼</h4><p>ç”±äºäºŒçº§ç»„åˆç´¢å¼•çš„å¶å­èŠ‚ç‚¹ï¼ŒåŒ…å«ç´¢å¼•é”®å€¼å’Œä¸»é”®å€¼ï¼Œè‹¥æŸ¥è¯¢çš„å­—æ®µåœ¨äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­ï¼Œåˆ™å¯ç›´æ¥è¿”å›ç»“æœï¼Œæ— éœ€å›è¡¨ã€‚è¿™ç§<strong>é€šè¿‡ç»„åˆç´¢å¼•é¿å…å›è¡¨çš„ä¼˜åŒ–æŠ€æœ¯ä¹Ÿç§°ä¸ºç´¢å¼•è¦†ç›–ï¼ˆCovering Indexï¼‰</strong>ã€‚</p><h4 id="æ€»ç»“ï¼š-4"><a href="#æ€»ç»“ï¼š-4" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h4><p>ç»„åˆç´¢å¼•ä¹Ÿæ˜¯ä¸€é¢— B+ æ ‘ï¼Œåªæ˜¯ç´¢å¼•çš„åˆ—ç”±å¤šä¸ªç»„æˆï¼Œç»„åˆç´¢å¼•æ—¢å¯ä»¥æ˜¯ä¸»é”®ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒçº§ç´¢å¼•ã€‚é€šè¿‡ä»Šå¤©çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯ä»¥å½’çº³ç»„åˆç´¢å¼•çš„ä¸‰å¤§ä¼˜åŠ¿ï¼š</p><ol><li>è¦†ç›–å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œå¦‚ï¼ˆaï¼Œbï¼‰ç´¢å¼•å¯ä»¥è¦†ç›–æŸ¥è¯¢ a &#x3D; ? æˆ–è€… a &#x3D; ? and b &#x3D; ?ï¼›</li><li>é¿å… SQL çš„é¢å¤–æ’åºï¼Œæå‡ SQL æ€§èƒ½ï¼Œå¦‚ WHERE a &#x3D; ? ORDER BY b è¿™æ ·çš„æŸ¥è¯¢æ¡ä»¶ï¼›</li><li>åˆ©ç”¨ç»„åˆç´¢å¼•åŒ…å«å¤šä¸ªåˆ—çš„ç‰¹æ€§ï¼Œå¯ä»¥å®ç°<u><strong>ç´¢å¼•è¦†ç›–æŠ€æœ¯</strong></u>ï¼Œæå‡ SQL çš„æŸ¥è¯¢æ€§èƒ½ï¼Œç”¨å¥½ç´¢å¼•è¦†ç›–æŠ€æœ¯ï¼Œæ€§èƒ½æå‡ 10 å€ä¸æ˜¯éš¾äº‹ã€‚</li></ol><h3 id="ç´¢å¼•å¤±æ•ˆ"><a href="#ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="ç´¢å¼•å¤±æ•ˆ"></a>ç´¢å¼•å¤±æ•ˆ</h3><p>â€‹åœ¨æˆ‘ä»¬ä½¿ç”¨ã€ŒäºŒçº§ç´¢å¼•ã€å­—æ®µä½œä¸ºæ¡ä»¶æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœè¦æŸ¥è¯¢çš„æ•°æ®åœ¨ã€ŒäºŒçº§ç´¢å¼•ã€çš„å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨ã€ŒäºŒçº§ç´¢å¼•ã€çš„ B+ æ ‘æ‰¾åˆ°å¯¹åº”çš„å¶å­èŠ‚ç‚¹ï¼Œç„¶åè¯»å–è¦æŸ¥è¯¢çš„æ•°æ®å³å¯ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš<strong>è¦†ç›–ç´¢å¼•</strong>ã€‚</p><p>ä½†æ˜¯<u><strong>å¹¶ä¸æ„å‘³ç€ï¼ŒæŸ¥è¯¢æ¡ä»¶ç”¨ä¸Šäº†ç´¢å¼•åˆ—ï¼Œå°±æŸ¥è¯¢è¿‡ç¨‹å°±ä¸€å®šéƒ½ç”¨ä¸Šç´¢å¼•</strong></u>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†ä¸€èµ·çœ‹çœ‹å“ªäº›æƒ…å†µä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œè€Œå‘ç”Ÿå…¨è¡¨æ‰«æã€‚</p><h4 id="1-å¯¹ç´¢å¼•ä½¿ç”¨å·¦æˆ–è€…å·¦å³æ¨¡ç³ŠåŒ¹é…"><a href="#1-å¯¹ç´¢å¼•ä½¿ç”¨å·¦æˆ–è€…å·¦å³æ¨¡ç³ŠåŒ¹é…" class="headerlink" title="1.å¯¹ç´¢å¼•ä½¿ç”¨å·¦æˆ–è€…å·¦å³æ¨¡ç³ŠåŒ¹é…"></a>1.å¯¹ç´¢å¼•ä½¿ç”¨<u>å·¦</u>æˆ–è€…<u>å·¦å³</u>æ¨¡ç³ŠåŒ¹é…</h4><h5 id="åˆ†æï¼š"><a href="#åˆ†æï¼š" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h5><p>â€‹ğŸŒŸå› ä¸ºInnodbå¯¹ä½ å®šä¹‰ç´¢å¼•çš„å­—æ®µå€¼è¿›è¡Œæ’åºï¼Œå¦‚æœä½ å¯¹å­—æ®µå€¼çš„å·¦è¾¹è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ï¼Œå½“ç„¶å°±æ— æ³•å¯¹ç›®æ ‡å­—æ®µçš„èŒƒå›´è¿›è¡Œä¸€å®šç¨‹åº¦çš„åˆ’åˆ†â€”â€”â€”æ„æ€å°±æ˜¯æ‰¾è°éƒ½ä¸çŸ¥é“ï¼Œå³ä¾¿ä½ æœ‰åºæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><p>â€‹å› æ­¤å³æ¨¡ç³ŠåŒ¹é…è¿˜æ˜¯ä¼šèµ°ç´¢å¼•çš„ï¼</p><h4 id="2-å¯¹ç´¢å¼•ä½¿ç”¨å‡½æ•°"><a href="#2-å¯¹ç´¢å¼•ä½¿ç”¨å‡½æ•°" class="headerlink" title="2.å¯¹ç´¢å¼•ä½¿ç”¨å‡½æ•°"></a>2.å¯¹ç´¢å¼•ä½¿ç”¨å‡½æ•°</h4><p>â€‹æœ‰æ—¶å€™æˆ‘ä»¬ä¼šç”¨ä¸€äº› MySQL è‡ªå¸¦çš„å‡½æ•°æ¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œè¿™æ—¶å€™è¦æ³¨æ„äº†ï¼Œ<u>å¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­å¯¹ç´¢å¼•å­—æ®µä½¿ç”¨å‡½æ•°ï¼Œå°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</u></p><p>æ¯”å¦‚ä¸‹é¢è¿™æ¡è¯­å¥æŸ¥è¯¢æ¡ä»¶ä¸­å¯¹ name å­—æ®µä½¿ç”¨äº† LENGTH å‡½æ•°ï¼Œæ‰§è¡Œè®¡åˆ’ä¸­çš„ type&#x3D;ALLï¼Œä»£è¡¨äº†å…¨è¡¨æ‰«æï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230803094403523.png" alt="image-20230803094403523"></p><h5 id="åˆ†æï¼š-1"><a href="#åˆ†æï¼š-1" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h5><p>â€‹å› ä¸ºå­˜å‚¨å¼•æ“åªå¯¹nameè¿›è¡Œæ’åºï¼Œå¹¶æ²¡æœ‰å¯¹length(name)æˆ–è€…æ˜¯ä»»ä½• å‡½æ•°å(name)è¿›è¡Œæ’åºï¼Œæ‰€ä»¥ç´¢å¼•è‡ªç„¶å¾—å¤±æ•ˆäº†ï¼</p><p>ä¸è¿‡ï¼Œä» MySQL 8.0 å¼€å§‹ï¼Œç´¢å¼•ç‰¹æ€§å¢åŠ äº†å‡½æ•°ç´¢å¼•ï¼Œå³<u><strong>å¯ä»¥é’ˆå¯¹å‡½æ•°è®¡ç®—åçš„å€¼å»ºç«‹ä¸€ä¸ªç´¢å¼•</strong></u>ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥ç´¢å¼•çš„å€¼æ˜¯å‡½æ•°è®¡ç®—åçš„å€¼ï¼Œæ‰€ä»¥å°±å¯ä»¥é€šè¿‡æ‰«æç´¢å¼•æ¥æŸ¥è¯¢æ•°æ®ã€‚</p><h4 id="3-å¯¹ç´¢å¼•è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—"><a href="#3-å¯¹ç´¢å¼•è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—" class="headerlink" title="3.å¯¹ç´¢å¼•è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—"></a>3.å¯¹ç´¢å¼•è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—</h4><p>â€‹åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­<u>å¯¹ç´¢å¼•è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—</u>ï¼Œä¹Ÿæ˜¯æ— æ³•èµ°ç´¢å¼•çš„ã€‚</p><p>â€‹æ¯”å¦‚ï¼Œä¸‹é¢è¿™æ¡æŸ¥è¯¢è¯­å¥ï¼Œæ‰§è¡Œè®¡åˆ’ä¸­ type &#x3D; ALLï¼Œè¯´æ˜æ˜¯é€šè¿‡å…¨è¡¨æ‰«æçš„æ–¹å¼æŸ¥è¯¢æ•°æ®çš„ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230803094828483.png" alt="image-20230803094828483"></p><h5 id="åˆ†æï¼š-2"><a href="#åˆ†æï¼š-2" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h5><p>â€‹æ˜¾ç„¶ï¼Œå¯¹idå»ºç«‹ç´¢å¼•ï¼Œå¹¶æ²¡æœ‰å¯¹ (id-1) å»ºç«‹ç´¢å¼• â€”â€”-(è™½ç„¶è¿™é‡Œid - 1 çš„æ’åºç»“æœ &#x3D;&#x3D; id çš„æ’åºç»“æœï¼Œä½†æ˜¯å¦‚æœä¸æ˜¯ç®€å•çš„åŠ å‡è¿ç®—è€Œæ˜¯ æ¯”å¦‚ id^2 ç­‰è®¡ç®—çš„è¯ï¼Œå¯èƒ½ä¼šä¸åŸæœ¬å»ºç«‹ç´¢å¼•çš„æ’åºç»“æœä¸ç›¸åŒï¼Œå› æ­¤å¯¹ç´¢å¼•è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—ï¼Œä¹Ÿæ˜¯æ— æ³•èµ°ç´¢å¼•çš„ï¼)</p><h4 id="4-å¯¹ç´¢å¼•éšå¼ç±»å‹è½¬æ¢"><a href="#4-å¯¹ç´¢å¼•éšå¼ç±»å‹è½¬æ¢" class="headerlink" title="4.å¯¹ç´¢å¼•éšå¼ç±»å‹è½¬æ¢"></a>4.å¯¹ç´¢å¼•éšå¼ç±»å‹è½¬æ¢</h4><p>æ¶‰åŠmysqlæ•´å½¢&lt;&#x3D;&#x3D;&gt;å­—ç¬¦ä¸²çš„è‡ªåŠ¨å˜åŒ–ï¼š</p><p>MySQL åœ¨<strong>é‡åˆ°å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒçš„æ—¶å€™</strong>ï¼Œ<u><strong>âš ï¸ä¼šè‡ªåŠ¨æŠŠå­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—ï¼Œç„¶åå†è¿›è¡Œæ¯”è¾ƒâš ï¸</strong></u>ã€‚</p><h5 id="ä¾‹1ï¼š"><a href="#ä¾‹1ï¼š" class="headerlink" title="ä¾‹1ï¼š"></a>ä¾‹1ï¼š</h5><p>â€‹å¦‚æœ<u>ç´¢å¼•å­—æ®µæ˜¯å­—ç¬¦ä¸²ç±»å‹</u>ï¼Œä½†æ˜¯åœ¨æ¡ä»¶æŸ¥è¯¢ä¸­ï¼Œ<u>è¾“å…¥çš„å‚æ•°æ˜¯æ•´å‹</u>çš„è¯ï¼Œä½ ä¼šåœ¨æ‰§è¡Œè®¡åˆ’çš„ç»“æœå‘ç°è¿™æ¡è¯­å¥ä¼šèµ°å…¨è¡¨æ‰«æã€‚</p><p>â€‹å› ä¸ºï¼šç´¢å¼•å­—æ®µä¼šè¢«è‡ªåŠ¨è½¬æ¢æˆæ•°å­—ç±»å‹ï¼Œç›¸å½“äºèµ°äº†ä¸€ä¸ªå‡½æ•°ï¼Œå› æ­¤ç´¢å¼•å¤±æ•ˆï¼ï¼</p><h5 id="ä¾‹2"><a href="#ä¾‹2" class="headerlink" title="ä¾‹2:"></a>ä¾‹2:</h5><p>â€‹å¦‚æœ<u>ç´¢å¼•å­—æ®µæ˜¯æ•´å‹ç±»å‹</u>ï¼Œ<u>æŸ¥è¯¢æ¡ä»¶ä¸­çš„è¾“å…¥å‚æ•°å³ä½¿å­—ç¬¦ä¸²ï¼Œæ˜¯ä¸ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</u>ï¼Œè¿˜æ˜¯å¯ä»¥èµ°ç´¢å¼•æ‰«æã€‚</p><p>â€‹å› ä¸ºç´¢å¼•å­—æ®µæ˜¯æ•´å½¢ï¼Œè¾“å…¥å‚æ•°ä¼šæ”¹å˜ç±»å‹ï¼Œå˜ä¸ºæ•´å½¢ï¼Œå› æ­¤ç´¢å¼•å¯ä»¥ç”Ÿæ•ˆï¼ï¼</p><h4 id="5-è”åˆç´¢å¼•éæœ€å·¦åŒ¹é…"><a href="#5-è”åˆç´¢å¼•éæœ€å·¦åŒ¹é…" class="headerlink" title="5.è”åˆç´¢å¼•éæœ€å·¦åŒ¹é…"></a>5.è”åˆç´¢å¼•éæœ€å·¦åŒ¹é…</h4><p>é‚£ä¹ˆ<strong>å¤šä¸ªæ™®é€šå­—æ®µç»„åˆåœ¨ä¸€èµ·åˆ›å»ºçš„ç´¢å¼•å°±å«åšè”åˆç´¢å¼•</strong>ï¼Œä¹Ÿå«ç»„åˆç´¢å¼•ã€‚</p><p>åˆ›å»ºè”åˆç´¢å¼•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„åˆ›å»ºæ—¶çš„é¡ºåºé—®é¢˜ï¼Œå› ä¸ºè”åˆç´¢å¼• (a, b, c) å’Œ (c, b, a) åœ¨ä½¿ç”¨çš„æ—¶å€™ä¼šå­˜åœ¨å·®åˆ«ã€‚</p><p>è”åˆç´¢å¼•è¦èƒ½æ­£ç¡®ä½¿ç”¨éœ€è¦éµå¾ª<strong>æœ€å·¦åŒ¹é…åŸåˆ™</strong>ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§æœ€å·¦ä¼˜å…ˆçš„æ–¹å¼è¿›è¡Œç´¢å¼•çš„åŒ¹é…ã€‚</p><p>ğŸŒŸæ¯”å¦‚ï¼Œå¦‚æœåˆ›å»ºäº†ä¸€ä¸ª <code>(a, b, c)</code> è”åˆç´¢å¼•ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶æ˜¯ä»¥ä¸‹è¿™å‡ ç§ï¼Œå°±å¯ä»¥åŒ¹é…ä¸Šè”åˆç´¢å¼•ï¼š</p><ul><li>where a&#x3D;1ï¼›</li><li>where a&#x3D;1 and b&#x3D;2 and c&#x3D;3ï¼›</li><li>where a&#x3D;1 and b&#x3D;2ï¼›</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<u>å› ä¸ºæœ‰æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼Œæ‰€ä»¥ a å­—æ®µåœ¨ where å­å¥çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚(ä½†å¦‚æœæ²¡æœ‰aï¼Œæ˜¯ä¸‡ä¸‡ä¸è¡Œçš„ï¼)</u></p><p>ä½†æ˜¯ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶æ˜¯ä»¥ä¸‹è¿™å‡ ç§ï¼Œå› ä¸ºä¸ç¬¦åˆæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œæ‰€ä»¥å°±æ— æ³•åŒ¹é…ä¸Šè”åˆç´¢å¼•ï¼Œè”åˆç´¢å¼•å°±ä¼šå¤±æ•ˆ:</p><ul><li>where b&#x3D;2ï¼›</li><li>where c&#x3D;3ï¼›</li><li>where b&#x3D;2 and c&#x3D;3ï¼›</li></ul><p>âš ï¸æœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„æŸ¥è¯¢æ¡ä»¶ï¼šwhere a &#x3D; 1 and c &#x3D; 3 ï¼Œç¬¦åˆæœ€å·¦åŒ¹é…å—ï¼Ÿ</p><p>è¿™ç§å…¶å®ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´æ˜¯å±äºç´¢å¼•æˆªæ–­ï¼Œä¸åŒç‰ˆæœ¬å¤„ç†æ–¹å¼ä¹Ÿä¸ä¸€æ ·ã€‚</p><ul><li>MySQL 5.5 çš„è¯ï¼Œ<u>å‰é¢ a ä¼šèµ°ç´¢å¼•ï¼Œåœ¨è”åˆç´¢å¼•æ‰¾åˆ°ä¸»é”®å€¼åï¼Œå¼€å§‹å›è¡¨</u>ï¼Œåˆ°ä¸»é”®ç´¢å¼•è¯»å–æ•°æ®è¡Œï¼ŒServer å±‚ä»å­˜å‚¨å¼•æ“å±‚è·å–åˆ°æ•°æ®è¡Œåï¼Œç„¶ååœ¨ Server å±‚å†æ¯”å¯¹ c å­—æ®µçš„å€¼ã€‚</li><li>ä» MySQL 5.6 ä¹‹åï¼Œæœ‰ä¸€ä¸ª<strong>ç´¢å¼•ä¸‹æ¨åŠŸèƒ½</strong>ï¼Œå¯ä»¥åœ¨å­˜å‚¨å¼•æ“å±‚è¿›è¡Œç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œå¯¹ç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µå…ˆåšåˆ¤æ–­ï¼Œç›´æ¥è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå†è¿”è¿˜ç»™ Server å±‚ï¼Œä»è€Œå‡å°‘å›è¡¨æ¬¡æ•°ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">é‡è¦ç»†èŠ‚ï¼ï¼ï¼ï¼ï¼</span><br><span class="line"></span><br><span class="line">âš ï¸ï¼šèŒƒå›´æŸ¥è¯¢åçš„å­—æ®µæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼ï¼ï¼</span><br><span class="line"></span><br><span class="line">ğŸ¥©ï¼šå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­æœ‰å¤šä¸ªä»¥ and è¿æ¥çš„ è”åˆç´¢å¼•å£°æ˜çš„åˆ—çš„æŸ¥è¯¢æ¡ä»¶ï¼Œé‚£ä¹ˆä¼šæŒ‰æ‰¾è”åˆç´¢å¼•çš„é¡ºåºå¯¹æŸ¥è¯¢æ¡ä»¶è¿›è¡Œå¤„ç†</span><br><span class="line"></span><br><span class="line">ä¾‹ï¼šå¯¹(c,b,a)ç®€å†è”åˆç´¢å¼•ï¼Œé‚£ä¹ˆåœ¨æŸ¥è¯¢æ¡ä»¶ä¸ºï¼šwhere a=1 and b=2 and c=3æ—¶ï¼Œä¼šå…ˆç­›é€‰c=3 å† b=2 æœ€å a=1</span><br><span class="line"></span><br><span class="line">âš ï¸æ³¨æ„ï¼šå¦‚æœæ¡ä»¶ä¸ºï¼šwhere a=1 and b=2 and c&gt;3ï¼Œå…ˆæ ¹æ®cçš„ç´¢å¼•æ‰¾åˆ°c&gt;3çš„è®°å½•ï¼Œä½†æ˜¯å› ä¸ºã€ŒèŒƒå›´æŸ¥è¯¢åçš„å­—æ®µæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼ã€ï¼Œæ‰€ä»¥aã€bæ­¤æ—¶æ— æ³•èµ°ç´¢å¼•ï¼ï¼ï¼ï¼ï¼</span><br></pre></td></tr></table></figure><h5 id="ç´¢å¼•ä¸‹æ¨ï¼š"><a href="#ç´¢å¼•ä¸‹æ¨ï¼š" class="headerlink" title="ç´¢å¼•ä¸‹æ¨ï¼š"></a>ç´¢å¼•ä¸‹æ¨ï¼š</h5><p>ç´¢å¼•ä¸‹æ¨çš„å¤§æ¦‚åŸç†æ˜¯ï¼šæˆªæ–­çš„å­—æ®µä¸ä¼šåœ¨ Server å±‚è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œè€Œæ˜¯ä¼šè¢«ä¸‹æ¨åˆ°ã€Œå­˜å‚¨å¼•æ“å±‚ã€è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼ˆå› ä¸º c å­—æ®µçš„å€¼æ˜¯åœ¨ <code>(a, b, c)</code> è”åˆç´¢å¼•é‡Œçš„ï¼‰ï¼Œç„¶å<u><strong>è¿‡æ»¤å‡ºç¬¦åˆæ¡ä»¶çš„æ•°æ®å</strong>å†è¿”å›ç»™ Server å±‚</u>ã€‚ç”±äºåœ¨å¼•æ“å±‚å°±è¿‡æ»¤æ‰å¤§é‡çš„æ•°æ®ï¼Œæ— éœ€å†å›è¡¨è¯»å–æ•°æ®æ¥è¿›è¡Œåˆ¤æ–­ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°ï¼Œä»è€Œæå‡äº†æ€§èƒ½ã€‚</p><p>â€‹æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºè”åˆç´¢å¼•ï¼ˆa, bï¼‰ï¼Œåœ¨æ‰§è¡Œ <code>select * from table where a &gt; 1 and b = 2</code> è¯­å¥çš„æ—¶å€™ï¼Œåªæœ‰ a å­—æ®µèƒ½ç”¨åˆ°ç´¢å¼•ï¼Œé‚£åœ¨è”åˆç´¢å¼•çš„ B+Tree æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„ä¸»é”®å€¼ï¼ˆID ä¸º 2ï¼‰åï¼Œè¿˜éœ€è¦åˆ¤æ–­å…¶ä»–æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼ˆçœ‹ b æ˜¯å¦ç­‰äº 2ï¼‰ï¼Œé‚£æ˜¯åœ¨è”åˆç´¢å¼•é‡Œåˆ¤æ–­ï¼Ÿè¿˜æ˜¯å›ä¸»é”®ç´¢å¼•å»åˆ¤æ–­å‘¢ï¼Ÿ</p><ul><li>åœ¨ MySQL 5.6 ä¹‹å‰ï¼Œåªèƒ½ä» ID2 ï¼ˆä¸»é”®å€¼ï¼‰å¼€å§‹ä¸€ä¸ªä¸ªå›è¡¨ï¼Œåˆ°ã€Œä¸»é”®ç´¢å¼•ã€ä¸Šæ‰¾å‡ºæ•°æ®è¡Œï¼Œå†å¯¹æ¯” b å­—æ®µå€¼ã€‚</li><li>è€Œ MySQL 5.6 å¼•å…¥çš„<strong>ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–</strong>ï¼ˆindex condition pushdown)ï¼Œ <u><strong>å¯ä»¥åœ¨è”åˆç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œå¯¹è”åˆç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µå…ˆåšåˆ¤æ–­ï¼Œç›´æ¥è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°</strong>ã€‚</u></li></ul><p>å½“ä½ çš„æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’é‡Œï¼Œå‡ºç°äº† Extra ä¸º <code>Using index condition</code>ï¼Œé‚£ä¹ˆè¯´æ˜ä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨çš„ä¼˜åŒ–ã€‚</p><h4 id="6-WHERE-å­å¥ä¸­çš„-OR"><a href="#6-WHERE-å­å¥ä¸­çš„-OR" class="headerlink" title="6.WHERE å­å¥ä¸­çš„ OR"></a>6.WHERE å­å¥ä¸­çš„ OR</h4><p>â€‹åœ¨ WHERE å­å¥ä¸­ï¼Œå¦‚æœåœ¨ OR å‰çš„æ¡ä»¶åˆ—æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œåœ¨ OR åçš„æ¡ä»¶åˆ—ä¸æ˜¯ç´¢å¼•åˆ—ï¼Œé‚£ä¹ˆç´¢å¼•ä¼šå¤±æ•ˆã€‚</p><p>â€‹ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä¸‹é¢çš„æŸ¥è¯¢è¯­å¥ï¼Œid æ˜¯ä¸»é”®ï¼Œage æ˜¯æ™®é€šåˆ—ï¼Œä»æ‰§è¡Œè®¡åˆ’çš„ç»“æœçœ‹ï¼Œæ˜¯èµ°äº†å…¨è¡¨æ‰«æã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">or</span> age <span class="operator">=</span> <span class="number">18</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸º OR çš„å«ä¹‰å°±æ˜¯ä¸¤ä¸ªåªè¦æ»¡è¶³ä¸€ä¸ªå³å¯ï¼Œå› æ­¤åªæœ‰ä¸€ä¸ªæ¡ä»¶åˆ—æ˜¯ç´¢å¼•åˆ—æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œåªè¦æœ‰æ¡ä»¶åˆ—ä¸æ˜¯ç´¢å¼•åˆ—ï¼Œå°±ä¼šè¿›è¡Œå…¨è¡¨æ‰«æã€‚</p><p>è¦è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œå°† age å­—æ®µè®¾ç½®ä¸ºç´¢å¼•å³å¯ã€‚</p><h4 id="ğŸ‘æ€»ç»“ï¼š"><a href="#ğŸ‘æ€»ç»“ï¼š" class="headerlink" title="ğŸ‘æ€»ç»“ï¼š"></a>ğŸ‘æ€»ç»“ï¼š</h4><p>6 ç§ä¼šå‘ç”Ÿç´¢å¼•å¤±æ•ˆçš„æƒ…å†µï¼š</p><ul><li>å½“æˆ‘ä»¬ä½¿ç”¨å·¦æˆ–è€…å·¦å³æ¨¡ç³ŠåŒ¹é…çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯ <code>like %xx</code> æˆ–è€… <code>like %xx%</code>è¿™ä¸¤ç§æ–¹å¼éƒ½ä¼šé€ æˆç´¢å¼•å¤±æ•ˆï¼›</li><li>å½“æˆ‘ä»¬åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­å¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°ï¼Œå°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li><li>å½“æˆ‘ä»¬åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­å¯¹ç´¢å¼•åˆ—è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—ï¼Œä¹Ÿæ˜¯æ— æ³•èµ°ç´¢å¼•çš„ã€‚</li><li>MySQL åœ¨é‡åˆ°å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æŠŠå­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—ï¼Œç„¶åå†è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå­—ç¬¦ä¸²æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œæ¡ä»¶è¯­å¥ä¸­çš„è¾“å…¥å‚æ•°æ˜¯æ•°å­—çš„è¯ï¼Œé‚£ä¹ˆç´¢å¼•åˆ—ä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ï¼Œç”±äºéšå¼ç±»å‹è½¬æ¢æ˜¯é€šè¿‡ CAST å‡½æ•°å®ç°çš„ï¼Œç­‰åŒäºå¯¹ç´¢å¼•åˆ—ä½¿ç”¨äº†å‡½æ•°ï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li><li>è”åˆç´¢å¼•è¦èƒ½æ­£ç¡®ä½¿ç”¨éœ€è¦éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§æœ€å·¦ä¼˜å…ˆçš„æ–¹å¼è¿›è¡Œç´¢å¼•çš„åŒ¹é…ï¼Œå¦åˆ™å°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li><li>åœ¨ WHERE å­å¥ä¸­ï¼Œå¦‚æœåœ¨ OR å‰çš„æ¡ä»¶åˆ—æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œåœ¨ OR åçš„æ¡ä»¶åˆ—ä¸æ˜¯ç´¢å¼•åˆ—ï¼Œé‚£ä¹ˆç´¢å¼•ä¼šå¤±æ•ˆã€‚</li></ul><h3 id="ç´¢å¼•é€‰æ‹©"><a href="#ç´¢å¼•é€‰æ‹©" class="headerlink" title="ç´¢å¼•é€‰æ‹©"></a>ç´¢å¼•é€‰æ‹©</h3><p>MySQL æ•°æ®åº“ä¸­çš„ä¼˜åŒ–å™¨æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Ÿæ ¹æ®ä»€ä¹ˆæ ‡å‡†é€‰æ‹©ç´¢å¼•çš„ï¼Ÿ</p><h4 id="CBOï¼ˆCost-based-Optimizerï¼ŒåŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨ï¼‰"><a href="#CBOï¼ˆCost-based-Optimizerï¼ŒåŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨ï¼‰" class="headerlink" title="CBOï¼ˆCost-based Optimizerï¼ŒåŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨ï¼‰"></a>CBOï¼ˆCost-based Optimizerï¼ŒåŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨ï¼‰</h4><p>MySQLä¸­ï¼Œ<strong>ä¸€æ¡ SQL çš„è®¡ç®—æˆæœ¬è®¡ç®—å¦‚ä¸‹æ‰€ç¤ºï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cost  = Server Cost + Engine Cost</span><br><span class="line"></span><br><span class="line">      = CPU Cost + IO Cost</span><br></pre></td></tr></table></figure><p>CPU Cost è¡¨ç¤ºè®¡ç®—çš„å¼€é”€ï¼Œæ¯”å¦‚<u>ç´¢å¼•é”®å€¼çš„æ¯”è¾ƒã€è®°å½•å€¼çš„æ¯”è¾ƒã€ç»“æœé›†çš„æ’åº</u>â€¦â€¦è¿™äº›æ“ä½œéƒ½åœ¨ Server å±‚å®Œæˆï¼›</p><p>IO Cost è¡¨ç¤ºå¼•æ“å±‚ IO çš„å¼€é”€ï¼ŒMySQL 8.0 å¯ä»¥é€šè¿‡åŒºåˆ†ä¸€å¼ è¡¨çš„æ•°æ®æ˜¯å¦åœ¨å†…å­˜ä¸­ï¼Œåˆ†åˆ«è®¡ç®—<u>è¯»å–å†…å­˜ IO å¼€é”€ä»¥åŠè¯»å–ç£ç›˜ IO çš„å¼€é”€ã€‚</u></p><p>MySQL ä¼˜åŒ–å™¨æ˜¯ CBOï¼Œå³ä¸€ç§åŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨ã€‚å…¶ä¼šåˆ¤å•æ¯ä¸ªç´¢å¼•çš„æ‰§è¡Œæˆæœ¬ï¼Œä»ä¸­é€‰æ‹©å‡ºæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ã€‚æ€»ç»“æ¥è¯´ï¼š</p><ul><li><p>MySQL ä¼˜åŒ–å™¨æ˜¯ CBO çš„ï¼›</p></li><li><p>MySQL ä¼š<u>é€‰æ‹©æˆæœ¬æœ€ä½çš„æ‰§è¡Œè®¡åˆ’</u>ï¼Œä½ å¯ä»¥é€šè¿‡ EXPLAIN å‘½ä»¤æŸ¥çœ‹æ¯ä¸ª SQL çš„æˆæœ¬ï¼›</p></li><li><p>**<u>ä¸€èˆ¬åªå¯¹é«˜é€‰æ‹©åº¦çš„å­—æ®µå’Œå­—æ®µç»„åˆåˆ›å»ºç´¢å¼•</u>**ï¼Œä½é€‰æ‹©åº¦çš„å­—æ®µå¦‚æ€§åˆ«ï¼Œä¸åˆ›å»ºç´¢å¼•ï¼›</p></li><li><p>ä½é€‰æ‹©æ€§ï¼Œä½†æ˜¯**<u>æ•°æ®å­˜åœ¨å€¾æ–œ</u>**ï¼Œé€šè¿‡ç´¢å¼•æ‰¾å‡ºå°‘éƒ¨åˆ†æ•°æ®ï¼Œå¯ä»¥<u>è€ƒè™‘åˆ›å»ºç´¢å¼•</u>ï¼›</p><ul><li><p>åœ¨ç”µå•†ä¸šåŠ¡ä¸­ä¼šæœ‰ä¸€ä¸ªè¿™æ ·çš„é€»è¾‘ï¼šå³ä¼šå®šæœŸæ‰«æå­—æ®µ o_orderstatus ä¸ºæ”¯ä»˜ä¸­çš„è®¢å•ï¼Œç„¶åå¼ºåˆ¶è®©å…¶å…³é—­ï¼Œä»è€Œé‡Šæ”¾åº“å­˜ï¼Œç»™å…¶ä»–æœ‰éœ€æ±‚çš„ä¹°å®¶è¿›è¡Œè´­ä¹°ã€‚</p><p>ä½†å­—æ®µ o_orderstatus çš„çŠ¶æ€æ˜¯æœ‰é™çš„ï¼Œä¸€èˆ¬ä»…ä¸ºå·²å®Œæˆã€æ”¯ä»˜ä¸­ã€è¶…æ—¶å·²å…³é—­è¿™å‡ ç§ã€‚</p><p>é€šå¸¸è®¢å•çŠ¶æ€<u>ç»å¤§éƒ¨åˆ†éƒ½æ˜¯å·²å®Œæˆï¼Œåªæœ‰ç»å°‘éƒ¨åˆ†å› ä¸ºç³»ç»Ÿæ•…éšœåŸå› ï¼Œä¼šåœ¨ 15 åˆ†é’Ÿåè¿˜æ²¡æœ‰å®Œæˆè®¢å•</u>ï¼Œ<strong>å› æ­¤è®¢å•çŠ¶æ€æ˜¯å­˜åœ¨æ•°æ®å€¾æ–œçš„ã€‚</strong></p></li></ul></li><li><p>è‹¥æ•°æ®å­˜åœ¨å€¾æ–œï¼Œå¯ä»¥åˆ›å»ºç›´æ–¹å›¾ï¼Œè®©ä¼˜åŒ–å™¨çŸ¥é“ç´¢å¼•ä¸­æ•°æ®çš„åˆ†å¸ƒï¼Œè¿›ä¸€æ­¥æ ¡å‡†æ‰§è¡Œè®¡åˆ’ã€‚</p></li></ul><h3 id="ğŸŒŸç´¢å¼•åº”ç”¨-æ€»ç»“-ï¼š"><a href="#ğŸŒŸç´¢å¼•åº”ç”¨-æ€»ç»“-ï¼š" class="headerlink" title="ğŸŒŸç´¢å¼•åº”ç”¨(æ€»ç»“)ï¼š"></a>ğŸŒŸç´¢å¼•åº”ç”¨(æ€»ç»“)ï¼š</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ˜ç™½ç´¢å¼•ä¸ºä»€ä¹ˆå¥½ï¼Œç„¶åæˆ‘ä»¬å†äº†è§£å…·ä½“å¥½åœ¨ä»€ä¹ˆæ–¹é¢ï¼</p><ol><li><p>å•è¡Œè®¿é—®æ˜¯å¾ˆæ…¢çš„ã€‚ç‰¹åˆ«æ˜¯åœ¨æœºæ¢°ç¡¬ç›˜å­˜å‚¨ä¸­(SSDçš„éšæœº I&#x2F;O è¦å¿«å¾ˆå¤šï¼Œä¸è¿‡è¿™ä¸€ç‚¹ä»ç„¶æˆç«‹)ã€‚å¦‚æœæœåŠ¡å™¨ä»å­˜å‚¨ä¸­è¯»å–ä¸€ä¸ªæ•°æ®å—åªæ˜¯ä¸ºäº†è·å–å…¶ä¸­ä¸€è¡Œï¼Œé‚£ä¹ˆå°±æµªè´¹äº†å¾ˆå¤šå·¥ä½œã€‚æœ€å¥½è¯»å–çš„å—ä¸­èƒ½åŒ…å«å°½å¯èƒ½å¤šæ‰€éœ€è¦çš„è¡Œã€‚<u><strong>ä½¿ç”¨ç´ å¼•å¯ä»¥åˆ›å»ºä½ç½®å¼•ç”¨ä»¥æå‡æ•ˆç‡ã€‚</strong></u></p></li><li><p>æŒ‰é¡ºåºè®¿é—®èŒƒå›´æ•°æ®æ˜¯å¾ˆå¿«çš„ï¼Œè¿™æœ‰ä¸¤ä¸ªåŸå› ã€‚</p><ul><li>ç¬¬ä¸€ï¼Œé¡ºåºI&#x2F;O ä¸éœ€è¦å¤šæ¬¡ç£ç›˜å¯»é“ï¼Œæ‰€ä»¥æ¯”éšæœº I&#x2F;O è¦å¿«å¾ˆå¤šï¼ˆç‰¹åˆ«æ˜¯å¯¹æœºæ¢°ç¡¬ç›˜ï¼‰ã€‚</li><li>ç¬¬äºŒï¼Œå¦‚æœæœåŠ¡å™¨èƒ½å¤ŸæŒ‰éœ€è¦é¡ºåºè¯»å–æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¸å†éœ€è¦é¢å¤–çš„æ’åºæ“ä½œï¼Œå¹¶ä¸” GROUP BY æŸ¥è¯¢ä¹Ÿæ— é¡»å†åšæ’åºå’Œå°†è¡ŒæŒ‰ç»„è¿›è¡Œèšåˆè®¡ç®—äº†ã€‚</li></ul></li><li><p>ç´¢å¼•è¦†ç›–æŸ¥è¯¢æ˜¯å¾ˆå¿«çš„ã€‚å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«äº†æŸ¥è¯¢éœ€è¦çš„æ‰€æœ‰åˆ—ï¼Œé‚£ä¹ˆå­˜å‚¨å¼•æ“å°±ä¸éœ€è¦å†å›è¡¨æŸ¥æ‰¾è¡Œã€‚è¿™é¿å…äº†å¤§é‡çš„å•è¡Œè®¿é—®ï¼Œè€Œä¸Šé¢çš„ç¬¬1ç‚¹å·²ç»å†™æ˜å•è¡Œè®¿é—®æ˜¯å¾ˆæ…¢çš„ã€‚</p></li></ol><h4 id="ç´¢å¼•çš„ä¼˜ç‚¹ï¼š"><a href="#ç´¢å¼•çš„ä¼˜ç‚¹ï¼š" class="headerlink" title="ç´¢å¼•çš„ä¼˜ç‚¹ï¼š"></a>ç´¢å¼•çš„ä¼˜ç‚¹ï¼š</h4><ul><li>æ•´ä¸ªæ•°æ®åº“ä¸­ï¼Œæ•°æ®è¡¨çš„<u>æŸ¥è¯¢é€Ÿåº¦ç›´çº¿æå‡</u>ï¼Œæ•°æ®é‡è¶Šå¤§æ—¶æ•ˆæœè¶Šæ˜æ˜¾ã€‚</li><li>é€šè¿‡åˆ›å»º<u>å”¯ä¸€ç´¢å¼•ï¼Œå¯ä»¥ç¡®ä¿æ•°æ®è¡¨ä¸­çš„æ•°æ®å”¯ä¸€æ€§</u>ï¼Œæ— éœ€é¢å¤–å»ºç«‹å”¯ä¸€çº¦æŸã€‚</li><li>åœ¨ä½¿ç”¨<u>åˆ†ç»„å’Œæ’åº</u>æ—¶ï¼ŒåŒæ ·å¯ä»¥æ˜¾è‘—å‡å°‘<code>SQL</code>æŸ¥è¯¢çš„åˆ†ç»„å’Œæ’åºçš„æ—¶é—´ã€‚</li><li>è¿è¡¨æŸ¥è¯¢æ—¶ï¼ŒåŸºäºä¸»å¤–é”®å­—æ®µä¸Šå»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥å¸¦æ¥ååˆ†æ˜æ˜¾çš„æ€§èƒ½æå‡ã€‚</li><li>ç´¢å¼•é»˜è®¤æ˜¯<code>B+Tree</code>æœ‰åºç»“æ„ï¼Œ<u>åŸºäºç´¢å¼•å­—æ®µåšèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œæ•ˆç‡ä¼šæ˜æ˜¾æé«˜</u>ã€‚</li><li>ä»<code>MySQL</code>æ•´ä½“æ¶æ„è€Œè¨€ï¼Œå‡å°‘äº†æŸ¥è¯¢<code>SQL</code>çš„æ‰§è¡Œæ—¶é—´ï¼Œæé«˜äº†æ•°æ®åº“æ•´ä½“ååé‡ã€‚</li></ul><h4 id="ç´¢å¼•çš„ç¼ºç‚¹ï¼š"><a href="#ç´¢å¼•çš„ç¼ºç‚¹ï¼š" class="headerlink" title="ç´¢å¼•çš„ç¼ºç‚¹ï¼š"></a>ç´¢å¼•çš„ç¼ºç‚¹ï¼š</h4><ul><li>å»ºç«‹ç´¢å¼•ä¼šç”Ÿæˆæœ¬åœ°ç£ç›˜æ–‡ä»¶ï¼Œ<u>éœ€è¦é¢å¤–çš„ç©ºé—´å­˜å‚¨ç´¢å¼•æ•°æ®</u>ï¼Œç£ç›˜å ç”¨ç‡ä¼šå˜é«˜ã€‚</li><li><u><strong>å†™å…¥æ•°æ®æ—¶ï¼Œéœ€è¦é¢å¤–ç»´æŠ¤ç´¢å¼•ç»“æ„</strong></u>ï¼Œå¢ã€åˆ ã€æ”¹æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦é¢å¤–æ“ä½œç´¢å¼•ã€‚</li><li><u><strong>å†™å…¥æ•°æ®</strong></u>æ—¶ç»´æŠ¤ç´¢å¼•éœ€è¦é¢å¤–çš„æ—¶é—´å¼€é”€ï¼Œæ‰§è¡Œå†™<code>SQL</code>æ—¶æ•ˆç‡ä¼šé™ä½ï¼Œæ€§èƒ½ä¼šä¸‹é™ã€‚</li></ul><h4 id="ğŸŒŸä¸»é”®ç´¢å¼•æœ€å¥½ä½¿ç”¨å¸¦é¡ºåºæ€§çš„å€¼-æ¯”å¦‚ï¼šè‡ªå¢idã€è‡ªå¢uuid-ï¼š"><a href="#ğŸŒŸä¸»é”®ç´¢å¼•æœ€å¥½ä½¿ç”¨å¸¦é¡ºåºæ€§çš„å€¼-æ¯”å¦‚ï¼šè‡ªå¢idã€è‡ªå¢uuid-ï¼š" class="headerlink" title="ğŸŒŸä¸»é”®ç´¢å¼•æœ€å¥½ä½¿ç”¨å¸¦é¡ºåºæ€§çš„å€¼(æ¯”å¦‚ï¼šè‡ªå¢idã€è‡ªå¢uuid)ï¼š"></a>ğŸŒŸä¸»é”®ç´¢å¼•æœ€å¥½ä½¿ç”¨å¸¦é¡ºåºæ€§çš„å€¼(æ¯”å¦‚ï¼šè‡ªå¢idã€è‡ªå¢uuid)ï¼š</h4><p>å› ä¸ºé»˜è®¤å¯¹ä¸»é”®å»ºç«‹ç´¢å¼•ï¼Œä¸»é”®å°†è¢«ç»´æŠ¤åœ¨B+æ ‘ä¸­ï¼Œå¦‚æœä¸»é”®æ˜¯éšæœºçš„æ•°ï¼Œé‚£ä¹ˆB+æ ‘å°†å‡ ä¹åœ¨æ¯æ¬¡æ’å…¥æ•°æ®æ—¶é‡æ„ï¼Œä½†å¦‚æœä¸»é”®æœ‰åºï¼Œæ¯æ¬¡åªéœ€è¦å°†æ•°æ®æ”¾åˆ°æœ€åå³å¯â€”â€”â€”ä¾¿äºç»´æŠ¤B+æ ‘ğŸŒ²</p><h4 id="ğŸŒŸè”åˆä¸»é”®è¦æ³¨æ„éæœ€å·¦åŒ¹é…çš„é—®é¢˜-è¯¦è§ç´¢å¼•å¤±æ•ˆç« èŠ‚"><a href="#ğŸŒŸè”åˆä¸»é”®è¦æ³¨æ„éæœ€å·¦åŒ¹é…çš„é—®é¢˜-è¯¦è§ç´¢å¼•å¤±æ•ˆç« èŠ‚" class="headerlink" title="ğŸŒŸè”åˆä¸»é”®è¦æ³¨æ„éæœ€å·¦åŒ¹é…çš„é—®é¢˜(è¯¦è§ç´¢å¼•å¤±æ•ˆç« èŠ‚)"></a>ğŸŒŸè”åˆä¸»é”®è¦æ³¨æ„éæœ€å·¦åŒ¹é…çš„é—®é¢˜(è¯¦è§ç´¢å¼•å¤±æ•ˆç« èŠ‚)</h4><h4 id="ğŸŒŸå‰ç¼€ç´¢å¼•çš„å¼Šç«¯ï¼š"><a href="#ğŸŒŸå‰ç¼€ç´¢å¼•çš„å¼Šç«¯ï¼š" class="headerlink" title="ğŸŒŸå‰ç¼€ç´¢å¼•çš„å¼Šç«¯ï¼š"></a>ğŸŒŸå‰ç¼€ç´¢å¼•çš„å¼Šç«¯ï¼š</h4><p>â€‹å‰ç¼€ç´¢å¼•çš„ç‰¹ç‚¹æ˜¯çŸ­å°ç²¾æ‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€ä¸ªå­—æ®µçš„å‰<code>N</code>ä¸ªå­—ç¬¦åˆ›å»ºç´¢å¼•ï¼Œä»¥è¿™ç§å½¢å¼åˆ›å»ºçš„ç´¢å¼•ä¹Ÿè¢«ç§°ä¹‹ä¸ºå‰ç¼€ç´¢å¼•ï¼Œç›¸è¾ƒäºä½¿ç”¨ä¸€ä¸ªå®Œæ•´å­—æ®µåˆ›å»ºç´¢å¼•ï¼Œå‰ç¼€ç´¢å¼•èƒ½å¤Ÿæ›´åŠ èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œå½“æ•°æ®è¶Šå¤šæ—¶ï¼Œå¸¦æ¥çš„ä¼˜åŠ¿è¶Šæ˜æ˜¾ã€‚</p><p>â€‹å‰ç¼€ç´¢å¼•<u>è™½ç„¶å¸¦æ¥äº†èŠ‚çœç©ºé—´çš„å¥½å¤„</u>ï¼Œä½†ä¹Ÿæ­£ç”±äºå…¶ç´¢å¼•èŠ‚ç‚¹ä¸­ï¼Œæœªå­˜å‚¨ä¸€ä¸ªå­—æ®µçš„å®Œæ•´å€¼ï¼Œæ‰€ä»¥<code>MySQL</code>ä¹Ÿ<u><strong>æ— æ³•é€šè¿‡å‰ç¼€ç´¢å¼•æ¥å®Œæˆ<code>ORDER BYã€GROUP BY</code>ç­‰åˆ†ç»„æ’åºå·¥ä½œï¼ŒåŒæ—¶ä¹Ÿæ— æ³•å®Œæˆè¦†ç›–æ‰«æç­‰æ“ä½œã€‚</strong></u></p><h4 id="ğŸŒŸå…¨æ–‡ç´¢å¼•ï¼š"><a href="#ğŸŒŸå…¨æ–‡ç´¢å¼•ï¼š" class="headerlink" title="ğŸŒŸå…¨æ–‡ç´¢å¼•ï¼š"></a>ğŸŒŸå…¨æ–‡ç´¢å¼•ï¼š</h4><p>â€‹å¯ä»¥åˆ©ç”¨å…¨æ–‡ç´¢å¼•ä»£æ›¿<code>like%</code>è¯­æ³•å®ç°æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå®ƒçš„æ€§èƒ½ä¼šæ¯”<code>like%</code>å¿«ä¸Š<code>N</code>å€ã€‚</p><h5 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><ul><li>ç”±äºå…¨æ–‡ç´¢å¼•æ˜¯åŸºäºåˆ†è¯å®ç°çš„ï¼Œæ‰€ä»¥å¯¹ä¸€ä¸ªå­—æ®µå»ºç«‹å…¨æ–‡ç´¢å¼•åï¼Œ<code>MySQL</code>ä¼šå¯¹è¯¥å­—æ®µåšåˆ†è¯å¤„ç†ï¼Œè¿™äº›åˆ†è¯ç»“æœä¹Ÿä¼šè¢«å­˜å‚¨åœ¨å…¨æ–‡ç´¢å¼•ä¸­ï¼Œå› æ­¤å…¨æ–‡ç´¢å¼•çš„æ–‡ä»¶ä¼šé¢å¤–çš„å¤§ï¼</li><li>ç”±äºå…¨æ–‡ç´¢å¼•å¯¹æ¯ä¸ªå­—æ®µå€¼éƒ½ä¼šåšåˆ†è¯ï¼Œå› æ­¤å½“ä¿®æ”¹å­—æ®µå€¼åï¼Œåˆ†è¯æ˜¯éœ€è¦æ—¶é—´çš„ï¼Œæ‰€ä»¥ä¿®æ”¹å­—æ®µæ•°æ®åä¸ä¼šç«‹é©¬è‡ªåŠ¨æ›´æ–°å…¨æ–‡ç´¢å¼•ï¼Œæ­¤æ—¶éœ€è¦å’±ä»¬å†™å­˜å‚¨è¿‡ç¨‹ï¼Œå¹¶è°ƒç”¨å®ƒæ‰‹åŠ¨æ›´æ–°å…¨æ–‡ç´¢å¼•ä¸­çš„æ•°æ®ã€‚</li><li>é™¤å¼€ä¸Šè¿°ä¸¤ç‚¹å¤–ï¼Œå…¨æ–‡ç´¢å¼•æœ€å¤§çš„ç¡¬ä¼¤åœ¨äºå¯¹ä¸­æ–‡æ”¯æŒä¸å¤Ÿå‹å¥½ï¼Œç±»ä¼¼äºè‹±æ–‡å¯ä»¥ç›´æ¥é€šè¿‡ç¬¦å·ã€ç©ºæ ¼æ¥åˆ†è¯ï¼Œä½†ä¸­æ–‡å‘¢ï¼Ÿä¸€ä¸ªè¯è¯­æ¥å½¢å®¹å°±æ˜¯åšå¤§ç²¾æ·±ï¼Œæ— æ³•ç²¾å‡†çš„å¯¹ä¸€æ®µæ–‡å­—åšåˆ†è¯ï¼Œå› æ­¤å…¨æ–‡ç´¢å¼•åœ¨æ£€ç´¢ä¸­æ–‡æ—¶ï¼Œå­˜åœ¨äº›è®¸ç²¾å‡†åº¦é—®é¢˜ã€‚</li></ul><h4 id="ğŸŒŸå”¯ä¸€ç´¢å¼•çš„åˆ©å¼Šï¼š"><a href="#ğŸŒŸå”¯ä¸€ç´¢å¼•çš„åˆ©å¼Šï¼š" class="headerlink" title="ğŸŒŸå”¯ä¸€ç´¢å¼•çš„åˆ©å¼Šï¼š"></a>ğŸŒŸå”¯ä¸€ç´¢å¼•çš„åˆ©å¼Šï¼š</h4><p>â€‹æŸ¥è¯¢å¿«ï¼šä¸ç”¨è€ƒè™‘æ˜¯å¦æœ‰å¤šæ¡ç´¢å¼•å€¼ç›¸åŒçš„è®°å½•</p><p>â€‹æ’å…¥æ•°æ®æ…¢ï¼šéœ€è¦è€ƒè™‘æ˜¯å¦æœ‰å¤šæ¡ç´¢å¼•å€¼ç›¸åŒçš„è®°å½•</p><h4 id="ğŸ“å»ºç«‹ç´¢å¼•æ—¶ï¼Œéœ€è¦éµå®ˆçš„ä¸€äº›åŸåˆ™ï¼š"><a href="#ğŸ“å»ºç«‹ç´¢å¼•æ—¶ï¼Œéœ€è¦éµå®ˆçš„ä¸€äº›åŸåˆ™ï¼š" class="headerlink" title="ğŸ“å»ºç«‹ç´¢å¼•æ—¶ï¼Œéœ€è¦éµå®ˆçš„ä¸€äº›åŸåˆ™ï¼š"></a>ğŸ“å»ºç«‹ç´¢å¼•æ—¶ï¼Œéœ€è¦éµå®ˆçš„ä¸€äº›åŸåˆ™ï¼š</h4><ul><li>ç»å¸¸é¢‘ç¹ç”¨ä½œæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µåº”é…Œæƒ…è€ƒè™‘ä¸ºå…¶åˆ›å»ºç´¢å¼•ã€‚</li><li>è¡¨çš„ä¸»å¤–é”®æˆ–è¿è¡¨å­—æ®µï¼Œå¿…é¡»å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºèƒ½å¾ˆå¤§ç¨‹åº¦æå‡è¿è¡¨æŸ¥è¯¢çš„æ€§èƒ½ã€‚</li><li>å»ºç«‹ç´¢å¼•çš„å­—æ®µï¼Œä¸€èˆ¬å€¼çš„åŒºåˆ†æ€§è¦è¶³å¤Ÿé«˜ï¼Œè¿™æ ·æ‰èƒ½æé«˜ç´¢å¼•çš„æ£€ç´¢æ•ˆç‡ã€‚</li><li>å»ºç«‹ç´¢å¼•çš„å­—æ®µï¼Œå€¼ä¸åº”è¯¥è¿‡é•¿ï¼Œå¦‚æœè¾ƒé•¿çš„å­—æ®µè¦å»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥é€‰æ‹©å‰ç¼€ç´¢å¼•ã€‚</li><li>å»ºç«‹è”åˆç´¢å¼•ï¼Œåº”å½“éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ï¼Œå°†å¤šä¸ªå­—æ®µä¹‹é—´æŒ‰ä¼˜å…ˆçº§é¡ºåºç»„åˆã€‚</li><li>ç»å¸¸æ ¹æ®èŒƒå›´å–å€¼ã€æ’åºã€åˆ†ç»„çš„å­—æ®µåº”å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•æœ‰åºï¼Œèƒ½åŠ å¿«æ’åºæ—¶é—´ã€‚</li><li>å¯¹äºå”¯ä¸€ç´¢å¼•ï¼Œå¦‚æœç¡®è®¤ä¸ä¼šåˆ©ç”¨è¯¥å­—æ®µæ’åºï¼Œé‚£å¯ä»¥å°†ç»“æ„æ”¹ä¸º<code>Hash</code>ç»“æ„ã€‚</li><li>å°½é‡ä½¿ç”¨è”åˆç´¢å¼•ä»£æ›¿å•å€¼ç´¢å¼•ï¼Œè”åˆç´¢å¼•æ¯”å¤šä¸ªå•å€¼ç´¢å¼•æŸ¥è¯¢æ•ˆç‡è¦é«˜ã€‚</li></ul><h4 id="ğŸ«å»ºç«‹ç´¢å¼•æ—¶è¿˜éœ€æœ‰äº›æ³¨æ„ç‚¹ï¼š"><a href="#ğŸ«å»ºç«‹ç´¢å¼•æ—¶è¿˜éœ€æœ‰äº›æ³¨æ„ç‚¹ï¼š" class="headerlink" title="ğŸ«å»ºç«‹ç´¢å¼•æ—¶è¿˜éœ€æœ‰äº›æ³¨æ„ç‚¹ï¼š"></a>ğŸ«å»ºç«‹ç´¢å¼•æ—¶è¿˜éœ€æœ‰äº›æ³¨æ„ç‚¹ï¼š</h4><ul><li><u>å€¼ç»å¸¸ä¼šå¢åˆ æ”¹çš„å­—æ®µï¼Œä¸åˆé€‚å»ºç«‹ç´¢å¼•ï¼Œ</u>å› ä¸ºæ¯æ¬¡æ”¹å˜åéœ€ç»´æŠ¤ç´¢å¼•ç»“æ„ã€‚</li><li>ä¸€ä¸ªå­—æ®µå­˜åœ¨<u>å¤§é‡çš„é‡å¤å€¼æ—¶ï¼Œä¸é€‚åˆå»ºç«‹ç´¢å¼•</u>ï¼Œæ¯”å¦‚ä¹‹å‰ä¸¾ä¾‹çš„æ€§åˆ«å­—æ®µã€‚</li><li>ç´¢å¼•ä¸èƒ½å‚ä¸è®¡ç®—ï¼Œå› æ­¤ç»å¸¸å¸¦å‡½æ•°æŸ¥è¯¢çš„å­—æ®µï¼Œå¹¶ä¸é€‚åˆå»ºç«‹ç´¢å¼•ã€‚</li><li>ä¸€å¼ è¡¨ä¸­çš„ç´¢å¼•æ•°é‡å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œä¸€èˆ¬æ§åˆ¶åœ¨<code>3</code>ï¼Œæœ€å¤šä¸èƒ½è¶…è¿‡<code>5</code>ã€‚</li><li><u>å»ºç«‹è”åˆç´¢å¼•æ—¶ï¼Œä¸€å®šè¦è€ƒè™‘ä¼˜å…ˆçº§ï¼ŒæŸ¥è¯¢é¢‘ç‡æœ€é«˜çš„å­—æ®µåº”å½“æ”¾é¦–ä½</u>ã€‚</li><li>å½“è¡¨çš„æ•°æ®è¾ƒå°‘ï¼Œä¸åº”å½“å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºæ•°æ®é‡ä¸å¤§æ—¶ï¼Œç»´æŠ¤ç´¢å¼•åè€Œå¼€é”€æ›´å¤§ã€‚</li><li><u><strong>ç´¢å¼•çš„å­—æ®µå€¼æ— åºæ—¶ï¼Œä¸æ¨èå»ºç«‹ç´¢å¼•</strong></u>ï¼Œå› ä¸ºä¼šé€ æˆé¡µåˆ†è£‚ï¼Œå°¤å…¶æ˜¯ä¸»é”®ç´¢å¼•ã€‚</li></ul><h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><h3 id="äº‹åŠ¡çš„ACIDï¼š"><a href="#äº‹åŠ¡çš„ACIDï¼š" class="headerlink" title="äº‹åŠ¡çš„ACIDï¼š"></a>äº‹åŠ¡çš„ACIDï¼š</h3><h4 id="Aâ€“åŸå­æ€§-Atomicity"><a href="#Aâ€“åŸå­æ€§-Atomicity" class="headerlink" title="Aâ€“åŸå­æ€§(Atomicity):"></a>Aâ€“åŸå­æ€§(Atomicity):</h4><p>â€‹ä¸€äº›æ“ä½œè¦ä¹ˆå…¨åšã€è¦ä¹ˆå…¨ä¸åš</p><h4 id="Câ€“ä¸€è‡´æ€§-Consistency-ï¼š"><a href="#Câ€“ä¸€è‡´æ€§-Consistency-ï¼š" class="headerlink" title="Câ€“ä¸€è‡´æ€§(Consistency)ï¼š"></a>Câ€“ä¸€è‡´æ€§(Consistency)ï¼š</h4><p>â€‹ä¸€è‡´æ€§çš„ä½“ç°ï¼šæ“ä½œæ‰§è¡Œå®Œæˆåä¿è¯æ•°æ®ç¬¦åˆæ‰€æœ‰æ—¢å®šçš„çº¦æŸ</p><p>â€‹ä¾‹å¦‚ï¼šæŸä¸ªçº¦æŸä¸ºï¼šå‚ä¸è½¬è´¦çš„è´¦æˆ·çš„æ€»çš„ä½™é¢æ˜¯ä¸å˜çš„</p><h4 id="Iâ€“éš”ç¦»æ€§-Isolation"><a href="#Iâ€“éš”ç¦»æ€§-Isolation" class="headerlink" title="Iâ€“éš”ç¦»æ€§(Isolation):"></a>Iâ€“éš”ç¦»æ€§(Isolation):</h4><p>â€‹ä¸åŒçš„æ“ä½œä¹‹é—´ä¸åº”ç›¸äº’å½±å“</p><h4 id="Dâ€“æŒä¹…æ€§-Durability"><a href="#Dâ€“æŒä¹…æ€§-Durability" class="headerlink" title="Dâ€“æŒä¹…æ€§(Durability):"></a>Dâ€“æŒä¹…æ€§(Durability):</h4><p>â€‹åœ¨æ“ä½œå®Œæˆåï¼Œå®ç°äº†æ•°æ®çš„çŠ¶æ€è½¬æ¢ï¼Œè¿™ä¸ªè½¬æ¢çš„ç»“æœå°†æ°¸ä¹…åœ°ä¿ç•™ã€‚</p><h3 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼š"><a href="#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼š" class="headerlink" title="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼š"></a>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼š</h3><h4 id="å¹¶è¡Œäº‹åŠ¡ä¼šå¼•å‘ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#å¹¶è¡Œäº‹åŠ¡ä¼šå¼•å‘ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="å¹¶è¡Œäº‹åŠ¡ä¼šå¼•å‘ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>å¹¶è¡Œäº‹åŠ¡ä¼šå¼•å‘ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h4><p>åœ¨åŒæ—¶å¤„ç†å¤šä¸ªäº‹åŠ¡çš„æ—¶å€™ï¼Œå°±å¯èƒ½å‡ºç°<strong>è„è¯»ï¼ˆdirty readï¼‰</strong>ã€<strong>ä¸å¯é‡å¤è¯»ï¼ˆnon-repeatable readï¼‰</strong>ã€<strong>å¹»è¯»ï¼ˆphantom readï¼‰</strong>çš„é—®é¢˜ã€‚</p><h5 id="è„è¯»ï¼š"><a href="#è„è¯»ï¼š" class="headerlink" title="è„è¯»ï¼š"></a>è„è¯»ï¼š</h5><p>â€‹<u>å¦‚æœä¸€ä¸ªäº‹åŠ¡ã€Œè¯»åˆ°ã€äº†å¦ä¸€ä¸ªã€Œæœªæäº¤äº‹åŠ¡ä¿®æ”¹è¿‡çš„æ•°æ®ã€ï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†ã€Œè„è¯»ã€ç°è±¡ã€‚</u></p><h5 id="ä¸å¯é‡å¤è¯»ï¼š"><a href="#ä¸å¯é‡å¤è¯»ï¼š" class="headerlink" title="ä¸å¯é‡å¤è¯»ï¼š"></a>ä¸å¯é‡å¤è¯»ï¼š</h5><p>â€‹<u>åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœå‡ºç°å‰åä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†ã€Œä¸å¯é‡å¤è¯»ã€ç°è±¡ã€‚</u></p><p>å‡è®¾æœ‰ A å’Œ B è¿™ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶åœ¨å¤„ç†ï¼Œäº‹åŠ¡ A å…ˆå¼€å§‹ä»æ•°æ®åº“ä¸­è¯»å–æŸæ•°æ®ï¼Œç„¶åç»§ç»­æ‰§è¡Œä»£ç é€»è¾‘å¤„ç†ï¼Œ<strong>åœ¨è¿™è¿‡ç¨‹ä¸­å¦‚æœ<u>äº‹åŠ¡ B æ›´æ–°äº†è¿™æ¡æ•°æ®ï¼Œå¹¶æäº¤äº†äº‹åŠ¡</u>ï¼Œé‚£ä¹ˆå½“äº‹åŠ¡ A å†æ¬¡è¯»å–è¯¥æ•°æ®æ—¶ï¼Œå°±ä¼šå‘ç°å‰åä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€è‡´çš„ï¼Œè¿™ç§ç°è±¡å°±è¢«ç§°ä¸ºä¸å¯é‡å¤è¯»ã€‚</strong></p><h5 id="å¹»è¯»ï¼š"><a href="#å¹»è¯»ï¼š" class="headerlink" title="å¹»è¯»ï¼š"></a>å¹»è¯»ï¼š</h5><p>â€‹åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡<u>æŸ¥è¯¢æŸä¸ªç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„ã€Œè®°å½•æ•°é‡ã€</u>ï¼Œå¦‚æœå‡ºç°å‰åä¸¤æ¬¡æŸ¥è¯¢åˆ°çš„è®°å½•æ•°é‡ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†ã€Œå¹»è¯»ã€ç°è±¡ã€‚</p><h5 id="ğŸ“–æ€»ç»“ï¼š"><a href="#ğŸ“–æ€»ç»“ï¼š" class="headerlink" title="ğŸ“–æ€»ç»“ï¼š"></a>ğŸ“–æ€»ç»“ï¼š</h5><ul><li>è„è¯»ï¼šè¯»åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼›</li><li>ä¸å¯é‡å¤è¯»ï¼šå‰åè¯»å–çš„æ•°æ®ä¸ä¸€è‡´ï¼›</li><li>å¹»è¯»ï¼šå‰åè¯»å–çš„è®°å½•æ•°é‡ä¸ä¸€è‡´ã€‚</li></ul><h4 id="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ"><a href="#äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ"></a>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ</h4><p>â€‹<u>ä¸Šè¿°ä¸‰ä¸ªç°è±¡çš„ä¸¥é‡æ€§æ’åºï¼š   è„è¯» &gt; ä¸å¯é‡å¤è¯» &gt; å¹»è¯»</u></p><p>SQL æ ‡å‡†æå‡ºäº†å››ç§éš”ç¦»çº§åˆ«æ¥è§„é¿è¿™äº›ç°è±¡ï¼Œ<strong>éš”ç¦»çº§åˆ«è¶Šé«˜ğŸ”¢ï¼Œæ€§èƒ½æ•ˆç‡å°±è¶Šä½</strong>ï¼Œè¿™å››ä¸ªéš”ç¦»çº§åˆ«å¦‚ä¸‹ï¼š</p><ul><li>4ï¸âƒ£<strong>è¯»æœªæäº¤ï¼ˆ<em>read uncommitted</em>ï¼‰</strong>ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ï¼›</li><li>3ï¸âƒ£<strong>è¯»æäº¤ï¼ˆ<em>read committed</em>ï¼‰</strong>ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ï¼›</li><li>2ï¸âƒ£<strong>å¯é‡å¤è¯»ï¼ˆ<em>repeatable read</em>ï¼‰</strong>ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œä¸€ç›´è·Ÿè¿™ä¸ªäº‹åŠ¡å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œ<strong>MySQL InnoDB å¼•æ“çš„é»˜è®¤éš”ç¦»çº§åˆ«</strong>ï¼›</li><li>1ï¸âƒ£<strong>ä¸²è¡ŒåŒ–ï¼ˆ<em>serializable</em> ï¼‰</strong>ï¼›ä¼šå¯¹è®°å½•åŠ ä¸Šè¯»å†™é”ï¼Œåœ¨å¤šä¸ªäº‹åŠ¡å¯¹è¿™æ¡è®°å½•è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œå¦‚æœå‘ç”Ÿäº†è¯»å†™å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼›</li></ul><p>â€‹</p><p>é’ˆå¯¹ä¸åŒçš„éš”ç¦»çº§åˆ«ï¼Œå¹¶å‘äº‹åŠ¡æ—¶å¯èƒ½å‘ç”Ÿçš„ç°è±¡ä¹Ÿä¼šä¸åŒï¼Œå¦‚å›¾ï¼š</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230804164017574.png" alt="image-20230804164017574" style="zoom:33%;" /><p>æˆ‘ä»¬è®¨è®ºçš„ <u>MySQL è™½ç„¶æ”¯æŒ 4 ç§éš”ç¦»çº§åˆ«ï¼Œä½†æ˜¯ä¸SQL æ ‡å‡†ä¸­è§„å®šçš„å„çº§éš”ç¦»çº§åˆ«å…è®¸å‘ç”Ÿçš„ç°è±¡å´æœ‰äº›å‡ºå…¥ã€‚</u></p><p>â€“MySQLä¸­çš„ã€Œå¯é‡å¤è¯»ã€æ¯”SQLæ ‡å‡†çš„ã€Œå¯é‡å¤è¯»ã€æ›´ç‰›ï¼</p><p>MySQL åœ¨ã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«ä¸‹ï¼Œ<u>å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…å¹»è¯»ç°è±¡çš„å‘ç”Ÿ</u>ï¼ˆæ³¨æ„æ˜¯å¾ˆå¤§ç¨‹åº¦é¿å…ï¼Œå¹¶ä¸æ˜¯å½»åº•é¿å…ï¼‰ï¼Œæ‰€ä»¥ MySQL å¹¶<u>ä¸ä¼šä½¿ç”¨ã€Œä¸²è¡ŒåŒ–ã€éš”ç¦»çº§åˆ«æ¥é¿å…å¹»è¯»ç°è±¡çš„å‘ç”Ÿï¼Œå› ä¸ºä½¿ç”¨ã€Œä¸²è¡ŒåŒ–ã€éš”ç¦»çº§åˆ«ä¼šå½±å“æ€§èƒ½ã€‚</u></p><h5 id="MySQL-InnoDB-å¼•æ“çš„é»˜è®¤éš”ç¦»çº§åˆ«è™½ç„¶æ˜¯ã€Œå¯é‡å¤è¯»ã€ï¼Œä½†æ˜¯å®ƒå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…å¹»è¯»ç°è±¡ï¼ˆå¹¶ä¸æ˜¯å®Œå…¨è§£å†³äº†ï¼‰ï¼Œè§£å†³çš„æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š"><a href="#MySQL-InnoDB-å¼•æ“çš„é»˜è®¤éš”ç¦»çº§åˆ«è™½ç„¶æ˜¯ã€Œå¯é‡å¤è¯»ã€ï¼Œä½†æ˜¯å®ƒå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…å¹»è¯»ç°è±¡ï¼ˆå¹¶ä¸æ˜¯å®Œå…¨è§£å†³äº†ï¼‰ï¼Œè§£å†³çš„æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š" class="headerlink" title="MySQL InnoDB å¼•æ“çš„é»˜è®¤éš”ç¦»çº§åˆ«è™½ç„¶æ˜¯ã€Œå¯é‡å¤è¯»ã€ï¼Œä½†æ˜¯å®ƒå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…å¹»è¯»ç°è±¡ï¼ˆå¹¶ä¸æ˜¯å®Œå…¨è§£å†³äº†ï¼‰ï¼Œè§£å†³çš„æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š"></a><strong>MySQL InnoDB å¼•æ“çš„é»˜è®¤éš”ç¦»çº§åˆ«è™½ç„¶æ˜¯ã€Œå¯é‡å¤è¯»ã€ï¼Œä½†æ˜¯å®ƒå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…å¹»è¯»ç°è±¡ï¼ˆå¹¶ä¸æ˜¯å®Œå…¨è§£å†³äº†ï¼‰</strong>ï¼Œè§£å†³çš„æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</h5><ul><li>é’ˆå¯¹<strong>å¿«ç…§è¯»</strong>ï¼ˆæ™®é€š select è¯­å¥ï¼‰ï¼Œæ˜¯é€šè¿‡ MVCC æ–¹å¼è§£å†³äº†å¹»è¯»ï¼Œå› ä¸ºå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œä¸€ç›´è·Ÿè¿™ä¸ªäº‹åŠ¡å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œ<u><strong>å³ä½¿ä¸­é€”æœ‰å…¶ä»–äº‹åŠ¡æ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œæ˜¯æŸ¥è¯¢ä¸å‡ºæ¥è¿™æ¡æ•°æ®çš„</strong></u>ï¼Œæ‰€ä»¥å°±å¾ˆå¥½äº†é¿å…å¹»è¯»é—®é¢˜ã€‚</li><li>é’ˆå¯¹<strong>å½“å‰è¯»</strong>ï¼ˆselect â€¦ for update ç­‰è¯­å¥ï¼‰ï¼Œæ˜¯<strong>é€šè¿‡ next-key lockï¼ˆè®°å½•é”+é—´éš™é”ï¼‰æ–¹å¼è§£å†³äº†å¹»è¯»</strong>ï¼Œå› ä¸ºå½“æ‰§è¡Œ select â€¦ for update è¯­å¥çš„æ—¶å€™ï¼Œä¼šåŠ ä¸Š next-key lockï¼Œå¦‚æœæœ‰å…¶ä»–äº‹åŠ¡åœ¨ next-key lock é”èŒƒå›´å†…æ’å…¥äº†ä¸€æ¡è®°å½•ï¼Œé‚£ä¹ˆè¿™ä¸ªæ’å…¥è¯­å¥å°±ä¼šè¢«é˜»å¡ï¼Œæ— æ³•æˆåŠŸæ’å…¥ï¼Œæ‰€ä»¥å°±å¾ˆå¥½äº†é¿å…å¹»è¯»é—®é¢˜ã€‚</li></ul><h5 id="è¿™å››ç§éš”ç¦»çº§åˆ«å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ"><a href="#è¿™å››ç§éš”ç¦»çº§åˆ«å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ" class="headerlink" title="è¿™å››ç§éš”ç¦»çº§åˆ«å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ"></a>è¿™å››ç§éš”ç¦»çº§åˆ«å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</h5><ul><li>å¯¹äºã€Œè¯»æœªæäº¤ã€éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œå› ä¸ºå¯ä»¥è¯»åˆ°æœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ï¼Œæ‰€ä»¥ç›´æ¥è¯»å–æœ€æ–°çš„æ•°æ®å°±å¥½äº†ï¼›</li><li>å¯¹äºã€Œä¸²è¡ŒåŒ–ã€éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œé€šè¿‡åŠ è¯»å†™é”çš„æ–¹å¼æ¥é¿å…å¹¶è¡Œè®¿é—®ï¼›</li><li>å¯¹äºã€Œè¯»æäº¤ã€å’Œã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œå®ƒä»¬æ˜¯é€šè¿‡ <strong>Read View æ¥å®ç°çš„ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºåˆ›å»º Read View çš„æ—¶æœºä¸åŒï¼Œå¤§å®¶å¯ä»¥æŠŠ Read View ç†è§£æˆä¸€ä¸ªæ•°æ®å¿«ç…§ï¼Œå°±åƒç›¸æœºæ‹ç…§é‚£æ ·ï¼Œå®šæ ¼æŸä¸€æ—¶åˆ»çš„é£æ™¯ã€‚ã€Œè¯»æäº¤ã€éš”ç¦»çº§åˆ«æ˜¯åœ¨ã€Œæ¯ä¸ªè¯­å¥æ‰§è¡Œå‰ã€éƒ½ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ª Read Viewï¼Œè€Œã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«æ˜¯ã€Œå¯åŠ¨äº‹åŠ¡æ—¶ã€ç”Ÿæˆä¸€ä¸ª Read Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æœŸé—´éƒ½åœ¨ç”¨è¿™ä¸ª Read View</strong>ã€‚<ul><li>æ³¨æ„ï¼Œæ‰§è¡Œã€Œå¼€å§‹äº‹åŠ¡ã€å‘½ä»¤ï¼Œå¹¶ä¸æ„å‘³ç€<u>å¯åŠ¨äº†äº‹åŠ¡</u>ã€‚åœ¨ MySQL æœ‰ä¸¤ç§å¼€å¯äº‹åŠ¡çš„å‘½ä»¤ï¼Œåˆ†åˆ«æ˜¯ï¼š<ul><li>ç¬¬ä¸€ç§ï¼šbegin&#x2F;start transaction å‘½ä»¤ï¼›</li><li>ç¬¬äºŒç§ï¼šstart transaction with consistent snapshot å‘½ä»¤ï¼›</li></ul></li><li>è¿™ä¸¤ç§å¼€å¯äº‹åŠ¡çš„å‘½ä»¤ï¼Œäº‹åŠ¡çš„å¯åŠ¨æ—¶æœºæ˜¯ä¸åŒçš„ï¼š<ul><li>æ‰§è¡Œäº† begin&#x2F;start transaction å‘½ä»¤åï¼Œå¹¶ä¸ä»£è¡¨äº‹åŠ¡å¯åŠ¨äº†ã€‚åªæœ‰åœ¨æ‰§è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œæ‰§è¡Œäº†å¢åˆ æŸ¥æ”¹æ“ä½œçš„ SQL è¯­å¥ï¼Œæ‰æ˜¯äº‹åŠ¡çœŸæ­£å¯åŠ¨çš„æ—¶æœºï¼›</li><li>æ‰§è¡Œäº† start transaction with consistent snapshot å‘½ä»¤ï¼Œå°±ä¼šé©¬ä¸Šå¯åŠ¨äº‹åŠ¡ã€‚</li></ul></li></ul></li></ul><h4 id="Read-View-åœ¨-MVCC-é‡Œå¦‚ä½•å·¥ä½œçš„ï¼Ÿ"><a href="#Read-View-åœ¨-MVCC-é‡Œå¦‚ä½•å·¥ä½œçš„ï¼Ÿ" class="headerlink" title="Read View åœ¨ MVCC é‡Œå¦‚ä½•å·¥ä½œçš„ï¼Ÿ"></a>Read View åœ¨ MVCC é‡Œå¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h4><p>â€‹æˆ‘ä»¬éœ€è¦äº†è§£ä¸¤ä¸ªçŸ¥è¯†ï¼š</p><ul><li>Read View ä¸­å››ä¸ªå­—æ®µä½œç”¨ï¼›</li><li>èšç°‡ç´¢å¼•è®°å½•ä¸­ä¸¤ä¸ªè·Ÿäº‹åŠ¡æœ‰å…³çš„éšè—åˆ—ï¼›</li></ul><h5 id="Read-Viewä¸­çš„å››ä¸ªå­—æ®µï¼š"><a href="#Read-Viewä¸­çš„å››ä¸ªå­—æ®µï¼š" class="headerlink" title="Read Viewä¸­çš„å››ä¸ªå­—æ®µï¼š"></a>Read Viewä¸­çš„å››ä¸ªå­—æ®µï¼š</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230804190142894.png" alt="image-20230804190142894"></p><ul><li>m_ids ï¼šæŒ‡çš„æ˜¯åœ¨åˆ›å»º Read View æ—¶ï¼Œå½“å‰æ•°æ®åº“ä¸­ã€Œæ´»è·ƒäº‹åŠ¡ã€çš„<strong>äº‹åŠ¡ id åˆ—è¡¨</strong>ï¼Œæ³¨æ„æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œ<strong>â€œæ´»è·ƒäº‹åŠ¡â€æŒ‡çš„å°±æ˜¯ï¼Œå¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤çš„äº‹åŠ¡</strong>ã€‚</li><li>min_trx_id ï¼šæŒ‡çš„æ˜¯åœ¨åˆ›å»º Read View æ—¶ï¼Œå½“å‰æ•°æ®åº“ä¸­ã€Œæ´»è·ƒäº‹åŠ¡ã€ä¸­äº‹åŠ¡ <strong>id æœ€å°çš„äº‹åŠ¡</strong>ï¼Œä¹Ÿå°±æ˜¯ m_ids çš„æœ€å°å€¼ã€‚</li><li>max_trx_id ï¼šè¿™ä¸ªå¹¶ä¸æ˜¯ m_ids çš„æœ€å¤§å€¼ï¼Œè€Œæ˜¯<strong>åˆ›å»º Read View æ—¶å½“å‰æ•°æ®åº“ä¸­åº”è¯¥ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„ id å€¼</strong>ï¼Œä¹Ÿå°±æ˜¯å…¨å±€äº‹åŠ¡ä¸­æœ€å¤§çš„äº‹åŠ¡ id å€¼ + 1ï¼›</li><li>creator_trx_id ï¼šæŒ‡çš„æ˜¯<strong>åˆ›å»ºè¯¥ Read View çš„äº‹åŠ¡çš„äº‹åŠ¡ id</strong>ã€‚</li></ul><p>çŸ¥é“äº† Read View çš„å­—æ®µï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£èšç°‡ç´¢å¼•è®°å½•ä¸­çš„ä¸¤ä¸ªéšè—åˆ—ã€‚</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230804224256537.png" alt="image-20230804224256537" style="zoom: 33%;" /><ul><li><u><strong>trx_id</strong></u>ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œå°±ä¼š<strong>æŠŠè¯¥äº‹åŠ¡çš„äº‹åŠ¡ id è®°å½•åœ¨ trx_id éšè—åˆ—é‡Œ</strong>ï¼›</li><li><u><strong>roll_pointer</strong></u>ï¼šæ¯æ¬¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œéƒ½ä¼šæŠŠæ—§ç‰ˆæœ¬çš„è®°å½•å†™å…¥åˆ° undo æ—¥å¿—ä¸­ï¼Œç„¶å<strong>è¿™ä¸ªéšè—åˆ—æ˜¯ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ¯ä¸€ä¸ªæ—§ç‰ˆæœ¬è®°å½•</strong>ï¼Œäºæ˜¯å°±å¯ä»¥é€šè¿‡å®ƒæ‰¾åˆ°ä¿®æ”¹å‰çš„è®°å½•ã€‚</li></ul><p>åœ¨åˆ›å»º Read View åï¼Œæˆ‘ä»¬å¯ä»¥å°†è®°å½•ä¸­çš„ trx_id åˆ’åˆ†è¿™ä¸‰ç§æƒ…å†µï¼š</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230804224507005.png" alt="image-20230804224507005" style="zoom:40%;" /><p>ä¸€ä¸ªäº‹åŠ¡å»è®¿é—®è®°å½•çš„æ—¶å€™ï¼Œé™¤äº†è‡ªå·±çš„æ›´æ–°è®°å½•æ€»æ˜¯å¯è§ä¹‹å¤–ï¼Œè¿˜æœ‰è¿™å‡ ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœè®°å½•çš„ trx_id å€¼å°äº Read View ä¸­çš„ <code>min_trx_id</code> å€¼ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨åˆ›å»º Read View <strong>å‰</strong>å·²ç»æäº¤çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡<strong>å¯è§</strong>ã€‚</li><li>å¦‚æœè®°å½•çš„ trx_id å€¼å¤§äºç­‰äº Read View ä¸­çš„ <code>max_trx_id</code> å€¼ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬çš„è®°å½•æ˜¯åœ¨åˆ›å»º Read View <strong>å</strong>æ‰å¯åŠ¨çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡<strong>ä¸å¯è§</strong>ã€‚</li><li>å¦‚æœè®°å½•çš„ trx_id å€¼åœ¨ Read View çš„<code>min_trx_id</code>å’Œ <code>max_trx_id</code>ä¹‹é—´ï¼Œéœ€è¦åˆ¤æ–­ trx_id æ˜¯å¦åœ¨ m_ids åˆ—è¡¨ä¸­ï¼š<ul><li>å¦‚æœè®°å½•çš„ trx_id <strong>åœ¨</strong> <code>m_ids</code> åˆ—è¡¨ä¸­ï¼Œè¡¨ç¤ºç”Ÿæˆè¯¥ç‰ˆæœ¬è®°å½•çš„æ´»è·ƒäº‹åŠ¡ä¾ç„¶æ´»è·ƒç€ï¼ˆè¿˜æ²¡æäº¤äº‹åŠ¡ï¼‰ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡<strong>ä¸å¯è§</strong>ã€‚</li><li>å¦‚æœè®°å½•çš„ trx_id <strong>ä¸åœ¨</strong> <code>m_ids</code>åˆ—è¡¨ä¸­ï¼Œè¡¨ç¤ºç”Ÿæˆè¯¥ç‰ˆæœ¬è®°å½•çš„æ´»è·ƒäº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬çš„è®°å½•å¯¹å½“å‰äº‹åŠ¡<strong>å¯è§</strong>ã€‚</li></ul></li></ul><p><u><strong>è¿™ç§é€šè¿‡ã€Œç‰ˆæœ¬é“¾ã€æ¥æ§åˆ¶å¹¶å‘äº‹åŠ¡è®¿é—®åŒä¸€ä¸ªè®°å½•æ—¶çš„è¡Œä¸ºå°±å« MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ã€‚</strong></u></p><h4 id="å¯é‡å¤è¯»æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿè¯»æäº¤æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"><a href="#å¯é‡å¤è¯»æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿè¯»æäº¤æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ" class="headerlink" title="å¯é‡å¤è¯»æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿè¯»æäº¤æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"></a>å¯é‡å¤è¯»æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿè¯»æäº¤æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h4><p>å¯¹äºã€Œè¯»æäº¤ã€å’Œã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œå®ƒä»¬æ˜¯<u>é€šè¿‡ Read View æ¥å®ç°çš„</u>ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºåˆ›å»º Read View çš„æ—¶æœºä¸åŒï¼š</p><ul><li>ã€Œè¯»æäº¤ã€éš”ç¦»çº§åˆ«æ˜¯åœ¨æ¯ä¸ª select éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ Read Viewï¼Œä¹Ÿæ„å‘³ç€ï¼Œäº‹åŠ¡æœŸé—´çš„å¤šæ¬¡è¯»å–åŒä¸€æ¡æ•°æ®ï¼Œå‰åä¸¤æ¬¡è¯»çš„æ•°æ®å¯èƒ½ä¼šå‡ºç°ä¸ä¸€è‡´ï¼Œå› ä¸ºå¯èƒ½è¿™æœŸé—´å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†è¯¥è®°å½•ï¼Œå¹¶æäº¤äº†äº‹åŠ¡ã€‚</li><li>ã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«æ˜¯å¯åŠ¨äº‹åŠ¡æ—¶ç”Ÿæˆä¸€ä¸ª Read Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æœŸé—´éƒ½åœ¨ç”¨è¿™ä¸ª Read Viewï¼Œè¿™æ ·å°±ä¿è¯äº†åœ¨äº‹åŠ¡æœŸé—´è¯»åˆ°çš„æ•°æ®éƒ½æ˜¯äº‹åŠ¡å¯åŠ¨å‰çš„è®°å½•ã€‚</li></ul><p>è¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«å®ç°<u><strong>æ˜¯é€šè¿‡ã€Œäº‹åŠ¡çš„ Read View é‡Œçš„å­—æ®µã€å’Œã€Œè®°å½•ä¸­çš„ä¸¤ä¸ªéšè—åˆ—ã€çš„æ¯”å¯¹ï¼Œæ¥æ§åˆ¶å¹¶å‘äº‹åŠ¡è®¿é—®åŒä¸€ä¸ªè®°å½•æ—¶çš„è¡Œä¸ºï¼Œè¿™å°±å« MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ã€‚</strong></u></p><p>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸­ï¼Œ<strong>æ™®é€šçš„ select è¯­å¥</strong>å°±æ˜¯åŸºäº MVCC å®ç°çš„å¿«ç…§è¯»ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šåŠ é”çš„ã€‚è€Œ <u>select .. for update è¯­å¥å°±ä¸æ˜¯å¿«ç…§è¯»äº†ï¼Œè€Œæ˜¯å½“å‰è¯»</u>äº†ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡è¯»éƒ½æ˜¯æ‹¿åˆ°æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®ï¼Œä½†æ˜¯å®ƒä¼šå¯¹è¯»åˆ°çš„è®°å½•åŠ ä¸Š next-key lock é”ã€‚</p><h4 id="MySQL-å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨è§£å†³å¹»è¯»äº†å—ï¼Ÿ"><a href="#MySQL-å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨è§£å†³å¹»è¯»äº†å—ï¼Ÿ" class="headerlink" title="MySQL å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨è§£å†³å¹»è¯»äº†å—ï¼Ÿ"></a>MySQL å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨è§£å†³å¹»è¯»äº†å—ï¼Ÿ</h4><h5 id="1-å¿«ç…§è¯»æ˜¯å¦‚ä½•é¿å…å¹»è¯»çš„ï¼Ÿ"><a href="#1-å¿«ç…§è¯»æ˜¯å¦‚ä½•é¿å…å¹»è¯»çš„ï¼Ÿ" class="headerlink" title="1.å¿«ç…§è¯»æ˜¯å¦‚ä½•é¿å…å¹»è¯»çš„ï¼Ÿ"></a>1.å¿«ç…§è¯»æ˜¯å¦‚ä½•é¿å…å¹»è¯»çš„ï¼Ÿ</h5><p>â€‹å¯é‡å¤è¯»éš”ç¦»çº§åˆ«æ˜¯ç”± MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰å®ç°çš„ï¼Œå®ç°çš„æ–¹å¼æ˜¯å¼€å§‹äº‹åŠ¡åï¼ˆæ‰§è¡Œ begin è¯­å¥åï¼‰ï¼Œåœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªæŸ¥è¯¢è¯­å¥åï¼Œä¼šåˆ›å»ºä¸€ä¸ª Read Viewï¼Œ<u><strong>åç»­çš„æŸ¥è¯¢è¯­å¥åˆ©ç”¨è¿™ä¸ª Read Viewï¼Œé€šè¿‡è¿™ä¸ª Read View å°±å¯ä»¥åœ¨ undo log ç‰ˆæœ¬é“¾æ‰¾åˆ°äº‹åŠ¡å¼€å§‹æ—¶çš„æ•°æ®ï¼Œæ‰€ä»¥äº‹åŠ¡è¿‡ç¨‹ä¸­æ¯æ¬¡æŸ¥è¯¢çš„æ•°æ®éƒ½æ˜¯ä¸€æ ·çš„</strong>ï¼Œå³ä½¿ä¸­é€”æœ‰å…¶ä»–äº‹åŠ¡æ’å…¥äº†æ–°çºªå½•ï¼Œæ˜¯æŸ¥è¯¢ä¸å‡ºæ¥è¿™æ¡æ•°æ®çš„ï¼Œæ‰€ä»¥å°±å¾ˆå¥½äº†é¿å…å¹»è¯»é—®é¢˜ã€‚</u></p><h5 id="2-å½“å‰è¯»æ˜¯å¦‚ä½•é¿å…å¹»è¯»çš„ï¼Ÿ"><a href="#2-å½“å‰è¯»æ˜¯å¦‚ä½•é¿å…å¹»è¯»çš„ï¼Ÿ" class="headerlink" title="2.å½“å‰è¯»æ˜¯å¦‚ä½•é¿å…å¹»è¯»çš„ï¼Ÿ"></a>2.å½“å‰è¯»æ˜¯å¦‚ä½•é¿å…å¹»è¯»çš„ï¼Ÿ</h5><p>MySQL é‡Œé™¤äº†æ™®é€šæŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œå…¶ä»–éƒ½æ˜¯<strong>å½“å‰è¯»</strong>ï¼Œæ¯”å¦‚ <u>updateã€insertã€deleteï¼Œè¿™äº›è¯­å¥æ‰§è¡Œå‰éƒ½ä¼šæŸ¥è¯¢æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®ï¼Œç„¶åå†åšè¿›ä¸€æ­¥çš„æ“ä½œã€‚</u></p><p>è¿™å¾ˆå¥½ç†è§£ï¼Œå‡è®¾ä½ è¦ update ä¸€ä¸ªè®°å½•ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡å·²ç» delete è¿™æ¡è®°å½•å¹¶ä¸”æäº¤äº‹åŠ¡äº†ï¼Œè¿™æ ·ä¸æ˜¯ä¼šäº§ç”Ÿå†²çªå—ï¼Œæ‰€ä»¥ update çš„æ—¶å€™è‚¯å®šè¦çŸ¥é“æœ€æ–°çš„æ•°æ®ã€‚</p><p>å¦å¤–ï¼Œ<code>select ... for update</code> è¿™ç§æŸ¥è¯¢è¯­å¥æ˜¯å½“å‰è¯»ï¼Œæ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™éƒ½æ˜¯è¯»å–æœ€æ–°çš„æ•°æ®ã€‚</p><p><strong>Innodb å¼•æ“ä¸ºäº†è§£å†³ã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«ä½¿ç”¨ã€Œå½“å‰è¯»ã€è€Œé€ æˆçš„å¹»è¯»é—®é¢˜ï¼Œå°±å¼•å‡ºäº†next-key lock</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230807143817869.png" alt="image-20230807143817869"></p><p><strong>äº‹åŠ¡ A æ‰§è¡Œäº†è¿™é¢è¿™æ¡é”å®šè¯»è¯­å¥åï¼Œå°±åœ¨å¯¹è¡¨ä¸­çš„è®°å½•åŠ ä¸Š id èŒƒå›´ä¸º (2, +âˆ] çš„ next-key lockï¼ˆnext-key lock æ˜¯é—´éš™é”+è®°å½•é”çš„ç»„åˆï¼‰ã€‚</strong></p><p>ç„¶åï¼Œäº‹åŠ¡ B åœ¨æ‰§è¡Œæ’å…¥è¯­å¥çš„æ—¶å€™ï¼Œåˆ¤æ–­åˆ°æ’å…¥çš„ä½ç½®è¢«äº‹åŠ¡ A åŠ äº† next-key lockï¼Œäºæ˜¯äº‹ç‰© B ä¼šç”Ÿæˆä¸€ä¸ªæ’å…¥æ„å‘é”ï¼ŒåŒæ—¶è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°äº‹åŠ¡ A æäº¤äº†äº‹åŠ¡ã€‚è¿™å°±é¿å…äº†ç”±äºäº‹åŠ¡ B æ’å…¥æ–°è®°å½•è€Œå¯¼è‡´äº‹åŠ¡ A å‘ç”Ÿå¹»è¯»çš„ç°è±¡ã€‚</p><h5 id="å¹»è¯»è¢«å®Œå…¨è§£å†³äº†å—ï¼Ÿ"><a href="#å¹»è¯»è¢«å®Œå…¨è§£å†³äº†å—ï¼Ÿ" class="headerlink" title="å¹»è¯»è¢«å®Œå…¨è§£å†³äº†å—ï¼Ÿ"></a>å¹»è¯»è¢«å®Œå…¨è§£å†³äº†å—ï¼Ÿ</h5><p>**å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹è™½ç„¶å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†å¹»è¯»ï¼Œä½†æ˜¯è¿˜æ˜¯<u>æ²¡èƒ½å®Œå…¨è§£å†³å¹»è¯»</u>**ã€‚</p><h6 id="å¹»è¯»åœºæ™¯1"><a href="#å¹»è¯»åœºæ™¯1" class="headerlink" title="å¹»è¯»åœºæ™¯1:"></a>å¹»è¯»åœºæ™¯1:</h6><p>â€‹<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230807144311080.png" alt="image-20230807144311080" style="zoom:50%;" /></p><p>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œ<u>äº‹åŠ¡ A ç¬¬ä¸€æ¬¡æ‰§è¡Œæ™®é€šçš„ select è¯­å¥æ—¶ç”Ÿæˆäº†ä¸€ä¸ª ReadViewï¼Œä¹‹åäº‹åŠ¡ B å‘è¡¨ä¸­æ–°æ’å…¥äº†ä¸€æ¡ id &#x3D; 5 çš„è®°å½•å¹¶æäº¤ã€‚æ¥ç€ï¼Œ<strong>äº‹åŠ¡ A å¯¹ id &#x3D; 5 è¿™æ¡è®°å½•è¿›è¡Œäº†æ›´æ–°æ“ä½œï¼Œåœ¨è¿™ä¸ªæ—¶åˆ»ï¼Œè¿™æ¡æ–°è®°å½•çš„ trx_id éšè—åˆ—çš„å€¼å°±å˜æˆäº†äº‹åŠ¡ A çš„äº‹åŠ¡ idï¼Œä¹‹åäº‹åŠ¡ A å†ä½¿ç”¨æ™®é€š select è¯­å¥å»æŸ¥è¯¢è¿™æ¡è®°å½•æ—¶å°±å¯ä»¥çœ‹åˆ°è¿™æ¡è®°å½•äº†</strong>ï¼Œäºæ˜¯å°±å‘ç”Ÿäº†å¹»è¯»ã€‚</u></p><p>å› ä¸ºè¿™ç§ç‰¹æ®Šç°è±¡çš„å­˜åœ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¤ä¸º <strong>MySQL Innodb ä¸­çš„ MVCC å¹¶ä¸èƒ½å®Œå…¨é¿å…å¹»è¯»ç°è±¡</strong>ã€‚</p><h6 id="å¹»è¯»åœºæ™¯2"><a href="#å¹»è¯»åœºæ™¯2" class="headerlink" title="å¹»è¯»åœºæ™¯2:"></a>å¹»è¯»åœºæ™¯2:</h6><p>é™¤äº†ä¸Šé¢è¿™ä¸€ç§åœºæ™¯ä¼šå‘ç”Ÿå¹»è¯»ç°è±¡ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸‹é¢è¿™ä¸ªåœºæ™¯ä¹Ÿä¼šå‘ç”Ÿå¹»è¯»ç°è±¡ã€‚</p><ul><li>T1 æ—¶åˆ»ï¼šäº‹åŠ¡ A å…ˆæ‰§è¡Œã€Œå¿«ç…§è¯»è¯­å¥ã€ï¼šselect * from t_test where id &gt; 100 å¾—åˆ°äº† 3 æ¡è®°å½•ã€‚</li><li>T2 æ—¶åˆ»ï¼šäº‹åŠ¡ B å¾€æ’å…¥ä¸€ä¸ª id&#x3D; 200 çš„è®°å½•å¹¶æäº¤ï¼›</li><li>T3 æ—¶åˆ»ï¼šäº‹åŠ¡ A å†æ‰§è¡Œã€Œå½“å‰è¯»è¯­å¥ã€ select * from t_test where id &gt; 100 for update å°±ä¼šå¾—åˆ° 4 æ¡è®°å½•ï¼Œæ­¤æ—¶ä¹Ÿå‘ç”Ÿäº†å¹»è¯»ç°è±¡ã€‚</li></ul><p><strong>ğŸŒŸå› ä¸ºT1æ—¶åˆ»æ²¡æœ‰ for update -&gt;è¿›è¡Œå½“å‰è¯»ï¼Œå› æ­¤æ²¡æœ‰åŠ ä¸Šnext-key lockï¼Œå› æ­¤å¯¼è‡´äº†å¹»è¯»</strong></p><p><strong>â€”â€”æ‰€ä»¥æˆ‘ä»¬å¼€å¯äº‹åŠ¡åï¼Œè¦è¶æ—©æ·»åŠ next-key lockï¼Œå³æ‰§è¡Œselect â€¦ for update è¿™ç±»å½“å‰è¯»çš„è¯­å¥ï¼Œä»è€Œé¿å…å…¶ä»–äº‹åŠ¡æ’å…¥ä¸€æ¡æ–°è®°å½•ã€‚</strong></p><h2 id="é”ğŸ”’"><a href="#é”ğŸ”’" class="headerlink" title="é”ğŸ”’"></a>é”ğŸ”’</h2><h3 id="é”ç²’åº¦ï¼š"><a href="#é”ç²’åº¦ï¼š" class="headerlink" title="é”ç²’åº¦ï¼š"></a>é”ç²’åº¦ï¼š</h3><h4 id="1-å…¨å±€é”ï¼š"><a href="#1-å…¨å±€é”ï¼š" class="headerlink" title="1.å…¨å±€é”ï¼š"></a>1.å…¨å±€é”ï¼š</h4><p>â€‹è¦ä½¿ç”¨å…¨å±€é”ï¼Œåˆ™è¦æ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä½¿ç”¨å…¨å±€é”ï¼š</span></span><br><span class="line">flush tables <span class="keyword">with</span> read lock;</span><br><span class="line"><span class="comment">-- é‡Šæ”¾å…¨å±€é”ï¼š</span></span><br><span class="line">unlock tables</span><br></pre></td></tr></table></figure><p>â€‹æ‰§è¡Œå®Œåï¼Œ<strong>æ•°æ®åº“åªèƒ½è¢«æŸ¥è¯¢</strong>ï¼Œå…¶ä»–æ“ä½œéƒ½ä¸èƒ½åšï¼ï¼ï¼ï¼</p><h5 id="åº”ç”¨åœºæ™¯ï¼š"><a href="#åº”ç”¨åœºæ™¯ï¼š" class="headerlink" title="åº”ç”¨åœºæ™¯ï¼š"></a>åº”ç”¨åœºæ™¯ï¼š</h5><p>â€‹å…¨å±€é”ä¸»è¦åº”ç”¨äºåš<strong>å…¨åº“é€»è¾‘å¤‡ä»½</strong>ï¼Œè¿™æ ·åœ¨å¤‡ä»½æ•°æ®åº“æœŸé—´ï¼Œä¸ä¼šå› ä¸ºæ•°æ®æˆ–è¡¨ç»“æ„çš„æ›´æ–°ï¼Œè€Œå‡ºç°å¤‡ä»½æ–‡ä»¶çš„æ•°æ®ä¸é¢„æœŸçš„ä¸ä¸€æ ·ã€‚</p><h5 id="ç¼ºç‚¹ï¼š-1"><a href="#ç¼ºç‚¹ï¼š-1" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><p>â€‹é‚£ä¹ˆå¦‚æœæ•°æ®åº“é‡Œæœ‰å¾ˆå¤šæ•°æ®ï¼Œå¤‡ä»½å°±ä¼šèŠ±è´¹å¾ˆå¤šçš„æ—¶é—´ï¼Œå…³é”®æ˜¯å¤‡ä»½æœŸé—´ï¼Œä¸šåŠ¡åªèƒ½è¯»æ•°æ®ï¼Œè€Œä¸èƒ½æ›´æ–°æ•°æ®ï¼Œè¿™æ ·ä¼šé€ æˆä¸šåŠ¡åœæ»ã€‚</p><h5 id="ğŸŒŸæ—¢ç„¶å¤‡ä»½æ•°æ®åº“æ•°æ®çš„æ—¶å€™ï¼Œä½¿ç”¨å…¨å±€é”ä¼šå½±å“ä¸šåŠ¡ï¼Œé‚£æœ‰ä»€ä¹ˆå…¶ä»–æ–¹å¼å¯ä»¥é¿å…ï¼Ÿ"><a href="#ğŸŒŸæ—¢ç„¶å¤‡ä»½æ•°æ®åº“æ•°æ®çš„æ—¶å€™ï¼Œä½¿ç”¨å…¨å±€é”ä¼šå½±å“ä¸šåŠ¡ï¼Œé‚£æœ‰ä»€ä¹ˆå…¶ä»–æ–¹å¼å¯ä»¥é¿å…ï¼Ÿ" class="headerlink" title="ğŸŒŸæ—¢ç„¶å¤‡ä»½æ•°æ®åº“æ•°æ®çš„æ—¶å€™ï¼Œä½¿ç”¨å…¨å±€é”ä¼šå½±å“ä¸šåŠ¡ï¼Œé‚£æœ‰ä»€ä¹ˆå…¶ä»–æ–¹å¼å¯ä»¥é¿å…ï¼Ÿ"></a>ğŸŒŸæ—¢ç„¶å¤‡ä»½æ•°æ®åº“æ•°æ®çš„æ—¶å€™ï¼Œä½¿ç”¨å…¨å±€é”ä¼šå½±å“ä¸šåŠ¡ï¼Œé‚£æœ‰ä»€ä¹ˆå…¶ä»–æ–¹å¼å¯ä»¥é¿å…ï¼Ÿ</h5><p>â€‹æœ‰çš„ï¼Œå¦‚æœæ•°æ®åº“çš„å¼•æ“æ”¯æŒçš„äº‹åŠ¡æ”¯æŒ<strong>å¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«</strong>ï¼Œ<u>é‚£ä¹ˆåœ¨å¤‡ä»½æ•°æ®åº“ä¹‹å‰å…ˆå¼€å¯äº‹åŠ¡ï¼Œä¼šå…ˆåˆ›å»º Read Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´éƒ½åœ¨ç”¨è¿™ä¸ª Read Viewï¼Œè€Œä¸”ç”±äº MVCC çš„æ”¯æŒï¼Œå¤‡ä»½æœŸé—´ä¸šåŠ¡ä¾ç„¶å¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ›´æ–°æ“ä½œã€‚</u></p><p>â€‹å› ä¸ºåœ¨å¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œå³ä½¿å…¶ä»–äº‹åŠ¡æ›´æ–°äº†è¡¨çš„æ•°æ®ï¼Œä¹Ÿä¸ä¼šå½±å“å¤‡ä»½æ•°æ®åº“æ—¶çš„ Read Viewï¼Œè¿™å°±æ˜¯äº‹åŠ¡å››å¤§ç‰¹æ€§ä¸­çš„éš”ç¦»æ€§ï¼Œè¿™æ ·å¤‡ä»½æœŸé—´å¤‡ä»½çš„æ•°æ®ä¸€ç›´æ˜¯åœ¨å¼€å¯äº‹åŠ¡æ—¶çš„æ•°æ®ã€‚</p><p>â€‹å¤‡ä»½æ•°æ®åº“çš„å·¥å…·æ˜¯ mysqldumpï¼Œåœ¨ä½¿ç”¨ mysqldump æ—¶åŠ ä¸Š <code>â€“single-transaction</code> å‚æ•°çš„æ—¶å€™ï¼Œå°±ä¼šåœ¨å¤‡ä»½æ•°æ®åº“ä¹‹å‰å…ˆå¼€å¯äº‹åŠ¡ã€‚è¿™ç§æ–¹æ³•åªé€‚ç”¨äºæ”¯æŒã€Œå¯é‡å¤è¯»éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ã€çš„å­˜å‚¨å¼•æ“ã€‚</p><p>â€‹InnoDB å­˜å‚¨å¼•æ“é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ­£æ˜¯å¯é‡å¤è¯»ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼æ¥å¤‡ä»½æ•°æ®åº“ã€‚</p><p>â€‹ä½†æ˜¯ï¼Œå¯¹äº MyISAM è¿™ç§ä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼Œåœ¨å¤‡ä»½æ•°æ®åº“æ—¶å°±è¦ä½¿ç”¨å…¨å±€é”çš„æ–¹æ³•ã€‚</p><h4 id="2-è¡¨çº§é”ï¼š"><a href="#2-è¡¨çº§é”ï¼š" class="headerlink" title="2.è¡¨çº§é”ï¼š"></a>2.è¡¨çº§é”ï¼š</h4><p>MySQL é‡Œé¢è¡¨çº§åˆ«çš„é”æœ‰è¿™å‡ ç§ï¼š</p><ul><li>è¡¨é”ï¼›</li><li>å…ƒæ•°æ®é”ï¼ˆMDLï¼‰;</li><li>æ„å‘é”ï¼›</li><li>AUTO-INC é”ï¼›</li></ul><h5 id="2-1-è¡¨é”ï¼š"><a href="#2-1-è¡¨é”ï¼š" class="headerlink" title="2.1.è¡¨é”ï¼š"></a>2.1.è¡¨é”ï¼š</h5><p>â€‹è¡¨é”èƒ½å¤Ÿé”ä½ä¸€å¼ è¡¨ï¼šä¸€ä¸ªçº¿ç¨‹å¯¹ä¸€å¼ è¡¨æ·»åŠ äº†è¡¨é”ï¼Œé‚£ä¹ˆæ‰€æœ‰çº¿ç¨‹å¯¹è¯¥è¡¨çš„å†™æ“ä½œéƒ½ä¼šè¢«é˜»å¡ï¼</p><p>ä¸è¿‡å°½é‡é¿å…åœ¨ä½¿ç”¨ InnoDB å¼•æ“çš„è¡¨ä½¿ç”¨è¡¨é”ï¼Œå› ä¸ºè¡¨é”çš„é¢—ç²’åº¦å¤ªå¤§ï¼Œä¼šå½±å“å¹¶å‘æ€§èƒ½ï¼Œ<strong>InnoDB ç‰›é€¼çš„åœ°æ–¹åœ¨äºå®ç°äº†é¢—ç²’åº¦æ›´ç»†çš„è¡Œçº§é”</strong>ã€‚</p><h5 id="2-2-å…ƒæ•°æ®é”-MDL-ï¼š"><a href="#2-2-å…ƒæ•°æ®é”-MDL-ï¼š" class="headerlink" title="2.2.å…ƒæ•°æ®é”(MDL)ï¼š"></a>2.2.å…ƒæ•°æ®é”(MDL)ï¼š</h5><p>æˆ‘ä»¬ä¸éœ€è¦æ˜¾ç¤ºçš„ä½¿ç”¨ MDLï¼Œå› ä¸ºå½“æˆ‘ä»¬å¯¹æ•°æ®åº“è¡¨è¿›è¡Œæ“ä½œæ—¶ï¼Œä¼šè‡ªåŠ¨ç»™è¿™ä¸ªè¡¨åŠ ä¸Š MDLï¼š</p><ul><li>å¯¹ä¸€å¼ è¡¨è¿›è¡Œ CRUD æ“ä½œæ—¶ï¼ŒåŠ çš„æ˜¯ <strong>MDL è¯»é”</strong>ï¼›</li><li>å¯¹ä¸€å¼ è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ çš„æ˜¯ <strong>MDL å†™é”</strong>ï¼›</li></ul><p><u>MDL æ˜¯ä¸ºäº†ä¿è¯å½“ç”¨æˆ·å¯¹è¡¨æ‰§è¡Œ CRUD æ“ä½œæ—¶ï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹å¯¹è¿™ä¸ªè¡¨ç»“æ„åšäº†å˜æ›´ã€‚</u></p><p>â€‹ğŸŒŸ<strong>å½“æœ‰çº¿ç¨‹åœ¨æ‰§è¡Œ select è¯­å¥ï¼ˆ åŠ  MDL <u>è¯»</u>é”ï¼‰çš„æœŸé—´ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹è¦æ›´æ”¹è¯¥è¡¨çš„ç»“æ„ï¼ˆ ç”³è¯· MDL <u>å†™</u>é”ï¼‰ï¼Œé‚£ä¹ˆå°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ‰§è¡Œå®Œ select è¯­å¥ï¼ˆ é‡Šæ”¾ MDL è¯»é”ï¼‰ã€‚</strong></p><p>â€‹<strong>ğŸŒŸåä¹‹ï¼Œå½“æœ‰çº¿ç¨‹å¯¹è¡¨ç»“æ„è¿›è¡Œå˜æ›´ï¼ˆ åŠ  MDL å†™é”ï¼‰çš„æœŸé—´ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹æ‰§è¡Œäº† CRUD æ“ä½œï¼ˆ ç”³è¯· MDL è¯»é”ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°è¡¨ç»“æ„å˜æ›´å®Œæˆï¼ˆ é‡Šæ”¾ MDL å†™é”ï¼‰ã€‚</strong></p><blockquote><p>MDL ä¸éœ€è¦æ˜¾ç¤ºè°ƒç”¨ï¼Œé‚£å®ƒæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™é‡Šæ”¾çš„?</p></blockquote><p>MDL æ˜¯<u>åœ¨äº‹åŠ¡æäº¤åæ‰ä¼šé‡Šæ”¾ï¼Œè¿™æ„å‘³ç€<strong>äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼ŒMDL æ˜¯ä¸€ç›´æŒæœ‰çš„</strong>ã€‚</u></p><p>é‚£å¦‚æœæ•°æ®åº“æœ‰ä¸€ä¸ªé•¿äº‹åŠ¡ï¼ˆæ‰€è°“çš„é•¿äº‹åŠ¡ï¼Œå°±æ˜¯å¼€å¯äº†äº‹åŠ¡ï¼Œä½†æ˜¯ä¸€ç›´è¿˜æ²¡æäº¤ï¼‰ï¼Œé‚£åœ¨å¯¹è¡¨ç»“æ„åšå˜æ›´æ“ä½œçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„äº‹æƒ…ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªé¡ºåºçš„åœºæ™¯ï¼š</p><ol><li>é¦–å…ˆï¼Œçº¿ç¨‹ A å…ˆå¯ç”¨äº†äº‹åŠ¡ï¼ˆä½†æ˜¯ä¸€ç›´ä¸æäº¤ï¼‰ï¼Œç„¶åæ‰§è¡Œä¸€æ¡ select è¯­å¥ï¼Œæ­¤æ—¶å°±å…ˆå¯¹è¯¥è¡¨åŠ ä¸Š MDL è¯»é”ï¼›</li><li>ç„¶åï¼Œçº¿ç¨‹ B ä¹Ÿæ‰§è¡Œäº†åŒæ ·çš„ select è¯­å¥ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šé˜»å¡ï¼Œå› ä¸ºã€Œè¯»è¯»ã€å¹¶ä¸å†²çªï¼›</li><li>æ¥ç€ï¼Œçº¿ç¨‹ C ä¿®æ”¹äº†è¡¨å­—æ®µï¼Œæ­¤æ—¶ç”±äºçº¿ç¨‹ A çš„äº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œä¹Ÿå°±æ˜¯ MDL è¯»é”è¿˜åœ¨å ç”¨ç€ï¼Œè¿™æ—¶çº¿ç¨‹ C å°±æ— æ³•ç”³è¯·åˆ° MDL å†™é”ï¼Œå°±ä¼šè¢«é˜»å¡ï¼Œ</li></ol><p>é‚£ä¹ˆåœ¨çº¿ç¨‹ C é˜»å¡åï¼Œåç»­æœ‰å¯¹è¯¥è¡¨çš„ select è¯­å¥ï¼Œå°±éƒ½ä¼šè¢«é˜»å¡ï¼Œå¦‚æœæ­¤æ—¶æœ‰å¤§é‡è¯¥è¡¨çš„ select è¯­å¥çš„è¯·æ±‚åˆ°æ¥ï¼Œå°±ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹è¢«é˜»å¡ä½ï¼Œè¿™æ—¶æ•°æ®åº“çš„çº¿ç¨‹å¾ˆå¿«å°±ä¼šçˆ†æ»¡äº†ã€‚</p><h5 id="2-3-æ„å‘é”ï¼š"><a href="#2-3-æ„å‘é”ï¼š" class="headerlink" title="2.3.æ„å‘é”ï¼š"></a>2.3.æ„å‘é”ï¼š</h5><ul><li>åœ¨ä½¿ç”¨ InnoDB å¼•æ“çš„è¡¨é‡Œå¯¹æŸäº›è®°å½•åŠ ä¸Šã€Œå…±äº«é”ã€ä¹‹å‰ï¼Œéœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸Šä¸€ä¸ªã€Œæ„å‘å…±äº«é”ã€ï¼›</li><li>åœ¨ä½¿ç”¨ InnoDB å¼•æ“çš„è¡¨é‡Œå¯¹æŸäº›çºªå½•åŠ ä¸Šã€Œç‹¬å é”ã€ä¹‹å‰ï¼Œéœ€è¦å…ˆåœ¨è¡¨çº§åˆ«åŠ ä¸Šä¸€ä¸ªã€Œæ„å‘ç‹¬å é”ã€ï¼›</li></ul><p>å¦‚æœæ²¡æœ‰ã€Œæ„å‘é”ã€ï¼Œé‚£ä¹ˆåŠ ã€Œç‹¬å è¡¨é”ã€æ—¶ï¼Œå°±éœ€è¦éå†è¡¨é‡Œæ‰€æœ‰è®°å½•ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰è®°å½•å­˜åœ¨ç‹¬å é”ï¼Œè¿™æ ·æ•ˆç‡ä¼šå¾ˆæ…¢ã€‚</p><p>é‚£ä¹ˆæœ‰äº†ã€Œæ„å‘é”ã€ï¼Œç”±äºåœ¨å¯¹è®°å½•åŠ ç‹¬å é”å‰ï¼Œå…ˆä¼šåŠ ä¸Šè¡¨çº§åˆ«çš„æ„å‘ç‹¬å é”ï¼Œé‚£ä¹ˆåœ¨åŠ ã€Œç‹¬å è¡¨é”ã€æ—¶ï¼Œç›´æ¥æŸ¥è¯¥è¡¨æ˜¯å¦æœ‰æ„å‘ç‹¬å é”ï¼Œå¦‚æœæœ‰å°±æ„å‘³ç€è¡¨é‡Œå·²ç»æœ‰è®°å½•è¢«åŠ äº†ç‹¬å é”ï¼Œè¿™æ ·å°±ä¸ç”¨å»éå†è¡¨é‡Œçš„è®°å½•ã€‚</p><p>æ€»ä¹‹ï¼š<strong>æ„å‘é”çš„ç›®çš„æ˜¯ä¸ºäº†å¿«é€Ÿåˆ¤æ–­è¡¨é‡Œæ˜¯å¦æœ‰è®°å½•è¢«åŠ é”</strong>ã€‚</p><h5 id="2-4-AUTO-INC-é”ï¼š"><a href="#2-4-AUTO-INC-é”ï¼š" class="headerlink" title="2.4.AUTO-INC é”ï¼š"></a>2.4.AUTO-INC é”ï¼š</h5><p>è¡¨é‡Œçš„ä¸»é”®é€šå¸¸éƒ½ä¼šè®¾ç½®æˆè‡ªå¢çš„ï¼Œè¿™æ˜¯é€šè¿‡å¯¹ä¸»é”®å­—æ®µå£°æ˜ <code>AUTO_INCREMENT</code> å±æ€§å®ç°çš„ã€‚</p><p>ä¹‹åå¯ä»¥åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œå¯ä»¥ä¸æŒ‡å®šä¸»é”®çš„å€¼ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨ç»™ä¸»é”®èµ‹å€¼é€’å¢çš„å€¼ï¼Œè¿™ä¸»è¦æ˜¯é€šè¿‡ <strong>AUTO-INC é”</strong>å®ç°çš„ã€‚</p><p>AUTO-INC é”æ˜¯ç‰¹æ®Šçš„è¡¨é”æœºåˆ¶ï¼Œé”<strong>ä¸æ˜¯å†ä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰é‡Šæ”¾ï¼Œè€Œæ˜¯å†æ‰§è¡Œå®Œæ’å…¥è¯­å¥åå°±ä¼šç«‹å³é‡Šæ”¾</strong>ã€‚</p><p><strong>åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œä¼šåŠ ä¸€ä¸ªè¡¨çº§åˆ«çš„ AUTO-INC é”</strong>ï¼Œç„¶åä¸ºè¢« <code>AUTO_INCREMENT</code> ä¿®é¥°çš„å­—æ®µèµ‹å€¼é€’å¢çš„å€¼ï¼Œç­‰æ’å…¥è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šæŠŠ AUTO-INC é”é‡Šæ”¾æ‰ã€‚</p><p>é‚£ä¹ˆï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”çš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–äº‹åŠ¡çš„å¦‚æœè¦å‘è¯¥è¡¨æ’å…¥è¯­å¥éƒ½ä¼šè¢«é˜»å¡ï¼Œä»è€Œä¿è¯æ’å…¥æ•°æ®æ—¶ï¼Œè¢« <code>AUTO_INCREMENT</code> ä¿®é¥°çš„å­—æ®µçš„å€¼æ˜¯è¿ç»­é€’å¢çš„ã€‚</p><p>ä½†æ˜¯ï¼Œ AUTO-INC é”å†å¯¹å¤§é‡æ•°æ®è¿›è¡Œæ’å…¥çš„æ—¶å€™ï¼Œä¼šå½±å“æ’å…¥æ€§èƒ½ï¼Œå› ä¸ºå¦ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ’å…¥ä¼šè¢«é˜»å¡ã€‚</p><p>å› æ­¤ï¼Œ åœ¨ MySQL 5.1.22 ç‰ˆæœ¬å¼€å§‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“æä¾›äº†ä¸€ç§<strong>è½»é‡çº§çš„é”</strong>æ¥å®ç°è‡ªå¢ã€‚</p><p>ä¸€æ ·ä¹Ÿæ˜¯åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œä¼šä¸ºè¢« <code>AUTO_INCREMENT</code> ä¿®é¥°çš„å­—æ®µåŠ ä¸Šè½»é‡çº§é”ï¼Œ<strong>ç„¶åç»™è¯¥å­—æ®µèµ‹å€¼ä¸€ä¸ªè‡ªå¢çš„å€¼ï¼Œå°±æŠŠè¿™ä¸ªè½»é‡çº§é”é‡Šæ”¾äº†ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æ•´ä¸ªæ’å…¥è¯­å¥æ‰§è¡Œå®Œåæ‰é‡Šæ”¾é”</strong>ã€‚</p><h4 id="3-è¡Œçº§é”ï¼š"><a href="#3-è¡Œçº§é”ï¼š" class="headerlink" title="3.è¡Œçº§é”ï¼š"></a>3.è¡Œçº§é”ï¼š</h4><p>â€‹è¡Œé”çš„é‡Šæ”¾æ—¶æœºæ˜¯åœ¨äº‹åŠ¡æäº¤ï¼ˆcommitï¼‰åï¼Œé”ä¼šè¢«é‡Šæ”¾ï¼Œå¹¶ä¸æ˜¯ä¸€æ¡è¯­å¥æ‰§è¡Œå®Œå°±é‡Šæ”¾è¡Œé”ã€‚</p><p>â€‹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœ update è¯­å¥çš„ where æ¡ä»¶æ²¡æœ‰ç”¨åˆ°ç´¢å¼•åˆ—ï¼Œé‚£ä¹ˆå°±ä¼šå…¨è¡¨æ‰«æï¼Œåœ¨ä¸€è¡Œè¡Œæ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä»…ç»™è¡Œè®°å½•åŠ ä¸Šäº†è¡Œé”ï¼Œè¿˜ç»™è¡Œè®°å½•ä¸¤è¾¹çš„ç©ºéš™ä¹ŸåŠ ä¸Šäº†é—´éš™é”ï¼Œç›¸å½“äºé”ä½æ•´ä¸ªè¡¨ï¼Œç„¶åç›´åˆ°äº‹åŠ¡ç»“æŸæ‰ä¼šé‡Šæ”¾é”ã€‚</p><p>æ‰€ä»¥åœ¨çº¿ä¸Šåƒä¸‡ä¸è¦æ‰§è¡Œæ²¡æœ‰å¸¦ç´¢å¼•æ¡ä»¶çš„ update è¯­å¥ï¼Œä¸ç„¶ä¼šé€ æˆä¸šåŠ¡åœæ»</p><h5 id="3-1-è®°å½•é”ï¼šRecord-Lock"><a href="#3-1-è®°å½•é”ï¼šRecord-Lock" class="headerlink" title="3.1.è®°å½•é”ï¼šRecord Lock"></a>3.1.è®°å½•é”ï¼šRecord Lock</h5><p>â€‹Record Lock ç§°ä¸ºè®°å½•é”ï¼Œé”ä½çš„æ˜¯ä¸€æ¡è®°å½•ã€‚è€Œä¸”è®°å½•é”æ˜¯æœ‰ S é”( ç±»ä¼¼è¯»é” )å’Œ X é”( ç±»ä¼¼å†™é” )ä¹‹åˆ†çš„ï¼š</p><ul><li>å½“ä¸€ä¸ªäº‹åŠ¡å¯¹ä¸€æ¡è®°å½•åŠ äº† S å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿå¯ä»¥ç»§ç»­å¯¹è¯¥è®°å½•åŠ  S å‹è®°å½•é”ï¼ˆS å‹ä¸ S é”å…¼å®¹ï¼‰ï¼Œä½†æ˜¯ä¸å¯ä»¥å¯¹è¯¥è®°å½•åŠ  X å‹è®°å½•é”ï¼ˆS å‹ä¸ X é”ä¸å…¼å®¹ï¼‰;</li><li>å½“ä¸€ä¸ªäº‹åŠ¡å¯¹ä¸€æ¡è®°å½•åŠ äº† X å‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ä¸å¯ä»¥å¯¹è¯¥è®°å½•åŠ  S å‹è®°å½•é”ï¼ˆS å‹ä¸ X é”ä¸å…¼å®¹ï¼‰ï¼Œä¹Ÿä¸å¯ä»¥å¯¹è¯¥è®°å½•åŠ  X å‹è®°å½•é”ï¼ˆX å‹ä¸ X é”ä¸å…¼å®¹ï¼‰ã€‚</li></ul><h5 id="3-2-é—´éš™é”ï¼šGap-Lock"><a href="#3-2-é—´éš™é”ï¼šGap-Lock" class="headerlink" title="3.2.é—´éš™é”ï¼šGap Lock"></a>3.2.é—´éš™é”ï¼šGap Lock</h5><p>â€‹Gap Lock **<u>åªå­˜åœ¨äºå¯é‡å¤è¯»éš”ç¦»çº§åˆ«</u>**ï¼Œç›®çš„æ˜¯<u>ä¸ºäº†è§£å†³å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¹»è¯»çš„ç°è±¡</u>ã€‚</p><p>å‡è®¾ï¼Œè¡¨ä¸­æœ‰ä¸€ä¸ªèŒƒå›´ id ä¸ºï¼ˆ3ï¼Œ5ï¼‰é—´éš™é”ï¼Œé‚£ä¹ˆ<strong>å…¶ä»–äº‹åŠ¡å°±<u>æ— æ³•æ’å…¥</u> id &#x3D; 4 è¿™æ¡è®°å½•äº†</strong>ï¼Œè¿™æ ·å°±æœ‰æ•ˆçš„é˜²æ­¢å¹»è¯»ç°è±¡çš„å‘ç”Ÿã€‚</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230806093108438.png" alt="image-20230806093108438" style="zoom:50%;" /><p>âš ï¸é—´éš™é”è™½ç„¶å­˜åœ¨ X å‹é—´éš™é”å’Œ S å‹é—´éš™é”ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œ<strong>é—´éš™é”ä¹‹é—´æ˜¯å…¼å®¹çš„ï¼Œå³ä¸¤ä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶æŒæœ‰åŒ…å«å…±åŒé—´éš™èŒƒå›´çš„é—´éš™é”ï¼Œå¹¶ä¸å­˜åœ¨äº’æ–¥å…³ç³»ï¼Œå› ä¸ºé—´éš™é”çš„ç›®çš„æ˜¯é˜²æ­¢æ’å…¥å¹»å½±è®°å½•è€Œæå‡ºçš„</strong>ã€‚</p><h5 id="3-3-ä¸´é”®é”ï¼šNext-Key-Lock"><a href="#3-3-ä¸´é”®é”ï¼šNext-Key-Lock" class="headerlink" title="3.3.ä¸´é”®é”ï¼šNext-Key Lock"></a>3.3.ä¸´é”®é”ï¼šNext-Key Lock</h5><p>Next-Key Lock ç§°ä¸ºä¸´é”®é”ï¼Œæ˜¯ <u><strong>Record Lock + Gap Lock çš„ç»„åˆï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚</strong></u></p><p>å‡è®¾ï¼Œè¡¨ä¸­æœ‰ä¸€ä¸ªèŒƒå›´ id ä¸ºï¼ˆ3ï¼Œ5] çš„ next-key lockï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡å³ä¸èƒ½æ’å…¥ id &#x3D; 4 è®°å½•ï¼Œä¹Ÿä¸èƒ½ä¿®æ”¹ id &#x3D; 5 è¿™æ¡è®°å½•ã€‚</p><p><strong>next-key lock æ˜¯åŒ…å«é—´éš™é”+è®°å½•é”çš„ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡è·å–äº† X å‹çš„ next-key lockï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡åœ¨è·å–ç›¸åŒèŒƒå›´çš„ X å‹çš„ next-key lock æ—¶ï¼Œæ˜¯ä¼šè¢«é˜»å¡çš„</strong>ã€‚â€”-å› ä¸ºè®°å½•Xé”ä¸èƒ½å…¼å®¹</p><h5 id="3-4-æ’å…¥æ„å‘é”ï¼š"><a href="#3-4-æ’å…¥æ„å‘é”ï¼š" class="headerlink" title="3.4.æ’å…¥æ„å‘é”ï¼š"></a>3.4.æ’å…¥æ„å‘é”ï¼š</h5><p>â€‹ä¸€ä¸ªäº‹åŠ¡åœ¨æ’å…¥ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œéœ€è¦åˆ¤æ–­æ’å…¥ä½ç½®æ˜¯å¦å·²è¢«å…¶ä»–äº‹åŠ¡åŠ äº†é—´éš™é”ï¼ˆnext-key lock ä¹ŸåŒ…å«é—´éš™é”ï¼‰ã€‚</p><p>å¦‚æœæœ‰çš„è¯ï¼Œæ’å…¥æ“ä½œå°±ä¼šå‘ç”Ÿ<strong>é˜»å¡</strong>ï¼Œç›´åˆ°æ‹¥æœ‰é—´éš™é”çš„é‚£ä¸ªäº‹åŠ¡æäº¤ä¸ºæ­¢ï¼ˆé‡Šæ”¾é—´éš™é”çš„æ—¶åˆ»ï¼‰ï¼Œåœ¨æ­¤æœŸé—´ä¼šç”Ÿæˆä¸€ä¸ª<strong>æ’å…¥æ„å‘é”</strong>ï¼Œè¡¨æ˜æœ‰äº‹åŠ¡æƒ³åœ¨æŸä¸ªåŒºé—´æ’å…¥æ–°è®°å½•ï¼Œä½†æ˜¯ç°åœ¨å¤„äºç­‰å¾…çŠ¶æ€ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾äº‹åŠ¡ A å·²ç»å¯¹è¡¨åŠ äº†ä¸€ä¸ªèŒƒå›´ id ä¸ºï¼ˆ3ï¼Œ5ï¼‰é—´éš™é”ã€‚</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230806093108438.png" alt="image-20230806093108438" style="zoom:50%;" /><p>å½“äº‹åŠ¡ A è¿˜æ²¡æäº¤çš„æ—¶å€™ï¼Œäº‹åŠ¡ B å‘è¯¥è¡¨æ’å…¥ä¸€æ¡ id &#x3D; 4 çš„æ–°è®°å½•ï¼Œè¿™æ—¶ä¼šåˆ¤æ–­åˆ°æ’å…¥çš„ä½ç½®å·²ç»è¢«äº‹åŠ¡ A åŠ äº†é—´éš™é”ï¼Œäºæ˜¯äº‹ç‰© B ä¼šç”Ÿæˆä¸€ä¸ªæ’å…¥æ„å‘é”ï¼Œç„¶åå°†é”çš„çŠ¶æ€è®¾ç½®ä¸ºç­‰å¾…çŠ¶æ€ï¼ˆ<em>PSï¼šMySQL åŠ é”æ—¶ï¼Œæ˜¯å…ˆç”Ÿæˆé”ç»“æ„ï¼Œç„¶åè®¾ç½®é”çš„çŠ¶æ€ï¼Œå¦‚æœé”çŠ¶æ€æ˜¯ç­‰å¾…çŠ¶æ€ï¼Œå¹¶ä¸æ˜¯æ„å‘³ç€äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”ï¼Œåªæœ‰å½“é”çŠ¶æ€ä¸ºæ­£å¸¸çŠ¶æ€æ—¶ï¼Œæ‰ä»£è¡¨äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”</em>ï¼‰ï¼Œæ­¤æ—¶äº‹åŠ¡ B å°±ä¼šå‘ç”Ÿé˜»å¡ï¼Œç›´åˆ°äº‹åŠ¡ A æäº¤äº†äº‹åŠ¡ã€‚</p><p>æ’å…¥æ„å‘é”åå­—è™½ç„¶æœ‰æ„å‘é”ï¼Œä½†æ˜¯å®ƒå¹¶<strong>ä¸æ˜¯æ„å‘é”ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ï¼Œå±äºè¡Œçº§åˆ«é”</strong>ã€‚</p><p>å¦‚æœè¯´é—´éš™é”é”ä½çš„æ˜¯ä¸€ä¸ªåŒºé—´ï¼Œé‚£ä¹ˆã€Œæ’å…¥æ„å‘é”ã€é”ä½çš„å°±æ˜¯ä¸€ä¸ªç‚¹ã€‚å› è€Œä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œæ’å…¥æ„å‘é”ç¡®å®æ˜¯ä¸€ç§ç‰¹æ®Šçš„é—´éš™é”ã€‚</p><p>æ’å…¥æ„å‘é”ä¸é—´éš™é”çš„å¦ä¸€ä¸ªéå¸¸é‡è¦çš„å·®åˆ«æ˜¯ï¼šå°½ç®¡ã€Œæ’å…¥æ„å‘é”ã€ä¹Ÿå±äºé—´éš™é”ï¼Œä½†ä¸¤ä¸ªäº‹åŠ¡å´ä¸èƒ½åœ¨åŒä¸€æ—¶é—´å†…ï¼Œä¸€ä¸ªæ‹¥æœ‰é—´éš™é”ï¼Œå¦ä¸€ä¸ªæ‹¥æœ‰è¯¥é—´éš™åŒºé—´å†…çš„æ’å…¥æ„å‘é”ï¼ˆå½“ç„¶ï¼Œæ’å…¥æ„å‘é”å¦‚æœä¸åœ¨é—´éš™é”åŒºé—´å†…åˆ™æ˜¯å¯ä»¥çš„ï¼‰ã€‚</p><h5 id="â˜„ï¸ä¸¤æ¡æ›´æ–°è¯­å¥æ›´æ–°åŒä¸€æ¡è®°å½•ï¼ŒåŠ çš„æ˜¯ä»€ä¹ˆé”ï¼Ÿ"><a href="#â˜„ï¸ä¸¤æ¡æ›´æ–°è¯­å¥æ›´æ–°åŒä¸€æ¡è®°å½•ï¼ŒåŠ çš„æ˜¯ä»€ä¹ˆé”ï¼Ÿ" class="headerlink" title="â˜„ï¸ä¸¤æ¡æ›´æ–°è¯­å¥æ›´æ–°åŒä¸€æ¡è®°å½•ï¼ŒåŠ çš„æ˜¯ä»€ä¹ˆé”ï¼Ÿ"></a>â˜„ï¸ä¸¤æ¡æ›´æ–°è¯­å¥æ›´æ–°åŒä¸€æ¡è®°å½•ï¼ŒåŠ çš„æ˜¯ä»€ä¹ˆé”ï¼Ÿ</h5><p>åœ¨å¯é‡å¤è¯»çº§åˆ«ä¸‹ï¼ŒåŠ é”çš„åŸºæœ¬å•ä½æ˜¯next-keyé”ï¼Œä½†æ˜¯åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œä¼šé€€åŒ–æˆè®°å½•é”æˆ–è€…é—®éš™é”ã€‚è¿™ä¸ªé¢˜ç›®æ›´æ–°åŒä¸€æ¡è®°å½•ï¼Œå°±è®¤ä¸ºæ˜¯ç­‰å€¼æŸ¥è¯¢çš„åœºæ™¯ã€‚è¦è€ƒè™‘è¿™å‡ ç§æƒ…å†µï¼š</p><h6 id="ç¬¬ä¸€ç§æƒ…å†µï¼šå¦‚æœæ›´æ–°æ¡ä»¶çš„å­—æ®µæ˜¯å”¯ä¸€ç´¢å¼•ï¼ŒåŠ ä»€ä¹ˆé”ï¼Ÿ"><a href="#ç¬¬ä¸€ç§æƒ…å†µï¼šå¦‚æœæ›´æ–°æ¡ä»¶çš„å­—æ®µæ˜¯å”¯ä¸€ç´¢å¼•ï¼ŒåŠ ä»€ä¹ˆé”ï¼Ÿ" class="headerlink" title="ç¬¬ä¸€ç§æƒ…å†µï¼šå¦‚æœæ›´æ–°æ¡ä»¶çš„å­—æ®µæ˜¯å”¯ä¸€ç´¢å¼•ï¼ŒåŠ ä»€ä¹ˆé”ï¼Ÿ"></a>ç¬¬ä¸€ç§æƒ…å†µï¼šå¦‚æœæ›´æ–°æ¡ä»¶çš„å­—æ®µæ˜¯å”¯ä¸€ç´¢å¼•ï¼ŒåŠ ä»€ä¹ˆé”ï¼Ÿ</h6><p>å½“æˆ‘ä»¬ç”¨å”¯ä¸€ç´¢å¼•è¿›è¡Œç­‰å€¼æŸ¥è¯¢çš„æ—¶å€™ï¼ŒæŸ¥è¯¢çš„è®°å½•å­˜ä¸å­˜åœ¨ï¼ŒåŠ é”çš„è§„åˆ™ä¹Ÿä¼šä¸åŒï¼š</p><ul><li>å½“æŸ¥è¯¢çš„è®°å½•æ˜¯ã€Œå­˜åœ¨ã€çš„ï¼Œåœ¨ç´¢å¼•æ ‘ä¸Šå®šä½åˆ°è¿™ä¸€æ¡è®°å½•åï¼Œå°†è¯¥è®°å½•çš„ç´¢å¼•ä¸­çš„ <strong>next-key lockä¼šé€€åŒ–æˆã€Œè®°å½•é”ã€ã€‚</strong></li><li>å½“æŸ¥è¯¢çš„è®°å½•æ˜¯ã€Œä¸å­˜åœ¨ã€çš„ï¼Œåœ¨ç´ å¼•(æ ‘æ‰¾åˆ°ç¬¬ä¸€æ¡å¤§äºè¯¥æŸ¥è¯¢è®°å½•çš„è®°å½•åï¼Œå°†è¯¥è®°å½•çš„ç´¢å¼•ä¸­çš„<strong>next-key lock ä¼šé€€åŒ–æˆã€Œé—´éš™é”ã€ã€‚</strong></li></ul><h6 id="ç¬¬äºŒç§æƒ…å†µï¼šå¦‚æœæ›´æ–°æ¡ä»¶çš„å­—æ®µæ˜¯éå”¯ä¸€ç´¢å¼•ï¼ŒåŠ ä»€ä¹ˆé”ï¼Ÿ"><a href="#ç¬¬äºŒç§æƒ…å†µï¼šå¦‚æœæ›´æ–°æ¡ä»¶çš„å­—æ®µæ˜¯éå”¯ä¸€ç´¢å¼•ï¼ŒåŠ ä»€ä¹ˆé”ï¼Ÿ" class="headerlink" title="ç¬¬äºŒç§æƒ…å†µï¼šå¦‚æœæ›´æ–°æ¡ä»¶çš„å­—æ®µæ˜¯éå”¯ä¸€ç´¢å¼•ï¼ŒåŠ ä»€ä¹ˆé”ï¼Ÿ"></a>ç¬¬äºŒç§æƒ…å†µï¼šå¦‚æœæ›´æ–°æ¡ä»¶çš„å­—æ®µæ˜¯éå”¯ä¸€ç´¢å¼•ï¼ŒåŠ ä»€ä¹ˆé”ï¼Ÿ</h6><p>å³éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢</p><p>å½“æˆ‘ä»¬ç”¨éå”¯ä¸€ç´¢å¼•è¿›è¡Œç­‰å€¼æŸ¥è¯¢çš„æ—¶å€™ï¼Œå› ä¸ºå­˜åœ¨ä¸¤ä¸ªç´¢å¼•ï¼Œä¸€ä¸ªæ˜¯ä¸»é”®ç´¢å¼•ï¼Œä¸€ä¸ªæ˜¯éå”¯ä¸€ç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰ï¼Œæ‰€ä»¥åœ¨åŠ é”æ—¶ï¼ŒåŒæ—¶ä¼šå¯¹è¿™ä¸¤ä¸ªç´¢å¼•éƒ½åŠ é”ï¼Œä½†æ˜¯å¯¹ä¸»é”®ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œåªæœ‰æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•æ‰ä¼šå¯¹å®ƒä»¬çš„ä¸»é”®ç´¢å¼•åŠ é”ã€‚</p><p>é’ˆå¯¹éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢æ—¶ï¼ŒæŸ¥è¯¢çš„è®°å½•å­˜ä¸å­˜åœ¨ï¼ŒåŠ é”çš„è§„åˆ™ä¹Ÿä¼šä¸åŒï¼š</p><ul><li>å½“æŸ¥è¯¢çš„è®°å½•ã€Œå­˜åœ¨ã€æ—¶ï¼Œç”±äºä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥è‚¯å®šå­˜åœ¨ç´¢å¼•å€¼ç›¸åŒçš„è®°å½•ï¼Œäºæ˜¯<strong>éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªæ‰«æçš„è¿‡ç¨‹ï¼Œç›´åˆ°æ‰«æåˆ°ç¬¬ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•å°±åœæ­¢æ‰«æï¼Œç„¶ååœ¨æ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ‰«æåˆ°çš„äºŒçº§ç´¢å¼•è®°å½•åŠ çš„æ˜¯next-key é”ï¼Œè€Œå¯¹äºç¬¬ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œè¯¥äºŒçº§ç´ å¼•çš„ next-key é”ä¼šé€€åŒ–æˆé—´éš™é”ã€‚åŒæ—¶ï¼Œåœ¨ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„è®°å½•çš„ä¸»é”®ç´¢å¼•ä¸ŠåŠ è®°å½•é”ã€‚</strong></li><li>å½“æŸ¥è¯¢çš„è®°å½•ã€Œä¸å­˜åœ¨ã€æ—¶ï¼Œ<strong>æ‰«æåˆ°ç¬¬ä¸€æ¡ä¸ç¬¦åˆæ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œè¯¥äºŒçº§ç´¢å¼•çš„ next-key é”ä¼šé€€åŒ–æˆé—´éš™é”ã€‚å› ä¸ºä¸å­˜åœ¨æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•ï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ä¸»é”®ç´¢å¼•åŠ é”ã€‚</strong></li></ul><h6 id="ç¬¬ä¸‰ç§æƒ…å†µï¼šå¦‚æœæ›´æ–°æ¡ä»¶çš„å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼ŒåŠ ä»€ä¹ˆé”ï¼Ÿ"><a href="#ç¬¬ä¸‰ç§æƒ…å†µï¼šå¦‚æœæ›´æ–°æ¡ä»¶çš„å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼ŒåŠ ä»€ä¹ˆé”ï¼Ÿ" class="headerlink" title="ç¬¬ä¸‰ç§æƒ…å†µï¼šå¦‚æœæ›´æ–°æ¡ä»¶çš„å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼ŒåŠ ä»€ä¹ˆé”ï¼Ÿ"></a>ç¬¬ä¸‰ç§æƒ…å†µï¼šå¦‚æœæ›´æ–°æ¡ä»¶çš„å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼ŒåŠ ä»€ä¹ˆé”ï¼Ÿ</h6><p>å³æ²¡æœ‰åŠ ç´¢å¼•çš„æŸ¥è¯¢</p><p>å‰é¢çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬çš„æŸ¥è¯¢è¯­å‘éƒ½æœ‰ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯æŸ¥è¯¢è®°å½•çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡ç´¢å¼•æ‰«æçš„æ–¹å¼æŸ¥è¯¢çš„ï¼Œç„¶åå¯¹æ‰«æå‡ºæ¥çš„è®°å½•è¿›è¡ŒåŠ é”ã€‚</p><p><strong>å¦‚æœé”å®šè¯»æŸ¥è¯¢è¯­å¥ï¼Œæ²¡æœ‰ä½¿ç”¨ç´¢å¼•åˆ—ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œæˆ–è€…æŸ¥è¯¢è¯­å¥æ²¡æœ‰èµ°ç´¢å¼•æŸ¥è¯¢ï¼Œå¯¼è‡´æ‰«ææ˜¯å…¨è¡¨æ‰«æã€‚é‚£ä¹ˆï¼Œæ¯ä¸€æ¡è®°å½•çš„ç´¢å¼•ä¸Šéƒ½ä¼šåŠ  next-key é”ï¼Œè¿™æ ·å°±ç›¸å½“äºé”ä½çš„å…¨è¡¨ï¼Œè¿™æ—¶å¦‚æœå…¶ä»–äº‹åŠ¡å¯¹è¯¥è¡¨è¿›è¡Œå¢ã€åˆ ã€æ”¹æ“ä½œçš„æ—¶å€™ï¼Œéƒ½ä¼šè¢«é˜»å¡ã€‚</strong></p><h3 id="æ­»é”ï¼š"><a href="#æ­»é”ï¼š" class="headerlink" title="æ­»é”ï¼š"></a>æ­»é”ï¼š</h3><p>â€‹</p><h4 id="Insert-è¯­å¥æ˜¯æ€ä¹ˆåŠ è¡Œçº§é”çš„ï¼Ÿ"><a href="#Insert-è¯­å¥æ˜¯æ€ä¹ˆåŠ è¡Œçº§é”çš„ï¼Ÿ" class="headerlink" title="Insert è¯­å¥æ˜¯æ€ä¹ˆåŠ è¡Œçº§é”çš„ï¼Ÿ"></a>Insert è¯­å¥æ˜¯æ€ä¹ˆåŠ è¡Œçº§é”çš„ï¼Ÿ</h4><p>Insert è¯­å¥åœ¨æ­£å¸¸æ‰§è¡Œæ—¶æ˜¯ä¸ä¼šç”Ÿæˆé”ç»“æ„çš„ï¼Œå®ƒæ˜¯é èšç°‡ç´¢å¼•è®°å½•è‡ªå¸¦çš„ trx_id éšè—åˆ—æ¥ä½œä¸º<strong>éšå¼é”</strong>æ¥ä¿æŠ¤è®°å½•çš„ã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯éšå¼é”ï¼Ÿ</p></blockquote><p>å½“äº‹åŠ¡éœ€è¦åŠ é”çš„æ—¶ï¼Œ<u>å¦‚æœè¿™ä¸ªé”ä¸å¯èƒ½å‘ç”Ÿå†²çªï¼ŒInnoDBä¼šè·³è¿‡åŠ é”ç¯èŠ‚ï¼Œè¿™ç§æœºåˆ¶ç§°ä¸ºéšå¼é”</u>ã€‚éšå¼é”æ˜¯ InnoDB å®ç°çš„ä¸€ç§å»¶è¿ŸåŠ é”æœºåˆ¶ï¼Œå…¶ç‰¹ç‚¹æ˜¯åªæœ‰åœ¨å¯èƒ½å‘ç”Ÿå†²çªæ—¶æ‰åŠ é”ï¼Œä»è€Œå‡å°‘äº†é”çš„æ•°é‡ï¼Œæé«˜äº†ç³»ç»Ÿæ•´ä½“æ€§èƒ½ã€‚</p><p>éšå¼é”å°±æ˜¯åœ¨ Insert è¿‡ç¨‹ä¸­ä¸åŠ é”ï¼Œåªæœ‰åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ‰ä¼šå°†éšå¼é”è½¬æ¢ä¸ºæ˜¾ç¤ºé”ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ—ä¸¾ä¸¤ä¸ªåœºæ™¯ã€‚</p><ul><li>å¦‚æœè®°å½•ä¹‹é—´åŠ æœ‰é—´éš™é”ï¼Œä¸ºäº†é¿å…å¹»è¯»ï¼Œæ­¤æ—¶æ˜¯ä¸èƒ½æ’å…¥è®°å½•çš„ï¼›<ul><li>æ¯æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼Œéƒ½éœ€è¦çœ‹ä¸€ä¸‹å¾…æ’å…¥è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•ä¸Šæ˜¯å¦å·²ç»è¢«åŠ äº†é—´éš™é”ï¼Œå¦‚æœå·²åŠ é—´éš™é”ï¼Œæ­¤æ—¶ä¼šç”Ÿæˆä¸€ä¸ªæ’å…¥æ„å‘é”ï¼Œç„¶åé”çš„çŠ¶æ€è®¾ç½®ä¸ºç­‰å¾…çŠ¶æ€ï¼ˆ<em>PSï¼šMySQL åŠ é”æ—¶ï¼Œæ˜¯å…ˆç”Ÿæˆé”ç»“æ„ï¼Œç„¶åè®¾ç½®é”çš„çŠ¶æ€ï¼Œå¦‚æœé”çŠ¶æ€æ˜¯ç­‰å¾…çŠ¶æ€ï¼Œå¹¶ä¸æ˜¯æ„å‘³ç€äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”ï¼Œåªæœ‰å½“é”çŠ¶æ€ä¸ºæ­£å¸¸çŠ¶æ€æ—¶ï¼Œæ‰ä»£è¡¨äº‹åŠ¡æˆåŠŸè·å–åˆ°äº†é”</em>ï¼‰ï¼Œç°è±¡å°±æ˜¯ Insert è¯­å¥ä¼šè¢«é˜»å¡ã€‚</li></ul></li><li>å¦‚æœ Insert çš„è®°å½•å’Œå·²æœ‰è®°å½•å­˜åœ¨å”¯ä¸€é”®å†²çªï¼Œæ­¤æ—¶ä¹Ÿä¸èƒ½æ’å…¥è®°å½•ï¼›<ul><li>å¦‚æœåœ¨æ’å…¥æ–°è®°å½•æ—¶ï¼Œæ’å…¥äº†ä¸€ä¸ªä¸ã€Œå·²æœ‰çš„è®°å½•çš„ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—å€¼ç›¸åŒã€çš„è®°å½•ï¼ˆä¸è¿‡å¯ä»¥æœ‰å¤šæ¡è®°å½•çš„å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—çš„å€¼åŒæ—¶ä¸ºNULLï¼Œè¿™é‡Œä¸è€ƒè™‘è¿™ç§æƒ…å†µï¼‰ï¼Œæ­¤æ—¶æ’å…¥å°±ä¼šå¤±è´¥ï¼Œç„¶åå¯¹äºè¿™æ¡è®°å½•åŠ ä¸Šäº† <strong>S å‹çš„é”</strong>ã€‚<ul><li>å¦‚æœ<u>ä¸»é”®ç´¢å¼•é‡å¤</u>ï¼Œæ’å…¥æ–°è®°å½•çš„äº‹åŠ¡ä¼šç»™å·²å­˜åœ¨çš„ä¸»é”®å€¼é‡å¤çš„èšç°‡ç´¢å¼•è®°å½•<strong>æ·»åŠ  S å‹è®°å½•é”</strong>ã€‚</li><li>å¦‚æœ<u>å”¯ä¸€äºŒçº§ç´¢å¼•é‡å¤</u>ï¼Œæ’å…¥æ–°è®°å½•çš„äº‹åŠ¡éƒ½ä¼šç»™å·²å­˜åœ¨çš„äºŒçº§ç´¢å¼•åˆ—å€¼é‡å¤çš„äºŒçº§ç´¢å¼•è®°å½•<strong>æ·»åŠ  S å‹ next-key é”</strong>ã€‚</li></ul></li></ul></li></ul><h4 id="å¦‚ä½•é¿å…æ­»é”ï¼Ÿ"><a href="#å¦‚ä½•é¿å…æ­»é”ï¼Ÿ" class="headerlink" title="å¦‚ä½•é¿å…æ­»é”ï¼Ÿ"></a>å¦‚ä½•é¿å…æ­»é”ï¼Ÿ</h4><p>â€‹æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š<strong>äº’æ–¥ã€å æœ‰ä¸”ç­‰å¾…ã€ä¸å¯å¼ºå ç”¨ã€å¾ªç¯ç­‰å¾…</strong>ã€‚åªè¦ç³»ç»Ÿå‘ç”Ÿæ­»é”ï¼Œè¿™äº›æ¡ä»¶å¿…ç„¶æˆç«‹ï¼Œä½†æ˜¯åªè¦ç ´åä»»æ„ä¸€ä¸ªæ¡ä»¶å°±æ­»é”å°±ä¸ä¼šæˆç«‹ã€‚</p><p>åœ¨æ•°æ®åº“å±‚é¢ï¼Œæœ‰ä¸¤ç§ç­–ç•¥é€šè¿‡ã€Œæ‰“ç ´å¾ªç¯ç­‰å¾…æ¡ä»¶ã€æ¥è§£é™¤æ­»é”çŠ¶æ€ï¼š</p><ul><li><p><strong>è®¾ç½®äº‹åŠ¡ç­‰å¾…é”çš„è¶…æ—¶æ—¶é—´</strong>ã€‚å½“ä¸€ä¸ªäº‹åŠ¡çš„ç­‰å¾…æ—¶é—´è¶…è¿‡è¯¥å€¼åï¼Œå°±å¯¹è¿™ä¸ªäº‹åŠ¡è¿›è¡Œå›æ»šï¼Œäºæ˜¯é”å°±é‡Šæ”¾äº†ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡å°±å¯ä»¥ç»§ç»­æ‰§è¡Œäº†ã€‚åœ¨ InnoDB ä¸­ï¼Œå‚æ•° <code>innodb_lock_wait_timeout</code> æ˜¯ç”¨æ¥è®¾ç½®è¶…æ—¶æ—¶é—´çš„ï¼Œé»˜è®¤å€¼æ—¶ 50 ç§’ã€‚</p><p>å½“å‘ç”Ÿè¶…æ—¶åï¼Œå°±å‡ºç°ä¸‹é¢è¿™ä¸ªæç¤ºï¼š</p></li></ul><p><img src="https://cdn.xiaolincoding.com//mysql/other/c296c1889f0101d335699311b4ef20a8.png" alt="å›¾ç‰‡"></p><ul><li><p><strong>å¼€å¯ä¸»åŠ¨æ­»é”æ£€æµ‹</strong>ã€‚ä¸»åŠ¨æ­»é”æ£€æµ‹åœ¨å‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•° <code>innodb_deadlock_detect</code> è®¾ç½®ä¸º onï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ï¼Œé»˜è®¤å°±å¼€å¯ã€‚</p><p>å½“æ£€æµ‹åˆ°æ­»é”åï¼Œå°±ä¼šå‡ºç°ä¸‹é¢è¿™ä¸ªæç¤ºï¼š</p></li></ul><p><img src="https://cdn.xiaolincoding.com//mysql/other/f380ef357d065498d8d54ad07f145e09.png" alt="å›¾ç‰‡"></p><p>ä¸Šé¢è¿™ä¸ªä¸¤ç§ç­–ç•¥æ˜¯ã€Œå½“æœ‰æ­»é”å‘ç”Ÿæ—¶ã€çš„é¿å…æ–¹å¼ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å›å½’ä¸šåŠ¡çš„è§’åº¦æ¥é¢„é˜²æ­»é”ï¼Œå¯¹è®¢å•åšå¹‚ç­‰æ€§æ ¡éªŒçš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯ä¸ä¼šå‡ºç°é‡å¤çš„è®¢å•ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ç›´æ¥å°† order_no å­—æ®µè®¾ç½®ä¸ºå”¯ä¸€ç´¢å¼•åˆ—ï¼Œåˆ©ç”¨å®ƒçš„å”¯ä¸€æ€§æ¥ä¿è¯è®¢å•è¡¨ä¸ä¼šå‡ºç°é‡å¤çš„è®¢å•ï¼Œä¸è¿‡æœ‰ä¸€ç‚¹ä¸å¥½çš„åœ°æ–¹å°±æ˜¯åœ¨æˆ‘ä»¬æ’å…¥ä¸€ä¸ªå·²ç»å­˜åœ¨çš„è®¢å•è®°å½•æ—¶å°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><h4 id="ä¸€é“é¢è¯•é¢˜ï¼š"><a href="#ä¸€é“é¢è¯•é¢˜ï¼š" class="headerlink" title="ä¸€é“é¢è¯•é¢˜ï¼š"></a>ä¸€é“é¢è¯•é¢˜ï¼š</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230807154158632.png" alt="image-20230807154158632" style="zoom: 33%;" /><p>æŒ‰é¢˜ä¸­é¡ºåºæ‰§è¡Œï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><h5 id="Time1"><a href="#Time1" class="headerlink" title="Time1:"></a>Time1:</h5><p>â€‹**æ­¤æ—¶äº‹åŠ¡ A åœ¨ä¸»é”®ç´¢å¼•ï¼ˆINDEX_NAME : PRIMARYï¼‰ä¸ŠåŠ äº†é—´éš™é”ï¼Œé”èŒƒå›´æ˜¯<code>(20, 30)</code>**ã€‚</p><h5 id="Time2"><a href="#Time2" class="headerlink" title="Time2:"></a>Time2:</h5><p>â€‹**äº‹åŠ¡ B åœ¨ä¸»é”®ç´¢å¼•ï¼ˆINDEX_NAME : PRIMARYï¼‰ä¸ŠåŠ äº†é—´éš™é”ï¼Œé”èŒƒå›´æ˜¯<code>(20, 30)</code>**ã€‚</p><h5 id="Time3"><a href="#Time3" class="headerlink" title="Time3:"></a>Time3:</h5><p>â€‹äº‹åŠ¡ A çš„çŠ¶æ€ä¸ºç­‰å¾…çŠ¶æ€ï¼ˆLOCK_STATUS: WAITINGï¼‰ï¼Œå› ä¸ºå‘äº‹åŠ¡ B ç”Ÿæˆçš„é—´éš™é”ï¼ˆèŒƒå›´ <code>(20, 30)</code>ï¼‰ä¸­æ’å…¥äº†ä¸€æ¡è®°å½•ï¼Œ<u>æ‰€ä»¥äº‹åŠ¡ A çš„æ’å…¥æ“ä½œç”Ÿæˆäº†ä¸€ä¸ªæ’å…¥æ„å‘é”</u></p><p>â€‹<strong>å°½ç®¡ã€Œæ’å…¥æ„å‘é”ã€ä¹Ÿå±äºé—´éš™é”ï¼Œä½†ä¸¤ä¸ªäº‹åŠ¡å´ä¸èƒ½åœ¨åŒä¸€æ—¶é—´å†…ï¼Œä¸€ä¸ªæ‹¥æœ‰é—´éš™é”ï¼Œå¦ä¸€ä¸ªæ‹¥æœ‰è¯¥é—´éš™åŒºé—´å†…çš„æ’å…¥æ„å‘é”ï¼ˆå½“ç„¶ï¼Œæ’å…¥æ„å‘é”å¦‚æœä¸åœ¨é—´éš™é”åŒºé—´å†…åˆ™æ˜¯å¯ä»¥çš„ï¼‰ã€‚æ‰€ä»¥ï¼Œæ’å…¥æ„å‘é”å’Œé—´éš™é”ä¹‹é—´æ˜¯å†²çªçš„</strong>ã€‚</p><p><u><strong>å› æ­¤äº‹åŠ¡Aä¼šç­‰å¾…äº‹åŠ¡Båœ¨ä¸»é”®èŒƒå›´20~30ä¸Šçš„é—´éš™é”é‡Šæ”¾ï¼</strong></u></p><h5 id="Time4"><a href="#Time4" class="headerlink" title="Time4:"></a>Time4:</h5><p>â€‹äº‹åŠ¡Bä¼šç­‰å¾…äº‹åŠ¡Aåœ¨ä¸»é”®èŒƒå›´20~30ä¸Šçš„é—´éš™é”é‡Šæ”¾</p><p>â€‹</p><p>ğŸ“– äº‹åŠ¡ A å’Œäº‹åŠ¡ B åœ¨æ‰§è¡Œå®Œå update è¯­å¥åéƒ½æŒæœ‰èŒƒå›´ä¸º<code>(20, 30ï¼‰</code>çš„é—´éš™é”ï¼Œè€Œæ¥ä¸‹æ¥çš„æ’å…¥æ“ä½œä¸ºäº†è·å–åˆ°æ’å…¥æ„å‘é”ï¼Œéƒ½åœ¨ç­‰å¾…å¯¹æ–¹äº‹åŠ¡çš„é—´éš™é”é‡Šæ”¾ï¼Œäºæ˜¯å°±é€ æˆäº†å¾ªç¯ç­‰å¾…ï¼Œæ»¡è¶³äº†æ­»é”çš„å››ä¸ªæ¡ä»¶ï¼š<strong>äº’æ–¥ã€å æœ‰ä¸”ç­‰å¾…ã€ä¸å¯å¼ºå ç”¨ã€å¾ªç¯ç­‰å¾…</strong>ï¼Œå› æ­¤å‘ç”Ÿäº†æ­»é”ã€‚</p><h5 id="æ€»ç»“ğŸŒŸï¼š"><a href="#æ€»ç»“ğŸŒŸï¼š" class="headerlink" title="æ€»ç»“ğŸŒŸï¼š"></a>æ€»ç»“ğŸŒŸï¼š</h5><p>â€‹ä¸¤ä¸ªäº‹åŠ¡å³ä½¿ç”Ÿæˆçš„é—´éš™é”çš„èŒƒå›´æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿå†²çªï¼Œå› ä¸º<u>é—´éš™é”ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥æ•°æ®ï¼Œå› æ­¤é—´éš™é”ä¸é—´éš™é”ä¹‹é—´æ˜¯ç›¸äº’å…¼å®¹çš„ã€‚</u></p><p>â€‹<u><strong>åœ¨æ‰§è¡Œæ’å…¥è¯­å¥æ—¶ï¼Œå¦‚æœæ’å…¥çš„è®°å½•åœ¨å…¶ä»–äº‹åŠ¡æŒæœ‰é—´éš™é”èŒƒå›´å†…ï¼Œæ’å…¥è¯­å¥å°±ä¼šè¢«é˜»å¡ï¼Œå› ä¸ºæ’å…¥è¯­å¥åœ¨ç¢°åˆ°é—´éš™é”æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ’å…¥æ„å‘é”ï¼Œç„¶åæ’å…¥æ„å‘é”å’Œé—´éš™é”ä¹‹é—´æ˜¯äº’æ–¥çš„å…³ç³»ã€‚</strong></u></p><p>â€‹<u>å¦‚æœä¸¤ä¸ªäº‹åŠ¡åˆ†åˆ«å‘å¯¹æ–¹æŒæœ‰çš„é—´éš™é”èŒƒå›´å†…æ’å…¥ä¸€æ¡è®°å½•ï¼Œè€Œæ’å…¥æ“ä½œä¸ºäº†è·å–åˆ°æ’å…¥æ„å‘é”ï¼Œéƒ½åœ¨ç­‰å¾…å¯¹æ–¹äº‹åŠ¡çš„é—´éš™é”é‡Šæ”¾ï¼Œäºæ˜¯å°±é€ æˆäº†å¾ªç¯ç­‰å¾…ï¼Œæ»¡è¶³äº†æ­»é”çš„å››ä¸ªæ¡ä»¶ï¼š<strong>äº’æ–¥ã€å æœ‰ä¸”ç­‰å¾…ã€ä¸å¯å¼ºå ç”¨ã€å¾ªç¯ç­‰å¾…</strong>ï¼Œå› æ­¤å‘ç”Ÿäº†æ­»é”ã€‚</u></p><h4 id="å¦‚ä½•é¿å…æ­»é”"><a href="#å¦‚ä½•é¿å…æ­»é”" class="headerlink" title="å¦‚ä½•é¿å…æ­»é”"></a>å¦‚ä½•é¿å…æ­»é”</h4><p>åœ¨å·¥ä½œè¿‡ç¨‹ä¸­å¶å°”ä¼šé‡åˆ°æ­»é”é—®é¢˜ï¼Œè™½ç„¶è¿™ç§é—®é¢˜é‡åˆ°çš„æ¦‚ç‡ä¸å¤§ï¼Œä½†æ¯æ¬¡é‡åˆ°çš„æ—¶å€™è¦æƒ³å½»åº•å¼„æ‡‚å…¶åŸç†å¹¶æ‰¾åˆ°è§£å†³æ–¹æ¡ˆå´å¹¶ä¸å®¹æ˜“ã€‚å…¶å®ï¼Œå¯¹äº MySQL çš„ InnoDb å­˜å‚¨å¼•æ“æ¥è¯´ï¼Œæ­»é”é—®é¢˜æ˜¯é¿å…ä¸äº†çš„ï¼Œæ²¡æœ‰å“ªç§è§£å†³æ–¹æ¡ˆå¯ä»¥è¯´å®Œå…¨è§£å†³æ­»é”é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›å¯æ§çš„æ‰‹æ®µï¼Œé™ä½å‡ºç°æ­»é”çš„æ¦‚ç‡ã€‚</p><ol><li>å¯¹ç´¢å¼•åŠ é”é¡ºåºçš„ä¸ä¸€è‡´å¾ˆå¯èƒ½ä¼šå¯¼è‡´æ­»é”ï¼Œæ‰€ä»¥å¦‚æœå¯ä»¥ï¼Œå°½é‡ä»¥ç›¸åŒçš„é¡ºåºæ¥è®¿é—®ç´¢å¼•è®°å½•å’Œè¡¨ã€‚åœ¨ç¨‹åºä»¥æ‰¹é‡æ–¹å¼å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœäº‹å…ˆå¯¹æ•°æ®æ’åºï¼Œä¿è¯æ¯ä¸ªçº¿ç¨‹æŒ‰å›ºå®šçš„é¡ºåºæ¥å¤„ç†è®°å½•ï¼Œä¹Ÿå¯ä»¥å¤§å¤§é™ä½å‡ºç°æ­»é”çš„å¯èƒ½ï¼›</li><li>Gap é”å¾€å¾€æ˜¯ç¨‹åºä¸­å¯¼è‡´æ­»é”çš„çœŸå‡¶ï¼Œç”±äºé»˜è®¤æƒ…å†µä¸‹ MySQL çš„éš”ç¦»çº§åˆ«æ˜¯ RRï¼Œæ‰€ä»¥å¦‚æœèƒ½ç¡®å®šå¹»è¯»å’Œä¸å¯é‡å¤è¯»å¯¹åº”ç”¨çš„å½±å“ä¸å¤§ï¼Œå¯ä»¥è€ƒè™‘å°†éš”ç¦»çº§åˆ«æ”¹æˆ RCï¼Œå¯ä»¥é¿å… Gap é”å¯¼è‡´çš„æ­»é”ï¼›</li><li>ä¸ºè¡¨æ·»åŠ åˆç†çš„ç´¢å¼•ï¼Œå¦‚æœä¸èµ°ç´¢å¼•å°†ä¼šä¸ºè¡¨çš„æ¯ä¸€è¡Œè®°å½•åŠ é”ï¼Œæ­»é”çš„æ¦‚ç‡å°±ä¼šå¤§å¤§å¢å¤§ï¼›</li><li>æˆ‘ä»¬çŸ¥é“ MyISAM åªæ”¯æŒè¡¨é”ï¼Œå®ƒé‡‡ç”¨ä¸€æ¬¡å°é”æŠ€æœ¯æ¥ä¿è¯äº‹åŠ¡ä¹‹é—´ä¸ä¼šå‘ç”Ÿæ­»é”ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨åŒæ ·çš„æ€æƒ³ï¼Œåœ¨äº‹åŠ¡ä¸­ä¸€æ¬¡é”å®šæ‰€éœ€è¦çš„æ‰€æœ‰èµ„æºï¼Œå‡å°‘æ­»é”æ¦‚ç‡ï¼›</li><li>é¿å…å¤§äº‹åŠ¡ï¼Œå°½é‡å°†å¤§äº‹åŠ¡æ‹†æˆå¤šä¸ªå°äº‹åŠ¡æ¥å¤„ç†ï¼›å› ä¸ºå¤§äº‹åŠ¡å ç”¨èµ„æºå¤šï¼Œè€—æ—¶é•¿ï¼Œä¸å…¶ä»–äº‹åŠ¡å†²çªçš„æ¦‚ç‡ä¹Ÿä¼šå˜é«˜ï¼›</li><li>é¿å…åœ¨åŒä¸€æ—¶é—´ç‚¹è¿è¡Œå¤šä¸ªå¯¹åŒä¸€è¡¨è¿›è¡Œè¯»å†™çš„è„šæœ¬ï¼Œç‰¹åˆ«æ³¨æ„åŠ é”ä¸”æ“ä½œæ•°æ®é‡æ¯”è¾ƒå¤§çš„è¯­å¥ï¼›æˆ‘ä»¬ç»å¸¸ä¼šæœ‰ä¸€äº›å®šæ—¶è„šæœ¬ï¼Œé¿å…å®ƒä»¬åœ¨åŒä¸€æ—¶é—´ç‚¹è¿è¡Œï¼›</li><li>è®¾ç½®é”ç­‰å¾…è¶…æ—¶å‚æ•°ï¼š<code>innodb_lock_wait_timeout</code>ï¼Œè¿™ä¸ªå‚æ•°å¹¶ä¸æ˜¯åªç”¨æ¥è§£å†³æ­»é”é—®é¢˜ï¼Œåœ¨å¹¶å‘è®¿é—®æ¯”è¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå¤§é‡äº‹åŠ¡å› æ— æ³•ç«‹å³è·å¾—æ‰€éœ€çš„é”è€ŒæŒ‚èµ·ï¼Œä¼šå ç”¨å¤§é‡è®¡ç®—æœºèµ„æºï¼Œé€ æˆä¸¥é‡æ€§èƒ½é—®é¢˜ï¼Œç”šè‡³æ‹–è·¨æ•°æ®åº“ã€‚æˆ‘ä»¬é€šè¿‡è®¾ç½®åˆé€‚çš„é”ç­‰å¾…è¶…æ—¶é˜ˆå€¼ï¼Œå¯ä»¥é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿã€‚</li></ol><h3 id="æ‚²è§‚é”ä¸ä¹è§‚é”ï¼š"><a href="#æ‚²è§‚é”ä¸ä¹è§‚é”ï¼š" class="headerlink" title="æ‚²è§‚é”ä¸ä¹è§‚é”ï¼š"></a>æ‚²è§‚é”ä¸ä¹è§‚é”ï¼š</h3><h4 id="æ‚²è§‚é”ï¼š"><a href="#æ‚²è§‚é”ï¼š" class="headerlink" title="æ‚²è§‚é”ï¼š"></a>æ‚²è§‚é”ï¼š</h4><p><strong>æ‚²è§‚é”ï¼ˆPessimistic Lockï¼‰ï¼š</strong> å°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ã€‚æ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ã€‚è¿™æ ·åˆ«äººæƒ³æ‹¿æ•°æ®å°±è¢«æŒ¡ä½ï¼Œç›´åˆ°æ‚²è§‚é”è¢«é‡Šæ”¾ï¼Œ<strong>æ‚²è§‚é”ä¸­çš„å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹</strong></p><p>ä½†æ˜¯åœ¨æ•ˆç‡æ–¹é¢ï¼Œå¤„ç†åŠ é”çš„æœºåˆ¶ä¼šäº§ç”Ÿé¢å¤–çš„å¼€é”€ï¼Œè¿˜æœ‰å¢åŠ äº§ç”Ÿæ­»é”çš„æœºä¼šã€‚å¦å¤–è¿˜ä¼šé™ä½å¹¶è¡Œæ€§ï¼Œå¦‚æœå·²ç»é”å®šäº†ä¸€ä¸ªçº¿ç¨‹ Aï¼Œå…¶ä»–çº¿ç¨‹å°±å¿…é¡»ç­‰å¾…è¯¥çº¿ç¨‹ A å¤„ç†å®Œæ‰å¯ä»¥å¤„ç†</p><p>æ•°æ®åº“ä¸­çš„è¡Œé”ï¼Œè¡¨é”ï¼Œè¯»é”ï¼ˆå…±äº«é”ï¼‰ï¼Œå†™é”ï¼ˆæ’ä»–é”ï¼‰ï¼Œä»¥åŠ <strong>syncronized</strong> å®ç°çš„é”å‡ä¸ºæ‚²è§‚é”</p><p>æ‚²è§‚å¹¶å‘æ§åˆ¶å®é™…ä¸Šæ˜¯â€œ<strong>å…ˆå–é”å†è®¿é—®</strong>â€çš„ä¿å®ˆç­–ç•¥ï¼Œä¸ºæ•°æ®å¤„ç†çš„å®‰å…¨æä¾›äº†ä¿è¯</p><h4 id="ä¹è§‚é”ï¼š"><a href="#ä¹è§‚é”ï¼š" class="headerlink" title="ä¹è§‚é”ï¼š"></a>ä¹è§‚é”ï¼š</h4><p><strong>ä¹è§‚é”ï¼ˆOptimistic Lockï¼‰ï¼š</strong> å°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ã€‚æ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œ<u>ä½†æ˜¯å¦‚æœæƒ³è¦æ›´æ–°æ•°æ®ï¼Œåˆ™ä¼šåœ¨æ›´æ–°å‰æ£€æŸ¥åœ¨è¯»å–è‡³æ›´æ–°è¿™æ®µæ—¶é—´åˆ«äººæœ‰æ²¡æœ‰ä¿®æ”¹è¿‡è¿™ä¸ªæ•°æ®ã€‚å¦‚æœä¿®æ”¹è¿‡ï¼Œåˆ™é‡æ–°è¯»å–ï¼Œå†æ¬¡å°è¯•æ›´æ–°ï¼Œå¾ªç¯ä¸Šè¿°æ­¥éª¤ç›´åˆ°æ›´æ–°æˆåŠŸï¼ˆå½“ç„¶ä¹Ÿå…è®¸æ›´æ–°å¤±è´¥çš„çº¿ç¨‹æ”¾å¼ƒæ“ä½œï¼‰,<strong>ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡</strong></u></p><p>ç›¸å¯¹äºæ‚²è§‚é”ï¼Œåœ¨å¯¹æ•°æ®åº“è¿›è¡Œå¤„ç†çš„æ—¶å€™ï¼Œä¹è§‚é”<u>å¹¶ä¸ä¼šä½¿ç”¨æ•°æ®åº“æä¾›çš„é”æœºåˆ¶</u>ã€‚<u><strong>ä¸€èˆ¬çš„å®ç°ä¹è§‚é”çš„æ–¹å¼å°±æ˜¯è®°å½•æ•°æ®ç‰ˆæœ¬ï¼ˆversionï¼‰æˆ–è€…æ˜¯æ—¶é—´æˆ³æ¥å®ç°ï¼Œä¸è¿‡ä½¿ç”¨ç‰ˆæœ¬è®°å½•æ˜¯æœ€å¸¸ç”¨çš„ã€‚</strong></u></p><p>â€”-&gt;ä¸ºæ•°æ®æ·»åŠ ä¸€åˆ—versionï¼Œç”¨äºversionç®¡ç†</p><h2 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h2><h3 id="MySQL-æ—¥å¿—ï¼šundo-logã€redo-logã€binlog-æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"><a href="#MySQL-æ—¥å¿—ï¼šundo-logã€redo-logã€binlog-æœ‰ä»€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="MySQL æ—¥å¿—ï¼šundo logã€redo logã€binlog æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"></a>MySQL æ—¥å¿—ï¼šundo logã€redo logã€binlog æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h3><ul><li><strong>undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰</strong>ï¼šæ˜¯ Innodb å­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡ä¸­çš„<strong>åŸå­æ€§</strong>ï¼Œä¸»è¦<strong>ç”¨äºäº‹åŠ¡å›æ»šå’Œ MVCC</strong>ã€‚</li><li><strong>redo logï¼ˆé‡åšæ—¥å¿—ï¼‰</strong>ï¼šæ˜¯ Innodb å­˜å‚¨å¼•æ“å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œå®ç°äº†äº‹åŠ¡ä¸­çš„<strong>æŒä¹…æ€§</strong>ï¼Œä¸»è¦<strong>ç”¨äºæ‰ç”µç­‰æ•…éšœæ¢å¤</strong>ï¼›</li><li><strong>binlog ï¼ˆå½’æ¡£æ—¥å¿—ï¼‰</strong>ï¼šæ˜¯ Server å±‚ç”Ÿæˆçš„æ—¥å¿—ï¼Œä¸»è¦<strong>ç”¨äºæ•°æ®å¤‡ä»½å’Œä¸»ä»å¤åˆ¶</strong>ï¼›</li></ul><h4 id="ä¸ºä»€ä¹ˆéœ€è¦-undo-logï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-undo-logï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ undo logï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ undo logï¼Ÿ</h4><p>å¦‚æœæˆ‘ä»¬æ¯æ¬¡åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéƒ½è®°å½•ä¸‹å›æ»šæ—¶éœ€è¦çš„ä¿¡æ¯åˆ°ä¸€ä¸ªæ—¥å¿—é‡Œï¼Œé‚£ä¹ˆåœ¨äº‹åŠ¡æ‰§è¡Œä¸­é€”å‘ç”Ÿäº† MySQL å´©æºƒåï¼Œå°±ä¸ç”¨æ‹…å¿ƒæ— æ³•å›æ»šåˆ°äº‹åŠ¡ä¹‹å‰çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ—¥å¿—å›æ»šåˆ°äº‹åŠ¡ä¹‹å‰çš„æ•°æ®ã€‚</p><p>å®ç°è¿™ä¸€æœºåˆ¶å°±æ˜¯ <strong>undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰ï¼Œå®ƒä¿è¯äº†äº‹åŠ¡çš„ <a href="https://xiaolincoding.com/mysql/transaction/mvcc.html#%E4%BA%8B%E5%8A%A1%E6%9C%89%E5%93%AA%E4%BA%9B%E7%89%B9%E6%80%A7">ACID ç‰¹æ€§ (opens new window)</a>ä¸­çš„åŸå­æ€§ï¼ˆAtomicityï¼‰</strong>ã€‚</p><p>undo log æ˜¯ä¸€ç§ç”¨äºæ’¤é”€å›é€€çš„æ—¥å¿—ã€‚åœ¨äº‹åŠ¡æ²¡æäº¤ä¹‹å‰ï¼ŒMySQL ä¼šå…ˆè®°å½•æ›´æ–°å‰çš„æ•°æ®åˆ° undo log æ—¥å¿—æ–‡ä»¶é‡Œé¢ï¼Œå½“äº‹åŠ¡å›æ»šæ—¶ï¼Œå¯ä»¥åˆ©ç”¨ undo log æ¥è¿›è¡Œå›æ»šã€‚</p><p><u><strong>ä¸€æ¡è®°å½•çš„æ¯ä¸€æ¬¡æ›´æ–°æ“ä½œäº§ç”Ÿçš„ undo log æ ¼å¼éƒ½æœ‰ä¸€ä¸ª roll_pointer æŒ‡é’ˆå’Œä¸€ä¸ª trx_id äº‹åŠ¡idï¼š</strong></u></p><ul><li>é€šè¿‡ trx_id å¯ä»¥çŸ¥é“è¯¥è®°å½•æ˜¯è¢«å“ªä¸ªäº‹åŠ¡ä¿®æ”¹çš„ï¼›</li><li>é€šè¿‡ roll_pointer æŒ‡é’ˆå¯ä»¥å°†è¿™äº› undo log ä¸²æˆä¸€ä¸ªé“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨å°±è¢«ç§°ä¸ºç‰ˆæœ¬é“¾ï¼›</li></ul><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230808100304687.png" alt="image-20230808100304687" style="zoom:50%;" /><h5 id="ğŸŒŸundo-log-ä¸¤å¤§ä½œç”¨ï¼š"><a href="#ğŸŒŸundo-log-ä¸¤å¤§ä½œç”¨ï¼š" class="headerlink" title="ğŸŒŸundo log ä¸¤å¤§ä½œç”¨ï¼š"></a>ğŸŒŸundo log ä¸¤å¤§ä½œç”¨ï¼š</h5><ul><li><strong>å®ç°äº‹åŠ¡å›æ»šï¼Œä¿éšœäº‹åŠ¡çš„åŸå­æ€§</strong>ã€‚äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‡ºç°äº†é”™è¯¯æˆ–è€…ç”¨æˆ·æ‰§ è¡Œäº† ROLLBACK è¯­å¥ï¼ŒMySQL å¯ä»¥åˆ©ç”¨ undo log ä¸­çš„å†å²æ•°æ®å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚</li><li><strong>å®ç° MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰å…³é”®å› ç´ ä¹‹ä¸€</strong>ã€‚MVCC æ˜¯é€šè¿‡ ReadView + undo log å®ç°çš„ã€‚undo log ä¸ºæ¯æ¡è®°å½•ä¿å­˜å¤šä»½å†å²æ•°æ®ï¼ŒMySQL åœ¨æ‰§è¡Œå¿«ç…§è¯»ï¼ˆæ™®é€š select è¯­å¥ï¼‰çš„æ—¶å€™ï¼Œä¼šæ ¹æ®äº‹åŠ¡çš„ Read View é‡Œçš„ä¿¡æ¯ï¼Œé¡ºç€ undo log çš„ç‰ˆæœ¬é“¾æ‰¾åˆ°æ»¡è¶³å…¶å¯è§æ€§çš„è®°å½•ã€‚</li></ul><h4 id="ä¸ºä»€ä¹ˆéœ€è¦-Buffer-Poolï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-Buffer-Poolï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ Buffer Poolï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ Buffer Poolï¼Ÿ</h4><p>â€‹Innodb å­˜å‚¨å¼•æ“è®¾è®¡äº†ä¸€ä¸ª<strong>ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰</strong>ï¼Œæ¥æé«˜æ•°æ®åº“çš„è¯»å†™æ€§èƒ½ã€‚</p><p>â€‹æœ‰äº† Buffer Pool åï¼š</p><ul><li>å½“è¯»å–æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å­˜åœ¨äº Buffer Pool ä¸­ï¼Œå®¢æˆ·ç«¯å°±ä¼šç›´æ¥è¯»å– Buffer Pool ä¸­çš„æ•°æ®ï¼Œå¦åˆ™å†å»ç£ç›˜ä¸­è¯»å–ã€‚</li><li>å½“ä¿®æ”¹æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å­˜åœ¨äº Buffer Pool ä¸­ï¼Œé‚£ç›´æ¥ä¿®æ”¹ Buffer Pool ä¸­æ•°æ®æ‰€åœ¨çš„é¡µï¼Œç„¶åå°†å…¶é¡µè®¾ç½®ä¸ºè„é¡µï¼ˆè¯¥é¡µçš„å†…å­˜æ•°æ®å’Œç£ç›˜ä¸Šçš„æ•°æ®å·²ç»ä¸ä¸€è‡´ï¼‰ï¼Œä¸ºäº†å‡å°‘ç£ç›˜I&#x2F;Oï¼Œä¸ä¼šç«‹å³å°†è„é¡µå†™å…¥ç£ç›˜ï¼Œåç»­ç”±åå°çº¿ç¨‹é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æ—¶æœºå°†è„é¡µå†™å…¥åˆ°ç£ç›˜ã€‚</li></ul><p>Buffer Poolä¸­è¿˜æœ‰Undoé¡µï¼Œç”¨äºè®°å½•undo logï¼š</p><p>â€‹å¼€å¯äº‹åŠ¡åï¼ŒInnoDB å±‚æ›´æ–°è®°å½•å‰ï¼Œé¦–å…ˆè¦è®°å½•ç›¸åº”çš„ undo logï¼Œå¦‚æœæ˜¯æ›´æ–°æ“ä½œï¼Œéœ€è¦æŠŠè¢«æ›´æ–°çš„åˆ—çš„æ—§å€¼è®°ä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯è¦ç”Ÿæˆä¸€æ¡ undo logï¼Œundo log ä¼šå†™å…¥ Buffer Pool ä¸­çš„ Undo é¡µé¢ã€‚</p><h4 id="ä¸ºä»€ä¹ˆéœ€è¦-redo-log-ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-redo-log-ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ redo log ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ redo log ï¼Ÿ</h4><p>â€‹Buffer Pool æ˜¯æé«˜äº†è¯»å†™æ•ˆç‡æ²¡é”™ï¼Œä½†æ˜¯é—®é¢˜æ¥äº†ï¼ŒBuffer Pool æ˜¯åŸºäºå†…å­˜çš„ï¼Œè€Œå†…å­˜æ€»æ˜¯ä¸å¯é ï¼Œä¸‡ä¸€æ–­ç”µé‡å¯ï¼Œè¿˜æ²¡æ¥å¾—åŠè½ç›˜çš„è„é¡µæ•°æ®å°±ä¼šä¸¢å¤±ã€‚</p><p>ä¸ºäº†é˜²æ­¢æ–­ç”µå¯¼è‡´æ•°æ®ä¸¢å¤±çš„é—®é¢˜ï¼Œå½“æœ‰ä¸€æ¡è®°å½•éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼ŒInnoDB å¼•æ“å°±ä¼šå…ˆæ›´æ–°å†…å­˜ï¼ˆåŒæ—¶æ ‡è®°ä¸ºè„é¡µï¼‰ï¼Œç„¶åå°†æœ¬æ¬¡å¯¹è¿™ä¸ªé¡µçš„ä¿®æ”¹ä»¥ redo log çš„å½¢å¼è®°å½•ä¸‹æ¥ï¼Œ<strong>è¿™ä¸ªæ—¶å€™æ›´æ–°å°±ç®—å®Œæˆäº†</strong>ã€‚</p><p>åç»­ï¼ŒInnoDB å¼•æ“ä¼šåœ¨é€‚å½“çš„æ—¶å€™ï¼Œç”±åå°çº¿ç¨‹å°†ç¼“å­˜åœ¨ Buffer Pool çš„è„é¡µåˆ·æ–°åˆ°ç£ç›˜é‡Œï¼Œè¿™å°±æ˜¯ <strong>WAL ï¼ˆWrite-Ahead Loggingï¼‰æŠ€æœ¯</strong>ã€‚</p><p><strong>WAL æŠ€æœ¯æŒ‡çš„æ˜¯ï¼Œ MySQL çš„å†™æ“ä½œå¹¶ä¸æ˜¯ç«‹åˆ»å†™åˆ°ç£ç›˜ä¸Šï¼Œè€Œæ˜¯å…ˆå†™æ—¥å¿—ï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶é—´å†å†™åˆ°ç£ç›˜ä¸Š</strong>ã€‚</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230808101725828.png" alt="image-20230808101725828" style="zoom: 45%;" /><p>redo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•äº†æŸä¸ªæ•°æ®é¡µåšäº†ä»€ä¹ˆä¿®æ”¹ï¼Œæ¯”å¦‚<strong>å¯¹ XXX è¡¨ç©ºé—´ä¸­çš„ YYY æ•°æ®é¡µ ZZZ åç§»é‡çš„åœ°æ–¹åšäº†AAA æ›´æ–°</strong>ï¼Œæ¯å½“æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡å°±ä¼šäº§ç”Ÿè¿™æ ·çš„ä¸€æ¡æˆ–è€…å¤šæ¡ç‰©ç†æ—¥å¿—ã€‚</p><p>åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œåªè¦å…ˆå°† redo log æŒä¹…åŒ–åˆ°ç£ç›˜å³å¯ï¼Œå¯ä»¥ä¸éœ€è¦ç­‰åˆ°å°†ç¼“å­˜åœ¨ Buffer Pool é‡Œçš„è„é¡µæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</p><p>å½“ç³»ç»Ÿå´©æºƒæ—¶ï¼Œè™½ç„¶è„é¡µæ•°æ®æ²¡æœ‰æŒä¹…åŒ–ï¼Œä½†æ˜¯ redo log å·²ç»æŒä¹…åŒ–ï¼Œæ¥ç€ MySQL é‡å¯åï¼Œå¯ä»¥æ ¹æ® redo log çš„å†…å®¹ï¼Œå°†æ‰€æœ‰æ•°æ®æ¢å¤åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚</p><ul><li>redo log è®°å½•äº†æ­¤æ¬¡äº‹åŠ¡ã€Œ<strong>å®Œæˆå</strong>ã€çš„æ•°æ®çŠ¶æ€ï¼Œè®°å½•çš„æ˜¯æ›´æ–°<strong>ä¹‹å</strong>çš„å€¼ï¼›</li><li>undo log è®°å½•äº†æ­¤æ¬¡äº‹åŠ¡ã€Œ<strong>å¼€å§‹å‰</strong>ã€çš„æ•°æ®çŠ¶æ€ï¼Œè®°å½•çš„æ˜¯æ›´æ–°<strong>ä¹‹å‰</strong>çš„å€¼ï¼›</li></ul><p>âš ï¸<u><strong>äº‹åŠ¡æäº¤ä¹‹å‰å‘ç”Ÿäº†å´©æºƒï¼Œé‡å¯åä¼šé€šè¿‡ undo log å›æ»šäº‹åŠ¡ï¼Œäº‹åŠ¡æäº¤ä¹‹åå‘ç”Ÿäº†å´©æºƒï¼Œé‡å¯åä¼šé€šè¿‡ redo log æ¢å¤äº‹åŠ¡</strong></u></p><h5 id="redo-log-è¦å†™åˆ°ç£ç›˜ï¼Œæ•°æ®ä¹Ÿè¦å†™ç£ç›˜ï¼Œä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ"><a href="#redo-log-è¦å†™åˆ°ç£ç›˜ï¼Œæ•°æ®ä¹Ÿè¦å†™ç£ç›˜ï¼Œä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ" class="headerlink" title="redo log è¦å†™åˆ°ç£ç›˜ï¼Œæ•°æ®ä¹Ÿè¦å†™ç£ç›˜ï¼Œä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ"></a>redo log è¦å†™åˆ°ç£ç›˜ï¼Œæ•°æ®ä¹Ÿè¦å†™ç£ç›˜ï¼Œä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ</h5><p>å†™å…¥ redo log çš„æ–¹å¼ä½¿ç”¨äº†è¿½åŠ æ“ä½œï¼Œ æ‰€ä»¥ç£ç›˜æ“ä½œæ˜¯<strong>é¡ºåºå†™</strong>ï¼Œè€Œå†™å…¥æ•°æ®éœ€è¦å…ˆæ‰¾åˆ°å†™å…¥ä½ç½®ï¼Œç„¶åæ‰å†™åˆ°ç£ç›˜ï¼Œæ‰€ä»¥ç£ç›˜æ“ä½œæ˜¯<strong>éšæœºå†™</strong>ã€‚</p><p>ç£ç›˜çš„ã€Œé¡ºåºå†™ ã€æ¯”ã€Œéšæœºå†™ã€ é«˜æ•ˆçš„å¤šï¼Œå› æ­¤ redo log å†™å…¥ç£ç›˜çš„å¼€é”€æ›´å°ã€‚</p><p>å¯ä»¥è¯´è¿™æ˜¯ WAL æŠ€æœ¯çš„å¦å¤–ä¸€ä¸ªä¼˜ç‚¹ï¼š<strong>MySQL çš„å†™æ“ä½œä»ç£ç›˜çš„ã€Œéšæœºå†™ã€å˜æˆäº†ã€Œé¡ºåºå†™ã€</strong>ï¼Œæå‡è¯­å¥çš„æ‰§è¡Œæ€§èƒ½ã€‚è¿™æ˜¯å› ä¸º MySQL çš„å†™æ“ä½œå¹¶ä¸æ˜¯ç«‹åˆ»æ›´æ–°åˆ°ç£ç›˜ä¸Šï¼Œè€Œæ˜¯å…ˆè®°å½•åœ¨æ—¥å¿—ä¸Šï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶é—´å†æ›´æ–°åˆ°ç£ç›˜ä¸Š ã€‚</p><p>âš ï¸è‡³æ­¤ï¼Œ é’ˆå¯¹ä¸ºä»€ä¹ˆéœ€è¦ redo log è¿™ä¸ªé—®é¢˜æˆ‘ä»¬æœ‰ä¸¤ä¸ªç­”æ¡ˆï¼š</p><ul><li><strong>å®ç°äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œè®© MySQL æœ‰ crash-safe çš„èƒ½åŠ›</strong>ï¼Œèƒ½å¤Ÿä¿è¯ MySQL åœ¨ä»»ä½•æ—¶é—´æ®µçªç„¶å´©æºƒï¼Œé‡å¯åä¹‹å‰å·²æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±ï¼›</li><li><strong>å°†å†™æ“ä½œä»ã€Œéšæœºå†™ã€å˜æˆäº†ã€Œé¡ºåºå†™ã€</strong>ï¼Œæå‡ MySQL å†™å…¥ç£ç›˜çš„æ€§èƒ½ã€‚</li></ul><h5 id="redo-logç›´æ¥å†™å…¥ç£ç›˜å—ï¼Ÿ"><a href="#redo-logç›´æ¥å†™å…¥ç£ç›˜å—ï¼Ÿ" class="headerlink" title="redo logç›´æ¥å†™å…¥ç£ç›˜å—ï¼Ÿ"></a>redo logç›´æ¥å†™å…¥ç£ç›˜å—ï¼Ÿ</h5><p>redo log ä¹Ÿä¼šå…ˆè¢«ä¿å­˜åœ¨å†…å­˜ä¸­çš„<strong>redo log buffer</strong>ä¸­ï¼Œä¸€å®šæ—¶æœºä¸‹å­˜å…¥ç£ç›˜â€”â€”å› ä¸ºå¦‚æœæ¯æ¡redo logéƒ½ç«‹å³å­˜å…¥ç£ç›˜ä¼šå¢åŠ I&#x2F;Oå¼€é”€ï¼Œå¤§å¤§é™ä½æ€§èƒ½ã€‚</p><h5 id="redo-log-bufferä½•æ—¶å†™å…¥ç£ç›˜ï¼š"><a href="#redo-log-bufferä½•æ—¶å†™å…¥ç£ç›˜ï¼š" class="headerlink" title="redo log bufferä½•æ—¶å†™å…¥ç£ç›˜ï¼š"></a>redo log bufferä½•æ—¶å†™å…¥ç£ç›˜ï¼š</h5><ul><li>MySQL æ­£å¸¸å…³é—­æ—¶ï¼›</li><li>å½“ redo log buffer ä¸­è®°å½•çš„å†™å…¥é‡å¤§äº redo log buffer å†…å­˜ç©ºé—´çš„ä¸€åŠæ—¶ï¼Œä¼šè§¦å‘è½ç›˜ï¼›</li><li>InnoDB çš„åå°çº¿ç¨‹æ¯éš” 1 ç§’ï¼Œå°† redo log buffer æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</li><li>æ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°†ç¼“å­˜åœ¨ redo log buffer é‡Œçš„ redo log ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼ˆè¿™ä¸ªç­–ç•¥å¯ç”± innodb_flush_log_at_trx_commit å‚æ•°æ§åˆ¶ï¼Œåˆ«çš„å‚æ•°ä»£è¡¨åˆ«çš„æ–¹æ¡ˆï¼‰</li></ul><h5 id="redo-log-æ–‡ä»¶å†™æ»¡äº†æ€ä¹ˆåŠï¼Ÿ"><a href="#redo-log-æ–‡ä»¶å†™æ»¡äº†æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="redo log æ–‡ä»¶å†™æ»¡äº†æ€ä¹ˆåŠï¼Ÿ"></a>redo log æ–‡ä»¶å†™æ»¡äº†æ€ä¹ˆåŠï¼Ÿ</h5><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ InnoDB å­˜å‚¨å¼•æ“æœ‰ 1 ä¸ªé‡åšæ—¥å¿—æ–‡ä»¶ç»„( redo log Groupï¼‰ï¼Œã€Œé‡åšæ—¥å¿—æ–‡ä»¶ç»„ã€ç”±æœ‰ 2 ä¸ª redo log æ–‡ä»¶ç»„æˆï¼Œè¿™ä¸¤ä¸ª redo æ—¥å¿—çš„æ–‡ä»¶åå« ï¼š<code>ib_logfile0</code> å’Œ <code>ib_logfile1</code> ã€‚</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/how_update/%E9%87%8D%E5%81%9A%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%BB%84.drawio.png" alt="é‡åšæ—¥å¿—æ–‡ä»¶ç»„"></p><p>åœ¨é‡åšæ—¥å¿—ç»„ä¸­ï¼Œæ¯ä¸ª redo log File çš„å¤§å°æ˜¯å›ºå®šä¸”ä¸€è‡´çš„ï¼Œå‡è®¾æ¯ä¸ª redo log File è®¾ç½®çš„ä¸Šé™æ˜¯ 1 GBï¼Œé‚£ä¹ˆæ€»å…±å°±å¯ä»¥è®°å½• 2GB çš„æ“ä½œã€‚</p><p>é‡åšæ—¥å¿—æ–‡ä»¶ç»„æ˜¯ä»¥<strong>å¾ªç¯å†™</strong>çš„æ–¹å¼å·¥ä½œçš„ï¼Œä»å¤´å¼€å§‹å†™ï¼Œå†™åˆ°æœ«å°¾å°±åˆå›åˆ°å¼€å¤´ï¼Œç›¸å½“äºä¸€ä¸ªç¯å½¢ã€‚</p><p>æ‰€ä»¥ InnoDB å­˜å‚¨å¼•æ“ä¼šå…ˆå†™ ib_logfile0 æ–‡ä»¶ï¼Œå½“ ib_logfile0 æ–‡ä»¶è¢«å†™æ»¡çš„æ—¶å€™ï¼Œä¼šåˆ‡æ¢è‡³ ib_logfile1 æ–‡ä»¶ï¼Œå½“ ib_logfile1 æ–‡ä»¶ä¹Ÿè¢«å†™æ»¡æ—¶ï¼Œä¼šåˆ‡æ¢å› ib_logfile0 æ–‡ä»¶ã€‚</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/how_update/%E9%87%8D%E5%81%9A%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%BB%84%E5%86%99%E5%85%A5%E8%BF%87%E7%A8%8B.drawio.png" alt="é‡åšæ—¥å¿—æ–‡ä»¶ç»„å†™å…¥è¿‡ç¨‹"></p><p>æˆ‘ä»¬çŸ¥é“ redo log æ˜¯ä¸ºäº†é˜²æ­¢ Buffer Pool ä¸­çš„è„é¡µä¸¢å¤±è€Œè®¾è®¡çš„ï¼Œé‚£ä¹ˆå¦‚æœéšç€ç³»ç»Ÿè¿è¡Œï¼ŒBuffer Pool çš„è„é¡µåˆ·æ–°åˆ°äº†ç£ç›˜ä¸­ï¼Œé‚£ä¹ˆ redo log å¯¹åº”çš„è®°å½•ä¹Ÿå°±æ²¡ç”¨äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬æ“¦é™¤è¿™äº›æ—§è®°å½•ï¼Œä»¥è…¾å‡ºç©ºé—´è®°å½•æ–°çš„æ›´æ–°æ“ä½œã€‚</p><h4 id="ä¸ºä»€ä¹ˆéœ€è¦-binlog-ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-binlog-ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ binlog ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ binlog ï¼Ÿ</h4><p>â€”-è®°å½•äº†æ‰€æœ‰<strong>æ•°æ®åº“è¡¨ç»“æ„å˜æ›´å’Œè¡¨æ•°æ®ä¿®æ”¹</strong>çš„æ—¥å¿—</p><p>å‰é¢ä»‹ç»çš„ undo log å’Œ redo log è¿™ä¸¤ä¸ªæ—¥å¿—éƒ½æ˜¯ <u>Innodb å­˜å‚¨å¼•æ“ç”Ÿæˆ</u>çš„ã€‚</p><p>MySQL åœ¨å®Œæˆä¸€æ¡æ›´æ–°æ“ä½œåï¼ŒServer å±‚è¿˜ä¼šç”Ÿæˆä¸€æ¡ binlogï¼Œç­‰ä¹‹å<u>äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œä¼šå°†è¯¥äº‹ç‰©æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ‰€æœ‰ binlog ç»Ÿä¸€å†™ å…¥ binlog æ–‡ä»¶ã€‚</u></p><p>binlog æ–‡ä»¶æ˜¯<u>è®°å½•äº†æ‰€æœ‰<strong>æ•°æ®åº“è¡¨ç»“æ„å˜æ›´å’Œè¡¨æ•°æ®ä¿®æ”¹</strong>çš„æ—¥å¿—</u>ï¼Œä¸ä¼šè®°å½•æŸ¥è¯¢ç±»çš„æ“ä½œï¼Œæ¯”å¦‚ SELECT å’Œ SHOW æ“ä½œã€‚</p><h5 id="redo-log-å’Œ-binlog-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#redo-log-å’Œ-binlog-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="redo log å’Œ binlog æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>redo log å’Œ binlog æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h5><p>è¿™ä¸¤ä¸ªæ—¥å¿—æœ‰å››ä¸ªåŒºåˆ«ã€‚</p><p><em>1ã€é€‚ç”¨å¯¹è±¡ä¸åŒï¼š</em></p><ul><li>binlog æ˜¯ MySQL çš„ Server å±‚å®ç°çš„æ—¥å¿—ï¼Œæ‰€æœ‰å­˜å‚¨å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ï¼›</li><li>redo log æ˜¯ Innodb å­˜å‚¨å¼•æ“å®ç°çš„æ—¥å¿—ï¼›</li></ul><p><em>2ã€æ–‡ä»¶æ ¼å¼ä¸åŒï¼š</em></p><ul><li>binlog æœ‰ 3 ç§æ ¼å¼ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ STATEMENTï¼ˆé»˜è®¤æ ¼å¼ï¼‰ã€ROWã€ MIXEDï¼ŒåŒºåˆ«å¦‚ä¸‹ï¼š<ul><li>STATEMENTï¼šæ¯ä¸€æ¡ä¿®æ”¹æ•°æ®çš„ SQL éƒ½ä¼šè¢«è®°å½•åˆ° binlog ä¸­ï¼ˆç›¸å½“äºè®°å½•äº†é€»è¾‘æ“ä½œï¼Œæ‰€ä»¥é’ˆå¯¹è¿™ç§æ ¼å¼ï¼Œ binlog å¯ä»¥ç§°ä¸ºé€»è¾‘æ—¥å¿—ï¼‰ï¼Œä¸»ä»å¤åˆ¶ä¸­ slave ç«¯å†æ ¹æ® SQL è¯­å¥é‡ç°ã€‚ä½† STATEMENT æœ‰åŠ¨æ€å‡½æ•°çš„é—®é¢˜ï¼Œæ¯”å¦‚ä½ ç”¨äº† uuid æˆ–è€… now è¿™äº›å‡½æ•°ï¼Œä½ åœ¨ä¸»åº“ä¸Šæ‰§è¡Œçš„ç»“æœå¹¶ä¸æ˜¯ä½ åœ¨ä»åº“æ‰§è¡Œçš„ç»“æœï¼Œè¿™ç§éšæ—¶åœ¨å˜çš„å‡½æ•°ä¼šå¯¼è‡´å¤åˆ¶çš„æ•°æ®ä¸ä¸€è‡´ï¼›</li><li>ROWï¼šè®°å½•è¡Œæ•°æ®æœ€ç»ˆè¢«ä¿®æ”¹æˆä»€ä¹ˆæ ·äº†ï¼ˆè¿™ç§æ ¼å¼çš„æ—¥å¿—ï¼Œå°±ä¸èƒ½ç§°ä¸ºé€»è¾‘æ—¥å¿—äº†ï¼‰ï¼Œä¸ä¼šå‡ºç° STATEMENT ä¸‹åŠ¨æ€å‡½æ•°çš„é—®é¢˜ã€‚ä½† ROW çš„ç¼ºç‚¹æ˜¯æ¯è¡Œæ•°æ®çš„å˜åŒ–ç»“æœéƒ½ä¼šè¢«è®°å½•ï¼Œæ¯”å¦‚æ‰§è¡Œæ‰¹é‡ update è¯­å¥ï¼Œæ›´æ–°å¤šå°‘è¡Œæ•°æ®å°±ä¼šäº§ç”Ÿå¤šå°‘æ¡è®°å½•ï¼Œä½¿ binlog æ–‡ä»¶è¿‡å¤§ï¼Œè€Œåœ¨ STATEMENT æ ¼å¼ä¸‹åªä¼šè®°å½•ä¸€ä¸ª update è¯­å¥è€Œå·²ï¼›</li><li>MIXEDï¼šåŒ…å«äº† STATEMENT å’Œ ROW æ¨¡å¼ï¼Œå®ƒä¼šæ ¹æ®ä¸åŒçš„æƒ…å†µè‡ªåŠ¨ä½¿ç”¨ ROW æ¨¡å¼å’Œ STATEMENT æ¨¡å¼ï¼›</li></ul></li><li>redo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯åœ¨æŸä¸ªæ•°æ®é¡µåšäº†ä»€ä¹ˆä¿®æ”¹ï¼Œæ¯”å¦‚å¯¹ XXX è¡¨ç©ºé—´ä¸­çš„ YYY æ•°æ®é¡µ ZZZ åç§»é‡çš„åœ°æ–¹åšäº†AAA æ›´æ–°ï¼›</li></ul><p><em>3ã€å†™å…¥æ–¹å¼ä¸åŒï¼š</em></p><ul><li>binlog æ˜¯è¿½åŠ å†™ï¼Œå†™æ»¡ä¸€ä¸ªæ–‡ä»¶ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç»§ç»­å†™ï¼Œä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ï¼Œä¿å­˜çš„æ˜¯å…¨é‡çš„æ—¥å¿—ã€‚</li><li>redo log æ˜¯å¾ªç¯å†™ï¼Œæ—¥å¿—ç©ºé—´å¤§å°æ˜¯å›ºå®šï¼Œå…¨éƒ¨å†™æ»¡å°±ä»å¤´å¼€å§‹ï¼Œä¿å­˜æœªè¢«åˆ·å…¥ç£ç›˜çš„è„é¡µæ—¥å¿—ã€‚</li></ul><p><em>4ã€ç”¨é€”ä¸åŒï¼š</em></p><ul><li>binlog ç”¨äºå¤‡ä»½æ¢å¤ã€ä¸»ä»å¤åˆ¶ï¼›</li><li>redo log ç”¨äºæ‰ç”µç­‰æ•…éšœæ¢å¤ã€‚</li></ul><p>å¦‚æœä¸å°å¿ƒæ•´ä¸ªæ•°æ®åº“çš„æ•°æ®è¢«åˆ é™¤äº†ï¼Œåªèƒ½ä½¿ç”¨binlogæ¢å¤æ•°æ®åº“ï¼Œredologæ–‡ä»¶ä¸ºå¾ªç¯å†™æœºåˆ¶ï¼Œè¾¹å†™è¾¹æ“¦é™¤ï¼Œåªç•™æœ‰æœ€æ–°çš„æ“ä½œ</p><h5 id="MySQLä¸»ä»å¤åˆ¶ï¼š"><a href="#MySQLä¸»ä»å¤åˆ¶ï¼š" class="headerlink" title="MySQLä¸»ä»å¤åˆ¶ï¼š"></a>MySQLä¸»ä»å¤åˆ¶ï¼š</h5><p>MySQL çš„ä¸»ä»å¤åˆ¶ä¾èµ–äº binlog ï¼Œä¹Ÿå°±æ˜¯è®°å½• MySQL ä¸Šçš„æ‰€æœ‰å˜åŒ–å¹¶ä»¥äºŒè¿›åˆ¶å½¢å¼ä¿å­˜åœ¨ç£ç›˜ä¸Šã€‚å¤åˆ¶çš„è¿‡ç¨‹å°±æ˜¯å°† binlog ä¸­çš„æ•°æ®ä»ä¸»åº“ä¼ è¾“åˆ°ä»åº“ä¸Šã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹ä¸€èˆ¬æ˜¯<strong>å¼‚æ­¥</strong>çš„ï¼Œä¹Ÿå°±æ˜¯ä¸»åº“ä¸Šæ‰§è¡Œäº‹åŠ¡æ“ä½œçš„çº¿ç¨‹ä¸ä¼šç­‰å¾…å¤åˆ¶ binlog çš„çº¿ç¨‹åŒæ­¥å®Œæˆã€‚</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/how_update/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E8%BF%87%E7%A8%8B.drawio.png?image_process=watermark,text_5YWs5LyX5Y-377ya5bCP5p6XY29kaW5n,type_ZnpsdHpoaw,x_10,y_10,g_se,size_20,color_0000CD,t_70,fill_0" alt="MySQL ä¸»ä»å¤åˆ¶è¿‡ç¨‹"></p><p>MySQL é›†ç¾¤çš„ä¸»ä»å¤åˆ¶è¿‡ç¨‹æ¢³ç†æˆ 3 ä¸ªé˜¶æ®µï¼š</p><ul><li><strong>å†™å…¥ Binlog</strong>ï¼šä¸»åº“å†™ binlog æ—¥å¿—ï¼Œæäº¤äº‹åŠ¡ï¼Œå¹¶æ›´æ–°æœ¬åœ°å­˜å‚¨æ•°æ®ã€‚</li><li><strong>åŒæ­¥ Binlog</strong>ï¼šæŠŠ binlog å¤åˆ¶åˆ°æ‰€æœ‰ä»åº“ä¸Šï¼Œæ¯ä¸ªä»åº“æŠŠ binlog å†™åˆ°æš‚å­˜æ—¥å¿—ä¸­ã€‚</li><li><strong>å›æ”¾ Binlog</strong>ï¼šå›æ”¾ binlogï¼Œå¹¶æ›´æ–°å­˜å‚¨å¼•æ“ä¸­çš„æ•°æ®ã€‚</li></ul><p>å…·ä½“è¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>MySQL ä¸»åº“åœ¨æ”¶åˆ°å®¢æˆ·ç«¯æäº¤äº‹åŠ¡çš„è¯·æ±‚ä¹‹åï¼Œä¼šå…ˆå†™å…¥ binlogï¼Œå†æäº¤äº‹åŠ¡ï¼Œæ›´æ–°å­˜å‚¨å¼•æ“ä¸­çš„æ•°æ®ï¼Œäº‹åŠ¡æäº¤å®Œæˆåï¼Œè¿”å›ç»™å®¢æˆ·ç«¯â€œæ“ä½œæˆåŠŸâ€çš„å“åº”ã€‚</li><li>ä»åº“ä¼šåˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ I&#x2F;O çº¿ç¨‹ï¼Œè¿æ¥ä¸»åº“çš„ log dump çº¿ç¨‹ï¼Œæ¥æ¥æ”¶ä¸»åº“çš„ binlog æ—¥å¿—ï¼Œå†æŠŠ binlog ä¿¡æ¯å†™å…¥ relay log çš„ä¸­ç»§æ—¥å¿—é‡Œï¼Œå†è¿”å›ç»™ä¸»åº“â€œå¤åˆ¶æˆåŠŸâ€çš„å“åº”ã€‚</li><li>ä»åº“ä¼šåˆ›å»ºä¸€ä¸ªç”¨äºå›æ”¾ binlog çš„çº¿ç¨‹ï¼Œå»è¯» relay log ä¸­ç»§æ—¥å¿—ï¼Œç„¶åå›æ”¾ binlog æ›´æ–°å­˜å‚¨å¼•æ“ä¸­çš„æ•°æ®ï¼Œæœ€ç»ˆå®ç°ä¸»ä»çš„æ•°æ®ä¸€è‡´æ€§ã€‚</li></ul><p>åœ¨å®Œæˆä¸»ä»å¤åˆ¶ä¹‹åï¼Œä½ å°±å¯ä»¥åœ¨å†™æ•°æ®æ—¶åªå†™ä¸»åº“ï¼Œåœ¨è¯»æ•°æ®æ—¶åªè¯»ä»åº“ï¼Œè¿™æ ·å³ä½¿å†™è¯·æ±‚ä¼šé”è¡¨æˆ–è€…é”è®°å½•ï¼Œä¹Ÿä¸ä¼šå½±å“è¯»è¯·æ±‚çš„æ‰§è¡Œã€‚</p><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/mysql/how_update/%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84.drawio.png?image_process=watermark,text_5YWs5LyX5Y-377ya5bCP5p6XY29kaW5n,type_ZnpsdHpoaw,x_10,y_10,g_se,size_20,color_0000CD,t_70,fill_0" alt="MySQL ä¸»ä»æ¶æ„"></p><h5 id="binlog-ä»€ä¹ˆæ—¶å€™åˆ·ç›˜ï¼Ÿ"><a href="#binlog-ä»€ä¹ˆæ—¶å€™åˆ·ç›˜ï¼Ÿ" class="headerlink" title="binlog ä»€ä¹ˆæ—¶å€™åˆ·ç›˜ï¼Ÿ"></a>binlog ä»€ä¹ˆæ—¶å€™åˆ·ç›˜ï¼Ÿ</h5><p>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ° binlog cacheï¼ˆServer å±‚çš„ cacheï¼‰ï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠ binlog cache å†™åˆ° binlog æ–‡ä»¶ä¸­ã€‚</p><p>ä¸€ä¸ªäº‹åŠ¡çš„ binlog æ˜¯ä¸èƒ½è¢«æ‹†å¼€çš„ï¼Œå› æ­¤æ— è®ºè¿™ä¸ªäº‹åŠ¡æœ‰å¤šå¤§ï¼ˆæ¯”å¦‚æœ‰å¾ˆå¤šæ¡è¯­å¥ï¼‰ï¼Œä¹Ÿè¦ä¿è¯ä¸€æ¬¡æ€§å†™å…¥ã€‚è¿™æ˜¯å› ä¸ºæœ‰ä¸€ä¸ªçº¿ç¨‹åªèƒ½åŒæ—¶æœ‰ä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œçš„è®¾å®šï¼Œæ‰€ä»¥æ¯å½“æ‰§è¡Œä¸€ä¸ª begin&#x2F;start transaction çš„æ—¶å€™ï¼Œå°±ä¼šé»˜è®¤æäº¤ä¸Šä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™æ ·å¦‚æœä¸€ä¸ªäº‹åŠ¡çš„ binlog è¢«æ‹†å¼€çš„æ—¶å€™ï¼Œåœ¨å¤‡åº“æ‰§è¡Œå°±ä¼šè¢«å½“åšå¤šä¸ªäº‹åŠ¡åˆ†æ®µè‡ªè¡Œï¼Œè¿™æ ·ç ´åäº†åŸå­æ€§ï¼Œæ˜¯æœ‰é—®é¢˜çš„ã€‚</p><p>MySQL ç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…äº†ä¸€ç‰‡å†…å­˜ç”¨äºç¼“å†² binlog ï¼Œè¯¥å†…å­˜å« binlog cacheï¼Œå‚æ•° binlog_cache_size ç”¨äºæ§åˆ¶å•ä¸ªçº¿ç¨‹å†… binlog cache æ‰€å å†…å­˜çš„å¤§å°ã€‚å¦‚æœè¶…è¿‡äº†è¿™ä¸ªå‚æ•°è§„å®šçš„å¤§å°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ã€‚</p><h5 id="ä¸ºä»€ä¹ˆéœ€è¦ä¸¤é˜¶æ®µæäº¤ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦ä¸¤é˜¶æ®µæäº¤ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ä¸¤é˜¶æ®µæäº¤ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ä¸¤é˜¶æ®µæäº¤ï¼Ÿ</h5><p>â€‹äº‹åŠ¡æäº¤åï¼Œredo log å’Œ binlog éƒ½è¦æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ˜¯ç‹¬ç«‹çš„é€»è¾‘ï¼Œå¯èƒ½å‡ºç°åŠæˆåŠŸçš„çŠ¶æ€ï¼Œè¿™æ ·å°±é€ æˆä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸ä¸€è‡´ã€‚<strong>å› ä¸º redo log å½±å“ä¸»åº“çš„æ•°æ®ï¼Œbinlog å½±å“ä»åº“çš„æ•°æ®ï¼Œæ‰€ä»¥ redo log å’Œ binlog å¿…é¡»ä¿æŒä¸€è‡´æ‰èƒ½ä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´ã€‚</strong></p><h5 id="ä¸¤é˜¶æ®µæäº¤çš„å®ç°è¿‡ç¨‹ï¼š"><a href="#ä¸¤é˜¶æ®µæäº¤çš„å®ç°è¿‡ç¨‹ï¼š" class="headerlink" title="ä¸¤é˜¶æ®µæäº¤çš„å®ç°è¿‡ç¨‹ï¼š"></a>ä¸¤é˜¶æ®µæäº¤çš„å®ç°è¿‡ç¨‹ï¼š</h5><p>â€‹äº‹åŠ¡çš„æäº¤è¿‡ç¨‹æœ‰ä¸¤ä¸ªé˜¶æ®µï¼Œå°±æ˜¯<strong>å°† redo log çš„å†™å…¥æ‹†æˆäº†ä¸¤ä¸ªæ­¥éª¤ï¼šprepare å’Œ commitï¼Œä¸­é—´å†ç©¿æ’å†™å…¥binlog</strong>ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ul><li><strong>prepare é˜¶æ®µ</strong>ï¼šå°† XIDï¼ˆå†…éƒ¨ XA äº‹åŠ¡çš„ IDï¼‰ å†™å…¥åˆ° redo logï¼ŒåŒæ—¶å°† redo log å¯¹åº”çš„äº‹åŠ¡çŠ¶æ€è®¾ç½®ä¸º prepareï¼Œç„¶åå°† redo log æŒä¹…åŒ–åˆ°ç£ç›˜ï¼ˆinnodb_flush_log_at_trx_commit &#x3D; 1 çš„ä½œç”¨ï¼‰ï¼›</li><li><strong>commit é˜¶æ®µ</strong>ï¼šæŠŠ XID å†™å…¥åˆ° binlogï¼Œç„¶åå°† binlog æŒä¹…åŒ–åˆ°ç£ç›˜ï¼ˆsync_binlog &#x3D; 1 çš„ä½œç”¨ï¼‰ï¼Œæ¥ç€è°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå°† redo log çŠ¶æ€è®¾ç½®ä¸º commitï¼Œæ­¤æ—¶è¯¥çŠ¶æ€å¹¶ä¸éœ€è¦æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œåªéœ€è¦ write åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cache ä¸­å°±å¤Ÿäº†ï¼Œå› ä¸ºåªè¦ binlog å†™ç£ç›˜æˆåŠŸï¼Œå°±ç®— redo log çš„çŠ¶æ€è¿˜æ˜¯ prepare ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œä¸€æ ·ä¼šè¢«è®¤ä¸ºäº‹åŠ¡å·²ç»æ‰§è¡ŒæˆåŠŸï¼›</li></ul><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230808110410810.png" alt="image-20230808110410810" style="zoom: 43%;" /><h5 id="äº‹åŠ¡æ²¡æäº¤çš„æ—¶å€™ï¼Œredo-log-ä¼šè¢«æŒä¹…åŒ–åˆ°ç£ç›˜å—ï¼Ÿ"><a href="#äº‹åŠ¡æ²¡æäº¤çš„æ—¶å€™ï¼Œredo-log-ä¼šè¢«æŒä¹…åŒ–åˆ°ç£ç›˜å—ï¼Ÿ" class="headerlink" title="äº‹åŠ¡æ²¡æäº¤çš„æ—¶å€™ï¼Œredo log ä¼šè¢«æŒä¹…åŒ–åˆ°ç£ç›˜å—ï¼Ÿ"></a>äº‹åŠ¡æ²¡æäº¤çš„æ—¶å€™ï¼Œredo log ä¼šè¢«æŒä¹…åŒ–åˆ°ç£ç›˜å—ï¼Ÿ</h5><p>ä¼šçš„ã€‚</p><p>äº‹åŠ¡æ‰§è¡Œä¸­é—´è¿‡ç¨‹çš„ redo log ä¹Ÿæ˜¯ç›´æ¥å†™åœ¨ redo log buffer ä¸­çš„ï¼Œè¿™äº›ç¼“å­˜åœ¨ redo log buffer é‡Œçš„ redo log ä¹Ÿä¼šè¢«ã€Œåå°çº¿ç¨‹ã€æ¯éš”ä¸€ç§’ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>äº‹åŠ¡æ²¡æäº¤çš„æ—¶å€™ï¼Œredo log ä¹Ÿæ˜¯å¯èƒ½è¢«æŒä¹…åŒ–åˆ°ç£ç›˜çš„</strong>ã€‚</p><p>æœ‰çš„åŒå­¦å¯èƒ½ä¼šé—®ï¼Œå¦‚æœ mysql å´©æºƒäº†ï¼Œè¿˜æ²¡æäº¤äº‹åŠ¡çš„ redo log å·²ç»è¢«æŒä¹…åŒ–ç£ç›˜äº†ï¼Œmysql é‡å¯åï¼Œæ•°æ®ä¸å°±ä¸ä¸€è‡´äº†ï¼Ÿ</p><p>æ”¾å¿ƒï¼Œè¿™ç§æƒ…å†µ mysql é‡å¯ä¼šè¿›è¡Œå›æ»šæ“ä½œï¼Œå› ä¸ºäº‹åŠ¡æ²¡æäº¤çš„æ—¶å€™ï¼Œbinlog æ˜¯è¿˜æ²¡æŒä¹…åŒ–åˆ°ç£ç›˜çš„ã€‚</p><p>æ‰€ä»¥ï¼Œ redo log å¯ä»¥åœ¨äº‹åŠ¡æ²¡æäº¤ä¹‹å‰æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä½†æ˜¯ binlog å¿…é¡»åœ¨äº‹åŠ¡æäº¤ä¹‹åï¼Œæ‰å¯ä»¥æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</p><h4 id="ğŸŒŸæ€»ç»“ï¼š"><a href="#ğŸŒŸæ€»ç»“ï¼š" class="headerlink" title="ğŸŒŸæ€»ç»“ï¼š"></a>ğŸŒŸæ€»ç»“ï¼š</h4><p>å…·ä½“æ›´æ–°ä¸€æ¡è®°å½• <code>UPDATE t_user SET name = &#39;xiaolin&#39; WHERE id = 1;</code> çš„æµç¨‹å¦‚ä¸‹:</p><ol><li>æ‰§è¡Œå™¨è´Ÿè´£å…·ä½“æ‰§è¡Œï¼Œä¼šè°ƒç”¨å­˜å‚¨å¼•æ“çš„æ¥å£ï¼Œé€šè¿‡ä¸»é”®ç´¢å¼•æ ‘æœç´¢è·å– id &#x3D; 1 è¿™ä¸€è¡Œè®°å½•ï¼š<ul><li>å¦‚æœ id&#x3D;1 è¿™ä¸€è¡Œæ‰€åœ¨çš„æ•°æ®é¡µæœ¬æ¥å°±åœ¨ buffer pool ä¸­ï¼Œå°±ç›´æ¥è¿”å›ç»™æ‰§è¡Œå™¨æ›´æ–°ï¼›</li><li>å¦‚æœè®°å½•ä¸åœ¨ buffer poolï¼Œå°†æ•°æ®é¡µä»ç£ç›˜è¯»å…¥åˆ° buffer poolï¼Œè¿”å›è®°å½•ç»™æ‰§è¡Œå™¨ã€‚</li></ul></li><li>æ‰§è¡Œå™¨å¾—åˆ°èšç°‡ç´¢å¼•è®°å½•åï¼Œä¼šçœ‹ä¸€ä¸‹æ›´æ–°å‰çš„è®°å½•å’Œæ›´æ–°åçš„è®°å½•æ˜¯å¦ä¸€æ ·ï¼š<ul><li>å¦‚æœä¸€æ ·çš„è¯å°±ä¸è¿›è¡Œåç»­æ›´æ–°æµç¨‹ï¼›</li><li>å¦‚æœä¸ä¸€æ ·çš„è¯å°±æŠŠæ›´æ–°å‰çš„è®°å½•å’Œæ›´æ–°åçš„è®°å½•éƒ½å½“ä½œå‚æ•°ä¼ ç»™ InnoDB å±‚ï¼Œè®© InnoDB çœŸæ­£çš„æ‰§è¡Œæ›´æ–°è®°å½•çš„æ“ä½œï¼›</li></ul></li><li>å¼€å¯äº‹åŠ¡ï¼Œ InnoDB å±‚æ›´æ–°è®°å½•å‰ï¼Œé¦–å…ˆè¦è®°å½•ç›¸åº”çš„ undo logï¼Œå› ä¸ºè¿™æ˜¯æ›´æ–°æ“ä½œï¼Œéœ€è¦æŠŠè¢«æ›´æ–°çš„åˆ—çš„æ—§å€¼è®°ä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯è¦ç”Ÿæˆä¸€æ¡ undo logï¼Œundo log ä¼šå†™å…¥ Buffer Pool ä¸­çš„ Undo é¡µé¢ï¼Œä¸è¿‡åœ¨å†…å­˜ä¿®æ”¹è¯¥ Undo é¡µé¢åï¼Œéœ€è¦è®°å½•å¯¹åº”çš„ redo logã€‚</li><li>InnoDB å±‚å¼€å§‹æ›´æ–°è®°å½•ï¼Œä¼šå…ˆæ›´æ–°å†…å­˜ï¼ˆåŒæ—¶æ ‡è®°ä¸ºè„é¡µï¼‰ï¼Œç„¶åå°†è®°å½•å†™åˆ° redo log é‡Œé¢ï¼Œè¿™ä¸ªæ—¶å€™æ›´æ–°å°±ç®—å®Œæˆäº†ã€‚ä¸ºäº†å‡å°‘ç£ç›˜I&#x2F;Oï¼Œä¸ä¼šç«‹å³å°†è„é¡µå†™å…¥ç£ç›˜ï¼Œåç»­ç”±åå°çº¿ç¨‹é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æ—¶æœºå°†è„é¡µå†™å…¥åˆ°ç£ç›˜ã€‚è¿™å°±æ˜¯ <strong>WAL æŠ€æœ¯</strong>ï¼ŒMySQL çš„å†™æ“ä½œå¹¶ä¸æ˜¯ç«‹åˆ»å†™åˆ°ç£ç›˜ä¸Šï¼Œè€Œæ˜¯å…ˆå†™ redo æ—¥å¿—ï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶é—´å†å°†ä¿®æ”¹çš„è¡Œæ•°æ®å†™åˆ°ç£ç›˜ä¸Šã€‚</li><li>è‡³æ­¤ï¼Œä¸€æ¡è®°å½•æ›´æ–°å®Œäº†ã€‚</li><li>åœ¨ä¸€æ¡æ›´æ–°è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œç„¶åå¼€å§‹è®°å½•è¯¥è¯­å¥å¯¹åº”çš„ binlogï¼Œæ­¤æ—¶è®°å½•çš„ binlog ä¼šè¢«ä¿å­˜åˆ° binlog cacheï¼Œå¹¶æ²¡æœ‰åˆ·æ–°åˆ°ç¡¬ç›˜ä¸Šçš„ binlog æ–‡ä»¶ï¼Œåœ¨äº‹åŠ¡æäº¤æ—¶æ‰ä¼šç»Ÿä¸€å°†è¯¥äº‹åŠ¡è¿è¡Œè¿‡ç¨‹ä¸­çš„æ‰€æœ‰ binlog åˆ·æ–°åˆ°ç¡¬ç›˜ã€‚</li><li>äº‹åŠ¡æäº¤ï¼ˆä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œè¿™é‡Œä¸è¯´ç»„æäº¤çš„è¿‡ç¨‹ï¼Œåªè¯´ä¸¤é˜¶æ®µæäº¤ï¼‰ï¼š<ul><li><strong>prepare é˜¶æ®µ</strong>ï¼šå°† redo log å¯¹åº”çš„äº‹åŠ¡çŠ¶æ€è®¾ç½®ä¸º prepareï¼Œç„¶åå°† redo log åˆ·æ–°åˆ°ç¡¬ç›˜ï¼›</li><li><strong>commit é˜¶æ®µ</strong>ï¼šå°† binlog åˆ·æ–°åˆ°ç£ç›˜ï¼Œæ¥ç€è°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå°† redo log çŠ¶æ€è®¾ç½®ä¸º commitï¼ˆå°†äº‹åŠ¡è®¾ç½®ä¸º commit çŠ¶æ€åï¼Œåˆ·å…¥åˆ°ç£ç›˜ redo log æ–‡ä»¶ï¼‰ï¼›</li></ul></li><li>è‡³æ­¤ï¼Œä¸€æ¡æ›´æ–°è¯­å¥æ‰§è¡Œå®Œæˆã€‚</li></ol><h3 id="æ•°æ®åº“å¤‡ä»½ï¼šå¤‡ä»½æ–‡ä»¶ä¹Ÿè¦æ£€æŸ¥ï¼"><a href="#æ•°æ®åº“å¤‡ä»½ï¼šå¤‡ä»½æ–‡ä»¶ä¹Ÿè¦æ£€æŸ¥ï¼" class="headerlink" title="æ•°æ®åº“å¤‡ä»½ï¼šå¤‡ä»½æ–‡ä»¶ä¹Ÿè¦æ£€æŸ¥ï¼"></a>æ•°æ®åº“å¤‡ä»½ï¼šå¤‡ä»½æ–‡ä»¶ä¹Ÿè¦æ£€æŸ¥ï¼</h3><h4 id="å…¨é‡å¤‡ä»½ï¼š"><a href="#å…¨é‡å¤‡ä»½ï¼š" class="headerlink" title="å…¨é‡å¤‡ä»½ï¼š"></a>å…¨é‡å¤‡ä»½ï¼š</h4><h5 id="1-é€»è¾‘å¤‡ä»½ï¼š"><a href="#1-é€»è¾‘å¤‡ä»½ï¼š" class="headerlink" title="1. é€»è¾‘å¤‡ä»½ï¼š"></a>1. é€»è¾‘å¤‡ä»½ï¼š</h5><p>æŒ‡å¤‡ä»½æ•°æ®åº“çš„é€»è¾‘å†…å®¹ï¼Œå°±æ˜¯æ¯å¼ è¡¨ä¸­çš„å†…å®¹<u>é€šè¿‡ INSERT è¯­å¥çš„å½¢å¼è¿›è¡Œå¤‡ä»½</u>ã€‚</p><p>MySQL å®˜æ–¹æä¾›çš„é€»è¾‘å¤‡ä»½å·¥å…·æœ‰ <strong>mysqldump å’Œ mysqlpump</strong></p><p>mysqldumpï¼šå•çº¿ç¨‹</p><p>mysqlpumpï¼šåŸºäºè¡¨çš„å¤šçº¿ç¨‹ï¼Œ<u>ä¸åŒè¡¨å¯ä»¥åŒæ—¶å¤‡ä»½</u>(ä¸èƒ½æ„å»ºä¸€ä¸ªä¸€è‡´æ€§çš„å¤‡ä»½)</p><h5 id="2-ç‰©ç†å¤‡ä»½ï¼š"><a href="#2-ç‰©ç†å¤‡ä»½ï¼š" class="headerlink" title="2. ç‰©ç†å¤‡ä»½ï¼š"></a>2. ç‰©ç†å¤‡ä»½ï¼š</h5><p>é€»è¾‘å¤‡ä»½è™½ç„¶å¥½ï¼Œä½†æ˜¯å®ƒæ‰€éœ€è¦çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå› ä¸ºæœ¬è´¨ä¸Šé€»è¾‘å¤‡ä»½å°±æ˜¯è¿›è¡Œ INSERT â€¦ SELECT â€¦ çš„æ“ä½œã€‚</p><p>è€Œ<u>ç‰©ç†å¤‡ä»½ç›´æ¥å¤‡ä»½æ•°æ®åº“çš„ç‰©ç†è¡¨ç©ºé—´æ–‡ä»¶å’Œé‡åšæ—¥å¿—ï¼Œä¸ç”¨é€šè¿‡é€»è¾‘çš„ SELECT å–å‡ºæ•°æ®</u>ã€‚æ‰€ä»¥ç‰©ç†å¤‡ä»½çš„é€Ÿåº¦ï¼Œé€šå¸¸æ˜¯æ¯”é€»è¾‘å¤‡ä»½å¿«çš„ï¼Œæ¢å¤é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚</p><p>ä½†å®ƒä¸å¦‚ mydumper çš„æ˜¯ï¼Œ<u><strong>ç‰©ç†å¤‡ä»½åªèƒ½æ¢å¤æ•´ä¸ªå®ä¾‹çš„æ•°æ®ï¼Œè€Œä¸èƒ½æŒ‰æŒ‡å®šè¡¨è¿›è¡Œæ¢å¤</strong></u>ã€‚MySQL 8.0 çš„ç‰©ç†å¤‡ä»½å·¥å…·å¯ä»¥é€‰æ‹©å®˜æ–¹çš„ Clone Pluginã€‚</p><h4 id="å¢é‡å¤‡ä»½ï¼š"><a href="#å¢é‡å¤‡ä»½ï¼š" class="headerlink" title="å¢é‡å¤‡ä»½ï¼š"></a>å¢é‡å¤‡ä»½ï¼š</h4><p>â€‹æˆ‘ä»¬éœ€è¦é€šè¿‡â€œå…¨é‡å¤‡ä»½ + å¢é‡å¤‡ä»½â€çš„æ–¹å¼ï¼Œæ„å»ºå®Œæ•´çš„å¤‡ä»½ç­–ç•¥ã€‚<strong>å¢é‡å¤‡ä»½å°±æ˜¯å¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œå¤‡ä»½ï¼Œåœ¨ MySQL æ•°æ®åº“ä¸­å°±æ˜¯äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ã€‚</strong></p><p>â€‹å› ä¸ºäºŒè¿›åˆ¶æ—¥å¿—ä¿å­˜äº†å¯¹æ•°æ®åº“æ‰€æœ‰å˜æ›´çš„ä¿®æ”¹ï¼Œæ‰€ä»¥â€œå…¨é‡å¤‡ä»½ + å¢é‡å¤‡ä»½â€ï¼Œå°±å¯ä»¥å®ç°åŸºäºæ—¶é—´ç‚¹çš„æ¢å¤ï¼ˆpoint in time recoveryï¼‰ï¼Œä¹Ÿå°±æ˜¯â€œé€šè¿‡å…¨é‡ + å¢é‡å¤‡ä»½â€å¯ä»¥æ¢å¤åˆ°ä»»æ„æ—¶é—´ç‚¹ã€‚</p><p>â€‹MySQL å¢é‡å¤‡ä»½çš„æœ¬è´¨æ˜¯é€šè¿‡ mysqlbinlog æ¨¡æ‹Ÿä¸€ä¸ª slave ä»æœåŠ¡å™¨ï¼Œç„¶åä¸»æœåŠ¡å™¨ä¸æ–­å°†äºŒè¿›åˆ¶æ—¥å¿—æ¨é€ç»™ä»æœåŠ¡å™¨ï¼Œåˆ©ç”¨ä¹‹å‰ä»‹ç»çš„å¤åˆ¶æŠ€æœ¯ï¼Œå®ç°æ•°æ®åº“çš„å¢é‡å¤‡ä»½ã€‚</p><p>å¢é‡å¤‡ä»½çš„æ¢å¤ï¼Œå°±æ˜¯é€šè¿‡ mysqlbinlog è§£æäºŒè¿›åˆ¶æ—¥å¿—ï¼Œç„¶åè¿›è¡Œæ¢å¤</p><h4 id="å¤‡ä»½ç­–ç•¥ï¼š"><a href="#å¤‡ä»½ç­–ç•¥ï¼š" class="headerlink" title="å¤‡ä»½ç­–ç•¥ï¼š"></a>å¤‡ä»½ç­–ç•¥ï¼š</h4><p>åœ¨æŒæ¡å…¨é‡å¤‡ä»½ã€å¢é‡å¤‡ä»½çš„çŸ¥è¯†ç‚¹åï¼Œæˆ‘ä»¬å°±èƒ½æ„å»ºè‡ªå·±çš„å¤‡ä»½ç­–ç•¥äº†ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦è®¾ç½®å…¨é‡å¤‡ä»½çš„é¢‘ç‡ï¼Œå› ä¸ºå…¨é‡å¤‡ä»½æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥å»ºè®®è®¾ç½® 1 å‘¨ 1 æ¬¡å…¨é‡å¤‡ä»½ï¼Œå®æ—¶å¢é‡å¤‡ä»½çš„é¢‘ç‡ã€‚è¿™æ ·æœ€åçš„æƒ…å†µå°±æ˜¯è¦æ¢å¤ 7 å¤©å‰çš„ä¸€ä¸ªå…¨å¤‡ï¼Œç„¶åé€šè¿‡ 7 å¤©çš„å¢é‡å¤‡ä»½æ¢å¤ã€‚</p><p>å¯¹äºå¤‡ä»½æ–‡ä»¶ï¼Œä¹Ÿéœ€è¦è¿›è¡Œå¤‡ä»½ã€‚æˆ‘ä»¬ä¸èƒ½è®¤ä¸ºå¤‡ä»½æ–‡ä»¶çš„å­˜å‚¨ä»‹è´¨ä¸ä¼šæŸåã€‚æ‰€ä»¥ï¼Œè‡³å°‘åœ¨ 2 ä¸ªæœºæˆ¿çš„ä¸åŒå­˜å‚¨æœåŠ¡å™¨ä¸Šå­˜å‚¨å¤‡ä»½æ–‡ä»¶ï¼Œå³å¤‡ä»½æ–‡ä»¶è‡³å°‘éœ€è¦ 2 ä¸ªå‰¯æœ¬ã€‚è‡³äºå¤‡ä»½æ–‡ä»¶çš„ä¿å­˜æœŸé™ï¼Œå–å†³äºæ¯ä¸ªå…¬å¸è‡ªå·±çš„è¦æ±‚ï¼ˆæ¯”å¦‚æœ‰çš„å…¬å¸è¦æ±‚æ°¸ä¹…ä¿å­˜ï¼Œæœ‰çš„å…¬å¸è¦æ±‚ä¿ç•™è‡³å°‘è¿‘ 3 ä¸ªæœˆçš„å¤‡ä»½æ–‡ä»¶ï¼‰ã€‚</p><p>æ‰€æœ‰çš„è¿™äº›å¤‡ä»½ç­–ç•¥ï¼Œéƒ½éœ€è¦è‡ªå·±çš„å¤‡ä»½ç³»ç»Ÿè¿›è¡Œè°ƒåº¦ï¼Œè¿™ä¸ªå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«å¥½çš„å¼€æºé¡¹ç›®ï¼Œéœ€è¦æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚ï¼Œå®šåˆ¶å¼€å‘ã€‚</p><h2 id="æ€§èƒ½è°ƒä¼˜"><a href="#æ€§èƒ½è°ƒä¼˜" class="headerlink" title="æ€§èƒ½è°ƒä¼˜"></a>æ€§èƒ½è°ƒä¼˜</h2><h3 id="benchmark"><a href="#benchmark" class="headerlink" title="benchmark"></a>benchmark</h3><p>mysqlæ€§èƒ½æµ‹è¯•ï¼š<a href="https://developer.aliyun.com/article/250710">https://developer.aliyun.com/article/250710</a></p><h3 id="ğŸŒŸexplainæ‰§è¡Œè®¡åˆ’"><a href="#ğŸŒŸexplainæ‰§è¡Œè®¡åˆ’" class="headerlink" title="ğŸŒŸexplainæ‰§è¡Œè®¡åˆ’"></a>ğŸŒŸexplainæ‰§è¡Œè®¡åˆ’</h3><p>â€‹ä¸€æ¡æŸ¥è¯¢è¯­å¥åœ¨ç»è¿‡MySQL**<u>æŸ¥è¯¢ä¼˜åŒ–å™¨</u>**çš„å„ç§åŸºäºæˆæœ¬å’Œè§„åˆ™çš„ä¼˜åŒ–ä¼šå<u>ç”Ÿæˆä¸€ä¸ªæ‰€è°“çš„æ‰§è¡Œè®¡åˆ’</u>ï¼Œè¿™ä¸ªæ‰§è¡Œè®¡åˆ’å±•ç¤ºäº†æ¥ä¸‹æ¥å…·ä½“æ‰§è¡ŒæŸ¥è¯¢çš„æ–¹å¼ï¼Œæ¯”å¦‚å¤šè¡¨è¿æ¥çš„é¡ºåºæ˜¯ä»€ä¹ˆï¼Œå¯¹äºæ¯ä¸ªè¡¨é‡‡ç”¨ä»€ä¹ˆè®¿é—®æ–¹æ³•æ¥å…·ä½“æ‰§è¡ŒæŸ¥è¯¢ç­‰ç­‰ã€‚</p><p>â€‹è®¾è®¡MySQLçš„å¤§å”è´´å¿ƒçš„ä¸ºæˆ‘ä»¬æä¾›äº†EXPLAINè¯­å¥æ¥<u><strong>å¸®åŠ©æˆ‘ä»¬æŸ¥çœ‹æŸä¸ªæŸ¥è¯¢è¯­å¥çš„å…·ä½“æ‰§è¡Œè®¡åˆ’</strong></u>ï¼Œæœ¬ç« çš„å†…å®¹å°±æ˜¯ä¸ºäº†å¸®åŠ©å¤§å®¶çœ‹æ‡‚EXPLAINè¯­å¥çš„å„ä¸ªè¾“å‡ºé¡¹éƒ½æ˜¯å¹²å˜›ä½¿çš„ï¼Œä»è€Œå¯ä»¥æœ‰é’ˆå¯¹æ€§çš„æå‡æˆ‘ä»¬æŸ¥è¯¢è¯­å¥çš„æ€§èƒ½ã€‚</p><h4 id="1-æŸ¥çœ‹æŸæ¡æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼š"><a href="#1-æŸ¥çœ‹æŸæ¡æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼š" class="headerlink" title="1. æŸ¥çœ‹æŸæ¡æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼š"></a>1. æŸ¥çœ‹æŸæ¡æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼š</h4><p>â€‹åœ¨æŸ¥è¯¢è¯­å¥å‰åŠ ä¸Š explain å³å¯</p><h4 id="2-explainæ‰§è¡Œè®¡åˆ’ä¸­æ¯ä¸ªåˆ—çš„å«ä¹‰ï¼š"><a href="#2-explainæ‰§è¡Œè®¡åˆ’ä¸­æ¯ä¸ªåˆ—çš„å«ä¹‰ï¼š" class="headerlink" title="2. explainæ‰§è¡Œè®¡åˆ’ä¸­æ¯ä¸ªåˆ—çš„å«ä¹‰ï¼š"></a>2. explainæ‰§è¡Œè®¡åˆ’ä¸­æ¯ä¸ªåˆ—çš„å«ä¹‰ï¼š</h4><p>â€‹å…ˆæŠŠEXPLAIN è¯­å¥è¾“å‡ºçš„å„ä¸ªåˆ—çš„ä½œç”¨å…ˆå¤§è‡´ç½—åˆ—ä¸€ä¸‹ï¼š</p><p>â€‹<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230809143140850.png" alt="image-20230809143140850" style="zoom:50%;" /></p><h5 id="tableï¼š"><a href="#tableï¼š" class="headerlink" title="tableï¼š"></a>tableï¼š</h5><p>â€‹EXPLAINè¯­å¥è¾“å‡ºçš„æ¯æ¡è®°å½•éƒ½å¯¹åº”ç€æŸä¸ªå•è¡¨çš„è®¿é—®æ–¹æ³•ï¼Œè¯¥æ¡è®°å½•çš„tableåˆ—ä»£è¡¨ç€è¯¥è¡¨çš„è¡¨åã€‚</p><p>â€”â€”æ¯æ¡è®°å½•çš„tableåˆ—ä¸­åªæœ‰ä¸€ä¸ªè¡¨åã€å¦‚æœæŸ¥è¯¢è¯­å¥ä¸­æŸ¥äº†å¤šä¸ªè¡¨ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å¤šæ¡æ‰§è¡Œè®¡åˆ’è®°å½•ï¼Œæ¯ä¸ªè®°å½•çš„tableä¸­åªæœ‰ä¸€ä¸ªè¡¨</p><h5 id="idï¼š"><a href="#idï¼š" class="headerlink" title="idï¼š"></a>idï¼š</h5><p>â€‹mysqlä¸ºæ¯ä¸ªselectè¯­å¥åˆ†é…ä¸€ä¸ªidï¼Œå…¶ä¸­ï¼š</p><ul><li><u><strong>è¿æ¥æŸ¥è¯¢</strong></u>ä¸­å‡ºç°çš„å‡ ä¸ªè¡¨çš„**<u>idæ˜¯ç›¸åŒ</u>**çš„ï¼Œå‡ºç°åœ¨å‰é¢çš„è¡¨æ˜¯ä¸»è¡¨ï¼Œå‡ºç°åœ¨åé¢çš„è¡¨æ˜¯ä»è¡¨<ul><li>å¯¹äºè¿æ¥æŸ¥è¯¢æ¥è¯´ï¼Œä¸€ä¸ª SELECT å…³é”®å­—åè¾¹çš„ FROM å­å¥ä¸­å¯ä»¥è·Ÿéšå¤šä¸ªè¡¨ï¼Œæ‰€ä»¥åœ¨è¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œæ¯ä¸ªè¡¨éƒ½ä¼šå¯¹åº”ä¸€æ¡è®°å½•ï¼Œä½†æ˜¯è¿™äº›è®°å½•çš„idå€¼éƒ½æ˜¯ç›¸åŒçš„</li></ul></li><li>å¯¹äº<u><strong>åŒ…å«å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥</strong></u>æ¥è¯´ï¼Œå°±å¯èƒ½æ¶‰åŠå¤šä¸ª SELECT å…³é”®å­—ï¼Œæ‰€ä»¥åœ¨åŒ…å«å­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ä¸­ï¼Œ<u>æ¯ä¸ª SELECT å…³é”®å­—éƒ½ä¼šå¯¹åº”ä¸€ä¸ª<strong>å”¯ä¸€</strong>çš„ id å€¼</u><ul><li>âš ï¸ä½†æ˜¯ï¼Œ<u>æŸ¥è¯¢ä¼˜åŒ–å™¨å¯èƒ½å¯¹æ¶‰åŠå­æŸ¥è¯¢çš„æŸ¥è¯¢è¯­å¥è¿›è¡Œé‡å†™ï¼Œä»è€Œè½¬æ¢ä¸ºè¿æ¥æŸ¥è¯¢</u>ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“æŸ¥è¯¢ä¼˜åŒ–å™¨å¯¹æŸä¸ªåŒ…å«å­æŸ¥è¯¢çš„è¯­å¥æ˜¯å¦è¿›è¡Œäº†é‡å†™ï¼Œ**<u>ç›´æ¥æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’å°±å¥½äº†ï¼Œå¦‚æœå­æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ä¸­å¤šæ¡è®°å½•çš„idç›¸åŒï¼Œé‚£ä¹ˆè¯´æ˜è¯­å¥è¢«é‡å†™ï¼</u>**</li></ul></li></ul><h5 id="select-typeï¼š"><a href="#select-typeï¼š" class="headerlink" title="select_typeï¼š"></a>select_typeï¼š</h5><p>SIMPLEï¼šç®€å• SELECTï¼Œä¸éœ€è¦ä½¿ç”¨ UNION æ“ä½œæˆ–å­æŸ¥è¯¢ã€‚<br>PRIMARYï¼šå¦‚æœæŸ¥è¯¢åŒ…å«å­æŸ¥è¯¢ï¼Œæœ€å¤–å±‚çš„ SELECT è¢«æ ‡è®°ä¸º PRIMARYï¼›æˆ–è€…UNIONè¯­å¥çš„æœ€å·¦è¾¹çš„æŸ¥è¯¢<br>UNIONï¼šUNION æ“ä½œä¸­ç¬¬äºŒä¸ªæˆ–åé¢çš„ SELECT è¯­å¥ã€‚<br>SUBQUERYï¼šå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª SELECTã€‚<br>DERIVEDï¼šæ´¾ç”Ÿè¡¨çš„ SELECT å­æŸ¥è¯¢ã€‚ï¼ˆä»ä¸€ä¸ªåˆšselectå‡ºæ¥çš„è¡¨ä¸­æŸ¥è¯¢ï¼‰</p><p>â€¦â€¦</p><h5 id="typeï¼š"><a href="#typeï¼š" class="headerlink" title="typeï¼š"></a>typeï¼š</h5><p>mysqlå¯¹æŸä¸ªè¡¨æ‰§è¡ŒæŸ¥è¯¢æ—¶çš„è®¿é—®æ–¹æ³•</p><ul><li><p>system</p><ul><li>å½“è¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•å¹¶ä¸”è¯¥è¡¨ä½¿ç”¨çš„å­˜å‚¨å¼•æ“çš„ç»Ÿè®¡æ•°æ®æ˜¯ç²¾ç¡®çš„ï¼Œæ¯”å¦‚MyISAMã€Memoryï¼Œé‚£ä¹ˆå¯¹è¯¥è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯ system ã€‚</li></ul></li><li><p>const</p><ul><li>å½“æˆ‘ä»¬æ ¹æ®ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—ä¸<u>å¸¸æ•°è¿›è¡Œç­‰å€¼åŒ¹é…</u>æ—¶ï¼Œå¯¹å•è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯ const</li></ul></li><li><p>eq_ref</p><ul><li>âš ï¸<u>é’ˆå¯¹è¢«é©±åŠ¨è¡¨çš„æ‰§è¡Œè®¡åˆ’</u></li><li>åœ¨è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå¦‚æœ<u><strong>è¢«é©±åŠ¨è¡¨</strong></u>æ˜¯é€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•åˆ—ç­‰å€¼åŒ¹é…çš„æ–¹å¼è¿›è¡Œè®¿é—®çš„ï¼ˆå¦‚æœè¯¥ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•æ˜¯è”åˆç´¢å¼•çš„è¯ï¼Œæ‰€æœ‰çš„ç´¢å¼•åˆ—éƒ½å¿…é¡»è¿›è¡Œç­‰å€¼æ¯”è¾ƒï¼‰ï¼Œåˆ™å¯¹è¯¥è¢«é©±åŠ¨è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯eq_ref</li></ul></li><li><p>ref</p><ul><li>å½“**<u>é€šè¿‡æ™®é€šçš„äºŒçº§ç´¢å¼•åˆ—ä¸å¸¸é‡è¿›è¡Œç­‰å€¼åŒ¹é…</u>**æ—¶æ¥æŸ¥è¯¢æŸä¸ªè¡¨ï¼Œé‚£ä¹ˆå¯¹è¯¥è¡¨çš„è®¿é—®æ–¹æ³•å°±å¯èƒ½æ˜¯ ref</li></ul></li><li><p>range</p><ul><li>å¦‚æœä½¿ç”¨ç´¢å¼•è·å–æŸäº› <u>èŒƒå›´åŒºé—´</u> çš„è®°å½•ï¼Œé‚£ä¹ˆå°±å¯èƒ½ä½¿ç”¨åˆ° range è®¿é—®æ–¹æ³•</li></ul></li><li><p>index</p><ul><li>å½“æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç´¢å¼•è¦†ç›–ï¼Œä½†éœ€è¦æ‰«æå…¨éƒ¨çš„ç´¢å¼•è®°å½•æ—¶ï¼Œè¯¥è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯ index</li></ul></li><li><p>all</p><ul><li>å…¨è¡¨æ‰«æ</li></ul></li></ul><h5 id="possible-keyså’Œkeyï¼š"><a href="#possible-keyså’Œkeyï¼š" class="headerlink" title="possible_keyså’Œkeyï¼š"></a>possible_keyså’Œkeyï¼š</h5><p>â€‹å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•ã€ç”¨åˆ°çš„ç´¢å¼•</p><h5 id="key-lenï¼š"><a href="#key-lenï¼š" class="headerlink" title="key_lenï¼š"></a>key_lenï¼š</h5><p>â€‹key_len åˆ—è¡¨ç¤ºå½“ä¼˜åŒ–å™¨å†³å®šä½¿ç”¨æŸä¸ªç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œè¯¥ç´¢å¼•è®°å½•çš„æœ€å¤§é•¿åº¦ï¼Œå®ƒæ˜¯ç”±è¿™ä¸‰ä¸ªéƒ¨åˆ†æ„æˆçš„ï¼š</p><ul><li>å¯¹äºä½¿ç”¨å›ºå®šé•¿åº¦ç±»å‹çš„ç´¢å¼•åˆ—æ¥è¯´ï¼Œå®ƒå®é™…å ç”¨çš„å­˜å‚¨ç©ºé—´çš„æœ€å¤§é•¿åº¦å°±æ˜¯è¯¥å›ºå®šå€¼ï¼Œå¯¹äºæŒ‡å®šå­—ç¬¦é›†çš„å˜é•¿ç±»å‹çš„ç´¢å¼•åˆ—æ¥è¯´ï¼Œæ¯”å¦‚æŸä¸ªç´¢å¼•åˆ—çš„ç±»å‹æ˜¯ VARCHAR(100) ï¼Œä½¿ç”¨çš„å­—ç¬¦é›†æ˜¯ utf8 ï¼Œé‚£ä¹ˆè¯¥åˆ—å®é™…å ç”¨çš„æœ€å¤§å­˜å‚¨ç©ºé—´å°±æ˜¯ 100 Ã— 3 &#x3D; 300 ä¸ªå­—èŠ‚ã€‚</li><li>å¦‚æœè¯¥ç´¢å¼•åˆ—å¯ä»¥å­˜å‚¨ NULL å€¼ï¼Œåˆ™ key_len æ¯”ä¸å¯ä»¥å­˜å‚¨ NULL å€¼æ—¶å¤š1ä¸ªå­—èŠ‚ã€‚</li><li>å¯¹äºå˜é•¿å­—æ®µæ¥è¯´ï¼Œéƒ½ä¼šæœ‰2ä¸ªå­—èŠ‚çš„ç©ºé—´æ¥å­˜å‚¨è¯¥å˜é•¿åˆ—çš„å®é™…é•¿åº¦ã€‚</li></ul><h5 id="refï¼š"><a href="#refï¼š" class="headerlink" title="refï¼š"></a>refï¼š</h5><p>å½“ä½¿ç”¨ç´¢å¼•åˆ—ç­‰å€¼åŒ¹é…çš„æ¡ä»¶å»æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œä¹Ÿå°±æ˜¯åœ¨<u>è®¿é—®æ–¹æ³•æ˜¯ const ã€ eq_ref ã€ ref ã€ ref_or_null ã€unique_subquery ã€ index_subquery å…¶ä¸­ä¹‹ä¸€æ—¶</u>ï¼Œ <u><strong>ref åˆ—å±•ç¤ºçš„å°±æ˜¯ä¸ç´¢å¼•åˆ—ä½œç­‰å€¼åŒ¹é…çš„ä¸œä¸œæ˜¯ä¸ªå•¥ï¼Œæ¯”å¦‚åªæ˜¯ä¸€ä¸ªå¸¸æ•°æˆ–è€…æ˜¯æŸä¸ªåˆ—ã€‚</strong></u></p><h5 id="rowsï¼š"><a href="#rowsï¼š" class="headerlink" title="rowsï¼š"></a>rowsï¼š</h5><p>â€‹å¦‚æœæŸ¥è¯¢ä¼˜åŒ–å™¨å†³å®šä½¿ç”¨å…¨è¡¨æ‰«æçš„æ–¹å¼å¯¹æŸä¸ªè¡¨æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œæ‰§è¡Œè®¡åˆ’çš„ rows åˆ—å°±ä»£è¡¨é¢„è®¡éœ€è¦æ‰«æçš„è¡Œæ•°ï¼Œå¦‚æœä½¿ç”¨ç´¢å¼•æ¥æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œæ‰§è¡Œè®¡åˆ’çš„ rows åˆ—å°±ä»£è¡¨é¢„è®¡æ‰«æçš„ç´¢å¼•è®°å½•è¡Œæ•°ã€‚</p><h5 id="Extraï¼š"><a href="#Extraï¼š" class="headerlink" title="Extraï¼š"></a>Extraï¼š</h5><p>â€‹é¡¾åæ€ä¹‰ï¼Œ Extra åˆ—æ˜¯ç”¨æ¥è¯´æ˜ä¸€äº›é¢å¤–ä¿¡æ¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›é¢å¤–ä¿¡æ¯æ¥æ›´å‡†ç¡®çš„<u><strong>ç†è§£ MySQL åˆ°åº•å°†å¦‚ä½•æ‰§è¡Œç»™å®šçš„æŸ¥è¯¢è¯­å¥ã€‚</strong></u></p><p>â€”å¤§å¤šæ•°æ˜¯æŠ¥é”™ä¿¡æ¯</p><ul><li>No tables used â€”â€” å½“æŸ¥è¯¢è¯­å¥çš„<u>æ²¡æœ‰ FROM å­å¥</u>æ—¶å°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯</li><li>Impossible WHERE â€”â€” æŸ¥è¯¢è¯­å¥çš„ WHERE å­å¥æ°¸è¿œä¸º FALSE æ—¶å°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯</li><li>No matching min&#x2F;max row â€”â€” å½“æŸ¥è¯¢åˆ—è¡¨å¤„æœ‰ MIN æˆ–è€… MAX èšé›†å‡½æ•°ï¼Œä½†æ˜¯<u>å¹¶æ²¡æœ‰ç¬¦åˆ WHERE å­å¥ä¸­çš„æœç´¢æ¡ä»¶çš„è®°å½•æ—¶ï¼Œå°†ä¼šæç¤ºè¯¥é¢å¤–ä¿¡æ¯ï¼Œ</u></li></ul><h3 id="ç´¢å¼•è°ƒä¼˜"><a href="#ç´¢å¼•è°ƒä¼˜" class="headerlink" title="ç´¢å¼•è°ƒä¼˜"></a>ç´¢å¼•è°ƒä¼˜</h3><ul><li><p>è™½ç„¶ä¾‹å¦‚æ€§åˆ«å­—æ®µåªæœ‰ä¸¤ä¸ªå–å€¼(æ¯”å¦‚ maleã€female)é€‰æ‹©æ€§ä½ï¼Œä½†æ˜¯å¦‚æœå‡ ä¹æ¯ä¸ªæŸ¥è¯¢éƒ½ä¼šç”¨åˆ°sexåˆ—çš„è¯ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å¯¹å…¶å»ºç«‹ç´¢å¼•ï¼Œå¹¶é€šè¿‡ä¸‹é¢çš„å°æŠ€å·§ï¼Œåœ¨æŸ¥è¯¢æ²¡æœ‰ä½¿ç”¨sexçš„åˆ—æ—¶ç»•è¿‡ï¼š</p><ul><li>åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­æ·»åŠ æ¡ä»¶ï¼šSEX IN (â€˜maleâ€™, â€˜femaleâ€™);å³å¯ï¼</li><li>ä¸Šé¢è¿™ç§æŠ€å·§åª<u><strong>é€‚ç”¨äºç»•è¿‡å»ºç«‹äº†ç´¢å¼•ä½†é€‰æ‹©æ€§ä½çš„åˆ—</strong></u></li></ul></li><li><p>å°½å¯èƒ½å°†éœ€è¦åšèŒƒå›´æŸ¥è¯¢çš„åˆ—(å¦‚ age)æ”¾åˆ°ç´¢å¼•çš„åé¢ï¼Œä»¥ä¾¿ä¼˜åŒ–å™¨èƒ½ä½¿ç”¨å°½å¯èƒ½å¤šçš„ç´¢å¼•åˆ—</p></li><li><p>å¦‚æœé‡åˆ°ä¸€æ¡sqlè¯­å¥ä¸­æœ‰ä¸¤ä¸ªèŒƒå›´æŸ¥è¯¢ï¼Œå¾ˆé—æ†¾ï¼Œå¹¶æ²¡æœ‰ç›´æ¥çš„ä¼˜åŒ–æ–¹å¼ã€‚æˆ‘ä»¬åªèƒ½é€šè¿‡ <u>æ„é€ æ–°åˆ—ã€è½¬æ¢æ¦‚å¿µ</u> ç­‰æ–¹å¼å°è¯•å°†æŸä¸€ä¸ªèŒƒå›´æŸ¥è¯¢è½¬æ¢ä¸ºç­‰å€¼æŸ¥è¯¢</p></li><li><p>ğŸŒŸå¯¹äºæµ·é‡æ•°æ®çš„åˆ†é¡µæŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼š</p><ul><li><p>å³ä½¿<u>æœ‰ç´¢å¼•</u>ï¼Œå¦‚æœç”¨æˆ·ç•Œé¢ä¸Šéœ€è¦ç¿»é¡µï¼Œå¹¶ä¸”ç¿»é¡µç¿»åˆ°æ¯”è¾ƒé åæ—¶æŸ¥è¯¢ä¹Ÿå¯èƒ½éå¸¸æ…¢ã€‚ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢å°±é€šè¿‡ ORDER BYå’Œ LIMIT åç§»é‡çš„ç»„åˆç¿»é¡µåˆ°å¾ˆåé¢çš„æ—¶å€™ :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT &lt;cols&gt; FROM profiles WHERE sex=&#x27;M&#x27;ORDER BY rating LIMIT 100000, 10</span><br></pre></td></tr></table></figure><p>æ— è®ºå¦‚ä½•åˆ›å»ºç´¢å¼•ï¼Œè¿™ç§æŸ¥è¯¢éƒ½æ˜¯ä¸ªä¸¥é‡çš„é—®é¢˜ã€‚**<u>å› ä¸ºéšç€åç§»é‡çš„å¢åŠ ï¼ŒMySQLéœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´æ¥æ‰«æéœ€è¦ä¸¢å¼ƒçš„æ•°æ®</u><strong>ã€‚åèŒƒå¼åŒ–ã€é¢„å…ˆè®¡ç®—å’Œç¼“å­˜å¯èƒ½æ˜¯è§£å†³è¿™ç±»æŸ¥è¯¢çš„ä»…æœ‰ç­–ç•¥ã€‚ä¸€ä¸ªæ›´å¥½çš„åŠæ³•æ˜¯é™åˆ¶ç”¨æˆ·èƒ½å¤Ÿç¿»é¡µçš„æ•°é‡ï¼Œå®é™…ä¸Šè¿™å¯¹ç”¨æˆ·ä½“éªŒçš„å½±å“ä¸å¤§ï¼Œå› ä¸ºç”¨æˆ·å¾ˆå°‘ä¼šçœŸæ­£åœ¨ä¹æœç´¢ç»“æœçš„ç¬¬ 10 000 é¡µã€‚<br>âš ï¸ä¼˜åŒ–è¿™ç±»ç´¢å¼•çš„å¦ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç­–ç•¥æ˜¯ä½¿ç”¨å»¶è¿Ÿå…³è”ï¼Œ</strong><u>é€šè¿‡ä½¿ç”¨è¦†ç›–ç´¢å¼•æŸ¥è¯¢è¿”å›éœ€è¦çš„ä¸»é”®ï¼Œå†æ ¹æ®è¿™äº›ä¸»é”®å…³è”åŸè¡¨è·å¾—éœ€è¦çš„è¡Œ</u>**ã€‚è¿™å¯ä»¥å‡å°‘ MySQL æ‰«æé‚£äº›éœ€è¦ä¸¢å¼ƒçš„è¡Œæ•°ã€‚ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢æ˜¾ç¤ºäº†å¦‚ä½•é«˜æ•ˆåœ°ä½¿ç”¨(sex, rating)ç´¢å¼•è¿›è¡Œæ’åºå’Œåˆ†é¡µã€‚</p></li><li><pre><code class="mysql">mysql&gt; SELECT &lt;cols&gt; FROM profiles where æŸä¸»é”®åˆ— in(  SELECT &lt; æŸä¸»é”®åˆ— &gt; FROM profiles  WHERE X.sex=&#39;M&#39; ORDER BY rating LIMIT 100000ï¼Œ10  );<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### SQLä¼˜åŒ–</span><br><span class="line"></span><br><span class="line">å‚è€ƒæ–‡ç« ï¼š[SQLä¼˜åŒ–ç¯‡:å¦‚ä½•æˆä¸ºä¸€ä½å†™ä¼˜è´¨SQLè¯­å¥çš„ç»é¡¶é«˜æ‰‹!](https://juejin.cn/post/7163894728201601060#heading-7)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### MySQLæ€§èƒ½ä¼˜åŒ–</span><br><span class="line"></span><br><span class="line">&lt;img src=&quot;https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230816135517270.png&quot; alt=&quot;image-20230816135517270&quot; style=&quot;zoom:33%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">- **SQL è¯­å¥å’Œç´¢å¼•ç›¸å…³é—®é¢˜æ˜¯æœ€å¸¸è§çš„ï¼Œå¸¦æ¥çš„ä»·å€¼ä¹Ÿæ˜¯æœ€æ˜æ˜¾çš„**ï¼›</span><br><span class="line">- ç³»ç»Ÿé…ç½®åº“è¡¨ç»“æ„å¸¦æ¥çš„ä»·å€¼æ¬¡ä¹‹ï¼›</span><br><span class="line">- è€Œç¡¬ä»¶å±‚æ¬¡çš„ä¼˜åŒ–ä¼˜å…ˆçº§æ˜¯ä¸é«˜çš„ã€‚</span><br><span class="line"></span><br><span class="line">#### 1. ç¡¬ä»¶é…ç½®ï¼š</span><br><span class="line"></span><br><span class="line">ç°åœ¨æˆ‘ä»¬åŸºæœ¬ä¸Šéƒ½æ˜¯ä½¿ç”¨äº‘æœåŠ¡å™¨ï¼Œå°±ä¼šæ¶‰åŠæœåŠ¡å™¨é…ç½®é€‰å‹ï¼Œå¯¹äºæ•°æ®åº“å¤„ç†å¤æ‚ SQL è€Œè¨€ï¼Œå°½é‡é€‰æ‹©é«˜é¢‘ CPUï¼Œè€Œä¸”æ•°æ®åº“ä¸€èˆ¬éƒ½ä¼š**å¼€è¾Ÿç¼“å­˜æ± æ¥å­˜æ”¾æ•°æ®**ï¼Œæ‰€ä»¥åœ¨æœåŠ¡å™¨é€‰å‹çš„æ—¶å€™å†…å­˜å¤§å°ä¹Ÿéœ€è¦è€ƒè™‘ã€‚ä¸€èˆ¬æ¥è¯´**æ•°æ®åº“æœåŠ¡å™¨çš„ç¡¬ä»¶é…ç½®çš„é‡è¦æ€§é«˜äºåº”ç”¨æœåŠ¡å™¨é…ç½®**ï¼Œè¿™æ–¹é¢äº†è§£ä¸‹å³å¯ï¼Œæµ‹è¯•å·¥ä½œåŸºæœ¬ä¸Šä¸ä¼šæ¶‰åŠæ•°æ®åº“æœåŠ¡å™¨çš„é€‰å‹ï¼Œè€Œä¸”ä¸€æ—¦é€‰å‹å›ºå®šä¹‹åä¸ä¼šè½»æ˜“æ”¹å˜æ•°æ®åº“çš„ç¡¬ä»¶é…ç½®ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 2. MySQLç³»ç»Ÿé…ç½®é€‰é¡¹ï¼š</span><br><span class="line"></span><br><span class="line">##### 1ï¼‰max_connections</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªå‚æ•°è¡¨ç¤º MySQL å¯ä»¥**æ¥æ”¶åˆ°çš„æœ€å¤§è¿æ¥æ•°**ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</span><br><span class="line"></span><br><span class="line">```sql</span><br><span class="line">show variables like &#x27;%max_connections%&#x27;;</span><br></pre></td></tr></table></figure></code></pre></li></ul></li></ul><p>å¦‚æœ max_connections çš„å€¼è®¾ç½®è¾ƒå°ï¼Œåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹æ˜“å‡ºç° â€œ<strong>too many connections</strong>â€ è¿™æ ·çš„æŠ¥é”™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è°ƒèŠ‚é…ç½®ä»è€Œå‡å°‘æ­¤é—®é¢˜çš„å‘ç”Ÿï¼Œä½ å¯ä»¥æ ¹æ®æ‰€åœ¨å…¬å¸çš„å®é™…æƒ…å†µè¿›è¡Œé…ç½®ã€‚</p><h5 id="2ï¼‰innodb-buffer-pool-size"><a href="#2ï¼‰innodb-buffer-pool-size" class="headerlink" title="2ï¼‰innodb_buffer_pool_size"></a>2ï¼‰innodb_buffer_pool_size</h5><p>è¿™ä¸ªå‚æ•°å®é™…å®šä¹‰äº† <strong>InnoDB å­˜å‚¨å¼•æ“ä¸‹ MySQL çš„å†…å­˜ç¼“å†²åŒº(buffer_pool)å¤§å°</strong></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¡ç®—ç¼“å­˜å‘½ä¸­ç‡æ¥åˆ¤æ–­ï¼Œå…¬å¼ä¸ºï¼š</p><blockquote><p>(1-innodb_buffer_pool_reads &#x2F; innodb_buffer_pool_read_request) * 100</p></blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<strong>å½“ç¼“å­˜å‘½ä¸­ç‡ä½äº 90% å°±è¯´æ˜éœ€è¦åŠ å¤§ç¼“å†²æ± äº†ã€‚</strong></p><p>å…³äºå…¬å¼ä¸­çš„ä¸¤ä¸ªå˜é‡çš„æŸ¥çœ‹æ–¹å¼ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤ä½ å°±å¯ä»¥è·å¾—ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">show</span> status <span class="keyword">like</span>  <span class="string">&#x27;Innodb_buffer_pool_read_%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------------+----------+</span></span><br><span class="line"></span><br><span class="line"><span class="operator">|</span> Variable_name                         <span class="operator">|</span> <span class="keyword">Value</span>    <span class="operator">|</span></span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------------+----------+</span></span><br><span class="line"></span><br><span class="line"><span class="operator">|</span> Innodb_buffer_pool_read_ahead_rnd     <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"></span><br><span class="line"><span class="operator">|</span> Innodb_buffer_pool_read_ahead         <span class="operator">|</span> <span class="number">51</span>       <span class="operator">|</span></span><br><span class="line"></span><br><span class="line"><span class="operator">|</span> Innodb_buffer_pool_read_ahead_evicted <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"></span><br><span class="line"><span class="operator">|</span> Innodb_buffer_pool_read_requests      <span class="operator">|</span> <span class="number">25688179</span> <span class="operator">|</span></span><br><span class="line"></span><br><span class="line"><span class="operator">|</span> Innodb_buffer_pool_reads              <span class="operator">|</span> <span class="number">2171</span>     <span class="operator">|</span></span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------------+----------+</span></span><br></pre></td></tr></table></figure><h4 id="3-SQL-ä¼˜åŒ–"><a href="#3-SQL-ä¼˜åŒ–" class="headerlink" title="3. SQL ä¼˜åŒ–"></a>3. SQL ä¼˜åŒ–</h4><p>å¸¸è§çš„é—®é¢˜æ˜¯ç´¢å¼•ç¼ºå¤±ã€ç´¢å¼•å¤±æ•ˆ</p><p>â€‹é€ æˆçš„åŸå› åˆ†åˆ«æ˜¯ï¼šæ·»åŠ æ¡ä»¶åˆ¤æ–­çš„å­—æ®µæœªå»ºç«‹ç´¢å¼•ã€æ·»åŠ äº†ç´¢å¼•ä½†æœªç”Ÿæ•ˆï¼Œå…·ä½“å†…å®¹å‰é¢ã€Œç´¢å¼•ã€ç« èŠ‚è¯¦ç»†ä»‹ç»è¿‡ã€‚</p><p>â€‹æŸ¥çœ‹sqlè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¯¹å…¶ç´¢å¼•ä½¿ç”¨æƒ…å†µè¿›è¡Œåˆ†æï¼Œå…·ä½“å†…å®¹åœ¨ã€Œexplainæ‰§è¡Œè®¡åˆ’ã€ä¸­è¯¦ç»†ä»‹ç»è¿‡ã€‚</p><p>æœ¬åšå®¢å¯¹ä»¥ä¸‹æ–‡ç« æœ‰å‚è€ƒå€Ÿé‰´ï¼Œååˆ†æ„Ÿè°¢è¿™äº›ä½œè€…çš„æ–‡ç« ğŸ™ï¼š</p><ul><li><p>æ‰§è¡Œä¸€æ¡ select è¯­å¥ï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ<a href="https://xiaolincoding.com/mysql/base/how_select.html)https://xiaolincoding.com/mysql/base/how_select.html">https://xiaolincoding.com/mysql/base/how_select.html)https://xiaolincoding.com/mysql/base/how_select.html</a></p></li><li><p>MySQLå¼•æ“ç¯‡ï¼š<a href="https://juejin.cn/post/7151275584218202143">https://juejin.cn/post/7151275584218202143</a></p></li><li><p>MySQL ä¸€è¡Œè®°å½•æ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Ÿ<a href="https://xiaolincoding.com/mysql/base/row_format.html">https://xiaolincoding.com/mysql/base/row_format.html</a></p></li><li><p>MySQLä¸­charä¸varcharçš„åŒºåˆ«ï¼šå­˜å‚¨æœºåˆ¶ã€æ€§èƒ½å·®å¼‚ï¼š<a href="https://www.maoyingdong.com/mysql-char-vs-varchar/">https://www.maoyingdong.com/mysql-char-vs-varchar/</a></p></li><li><p>ä»æ•°æ®é¡µçš„è§’åº¦çœ‹ B+ æ ‘ï¼š<a href="https://xiaolincoding.com/mysql/index/page.html">https://xiaolincoding.com/mysql/index/page.html</a></p></li><li><p>æ­å¼€ Buffer Pool çš„é¢çº±ï¼š<a href="https://xiaolincoding.com/mysql/buffer_pool/buffer_pool.html">https://xiaolincoding.com/mysql/buffer_pool/buffer_pool.html</a></p></li><li><p>æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œåº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿ<a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2">https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2</a></p></li><li><p><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%98%E5%AE%9D%E5%85%B8">https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%98%E5%AE%9D%E5%85%B8</a></p><ul><li>08 ç´¢å¼•ï¼šæ’åºçš„è‰ºæœ¯</li><li>09 ç´¢å¼•ç»„ç»‡è¡¨ï¼šä¸‡ç‰©çš†ç´¢å¼•</li><li>10 ç»„åˆç´¢å¼•ï¼šç”¨å¥½ï¼Œæ€§èƒ½æå‡ 10 å€ï¼</li><li>11 ç´¢å¼•å‡ºé”™ï¼šè¯·ç†è§£ CBO çš„å·¥ä½œåŸç†</li><li>18 å¦‚ä½•æ‰èƒ½ä¼˜åŒ– MySQL æ€§èƒ½ï¼Ÿ</li><li>21 æ•°æ®åº“å¤‡ä»½ï¼šå¤‡ä»½æ–‡ä»¶ä¹Ÿè¦æ£€æŸ¥ï¼</li></ul></li><li><p>ä¸ºä»€ä¹ˆ MySQL é‡‡ç”¨ B+ æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿ<a href="https://xiaolincoding.com/mysql/index/why_index_chose_bpuls_tree.html">https://xiaolincoding.com/mysql/index/why_index_chose_bpuls_tree.html</a></p></li><li><p>ç´¢å¼•å¤±æ•ˆæœ‰å“ªäº›ï¼Ÿ<a href="https://xiaolincoding.com/mysql/index/index_lose.html">https://xiaolincoding.com/mysql/index/index_lose.html</a></p></li><li><p>å»ºç«‹ç´¢å¼•çš„æ­£ç¡®å§¿åŠ¿ä¸ä½¿ç”¨ç´¢å¼•çš„æœ€ä½³æŒ‡å—ï¼<a href="https://juejin.cn/post/7149074488649318431">https://juejin.cn/post/7149074488649318431</a></p></li><li><p>ç´¢å¼•å¸¸è§é¢è¯•é¢˜ï¼š<a href="https://xiaolincoding.com/mysql/index/index_interview.html">https://xiaolincoding.com/mysql/index/index_interview.html</a></p></li><li><p>äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ<a href="https://xiaolincoding.com/mysql/transaction/mvcc.html">https://xiaolincoding.com/mysql/transaction/mvcc.html</a></p></li><li><p>MySQL å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨è§£å†³å¹»è¯»äº†å—ï¼Ÿ<a href="https://xiaolincoding.com/mysql/transaction/phantom.html">https://xiaolincoding.com/mysql/transaction/phantom.html</a></p></li><li><p>MySQL æœ‰å“ªäº›é”ï¼Ÿ<a href="https://xiaolincoding.com/mysql/lock/mysql_lock.html">https://xiaolincoding.com/mysql/lock/mysql_lock.html</a></p></li><li><p>MySQL æ˜¯æ€ä¹ˆåŠ é”çš„ï¼Ÿ(æ ¡æ‹›å¯ä¸æŒæ¡)<a href="https://xiaolincoding.com/mysql/lock/how_to_lock.html">https://xiaolincoding.com/mysql/lock/how_to_lock.html</a></p></li><li><p>MySQL æ­»é”äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ<a href="https://xiaolincoding.com/mysql/lock/deadlock.html">https://xiaolincoding.com/mysql/lock/deadlock.html</a></p></li><li><p>å­—èŠ‚é¢è¯•ï¼šåŠ äº†ä»€ä¹ˆé”ï¼Œå¯¼è‡´æ­»é”çš„ï¼Ÿ<a href="https://xiaolincoding.com/mysql/lock/show_lock.html">https://xiaolincoding.com/mysql/lock/show_lock.html</a></p></li><li><p>MySQL æ—¥å¿—ï¼šundo logã€redo logã€binlog æœ‰ä»€ä¹ˆç”¨ï¼Ÿ<a href="https://xiaolincoding.com/mysql/log/how_update.html">https://xiaolincoding.com/mysql/log/how_update.html</a></p></li><li><p><a href="https://tech.meituan.com/2014/08/20/innodb-lock.html">å¥½æ–‡æ¨è</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ç›¸å…³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> åŸç†å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC</title>
      <link href="/2023/07/27/SpringMVC/"/>
      <url>/2023/07/27/SpringMVC/</url>
      
        <content type="html"><![CDATA[<p>æœ¬åšå®¢æ˜¯æ ¹æ®éŸ©é¡ºå¹³è€å¸ˆçš„SpingMVCè¯¾ç¨‹è¿›è¡Œçš„çŸ¥è¯†æ€»ç»“ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Springå¼€å‘æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯å¼€å‘ </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®æ“ä¸­é‡åˆ°çš„åç«¯å¼€å‘ç›¸å…³é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</title>
      <link href="/2023/07/24/%E5%AE%9E%E6%93%8D%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
      <url>/2023/07/24/%E5%AE%9E%E6%93%8D%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<h1 id="javaï¼š"><a href="#javaï¼š" class="headerlink" title="javaï¼š"></a>javaï¼š</h1><h3 id="æµçš„ä½¿ç”¨ï¼š"><a href="#æµçš„ä½¿ç”¨ï¼š" class="headerlink" title="æµçš„ä½¿ç”¨ï¼š"></a>æµçš„ä½¿ç”¨ï¼š</h3><ol><li>éœ€æ±‚ï¼šå°†å¾—åˆ°çš„å¯¹è±¡List æ ¹æ®æŸä¸€å±æ€§è¿›è¡Œåˆ†ç»„(ä¾‹å¦‚ä½ éœ€è¦æ ¹æ®åˆ†åˆ«å¯¹äº§å“idçš„æ¯ç§æƒ…å†µè¿›è¡Œè®¨è®º)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// ç”¨äºå­˜å‚¨ä»æ¯æ¡è®°å½•ä¸­å¾—åˆ°çš„æœ‰æ•ˆä¿¡æ¯</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InfoDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long equipmentId;</span><br><span class="line">    <span class="keyword">private</span> Boolean isSuccess;</span><br><span class="line">    <span class="keyword">private</span> Date actingTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">InfoDTO</span><span class="params">(Long equipmentId, Date actingTime)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.equipmentId = equipmentId;</span><br><span class="line">        <span class="built_in">this</span>.actingTime = actingTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">InfoDTO</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ArrayList&lt;InfoDTO&gt; successInfo = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//å¡«å……successInfoï¼Œæ­¤å¤„çœç•¥       </span></span><br><span class="line">Map&lt;Long,List&lt;InfoDTO&gt;&gt; groupedList = successInfo.stream().collect(Collectors.groupingBy(InfoDTO::getEquipmentId));</span><br></pre></td></tr></table></figure><h3 id="Mapä¸­ï¼Œå€¼çš„è‡ªå¢ã€è‡ªå‡æ“ä½œçš„ç®€å•å†™æ³•ï¼š"><a href="#Mapä¸­ï¼Œå€¼çš„è‡ªå¢ã€è‡ªå‡æ“ä½œçš„ç®€å•å†™æ³•ï¼š" class="headerlink" title="Mapä¸­ï¼Œå€¼çš„è‡ªå¢ã€è‡ªå‡æ“ä½œçš„ç®€å•å†™æ³•ï¼š"></a>Mapä¸­ï¼Œå€¼çš„è‡ªå¢ã€è‡ªå‡æ“ä½œçš„ç®€å•å†™æ³•ï¼š</h3><p>åº”ç”¨åœºæ™¯ï¼šæŸ¥è¯¢Mapä¸­çš„æŸä¸€keyå€¼ï¼Œå¦‚æœæœ‰å°±+1ï¼Œå¦‚æœæ²¡æœ‰å°±putè¿›value &#x3D; 1</p><p>ğŸŒåŸæœ¬çš„å†™æ³•ï¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨keyï¼Œå¦‚æœå­˜åœ¨åˆ™å–å‡ºvalueï¼Œ + 1åå†putå›å»ï¼›å¦‚æœæ²¡æœ‰å°±put(keyï¼Œ1)è¿›å…¥</p><p>ç°åœ¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map.put(<span class="string">&quot;ä½ è¦æ‰¾çš„key&quot;</span>, map.getOrDefault(<span class="string">&quot;ä½ è¦æ‰¾çš„key&quot;</span>, <span class="number">0</span>) + <span class="number">1</span>);</span><br></pre></td></tr></table></figure><h3 id="å°†æœ¬åœ°ä»£ç æ‰“jaråŒ…ä¸Šä¼ æœåŠ¡å™¨å¹¶æµ‹è¯•è¿è¡Œï¼š"><a href="#å°†æœ¬åœ°ä»£ç æ‰“jaråŒ…ä¸Šä¼ æœåŠ¡å™¨å¹¶æµ‹è¯•è¿è¡Œï¼š" class="headerlink" title="å°†æœ¬åœ°ä»£ç æ‰“jaråŒ…ä¸Šä¼ æœåŠ¡å™¨å¹¶æµ‹è¯•è¿è¡Œï¼š"></a>å°†æœ¬åœ°ä»£ç æ‰“jaråŒ…ä¸Šä¼ æœåŠ¡å™¨å¹¶æµ‹è¯•è¿è¡Œï¼š</h3><h4 id="1-å°†æœ¬åœ°é¡¹ç›®ä»£ç æ‰“jaråŒ…-ideaä¸­"><a href="#1-å°†æœ¬åœ°é¡¹ç›®ä»£ç æ‰“jaråŒ…-ideaä¸­" class="headerlink" title="1.å°†æœ¬åœ°é¡¹ç›®ä»£ç æ‰“jaråŒ…(ideaä¸­)"></a>1.å°†æœ¬åœ°é¡¹ç›®ä»£ç æ‰“jaråŒ…(ideaä¸­)</h4><ul><li>Command + ; æ‰“å¼€é¡¹ç›®ç»“æ„ç•Œé¢ï¼Œåˆ›å»ºjaråŒ…</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231215140746859.png" alt="image-20231215140746859"></p><ul><li>è¿›å…¥é¡µé¢åï¼Œé€‰æ‹©éœ€è¦åˆ›å»ºjaråŒ…çš„ä¸»ç±»ï¼Œç‚¹å‡»ç¡®å®šåå†åº”ç”¨</li></ul><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231215141013951.png" alt="image-20231215141013951" style="zoom: 50%;" /><ul><li>ä¹‹åå†æ ¹æ®éœ€è¦æ„å»ºå·¥ä»¶å³å¯åœ¨ç”Ÿæˆç›®å½•ä¸­å¾—åˆ°jaråŒ…</li></ul><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231215141350692.png" alt="image-20231215141350692" style="zoom:50%;" /><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231215141517041.png" alt="image-20231215141517041" style="zoom:50%;" /><h4 id="2-å°†jaråŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨æŒ‡å®šç›®å½•"><a href="#2-å°†jaråŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨æŒ‡å®šç›®å½•" class="headerlink" title="2.å°†jaråŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨æŒ‡å®šç›®å½•"></a>2.å°†jaråŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨æŒ‡å®šç›®å½•</h4><ul><li>ä½¿ç”¨sftpä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œä½¿ç”¨putæ–¹æ³•å°†æœ¬åœ°jaråŒ…ä¸Šä¼ è‡³æœåŠ¡å™¨</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">put localfilepath remotefilepath</span><br></pre></td></tr></table></figure><h4 id="3-åœ¨æœåŠ¡å™¨å¯¹åº”ç›®å½•è¿è¡ŒjaråŒ…è¿›è¡Œæµ‹è¯•"><a href="#3-åœ¨æœåŠ¡å™¨å¯¹åº”ç›®å½•è¿è¡ŒjaråŒ…è¿›è¡Œæµ‹è¯•" class="headerlink" title="3.åœ¨æœåŠ¡å™¨å¯¹åº”ç›®å½•è¿è¡ŒjaråŒ…è¿›è¡Œæµ‹è¯•"></a>3.åœ¨æœåŠ¡å™¨å¯¹åº”ç›®å½•è¿è¡ŒjaråŒ…è¿›è¡Œæµ‹è¯•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar xxxx.jar</span><br></pre></td></tr></table></figure><h1 id="æ•°æ®åº“ï¼š"><a href="#æ•°æ®åº“ï¼š" class="headerlink" title="æ•°æ®åº“ï¼š"></a>æ•°æ®åº“ï¼š</h1><h3 id="åŠ¨æ€æŸ¥è¯¢ï¼š"><a href="#åŠ¨æ€æŸ¥è¯¢ï¼š" class="headerlink" title="åŠ¨æ€æŸ¥è¯¢ï¼š"></a>åŠ¨æ€æŸ¥è¯¢ï¼š</h3><h5 id="éœ€æ±‚ï¼š"><a href="#éœ€æ±‚ï¼š" class="headerlink" title="éœ€æ±‚ï¼š"></a>éœ€æ±‚ï¼š</h5><p>â€‹æœ‰è®¸å¤šåŒç±»å‹çš„è¡¨(è¡¨åå‰ç¼€ç›¸åŒï¼Œéƒ½æ˜¯ç±»ä¼¼äºxxxx202209 â€“&gt; å…¬å…±å‰ç¼€+å¹´æœˆä¿¡æ¯)ï¼Œç”±äºæ•°æ®é‡åºå¤§æŒ‰æœˆä»½åˆ†æˆäº†å¤šå¼ è¡¨ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å‰ç«¯è¯·æ±‚ä¸­æºå¸¦çš„å¹´æœˆä¿¡æ¯å»æŸ¥è¯¢ä¸åŒçš„è¡¨</p><h5 id="å®ç°æ–¹æ¡ˆï¼š"><a href="#å®ç°æ–¹æ¡ˆï¼š" class="headerlink" title="å®ç°æ–¹æ¡ˆï¼š"></a>å®ç°æ–¹æ¡ˆï¼š</h5><p>â€‹ä½¿ç”¨æ‹¦æˆªå™¨ï¼Œ(æŒ‰ç…§æˆ‘ç›®å‰çš„ç†è§£ã€‚ã€‚)å¯¹æ•°æ®åº“æŸ¥è¯¢è¯­å¥è¿›è¡Œæ‹¦æˆªï¼Œå½“æŸ¥è¯¢è¡¨åä¸ºå…¬å…±å‰ç¼€æ—¶ï¼Œå°±è·å–è¯·æ±‚å¤´ä¼ æ¥çš„æ—¥æœŸä¿¡æ¯ï¼Œå‡­å€Ÿæˆå®Œæ•´çš„è¡¨åï¼Œå»å¯¹åº”çš„è¡¨ä¸­æŸ¥è¯¢ï¼</p><h5 id="ç¤ºä¾‹ä»£ç ï¼š"><a href="#ç¤ºä¾‹ä»£ç ï¼š" class="headerlink" title="ç¤ºä¾‹ä»£ç ï¼š"></a>ç¤ºä¾‹ä»£ç ï¼š</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xxx.springbootinit.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.DynamicTableNameInnerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> miemie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2018-08-10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.nrec.springbootinit.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="type">DynamicTableNameInnerInterceptor</span> <span class="variable">dynamicTableNameInnerInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DynamicTableNameInnerInterceptor</span>();</span><br><span class="line">        dynamicTableNameInnerInterceptor.setTableNameHandler((sql, tableName) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;è¿™é‡Œå¡«å“ªäº›ç›¸åŒç»“æ„è¡¨åçš„å…¬å…±å‰ç¼€&quot;</span>.equals(tableName)) &#123;</span><br><span class="line">              <span class="comment">//è¿™é‡Œï¼Œæˆ‘åœ¨controllerä¸­ï¼Œç”¨æˆ·è¯·æ±‚æ—¶ï¼Œå°±å°†dateä¿¡æ¯å­˜æ”¾åœ¨è¯·æ±‚å‚æ•°ä¼ é€’è¾…åŠ©ç±»çš„ map ä¸­ï¼Œå› æ­¤åœ¨è¿™é‡Œå¯ä»¥è·å–</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">dateSuf</span> <span class="operator">=</span> RequestDataHelper.getRequestData(<span class="string">&quot;date&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;å…¬å…±å‰ç¼€&quot;</span> + dateSuf;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">//å¦‚æœä¸æ˜¯æˆ‘è¦æŸ¥è¯¢çš„è¡¨ï¼Œé‚£ä¹ˆå°±è¿˜æ˜¯æŒ‰åŸæ¥çš„è¡¨åæŸ¥è¯¢</span></span><br><span class="line">                <span class="keyword">return</span> tableName;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        interceptor.addInnerInterceptor(dynamicTableNameInnerInterceptor);</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.xxx.springbootinit.config;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯·æ±‚å‚æ•°ä¼ é€’è¾…åŠ©ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDataHelper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯·æ±‚å‚æ•°å­˜å–</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Map&lt;String, Object&gt;&gt; REQUEST_DATA = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestData è¯·æ±‚å‚æ•° MAP å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setRequestData</span><span class="params">(Map&lt;String, Object&gt; requestData)</span> &#123;</span><br><span class="line">        REQUEST_DATA.set(requestData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¯·æ±‚å‚æ•° MAP å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getRequestData</span><span class="params">(String param)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; dataMap = getRequestData();</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isNotEmpty(dataMap)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (T) dataMap.get(param);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¯·æ±‚å‚æ•° MAP å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title function_">getRequestData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> REQUEST_DATA.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//controllerå±‚ç¤ºä¾‹æ¥å£ï¼š</span></span><br><span class="line"> <span class="meta">@GetMapping(&quot;/query&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResultDTO <span class="title function_">query</span><span class="params">(<span class="meta">@RequestParam(&quot;date&quot;)</span>String date)</span>&#123;</span><br><span class="line">        RequestDataHelper.setRequestData(<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;() &#123;&#123;</span><br><span class="line">            put(<span class="string">&quot;date&quot;</span>, date);&#125;&#125;);</span><br><span class="line">      <span class="comment">//ç»§ç»­å†™ä¸šåŠ¡ã€‚ã€‚ã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux:"></a>Linux:</h1><h3 id="xxx-ç”¨æˆ·å-ä¸åœ¨-sudoersæ–‡ä»¶ä¸­ï¼Œæ­¤äº‹å°†è¢«æŠ¥å‘Š-è§£å†³æ–¹æ¡ˆ"><a href="#xxx-ç”¨æˆ·å-ä¸åœ¨-sudoersæ–‡ä»¶ä¸­ï¼Œæ­¤äº‹å°†è¢«æŠ¥å‘Š-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="xxx(ç”¨æˆ·å) ä¸åœ¨ sudoersæ–‡ä»¶ä¸­ï¼Œæ­¤äº‹å°†è¢«æŠ¥å‘Š è§£å†³æ–¹æ¡ˆ"></a>xxx(ç”¨æˆ·å) ä¸åœ¨ sudoersæ–‡ä»¶ä¸­ï¼Œæ­¤äº‹å°†è¢«æŠ¥å‘Š è§£å†³æ–¹æ¡ˆ</h3><p>æ‰§è¡Œ<strong>sudo</strong>æ—¶æç¤ºâ€œXXX ä¸åœ¨sudoersæ–‡ä»¶ä¸­ï¼Œæ­¤äº‹å°†è¢«æŠ¥å‘Šâ€</p><p><strong>è§£é‡Š</strong>ï¼šsudoå‘½ä»¤å¯ä»¥è®©ä½ ä»¥rootèº«ä»½æ‰§è¡Œå‘½ä»¤ï¼Œæ¥å®Œæˆä¸€äº›æˆ‘ä»¬è¿™ä¸ªè´¦å·å®Œæˆä¸äº†çš„ä»»åŠ¡ã€‚ä½†æ˜¯å¹¶éæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½å¤Ÿæ‰§è¡Œsudoï¼Œå› ä¸ºæœ‰æƒé™çš„ç”¨æˆ·éƒ½åœ¨&#x2F;etc&#x2F;sudoersä¸­ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆï¼š"><a href="#è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼š"></a>è§£å†³æ–¹æ¡ˆï¼š</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231215161542383.png" alt="image-20231215161542383" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›®å¼€å‘ </tag>
            
            <tag> ç»éªŒæ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring</title>
      <link href="/2023/07/16/Spring/"/>
      <url>/2023/07/16/Spring/</url>
      
        <content type="html"><![CDATA[<p> æœ¬åšå®¢å‚ç…§äº†éŸ©é¡ºå¹³è€å¸ˆçš„ Spring è¯¾ç¨‹è®²ä¹‰ï¼</p><h1 id="1-Spring-åŸºæœ¬ä»‹ç»"><a href="#1-Spring-åŸºæœ¬ä»‹ç»" class="headerlink" title="1 Spring åŸºæœ¬ä»‹ç»"></a>1 Spring åŸºæœ¬ä»‹ç»</h1><h2 id="1-1-å®˜æ–¹èµ„æ–™"><a href="#1-1-å®˜æ–¹èµ„æ–™" class="headerlink" title="1.1 å®˜æ–¹èµ„æ–™"></a>1.1 å®˜æ–¹èµ„æ–™</h2><h3 id="1-1-1-å®˜ç½‘-https-spring-io"><a href="#1-1-1-å®˜ç½‘-https-spring-io" class="headerlink" title="1.1.1 å®˜ç½‘ https://spring.io/"></a>1.1.1 å®˜ç½‘ <a href="https://spring.io/">https://spring.io/</a></h3><h3 id="1-1-2-Spring5-ä¸‹è½½"><a href="#1-1-2-Spring5-ä¸‹è½½" class="headerlink" title="1.1.2 Spring5 ä¸‹è½½"></a>1.1.2 Spring5 ä¸‹è½½</h3><p>â€¦â€¦</p><h3 id="1-1-3-åœ¨çº¿æ–‡æ¡£-https-docs-spring-io-spring-framework-docs-current-reference-html"><a href="#1-1-3-åœ¨çº¿æ–‡æ¡£-https-docs-spring-io-spring-framework-docs-current-reference-html" class="headerlink" title="1.1.3 åœ¨çº¿æ–‡æ¡£: https://docs.spring.io/spring-framework/docs/current/reference/html/"></a>1.1.3 åœ¨çº¿æ–‡æ¡£: <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/">https://docs.spring.io/spring-framework/docs/current/reference/html/</a></h3><h3 id="1-1-4-ç¦»çº¿æ–‡æ¡£-è§£å‹-spring-5-3-8-dist-zipspring-framework-5-3-8-docs-reference-html-index-html"><a href="#1-1-4-ç¦»çº¿æ–‡æ¡£-è§£å‹-spring-5-3-8-dist-zipspring-framework-5-3-8-docs-reference-html-index-html" class="headerlink" title="1.1.4 ç¦»çº¿æ–‡æ¡£ : è§£å‹ spring-5.3.8-dist.zipspring-framework-5.3.8\docs\reference\html\index.html"></a>1.1.4 ç¦»çº¿æ–‡æ¡£ : è§£å‹ spring-5.3.8-dist.zipspring-framework-5.3.8\docs\reference\html\index.html</h3><h3 id="1-1-5-ç¦»çº¿API-è§£å‹-spring-5-3-8-dist-zipspring-framework-5-3-8-docs-javadoc-api-index-html"><a href="#1-1-5-ç¦»çº¿API-è§£å‹-spring-5-3-8-dist-zipspring-framework-5-3-8-docs-javadoc-api-index-html" class="headerlink" title="1.1.5 ç¦»çº¿API: è§£å‹ spring-5.3.8-dist.zipspring-framework-5.3.8\docs\javadoc-api\index.html"></a>1.1.5 ç¦»çº¿API: è§£å‹ spring-5.3.8-dist.zipspring-framework-5.3.8\docs\javadoc-api\index.html</h3><h2 id="1-2-Spring-å­¦ä¹ çš„æ ¸å¿ƒå†…å®¹"><a href="#1-2-Spring-å­¦ä¹ çš„æ ¸å¿ƒå†…å®¹" class="headerlink" title="1.2 Spring å­¦ä¹ çš„æ ¸å¿ƒå†…å®¹"></a>1.2 Spring å­¦ä¹ çš„æ ¸å¿ƒå†…å®¹</h2><p>ä¸€å›¾èƒœåƒè¨€</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230716213809556.png" alt="image-20230716213809556"></p><p>è€éŸ©è§£è¯»ä¸Šå›¾:</p><p>1ã€Spring æ ¸å¿ƒå­¦ä¹ å†…å®¹ IOCã€AOP, jdbcTemplate, å£°æ˜å¼äº‹åŠ¡</p><p>2ã€IOC: æ§åˆ¶åè½¬ , å¯ä»¥ç®¡ç† java å¯¹è±¡</p><p>3ã€AOP : åˆ‡é¢ç¼–ç¨‹</p><p>4ã€ JDBCTemplate : æ˜¯ spring æä¾›ä¸€å¥—è®¿é—®æ•°æ®åº“çš„æŠ€æœ¯, åº”ç”¨æ€§å¼ºï¼Œç›¸å¯¹å¥½ç†è§£</p><p>5ã€å£°æ˜å¼äº‹åŠ¡: åŸºäº ioc&#x2F;aop å®ç°äº‹åŠ¡ç®¡ç†, ç†è§£éœ€è¦å°ä¼™ä¼´èŠ±æ—¶é—´</p><p>6ã€IOC, AOP æ˜¯é‡ç‚¹åŒæ—¶éš¾ç‚¹</p><h2 id="1-3-Spring-å‡ ä¸ªé‡è¦æ¦‚å¿µ"><a href="#1-3-Spring-å‡ ä¸ªé‡è¦æ¦‚å¿µ" class="headerlink" title="1.3 Spring å‡ ä¸ªé‡è¦æ¦‚å¿µ"></a>1.3 Spring å‡ ä¸ªé‡è¦æ¦‚å¿µ</h2><ol><li>Spring å¯ä»¥æ•´åˆå…¶ä»–çš„æ¡†æ¶(è€éŸ©è§£è¯»: Spring æ˜¯ç®¡ç†æ¡†æ¶çš„æ¡†æ¶)</li><li>Spring æœ‰ä¸¤ä¸ªæ ¸å¿ƒçš„æ¦‚å¿µ: <strong>IOC</strong> å’Œ <strong>AOP</strong></li><li>IOC [Inversion Of Control åè½¬æ§åˆ¶]</li></ol><h3 id="â—-ä¼ ç»Ÿçš„å¼€å‘æ¨¡å¼-JdbcUtils-x2F-åå°„"><a href="#â—-ä¼ ç»Ÿçš„å¼€å‘æ¨¡å¼-JdbcUtils-x2F-åå°„" class="headerlink" title="â— ä¼ ç»Ÿçš„å¼€å‘æ¨¡å¼[JdbcUtils &#x2F; åå°„]"></a>â— ä¼ ç»Ÿçš„å¼€å‘æ¨¡å¼[JdbcUtils &#x2F; åå°„]</h3><p>ç¨‹åºâ€”â€”&gt;ç¯å¢ƒ &#x2F;&#x2F;ç¨‹åºè¯»å–ç¯å¢ƒé…ç½®ï¼Œç„¶åè‡ªå·±åˆ›å»ºå¯¹è±¡.</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230716214351358.png" alt="image-20230716214351358"></p><p>è€éŸ©è§£è¯»ä¸Šå›¾(ä»¥è¿æ¥åˆ°æ•°æ®åº“ä¸ºä¾‹è¯´æ˜)</p><p>1ã€<strong>ç¨‹åºå‘˜ç¼–å†™ç¨‹åº, åœ¨ç¨‹åºä¸­è¯»å–é…ç½®ä¿¡æ¯</strong></p><p>2ã€**(ç¨‹åºå‘˜)åˆ›å»ºå¯¹è±¡**, new Object???() || åå°„æ–¹å¼</p><p>3ã€ä½¿ç”¨å¯¹è±¡å®Œæˆä»»åŠ¡</p><h3 id="â—-IOC-çš„å¼€å‘æ¨¡å¼-EmpAction-EmpService-EmpDao-Emp"><a href="#â—-IOC-çš„å¼€å‘æ¨¡å¼-EmpAction-EmpService-EmpDao-Emp" class="headerlink" title="â— IOC çš„å¼€å‘æ¨¡å¼ [EmpAction EmpService EmpDao Emp]"></a>â— IOC çš„å¼€å‘æ¨¡å¼ [EmpAction EmpService EmpDao Emp]</h3><p>ç¨‹åº&lt;â€”â€“å®¹å™¨ &#x2F;&#x2F;<strong>å®¹å™¨åˆ›å»ºå¥½å¯¹è±¡ï¼Œç¨‹åºç›´æ¥ä½¿ç”¨</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230716214640935.png" alt="image-20230716214640935"></p><p>è€éŸ©è§£è¯»ä¸Šå›¾</p><p>1ã€<u>Spring æ ¹æ®é…ç½®æ–‡ä»¶ xml || æ³¨è§£, åˆ›å»ºå¯¹è±¡</u>ï¼Œ å¹¶æ”¾å…¥åˆ°å®¹å™¨(å¦‚ï¼šConcurrentHashMap)ä¸­,å¹¶ä¸”å¯ä»¥å®Œæˆå¯¹è±¡ä¹‹é—´çš„ä¾èµ–</p><p>2ã€**<u>å½“éœ€è¦ä½¿ç”¨æŸä¸ªå¯¹è±¡å®ä¾‹çš„æ—¶å€™, å°±ç›´æ¥ä»å®¹å™¨ä¸­è·å–å³å¯</u>**</p><p>3ã€ç¨‹åºå‘˜å¯ä»¥æ›´åŠ å…³æ³¨å¦‚ä½•ä½¿ç”¨å¯¹è±¡å®Œæˆç›¸åº”çš„ä¸šåŠ¡  (ä»¥å‰æ˜¯ new â€¦ &#x3D;&#x3D;&gt; æ³¨è§£&#x2F;é…ç½®æ–¹å¼)</p><p>4ã€<strong>DIâ€”Dependency Injection ä¾èµ–æ³¨å…¥</strong>ï¼Œå¯ä»¥ç†è§£æˆæ˜¯ IOC çš„å¦å¤–å«æ³•.</p><p>5ã€Springæœ€å¤§çš„ä»·å€¼ï¼Œé€šè¿‡é…ç½®ï¼Œ<strong>ç»™ç¨‹åºæä¾›éœ€è¦ä½¿ç”¨çš„web å±‚</strong>[Servlet(Action&#x2F;Controller)]&#x2F;Service&#x2F;Dao&#x2F;[JavaBean&#x2F;entity]<strong>å¯¹è±¡</strong>,è¿™ä¸ªæ˜¯æ ¸å¿ƒä»·å€¼æ‰€åœ¨ï¼Œä¹Ÿæ˜¯ ioc çš„å…·ä½“ä½“ç°, å®ç°äº†è§£è€¦</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230716220144385.png" alt="image-20230716220144385" style="zoom:50%;" /><h2 id="1-4-Spring-å¿«é€Ÿå…¥é—¨"><a href="#1-4-Spring-å¿«é€Ÿå…¥é—¨" class="headerlink" title="1.4 Spring å¿«é€Ÿå…¥é—¨"></a>1.4 Spring å¿«é€Ÿå…¥é—¨</h2><h3 id="1-4-1-éœ€æ±‚è¯´æ˜"><a href="#1-4-1-éœ€æ±‚è¯´æ˜" class="headerlink" title="1.4.1 éœ€æ±‚è¯´æ˜"></a>1.4.1 éœ€æ±‚è¯´æ˜</h3><ol><li>é€šè¿‡ Spring çš„æ–¹å¼[é…ç½®æ–‡ä»¶]ï¼Œ è·å– JavaBean: Monster çš„å¯¹è±¡ï¼Œ å¹¶ç»™è¯¥çš„å¯¹è±¡å±æ€§èµ‹å€¼ï¼Œ è¾“å‡ºè¯¥å¯¹è±¡ä¿¡æ¯</li></ol><h3 id="1-4-2-å®Œæˆæ­¥éª¤"><a href="#1-4-2-å®Œæˆæ­¥éª¤" class="headerlink" title="1.4.2 å®Œæˆæ­¥éª¤"></a>1.4.2 å®Œæˆæ­¥éª¤</h3><p>â€¦â€¦</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      1. é…ç½®monsterå¯¹è±¡/javabean</span></span><br><span class="line"><span class="comment">      2. åœ¨beansä¸­å¯ä»¥é…ç½®å¤šä¸ªbean</span></span><br><span class="line"><span class="comment">      3. beanè¡¨ç¤ºå°±æ˜¯ä¸€ä¸ªjavaå¯¹è±¡</span></span><br><span class="line"><span class="comment">      4. classå±æ€§æ˜¯ç”¨äºæŒ‡å®šç±»çš„å…¨è·¯å¾„-&gt;springåº•å±‚ä½¿ç”¨åå°„åˆ›å»º</span></span><br><span class="line"><span class="comment">      5. ğŸŒŸidå±æ€§è¡¨ç¤ºè¯¥javaå¯¹è±¡åœ¨springå®¹å™¨ä¸­çš„id, é€šè¿‡idå¯ä»¥è·å–åˆ°å¯¹è±¡</span></span><br><span class="line"><span class="comment">      6. &lt;property name=&quot;monsterId&quot; value=&quot;100&quot;&gt; ç”¨äºç»™è¯¥å¯¹è±¡çš„å±æ€§èµ‹å€¼</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Monster&quot;</span> <span class="attr">id</span>=<span class="string">&quot;monster01&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç‰›é­”ç‹&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èŠ­è•‰æ‰‡&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Monster&quot;</span> <span class="attr">id</span>=<span class="string">&quot;monster02&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç‰›é­”ç‹~&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èŠ­è•‰æ‰‡~&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="1-4-3-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#1-4-3-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="1.4.3 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>1.4.3 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><h4 id="1ã€-è¯´æ˜"><a href="#1ã€-è¯´æ˜" class="headerlink" title="1ã€ è¯´æ˜"></a>1ã€ è¯´æ˜</h4><p>ClassPathXmlApplicationContext ioc &#x3D;new ClassPathXmlApplicationContext(â€œbeans.xmlâ€);</p><p>â€”â€”ä¸ºä»€ä¹ˆè¯»å–åˆ° beans.xml</p><h4 id="2ã€è§£é‡Šä¸€ä¸‹ç±»åŠ è½½è·¯å¾„-å¯ä»¥ç»™å­¦å‘˜è¾“å‡ºä¸€ä¸‹"><a href="#2ã€è§£é‡Šä¸€ä¸‹ç±»åŠ è½½è·¯å¾„-å¯ä»¥ç»™å­¦å‘˜è¾“å‡ºä¸€ä¸‹" class="headerlink" title="2ã€è§£é‡Šä¸€ä¸‹ç±»åŠ è½½è·¯å¾„. å¯ä»¥ç»™å­¦å‘˜è¾“å‡ºä¸€ä¸‹:"></a>2ã€è§£é‡Šä¸€ä¸‹ç±»åŠ è½½è·¯å¾„. å¯ä»¥ç»™å­¦å‘˜è¾“å‡ºä¸€ä¸‹:</h4><p>&#x2F;&#x2F; è·å–ã€Œ<strong>ç±»åŠ è½½è·¯å¾„</strong>ã€</p><p>&#x2F;&#x2F; File f &#x3D; new File(this.getClass().getResource(â€œ&#x2F;â€œ).getPath());</p><p>&#x2F;&#x2F; System.out.println(f);</p><p>â€”è¾“å‡ºâ€”â€”é¡¹ç›®æ–‡ä»¶å¤¹\å·¥ç¨‹å\out\production\å·¥ç¨‹å</p><h4 id="3ã€debug-çœ‹çœ‹-spring-å®¹å™¨ç»“æ„-x2F-æœºåˆ¶-è®°ä½ä½ æ˜¯-OOP-ç¨‹åºå‘˜-é‡è¦"><a href="#3ã€debug-çœ‹çœ‹-spring-å®¹å™¨ç»“æ„-x2F-æœºåˆ¶-è®°ä½ä½ æ˜¯-OOP-ç¨‹åºå‘˜-é‡è¦" class="headerlink" title="3ã€debug çœ‹çœ‹ spring å®¹å™¨ç»“æ„&#x2F;æœºåˆ¶, è®°ä½ä½ æ˜¯ OOP ç¨‹åºå‘˜,é‡è¦!"></a>3ã€debug çœ‹çœ‹ spring å®¹å™¨ç»“æ„&#x2F;æœºåˆ¶, è®°ä½ä½ æ˜¯ OOP ç¨‹åºå‘˜,é‡è¦!</h4><ul><li>è€éŸ©è¯´æ˜: æ³¨æ„é…ç½® debugger, å¦åˆ™ä½ çœ‹åˆ°çš„ debug è§†å›¾å’Œè€å¸ˆä¸ä¸€æ ·</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230717215641546.png" alt="image-20230717215641546"></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230717215726473.png" alt="image-20230717215726473"></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230717215817159.png" alt="image-20230717215817159"></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230717215902732.png" alt="image-20230717215902732"></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230717215925529.png" alt="image-20230717215925529"></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230717220000530.png" alt="image-20230717220000530"></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230717220027499.png" alt="image-20230717220027499"></p><h4 id="4ã€ioc-structure-summaryï¼š"><a href="#4ã€ioc-structure-summaryï¼š" class="headerlink" title="4ã€ioc structure summaryï¼š"></a>4ã€ioc structure summaryï¼š</h4><p>iocå®¹å™¨(ClassPathXmlApplicationContext)ï¼š</p><p>â€”â€”beanFactory(DefaultListableBeanFactory)</p><p>â€”â€”â€”â€”beanDefinitionMap(ConcurrentHashMap)</p><p>â€”â€”â€”â€”â€”â€”table(ConcurrentHashMap$Node[512])</p><p>â€”â€”â€”â€”â€”â€”å¯ä»¥å­˜æ”¾beans.xmlä¸­çš„beanèŠ‚ç‚¹é…ç½®çš„beanå¯¹è±¡ä¿¡æ¯</p><p>â€”â€”â€”â€”â€”â€”<strong>keyæ˜¯ åœ¨beans.xmlä¸­é…ç½®çš„beançš„idï¼Œvalueæ˜¯è¿™ä¸ªbeançš„å„ç§ä¿¡æ¯(å¦‚ï¼šå±æ€§ã€å±æ€§å€¼ã€ç±»ä¿¡æ¯ã€æ˜¯ä¸æ˜¯æ‡’åŠ è½½ç­‰ä¿¡æ¯)</strong></p><p>â€”â€”â€”â€”singletonObjects(ConcurrentHashMap)</p><p>â€”â€”â€”â€”â€”â€”table(ConcurrentHashMap$Node[512])</p><p>â€”â€”â€”â€”â€”â€”åœ¨beans.xmlæ–‡ä»¶ä¸­é…ç½®çš„å¯¹è±¡é»˜è®¤æ˜¯å•ä¾‹çš„ï¼Œä¼šåˆå§‹åŒ–åœ¨è¯¥tableä¸­ï¼›è¿˜æœ‰ä¸€äº›springåˆå§‹åŒ–çš„â€”â€”â€”â€”â€”â€”å•ä¾‹å¯¹è±¡</p><p>â€”â€”â€”â€”beanDefinitionNames(ArrayList)</p><p>â€”â€”â€”â€”å­˜æ”¾äº†beans.xmlä¸­ï¼Œæ‰€æœ‰é…ç½®çš„beançš„idï¼Œæ–¹ä¾¿æŸ¥çœ‹</p><p><strong>ç”¨æˆ·æƒ³è¦ä¸€ä¸ªå¯¹è±¡â€”&gt;å…ˆå»beanDefinitionMapçš„tableä¸­æ‰¾å…¶å®šä¹‰çš„ä½ç½®çœ‹çœ‹ï¼šå¦‚æœæ˜¯å¤šä¾‹ï¼Œåˆ™ç›´æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶è¿”å›ï¼›å¦‚æœæ˜¯å•ä¾‹çš„ï¼Œåˆ™å»singletonObjectsçš„tableä¸­å–å‡ºäº‹å…ˆåˆ›å»ºå¥½çš„å¯¹è±¡è¿”å›ç»™ç”¨æˆ·</strong></p><h2 id="1-5-æ‰‹åŠ¨å¼€å‘-ç®€å•çš„-Spring-åŸºäº-XML-é…ç½®çš„ç¨‹åº"><a href="#1-5-æ‰‹åŠ¨å¼€å‘-ç®€å•çš„-Spring-åŸºäº-XML-é…ç½®çš„ç¨‹åº" class="headerlink" title="1.5 æ‰‹åŠ¨å¼€å‘- ç®€å•çš„ Spring åŸºäº XML é…ç½®çš„ç¨‹åº"></a>1.5 æ‰‹åŠ¨å¼€å‘- ç®€å•çš„ Spring åŸºäº XML é…ç½®çš„ç¨‹åº</h2><h3 id="1-5-1-éœ€æ±‚è¯´æ˜"><a href="#1-5-1-éœ€æ±‚è¯´æ˜" class="headerlink" title="1.5.1 éœ€æ±‚è¯´æ˜"></a>1.5.1 éœ€æ±‚è¯´æ˜</h3><ol><li><p>è‡ªå·±å†™ä¸€ä¸ªç®€å•çš„ Spring å®¹å™¨, é€šè¿‡è¯»å– beans.xmlï¼Œ è·å–ç¬¬ 1 ä¸ª JavaBean: Monster çš„å¯¹è±¡ï¼Œ å¹¶ç»™è¯¥çš„å¯¹è±¡å±æ€§èµ‹å€¼ï¼Œ æ”¾å…¥åˆ°å®¹å™¨ä¸­, è¾“å‡ºè¯¥å¯¹è±¡ä¿¡æ¯.</p></li><li><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä½¿ç”¨ Spring åŸç”Ÿæ¡†æ¶ï¼Œæˆ‘ä»¬è‡ªå·±ç®€å•æ¨¡æ‹Ÿå®ç°</p></li><li><p>å¯ä»¥è®©å°ä¼™ä¼´äº†è§£ Spring å®¹å™¨çš„ç®€å•æœºåˆ¶</p></li></ol><h3 id="1-5-2-æ€è·¯åˆ†æ"><a href="#1-5-2-æ€è·¯åˆ†æ" class="headerlink" title="1.5.2 æ€è·¯åˆ†æ"></a>1.5.2 æ€è·¯åˆ†æ</h3><ol><li>æ€è·¯åˆ†æ&#x2F;å›¾è§£</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230718083350279.png" alt="image-20230718083350279"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.spring.hspapplicationcontext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.spring.bean.Monster;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.Document;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.DocumentException;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.Element;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.io.SAXReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> éŸ©é¡ºå¹³</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="comment"> * 1. è¿™ä¸ªç¨‹åºç”¨äºå®ç°Springçš„ä¸€ä¸ªç®€å•å®¹å™¨æœºåˆ¶</span></span><br><span class="line"><span class="comment"> * 2. åé¢æˆ‘ä»¬è¿˜ä¼šè¯¦ç»†çš„å®ç°</span></span><br><span class="line"><span class="comment"> * 3. è¿™é‡Œæˆ‘ä»¬å®ç°å¦‚ä½•å°†beans.xmlæ–‡ä»¶è¿›è¡Œè§£æï¼Œå¹¶ç”Ÿæˆå¯¹è±¡,æ”¾å…¥å®¹å™¨ä¸­</span></span><br><span class="line"><span class="comment"> * 4. æä¾›ä¸€ä¸ªæ–¹æ³• getBean(id) è¿”å›å¯¹åº”çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * 5. è¿™é‡Œå°±æ˜¯ä¸€ä¸ªå¼€èƒƒå°ç‚¹å¿ƒ, ç†è§£Springå®¹å™¨çš„æœºåˆ¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HspApplicationContext</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ConcurrentHashMap&lt;String, Object&gt; singletonObjects =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ å™¨</span></span><br><span class="line">    <span class="comment">//æ¥æ”¶ä¸€ä¸ªå®¹å™¨çš„é…ç½®æ–‡ä»¶ æ¯”å¦‚ beans.xml, è¯¥æ–‡ä»¶é»˜è®¤åœ¨src</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HspApplicationContext</span><span class="params">(String iocBeanXmlFile)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. å¾—åˆ°ç±»åŠ è½½è·¯å¾„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getResource(<span class="string">&quot;/&quot;</span>).getPath();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. åˆ›å»º Saxreader</span></span><br><span class="line">        <span class="type">SAXReader</span> <span class="variable">saxReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. å¾—åˆ°Documentå¯¹è±¡</span></span><br><span class="line">        <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span></span><br><span class="line">                saxReader.read(<span class="keyword">new</span> <span class="title class_">File</span>(path + iocBeanXmlFile));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. å¾—åˆ°rootDocument</span></span><br><span class="line">        <span class="type">Element</span> <span class="variable">rootElement</span> <span class="operator">=</span> document.getRootElement();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. å¾—åˆ°ç¬¬ä¸€ä¸ªbean-monster01</span></span><br><span class="line">        <span class="type">Element</span> <span class="variable">bean</span> <span class="operator">=</span> (Element) rootElement.elements(<span class="string">&quot;bean&quot;</span>).get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. è·å–åˆ°ç¬¬ä¸€ä¸ªbean-monster01çš„ç›¸å…³å±æ€§</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> bean.attributeValue(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">classFullPath</span> <span class="operator">=</span> bean.attributeValue(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">        List&lt;Element&gt; property = bean.elements(<span class="string">&quot;property&quot;</span>);</span><br><span class="line">        <span class="comment">//éå†-&gt;è€å¸ˆç®€åŒ–ç›´æ¥è·å–</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">monsterId</span> <span class="operator">=</span></span><br><span class="line">                Integer.parseInt(property.get(<span class="number">0</span>).attributeValue(<span class="string">&quot;value&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> property.get(<span class="number">1</span>).attributeValue(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">skill</span> <span class="operator">=</span> property.get(<span class="number">2</span>).attributeValue(<span class="string">&quot;value&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7. ä½¿ç”¨åå°„åˆ›å»ºå¯¹è±¡.=&gt; å›é¡¾åå°„æœºåˆ¶</span></span><br><span class="line">        Class&lt;?&gt; aClass = Class.forName(classFullPath);</span><br><span class="line">        <span class="comment">//è¿™é‡Œoå¯¹è±¡å°±æ˜¯Monsterå¯¹è±¡</span></span><br><span class="line">        <span class="type">Monster</span> <span class="variable">o</span> <span class="operator">=</span> (Monster) aClass.newInstance();</span><br><span class="line">        <span class="comment">//ç»™oå¯¹è±¡èµ‹å€¼</span></span><br><span class="line">        <span class="comment">//åå°„æ¥èµ‹å€¼=&gt; è¿™é‡Œè€å¸ˆå°±ç®€åŒ–ï¼Œç›´æ¥èµ‹å€¼-&gt;ç›®çš„å°±æ˜¯å…ˆç†è§£æµç¨‹</span></span><br><span class="line">        <span class="comment">//è¿™é‡Œçš„æ–¹æ³•å°±æ˜¯setteræ–¹æ³•</span></span><br><span class="line">        <span class="comment">//Method[] declaredMethods = aClass.getDeclaredMethods();</span></span><br><span class="line">        <span class="comment">//for (Method declaredMethod : declaredMethods) &#123;</span></span><br><span class="line">        <span class="comment">//    declaredMethod.invoke();</span></span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line">        <span class="comment">//èµ‹å€¼</span></span><br><span class="line">        o.setMonsterId(monsterId);</span><br><span class="line">        o.setName(name);</span><br><span class="line">        o.setSkill(skill);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//8. å°†åˆ›å»ºå¥½çš„å¯¹è±¡æ”¾å…¥åˆ°singletonObjects</span></span><br><span class="line">        singletonObjects.put(id, o);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="comment">//è¿™é‡Œå°ä¼™ä¼´å¯ä»¥å†å¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span> singletonObjects.get(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1-6-ğŸŒŸSpring-åŸç”Ÿå®¹å™¨åº•å±‚ç»“æ„"><a href="#1-6-ğŸŒŸSpring-åŸç”Ÿå®¹å™¨åº•å±‚ç»“æ„" class="headerlink" title="1.6 ğŸŒŸSpring åŸç”Ÿå®¹å™¨åº•å±‚ç»“æ„"></a>1.6 ğŸŒŸSpring åŸç”Ÿå®¹å™¨åº•å±‚ç»“æ„</h2><h3 id="1-6-1-ä¸€å›¾èƒœåƒè¨€"><a href="#1-6-1-ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="1.6.1 ä¸€å›¾èƒœåƒè¨€"></a>1.6.1 ä¸€å›¾èƒœåƒè¨€</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230718105740683.png" alt="image-20230718105740683"></p><h3 id="1-6-2-è¯¾åä½œä¸šé¢˜"><a href="#1-6-2-è¯¾åä½œä¸šé¢˜" class="headerlink" title="1.6.2 è¯¾åä½œä¸šé¢˜"></a>1.6.2 è¯¾åä½œä¸šé¢˜</h3><ol><li>åœ¨ beans.xml ä¸­ï¼Œ æˆ‘ä»¬æ³¨å…¥ 2 ä¸ª Monster å¯¹è±¡, ä½†æ˜¯ä¸æŒ‡å®š id,å¦‚ä¸‹</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.beans.Monster&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1010&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç‰›é­”ç‹~&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èŠ­è•‰æ‰‡~&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.beans.Monster&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;666&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç‰›é­”ç‹~~!!&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èŠ­è•‰æ‰‡~~&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>é—®é¢˜ 1ï¼šè¿è¡Œä¼šä¸ä¼šæŠ¥é”™</li></ol><ul><li>ç­”ï¼šä¸ä¼šæŠ¥é”™ï¼Œä¼šæ­£å¸¸è¿è¡Œ</li></ul><ol start="3"><li>é—®é¢˜ 2ï¼šå¦‚æœä¸æŠ¥é”™, ä½ èƒ½å¦æ‰¾åˆ°åˆ†é…çš„ id, å¹¶è·å¾—åˆ°è¯¥å¯¹è±¡.</li></ol><ul><li>ç­”ï¼š<strong>ç³»ç»Ÿä¼šé»˜è®¤åˆ†é… id</strong> ,<u>åˆ†é… id çš„è§„åˆ™æ˜¯ å…¨ç±»å#0 , å…¨ç±»å#1 è¿™æ ·çš„è§„åˆ™æ¥åˆ†é… id</u>, æˆ‘ä»¬å¯ä»¥é€šè¿‡ debug æ–¹å¼æ¥æŸ¥çœ‹.</li></ul><h1 id="2-Spring-ç®¡ç†-Bean-IOC"><a href="#2-Spring-ç®¡ç†-Bean-IOC" class="headerlink" title="2 Spring ç®¡ç† Bean-IOC"></a>2 Spring ç®¡ç† Bean-IOC</h1><h2 id="2-1-Spring-é…ç½®-x2F-ç®¡ç†-bean-ä»‹ç»"><a href="#2-1-Spring-é…ç½®-x2F-ç®¡ç†-bean-ä»‹ç»" class="headerlink" title="2.1 Spring é…ç½®&#x2F;ç®¡ç† bean ä»‹ç»"></a>2.1 Spring é…ç½®&#x2F;ç®¡ç† bean ä»‹ç»</h2><h3 id="2-1-1-Bean-ç®¡ç†åŒ…æ‹¬ä¸¤æ–¹é¢"><a href="#2-1-1-Bean-ç®¡ç†åŒ…æ‹¬ä¸¤æ–¹é¢" class="headerlink" title="2.1.1 Bean ç®¡ç†åŒ…æ‹¬ä¸¤æ–¹é¢"></a>2.1.1 Bean ç®¡ç†åŒ…æ‹¬ä¸¤æ–¹é¢</h3><h4 id="2-1-1-1-åˆ›å»º-bean-å¯¹è±¡"><a href="#2-1-1-1-åˆ›å»º-bean-å¯¹è±¡" class="headerlink" title="2.1.1.1 åˆ›å»º bean å¯¹è±¡"></a>2.1.1.1 åˆ›å»º bean å¯¹è±¡</h4><h4 id="2-1-1-2-ç»™-bean-æ³¨å…¥å±æ€§"><a href="#2-1-1-2-ç»™-bean-æ³¨å…¥å±æ€§" class="headerlink" title="2.1.1.2 ç»™ bean æ³¨å…¥å±æ€§"></a>2.1.1.2 ç»™ bean æ³¨å…¥å±æ€§</h4><h3 id="2-1-2-Bean-é…ç½®æ–¹å¼"><a href="#2-1-2-Bean-é…ç½®æ–¹å¼" class="headerlink" title="2.1.2 Bean é…ç½®æ–¹å¼"></a>2.1.2 Bean é…ç½®æ–¹å¼</h3><h4 id="2-1-2-1-åŸºäº-xml-æ–‡ä»¶é…ç½®æ–¹å¼"><a href="#2-1-2-1-åŸºäº-xml-æ–‡ä»¶é…ç½®æ–¹å¼" class="headerlink" title="2.1.2.1 åŸºäº xml æ–‡ä»¶é…ç½®æ–¹å¼"></a>2.1.2.1 åŸºäº xml æ–‡ä»¶é…ç½®æ–¹å¼</h4><h4 id="2-1-2-2-åŸºäºæ³¨è§£æ–¹å¼"><a href="#2-1-2-2-åŸºäºæ³¨è§£æ–¹å¼" class="headerlink" title="2.1.2.2 åŸºäºæ³¨è§£æ–¹å¼"></a>2.1.2.2 åŸºäºæ³¨è§£æ–¹å¼</h4><h2 id="2-2-åŸºäº-XML-é…ç½®-bean"><a href="#2-2-åŸºäº-XML-é…ç½®-bean" class="headerlink" title="2.2 åŸºäº XML é…ç½® bean"></a>2.2 åŸºäº XML é…ç½® bean</h2><h3 id="2-2-1-é€šè¿‡ç±»å‹æ¥è·å–-bean"><a href="#2-2-1-é€šè¿‡ç±»å‹æ¥è·å–-bean" class="headerlink" title="2.2.1 é€šè¿‡ç±»å‹æ¥è·å– bean"></a>2.2.1 é€šè¿‡ç±»å‹æ¥è·å– bean</h3><h4 id="2-2-1-1-åº”ç”¨æ¡ˆä¾‹"><a href="#2-2-1-1-åº”ç”¨æ¡ˆä¾‹" class="headerlink" title="2.2.1.1 åº”ç”¨æ¡ˆä¾‹"></a>2.2.1.1 åº”ç”¨æ¡ˆä¾‹</h4><p>â€‹â— æ¡ˆä¾‹è¯´æ˜:</p><ol><li>é€šè¿‡ spring çš„ ioc å®¹å™¨, è·å–ä¸€ä¸ª bean å¯¹è±¡</li><li>è¯´æ˜ï¼šè·å– bean çš„æ–¹å¼ï¼šæŒ‰ç±»å‹</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Monster</span> <span class="variable">monster</span> <span class="operator">=</span> ioc.getBean(Monster.class);</span><br></pre></td></tr></table></figure><h4 id="2-2-1-2-ç»†èŠ‚è¯´æ˜"><a href="#2-2-1-2-ç»†èŠ‚è¯´æ˜" class="headerlink" title="2.2.1.2 ç»†èŠ‚è¯´æ˜"></a>2.2.1.2 ç»†èŠ‚è¯´æ˜</h4><ol><li><p>æŒ‰ç±»å‹æ¥è·å– bean, è¦æ±‚ ioc å®¹å™¨ä¸­çš„åŒä¸€ä¸ªç±»çš„ bean åªèƒ½æœ‰ä¸€ä¸ª, å¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ NoUniqueBeanDefinitionException</p></li><li><p>è¿™ç§æ–¹å¼çš„åº”ç”¨åœºæ™¯ï¼šæ¯”å¦‚ XxxAction&#x2F;Servlet&#x2F;Controller, æˆ– XxxService <strong>åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­åªéœ€è¦ä¸€ä¸ªå¯¹è±¡å®ä¾‹(å•ä¾‹)çš„æƒ…å†µ</strong></p></li><li><p>è€å¸ˆè¿™é‡Œåœ¨è¯´æ˜ä¸€ä¸‹: åœ¨å®¹å™¨é…ç½®æ–‡ä»¶(æ¯”å¦‚ beans.xml)ä¸­<strong>ç»™å±æ€§èµ‹å€¼, åº•å±‚æ˜¯é€šè¿‡ setter æ–¹æ³•å®Œæˆçš„</strong>, è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æä¾› setter æ–¹æ³•çš„åŸå› </p></li></ol><h3 id="2-2-2-é€šè¿‡æ„é€ å™¨é…ç½®-bean"><a href="#2-2-2-é€šè¿‡æ„é€ å™¨é…ç½®-bean" class="headerlink" title="2.2.2 é€šè¿‡æ„é€ å™¨é…ç½® bean"></a>2.2.2 é€šè¿‡æ„é€ å™¨é…ç½® bean</h3><h4 id="2-2-2-1-åº”ç”¨æ¡ˆä¾‹"><a href="#2-2-2-1-åº”ç”¨æ¡ˆä¾‹" class="headerlink" title="2.2.2.1 åº”ç”¨æ¡ˆä¾‹"></a>2.2.2.1 åº”ç”¨æ¡ˆä¾‹</h4><p>â— æ¡ˆä¾‹è¯´æ˜:</p><p>åœ¨ spring çš„ ioc å®¹å™¨, å¯ä»¥é€šè¿‡æ„é€ å™¨æ¥é…ç½® bean å¯¹è±¡</p><p>â— å®Œæˆæ­¥éª¤</p><ol><li>åœ¨ beans.xml é…ç½®</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®Monsterå¯¹è±¡ï¼Œå¹¶ä¸”æŒ‡å®šæ„é€ å™¨</span></span><br><span class="line"><span class="comment">è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="comment">1. constructor-argæ ‡ç­¾å¯ä»¥æŒ‡å®šä½¿ç”¨æ„é€ å™¨çš„å‚æ•°</span></span><br><span class="line"><span class="comment">2. indexè¡¨ç¤ºæ„é€ å™¨çš„ç¬¬å‡ ä¸ªå‚æ•° ä»0å¼€å§‹è®¡ç®—çš„</span></span><br><span class="line"><span class="comment">3. é™¤äº†å¯ä»¥é€šè¿‡index è¿˜å¯ä»¥é€šè¿‡ name / type æ¥æŒ‡å®šå‚æ•°æ–¹å¼</span></span><br><span class="line"><span class="comment">4. è§£é™¤å¤§å®¶çš„ç–‘æƒ‘, ç±»çš„æ„é€ å™¨ï¼Œä¸èƒ½æœ‰å®Œå…¨ç›¸åŒç±»å‹å’Œé¡ºåºçš„æ„é€ å™¨ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡typeæ¥æŒ‡å®š</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- index --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster03&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Monster&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;200&quot;</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;ç™½éª¨ç²¾&quot;</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;å¸äººè¡€&quot;</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- name --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster04&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Monster&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;200&quot;</span> <span class="attr">name</span>=<span class="string">&quot;monsterId&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;ç™½éª¨ç²¾&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;å¸äººè¡€&quot;</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- type --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster05&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Monster&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;300&quot;</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.Integer&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;ç™½éª¨ç²¾~&quot;</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;å¸äººè¡€~&quot;</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-2-2-2-ä½¿ç”¨ç»†èŠ‚"><a href="#2-2-2-2-ä½¿ç”¨ç»†èŠ‚" class="headerlink" title="2.2.2.2 ä½¿ç”¨ç»†èŠ‚"></a>2.2.2.2 ä½¿ç”¨ç»†èŠ‚</h4><ol><li>é€šè¿‡ index å±æ€§æ¥åŒºåˆ†æ˜¯ç¬¬å‡ ä¸ªå‚æ•°</li><li>é€šè¿‡ type å±æ€§æ¥åŒºåˆ†æ˜¯ä»€ä¹ˆç±»å‹(æŒ‰ç…§é¡ºåº)</li></ol><h3 id="2-2-3-é€šè¿‡-p-åç§°ç©ºé—´é…ç½®-bean"><a href="#2-2-3-é€šè¿‡-p-åç§°ç©ºé—´é…ç½®-bean" class="headerlink" title="2.2.3 é€šè¿‡ p åç§°ç©ºé—´é…ç½® bean"></a>2.2.3 é€šè¿‡ p åç§°ç©ºé—´é…ç½® bean</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">åœ¨beansæ ‡ç­¾ä¸­æ·»åŠ     xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--é€šè¿‡påç§°ç©ºé—´æ¥é…ç½®bean</span></span><br><span class="line"><span class="comment">    è€éŸ©è§£è¯»</span></span><br><span class="line"><span class="comment">    1. å°†å…‰æ ‡æ”¾åœ¨p , è¾“å…¥alt+enter , å°±ä¼šè‡ªåŠ¨çš„æ·»åŠ xmlns</span></span><br><span class="line"><span class="comment">    2. æœ‰æ—¶éœ€è¦å¤šæ¥å‡ æ¬¡</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster06&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Monster&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:monsterId</span>=<span class="string">&quot;500&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:name</span>=<span class="string">&quot;çº¢å­©å„¿&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:skill</span>=<span class="string">&quot;åç«&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-4-å¼•ç”¨-x2F-æ³¨å…¥å…¶å®ƒ-bean-å¯¹è±¡-æŸç±»ä¸­æœ‰å…¶ä»–ç±»å‹çš„æ•°æ®ï¼Œä¹Ÿéœ€è¦åˆå§‹åŒ–"><a href="#2-2-4-å¼•ç”¨-x2F-æ³¨å…¥å…¶å®ƒ-bean-å¯¹è±¡-æŸç±»ä¸­æœ‰å…¶ä»–ç±»å‹çš„æ•°æ®ï¼Œä¹Ÿéœ€è¦åˆå§‹åŒ–" class="headerlink" title="2.2.4 å¼•ç”¨&#x2F;æ³¨å…¥å…¶å®ƒ bean å¯¹è±¡(æŸç±»ä¸­æœ‰å…¶ä»–ç±»å‹çš„æ•°æ®ï¼Œä¹Ÿéœ€è¦åˆå§‹åŒ–)"></a>2.2.4 å¼•ç”¨&#x2F;æ³¨å…¥å…¶å®ƒ bean å¯¹è±¡(æŸç±»ä¸­æœ‰å…¶ä»–ç±»å‹çš„æ•°æ®ï¼Œä¹Ÿéœ€è¦åˆå§‹åŒ–)</h3><h4 id="2-2-4-1-å®ä¾‹æ¼”ç¤º"><a href="#2-2-4-1-å®ä¾‹æ¼”ç¤º" class="headerlink" title="2.2.4.1 å®ä¾‹æ¼”ç¤º"></a>2.2.4.1 å®ä¾‹æ¼”ç¤º</h4><p>â€‹â— æ¡ˆä¾‹è¯´æ˜:åœ¨ spring çš„ ioc å®¹å™¨, å¯ä»¥<strong>é€šè¿‡ ref æ¥å®ç° bean å¯¹è±¡çš„ç›¸äº’å¼•ç”¨</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®MemberServiceImplå¯¹è±¡</span></span><br><span class="line"><span class="comment">    è€éŸ©è§£è¯»</span></span><br><span class="line"><span class="comment">    1. ref=&quot;memberDAO&quot;è¡¨ç¤º  MemberServiceImplå¯¹è±¡å±æ€§memberDAOå¼•ç”¨çš„å¯¹è±¡æ˜¯id=memberDAO</span></span><br><span class="line"><span class="comment">    çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">    2. è¿™é‡Œå°±ä½“ç°å‡ºspringå®¹å™¨çš„ä¾èµ–æ³¨å…¥</span></span><br><span class="line"><span class="comment">    3. æ³¨æ„å†springå®¹å™¨ä¸­, ä»–æ˜¯ã€Œä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥æ‰§è¡Œçš„ã€å³å¦‚æœä½ å¼•ç”¨åˆ°ä¸€ä¸ªbeanå¯¹è±¡, å¯¹ä½ é…ç½®çš„é¡ºåºæ²¡æœ‰è¦æ±‚</span></span><br><span class="line"><span class="comment">    4. å»ºè®®è¿˜æ˜¯æŒ‰é¡ºåºï¼Œå¥½å¤„æ˜¯é˜…è¯»çš„æ—¶å€™ï¼Œæ¯”è¾ƒæ–¹ä¾¿</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®MemberDAOImplå¯¹è±¡--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.dao.MemberDAOImpl&quot;</span> <span class="attr">id</span>=<span class="string">&quot;memberDAO&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.service.MemberServiceImpl&quot;</span> <span class="attr">id</span>=<span class="string">&quot;memberService&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;memberDAO&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;memberDAO&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-5-å¼•ç”¨-x2F-æ³¨å…¥å†…éƒ¨-bean-å¯¹è±¡"><a href="#2-2-5-å¼•ç”¨-x2F-æ³¨å…¥å†…éƒ¨-bean-å¯¹è±¡" class="headerlink" title="2.2.5 å¼•ç”¨&#x2F;æ³¨å…¥å†…éƒ¨ bean å¯¹è±¡"></a>2.2.5 å¼•ç”¨&#x2F;æ³¨å…¥å†…éƒ¨ bean å¯¹è±¡</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;memberServiceImpl02&quot;</span><span class="attr">class</span>=<span class="string">&quot;com.study.spring.service.MemberServiceImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;memberDAO&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.dao.MemberDAOImpl&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-6-å¼•ç”¨-x2F-æ³¨å…¥é›†åˆ-x2F-æ•°ç»„ç±»å‹"><a href="#2-2-6-å¼•ç”¨-x2F-æ³¨å…¥é›†åˆ-x2F-æ•°ç»„ç±»å‹" class="headerlink" title="2.2.6 å¼•ç”¨&#x2F;æ³¨å…¥é›†åˆ&#x2F;æ•°ç»„ç±»å‹"></a>2.2.6 å¼•ç”¨&#x2F;æ³¨å…¥é›†åˆ&#x2F;æ•°ç»„ç±»å‹</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®Masterå¯¹è±¡</span></span><br><span class="line"><span class="comment">ä½“ä¼š spring å®¹å™¨é…ç½®ç‰¹ç‚¹ ä¾èµ–æ³¨å…¥-éå¸¸çµæ´»</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Master&quot;</span> <span class="attr">id</span>=<span class="string">&quot;master&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¤ªä¸Šè€å›&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç»™listå±æ€§èµ‹å€¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterList&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--å¼•ç”¨çš„æ–¹æ³•--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;monster01&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;monster02&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--å†…éƒ¨bean--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Monster&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;è€é¼ ç²¾&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;åƒç²®é£Ÿ&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç»™mapå±æ€§èµ‹å€¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterMap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>monster03<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--è¿™é‡Œè€å¸ˆä½¿ç”¨çš„å¤–éƒ¨bean,å¼•å…¥--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;monster03&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>monster04<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;monster04&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç»™setå±æ€§èµ‹å€¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterSet&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;monster05&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;monster06&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Monster&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;é‡‘è§’å¤§ç‹&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;åæ°´&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;666&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç»™æ•°ç»„å±æ€§èµ‹å€¼</span></span><br><span class="line"><span class="comment">    è€å¸ˆå¤šè¯´ä¸€å¥: arrayæ ‡ç­¾ä¸­ä½¿ç”¨ value è¿˜æ˜¯ bean , ref .. è¦æ ¹æ®ä½ çš„ä¸šåŠ¡å†³å®š</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterName&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>å°å¦–æ€ª<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>å¤§å¦–æ€ª<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>è€å¦–æ€ª<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç»™Propertieså±æ€§èµ‹å€¼ ç»“æ„k(String)-v(String)--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;pros&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;username&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;ip&quot;</span>&gt;</span>127.0.0.1<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-2-6-2-ä½¿ç”¨ç»†èŠ‚"><a href="#2-2-6-2-ä½¿ç”¨ç»†èŠ‚" class="headerlink" title="2.2.6.2 ä½¿ç”¨ç»†èŠ‚"></a>2.2.6.2 ä½¿ç”¨ç»†èŠ‚</h4><ol><li><p>ä¸»è¦æŒæ¡ List&#x2F;Map&#x2F;Properties ä¸‰ç§é›†åˆçš„ä½¿ç”¨.</p></li><li><p>Properties é›†åˆçš„ç‰¹ç‚¹</p><ul><li><p>è¿™ä¸ª Properties æ˜¯ Hashtable çš„å­ç±» , æ˜¯ key-value çš„å½¢å¼</p></li><li><p>key æ˜¯ string è€Œ value ä¹Ÿæ˜¯ string</p></li></ul></li></ol><h3 id="2-2-7-é€šè¿‡-util-åç§°ç©ºé—´åˆ›å»º-list"><a href="#2-2-7-é€šè¿‡-util-åç§°ç©ºé—´åˆ›å»º-list" class="headerlink" title="2.2.7 é€šè¿‡ util åç§°ç©ºé—´åˆ›å»º list"></a>2.2.7 é€šè¿‡ util åç§°ç©ºé—´åˆ›å»º list</h3><h4 id="2-2-7-1-å®ä¾‹æ¼”ç¤º"><a href="#2-2-7-1-å®ä¾‹æ¼”ç¤º" class="headerlink" title="2.2.7.1 å®ä¾‹æ¼”ç¤º"></a>2.2.7.1 å®ä¾‹æ¼”ç¤º</h4><p>â€‹â— æ¡ˆä¾‹è¯´æ˜</p><p>â€‹spring çš„ ioc å®¹å™¨, å¯ä»¥é€šè¿‡ util åç§°ç©ºé—´åˆ›å»º list é›†åˆ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">xmlns:util=&quot;http://www.springframework.org/schema/util&quot;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--å®šä¹‰ä¸€ä¸ªutil:list å¹¶ä¸”æŒ‡å®šid å¯ä»¥è¾¾åˆ°æ•°æ®å¤ç”¨</span></span><br><span class="line"><span class="comment">è€å¸ˆè¯´æ˜: åœ¨ä½¿ç”¨util:list åç§°ç©ºé—´æ—¶å€™ï¼Œéœ€è¦å¼•å…¥ç›¸åº”çš„æ ‡ç­¾, ä¸€èˆ¬æ¥è¯´é€šè¿‡alt+enterä¼šè‡ªåŠ¨åŠ å…¥</span></span><br><span class="line"><span class="comment">, å¦‚æœæ²¡æœ‰å°±æ‰‹åŠ¨æ·»åŠ ä¸€ä¸‹å³å¯.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;myBookList&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>ä¸‰å›½æ¼”ä¹‰<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>çº¢æ¥¼æ¢¦<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>è¥¿æ¸¸è®°<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>æ°´æµ’ä¼ <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®BookStoreå¯¹è±¡--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.BookStore&quot;</span> <span class="attr">id</span>=<span class="string">&quot;bookStore&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookList&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;myBookList&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-8-çº§è”å±æ€§èµ‹å€¼"><a href="#2-2-8-çº§è”å±æ€§èµ‹å€¼" class="headerlink" title="2.2.8 çº§è”å±æ€§èµ‹å€¼"></a>2.2.8 çº§è”å±æ€§èµ‹å€¼</h3><h4 id="2-2-8-1-å®ä¾‹æ¼”ç¤º"><a href="#2-2-8-1-å®ä¾‹æ¼”ç¤º" class="headerlink" title="2.2.8.1 å®ä¾‹æ¼”ç¤º"></a>2.2.8.1 å®ä¾‹æ¼”ç¤º</h4><p>â€‹â— æ¡ˆä¾‹è¯´æ˜</p><p>â€‹spring çš„ ioc å®¹å™¨, å¯ä»¥ç›´æ¥ç»™å¯¹è±¡å±æ€§çš„å±æ€§èµ‹å€¼ï¼Œ å³çº§è”å±æ€§èµ‹å€¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®Deptå¯¹è±¡--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Dept&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dept&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®Empå¯¹è±¡--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Emp&quot;</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jack&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dept&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--è¿™é‡Œæˆ‘å¸Œæœ›ç»™deptçš„nameå±æ€§æŒ‡å®šå€¼[çº§è”å±æ€§èµ‹å€¼]--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept.name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Javaå¼€å‘éƒ¨é—¨&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-9-é€šè¿‡é™æ€å·¥å‚è·å–å¯¹è±¡"><a href="#2-2-9-é€šè¿‡é™æ€å·¥å‚è·å–å¯¹è±¡" class="headerlink" title="2.2.9 é€šè¿‡é™æ€å·¥å‚è·å–å¯¹è±¡"></a>2.2.9 é€šè¿‡é™æ€å·¥å‚è·å–å¯¹è±¡</h3><h4 id="2-2-9-1-å®ä¾‹æ¼”ç¤º"><a href="#2-2-9-1-å®ä¾‹æ¼”ç¤º" class="headerlink" title="2.2.9.1 å®ä¾‹æ¼”ç¤º"></a>2.2.9.1 å®ä¾‹æ¼”ç¤º</h4><p>â€‹â— æ¡ˆä¾‹è¯´æ˜</p><p>â€‹åœ¨ spring çš„ ioc å®¹å™¨, å¯ä»¥é€šè¿‡é™æ€å·¥å‚è·å– bean å¯¹è±¡</p><ol><li>åˆ› å»ºcom\study\spring\factory\MyStaticFactory.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyStaticFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Monster&gt; monsterMap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä½¿ç”¨ staticä»£ç å— è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">    <span class="comment">//åœ¨javaåŸºç¡€çš„æ—¶å€™ï¼Œè®²è¿‡çš„</span></span><br><span class="line">    <span class="keyword">static</span>  &#123;</span><br><span class="line">        monsterMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        monsterMap.put(<span class="string">&quot;monster01&quot;</span>, <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">100</span>,<span class="string">&quot;ç‰›é­”ç‹&quot;</span>,<span class="string">&quot;èŠ­è•‰æ‰‡&quot;</span>));</span><br><span class="line">        monsterMap.put(<span class="string">&quot;monster02&quot;</span>, <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">200</span>,<span class="string">&quot;ç‹ç‹¸ç²¾&quot;</span>,<span class="string">&quot;ç¾äººè®¡&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æä¾›ä¸€ä¸ªæ–¹æ³•,è¿”å›Monsterå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Monster <span class="title function_">getMonster</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> monsterMap.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>ä¿®æ”¹ beans.xml , å¢åŠ é…ç½®</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®monsterå¯¹è±¡,é€šè¿‡é™æ€å·¥å‚è·å–</span></span><br><span class="line"><span class="comment">   è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="comment">   1. é€šè¿‡é™æ€å·¥å‚è·å–/é…ç½®bean</span></span><br><span class="line"><span class="comment">   2. class æ˜¯é™æ€å·¥å‚ç±»çš„å…¨è·¯å¾„</span></span><br><span class="line"><span class="comment">   3. factory-method è¡¨ç¤ºæ˜¯æŒ‡å®šé™æ€å·¥å‚ç±»çš„å“ªä¸ªæ–¹æ³•è¿”å›å¯¹è±¡</span></span><br><span class="line"><span class="comment">   4. constructor-arg value=&quot;monster02&quot; valueæ˜¯æŒ‡å®šè¦è¿”å›é™æ€å·¥å‚çš„å“ªä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;my_monster01&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">class</span>=<span class="string">&quot;com.study.spring.factory.MyStaticFactory&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">factory-method</span>=<span class="string">&quot;getMonster&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;monster02&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-10-é€šè¿‡å®ä¾‹å·¥å‚è·å–å¯¹è±¡"><a href="#2-2-10-é€šè¿‡å®ä¾‹å·¥å‚è·å–å¯¹è±¡" class="headerlink" title="2.2.10 é€šè¿‡å®ä¾‹å·¥å‚è·å–å¯¹è±¡"></a>2.2.10 é€šè¿‡å®ä¾‹å·¥å‚è·å–å¯¹è±¡</h3><h4 id="2-2-10-1-å®ä¾‹æ¼”ç¤º"><a href="#2-2-10-1-å®ä¾‹æ¼”ç¤º" class="headerlink" title="2.2.10.1 å®ä¾‹æ¼”ç¤º"></a>2.2.10.1 å®ä¾‹æ¼”ç¤º</h4><p>â€‹â— æ¡ˆä¾‹è¯´æ˜åœ¨ spring çš„ ioc å®¹å™¨, å¯ä»¥é€šè¿‡å®ä¾‹å·¥å‚è·å– bean å¯¹è±¡</p><p>â€‹â— å®Œæˆæ­¥éª¤1. åˆ› å»ºcom\study\spring\factory\MyInstanceFactory.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInstanceFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Monster&gt; monster_map;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šè¿‡æ™®é€šä»£ç å—è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">    &#123;</span><br><span class="line">        monster_map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        monster_map.put(<span class="string">&quot;monster03&quot;</span>, <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">300</span>, <span class="string">&quot;ç‰›é­”ç‹~&quot;</span>, <span class="string">&quot;èŠ­è•‰æ‰‡~&quot;</span>));</span><br><span class="line">        monster_map.put(<span class="string">&quot;monster04&quot;</span>, <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">400</span>, <span class="string">&quot;ç‹ç‹¸ç²¾~&quot;</span>, <span class="string">&quot;ç¾äººè®¡~&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å†™ä¸€ä¸ªæ–¹æ³•è¿”å›Monsterå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> Monster <span class="title function_">getMonster</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> monster_map.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½® beans.xml</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®2ä¸ªå®ä¾‹å·¥å‚å¯¹è±¡--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.factory.MyInstanceFactory&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myInstanceFactory&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.factory.MyInstanceFactory&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myInstanceFactory2&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®monsterå¯¹è±¡, é€šè¿‡å®ä¾‹å·¥å‚</span></span><br><span class="line"><span class="comment">è€éŸ©è§£è¯»</span></span><br><span class="line"><span class="comment">1. factory-bean æŒ‡å®šä½¿ç”¨ &#x27;å“ªä¸ªå®ä¾‹å·¥å‚&#x27; å¯¹è±¡è¿”å›bean</span></span><br><span class="line"><span class="comment">2. factory-method æŒ‡å®šä½¿ç”¨å®ä¾‹å·¥å‚å¯¹è±¡çš„ &#x27;å“ªä¸ªæ–¹æ³•&#x27; è¿”å›bean</span></span><br><span class="line"><span class="comment">3. constructor-arg value=&quot;monster03&quot; æŒ‡å®šè·å–åˆ°å®ä¾‹å·¥å‚ä¸­çš„å“ªä¸ªmonster</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;my_monster02&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;myInstanceFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getMonster&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;monster03&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;my_monster03&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;myInstanceFactory2&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getMonster&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;monster03&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-12-é€šè¿‡-FactoryBean-è·å–å¯¹è±¡-é‡ç‚¹"><a href="#2-2-12-é€šè¿‡-FactoryBean-è·å–å¯¹è±¡-é‡ç‚¹" class="headerlink" title="2.2.12 é€šè¿‡ FactoryBean è·å–å¯¹è±¡(é‡ç‚¹)"></a>2.2.12 é€šè¿‡ FactoryBean è·å–å¯¹è±¡(é‡ç‚¹)</h3><h4 id="2-2-12-1-åº”ç”¨å®ä¾‹"><a href="#2-2-12-1-åº”ç”¨å®ä¾‹" class="headerlink" title="2.2.12.1 åº”ç”¨å®ä¾‹"></a>2.2.12.1 åº”ç”¨å®ä¾‹</h4><p>â€‹â— æ¡ˆä¾‹è¯´æ˜</p><p>â€‹åœ¨ spring çš„ ioc å®¹å™¨,é€šè¿‡ FactoryBean è·å– bean å¯¹è±¡(é‡ç‚¹)</p><ol><li>åˆ› å»ºcom\study\spring\factory\MyFactoryBean.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Monster&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™ä¸ªå°±æ˜¯ä½ é…ç½®æ—¶å€™ï¼ŒæŒ‡å®šè¦è·å–çš„å¯¹è±¡å¯¹åº”key</span></span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Monster&gt; monster_map;</span><br><span class="line"></span><br><span class="line">    &#123;   <span class="comment">//ä»£ç å—ï¼Œå®Œæˆåˆå§‹åŒ–</span></span><br><span class="line">        monster_map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        monster_map.put(<span class="string">&quot;monster03&quot;</span>, <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">300</span>, <span class="string">&quot;ç‰›é­”ç‹~&quot;</span>, <span class="string">&quot;èŠ­è•‰æ‰‡~&quot;</span>));</span><br><span class="line">        monster_map.put(<span class="string">&quot;monster04&quot;</span>, <span class="keyword">new</span> <span class="title class_">Monster</span>(<span class="number">400</span>, <span class="string">&quot;ç‹ç‹¸ç²¾~&quot;</span>, <span class="string">&quot;ç¾äººè®¡~&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Monster <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> monster_map.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> Monster.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;<span class="comment">//è¿™é‡ŒæŒ‡å®šæ˜¯å¦è¿”æ˜¯å•ä¾‹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½® beans.xml</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®monsterå¯¹è±¡ï¼Œé€šè¿‡FactoryBeanè·å–</span></span><br><span class="line"><span class="comment">è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="comment">1. class æŒ‡å®šä½¿ç”¨çš„FactoryBean</span></span><br><span class="line"><span class="comment">2. keyè¡¨ç¤ºå°±æ˜¯ MyFactoryBean å±æ€§key</span></span><br><span class="line"><span class="comment">3. valueå°±æ˜¯ä½ è¦è·å–çš„å¯¹è±¡å¯¹åº”key</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;my_monster05&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.factory.MyFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;key&quot;</span> <span class="attr">value</span>=<span class="string">&quot;monster04&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-13-bean-é…ç½®ä¿¡æ¯é‡ç”¨-ç»§æ‰¿"><a href="#2-2-13-bean-é…ç½®ä¿¡æ¯é‡ç”¨-ç»§æ‰¿" class="headerlink" title="2.2.13 bean é…ç½®ä¿¡æ¯é‡ç”¨(ç»§æ‰¿)"></a>2.2.13 bean é…ç½®ä¿¡æ¯é‡ç”¨(ç»§æ‰¿)</h3><h4 id="2-2-13-1-åº”ç”¨å®ä¾‹"><a href="#2-2-13-1-åº”ç”¨å®ä¾‹" class="headerlink" title="2.2.13.1 åº”ç”¨å®ä¾‹"></a>2.2.13.1 åº”ç”¨å®ä¾‹</h4><p>â€‹â— è¯´æ˜</p><p>â€‹åœ¨ spring çš„ ioc å®¹å™¨, æä¾›äº†ä¸€ç§ç»§æ‰¿çš„æ–¹å¼æ¥å®ç° bean é…ç½®ä¿¡æ¯çš„é‡ç”¨</p><p>â€‹â— åº”ç”¨å®ä¾‹æ¼”ç¤º</p><ol><li>é…ç½® beans.xml</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®Monsterå¯¹è±¡</span></span><br><span class="line"><span class="comment">1. å¦‚æœbeanæŒ‡å®šäº† abstract=&quot;true&quot;, è¡¨ç¤ºè¯¥beanå¯¹è±¡, æ˜¯ç”¨äºè¢«ç»§æ‰¿</span></span><br><span class="line"><span class="comment">2. æœ¬èº«è¿™ä¸ªbeanå°±ä¸èƒ½è¢«è·å–/å®ä¾‹åŒ–</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster12&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Monster&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èœˆèš£ç²¾~&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èœ‡äºº~&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster13&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Monster&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;monster12&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-14-bean-åˆ›å»ºé¡ºåº"><a href="#2-2-14-bean-åˆ›å»ºé¡ºåº" class="headerlink" title="2.2.14 bean åˆ›å»ºé¡ºåº"></a>2.2.14 bean åˆ›å»ºé¡ºåº</h3><h4 id="2-2-14-1-å®ä¾‹æ¼”ç¤º"><a href="#2-2-14-1-å®ä¾‹æ¼”ç¤º" class="headerlink" title="2.2.14.1 å®ä¾‹æ¼”ç¤º"></a>2.2.14.1 å®ä¾‹æ¼”ç¤º</h4><p>â€‹â— è¯´æ˜</p><ol><li>åœ¨ spring çš„ ioc å®¹å™¨, é»˜è®¤æ˜¯æŒ‰ç…§é…ç½®çš„é¡ºåºåˆ›å»º bean å¯¹è±¡</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æµ‹è¯•beanå¯¹è±¡çš„åˆ›å»ºé¡ºåº</span></span><br><span class="line"><span class="comment">è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="comment">1. åœ¨é»˜è®¤æƒ…å†µä¸‹, beanåˆ›å»ºçš„é¡ºåºæ˜¯æŒ‰ç…§é…ç½®é¡ºåºæ¥çš„</span></span><br><span class="line"><span class="comment">2. ä½†æ˜¯å¦‚æœæˆ‘ä»¬å¢åŠ äº† depends-on=&quot;department01&quot; è¿™æ—¶å°±ä¼šå…ˆåˆ›å»ºid= department01å¯¹è±¡</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hspedu.bean.Student&quot;</span> <span class="attr">depends-on</span>=<span class="string">&quot;department01&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;department01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hspedu.bean.Department&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>2.2.14.2 ä¸€ä¸ªé—®é¢˜</p><p>â€‹â— é—®é¢˜è¯´æ˜</p><ol><li>å…ˆçœ‹ä¸‹é¢çš„é…ç½®, è¯·é—®ä¸¤ä¸ª bean åˆ›å»ºçš„é¡ºåºæ˜¯ä»€ä¹ˆ? å¹¶åˆ†ææ‰§è¡Œæµ<ol><li>å…ˆåˆ›å»º id&#x3D;memberDAOImpl</li><li>å†åˆ›å»º id &#x3D; memberServiceImpl</li><li>è°ƒç”¨ memberServiceImpl.setMemberDAO() å®Œæˆå¼•ç”¨</li></ol></li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230720095126833.png" alt="image-20230720095126833"></p><ol start="2"><li><p>å…ˆçœ‹ä¸‹é¢çš„é…ç½®, è¯·é—®ä¸¤ä¸ª bean åˆ›å»ºçš„é¡ºåºæ˜¯ä»€ä¹ˆ, å¹¶åˆ†ææ‰§è¡Œæµç¨‹</p><ol><li>å…ˆåˆ›å»º id &#x3D; memberServiceImpl</li><li>å†åˆ›å»º id&#x3D;memberDAOImpl</li></ol><ol start="3"><li>ç”¨ memberServiceImpl.setMemberDAO() å®Œæˆå¼•ç”¨.   ï¼ˆåƒæ˜¯æ ˆ</li></ol></li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230720095309694.png" alt="image-20230720095309694"></p><h3 id="2-2-15-bean-å¯¹è±¡çš„å•ä¾‹å’Œå¤šä¾‹"><a href="#2-2-15-bean-å¯¹è±¡çš„å•ä¾‹å’Œå¤šä¾‹" class="headerlink" title="2.2.15 bean å¯¹è±¡çš„å•ä¾‹å’Œå¤šä¾‹"></a>2.2.15 bean å¯¹è±¡çš„å•ä¾‹å’Œå¤šä¾‹</h3><h4 id="2-2-15-1-åº”ç”¨å®ä¾‹"><a href="#2-2-15-1-åº”ç”¨å®ä¾‹" class="headerlink" title="2.2.15.1 åº”ç”¨å®ä¾‹"></a>2.2.15.1 åº”ç”¨å®ä¾‹</h4><p>â€‹â— è¯´æ˜</p><p>â€‹<u>åœ¨ spring çš„ ioc å®¹å™¨, åœ¨é»˜è®¤æ˜¯æŒ‰ç…§å•ä¾‹åˆ›å»ºçš„ï¼Œ å³é…ç½®ä¸€ä¸ª bean å¯¹è±¡åï¼Œ ioc å®¹å™¨åªä¼šåˆ›å»ºä¸€ä¸ª bean å®ä¾‹ã€‚</u></p><p>â€‹å¦‚æœ,æˆ‘ä»¬å¸Œæœ› ioc å®¹å™¨é…ç½®çš„æŸä¸ª bean å¯¹è±¡ï¼Œ æ˜¯ä»¥å¤šä¸ªå®ä¾‹å½¢å¼åˆ›å»ºçš„åˆ™å¯ä»¥é€šè¿‡é…ç½®<strong>scope&#x3D;â€prototypeâ€</strong> æ¥æŒ‡å®š</p><p><strong>é…ç½® beans.xmlï¼š</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®Catå¯¹è±¡</span></span><br><span class="line"><span class="comment">    è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="comment">    1. åœ¨é»˜è®¤æƒ…å†µä¸‹ scopeå±æ€§æ˜¯ singleton</span></span><br><span class="line"><span class="comment">    2. åœ¨iocå®¹å™¨ä¸­, åªè¦æœ‰ä¸€ä¸ªè¿™ä¸ªbeanå¯¹è±¡</span></span><br><span class="line"><span class="comment">    3. å½“ç¨‹åºå‘˜æ‰§è¡ŒgetBeanæ—¶, è¿”å›çš„çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment">    4. å¦‚æœæˆ‘ä»¬å¸Œæœ›æ¯æ¬¡getBeanè¿”å›ä¸€ä¸ªæ–°çš„Beanå¯¹è±¡ï¼Œåˆ™å¯ä»¥scope=&quot;prototype&quot;</span></span><br><span class="line"><span class="comment">    5. å¦‚æœbeançš„é…ç½®æ˜¯ scope=&quot;singleton&quot; lazy-init=&quot;true&quot; è¿™æ—¶,iocå®¹å™¨å°±ä¸ä¼šæå‰åˆ›å»ºè¯¥å¯¹è±¡</span></span><br><span class="line"><span class="comment">       , è€Œæ˜¯å½“æ‰§è¡ŒgetBeanæ–¹æ³•çš„æ—¶å€™ï¼Œæ‰ä¼šåˆ›å»ºå¯¹è±¡</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.study.spring.bean.Cat&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å°èŠ±çŒ«&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-2-15-2-ä½¿ç”¨ç»†èŠ‚"><a href="#2-2-15-2-ä½¿ç”¨ç»†èŠ‚" class="headerlink" title="2.2.15.2 ä½¿ç”¨ç»†èŠ‚"></a>2.2.15.2 ä½¿ç”¨ç»†èŠ‚</h4><ol><li><p><strong>é»˜è®¤æ˜¯å•ä¾‹ singleton, åœ¨å¯åŠ¨å®¹å™¨æ—¶, é»˜è®¤å°±ä¼šåˆ›å»º , å¹¶æ”¾å…¥åˆ° singletonObjects é›†åˆ</strong></p></li><li><p>å½“ <bean scope="prototype" > <strong><u>è®¾ç½®ä¸ºå¤šå®ä¾‹æœºåˆ¶å, è¯¥ bean æ˜¯åœ¨ getBean()æ—¶æ‰åˆ›å»º</u></strong> </p></li><li><p>å¦‚æœæ˜¯å•ä¾‹ singleton, åŒæ—¶å¸Œæœ›åœ¨ getBean æ—¶æ‰åˆ›å»º , å¯ä»¥æŒ‡å®šæ‡’åŠ è½½lazy-init&#x3D;â€trueâ€ (æ³¨æ„é»˜è®¤æ˜¯ false)</p></li><li><p><u>é€šå¸¸æƒ…å†µä¸‹, lazy-init å°±ä½¿ç”¨é»˜è®¤å€¼ false , åœ¨å¼€å‘çœ‹æ¥, ç”¨ç©ºé—´æ¢æ—¶é—´æ˜¯å€¼å¾—çš„,</u> é™¤éæœ‰ç‰¹æ®Šçš„è¦æ±‚.</p></li><li><p><strong>å¦‚æœ scope&#x3D;â€prototypeâ€ è¿™æ—¶ä½ çš„ lazy-init å±æ€§çš„å€¼ä¸ç®¡æ˜¯ ture, è¿˜æ˜¯ false éƒ½æ˜¯åœ¨getBean æ—¶å€™ï¼Œæ‰åˆ›å»ºå¯¹è±¡.</strong></p></li></ol><h3 id="2-2-16-bean-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#2-2-16-bean-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="2.2.16 bean çš„ç”Ÿå‘½å‘¨æœŸ"></a>2.2.16 bean çš„ç”Ÿå‘½å‘¨æœŸ</h3><h4 id="2-2-16-1-åº”ç”¨å®ä¾‹"><a href="#2-2-16-1-åº”ç”¨å®ä¾‹" class="headerlink" title="2.2.16.1 åº”ç”¨å®ä¾‹"></a>2.2.16.1 åº”ç”¨å®ä¾‹</h4><p>â€‹â— è¯´æ˜: bean å¯¹è±¡åˆ›å»ºæ˜¯ç”± JVM å®Œæˆçš„ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹æ–¹æ³•</p><p>â€‹<strong>1.</strong>  æ‰§è¡Œæ„é€ å™¨</p><p>â€‹<strong>2.</strong>  æ‰§è¡Œ set ç›¸å…³æ–¹æ³•</p><p>â€‹<strong>3.</strong>  è°ƒç”¨ bean çš„åˆå§‹åŒ–çš„æ–¹æ³•ï¼ˆéœ€è¦é…ç½®ï¼‰</p><p>â€‹<strong>4.</strong>  ä½¿ç”¨ bean </p><p>â€‹<strong>5.</strong>  å½“å®¹å™¨å…³é—­æ—¶å€™ï¼Œè°ƒç”¨ bean çš„é”€æ¯æ–¹æ³•ï¼ˆéœ€è¦é…ç½®ï¼‰</p><p>â€‹â— åº”ç”¨å®ä¾‹æ¼”ç¤º</p><ol><li>åˆ›å»º com.hspedu.spring.beans;</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">House</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">House</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;House() æ„é€ å™¨...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;House setName()=&quot;</span> + name);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è€å¸ˆè§£è¯»</span></span><br><span class="line">    <span class="comment">//1. è¿™ä¸ªæ–¹æ³•æ˜¯ç¨‹åºå‘˜æ¥ç¼–å†™çš„.</span></span><br><span class="line">    <span class="comment">//2. æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘æ¥å†™.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;House init()..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è€å¸ˆè§£è¯»</span></span><br><span class="line">    <span class="comment">//1. è¿™ä¸ªæ–¹æ³•æ˜¯ç¨‹åºå‘˜æ¥ç¼–å†™çš„.</span></span><br><span class="line">    <span class="comment">//2. æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘æ¥å†™.</span></span><br><span class="line">    <span class="comment">//3. åå­—ä¹Ÿä¸æ˜¯å›ºå®šçš„</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;House destroy()..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;House&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½® beans.xml</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®Houseå¯¹è±¡ï¼Œæ¼”ç¤ºæ•´ä¸ªBeançš„ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line"><span class="comment">è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="comment">1. init-method=&quot;init&quot; æŒ‡å®šbeançš„åˆå§‹åŒ–æ–¹æ³• , åœ¨setteræ–¹æ³•åæ‰§è¡Œ</span></span><br><span class="line"><span class="comment">2. initæ–¹æ³•æ‰§è¡Œçš„æ—¶æœºï¼Œç”±springå®¹å™¨æ¥æ§åˆ¶</span></span><br><span class="line"><span class="comment">3. destroy-method=&quot;destroy&quot; æŒ‡å®šbeançš„é”€æ¯æ–¹æ³•, åœ¨å®¹å™¨å…³é—­çš„æ—¶å€™æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">4. destroyæ–¹æ³•æ‰§è¡Œçš„æ—¶æœºï¼Œä¹Ÿç”±springå®¹å™¨æ¥æ§åˆ¶</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.hspedu.spring.bean.House&quot;</span> <span class="attr">id</span>=<span class="string">&quot;house&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;åŒ—äº¬è±ªå®…&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-2-16-2-ä½¿ç”¨ç»†èŠ‚"><a href="#2-2-16-2-ä½¿ç”¨ç»†èŠ‚" class="headerlink" title="2.2.16.2 ä½¿ç”¨ç»†èŠ‚"></a>2.2.16.2 ä½¿ç”¨ç»†èŠ‚</h4><ol><li><p>åˆå§‹åŒ– init æ–¹æ³•å’Œ destory æ–¹æ³•, æ˜¯ç¨‹åºå‘˜æ¥æŒ‡å®š</p></li><li><p>é”€æ¯æ–¹æ³•å°±æ˜¯å½“å…³é—­å®¹å™¨æ—¶ï¼Œæ‰ä¼šè¢«è°ƒç”¨.</p></li></ol><h3 id="2-2-17-é…ç½®-bean-çš„åç½®å¤„ç†å™¨-ã€è¿™ä¸ªæ¯”è¾ƒéš¾ã€‘"><a href="#2-2-17-é…ç½®-bean-çš„åç½®å¤„ç†å™¨-ã€è¿™ä¸ªæ¯”è¾ƒéš¾ã€‘" class="headerlink" title="2.2.17 é…ç½® bean çš„åç½®å¤„ç†å™¨ ã€è¿™ä¸ªæ¯”è¾ƒéš¾ã€‘"></a>2.2.17 é…ç½® bean çš„åç½®å¤„ç†å™¨ ã€è¿™ä¸ªæ¯”è¾ƒéš¾ã€‘</h3><h4 id="2-2-17-1-åº”ç”¨å®ä¾‹"><a href="#2-2-17-1-åº”ç”¨å®ä¾‹" class="headerlink" title="2.2.17.1 åº”ç”¨å®ä¾‹"></a>2.2.17.1 åº”ç”¨å®ä¾‹</h4><p>â— è¯´æ˜</p><ol><li>åœ¨ spring çš„ ioc å®¹å™¨,å¯ä»¥é…ç½® <strong>bean çš„åç½®å¤„ç†å™¨</strong></li><li>è¯¥å¤„ç†å™¨&#x2F;å¯¹è±¡ä¼šåœ¨ <strong>bean åˆå§‹åŒ–æ–¹æ³•<u>è°ƒç”¨å‰</u>å’Œåˆå§‹åŒ–æ–¹æ³•<u>è°ƒç”¨å</u>è¢«è°ƒç”¨</strong></li><li>ç¨‹åºå‘˜å¯ä»¥åœ¨åç½®å¤„ç†å™¨ä¸­ç¼–å†™è‡ªå·±çš„ä»£ç </li></ol><p>åç½®å¤„ç†å™¨åˆ›å»ºå¥½åï¼Œä¹Ÿæ³¨å†Œåœ¨beans.xmlä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨: åœ¨Beançš„initæ–¹æ³•å‰è¢«è°ƒç”¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bean ä¼ å…¥çš„åœ¨IOCå®¹å™¨ä¸­åˆ›å»º/é…ç½®Bean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> beanName ä¼ å…¥çš„åœ¨IOCå®¹å™¨ä¸­åˆ›å»º/é…ç½®Beançš„id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> Object ç¨‹åºå‘˜å¯¹ä¼ å…¥çš„bean è¿›è¡Œä¿®æ”¹/å¤„ç†ã€å¦‚æœæœ‰éœ€è¦çš„è¯ã€‘ ,è¿”å›</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;postProcessBeforeInitialization().. bean=&quot;</span></span><br><span class="line">            + bean + <span class="string">&quot; beanName=&quot;</span> + beanName);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆæ­¥ä½“éªŒæ¡ˆä¾‹: å¦‚æœç±»å‹æ˜¯Houseçš„ç»Ÿä¸€æ”¹æˆ ä¸Šæµ·è±ªå®…</span></span><br><span class="line">    <span class="comment">//å¯¹å¤šä¸ªå¯¹è±¡è¿›è¡Œå¤„ç†/ç¼–ç¨‹==&gt;åˆ‡é¢ç¼–ç¨‹</span></span><br><span class="line">    <span class="keyword">if</span>(bean <span class="keyword">instanceof</span> House) &#123;</span><br><span class="line">        ((House)bean).setName(<span class="string">&quot;ä¸Šæµ·è±ªå®…~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨: åœ¨Beançš„initæ–¹æ³•åè¢«è°ƒç”¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bean  ä¼ å…¥çš„åœ¨IOCå®¹å™¨ä¸­åˆ›å»º/é…ç½®Bean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> beanName ä¼ å…¥çš„åœ¨IOCå®¹å™¨ä¸­åˆ›å»º/é…ç½®Beançš„id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ç¨‹åºå‘˜å¯¹ä¼ å…¥çš„bean è¿›è¡Œä¿®æ”¹/å¤„ç†ã€å¦‚æœæœ‰éœ€è¦çš„è¯ã€‘ ,è¿”å›</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;postProcessAfterInitialization().. bean=&quot;</span></span><br><span class="line">            + bean + <span class="string">&quot; beanName=&quot;</span> + beanName);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®åç½®å¤„ç†å™¨å¯¹è±¡</span></span><br><span class="line"><span class="comment">è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="comment">1. å½“æˆ‘ä»¬åœ¨beans02.xml å®¹å™¨é…ç½®æ–‡ä»¶ é…ç½®äº† MyBeanPostProcessor</span></span><br><span class="line"><span class="comment">2. è¿™æ—¶åç½®å¤„ç†å™¨å¯¹è±¡ï¼Œå°±ä¼šä½œç”¨åœ¨è¯¥å®¹å™¨åˆ›å»ºçš„Beanå¯¹è±¡</span></span><br><span class="line"><span class="comment">3. å·²ç»æ˜¯é’ˆå¯¹æ‰€æœ‰å¯¹è±¡ç¼–ç¨‹-&gt;åˆ‡é¢ç¼–ç¨‹AOP</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.hspedu.spring.bean.MyBeanPostProcessor&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myBeanPostProcessor&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-2-17-2-å…¶å®ƒè¯´æ˜"><a href="#2-2-17-2-å…¶å®ƒè¯´æ˜" class="headerlink" title="2.2.17.2 å…¶å®ƒè¯´æ˜"></a>2.2.17.2 å…¶å®ƒè¯´æ˜</h4><p>1ã€ æ€ä¹ˆæ‰§è¡Œåˆ°è¿™ä¸ªæ–¹æ³•?&#x3D;&gt; ä½¿ç”¨ AOP(åå°„+åŠ¨æ€ä»£ç†+IO+å®¹å™¨+æ³¨è§£)</p><p>2ã€æœ‰ä»€ä¹ˆç”¨ï¼Ÿ&#x3D;&gt; å¯ä»¥å¯¹ IOC å®¹å™¨ä¸­æ‰€æœ‰çš„å¯¹è±¡è¿›è¡Œç»Ÿä¸€å¤„ç† ,æ¯”å¦‚ <strong>æ—¥å¿—å¤„ç†&#x2F;æƒé™çš„æ ¡éªŒ&#x2F;å®‰å…¨çš„éªŒè¯&#x2F;äº‹åŠ¡ç®¡ç†.</strong></p><p>â€‹-åˆæ­¥ä½“éªŒæ¡ˆä¾‹: å¦‚æœç±»å‹æ˜¯ House çš„<strong>ç»Ÿä¸€</strong>æ”¹æˆ ä¸Šæµ·è±ªå®…</p><p>3ã€é’ˆå¯¹å®¹å™¨çš„æ‰€æœ‰å¯¹è±¡å—? æ˜¯çš„&#x3D;&gt;åˆ‡é¢ç¼–ç¨‹ç‰¹ç‚¹</p><p>4ã€åé¢æˆ‘ä»¬ä¼šè‡ªå·±å®ç°è¿™ä¸ªåº•å±‚æœºåˆ¶ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªæ¯”è¾ƒéš¾ç†è§£çš„çŸ¥è¯†ç‚¹, ç°åœ¨ä¸åšè¿‡å¤šçš„çº ç»“ï¼Œåé¢æˆ‘ä¼šå¸¦å°ä¼™ä¼´å®ç°è¿™ä¸ªæœºåˆ¶</p><h3 id="2-2-18-é€šè¿‡å±æ€§æ–‡ä»¶ç»™-bean-æ³¨å…¥å€¼"><a href="#2-2-18-é€šè¿‡å±æ€§æ–‡ä»¶ç»™-bean-æ³¨å…¥å€¼" class="headerlink" title="2.2.18 é€šè¿‡å±æ€§æ–‡ä»¶ç»™ bean æ³¨å…¥å€¼"></a>2.2.18 é€šè¿‡å±æ€§æ–‡ä»¶ç»™ bean æ³¨å…¥å€¼</h3><h4 id="2-2-18-1-åº”ç”¨å®ä¾‹"><a href="#2-2-18-1-åº”ç”¨å®ä¾‹" class="headerlink" title="2.2.18.1 åº”ç”¨å®ä¾‹"></a>2.2.18.1 åº”ç”¨å®ä¾‹</h4><p>â€‹â— è¯´æ˜</p><p>åœ¨ spring çš„ ioc å®¹å™¨,é€šè¿‡å±æ€§æ–‡ä»¶ç»™ bean æ³¨å…¥å€¼</p><p>â€‹â— åº”ç”¨å®ä¾‹æ¼”ç¤º</p><ol><li>src&#x2F; åˆ›å»º my.properties</li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">monsterId</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">\u4e4c\u9f9f\u7cbe</span></span><br><span class="line"><span class="attr">skill</span>=<span class="string">\u7f29\u8116\u5b50</span></span><br></pre></td></tr></table></figure><ol start="2"><li>ä¿®æ”¹ src\beans.xml , ç»§ç»­å®Œæˆé…ç½®</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line"><span class="comment">&lt;!--æŒ‡å®šå±æ€§æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     1. å…ˆæŠŠè¿™ä¸ªæ–‡ä»¶ä¿®æ”¹æˆæç¤ºAll Problem</span></span><br><span class="line"><span class="comment">     2. æç¤ºé”™è¯¯ï¼Œå°†å…‰æ ‡æ”¾åœ¨context è¾“å…¥alt+enter å°±ä¼šè‡ªåŠ¨å¼•å…¥namespace</span></span><br><span class="line"><span class="comment">     3. location=&quot;classpath:my.properties&quot; è¡¨ç¤ºæŒ‡å®šå±æ€§æ–‡ä»¶çš„ä½ç½®</span></span><br><span class="line"><span class="comment">     4. æç¤ºï¼Œéœ€è¦å¸¦ä¸Š classpath</span></span><br><span class="line"><span class="comment">     5. å±æ€§æ–‡ä»¶æœ‰ä¸­æ–‡ï¼Œéœ€è¦å°†å…¶è½¬ä¸ºunicodeç¼–ç -&gt; ä½¿ç”¨å·¥å…·</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:my.properties&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;monster100&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hspedu.spring.beans.Monster&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;monsterId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;id&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;name&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;skill&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;skill&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-19-åŸºäº-XML-çš„-bean-çš„è‡ªåŠ¨è£…é…"><a href="#2-2-19-åŸºäº-XML-çš„-bean-çš„è‡ªåŠ¨è£…é…" class="headerlink" title="2.2.19 åŸºäº XML çš„ bean çš„è‡ªåŠ¨è£…é…"></a>2.2.19 åŸºäº XML çš„ bean çš„è‡ªåŠ¨è£…é…</h3><h4 id="2-2-19-1-åº”ç”¨å®ä¾‹"><a href="#2-2-19-1-åº”ç”¨å®ä¾‹" class="headerlink" title="2.2.19.1 åº”ç”¨å®ä¾‹"></a>2.2.19.1 åº”ç”¨å®ä¾‹</h4><p>â€‹â— è¯´æ˜</p><p>â€‹åœ¨ spring çš„ ioc å®¹å™¨,å¯ä»¥å®ç°è‡ªåŠ¨è£…é… bean</p><p>â€‹â— åº”ç”¨å®ä¾‹æ¼”ç¤º</p><p>â€‹è¿™é‡Œè¯´çš„ Action å°±æ˜¯æˆ‘ä»¬å‰é¢è®²è¿‡çš„ Servlet-&gt;å……å½“ Controller</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®OrderDaoå¯¹è±¡--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.hspedu.spring.dao.OrderDao&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orderDao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®OrderServiceå¯¹è±¡</span></span><br><span class="line"><span class="comment">        è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="comment">        1. autowire=&quot;byType&quot; è¡¨ç¤º åœ¨åˆ›å»º orderServiceæ—¶</span></span><br><span class="line"><span class="comment">           é€šè¿‡ç±»å‹çš„æ–¹å¼ ç»™å¯¹è±¡å±æ€§ è‡ªåŠ¨å®Œæˆèµ‹å€¼/å¼•ç”¨</span></span><br><span class="line"><span class="comment">        2. æ¯”å¦‚OrderService å¯¹è±¡æœ‰ private OrderDao orderDao</span></span><br><span class="line"><span class="comment">        3. å°±ä¼šåœ¨å®¹å™¨ä¸­å»æ‰¾æœ‰æ²¡æœ‰ OrderDaoç±»å‹å¯¹è±¡</span></span><br><span class="line"><span class="comment">        4. å¦‚æœæœ‰ï¼Œå°±ä¼šè‡ªåŠ¨çš„è£…é…, è€å¸ˆæç¤ºå¦‚æœæ˜¯æŒ‰ç…§ byType æ–¹å¼æ¥è£…é…, è¿™ä¸ªå®¹å™¨ä¸­ï¼Œä¸èƒ½æœ‰ä¸¤ä¸ª</span></span><br><span class="line"><span class="comment">          çš„OrderDaoç±»å‹å¯¹è±¡</span></span><br><span class="line"><span class="comment">        5. å¦‚æœä½ çš„å¯¹è±¡æ²¡æœ‰å±æ€§,  autowireå°±æ²¡æœ‰å¿…è¦å†™</span></span><br><span class="line"><span class="comment">        6. å…¶å®ƒç±»æ¨..</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        7. å¦‚æœæˆ‘ä»¬è®¾ç½®çš„æ˜¯ autowire=&quot;byName&quot; è¡¨ç¤ºé€šè¿‡åå­—å®Œæˆè‡ªåŠ¨è£…é…</span></span><br><span class="line"><span class="comment">        8. æ¯”å¦‚ä¸‹é¢çš„ autowire=&quot;byName&quot; class=&quot;com.hspedu.spring.service.OrderService&quot;</span></span><br><span class="line"><span class="comment">           1) å…ˆçœ‹ OrderService å±æ€§ private OrderDao orderDao</span></span><br><span class="line"><span class="comment">           2) å†æ ¹æ®è¿™ä¸ªå±æ€§çš„setXxx()æ–¹æ³•çš„ xxx æ¥æ‰¾å¯¹è±¡id</span></span><br><span class="line"><span class="comment">           3) public void setOrderDao() å°±ä¼šæ‰¾id=orderDaoå¯¹è±¡æ¥è¿›è¡Œè‡ªåŠ¨è£…é…</span></span><br><span class="line"><span class="comment">           4) å¦‚æœæ²¡æœ‰å°±è£…é…å¤±è´¥</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hspedu.spring.service.OrderService&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">id</span>=<span class="string">&quot;orderService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®OrderAction--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hspedu.spring.web.OrderAction&quot;</span> <span class="attr">id</span>=<span class="string">&quot;orderAction&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>2.2.19.2 å…¶å®ƒè¯´æ˜</p><pre><code>1. è¿™ä¸ªçŸ¥è¯†ç‚¹ä½œä¸ºäº†è§£å³å¯ï¼Œ åé¢æˆ‘ä»¬ä¸»è¦è¿˜æ˜¯ä½¿ç”¨åŸºäºæ³¨è§£çš„æ–¹å¼(é‡ç‚¹.)1. ä½†æ˜¯æœºåˆ¶å’ŒåŸç†ç±»ä¼¼</code></pre><h2 id="2-3-ğŸŒŸåŸºäºæ³¨è§£é…ç½®-bean"><a href="#2-3-ğŸŒŸåŸºäºæ³¨è§£é…ç½®-bean" class="headerlink" title="2.3 ğŸŒŸåŸºäºæ³¨è§£é…ç½® bean"></a>2.3 ğŸŒŸåŸºäºæ³¨è§£é…ç½® bean</h2><h3 id="2-3-18-åŸºæœ¬ä½¿ç”¨"><a href="#2-3-18-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2.3.18 åŸºæœ¬ä½¿ç”¨"></a>2.3.18 åŸºæœ¬ä½¿ç”¨</h3><h4 id="2-3-18-1-è¯´æ˜"><a href="#2-3-18-1-è¯´æ˜" class="headerlink" title="2.3.18.1 è¯´æ˜"></a>2.3.18.1 è¯´æ˜</h4><p>â€‹â— åŸºæœ¬ä»‹ç»åŸºäºæ³¨è§£çš„æ–¹å¼é…ç½® bean, ä¸»è¦æ˜¯é¡¹ç›®å¼€å‘ä¸­çš„ç»„ä»¶ï¼Œ æ¯”å¦‚ Controllerã€ Serviceã€ å’Œ Dao.</p><p>â€‹â— ç»„ä»¶æ³¨è§£çš„å½¢å¼æœ‰</p><ol><li><p><u>@Component</u> è¡¨ç¤ºå½“å‰æ³¨è§£æ ‡è¯†çš„<strong>æ˜¯ä¸€ä¸ªç»„ä»¶</strong>ï¼Œ<u>æœ€å®½æ³›ï¼Œåªæ˜¯æŠŠè¯¥ç±»æ³¨å†Œåˆ°spring iocå®¹å™¨ä¸­</u></p></li><li><p><u>@Controller</u> è¡¨ç¤ºå½“å‰æ³¨è§£æ ‡è¯†çš„<strong>æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œ é€šå¸¸ç”¨äº Servlet</strong></p></li><li><p><u>@Service</u> è¡¨ç¤ºå½“å‰æ³¨è§£æ ‡è¯†çš„æ˜¯ä¸€ä¸ª<strong>å¤„ç†ä¸šåŠ¡é€»è¾‘çš„ç±»</strong>ï¼Œ é€šå¸¸ç”¨äº Service ç±»</p></li><li><p><u>@Repository</u> è¡¨ç¤ºå½“å‰æ³¨è§£æ ‡è¯†çš„æ˜¯<strong>ä¸€ä¸ªæŒä¹…åŒ–å±‚çš„ç±»</strong>ï¼Œ é€šå¸¸ç”¨äº Dao ç±»</p></li></ol><h4 id="2-3-18-2-å¿«é€Ÿå…¥é—¨"><a href="#2-3-18-2-å¿«é€Ÿå…¥é—¨" class="headerlink" title="2.3.18.2 å¿«é€Ÿå…¥é—¨"></a>2.3.18.2 å¿«é€Ÿå…¥é—¨</h4><p>â€‹â— åº”ç”¨å®ä¾‹ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½®  Controller &#x2F; Service &#x2F; Respository &#x2F; Component</p><p>â€‹â— ä»£ç å®ç°</p><p>â€‹1. å¼•å…¥ spring-aop-5.3.8.jar , åœ¨ spring&#x2F;libs ä¸‹æ‹·è´å³å¯</p><p>â€‹2.åˆ›å»º UserAction.java UserService.java, UserDao.java MyComponent.java</p><p>â€‹3.é…ç½® beans.xml(<strong>é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ…</strong>)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ…ï¼Œæ³¨æ„éœ€è¦åŠ å…¥ context åç§°ç©ºé—´ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.study.spring.component&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-3-18-3-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"><a href="#2-3-18-3-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜" class="headerlink" title="2.3.18.3 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"></a>2.3.18.3 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜</h4><ol><li><p>éœ€è¦å¯¼å…¥ spring-aop-5.3.8.jar , åˆ«å¿˜äº†</p></li><li><p>å¿…é¡»åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šâ€è‡ªåŠ¨æ‰«æçš„åŒ…â€ï¼ŒIOC å®¹å™¨æ‰èƒ½å¤Ÿæ£€æµ‹åˆ°å½“å‰é¡¹ç›®ä¸­å“ªäº›ç±»è¢«æ ‡è¯†äº†æ³¨è§£ï¼Œ æ³¨æ„åˆ°å¯¼å…¥ context åç§°ç©ºé—´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hspedu.spring.component&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ * æ¥æŒ‡å®š ï¼Œæ¯”å¦‚ com.hspedu.spring.* è¡¨ç¤º<br><strong>â€“æé—®: com.hspedu.spring.component ä¼šä¸ä¼šå»æ‰«æå®ƒçš„å­åŒ…?â€“ç­”ï¼šä¼šçš„</strong></p></li><li><p>Spring çš„ IOC å®¹å™¨ä¸èƒ½æ£€æµ‹ä¸€ä¸ªä½¿ç”¨äº†@Controller æ³¨è§£çš„ç±»åˆ°åº•æ˜¯ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ§åˆ¶å™¨ã€‚æ³¨è§£çš„åç§°æ˜¯ç”¨äºç¨‹åºå‘˜è‡ªå·±è¯†åˆ«å½“å‰æ ‡è¯†çš„æ˜¯ä»€ä¹ˆç»„ä»¶ã€‚å…¶å®ƒçš„@Service@Repository ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç† [ä¹Ÿå°±æ˜¯è¯´ <em><strong>spring çš„ IOC å®¹å™¨åªè¦æ£€æŸ¥åˆ°æ³¨è§£å°±ä¼šç”Ÿæˆå¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªæ³¨è§£çš„å«ä¹‰ spring ä¸ä¼šè¯†åˆ«ï¼Œæ³¨è§£æ˜¯ç»™ç¨‹åºå‘˜ç¼–ç¨‹æ–¹ä¾¿çœ‹çš„</strong></em>]</p></li><li><p>&lt;context:component-scan base-package&#x3D;â€com.hspedu.spring.componentâ€resource-pattern&#x3D;â€User* .classâ€ &#x2F;&gt;resource-pattern&#x3D;â€User*.classâ€: <strong>è¡¨ç¤ºåªæ‰«ææ»¡è¶³è¦æ±‚çš„ç±»</strong>.[ä½¿ç”¨çš„å°‘ï¼Œä¸æƒ³æ‰«æï¼Œä¸å†™æ³¨è§£å°±å¯ä»¥, çŸ¥é“è¿™ä¸ªçŸ¥è¯†ç‚¹å³å¯]</p></li><li><p>&lt;context:component-scan base-package&#x3D;â€com.hspedu.spring.componentâ€ &gt;</p><!-- æ’é™¤å“ªäº›ç±» , ä»¥ annotaion æ³¨è§£ä¸ºä¾‹ --><p>&lt;context:exclude-filter type&#x3D;â€annotationâ€expression&#x3D;â€org.springframework.stereotype.Serviceâ€&#x2F;&gt;</context></p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1) &lt;context:exclude-filter&gt; æ”¾åœ¨&lt;context:component-scan&gt;å†…ï¼Œè¡¨ç¤ºæ‰«æè¿‡æ»¤æ‰å½“å‰åŒ…çš„æŸäº›ç±»</span><br><span class="line">2) type=&quot;annotation&quot; æŒ‰ç…§æ³¨è§£ç±»å‹è¿›è¡Œè¿‡æ»¤.</span><br><span class="line">3) expression :å°±æ˜¯æ³¨è§£çš„å…¨ç±»åï¼Œæ¯”å¦‚ org.springframework.stereotype.Service å°±æ˜¯@Service æ³¨è§£çš„å…¨ç±»å,å…¶å®ƒæ¯”@Controller @Repository ç­‰ ä¾æ¬¡ç±»æ¨</span><br><span class="line">4) ä¸Šé¢è¡¨ç¤ºè¿‡æ»¤æ‰ com.hspedu.spring.component åŒ…ä¸‹ï¼ŒåŠ å…¥äº†@Service æ³¨è§£çš„ç±»</span><br><span class="line">5) å®Œæˆæµ‹è¯•ï¼Œ ä¿®æ”¹ beans.xml, å¢åŠ  exclude-filter , å‘ç° UserService, ä¸ä¼šæ³¨å…¥åˆ°å®¹å™¨.</span><br></pre></td></tr></table></figure><ol start="6"><li>æŒ‡å®šè‡ªåŠ¨æ‰«æå“ªäº›æ³¨è§£ç±»</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    éœ€æ±‚ï¼šå¦‚æœæˆ‘ä»¬å¸Œæœ›æŒ‰ç…§è‡ªå·±çš„è§„åˆ™ï¼Œæ¥æ‰«æåŒ…/å­åŒ…ä¸‹çš„æŸäº›æ³¨è§£, å¯ä»¥é€šè¿‡ include-filter</span></span><br><span class="line"><span class="comment">    1. use-default-filters=&quot;false&quot; è¡¨ç¤ºä¸ä½¿ç”¨é»˜è®¤çš„è¿‡æ»¤æœºåˆ¶/æ‰«ææœºåˆ¶</span></span><br><span class="line"><span class="comment">    2. context:include-filter è¡¨ç¤ºè¦å»æ‰«æå“ªäº›ç±»</span></span><br><span class="line"><span class="comment">    3. type=&quot;annotation&quot; æŒ‰ç…§æ³¨è§£æ–¹å¼æ¥æ‰«æ/è¿‡æ»¤</span></span><br><span class="line"><span class="comment">    4. expression=&quot;org.springframework.stereotype.Service&quot; æŒ‡å®šè¦æ‰«æçš„æ³¨è§£çš„å…¨è·¯å¾„</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hspedu.spring.component&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Service&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Repository&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="7"><li><p>é»˜è®¤æƒ…å†µï¼š<strong>æ ‡è®°æ³¨è§£åï¼Œé»˜è®¤æŠŠç±»åé¦–å­—æ¯å°å†™ä½œä¸º id çš„å€¼ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨æ³¨è§£çš„ value å±æ€§æŒ‡å®š id å€¼ï¼Œå¹¶ä¸” value å¯ä»¥çœç•¥ã€‚</strong></p></li><li><p>æ‰©å±•-@Controller ã€@Serviceã€@Component åŒºåˆ« : (å›å»çœ‹çœ‹ä¸€ä¸‹è€å¸ˆçš„è®²è§£çš„æ³¨è§£åŸºç¡€) <a href="https://zhuanlan.zhihu.com/p/454638478">https://zhuanlan.zhihu.com/p/454638478</a></p></li></ol><h3 id="2-3-19-ğŸŒŸæ‰‹åŠ¨å¼€å‘ç®€å•çš„-Spring-åŸºäºæ³¨è§£é…ç½®çš„ç¨‹åº"><a href="#2-3-19-ğŸŒŸæ‰‹åŠ¨å¼€å‘ç®€å•çš„-Spring-åŸºäºæ³¨è§£é…ç½®çš„ç¨‹åº" class="headerlink" title="2.3.19 ğŸŒŸæ‰‹åŠ¨å¼€å‘ç®€å•çš„ Spring åŸºäºæ³¨è§£é…ç½®çš„ç¨‹åº"></a>2.3.19 ğŸŒŸæ‰‹åŠ¨å¼€å‘ç®€å•çš„ Spring åŸºäºæ³¨è§£é…ç½®çš„ç¨‹åº</h3><p> -è€éŸ©è¦æ±‚: å°ä¼™ä¼´è¦è‡³å°‘ç‹¬ç«‹å†™ 2 é</p><h4 id="2-3-19-1-éœ€æ±‚è¯´æ˜"><a href="#2-3-19-1-éœ€æ±‚è¯´æ˜" class="headerlink" title="2.3.19.1 éœ€æ±‚è¯´æ˜"></a>2.3.19.1 éœ€æ±‚è¯´æ˜</h4><ol><li><p><strong>è‡ª å·± å†™ ä¸€ ä¸ª ç®€ å• çš„ Spring å®¹ å™¨ , é€š è¿‡ è¯» å– ç±» çš„ æ³¨ è§£ (@Component @Controller@Service @Reponsitory)ï¼Œ å°†å¯¹è±¡æ³¨å…¥åˆ° IOC å®¹å™¨</strong></p></li><li><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ä¸ä½¿ç”¨ Spring åŸç”Ÿæ¡†æ¶ï¼Œæˆ‘ä»¬è‡ªå·±ä½¿ç”¨ IO+Annotaion+åå°„+é›†åˆ æŠ€æœ¯å®ç°, æ‰“é€š Spring æ³¨è§£æ–¹å¼å¼€å‘çš„æŠ€æœ¯ç—›ç‚¹</strong></p></li></ol><h4 id="2-3-19-2-æ€è·¯åˆ†æ"><a href="#2-3-19-2-æ€è·¯åˆ†æ" class="headerlink" title="2.3.19.2 æ€è·¯åˆ†æ"></a>2.3.19.2 æ€è·¯åˆ†æ</h4><ol><li><p>æ€è·¯åˆ†æ+ç¨‹åºç»“æ„</p><p>1)æˆ‘ä»¬ä½¿ç”¨æ³¨è§£æ–¹å¼å®Œæˆ, è¿™é‡Œè€éŸ©ä¸ç”¨ xml æ¥é…</p><p>2)ç¨‹åºæ¡†æ¶å›¾</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230725093807908.png" alt="image-20230725093807908"></p><h4 id="2-3-19-3-ä»£ç å®ç°"><a href="#2-3-19-3-ä»£ç å®ç°" class="headerlink" title="2.3.19.3 ä»£ç å®ç°"></a>2.3.19.3 ä»£ç å®ç°</h4><p>â€‹â— åº”ç”¨å®ä¾‹</p><ol><li><p>æ‰‹åŠ¨å®ç°æ³¨è§£çš„æ–¹å¼æ¥é…ç½® Controller &#x2F; Service &#x2F; Respository &#x2F; Component</p></li><li><p>æˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£æ¥å®Œæˆ.</p><p>â— ä»£ç å®ç°</p></li><li><p>ä»ç„¶ä½¿ç”¨å‰é¢çš„ \com\hspedu\spring\component\ åŒ…ä¸‹çš„ç±»</p></li><li><p>åˆ›å»º ComponentScan.java</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£è¯»</span></span><br><span class="line"><span class="comment"> * 1. <span class="doctag">@Target</span>(ElementType.TYPE)æŒ‡å®šæˆ‘ä»¬çš„ComponentScanæ³¨è§£å¯ä»¥ä¿®é¥° Typeç¨‹åºå…ƒç´ </span></span><br><span class="line"><span class="comment"> * 2. <span class="doctag">@Retention</span>(RetentionPolicy.RUNTIME) æŒ‡å®šComponentScanæ³¨è§£ ä¿ç•™èŒƒå›´</span></span><br><span class="line"><span class="comment"> * 3. String value() default &quot;&quot;; è¡¨ç¤ºComponentScan å¯ä»¥ä¼ å…¥ value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ComponentScan &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>åˆ› å»º HspSpringConfig.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hspedu.spring.annotation;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> éŸ©é¡ºå¹³</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±», ä½œç”¨ç±»ä¼¼æˆ‘ä»¬åŸç”Ÿspringçš„ beans.xml å®¹å™¨é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentScan(value = &quot;com.hspedu.spring.component&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HspSpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>åˆ› å»º HspSpringApplicationContext.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HspSpringApplicationContext ç±»çš„ä½œç”¨ç±»ä¼¼SpringåŸç”Ÿiocå®¹å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HspSpringApplicationContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Class configClass;</span><br><span class="line">    <span class="comment">//iocæˆ‘å­˜æ”¾çš„å°±æ˜¯é€šè¿‡åå°„åˆ›å»ºçš„å¯¹è±¡(åŸºäºæ³¨è§£æ–¹å¼)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, Object&gt; ioc =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HspSpringApplicationContext</span><span class="params">(Class configClass)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.configClass = configClass;</span><br><span class="line">        System.out.println(<span class="string">&quot;this.configClass=&quot;</span> + <span class="built_in">this</span>.configClass);</span><br><span class="line">        <span class="comment">//è·å–è¦æ‰«æçš„åŒ…</span></span><br><span class="line">        <span class="comment">//1. å…ˆå¾—åˆ°HspSpringConfigé…ç½®çš„çš„@ComponentScan(value = &quot;com.hspedu.spring.component&quot;)</span></span><br><span class="line">        <span class="type">ComponentScan</span> <span class="variable">componentScan</span> <span class="operator">=</span></span><br><span class="line">                (ComponentScan) <span class="built_in">this</span>.configClass.getDeclaredAnnotation(ComponentScan.class);</span><br><span class="line">        <span class="comment">//2. é€šè¿‡componentScançš„value=&gt; å³è¦æ‰«æçš„åŒ…</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> componentScan.value();</span><br><span class="line">        System.out.println(<span class="string">&quot;è¦æ‰«æçš„åŒ…= &quot;</span> + path);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¾—åˆ°è¦æ‰«æçš„åŒ…ä¸‹çš„æ‰€æœ‰èµ„æº(ç±» .class)âš ï¸è¦å»outç›®å½•ä¸‹ï¼Œè€Œä¸æ˜¯srcç›®å½•</span></span><br><span class="line">        <span class="comment">//1.å¾—åˆ°ç±»çš„åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span></span><br><span class="line">                HspApplicationContext.class.getClassLoader();</span><br><span class="line">        <span class="comment">//2. é€šè¿‡ç±»çš„åŠ è½½å™¨è·å–åˆ°è¦æ‰«æçš„åŒ…çš„èµ„æº url=ã€‹ç±»ä¼¼ä¸€ä¸ªè·¯å¾„</span></span><br><span class="line">        path = path.replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;/&quot;</span>);<span class="comment">//ä¸€å®šè¦æŠŠ. æ›¿æ¢æˆ /</span></span><br><span class="line">        <span class="type">URL</span> <span class="variable">resource</span> <span class="operator">=</span></span><br><span class="line">                classLoader.getResource(path);</span><br><span class="line">        System.out.println(<span class="string">&quot;resource=&quot;</span> + resource);</span><br><span class="line">        <span class="comment">//3. å°†è¦åŠ è½½çš„èµ„æº(.class) è·¯å¾„ä¸‹çš„æ–‡ä»¶è¿›è¡Œéå†=&gt;io</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(resource.getFile());</span><br><span class="line">        <span class="keyword">if</span> (file.isDirectory()) &#123;</span><br><span class="line">            File[] files = file.listFiles();</span><br><span class="line">            <span class="keyword">for</span> (File f : files) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;=====================&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;=&quot;</span> + f.getAbsolutePath());</span><br><span class="line">                <span class="comment">//D:\hspedu_spring\spring\out\production\spring\com\hspedu\spring\component\UserService.class</span></span><br><span class="line">                <span class="comment">//è·å–åˆ° com.hspedu.spring.component.UserService</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">fileAbsolutePath</span> <span class="operator">=</span> f.getAbsolutePath();</span><br><span class="line"></span><br><span class="line">                <span class="comment">//è¿™é‡Œæˆ‘ä»¬åªå¤„ç†.classæ–‡ä»¶</span></span><br><span class="line">                <span class="keyword">if</span> (fileAbsolutePath.endsWith(<span class="string">&quot;.class&quot;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//1. è·å–åˆ°ç±»å</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span></span><br><span class="line">                            fileAbsolutePath.substring(fileAbsolutePath.lastIndexOf(<span class="string">&quot;\\&quot;</span>) + <span class="number">1</span>, fileAbsolutePath.indexOf(<span class="string">&quot;.class&quot;</span>));</span><br><span class="line">                    <span class="comment">//System.out.println(&quot;className=&quot; + className);</span></span><br><span class="line">                    <span class="comment">//2. è·å–ç±»çš„å®Œæ•´çš„è·¯å¾„(å…¨ç±»å)</span></span><br><span class="line">                    <span class="comment">//è€å¸ˆè§£è¯» path.replace(&quot;/&quot;,&quot;.&quot;) =&gt; com.hspedu.spring.component.</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">classFullName</span> <span class="operator">=</span> path.replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>) +  <span class="string">&quot;.&quot;</span> + className;</span><br><span class="line">                    <span class="comment">//System.out.println(&quot;classFullName=&quot; + classFullName);</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//3. åˆ¤æ–­è¯¥ç±»æ˜¯ä¸æ˜¯éœ€è¦æ³¨å…¥å®¹å™¨, å°±çœ‹è¯¥ç±»æ˜¯ä¸æ˜¯æœ‰æ³¨è§£ @Component @Service..</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">//è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¾—åˆ°è€è¯¥ç±»çš„Classå¯¹è±¡</span></span><br><span class="line">                        <span class="comment">//Class clazz = Class.forName(classFullName)</span></span><br><span class="line">                        <span class="comment">//è€å¸ˆè¯´ä¸€ä¸‹</span></span><br><span class="line">                        <span class="comment">//1. Class clazz = Class.forName(classFullName) å¯ä»¥åå°„åŠ è½½ç±»</span></span><br><span class="line">                        <span class="comment">//2. classLoader.loadClass(classFullName); å¯ä»¥åå°„ç±»çš„Class</span></span><br><span class="line">                        <span class="comment">//3. åŒºåˆ«æ˜¯ : ä¸Šé¢æ–¹å¼åè°ƒç”¨æ¥ç±»çš„é™æ€æ–¹æ³•, ä¸‹é¢æ–¹æ³•ä¸ä¼š</span></span><br><span class="line">                        <span class="comment">//4. aClass.isAnnotationPresent(Component.class) åˆ¤æ–­è¯¥ç±»æ˜¯å¦æœ‰ @Component</span></span><br><span class="line">                        Class&lt;?&gt; aClass = classLoader.loadClass(classFullName);</span><br><span class="line">                        <span class="keyword">if</span> (aClass.isAnnotationPresent(Component.class) ||</span><br><span class="line">                                aClass.isAnnotationPresent(Controller.class) ||</span><br><span class="line">                                aClass.isAnnotationPresent(Service.class) ||</span><br><span class="line">                                aClass.isAnnotationPresent(Repository.class)) &#123;</span><br><span class="line"></span><br><span class="line">                            <span class="comment">//è¿™é‡Œè€å¸ˆæ¼”ç¤ºä¸€ä¸ªComponentæ³¨è§£æŒ‡å®švalue,åˆ†é…id</span></span><br><span class="line">                            <span class="comment">//è€å¸ˆå°±æ˜¯æ¼”ç¤ºäº†ä¸€ä¸‹æœºåˆ¶.</span></span><br><span class="line">                            <span class="keyword">if</span>(aClass.isAnnotationPresent(Component.class)) &#123;</span><br><span class="line">                                <span class="comment">//è·å–åˆ°è¯¥æ³¨è§£</span></span><br><span class="line">                                <span class="type">Component</span> <span class="variable">component</span> <span class="operator">=</span> aClass.getDeclaredAnnotation(Component.class);</span><br><span class="line">                                <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> component.value();</span><br><span class="line">                                <span class="keyword">if</span>(!<span class="string">&quot;&quot;</span>.endsWith(id)) &#123;</span><br><span class="line">                                    className = id;<span class="comment">//æ›¿æ¢</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="comment">//è¿™æ—¶å°±å¯ä»¥åå°„å¯¹è±¡ï¼Œå¹¶æ”¾å…¥åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">                            Class&lt;?&gt; clazz = Class.forName(classFullName);</span><br><span class="line">                            <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> clazz.newInstance();</span><br><span class="line">                            <span class="comment">//æ”¾å…¥åˆ°å®¹å™¨ä¸­, å°†ç±»åçš„é¦–å­—æ¯å°å†™ä½œä¸ºid</span></span><br><span class="line">                            <span class="comment">//StringUtils</span></span><br><span class="line"></span><br><span class="line">                            ioc.put(StringUtils.uncapitalize(className) , instance);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¼–å†™æ–¹æ³•è¿”å›å¯¹å®¹å™¨ä¸­å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ioc.get(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-3-19-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"><a href="#2-3-19-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜" class="headerlink" title="2.3.19.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"></a>2.3.19.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜</h4><p>è¿˜å¯ä»¥é€šè¿‡@Component(value &#x3D; â€œxxâ€) @Controller(value &#x3D; â€œyyâ€) @Service(value &#x3D; â€œzzâ€)ä¸­æŒ‡å®šçš„ value, ç»™ bean åˆ†é… id</p><h3 id="2-3-20-è‡ªåŠ¨è£…é…"><a href="#2-3-20-è‡ªåŠ¨è£…é…" class="headerlink" title="2.3.20 è‡ªåŠ¨è£…é…"></a>2.3.20 è‡ªåŠ¨è£…é…</h3><h4 id="2-3-20-1-åº”ç”¨å®ä¾‹"><a href="#2-3-20-1-åº”ç”¨å®ä¾‹" class="headerlink" title="2.3.20.1 åº”ç”¨å®ä¾‹"></a>2.3.20.1 åº”ç”¨å®ä¾‹</h4><p>â€‹â— åŸºæœ¬è¯´æ˜</p><ol><li><p>åŸºäºæ³¨è§£é…ç½® beanï¼Œä¹Ÿå¯å®ç°è‡ªåŠ¨è£…é…ï¼Œä½¿ç”¨çš„æ³¨è§£æ˜¯ï¼š@AutoWired æˆ–è€… @Resource</p></li><li><p><strong>@AutoWired çš„è§„åˆ™è¯´æ˜</strong></p><ol><li>ğŸŒŸåœ¨ IOC å®¹å™¨ä¸­æŸ¥æ‰¾å¾…è£…é…çš„ç»„ä»¶çš„<strong>ç±»å‹</strong>ï¼Œå¦‚æœæœ‰å”¯ä¸€çš„ bean åŒ¹é…ï¼Œåˆ™ä½¿ç”¨è¯¥ bean è£…é… </li><li>ğŸŒŸå¦‚å¾…è£…é…çš„ç±»å‹å¯¹åº”çš„ bean åœ¨ IOC å®¹å™¨ä¸­æœ‰å¤šä¸ªï¼Œåˆ™ä½¿ç”¨<strong>å¾…è£…é…çš„å±æ€§çš„å±æ€§åä½œä¸º id å€¼</strong>å†è¿›è¡ŒæŸ¥æ‰¾, æ‰¾åˆ°å°±è£…é…ï¼Œæ‰¾ä¸åˆ°å°±æŠ›å¼‚å¸¸</li></ol></li><li><p><strong>@Resource çš„è§„åˆ™è¯´æ˜</strong></p><ol><li>ğŸŒŸ@Resource æœ‰ä¸¤ä¸ªå±æ€§æ˜¯æ¯”è¾ƒé‡è¦çš„,åˆ†æ˜¯ name å’Œ type,Spring å°†@Resource æ³¨è§£çš„name å±æ€§è§£æä¸º bean çš„åå­—,è€Œ type å±æ€§åˆ™è§£æä¸º bean çš„ç±»å‹.æ‰€ä»¥å¦‚æœä½¿ç”¨ name å±æ€§,åˆ™ä½¿ç”¨ byName çš„è‡ªåŠ¨æ³¨å…¥ç­–ç•¥,è€Œä½¿ç”¨ type å±æ€§æ—¶åˆ™ä½¿ç”¨ byType è‡ªåŠ¨æ³¨å…¥ç­–ç•¥(åŒæ ·ï¼Œå®¹å™¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªè¯¥ç±»å‹çš„å¯¹è±¡)</li><li>ğŸŒŸå¦‚æœ@Resource æ²¡æœ‰æŒ‡å®š name å’Œ type ,åˆ™å…ˆä½¿ç”¨byNameæ³¨å…¥ç­–ç•¥(ç”¨ä½ çš„å¯¹è±¡åå­—æ‰¾iocå®¹å™¨ä¸­çš„id), å¦‚æœåŒ¹é…ä¸ä¸Š,å†ä½¿ç”¨ byType ç­–ç•¥(iocå®¹å™¨ä¸­è¯¥ç±»å‹å¯¹è±¡å¿…é¡»å”¯ä¸€), å¦‚æœéƒ½ä¸æˆåŠŸï¼Œå°±ä¼šæŠ¥é”™</li></ol></li><li><p>æ€»ç»“ï¼š<strong>ä¸ç®¡æ˜¯@Autowired è¿˜æ˜¯ @Resourceéƒ½ä¿è¯å±æ€§åæ˜¯è§„èŒƒçš„å†™æ³•å°±å¯ä»¥æ³¨å…¥.</strong></p></li></ol><h4 id="2-3-20-2-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"><a href="#2-3-20-2-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜" class="headerlink" title="2.3.20.2 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"></a>2.3.20.2 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜</h4><ol><li>å¦‚å¾…è£…é…çš„ç±»å‹å¯¹åº”çš„ bean åœ¨ IOC å®¹å™¨ä¸­æœ‰å¤šä¸ªï¼Œ åˆ™ä½¿ç”¨å¾…è£…é…çš„å±æ€§çš„å±æ€§åä½œä¸º id å€¼å†è¿›è¡ŒæŸ¥æ‰¾, æ‰¾åˆ°å°±è£…é…ï¼Œ æ‰¾ä¸åˆ°å°±æŠ›å¼‚å¸¸</li></ol><h3 id="2-3-21-æ³›å‹ä¾èµ–æ³¨å…¥"><a href="#2-3-21-æ³›å‹ä¾èµ–æ³¨å…¥" class="headerlink" title="2.3.21 æ³›å‹ä¾èµ–æ³¨å…¥"></a>2.3.21 æ³›å‹ä¾èµ–æ³¨å…¥</h3><h4 id="2-3-21-1-æ³›å‹ä¾èµ–è§£é‡Š"><a href="#2-3-21-1-æ³›å‹ä¾èµ–è§£é‡Š" class="headerlink" title="2.3.21.1 æ³›å‹ä¾èµ–è§£é‡Š"></a>2.3.21.1 æ³›å‹ä¾èµ–è§£é‡Š</h4><p>â€‹â— åŸºæœ¬è¯´æ˜</p><ol><li><p><strong>ä¸ºäº†æ›´å¥½çš„ç®¡ç†æœ‰ç»§æ‰¿å’Œç›¸äº’ä¾èµ–çš„ bean çš„è‡ªåŠ¨è£…é…</strong>ï¼Œ spring è¿˜æä¾›åŸºäºæ³›å‹ä¾èµ–çš„æ³¨å…¥æœºåˆ¶</p></li><li><p>åœ¨ç»§æ‰¿å…³ç³»å¤æ‚æƒ…å†µä¸‹ï¼Œ æ³›å‹ä¾èµ–æ³¨å…¥å°±ä¼šæœ‰å¾ˆå¤§çš„ä¼˜è¶Šæ€§</p></li></ol><h4 id="2-3-21-2-åº”ç”¨å®ä¾‹"><a href="#2-3-21-2-åº”ç”¨å®ä¾‹" class="headerlink" title="2.3.21.2 åº”ç”¨å®ä¾‹"></a>2.3.21.2 åº”ç”¨å®ä¾‹</h4><p>â€‹â— åº”ç”¨å®ä¾‹éœ€æ±‚</p><ol><li>å„ä¸ªç±»å…³ç³»å›¾</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230725145512754.png" alt="image-20230725145512754"></p><ol start="2"><li>ä¼ ç»Ÿæ–¹æ³•æ˜¯å°† PhoneDao &#x2F;BookDao è‡ªåŠ¨è£…é…åˆ° BookService&#x2F;PhoneSerive ä¸­ï¼Œå½“è¿™ç§ç»§æ‰¿å…³ç³»å¤šæ—¶ï¼Œå°±æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨ spring æä¾›çš„æ³›å‹ä¾èµ–æ³¨å…¥</li></ol><p>(è·Ÿé…ç½®mybatis plusçš„serviceå±‚ã€implå±‚ã€mapperå±‚ä¹‹é—´çš„å…³ç³»å¾ˆåƒ)</p><h1 id="3-AOP"><a href="#3-AOP" class="headerlink" title="3 AOP"></a>3 AOP</h1><h2 id="3-1-å®˜æ–¹æ–‡æ¡£"><a href="#3-1-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="3.1 å®˜æ–¹æ–‡æ¡£"></a>3.1 å®˜æ–¹æ–‡æ¡£</h2><h3 id="3-1-1-AOP-è®²è§£"><a href="#3-1-1-AOP-è®²è§£" class="headerlink" title="3.1.1 AOP è®²è§£:"></a>3.1.1 AOP è®²è§£:</h3><p>spring-framework-5.3.8&#x2F;docs&#x2F;reference&#x2F;html&#x2F;core.html#aop</p><h3 id="3-1-2-AOP-APIs"><a href="#3-1-2-AOP-APIs" class="headerlink" title="3.1.2 AOP APIs :"></a>3.1.2 AOP APIs :</h3><p>spring-framework-5.3.8&#x2F;docs&#x2F;reference&#x2F;html&#x2F;core.html#aop-api</p><h2 id="3-2-åŠ¨æ€ä»£ç†-ç²¾è‡´å°æ¡ˆä¾‹"><a href="#3-2-åŠ¨æ€ä»£ç†-ç²¾è‡´å°æ¡ˆä¾‹" class="headerlink" title="3.2 åŠ¨æ€ä»£ç†-ç²¾è‡´å°æ¡ˆä¾‹"></a>3.2 åŠ¨æ€ä»£ç†-ç²¾è‡´å°æ¡ˆä¾‹</h2><h3 id="3-2-1-éœ€æ±‚è¯´æ˜"><a href="#3-2-1-éœ€æ±‚è¯´æ˜" class="headerlink" title="3.2.1 éœ€æ±‚è¯´æ˜"></a>3.2.1 éœ€æ±‚è¯´æ˜</h3><p>â— éœ€æ±‚è¯´æ˜</p><ol><li>æœ‰ Vehicle(äº¤é€šå·¥å…·æ¥å£, æœ‰ä¸€ä¸ª run æ–¹æ³•), ä¸‹é¢æœ‰ä¸¤ä¸ªå®ç°ç±» Car å’Œ Ship</li><li>å½“è¿è¡Œ Car å¯¹è±¡ çš„ run æ–¹æ³•å’Œ Ship å¯¹è±¡çš„ run æ–¹æ³•æ—¶ï¼Œè¾“å…¥å¦‚ä¸‹å†…å®¹, æ³¨æ„è§‚å¯Ÿå‰åæœ‰ç»Ÿä¸€çš„è¾“å‡º.</li></ol><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230725153717459.png" alt="image-20230725153717459" style="zoom:50%;" /><h3 id="3-2-2-è§£å†³æ–¹æ¡ˆ-ä¼ ç»Ÿæ–¹å¼"><a href="#3-2-2-è§£å†³æ–¹æ¡ˆ-ä¼ ç»Ÿæ–¹å¼" class="headerlink" title="3.2.2 è§£å†³æ–¹æ¡ˆ-ä¼ ç»Ÿæ–¹å¼"></a>3.2.2 è§£å†³æ–¹æ¡ˆ-ä¼ ç»Ÿæ–¹å¼</h3><ol><li><p>ä¼ ç»Ÿçš„è§£å†³æ€è·¯ï¼Œ åœ¨å„ä¸ªæ–¹æ³•çš„[å‰ï¼Œ æ‰§è¡Œè¿‡ç¨‹, å]è¾“å‡ºæ—¥å¿—æç¤ºä¿¡æ¯</p></li><li><p>æ¥æ€è€ƒä¸€ä¸‹ï¼Œ è§£å†³æ–¹æ¡ˆå¥½å—? &#x3D;&#x3D;&#x3D;&gt; ä»£ç å†—ä½™, å…¶å®å°±æ˜¯å•ä¸ªå¯¹è±¡çš„è°ƒç”¨,å¹¶æ²¡æœ‰å¾ˆå¥½çš„è§£å†³</p></li></ol><h3 id="3-2-3-è§£å†³æ–¹æ¡ˆ-ğŸŒŸåŠ¨æ€ä»£ç†æ–¹å¼"><a href="#3-2-3-è§£å†³æ–¹æ¡ˆ-ğŸŒŸåŠ¨æ€ä»£ç†æ–¹å¼" class="headerlink" title="3.2.3 è§£å†³æ–¹æ¡ˆ-ğŸŒŸåŠ¨æ€ä»£ç†æ–¹å¼ !!!!!!!!"></a>3.2.3 è§£å†³æ–¹æ¡ˆ-ğŸŒŸåŠ¨æ€ä»£ç†æ–¹å¼ !!!!!!!!</h3><p>â— è§£å†³æ–¹æ¡ˆ 2-ä»£ç å®ç°</p><ol><li>åŠ¨æ€ä»£ç†è§£å†³æ€è·¯ï¼Œåœ¨è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä½¿ç”¨åå°„æœºåˆ¶ï¼Œæ ¹æ®æ–¹æ³•å»å†³å®šè°ƒç”¨å“ªä¸ªå¯¹è±¡æ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hspedu.spring.proxy2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> éŸ©é¡ºå¹³</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * æ¥å£ï¼Œè¯¥æ¥å£æœ‰runæ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fly</span><span class="params">(<span class="type">int</span> height)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hspedu.spring.proxy2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * VehicleProxyProvider è¯¥ç±»å¯ä»¥è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VehicleProxyProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®šä¹‰ä¸€ä¸ªå±æ€§</span></span><br><span class="line">    <span class="comment">//target_vehicle è¡¨ç¤ºçœŸæ­£è¦æ‰§è¡Œçš„å¯¹è±¡</span></span><br><span class="line">    <span class="comment">//è¯¥å¯¹è±¡å®ç°äº†Vehicleæ¥å£</span></span><br><span class="line">    <span class="keyword">private</span> Vehicle target_vehicle;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VehicleProxyProvider</span><span class="params">(Vehicle target_vehicle)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target_vehicle = target_vehicle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡, è¯¥ä»£ç†å¯¹è±¡å¯ä»¥é€šè¿‡åå°„æœºåˆ¶è°ƒç”¨åˆ°è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line">    <span class="comment">//è€å¸ˆè§£è¯»</span></span><br><span class="line">    <span class="comment">//1. è¿™ä¸ªæ–¹æ³•éå¸¸é‡è¦ï¼Œ ç†è§£æœ‰ä¸€å®šéš¾åº¦</span></span><br><span class="line">    <span class="keyword">public</span> Vehicle <span class="title function_">getProxy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¾—åˆ°ç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span></span><br><span class="line">                target_vehicle.getClass().getClassLoader();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¾—åˆ°è¦ä»£ç†çš„å¯¹è±¡/è¢«æ‰§è¡Œå¯¹è±¡ çš„æ¥å£ä¿¡æ¯,åº•å±‚æ˜¯é€šè¿‡æ¥å£æ¥å®Œæˆè°ƒç”¨</span></span><br><span class="line">        Class&lt;?&gt;[] interfaces = target_vehicle.getClass().getInterfaces();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºInvocationHandler å¯¹è±¡</span></span><br><span class="line">        <span class="comment">//å› ä¸º InvocationHandler æ˜¯æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡åŒ¿åå¯¹è±¡çš„æ–¹å¼æ¥åˆ›å»ºè¯¥å¯¹è±¡</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * public interface InvocationHandler &#123;</span></span><br><span class="line"><span class="comment">         *  public Object invoke(Object proxy, Method method, Object[] args)</span></span><br><span class="line"><span class="comment">         *         throws Throwable;</span></span><br><span class="line"><span class="comment">         * &#125;</span></span><br><span class="line"><span class="comment">         * invoke æ–¹æ³•æ˜¯å°†æ¥æ‰§è¡Œæˆ‘ä»¬çš„target_vehicleçš„æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨åˆ°</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * invoke æ–¹æ³•æ˜¯å°†æ¥æ‰§è¡Œæˆ‘ä»¬çš„target_vehicleçš„æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨åˆ°</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> o è¡¨ç¤ºä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> method å°±æ˜¯é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œçš„å“ªä¸ªæ–¹æ³• ä»£ç†å¯¹è±¡.run()</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> args : è¡¨ç¤ºè°ƒç”¨ ä»£ç†å¯¹è±¡.run(xx) ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span> è¡¨ç¤º ä»£ç†å¯¹è±¡.run(xx) æ‰§è¡Œåçš„ç»“æœ.</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object o, Method method, Object[] args)</span></span><br><span class="line">                    <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">&quot;äº¤é€šå·¥å…·å¼€å§‹è¿è¡Œäº†....&quot;</span>);</span><br><span class="line">                <span class="comment">//è¿™é‡Œæ˜¯æˆ‘ä»¬çš„åå°„åŸºç¡€ =&gt; OOP</span></span><br><span class="line">                <span class="comment">//method æ˜¯ï¼Ÿ: public abstract void com.hspedu.spring.proxy2.Vehicle.run()</span></span><br><span class="line">                <span class="comment">//target_vehicle æ˜¯?: Shipå¯¹è±¡</span></span><br><span class="line">                <span class="comment">//args æ˜¯null</span></span><br><span class="line">                <span class="comment">//è¿™é‡Œé€šè¿‡åå°„+åŠ¨æ€ç»‘å®šæœºåˆ¶ï¼Œå°±ä¼šæ‰§è¡Œåˆ°è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line">                <span class="comment">//æ‰§è¡Œå®Œæ¯•å°±è¿”å›</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target_vehicle, args);</span><br><span class="line">                System.out.println(<span class="string">&quot;äº¤é€šå·¥å…·åœæ­¢è¿è¡Œäº†....&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          public static Object newProxyInstance(ClassLoader loader,</span></span><br><span class="line"><span class="comment">                                          Class&lt;?&gt;[] interfaces,</span></span><br><span class="line"><span class="comment">                                          InvocationHandler h)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="comment">          1. Proxy.newProxyInstance() å¯ä»¥è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">          2. ClassLoader loader: ç±»çš„åŠ è½½å™¨.</span></span><br><span class="line"><span class="comment">          3. Class&lt;?&gt;[] interfaces å°±æ˜¯å°†æ¥è¦ä»£ç†çš„å¯¹è±¡çš„æ¥å£ä¿¡æ¯</span></span><br><span class="line"><span class="comment">          4. InvocationHandler h è°ƒç”¨å¤„ç†å™¨/å¯¹è±¡ æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æ–¹æ³•invoke</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">proxy</span> <span class="operator">=</span></span><br><span class="line">                (Vehicle)Proxy.newProxyInstance(classLoader, interfaces, invocationHandler);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hspedu.spring.proxy2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> éŸ©é¡ºå¹³</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestVehicle</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//OOPåŸºç¡€=&gt;javaåŸºç¡€</span></span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">vehicle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ship</span>();</span><br><span class="line">        <span class="comment">//åŠ¨æ€ç»‘å®š</span></span><br><span class="line">        vehicle.run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">proxyRun</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºShipå¯¹è±¡</span></span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">vehicle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºVehicleProxyProviderå¯¹è±¡, å¹¶ä¸”æˆ‘ä»¬ä¼ å…¥çš„è¦ä»£ç†çš„å¯¹è±¡</span></span><br><span class="line">        <span class="type">VehicleProxyProvider</span> <span class="variable">vehicleProxyProvider</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">VehicleProxyProvider</span>(vehicle);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–ä»£ç†å¯¹è±¡, è¯¥å¯¹è±¡å¯ä»¥ä»£ç†æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">        <span class="comment">//è€å¸ˆè§£è¯»</span></span><br><span class="line">        <span class="comment">//1. porxy ç¼–è¯‘ç±»å‹ Vehicle</span></span><br><span class="line">        <span class="comment">//2. è¿è¡Œç±»å‹ æ˜¯ä»£ç†ç±»å‹ class com.sun.proxy.$Proxy9</span></span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">proxy</span> <span class="operator">=</span> vehicleProxyProvider.getProxy();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;proxyçš„ç¼–è¯‘ç±»å‹æ˜¯ Vehicle&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;proxyçš„è¿è¡Œç±»å‹æ˜¯ &quot;</span> + proxy.getClass());</span><br><span class="line">        <span class="comment">//ä¸‹é¢è€éŸ©å°±è¦ç»™å¤§å®¶è§£è¯»/debugæ€ä¹ˆ æ‰§è¡Œåˆ° ä»£ç†å¯¹è±¡çš„ public Object invoke(Object o, Method method, Object[] args)</span></span><br><span class="line">        <span class="comment">//æ¢³ç†å®Œæ¯•. proxyçš„ç¼–è¯‘ç±»å‹æ˜¯ Vehicle, è¿è¡Œç±»å‹æ˜¯ class com.sun.proxy.$Proxy9</span></span><br><span class="line">        <span class="comment">//æ‰€ä»¥å½“æ‰§è¡Œrunæ–¹æ³•æ—¶ï¼Œä¼šæ‰§è¡Œåˆ° ä»£ç†å¯¹è±¡çš„invoke</span></span><br><span class="line">        <span class="comment">//å¦‚ä½•ä½“ç°åŠ¨æ€ [1. è¢«ä»£ç†çš„å¯¹è±¡ 2. æ–¹æ³•]</span></span><br><span class="line">        <span class="comment">//proxy.run();</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> proxy.fly(<span class="number">10000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;result=&quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-3-åŠ¨æ€ä»£ç†æ·±å…¥"><a href="#3-3-åŠ¨æ€ä»£ç†æ·±å…¥" class="headerlink" title="3.3 åŠ¨æ€ä»£ç†æ·±å…¥"></a>3.3 åŠ¨æ€ä»£ç†æ·±å…¥</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hspedu.spring.aop.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> éŸ©é¡ºå¹³</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * å¯ä»¥è¿”å›ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡, å¯ä»¥æ‰§è¡ŒSmartDogå¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProxyProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®šä¹‰æˆ‘ä»¬è¦æ‰§è¡Œçš„ç›®æ ‡å¯¹è±¡, è¯¥å¯¹è±¡éœ€è¦å®ç°SmartAnimalable</span></span><br><span class="line">    <span class="keyword">private</span> SmartAnimalable target_obj;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyProxyProvider</span><span class="params">(SmartAnimalable target_obj)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target_obj = target_obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ–¹æ³•, å¯ä»¥è¿”å›ä»£ç†å¯¹è±¡ï¼Œè¯¥ä»£ç†å¯¹è±¡å¯ä»¥æ‰§è¡Œç›®æ ‡å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> SmartAnimalable <span class="title function_">getProxy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. å…ˆåˆ°çš„ç±»åŠ è½½å™¨/å¯¹è±¡</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> target_obj.getClass().getClassLoader();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. å¾—åˆ°è¦æ‰§è¡Œçš„ç›®æ ‡å¯¹è±¡çš„æ¥å£ä¿¡æ¯</span></span><br><span class="line">        Class&lt;?&gt;[] interfaces = target_obj.getClass().getInterfaces();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. åˆ›å»ºInvocationHandler</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œå‰-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + method.getName() + <span class="string">&quot;-å‚æ•° &quot;</span></span><br><span class="line">                            + Arrays.asList(args)); <span class="comment">//è¿™é‡Œä»AOPçœ‹ï¼Œå°±æ˜¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹-å‰ç½®é€šçŸ¥</span></span><br><span class="line">                    <span class="comment">//ä½¿ç”¨åå°„è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">                    result = method.invoke(target_obj, args);</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œæ­£å¸¸ç»“æŸ-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + method.getName() + <span class="string">&quot;-ç»“æœresult= &quot;</span></span><br><span class="line">                            + result);<span class="comment">//ä»AOPçœ‹, ä¹Ÿæ˜¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹-è¿”å›é€šçŸ¥</span></span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    <span class="comment">//å¦‚æœåå°„æ‰§è¡Œæ–¹æ³•æ—¶ï¼Œå‡ºç°å¼‚å¸¸,å°±ä¼šè¿›å…¥åˆ°catch&#123;&#125;</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œå¼‚å¸¸-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + method.getName()</span><br><span class="line">                            + <span class="string">&quot;-å¼‚å¸¸ç±»å‹=&quot;</span> + e.getClass().getName());<span class="comment">//ä»AOPçœ‹, ä¹Ÿæ˜¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹-å¼‚å¸¸é€šçŸ¥</span></span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;<span class="comment">//ä¸ç®¡ä½ æ˜¯å¦å‡ºç°å¼‚å¸¸,æœ€ç»ˆéƒ½ä¼šæ‰§è¡Œåˆ°finally&#123;&#125;</span></span><br><span class="line">                    <span class="comment">//ä»AOPçš„è§’åº¦çœ‹, ä¹Ÿæ˜¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹-æœ€ç»ˆé€šçŸ¥</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;æ–¹æ³•æœ€ç»ˆç»“æŸ-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + method.getName());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºä»£ç†å¯¹è±¡</span></span><br><span class="line">        <span class="type">SmartAnimalable</span> <span class="variable">proxy</span> <span class="operator">=</span></span><br><span class="line">                (SmartAnimalable)Proxy.newProxyInstance(classLoader, interfaces, invocationHandler);</span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-4-è€éŸ©åˆ†æï¼š-é—®é¢˜å†æ¬¡å‡ºç°"><a href="#3-4-è€éŸ©åˆ†æï¼š-é—®é¢˜å†æ¬¡å‡ºç°" class="headerlink" title="3.4 è€éŸ©åˆ†æï¼š é—®é¢˜å†æ¬¡å‡ºç°"></a>3.4 è€éŸ©åˆ†æï¼š é—®é¢˜å†æ¬¡å‡ºç°</h2><h3 id="3-4-1-é—®é¢˜æå‡º"><a href="#3-4-1-é—®é¢˜æå‡º" class="headerlink" title="3.4.1 é—®é¢˜æå‡º"></a>3.4.1 é—®é¢˜æå‡º</h3><p>â€‹â— é—®é¢˜æå‡º</p><ol><li>åœ¨ MyProxyProvider.java ä¸­, æˆ‘ä»¬çš„è¾“å‡ºè¯­å¥åŠŸèƒ½æ¯”è¾ƒå¼±ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æ˜¯ä»¥ä¸€ä¸ªæ–¹æ³•çš„å½¢å¼ï¼ŒåµŒå…¥åˆ°çœŸæ­£æ‰§è¡Œçš„ç›®æ ‡æ–¹æ³•å‰ï¼Œæ€ä¹ˆåŠ?</li><li>ä¹Ÿå°±æ˜¯å¦‚å›¾åˆ†æ</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230725164754136.png" alt="image-20230725164754136"></p><h3 id="3-4-2-ç”¨è€éŸ©çš„åœŸæ–¹æ³•è§£å†³"><a href="#3-4-2-ç”¨è€éŸ©çš„åœŸæ–¹æ³•è§£å†³" class="headerlink" title="3.4.2 ç”¨è€éŸ©çš„åœŸæ–¹æ³•è§£å†³"></a>3.4.2 ç”¨è€éŸ©çš„åœŸæ–¹æ³•è§£å†³</h3><ol><li><p>éœ€æ±‚åˆ†æï¼š ä½¿ç”¨è€éŸ©çš„åœŸæ–¹æ³•è§£å†³å‰é¢çš„é—®é¢˜ &#x3D;&gt; åé¢ä½¿ç”¨ Spring çš„ AOP ç»„ä»¶å®Œæˆ, å…ˆè¿‡è‹¦æ—¥å­ï¼Œ å†è¿‡ç”œæ—¥å­</p></li><li><p>å…ˆæ–°å»ºä¸€ä¸ªåŒ…ï¼ŒæŠŠç›¸å…³æ–‡ä»¶æ‹·è´è¿‡æ¥ï¼Œè¿›è¡Œä¿®æ”¹å®Œæˆï¼Œæ€è·¯æ›´åŠ æ¸…æ™°.</p></li></ol><p>è€å¸ˆå­¦ä¹ å°æŠ€å·§:æ–°å»ºä¸€ä¸ªåŒ…ï¼Œä¿ç•™åŸæ¥çš„ä»£ç </p><p>å…·ä½“å®ç°æ–¹å¼çœç•¥â€¦â€¦â€¦â€¦æŠŠçº¢æ¡†é‡Œçš„ä»£ç åœ¨åŒä¸€ç±»ä¸­è‡ªè¡Œå°è£…æˆä¸€ä¸ªä¸ªæ–¹æ³•å³å¯</p><ol start="3"><li>è¯¥æ–¹æ³•é—®é¢˜åˆ†æï¼šè€¦åˆåº¦é«˜</li></ol><h3 id="3-4-3-å¯¹åœŸæ–¹æ³•è§£è€¦-å¼€å‘ç®€æ˜“çš„-AOP-ç±»"><a href="#3-4-3-å¯¹åœŸæ–¹æ³•è§£è€¦-å¼€å‘ç®€æ˜“çš„-AOP-ç±»" class="headerlink" title="3.4.3 å¯¹åœŸæ–¹æ³•è§£è€¦-å¼€å‘ç®€æ˜“çš„ AOP ç±»"></a>3.4.3 å¯¹åœŸæ–¹æ³•è§£è€¦-å¼€å‘ç®€æ˜“çš„ AOP ç±»</h3><p>æŠŠè¿™äº›æ–¹æ³•æŠ½å‡ºï¼Œæ”¾åˆ°ä¸€ä¸ªç±»ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> éŸ©é¡ºå¹³</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * æˆ‘ä»¬è‡ªå·±ç¼–å†™ä¸€ä¸ªä¸€ä¸ªæç®€çš„AOPç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HspAOP</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æˆ‘ä»¬ä¸€ä¸ªæ–¹æ³•,åœ¨ç›®æ ‡å¯¹è±¡æ‰§è¡Œå‰æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(Object proxy, Method method, Object[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;HspAOP-æ–¹æ³•æ‰§è¡Œå‰-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + method.getName() + <span class="string">&quot;-å‚æ•° &quot;</span></span><br><span class="line">                + Arrays.asList(args)); <span class="comment">//è¿™é‡Œä»AOPçœ‹ï¼Œå°±æ˜¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹-å‰ç½®é€šçŸ¥</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æˆ‘ä»¬ä¸€ä¸ªæ–¹æ³•,åœ¨ç›®æ ‡å¯¹è±¡æ‰§è¡Œåæ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(Method method, Object result)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;HspAOP-æ–¹æ³•æ‰§è¡Œæ­£å¸¸ç»“æŸ-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + method.getName() + <span class="string">&quot;-ç»“æœresult= &quot;</span> + result);<span class="comment">//ä»AOPçœ‹, ä¹Ÿæ˜¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹-è¿”å›é€šçŸ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-4-å†æ¬¡åˆ†æ-æå‡º-Spring-AOP"><a href="#3-4-4-å†æ¬¡åˆ†æ-æå‡º-Spring-AOP" class="headerlink" title="3.4.4 å†æ¬¡åˆ†æ-æå‡º Spring AOP"></a>3.4.4 å†æ¬¡åˆ†æ-æå‡º Spring AOP</h3><h4 id="3-4-4-1-åœŸæ–¹æ³•-ä¸å¤Ÿçµæ´»"><a href="#3-4-4-1-åœŸæ–¹æ³•-ä¸å¤Ÿçµæ´»" class="headerlink" title="3.4.4.1 åœŸæ–¹æ³• ä¸å¤Ÿçµæ´»"></a>3.4.4.1 åœŸæ–¹æ³• ä¸å¤Ÿçµæ´»</h4><h4 id="3-4-4-2-åœŸæ–¹æ³•-å¤ç”¨æ€§å·®"><a href="#3-4-4-2-åœŸæ–¹æ³•-å¤ç”¨æ€§å·®" class="headerlink" title="3.4.4.2 åœŸæ–¹æ³• å¤ç”¨æ€§å·®"></a>3.4.4.2 åœŸæ–¹æ³• å¤ç”¨æ€§å·®</h4><h4 id="3-4-4-3-åœŸæ–¹æ³•-è¿˜æ˜¯ä¸€ç§ç¡¬ç¼–ç -å› ä¸ºæ²¡æœ‰æ³¨è§£å’Œåå°„æ”¯æ’‘"><a href="#3-4-4-3-åœŸæ–¹æ³•-è¿˜æ˜¯ä¸€ç§ç¡¬ç¼–ç -å› ä¸ºæ²¡æœ‰æ³¨è§£å’Œåå°„æ”¯æ’‘" class="headerlink" title="3.4.4.3 åœŸæ–¹æ³• è¿˜æ˜¯ä¸€ç§ç¡¬ç¼–ç (å› ä¸ºæ²¡æœ‰æ³¨è§£å’Œåå°„æ”¯æ’‘)"></a>3.4.4.3 åœŸæ–¹æ³• è¿˜æ˜¯ä¸€ç§ç¡¬ç¼–ç (å› ä¸ºæ²¡æœ‰æ³¨è§£å’Œåå°„æ”¯æ’‘)</h4><h4 id="3-4-4-4-Spring-AOP-é—ªäº®ç™»åœº-åº•å±‚æ˜¯-ASPECTJ"><a href="#3-4-4-4-Spring-AOP-é—ªäº®ç™»åœº-åº•å±‚æ˜¯-ASPECTJ" class="headerlink" title="3.4.4.4 Spring AOP é—ªäº®ç™»åœº-åº•å±‚æ˜¯ ASPECTJ"></a>3.4.4.4 Spring AOP é—ªäº®ç™»åœº-åº•å±‚æ˜¯ ASPECTJ</h4><h4 id="3-4-4-5-æœ‰äº†å‰é¢çš„æŠ€æœ¯å¼•å¯¼ï¼Œ-ç†è§£-Spring-AOP-å°±æ°´åˆ°æ¸ æˆ"><a href="#3-4-4-5-æœ‰äº†å‰é¢çš„æŠ€æœ¯å¼•å¯¼ï¼Œ-ç†è§£-Spring-AOP-å°±æ°´åˆ°æ¸ æˆ" class="headerlink" title="3.4.4.5 æœ‰äº†å‰é¢çš„æŠ€æœ¯å¼•å¯¼ï¼Œ ç†è§£ Spring AOP å°±æ°´åˆ°æ¸ æˆ"></a>3.4.4.5 æœ‰äº†å‰é¢çš„æŠ€æœ¯å¼•å¯¼ï¼Œ ç†è§£ Spring AOP å°±æ°´åˆ°æ¸ æˆ</h4><h2 id="3-5-AOP-çš„åŸºæœ¬ä»‹ç»"><a href="#3-5-AOP-çš„åŸºæœ¬ä»‹ç»" class="headerlink" title="3.5 AOP çš„åŸºæœ¬ä»‹ç»"></a>3.5 AOP çš„åŸºæœ¬ä»‹ç»</h2><p>â€‹â— ä»€ä¹ˆæ˜¯ AOP</p><p>â€‹AOP çš„å…¨ç§°(aspect oriented programming) ï¼Œ<strong>é¢å‘åˆ‡é¢ç¼–ç¨‹</strong></p><p>â€‹â— 2 å¼ ç¤ºæ„å›¾è¯´æ˜ AOP çš„ç›¸å…³æ¦‚å¿µ</p><ol><li>ä¸€å¼ ç®€æ˜“å›¾è¯´æ˜ AOP</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230725224710622.png" alt="image-20230725224710622"></p><ol start="2"><li>ä¸€å¼ è¯¦ç»†å›¾è¯´æ˜ AOP</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230725225233953.png" alt="image-20230725225233953"></p><p>â— AOP å®ç°æ–¹å¼</p><ol><li><p>åŸºäºåŠ¨æ€ä»£ç†çš„æ–¹å¼[å†…ç½® aop å®ç°]</p></li><li><p>ä½¿ç”¨æ¡†æ¶ aspectj æ¥å®ç°</p></li></ol><h2 id="3-6-AOP-ç¼–ç¨‹å¿«é€Ÿå…¥é—¨"><a href="#3-6-AOP-ç¼–ç¨‹å¿«é€Ÿå…¥é—¨" class="headerlink" title="3.6 AOP ç¼–ç¨‹å¿«é€Ÿå…¥é—¨"></a>3.6 AOP ç¼–ç¨‹å¿«é€Ÿå…¥é—¨</h2><h2 id="3-6-1-åŸºæœ¬è¯´æ˜"><a href="#3-6-1-åŸºæœ¬è¯´æ˜" class="headerlink" title="3.6.1 åŸºæœ¬è¯´æ˜"></a>3.6.1 åŸºæœ¬è¯´æ˜</h2><p>â€‹â— è¯´æ˜</p><ol><li><p>éœ€è¦å¼•å…¥æ ¸å¿ƒçš„ aspect åŒ…</p></li><li><p>åœ¨åˆ‡é¢ç±»ä¸­å£°æ˜é€šçŸ¥æ–¹æ³•</p><ol><li>å‰ç½®é€šçŸ¥ï¼š@Before</li><li>è¿”å›é€šçŸ¥ï¼š@AfterReturning</li><li>å¼‚å¸¸é€šçŸ¥ï¼š@AfterThrowing</li><li>åç½®é€šçŸ¥ï¼š@After</li><li>ç¯ç»•é€šçŸ¥ï¼š@Around</li></ol></li></ol><h3 id="3-6-2-å¿«é€Ÿå…¥é—¨å®ä¾‹"><a href="#3-6-2-å¿«é€Ÿå…¥é—¨å®ä¾‹" class="headerlink" title="3.6.2 å¿«é€Ÿå…¥é—¨å®ä¾‹"></a>3.6.2 å¿«é€Ÿå…¥é—¨å®ä¾‹</h3><p>â€‹â— éœ€æ±‚è¯´æ˜</p><p>â€‹æˆ‘ä»¬ä½¿ç”¨ aop ç¼–ç¨‹çš„æ–¹å¼ï¼Œæ¥å®ç°æ‰‹å†™çš„åŠ¨æ€ä»£ç†æ¡ˆä¾‹æ•ˆæœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hspedu.spring.aop.aspectj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ‡é¢ç±» , ç±»ä¼¼äºæˆ‘ä»¬ä»¥å‰è‡ªå·±å†™çš„MyProxyProvider,ä½†æ˜¯åŠŸèƒ½å¼ºå¤§å¾ˆå¤š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Order(value = 1)</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//è¡¨ç¤ºæ˜¯ä¸€ä¸ªåˆ‡é¢ç±»[åº•å±‚åˆ‡é¢ç¼–ç¨‹çš„æ”¯æ’‘(åŠ¨æ€ä»£ç†+åå°„+åŠ¨æ€ç»‘å®š...)]</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//ä¼šå°†SmartAnimalAspect3æ³¨å…¥åˆ°å®¹å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartAnimalAspect3</span> &#123;</span><br><span class="line">    <span class="comment">//å¸Œæœ›å°†f1æ–¹æ³•åˆ‡å…¥åˆ°SmartDog-getSumå‰æ‰§è¡Œ-å‰ç½®é€šçŸ¥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="comment">     * 1. <span class="doctag">@Before</span> è¡¨ç¤ºå‰ç½®é€šçŸ¥:å³åœ¨æˆ‘ä»¬çš„ç›®æ ‡å¯¹è±¡æ‰§è¡Œæ–¹æ³•å‰æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">     * 2. value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float)</span></span><br><span class="line"><span class="comment">     * æŒ‡å®šåˆ‡å…¥åˆ°å“ªä¸ªç±»çš„å“ªä¸ªæ–¹æ³•  å½¢å¼æ˜¯: è®¿é—®ä¿®é¥°ç¬¦ è¿”å›ç±»å‹ å…¨ç±»å.æ–¹æ³•å(å½¢å‚åˆ—è¡¨)</span></span><br><span class="line"><span class="comment">     * 3. showBeginLogæ–¹æ³•å¯ä»¥ç†è§£æˆå°±æ˜¯ä¸€ä¸ªåˆ‡å…¥æ–¹æ³•, è¿™ä¸ªæ–¹æ³•åæ˜¯å¯ä»¥ç¨‹åºå‘˜æŒ‡å®š  æ¯”å¦‚:showBeginLog</span></span><br><span class="line"><span class="comment">     * 4. JoinPoint joinPoint åœ¨åº•å±‚æ‰§è¡Œæ—¶ï¼Œç”±AspectJåˆ‡é¢æ¡†æ¶ï¼Œä¼šç»™è¯¥åˆ‡å…¥æ–¹æ³•ä¼ å…¥joinPointå¯¹è±¡, é€šè¿‡                                                   * è¯¥æ–¹æ³•ï¼Œç¨‹åºå‘˜å¯ä»¥è·å–åˆ°ç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showBeginLog</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="comment">//é€šè¿‡è¿æ¥ç‚¹å¯¹è±¡joinPoint å¯ä»¥è·å–æ–¹æ³•ç­¾å</span></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect3-åˆ‡é¢ç±»showBeginLog()-æ–¹æ³•æ‰§è¡Œå‰-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + signature.getName() + <span class="string">&quot;-å‚æ•° &quot;</span></span><br><span class="line">                + Arrays.asList(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿”å›é€šçŸ¥ï¼šå³æŠŠshowSuccessEndLogæ–¹æ³•åˆ‡å…¥åˆ°ç›®æ ‡å¯¹è±¡æ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæ¯•åçš„åœ°æ–¹</span></span><br><span class="line">    <span class="comment">//è€éŸ©è§£è¯»</span></span><br><span class="line">    <span class="comment">//1. å¦‚æœæˆ‘ä»¬å¸Œæœ›æŠŠç›®æ ‡æ–¹æ³•æ‰§è¡Œçš„ç»“æœï¼Œè¿”å›ç»™åˆ‡å…¥æ–¹æ³•</span></span><br><span class="line">    <span class="comment">//2. å¯ä»¥å† @AfterReturning å¢åŠ å±æ€§ , æ¯”å¦‚ returning = &quot;res&quot;</span></span><br><span class="line">    <span class="comment">//3. åŒæ—¶åœ¨åˆ‡å…¥æ–¹æ³•å¢åŠ  Object res</span></span><br><span class="line">    <span class="comment">//4. æ³¨æ„: returning = &quot;res&quot; å’Œ Object res çš„ resåå­—ä¸€è‡´</span></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;, returning = &quot;res&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showSuccessEndLog</span><span class="params">(JoinPoint joinPoint, Object res)</span> &#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect3-åˆ‡é¢ç±»showSuccessEndLog()-æ–¹æ³•æ‰§è¡Œæ­£å¸¸ç»“æŸ-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + signature.getName() + <span class="string">&quot; è¿”å›çš„ç»“æœæ˜¯=&quot;</span> + res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼‚å¸¸é€šçŸ¥ï¼šå³æŠŠshowExceptionLogæ–¹æ³•åˆ‡å…¥åˆ°ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œå‘ç”Ÿå¼‚å¸¸çš„çš„catch&#123;&#125;</span></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;, throwing = &quot;throwable&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showExceptionLog</span><span class="params">(JoinPoint joinPoint, Throwable throwable)</span> &#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect3-åˆ‡é¢ç±»showExceptionLog()-æ–¹æ³•æ‰§è¡Œå¼‚å¸¸-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + signature.getName() + <span class="string">&quot; å¼‚å¸¸ä¿¡æ¯=&quot;</span> + throwable);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æœ€ç»ˆé€šçŸ¥ï¼šå³æŠŠshowFinallyEndLogæ–¹æ³•åˆ‡å…¥åˆ°ç›®æ ‡æ–¹æ³•æ‰§è¡Œå(ä¸ç®¡æ˜¯å¦å‘ç”Ÿå¼‚å¸¸,éƒ½è¦æ‰§è¡Œ finally&#123;&#125;)</span></span><br><span class="line">    <span class="meta">@After(value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showFinallyEndLog</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        System.out.println(<span class="string">&quot;SmartAnimalAspect3-åˆ‡é¢ç±»showFinallyEndLog()-æ–¹æ³•æœ€ç»ˆæ‰§è¡Œå®Œæ¯•-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + signature.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨AOPæ—¶ï¼Œè®°å¾—åœ¨beans.xmlä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œä»¥å¼€å¯åŸºäºæ³¨è§£çš„ AOP åŠŸèƒ½ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-6-3-ç»†èŠ‚è¯´æ˜"><a href="#3-6-3-ç»†èŠ‚è¯´æ˜" class="headerlink" title="3.6.3 ç»†èŠ‚è¯´æ˜"></a>3.6.3 ç»†èŠ‚è¯´æ˜</h3><ol><li><p>å…³äºåˆ‡é¢ç±»æ–¹æ³•å‘½åå¯ä»¥è‡ªå·±è§„èŒƒä¸€ä¸‹, æ¯”å¦‚ showBeginLog(), showSuccessEndLog(), showExceptionLog() , showFinallyEndLog()</p></li><li><p>åˆ‡å…¥è¡¨è¾¾å¼çš„æ›´å¤šé…ç½®ï¼Œæ¯”å¦‚ä½¿ç”¨æ¨¡ç³Šé…ç½®@Before(value&#x3D;â€execution(* com.hspedu.aop.proxy.SmartDog.*(..))â€)</p></li><li><p>è¡¨ç¤ºæ‰€æœ‰è®¿é—®æƒé™ï¼Œæ‰€æœ‰åŒ…çš„ä¸‹æ‰€æœ‰æœ‰ç±»çš„æ‰€æ–¹æ³•ï¼Œéƒ½ä¼šè¢«æ‰§è¡Œè¯¥å‰ç½®é€šçŸ¥æ–¹æ³•</p></li></ol><p>â€‹@Before(value&#x3D;â€execution(* <em>.</em>(..))â€)</p><ol start="4"><li><strong>å½“ spring å®¹å™¨å¼€å¯äº† <!-- å¼€å¯åŸºäºæ³¨è§£çš„ AOP åŠŸèƒ½ -->&lt; aop:aspectj-autoproxy&#x2F;&gt; , æˆ‘ä»¬è·å–æ³¨å…¥çš„å¯¹è±¡, éœ€è¦ä»¥æ¥å£çš„ç±»å‹æ¥è·å–, å› ä¸ºä½ æ³¨å…¥çš„å¯¹è±¡.getClass() å·²ç»æ˜¯ä»£ç†ç±»å‹äº†!</strong></li><li><strong>å½“ spring å®¹å™¨å¼€å¯äº† <!-- å¼€å¯åŸºäºæ³¨è§£çš„ AOP åŠŸèƒ½ -->&lt; aop:aspectj-autoproxy&#x2F;&gt;  , æˆ‘ä»¬è·å–æ³¨å…¥çš„å¯¹è±¡, ä¹Ÿå¯ä»¥é€šè¿‡ id æ¥è·å–, ä½†æ˜¯ä¹Ÿè¦è½¬æˆæ¥å£ç±»å‹</strong></li></ol><h2 id="3-7-AOP-åˆ‡å…¥è¡¨è¾¾å¼"><a href="#3-7-AOP-åˆ‡å…¥è¡¨è¾¾å¼" class="headerlink" title="3.7 AOP-åˆ‡å…¥è¡¨è¾¾å¼"></a>3.7 AOP-åˆ‡å…¥è¡¨è¾¾å¼</h2><h3 id="3-7-1-å…·ä½“ä½¿ç”¨"><a href="#3-7-1-å…·ä½“ä½¿ç”¨" class="headerlink" title="3.7.1 å…·ä½“ä½¿ç”¨"></a>3.7.1 å…·ä½“ä½¿ç”¨</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230726083322753.png" alt="image-20230726083322753"></p><h3 id="3-7-2-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#3-7-2-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="3.7.2 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>3.7.2 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><ol><li><p>åˆ‡å…¥è¡¨è¾¾å¼å¯ä»¥æŒ‡å‘ç±»çš„æ–¹æ³•, è¿™æ—¶åˆ‡å…¥è¡¨è¾¾å¼ä¼šå¯¹è¯¥ç±»&#x2F;å¯¹è±¡ç”Ÿæ•ˆ(ç±»å.*)</p></li><li><p>åˆ‡å…¥è¡¨è¾¾å¼ä¹Ÿå¯ä»¥<strong>æŒ‡å‘æ¥å£çš„æ–¹æ³•</strong>, è¿™æ—¶åˆ‡å…¥è¡¨è¾¾å¼ä¼š**<u>å¯¹å®ç°äº†æ¥å£çš„ç±»&#x2F;å¯¹è±¡ç”Ÿæ•ˆ</u>**</p></li><li><p>åˆ‡å…¥è¡¨è¾¾å¼ä¹Ÿå¯ä»¥å¯¹æ²¡æœ‰å®ç°æ¥å£çš„ç±»ï¼Œè¿›è¡Œåˆ‡å…¥</p></li><li><p>è€å¸ˆè¡¥å……: åŠ¨æ€ä»£ç† jdk çš„ Proxy ä¸ Spring çš„ CGlib</p></li></ol><p>ğŸŒŸ<a href="https://www.cnblogs.com/threeAgePie/p/15832586.html">https://www.cnblogs.com/threeAgePie/p/15832586.html</a></p><p>â€”å¯¹æ²¡æœ‰å®ç°æ¥å£çš„ç±»ç”Ÿæˆçš„ä»£ç†æ˜¯CGlibåŠ¨æ€ä»£ç†</p><h4 id="ä¸¤ä¸ªåŠ¨æ€ä»£ç†çš„åŒºåˆ«"><a href="#ä¸¤ä¸ªåŠ¨æ€ä»£ç†çš„åŒºåˆ«" class="headerlink" title="ä¸¤ä¸ªåŠ¨æ€ä»£ç†çš„åŒºåˆ«"></a>ä¸¤ä¸ªåŠ¨æ€ä»£ç†çš„åŒºåˆ«</h4><ol><li>JDKåŠ¨æ€ä»£ç†æ˜¯é¢å‘æ¥å£çš„ï¼Œåªèƒ½å¢å¼ºå®ç°ç±»ä¸­æ¥å£ä¸­å­˜åœ¨çš„æ–¹æ³•ã€‚CGlibæ˜¯é¢å‘çˆ¶ç±»çš„ï¼Œå¯ä»¥å¢å¼ºçˆ¶ç±»çš„æ‰€æœ‰æ–¹æ³•</li><li>JDKå¾—åˆ°çš„å¯¹è±¡æ˜¯JDKä»£ç†å¯¹è±¡å®ä¾‹ï¼Œè€ŒCGlibå¾—åˆ°çš„å¯¹è±¡æ˜¯è¢«ä»£ç†å¯¹è±¡çš„å­ç±»</li></ol><h2 id="3-8-AOP-JoinPoint"><a href="#3-8-AOP-JoinPoint" class="headerlink" title="3.8 AOP-JoinPoint"></a>3.8 AOP-JoinPoint</h2><h3 id="3-8-1-åº”ç”¨å®ä¾‹"><a href="#3-8-1-åº”ç”¨å®ä¾‹" class="headerlink" title="3.8.1 åº”ç”¨å®ä¾‹"></a>3.8.1 åº”ç”¨å®ä¾‹</h3><p>â€‹â— é€šè¿‡ JoinPoint å¯ä»¥è·å–åˆ°è°ƒç”¨æ–¹æ³•çš„ç­¾å</p><p>â€‹â— åº”ç”¨å®ä¾‹éœ€æ±‚</p><p>è¯´æ˜: åœ¨è°ƒç”¨å‰ç½®é€šçŸ¥è·å–åˆ°è°ƒç”¨æ–¹æ³•çš„ç­¾å, å’Œå…¶å®ƒç›¸å…³ä¿¡æ¯</p><p>â€‹â— åº”ç”¨å®ä¾‹-ä»£ç å®ç°</p><p>â€‹å‰é¢æˆ‘ä»¬å·²ç»ä¸¾ä¾‹è¯´æ˜è¿‡äº†</p><p>â€‹â— å…¶å®ƒå¸¸ç”¨æ–¹æ³•ä¸€è§ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeMethod</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">joinPoint.getSignature().getName(); <span class="comment">// è·å–ç›®æ ‡æ–¹æ³•å    </span></span><br><span class="line">joinPoint.getSignature().getDeclaringType().getSimpleName(); <span class="comment">// è·å–ç›®æ ‡æ–¹æ³•æ‰€å±ç±»çš„ç®€å•ç±»å</span></span><br><span class="line">joinPoint.getSignature().getDeclaringTypeName(); <span class="comment">// è·å–ç›®æ ‡æ–¹æ³•æ‰€å±ç±»çš„ç±»å</span></span><br><span class="line">joinPoint.getSignature().getModifiers(); <span class="comment">// è·å–ç›®æ ‡æ–¹æ³•å£°æ˜ç±»å‹(publicã€ privateã€protected)</span></span><br><span class="line">  Object[] args = joinPoint.getArgs(); <span class="comment">// è·å–ä¼ å…¥ç›®æ ‡æ–¹æ³•çš„å‚æ•°ï¼Œ è¿”å›ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">  joinPoint.getTarget(); <span class="comment">// è·å–è¢«ä»£ç†çš„å¯¹è±¡joinPoint.getThis(); // è·å–ä»£ç†å¯¹è±¡è‡ªå·±</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-9-AOP-è¿”å›é€šçŸ¥è·å–ç»“æœ"><a href="#3-9-AOP-è¿”å›é€šçŸ¥è·å–ç»“æœ" class="headerlink" title="3.9 AOP-è¿”å›é€šçŸ¥è·å–ç»“æœ"></a>3.9 AOP-è¿”å›é€šçŸ¥è·å–ç»“æœ</h2><h3 id="3-9-1-åº”ç”¨å®ä¾‹"><a href="#3-9-1-åº”ç”¨å®ä¾‹" class="headerlink" title="3.9.1 åº”ç”¨å®ä¾‹"></a>3.9.1 åº”ç”¨å®ä¾‹</h3><p>â€‹â— å¦‚ä½•åœ¨è¿”å›é€šçŸ¥æ–¹æ³•è·å–è¿”å›ç»“æœ</p><p>â€‹çœ‹ä¸€ä¸ªéœ€æ±‚:</p><p>â€‹åœ¨è¿”å›é€šçŸ¥æ–¹æ³•è·å–è¿”å›çš„ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. å¦‚æœæˆ‘ä»¬å¸Œæœ›æŠŠç›®æ ‡æ–¹æ³•æ‰§è¡Œçš„ç»“æœï¼Œè¿”å›ç»™åˆ‡å…¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">//2. å¯ä»¥å† @AfterReturning å¢åŠ å±æ€§ , æ¯”å¦‚ returning = &quot;res&quot;</span></span><br><span class="line"><span class="comment">//3. åŒæ—¶åœ¨åˆ‡å…¥æ–¹æ³•å¢åŠ  Object res</span></span><br><span class="line"><span class="comment">//4. æ³¨æ„: returning = &quot;res&quot; å’Œ Object res çš„ resåå­—ä¸€è‡´</span></span><br><span class="line"><span class="meta">@AfterReturning(value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;, returning = &quot;res&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showSuccessEndLog</span><span class="params">(JoinPoint joinPoint, Object res)</span> &#123;</span><br><span class="line">    <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">    System.out.println(<span class="string">&quot;SmartAnimalAspect3-åˆ‡é¢ç±»showSuccessEndLog()-æ–¹æ³•æ‰§è¡Œæ­£å¸¸ç»“æŸ-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + signature.getName() + <span class="string">&quot; è¿”å›çš„ç»“æœæ˜¯=&quot;</span> + res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-10-AOP-å¼‚å¸¸é€šçŸ¥ä¸­è·å–å¼‚å¸¸"><a href="#3-10-AOP-å¼‚å¸¸é€šçŸ¥ä¸­è·å–å¼‚å¸¸" class="headerlink" title="3.10 AOP-å¼‚å¸¸é€šçŸ¥ä¸­è·å–å¼‚å¸¸"></a>3.10 AOP-å¼‚å¸¸é€šçŸ¥ä¸­è·å–å¼‚å¸¸</h2><p>åŒç†â€¦â€¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼‚å¸¸é€šçŸ¥ï¼šå³æŠŠshowExceptionLogæ–¹æ³•åˆ‡å…¥åˆ°ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œå‘ç”Ÿå¼‚å¸¸çš„çš„catch&#123;&#125;</span></span><br><span class="line"><span class="meta">@AfterThrowing(value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;, throwing = &quot;throwable&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showExceptionLog</span><span class="params">(JoinPoint joinPoint, Throwable throwable)</span> &#123;</span><br><span class="line">    <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">    System.out.println(<span class="string">&quot;SmartAnimalAspect3-åˆ‡é¢ç±»showExceptionLog()-æ–¹æ³•æ‰§è¡Œå¼‚å¸¸-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + signature.getName() + <span class="string">&quot; å¼‚å¸¸ä¿¡æ¯=&quot;</span> + throwable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-11-AOP-ç¯ç»•é€šçŸ¥ã€äº†è§£ã€‘"><a href="#3-11-AOP-ç¯ç»•é€šçŸ¥ã€äº†è§£ã€‘" class="headerlink" title="3.11 AOP-ç¯ç»•é€šçŸ¥ã€äº†è§£ã€‘"></a>3.11 AOP-ç¯ç»•é€šçŸ¥ã€äº†è§£ã€‘</h2><h3 id="3-11-1-åº”ç”¨å®ä¾‹"><a href="#3-11-1-åº”ç”¨å®ä¾‹" class="headerlink" title="3.11.1 åº”ç”¨å®ä¾‹"></a>3.11.1 åº”ç”¨å®ä¾‹</h3><p>â€‹â— ç¯ç»•é€šçŸ¥å¯ä»¥å®Œæˆå…¶å®ƒå››ä¸ªé€šçŸ¥è¦åšçš„äº‹æƒ…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ¼”ç¤ºç¯ç»•é€šçŸ¥çš„ä½¿ç”¨-äº†è§£</span></span><br><span class="line"><span class="comment">//è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="comment">//1. @Around: è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç¯ç»•é€šçŸ¥[å®Œæˆå…¶å®ƒå››ä¸ªé€šçŸ¥çš„åŠŸèƒ½]</span></span><br><span class="line"><span class="comment">//2. value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float)) åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">//3. doAround è¡¨ç¤ºè¦åˆ‡å…¥çš„æ–¹æ³• - è°ƒç”¨ç»“æ„ try-catch-finally</span></span><br><span class="line"><span class="meta">@Around(value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">doAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//1.ç›¸å½“äºå‰ç½®é€šçŸ¥å®Œæˆçš„äº‹æƒ…</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        List&lt;Object&gt; argList = Arrays.asList(args);</span><br><span class="line">        System.out.println(<span class="string">&quot;AOPç¯ç»•é€šçŸ¥[-å‰ç½®é€šçŸ¥]&quot;</span> + methodName + <span class="string">&quot;æ–¹æ³•å¼€å§‹äº†--å‚æ•°æœ‰ï¼š&quot;</span> + argList);</span><br><span class="line">        <span class="comment">//åœ¨ç¯ç»•é€šçŸ¥ä¸­ä¸€å®šè¦è°ƒç”¨joinPoint.proceed()æ¥æ‰§è¡Œç›®æ ‡æ–¹æ³•</span></span><br><span class="line">        result = joinPoint.proceed();</span><br><span class="line">        <span class="comment">//2.ç›¸å½“äºè¿”å›é€šçŸ¥å®Œæˆçš„äº‹æƒ…</span></span><br><span class="line">        System.out.println(<span class="string">&quot;AOPç¯ç»•é€šçŸ¥[-è¿”å›é€šçŸ¥]&quot;</span> + methodName + <span class="string">&quot;æ–¹æ³•ç»“æŸäº†--ç»“æœæ˜¯ï¼š&quot;</span> + result);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">        <span class="comment">//3.ç›¸å½“äºå¼‚å¸¸é€šçŸ¥å®Œæˆçš„äº‹æƒ…</span></span><br><span class="line">        System.out.println(<span class="string">&quot;AOPç¯ç»•é€šçŸ¥[-å¼‚å¸¸é€šçŸ¥]&quot;</span> + methodName + <span class="string">&quot;æ–¹æ³•æŠ›å¼‚å¸¸äº†--å¼‚å¸¸å¯¹è±¡ï¼š&quot;</span> + throwable);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//4.ç›¸å½“äºæœ€ç»ˆé€šçŸ¥å®Œæˆçš„äº‹æƒ…</span></span><br><span class="line">        System.out.println(<span class="string">&quot;AOPç¯ç»•é€šçŸ¥[-åç½®é€šçŸ¥]&quot;</span> + methodName + <span class="string">&quot;æ–¹æ³•æœ€ç»ˆç»“æŸäº†...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-12-AOP-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼é‡ç”¨"><a href="#3-12-AOP-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼é‡ç”¨" class="headerlink" title="3.12 AOP-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼é‡ç”¨"></a>3.12 AOP-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼é‡ç”¨</h2><h3 id="3-12-1-åº”ç”¨å®ä¾‹"><a href="#3-12-1-åº”ç”¨å®ä¾‹" class="headerlink" title="3.12.1 åº”ç”¨å®ä¾‹"></a>3.12.1 åº”ç”¨å®ä¾‹</h3><p>â— åˆ‡å…¥ç‚¹è¡¨è¾¾å¼é‡ç”¨(å…¶å®å°±æ˜¯æŠŠåˆ‡å…¥è¡¨è¾¾å¼æå–å‡ºæ¥ï¼Œè¿™æ ·å¯ä»¥é¿å…å½“ä¸€ä¸ªæ–¹æ³•éœ€è¦å¤šæ¬¡åˆ‡å…¥æ—¶ï¼Œæ¯ä¸ªåˆ‡å…¥æ–¹æ³•éƒ½éœ€è¦é‡å†™ä¸€éåˆ‡å…¥è¡¨è¾¾å¼çš„æƒ…å†µ)</p><p>ä¸ºäº†ç»Ÿä¸€ç®¡ç†åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œå¯ä»¥ä½¿ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼é‡ç”¨æŠ€æœ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªåˆ‡å…¥ç‚¹, åœ¨åé¢ä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥å¼•ç”¨, æé«˜äº†å¤ç”¨æ€§</span></span><br><span class="line"><span class="meta">@Pointcut(value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float)))</span><span class="string">&quot;)</span></span><br><span class="line"><span class="string">public void myPointCut() &#123;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//å¸Œæœ›å°†myPointCutæ–¹æ³•åˆ‡å…¥åˆ°SmartDog-getSumå‰æ‰§è¡Œ-å‰ç½®é€šçŸ¥</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/**</span></span><br><span class="line"><span class="string"> * è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="string"> * 1. @Before è¡¨ç¤ºå‰ç½®é€šçŸ¥:å³åœ¨æˆ‘ä»¬çš„ç›®æ ‡å¯¹è±¡æ‰§è¡Œæ–¹æ³•å‰æ‰§è¡Œ</span></span><br><span class="line"><span class="string"> * 2. value = &quot;</span>execution(<span class="keyword">public</span> <span class="type">float</span> com.hspedu.spring.aop.aspectj.SmartDog.getSum(<span class="type">float</span>, <span class="type">float</span>)</span><br><span class="line"> * æŒ‡å®šåˆ‡å…¥åˆ°å“ªä¸ªç±»çš„å“ªä¸ªæ–¹æ³•  å½¢å¼æ˜¯: è®¿é—®ä¿®é¥°ç¬¦ è¿”å›ç±»å‹ å…¨ç±»å.æ–¹æ³•å(å½¢å‚åˆ—è¡¨)</span><br><span class="line"> * <span class="number">3.</span> showBeginLogæ–¹æ³•å¯ä»¥ç†è§£æˆå°±æ˜¯ä¸€ä¸ªåˆ‡å…¥æ–¹æ³•, è¿™ä¸ªæ–¹æ³•åæ˜¯å¯ä»¥ç¨‹åºå‘˜æŒ‡å®š  æ¯”å¦‚:showBeginLog</span><br><span class="line"> * <span class="number">4.</span> JoinPoint joinPoint åœ¨åº•å±‚æ‰§è¡Œæ—¶ï¼Œç”±AspectJåˆ‡é¢æ¡†æ¶ï¼Œ ä¼šç»™è¯¥åˆ‡å…¥æ–¹æ³•ä¼ å…¥ joinPointå¯¹è±¡</span><br><span class="line"> * , é€šè¿‡è¯¥æ–¹æ³•ï¼Œç¨‹åºå‘˜å¯ä»¥è·å–åˆ° ç›¸å…³ä¿¡æ¯</span><br><span class="line"> *</span><br><span class="line"> * <span class="meta">@param</span> joinPoint</span><br><span class="line"> */</span><br><span class="line"><span class="comment">//@Before(value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line"><span class="comment">//è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å®šä¹‰å¥½çš„åˆ‡å…¥ç‚¹</span></span><br><span class="line"><span class="meta">@Before(value = &quot;myPointCut()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showBeginLog</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">    <span class="comment">//é€šè¿‡è¿æ¥ç‚¹å¯¹è±¡joinPoint å¯ä»¥è·å–æ–¹æ³•ç­¾å</span></span><br><span class="line">    <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">    System.out.println(<span class="string">&quot;SmartAnimalAspect-åˆ‡é¢ç±»showBeginLog()[ä½¿ç”¨çš„myPointCut()]-æ–¹æ³•æ‰§è¡Œå‰-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + signature.getName() + <span class="string">&quot;-å‚æ•° &quot;</span></span><br><span class="line">            + Arrays.asList(joinPoint.getArgs()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›é€šçŸ¥ï¼šå³æŠŠshowSuccessEndLogæ–¹æ³•åˆ‡å…¥åˆ°ç›®æ ‡å¯¹è±¡æ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæ¯•åçš„åœ°æ–¹</span></span><br><span class="line"><span class="comment">//è€éŸ©è§£è¯»</span></span><br><span class="line"><span class="comment">//1. å¦‚æœæˆ‘ä»¬å¸Œæœ›æŠŠç›®æ ‡æ–¹æ³•æ‰§è¡Œçš„ç»“æœï¼Œè¿”å›ç»™åˆ‡å…¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">//2. å¯ä»¥å† @AfterReturning å¢åŠ å±æ€§ , æ¯”å¦‚ returning = &quot;res&quot;</span></span><br><span class="line"><span class="comment">//3. åŒæ—¶åœ¨åˆ‡å…¥æ–¹æ³•å¢åŠ  Object res</span></span><br><span class="line"><span class="comment">//4. æ³¨æ„: returning = &quot;res&quot; å’Œ Object res çš„ resåå­—ä¸€è‡´</span></span><br><span class="line"><span class="comment">//@AfterReturning(value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;, returning = &quot;res&quot;)</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨åˆ‡å…¥ç‚¹</span></span><br><span class="line"><span class="meta">@AfterReturning(value = &quot;myPointCut()&quot;, returning = &quot;res&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showSuccessEndLog</span><span class="params">(JoinPoint joinPoint, Object res)</span> &#123;</span><br><span class="line">    <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">    System.out.println(<span class="string">&quot;SmartAnimalAspect-åˆ‡é¢ç±»showSuccessEndLog()-æ–¹æ³•æ‰§è¡Œæ­£å¸¸ç»“æŸ-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + signature.getName() + <span class="string">&quot; è¿”å›çš„ç»“æœæ˜¯=&quot;</span> + res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼‚å¸¸é€šçŸ¥ï¼šå³æŠŠshowExceptionLogæ–¹æ³•åˆ‡å…¥åˆ°ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œå‘ç”Ÿå¼‚å¸¸çš„çš„catch&#123;&#125;</span></span><br><span class="line"><span class="comment">//@AfterThrowing(value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;, throwing = &quot;throwable&quot;)</span></span><br><span class="line"><span class="comment">//ç›´æ¥ä½¿ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</span></span><br><span class="line"><span class="meta">@AfterThrowing(value = &quot;myPointCut()&quot;, throwing = &quot;throwable&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showExceptionLog</span><span class="params">(JoinPoint joinPoint, Throwable throwable)</span> &#123;</span><br><span class="line">    <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">    System.out.println(<span class="string">&quot;SmartAnimalAspect-åˆ‡é¢ç±»showExceptionLog()-æ–¹æ³•æ‰§è¡Œå¼‚å¸¸-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + signature.getName() + <span class="string">&quot; å¼‚å¸¸ä¿¡æ¯=&quot;</span> + throwable);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ€ç»ˆé€šçŸ¥ï¼šå³æŠŠshowFinallyEndLogæ–¹æ³•åˆ‡å…¥åˆ°ç›®æ ‡æ–¹æ³•æ‰§è¡Œå(ä¸ç®¡æ˜¯å¦å‘ç”Ÿå¼‚å¸¸,éƒ½è¦æ‰§è¡Œ finally&#123;&#125;)</span></span><br><span class="line"><span class="comment">//@After(value = &quot;execution(public float com.hspedu.spring.aop.aspectj.SmartDog.getSum(float, float))&quot;)</span></span><br><span class="line"><span class="comment">//ç›´æ¥ä½¿ç”¨åˆ‡å…¥ç‚¹</span></span><br><span class="line"><span class="meta">@After(value = &quot;myPointCut()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showFinallyEndLog</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">    <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">    System.out.println(<span class="string">&quot;SmartAnimalAspect-åˆ‡é¢ç±»showFinallyEndLog()-æ–¹æ³•æœ€ç»ˆæ‰§è¡Œå®Œæ¯•-æ—¥å¿—-æ–¹æ³•å-&quot;</span> + signature.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-13-AOP-åˆ‡é¢ä¼˜å…ˆçº§é—®é¢˜"><a href="#3-13-AOP-åˆ‡é¢ä¼˜å…ˆçº§é—®é¢˜" class="headerlink" title="3.13 AOP-åˆ‡é¢ä¼˜å…ˆçº§é—®é¢˜"></a>3.13 AOP-åˆ‡é¢ä¼˜å…ˆçº§é—®é¢˜</h2><h3 id="3-13-1-åº”ç”¨å®ä¾‹"><a href="#3-13-1-åº”ç”¨å®ä¾‹" class="headerlink" title="3.13.1 åº”ç”¨å®ä¾‹"></a>3.13.1 åº”ç”¨å®ä¾‹</h3><p>â€‹â— åˆ‡é¢ä¼˜å…ˆçº§é—®é¢˜:</p><p>â€‹å¦‚æœåŒä¸€ä¸ªæ–¹æ³•ï¼Œæœ‰å¤šä¸ªåˆ‡é¢åœ¨åŒä¸€ä¸ªåˆ‡å…¥ç‚¹åˆ‡å…¥ï¼Œé‚£ä¹ˆæ‰§è¡Œçš„ä¼˜å…ˆçº§å¦‚ä½•æ§åˆ¶.</p><p>â€‹â— åŸºæœ¬è¯­æ³•:</p><p>â€‹@order(value&#x3D;n) æ¥æ§åˆ¶ n å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜.</p><h3 id="3-13-2-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"><a href="#3-13-2-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜" class="headerlink" title="3.13.2 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"></a>3.13.2 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜</h3><ol><li>ä¸èƒ½ç†è§£æˆï¼š ä¼˜å…ˆçº§é«˜çš„æ¯ä¸ªæ¶ˆæ¯é€šçŸ¥éƒ½å…ˆæ‰§è¡Œï¼Œ è¿™ä¸ªå’Œæ–¹æ³•è°ƒç”¨æœºåˆ¶(å’Œ Filter è¿‡æ»¤å™¨é“¾å¼è°ƒç”¨ç±»ä¼¼)</li></ol><p><strong>ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå‰ç½®é€šçŸ¥å…ˆæ‰§è¡Œ(é˜Ÿåˆ—)ï¼Œä½†å…¶ä»–çš„é€šçŸ¥éƒ½æ˜¯æœ€åæ‰§è¡Œ(æ ˆ)</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230726092923563.png" alt="image-20230726092923563"></p><h2 id="3-14-AOP-åŸºäº-XML-é…ç½®-AOP"><a href="#3-14-AOP-åŸºäº-XML-é…ç½®-AOP" class="headerlink" title="3.14 AOP-åŸºäº XML é…ç½® AOP"></a>3.14 AOP-åŸºäº XML é…ç½® AOP</h2><h3 id="3-14-1-åº”ç”¨å®ä¾‹"><a href="#3-14-1-åº”ç”¨å®ä¾‹" class="headerlink" title="3.14.1 åº”ç”¨å®ä¾‹"></a>3.14.1 åº”ç”¨å®ä¾‹</h3><p>â€‹â— åŸºæœ¬è¯´æ˜:</p><p>â€‹å‰é¢æˆ‘ä»¬æ˜¯é€šè¿‡æ³¨è§£æ¥é…ç½® aop çš„ï¼Œ åœ¨ spring ä¸­ï¼Œ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ xml çš„æ–¹å¼æ¥é…ç½® AOP</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--ä½¿ç”¨XMLé…ç½®ï¼Œå®ŒæˆAOPç¼–ç¨‹--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®ä¸€ä¸ªåˆ‡é¢ç±»å¯¹è±¡-bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.hspedu.spring.aop.xml.SmartAnimalAspect&quot;</span> <span class="attr">id</span>=<span class="string">&quot;smartAnimalAspect&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®ä¸€ä¸ªSmartDogå¯¹è±¡-bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.hspedu.spring.aop.xml.SmartDog&quot;</span> <span class="attr">id</span>=<span class="string">&quot;smartDog&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®åˆ‡é¢ç±», ç»†èŠ‚ä¸€å®šè¦å¼•å…¥ xmlns:aop--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--é…ç½®åˆ‡å…¥ç‚¹--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;myPointCut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(public float com.hspedu.spring.aop.xml.SmartDog.getSum(float, float)))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--é…ç½®åˆ‡é¢çš„å‰ç½®ï¼Œè¿”å›, å¼‚å¸¸, æœ€ç»ˆé€šçŸ¥--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;smartAnimalAspect&quot;</span> <span class="attr">order</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--é…ç½®å‰ç½®é€šçŸ¥--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;showBeginLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointCut&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--è¿”å›é€šçŸ¥--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;showSuccessEndLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointCut&quot;</span> <span class="attr">returning</span>=<span class="string">&quot;res&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--å¼‚å¸¸é€šçŸ¥--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;showExceptionLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointCut&quot;</span> <span class="attr">throwing</span>=<span class="string">&quot;throwable&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æœ€ç»ˆé€šçŸ¥--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;showFinallyEndLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointCut&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--é…ç½®ç¯ç»•é€šçŸ¥--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;aop:around method=&quot;&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="4-æ‰‹åŠ¨å®ç°-Spring-åº•å±‚æœºåˆ¶ã€-åˆå§‹åŒ–-IOCå®¹å™¨-ä¾èµ–æ³¨å…¥-BeanPostProcessor-æœºåˆ¶-AOPã€‘"><a href="#4-æ‰‹åŠ¨å®ç°-Spring-åº•å±‚æœºåˆ¶ã€-åˆå§‹åŒ–-IOCå®¹å™¨-ä¾èµ–æ³¨å…¥-BeanPostProcessor-æœºåˆ¶-AOPã€‘" class="headerlink" title="4 æ‰‹åŠ¨å®ç° Spring åº•å±‚æœºåˆ¶ã€ åˆå§‹åŒ– IOCå®¹å™¨+ä¾èµ–æ³¨å…¥+BeanPostProcessor æœºåˆ¶+AOPã€‘"></a>4 æ‰‹åŠ¨å®ç° Spring åº•å±‚æœºåˆ¶ã€ åˆå§‹åŒ– IOCå®¹å™¨+ä¾èµ–æ³¨å…¥+BeanPostProcessor æœºåˆ¶+AOPã€‘</h1><h3 id="4-1-1-å¼•è¨€ï¼š-å‰é¢æˆ‘ä»¬å®é™…ä¸Šå·²ç»ç”¨ä»£ç ç®€å•å®ç°äº†"><a href="#4-1-1-å¼•è¨€ï¼š-å‰é¢æˆ‘ä»¬å®é™…ä¸Šå·²ç»ç”¨ä»£ç ç®€å•å®ç°äº†" class="headerlink" title="4.1.1 å¼•è¨€ï¼š å‰é¢æˆ‘ä»¬å®é™…ä¸Šå·²ç»ç”¨ä»£ç ç®€å•å®ç°äº†"></a>4.1.1 å¼•è¨€ï¼š å‰é¢æˆ‘ä»¬å®é™…ä¸Šå·²ç»ç”¨ä»£ç ç®€å•å®ç°äº†</h3><h4 id="4-1-1-1-Spring-XML-æ³¨å…¥-bean"><a href="#4-1-1-1-Spring-XML-æ³¨å…¥-bean" class="headerlink" title="4.1.1.1 Spring XML æ³¨å…¥ bean"></a>4.1.1.1 Spring XML æ³¨å…¥ bean</h4><h4 id="4-1-1-2-Spring-æ³¨è§£æ–¹å¼æ³¨å…¥-bean"><a href="#4-1-1-2-Spring-æ³¨è§£æ–¹å¼æ³¨å…¥-bean" class="headerlink" title="4.1.1.2 Spring æ³¨è§£æ–¹å¼æ³¨å…¥ bean"></a>4.1.1.2 Spring æ³¨è§£æ–¹å¼æ³¨å…¥ bean</h4><h4 id="4-1-1-3-Spring-AOP-åŠ¨æ€ä»£ç†å®ç°"><a href="#4-1-1-3-Spring-AOP-åŠ¨æ€ä»£ç†å®ç°" class="headerlink" title="4.1.1.3 Spring AOP åŠ¨æ€ä»£ç†å®ç°"></a>4.1.1.3 Spring AOP åŠ¨æ€ä»£ç†å®ç°</h4><h3 id="4-1-2-ç»§ç»­æ€è€ƒ-åŸç”Ÿ-Spring-å¦‚ä½•å®ç°ä¾èµ–æ³¨å…¥å’Œ-singletonã€-prototype"><a href="#4-1-2-ç»§ç»­æ€è€ƒ-åŸç”Ÿ-Spring-å¦‚ä½•å®ç°ä¾èµ–æ³¨å…¥å’Œ-singletonã€-prototype" class="headerlink" title="4.1.2 ç»§ç»­æ€è€ƒ-åŸç”Ÿ Spring å¦‚ä½•å®ç°ä¾èµ–æ³¨å…¥å’Œ singletonã€ prototype"></a>4.1.2 ç»§ç»­æ€è€ƒ-åŸç”Ÿ Spring å¦‚ä½•å®ç°ä¾èµ–æ³¨å…¥å’Œ singletonã€ prototype</h3><h4 id="4-1-2-1-å®ä¾‹æ¼”ç¤º-Maven-é¡¹ç›®"><a href="#4-1-2-1-å®ä¾‹æ¼”ç¤º-Maven-é¡¹ç›®" class="headerlink" title="4.1.2.1 å®ä¾‹æ¼”ç¤º-Maven é¡¹ç›®"></a>4.1.2.1 å®ä¾‹æ¼”ç¤º-Maven é¡¹ç›®</h4><p>å…¶å®å°±æ˜¯ç¬¬äºŒç« ï¼Œå»çœ‹ä¸€ä¸‹å³å¯â€¦â€¦</p><p>â€‹â— å¿«é€Ÿç»™å°ä¼™ä¼´å®Œæˆè¿™ä¸ªå°æ¡ˆä¾‹(æç¤ºï¼š åˆ›å»ºæ–°é¡¹ç›®, ä¸å’ŒåŸæ¥çš„ Spring æ··åœ¨ä¸€èµ·)</p><ol><li><h5 id="åˆ›å»ºå·¥ç¨‹"><a href="#åˆ›å»ºå·¥ç¨‹" class="headerlink" title="åˆ›å»ºå·¥ç¨‹"></a>åˆ›å»ºå·¥ç¨‹</h5></li><li><h5 id="ä¿®æ”¹-pom-xml-å¼•å…¥éœ€è¦çš„-jar-åŒ…"><a href="#ä¿®æ”¹-pom-xml-å¼•å…¥éœ€è¦çš„-jar-åŒ…" class="headerlink" title="ä¿®æ”¹ pom.xml, å¼•å…¥éœ€è¦çš„ jar åŒ…"></a>ä¿®æ”¹ pom.xml, å¼•å…¥éœ€è¦çš„ jar åŒ…</h5></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--åŠ å…¥springå¼€å‘çš„åŸºæœ¬åŒ…--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--åŠ å…¥springå¼€å‘åˆ‡é¢ç¼–ç¨‹éœ€è¦çš„åŒ…--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li><h5 id="åˆ›-å»ºUserAction-java"><a href="#åˆ›-å»ºUserAction-java" class="headerlink" title="åˆ› å»ºUserAction.java"></a>åˆ› å»ºUserAction.java</h5></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°±æ˜¯ä¸€ä¸ªController</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//ä¹Ÿå¯ä»¥ä½¿ç”¨@Controller</span></span><br><span class="line"><span class="comment">//åœ¨é»˜è®¤æƒ…å†µä¸‹ æˆ‘ä»¬é…ç½®@Component @Controller @Service @Repository æ˜¯å•ä¾‹</span></span><br><span class="line"><span class="comment">//@Scope(value = &quot;prototype&quot;) è¡¨ç¤ºä»¥å¤šå®ä¾‹å½¢å¼ï¼Œè¿”å›UserAction bean</span></span><br><span class="line"><span class="comment">//è€å¸ˆæ€è€ƒ:Springå®¹å™¨åº•å±‚å¦‚ä½•å®ç°</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//@Scope(value = &quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAction</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><h5 id="åˆ›-å»ºUserDao-java"><a href="#åˆ›-å»ºUserDao-java" class="headerlink" title="åˆ› å»ºUserDao.java"></a>åˆ› å»ºUserDao.java</h5></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯ä»¥ä½¿ç”¨@Repository</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hi</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserDao-hi()---&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li><h5 id="åˆ›-å»ºUserService-java"><a href="#åˆ›-å»ºUserService-java" class="headerlink" title="åˆ› å»ºUserService.java"></a>åˆ› å»ºUserService.java</h5></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¹Ÿå¯ä»¥ä½¿ç”¨@Service</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®šä¹‰å±æ€§</span></span><br><span class="line">    <span class="comment">//è€å¸ˆæ€è€ƒï¼šåŠ å…¥ @Autowired , Springå®¹å™¨æ—¶å¦‚ä½•å®ç°ä¾èµ–æ³¨å…¥?</span></span><br><span class="line">    <span class="comment">//ä¹Ÿå¯ä»¥ä½¿ç”¨@Resource</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">m1</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.hi();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™é‡Œæˆ‘ä»¬éœ€è¦æŒ‡å®šinit() æ˜¯åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserService-init()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li><h5 id="åˆ›å»º-beans-xml"><a href="#åˆ›å»º-beans-xml" class="headerlink" title="åˆ›å»º beans.xml"></a>åˆ›å»º beans.xml</h5></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®è‡ªåŠ¨æ‰«æçš„åŒ…, åŒæ—¶å¼•å…¥å¯¹åº”çš„åç§°ç©ºé—´--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--è€å¸ˆè¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">    1. å¦‚æœæˆ‘ä»¬æ˜¯æ™®é€šçš„javaé¡¹ç›®, beans.xml æ”¾åœ¨srcä¸‹</span></span><br><span class="line"><span class="comment">    2. å¦‚æœæˆ‘ä»¬æ˜¯java maven é¡¹ç›®, beans.xml æ”¾åœ¨ src/main/resources</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hspedu.spring.component&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hspedu.spring.aop&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å¯ç”¨åŸºäºæ³¨è§£æ–¹å¼çš„AOPåŠŸèƒ½--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®åç½®å¤„ç†å™¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.hspedu.spring.process.MyBeanPostProcessor&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myBeanPostProcessor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="7"><li><h5 id="åˆ›å»º-AppMain-java"><a href="#åˆ›å»º-AppMain-java" class="headerlink" title="åˆ›å»º AppMain.java"></a>åˆ›å»º AppMain.java</h5></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//æµ‹è¯•çœ‹çœ‹æ˜¯å¦å¯ä»¥å¾—åˆ°springå®¹å™¨ä¸­çš„bean , åŒæ—¶çœ‹çœ‹ä¾èµ–æ³¨å…¥æ˜¯å¦OK</span></span><br><span class="line"></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserAction</span> <span class="variable">userAction</span> <span class="operator">=</span> (UserAction) ioc.getBean(<span class="string">&quot;userAction&quot;</span>);</span><br><span class="line">        <span class="type">UserAction</span> <span class="variable">userAction2</span> <span class="operator">=</span> (UserAction) ioc.getBean(<span class="string">&quot;userAction&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;userAction=&quot;</span> + userAction);</span><br><span class="line">        System.out.println(<span class="string">&quot;userAction2=&quot;</span> + userAction2);</span><br><span class="line"></span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> (UserDao) ioc.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;userDao=&quot;</span> + userDao);</span><br><span class="line"></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) ioc.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;userService=&quot;</span> + userService);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æµ‹è¯•ä¸€ä¸‹å½“å‰çš„ä¾èµ–æ³¨å…¥</span></span><br><span class="line">        userService.m1();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æµ‹è¯•ä¸€ä¸‹AOP</span></span><br><span class="line">        <span class="type">SmartAnimalable</span> <span class="variable">smartDog</span> <span class="operator">=</span> ioc.getBean(SmartAnimalable.class);</span><br><span class="line">        smartDog.getSum(<span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-1-2-2-æ€è€ƒé—®é¢˜"><a href="#4-1-2-2-æ€è€ƒé—®é¢˜" class="headerlink" title="4.1.2.2 æ€è€ƒé—®é¢˜"></a>4.1.2.2 æ€è€ƒé—®é¢˜</h4><h5 id="4-1-2-2-1-Spring-åº•å±‚å®ç°-å¦‚ä½•å®ç°-IOC-å®¹å™¨åˆ›å»ºå’Œåˆå§‹åŒ–ã€å‰é¢æˆ‘ä»¬å®ç°è¿‡ï¼Œ-ç°åœ¨è¦å†æ·±å…¥ã€‘"><a href="#4-1-2-2-1-Spring-åº•å±‚å®ç°-å¦‚ä½•å®ç°-IOC-å®¹å™¨åˆ›å»ºå’Œåˆå§‹åŒ–ã€å‰é¢æˆ‘ä»¬å®ç°è¿‡ï¼Œ-ç°åœ¨è¦å†æ·±å…¥ã€‘" class="headerlink" title="4.1.2.2.1 Spring åº•å±‚å®ç°, å¦‚ä½•å®ç° IOC å®¹å™¨åˆ›å»ºå’Œåˆå§‹åŒ–ã€å‰é¢æˆ‘ä»¬å®ç°è¿‡ï¼Œ ç°åœ¨è¦å†æ·±å…¥ã€‘"></a>4.1.2.2.1 Spring åº•å±‚å®ç°, å¦‚ä½•å®ç° IOC å®¹å™¨åˆ›å»ºå’Œåˆå§‹åŒ–ã€å‰é¢æˆ‘ä»¬å®ç°è¿‡ï¼Œ ç°åœ¨è¦å†æ·±å…¥ã€‘</h5><h5 id="4-1-2-2-2-Spring-åº•å±‚å®ç°-å¦‚ä½•å®ç°-getBean-æ ¹æ®-singleton-å’Œ-prototype-æ¥è¿”å›-bean-å®ä¾‹"><a href="#4-1-2-2-2-Spring-åº•å±‚å®ç°-å¦‚ä½•å®ç°-getBean-æ ¹æ®-singleton-å’Œ-prototype-æ¥è¿”å›-bean-å®ä¾‹" class="headerlink" title="4.1.2.2.2 Spring åº•å±‚å®ç°, å¦‚ä½•å®ç° getBean, æ ¹æ® singleton å’Œ prototype æ¥è¿”å› bean å®ä¾‹"></a>4.1.2.2.2 Spring åº•å±‚å®ç°, å¦‚ä½•å®ç° getBean, æ ¹æ® singleton å’Œ prototype æ¥è¿”å› bean å®ä¾‹</h5><h3 id="4-1-3-ç»§ç»­æ€è€ƒ-åŸç”Ÿ-Spring-å¦‚ä½•å®ç°-BeanPostProcessor"><a href="#4-1-3-ç»§ç»­æ€è€ƒ-åŸç”Ÿ-Spring-å¦‚ä½•å®ç°-BeanPostProcessor" class="headerlink" title="4.1.3 ç»§ç»­æ€è€ƒ-åŸç”Ÿ Spring å¦‚ä½•å®ç° BeanPostProcessor"></a>4.1.3 ç»§ç»­æ€è€ƒ-åŸç”Ÿ Spring å¦‚ä½•å®ç° BeanPostProcessor</h3><h4 id="4-1-3-1-å®ä¾‹æ¼”ç¤º"><a href="#4-1-3-1-å®ä¾‹æ¼”ç¤º" class="headerlink" title="4.1.3.1 å®ä¾‹æ¼”ç¤º"></a>4.1.3.1 å®ä¾‹æ¼”ç¤º</h4><ol><li>åˆ› å»ºMyBeanPostProcessor.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨Beançš„ initåˆå§‹åŒ–æ–¹æ³•å‰è°ƒç”¨-&gt; è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œåœ¨å‰é¢è®²è§£åç½®å¤„ç†å™¨æ—¶è®²è¿‡çš„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beanName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;postProcessBeforeInitialization è¢« è°ƒ ç”¨ &quot;</span> + beanName + <span class="string">&quot; bean= &quot;</span> + bean.getClass());</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨Beançš„ initåˆå§‹åŒ–æ–¹æ³•åè°ƒç”¨-&gt; è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œåœ¨å‰é¢è®²è§£åç½®å¤„ç†å™¨æ—¶è®²è¿‡çš„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beanName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postProcessAfterInitialization è¢« è°ƒ ç”¨ &quot;</span> + beanName + <span class="string">&quot; bean= &quot;</span> + bean.getClass());</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-1-3-2-æ€è€ƒé—®é¢˜"><a href="#4-1-3-2-æ€è€ƒé—®é¢˜" class="headerlink" title="4.1.3.2 æ€è€ƒé—®é¢˜"></a>4.1.3.2 æ€è€ƒé—®é¢˜</h4><h5 id="4-1-3-2-1-Spring-åº•å±‚å®ç°-å¦‚ä½•å®ç°-Bean-åç½®å¤„ç†å™¨æœºåˆ¶"><a href="#4-1-3-2-1-Spring-åº•å±‚å®ç°-å¦‚ä½•å®ç°-Bean-åç½®å¤„ç†å™¨æœºåˆ¶" class="headerlink" title="4.1.3.2.1 Spring åº•å±‚å®ç°, å¦‚ä½•å®ç° Bean åç½®å¤„ç†å™¨æœºåˆ¶"></a>4.1.3.2.1 Spring åº•å±‚å®ç°, å¦‚ä½•å®ç° Bean åç½®å¤„ç†å™¨æœºåˆ¶</h5><p>â€”â€”å½“ç„¶æ˜¯åŠ¨æ€ä»£ç†å‘€</p><h3 id="4-1-4-ç»§ç»­æ€è€ƒ-åŸç”Ÿ-Spring-æ˜¯å¦‚ä½•å®ç°-AOP"><a href="#4-1-4-ç»§ç»­æ€è€ƒ-åŸç”Ÿ-Spring-æ˜¯å¦‚ä½•å®ç°-AOP" class="headerlink" title="4.1.4 ç»§ç»­æ€è€ƒ-åŸç”Ÿ Spring æ˜¯å¦‚ä½•å®ç° AOP"></a>4.1.4 ç»§ç»­æ€è€ƒ-åŸç”Ÿ Spring æ˜¯å¦‚ä½•å®ç° AOP</h3><h4 id="4-1-4-1-å®ä¾‹æ¼”ç¤º"><a href="#4-1-4-1-å®ä¾‹æ¼”ç¤º" class="headerlink" title="4.1.4.1 å®ä¾‹æ¼”ç¤º"></a>4.1.4.1 å®ä¾‹æ¼”ç¤º</h4><p>çœ‹ç¬¬ä¸‰ç« â€¦â€¦ </p><h4 id="4-1-4-2-ç®€å•åˆ†æ-AOP-å’Œ-BeanPostProcessor-å…³ç³»"><a href="#4-1-4-2-ç®€å•åˆ†æ-AOP-å’Œ-BeanPostProcessor-å…³ç³»" class="headerlink" title="4.1.4.2 ç®€å•åˆ†æ AOP å’Œ BeanPostProcessor å…³ç³»"></a>4.1.4.2 ç®€å•åˆ†æ AOP å’Œ BeanPostProcessor å…³ç³»</h4><p>â€¦â€¦</p><p>è€éŸ©è§£è¯»ï¼š</p><ul><li>AOP åº•å±‚æ˜¯åŸºäº BeanPostProcessor æœºåˆ¶çš„.</li><li>å³åœ¨ Bean åˆ›å»ºå¥½åï¼Œ<strong>æ ¹æ®æ˜¯å¦éœ€è¦ AOP å¤„ç†</strong>ï¼Œå†³å®šè¿”å›ä»£ç†å¯¹è±¡ï¼Œè¿˜æ˜¯åŸç”Ÿ Bean</li><li>åœ¨è¿”å›ä»£ç†å¯¹è±¡æ—¶ï¼Œå°±å¯ä»¥æ ¹æ®è¦ä»£ç†çš„ç±»å’Œæ–¹æ³•æ¥è¿”å›</li><li>å…¶å®è¿™ä¸ªæœºåˆ¶å¹¶ä¸éš¾ï¼Œæœ¬è´¨å°±æ˜¯åœ¨ BeanPostProcessor æœºåˆ¶ + åŠ¨æ€ä»£ç†æŠ€æœ¯</li></ul><h4 id="4-1-4-3-æ€è€ƒé—®é¢˜"><a href="#4-1-4-3-æ€è€ƒé—®é¢˜" class="headerlink" title="4.1.4.3 æ€è€ƒé—®é¢˜"></a>4.1.4.3 æ€è€ƒé—®é¢˜</h4><h5 id="4-1-4-3-1-Spring-åº•å±‚å®ç°-å¦‚ä½•å®ç°-AOP-ç¼–ç¨‹"><a href="#4-1-4-3-1-Spring-åº•å±‚å®ç°-å¦‚ä½•å®ç°-AOP-ç¼–ç¨‹" class="headerlink" title="4.1.4.3.1 Spring åº•å±‚å®ç°, å¦‚ä½•å®ç° AOP ç¼–ç¨‹"></a>4.1.4.3.1 Spring åº•å±‚å®ç°, å¦‚ä½•å®ç° AOP ç¼–ç¨‹</h5><h3 id="4-1-5-æˆ‘ä»¬çš„ç›®æ ‡-ä¸ç”¨-Spring-æ¡†æ¶-æ¨¡æ‹Ÿ-Spring-åº•å±‚å®ç°-ä¹Ÿèƒ½å®Œæˆç›¸åŒçš„åŠŸèƒ½"><a href="#4-1-5-æˆ‘ä»¬çš„ç›®æ ‡-ä¸ç”¨-Spring-æ¡†æ¶-æ¨¡æ‹Ÿ-Spring-åº•å±‚å®ç°-ä¹Ÿèƒ½å®Œæˆç›¸åŒçš„åŠŸèƒ½" class="headerlink" title="4.1.5 æˆ‘ä»¬çš„ç›®æ ‡: ä¸ç”¨ Spring æ¡†æ¶, æ¨¡æ‹Ÿ Spring åº•å±‚å®ç°, ä¹Ÿèƒ½å®Œæˆç›¸åŒçš„åŠŸèƒ½"></a>4.1.5 æˆ‘ä»¬çš„ç›®æ ‡: ä¸ç”¨ Spring æ¡†æ¶, æ¨¡æ‹Ÿ Spring åº•å±‚å®ç°, ä¹Ÿèƒ½å®Œæˆç›¸åŒçš„åŠŸèƒ½</h3><h2 id="4-2-ğŸŒŸSpring-æ•´ä½“æ¶æ„åˆ†æ"><a href="#4-2-ğŸŒŸSpring-æ•´ä½“æ¶æ„åˆ†æ" class="headerlink" title="4.2 ğŸŒŸSpring æ•´ä½“æ¶æ„åˆ†æ"></a>4.2 ğŸŒŸSpring æ•´ä½“æ¶æ„åˆ†æ</h2><h3 id="4-2-1-ğŸŒŸä¸€å›¾èƒœåƒè¨€"><a href="#4-2-1-ğŸŒŸä¸€å›¾èƒœåƒè¨€" class="headerlink" title="4.2.1 ğŸŒŸä¸€å›¾èƒœåƒè¨€"></a>4.2.1 ğŸŒŸä¸€å›¾èƒœåƒè¨€</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230727094752719.png" alt="image-20230727094752719"></p><h2 id="4-3-æ‰‹åŠ¨å®ç°-Spring-åº•å±‚æœºåˆ¶"><a href="#4-3-æ‰‹åŠ¨å®ç°-Spring-åº•å±‚æœºåˆ¶" class="headerlink" title="4.3 æ‰‹åŠ¨å®ç° Spring åº•å±‚æœºåˆ¶"></a>4.3 æ‰‹åŠ¨å®ç° Spring åº•å±‚æœºåˆ¶</h2><p>ã€åˆå§‹åŒ– IOC å®¹å™¨+ä¾èµ–æ³¨å…¥+BeanPostProcessor æœºåˆ¶+AOPã€‘</p><h3 id="4-3-1-å®ç°ä»»åŠ¡é˜¶æ®µ-1-ç¼–å†™è‡ªå·±-Spring-å®¹å™¨ï¼Œ-å®ç°æ‰«æåŒ…ï¼Œ-å¾—åˆ°-bean-çš„-class-å¯¹è±¡"><a href="#4-3-1-å®ç°ä»»åŠ¡é˜¶æ®µ-1-ç¼–å†™è‡ªå·±-Spring-å®¹å™¨ï¼Œ-å®ç°æ‰«æåŒ…ï¼Œ-å¾—åˆ°-bean-çš„-class-å¯¹è±¡" class="headerlink" title="4.3.1 å®ç°ä»»åŠ¡é˜¶æ®µ 1- ç¼–å†™è‡ªå·± Spring å®¹å™¨ï¼Œ å®ç°æ‰«æåŒ…ï¼Œ å¾—åˆ° bean çš„ class å¯¹è±¡"></a>4.3.1 å®ç°ä»»åŠ¡é˜¶æ®µ 1- ç¼–å†™è‡ªå·± Spring å®¹å™¨ï¼Œ å®ç°æ‰«æåŒ…ï¼Œ å¾—åˆ° bean çš„ class å¯¹è±¡</h3><h4 id="4-3-1-1-çŸ¥è¯†æ‰©å±•ï¼š-ç±»åŠ è½½å™¨"><a href="#4-3-1-1-çŸ¥è¯†æ‰©å±•ï¼š-ç±»åŠ è½½å™¨" class="headerlink" title="4.3.1.1 çŸ¥è¯†æ‰©å±•ï¼š ç±»åŠ è½½å™¨"></a>4.3.1.1 çŸ¥è¯†æ‰©å±•ï¼š ç±»åŠ è½½å™¨</h4><p>â€‹â— java çš„ç±»åŠ è½½å™¨ 3 ç§</p><p>â€‹Bootstrap ç±»åŠ è½½å™¨â€”â€”â€”â€”â€“å¯¹åº”è·¯å¾„ jre&#x2F;lib</p><p>â€‹Ext ç±»åŠ è½½å™¨â€”â€”â€”â€”â€”â€”â€“å¯¹åº”è·¯å¾„ jre&#x2F;lib&#x2F;ext</p><p>â€‹App ç±»åŠ è½½å™¨â€”â€”â€”â€”â€”â€”-å¯¹åº”è·¯å¾„ classpath</p><h4 id="4-3-1-2-è¯´æ˜-ç¼–å†™è‡ªå·±-Spring-å®¹å™¨ï¼Œ-å®ç°æ‰«æåŒ…ï¼Œ-å¾—åˆ°-bean-çš„-class-å¯¹è±¡"><a href="#4-3-1-2-è¯´æ˜-ç¼–å†™è‡ªå·±-Spring-å®¹å™¨ï¼Œ-å®ç°æ‰«æåŒ…ï¼Œ-å¾—åˆ°-bean-çš„-class-å¯¹è±¡" class="headerlink" title="4.3.1.2 è¯´æ˜: ç¼–å†™è‡ªå·± Spring å®¹å™¨ï¼Œ å®ç°æ‰«æåŒ…ï¼Œ å¾—åˆ° bean çš„ class å¯¹è±¡"></a>4.3.1.2 è¯´æ˜: ç¼–å†™è‡ªå·± Spring å®¹å™¨ï¼Œ å®ç°æ‰«æåŒ…ï¼Œ å¾—åˆ° bean çš„ class å¯¹è±¡</h4><h3 id="ğŸŒŸçœ‹p12-P41"><a href="#ğŸŒŸçœ‹p12-P41" class="headerlink" title="ğŸŒŸçœ‹p12-P41"></a>ğŸŒŸçœ‹p12-P41</h3><p>å…ˆäº†è§£springåº•å±‚æœºåˆ¶ å…·ä½“å®ç°æ—¥åæœ‰ç©ºå†è¯´</p><p>JDBCç­‰çŸ¥è¯†ç”±äºä¹‹åéƒ½ç”¨mybatisç­‰å·¥å…·ï¼Œä¹Ÿå…ˆä¸å­¦</p><p>äº‹åŠ¡å…ˆä¸å­¦äº†ï¼Œä¹‹åè¡¥ï¼</p><h1 id="5-Springé¢è¯•å‡†å¤‡"><a href="#5-Springé¢è¯•å‡†å¤‡" class="headerlink" title="5.Springé¢è¯•å‡†å¤‡"></a>5.Springé¢è¯•å‡†å¤‡</h1><h3 id="IOCå®ç°åŸç†æ€»ç»“ï¼š"><a href="#IOCå®ç°åŸç†æ€»ç»“ï¼š" class="headerlink" title="IOCå®ç°åŸç†æ€»ç»“ï¼š"></a>IOCå®ç°åŸç†æ€»ç»“ï¼š</h3><p>å…·ä½“æ¥è¯´ï¼ŒSpring IOC çš„å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>è¯»å–é…ç½®æ–‡ä»¶æˆ–è§£ææ³¨è§£ä¿¡æ¯ï¼Œå°†å…¶è½¬æ¢ä¸ºå†…éƒ¨çš„å¯¹è±¡å®šä¹‰å’Œä¾èµ–å…³ç³»ã€‚åœ¨ Spring ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <u>XML æ–‡ä»¶æˆ–æ³¨è§£</u>æ¥é…ç½®å¯¹è±¡å’Œä¾èµ–å…³ç³»ã€‚Spring é€šè¿‡è§£æé…ç½®æ–‡ä»¶æˆ–æ³¨è§£ä¿¡æ¯ï¼Œå°†å…¶è½¬æ¢ä¸ºå†…éƒ¨çš„å¯¹è±¡å®šä¹‰å’Œä¾èµ–å…³ç³»ï¼ˆBeanDefinitionï¼‰æ”¾åˆ°å®¹å™¨ï¼ˆBeanFactoryï¼‰ä¸­ã€‚å¯¹è±¡å®šä¹‰åŒ…æ‹¬å¯¹è±¡çš„ç±»å‹ã€å±æ€§ã€æ„é€ å‡½æ•°ç­‰ä¿¡æ¯ï¼Œä¾èµ–å…³ç³»åŒ…æ‹¬å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€ä¾èµ–æ³¨å…¥æ–¹å¼ç­‰ä¿¡æ¯ã€‚</li><li>å®ä¾‹åŒ–beanå¯¹è±¡ï¼šSpring ä¼šæ ¹æ®å¯¹è±¡å®šä¹‰çš„ç±»å‹å’Œæ„é€ å‡½æ•°ä¿¡æ¯ï¼Œä½¿ç”¨åå°„æœºåˆ¶æ¥åˆ›å»ºå¯¹è±¡ã€‚</li><li>è®¾ç½®å±æ€§ï¼šå®ä¾‹åŒ–åçš„ä»ç„¶æ˜¯ä¸€ä¸ªåŸç”Ÿçš„çŠ¶æ€ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚ è¿™ä¸€æ­¥Springæ ¹æ®BeanDefinitionä¸­çš„ä¿¡æ¯è¿›è¡Œå±æ€§å¡«å……ï¼Œä¾èµ–æ³¨å…¥ã€‚ </li><li>è°ƒç”¨Awareæ¥å£ï¼šSpringä¼šæ£€æµ‹è¯¥å¯¹è±¡æ˜¯å¦å®ç°äº†xxxAwareæ¥å£ï¼Œå¦‚æœæœ‰ä¼šåœ¨è¿™é‡Œæ‰§è¡Œå®Œæˆã€‚Awareä¸»è¦æ˜¯èƒ½è·å–åˆ°Springå®¹å™¨ä¸­çš„ä¸€äº›èµ„æºï¼Œç„¶åå¯ä»¥ä¾›åç»­æ­¥éª¤ï¼Œä¾‹å¦‚åˆå§‹åŒ–é˜¶æ®µä½¿ç”¨ã€‚</li><li>BeanPostProcessorå‰ç½®å¤„ç†ï¼špostProcessBeforeInitialzationæ–¹æ³•ã€‚ä¸Šè¿°å‡ ä¸ªæ­¥éª¤åï¼Œbeanå¯¹è±¡å·²ç»è¢«æ­£ç¡®æ„é€ ï¼Œä½†å¦‚æœæƒ³è¦å¯¹è±¡è¢«åˆå§‹åŒ–å‰å†è¿›è¡Œä¸€äº›è‡ªå®šä¹‰çš„å¤„ç†ï¼Œå°±å¯ä»¥é€šè¿‡BeanPostProcessoræ¥å£çš„è¯¥æ–¹æ³•æ¥å®ç°ã€‚</li><li>åˆå§‹åŒ–é˜¶æ®µï¼šè¯¥é˜¶æ®µSpringé¦–å…ˆä¼šçœ‹æ˜¯å¦æ˜¯å®ç°äº†InitializingBeanæ¥å£çš„afterPropertiesSetæ–¹æ³•ä»¥åŠæ˜¯å¦æœ‰è‡ªå®šä¹‰çš„init-methodç­‰ï¼Œå¦‚æœæœ‰ä¼šè¿›è¡Œè°ƒç”¨æ‰§è¡Œã€‚</li><li>BeanPostProcessoråç½®å¤„ç†ï¼špostProcessAfterInitialzationæ–¹æ³•ã€‚å½“å‰æ­£åœ¨åˆå§‹åŒ–çš„beanå¯¹è±¡ä¼šè¢«ä¼ é€’è¿›æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹è¿™ä¸ªbeanä½œä»»ä½•å¤„ç†ï¼Œä¸å‰é¢å‰ç½®å¤„ç†ç›¸å¯¹çš„ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨InitialzationBeanå®Œæˆåæ‰§è¡Œï¼Œå› æ­¤ç§°ä¸ºåç½®å¤„ç†ã€‚</li><li>beanåˆå§‹åŒ–å®Œæˆå¯ä»¥è¢«ä½¿ç”¨äº†ã€‚</li></ol><p>æ€»çš„æ¥è¯´ï¼ŒSpring IOC çš„å®ç°åŸç†æ˜¯é€šè¿‡åå°„æœºåˆ¶åŠ¨æ€åˆ›å»ºå¯¹è±¡ï¼Œä¾èµ–æ³¨å…¥ï¼Œå¯¹è±¡åˆå§‹åŒ–ã€‚é€šè¿‡è§£è€¦å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºæ›´åŠ çµæ´»ã€å¯ç»´æŠ¤ã€å¯æ‰©å±•ã€‚</p><h3 id="BeanFactoryå’ŒApplicationContextçš„å…³ç³»"><a href="#BeanFactoryå’ŒApplicationContextçš„å…³ç³»" class="headerlink" title="BeanFactoryå’ŒApplicationContextçš„å…³ç³»"></a>BeanFactoryå’ŒApplicationContextçš„å…³ç³»</h3><p>BeanFactoryå’ŒApplicationContextæ˜¯Springæ¡†æ¶ä¸­çš„ä¸¤ä¸ªé‡è¦çš„æ¥å£ã€‚å®ƒä»¬éƒ½ç”¨äºç®¡ç†Spring Beanå¯¹è±¡ï¼Œä½†æ˜¯å®ƒä»¬åœ¨åŠŸèƒ½ä¸Šæœ‰ä¸€äº›ä¸åŒç‚¹ã€‚</p><p>BeanFactoryæ˜¯Springæ¡†æ¶ä¸­æœ€åŸºæœ¬çš„å®¹å™¨ï¼Œå®ƒæä¾›äº†æœ€åŸºç¡€çš„IOCå’ŒDIçš„æ”¯æŒï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯ç”¨äºåˆ›å»ºã€ç®¡ç†å’ŒæŸ¥æ‰¾Beanå¯¹è±¡ã€‚BeanFactoryåªæ˜¯ä¸ªæ¥å£ï¼Œå¹¶ä¸æ˜¯IOCå®¹å™¨çš„å…·ä½“å®ç°ï¼Œ å®ƒä¸ºå…¶ä»–å…·ä½“çš„IOCå®¹å™¨æä¾›äº†æœ€åŸºæœ¬çš„è§„èŒƒï¼Œä¾‹å¦‚DefaultListableBeanFactory,ApplicationContext ç­‰å®¹å™¨å®ç°æˆ–å®¹å™¨æ¥å£éƒ½æ˜¯åŸºäºBeanFactoryï¼Œå†åœ¨å…¶åŸºç¡€ä¹‹ä¸Šé™„åŠ äº†å…¶ä»–çš„åŠŸèƒ½ï¼ŒåŸå§‹çš„BeanFactoryæ— æ³•æ”¯æŒspringçš„è®¸å¤šæ’ä»¶ï¼Œå¦‚AOPåŠŸèƒ½ã€Webåº”ç”¨ç­‰ã€‚åŸå§‹BeanFactoryæ˜¯å»¶æ—¶åŠ è½½ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å®¹å™¨å¯åŠ¨æ—¶ä¸ä¼šæ³¨å…¥beanï¼Œè€Œæ˜¯åœ¨éœ€è¦ä½¿ç”¨beançš„æ—¶å€™ï¼Œæ‰ä¼šå¯¹è¯¥beanè¿›è¡ŒåŠ è½½å®ä¾‹åŒ–ã€‚</p><p>ApplicationContextæ¥å£æ˜¯åŸºäºBeanFactoryæ‰©å±•è€Œæ¥ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå®¹å™¨æ¥å£ï¼Œå…·æœ‰BeanFactoryæ‰€æœ‰çš„åŠŸèƒ½ï¼ŒåŒæ—¶ç»§æ‰¿äº†MessageSourceï¼Œæ‰€ä»¥æä¾›äº†æ›´å®Œæ•´çš„æ¡†æ¶åŠŸèƒ½ï¼Œæ”¯æŒå›½é™…åŒ–ã€èµ„æºæ–‡ä»¶è®¿é—®ã€è½½å…¥å¤šä¸ªä¸Šä¸‹æ–‡é…ç½®æ–‡ä»¶ï¼Œä½¿å¾—æ¯ä¸€ä¸ªä¸Šä¸‹æ–‡éƒ½ä¸“æ³¨äºä¸€ä¸ªç‰¹å®šå±‚æ¬¡ï¼Œæä¾›åœ¨ç›‘å¬å™¨ä¸­æ³¨å†Œbeanäº‹ä»¶ã€‚ApplicationContext æ˜¯é¢„åŠ è½½ï¼Œåœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„beanï¼Œæ‰€ä»¥è¿è¡Œçš„æ—¶å€™é€Ÿåº¦ç›¸å¯¹BeanFactoryæ¯”è¾ƒå¿«ï¼Œç¼ºç‚¹å°±æ˜¯è€—å†…å­˜ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒBeanFactoryæ˜¯Springæ¡†æ¶ä¸­æœ€åŸºæœ¬çš„å®¹å™¨ï¼Œæä¾›æœ€åŸºç¡€çš„IOCå’ŒDIçš„æ”¯æŒï¼›è€ŒApplicationContextæ˜¯åœ¨BeanFactoryçš„åŸºç¡€ä¸Šæ‰©å±•è€Œæ¥çš„ï¼Œæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œç‰¹æ€§ã€‚ApplicationContextæ˜¯Springæ¡†æ¶ä¸­ä½¿ç”¨è¾ƒä¸ºå¹¿æ³›çš„å®¹å™¨ã€‚</p><h3 id="è°ˆè°ˆä½ å¯¹AOPçš„ç†è§£ï¼Ÿ"><a href="#è°ˆè°ˆä½ å¯¹AOPçš„ç†è§£ï¼Ÿ" class="headerlink" title="è°ˆè°ˆä½ å¯¹AOPçš„ç†è§£ï¼Ÿ"></a>è°ˆè°ˆä½ å¯¹AOPçš„ç†è§£ï¼Ÿ</h3><p>Spring AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ˜¯ Spring æ¡†æ¶ä¸­çš„ä¸€ä¸ªé‡è¦æ¨¡å—ï¼Œç”¨äºè§£å†³ç³»ç»Ÿä¸­çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆcross-cutting concernsï¼‰é—®é¢˜ã€‚æ‰€è°“æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ŒæŒ‡çš„æ˜¯ç³»ç»Ÿä¸­åˆ†æ•£åœ¨å„ä¸ªæ¨¡å—ä¸­ã€ä¸ä¸»ä¸šåŠ¡é€»è¾‘æ— å…³çš„ä»£ç ï¼Œä¾‹å¦‚æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ã€‚</p><p>Spring AOP é‡‡ç”¨ä»£ç†æ¨¡å¼å®ç°ï¼Œå®ƒé€šè¿‡åœ¨è¿è¡ŒæœŸé—´åŠ¨æ€ä»£ç†ç›®æ ‡å¯¹è±¡ï¼Œå°†æ¨ªåˆ‡å…³æ³¨ç‚¹ç»‡å…¥åˆ°ç³»ç»Ÿä¸­ï¼Œä»è€Œå®ç°äº†ä¸šåŠ¡é€»è¾‘ä¸æ¨ªåˆ‡å…³æ³¨ç‚¹çš„åˆ†ç¦»ã€‚Spring AOP ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µç»„æˆï¼š</p><ol><li>åˆ‡é¢ï¼ˆAspectï¼‰ï¼šåˆ‡é¢æ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒåŒ…å«äº†ä¸€ç»„æ¨ªåˆ‡å…³æ³¨ç‚¹å’Œç›¸åº”çš„é€»è¾‘ã€‚ä¸€ä¸ªåˆ‡é¢é€šå¸¸ä¼šè·¨è¶Šå¤šä¸ªå¯¹è±¡ï¼Œå› æ­¤å®ƒä¸ä»…å®šä¹‰äº†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œè¿˜å®šä¹‰äº†æ¨ªåˆ‡å…³æ³¨ç‚¹ä¸ä¸šåŠ¡é€»è¾‘çš„å…³ç³»ã€‚</li><li>è¿æ¥ç‚¹ï¼ˆJoin Pointï¼‰ï¼šè¿æ¥ç‚¹æ˜¯åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´å¯ä»¥æ’å…¥åˆ‡é¢çš„ç‚¹ã€‚ä¾‹å¦‚æ–¹æ³•è°ƒç”¨ã€å¼‚å¸¸æŠ›å‡ºç­‰ã€‚</li><li>åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰ï¼šåˆ‡å…¥ç‚¹æ˜¯ä¸€ç»„è¿æ¥ç‚¹çš„é›†åˆï¼Œå®ƒå®šä¹‰äº†åœ¨å“ªäº›è¿æ¥ç‚¹ä¸Šåº”ç”¨åˆ‡é¢ã€‚ä¾‹å¦‚æ‰€æœ‰çš„æ–¹æ³•è°ƒç”¨ã€æ‰€æœ‰çš„å¼‚å¸¸æŠ›å‡ºç­‰ã€‚</li><li>é€šçŸ¥ï¼ˆAdviceï¼‰ï¼šé€šçŸ¥æ˜¯åˆ‡é¢åœ¨ç‰¹å®šè¿æ¥ç‚¹æ‰§è¡Œçš„ä»£ç ã€‚Spring AOP æä¾›äº†äº”ç§ç±»å‹çš„é€šçŸ¥ï¼šå‰ç½®é€šçŸ¥ï¼ˆBeforeï¼‰ã€åç½®é€šçŸ¥ï¼ˆAfterï¼‰ã€è¿”å›é€šçŸ¥ï¼ˆAfter-returningï¼‰ã€å¼‚å¸¸é€šçŸ¥ï¼ˆAfter-throwingï¼‰å’Œç¯ç»•é€šçŸ¥ï¼ˆAroundï¼‰ã€‚</li><li>åˆ‡é¢ç»‡å…¥ï¼ˆWeavingï¼‰ï¼šåˆ‡é¢ç»‡å…¥æ˜¯å°†åˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡å¹¶åˆ›å»ºä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚</li></ol><p>Spring AOP é€šè¿‡é…ç½®æ–‡ä»¶æˆ–æ³¨è§£çš„æ–¹å¼æ¥å®šä¹‰åˆ‡é¢ã€è¿æ¥ç‚¹ã€åˆ‡å…¥ç‚¹å’Œé€šçŸ¥ç­‰ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨ä»£ç†æ¨¡å¼å°†åˆ‡é¢ç»‡å…¥åˆ°ç›®æ ‡å¯¹è±¡ä¸­ã€‚é€šè¿‡ AOP æŠ€æœ¯ï¼Œå¯ä»¥æœ‰æ•ˆåœ°è§£è€¦ä¸šåŠ¡é€»è¾‘å’Œæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p><h3 id="åŠ¨æ€ä»£ç†äº†è§£å—ï¼Ÿ"><a href="#åŠ¨æ€ä»£ç†äº†è§£å—ï¼Ÿ" class="headerlink" title="åŠ¨æ€ä»£ç†äº†è§£å—ï¼Ÿ"></a>åŠ¨æ€ä»£ç†äº†è§£å—ï¼Ÿ</h3><p>JavaåŠ¨æ€ä»£ç†æ˜¯Javaä¸­ä¸€ç§é‡è¦çš„ä»£ç†æ¨¡å¼ï¼Œå®ƒå…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ç”Ÿæˆä»£ç†ç±»å’Œå¯¹è±¡ï¼Œæ— éœ€ç¼–å†™é™æ€ä»£ç†ç±»ã€‚</p><p>åœ¨Javaä¸­ï¼ŒåŠ¨æ€ä»£ç†å¯ä»¥é€šè¿‡Javaè‡ªå¸¦çš„ä¸¤ç§æ–¹å¼å®ç°ï¼šåŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†å’ŒåŸºäºç±»çš„åŠ¨æ€ä»£ç†ã€‚</p><ol><li>åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†</li></ol><p>åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†æ˜¯Javaå®˜æ–¹æä¾›çš„ä¸€ç§åŠ¨æ€ä»£ç†å®ç°æ–¹å¼ã€‚åœ¨è¿™ç§å®ç°æ–¹å¼ä¸­ï¼Œä»£ç†ç±»å¿…é¡»å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ï¼Œç„¶ååœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºä»£ç†å¯¹è±¡ã€‚JDKä¸­æä¾›äº†ä¸€ä¸ªProxyç±»å’Œä¸€ä¸ªInvocationHandleræ¥å£æ¥å®ç°åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªå®ç°InvocationHandleræ¥å£çš„ä»£ç†ç±»ï¼Œè¯¥ç±»å®ç°äº†ä»£ç†ç±»çš„é€»è¾‘ã€‚è¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªinvokeæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ä»£ç†ç±»çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶è¢«æ‰§è¡Œã€‚åœ¨è¿è¡Œæ—¶é€šè¿‡Proxyç±»çš„é™æ€æ–¹æ³•newProxyInstanceç”Ÿæˆä»£ç†ç±»å¯¹è±¡ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼šClassLoaderã€ä»£ç†ç±»éœ€è¦å®ç°çš„æ¥å£æ•°ç»„å’ŒInvocationHandlerå®ç°ç±»çš„å®ä¾‹ã€‚å½“é€šè¿‡ä»£ç†ç±»å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•é¦–å…ˆè¢«è½¬å‘åˆ°InvocationHandlerçš„invokeæ–¹æ³•ä¸­ã€‚åœ¨invokeæ–¹æ³•ä¸­ï¼Œå¯ä»¥æ ¹æ®ä»£ç†ç±»æ–¹æ³•çš„ä¸åŒæ¥æ‰§è¡Œä¸åŒçš„é€»è¾‘ï¼ŒåŒ…æ‹¬è°ƒç”¨è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•å’Œæ‰§è¡Œå…¶ä»–çš„é€»è¾‘ã€‚æœ€ç»ˆï¼Œä»£ç†ç±»çš„æ–¹æ³•è¢«æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›ç»“æœã€‚</p><ol start="2"><li>åŸºäºç±»çš„åŠ¨æ€ä»£ç†</li></ol><p>åŸºäºç±»çš„åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡å­—èŠ‚ç ç”ŸæˆæŠ€æœ¯å®ç°çš„ã€‚åœ¨è¿™ç§å®ç°æ–¹å¼ä¸­ï¼Œä»£ç†ç±»ä¸éœ€è¦å®ç°æ¥å£ï¼Œè€Œæ˜¯é€šè¿‡ç»§æ‰¿ä¸€ä¸ªå·²æœ‰çš„ç±»æ¥å®ç°ä»£ç†åŠŸèƒ½ã€‚åœ¨Javaä¸­ï¼Œå¯ä»¥é€šè¿‡CGLIBåº“å®ç°åŸºäºç±»çš„åŠ¨æ€ä»£ç†ã€‚</p><p>CGLIBï¼ˆCode Generation Libraryï¼‰æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ä»£ç ç”Ÿæˆåº“ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç æ¥å®ç°ç±»çš„å¢å¼ºåŠŸèƒ½ã€‚é€šè¿‡CGLIBåº“ï¼Œå¯ä»¥ç›´æ¥åœ¨è¿è¡Œæ—¶åˆ›å»ºç›®æ ‡å¯¹è±¡çš„å­ç±»ï¼Œä»è€Œå®ç°åŸºäºç±»çš„åŠ¨æ€ä»£ç†ã€‚</p><p>åŸºäºç±»çš„åŠ¨æ€ä»£ç†ç›¸æ¯”äºåŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†ï¼Œå¯ä»¥ä»£ç†é‚£äº›æ²¡æœ‰å®ç°ä»»ä½•æ¥å£çš„ç±»ï¼Œæ›´åŠ çµæ´»ã€‚ä½†æ˜¯å®ƒçš„å®ç°åŸç†æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç ï¼Œä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚</p><h3 id="SpringMVCçš„æ‰§è¡Œæµç¨‹äº†è§£å—ï¼Ÿ"><a href="#SpringMVCçš„æ‰§è¡Œæµç¨‹äº†è§£å—ï¼Ÿ" class="headerlink" title="SpringMVCçš„æ‰§è¡Œæµç¨‹äº†è§£å—ï¼Ÿ"></a>SpringMVCçš„æ‰§è¡Œæµç¨‹äº†è§£å—ï¼Ÿ</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230815153451136.png" alt="image-20230815153451136"></p><p>SpringMVCæ˜¯åŸºäºMVCè®¾è®¡æ¨¡å¼å®ç°çš„Webæ¡†æ¶ï¼Œå…¶å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å®¢æˆ·ç«¯å‘é€HTTPè¯·æ±‚è‡³å‰ç«¯æ§åˆ¶å™¨DispatcherServletã€‚</li><li>DispatcherServletæ ¹æ®è¯·æ±‚ä¿¡æ¯è°ƒç”¨HandlerMappingï¼Œè§£æè¯·æ±‚å¯¹åº”çš„Handlerå³å¤„ç†å™¨ï¼ˆControllerï¼‰ã€‚</li><li>HandlerMappingæ ¹æ®è¯·æ±‚URLæŸ¥æ‰¾å¯¹åº”çš„Controllerï¼ŒåŒæ—¶ç”Ÿæˆç”¨äºæ‰§è¡Œè¯¥è¯·æ±‚çš„HandlerExecutionChainå¯¹è±¡ï¼ˆåŒ…å«Interceptoré“¾ï¼‰ã€‚</li><li>DispatcherServletè°ƒç”¨HandlerAdapteræ‰§è¡ŒHandlerã€‚åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒHandlerAdapterå°†æŠŠModelAndViewå¯¹è±¡ä¼ é€’ç»™DispatcherServletã€‚</li><li>Handleræ‰§è¡Œå®Œæˆåï¼Œè¿”å›ä¸€ä¸ªModelAndViewå¯¹è±¡ç»™HandlerAdapterã€‚</li><li>HandlerAdapterå°†ModelAndViewå¯¹è±¡ä¼ é€’ç»™DispatcherServletã€‚</li><li>DispatcherServletè°ƒç”¨ViewResolverè§£æè§†å›¾ï¼ˆViewï¼‰ã€‚</li><li>ViewResolverè§£æå‡ºViewå¯¹è±¡åï¼Œå°†å…¶è¿”å›ç»™DispatcherServletã€‚</li><li>DispatcherServletè°ƒç”¨Viewå¯¹è±¡çš„render()æ–¹æ³•è¿›è¡Œè§†å›¾æ¸²æŸ“ã€‚</li><li>DispatcherServletå°†æ¸²æŸ“åçš„è§†å›¾è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒDispatcherServletæ˜¯æ•´ä¸ªSpringMVCçš„æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£åè°ƒå„ä¸ªç»„ä»¶çš„å·¥ä½œã€‚HandlerMappingè´Ÿè´£å°†è¯·æ±‚æ˜ å°„åˆ°å¯¹åº”çš„Controllerï¼Œè€ŒHandlerAdapterè´Ÿè´£æ‰§è¡ŒControllerã€‚ViewResolveråˆ™æ ¹æ®é€»è¾‘è§†å›¾åï¼ˆå¦‚JSPæ–‡ä»¶åï¼‰è§£æå‡ºViewå¯¹è±¡ï¼Œæœ€åç”±Viewæ¸²æŸ“å‡ºå®é™…çš„é¡µé¢å†…å®¹ã€‚é€šè¿‡è¿™ç§åˆ†å·¥åä½œçš„æ–¹å¼ï¼ŒSpringMVCå¯ä»¥å®ç°çµæ´»ã€é«˜æ•ˆã€å¯æ‰©å±•çš„Webåº”ç”¨ç¨‹åºå¼€å‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Springå¼€å‘æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯å¼€å‘ </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>APIæ¥å£å¼€æ”¾å¹³å°</title>
      <link href="/2023/07/11/API%E6%8E%A5%E5%8F%A3%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0/"/>
      <url>/2023/07/11/API%E6%8E%A5%E5%8F%A3%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="APIå¼€æ”¾å¹³å°"><a href="#APIå¼€æ”¾å¹³å°" class="headerlink" title="APIå¼€æ”¾å¹³å°"></a>APIå¼€æ”¾å¹³å°</h1><h2 id="èƒŒæ™¯ï¼š"><a href="#èƒŒæ™¯ï¼š" class="headerlink" title="èƒŒæ™¯ï¼š"></a>èƒŒæ™¯ï¼š</h2><ol><li><p>å‰ç«¯å¼€å‘éœ€è¦ç”¨åˆ°åå°æ¥å£</p></li><li><p>ä½¿ç”¨ç°æˆçš„ç³»ç»Ÿçš„åŠŸèƒ½</p></li></ol><h3 id="åšä¸€ä¸ªAPIæ¥å£å¹³å°ï¼š"><a href="#åšä¸€ä¸ªAPIæ¥å£å¹³å°ï¼š" class="headerlink" title="åšä¸€ä¸ªAPIæ¥å£å¹³å°ï¼š"></a>åšä¸€ä¸ªAPIæ¥å£å¹³å°ï¼š</h3><ol><li>é˜²æ­¢æ”»å‡»(å®‰å…¨æ€§)</li><li>ä¸èƒ½éšä¾¿è°ƒç”¨(é™åˆ¶ã€å¼€é€š)</li><li>ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°</li><li>è®¡è´¹</li><li>æµé‡ä¿æŠ¤</li><li>APIæ¥å…¥</li></ol><h2 id="é¡¹ç›®ä»‹ç»"><a href="#é¡¹ç›®ä»‹ç»" class="headerlink" title="é¡¹ç›®ä»‹ç»"></a>é¡¹ç›®ä»‹ç»</h2><p>åšä¸€ä¸ªæä¾›APIæ¥å£è°ƒç”¨çš„å¹³å°ï¼š</p><ul><li><p>ç”¨æˆ·å¯ä»¥æ³¨å†Œç™»å½•ï¼Œå¼€é€šæ¥å£è°ƒç”¨æƒé™ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¥å£ï¼Œå¹¶ä¸”æ¯æ¬¡è°ƒç”¨ä¼šè¿›è¡Œç»Ÿè®¡ã€‚</p></li><li><p>ç®¡ç†å‘˜å¯ä»¥å‘å¸ƒæ¥å£ã€ä¸‹çº¿æ¥å£ã€æ¥å…¥æ¥å£ï¼Œä»¥åŠå¯è§†åŒ–æ¥å£çš„è°ƒç”¨æƒ…å†µã€æ•°æ®ã€‚</p></li></ul><h3 id="ä¸šåŠ¡æµç¨‹"><a href="#ä¸šåŠ¡æµç¨‹" class="headerlink" title="ä¸šåŠ¡æµç¨‹"></a>ä¸šåŠ¡æµç¨‹</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711194146565.png" alt="image-20230711194146565"></p><h3 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h3><h4 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h4><ul><li><p>Ant Design Pro</p></li><li><p>React</p></li><li><p>Ant Design Procomponents</p></li><li><p>Umi</p></li><li><p>Umi Request(Axiosçš„å°è£…)</p></li></ul><h4 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h4><ul><li><p>Spring Boot</p></li><li><p>Spring Boot Starter(SDKå¼€å‘)</p></li><li><p>ç½‘å…³ã€é™æµã€æ—¥å¿—å®ç° â€”â€“&gt; dubbo+nacos</p></li></ul><h3 id="é¡¹ç›®å¼€å‘çš„é˜¶æ®µåˆ’åˆ†"><a href="#é¡¹ç›®å¼€å‘çš„é˜¶æ®µåˆ’åˆ†" class="headerlink" title="é¡¹ç›®å¼€å‘çš„é˜¶æ®µåˆ’åˆ†"></a>é¡¹ç›®å¼€å‘çš„é˜¶æ®µåˆ’åˆ†</h3><h4 id="1ã€åˆå§‹åŒ–å’Œå±•ç¤º"><a href="#1ã€åˆå§‹åŒ–å’Œå±•ç¤º" class="headerlink" title="1ã€åˆå§‹åŒ–å’Œå±•ç¤º"></a>1ã€åˆå§‹åŒ–å’Œå±•ç¤º</h4><p>é¡¹ç›®ä»‹ç»ã€è®¾è®¡ã€æŠ€æœ¯é€‰å‹</p><p>åŸºç¡€é¡¹ç›®çš„æ­å»º</p><p>æ¥å£ç®¡ç†</p><p>ç”¨æˆ·æŸ¥çœ‹æ¥å£</p><h4 id="2ã€æ¥å£è°ƒç”¨"><a href="#2ã€æ¥å£è°ƒç”¨" class="headerlink" title="2ã€æ¥å£è°ƒç”¨"></a>2ã€æ¥å£è°ƒç”¨</h4><ol><li>ç»§ç»­å¼€å‘æ¥å£ç®¡ç†å‰ç«¯é¡µé¢</li><li>å¼€å‘æ¨¡æ‹ŸAPIæ¥å£</li><li>å¼€å‘è°ƒç”¨è¿™ä¸ªæ¥å£çš„ä»£ç </li><li>ä¿è¯è°ƒç”¨çš„å®‰å…¨æ€§(APIç­¾åè®¤è¯)</li><li>å®¢æˆ·ç«¯SDKçš„å¼€å‘</li></ol><h4 id="3ã€æ¥å£è®¡é‡ä¸ä¿æŠ¤"><a href="#3ã€æ¥å£è®¡é‡ä¸ä¿æŠ¤" class="headerlink" title="3ã€æ¥å£è®¡é‡ä¸ä¿æŠ¤"></a>3ã€æ¥å£è®¡é‡ä¸ä¿æŠ¤</h4><ol><li>å¼€å‘æ¥å£å‘å¸ƒ&#x2F;ä¸‹çº¿çš„åŠŸèƒ½(ç®¡ç†å‘˜)</li><li>å‰ç«¯å»æµè§ˆæ¥å£ã€æŸ¥çœ‹æ¥å£æ–‡æ¡£ã€ç”³è¯·ç­¾å(æ³¨å†Œ)ã€åœ¨çº¿è°ƒè¯•(ç”¨æˆ·)</li><li>ç»Ÿè®¡ç”¨æˆ·è°ƒç”¨æ¥å£æ¬¡æ•°</li><li>ä¼˜åŒ–ç³»ç»Ÿ - APIç½‘å…³</li></ol><h5 id="å¼€å‘æ¥å£å‘å¸ƒ-x2F-ä¸‹çº¿çš„åŠŸèƒ½-ç®¡ç†å‘˜"><a href="#å¼€å‘æ¥å£å‘å¸ƒ-x2F-ä¸‹çº¿çš„åŠŸèƒ½-ç®¡ç†å‘˜" class="headerlink" title="å¼€å‘æ¥å£å‘å¸ƒ&#x2F;ä¸‹çº¿çš„åŠŸèƒ½(ç®¡ç†å‘˜)"></a>å¼€å‘æ¥å£å‘å¸ƒ&#x2F;ä¸‹çº¿çš„åŠŸèƒ½(ç®¡ç†å‘˜)</h5><h6 id="å‘å¸ƒæ¥å£-ä»…ç®¡ç†å‘˜å¯ç”¨-ï¼š"><a href="#å‘å¸ƒæ¥å£-ä»…ç®¡ç†å‘˜å¯ç”¨-ï¼š" class="headerlink" title="å‘å¸ƒæ¥å£(ä»…ç®¡ç†å‘˜å¯ç”¨)ï¼š"></a>å‘å¸ƒæ¥å£(ä»…ç®¡ç†å‘˜å¯ç”¨)ï¼š</h6><ol><li>æ£€æŸ¥è¯¥æ¥å£æ˜¯å¦å­˜åœ¨</li><li>åˆ¤æ–­è¯¥æ¥å£æ˜¯å¦å¯ä»¥è°ƒç”¨</li><li>ä¿®æ”¹æ¥å£æ•°æ®åº“ä¸­çš„çŠ¶æ€å­—æ®µä¸º1</li></ol><h6 id="ä¸‹çº¿æ¥å£ï¼š"><a href="#ä¸‹çº¿æ¥å£ï¼š" class="headerlink" title="ä¸‹çº¿æ¥å£ï¼š"></a>ä¸‹çº¿æ¥å£ï¼š</h6><ol><li>æ£€æŸ¥è¯¥æ¥å£æ˜¯å¦å­˜åœ¨</li><li>åˆ¤æ–­è¯¥æ¥å£æ˜¯å¦å¯ä»¥è°ƒç”¨</li><li>ä¿®æ”¹æ¥å£æ•°æ®åº“ä¸­çš„çŠ¶æ€å­—æ®µä¸º0</li></ol><p>å‰ç«¯å»æµè§ˆæ¥å£ã€æŸ¥çœ‹æ¥å£æ–‡æ¡£</p><p>â€“åŠ¨æ€è·¯ç”±ï¼Œç”¨urlæ¥ä¼ é€’idï¼ŒåŠ è½½ä¸åŒçš„æ¥å£ä¿¡æ¯</p><p>ç”³è¯·ç­¾å(æ³¨å†Œ) ï¼š</p><p>ç”¨æˆ·åœ¨æ³¨å†ŒæˆåŠŸæ—¶ï¼Œè‡ªåŠ¨åˆ†é… accessKeyã€secretKey</p><p>æ‰©å±•ï¼šç”¨æˆ·å¯ä»¥ç”³è¯·æ›´æ¢ç­¾å</p><p>åœ¨çº¿è°ƒç”¨</p><p>â€‹è¯·æ±‚å‚æ•°çš„ç±»å‹(ç›´æ¥ç”¨ json ç±»å‹)</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;username&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>å…ˆè·‘é€šæ•´ä¸ªæµç¨‹ï¼Œå†å»é’ˆå¯¹ä¸åŒçš„è¯·æ±‚æˆ–æ¥å£ç±»å‹æ¥è®¾è®¡ç•Œé¢å’Œè¡¨å•ï¼Œç»™ç”¨æˆ·æ›´å¥½çš„ä½“éªŒ(å¯ä»¥å‚è€ƒpostman)</p><p>è°ƒç”¨æµç¨‹ï¼š</p><p>ä½¿ç”¨èµ°åç«¯æ–¹å¼æµç¨‹ï¼š(åç«¯ç›¸å½“äºä¸­è½¬ç«™ï¼Œé˜²æ­¢ç”¨æˆ·ç›´æ¥æ‹¿åˆ°æ¥å£çš„åœ°å€ï¼Œä»è€Œç»•è¿‡ç³»ç»Ÿè‡ªè¡Œè°ƒç”¨)</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230716140059896.png" alt="image-20230716140059896" style="zoom:50%;" /><p>æµç¨‹ï¼š</p><pre><code>1. å‰ç«¯å°†ç”¨æˆ·è¾“å…¥çš„è¯·æ±‚å‚æ•°å’Œè¦æµ‹è¯•çš„æ¥å£å‘é€ç»™å¹³å°åç«¯2. (åœ¨è°ƒç”¨å‰å¯ä»¥åšä¸€äº›è°ƒç”¨)3. å¹³å°åç«¯å»è°ƒç”¨æ¨¡æ‹Ÿæ¥å£</code></pre><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¯·æ±‚å‚æ•°è¦æ³¨æ„å¤§å°å†™ï¼</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;don&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h4><p>åˆ¤æ–­è¯¥æ¥å£æ˜¯å¦å¯ä»¥è°ƒç”¨æ—¶ ç”±å›ºå®šæ–¹æ³•åæ”¹ä¸ºæ ¹æ®æµ‹è¯•åœ°å€æ¥è°ƒç”¨</p><p>ç”¨æˆ·æµ‹è¯•æ¥å£ ç”±å›ºå®šæ–¹æ³•å-&gt;æ ¹æ®æµ‹è¯•åœ°å€æ¥è°ƒç”¨</p><p>æ¨¡æ‹Ÿæ¥å£æ”¹ä¸ºä»æ•°æ®åº“æ ¡éªŒ akey</p><h4 id="4ã€ç®¡ç†ã€ç»Ÿè®¡åˆ†æ"><a href="#4ã€ç®¡ç†ã€ç»Ÿè®¡åˆ†æ" class="headerlink" title="4ã€ç®¡ç†ã€ç»Ÿè®¡åˆ†æ"></a>4ã€ç®¡ç†ã€ç»Ÿè®¡åˆ†æ</h4><ol><li><p>å¼€å‘æ¥å£è°ƒç”¨æ¬¡æ•°çš„ç»Ÿè®¡</p></li><li><p>ä¼˜åŒ–æ•´ä¸ªç³»ç»Ÿçš„æ¶æ„</p><p>a. ç½‘å…³æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>b. ç½‘å…³çš„ä½œç”¨ï¼Ÿ</p><p>c. ç½‘å…³çš„åº”ç”¨åœºæ™¯åŠå®ç°</p><p>d. ç»“åˆä¸šåŠ¡å»åº”ç”¨ç½‘å…³</p></li></ol><h6 id="æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡"><a href="#æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡" class="headerlink" title="æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡"></a>æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡</h6><p>â€‹<strong>1ã€éœ€æ±‚ï¼šç”¨æˆ·æ¯æ¬¡è°ƒç”¨æ¥å£æˆåŠŸï¼Œæ¬¡æ•°+1</strong></p><p>â€‹2ã€ç»™ç”¨æˆ·åˆ†é…æˆ–è€…ç”¨æˆ·è‡ªä¸»ç”³è¯·æ¥å£è°ƒç”¨æ¬¡æ•°</p><p>â€‹ä¸šåŠ¡æµç¨‹ï¼š</p><p>â€‹1ã€ç”¨æˆ·è°ƒç”¨æ¥å£</p><p>â€‹2ã€ä¿®æ”¹æ•°æ®åº“ï¼Œè°ƒç”¨æ¬¡æ•°+1</p><h4 id="5ã€é‰´æƒ"><a href="#5ã€é‰´æƒ" class="headerlink" title="5ã€é‰´æƒ"></a>5ã€é‰´æƒ</h4><ol><li>å®ç°<strong>ç»Ÿä¸€</strong>çš„ç”¨æˆ·é‰´æƒã€ç»Ÿä¸€çš„æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡ï¼ˆæŠŠAPIç½‘å…³åº”ç”¨åˆ°é¡¹ç›®ä¸­ï¼‰<ul><li>ç”¨åˆ°çš„<strong>ç½‘å…³ç›¸å…³ç‰¹æ€§</strong><ul><li>è·¯ç”±ï¼šç”¨æˆ·åŸæœ¬ç›´æ¥è¯·æ±‚æ¨¡æ‹Ÿæ¥å£ï¼Œåœ¨æ¨¡æ‹Ÿæ¥å£é‰´æƒï¼›ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨ç½‘å…³å¯¹ç”¨æˆ·è¿›è¡Œé‰´æƒï¼Œç½‘å…³é‰´æƒé€šè¿‡åå†å°†è¯·æ±‚é‡å®šå‘åˆ°æ¨¡æ‹Ÿæ¥å£ã€‚</li><li>ç»Ÿä¸€é‰´æƒ(accessKeyã€secretKey)</li><li>ç»Ÿä¸€ä¸šåŠ¡å¤„ç†(æ¯æ¬¡è¯·æ±‚æ¥å£åï¼Œè°ƒç”¨æ¬¡æ•°éƒ½è¦+1)</li><li>è®¿é—®æ§åˆ¶(é»‘ç™½åå•)</li><li>æµé‡æŸ“è‰²(è®°å½•è¯·æ±‚æ˜¯å¦ä¸ºç½‘å…³æ¥çš„ï¼Œä½†æ˜¯è¿™æ ·çš„è¯ï¼Œåœ¨æœ€ç»ˆæ¥å£å¤„è¿˜è¦å¯¹è¯·æ±‚è¿›è¡Œåˆ¤æ–­,çœ‹çœ‹æœ‰æ²¡æœ‰è¢«æŸ“è‰²)</li><li>ç»Ÿä¸€æ—¥å¿—(è®°å½•æ¯æ¬¡çš„è¯·æ±‚ä¸å“åº”)</li></ul></li><li>ä¸šåŠ¡é€»è¾‘<ol><li>ç”¨æˆ·å‘é€è¯·æ±‚åˆ°APIç½‘å…³</li><li>è¯·æ±‚æ—¥å¿—</li><li>(é»‘ç™½åå•)</li><li>ç”¨æˆ·é‰´æƒ(åˆ¤æ–­akã€skæ˜¯å¦åˆæ³•)</li><li>è¯·æ±‚çš„æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨ï¼Ÿ</li><li>è¯·æ±‚è½¬å‘ï¼Œè°ƒç”¨æ¨¡æ‹Ÿæ¥å£</li><li>å“åº”æ—¥å¿—</li><li>è°ƒç”¨æˆåŠŸï¼Œæ¥å£è°ƒç”¨æ¬¡æ•°+1</li><li>è°ƒç”¨å¤±è´¥ï¼Œè¿”å›ä¸€ä¸ªè§„èŒƒçš„é”™è¯¯ç </li></ol></li></ul></li></ol><h4 id="6ã€ç½‘å…³"><a href="#6ã€ç½‘å…³" class="headerlink" title="6ã€ç½‘å…³"></a>6ã€ç½‘å…³</h4><ol><li>è¡¥å……å®Œæ•´ç½‘å…³çš„ä¸šåŠ¡é€»è¾‘(æ€ä¹ˆå»æ“ä½œæ•°æ®åº“ã€æ€ä¹ˆå¤ç”¨ä¹‹å‰çš„æ–¹æ³•â€”â€”RPC)</li><li>å®Œå–„ç³»ç»Ÿï¼Œå¼€å‘ä¸€ä¸ªç›‘æ§ç»Ÿè®¡åŠŸèƒ½</li></ol><h5 id="ç½‘å…³ä¸šåŠ¡é€»è¾‘"><a href="#ç½‘å…³ä¸šåŠ¡é€»è¾‘" class="headerlink" title="ç½‘å…³ä¸šåŠ¡é€»è¾‘"></a>ç½‘å…³ä¸šåŠ¡é€»è¾‘</h5><p>é—®é¢˜ï¼šç½‘å…³é¡¹ç›®æ¯”è¾ƒçº¯å‡€ï¼Œæ²¡æœ‰æ“ä½œæ•°æ®åº“çš„åŒ…ã€å¹¶ä¸”è¿˜è¦è°ƒç”¨æˆ‘ä»¬ä¹‹å‰å†™è¿‡çš„ä»£ç ï¼Ÿå¤åˆ¶ç²˜è´´ç»´æŠ¤éº»çƒ¦</p><p>ç†æƒ³ï¼šç›´æ¥è¯·æ±‚åˆ°å…¶ä»–é¡¹ç›®çš„æ–¹æ³•</p><h6 id="æ€ä¹ˆè°ƒç”¨å…¶ä»–é¡¹ç›®çš„æ–¹æ³•ï¼Ÿï¼š"><a href="#æ€ä¹ˆè°ƒç”¨å…¶ä»–é¡¹ç›®çš„æ–¹æ³•ï¼Ÿï¼š" class="headerlink" title="æ€ä¹ˆè°ƒç”¨å…¶ä»–é¡¹ç›®çš„æ–¹æ³•ï¼Ÿï¼š"></a>æ€ä¹ˆè°ƒç”¨å…¶ä»–é¡¹ç›®çš„æ–¹æ³•ï¼Ÿï¼š</h6><ol><li>å¤åˆ¶ä»£ç ã€ç¯å¢ƒ</li><li>HTTPè¯·æ±‚(æä¾›ä¸€ä¸ªæ¥å£ã€ä¾›å…¶ä»–é¡¹ç›®ä½¿ç”¨)<ul><li>serverå¼€å‘ä¸€ä¸ªæ¥å£(åœ°å€ã€è¯·æ±‚æ–¹æ³•ã€å‚æ•°ã€è¿”å›å€¼)</li><li>clientä½¿ç”¨HTTP Clientä¹‹ç±»çš„ä»£ç åŒ…å»å‘é€HTTPè¯·æ±‚</li></ul></li><li>RPC<ul><li>ä½œç”¨ï¼šåƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æ–¹æ³•</li><li>å¯¹å¼€å‘è€…æ›´é€æ˜ï¼Œå‡å°‘äº†å¾ˆå¤šæ²Ÿé€šæˆæœ¬</li><li>RPCå‘è¿œç¨‹æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œæœªå¿…è¦ä½¿ç”¨HTTPåè®®ï¼Œæ¯”å¦‚ TCP&#x2F;IP(æ€§èƒ½æ›´é«˜ã€å†…éƒ¨æœåŠ¡æ›´é€‚ç”¨)ç­‰ç­‰ç­‰ç­‰</li></ul></li><li>æŠŠå…¬å…±é¡¹ç›®æ‰“åŒ…æˆjaråŒ…ï¼Œå…¶ä»–é¡¹ç›®å»å¼•ç”¨(å®¢æˆ·ç«¯SDK)</li></ol><p>![image-20230719103013425](&#x2F;Users&#x2F;donn&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230719103013425.png)</p><h6 id="å…·ä½“å®ç°ï¼š"><a href="#å…·ä½“å®ç°ï¼š" class="headerlink" title="å…·ä½“å®ç°ï¼š"></a>å…·ä½“å®ç°ï¼š</h6><ol><li>è¯·æ±‚è½¬å‘</li></ol><p>ç”¨ä¸€ä¸ªå‰ç¼€åŒ¹é…æ–­è¨€ï¼šæ‰€æœ‰è·¯å¾„ä¸º &#x2F;api&#x2F;** çš„è¯·æ±‚è½¬å‘åˆ°<a href="http://localhost:8123/api/">http://localhost:8123/api/</a>**</p><p>ä¾‹å¦‚ï¼š<a href="http://localhost:8090/api/name/">http://localhost:8090/api/name/</a>** &#x3D;&#x3D;&#x3D;&gt; <a href="http://localhost:8123/api/name/">http://localhost:8123/api/name/</a>**</p><p>æ¨¡æ‹Ÿæ¥å£è¯·æ±‚åœ°å€ï¼š<a href="http://localhost:8123/api/name/get?name=123">http://localhost:8123/api/name/get?name=123</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">default-filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddResponseHeader=source,</span> <span class="string">donn</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">api_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://localhost:8123</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/**</span></span><br></pre></td></tr></table></figure><ol start="2"><li><p>ç¼–å†™ä¸šåŠ¡é€»è¾‘</p><p>ä½¿ç”¨äº†GlobalFilterå…¨å±€è¯·æ±‚æ‹¦æˆªå¤„ç†(ç±»ä¼¼AOP)</p></li></ol><p>â€‹å› ä¸ºç½‘å…³é¡¹ç›®æ²¡å¼•å…¥MyBatisç­‰æ“ä½œæ•°æ®åº“çš„ç±»åº“ï¼Œå¦‚æœè¯¥æ“ä½œè¾ƒä¸ºå¤æ‚ï¼Œå¯ä»¥ç”±backendå¢åˆ æ”¹æŸ¥é¡¹ç›®æä¾›æ¥å£ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨ï¼Œä¸ç”¨å†é‡å¤å†™é€»è¾‘ã€‚</p><ul><li>HTTPè¯·æ±‚ (ç”¨HTTPClientã€ç”¨RestTemplateã€Feign)</li><li>RPC (Dubbo)</li></ul><h6 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h6><p>é¢„æœŸæ˜¯ç­‰æ¨¡æ‹Ÿæ¥å£è°ƒç”¨å®Œæˆï¼Œæ‰è°ƒç”¨å“åº”æ—¥å¿—ã€ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°</p><p>ä½†å®é™…ä¸Š chain.filter æ–¹æ³•ç«‹å³è¿”å›äº†ï¼Œç›´åˆ°filterè¿‡æ»¤å™¨ return åæ‰è°ƒç”¨äº†æ¨¡æ‹Ÿæ¥å£</p><p>åŸå› ï¼šchain.filter æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œç†è§£ä¸ºå‰ç«¯çš„ promise</p><p>è§£å†³æ–¹æ¡ˆï¼šåˆ©ç”¨responseè£…é¥°è€…ï¼Œå¢å¼ºåŸæœ‰çš„responseçš„å¤„ç†èƒ½åŠ›</p><h6 id="Dubboæ¡†æ¶-RPCå®ç°"><a href="#Dubboæ¡†æ¶-RPCå®ç°" class="headerlink" title="Dubboæ¡†æ¶(RPCå®ç°)"></a>Dubboæ¡†æ¶(RPCå®ç°)</h6><p>â€‹ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š</p><ol><li><p>Spring Boot ä»£ç (æ³¨è§£ + ç¼–ç¨‹å¼)ï¼šå†™javaæ¥å£ï¼ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…éƒ½å»å¼•ç”¨è¿™ä¸ªæ¥å£ </p></li><li><p>IDL (æ¥å£è°ƒç”¨è¯­è¨€)ï¼šåˆ›å»ºä¸€ä¸ªå…¬å…±çš„æ¥å£å®šä¹‰æ–‡ä»¶ï¼ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œä¼˜ç‚¹æ˜¯è·¨è¯­è¨€ã€æ‰€æœ‰çš„æ¡†æ¶éƒ½è®¤è¯†</p></li></ol><p>åº•å±‚æ˜¯Tripleåè®®</p><h5 id="æ•´åˆè¿ç”¨ï¼š"><a href="#æ•´åˆè¿ç”¨ï¼š" class="headerlink" title="æ•´åˆè¿ç”¨ï¼š"></a>æ•´åˆè¿ç”¨ï¼š</h5><ol><li>backendé¡¹ç›®ä½œä¸ºæœåŠ¡æä¾›è€…ï¼Œæä¾›ä¸‰ä¸ªæ–¹æ³•</li></ol><ul><li>å»æ•°æ®åº“ä¸­æŸ¥æ˜¯å¦å·²åˆ†é…ç»™ç”¨æˆ·</li><li>æŸ¥è¯¢æ•°æ®åº“ï¼Œæ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠè¯·æ±‚æ–¹æ³•æ˜¯å¦åŒ¹é…</li><li>è°ƒç”¨æˆåŠŸå è°ƒç”¨æ¬¡æ•°+1 invokeCount</li></ul><ol start="2"><li>Gatawayé¡¹ç›®ä½œä¸ºæœåŠ¡è°ƒç”¨è€…ï¼Œè°ƒç”¨è¿™ä¸‰ä¸ªæ–¹æ³•</li></ol><h4 id="7ã€å®Œå–„ç½‘å…³ã€æ¥å£è°ƒç”¨ä¿¡æ¯å¯è§†åŒ–ã€å±•æœ›â€¦â€¦"><a href="#7ã€å®Œå–„ç½‘å…³ã€æ¥å£è°ƒç”¨ä¿¡æ¯å¯è§†åŒ–ã€å±•æœ›â€¦â€¦" class="headerlink" title="7ã€å®Œå–„ç½‘å…³ã€æ¥å£è°ƒç”¨ä¿¡æ¯å¯è§†åŒ–ã€å±•æœ›â€¦â€¦"></a>7ã€å®Œå–„ç½‘å…³ã€æ¥å£è°ƒç”¨ä¿¡æ¯å¯è§†åŒ–ã€å±•æœ›â€¦â€¦</h4><ol><li>å®Œæˆç½‘å…³ä¸šåŠ¡é€»è¾‘<ul><li>å®é™…æƒ…å†µåº”è¯¥æ˜¯å»æ•°æ®åº“æŸ¥çœ‹æ˜¯å¦å·²åˆ†é…ç»™ç”¨æˆ·(akã€skæ˜¯å¦åˆæ³•)<ul><li>å…ˆæ ¹æ®accessKeyåˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼ŒæŸ¥åˆ°secretKey</li><li>å¯¹æ¯”secretKeyå’Œç”¨æˆ·ä¼ çš„åŠ å¯†åçš„secretKeyæ˜¯å¦ä¸€è‡´</li></ul></li><li>ä»æ•°æ®åº“æŸ¥è¯¢æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠè¯·æ±‚æ–¹å¼æ˜¯å¦åŒ¹é…(è¿˜å¯ä»¥æ ¡éªŒè¯·æ±‚å‚æ•°)</li><li>è°ƒç”¨æˆåŠŸåï¼Œè°ƒç”¨æ¬¡æ•°+1 ï¼ˆinvoke count</li></ul></li><li>å¼€å‘ç®¡ç†å‘˜åˆ†æçš„åŠŸèƒ½</li><li>ä¸Šçº¿</li></ol><h6 id="å¦‚ä½•è·å–æ¥å£è½¬å‘æœåŠ¡å™¨çš„åœ°å€"><a href="#å¦‚ä½•è·å–æ¥å£è½¬å‘æœåŠ¡å™¨çš„åœ°å€" class="headerlink" title="å¦‚ä½•è·å–æ¥å£è½¬å‘æœåŠ¡å™¨çš„åœ°å€"></a>å¦‚ä½•è·å–æ¥å£è½¬å‘æœåŠ¡å™¨çš„åœ°å€</h6><p>â€‹ç½‘å…³å¯åŠ¨æ—¶ï¼Œ è·å–æ‰€æœ‰çš„æ¥å£ä¿¡æ¯ï¼Œç»´æŠ¤åˆ°å†…å­˜çš„hashmapä¸­ï¼›æœ‰è¯·æ±‚æ—¶ï¼Œæ ¹æ®è¯·æ±‚çš„urlè·¯å¾„æˆ–è€…å…¶ä»–å‚æ•°[æ¯”å¦‚hostè¯·æ±‚å¤´]æ¥åˆ¤æ–­åº”è¯¥è½¬å‘åˆ°å“ªå°æœåŠ¡å™¨ï¼Œä»¥åŠç”¨äºæ ¡éªŒæ¥å£æ˜¯å¦å­˜åœ¨</p><h6 id="å…¬å…±æœåŠ¡ï¼š"><a href="#å…¬å…±æœåŠ¡ï¼š" class="headerlink" title="å…¬å…±æœåŠ¡ï¼š"></a>å…¬å…±æœåŠ¡ï¼š</h6><p>â€‹ç›®çš„æ˜¯è®©æ–¹æ³•ã€å®ä½“ç±»åœ¨å¤šä¸ªé¡¹ç›®é—´å¤ç”¨ï¼Œé‡å¤ç¼–å†™</p><pre><code>1. æ•°æ®åº“ä¸­æŸ¥è¯¢æ˜¯å¦å·²åˆ†é…ç»™ç”¨æˆ·å¯†é’¥(accessKeyï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯ï¼Œä¸ºç©ºè¡¨ç¤ºä¸å­˜åœ¨)1. ä»æ•°æ®åº“æŸ¥è¯¢æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨(è¯·æ±‚è·¯å¾„ã€è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚å‚æ•°ã€è¿”å›æ¥å£ä¿¡æ¯ï¼Œä¸ºç©ºè¡¨ç¤ºä¸å­˜åœ¨)1. è°ƒç”¨æ¬¡æ•°+1 (accessKey(æ ‡è¯†ç”¨æˆ·)ã€æ¥å£è·¯å¾„)</code></pre><p>æ­¥éª¤ï¼š</p><ol><li>æ–°å»ºå¹²å‡€çš„mavené¡¹ç›®ï¼Œåªä¿ç•™å¿…è¦çš„å…¬å…±ä¾èµ–</li><li>æŠ½å–serviceå’Œå®ä½“ç±»</li><li>installæœ¬åœ° mavenåŒ…</li><li>è®©æœåŠ¡æä¾›æ–¹å¼•å…¥commonåŒ…ï¼Œæµ‹è¯•æ˜¯å¦æ­£å¸¸è¿è¡Œ</li><li>è®©æœåŠ¡æ¶ˆè´¹æ–¹å¼•å…¥commonåŒ…</li></ol><h6 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h6><ol><li><p>æ€ä¹ˆè®©å…¶ä»–ç”¨æˆ·ä¹Ÿä¸Šä¼ æ¥å£ï¼Ÿ</p><p>éœ€è¦æä¾›ä¸€ä¸ªæœºåˆ¶(ç•Œé¢)ï¼Œè®©ç”¨æˆ·è¾“å…¥è‡ªå·±çš„æ¥å£host(æœåŠ¡å™¨åœ°å€)ã€æ¥å£ä¿¡æ¯ï¼Œå°†æ¥å£ä¿¡æ¯å†™å…¥æ•°æ®åº“ã€‚</p><p>å°†æ¥å£ä¿¡æ¯å†™å…¥æ•°æ®åº“ä¹‹å‰ï¼Œè¦å¯¹æ¥å£è¿›è¡Œæ ¡éªŒï¼Œæ¯”å¦‚æµ‹è¯•è°ƒç”¨ï¼Œä¿è¯æ¥å£æ­£å¸¸ã€‚å¹¶éµå¾ªæˆ‘ä»¬é¡¹ç›®çš„è¦æ±‚(å¹¶ä¸”ä½¿ç”¨æˆ‘ä»¬çš„sdk)</p></li><li><p>åœ¨interfaceInfoè¡¨ä¸­åŠ å…¥hostå­—æ®µï¼ŒåŒºåˆ†æœåŠ¡å™¨åœ°å€ï¼Œè®©æ¥å£æä¾›è€…æ›´çµæ´»åœ°æ¥å…¥ç³»ç»Ÿã€‚</p></li><li><p>ç½‘å…³åˆ¤æ–­æ˜¯å¦è¿˜æœ‰è°ƒç”¨æ¬¡æ•°</p></li><li><p>ç½‘å…³é™æµã€æé«˜æ€§èƒ½ç­‰ç­‰</p></li></ol><h5 id="å¼€å‘ç»Ÿè®¡åˆ†æï¼š"><a href="#å¼€å‘ç»Ÿè®¡åˆ†æï¼š" class="headerlink" title="å¼€å‘ç»Ÿè®¡åˆ†æï¼š"></a>å¼€å‘ç»Ÿè®¡åˆ†æï¼š</h5><p>æä¾›å¯è§†åŒ–å¹³å°ï¼Œç”¨å›¾è¡¨çš„æ–¹å¼å±•ç¤ºæ‰€æœ‰çš„è°ƒç”¨æƒ…å†µï¼Œä¾¿äºè°ƒæ•´ä¸šåŠ¡</p><h6 id="éœ€æ±‚ï¼š"><a href="#éœ€æ±‚ï¼š" class="headerlink" title="éœ€æ±‚ï¼š"></a>éœ€æ±‚ï¼š</h6><p>â€‹å„æ¥å£æ€»è°ƒç”¨æ¬¡æ•°å æ¯”(é¥¼å›¾)å‰3çš„æ¥å£ï¼Œä»è€Œåˆ†æå‡ºå“ªäº›æ¥å£æ²¡äººç”¨(é™ä½èµ„æºæˆ–è€…ä¸‹çº¿)ä»¥åŠé«˜é¢‘æ¥å£(å¢åŠ èµ„æºã€æé«˜æ”¶è´¹)</p><h6 id="å®ç°ï¼š"><a href="#å®ç°ï¼š" class="headerlink" title="å®ç°ï¼š"></a>å®ç°ï¼š</h6><h6 id="å‰ç«¯ï¼š"><a href="#å‰ç«¯ï¼š" class="headerlink" title="å‰ç«¯ï¼š"></a>å‰ç«¯ï¼š</h6><p>â€‹å±•ç¤ºé¥¼å›¾â€”â€”æ¨èä½¿ç”¨çº¿ç¨‹çš„åº“</p><p>â€‹EChartsã€AntV</p><ul><li>çœ‹å®˜ç½‘</li><li>è¿›å…¥å®ä¾‹é¡µé¢</li><li>æ‰¾åˆ°æƒ³è¦çš„å›¾</li><li>åœ¨çº¿è°ƒè¯•</li><li>å¤åˆ¶ä»£ç </li><li>æ”¹ä¸ºçœŸå®æ•°æ®</li></ul><h6 id="åç«¯ï¼š"><a href="#åç«¯ï¼š" class="headerlink" title="åç«¯ï¼š"></a>åç«¯ï¼š</h6><p>â€‹1. SQLæŸ¥è¯¢è°ƒç”¨æ•°æ®</p><p>â€‹select interfaceInfoId, sum(totalNum) as totalNum from interface_info group by interfaceInfoId order by totalNum desc limit 3;</p><p>â€‹2. ä¸šåŠ¡å±‚å»å…³è”æŸ¥è¯¢æ¥å£ä¿¡æ¯</p><h6 id="ä¸Šçº¿ï¼š"><a href="#ä¸Šçº¿ï¼š" class="headerlink" title="ä¸Šçº¿ï¼š"></a>ä¸Šçº¿ï¼š</h6><p>å‰ç«¯ï¼šå‚è€ƒç”¨æˆ·ä¸­å¿ƒçš„ä¸Šçº¿æ–¹å¼</p><p>åç«¯ï¼š</p><ul><li>backendé¡¹ç›®ï¼šwebé¡¹ç›®ï¼Œéƒ¨ç½²springbootçš„jaråŒ…(å¯¹å¤–çš„)</li><li>gatewayé¡¹ç›®ï¼šwebé¡¹ç›®ï¼Œéƒ¨ç½²springbootçš„jaråŒ…(å¯¹å¤–çš„)</li><li>interface æ¨¡æ‹Ÿæ¥å£é¡¹ç›®ï¼šwebé¡¹ç›®ï¼Œéƒ¨ç½²springbootçš„jaråŒ…(ä¸å»ºè®®å¯¹å¤–æš´éœ²çš„)</li></ul><p>å¦‚æœè‡ªå·±å­¦ä¹ ç”¨ï¼šå•ä¸ªæœåŠ¡å™¨éƒ¨ç½²è¿™ä¸‰ä¸ªé¡¹ç›®è¶³å¤Ÿ</p><p>å¦‚æœæƒ³æå¤§äº‹ï¼šå¤šä¸ªæœåŠ¡å™¨å»ºè®®åœ¨åŒä¸€å†…ç½‘ï¼Œå†…ç½‘äº¤äº’ä¼šæ›´å¿«ï¼Œä¸”æ›´å®‰å…¨</p><p>è®¾è®¡åº“è¡¨ï¼š</p><p>å“ªä¸ªç”¨æˆ·ï¼Ÿå“ªä¸ªæ¥å£ï¼Ÿ</p><p>ç”¨æˆ· &lt;&#x3D;&#x3D;å¤šå¯¹å¤š&#x3D;&#x3D;&gt; æ¥å£</p><p>å› æ­¤éœ€è¦å†åˆ›å»ºä¸€ä¸ªè¡¨ï¼š</p><p>ç”¨æˆ·è°ƒç”¨æ¥å£å…³ç³»è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç”¨æˆ·è°ƒç”¨æ¥å£å…³ç³»è¡¨</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> tjyapi.`user_interface_info`</span><br><span class="line">(</span><br><span class="line">    `id` <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment comment <span class="string">&#x27;ä¸»é”®&#x27;</span> <span class="keyword">primary</span> key,</span><br><span class="line">  `userId` <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;è°ƒç”¨ç”¨æˆ·id&#x27;</span>,</span><br><span class="line">  `interfaceInfoId` <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ¥å£id&#x27;</span>,</span><br><span class="line">    `totalNum` <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ€»è°ƒç”¨æ¬¡æ•°&#x27;</span>,</span><br><span class="line">    `leftNum` <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;å‰©ä½™è°ƒç”¨æ¬¡æ•°&#x27;</span>,</span><br><span class="line">  `status` <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;0-æ­£å¸¸ 1-ç¦ç”¨&#x27;</span>,</span><br><span class="line">  `createTime` datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">    `updateTime` datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">on</span> <span class="keyword">update</span> <span class="built_in">CURRENT_TIMESTAMP</span> comment <span class="string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,</span><br><span class="line">    `isDelete` tinyint <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ˜¯å¦åˆ é™¤ 0-æœªåˆ  1-å·²åˆ ,</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">) comment &#x27;</span>ç”¨æˆ·è°ƒç”¨æ¥å£å…³ç³»è¡¨<span class="string">&#x27;;</span></span><br></pre></td></tr></table></figure><p>æ­¥éª¤ï¼š</p><pre><code>1. å¼€å‘åŸºæœ¬å¢åˆ æ”¹æŸ¥(ç»™ç®¡ç†å‘˜ç”¨)1. å¼€å‘ç”¨æˆ·è°ƒç”¨æ¥å£æ¬¡æ•°+1çš„åŠŸèƒ½(service)</code></pre><p>â€‹é—®é¢˜ï¼š</p><p>â€‹â€”â€”å¦‚æœæ¯ä¸ªæ¥å£çš„æ–¹æ³•éƒ½å†™è°ƒç”¨æ¬¡æ•°+1ï¼Œæ˜¯ä¸æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Ÿ</p><p>â€‹â€”â€”è‡´å‘½é—®é¢˜ï¼šæ¥å£å¼€å‘è€…éœ€è¦è‡ªå·±å»æ·»åŠ ç»Ÿè®¡ä»£ç </p><p>ä½¿ç”¨AOPåˆ‡é¢çš„ä¼˜ç‚¹ï¼šç‹¬ç«‹äºæ¥å£ï¼Œåœ¨æ¯ä¸ªæ¥å£è°ƒç”¨åç»Ÿè®¡æ¬¡æ•°+1</p><p>AOPåˆ‡é¢çš„ç¼ºç‚¹ï¼šå­˜åœ¨äºå•ä¸ªé¡¹ç›®ä¸­ï¼Œå¦‚æœæ¯ä¸ªå›¢é˜Ÿéƒ½è¦å¼€å‘è‡ªå·±çš„æ¥å£ï¼Œé‚£ä¹ˆéƒ½éœ€è¦å†™AOPåˆ‡é¢â€”è¿˜æ˜¯æ²¡æœ‰è§£å†³ é—®é¢˜</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230717140031212.png" alt="image-20230717140031212"></p><h3 id="ç½‘å…³ç›¸å…³çŸ¥è¯†ï¼š"><a href="#ç½‘å…³ç›¸å…³çŸ¥è¯†ï¼š" class="headerlink" title="ç½‘å…³ç›¸å…³çŸ¥è¯†ï¼š"></a>ç½‘å…³ç›¸å…³çŸ¥è¯†ï¼š</h3><p>â€‹ç½‘å…³çš„ä¼˜ç‚¹ï¼šç»Ÿä¸€è¿›è¡Œä¸€äº›æ“ä½œï¼Œå¤„ç†ä¸€äº›é—®é¢˜</p><ul><li><p>è·¯ç”±</p><ul><li><p>èµ·åˆ°è½¬å‘çš„ä½œç”¨ï¼Œæ¯”å¦‚æœ‰æ¥å£ A å’Œæ¥å£ Bï¼Œç½‘å…³ä¼šè®°å½•è¿™äº›ä¿¡æ¯ï¼Œæ ¹æ®ç”¨æˆ·è®¿é—®çš„åœ°å€å’Œå‚æ•°ï¼Œè½¬å‘è¯·æ±‚åˆ°å¯¹åº”çš„æ¥å£ï¼ˆæœåŠ¡å™¨&#x2F;é›†ç¾¤ï¼‰</p><p>&#x2F;a&#x3D;ï¼æ¥å£A</p><p>&#x2F;b&#x3D;ï¼æ¥å£B</p></li></ul></li><li><p>ç»Ÿä¸€é‰´æƒ</p><ul><li>åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡Œæ“ä½œï¼Œæ— è®ºè®¿é—®ä»€ä¹ˆæ¥å£ï¼Œéƒ½ç»Ÿä¸€å»åˆ¤æ–­ï¼Œä¸ç”¨é‡å¤å†™</li></ul></li><li><p>ç»Ÿä¸€è·¨åŸŸå¤„ç†</p><ul><li>ç½‘å…³ç»Ÿä¸€å¤„ç†è·¨åŸŸ</li></ul></li><li><p>ç¼“å­˜</p></li><li><p>æµé‡æŸ“è‰²</p><ul><li>ç»™è¯·æ±‚(æµé‡)æ·»åŠ ä¸€äº›æ ‡è¯†ï¼Œä¸€èˆ¬æ˜¯è®¾ç½®åœ¨è¯·æ±‚å¤´ä¸­ï¼Œæ·»åŠ æ–°çš„è¯·æ±‚å¤´</li></ul></li><li><p>è®¿é—®æ§åˆ¶</p><ul><li>é»‘ç™½åå•ï¼Œæ¯”å¦‚é™åˆ¶DDOS IP</li></ul></li><li><p>ç»Ÿä¸€ä¸šåŠ¡å¤„ç†</p><ul><li>æŠŠæ¯ä¸ªé¡¹ç›®ä¸­éƒ½è¦åšçš„é€šç”¨é€»è¾‘æ”¾åˆ°ä¸Šå±‚(ç½‘å…³)ï¼Œç»Ÿä¸€å¤„ç†ï¼Œæ¯”å¦‚æœ¬é¡¹ç›®çš„æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡</li></ul></li><li><p>å‘å¸ƒæ§åˆ¶</p><ul><li>ç°åº¦å‘å¸ƒï¼Œæ¯”å¦‚ä¸Šçº¿æ–°æ¥å£ï¼Œå…ˆç»™æ–°æ¥å£åˆ†é…20%æµé‡ï¼Œæ…¢æ…¢å¢åŠ ï¼Œæœ€ç»ˆæ›¿ä»£è€æ¥å£</li></ul></li><li><p>è´Ÿè½½å‡è¡¡</p><ul><li>åœ¨è·¯ç”±çš„åŸºç¡€ä¸Š</li></ul></li></ul><p>â€‹&#x2F;c&#x3D;ï¼æœåŠ¡ A &#x2F; é›†ç¾¤Aï¼ˆéšæœºè½¬å‘åˆ°å…¶ä¸­çš„æŸä¸€ä¸ªæœºå™¨ï¼‰</p><ul><li>ç»Ÿä¸€æ¥å£ä¿æŠ¤<ul><li>é™åˆ¶è¯·æ±‚</li><li>ä¿¡æ¯è„±æ•</li><li>é™çº§(ç†”æ–­)</li><li>é™æµ</li><li>è¶…æ—¶æ—¶é—´</li></ul></li><li>ç»Ÿä¸€æ—¥å¿—<ul><li>ç»Ÿä¸€çš„è¯·æ±‚ã€å“åº”ä¿¡æ¯è®°å½•</li></ul></li><li>ç»Ÿä¸€æ–‡æ¡£<ul><li>å°†ä¸‹æ¸¸é¡¹ç›®çš„æ–‡æ¡£è¿›è¡Œèšåˆï¼Œåœ¨ä¸€ä¸ªé¡µé¢ç»Ÿä¸€æŸ¥çœ‹</li></ul></li></ul><h4 id="ç½‘å…³çš„åˆ†ç±»"><a href="#ç½‘å…³çš„åˆ†ç±»" class="headerlink" title="ç½‘å…³çš„åˆ†ç±»"></a>ç½‘å…³çš„åˆ†ç±»</h4><ol><li>å…¨å±€ç½‘å…³(æ¥å…¥å±‚ç½‘å…³)ï¼šä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡ã€è¯·æ±‚æ—¥å¿—ç­‰ï¼Œä¸å’Œä¸šåŠ¡é€»è¾‘ç»‘å®š</li><li>ä¸šåŠ¡ç½‘å…³(å¾®æœåŠ¡ç½‘å…³)ï¼šä¼šæœ‰ä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼Œä½œç”¨æ˜¯å°†è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„ä¸šåŠ¡&#x2F;é¡¹ç›®&#x2F;æ¥å£&#x2F;æœåŠ¡</li></ol><h4 id="å®ç°ï¼š-1"><a href="#å®ç°ï¼š-1" class="headerlink" title="å®ç°ï¼š"></a>å®ç°ï¼š</h4><ol><li><p>Nginx( å…¨å±€ç½‘å…³ )ã€Kongç½‘å…³( APIç½‘å…³ Kong: <a href="https://github.com/Kong/kong">https://github.com/Kong/kong</a> )ï¼Œç¼–ç¨‹æˆæœ¬é«˜</p></li><li><p>Spring Cloud Gateway (å–ä»£äº† Zuul) æ€§èƒ½é«˜ï¼Œå¯ä»¥ç”¨Javaä»£ç æ¥å†™é€»è¾‘ï¼Œæ˜“äºå­¦ä¹ </p></li></ol><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/qq_21040559/article/details/122961395">https://blog.csdn.net/qq_21040559/article/details/122961395</a></p><p>ç½‘å…³æŠ€æœ¯é€‰å‹ï¼š<a href="https://zhuanlan.zhihu.com/p/500587132">https://zhuanlan.zhihu.com/p/500587132</a></p><h4 id="Spring-Cloud-Gatewayç”¨æ³•"><a href="#Spring-Cloud-Gatewayç”¨æ³•" class="headerlink" title="Spring Cloud Gatewayç”¨æ³•"></a>Spring Cloud Gatewayç”¨æ³•</h4><p>å®˜ç½‘ï¼š<a href="https://spring.io/projects/spring-cloud-gateway">https://spring.io/projects/spring-cloud-gateway</a></p><h5 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h5><p>è·¯ç”±ï¼šæ ¹æ®ä»€ä¹ˆæ¡ä»¶ï¼Œè½¬å‘è¯·æ±‚åˆ°å“ªé‡Œ</p><p>æ–­è¨€ï¼šä¸€ç»„è§„åˆ™ã€æ¡ä»¶ï¼Œç”¨æ¥ç¡®å®šå¦‚ä½•è½¬å‘è·¯ç”±</p><p>è¿‡æ»¤å™¨ï¼šå¯¹è¯·æ±‚è¿›è¡Œä¸€ç³»åˆ—å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´ã€æ·»åŠ è¯·æ±‚å‚æ•°</p><h5 id="è¯·æ±‚æµç¨‹ï¼š"><a href="#è¯·æ±‚æµç¨‹ï¼š" class="headerlink" title="è¯·æ±‚æµç¨‹ï¼š"></a>è¯·æ±‚æµç¨‹ï¼š</h5><ol><li>å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚</li><li>Handler Mappingï¼šæ ¹æ®æ–­è¨€ï¼Œå»å°†è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„è·¯ç”±</li><li>Web Handlerï¼šå¤„ç†è¯·æ±‚(ä¸€å±‚å±‚ç»è¿‡è¿‡æ»¤å™¨)</li><li>å®é™…è°ƒç”¨æœåŠ¡</li></ol><h5 id="ä¸¤ç§é…ç½®æ–¹å¼ï¼š"><a href="#ä¸¤ç§é…ç½®æ–¹å¼ï¼š" class="headerlink" title="ä¸¤ç§é…ç½®æ–¹å¼ï¼š"></a>ä¸¤ç§é…ç½®æ–¹å¼ï¼š</h5><ol><li>é…ç½®å¼(application.yamlä¸­é…ç½®) æ–¹ä¾¿ã€è§„èŒƒ</li><li>ç¼–ç¨‹å¼     ç›¸å¯¹éº»çƒ¦ã€çµæ´»</li></ol><h5 id="æ–­è¨€ï¼š-ä¸€äº›æ¡ä»¶"><a href="#æ–­è¨€ï¼š-ä¸€äº›æ¡ä»¶" class="headerlink" title="æ–­è¨€ï¼š(ä¸€äº›æ¡ä»¶)"></a>æ–­è¨€ï¼š(ä¸€äº›æ¡ä»¶)</h5><ol><li>afterï¼šåœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å</li><li>beforeâ€¦â€¦</li></ol><p>â€¦â€¦ç­‰ç­‰å¤šç§å› ç´ éƒ½èƒ½æ”¾è¿›æ¥è€ƒè™‘</p><p>å»ºè®®å¼€å¯æ—¥å¿—â€”â€”æ–¹ä¾¿å‘ç°é—®é¢˜ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">org:</span></span><br><span class="line">      <span class="attr">springframework:</span></span><br><span class="line">        <span class="attr">cloud:</span></span><br><span class="line">          <span class="attr">gateway:</span> <span class="string">trace</span></span><br></pre></td></tr></table></figure><h5 id="è¿‡æ»¤å™¨ï¼š"><a href="#è¿‡æ»¤å™¨ï¼š" class="headerlink" title="è¿‡æ»¤å™¨ï¼š"></a>è¿‡æ»¤å™¨ï¼š</h5><p>åŸºæœ¬(å¯¹è¯·æ±‚å¤´ã€å“åº”å¤´è¿›è¡Œå¢åˆ æ”¹æŸ¥)</p><p>â€‹åœ¨æŸè®¾å®šè·¯ç”±ä¸‹ï¼Œåšè‡ªå®šä¹‰çš„äº‹(å¦‚æ·»åŠ è¯·æ±‚å¤´ã€æ·»åŠ è¯·æ±‚ä½“å‚æ•°ç­‰ç­‰ç­‰ç­‰)</p><p>â€‹æˆ–è€… è®¿é—®æŸè·¯ç”±å¦‚æœå¤±è´¥ï¼Œä¼šè½¬è€Œè®¿é—®å¦ä¸€ä¸ªè®¾å®šçš„è·¯ç”±(é™çº§)</p><h4 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><ol><li>ç®¡ç†å‘˜å¯ä»¥å¯¹æ¥å£ä¿¡æ¯è¿›è¡Œå¢åˆ æ”¹æŸ¥</li><li>ç”¨æˆ·å¯ä»¥è®¿é—®å‰å°ï¼ŒæŸ¥çœ‹æ¥å£ä¿¡æ¯</li></ol><h3 id="æ•°æ®åº“è¡¨è®¾è®¡"><a href="#æ•°æ®åº“è¡¨è®¾è®¡" class="headerlink" title="æ•°æ®åº“è¡¨è®¾è®¡"></a>æ•°æ®åº“è¡¨è®¾è®¡</h3><h4 id="æ¥å£ä¿¡æ¯è¡¨"><a href="#æ¥å£ä¿¡æ¯è¡¨" class="headerlink" title="æ¥å£ä¿¡æ¯è¡¨"></a>æ¥å£ä¿¡æ¯è¡¨</h4><p>id</p><p>name æ¥å£åç§°</p><p>description  æè¿°</p><p>url æ¥å£åœ°å€</p><p>typeè¯·æ±‚ç±»å‹</p><p>requestHeaderè¯·æ±‚å¤´</p><p>responseHeader  å“åº”å¤´</p><p>status æ¥å£çŠ¶æ€ 0-å…³é—­ 1-å¼€å¯</p><p>isDelete</p><p>createTime</p><p>updateTime</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">use tjyapi;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ¥å£ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> tjyapi.`interface_info`</span><br><span class="line">(</span><br><span class="line">    `id` <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment comment <span class="string">&#x27;ä¸»é”®&#x27;</span> <span class="keyword">primary</span> key,</span><br><span class="line">    `name` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ¥å£åç§°&#x27;</span>,</span><br><span class="line">    `description` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">null</span> comment <span class="string">&#x27;æè¿°&#x27;</span>,</span><br><span class="line">    `url` <span class="type">varchar</span>(<span class="number">512</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ¥å£åœ°å€&#x27;</span>,</span><br><span class="line">    `requestHeader` text <span class="keyword">null</span> comment <span class="string">&#x27;è¯·æ±‚å¤´&#x27;</span>,</span><br><span class="line">    `responseHeader` text <span class="keyword">null</span> comment <span class="string">&#x27;å“åº”å¤´&#x27;</span>,</span><br><span class="line">    `status` <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ¥å£çŠ¶æ€ 0-å…³é—­ 1-å¼€å¯&#x27;</span>,</span><br><span class="line">    `<span class="keyword">method</span>` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ¥å£ç±»å‹&#x27;</span>,</span><br><span class="line">    `userId` <span class="type">bigint</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;åˆ›å»ºäºº&#x27;</span>,</span><br><span class="line">    `createTime` datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">    `updateTime` datetime <span class="keyword">default</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">on</span> <span class="keyword">update</span> <span class="built_in">CURRENT_TIMESTAMP</span> comment <span class="string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,</span><br><span class="line">    `isDelete` tinyint <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;æ˜¯å¦åˆ é™¤ 1-å·²åˆ &#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;æ¥å£ä¿¡æ¯&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;å”æœ&#x27;</span>, <span class="string">&#x27;æ±Ÿèƒ¤ç¥¥&#x27;</span>, <span class="string">&#x27;www.hui-russel.net&#x27;</span>, <span class="string">&#x27;7IE&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;å§œçƒ¨ç£Š&#x27;</span>, <span class="number">7</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;èŒƒæµ©&#x27;</span>, <span class="string">&#x27;å´”æŒ¯å®¶&#x27;</span>, <span class="string">&#x27;www.peter-schmeler.info&#x27;</span>, <span class="string">&#x27;Pj0&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;é»„é’°è½©&#x27;</span>, <span class="number">12857921</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;å”èˆª&#x27;</span>, <span class="string">&#x27;å­”å¥é›„&#x27;</span>, <span class="string">&#x27;www.tanner-bednar.name&#x27;</span>, <span class="string">&#x27;Hi9QM&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;å®‹æ˜Šç„¶&#x27;</span>, <span class="number">18787</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;è¢å­é»˜&#x27;</span>, <span class="string">&#x27;çŸ³æ˜æ°&#x27;</span>, <span class="string">&#x27;www.mitsuko-zboncak.net&#x27;</span>, <span class="string">&#x27;4q&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;å‘¨æ¶›&#x27;</span>, <span class="number">954194648</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;æœ±åšæ¶›&#x27;</span>, <span class="string">&#x27;ç§¦æ˜Šç„±&#x27;</span>, <span class="string">&#x27;www.rey-ondricka.biz&#x27;</span>, <span class="string">&#x27;GhO&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;ç‹ç‘¾ç‘œ&#x27;</span>, <span class="number">43144</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;é™†ç»é½&#x27;</span>, <span class="string">&#x27;æ›¹é¸¿æ¶›&#x27;</span>, <span class="string">&#x27;www.cathleen-gusikowski.org&#x27;</span>, <span class="string">&#x27;pP0Z&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;å°¹ä¹é©¹&#x27;</span>, <span class="number">23494</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;å°¹æ€èª&#x27;</span>, <span class="string">&#x27;è´ºé’°è½©&#x27;</span>, <span class="string">&#x27;www.jeni-bartell.co&#x27;</span>, <span class="string">&#x27;ZZdsp&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;å†¯æœ&#x27;</span>, <span class="number">25646340</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;å´”é’°è½©&#x27;</span>, <span class="string">&#x27;å†¯ç† å½¤&#x27;</span>, <span class="string">&#x27;www.timothy-legros.org&#x27;</span>, <span class="string">&#x27;Qr&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;é¾™ä¹é©¹&#x27;</span>, <span class="number">275486388</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;é©¬å­éª&#x27;</span>, <span class="string">&#x27;é‚¹æ™‹é¹&#x27;</span>, <span class="string">&#x27;www.tori-wisoky.io&#x27;</span>, <span class="string">&#x27;cwVv&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;ç†Šä¿Šé©°&#x27;</span>, <span class="number">9055718270</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;æå˜‰æ‡¿&#x27;</span>, <span class="string">&#x27;æ¯›å¼˜æ–‡&#x27;</span>, <span class="string">&#x27;www.tawna-murazik.info&#x27;</span>, <span class="string">&#x27;d8H&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;é’Ÿé–çª&#x27;</span>, <span class="number">596652</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;é¾šç»é½&#x27;</span>, <span class="string">&#x27;å´”ä¼Ÿç¥º&#x27;</span>, <span class="string">&#x27;www.bart-dare.biz&#x27;</span>, <span class="string">&#x27;VM&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;é™†ä¹é©¹&#x27;</span>, <span class="number">720475</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;ä¸¥ç† å½¤&#x27;</span>, <span class="string">&#x27;è®¸ç‚«æ˜&#x27;</span>, <span class="string">&#x27;www.lane-schoen.com&#x27;</span>, <span class="string">&#x27;pc05M&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;ä½™å¥é›„&#x27;</span>, <span class="number">481356844</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;é‚µå‡¯ç‘&#x27;</span>, <span class="string">&#x27;éƒ­æ™ºæ¸Š&#x27;</span>, <span class="string">&#x27;www.von-rempel.org&#x27;</span>, <span class="string">&#x27;FSiqa&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;é¾™åšè¶…&#x27;</span>, <span class="number">1368599</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;èµ–æœ&#x27;</span>, <span class="string">&#x27;æ¨å¤©å®‡&#x27;</span>, <span class="string">&#x27;www.kourtney-lubowitz.name&#x27;</span>, <span class="string">&#x27;3C&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;éŸ©ä¿®æ°&#x27;</span>, <span class="number">6026675</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;æ®µæµ©å®‡&#x27;</span>, <span class="string">&#x27;éŸ©é¸¿æ¶›&#x27;</span>, <span class="string">&#x27;www.rupert-schmeler.co&#x27;</span>, <span class="string">&#x27;mMo&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;é­è¿œèˆª&#x27;</span>, <span class="number">76</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;æ²ˆç‚å½¬&#x27;</span>, <span class="string">&#x27;å¼ æ˜Šå¤©&#x27;</span>, <span class="string">&#x27;www.sheri-kerluke.co&#x27;</span>, <span class="string">&#x27;adMn1&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;è–›æ˜&#x27;</span>, <span class="number">3551</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;é«˜é»æ˜•&#x27;</span>, <span class="string">&#x27;è°¢å¿—æ³½&#x27;</span>, <span class="string">&#x27;www.sterling-adams.org&#x27;</span>, <span class="string">&#x27;baP&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;é‡‘æ˜å“²&#x27;</span>, <span class="number">91</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;èƒ¡è¯­å ‚&#x27;</span>, <span class="string">&#x27;è¦ƒæµ©ç„¶&#x27;</span>, <span class="string">&#x27;www.khalilah-breitenberg.biz&#x27;</span>, <span class="string">&#x27;gDtv&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;é›·ç¿æ¸Š&#x27;</span>, <span class="number">21221843</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;é™†é›¨æ³½&#x27;</span>, <span class="string">&#x27;æ›¾é›ªæ¾&#x27;</span>, <span class="string">&#x27;www.jonas-fritsch.co&#x27;</span>, <span class="string">&#x27;XvfU&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;ä¾¯æ™ºæ¸Š&#x27;</span>, <span class="number">472525914</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tjyapi.`interface_info` (`name`, `description`, `url`, `responseHeader`, `status`, `<span class="keyword">method</span>`, `userId`, `isDelete`) <span class="keyword">values</span> (<span class="string">&#x27;é‚“æ˜Šç„±&#x27;</span>, <span class="string">&#x27;ç§¦èƒ¤ç¥¥&#x27;</span>, <span class="string">&#x27;www.aron-buckridge.com&#x27;</span>, <span class="string">&#x27;fBh3&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;ä¸å­é»˜&#x27;</span>, <span class="number">12000</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><h3 id="å‰ç«¯é¡¹ç›®è„šæ‰‹æ¶ï¼š"><a href="#å‰ç«¯é¡¹ç›®è„šæ‰‹æ¶ï¼š" class="headerlink" title="å‰ç«¯é¡¹ç›®è„šæ‰‹æ¶ï¼š"></a>å‰ç«¯é¡¹ç›®è„šæ‰‹æ¶ï¼š</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. åœ¨ç»ˆç«¯è¿è¡Œ</span><br><span class="line">npm i @ant-design/pro-cli -g</span><br><span class="line">2. è¿›å…¥ä½ æ”¾çš„ç›®å½•çš„ç»ˆç«¯ï¼Œè‡ªåŠ¨åˆ›å»ºé¡¹ç›®</span><br><span class="line">pro create é¡¹ç›®åç§°</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç‰ˆæœ¬ä¿¡æ¯ï¼š</span><br><span class="line">donn@Macc ~ % node -v</span><br><span class="line">v16.13.0</span><br><span class="line">donn@Macc ~ % npm -v       </span><br><span class="line">8.1.0</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ç©ºé¡¹ç›®ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711212835653.png" alt="image-20230711212835653"></p><p>å‰ç«¯ï¼šant design pro è„šæ‰‹æ¶</p><p>åç«¯ï¼šç›´æ¥ä½¿ç”¨æ¨¡æ¿ springboot-init</p><h4 id="åŸºç¡€åŠŸèƒ½"><a href="#åŸºç¡€åŠŸèƒ½" class="headerlink" title="åŸºç¡€åŠŸèƒ½"></a>åŸºç¡€åŠŸèƒ½</h4><p>å¢åˆ æ”¹æŸ¥ã€ç™»å½•(å¤åˆ¶ç²˜è´´)</p><p>å‰ç«¯æ¥å£è°ƒç”¨ï¼šopenapiæ’ä»¶è‡ªåŠ¨ç”Ÿæˆ</p><p>openapiè§„èŒƒ</p><h4 id="æ¨¡æ‹Ÿæ¥å£é¡¹ç›®-tjyapi-interface"><a href="#æ¨¡æ‹Ÿæ¥å£é¡¹ç›®-tjyapi-interface" class="headerlink" title="æ¨¡æ‹Ÿæ¥å£é¡¹ç›® tjyapi-interface"></a>æ¨¡æ‹Ÿæ¥å£é¡¹ç›® tjyapi-interface</h4><p>æä¾›ä¸‰ä¸ªæ¨¡æ‹Ÿæ¥å£</p><ol><li>GETæ¥å£</li><li>POSTæ¥å£(urlä¼ å‚)</li><li>POSTæ¥å£(Restful)</li></ol><h4 id="è°ƒç”¨æ¥å£"><a href="#è°ƒç”¨æ¥å£" class="headerlink" title="è°ƒç”¨æ¥å£"></a>è°ƒç”¨æ¥å£</h4><p>å‡ ç§ HTTP è°ƒç”¨æ–¹å¼ï¼š</p><ol><li><p>HttpClient</p></li><li><p>RestTemplate</p></li><li><p>ç¬¬ä¸‰æ–¹åº“(OKHTTPã€Hutool)</p></li></ol><p>Hutoolï¼š<a href="https://www.hutool.cn/">https://www.hutool.cn</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://doc.hutool.cn/pages/HttpUtil/#%E6%A6%82%E8%BF%B0">https://doc.hutool.cn/pages/HttpUtil/#æ¦‚è¿°</a></p><h3 id="APIç­¾åè®¤è¯"><a href="#APIç­¾åè®¤è¯" class="headerlink" title="APIç­¾åè®¤è¯"></a>APIç­¾åè®¤è¯</h3><h5 id="æœ¬è´¨ï¼š"><a href="#æœ¬è´¨ï¼š" class="headerlink" title="æœ¬è´¨ï¼š"></a>æœ¬è´¨ï¼š</h5><pre><code>1. ç­¾å‘ç­¾å1. ä½¿ç”¨ç­¾å(æ ¡éªŒç­¾å)</code></pre><h5 id="ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</h5><ol><li>ä¿è¯å®‰å…¨æ€§ï¼Œä¸èƒ½éšä¾¿æ¥ä¸€ä¸ªäººéƒ½èƒ½è°ƒç”¨</li></ol><h5 id="æ€ä¹ˆå®ç°ï¼Ÿ"><a href="#æ€ä¹ˆå®ç°ï¼Ÿ" class="headerlink" title="æ€ä¹ˆå®ç°ï¼Ÿ"></a>æ€ä¹ˆå®ç°ï¼Ÿ</h5><p>é€šè¿‡http request headerå¤´ ä¼ é€’å‚æ•°</p><p><strong>å‚æ•°1:</strong> accessKeyï¼šè°ƒç”¨çš„æ ‡è¯† userAã€userB(å¤æ‚ã€æ— åºã€æ— è§„å¾‹)</p><p><strong>å‚æ•°2:</strong> secretKeyï¼š å¯†é’¥â€”â€”â€“<strong>è¯¥å‚æ•°ä¸ä¼ é€’åˆ°è¯·æ±‚å¤´ä¸­ï¼Œé€šè¿‡ç§ä¸‹çº¦å®šè¿›è¡ŒåŒæ­¥</strong></p><p>å¯ä»¥æš‚æ—¶ç†è§£ä¸ºç”¨æˆ·åå’Œå¯†ç ï¼ŒåŒºåˆ«ä¸ºï¼šakã€skæ˜¯æ— çŠ¶æ€çš„ï¼›ä½ æ¯æ¬¡è®¿é—®éƒ½éœ€æºå¸¦æ­£ç¡®çš„akã€skæ‰èƒ½è®¿é—®</p><p>è‡ªè¡Œç¼–å†™ä»£ç ç»™æ¯ä¸ªç”¨æˆ·ç”Ÿæˆakã€sk</p><p>åƒä¸‡ä¸èƒ½æŠŠå¯†é’¥ç›´æ¥åœ¨æœåŠ¡å™¨ä¹‹é—´ä¼ é€’ï¼Œå› ä¸ºæœ‰å¯èƒ½è¢«æ‹¦æˆª</p><p>(æ‰€ä»¥è¦å¯¹å¯†ç è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†)</p><p><strong>å‚æ•°3:</strong> ç”¨æˆ·è¯·æ±‚å‚æ•°</p><p><strong>å‚æ•°4:</strong> sign å‚æ•°</p><p>åŠ å¯†æ–¹å¼ï¼šå¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€md5ç­¾å</p><p>ç”¨æˆ·å‚æ•°ï¼šabc + å¯†é’¥ &#x3D;&gt; ç­¾åç”Ÿæˆç®—æ³• &#x3D;&gt; ä¸å¯è§£å¯†çš„å€¼</p><p>abc + miyao &#x3D;&gt; dnasufbnusfuisdafiuadbfouiadbfuiasdbofibdaiksfbefewdf</p><p><strong>æœåŠ¡ç«¯ç”¨ä¸€æ ·çš„æ–¹å¼ç”Ÿæˆç­¾åï¼Œåªè¦ç»“æœå’Œç”¨æˆ·ä¼ æ¥çš„ä¸€è‡´ï¼Œå°±è¡¨ç¤ºä¸€è‡´</strong> </p><p>æ€ä¹ˆé˜²é‡æ”¾ï¼Ÿ</p><p><strong>å‚æ•°5:</strong> æ¯æ¬¡è¯·æ±‚æ—¶éƒ½ + nonceéšæœºæ•°ï¼Œåªèƒ½ç”¨ä¸€æ¬¡</p><p>æœåŠ¡ç«¯è¦ä¿å­˜ç”¨è¿‡çš„éšæœºæ•°</p><p><strong>å‚æ•°6:</strong> åŠ timestampæ—¶é—´æˆ³ï¼Œæ ¡éªŒæ—¶é—´æˆ³æ˜¯å¦è¿‡æœŸ</p><p><strong>APIç­¾åè®¤è¯æ˜¯ä¸€ä¸ªå¾ˆçµæ´»çš„è®¾è®¡ï¼Œå…·ä½“æœ‰å“ªäº›å‚æ•°ï¼Œå‚æ•°åå¦‚ä½• ä¸€å®šè¦æ ¹æ®å…·ä½“åœºæ™¯æ¥ï¼Œ(æ¯”å¦‚userIdã€appIdã€versionã€å›ºå®šå€¼ç­‰ç­‰)</strong></p><p>æ€è€ƒï¼šå¼€å‘è€…æ¯æ¬¡è°ƒç”¨æ¥å£éƒ½è¦è‡ªå·±å†™ç­¾åç®—æ³•ï¼Ÿ</p><h3 id="â€”â€”å¼€å‘ä¸€ä¸ªç®€å•æ˜“ç”¨çš„SDK"><a href="#â€”â€”å¼€å‘ä¸€ä¸ªç®€å•æ˜“ç”¨çš„SDK" class="headerlink" title="â€”â€”å¼€å‘ä¸€ä¸ªç®€å•æ˜“ç”¨çš„SDK"></a>â€”â€”å¼€å‘ä¸€ä¸ªç®€å•æ˜“ç”¨çš„SDK</h3><p>ç†æƒ³æƒ…å†µï¼šå¼€å‘è€…åªéœ€è¦å…³å¿ƒè°ƒç”¨å“ªäº›æ¥å£ã€ä¼ é€’å“ªäº›å‚æ•°ï¼Œå°±è·Ÿè°ƒç”¨è‡ªå·±å†™çš„ä»£ç ä¸€æ ·ç®€å•ã€‚</p><p>â€”â€”å¼€å‘ä¸€ä¸ªstarterçš„å¥½å¤„ï¼š</p><p>å¼€å‘è€…å¼•å…¥åï¼Œå¯ä»¥ç›´æ¥åœ¨application.yamlä¸­å†™é…ç½®ï¼Œè‡ªåŠ¨åˆ›å»ºå®¢æˆ·ç«¯</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230715142059798.png" alt="image-20230715142059798"></p><p>spring-boot-configuration-processorçš„ä½œç”¨æ˜¯è‡ªåŠ¨ç”Ÿæˆé…ç½®çš„ä»£ç æç¤º</p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›®å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaWeb</title>
      <link href="/2023/07/04/JavaWeb/"/>
      <url>/2023/07/04/JavaWeb/</url>
      
        <content type="html"><![CDATA[<p> æœ¬åšå®¢å‚ç…§äº†éŸ©é¡ºå¹³è€å¸ˆçš„ JavaWeb è¯¾ç¨‹è®²ä¹‰ï¼</p><h1 id="7-Tomcat"><a href="#7-Tomcat" class="headerlink" title="7 Tomcat"></a>7 Tomcat</h1><h2 id="7-1-å®˜æ–¹æ–‡æ¡£"><a href="#7-1-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="7.1 å®˜æ–¹æ–‡æ¡£"></a>7.1 å®˜æ–¹æ–‡æ¡£</h2><h3 id="7-1-1-åœ°å€-https-tomcat-apache-org-tomcat-8-0-doc"><a href="#7-1-1-åœ°å€-https-tomcat-apache-org-tomcat-8-0-doc" class="headerlink" title="7.1.1 åœ°å€: https://tomcat.apache.org/tomcat-8.0-doc/"></a>7.1.1 åœ°å€: <a href="https://tomcat.apache.org/tomcat-8.0-doc/">https://tomcat.apache.org/tomcat-8.0-doc/</a></h3><h2 id="7-2-WEBå¼€å‘ä»‹ç»"><a href="#7-2-WEBå¼€å‘ä»‹ç»" class="headerlink" title="7.2 WEBå¼€å‘ä»‹ç»"></a>7.2 WEBå¼€å‘ä»‹ç»</h2><ol><li><p>WEBï¼Œåœ¨è‹±è¯­ä¸­ web è¡¨ç¤ºç½‘&#x2F;ç½‘ç»œèµ„æº(é¡µé¢, å›¾ç‰‡, css, js)æ„æ€ï¼Œå®ƒç”¨äºè¡¨ç¤º WEB æœåŠ¡å™¨(ä¸»æœº)ä¾›æµè§ˆå™¨è®¿é—®çš„èµ„æº</p></li><li><p>WEB æœåŠ¡å™¨(ä¸»æœº)ä¸Šä¾›å¤–ç•Œè®¿é—®çš„ web èµ„æºåˆ†ä¸ºï¼š</p></li></ol><ul><li>é™æ€webèµ„æºï¼ˆå¦‚ html é¡µé¢ï¼‰ï¼šæŒ‡webé¡µé¢ä¸­ä¾›äººä»¬æµè§ˆçš„æ•°æ®å§‹ç»ˆæ˜¯ä¸å˜ã€‚</li><li>åŠ¨æ€webèµ„æºï¼Œæ¯”å¦‚ Servlet(java)ã€PHP ç­‰</li></ul><ol start="3"><li>é™æ€web èµ„æºå¼€å‘æŠ€æœ¯</li></ol><ul><li>Htmlã€CSSã€js ç­‰</li></ul><ol start="4"><li>å¸¸ç”¨åŠ¨æ€web èµ„æºå¼€å‘æŠ€æœ¯ï¼š</li></ol><ul><li>Servletã€SpringBootã€SpringvVCã€ PHPã€ASP.NET ç­‰</li></ul><h2 id="7-3-JavaWebå¼€å‘æŠ€æœ¯æ ˆå›¾"><a href="#7-3-JavaWebå¼€å‘æŠ€æœ¯æ ˆå›¾" class="headerlink" title="7.3 JavaWebå¼€å‘æŠ€æœ¯æ ˆå›¾"></a>7.3 JavaWebå¼€å‘æŠ€æœ¯æ ˆå›¾</h2><p>-ä¸€å›¾èƒœåƒè¨€</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230704161447451.png" alt="image-20230704161447451"></p><h2 id="7-4-BS-ä¸-CS-å¼€å‘ä»‹ç»"><a href="#7-4-BS-ä¸-CS-å¼€å‘ä»‹ç»" class="headerlink" title="7.4 BS ä¸ CS å¼€å‘ä»‹ç»"></a>7.4 BS ä¸ CS å¼€å‘ä»‹ç»</h2><h3 id="7-4-1-BSå¼€å‘"><a href="#7-4-1-BSå¼€å‘" class="headerlink" title="7.4.1 BSå¼€å‘"></a>7.4.1 BSå¼€å‘</h3><p><strong>B</strong>: browser(æµè§ˆå™¨,ç§ç±»å¤ªå¤š ff, chrome, ie, edge) </p><p><strong>S</strong>: Server(æœåŠ¡ç«¯,è€ƒè™‘å¾ˆå¤š)<br><strong>ç¤ºæ„å›¾:</strong></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230704162955992.png" alt="image-20230704162955992" style="zoom:30%;" /><p>å¯¹BSçš„è§£è¯»:</p><ol><li><p>å…¼å®¹æ€§ï¼Œå› ä¸ºæµè§ˆå™¨çš„ç§ç±»å¾ˆå¤šï¼Œå‘ç°ä½ å·çš„ç¨‹åºï¼Œåœ¨æŸä¸ªæµè§ˆå™¨ä¼šå‡ºè§‚é—®é¢˜ï¼Œå…¶å®ƒæµè§ˆå™¨æ­£å¸¸</p></li><li><p>å®‰å…¨æ€§ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼ŒBs å®‰å…¨æ€§ä¸å¦‚ CS å¥½æ§åˆ¶</p></li><li><p>æ˜“ç”¨æ€§ï¼ŒBS å¥½äºCSï¼Œæµè§ˆå™¨å¯ç›´æ¥ä¸‹è½½</p></li><li><p>æ‰©å±•æ€§ï¼ŒBSç›¸å¯¹ç»Ÿä¸€ï¼Œåªéœ€è¦å†™ Server</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230704163213955.png" alt="image-20230704163213955"></p><h3 id="7-4-2-CSå¼€å‘"><a href="#7-4-2-CSå¼€å‘" class="headerlink" title="7.4.2 CSå¼€å‘"></a>7.4.2 CSå¼€å‘</h3><p><strong>C</strong>: Client(å®¢æˆ·ç«¯) </p><p><strong>S</strong>: Server(æœåŠ¡ç«¯) </p><p><strong>ç¤ºæ„å›¾:</strong></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230704163427794.png" alt="image-20230704163427794" style="zoom:30%;" /><h2 id="7-5-JavaWebæœåŠ¡è½¯ä»¶"><a href="#7-5-JavaWebæœåŠ¡è½¯ä»¶" class="headerlink" title="7.5 JavaWebæœåŠ¡è½¯ä»¶"></a>7.5 JavaWebæœåŠ¡è½¯ä»¶</h2><h3 id="7-5-1-JavaWebæœåŠ¡å™¨è½¯ä»¶ä»‹ç»"><a href="#7-5-1-JavaWebæœåŠ¡å™¨è½¯ä»¶ä»‹ç»" class="headerlink" title="7.5.1 JavaWebæœåŠ¡å™¨è½¯ä»¶ä»‹ç»"></a>7.5.1 JavaWebæœåŠ¡å™¨è½¯ä»¶ä»‹ç»</h3><p>1.å­¦ä¹ Javaweb å¼€å‘ï¼Œéœ€è¦å…ˆå®‰è£… JavaWeb æœåŠ¡è½¯ä»¶ã€æˆ‘ä»¬æŠŠå®‰è£…äº† Javaweb æœåŠ¡è½¯ä»¶ä¸»æœºç§°ä¸º webæœåŠ¡å™¨&#x2F;Javaweb æœåŠ¡å™¨ã€‘ï¼Œç„¶ååœ¨web æœåŠ¡å™¨ä¸­å¼€å‘ç›¸åº”çš„ web èµ„æºã€‚[ Javaweb æœåŠ¡å™¨ï¼ŒMysqlæœåŠ¡å™¨]</p><p>2.è€éŸ©æé—®ï¼šå­¦ä¹ Javaweb å¼€å‘ï¼Œä¸ºä»€ä¹ˆå¿…é¡»è¦å…ˆè£… WEB æœåŠ¡è½¯ä»¶ï¼Ÿ</p><p>ç­”ï¼šéœ€è¦å®‰è£…ï¼Œç†è§£ Tomcat æœ¬è´¨å°±æ˜¯ä¸€ä¸ªJava ç¨‹åºï¼Œä½†æ˜¯è¿™ä¸ª Java ç¨‹åºå¯ä»¥å¤„ç†æ¥è‡ªæµè§ˆå™¨çš„ HTTP è¯·æ±‚ï¼Œå’Œæˆ‘ä»¬å‰é¢è®²çš„ java ç½‘ç»œæœåŠ¡ï¼ˆå¤šäººèŠå¤©,Server)</p><h3 id="7-5-2-æ‰‹å†™ç®€å•-Web-æœåŠ¡ç¨‹åº"><a href="#7-5-2-æ‰‹å†™ç®€å•-Web-æœåŠ¡ç¨‹åº" class="headerlink" title="7.5.2 æ‰‹å†™ç®€å• Web æœåŠ¡ç¨‹åº"></a>7.5.2 æ‰‹å†™ç®€å• <strong>Web</strong> æœåŠ¡ç¨‹åº</h3><p><strong>1.</strong> éœ€æ±‚**:** æ‰‹å†™ <strong>MyWebServer.java ,</strong> è®©å¤§å®¶ä½“éªŒä¸€ä¸‹ <strong>JavaWeb</strong> æœåŠ¡æœ¬è´¨ </p><p> <strong>æé†’</strong>: è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ° JavaåŸºç¡€(IO&#x2F;ç½‘ç»œ),</p><p>â€‹<a href="http://localhost:9999/">http://localhost:9999</a> è¡¨ç¤ºæµè§ˆå™¨å‘localhost(127.0.0.1)è¡¨ç¤ºæœ¬æœºçš„9999ç«¯å£å‘å‡ºè¯·æ±‚</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230704164133005.png" alt="image-20230704164133005" style="zoom:50%;" /><p><strong>2.</strong> <strong>åˆ›å»º</strong> <strong>hspedu_mytomcat</strong> <strong>çš„</strong> <strong>Java</strong> <strong>åº”ç”¨ç¨‹åº</strong>.</p><p><strong>3.</strong> <strong>åˆ›å»º</strong> <strong>D:\idea_java_projects\hspedu_mytomcat\src\hello.html</strong></p><p>â€‹Hello, I AM WEB Server!</p><p><strong>4.</strong> <strong>åˆ›å»º</strong> <strong>D:\idea_java_projects\hspedu_mytomcat\src\MyWebServer.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTomcat</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//1.åœ¨ 9999 ç«¯å£ç›‘å¬</span></span><br><span class="line">    <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9999</span>);</span><br><span class="line">    <span class="comment">//å¦‚æœ serverSocket æ²¡æœ‰å…³é—­ï¼Œå°±ç­‰å¾…è¿æ¥, ä¸åœçš„ç­‰å¾… </span></span><br><span class="line">    <span class="keyword">while</span> (!serverSocket.isClosed()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;=====æˆ‘çš„ web æœåŠ¡åœ¨ 9999 ç«¯å£ç›‘å¬=====&quot;</span>); </span><br><span class="line">    <span class="comment">//2. ç­‰å¾…æµè§ˆå™¨/å®¢æˆ·ç«¯è¿æ¥, å¾—åˆ° socket</span></span><br><span class="line">    <span class="comment">// è¯¥ socket ç”¨äºé€šä¿¡</span></span><br><span class="line">    <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">    <span class="comment">//3. é€šè¿‡ socket å¾—åˆ° è¾“å‡ºæµï¼Œ[]</span></span><br><span class="line">    <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> socket.getOutputStream(); <span class="comment">// è¿”å›ç»™æµè§ˆå™¨/å®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="comment">//4. è¯»å– hello.html æ–‡ä»¶è¿”å›å³å¯=&gt; å¦‚ä½•è¯»å–æ–‡ä»¶å†…å®¹ </span></span><br><span class="line">    <span class="comment">// å¾—åˆ°æ–‡ä»¶è¾“å…¥æµ(å­—ç¬¦è¾“å…¥æµ), å’Œ src/hello.html </span></span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;src/hello.html&quot;</span>)); </span><br><span class="line">    <span class="type">String</span> <span class="variable">buf</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">// å¾ªç¯è¯»å– hello.html</span></span><br><span class="line">    <span class="keyword">while</span> ((buf = bufferedReader.readLine())!=<span class="literal">null</span>) &#123;</span><br><span class="line">      outputStream.write(buf.getBytes()); &#125;</span><br><span class="line">      outputStream.close();</span><br><span class="line">    socket.close(); </span><br><span class="line">    &#125;</span><br><span class="line">    serverSocket.close();</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>5.</strong> <strong>å®Œæˆæµ‹è¯•</strong>: <strong>æµè§ˆå™¨</strong> <strong><a href="http://localhost:9999/">http://localhost:9999/</a></strong></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230704165444597.png" alt="image-20230704165444597" style="zoom:33%;" /><h3 id="7-5-3-å¸¸ç”¨-JavaWeb-æœåŠ¡è½¯ä»¶"><a href="#7-5-3-å¸¸ç”¨-JavaWeb-æœåŠ¡è½¯ä»¶" class="headerlink" title="7.5.3 å¸¸ç”¨ JavaWeb æœåŠ¡è½¯ä»¶"></a>7.5.3 å¸¸ç”¨ JavaWeb æœåŠ¡è½¯ä»¶</h3><p><strong>1.</strong> <strong>Tomcat</strong>:ç”± <strong>Apache</strong> ç»„ç»‡æä¾›çš„ä¸€ç§ <strong>Web</strong> æœåŠ¡å™¨ï¼Œæä¾›å¯¹ <strong>jsp</strong> å’Œ <strong>Servlet</strong> çš„æ”¯æŒã€‚å®ƒæ˜¯ä¸€ç§è½»é‡çº§çš„ <strong>javaWeb</strong> å®¹å™¨(æœåŠ¡å™¨)ï¼Œä¹Ÿæ˜¯å½“å‰åº”ç”¨æœ€å¹¿çš„ <strong>JavaWeb</strong> æœåŠ¡å™¨(å…è´¹)ã€‚</p><p><strong>2.</strong> <strong>Jboss:æ˜¯ä¸€ä¸ªéµä»</strong> <strong>JavaEE</strong> <strong>è§„èŒƒçš„ã€å®ƒæ”¯æŒæ‰€æœ‰çš„</strong> <strong>JavaEE</strong> <strong>è§„èŒƒ(å…è´¹)ã€‚</strong></p><p><strong>3.</strong> <strong>GlassFish</strong>: ç”± <strong>Oracle</strong> <strong>å…¬å¸å¼€å‘çš„ä¸€æ¬¾</strong> <strong>JavaWeb</strong> <strong>æœåŠ¡å™¨ï¼Œæ˜¯ä¸€æ¬¾å•†ä¸šæœåŠ¡å™¨ï¼Œè¾¾åˆ°äº§å“çº§è´¨é‡(åº”ç”¨å¾ˆå°‘)ã€‚</strong></p><p><strong>4.</strong> <strong>Resin:æ˜¯CAUCHO</strong> <strong>å…¬å¸çš„äº§å“ï¼Œæ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„æœåŠ¡å™¨ï¼Œå¯¹</strong> <strong>servlet</strong> <strong>å’Œ</strong> <strong>JSP</strong> <strong>æä¾›äº†è‰¯å¥½çš„æ”¯æŒï¼Œ æ€§èƒ½ä¹Ÿæ¯”è¾ƒä¼˜è‰¯(æ”¶è´¹)ã€‚</strong></p><p><strong>5.</strong> <strong>WebLogic</strong>ã€å¾ˆçŒ›ã€‘:æ˜¯ <strong>Oracle</strong> <strong>å…¬å¸çš„äº§å“ï¼Œæ”¯æŒ</strong> <strong>JavaEE</strong> <strong>è§„èŒƒï¼Œ è€Œä¸”ä¸æ–­çš„å®Œå–„ä»¥é€‚åº”æ–°çš„å¼€å‘è¦æ±‚ï¼Œé€‚åˆå¤§å‹é¡¹ç›®(æ”¶è´¹ï¼Œç”¨çš„ä¸å¤šï¼Œé€‚åˆå¤§å…¬å¸)ã€‚</strong></p><h2 id="7-6-Tomcat"><a href="#7-6-Tomcat" class="headerlink" title="7.6 Tomcat"></a>7.6 Tomcat</h2><h3 id="7-6-1-Tomcatä¸‹è½½å’Œå®‰è£…"><a href="#7-6-1-Tomcatä¸‹è½½å’Œå®‰è£…" class="headerlink" title="7.6.1 Tomcatä¸‹è½½å’Œå®‰è£…"></a><strong>7.6.1 Tomcat</strong>ä¸‹è½½å’Œå®‰è£…</h3><p><strong>1. Tomcat</strong> å®˜æ–¹ç«™ç‚¹:**<a href="http://tomcat.apache.org/">http://tomcat.apache.org/</a> **</p><p><strong>2.</strong> <strong>è·å–</strong> <strong>Tomcat</strong> <strong>å®‰è£…ç¨‹åºåŒ…</strong></p><p><strong>tar.gz</strong>æ–‡ä»¶æ˜¯<u>Linux</u>æ“ä½œç³»ç»Ÿä¸‹çš„å®‰è£…ç‰ˆæœ¬</p><p><strong>zip</strong>æ–‡ä»¶æ˜¯<u>Windows</u>ç³»ç»Ÿä¸‹çš„å‹ç¼©ç‰ˆæœ¬</p><p><strong>3.</strong> <strong>ä½¿ç”¨</strong> <strong>zip</strong> <strong>åŒ…å®‰è£…</strong> <strong>Tomcat</strong></p><p>**4. which version <a href="https://tomcat.apache.org/whichversion.html">https://tomcat.apache.org/whichversion.html</a> ,**å¯ä»¥çœ‹åˆ° <strong>Tomcat</strong> <strong>ä»ç„¶æ˜¯æ”¯æŒ</strong> <strong>jsp</strong> <strong>å’Œ</strong> <strong>el</strong></p><p><strong>5.</strong> Tomcat <strong>æœ€å¥½çš„å°ä¼™ä¼´æ˜¯</strong> <strong>JSP+EL</strong></p><h3 id="7-6-2-Tomcatå¯åŠ¨"><a href="#7-6-2-Tomcatå¯åŠ¨" class="headerlink" title="7.6.2 Tomcatå¯åŠ¨"></a><strong>7.6.2 Tomcat</strong>å¯åŠ¨</h3><p>windowsç³»ç»Ÿï¼šåŒå‡» <strong>bin</strong> ç›®å½•ä¸‹çš„ <strong>startup.bat</strong> æ–‡ä»¶</p><p>macosï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ğŸŒŸè¿›å…¥tomcatå®‰è£…ç›®å½•çš„binç›®å½•ä¸‹</span><br><span class="line">cd /Applications/å‹ç¼©åŒ…èµ„æº/apache-tomcat-9.0.73/bin</span><br><span class="line"></span><br><span class="line">ğŸŒŸå¯åŠ¨tomcat</span><br><span class="line">./startup.sh</span><br><span class="line">ğŸŒŸå…³é—­tomcat</span><br><span class="line">./shutdown.sh</span><br><span class="line">ğŸŒŸæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">./version.sh</span><br></pre></td></tr></table></figure><p><strong>è¾“å…¥</strong> <strong><a href="http://localhost:8080/%EF%BC%8C%E6%98%BE%E7%A4%BA%E5%A6%82%E4%B8%8B%E7%95%8C%E9%9D%A2%E4%BB%A3%E8%A1%A8%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F">http://localhost:8080/ï¼Œæ˜¾ç¤ºå¦‚ä¸‹ç•Œé¢ä»£è¡¨å®‰è£…æˆåŠŸ</a></strong>, <strong>é»˜è®¤åœ¨</strong> <strong>8080</strong> <strong>ç«¯å£</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230705084311991.png" alt="image-20230705084311991"></p><p><strong>åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹å“ªäº›ç«¯å£åœ¨ç›‘å¬ï¼š</strong> netstat -anb</p><h3 id="7-6-3-Tomcatå¯åŠ¨æ•…éšœæ’é™¤"><a href="#7-6-3-Tomcatå¯åŠ¨æ•…éšœæ’é™¤" class="headerlink" title="7.6.3 Tomcatå¯åŠ¨æ•…éšœæ’é™¤"></a><strong>7.6.3 Tomcat</strong>å¯åŠ¨æ•…éšœæ’é™¤</h3><p><strong>1.</strong> åŒå‡» <strong>startup.bat</strong> æ–‡ä»¶ï¼Œå‡ºç°ä¸€ä¸ªå°é»‘çª—å£ç„¶åå°±æ²¡äº†ï¼ŒåŸå› æ˜¯å› ä¸ºæ²¡æœ‰é…ç½®å¥½<strong>JAVA_HOME</strong> ç¯å¢ƒå˜é‡<strong>Tomcat</strong> <strong>æœ¬è´¨æ˜¯ä¸€ä¸ª</strong> <strong>Java</strong> <strong>ç¨‹åºï¼Œæ‰€ä»¥è¦</strong> <strong>jdk,</strong> <strong>ä¼šå»æ ¹æ®</strong> <strong>JAVA_HOME</strong> <strong>ä½¿ç”¨æŒ‡å®š</strong> <strong>jdk</strong></p><p><strong>2. JAVA_HOME</strong> <strong>å¿…é¡»å…¨å¤§å†™</strong></p><p><strong>3. JAVA_HOME</strong> <strong>ä¸­é—´å¿…é¡»æ˜¯ä¸‹åˆ’çº¿</strong></p><p><strong>4. JAVA_HOME</strong> <strong>é…ç½®çš„è·¯å¾„åªéœ€è¦é…ç½®åˆ°</strong> <strong>jdk</strong> <strong>çš„å®‰è£…ç›®å½•å³å¯ã€‚ä¸éœ€è¦å¸¦ä¸Š</strong> <strong>bin</strong> <strong>ç›®å½•</strong></p><p><strong>5.</strong> <strong>ç«¯å£</strong> <strong>8080</strong> <strong>è¢«å ç”¨</strong> **[**æŸ¥çœ‹ç«¯å£<u>netstat -anb</u>,ä½¿ç”¨çš„éå¸¸å¤š]</p><p><strong>6.</strong> <strong>å¦‚æœå…¶å®ƒæœåŠ¡ç¨‹åºå ç”¨äº†</strong> <strong>8080</strong> <strong>ç«¯å£ï¼Œå¯ä»¥å…³é—­è¯¥æœåŠ¡ï¼Œæˆ–è€…ä¿®æ”¹</strong> <strong>Tomcat</strong> <strong>æœåŠ¡çš„é»˜è®¤ ç«¯å£</strong> **8080 [**åé¢è®²]</p><h3 id="7-6-4-Tomcat-ç›®å½•ç»“æ„"><a href="#7-6-4-Tomcat-ç›®å½•ç»“æ„" class="headerlink" title="7.6.4 Tomcat ç›®å½•ç»“æ„"></a><strong>7.6.4 Tomcat</strong> ç›®å½•ç»“æ„</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230705085601438.png" alt="image-20230705085601438"></p><p>è§£è¯»<br><strong>1. server.xml</strong> <strong>ç”¨äºé…ç½®</strong> <strong>tomcatçš„åŸºæœ¬è®¾ç½®(å¯åŠ¨ç«¯å£ï¼Œå…³é—­ç«¯å£,ä¸»æœºå)</strong></p><p><strong>2. wex.xml ç”¨äºæŒ‡å®š tomcat è¿è¡Œæ—¶é…ç½®(æ¯”å¦‚servletç­‰</strong>.)</p><p><strong>3. webapps ç›®å½•æ˜¯å­˜æ”¾webåº”ç”¨ï¼Œå°±æ˜¯ç½‘ç«™</strong></p><h3 id="7-6-5-catalina-å¯åŠ¨-Tomcat-Windows"><a href="#7-6-5-catalina-å¯åŠ¨-Tomcat-Windows" class="headerlink" title="7.6.5 catalina å¯åŠ¨ Tomcat(Windows)"></a>7.6.5 catalina å¯åŠ¨ Tomcat(Windows)</h3><p><strong>1.</strong> è¿›å…¥åˆ° <strong>Tomcat</strong> çš„ <strong>bin</strong> ç›®å½•ä¸‹</p><p><strong>2.</strong> <strong>æ‰§è¡Œå‘½ä»¤:</strong> <strong>catalina run</strong></p><h3 id="7-6-6-åœæ­¢-Tomcat"><a href="#7-6-6-åœæ­¢-Tomcat" class="headerlink" title="7.6.6 åœæ­¢ Tomcat"></a>7.6.6 åœæ­¢ Tomcat</h3><p><strong>è¿›å…¥</strong> <strong>Tomcat</strong> <strong>çš„</strong> <strong>bin</strong> <strong>ç›®å½•ä¸‹çš„</strong> <strong>shutdown.bat</strong> <strong>åŒå‡»ï¼Œå°±å¯ä»¥åœæ­¢</strong> <strong>Tomcat</strong> <strong>æœåŠ¡å™¨</strong>(windows)</p><h3 id="7-6-7-ä¿®æ”¹-Tomcat-æœåŠ¡ç«¯å£"><a href="#7-6-7-ä¿®æ”¹-Tomcat-æœåŠ¡ç«¯å£" class="headerlink" title="7.6.7 ä¿®æ”¹ Tomcat æœåŠ¡ç«¯å£"></a>7.6.7 ä¿®æ”¹ Tomcat æœåŠ¡ç«¯å£</h3><p><strong>1. Tomcat</strong> ç›®å½•ä¸‹çš„ <strong>conf</strong> ç›®å½•ï¼Œä¿®æ”¹ <strong>server.xml</strong> é…ç½®æ–‡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230705152146388.png" alt="image-20230705152146388"></p><p><strong>2.</strong> <strong>è€éŸ©è¯´æ˜:</strong> <strong><a href="http://localhost/">http://localhost</a> ,</strong> <strong>é»˜è®¤æ˜¯è®¿é—®</strong> <strong>80</strong> <strong>ç«¯å£</strong>,<strong>å³</strong> <a href="http://localhost**ç­‰ä»·**http//localhost:80">http://localhost**ç­‰ä»·**http://localhost:80</a></p><h3 id="7-6-8-Tomcat-æœåŠ¡ä¸­éƒ¨ç½²-WEB-åº”ç”¨"><a href="#7-6-8-Tomcat-æœåŠ¡ä¸­éƒ¨ç½²-WEB-åº”ç”¨" class="headerlink" title="7.6.8 Tomcat æœåŠ¡ä¸­éƒ¨ç½² WEB åº”ç”¨"></a>7.6.8 Tomcat æœåŠ¡ä¸­éƒ¨ç½² <strong>WEB</strong> åº”ç”¨</h3><ul><li>ä»€ä¹ˆæ˜¯<strong>Web</strong>åº”ç”¨</li></ul><ol><li><p>WEBåº”ç”¨æ˜¯å¤šä¸ªwebèµ„æºçš„é›†åˆã€‚ç®€å•çš„è¯´ï¼Œå¯ä»¥æŠŠwebåº”ç”¨ç†è§£ä¸ºç¡¬ç›˜ä¸Šçš„ä¸€ä¸ªç›®å½•ï¼Œè¿™ä¸ªç›®å½•ç”¨äºç®¡ç†å¤šä¸ªwebèµ„æºã€‚</p></li><li><p>webåº”ç”¨é€šå¸¸ä¹Ÿç§°ä¹‹ä¸ºwebåº”ç”¨ç¨‹åºï¼Œæˆ–webå·¥ç¨‹ï¼Œé€šä¿—çš„è¯´å°±æ˜¯ç½‘ç«™ã€‚</p></li></ol><ul><li><strong>Webåº”ç”¨</strong>ç»„æˆ</li></ul><p>ä¸€ä¸ª WEB åº”ç”¨ç”±å¤šä¸ªWEB èµ„æºæˆ–å…¶å®ƒæ–‡ä»¶ç»„æˆï¼ŒåŒ…æ‹¬html æ–‡ä»¶ã€css æ–‡ä»¶ã€jsæ–‡ä»¶ã€åŠ¨æ€webé¡µé¢ã€java ç¨‹åºã€æ”¯æŒjar åŒ…ã€é…ç½®æ–‡ä»¶ç­‰ã€‚å¼€å‘äººå‘˜åœ¨å¼€å‘ web åº”ç”¨æ—¶ï¼ŒæŒ‰ç…§è§„å®šç›®å½•ç»“æ„å­˜æ”¾è¿™äº›æ–‡ä»¶ã€‚å¦åˆ™ï¼Œåœ¨æŠŠ web åº”ç”¨äº¤ç»™ web æœåŠ¡å™¨ç®¡ç†æ—¶ï¼Œä¸ä»…å¯èƒ½ä¼šä½¿web åº”ç”¨æ— æ³•è®¿é—®ï¼Œè¿˜ä¼šå¯¼è‡´ web æœåŠ¡å™¨å¯åŠ¨æŠ¥é”™ã€‚</p><ul><li>Javawebç¨‹åº&#x2F;åº”ç”¨&#x2F;å·¥ç¨‹ç›®å½•ç»“æ„</li></ul><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230706111003709.png" alt="image-20230706111003709" style="zoom: 40%;" /><ul><li>éƒ¨ç½²æ–¹å¼1ï¼šå°†webå·¥ç¨‹çš„ç›®å½•æ‹·è´åˆ° Tomcat çš„webapps ç›®å½•ä¸‹</li></ul><ol><li><p>news webå·¥ç¨‹(ç›®å‰éƒ½æ˜¯é™æ€èµ„æº htmlï¼Œ å›¾ç‰‡ï¼‰</p></li><li><p>å°†è¯¥newsç›®å½•&#x2F;æ–‡ä»¶å¤¹ æ‹·è´åˆ° Tomcat çš„webappsç›®å½•ä¸‹</p></li><li><p>æµè§ˆå™¨è¾“å…¥ï¼š<a href="http://ip[åŸŸå]:port/news/å­ç›®å½•.../æ–‡ä»¶å">http://ip[åŸŸå]:port/news/å­ç›®å½•.../æ–‡ä»¶å</a></p></li></ol><ul><li>éƒ¨ç½²æ–¹å¼2ï¼š</li></ul><p>åœ¨tomcatä¸‹çš„ conf&#x2F;Catalina&#x2F;localhost&#x2F; ç›®å½•ä¸­ï¼Œæ·»åŠ é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ˜ å°„åˆ°å…¶ä»–ä½ç½®çš„webåº”ç”¨(åœ¨å…¶ä»–åœ°æ–¹å¯»æ‰¾webåº”ç”¨ï¼Œè§£å†³ç£ç›˜ç©ºé—´åˆ†é…é—®é¢˜)</p><p><strong>ROOT çš„å·¥ç¨‹çš„è®¿é—®:</strong></p><ol><li><p>åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥è®¿é—®åœ°å€å¦‚ä¸‹ï¼š<a href="http://ip[åŸŸå]:portï¼Œ">http://ip[åŸŸå]:portï¼Œ</a><u>æ²¡æœ‰webå·¥ç¨‹&#x2F; åº”ç”¨åæ—¶ï¼Œé»˜è®¤è®¿é—®çš„æ˜¯ ROOT å·¥ç¨‹</u></p></li><li><p>åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥çš„è®¿é—®åœ°å€å¦‚ä¸‹: <a href="http://ip[åŸŸå]:port/å·¥ç¨‹å/">http://ip[åŸŸå]:port/å·¥ç¨‹å/</a> ï¼Œæ²¡æœ‰èµ„æºå,<strong>åˆ™é»˜è®¤è®¿é—®</strong> <strong>index.jsp</strong> <strong>é¡µé¢</strong></p></li></ol><h3 id="7-6-9-æµè§ˆå™¨è®¿é—®-Web-æœåŠ¡è¿‡ç¨‹è¯¦è§£"><a href="#7-6-9-æµè§ˆå™¨è®¿é—®-Web-æœåŠ¡è¿‡ç¨‹è¯¦è§£" class="headerlink" title="7.6.9 æµè§ˆå™¨è®¿é—® Web æœåŠ¡è¿‡ç¨‹è¯¦è§£"></a>7.6.9 æµè§ˆå™¨è®¿é—® Web æœåŠ¡è¿‡ç¨‹è¯¦è§£</h3><h4 id="7-6-9-1-å›é¡¾å‰é¢çš„-JavaWeb-å¼€å‘æŠ€æœ¯æ ˆå›¾"><a href="#7-6-9-1-å›é¡¾å‰é¢çš„-JavaWeb-å¼€å‘æŠ€æœ¯æ ˆå›¾" class="headerlink" title="7.6.9.1 å›é¡¾å‰é¢çš„ JavaWeb å¼€å‘æŠ€æœ¯æ ˆå›¾"></a>7.6.9.1 å›é¡¾å‰é¢çš„ JavaWeb å¼€å‘æŠ€æœ¯æ ˆå›¾</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230704161447451.png" alt="image-20230704161447451"></p><h4 id="7-6-9-2-æµè§ˆå™¨è®¿é—®-web-æœåŠ¡å™¨æ–‡ä»¶-UML-æ—¶åºå›¾"><a href="#7-6-9-2-æµè§ˆå™¨è®¿é—®-web-æœåŠ¡å™¨æ–‡ä»¶-UML-æ—¶åºå›¾" class="headerlink" title="7.6.9.2 æµè§ˆå™¨è®¿é—® web æœåŠ¡å™¨æ–‡ä»¶ UML æ—¶åºå›¾!!!"></a>7.6.9.2 æµè§ˆå™¨è®¿é—® web æœåŠ¡å™¨æ–‡ä»¶ UML æ—¶åºå›¾!!!</h4><p><strong>1.</strong> è¯´æ˜</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å¯¹æµè§ˆå™¨è®¿é—®webæœåŠ¡å™¨èµ„æº(html,css,å›¾ç‰‡,js)åšè¯¦è§£ï¼Œé€šè¿‡ä¸€ä¸ªæ—¶åºå›¾åŠ å¼ºå¯¹è¿™ä¸ªé‡è¦è¿‡ç¨‹çš„ç†è§£,é‡è¦ï¼Œæ ¸å¿ƒ</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230706111724367.png" alt="image-20230706111724367"></p><h2 id="7-7-IDEA-å¼€å‘-JavaWeb-å·¥ç¨‹"><a href="#7-7-IDEA-å¼€å‘-JavaWeb-å·¥ç¨‹" class="headerlink" title="7.7 IDEA å¼€å‘ JavaWeb å·¥ç¨‹"></a>7.7 IDEA å¼€å‘ JavaWeb å·¥ç¨‹</h2><h3 id="7-7-1-å¼€å‘-javaweb-å·¥ç¨‹-amp-é…ç½®-TomCat-amp-å¯åŠ¨é¡¹ç›®"><a href="#7-7-1-å¼€å‘-javaweb-å·¥ç¨‹-amp-é…ç½®-TomCat-amp-å¯åŠ¨é¡¹ç›®" class="headerlink" title="7.7.1 å¼€å‘ javaweb å·¥ç¨‹ &amp; é…ç½® TomCat &amp; å¯åŠ¨é¡¹ç›®"></a>7.7.1 å¼€å‘ javaweb å·¥ç¨‹ &amp; é…ç½® TomCat &amp; å¯åŠ¨é¡¹ç›®</h3><p>1.éœ€æ±‚&#x2F;å›¾è§£ï¼šä½¿ç”¨ IDEA å¼€å‘ Javaweb å·¥ç¨‹fishwebï¼Œå¹¶å°†ç½‘é¡µéƒ¨ç½²åˆ° fishweb å·¥ç¨‹ï¼Œçœ‹è€å¸ˆæ¼”ç¤º</p> <img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230706112454090.png" alt="image-20230706112454090" style="zoom:33%;" /><h3 id="7-7-2-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#7-7-2-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="7.7.2 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>7.7.2 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><h4 id="1-çƒ­åŠ è½½é€‰é¡¹è¯´æ˜"><a href="#1-çƒ­åŠ è½½é€‰é¡¹è¯´æ˜" class="headerlink" title="1. çƒ­åŠ è½½é€‰é¡¹è¯´æ˜"></a>1. çƒ­åŠ è½½é€‰é¡¹è¯´æ˜</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230706135810014.png" alt="image-20230706135810014"></p><p>è§£è¯»ï¼š</p><p>(1)on update action ï¼šè¡¨ç¤ºå½“æˆ‘ä»¬<strong>æ›´æ–°æ“ä½œ</strong>æ—¶ï¼ŒTomcat ä¼šè‡ªåŠ¨æ›´æ–°ç±»å’Œèµ„æºï¼ˆ<u>å½“jsp&#x2F;htmlæ–‡ä»¶ä¿®æ”¹æ—¶ï¼Œå¯ä»¥ç”Ÿæ•ˆï¼Œä½†æ˜¯å¦‚æœä½ ä¿®æ”¹çš„java æ–‡ä»¶ï¼Œéœ€è¦ Redepoly æ‰ä¼šç”Ÿæ•ˆ</u>ï¼‰</p><p>(2) on frame deactivation ï¼šè¡¨ç¤º <strong>IDEA å¤±å»ç„¦ç‚¹</strong>ï¼ˆ(æ¯”å¦‚æœ€å°åŒ–)ï¼Œä¹Ÿä¼šå¯¼è‡´jsp&#x2F;html å‘ç”Ÿæ›´æ–°ï¼Œä½†æ˜¯java ä¿®æ”¹äº†ï¼Œè¿˜æ˜¯éœ€è¦ Redeploy</p><h4 id="2-ç«¯å£ä¿®æ”¹"><a href="#2-ç«¯å£ä¿®æ”¹" class="headerlink" title="2. ç«¯å£ä¿®æ”¹"></a>2. ç«¯å£ä¿®æ”¹</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230706140054643.png" alt="image-20230706140054643" style="zoom:50%;" /><p><strong>è¿™é‡Œä¿®æ”¹çš„ç«¯å£ï¼Œ åªä¼šå½±å“åˆ°å½“å‰çš„é¡¹ç›®ï¼Œè€Œä¸æ˜¯å»ä¿®æ”¹ server.xml</strong></p><h4 id="3-out-ç›®å½•æ˜¯ä»€ä¹ˆ"><a href="#3-out-ç›®å½•æ˜¯ä»€ä¹ˆ" class="headerlink" title="3.out ç›®å½•æ˜¯ä»€ä¹ˆ"></a>3.out ç›®å½•æ˜¯ä»€ä¹ˆ</h4><p>å½“tomcat å¯åŠ¨æ—¶ï¼Œä¼šç”Ÿæˆ out ç›®å½•ï¼Œè¯¥ç›®å½•å°±æ˜¯åŸé¡¹ç›®èµ„æºçš„æ˜ å°„ï¼Œæˆ‘ä»¬æµè§ˆå™¨è®¿é—®çš„èµ„æºæ˜¯ out ç›®å½•</p><h4 id="4-å½“æˆ‘ä»¬ä»å¤–éƒ¨æ‹·è´èµ„æºåˆ°é¡¹ç›®ï¼ˆå›¾ç‰‡ï¼Œæ–‡ä»¶ï¼Œjsï¼Œcss-ç­‰"><a href="#4-å½“æˆ‘ä»¬ä»å¤–éƒ¨æ‹·è´èµ„æºåˆ°é¡¹ç›®ï¼ˆå›¾ç‰‡ï¼Œæ–‡ä»¶ï¼Œjsï¼Œcss-ç­‰" class="headerlink" title="4.å½“æˆ‘ä»¬ä»å¤–éƒ¨æ‹·è´èµ„æºåˆ°é¡¹ç›®ï¼ˆå›¾ç‰‡ï¼Œæ–‡ä»¶ï¼Œjsï¼Œcss ç­‰)"></a>4.å½“æˆ‘ä»¬ä»å¤–éƒ¨æ‹·è´èµ„æºåˆ°é¡¹ç›®ï¼ˆå›¾ç‰‡ï¼Œæ–‡ä»¶ï¼Œjsï¼Œcss ç­‰)</h4><p>å¦‚æœå‡ºç° 404 ä¸èƒ½è®¿é—®é”™è¯¯,è§£å†³æ–¹å¼ rebulid project -ï¼é‡å¯ Tomcat</p><h3 id="7-7-3-JavaWeb-å·¥ç¨‹çš„ç›®å½•ä»‹ç»"><a href="#7-7-3-JavaWeb-å·¥ç¨‹çš„ç›®å½•ä»‹ç»" class="headerlink" title="7.7.3 JavaWeb å·¥ç¨‹çš„ç›®å½•ä»‹ç»"></a><strong>7.7.3 JavaWeb</strong> å·¥ç¨‹çš„ç›®å½•ä»‹ç»</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230706141714376.png" alt="image-20230706141714376"></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230706141833960.png" alt="image-20230706141833960"></p><h1 id="8-åŠ¨æ€-WEB-å¼€å‘æ ¸å¿ƒ-Servlet"><a href="#8-åŠ¨æ€-WEB-å¼€å‘æ ¸å¿ƒ-Servlet" class="headerlink" title="8 åŠ¨æ€ WEB å¼€å‘æ ¸å¿ƒ-Servlet"></a>8 åŠ¨æ€ WEB å¼€å‘æ ¸å¿ƒ-Servlet</h1><h2 id="8-1-å®˜æ–¹æ–‡æ¡£"><a href="#8-1-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="8.1 å®˜æ–¹æ–‡æ¡£"></a>8.1 å®˜æ–¹æ–‡æ¡£</h2><h3 id="8-1-1-åœ°å€-https-tomcat-apache-org-tomcat-8-0-doc-servletapi-index-html"><a href="#8-1-1-åœ°å€-https-tomcat-apache-org-tomcat-8-0-doc-servletapi-index-html" class="headerlink" title="8.1.1 åœ°å€: https://tomcat.apache.org/tomcat-8.0-doc/servletapi/index.html"></a>8.1.1 åœ°å€: <a href="https://tomcat.apache.org/tomcat-8.0-doc/servletapi/index.html">https://tomcat.apache.org/tomcat-8.0-doc/servletapi/index.html</a></h3><h3 id="8-1-3-Servletå’ŒTomcatçš„å…³ç³»-ä¸€å¥è¯-Tomcatæ”¯æŒServlet"><a href="#8-1-3-Servletå’ŒTomcatçš„å…³ç³»-ä¸€å¥è¯-Tomcatæ”¯æŒServlet" class="headerlink" title="8.1.3 Servletå’ŒTomcatçš„å…³ç³»:ä¸€å¥è¯,Tomcatæ”¯æŒServlet"></a>8.1.3 Servletå’ŒTomcatçš„å…³ç³»:ä¸€å¥è¯,Tomcatæ”¯æŒServlet</h3><h2 id="8-2-ä¸ºä»€ä¹ˆä¼šå‡ºç°-Servlet"><a href="#8-2-ä¸ºä»€ä¹ˆä¼šå‡ºç°-Servlet" class="headerlink" title="8.2 ä¸ºä»€ä¹ˆä¼šå‡ºç° Servlet"></a>8.2 ä¸ºä»€ä¹ˆä¼šå‡ºç° Servlet</h2><p>æå‡ºéœ€æ±‚**:** è¯·ç”¨ä½ ç°æœ‰çš„<strong>html css javascript</strong>ï¼Œå¼€å‘ç½‘ç«™ï¼Œæ¯”å¦‚å¯ä»¥è®©ç”¨æˆ·ç•™è¨€**&#x2F;<strong>è´­ç‰©</strong>&#x2F;<strong>æ”¯ä»˜</strong>,** ä½ èƒ½æå®šå—**?**</p><p>â€”ä¸èƒ½ï¼Œå› ä¸ºæ— æ³•æ“ä½œæ•°æ®åº“</p><ul><li>å¼•å…¥æˆ‘ä»¬åŠ¨æ€ç½‘é¡µ(èƒ½å’Œç”¨æˆ·äº¤äº’)æŠ€æœ¯ <strong>&#x3D;&#x3D;&#x3D;&gt; Servlet</strong></li><li>å¯¹Java Web æŠ€æœ¯ä½“ç³»çš„æµç¨‹å›¾æ”¹é€ è¯´æ˜(ç»†åŒ–).[æ•´ä½“çš„æ¦‚å¿µ]</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230706145610695.png" alt="image-20230706145610695"></p><h2 id="8-3-ä»€ä¹ˆæ˜¯-Servlet"><a href="#8-3-ä»€ä¹ˆæ˜¯-Servlet" class="headerlink" title="8.3 ä»€ä¹ˆæ˜¯ Servlet"></a>8.3 ä»€ä¹ˆæ˜¯ Servlet</h2><ul><li><p>ä»€ä¹ˆæ˜¯Servlet</p><ul><li>Servlet åœ¨å¼€å‘åŠ¨æ€ WEB å·¥ç¨‹ä¸­ï¼Œå¾—åˆ°å¹¿æ³›çš„åº”ç”¨ï¼ŒæŒæ¡å¥½ Servlet éå¸¸é‡è¦,Servlet(åŸºçŸ³)æ˜¯ SpringMVC çš„åŸºç¡€</li></ul></li><li><p>Servlet(java æœåŠ¡å™¨å°ç¨‹åº)ï¼Œå®ƒçš„ç‰¹ç‚¹ï¼š</p><ul><li>ä»–æ˜¯ç”±æœåŠ¡å™¨ç«¯è°ƒç”¨å’Œæ‰§è¡Œçš„(ä¸€å¥è¯ï¼šæ˜¯Tomcatè§£æå’Œæ‰§è¡Œï¼‰</li><li>ä»–æ˜¯ç”¨javaè¯­è¨€ç¼–å·çš„ï¼Œæœ¬è´¨å°±æ˜¯Javaç±»</li><li>ä»–æ˜¯æŒ‰ç…§Servletè§„èŒƒå¼€å‘çš„ï¼ˆé™¤ äº†tomcat-&gt;Servlet weblogic-&gt;Servlet)</li><li>åŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥å®Œæˆå‡ ä¹æ‰€æœ‰çš„ç½‘ç«™åŠŸèƒ½(åœ¨ä»¥å‰ï¼Œæˆ‘ä»¬è€ç¨‹å‘˜ï¼Œä½¿ç”¨Servletå¼€å‘ç½‘ç«™ï¼‰æŠ€æœ¯æ ˆè¦æ±‚é«˜</li></ul></li></ul><h2 id="8-4-Servletåœ¨JavaWebé¡¹ç›®ä½ç½®"><a href="#8-4-Servletåœ¨JavaWebé¡¹ç›®ä½ç½®" class="headerlink" title="8.4 Servletåœ¨JavaWebé¡¹ç›®ä½ç½®"></a>8.4 Servletåœ¨JavaWebé¡¹ç›®ä½ç½®</h2><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230707084620291.png" alt="image-20230707084620291"></p><h2 id="8-5-ServletåŸºæœ¬ä½¿ç”¨"><a href="#8-5-ServletåŸºæœ¬ä½¿ç”¨" class="headerlink" title="8.5 ServletåŸºæœ¬ä½¿ç”¨"></a>8.5 ServletåŸºæœ¬ä½¿ç”¨</h2><h3 id="8-5-1-Servletå¼€å‘æ–¹å¼è¯´æ˜"><a href="#8-5-1-Servletå¼€å‘æ–¹å¼è¯´æ˜" class="headerlink" title="8.5.1 Servletå¼€å‘æ–¹å¼è¯´æ˜"></a><strong>8.5.1 Servlet</strong>å¼€å‘æ–¹å¼è¯´æ˜</h3><ol><li><p>servlet3.0 å‰ä½¿ç”¨ <strong>web.xml , servlet3.0</strong> ç‰ˆæœ¬ä»¥å**(**åŒ…æ‹¬ **3.0)**æ”¯æŒæ³¨è§£ï¼Œ åŒæ—¶æ”¯æŒ <strong>web.xml</strong> é…ç½®</p></li><li><p><strong>å¦‚ä½•æŸ¥çœ‹</strong> <strong>servletç‰ˆæœ¬[å¦‚å›¾]</strong></p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230707085030431.png" alt="image-20230707085030431"></p><ol start="3"><li><p>è®²è§£SpringBoot æ—¶ï¼Œæˆ‘ä»¬ç”¨æ³¨è§£æ–¹å¼ï¼Œä» ssm,springboot åé¢å…¨éƒ¨ä½¿ç”¨æ³¨è§£</p></li><li><p>è¿™ä¸“é—¨è®² servletï¼Œ ä¸ºè®©å¤§å®¶æ›´æ¸…æ™°çŸ¥é“ servlet ä½¿ç”¨åŸç†ï¼Œè€å¸ˆç”¨é…ç½®æ–¹å¼ï¼ˆè¯´æ˜: åŸç”Ÿçš„ Servlet åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¾ˆå°‘</p></li><li><p>ä¸ç®¡ä½¿ç”¨å“ªç§æ–¹å¼ï¼Œæœ¬è´¨éƒ½ä¸€æ ·</p></li></ol><h3 id="8-5-2-å¿«é€Ÿå…¥é—¨-æ‰‹åŠ¨å¼€å‘-Servlet"><a href="#8-5-2-å¿«é€Ÿå…¥é—¨-æ‰‹åŠ¨å¼€å‘-Servlet" class="headerlink" title="8.5.2 å¿«é€Ÿå…¥é—¨- æ‰‹åŠ¨å¼€å‘ Servlet"></a>8.5.2 å¿«é€Ÿå…¥é—¨- æ‰‹åŠ¨å¼€å‘ Servlet</h3><p>éœ€æ±‚è¯´æ˜</p><p>1ã€å¼€å‘ä¸€ä¸ª Helloservlet</p><p>2ã€å½“æµè§ˆå™¨ è®¿é—® <a href="http://localhost:8080/web%E5%BA%94%E7%94%A8%E5%90%8D/helloServlet">http://localhost:8080/webåº”ç”¨å/helloServlet</a> æ—¶ï¼Œåå°è¾“å‡º â€œhi HelloServeltâ€</p><ul><li>å…·ä½“æ­¥éª¤<ul><li>ç¼–å†™ç±»Helloservletå»å®ç° Servlet <strong>æ¥å£</strong></li><li>å®ç° service æ–¹æ³•ï¼Œå¤„ç†è¯·æ±‚ï¼Œå¹¶å“åº”æ•°æ®</li><li>åœ¨ web.xml ä¸­å»é…ç½® servlet ç¨‹åºçš„è®¿é—®åœ°å€</li></ul></li></ul><p>1.åˆ›å»º hspedu_servlet JavaWeb å·¥ç¨‹ï¼Œå¹¶é…ç½®å¥½Tomcat</p><p>2.æ·»åŠ servlet-api.jar(åœ¨tomcat&#x2F;libä¸‹)åˆ°å·¥ç¨‹,å› ä¸ºservlet.jarä¸æ˜¯jdkè‡ªå¸¦çš„,è¦å¼•å…¥</p><p>3.åœ¨srcä¸‹åŒ…<strong>com.hspedu.servlet.HelloServlet.java</strong>ï¼Œå¹¶å®ç°Servletæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/7/7</span></span><br><span class="line"><span class="comment"> * 09:06</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line">    <span class="comment">//å½“åˆ›å»ºHelloServletæ—¶ï¼Œä¼šè°ƒç”¨initæ–¹æ³•</span></span><br><span class="line">    <span class="comment">//è¯¥æ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig servletConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;servletè¢«è°ƒç”¨~~~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿”å›Servletçš„é…ç½®ä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * service æ–¹æ³•æ˜¯ä¸“é—¨ç”¨æ¥å¤„ç†è¯·æ±‚å’Œå“åº”çš„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> servletRequest</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> servletResponse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;service~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;destroy è¢«è°ƒç”¨...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.åœ¨web.xmlé…ç½®HelloServletï¼Œå³:ç»™HelloServletæä¾›å¯¹å¤–è®¿é—®åœ°å€</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  1.web.xmlä¸»è¦ç”¨æ¥é…ç½®è¯¥webåº”ç”¨ä½¿ç”¨åˆ°çš„Servlet  --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  2.servlet-name:ç»™Servletå–å(ç¨‹åºå‘˜å†³å®š)ï¼Œè¯¥åå­—å”¯ä¸€</span></span><br><span class="line"><span class="comment">      3.servlet-classï¼šServletçš„ç±»çš„å…¨è·¯å¾„ï¼šTomcatåœ¨åå°„ç”Ÿæˆè¯¥Servletéœ€è¦ä½¿ç”¨</span></span><br><span class="line"><span class="comment">      4.url-patternï¼šè¯¥servletè®¿é—®çš„urlçš„é…ç½®(è·¯å¾„)</span></span><br><span class="line"><span class="comment">      è¿™æ—¶æˆ‘ä»¬åº”è®¿é—®ï¼šhttp://localhost:8080/servlet/helloServlet</span></span><br><span class="line"><span class="comment">      5.url-pattern å–åæ˜¯ç¨‹åºå‘˜å†³å®šçš„</span></span><br><span class="line"><span class="comment">      6.load-on-startup:è¡¨ç¤ºåœ¨tomcatå¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åŠ è½½servletå®ä¾‹</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.study.servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/helloServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>5.é€šè¿‡æµè§ˆå™¨è®¿é—®HelloServlet ,çœ‹æ˜¯å¦æ­£ç¡®(è®°ä½è¦redeploy[å¿«]æˆ–è€…restart[æ…¢])</p><p><a href="http://localhost:8080/servlet/helloServlet">http://localhost:8080/servlet/helloServlet</a></p><h3 id="8-5-3-æµè§ˆå™¨è°ƒç”¨-Servlet-æµç¨‹åˆ†æ"><a href="#8-5-3-æµè§ˆå™¨è°ƒç”¨-Servlet-æµç¨‹åˆ†æ" class="headerlink" title="8.5.3 æµè§ˆå™¨è°ƒç”¨ Servlet æµç¨‹åˆ†æ"></a>8.5.3 æµè§ˆå™¨è°ƒç”¨ Servlet æµç¨‹åˆ†æ</h3><p>ä¸€å›¾èƒœåƒè¨€</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230707095156118.png" alt="image-20230707095156118"></p><p>å¦‚æœåœ¨web.xmlä¸­æœªæŸ¥è¯¢åˆ°è¯·æ±‚çš„èµ„æºï¼Œåˆ™ä¼šè¿”å›404é”™è¯¯ï¼</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230707095634908.png" alt="image-20230707095634908"></p><p><strong>Servletå¸¸é©»å†…å­˜ï¼Œå±äºå•ä¾‹æ¨¡å¼</strong></p><h3 id="8-5-4-Servletç”Ÿå‘½å‘¨æœŸ"><a href="#8-5-4-Servletç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="8.5.4 Servletç”Ÿå‘½å‘¨æœŸ"></a><strong>8.5.4 Servlet</strong>ç”Ÿå‘½å‘¨æœŸ</h3><p>â— ä¸»è¦æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š</p><p><strong>1. init()ï¼š</strong>åˆå§‹åŒ–é˜¶æ®µ</p><p><strong>2. service()ï¼š</strong>å¤„ç†æµè§ˆå™¨è¯·æ±‚é˜¶æ®µ</p><p><strong>3. destroy()ï¼š</strong>ç»ˆæ­¢é˜¶æ®µ</p><ul><li><strong>ç¤ºæ„å›¾</strong></li></ul><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230707100629527.png" alt="image-20230707100629527" style="zoom:40%;" /><ul><li><p><strong>åˆå§‹åŒ–é˜¶æ®µ</strong></p><ul><li><p>servlet å®¹å™¨(æ¯”å¦‚ï¼šTomcat)&#x2F;åŠ è½½ Servletï¼ŒåŠ è½½å®Œæˆåï¼ŒServlet å®¹å™¨ä¼šåˆ›å»ºä¸€ä¸ª Servlet å®ä¾‹</p><p>å¹¶è°ƒç”¨ init()æ–¹æ³•ï¼Œinit()æ–¹æ³•åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼ŒServlet å®¹å™¨åœ¨ä¸‹é¢çš„æƒ…å†µè£…è½½ Servlet:</p><ul><li><p>Servlet å®¹å™¨ (Tomcat) å¯åŠ¨æ—¶è‡ªåŠ¨è£…è½½æŸäº› servletï¼Œå®ç°è¿™ä¸ªéœ€è¦åœ¨ web.xml æ–‡ä»¶ä¸­æ·»åŠ </p><p><load-on-startup>1</load-on-startup>1 è¡¨ç¤ºè£…è½½çš„é¡ºåº</p></li><li><p>åœ¨servlet å®¹å™¨å¯åŠ¨åï¼Œæµè§ˆå™¨é¦–æ¬¡å‘ servlet å‘é€è¯·æ±‚(è¿™ä¸ªå‰é¢è¯´è¿‡ï¼‰</p></li><li><p>Servlet é‡æ–°éƒ¨ç½²å(æ¯”å¦‚ tomcat è¿›è¡Œ redeploy ã€*<u><strong>redeploy ä¼šé”€æ¯æ‰€æœ‰çš„ servlet å®ä¾‹!!!</strong></u>*ã€‘ï¼‰ã€‚</p><p>æµè§ˆå™¨å†å‘ Servlet å‘é€ç¬¬1æ¬¡è¯·æ±‚(æˆ–é…ç½®äº†tomcatå¯åŠ¨è‡ªåŠ¨è£…è½½)</p></li></ul></li></ul></li><li><p><strong>å¤„ç†æµè§ˆå™¨è¯·æ±‚é˜¶æ®µ</strong>(service <strong>æ–¹æ³•</strong>)</p></li><li><p>æ¯æ”¶åˆ°ä¸€ä¸ªhttp è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°±ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„çº¿ç¨‹å»å¤„ç†[çº¿ç¨‹]</p></li><li><p>åˆ›å»ºä¸€ä¸ªç”¨äºå°è£… HTTP è¯·æ±‚æ¶ˆæ¯çš„ <strong>ServletRequest å¯¹è±¡</strong>å’Œä¸€ä¸ªä»£è¡¨ HTTP å“åº”æ¶ˆæ¯çš„<strong>ServletResponse</strong> å¯¹è±¡</p></li><li><p>ç„¶åè°ƒç”¨ Servlet çš„ service()æ–¹æ³•å¹¶å°†è¯·æ±‚å’Œå“åº”å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»</p></li><li><p>ç»ˆæ­¢é˜¶æ®µ destory æ–¹æ³•(ä½“ç° Servlet å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸ)</p><ul><li><p>å½“web åº”ç”¨è¢«çµ‚æ­¢ï¼Œæˆ–è€… servlet å®¹å™¨çµ‚æ­¢è¿è¡Œï¼Œæˆ–è€…Servlet ç±»é‡æ–°è£…è½½æ—¶ï¼Œä¼šè°ƒç”¨ destroy(æ–¹æ³•</p></li><li><p>æ¯”å¦‚é‡å¯ tomcat,æˆ–è€…redeploy web åº”ç”¨</p></li></ul></li></ul><h3 id="8-5-5-GET-å’Œ-POST-è¯·æ±‚çš„åˆ†å‘å¤„ç†"><a href="#8-5-5-GET-å’Œ-POST-è¯·æ±‚çš„åˆ†å‘å¤„ç†" class="headerlink" title="8.5.5 GET å’Œ POST è¯·æ±‚çš„åˆ†å‘å¤„ç†"></a>8.5.5 GET å’Œ POST è¯·æ±‚çš„åˆ†å‘å¤„ç†</h3><ul><li><p>å¼€å‘ servletï¼Œé€šå¸¸ç¼–å†™ doGetã€doPost æ–¹æ³•ã€‚æ¥å¯¹è¡¨å•çš„get å’Œ post è¯·æ±‚è¿›è¡Œåˆ†å‘å¤„ç†</p></li><li><p>ä»£ç æ¼”ç¤º HelloServlet.java   register.html</p></li></ul><ol><li>åˆ›å»º servlet\web\register.html</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">title</span>&gt;</span>æ³¨å†Œ<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æ³¨å†Œç”¨æˆ·<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://localhost:8080/servlet/helloServlet&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">            u: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æ³¨å†Œç”¨æˆ·&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2.</strong> ä¿®æ”¹ <strong>servlet\src\com\hspedu\servlet\HelloServlet.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//æ€è€ƒ-&gt;ä» servletRequest å¯¹è±¡æ¥è·å–è¯·æ±‚æ–¹å¼-&gt;</span></span><br><span class="line">        <span class="comment">//1. ServletRequest æ²¡æœ‰å¾—åˆ°æäº¤æ–¹å¼çš„æ–¹æ³•</span></span><br><span class="line">        <span class="comment">//2. ServletRequest çœ‹çœ‹ ServletRequest å­æ¥å£æœ‰æ²¡æœ‰ç›¸å…³æ–¹æ³•</span></span><br><span class="line">        <span class="comment">//3. è€å¸ˆå°æŠ€å·§:ctrl+alt+b =&gt; å¯ä»¥çœ‹åˆ°æ¥å£çš„å­æ¥å£å’Œå®ç°å­ç±»</span></span><br><span class="line">        <span class="comment">//4. æŠŠ servletReqeust è½¬æˆ HttpServletRequest å¼•ç”¨</span></span><br><span class="line">        <span class="comment">//5. ä»ç„¶æ˜¯ Java åŸºç¡€çš„ OOP</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">httpServletRequest</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> httpServletRequest.getMethod();</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;GET&quot;</span>.equals(method)) &#123;</span><br><span class="line">            doGet();    <span class="comment">//ç”¨ doGet() å¤„ç† GET è¯·æ±‚ &#125;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;POST&quot;</span>.equals(method)) &#123;</span><br><span class="line">            doPost();   <span class="comment">//ç”¨ doPost() å¤„ç† POST è¯·æ±‚</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;doGetè¢«è°ƒç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;doPostè¢«è°ƒç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="8-5-6-é€šè¿‡ç»§æ‰¿-HttpServlet-å¼€å‘-Servlet"><a href="#8-5-6-é€šè¿‡ç»§æ‰¿-HttpServlet-å¼€å‘-Servlet" class="headerlink" title="8.5.6 é€šè¿‡ç»§æ‰¿ HttpServlet å¼€å‘ Servlet"></a>8.5.6 é€šè¿‡ç»§æ‰¿ HttpServlet å¼€å‘ Servlet</h3><ul><li>HttpServlet ä»‹ç»</li></ul><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œéƒ½æ˜¯ä½¿ç”¨ç»§æ‰¿ HttpServlet ç±»å¼€å‘ Servlet ç¨‹åºï¼Œæ›´åŠ æ–¹ä¾¿</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230707112036074.png" alt="image-20230707112036074" style="zoom:50%;" /><ul><li>HttpServlet ä»‹ç»</li></ul><p>1ã€é€šè¿‡ç»§æ‰¿ HttpServlet å¼€å‘ä¸€ä¸ª HiServlet</p><p>2ã€å½“æµè§ˆå™¨ è®¿é—® <a href="http://localhost:8080/web">http://localhost:8080/web</a> åº”ç”¨å&#x2F;hiServlet æ—¶ï¼Œåå°è¾“å‡º â€œhi HiServeltâ€</p><ul><li>å…·ä½“çš„å¼€å‘æ­¥éª¤</li></ul><ol><li>ç¼–å†™ä¸€ä¸ªç±»å»ç»§æ‰¿ HttpServlet ç±»</li><li>æ ¹æ®ä¸šåŠ¡éœ€è¦é‡å†™ doGet æˆ– doPost æ–¹æ³•</li><li>åˆ° web.xml ä¸­çš„é…ç½® Servlet ç¨‹åº</li></ol><ul><li>åº”ç”¨å®ä¾‹</li></ul><p>1.åˆ›å»ºHiServlet.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/7/7</span></span><br><span class="line"><span class="comment"> * 13:46</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HiServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;HiServlet doGet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;HiServlet doPost&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.ä¿®æ”¹web.xmlå®Œæˆé…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HiServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.study.servlet.HiServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HiServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hiServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.å®Œæˆæµ‹è¯•</p><p><a href="http://localhost:8080/servlet/hiServlet">http://localhost:8080/servlet/hiServlet</a></p><h3 id="8-5-7-IDEA-å¼€å‘-Servlet-ç¨‹åº"><a href="#8-5-7-IDEA-å¼€å‘-Servlet-ç¨‹åº" class="headerlink" title="8.5.7 IDEA å¼€å‘ Servlet ç¨‹åº"></a>8.5.7 IDEA å¼€å‘ Servlet ç¨‹åº</h3><ul><li>è¯´æ˜</li></ul><p>ç¼–æ‰‹åŠ¨å¼€å‘ Servlet éœ€è¦ç¨‹åºå‘˜è‡ªå·±é…ç½® Servlet ,æ¯”è¾ƒéº»çƒ¦ï¼Œåœ¨å·¥ä½œä¸­ï¼Œç›´æ¥ä½¿ç”¨ IDEA å¼€å‘ Servlet ä¼šæ›´åŠ æ–¹ä¾¿</p><ul><li>åº”ç”¨å®ä¾‹</li></ul><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230707140732732.png" alt="image-20230707140732732" style="zoom:50%;" /><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230707140642567.png" alt="image-20230707140642567" style="zoom: 50%;" /><h3 id="8-5-8-Servlet-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#8-5-8-Servlet-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="8.5.8 Servlet æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>8.5.8 Servlet æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><ol><li>Servlet æ˜¯ä¸€ä¸ªä¾›å…¶ä»– Java ç¨‹åºï¼ˆServlet å¼•æ“ï¼‰ è°ƒç”¨çš„ Java ç±»ï¼Œ ä¸èƒ½ç‹¬ç«‹è¿è¡Œ</li><li>é’ˆå¯¹æµè§ˆå™¨çš„å¤šæ¬¡ Servlet è¯·æ±‚ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨åªä¼šåˆ›å»ºä¸€ä¸ª Servlet å®ä¾‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ Servlet å®ä¾‹å¯¹è±¡ä¸€æ—¦åˆ›å»ºï¼Œå®ƒå°±ä¼šé©»ç•™åœ¨å†…å­˜ä¸­ï¼Œä¸ºåç»­çš„å…¶å®ƒè¯·æ±‚æœåŠ¡ï¼Œç›´è‡³web å®¹å™¨é€€å‡º&#x2F;æˆ–è€… redeploy è¯¥ web åº”ç”¨ï¼Œservlet å®ä¾‹å¯¹è±¡æ‰ä¼šé”€æ¯ ã€ç¤ºæ„å›¾ã€‘</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230710085610919.png" alt="image-20230710085610919" style="zoom:50%;" /><ol start="3"><li><p>åœ¨ Servlet çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ï¼Œinit æ–¹æ³•åªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚è€Œå¯¹æ¯æ¬¡è¯·æ±‚éƒ½å¯¼è‡´ Servlet å¼•æ“è°ƒç”¨ä¸€æ¬¡ servlet çš„ service æ–¹æ³•ã€‚</p></li><li><p>å¯¹äºæ¯æ¬¡è®¿é—®è¯·æ±‚ï¼ŒServlet å¼•æ“éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ HttpServletRequest è¯·æ±‚å¯¹è±¡å’Œä¸€ä¸ªæ–°çš„ HttpServletResponse å“åº”å¯¹è±¡ï¼Œç„¶åå°†è¿™ä¸¤ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒè°ƒç”¨çš„ Servletçš„ service()æ–¹æ³•ï¼Œservice æ–¹æ³•å†æ ¹æ®è¯·æ±‚æ–¹å¼åˆ†åˆ«è°ƒç”¨ doXXX æ–¹æ³•</p></li><li><p>å¦‚æœåœ¨<servlet>å…ƒç´ ä¸­é…ç½®äº†ä¸€ä¸ª<load-on-startup>å…ƒç´ ï¼Œé‚£ä¹ˆ WEB åº”ç”¨ç¨‹åºåœ¨å¯åŠ¨æ—¶ï¼Œå°±ä¼šè£…è½½å¹¶åˆ›å»º Servlet çš„å®ä¾‹å¯¹è±¡ã€ä»¥åŠè°ƒç”¨ Servlet å®ä¾‹å¯¹è±¡çš„ init()æ–¹æ³•         åº”ç”¨åœºæ™¯ï¼š(å®šæ—¶å‘é€é‚®ä»¶çš„æœåŠ¡&#x2F;è‡ªåŠ¨å¯åŠ¨-&gt;å®Œæˆä»»åŠ¡)</p></li></ol><h2 id="8-6-Servlet-æ³¨è§£æ–¹å¼"><a href="#8-6-Servlet-æ³¨è§£æ–¹å¼" class="headerlink" title="8.6 Servlet - æ³¨è§£æ–¹å¼"></a>8.6 Servlet - æ³¨è§£æ–¹å¼</h2><h3 id="8-6-1-å¿«é€Ÿå…¥é—¨"><a href="#8-6-1-å¿«é€Ÿå…¥é—¨" class="headerlink" title="8.6.1 å¿«é€Ÿå…¥é—¨"></a>8.6.1 å¿«é€Ÿå…¥é—¨</h3><ul><li>å…·ä½“æ­¥éª¤</li></ul><ol><li><p>ç¼–å†™ç±»OkServletå»ç»§æ‰¿HttpServlet</p></li><li><p>æ³¨è§£æ–¹å¼é…ç½®OkServlet, ä¸€ä¸ªServletæ”¯æŒé…ç½®å¤šä¸ªurlPattern</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.servlet.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/7/7</span></span><br><span class="line"><span class="comment"> * 14:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * 1.æ³¨è§£æ–¹å¼é…ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@WebServlet</span>æ˜¯ä¸€ä¸ªæ³¨è§£</span></span><br><span class="line"><span class="comment"> * 2.æºç ï¼š</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Target</span>(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Retention</span>(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Documented</span></span></span><br><span class="line"><span class="comment"> * public <span class="doctag">@interface</span> WebServlet &#123;</span></span><br><span class="line"><span class="comment"> *     String name() default &quot;&quot;;</span></span><br><span class="line"><span class="comment"> *     String[] value() default &#123;&#125;;</span></span><br><span class="line"><span class="comment"> *     String[] urlPatterns() default &#123;&#125;;</span></span><br><span class="line"><span class="comment"> *     int loadOnStartup() default -1;</span></span><br><span class="line"><span class="comment"> *     WebInitParam[] initParams() default &#123;&#125;;</span></span><br><span class="line"><span class="comment"> *     boolean asyncSupported() default false;</span></span><br><span class="line"><span class="comment"> *     String smallIcon() default &quot;&quot;;</span></span><br><span class="line"><span class="comment"> *     String largeIcon() default &quot;&quot;;</span></span><br><span class="line"><span class="comment"> *     String description() default &quot;&quot;;</span></span><br><span class="line"><span class="comment"> *     String displayName() default &quot;&quot;;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> * 3.urlPatterns å¯¹åº” &lt;url-patterns&gt;&lt;url-patterns/&gt;</span></span><br><span class="line"><span class="comment"> * 4.&#123;&quot;/ok1&quot;,&quot;/ok2&quot;&#125; å¯ä»¥ç»™OkServleté…ç½®å¤šä¸ªurl-pattern</span></span><br><span class="line"><span class="comment"> * 5.ç”¨æˆ·åœ¨æµè§ˆå™¨å¯ä»¥è¿™æ ·è®¿é—®ï¼šhttp://localhost:8080/servlet/ok2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(urlPatterns = &#123;&quot;/ok1&quot;,&quot;/ok2&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OkServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ³¨è§£æ–¹å¼ OkServlet doPost&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ³¨è§£æ–¹å¼ OkServlet doGet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>æ³¨è§£æ–¹å¼æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p><p>â€”â€”Tomcatå¯¹åŒ…è¿›è¡Œæ‰«æï¼Œå¦‚æœå‘ç°æŸä¸ªç±»è¢«@WebServletä¿®é¥°ï¼Œå°±è¯´æ˜è¯¥ç±»æ˜¯Servletï¼Œå°±è¯»å–æ³¨è§£ä¸­çš„urlPatternsï¼Œç„¶åè¿›è¡Œä¸‹ä¸€æ­¥â€¦â€¦(çœ‹è¯·æ±‚çš„èµ„æºæ˜¯å¦èƒ½ä»æ³¨è§£ä¸­æ‰¾åˆ°â€¦â€¦ï¼Œæ‰¾åˆ°åˆ™å¾—åˆ°urlPatternsï¼Œå»hashmapä¸­çœ‹è¯¥servletæ˜¯å¦å·²ç»åŠ è½½è¿‡â€¦â€¦)</p><h3 id="8-6-2-Servlet-urlPattern-é…ç½®"><a href="#8-6-2-Servlet-urlPattern-é…ç½®" class="headerlink" title="8.6.2 Servlet urlPattern é…ç½®"></a>8.6.2 Servlet urlPattern é…ç½®</h3><h4 id="8-6-2-1-ç²¾ç¡®åŒ¹é…"><a href="#8-6-2-1-ç²¾ç¡®åŒ¹é…" class="headerlink" title="8.6.2.1 ç²¾ç¡®åŒ¹é…"></a>8.6.2.1 ç²¾ç¡®åŒ¹é…</h4><p>â€”â€”æœ€ç®€å•ã€æ™®éçš„è·¯å¾„è®¾ç½®æ–¹å¼</p><p>é…ç½®è·¯å¾„ : @WebServlet(â€œ&#x2F;ok&#x2F;zsâ€)</p><p>è®¿é—® servlet: localhost:8080&#x2F;servlet&#x2F;ok&#x2F;zs</p><h4 id="8-6-2-2-ç›®å½•åŒ¹é…"><a href="#8-6-2-2-ç›®å½•åŒ¹é…" class="headerlink" title="8.6.2.2 ç›®å½•åŒ¹é…"></a>8.6.2.2 ç›®å½•åŒ¹é…</h4><p>â€”â€” * è¡¨ç¤ºï¼šé›¶å±‚ã€ä»»æ„å•å±‚ã€ä»»æ„å¤šå±‚</p><p>é…ç½®è·¯å¾„ : @WebServlet(â€œ&#x2F;ok&#x2F;*â€)</p><p>è®¿é—®æ–‡ä»¶: localhost:8080&#x2F;servlet&#x2F;ok&#x2F;aaa localhost:8080&#x2F;servlet&#x2F;ok&#x2F;bbb</p><h4 id="8-6-2-3-æ‰©å±•ååŒ¹é…"><a href="#8-6-2-3-æ‰©å±•ååŒ¹é…" class="headerlink" title="8.6.2.3 æ‰©å±•ååŒ¹é…"></a>8.6.2.3 æ‰©å±•ååŒ¹é…</h4><p>â€”â€”å¿…é¡»ä¿è¯åç¼€ä¸º .action</p><p>é…ç½®è·¯å¾„ : @WebServlet(â€œ**.actionâ€)*</p><p>è®¿é—®æ–‡ä»¶: localhost:8080&#x2F;hsp&#x2F;zs.action localhost:8080&#x2F;hsp&#x2F;ls.action</p><p>æç¤º: @WebServlet(â€œ&#x2F;*.actionâ€) , ä¸èƒ½å¸¦ &#x2F; , å¦åˆ™ tomcat æŠ¥é”™</p><h4 id="8-6-2-4-ä»»æ„åŒ¹é…"><a href="#8-6-2-4-ä»»æ„åŒ¹é…" class="headerlink" title="8.6.2.4 ä»»æ„åŒ¹é…"></a>8.6.2.4 ä»»æ„åŒ¹é…</h4><p>é…ç½®è·¯å¾„ : @WebServlet(â€œ&#x2F;â€œ) @WebServlet(â€œ&#x2F;**â€)*</p><p>è®¿é—®æ–‡ä»¶: localhost:8080&#x2F;hsp&#x2F;aaa localhost:8080&#x2F;hsp&#x2F;bbb localhost:8080&#x2F;hsp&#x2F;ccc</p><p>æé†’ï¼š &#x2F; å’Œ &#x2F;*çš„é…ç½®ï¼Œ ä¼šåŒ¹é…æ‰€æœ‰çš„è¯·æ±‚ï¼Œ è¿™ä¸ªæ¯”è¾ƒä¸å®ç”¨</p><h4 id="8-6-2-5-æ³¨æ„äº‹é¡¹å’Œä½¿ç”¨ç»†èŠ‚"><a href="#8-6-2-5-æ³¨æ„äº‹é¡¹å’Œä½¿ç”¨ç»†èŠ‚" class="headerlink" title="8.6.2.5 æ³¨æ„äº‹é¡¹å’Œä½¿ç”¨ç»†èŠ‚"></a>8.6.2.5 æ³¨æ„äº‹é¡¹å’Œä½¿ç”¨ç»†èŠ‚</h4><p>1ã€ å½“ Servlet é…ç½®äº† â€œ&#x2F;â€œ, ä¼šè¦†ç›– tomcat çš„ DefaultServlet,ï¼ˆå½“å…¶ä»–çš„ utl-pattern éƒ½åŒ¹é…ä¸ä¸Šæ—¶ ï¼Œéƒ½ä¼šèµ°è¿™ä¸ª Servlet, è¿™æ ·å¯ä»¥æ‹¦æˆªåˆ°å…¶å®ƒé™æ€èµ„æº,æ¯”å¦‚D:\hspedu_javaweb_temp\hspedu_servlet\web\hi.html [ä¸¾ä¾‹]æŸ¥çœ‹ï¼štomcat&#x2F;conf&#x2F;web.xml , é…ç½®çš„ DefaultServlet</p><p>ã€ŒThe default servlet for all web applications, that serves static resources.è¿™ä¸ªé»˜è®¤çš„ servlet æ˜¯å¤„ç†é™æ€èµ„æºçš„ï¼Œä¸€æ—¦æ‹¦æˆªï¼Œé™æ€èµ„æºä¸èƒ½å¤„ç†ã€</p><p>2ã€å½“ Servelt é…ç½®äº† â€œ&#x2F;**â€, è¡¨ç¤ºå¯ä»¥åŒ¹é…ä»»æ„è®¿é—®è·¯å¾„*</p><p>3ã€æç¤º: å»ºè®®ä¸è¦ä½¿ç”¨ &#x2F; å’Œ &#x2F;*, å»ºè®®å°½é‡ä½¿ç”¨ç²¾ç¡®åŒ¹é…</p><p>4ã€ä¼˜å…ˆçº§éµå®ˆ: ç²¾ç¡®è·¯å¾„ &gt; ç›®å½•è·¯å¾„ &gt; æ‰©å±•åè·¯å¾„ &gt; &#x2F;* &gt; &#x2F;</p><h2 id="8-8-ğŸŒŸå…³è”ç¯‡ï¼š-HTTP-åè®®"><a href="#8-8-ğŸŒŸå…³è”ç¯‡ï¼š-HTTP-åè®®" class="headerlink" title="8.8 ğŸŒŸå…³è”ç¯‡ï¼š HTTP åè®®"></a>8.8 ğŸŒŸå…³è”ç¯‡ï¼š HTTP åè®®</h2><h3 id="8-8-1è¯·æ±‚å¤´ã€å“åº”å¤´ä»‹ç»"><a href="#8-8-1è¯·æ±‚å¤´ã€å“åº”å¤´ä»‹ç»" class="headerlink" title="8.8.1è¯·æ±‚å¤´ã€å“åº”å¤´ä»‹ç»"></a>8.8.1è¯·æ±‚å¤´ã€å“åº”å¤´ä»‹ç»</h3><p><a href="https://github.com/Tangjiayang/picodemo/blob/main/img/HTTP%E5%B8%B8%E8%A7%81%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94%E5%A4%B4-%E8%AF%B4%E6%98%8E.pdf">https://github.com/Tangjiayang/picodemo/blob/main/img/HTTP%E5%B8%B8%E8%A7%81%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94%E5%A4%B4-%E8%AF%B4%E6%98%8E.pdf</a></p><h3 id="8-8-2HTTPçŠ¶æ€ç "><a href="#8-8-2HTTPçŠ¶æ€ç " class="headerlink" title="8.8.2HTTPçŠ¶æ€ç "></a>8.8.2HTTPçŠ¶æ€ç </h3><p>å½“æµè§ˆè€…è®¿é—®ä¸€ä¸ªç½‘é¡µæ—¶ï¼Œæµè§ˆè€…çš„æµè§ˆå™¨ä¼šå‘ç½‘é¡µæ‰€åœ¨æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ã€‚å½“æµè§ˆå™¨æ¥æ”¶å¹¶æ˜¾ç¤ºç½‘é¡µå‰ï¼Œæ­¤ç½‘é¡µæ‰€åœ¨çš„æœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªåŒ…å«HTTPçŠ¶æ€ç çš„ä¿¡æ¯å¤´ï¼ˆserver headerï¼‰ç”¨ä»¥å“åº”æµè§ˆå™¨çš„è¯·æ±‚ã€‚</p><p>HTTPçŠ¶æ€ç çš„è‹±æ–‡ä¸ºHTTP Status Codeã€‚</p><h4 id="ä¸‹é¢æ˜¯å¸¸è§çš„HTTPçŠ¶æ€ç ï¼š"><a href="#ä¸‹é¢æ˜¯å¸¸è§çš„HTTPçŠ¶æ€ç ï¼š" class="headerlink" title="ä¸‹é¢æ˜¯å¸¸è§çš„HTTPçŠ¶æ€ç ï¼š"></a>ä¸‹é¢æ˜¯å¸¸è§çš„HTTPçŠ¶æ€ç ï¼š</h4><p><strong>200 -</strong> <strong>è¯·æ±‚æˆåŠŸ</strong></p><p><strong>301 -</strong> <strong>èµ„æºï¼ˆç½‘é¡µç­‰ï¼‰è¢«æ°¸ä¹…è½¬ç§»åˆ°å…¶å®ƒURL</strong></p><p><strong>404 -</strong> <strong>è¯·æ±‚çš„èµ„æºï¼ˆç½‘é¡µç­‰ï¼‰ä¸å­˜åœ¨</strong></p><p><strong>500 -</strong> <strong>å†…éƒ¨æœåŠ¡å™¨é”™è¯¯</strong></p><h4 id="HTTPçŠ¶æ€ç åˆ†ç±»"><a href="#HTTPçŠ¶æ€ç åˆ†ç±»" class="headerlink" title="HTTPçŠ¶æ€ç åˆ†ç±»"></a>HTTPçŠ¶æ€ç åˆ†ç±»</h4><p>HTTPçŠ¶æ€ç ç”±ä¸‰ä¸ªåè¿›åˆ¶æ•°å­—ç»„æˆï¼Œç¬¬ä¸€ä¸ªåè¿›åˆ¶æ•°å­—å®šä¹‰äº†çŠ¶æ€ç çš„ç±»å‹ï¼Œåä¸¤ä¸ªæ•°å­—æ²¡æœ‰åˆ†ç±»çš„ä½œç”¨ã€‚HTTPçŠ¶æ€ç å…±åˆ†ä¸º5ç§ç±»å‹ï¼š</p><table><thead><tr><th>HTTPçŠ¶æ€ç åˆ†ç±»</th><th></th></tr></thead><tbody><tr><td><strong>åˆ†ç±»</strong></td><td><strong>åˆ†ç±»æè¿°</strong></td></tr><tr><td><strong>1*</strong>*</td><td><strong>ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œéœ€è¦è¯·æ±‚è€…ç»§ç»­æ‰§è¡Œæ“ä½œ</strong></td></tr><tr><td><strong>2*</strong>*</td><td><strong>æˆåŠŸï¼Œæ“ä½œè¢«æˆåŠŸæ¥æ”¶å¹¶å¤„ç†</strong></td></tr><tr><td><strong>3*</strong>*</td><td><strong>é‡å®šå‘ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œä»¥å®Œæˆè¯·æ±‚</strong></td></tr><tr><td><strong>4*</strong>*</td><td><strong>å®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚åŒ…å«è¯­æ³•é”™è¯¯æˆ–æ— æ³•å®Œæˆè¯·æ±‚</strong></td></tr><tr><td><strong>5*</strong>*</td><td><strong>æœåŠ¡å™¨é”™è¯¯ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯</strong></td></tr></tbody></table><h4 id="HTTPçŠ¶æ€ç åˆ—è¡¨"><a href="#HTTPçŠ¶æ€ç åˆ—è¡¨" class="headerlink" title="HTTPçŠ¶æ€ç åˆ—è¡¨:"></a>HTTPçŠ¶æ€ç åˆ—è¡¨:</h4><table><thead><tr><th>çŠ¶æ€ç </th><th><strong>çŠ¶æ€ç è‹±æ–‡åç§°</strong></th><th><strong>ä¸­æ–‡æè¿°</strong></th></tr></thead><tbody><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http100">100</a></strong></td><td><strong>Continue</strong></td><td><strong>ç»§ç»­ã€‚å®¢æˆ·ç«¯åº”ç»§ç»­å…¶è¯·æ±‚</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http101">101</a></strong></td><td><strong>Switching Protocols</strong></td><td><strong>åˆ‡æ¢åè®®ã€‚æœåŠ¡å™¨æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ‡æ¢åè®®ã€‚åªèƒ½åˆ‡æ¢åˆ°æ›´é«˜çº§çš„åè®®ï¼Œä¾‹å¦‚ï¼Œåˆ‡æ¢åˆ°HTTPçš„æ–°ç‰ˆæœ¬åè®®</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http200">200</a></strong></td><td><strong>OK</strong></td><td><strong>è¯·æ±‚æˆåŠŸã€‚ä¸€èˆ¬ç”¨äºGETä¸POSTè¯·æ±‚</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http201">201</a></strong></td><td><strong>Created</strong></td><td><strong>å·²åˆ›å»ºã€‚æˆåŠŸè¯·æ±‚å¹¶åˆ›å»ºäº†æ–°çš„èµ„æº</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http200">202</a></strong></td><td><strong>Accepted</strong></td><td><strong>å·²æ¥å—ã€‚å·²ç»æ¥å—è¯·æ±‚ï¼Œä½†æœªå¤„ç†å®Œæˆ</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http203">203</a></strong></td><td><strong>Non-Authoritative Information</strong></td><td><strong>éæˆæƒä¿¡æ¯ã€‚è¯·æ±‚æˆåŠŸã€‚ä½†è¿”å›çš„metaä¿¡æ¯ä¸åœ¨åŸå§‹çš„æœåŠ¡å™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå‰¯æœ¬</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http204">204</a></strong></td><td><strong>No Content</strong></td><td><strong>æ— å†…å®¹ã€‚æœåŠ¡å™¨æˆåŠŸå¤„ç†ï¼Œä½†æœªè¿”å›å†…å®¹ã€‚åœ¨æœªæ›´æ–°ç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œå¯ç¡®ä¿æµè§ˆå™¨ç»§ç»­æ˜¾ç¤ºå½“å‰æ–‡æ¡£</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http205">205</a></strong></td><td><strong>Reset Content</strong></td><td><strong>é‡ç½®å†…å®¹ã€‚æœåŠ¡å™¨å¤„ç†æˆåŠŸï¼Œç”¨æˆ·ç»ˆç«¯ï¼ˆä¾‹å¦‚ï¼šæµè§ˆå™¨ï¼‰åº”é‡ç½®æ–‡æ¡£è§†å›¾ã€‚å¯é€šè¿‡æ­¤è¿”å›ç æ¸…é™¤æµè§ˆå™¨çš„è¡¨å•åŸŸ</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http206">206</a></strong></td><td><strong>Partial Content</strong></td><td><strong>éƒ¨åˆ†å†…å®¹ã€‚æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†éƒ¨åˆ†GETè¯·æ±‚</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http300">300</a></strong></td><td><strong>Multiple Choices</strong></td><td><strong>å¤šç§é€‰æ‹©ã€‚è¯·æ±‚çš„èµ„æºå¯åŒ…æ‹¬å¤šä¸ªä½ç½®ï¼Œç›¸åº”å¯è¿”å›ä¸€ä¸ªèµ„æºç‰¹å¾ä¸åœ°å€çš„åˆ—è¡¨ç”¨äºç”¨æˆ·ç»ˆç«¯ï¼ˆä¾‹å¦‚ï¼šæµè§ˆå™¨ï¼‰é€‰æ‹©</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http301">301</a></strong></td><td><strong>Moved Permanently</strong></td><td><strong>æ°¸ä¹…ç§»åŠ¨ã€‚è¯·æ±‚çš„èµ„æºå·²è¢«æ°¸ä¹…çš„ç§»åŠ¨åˆ°æ–°URIï¼Œè¿”å›ä¿¡æ¯ä¼šåŒ…æ‹¬æ–°çš„URIï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å®šå‘åˆ°æ–°URIã€‚ä»Šåä»»ä½•æ–°çš„è¯·æ±‚éƒ½åº”ä½¿ç”¨æ–°çš„URIä»£æ›¿</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http302">302</a></strong></td><td><strong>Found</strong></td><td><strong>ä¸´æ—¶ç§»åŠ¨ã€‚ä¸301ç±»ä¼¼ã€‚ä½†èµ„æºåªæ˜¯ä¸´æ—¶è¢«ç§»åŠ¨ã€‚å®¢æˆ·ç«¯åº”ç»§ç»­ä½¿ç”¨åŸæœ‰URI</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http303">303</a></strong></td><td><strong>See Other</strong></td><td><strong>æŸ¥çœ‹å…¶å®ƒåœ°å€ã€‚ä¸301ç±»ä¼¼ã€‚ä½¿ç”¨GETå’ŒPOSTè¯·æ±‚æŸ¥çœ‹</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http304">304</a></strong></td><td><strong>Not Modified</strong></td><td><strong>æœªä¿®æ”¹ã€‚æ‰€è¯·æ±‚çš„èµ„æºæœªä¿®æ”¹ï¼ŒæœåŠ¡å™¨è¿”å›æ­¤çŠ¶æ€ç æ—¶ï¼Œä¸ä¼šè¿”å›ä»»ä½•èµ„æºã€‚å®¢æˆ·ç«¯é€šå¸¸ä¼šç¼“å­˜è®¿é—®è¿‡çš„èµ„æºï¼Œé€šè¿‡æä¾›ä¸€ä¸ªå¤´ä¿¡æ¯æŒ‡å‡ºå®¢æˆ·ç«¯å¸Œæœ›åªè¿”å›åœ¨æŒ‡å®šæ—¥æœŸä¹‹åä¿®æ”¹çš„èµ„æº</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http305">305</a></strong></td><td><strong>Use Proxy</strong></td><td><strong>ä½¿ç”¨ä»£ç†ã€‚æ‰€è¯·æ±‚çš„èµ„æºå¿…é¡»é€šè¿‡ä»£ç†è®¿é—®</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http306">306</a></strong></td><td><strong>Unused</strong></td><td><strong>å·²ç»è¢«åºŸå¼ƒçš„HTTPçŠ¶æ€ç </strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http307">307</a></strong></td><td><strong>Temporary Redirect</strong></td><td><strong>ä¸´æ—¶é‡å®šå‘ã€‚ä¸302ç±»ä¼¼ã€‚ä½¿ç”¨GETè¯·æ±‚é‡å®šå‘</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http400">400</a></strong></td><td><strong>Bad Request</strong></td><td><strong>å®¢æˆ·ç«¯è¯·æ±‚çš„è¯­æ³•é”™è¯¯ï¼ŒæœåŠ¡å™¨æ— æ³•ç†è§£</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http401">401</a></strong></td><td><strong>Unauthorized</strong></td><td><strong>è¯·æ±‚è¦æ±‚ç”¨æˆ·çš„èº«ä»½è®¤è¯</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http402">402</a></strong></td><td><strong>Payment Required</strong></td><td><strong>ä¿ç•™ï¼Œå°†æ¥ä½¿ç”¨</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http403">403</a></strong></td><td><strong>Forbidden</strong></td><td><strong>æœåŠ¡å™¨ç†è§£è¯·æ±‚å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æ‰§è¡Œæ­¤è¯·æ±‚</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http404">404</a></strong></td><td><strong>Not Found</strong></td><td><strong>æœåŠ¡å™¨æ— æ³•æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚æ‰¾åˆ°èµ„æºï¼ˆç½‘é¡µï¼‰ã€‚é€šè¿‡æ­¤ä»£ç ï¼Œç½‘ç«™è®¾è®¡äººå‘˜å¯è®¾ç½®â€æ‚¨æ‰€è¯·æ±‚çš„èµ„æºæ— æ³•æ‰¾åˆ°â€çš„ä¸ªæ€§é¡µé¢</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http405">405</a></strong></td><td><strong>Method Not Allowed</strong></td><td><strong>å®¢æˆ·ç«¯è¯·æ±‚ä¸­çš„æ–¹æ³•è¢«ç¦æ­¢</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http406">406</a></strong></td><td><strong>Not Acceptable</strong></td><td><strong>æœåŠ¡å™¨æ— æ³•æ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚çš„å†…å®¹ç‰¹æ€§å®Œæˆè¯·æ±‚</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http407">407</a></strong></td><td><strong>Proxy Authentication Required</strong></td><td><strong>è¯·æ±‚è¦æ±‚ä»£ç†çš„èº«ä»½è®¤è¯ï¼Œä¸401ç±»ä¼¼ï¼Œä½†è¯·æ±‚è€…åº”å½“ä½¿ç”¨ä»£ç†è¿›è¡Œæˆæƒ</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http408">408</a></strong></td><td><strong>Request Time-out</strong></td><td><strong>æœåŠ¡å™¨ç­‰å¾…å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ—¶é—´è¿‡é•¿ï¼Œè¶…æ—¶</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http409">409</a></strong></td><td><strong>Conflict</strong></td><td><strong>æœåŠ¡å™¨å®Œæˆå®¢æˆ·ç«¯çš„PUTè¯·æ±‚æ˜¯å¯èƒ½è¿”å›æ­¤ä»£ç ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿäº†å†²çª</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http410">410</a></strong></td><td><strong>Gone</strong></td><td><strong>å®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºå·²ç»ä¸å­˜åœ¨ã€‚410ä¸åŒäº404ï¼Œå¦‚æœèµ„æºä»¥å‰æœ‰ç°åœ¨è¢«æ°¸ä¹…åˆ é™¤äº†å¯ä½¿ç”¨410ä»£ç ï¼Œç½‘ç«™è®¾è®¡äººå‘˜å¯é€šè¿‡301ä»£ç æŒ‡å®šèµ„æºçš„æ–°ä½ç½®</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http411">411</a></strong></td><td><strong>Length Required</strong></td><td><strong>æœåŠ¡å™¨æ— æ³•å¤„ç†å®¢æˆ·ç«¯å‘é€çš„ä¸å¸¦Content-Lengthçš„è¯·æ±‚ä¿¡æ¯</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http412">412</a></strong></td><td><strong>Precondition Failed</strong></td><td><strong>å®¢æˆ·ç«¯è¯·æ±‚ä¿¡æ¯çš„å…ˆå†³æ¡ä»¶é”™è¯¯</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http413">413</a></strong></td><td><strong>Request Entity Too Large</strong></td><td><strong>ç”±äºè¯·æ±‚çš„å®ä½“è¿‡å¤§ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ï¼Œå› æ­¤æ‹’ç»è¯·æ±‚ã€‚ä¸ºé˜²æ­¢å®¢æˆ·ç«¯çš„è¿ç»­è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šå…³é—­è¿æ¥ã€‚å¦‚æœåªæ˜¯æœåŠ¡å™¨æš‚æ—¶æ— æ³•å¤„ç†ï¼Œåˆ™ä¼šåŒ…å«ä¸€ä¸ªRetry-Afterçš„å“åº”ä¿¡æ¯</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http414">414</a></strong></td><td><strong>Request-URI Too Large</strong></td><td><strong>è¯·æ±‚çš„URIè¿‡é•¿ï¼ˆURIé€šå¸¸ä¸ºç½‘å€ï¼‰ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http415">415</a></strong></td><td><strong>Unsupported Media Type</strong></td><td><strong>æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚é™„å¸¦çš„åª’ä½“æ ¼å¼</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http416">416</a></strong></td><td><strong>Requested range not satisfiable</strong></td><td><strong>å®¢æˆ·ç«¯è¯·æ±‚çš„èŒƒå›´æ— æ•ˆ</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http417">417</a></strong></td><td><strong>Expectation Failed</strong></td><td><strong>æœåŠ¡å™¨æ— æ³•æ»¡è¶³Expectçš„è¯·æ±‚å¤´ä¿¡æ¯</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http500">500</a></strong></td><td><strong>Internal Server Error</strong></td><td><strong>æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http501">501</a></strong></td><td><strong>Not Implemented</strong></td><td><strong>æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚çš„åŠŸèƒ½ï¼Œæ— æ³•å®Œæˆè¯·æ±‚</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http502">502</a></strong></td><td><strong>Bad Gateway</strong></td><td><strong>å……å½“ç½‘å…³æˆ–ä»£ç†çš„æœåŠ¡å™¨ï¼Œä»è¿œç«¯æœåŠ¡å™¨æ¥æ”¶åˆ°äº†ä¸€ä¸ªæ— æ•ˆçš„è¯·æ±‚</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http503">503</a></strong></td><td><strong>Service Unavailable</strong></td><td><strong>ç”±äºè¶…è½½æˆ–ç³»ç»Ÿç»´æŠ¤ï¼ŒæœåŠ¡å™¨æš‚æ—¶çš„æ— æ³•å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å»¶æ—¶çš„é•¿åº¦å¯åŒ…å«åœ¨æœåŠ¡å™¨çš„Retry-Afterå¤´ä¿¡æ¯ä¸­</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http504">504</a></strong></td><td><strong>Gateway Time-out</strong></td><td><strong>å……å½“ç½‘å…³æˆ–ä»£ç†çš„æœåŠ¡å™¨ï¼ŒæœªåŠæ—¶ä»è¿œç«¯æœåŠ¡å™¨è·å–è¯·æ±‚</strong></td></tr><tr><td><strong><a href="https://www.w3cschool.cn/http/g9prxfmx.html#http505">505</a></strong></td><td><strong>HTTP Version not supported</strong></td><td><strong>æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚çš„HTTPåè®®çš„ç‰ˆæœ¬ï¼Œæ— æ³•å®Œæˆå¤„ç†</strong></td></tr></tbody></table><h3 id="GETè¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´è§£æï¼š"><a href="#GETè¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´è§£æï¼š" class="headerlink" title="GETè¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´è§£æï¼š"></a>GETè¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´è§£æï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230710100130745.png" alt="image-20230710100130745"></p><h3 id="POSTè¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´è§£æï¼š"><a href="#POSTè¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´è§£æï¼š" class="headerlink" title="POSTè¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´è§£æï¼š"></a>POSTè¯·æ±‚è¡Œå’Œè¯·æ±‚å¤´è§£æï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230710101351184.png" alt="image-20230710101351184"></p><h3 id="ä½•æ—¶ä½¿ç”¨-get-x2F-post-ï¼Ÿ"><a href="#ä½•æ—¶ä½¿ç”¨-get-x2F-post-ï¼Ÿ" class="headerlink" title="ä½•æ—¶ä½¿ç”¨ get &#x2F; post ï¼Ÿ"></a>ä½•æ—¶ä½¿ç”¨ get &#x2F; post ï¼Ÿ</h3><p>getå’Œpostæ–¹æ³•åŠŸèƒ½ç±»ä¼¼çš„ï¼Œä½¿ç”¨å»ºè®®ï¼š<br>1ã€getæ–¹å¼çš„å®‰å…¨æ€§è¾ƒPostæ–¹å¼è¦å·®äº›ï¼ŒåŒ…å«æœºå¯†ä¿¡æ¯çš„è¯ï¼Œå»ºè®®ç”¨Postæ•°æ®æäº¤æ–¹å¼ï¼›<br>2ã€åœ¨åšæ•°æ®æŸ¥è¯¢æ—¶ï¼Œå»ºè®®ç”¨Getæ–¹å¼ï¼›è€Œåœ¨åšæ•°æ®æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤æ—¶ï¼Œå»ºè®®ç”¨Postæ–¹å¼ï¼›</p><p>åŒºåˆ«è¡¨ç°å¦‚ä¸‹ï¼š</p><ol><li>getæ˜¯ä»æœåŠ¡å™¨ä¸Šè·å–æ•°æ®ï¼Œpostæ˜¯å‘æœåŠ¡å™¨ä¼ é€æ•°æ®ã€‚</li><li>getæ˜¯æŠŠå‚æ•°æ•°æ®é˜Ÿåˆ—åŠ åˆ°æäº¤è¡¨å•çš„ACTIONå±æ€§æ‰€æŒ‡çš„URLä¸­ï¼Œå€¼å’Œè¡¨å•å†…å„ä¸ªå­—æ®µä¸€ä¸€å¯¹åº”ï¼Œåœ¨URLä¸­å¯ä»¥çœ‹åˆ°ã€‚postæ˜¯é€šè¿‡HTTP postæœºåˆ¶ï¼Œå°†è¡¨å•å†…å„ä¸ªå­—æ®µä¸å…¶å†…å®¹æ”¾ç½®åœ¨HTML HEADERå†…ä¸€èµ·ä¼ é€åˆ°ACTIONå±æ€§æ‰€æŒ‡çš„URLåœ°å€ã€‚ç”¨æˆ·çœ‹ä¸åˆ°è¿™ä¸ªè¿‡ç¨‹ã€‚</li><li>å¯¹äºgetæ–¹å¼ï¼ŒæœåŠ¡å™¨ç«¯ç”¨Request.QueryStringè·å–å˜é‡çš„å€¼ï¼Œå¯¹äºpostæ–¹å¼ï¼ŒæœåŠ¡å™¨ç«¯ç”¨Request.Formè·å–æäº¤çš„æ•°æ®ã€‚</li><li>getä¼ é€çš„æ•°æ®é‡è¾ƒå°ï¼Œä¸èƒ½å¤§äº2KBã€‚postä¼ é€çš„æ•°æ®é‡è¾ƒå¤§ï¼Œä¸€èˆ¬è¢«é»˜è®¤ä¸ºä¸å—é™åˆ¶ã€‚ä½†ç†è®ºä¸Šï¼ŒIIS4ä¸­æœ€å¤§é‡ä¸º80KBï¼ŒIIS5ä¸­ä¸º100KBã€‚</li><li>getå®‰å…¨æ€§éå¸¸ä½ï¼Œpostå®‰å…¨æ€§è¾ƒé«˜ã€‚ä½†æ˜¯æ‰§è¡Œæ•ˆç‡å´æ¯”Postæ–¹æ³•å¥½ã€‚</li></ol><p><strong>è‹¥ç¬¦åˆä¸‹åˆ—ä»»ä¸€æƒ…å†µï¼Œåˆ™ç”¨POSTæ–¹æ³•ï¼š</strong></p><ul><li>è¯·æ±‚çš„ç»“æœæœ‰æŒç»­æ€§çš„å‰¯ä½œç”¨ï¼Œä¾‹å¦‚ï¼Œæ•°æ®åº“å†…æ·»åŠ æ–°çš„æ•°æ®è¡Œã€‚</li><li>è‹¥ä½¿ç”¨GETæ–¹æ³•ï¼Œåˆ™è¡¨å•ä¸Šæ”¶é›†çš„æ•°æ®å¯èƒ½è®©URLè¿‡é•¿ã€‚</li><li>è¦ä¼ é€çš„æ•°æ®ä¸æ˜¯é‡‡ç”¨7ä½çš„ASCIIç¼–ç ã€‚</li></ul><p><strong>è‹¥ç¬¦åˆä¸‹åˆ—ä»»ä¸€æƒ…å†µï¼Œåˆ™ç”¨GETæ–¹æ³•ï¼š</strong></p><ul><li>è¯·æ±‚æ˜¯ä¸ºäº†æŸ¥æ‰¾èµ„æºï¼ŒHTMLè¡¨å•æ•°æ®ä»…ç”¨æ¥å¸®åŠ©æœç´¢ã€‚</li><li>è¯·æ±‚ç»“æœæ— æŒç»­æ€§çš„å‰¯ä½œç”¨ã€‚</li><li>æ”¶é›†çš„æ•°æ®åŠHTMLè¡¨å•å†…çš„è¾“å…¥å­—æ®µåç§°çš„æ€»é•¿ä¸è¶…è¿‡1024ä¸ªå­—ç¬¦ã€‚</li></ul><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/qq_47443027/article/details/114696716">https://blog.csdn.net/qq_47443027/article/details/114696716</a></p><h3 id="å“åº”ä½“ï¼š"><a href="#å“åº”ä½“ï¼š" class="headerlink" title="å“åº”ä½“ï¼š"></a>å“åº”ä½“ï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230710211832628.png" alt="image-20230710211832628"></p><h3 id="å¸¸è§çŠ¶æ€ç è¯´æ˜ï¼š"><a href="#å¸¸è§çŠ¶æ€ç è¯´æ˜ï¼š" class="headerlink" title="å¸¸è§çŠ¶æ€ç è¯´æ˜ï¼š"></a>å¸¸è§çŠ¶æ€ç è¯´æ˜ï¼š</h3><h4 id="302"><a href="#302" class="headerlink" title="302"></a>302</h4><p>â€‹èµ„æºè¢«è½¬ç§»äº†ï¼Œè¿”å›ç»™ä½ 302 è¿˜å‘Šè¯‰ä½ è¯¥å»å“ªé‡Œæ‰¾ä¸è§çš„èµ„æºï¼Œå› æ­¤æµè§ˆå™¨éœ€è¦å‘é€ä¸¤æ¬¡è¯·æ±‚æ‰èƒ½è®¿é—®åˆ°åŸæ¥çš„èµ„æº(åªå‘ç”Ÿä¸€æ¬¡302çš„æƒ…å†µ)</p><h4 id="304"><a href="#304" class="headerlink" title="304"></a>304</h4><p>(åœ¨æµè§ˆå™¨å…è®¸ç¼“å­˜çš„æƒ…å†µä¸‹)æµè§ˆå™¨åœ¨è¯·æ±‚æŸèµ„æºæ—¶ï¼Œå¦‚æœæœ‰è¯¥èµ„æºçš„ç¼“å­˜ï¼Œå°±ä¼šæŠŠè¯¥èµ„æºçš„æœ€åä¿®æ”¹æ—¥æœŸä¹Ÿå‘ç»™æœåŠ¡å™¨ã€‚</p><p>å¦‚æœæœ€åä¿®æ”¹æ—¥æœŸ &#x3D; æœåŠ¡å™¨ç«¯è¯¥èµ„æºçš„æœ€åä¿®æ”¹æ—¥æœŸï¼Œåˆ™æœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨è¯·æ±‚çš„èµ„æºæœªä¿®æ”¹è¿‡ï¼Œè¿”å›304ï¼Œä¸è¿”å›èµ„æºç»™æµè§ˆå™¨ï¼Œè®©æµè§ˆå™¨å»è‡ªå·±çš„ç¼“å­˜å»æ‰¾ã€‚</p><h4 id="MIMEç±»å‹"><a href="#MIMEç±»å‹" class="headerlink" title="MIMEç±»å‹"></a>MIMEç±»å‹</h4><h5 id="MIME-ä»‹ç»ï¼š"><a href="#MIME-ä»‹ç»ï¼š" class="headerlink" title="MIME ä»‹ç»ï¼š"></a>MIME ä»‹ç»ï¼š</h5><ol><li><p>MIME æ˜¯ HTTP åè®®ä¸­æ•°æ®ç±»å‹ã€‚ MIME çš„è‹±æ–‡å…¨ç§°æ˜¯â€Multipurpose Internet Mail Extensionsâ€ å¤šåŠŸèƒ½ Internet é‚®ä»¶æ‰©å……æœåŠ¡ã€‚ MIME ç±»å‹çš„æ ¼å¼æ˜¯**â€å¤§ç±»å‹&#x2F;å°ç±»å‹â€**ï¼Œå¹¶ä¸æŸä¸€ç§æ–‡ä»¶çš„æ‰©å±•åç›¸å¯¹åº”</p></li><li><p>åœ¨å“åº”åŒ…çš„Content-Type å°±æœ‰æŒ‡å®š</p></li></ol><h5 id="å¸¸è§çš„-MIME-ç±»å‹ï¼š"><a href="#å¸¸è§çš„-MIME-ç±»å‹ï¼š" class="headerlink" title="å¸¸è§çš„ MIME ç±»å‹ï¼š"></a>å¸¸è§çš„ MIME ç±»å‹ï¼š</h5><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711083211146.png" alt="image-20230711083211146" style="zoom: 67%;" /><h2 id="8-9-ServletConfig"><a href="#8-9-ServletConfig" class="headerlink" title="8.9 ServletConfig"></a>8.9 ServletConfig</h2><h3 id="8-9-1-ServletConfig-åŸºæœ¬ä»‹ç»"><a href="#8-9-1-ServletConfig-åŸºæœ¬ä»‹ç»" class="headerlink" title="8.9.1 ServletConfig åŸºæœ¬ä»‹ç»"></a>8.9.1 ServletConfig åŸºæœ¬ä»‹ç»</h3><ol><li>ServletConfig ç±»æ˜¯ä¸º Servlet ç¨‹åºçš„<strong>é…ç½®ä¿¡æ¯çš„ç±»</strong></li><li>Servlet ç¨‹åºå’Œ ServletConfig å¯¹è±¡éƒ½æ˜¯ç”± Tomcat è´Ÿè´£åˆ›å»º</li><li>Servlet ç¨‹åºé»˜è®¤æ˜¯ç¬¬ 1 æ¬¡è®¿é—®çš„æ—¶å€™åˆ›å»ºï¼Œ <u>ServletConfig åœ¨ Servlet ç¨‹åºåˆ›å»ºæ—¶ï¼Œ å°±åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ ServletConfig å¯¹è±¡</u>(æ¯ä¸ªservletéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„servletConfig)</li></ol><p>8.9.2 ServletConfig ç±»èƒ½å¹²ä»€ä¹ˆ</p><ul><li><p>è·å– Servlet ç¨‹åºçš„ <strong>servlet-name</strong> çš„å€¼</p></li><li><p>è·å–<strong>åˆå§‹åŒ–å‚æ•° init-param</strong></p></li><li><p>è·å– <strong>ServletContext å¯¹è±¡</strong></p></li></ul><h3 id="8-9-3-ServletConfig"><a href="#8-9-3-ServletConfig" class="headerlink" title="8.9.3 ServletConfig"></a>8.9.3 ServletConfig</h3><p>åº”ç”¨å®ä¾‹</p><p>â— éœ€æ±‚: ç¼–å†™ DBServlet.java å®Œæˆå¦‚ä¸‹åŠŸèƒ½</p><ol><li><p>åœ¨ web.xml é…ç½®è¿æ¥ mysql çš„ç”¨æˆ·åå’Œå¯†ç </p></li><li><p>åœ¨ DBServlet æ‰§è¡Œ doGet()&#x2F;doPost() æ—¶ï¼Œå¯ä»¥è·å–åˆ° web.xml é…ç½®çš„ç”¨æˆ·åå’Œå¯†ç </p></li><li><p>ç¤ºæ„å›¾(æ€è·¯åˆ†æ)</p></li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711084923867.png" alt="image-20230711084923867" style="zoom: 50%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;DBServlet&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;com.study.servlet.DBServlet&lt;/servlet-class&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;username&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;donn&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;password&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;<span class="number">123456</span>&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">ServletConfig</span> <span class="variable">servletConfig</span> <span class="operator">=</span> getServletConfig();</span><br><span class="line">    System.out.println(servletConfig.getInitParameter(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">    System.out.println(servletConfig.getInitParameter(<span class="string">&quot;password&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-10-ServletContext"><a href="#8-10-ServletContext" class="headerlink" title="8.10 ServletContext"></a>8.10 ServletContext</h2><p><strong><u><em>â€”â€”å¤šä¸ªServletå…±äº«çš„æ•°æ®ç©ºé—´</em></u></strong></p><h3 id="8-10-1-ä¸ºä»€ä¹ˆéœ€è¦-ServletContext"><a href="#8-10-1-ä¸ºä»€ä¹ˆéœ€è¦-ServletContext" class="headerlink" title="8.10.1 ä¸ºä»€ä¹ˆéœ€è¦ ServletContext"></a>8.10.1 ä¸ºä»€ä¹ˆéœ€è¦ ServletContext</h3><ol><li>å…ˆçœ‹ä¸€ä¸ªéœ€æ±‚ï¼š å¦‚æœæˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æŸä¸ª web åº”ç”¨çš„æ‰€æœ‰ Servlet è¢«è®¿é—®çš„æ¬¡æ•°ï¼Œ æ€ä¹ˆåŠ?</li></ol><p>â€‹æ–¹æ¡ˆ1-DB:</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711091848410.png" alt="image-20230711091848410" style="zoom:50%;" /><p>â€‹æ–¹æ¡ˆ2-ServletContextï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711092040710.png" alt="image-20230711092040710"></p><h3 id="8-10-2-ServletContext-åŸºæœ¬ä»‹ç»"><a href="#8-10-2-ServletContext-åŸºæœ¬ä»‹ç»" class="headerlink" title="8.10.2 ServletContext åŸºæœ¬ä»‹ç»"></a>8.10.2 ServletContext åŸºæœ¬ä»‹ç»</h3><ol><li><p>ServletContext æ˜¯ä¸€ä¸ªæ¥å£ï¼Œ å®ƒè¡¨ç¤º Servlet ä¸Šä¸‹æ–‡å¯¹è±¡</p></li><li><p><strong>ä¸€ä¸ª web å·¥ç¨‹ï¼Œåªæœ‰ä¸€ä¸ª ServletContext å¯¹è±¡å®ä¾‹</strong></p></li><li><p><strong>ServletContext å¯¹è±¡ æ˜¯åœ¨ web å·¥ç¨‹å¯åŠ¨çš„æ—¶å€™åˆ›å»ºï¼Œåœ¨ web å·¥ç¨‹åœæ­¢çš„æ—¶é”€æ¯</strong>  </p></li><li><p>ServletContext å¯¹è±¡å¯ä»¥é€šè¿‡ <strong>ServletConfig.getServletContext æ–¹æ³•</strong>è·å¾—å¯¹ ServletContextå¯¹è±¡çš„å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ **this.getServletContext()**æ¥è·å¾—å…¶å¯¹è±¡çš„å¼•ç”¨ã€‚</p></li><li><p>ç”±äºä¸€ä¸ª WEB åº”ç”¨ä¸­çš„æ‰€æœ‰ Servlet å…±äº«åŒä¸€ä¸ª ServletContext å¯¹è±¡ï¼Œå› æ­¤ Servlet å¯¹è±¡ä¹‹é—´å¯ä»¥é€šè¿‡ ServletContext å¯¹è±¡æ¥å®ç°å¤šä¸ª Servlet é—´é€šè®¯ã€‚<strong>ServletContext å¯¹è±¡é€šå¸¸ä¹Ÿè¢«ç§°ä¹‹ä¸ºåŸŸå¯¹è±¡</strong>ã€‚ã€ç¤ºæ„å›¾ã€‘</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711092825430.png" alt="image-20230711092825430"></p><h3 id="8-10-3-ServletContext-å¯ä»¥åšä»€ä¹ˆ"><a href="#8-10-3-ServletContext-å¯ä»¥åšä»€ä¹ˆ" class="headerlink" title="8.10.3 ServletContext å¯ä»¥åšä»€ä¹ˆ"></a>8.10.3 ServletContext å¯ä»¥åšä»€ä¹ˆ</h3><ol><li><p>è·å– web.xml ä¸­é…ç½®çš„ä¸Šä¸‹æ–‡å‚æ•° context-param [ä¿¡æ¯å’Œæ•´ä¸ª web åº”ç”¨ç›¸å…³ï¼Œ è€Œä¸æ˜¯å±äºæŸä¸ª Servlet]</p></li><li><p><strong>è·å–å½“å‰çš„å·¥ç¨‹è·¯å¾„</strong>ï¼Œæ ¼å¼: &#x2F;å·¥ç¨‹è·¯å¾„ &#x3D;&#x3D;&gt; æ¯”å¦‚ &#x2F;servlet.          <strong>å…¶å®å°±æ˜¯&#x2F;å·¥ç¨‹å</strong></p></li><li><p>è·å–<strong>å·¥ç¨‹éƒ¨ç½²ååœ¨æœåŠ¡å™¨ç¡¬ç›˜ä¸Šçš„ç»å¯¹è·¯å¾„</strong>( æ¯” å¦‚ :D:\hspedu_javaweb\servlet\out\artifacts\servlet_war_exploded)</p></li><li><p>åƒ Map ä¸€æ ·å­˜å–æ•°æ®, å¤šä¸ª Servlet å…±äº«æ•°æ®</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711093633773.png" alt="image-20230711093633773"></p><p>8.10.4 åº”ç”¨å®ä¾‹ </p><p>1-è·å–å·¥ç¨‹ç›¸å…³ä¿¡æ¯</p><p>â— éœ€æ±‚å¦‚ä¸‹ï¼š</p><ol><li>è·å– web.xml ä¸­é…ç½®çš„ä¸Šä¸‹æ–‡å‚æ•° context-param</li><li>è·å–å½“å‰çš„å·¥ç¨‹è·¯å¾„ï¼Œ æ ¼å¼: &#x2F;å·¥ç¨‹è·¯å¾„</li><li>è·å–å·¥ç¨‹éƒ¨ç½²ååœ¨æœåŠ¡å™¨ç¡¬ç›˜ä¸Šçš„ç»å¯¹è·¯å¾„</li></ol><p>â— ä»£ç å®ç° - å…·ä½“çœ‹ é¡¹ç›®ä¸­çš„ä»£ç .</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">ServletConfig</span> <span class="variable">servletConfig</span> <span class="operator">=</span> getServletConfig();</span><br><span class="line">    System.out.println(servletConfig.getInitParameter(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">    System.out.println(servletConfig.getInitParameter(<span class="string">&quot;password&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;å…¬å…±æ•°æ®ï¼š&quot;</span> + servletConfig.getServletContext().getInitParameter(<span class="string">&quot;website&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;å·¥ç¨‹è·¯å¾„&quot;</span> + servletConfig.getServletContext().getContextPath());</span><br><span class="line">  <span class="comment">// â€œ/â€è¡¨ç¤ºé¡¹ç›®å‘å¸ƒåçš„æ ¹ç›®å½•(outç›®å½•ä¸­)</span></span><br><span class="line">    System.out.println(<span class="string">&quot;ç»å¯¹è·¯å¾„&quot;</span> + servletConfig.getServletContext().getRealPath(<span class="string">&quot;/&quot;</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-10-5-åº”ç”¨å®ä¾‹-2-ç®€å•çš„ç½‘ç«™è®¿é—®æ¬¡æ•°è®¡æ•°å™¨"><a href="#8-10-5-åº”ç”¨å®ä¾‹-2-ç®€å•çš„ç½‘ç«™è®¿é—®æ¬¡æ•°è®¡æ•°å™¨" class="headerlink" title="8.10.5 åº”ç”¨å®ä¾‹ 2-ç®€å•çš„ç½‘ç«™è®¿é—®æ¬¡æ•°è®¡æ•°å™¨"></a>8.10.5 åº”ç”¨å®ä¾‹ 2-ç®€å•çš„ç½‘ç«™è®¿é—®æ¬¡æ•°è®¡æ•°å™¨</h3><p>â€¦â€¦</p><h2 id="8-11-HttpServletRequest"><a href="#8-11-HttpServletRequest" class="headerlink" title="8.11 HttpServletRequest"></a>8.11 HttpServletRequest</h2><h3 id="8-11-1-HttpServletRequest-ä»‹ç»"><a href="#8-11-1-HttpServletRequest-ä»‹ç»" class="headerlink" title="8.11.1 HttpServletRequest ä»‹ç»"></a>8.11.1 HttpServletRequest ä»‹ç»</h3><p><strong><u>â€”â€”httpè¯·æ±‚ä¸­çš„ä¿¡æ¯éƒ½è¢«å°è£…åœ¨HttpServletRequestä¸­</u></strong></p><ol><li>HttpServletRequest å¯¹è±¡ä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚</li><li>å½“å®¢æˆ·ç«¯&#x2F;æµè§ˆå™¨é€šè¿‡ HTTP åè®®è®¿é—®æœåŠ¡å™¨æ—¶ï¼Œ<strong>HTTP è¯·æ±‚å¤´ä¸­çš„æ‰€æœ‰ä¿¡æ¯éƒ½å°è£…åœ¨è¿™ä¸ªå¯¹è±¡ä¸­</strong></li><li>é€šè¿‡è¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œå¯ä»¥è·å¾—å®¢æˆ·ç«¯è¿™äº›ä¿¡æ¯ã€‚</li></ol><h3 id="8-11-2-HttpServletRequest-ç±»å›¾"><a href="#8-11-2-HttpServletRequest-ç±»å›¾" class="headerlink" title="8.11.2 HttpServletRequest ç±»å›¾"></a>8.11.2 HttpServletRequest ç±»å›¾</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711102743263.png" alt="image-20230711102743263"></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711102808631.png" alt="image-20230711102808631" style="zoom:50%;" /><h3 id="8-11-3-HttpServletRequest-å¸¸ç”¨æ–¹æ³•"><a href="#8-11-3-HttpServletRequest-å¸¸ç”¨æ–¹æ³•" class="headerlink" title="8.11.3 HttpServletRequest å¸¸ç”¨æ–¹æ³•"></a>8.11.3 HttpServletRequest å¸¸ç”¨æ–¹æ³•</h3><ol><li><p>getRequestURI() è·å–è¯·æ±‚çš„<strong>èµ„æºè·¯å¾„</strong></p><p>å³  <a href="http://localhost:8080/servlet/loginServlet%E4%B8%AD%E7%9A%84%E3%80%8Cservlet/loginServlet%E3%80%8D">http://localhost:8080/servlet/loginServletä¸­çš„ã€Œservlet/loginServletã€</a></p></li><li><p>getRequestURL() è·å–è¯·æ±‚çš„ç»Ÿä¸€èµ„æºå®šä½ç¬¦ ï¼ˆ ç» å¯¹ è·¯ å¾„ ï¼‰<a href="http://localhost:8080/servlet/loginServlet">http://localhost:8080/servlet/loginServlet</a></p></li><li><p>getRemoteHost() è·å–å®¢æˆ·ç«¯çš„ä¸»æœº, getRemoteAddr()</p></li><li><p>getHeader() è·å–è¯·æ±‚å¤´                <strong>request.getHeader(â€œCookie(ä¾‹)â€) å¯ä»¥è·å–httpè¯·æ±‚å¤´ä¸­çš„ä»»æ„ä¿¡æ¯</strong></p></li><li><p>getParameter() è·å–è¯·æ±‚çš„å‚æ•°</p></li><li><p>getParameterValues() è·å–è¯·æ±‚çš„å‚æ•°ï¼ˆå¤šä¸ªå€¼çš„æ—¶å€™ä½¿ç”¨ï¼‰ , æ¯”å¦‚ checkbox, è¿”å›çš„æ•°ç»„</p><p><strong>å¯ä»¥è·å–å‰ç«¯è¡¨å•ä¼ æ¥çš„æ•°æ®ï¼Œæ ¹æ®é”®(å‰ç«¯æ ‡ç­¾ä¸­çš„nameå±æ€§)è·å–å€¼</strong></p></li><li><p>getMethod() è·å–è¯·æ±‚çš„æ–¹å¼ GET æˆ– POST</p></li><li><p>setAttribute(key, value); <strong>è®¾ç½®åŸŸæ•°æ®</strong></p></li><li><p>getAttribute(key); <strong>è·å–åŸŸæ•°æ®</strong></p></li><li><p>ğŸŒŸgetRequestDispatcher() <u><strong>è·å–è¯·æ±‚è½¬å‘å¯¹è±¡, è¯·æ±‚è½¬å‘çš„æ ¸å¿ƒå¯¹è±¡</strong></u></p></li></ol><h3 id="8-11-4-HttpServletRequest-åº”ç”¨å®ä¾‹"><a href="#8-11-4-HttpServletRequest-åº”ç”¨å®ä¾‹" class="headerlink" title="8.11.4 HttpServletRequest åº”ç”¨å®ä¾‹"></a>8.11.4 HttpServletRequest åº”ç”¨å®ä¾‹</h3><p>â€¦â€¦</p><h3 id="8-11-5-HttpServletRequest-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#8-11-5-HttpServletRequest-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="8.11.5 HttpServletRequest æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>8.11.5 HttpServletRequest æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><ol><li>è· å– doPost å‚æ•°ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ¡ˆ , æ³¨ æ„ setCharacterEncoding(â€œutf-8â€) è¦ å†™ åœ¨request.getParameter()å‰(åœ¨æ¥å—å‚æ•°å‰è®¾ç½®å­—ä½“ )ã€‚</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711110015613.png" alt="image-20230711110015613" style="zoom:50%;" /><ol start="2"><li>æ³¨æ„ï¼šå¦‚æœé€šè¿‡ PrintWriter writer, æœ‰è¿”å›æ•°æ®ç»™æµè§ˆå™¨ï¼Œå»ºè®®å°†<strong>è·å–å‚æ•°ä»£ç å†™åœ¨writer.print() ä¹‹å‰</strong>ï¼Œå¦åˆ™å¯èƒ½è·å–ä¸åˆ°å‚æ•°å€¼(doPost)</li><li>å¤„ç† http <strong>å“åº”æ•°æ®ä¸­æ–‡ä¹±ç </strong>é—®é¢˜ (æ”¹å˜ç¼–ç ä¸ºutf-8)</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711110448507.png" alt="image-20230711110448507" style="zoom:50%;" /><ol start="4"><li>å†æ¬¡ç†è§£ Http åè®®å“åº” Content-Type çš„å«ä¹‰, æ¯”å¦‚ text&#x2F;plain(ä»¥æ–‡æœ¬æ–¹å¼è§£æ)    application&#x2F;x-tar(è¡¨ç¤ºè¿”å›çš„æ˜¯æ–‡ä»¶ï¼Œæµè§ˆå™¨ä¼šä»¥ä¸‹è½½æ–‡ä»¶çš„æ–¹å¼å¤„ç†)</li></ol><h3 id="8-11-7-è¯·æ±‚è½¬å‘"><a href="#8-11-7-è¯·æ±‚è½¬å‘" class="headerlink" title="8.11.7 è¯·æ±‚è½¬å‘"></a>8.11.7 è¯·æ±‚è½¬å‘</h3><h4 id="8-11-7-1-ä¸ºä»€ä¹ˆéœ€è¦è¯·æ±‚è½¬å‘"><a href="#8-11-7-1-ä¸ºä»€ä¹ˆéœ€è¦è¯·æ±‚è½¬å‘" class="headerlink" title="8.11.7.1 ä¸ºä»€ä¹ˆéœ€è¦è¯·æ±‚è½¬å‘"></a>8.11.7.1 ä¸ºä»€ä¹ˆéœ€è¦è¯·æ±‚è½¬å‘</h4><ol><li>ç›®å‰æˆ‘ä»¬å­¦ä¹ çš„éƒ½æ˜¯ä¸€æ¬¡è¯·æ±‚ï¼Œ å¯¹åº”ä¸€ä¸ª Servletï¼Œ å¦‚å›¾</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711111006356.png" alt="image-20230711111006356" style="zoom: 50%;" /><ol start="2"><li>ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¾€å¾€ä¸šåŠ¡æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­ï¼Œ<strong>ä½¿ç”¨åˆ°å¤šä¸ª Servlet å®Œæˆä¸€ä¸ªä»»åŠ¡(Servlet é“¾, æµæ°´ä½œä¸š)</strong> å¦‚å›¾:</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711111046853.png" alt="image-20230711111046853"></p><h4 id="8-11-7-2-è¯·æ±‚è½¬å‘è¯´æ˜"><a href="#8-11-7-2-è¯·æ±‚è½¬å‘è¯´æ˜" class="headerlink" title="8.11.7.2 è¯·æ±‚è½¬å‘è¯´æ˜"></a>8.11.7.2 è¯·æ±‚è½¬å‘è¯´æ˜</h4><ol><li><p>å®ç°è¯·æ±‚è½¬å‘ï¼š è¯·æ±‚è½¬å‘æŒ‡ä¸€ä¸ª web èµ„æºæ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åï¼Œ é€šçŸ¥æœåŠ¡å™¨å»è°ƒç”¨å¦å¤–ä¸€ä¸ª web èµ„æºè¿›è¡Œå¤„ç†</p></li><li><p>HttpServletRequest å¯¹è±¡(ä¹Ÿå« Request å¯¹è±¡)æä¾›äº†ä¸€ä¸ª getRequestDispatcher æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª RequestDispatcher å¯¹è±¡ï¼Œ<strong>è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„ forward æ–¹æ³•å¯ä»¥å®ç°è¯·æ±‚è½¬å‘</strong></p></li><li><p>request å¯¹è±¡åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªåŸŸå¯¹è±¡ï¼Œå¼€å‘äººå‘˜é€šè¿‡ request å¯¹è±¡åœ¨å®ç°è½¬å‘æ—¶ï¼ŒæŠŠæ•°æ®é€šè¿‡ request å¯¹è±¡å¸¦ç»™å…¶å®ƒ web èµ„æºå¤„ç†</p><ul><li><p>setAttributeæ–¹æ³•</p></li><li><p>getAttributeæ–¹æ³•</p></li><li><p>removeAttributeæ–¹æ³•</p></li><li><p>getAttributeNamesæ–¹æ³•</p></li></ul></li></ol><h4 id="8-11-7-3-å®ç°è¯·æ±‚è½¬å‘"><a href="#8-11-7-3-å®ç°è¯·æ±‚è½¬å‘" class="headerlink" title="8.11.7.3 å®ç°è¯·æ±‚è½¬å‘"></a>8.11.7.3 å®ç°è¯·æ±‚è½¬å‘</h4><p>è¯·æ±‚è½¬å‘åŸç†ç¤ºæ„å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711134908152.png" alt="image-20230711134908152"></p><h4 id="8-11-7-4-è¯·æ±‚è½¬å‘åº”ç”¨å®ä¾‹"><a href="#8-11-7-4-è¯·æ±‚è½¬å‘åº”ç”¨å®ä¾‹" class="headerlink" title="8.11.7.4 è¯·æ±‚è½¬å‘åº”ç”¨å®ä¾‹"></a>8.11.7.4 è¯·æ±‚è½¬å‘åº”ç”¨å®ä¾‹</h4><p>â€¦â€¦</p><p>è¯·æ±‚è½¬å‘ä¸­ï¼Œå„ä¸ªservletå¯ä»¥å…±äº«requeståŸŸå¯¹è±¡çš„åŸå› ï¼š</p><p>â€‹å› ä¸ºè¯·æ±‚è½¬å‘çš„æ–¹å¼ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  â€œ/manageServletâ€ä¸ºå‘é€çš„å¯¹è±¡(è½¬å‘ç»™è°)</span></span><br><span class="line"><span class="comment">//å…¶ä¸­:â€œ/â€ ä¼šè¢«è§£ææˆâ€œ/é¡¹ç›®åâ€ (å‰é¢ä¸€å®šæ˜¯è¡¨ç¤ºè¯¥æœåŠ¡å™¨çš„http://å·¥ç¨‹åï¼šç«¯å£)</span></span><br><span class="line"><span class="comment">//manageServletä¸ºèµ„æºå</span></span><br><span class="line"><span class="comment">//ğŸŒŸå› æ­¤ï¼Œè¯·æ±‚è½¬å‘æ˜¯ä¸èƒ½è½¬å‘åˆ°å¤–ç½‘çš„(åªèƒ½åœ¨æœåŠ¡å™¨ä¸»æœºå†…éƒ¨è¿›è¡Œè½¬å‘)</span></span><br><span class="line"><span class="type">RequestDispatcher</span> <span class="variable">requestDispatcher</span> <span class="operator">=</span> request.getRequestDispatcher(<span class="string">&quot;/manageServlet&quot;</span>);</span><br><span class="line"><span class="comment">//è€Œæ­¤å¤„çš„requestå°†è¢«ä¼ ç»™ä¸‹ä¸€ä¸ªservletï¼Œæ‰€ä»¥å¯ä»¥å…±äº«requestå¯¹è±¡ä¸­çš„æ•°æ®ï¼ï¼ï¼ï¼</span></span><br><span class="line">requestDispatcher.forward(request, response);</span><br></pre></td></tr></table></figure><h4 id="8-11-7-5-è¯·æ±‚è½¬å‘æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#8-11-7-5-è¯·æ±‚è½¬å‘æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="8.11.7.5 è¯·æ±‚è½¬å‘æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>8.11.7.5 è¯·æ±‚è½¬å‘æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><ol><li><p>ğŸŒŸ<strong>æµè§ˆå™¨åœ°å€ä¸ä¼šå˜åŒ–(åœ°å€ä¼šä¿ç•™åœ¨ç¬¬ 1 ä¸ª servlet çš„ url)</strong></p></li><li><p>åœ¨åŒä¸€æ¬¡ HTTP è¯·æ±‚ä¸­ï¼Œè¿›è¡Œå¤šæ¬¡è½¬å‘ï¼Œä»ç„¶æ˜¯ä¸€æ¬¡ HTTP è¯·æ±‚</p></li><li><p>åœ¨åŒä¸€æ¬¡ HTTP è¯·æ±‚ä¸­ï¼Œè¿›è¡Œå¤šæ¬¡è½¬å‘ï¼Œå¤šä¸ª Servlet å¯ä»¥å…±äº« request åŸŸ&#x2F;å¯¹è±¡çš„æ•°æ®(å› ä¸ºå§‹ç»ˆæ˜¯åŒä¸€ä¸ª request å¯¹è±¡)</p></li><li><p>å¯ä»¥è½¬å‘åˆ° WEB-INF ç›®å½•ä¸‹(åé¢åšé¡¹ç›®ä½¿ç”¨)</p></li><li><p><strong>ä¸èƒ½è®¿é—®å½“å‰ WEB å·¥ç¨‹å¤–çš„èµ„æº</strong></p></li><li><p><u>å› ä¸ºæµè§ˆå™¨åœ°å€æ ä¼šåœæ­¢åœ¨ç¬¬ä¸€ä¸ª servlet ,å¦‚æœä½ åˆ·æ–°é¡µé¢ï¼Œä¼šå†æ¬¡å‘å‡ºè¯·æ±‚(å¹¶ä¸”ä¼šå¸¦æ•°æ®), æ‰€ä»¥åœ¨æ”¯ä»˜é¡µé¢æƒ…å†µä¸‹ï¼Œä¸è¦ä½¿ç”¨è¯·æ±‚è½¬å‘ï¼Œå¦åˆ™ä¼šé€ æˆé‡å¤æ”¯ä»˜</u></p></li></ol><h3 id="8-11-8-è¯¾åä½œä¸š"><a href="#8-11-8-è¯¾åä½œä¸š" class="headerlink" title="8.11.8 è¯¾åä½œä¸š"></a>8.11.8 è¯¾åä½œä¸š</h3><p>â€¦â€¦</p><h2 id="8-12-HttpServletResponse"><a href="#8-12-HttpServletResponse" class="headerlink" title="8.12 HttpServletResponse"></a>8.12 HttpServletResponse</h2><h3 id="8-12-1-HttpServletResponse-ä»‹ç»"><a href="#8-12-1-HttpServletResponse-ä»‹ç»" class="headerlink" title="8.12.1 HttpServletResponse ä»‹ç»"></a>8.12.1 HttpServletResponse ä»‹ç»</h3><ol><li><p>æ¯æ¬¡ HTTP è¯·æ±‚ï¼Œ Tomcat ä¼šåˆ›å»ºä¸€ä¸ª HttpServletResponse å¯¹è±¡ä¼ é€’ç»™ Servlet ç¨‹åºå»ä½¿ç”¨ã€‚</p></li><li><p><strong>HttpServletRequest è¡¨ç¤ºè¯·æ±‚è¿‡æ¥çš„ä¿¡æ¯</strong>ï¼Œ<strong>HttpServletResponse è¡¨ç¤ºæ‰€æœ‰<u>å“åº”</u>çš„ä¿¡æ¯</strong>ï¼Œå¦‚æœ<u>éœ€è¦è®¾ç½®è¿”å›ç»™å®¢æˆ·ç«¯çš„ä¿¡æ¯</u>ï¼Œé€šè¿‡ HttpServletResponse å¯¹è±¡æ¥è¿›è¡Œè®¾ç½®å³å¯</p></li></ol><h3 id="8-12-2-HttpServletResponse-ç±»å›¾"><a href="#8-12-2-HttpServletResponse-ç±»å›¾" class="headerlink" title="8.12.2 HttpServletResponse ç±»å›¾"></a>8.12.2 HttpServletResponse ç±»å›¾</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711152642270.png" alt="image-20230711152642270"></p><h3 id="8-12-3-å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ–¹æ³•"><a href="#8-12-3-å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ–¹æ³•" class="headerlink" title="8.12.3 å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ–¹æ³•"></a>8.12.3 å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ–¹æ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711152728428.png" alt="image-20230711152728428"></p><ol><li>å­—èŠ‚æµ getOutputStream(); <strong>å¸¸ç”¨äºä¸‹è½½</strong>ï¼ˆå¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼‰</li><li>å­—ç¬¦æµ getWriter(); å¸¸ç”¨äº<strong>å›ä¼ </strong>å­—ç¬¦ä¸²</li><li>(ç»†èŠ‚ï¼š)ä¸¤ä¸ªæµ<strong>åŒæ—¶åªèƒ½ä½¿ç”¨ä¸€ä¸ª</strong>ã€‚ ä½¿ç”¨äº†å­—èŠ‚æµï¼Œå°±ä¸èƒ½å†ä½¿ç”¨å­—ç¬¦æµï¼Œåä¹‹äº¦ç„¶ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™</li></ol><h3 id="8-12-4-å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®åº”ç”¨å®ä¾‹"><a href="#8-12-4-å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®åº”ç”¨å®ä¾‹" class="headerlink" title="8.12.4 å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®åº”ç”¨å®ä¾‹"></a>8.12.4 å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®åº”ç”¨å®ä¾‹</h3><ol><li>éœ€æ±‚ï¼š æµè§ˆå™¨è¯·æ±‚ , è¿”å› hello, world</li></ol><p>â€¦â€¦</p><h3 id="8-12-5-å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#8-12-5-å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="8.12.5 å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>8.12.5 å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><ol><li>å¤„ç†ä¸­æ–‡ä¹±ç é—®é¢˜-æ–¹æ¡ˆ 1</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711153139236.png" alt="image-20230711153139236" style="zoom:50%;" /><ol start="2"><li>å¤„ç†ä¸­æ–‡ä¹±ç é—®é¢˜-æ–¹æ¡ˆ 2(å¸¸ç”¨ï¼Œæ–¹ä¾¿)</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711153202800.png" alt="image-20230711153202800" style="zoom:50%;" /><h3 id="8-12-6-è¯·æ±‚é‡å®šå‘"><a href="#8-12-6-è¯·æ±‚é‡å®šå‘" class="headerlink" title="8.12.6 è¯·æ±‚é‡å®šå‘"></a>8.12.6 è¯·æ±‚é‡å®šå‘</h3><h4 id="8-12-6-1-è¯·æ±‚é‡å®šå‘ä»‹ç»"><a href="#8-12-6-1-è¯·æ±‚é‡å®šå‘ä»‹ç»" class="headerlink" title="8.12.6.1 è¯·æ±‚é‡å®šå‘ä»‹ç»"></a>8.12.6.1 è¯·æ±‚é‡å®šå‘ä»‹ç»</h4><ol><li><p>è¯·æ±‚é‡å®šå‘æŒ‡ï¼š ä¸€ä¸ª web èµ„æºæ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åï¼Œ <u><strong>é€šçŸ¥å®¢æˆ·ç«¯å»è®¿é—®å¦å¤–ä¸€ä¸ª webèµ„æº</strong></u>ï¼Œ è¿™ç§°ä¹‹ä¸ºè¯·æ±‚é‡å®šå‘</p></li><li><p>è¯·æ±‚é‡å®šå‘åŸç†ç¤ºæ„å›¾</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230711153900776.png" alt="image-20230711153900776"></p><h4 id="8-12-6-2-è¯·æ±‚é‡å®šå‘åº”ç”¨å®ä¾‹"><a href="#8-12-6-2-è¯·æ±‚é‡å®šå‘åº”ç”¨å®ä¾‹" class="headerlink" title="8.12.6.2 è¯·æ±‚é‡å®šå‘åº”ç”¨å®ä¾‹"></a>8.12.6.2 è¯·æ±‚é‡å®šå‘åº”ç”¨å®ä¾‹</h4><ol><li>éœ€ æ±‚ ï¼š æ¼”ç¤ºè¯·æ±‚é‡å®šå‘çš„ä½¿ç”¨å½“è®¿é—® DownServlet ä¸‹ è½½ æ–‡ ä»¶ ï¼Œ é‡å®šå‘åˆ°DownServletNew ä¸‹è½½æ–‡ä»¶</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. sendRedirect æœ¬è´¨å°±ä¼š è¿”å› 302 çŠ¶æ€ç  Location: /servlet/downservletNew</span></span><br><span class="line"><span class="comment">//2ï¼å› æ­¤ 302å’Œ/servlet/downservletNew æ˜¯æµè§ˆå™¨è§£æï¼Œè€Œä¸æ˜¯æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment">//3ï¼æµè§ˆå™¨åœ¨è§£æ /servlet/downservletnew =&gt; http://localhost:8080/downServletNew</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ³•1:</span></span><br><span class="line">response.sendRedirect(<span class="string">&quot;/servlet/downServletNew&quot;</span>);</span><br><span class="line"><span class="comment">//æ–¹æ³•2:</span></span><br><span class="line">response.setStatus(<span class="number">302</span>);</span><br><span class="line">response.setHeader(<span class="string">&quot;Location&quot;</span>,<span class="string">&quot;/servlet/downServletNew&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="8-12-6-3-è¯·æ±‚é‡å®šå‘æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#8-12-6-3-è¯·æ±‚é‡å®šå‘æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="8.12.6.3 è¯·æ±‚é‡å®šå‘æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>8.12.6.3 è¯·æ±‚é‡å®šå‘æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><ol><li><p>æœ€ä½³åº”ç”¨åœºæ™¯ï¼šç½‘ç«™è¿ç§»ï¼Œ æ¯”å¦‚åŸåŸŸåæ˜¯ <a href="http://www.hsp.com/">www.hsp.com</a> è¿ç§»åˆ° <a href="http://www.hsp.cn/">www.hsp.cn</a> ï¼Œ ä½†æ˜¯ç™¾åº¦æŠ“å–çš„è¿˜æ˜¯åŸæ¥ç½‘å€.</p></li><li><p>æµè§ˆå™¨åœ°å€ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæœ¬è´¨æ˜¯ä¸¤æ¬¡ http è¯·æ±‚.</p></li><li><p><strong>ä¸èƒ½å…±äº« Request åŸŸä¸­çš„æ•°æ®ï¼Œæœ¬è´¨æ˜¯ä¸¤æ¬¡ http è¯·æ±‚ï¼Œä¼šç”Ÿæˆä¸¤ä¸ª HttpServletRequestå¯¹è±¡</strong></p></li><li><p><u>ä¸èƒ½é‡å®šå‘åˆ° &#x2F;WEB-INF ä¸‹çš„èµ„æº</u></p></li><li><p>å¯ä»¥é‡å®šå‘åˆ° Web å·¥ç¨‹ä»¥å¤–çš„èµ„æºï¼Œ æ¯”å¦‚ åˆ° <a href="http://www.baidu.com/">www.baidu.com</a> </p></li><li><p>é‡å®šå‘æœ‰ä¸¤ç§æ–¹å¼, <strong>æ¨èä½¿ç”¨ç¬¬ 1 ç§.</strong></p></li><li><p>åŠ¨æ€è·å–åˆ° application context(è¿™ä¸ªæ˜¯æŒ‡è¯¥é¡¹ç›®åœ¨tomcatä¸Šè¿è¡Œæ—¶çš„é¡¹ç›®åç§°ï¼Œé‡å®šå‘æ—¶æ¯æ¬¡éƒ½éœ€è¦å¡«ä¸Šï¼Œå› æ­¤åœ¨ä¿®æ”¹æ—¶ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–åŠ¨æ€è·å–çš„æ–¹å¼ç®€åŒ–å®ƒ</p><p>ä½¿ç”¨æ–¹æ³•ï¼šgetServletContext().getContextPath()è·å–å³å¯)</p></li></ol><h3 id="8-12-7-è¯¾åä½œä¸š"><a href="#8-12-7-è¯¾åä½œä¸š" class="headerlink" title="8.12.7 è¯¾åä½œä¸š"></a>8.12.7 è¯¾åä½œä¸š</h3><ol><li><p>ç¼–å†™ä¸€ä¸ª MyPayServlet , èƒ½å¤Ÿæ¥æ”¶åˆ°æäº¤çš„æ•°æ®</p></li><li><p>ç¼–å†™ä¸€ä¸ªç®€å•çš„æ”¯ä»˜é¡µé¢ pay.html(å¦‚å›¾)</p></li><li><p>å¦‚æœæ”¯ä»˜é‡‘é¢å¤§äº 100, åˆ™é‡å®šå‘åˆ° payok.html, å¦åˆ™é‡å®šå‘åˆ°åŸæ¥çš„ pay.html</p></li></ol><p>â€‹â€¦â€¦</p><h1 id="10-æ‰‹åŠ¨å®ç°-Tomcat-åº•å±‚æœºåˆ¶-è‡ªå·±è®¾è®¡-Servlet"><a href="#10-æ‰‹åŠ¨å®ç°-Tomcat-åº•å±‚æœºåˆ¶-è‡ªå·±è®¾è®¡-Servlet" class="headerlink" title="10 æ‰‹åŠ¨å®ç° Tomcat åº•å±‚æœºåˆ¶+ è‡ªå·±è®¾è®¡ Servlet"></a>10 æ‰‹åŠ¨å®ç° Tomcat åº•å±‚æœºåˆ¶+ è‡ªå·±è®¾è®¡ Servlet</h1><h2 id="10-1-å…ˆçœ‹ä¸€ä¸ªå°æ¡ˆä¾‹ï¼Œ-å¼•å‡ºå¯¹-Tomcat-åº•å±‚å®ç°æ€è€ƒ"><a href="#10-1-å…ˆçœ‹ä¸€ä¸ªå°æ¡ˆä¾‹ï¼Œ-å¼•å‡ºå¯¹-Tomcat-åº•å±‚å®ç°æ€è€ƒ" class="headerlink" title="10.1 å…ˆçœ‹ä¸€ä¸ªå°æ¡ˆä¾‹ï¼Œ å¼•å‡ºå¯¹ Tomcat åº•å±‚å®ç°æ€è€ƒ"></a>10.1 å…ˆçœ‹ä¸€ä¸ªå°æ¡ˆä¾‹ï¼Œ å¼•å‡ºå¯¹ Tomcat åº•å±‚å®ç°æ€è€ƒ</h2><h3 id="10-1-1-å®Œæˆå°æ¡ˆä¾‹"><a href="#10-1-1-å®Œæˆå°æ¡ˆä¾‹" class="headerlink" title="10.1.1 å®Œæˆå°æ¡ˆä¾‹"></a>10.1.1 å®Œæˆå°æ¡ˆä¾‹</h3><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230712184414696.png" alt="image-20230712184414696" style="zoom:50%;" /><ol start="0"><li>æˆ‘ä»¬å‡†å¤‡ä½¿ç”¨ Maven æ¥åˆ›å»ºä¸€ä¸ª WEB é¡¹ç›®, è€å¸ˆå…ˆç®€å•ç»™å°ä¼™ä¼´ä»‹ç»ä¸€ä¸‹ Maven æ˜¯ä»€ä¹ˆ, æ›´åŠ è¯¦ç»†çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬è¿˜ä¼šç»†è®², ç°åœ¨å…ˆä½¿ç”¨ä¸€æŠŠ</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230712184444044.png" alt="image-20230712184444044" style="zoom:50%;" /><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230712184525975.png" alt="image-20230712184525975" style="zoom:67%;" /><ol><li>å…ˆåˆ›å»ºä¸€ä¸ª Maven çš„ Web é¡¹ç›® hsp-tomcat</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230712185354190.png" alt="image-20230712185354190" style="zoom:50%;" /><ul><li>é…ç½®é˜¿é‡Œ maven é•œåƒ</li></ul><p>â€‹åœ¨mavençš„settings.xmlæ–‡ä»¶ä¸­ä¿®æ”¹mirroræ ‡ç­¾ä¸­çš„å†…å®¹å³å¯</p><ol start="2"><li>ä¿®æ”¹ D:\java_projects2\hsp\pom.xml</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.donn<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mytomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mytomcat Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--1.å¼•å…¥javax.servlet-api.jarï¼Œä¸ºäº†å¼€å‘servlet</span></span><br><span class="line"><span class="comment">          2.&lt;dependency&gt;æ ‡ç­¾è¡¨ç¤ºå¼•å…¥ä¸€ä¸ªåŒ…</span></span><br><span class="line"><span class="comment">          3.groudIdï¼šåŒ…çš„å…¬å¸ä¿¡æ¯ï¼šjavax.servlet</span></span><br><span class="line"><span class="comment">          4.artifactIdï¼šé¡¹ç›®åï¼šjavax.servlet-api</span></span><br><span class="line"><span class="comment">            groupId+artifactId å°†ä»¥ç›®å½•å½¢å¼ä½“ç°(åœ¨ä»“åº“ä¸­ç»„æˆjaråŒ…è·¯å¾„</span></span><br><span class="line"><span class="comment">          5.versionï¼šç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line"><span class="comment">          6.scopeï¼šè¡¨ç¤ºå¼•å…¥åŒ…çš„ä½œç”¨èŒƒå›´</span></span><br><span class="line"><span class="comment">            åœ¨ä»€ä¹ˆåœ°æ–¹ã€åœ¨ä»€ä¹ˆé˜¶æ®µç”Ÿæ•ˆ</span></span><br><span class="line"><span class="comment">            &lt;scope&gt;provided&lt;/scope&gt; è¡¨ç¤ºtomcatæœ¬èº«æœ‰jaråŒ…ï¼Œ</span></span><br><span class="line"><span class="comment">            åœ¨ç¼–è¯‘ã€æµ‹è¯•æ—¶æœ‰æ•ˆï¼Œä½†æ˜¯æ‰“åŒ…å‘å¸ƒåä¸è¦å¸¦ä¸Šè¿™ä¸ªåŒ…</span></span><br><span class="line"><span class="comment">            (æ„æ€å°±æ˜¯æ‰“åŒ…æ—¶ï¼Œé¡¹ç›®ä¼šæœ‰è‡ªå¸¦çš„è¯¥jaråŒ…ï¼Œ</span></span><br><span class="line"><span class="comment">            ä½†æ˜¯ç¼–è¯‘ã€æµ‹è¯•æ—¶æ²¡æœ‰ï¼ŒprovidedæŒ‡åªåœ¨ç¼–è¯‘æµ‹è¯•æ—¶æ·»åŠ è¯¥jaråŒ…)</span></span><br><span class="line"><span class="comment">          7.ä¸‹è½½çš„åŒ…åœ¨æŒ‡å®šçš„æœ¬åœ°ä»“åº“</span></span><br><span class="line"><span class="comment">          --&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>mytomcat<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>åˆ›å»º D:\java_projects2\hsp\src\main\webapp\cal.html</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>è®¡ç®—å™¨<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>è®¡ç®—å™¨<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/calServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    num1:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;num1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    num2:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;num2&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="4"><li><p>åˆ›å»º java ç›®å½•ï¼Œå­˜æ”¾ java æºæ–‡ä»¶.</p></li><li><p>åˆ›å»º CalServlet.java</p></li><li><p>ä¿®æ”¹ web.xml , é…ç½® Servlet</p></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">web-app</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>CalServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.donn.servlet.CalServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>CalServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/calServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="7"><li>ä¿®æ”¹CalServlet.java, å®Œæˆè®¡ç®—ä»»åŠ¡</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.donn.servlet; <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/7/12</span></span><br><span class="line"><span class="comment"> * 22:27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.donn.utils.WebUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//æ¥å—æäº¤çš„æ•°æ®è¿›è¡Œè®¡ç®—</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">num1</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;num1&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">num2</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;num2&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> WebUtils.parseInt(num1, <span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> WebUtils.parseInt(num2, <span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> i1 + i2;</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        writer.print(<span class="string">&quot;&lt;h1&gt;&quot;</span> + i1 + <span class="string">&quot;+&quot;</span> + i2 + <span class="string">&quot;=&quot;</span> + res + <span class="string">&quot;&lt;/h1&gt;&quot;</span>);</span><br><span class="line">        writer.flush();</span><br><span class="line">        writer.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="8"><li>åˆ› å»º å·¥ å…· ç±»\utils\WebUtils.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.donn.utils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/7/12</span></span><br><span class="line"><span class="comment"> * 22:38</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†ä¸€ä¸ªå­—ç¬¦ä¸²æ•°å­—ï¼Œè½¬æˆ int, å¦‚æœè½¬æ¢å¤±è´¥ï¼Œå°±è¿”å›ä¼ å…¥ defaultVal</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strNum</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defaultVal</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">parseInt</span><span class="params">(String strNum, <span class="type">int</span> defaultVal)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.parseInt(strNum);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">            System.out.println(strNum + <span class="string">&quot; æ ¼å¼ä¸å¯¹ï¼Œè½¬æ¢å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> defaultVal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-1-3-å®Œæˆæµ‹è¯•"><a href="#10-1-3-å®Œæˆæµ‹è¯•" class="headerlink" title="10.1.3 å®Œæˆæµ‹è¯•"></a>10.1.3 å®Œæˆæµ‹è¯•</h3><h4 id="10-1-3-1-é…ç½®-tomcat"><a href="#10-1-3-1-é…ç½®-tomcat" class="headerlink" title="10.1.3.1 é…ç½® tomcat"></a>10.1.3.1 é…ç½® tomcat</h4><h4 id="10-1-3-2-å¯åŠ¨-tomcat"><a href="#10-1-3-2-å¯åŠ¨-tomcat" class="headerlink" title="10.1.3.2 å¯åŠ¨ tomcat"></a>10.1.3.2 å¯åŠ¨ tomcat</h4><h4 id="10-1-3-3-æµè§ˆå™¨è®¿é—®-http-localhost-8080-cal-html"><a href="#10-1-3-3-æµè§ˆå™¨è®¿é—®-http-localhost-8080-cal-html" class="headerlink" title="10.1.3.3 æµè§ˆå™¨è®¿é—®: http://localhost:8080/cal.html"></a>10.1.3.3 æµè§ˆå™¨è®¿é—®: <a href="http://localhost:8080/cal.html">http://localhost:8080/cal.html</a></h4><h3 id="10-1-4-æ€è€ƒé—®é¢˜-Tomcat-åº•å±‚å®ç°-å’Œ-è°ƒç”¨åˆ°-Servlet-æµç¨‹"><a href="#10-1-4-æ€è€ƒé—®é¢˜-Tomcat-åº•å±‚å®ç°-å’Œ-è°ƒç”¨åˆ°-Servlet-æµç¨‹" class="headerlink" title="10.1.4 æ€è€ƒé—®é¢˜: Tomcat åº•å±‚å®ç° å’Œ è°ƒç”¨åˆ° Servlet æµç¨‹?"></a>10.1.4 æ€è€ƒé—®é¢˜: Tomcat åº•å±‚å®ç° å’Œ è°ƒç”¨åˆ° Servlet æµç¨‹?</h3><h3 id="10-1-5-æˆ‘ä»¬çš„ç›®æ ‡"><a href="#10-1-5-æˆ‘ä»¬çš„ç›®æ ‡" class="headerlink" title="10.1.5 æˆ‘ä»¬çš„ç›®æ ‡:"></a>10.1.5 æˆ‘ä»¬çš„ç›®æ ‡:</h3><p><u><strong>ä¸ç”¨ Tomcat, ä¸ç”¨ç³»ç»Ÿæä¾›çš„ Servlet, æ¨¡æ‹Ÿ Tomcat åº•å±‚å®ç°å¹¶èƒ½è°ƒç”¨æˆ‘ä»¬è‡ªå·±è®¾è®¡çš„ Servle, ä¹Ÿèƒ½å®Œæˆç›¸åŒçš„åŠŸèƒ½</strong></u></p><h2 id="10-2-ğŸŒŸTomcat-æ•´ä½“æ¶æ„åˆ†æ"><a href="#10-2-ğŸŒŸTomcat-æ•´ä½“æ¶æ„åˆ†æ" class="headerlink" title="10.2 ğŸŒŸTomcat æ•´ä½“æ¶æ„åˆ†æ"></a>10.2 ğŸŒŸTomcat æ•´ä½“æ¶æ„åˆ†æ</h2><h3 id="10-2-1-ä¸€å›¾èƒœåƒè¨€"><a href="#10-2-1-ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="10.2.1 ä¸€å›¾èƒœåƒè¨€"></a>10.2.1 ä¸€å›¾èƒœåƒè¨€</h3><p>â— è¯´æ˜: Tomcat æœ‰ä¸‰ç§è¿è¡Œæ¨¡å¼ï¼ˆBIO, NIO, APRï¼‰ , å› ä¸ºè€å¸ˆæ ¸å¿ƒè®²è§£çš„æ˜¯ <strong>Tomcat å¦‚ä½•æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œ è§£æè¯·æ±‚, è°ƒç”¨ Servlet ,</strong> å¹¶è¿”å›ç»“æœçš„æœºåˆ¶æµç¨‹, é‡‡ç”¨ BIO çº¿ç¨‹æ¨¡å‹æ¥æ¨¡æ‹Ÿ.[ç»˜å›¾]</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230713085315598.png" alt="image-20230713085315598"></p><h2 id="10-4-æ‰‹åŠ¨å®ç°-Tomcat-åº•å±‚æœºåˆ¶-è‡ªå·±è®¾è®¡-Servlet"><a href="#10-4-æ‰‹åŠ¨å®ç°-Tomcat-åº•å±‚æœºåˆ¶-è‡ªå·±è®¾è®¡-Servlet" class="headerlink" title="10.4 æ‰‹åŠ¨å®ç° Tomcat åº•å±‚æœºåˆ¶+ è‡ªå·±è®¾è®¡ Servlet"></a>10.4 æ‰‹åŠ¨å®ç° Tomcat åº•å±‚æœºåˆ¶+ è‡ªå·±è®¾è®¡ Servlet</h2><h3 id="10-4-1-å®ç°ä»»åŠ¡é˜¶æ®µ-1-ç¼–å†™è‡ªå·±-Tomcat-èƒ½ç»™æµè§ˆå™¨è¿”å›-Hi-Hspedu"><a href="#10-4-1-å®ç°ä»»åŠ¡é˜¶æ®µ-1-ç¼–å†™è‡ªå·±-Tomcat-èƒ½ç»™æµè§ˆå™¨è¿”å›-Hi-Hspedu" class="headerlink" title="10.4.1 å®ç°ä»»åŠ¡é˜¶æ®µ 1- ç¼–å†™è‡ªå·± Tomcat, èƒ½ç»™æµè§ˆå™¨è¿”å› Hi, Hspedu"></a>10.4.1 å®ç°ä»»åŠ¡é˜¶æ®µ 1- ç¼–å†™è‡ªå·± Tomcat, èƒ½ç»™æµè§ˆå™¨è¿”å› Hi, Hspedu</h3><h4 id="10-4-1-1-åŸºäº-socket-å¼€å‘æœåŠ¡ç«¯-æµç¨‹"><a href="#10-4-1-1-åŸºäº-socket-å¼€å‘æœåŠ¡ç«¯-æµç¨‹" class="headerlink" title="10.4.1.1 åŸºäº socket å¼€å‘æœåŠ¡ç«¯-æµç¨‹"></a>10.4.1.1 åŸºäº socket å¼€å‘æœåŠ¡ç«¯-æµç¨‹</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230713090001942.png" alt="image-20230713090001942" style="zoom:50%;" /><h4 id="10-4-1-2-éœ€æ±‚åˆ†æ"><a href="#10-4-1-2-éœ€æ±‚åˆ†æ" class="headerlink" title="10.4.1.2 éœ€æ±‚åˆ†æ"></a>10.4.1.2 éœ€æ±‚åˆ†æ</h4><ol><li>éœ€æ±‚åˆ†æå¦‚å›¾, æµè§ˆå™¨è¯·æ±‚ <a href="http://localhost:8080/">http://localhost:8080/</a>??, æœåŠ¡ç«¯è¿”å› hi , donn</li></ol><h4 id="10-4-1-3-åˆ†æ-ä»£ç å®ç°"><a href="#10-4-1-3-åˆ†æ-ä»£ç å®ç°" class="headerlink" title="10.4.1.3 åˆ†æ+ä»£ç å®ç°"></a>10.4.1.3 åˆ†æ+ä»£ç å®ç°</h4><h4 id="â—-åˆ†æç¤ºæ„å›¾"><a href="#â—-åˆ†æç¤ºæ„å›¾" class="headerlink" title="â— åˆ†æç¤ºæ„å›¾"></a>â— åˆ†æç¤ºæ„å›¾</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230713093415805.png" alt="image-20230713093415805" style="zoom:50%;" /><p>â— ä»£ç å®ç°</p><ol><li>åˆ› å»ºDonnTomcatV1.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.donn.tomcat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/7/13</span></span><br><span class="line"><span class="comment"> * 09:09</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶è¿”å›ç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DonnTomcatV1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8081</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;mytomcatåœ¨8081ç«¯å£ç›‘å¬&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (!serverSocket.isClosed())&#123;</span><br><span class="line">            <span class="comment">//ç­‰å¾…æµè§ˆå™¨çš„è¿æ¥</span></span><br><span class="line">            <span class="comment">//å¦‚æœæœ‰è¿æ¥æ¥ï¼Œå°±åˆ›å»ºä¸€ä¸ªsocket</span></span><br><span class="line">            <span class="comment">//è¿™ä¸ªsocketå°±æ˜¯æœåŠ¡å™¨å’Œæµè§ˆå™¨è¿æ¥çš„é€šé“</span></span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">            <span class="comment">//å…ˆæ¥å—æµè§ˆå™¨å‘é€çš„æ•°æ®</span></span><br><span class="line">            <span class="comment">//inputStreamæ˜¯å­—èŠ‚æµ =BufferedReaderä¸ºå­—ç¬¦æµ</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream, <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">            <span class="type">String</span> <span class="variable">mes</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">//å¾ªç¯åœ°è¯»å–</span></span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥å—åˆ°æµè§ˆå™¨å‘é€çš„æ•°æ®&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (((mes = bufferedReader.readLine()) != <span class="literal">null</span>))&#123;</span><br><span class="line">                <span class="comment">//åˆ¤æ–­mesçš„é•¿åº¦æ˜¯å¦ä¸º0</span></span><br><span class="line">                <span class="keyword">if</span>(mes.length() == <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(mes);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//tomcatå›é€httpResponse</span></span><br><span class="line">            <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">            <span class="comment">//æ„å»ºä¸€ä¸ª http å“åº”çš„å¤´</span></span><br><span class="line">            <span class="comment">// \r\n è¡¨ç¤ºæ¢è¡Œ</span></span><br><span class="line">            <span class="comment">// http å“åº”ä½“ï¼Œéœ€è¦å‰é¢æœ‰ä¸¤ä¸ªæ¢è¡Œ \r\n\r\n</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">respHeader</span> <span class="operator">=</span> <span class="string">&quot;HTTP/1.1 200 OK\r\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;Content-Type: text/html;charset=utf-8\r\n\r\n&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">resp</span> <span class="operator">=</span> respHeader + <span class="string">&quot;hi, donn&quot;</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;========æˆ‘ä»¬çš„ tomcat ç»™æµè§ˆå™¨ä¼šé€çš„æ•°æ®======&quot;</span>);</span><br><span class="line">            System.out.println(resp);</span><br><span class="line">            outputStream.write(resp.getBytes());</span><br><span class="line">            <span class="comment">//å°† resp å­—ç¬¦ä¸²ä»¥ byte[] æ–¹å¼è¿”å›</span></span><br><span class="line">            outputStream.flush();</span><br><span class="line">            outputStream.close();</span><br><span class="line">            inputStream.close();</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="10-4-1-4-æµ‹è¯•-æµè§ˆå™¨-ï¼š-http-localhost-8081"><a href="#10-4-1-4-æµ‹è¯•-æµè§ˆå™¨-ï¼š-http-localhost-8081" class="headerlink" title="10.4.1.4 æµ‹è¯• æµè§ˆå™¨ ï¼š http://localhost:8081/"></a>10.4.1.4 æµ‹è¯• æµè§ˆå™¨ ï¼š <a href="http://localhost:8081/">http://localhost:8081/</a></h4><h4 id="10-4-1-5-é—®é¢˜åˆ†æï¼š-æ²¡æœ‰ä½¿ç”¨-BIO-çº¿ç¨‹æ¨¡å‹ï¼Œ-æ²¡æœ‰å®ç°å¤šçº¿ç¨‹ï¼Œ-æ€§èƒ½å·®"><a href="#10-4-1-5-é—®é¢˜åˆ†æï¼š-æ²¡æœ‰ä½¿ç”¨-BIO-çº¿ç¨‹æ¨¡å‹ï¼Œ-æ²¡æœ‰å®ç°å¤šçº¿ç¨‹ï¼Œ-æ€§èƒ½å·®" class="headerlink" title="10.4.1.5 é—®é¢˜åˆ†æï¼š æ²¡æœ‰ä½¿ç”¨ BIO çº¿ç¨‹æ¨¡å‹ï¼Œ æ²¡æœ‰å®ç°å¤šçº¿ç¨‹ï¼Œ æ€§èƒ½å·®"></a>10.4.1.5 é—®é¢˜åˆ†æï¼š æ²¡æœ‰ä½¿ç”¨ BIO çº¿ç¨‹æ¨¡å‹ï¼Œ æ²¡æœ‰å®ç°å¤šçº¿ç¨‹ï¼Œ æ€§èƒ½å·®</h4><h3 id="10-4-2-å®ç°ä»»åŠ¡é˜¶æ®µ-2-ä½¿ç”¨-BIO-çº¿ç¨‹æ¨¡å‹ï¼Œ-æ”¯æŒå¤šçº¿ç¨‹"><a href="#10-4-2-å®ç°ä»»åŠ¡é˜¶æ®µ-2-ä½¿ç”¨-BIO-çº¿ç¨‹æ¨¡å‹ï¼Œ-æ”¯æŒå¤šçº¿ç¨‹" class="headerlink" title="10.4.2 å®ç°ä»»åŠ¡é˜¶æ®µ 2__ ä½¿ç”¨ BIO çº¿ç¨‹æ¨¡å‹ï¼Œ æ”¯æŒå¤šçº¿ç¨‹"></a>10.4.2 å®ç°ä»»åŠ¡é˜¶æ®µ 2__ ä½¿ç”¨ BIO çº¿ç¨‹æ¨¡å‹ï¼Œ æ”¯æŒå¤šçº¿ç¨‹</h3><h4 id="10-4-2-1-BIO-çº¿ç¨‹æ¨¡å‹ä»‹ç»"><a href="#10-4-2-1-BIO-çº¿ç¨‹æ¨¡å‹ä»‹ç»" class="headerlink" title="10.4.2.1 BIO çº¿ç¨‹æ¨¡å‹ä»‹ç»"></a>10.4.2.1 BIO çº¿ç¨‹æ¨¡å‹ä»‹ç»</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230713093624025.png" alt="image-20230713093624025"></p><h4 id="10-4-2-2-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-4-2-2-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.4.2.2 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.4.2.2 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><ol><li>éœ€æ±‚åˆ†æå¦‚å›¾, æµè§ˆå™¨è¯·æ±‚ <a href="http://localhost:8081/">http://localhost:8081</a>, æœåŠ¡ç«¯è¿”å› hi , donn, åå°donntomcat ä½¿ç”¨ BIO çº¿ç¨‹æ¨¡å‹,æ”¯æŒå¤šçº¿ç¨‹&#x3D;&gt; å¯¹å‰é¢çš„å¼€å‘æ¨¡å¼è¿›è¡Œæ”¹é€ </li></ol><h4 id="10-4-2-3-åˆ†æ-ä»£ç å®ç°"><a href="#10-4-2-3-åˆ†æ-ä»£ç å®ç°" class="headerlink" title="10.4.2.3 åˆ†æ+ä»£ç å®ç°"></a>10.4.2.3 åˆ†æ+ä»£ç å®ç°</h4><p>ç¤ºæ„å›¾ï¼š</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230713100725181.png" alt="image-20230713100725181" style="zoom:50%;" /><p>åˆ›å»ºçº¿ç¨‹ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.donn.tomcat.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/7/13</span></span><br><span class="line"><span class="comment"> * 09:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * DonnRequestHandlerå¯¹è±¡æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * å¤„ç†ä¸€ä¸ªhttpè¯·æ±‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DonnRequestHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DonnRequestHandler</span><span class="params">(Socket socket)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹å®¢æˆ·ç«¯è¿›è¡Œäº¤äº’</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">            <span class="comment">//è½¬æ¢æˆå­—ç¬¦æµ,æ–¹ä¾¿æŒ‰è¡Œè¯»å–</span></span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream, <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;==donnTomcatV2æ¥æ”¶åˆ°çš„æ•°æ®å¦‚ä¸‹==&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">mes</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">//è¾“å‡ºæ¶ˆæ¯</span></span><br><span class="line">            <span class="keyword">while</span> (((mes = bufferedReader.readLine()) != <span class="literal">null</span>))&#123;</span><br><span class="line">                <span class="keyword">if</span>(mes.length() == <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(mes);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æ„å»ºhttpå“åº”å¤´</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">respHeader</span> <span class="operator">=</span> <span class="string">&quot;HTTP/1.1 200 OK\r\n&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;Content-Type: text/html;charset=utf-8\r\n\r\n&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">resp</span> <span class="operator">=</span> respHeader + <span class="string">&quot;&lt;h1&gt;byeï½ donn&lt;/h1&gt;&quot;</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;V2è¿”å›çš„æ•°æ®&quot;</span>);</span><br><span class="line">            <span class="comment">//è¿”å›æ•°æ®ç»™æˆ‘ä»¬çš„æµè§ˆå™¨ -&gt; å°è£…æˆhttpå“åº”</span></span><br><span class="line">            <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">            outputStream.write(resp.getBytes());</span><br><span class="line">            outputStream.flush();</span><br><span class="line">            outputStream.close();</span><br><span class="line">            inputStream.close();</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (socket != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    socket.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è°ƒç”¨çº¿ç¨‹ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.donn.tomcat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.donn.tomcat.handler.DonnRequestHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/7/13</span></span><br><span class="line"><span class="comment"> * 09:55</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DonnTomcatV2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8081</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;myTomcatV2åœ¨8081ç«¯å£ç›‘å¬&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (!serverSocket.isClosed())&#123;</span><br><span class="line">            <span class="comment">//ç­‰å¾…æµè§ˆå™¨çš„è¿æ¥</span></span><br><span class="line">            <span class="comment">//å¦‚æœæœ‰è¿æ¥æ¥ï¼Œå°±åˆ›å»ºä¸€ä¸ªsocket</span></span><br><span class="line">            <span class="comment">//è¿™ä¸ªsocketå°±æ˜¯æœåŠ¡å™¨å’Œæµè§ˆå™¨è¿æ¥çš„é€šé“</span></span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">DonnRequestHandler</span>(socket)).start();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="10-4-2-5-é—®é¢˜åˆ†æï¼š-HspTomcat-åªæ˜¯ç®€å•è¿”å›ç»“æœï¼Œ-æ²¡æœ‰å’Œ-Servletã€-web-xml-å…³è”"><a href="#10-4-2-5-é—®é¢˜åˆ†æï¼š-HspTomcat-åªæ˜¯ç®€å•è¿”å›ç»“æœï¼Œ-æ²¡æœ‰å’Œ-Servletã€-web-xml-å…³è”" class="headerlink" title="10.4.2.5 é—®é¢˜åˆ†æï¼š HspTomcat åªæ˜¯ç®€å•è¿”å›ç»“æœï¼Œ æ²¡æœ‰å’Œ Servletã€ web.xml å…³è”"></a>10.4.2.5 é—®é¢˜åˆ†æï¼š HspTomcat åªæ˜¯ç®€å•è¿”å›ç»“æœï¼Œ æ²¡æœ‰å’Œ Servletã€ web.xml å…³è”</h4><h3 id="10-4-3-å®ç°ä»»åŠ¡é˜¶æ®µ-3-å¤„ç†-Servlet"><a href="#10-4-3-å®ç°ä»»åŠ¡é˜¶æ®µ-3-å¤„ç†-Servlet" class="headerlink" title="10.4.3 å®ç°ä»»åŠ¡é˜¶æ®µ 3- å¤„ç† Servlet"></a>10.4.3 å®ç°ä»»åŠ¡é˜¶æ®µ 3- å¤„ç† Servlet</h3><h4 id="10-4-3-1-Servlet-ç”Ÿå‘½å‘¨æœŸ-å›é¡¾"><a href="#10-4-3-1-Servlet-ç”Ÿå‘½å‘¨æœŸ-å›é¡¾" class="headerlink" title="10.4.3.1 Servlet ç”Ÿå‘½å‘¨æœŸ-å›é¡¾"></a>10.4.3.1 Servlet ç”Ÿå‘½å‘¨æœŸ-å›é¡¾</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230713101011930.png" alt="image-20230713101011930" style="zoom:50%;" /><h4 id="10-4-3-2-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-4-3-2-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.4.3.2 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.4.3.2 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p>â— éœ€æ±‚åˆ†æå¦‚å›¾, æµè§ˆå™¨è¯·æ±‚ <a href="http://localhost:8080/hspCalServlet">http://localhost:8080/hspCalServlet</a>, æäº¤æ•°æ®ï¼Œ å®Œæˆè®¡ç®—ä»»åŠ¡ï¼Œ å¦‚æœ servlet ä¸å­˜åœ¨ï¼Œ è¿”å› 404</p><h4 id="10-4-3-3-åˆ†æ-ä»£ç å®ç°"><a href="#10-4-3-3-åˆ†æ-ä»£ç å®ç°" class="headerlink" title="10.4.3.3 åˆ†æ+ä»£ç å®ç°"></a>10.4.3.3 åˆ†æ+ä»£ç å®ç°</h4><p>â— åˆ†æç¤ºæ„å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230713101359727.png" alt="image-20230713101359727"></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230713101431086.png" alt="image-20230713101431086" style="zoom:50%;" /><p>å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.donn.tomcat.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/7/13</span></span><br><span class="line"><span class="comment"> * 10:19</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * 1. DonnRequestçš„ä½œç”¨æ˜¯å°è£…httpè¯·æ±‚çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * 2. æ¯”å¦‚method(GET)ã€uri(èµ„æºå)ã€å‚æ•°åˆ—è¡¨(num1=10&amp;num2=30)</span></span><br><span class="line"><span class="comment"> * 3. DonnRequestçš„ä½œç”¨ç­‰ä»·åŸç”Ÿservletä¸­çš„HttpServletRequest</span></span><br><span class="line"><span class="comment"> * 4. è¿™é‡Œå…ˆåªè€ƒè™‘getè¯·æ±‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DonnRequest</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿™ä¸‰ä¸ªå‚æ•°éƒ½å­˜åœ¨äºhttpè¯·æ±‚ä¸­çš„ç¬¬ä¸€è¡Œä¸­</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String method;</span><br><span class="line">    <span class="keyword">private</span> String uri;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­˜æ”¾å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;String,String&gt; parametersMapping = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getParameter</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(parametersMapping.containsKey(name)) &#123;</span><br><span class="line">            <span class="keyword">return</span> parametersMapping.get(name);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> method;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ å™¨</span></span><br><span class="line"><span class="comment">     * inputStreamä¸httpè¯·æ±‚çš„socketå…³è”</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DonnRequest</span><span class="params">(InputStream inputStream)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream, <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">            <span class="comment">//è¯»å–ç¬¬ä¸€è¡Œ</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">readLine</span> <span class="operator">=</span> bufferedReader.readLine();</span><br><span class="line">            method = readLine.split(<span class="string">&quot; &quot;</span>)[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> readLine.split(<span class="string">&quot; &quot;</span>)[<span class="number">1</span>].indexOf(<span class="string">&#x27;?&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (index == -<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment">//è¯´æ˜æ²¡æœ‰å‚æ•°åˆ—è¡¨</span></span><br><span class="line">                uri = readLine.split(<span class="string">&quot; &quot;</span>)[<span class="number">1</span>];</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                uri = readLine.split(<span class="string">&quot; &quot;</span>)[<span class="number">1</span>].substring(<span class="number">0</span>,index);</span><br><span class="line">                <span class="comment">//è·å–å‚æ•°åˆ—è¡¨</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">parameters</span> <span class="operator">=</span> readLine.split(<span class="string">&quot; &quot;</span>)[<span class="number">1</span>].substring(index + <span class="number">1</span>);</span><br><span class="line">                String[] parametersPair = parameters.split(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span>(parametersPair != <span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span> (String parameter :parametersPair) &#123;</span><br><span class="line">                        String[] split = parameter.split(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">                        <span class="keyword">if</span>(split.length == <span class="number">2</span>)&#123;</span><br><span class="line">                            parametersMapping.put(split[<span class="number">0</span>],split[<span class="number">1</span>]);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è¿™é‡Œä¸èƒ½å…³é—­ï¼ŒinputStreamå’Œsocketå…³è”</span></span><br><span class="line"><span class="comment">//            inputStream.close();</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å›é¡¾-Tomcat-å·¥ä½œæ¶æ„å›¾"><a href="#å›é¡¾-Tomcat-å·¥ä½œæ¶æ„å›¾" class="headerlink" title="å›é¡¾ Tomcat å·¥ä½œæ¶æ„å›¾"></a>å›é¡¾ Tomcat å·¥ä½œæ¶æ„å›¾</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230713101359727.png" alt="image-20230713101359727"></p><h1 id="11-WEB-å·¥ç¨‹è·¯å¾„ä¸“é¢˜"><a href="#11-WEB-å·¥ç¨‹è·¯å¾„ä¸“é¢˜" class="headerlink" title="11 WEB å·¥ç¨‹è·¯å¾„ä¸“é¢˜"></a>11 WEB å·¥ç¨‹è·¯å¾„ä¸“é¢˜</h1><h2 id="11-3-WEB-å·¥ç¨‹è·¯å¾„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#11-3-WEB-å·¥ç¨‹è·¯å¾„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="11.3 WEB å·¥ç¨‹è·¯å¾„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>11.3 WEB å·¥ç¨‹è·¯å¾„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><h3 id="11-3-1-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"><a href="#11-3-1-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜" class="headerlink" title="11.3.1 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"></a>11.3.1 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜</h3><ol><li>Web å·¥ç¨‹çš„ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„ï¼š</li></ol><p>ç›¸å¯¹è·¯å¾„ï¼š</p><p>â— .è¡¨ç¤ºå½“å‰ç›®å½•</p><p>â— ..è¡¨ç¤ºä¸Šä¸€çº§ç›®å½•</p><p>â— èµ„æºå è¡¨ç¤ºå½“å‰ç›®å½•çš„èµ„æºå</p><p>ç»å¯¹è·¯å¾„ï¼š <a href="http://ip:port/å·¥ç¨‹è·¯å¾„/èµ„æºè·¯å¾„">http://ip:port/å·¥ç¨‹è·¯å¾„/èµ„æºè·¯å¾„</a></p><ol start="2"><li><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œ è·¯å¾„éƒ½ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œ è€Œä¸æ˜¯ç›¸å¯¹è·¯å¾„</p></li><li><p>åœ¨ web ä¸­ &#x2F; æ–œæ  å¦‚æœè¢«æµè§ˆå™¨è§£æï¼Œ å¾—åˆ°çš„åœ°å€æ˜¯ï¼š <strong><a href="http://ip[åŸŸå]:port/">http://ip[åŸŸå]:port/</a></strong></p><p>æ¯”å¦‚:  &lt;ahref&#x3D;â€&#x2F;â€œ&gt;æ–œæ </a></p></li><li><p>åœ¨ web ä¸­ &#x2F; æ–œæ å¦‚æœè¢«æœåŠ¡å™¨è§£æï¼Œå¾—åˆ°çš„åœ°å€æ˜¯: **<a href="http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/**ï¼Œä½ ä¹Ÿå¯ä»¥ç†è§£æˆ">http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/**ï¼Œä½ ä¹Ÿå¯ä»¥ç†è§£æˆ</a> &#x2F;å·¥ç¨‹è·¯å¾„&#x2F; </p><p>ä¸‹é¢çš„å‡ ç§æƒ…å†µå°±æ˜¯å¦‚æ­¤:</p></li></ol><p>â€‹â— <url-pattern>&#x2F;servelturl</url-pattern></p><p>â€‹â— servletContext.getRealPath(â€œ&#x2F;â€œ); &#x3D;&#x3D;&gt; æ˜¯å¾—åˆ°æ‰§è¡Œè·¯å¾„&#x2F;å·¥ä½œè·¯å¾„</p><p>â€‹â— request.getRequestDispatcher(â€œ&#x2F;â€œ);</p><ol start="5"><li><p>åœ¨ javaWeb ä¸­ è·¯å¾„<u><strong>æœ€å</strong></u>å¸¦ &#x2F; å’Œä¸å¸¦ &#x2F; å«ä¹‰ä¸åŒ, ä¸€å®šè¦å°å¿ƒ,æ¯”å¦‚</p><p> &lt; a href&#x3D;â€&#x2F;a&#x2F;servlet03â€&gt;ç½‘å€</a> ä¸­çš„<strong>servlet03 è¡¨ç¤ºèµ„æº</strong></p><p>&lt; a href&#x3D;â€&#x2F;a&#x2F;servlet03&#x2F;â€œ&gt;ç½‘å€</a> ä¸­çš„<strong>servlet03 è¡¨ç¤ºè·¯å¾„</strong></p></li><li><p>ğŸŒŸç‰¹åˆ«è¯´æ˜ï¼š é‡å®šå‘ response.sendRediect(â€œ&#x2F;â€œ); è¿™æ¡è¯­å¥è™½ç„¶æ˜¯åœ¨æœåŠ¡å™¨æ‰§è¡Œçš„ï¼Œ ä½†æ˜¯,æœåŠ¡å™¨æ˜¯æŠŠæ–œæ  &#x2F; å‘é€ç»™æµè§ˆå™¨è§£æã€‚ å› æ­¤å¾—åˆ°åœ°å€ <a href="http://ip[åŸŸå]:port/">http://ip[åŸŸå]:port/</a></p></li></ol><p><strong>å°ç»“</strong>ï¼š åœ¨<strong>ç¼–å†™èµ„æºè·¯å¾„æ—¶</strong> , è€ƒè™‘è¿™ä¹ˆå‡ ç‚¹</p><p>(1) è¿™ä¸ªè·¯å¾„å‰é¢æœ‰æ²¡æœ‰ &#x2F;</p><p>(2) <strong>è¿™ä¸ªè·¯å¾„åœ¨å“ªé‡Œè¢«è§£æ</strong> [æœåŠ¡å™¨è¿˜æ˜¯æµè§ˆå™¨] , å¦‚æœå‰é¢æœ‰ &#x2F; , å¹¶ä¸”æ˜¯åœ¨ æµè§ˆå™¨è¢«è§£æçš„ è¢«è§£ææˆ <a href="http://ip:port/">http://ip:port/</a> , å¦‚æœåœ¨æœåŠ¡å™¨ç«¯è¢«è§£æ , è¢«è§£ææˆ &#x2F;å·¥ç¨‹è·¯å¾„&#x2F;</p><p>(3) å¦‚æœè¿™ä¸ªè·¯å¾„ï¼Œ å‰é¢æ²¡æœ‰ &#x2F; , å¹¶ä¸”åœ¨æµè§ˆå™¨è¢«è§£æï¼Œ åˆ™ä»¥æµè§ˆå™¨å½“å‰çš„åœ°å€æ  å»æ‰èµ„æºéƒ¨åˆ†ï¼Œ ä½œä¸ºä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œå†æ‹¼æ¥è¿™æ¡è·¯å¾„.</p><p>(4) è¿™ä¸ªè·¯å¾„ï¼Œ æœ€åæœ‰æ²¡æœ‰ &#x2F; , å¦‚æœæœ€åæœ‰&#x2F; è¡¨ç¤ºè·¯å¾„ï¼Œ å¦‚æœæ²¡æœ‰ &#x2F; è¡¨ç¤ºèµ„æº</p><h1 id="12-Web-å¼€å‘ä¼šè¯æŠ€æœ¯-Cookie-amp-Session"><a href="#12-Web-å¼€å‘ä¼šè¯æŠ€æœ¯-Cookie-amp-Session" class="headerlink" title="12 Web å¼€å‘ä¼šè¯æŠ€æœ¯ Cookie&amp;Session"></a>12 Web å¼€å‘ä¼šè¯æŠ€æœ¯ Cookie&amp;Session</h1><h2 id="12-1-ä¼šè¯"><a href="#12-1-ä¼šè¯" class="headerlink" title="12.1 ä¼šè¯"></a>12.1 ä¼šè¯</h2><h3 id="12-1-1-åŸºæœ¬ä»‹ç»"><a href="#12-1-1-åŸºæœ¬ä»‹ç»" class="headerlink" title="12.1.1 åŸºæœ¬ä»‹ç»"></a>12.1.1 åŸºæœ¬ä»‹ç»</h3><ol><li><p>ä»€ä¹ˆæ˜¯ä¼šè¯ï¼Ÿ</p><p>â€‹ä¼šè¯å¯ç®€å•ç†è§£ä¸ºï¼š<u>ç”¨æˆ·å¼€ä¸€ä¸ªæµè§ˆå™¨ï¼Œç‚¹å‡»å¤šä¸ªè¶…é“¾æ¥ï¼Œè®¿é—®æœåŠ¡å™¨å¤šä¸ª web èµ„æºï¼Œç„¶åå…³é—­æµè§ˆå™¨</u>ï¼Œæ•´ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸ºä¸€ä¸ªä¼šè¯ã€‚</p></li><li><p>ä¼šè¯è¿‡ç¨‹ä¸­è¦è§£å†³çš„ä¸€äº›é—®é¢˜ï¼Ÿ</p><p>æ¯ä¸ªç”¨æˆ·åœ¨ä½¿ç”¨æµè§ˆå™¨ä¸æœåŠ¡å™¨è¿›è¡Œä¼šè¯çš„è¿‡ç¨‹ä¸­ï¼Œä¸å¯é¿å…å„è‡ªä¼šäº§ç”Ÿä¸€äº›æ•°æ®ï¼ŒæœåŠ¡å™¨è¦æƒ³åŠæ³•ä¸ºæ¯ä¸ªç”¨æˆ·ä¿å­˜è¿™äº›æ•°æ®</p><p>ä¾‹å¦‚ï¼šå¤šä¸ªç”¨æˆ·ç‚¹å‡»è¶…é“¾æ¥é€šè¿‡ä¸€ä¸ª servlet å„è‡ªè´­ä¹°äº†ä¸€ä¸ªå•†å“ï¼ŒæœåŠ¡å™¨åº”è¯¥æƒ³åŠæ³•æŠŠæ¯ä¸€ä¸ªç”¨æˆ·è´­ä¹°çš„å•†å“ä¿å­˜åœ¨å„è‡ªçš„åœ°æ–¹ï¼Œä»¥ä¾¿äºè¿™äº›ç”¨æˆ·ç‚¹ç»“å¸ servlet æ—¶ï¼Œç»“å¸servlet å¯ä»¥å¾—åˆ°ç”¨æˆ·å„è‡ªè´­ä¹°çš„å•†å“ä¸ºç”¨æˆ·ç»“å¸</p></li></ol><h3 id="12-1-2-ä¼šè¯çš„ä¸¤ç§æŠ€æœ¯"><a href="#12-1-2-ä¼šè¯çš„ä¸¤ç§æŠ€æœ¯" class="headerlink" title="12.1.2 ä¼šè¯çš„ä¸¤ç§æŠ€æœ¯"></a>12.1.2 ä¼šè¯çš„ä¸¤ç§æŠ€æœ¯</h3><h4 id="12-1-2-1-Session"><a href="#12-1-2-1-Session" class="headerlink" title="12.1.2.1 Session"></a>12.1.2.1 Session</h4><h4 id="12-1-2-2-Cookie"><a href="#12-1-2-2-Cookie" class="headerlink" title="12.1.2.2 Cookie"></a>12.1.2.2 Cookie</h4><h2 id="12-2-Cookie-æœ‰ä»€ä¹ˆç”¨"><a href="#12-2-Cookie-æœ‰ä»€ä¹ˆç”¨" class="headerlink" title="12.2 Cookie æœ‰ä»€ä¹ˆç”¨"></a>12.2 Cookie æœ‰ä»€ä¹ˆç”¨</h2><p>æ€è€ƒé—®é¢˜ 1-æŠ›ç –å¼•ç‰â˜</p><p>â€‹å¤§å®¶åœ¨è®¿é—®æŸä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œæ˜¯å¦èƒ½çœ‹åˆ°æç¤ºä½ ä¸Šæ¬¡ç™»å½•ç½‘ç«™çš„æ—¶é—´,è€Œä¸”è¦æ³¨æ„çš„æ˜¯ä¸åŒç”¨æˆ·ä¸Šæ¬¡ç™»å½•çš„æ—¶é—´è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™æ˜¯æ€ä¹ˆå®ç°çš„?</p><p>æ€è€ƒé—®é¢˜ 2-æŠ›ç –å¼•ç‰â˜</p><p>â€‹å¤§å®¶åœ¨è®¿é—®æŸä¸ªè´­ç‰©ç½‘ç«™çš„æ—¶å€™ï¼Œæ˜¯å¦èƒ½çœ‹åˆ°æç¤ºä½ æ›¾ç»æµè§ˆè¿‡çš„å•†å“ï¼Œä¸åŒç”¨æˆ·æµè§ˆè¿‡çš„å•†å“è‚¯å®šä¸ä¸€æ ·ï¼Œè¿™æ˜¯æ€ä¹ˆå®ç°çš„?</p><p>è§£å†³ä¹‹é“â€”cookie æŠ€æœ¯</p><p>â€‹Cookie(å°ç”œé¥¼)æ˜¯å®¢æˆ·ç«¯æŠ€æœ¯ï¼Œ<strong>æœåŠ¡å™¨æŠŠæ¯ä¸ªç”¨æˆ·çš„æ•°æ®ä»¥ cookie çš„å½¢å¼å†™ç»™ç”¨æˆ·å„è‡ªçš„æµè§ˆå™¨</strong>ã€‚å½“ç”¨æˆ·ä½¿ç”¨æµè§ˆå™¨å†å»è®¿é—®æœåŠ¡å™¨ä¸­çš„ web èµ„æºæ—¶ï¼Œå°±ä¼šå¸¦ç€å„è‡ªçš„æ•°æ®å»ã€‚è¿™æ ·ï¼Œweb èµ„æºå¤„ç†çš„å°±æ˜¯ç”¨æˆ·å„è‡ªçš„æ•°æ®äº†ã€‚ã€ç®€å•ç¤ºæ„å›¾ã€‘</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230713193537687.png" alt="image-20230713193537687"></p><h2 id="12-3-cookie-ä»‹ç»"><a href="#12-3-cookie-ä»‹ç»" class="headerlink" title="12.3 cookie ä»‹ç»"></a>12.3 cookie ä»‹ç»</h2><h3 id="12-3-1-äºŒè¯´-cookie"><a href="#12-3-1-äºŒè¯´-cookie" class="headerlink" title="12.3.1 äºŒè¯´ cookie"></a>12.3.1 äºŒè¯´ cookie</h3><ol><li>Cookie æ˜¯æœåŠ¡å™¨åœ¨å®¢æˆ·ç«¯ä¿å­˜ç”¨æˆ·çš„ä¿¡æ¯ï¼Œ æ¯”å¦‚ç™»å½•åï¼Œ æµè§ˆå†å²ç­‰, å°±å¯ä»¥ä»¥ cookieæ–¹å¼ä¿å­˜.</li><li>Cookie ä¿¡æ¯å°±åƒæ˜¯å°ç”œé¥¼(cookie ä¸­æ–‡)ä¸€æ ·ï¼Œæ•°æ®é‡å¹¶ä¸å¤§ï¼ŒæœåŠ¡å™¨ç«¯åœ¨éœ€è¦çš„æ—¶å€™å¯ä»¥ä»å®¢æˆ·ç«¯&#x2F;æµè§ˆå™¨è¯»å–(http åè®®)ï¼Œå¯ä»¥é€šè¿‡å›¾æ¥ç†è§£</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230713193754793.png" alt="image-20230713193754793" style="zoom:50%;" /><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230713194449881.png" alt="image-20230713194449881" style="zoom:50%;" /><ol start="3"><li>å†æ¬¡è¯´æ˜: <strong>cookie æ•°æ®æ˜¯ä¿å­˜åœ¨æµè§ˆå™¨çš„</strong></li></ol><h3 id="12-3-2-cookie-å¯ä»¥ç”¨æ¥åšå•¥"><a href="#12-3-2-cookie-å¯ä»¥ç”¨æ¥åšå•¥" class="headerlink" title="12.3.2 cookie å¯ä»¥ç”¨æ¥åšå•¥"></a>12.3.2 cookie å¯ä»¥ç”¨æ¥åšå•¥</h3><ol><li><p>ä¿å­˜ä¸Šæ¬¡ç™»å½•æ—¶é—´ç­‰ä¿¡æ¯</p></li><li><p>ä¿å­˜ç”¨æˆ·åï¼Œå¯†ç , åœ¨ä¸€å®šæ—¶é—´ä¸ç”¨é‡æ–°ç™»å½•</p></li><li><p>ç½‘ç«™çš„ä¸ªæ€§åŒ–ï¼Œæ¯”å¦‚å®šåˆ¶ç½‘ç«™çš„æœåŠ¡ï¼Œå†…å®¹</p></li></ol><h2 id="12-4-cookie-åŸºæœ¬ä½¿ç”¨"><a href="#12-4-cookie-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="12.4 cookie åŸºæœ¬ä½¿ç”¨"></a>12.4 cookie åŸºæœ¬ä½¿ç”¨</h2><h3 id="12-4-1-æ–‡æ¡£ï¼š-java-ee-api-ä¸­è‹±æ–‡å¯¹ç…§ç‰ˆ-chm"><a href="#12-4-1-æ–‡æ¡£ï¼š-java-ee-api-ä¸­è‹±æ–‡å¯¹ç…§ç‰ˆ-chm" class="headerlink" title="12.4.1 æ–‡æ¡£ï¼š java_ee_api_ä¸­è‹±æ–‡å¯¹ç…§ç‰ˆ.chm"></a>12.4.1 æ–‡æ¡£ï¼š java_ee_api_ä¸­è‹±æ–‡å¯¹ç…§ç‰ˆ.chm</h3><h3 id="12-4-2-cookie-å¸¸ç”¨æ–¹æ³•"><a href="#12-4-2-cookie-å¸¸ç”¨æ–¹æ³•" class="headerlink" title="12.4.2 cookie å¸¸ç”¨æ–¹æ³•"></a>12.4.2 cookie å¸¸ç”¨æ–¹æ³•</h3><ol><li><p>Cookie æœ‰ç‚¹è±¡ä¸€å¼ è¡¨(K-V)ï¼Œ åˆ†ä¸¤åˆ—ï¼Œ ä¸€ä¸ªæ˜¯åå­—ï¼Œ ä¸€ä¸ªæ˜¯å€¼ï¼Œ æ•°æ®ç±»å‹éƒ½æ˜¯ String </p></li><li><p>å¦‚ä½•åˆ›å»ºä¸€ä¸ª Cookie(åœ¨æœåŠ¡ç«¯åˆ›å»ºçš„)</p></li></ol><p>â€‹Cookie c&#x3D;new Cookie(String name,String val);    c.setMaxAge();&#x2F;&#x2F;ä¿å­˜æ—¶é—´</p><ol start="3"><li><p>å¦‚ä½•å°†ä¸€ä¸ª Cookie æ·»åŠ åˆ°å®¢æˆ·ç«¯</p><p>response.addCookie(c);</p></li><li><p>å¦‚ä½•è¯»å– cookie(åœ¨æœåŠ¡å™¨ç«¯è¯»å–åˆ° cookie ä¿¡æ¯)</p><p>request.getCookies();</p></li></ol><h2 id="12-7-cookie-ç”Ÿå‘½å‘¨æœŸ"><a href="#12-7-cookie-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="12.7 cookie ç”Ÿå‘½å‘¨æœŸ"></a>12.7 cookie ç”Ÿå‘½å‘¨æœŸ</h2><h3 id="12-7-1-ä»‹ç»"><a href="#12-7-1-ä»‹ç»" class="headerlink" title="12.7.1 ä»‹ç»"></a>12.7.1 ä»‹ç»</h3><ol><li>Cookie çš„ç”Ÿå‘½å‘¨æœŸæŒ‡çš„æ˜¯å¦‚ä½•ç®¡ç† Cookie ä»€ä¹ˆæ—¶å€™è¢«é”€æ¯ï¼ˆåˆ é™¤ï¼‰</li><li>setMaxAge()</li></ol><p>â€‹â— æ­£æ•°ï¼Œè¡¨ç¤ºåœ¨æŒ‡å®šçš„ç§’æ•°åè¿‡æœŸ  <strong>è¿‡æœŸåï¼Œæµè§ˆå™¨ä¸ä¼šåˆ é™¤è¯¥cookieï¼Œåªæ˜¯ä¸å†æºå¸¦è¯¥cookie</strong></p><p>â€‹â— è´Ÿæ•°ï¼Œè¡¨ç¤ºæµè§ˆå™¨å…³é—­ï¼Œ Cookie å°±ä¼šè¢«åˆ é™¤ï¼ˆé»˜è®¤å€¼æ˜¯-1ï¼‰</p><p>â€‹â— 0ï¼Œ è¡¨ç¤ºé©¬ä¸Šåˆ é™¤ Cookie<strong>è®¾ç½®ä¸º0åï¼Œæµè§ˆå™¨ä¼šæŠŠè¯¥cookieç›´æ¥åˆ é™¤</strong></p><h2 id="12-8-cookie-æœ‰æ•ˆè·¯å¾„"><a href="#12-8-cookie-æœ‰æ•ˆè·¯å¾„" class="headerlink" title="12.8 cookie æœ‰æ•ˆè·¯å¾„"></a>12.8 cookie æœ‰æ•ˆè·¯å¾„</h2><h3 id="12-8-1-æœ‰æ•ˆè·¯å¾„è§„åˆ™"><a href="#12-8-1-æœ‰æ•ˆè·¯å¾„è§„åˆ™" class="headerlink" title="12.8.1 æœ‰æ•ˆè·¯å¾„è§„åˆ™"></a>12.8.1 æœ‰æ•ˆè·¯å¾„è§„åˆ™</h3><ol><li>Cookie æœ‰æ•ˆè·¯å¾„ Path çš„è®¾ç½®</li><li>Cookie çš„ path å±æ€§å¯ä»¥æœ‰æ•ˆçš„<strong>è¿‡æ»¤å“ªäº› Cookie å¯ä»¥å‘é€ç»™æœåŠ¡å™¨ï¼Œå“ªäº›ä¸å‘</strong>ã€‚ pathå±æ€§æ˜¯é€šè¿‡è¯·æ±‚çš„åœ°å€æ¥è¿›è¡Œæœ‰æ•ˆçš„è¿‡æ»¤</li><li>è§„åˆ™å¦‚ä¸‹:</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230714164006880.png" alt="image-20230714164006880" style="zoom: 67%;" /><p><strong>æ²¡è®¾ç½®é»˜è®¤ä¸ºé¡¹ç›®å·¥ç¨‹è·¯å¾„</strong></p><h2 id="12-10-Cookie-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#12-10-Cookie-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="12.10 Cookie æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>12.10 Cookie æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h2><ol><li>ä¸€ä¸ª Cookie åªèƒ½æ ‡è¯†ä¸€ç§ä¿¡æ¯ï¼Œ å®ƒè‡³å°‘å«æœ‰ä¸€ä¸ªæ ‡è¯†è¯¥ä¿¡æ¯çš„åç§°ï¼ˆNAMEï¼‰ å’Œè®¾ç½®å€¼ï¼ˆVALUEï¼‰ ã€‚</li><li><strong>ä¸€ä¸ª WEB ç«™ç‚¹å¯ä»¥ç»™ä¸€ä¸ªæµè§ˆå™¨å‘é€å¤šä¸ª Cookieï¼Œä¸€ä¸ªæµè§ˆå™¨ä¹Ÿå¯ä»¥å­˜å‚¨å¤šä¸ª WEB ç«™ç‚¹æä¾›çš„ Cookieã€‚</strong></li><li>cookie çš„æ€»æ•°é‡æ²¡æœ‰é™åˆ¶ï¼Œä½†æ˜¯æ¯ä¸ªåŸŸåçš„ COOKIE æ•°é‡å’Œæ¯ä¸ª COOKIE çš„å¤§å°æ˜¯æœ‰é™åˆ¶çš„ (ä¸åŒçš„æµè§ˆå™¨é™åˆ¶ä¸åŒ, çŸ¥é“å³å¯) , <strong>Cookie ä¸é€‚åˆå­˜æ”¾æ•°æ®é‡å¤§çš„ä¿¡æ¯</strong>ã€‚</li><li>æ³¨æ„ï¼Œåˆ é™¤ cookie æ—¶ï¼Œpath å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™ä¸ä¼šåˆ é™¤</li><li>Java servlet ä¸­ cookie <strong>ä¸­æ–‡ä¹±ç </strong>è§£å†³</li></ol><p>â€‹å¦‚æœå­˜æ”¾ä¸­æ–‡çš„ cookie, é»˜è®¤æŠ¥é”™, <u>å¯ä»¥é€šè¿‡ URL ç¼–ç å’Œè§£ç æ¥è§£å†³</u>, <strong>ä¸å»ºè®®å­˜æ”¾ä¸­æ–‡çš„ cookie ä¿¡æ¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€šè¿‡å°†ä¸­æ–‡è½¬åŒ–æˆutf-8å½¢å¼çš„Stringï¼Œä¾¿å¯ä»¥å°†è½¬åŒ–çš„ç»“æœæ”¾å…¥cookieä¸­äº†</span></span><br><span class="line"><span class="type">String</span> <span class="variable">urlName</span> <span class="operator">=</span> URLEncoder.encode(<span class="string">&quot;éŸ©é¡ºå¹³æ•™è‚²&quot;</span>, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½†æ˜¯è¿™æ ·çš„è¯ï¼Œåœ¨è·å–cookieä¸­ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬å¯¹è¯»å‡ºçš„cookieæ•°æ®è¿›è¡Œè§£ç ï¼Œä»è€Œè½¬æ¢æˆä¸­æ–‡</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Cookie[] cookies = request.getCookies();</span><br><span class="line"><span class="comment">//å¤„ç†çš„ä¸­æ–‡ä¹±ç é—®é¢˜</span></span><br><span class="line"><span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">  writer.println( cookie.getName()+ URLDecoder.decode(cookie.getValue(),<span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-11-session-æœ‰ä»€ä¹ˆç”¨"><a href="#12-11-session-æœ‰ä»€ä¹ˆç”¨" class="headerlink" title="12.11 session æœ‰ä»€ä¹ˆç”¨"></a>12.11 session æœ‰ä»€ä¹ˆç”¨</h2><p>æ€è€ƒä¸¤ä¸ªé—®é¢˜â€”æŠ›ç –å¼•ç‰</p><ol><li>ä¸åŒçš„ç”¨æˆ·ç™»å½•ç½‘ç«™åï¼Œä¸ç®¡è¯¥ç”¨æˆ·æµè§ˆè¯¥ç½‘ç«™çš„å“ªä¸ªé¡µé¢ï¼Œéƒ½å¯æ˜¾ç¤ºç™»å½•äººçš„åå­—ï¼Œè¿˜å¯ä»¥éšæ—¶å»æŸ¥çœ‹è‡ªå·±çš„è´­ç‰©è½¦ä¸­çš„å•†å“, æ˜¯å¦‚ä½•å®ç°çš„?</li><li>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªç”¨æˆ·åœ¨æµè§ˆç½‘ç«™ä¸åŒé¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨æ˜¯å¦‚ä½•çŸ¥é“æ˜¯å¼ ä¸‰åœ¨æµè§ˆè¿™ä¸ªé¡µé¢ï¼Œè¿˜æ˜¯æå››åœ¨æµè§ˆè¿™ä¸ªé¡µé¢?</li></ol><ul><li>æ–¹æ¡ˆ1  :  å¯ä»¥æŠŠæ¯ä¸ªç”¨æˆ·çš„ä¿¡æ¯éƒ½å­˜åˆ°æœåŠ¡å™¨çš„ä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œå†ç”¨ä¸€ä¸ªâ€˜ğŸ”‘â€™æ¥ç¡®å®šå“ªä¸ªç”¨æˆ·å¯¹åº”dbä¸­çš„å“ªæ¡è®°å½•</li><li>æ–¹æ¡ˆ2  :  ä¹Ÿå¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯ç›´æ¥ä¿å­˜åˆ°cookieä¸­ï¼Œä½†æ˜¯å½“åˆ‡æ¢ç”¨æˆ·åcookieå†…å®¹ä¸å˜ï¼Œä¸å®‰å…¨ï¼›è€Œä¸”cookieä½œä¸ºä¼ è¾“çš„æ•°æ®å®¹æ˜“æ³„éœ²ï¼Œä¸ä¾¿äºä¼ è¾“æ•æ„Ÿä¿¡æ¯</li></ul><p>è§£å†³ä¹‹é“â€”session æŠ€æœ¯</p><ol><li><p>Session æ˜¯æœåŠ¡å™¨ç«¯æŠ€æœ¯ï¼ŒæœåŠ¡å™¨åœ¨è¿è¡Œæ—¶ä¸ºæ¯ä¸€ä¸ªç”¨æˆ·çš„æµè§ˆå™¨åˆ›å»ºä¸€ä¸ªå…¶ç‹¬äº«çš„session å¯¹è±¡&#x2F;é›†åˆ( å…¶å®ç›¸å½“äºå‰é¢è¯´çš„æ–¹æ¡ˆ1 )</p></li><li><p>ç”±äº session ä¸ºå„ä¸ªç”¨æˆ·æµè§ˆå™¨ç‹¬äº«ï¼Œæ‰€ä»¥ç”¨æˆ·åœ¨è®¿é—®æœåŠ¡å™¨çš„ä¸åŒé¡µé¢æ—¶ï¼Œå¯ä»¥ä»å„è‡ªçš„ session ä¸­è¯»å–&#x2F;æ·»åŠ æ•°æ®, ä»è€Œå®Œæˆç›¸åº”ä»»åŠ¡</p></li></ol><h2 id="12-12-session-åŸºæœ¬åŸç†"><a href="#12-12-session-åŸºæœ¬åŸç†" class="headerlink" title="12.12 session åŸºæœ¬åŸç†"></a>12.12 session åŸºæœ¬åŸç†</h2><h3 id="12-12-1-Sesson-åŸç†ç¤ºæ„å›¾"><a href="#12-12-1-Sesson-åŸç†ç¤ºæ„å›¾" class="headerlink" title="12.12.1 Sesson åŸç†ç¤ºæ„å›¾"></a>12.12.1 Sesson åŸç†ç¤ºæ„å›¾</h3><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230714220951863.png" alt="image-20230714220951863" style="zoom:50%;" /><ol><li>å½“ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®æŸä¸ªç½‘ç«™, æ“ä½œ session æ—¶ï¼ŒæœåŠ¡å™¨å°±ä¼šåœ¨å†…å­˜(åœ¨æœåŠ¡ç«¯)ä¸ºè¯¥æµè§ˆå™¨åˆ†é…ä¸€ä¸ª session å¯¹è±¡ï¼Œè¯¥ session å¯¹è±¡è¢«è¿™ä¸ªæµè§ˆå™¨ç‹¬å , å¦‚å›¾â¬†ï¸</li><li>è¿™ä¸ª session å¯¹è±¡ä¹Ÿå¯çœ‹åšæ˜¯ä¸€ä¸ªå®¹å™¨&#x2F;é›†åˆ,session å¯¹è±¡é»˜è®¤å­˜åœ¨æ—¶é—´ä¸º 30min(è¿™æ˜¯åœ¨tomcat&#x2F;conf&#x2F;web.xml)ï¼Œä¹Ÿå¯ä¿®æ”¹</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230714221054233.png" alt="image-20230714221054233" style="zoom: 50%;" /><h3 id="12-12-2-Session-å¯ä»¥åšä»€ä¹ˆ"><a href="#12-12-2-Session-å¯ä»¥åšä»€ä¹ˆ" class="headerlink" title="12.12.2 Session å¯ä»¥åšä»€ä¹ˆ"></a>12.12.2 Session å¯ä»¥åšä»€ä¹ˆ</h3><ol><li>ç½‘ä¸Šå•†åŸä¸­çš„è´­ç‰©è½¦</li><li>ä¿å­˜ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯</li><li>å°†æ•°æ®æ”¾å…¥åˆ° Session ä¸­ï¼Œ ä¾›ç”¨æˆ·åœ¨è®¿é—®ä¸åŒé¡µé¢æ—¶ï¼Œ å®ç°è·¨é¡µé¢è®¿é—®æ•°æ®</li><li>é˜²æ­¢ç”¨æˆ·éæ³•ç™»å½•åˆ°æŸä¸ªé¡µé¢</li><li>â€¦..</li></ol><h3 id="12-12-3-å¦‚ä½•ç†è§£-Session"><a href="#12-12-3-å¦‚ä½•ç†è§£-Session" class="headerlink" title="12.12.3 å¦‚ä½•ç†è§£ Session"></a>12.12.3 å¦‚ä½•ç†è§£ Session</h3><ol><li>session å­˜å‚¨ç»“æ„ç¤ºæ„å›¾</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230714221456503.png" alt="image-20230714221456503" style="zoom: 50%;" /><ol start="2"><li>ä½ å¯ä»¥æŠŠ session çœ‹ä½œæ˜¯ä¸€å®¹å™¨ç±»ä¼¼ HashMapï¼Œæœ‰ä¸¤åˆ—(K-V)ï¼Œæ¯ä¸€è¡Œå°±æ˜¯ session çš„ä¸€ä¸ªå±æ€§ã€‚</li><li>æ¯ä¸ªå±æ€§åŒ…å«æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯è¯¥å±æ€§çš„åå­—(String)ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯å®ƒçš„å€¼(Object)</li></ol><h2 id="12-13-session-å¸¸ç”¨æ–¹æ³•"><a href="#12-13-session-å¸¸ç”¨æ–¹æ³•" class="headerlink" title="12.13 session å¸¸ç”¨æ–¹æ³•"></a>12.13 session å¸¸ç”¨æ–¹æ³•</h2><h3 id="12-13-1-ç½‘ä¸Šå»æ‰¾æ–‡æ¡£"><a href="#12-13-1-ç½‘ä¸Šå»æ‰¾æ–‡æ¡£" class="headerlink" title="12.13.1 ç½‘ä¸Šå»æ‰¾æ–‡æ¡£"></a>12.13.1 ç½‘ä¸Šå»æ‰¾æ–‡æ¡£</h3><h4 id="12-13-2-Session-çš„åŸºæœ¬ä½¿ç”¨"><a href="#12-13-2-Session-çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="12.13.2 Session çš„åŸºæœ¬ä½¿ç”¨"></a>12.13.2 Session çš„åŸºæœ¬ä½¿ç”¨</h4><ol><li><p><strong>åˆ›å»º</strong>&#x2F;<strong>è·å–</strong> Sessionï¼Œ API ä¸€æ ·</p><ul><li>HttpSession session &#x3D; request.<strong>getSession();</strong></li><li><u>ç¬¬ 1 æ¬¡è°ƒç”¨æ˜¯åˆ›å»º Session ä¼šè¯ï¼Œ ä¹‹åè°ƒç”¨æ˜¯è·å–åˆ›å»ºå¥½çš„ Session å¯¹è±¡</u></li></ul></li><li><p>å‘ session æ·»åŠ å±æ€§session.setAttribute(String name,Object val);</p></li><li><p>ä» session å¾—åˆ°æŸä¸ªå±æ€§Object obj&#x3D;session.getAttribute(String name);</p></li><li><p>ä» session åˆ é™¤è°ƒæŸä¸ªå±æ€§:</p><ul><li>hs.removeAttribute(String name);</li></ul></li><li><p>isNew(); åˆ¤æ–­æ˜¯ä¸æ˜¯åˆšåˆ›å»ºå‡ºæ¥çš„ Session</p></li><li><p>æ¯ä¸ª Session éƒ½æœ‰ 1 ä¸ªå”¯ä¸€æ ‡è¯† Id å€¼ã€‚ é€šè¿‡ getId() å¾—åˆ° Session çš„ä¼šè¯ id å€¼ï¼Œ<br><strong>å³cookieä¸­çš„JSESSIONID</strong></p></li></ol><h2 id="12-14-session-åº•å±‚å®ç°æœºåˆ¶"><a href="#12-14-session-åº•å±‚å®ç°æœºåˆ¶" class="headerlink" title="12.14 session åº•å±‚å®ç°æœºåˆ¶"></a>12.14 session åº•å±‚å®ç°æœºåˆ¶</h2><h3 id="12-14-1-åŸç†åˆ†æå›¾-ä¸€å›¾èƒœåƒè¨€"><a href="#12-14-1-åŸç†åˆ†æå›¾-ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="12.14.1 åŸç†åˆ†æå›¾(ä¸€å›¾èƒœåƒè¨€)"></a>12.14.1 åŸç†åˆ†æå›¾(ä¸€å›¾èƒœåƒè¨€)</h3><p>â— session åº•å±‚å®ç°æœºåˆ¶å›¾è§£(é‡è¦)</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230714222324161.png" alt="image-20230714222324161" style="zoom:50%;" /><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230714222400458.png" alt="image-20230714222400458" style="zoom:60%;" /><p><strong>å¦‚æœåœ¨æœ¬æ¬¡ä¼šè¯ä¸­ï¼ŒæœåŠ¡å™¨ä¸ºæµè§ˆå™¨åˆ›å»ºäº†sessionç©ºé—´(è¯´æ˜äº§ç”Ÿäº†ä¸€ç»„æ–°çš„ã€ŒsessionId + sessionä½“ã€çš„ç»“æ„å‡ºç°)ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šè®©æµè§ˆå™¨å°†set sessionidä¿¡æ¯æ”¾å…¥cookieä¸­</strong></p><h3 id="12-14-3-Session-å®ç°åŸç†åŠ¨ç”»"><a href="#12-14-3-Session-å®ç°åŸç†åŠ¨ç”»" class="headerlink" title="12.14.3 Session å®ç°åŸç†åŠ¨ç”»"></a>12.14.3 Session å®ç°åŸç†åŠ¨ç”»</h3><p>â— æœåŠ¡å™¨æ˜¯å¦‚ä½•å®ç°ä¸€ä¸ª session ä¸ºä¸€ä¸ªç”¨æˆ·æµè§ˆå™¨æœåŠ¡çš„</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230715092237931.png" alt="image-20230715092237931" style="zoom:50%;" /><h2 id="12-15-session-ç”Ÿå‘½å‘¨æœŸ"><a href="#12-15-session-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="12.15 session ç”Ÿå‘½å‘¨æœŸ"></a>12.15 session ç”Ÿå‘½å‘¨æœŸ</h2><h3 id="12-15-1-Session-ç”Ÿå‘½å‘¨æœŸ-è¯´æ˜"><a href="#12-15-1-Session-ç”Ÿå‘½å‘¨æœŸ-è¯´æ˜" class="headerlink" title="12.15.1 Session ç”Ÿå‘½å‘¨æœŸ-è¯´æ˜"></a>12.15.1 Session ç”Ÿå‘½å‘¨æœŸ-è¯´æ˜</h3><ol><li><p>public void <strong>setMaxInactiveInterval</strong>(int interval) è®¾ç½® Session çš„è¶…æ—¶æ—¶é—´ï¼ˆä»¥<strong>ç§’</strong>ä¸ºå•ä½ï¼‰ ï¼Œè¶…è¿‡æŒ‡å®šçš„æ—¶é•¿ï¼Œ Session å°±ä¼šè¢«é”€æ¯ã€‚</p></li><li><p>å€¼ä¸ºæ­£æ•°çš„æ—¶å€™ï¼Œè®¾å®š Session çš„è¶…æ—¶æ—¶é•¿ã€‚</p></li><li><p><strong>è´Ÿæ•°è¡¨ç¤ºæ°¸ä¸è¶…æ—¶</strong></p></li><li><p>public int **getMaxInactiveInterval()**è·å– Session çš„è¶…æ—¶æ—¶é—´</p></li><li><p>public void <strong>invalidate() è®©å½“å‰ Session ä¼šè¯ç«‹å³æ— æ•ˆ</strong></p></li><li><p>å¦‚æœæ²¡æœ‰è°ƒç”¨ setMaxInactiveInterval() æ¥æŒ‡å®š Session çš„ç”Ÿå‘½æ—¶é•¿ï¼ŒTomcat ä¼šä»¥ Sessioné»˜è®¤æ—¶é•¿ä¸ºå‡†ï¼Œ<strong>Session é»˜è®¤çš„è¶…æ—¶ä¸º 30 åˆ†é’Ÿ</strong>ï¼Œ å¯ä»¥åœ¨ <strong>tomcat çš„ web.xml è®¾ç½®</strong></p></li><li><p>Session çš„ç”Ÿå‘½å‘¨æœŸæŒ‡çš„æ˜¯ ï¼šå®¢æˆ·ç«¯&#x2F;æµè§ˆå™¨<strong>ä¸¤æ¬¡è¯·æ±‚æœ€å¤§é—´éš”æ—¶é•¿</strong>ï¼Œè€Œä¸æ˜¯ç´¯ç§¯æ—¶é•¿ã€‚**<u>å³å½“å®¢æˆ·ç«¯è®¿é—®äº†è‡ªå·±çš„ sessionï¼Œsession çš„ç”Ÿå‘½å‘¨æœŸå°†ä» 0 å¼€å§‹é‡æ–°è®¡ç®—ã€‚</u>**(è§£è¯»: æŒ‡çš„æ˜¯åŒä¸€ä¸ªä¼šè¯ä¸¤æ¬¡è¯·æ±‚ä¹‹é—´çš„é—´éš”æ—¶é—´)</p></li><li><p>ğŸŒŸåº•å±‚: <strong>Tomcat ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥è½®è¯¢ä¼šè¯çŠ¶æ€ï¼Œå¦‚æœæŸä¸ªä¼šè¯çš„ç©ºé—²æ—¶é—´è¶…è¿‡è®¾å®šçš„æœ€å¤§å€¼ï¼Œåˆ™å°†è¯¥ä¼šè¯é”€æ¯</strong></p></li></ol><h1 id="14-JavaWeb-ä¸‰å¤§ç»„ä»¶ä¹‹ç›‘å¬å™¨-Listener"><a href="#14-JavaWeb-ä¸‰å¤§ç»„ä»¶ä¹‹ç›‘å¬å™¨-Listener" class="headerlink" title="14 JavaWeb ä¸‰å¤§ç»„ä»¶ä¹‹ç›‘å¬å™¨ Listener"></a>14 JavaWeb ä¸‰å¤§ç»„ä»¶ä¹‹ç›‘å¬å™¨ Listener</h1><h2 id="14-1-å®˜æ–¹æ–‡æ¡£"><a href="#14-1-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="14.1 å®˜æ–¹æ–‡æ¡£"></a>14.1 å®˜æ–¹æ–‡æ¡£</h2><h3 id="14-1-1-æ–‡æ¡£â€¦â€¦"><a href="#14-1-1-æ–‡æ¡£â€¦â€¦" class="headerlink" title="14.1.1 æ–‡æ¡£â€¦â€¦"></a>14.1.1 æ–‡æ¡£â€¦â€¦</h3><h2 id="14-2-Listener-ç›‘å¬å™¨ä»‹ç»"><a href="#14-2-Listener-ç›‘å¬å™¨ä»‹ç»" class="headerlink" title="14.2 Listener ç›‘å¬å™¨ä»‹ç»"></a>14.2 Listener ç›‘å¬å™¨ä»‹ç»</h2><ol><li><p>Listener ç›‘å¬å™¨å®ƒæ˜¯ JavaWeb çš„ä¸‰å¤§ç»„ä»¶ä¹‹ä¸€ã€‚ JavaWeb çš„ä¸‰å¤§ç»„ä»¶åˆ†åˆ«æ˜¯ï¼š Servlet ç¨‹åºã€ Listener ç›‘å¬å™¨ã€ Filter è¿‡æ»¤å™¨</p></li><li><p>Listener æ˜¯ JavaEE çš„è§„èŒƒï¼Œå°±æ˜¯æ¥å£</p></li><li><p><strong>ç›‘å¬å™¨çš„ä½œç”¨æ˜¯ï¼Œç›‘å¬æŸç§å˜åŒ–(ä¸€èˆ¬å°±æ˜¯<u>å¯¹è±¡åˆ›å»º&#x2F;é”€æ¯, å±æ€§å˜åŒ–</u>), è§¦å‘å¯¹åº”æ–¹æ³•å®Œæˆç›¸åº”çš„ä»»åŠ¡</strong></p></li><li><p>JavaWeb ä¸­çš„ç›‘å¬å™¨ï¼ˆå…±å…«ä¸ªï¼‰, ç›®å‰æœ€å¸¸ç”¨çš„æ˜¯ <strong>ServletContextListener</strong></p></li></ol><h2 id="14-3-JavaWeb-çš„ç›‘å¬å™¨"><a href="#14-3-JavaWeb-çš„ç›‘å¬å™¨" class="headerlink" title="14.3 JavaWeb çš„ç›‘å¬å™¨"></a>14.3 JavaWeb çš„ç›‘å¬å™¨</h2><h3 id="14-3-1-ServletContextListener-ç›‘å¬å™¨"><a href="#14-3-1-ServletContextListener-ç›‘å¬å™¨" class="headerlink" title="14.3.1 ServletContextListener ç›‘å¬å™¨"></a>14.3.1 ServletContextListener ç›‘å¬å™¨</h3><ol><li><p>ä½œç”¨ï¼š ğŸŒŸ<strong>ç›‘å¬ ServletContext åˆ›å»ºæˆ–é”€æ¯</strong>(å½“æˆ‘ä»¬ <strong>Web åº”ç”¨å¯åŠ¨æ—¶ï¼Œ å°±ä¼šåˆ›å»º ServletContext</strong>)ï¼Œå³ç”Ÿå‘½å‘¨æœŸç›‘å¬ï¼Œ åº”ç”¨åœºæ™¯</p><ol><li>åŠ è½½åˆå§‹åŒ–çš„é…ç½®æ–‡ä»¶ï¼› æ¯”å¦‚ spring çš„é…ç½®æ–‡ä»¶</li><li>ä»»åŠ¡è°ƒåº¦ï¼ˆé…åˆå®šæ—¶å™¨ Timer&#x2F;TimerTask)</li></ol></li><li><p>ç›¸å…³æ–¹æ³•</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> <span class="comment">//åˆ›å»º Servletcontext æ—¶è§¦å‘ </span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> <span class="comment">//é”€æ¯ Servletcontext æ—¶è§¦å‘</span></span><br></pre></td></tr></table></figure><ol start="3"><li>åº” ç”¨ å® ä¾‹ åˆ› å»º  MyServletContextListener.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServletContextListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent servletContextEvent&#123;</span></span><br><span class="line"><span class="params">  System.out.println(<span class="string">&quot;ServletContext åˆ›å»ºï¼Œå®Œæˆ WEB é¡¹ç›®åˆå§‹åŒ–çš„å·¥ä½œ..&quot;</span>)</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent servletContextEvent)</span>&#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;ServletContext é”€æ¯, å®Œæˆèµ„æºå›æ”¶å·¥ä½œ..&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>åœ¨ web.xml é…ç½® MyServletContextListener</li></ol><h3 id="14-3-2-ServletContextAttributeListener-ç›‘å¬å™¨"><a href="#14-3-2-ServletContextAttributeListener-ç›‘å¬å™¨" class="headerlink" title="14.3.2 ServletContextAttributeListener ç›‘å¬å™¨"></a>14.3.2 ServletContextAttributeListener ç›‘å¬å™¨</h3><ol><li>ä½œç”¨ï¼š ğŸŒŸ<strong>ç›‘å¬ ServletContext å±æ€§å˜åŒ–</strong></li><li>ç›¸å…³æ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">attributeAdded</span><span class="params">(ServletContextAttributeEvent event)</span> <span class="comment">//æ·»åŠ å±æ€§æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">attributeReplaced</span><span class="params">(ServletContextAttributeEvent event)</span> <span class="comment">//æ›¿æ¢å±æ€§æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">attributeRemoved</span><span class="params">(ServletContextAttributeEvent event)</span> <span class="comment">//ç§»é™¤å±æ€§æ—¶è°ƒç”¨</span></span><br></pre></td></tr></table></figure><ol start="3"><li><strong>ä½¿ç”¨å°‘</strong>,å†ç»™å¤§å®¶ä¸¾ä¸ªä¾‹(åé¢çš„ç›‘å¬å™¨ç±»ä¼¼)</li></ol><p>åˆ› å»ºMyServletContextAttributeListener.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServletContextAttributeListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextAttributeListener</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">attributeAdded</span><span class="params">(ServletContextAttributeEvent servletContextAttributeEvent)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;æ·»åŠ äº† servletContext å±æ€§å= &quot;</span>+servletContextAttributeEvent.getName() + <span class="string">&quot; å± æ€§ å€¼ =&quot;</span> +servletContextAttributeEvent.getValue());</span><br><span class="line">&#125; </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">attributeRemoved</span><span class="params">(ServletContextAttributeEvent servletContextAttributeEvent)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;åˆ é™¤äº† servletContext å±æ€§&quot;</span>);</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">attributeReplaced</span><span class="params">(ServletContextAttributeEvent servletContextAttributeEvent)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ›¿æ¢äº† servletContext å±æ€§ &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="14-3-3-å…¶å®ƒç›‘å¬å™¨-ä½¿ç”¨è¾ƒå°‘"><a href="#14-3-3-å…¶å®ƒç›‘å¬å™¨-ä½¿ç”¨è¾ƒå°‘" class="headerlink" title="14.3.3 å…¶å®ƒç›‘å¬å™¨-ä½¿ç”¨è¾ƒå°‘"></a>14.3.3 å…¶å®ƒç›‘å¬å™¨-ä½¿ç”¨è¾ƒå°‘</h3><h4 id="14-3-3-1-HttpSessionListener-ç›‘å¬å™¨"><a href="#14-3-3-1-HttpSessionListener-ç›‘å¬å™¨" class="headerlink" title="14.3.3.1 HttpSessionListener ç›‘å¬å™¨"></a>14.3.3.1 HttpSessionListener ç›‘å¬å™¨</h4><ol><li>ä½œç”¨ï¼š ğŸŒŸ<strong>ç›‘å¬ Session <u>åˆ›å»ºæˆ–é”€æ¯</u>ï¼Œ å³ç”Ÿå‘½å‘¨æœŸç›‘å¬</strong></li><li>ç›¸å…³æ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">sessionCreated</span><span class="params">(HttpSessionEvent se)</span>  <span class="comment">//åˆ›å»º session æ—¶è°ƒç”¨ </span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">sessionDestroyed</span><span class="params">(HttpSessionEvent se)</span><span class="comment">//é”€æ¯ session æ—¶è°ƒç”¨</span></span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨æ–¹æ³•å’Œå‰é¢ä¸€æ ·, <strong><u>å¯ä»¥ç”¨äºç›‘æ§ç”¨æˆ·ä¸Šçº¿ï¼Œç¦»çº¿</u></strong></li></ol><h4 id="14-3-3-2-HttpSessionAttributeListener-ç›‘å¬å™¨"><a href="#14-3-3-2-HttpSessionAttributeListener-ç›‘å¬å™¨" class="headerlink" title="14.3.3.2 HttpSessionAttributeListener ç›‘å¬å™¨"></a>14.3.3.2 HttpSessionAttributeListener ç›‘å¬å™¨</h4><ol><li>ä½œç”¨ï¼š ğŸŒŸ<strong>ç›‘å¬ Session <u>å±æ€§çš„å˜åŒ–</u></strong></li><li>ç›¸å…³æ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">attributeAdded</span><span class="params">(ServletRequestAttributeEvent srae)</span> <span class="comment">//æ·»åŠ å±æ€§æ—¶</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">attributeReplaced</span><span class="params">(ServletRequestAttributeEvent srae)</span> <span class="comment">//æ›¿æ¢å±æ€§æ—¶</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">attributeRemoved</span><span class="params">(ServletRequestAttributeEvent srae)</span> <span class="comment">//ç§»é™¤å±æ€§æ—¶</span></span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨å°‘ ï¼Œ ä½¿ç”¨æ–¹æ³•å’Œå‰é¢ä¸€æ ·ã€‚</li></ol><h4 id="14-3-3-3-ServletRequestListener-ç›‘å¬å™¨"><a href="#14-3-3-3-ServletRequestListener-ç›‘å¬å™¨" class="headerlink" title="14.3.3.3 ServletRequestListener ç›‘å¬å™¨"></a>14.3.3.3 ServletRequestListener ç›‘å¬å™¨</h4><ol><li><p>ServletRequestListener ç›‘å¬å™¨</p></li><li><p>ä½œç”¨ï¼š<strong>ç›‘å¬ Request åˆ›å»ºæˆ–é”€æ¯ï¼Œå³ Request ç”Ÿå‘½å‘¨æœŸç›‘å¬</strong></p></li><li><p>ğŸŒŸ<strong>å¯ä»¥ç”¨æ¥ç›‘æ§, æŸä¸ª IP è®¿é—®æˆ‘ä»¬ç½‘ç«™çš„é¢‘ç‡, æ—¥å¿—è®°å½• ,è®¿é—®èµ„æºçš„æƒ…å†µ</strong></p></li></ol><h4 id="14-3-3-4-ServletRequestAttributeListener-ç›‘å¬å™¨"><a href="#14-3-3-4-ServletRequestAttributeListener-ç›‘å¬å™¨" class="headerlink" title="14.3.3.4 ServletRequestAttributeListener ç›‘å¬å™¨"></a>14.3.3.4 ServletRequestAttributeListener ç›‘å¬å™¨</h4><ol><li>ä½œç”¨ï¼š ç›‘å¬ Request å±æ€§å˜åŒ–</li></ol><p>â€¦â€¦</p><h4 id="14-3-3-5-HttpSessionBindingListener-æ„ŸçŸ¥ç›‘å¬å™¨"><a href="#14-3-3-5-HttpSessionBindingListener-æ„ŸçŸ¥ç›‘å¬å™¨" class="headerlink" title="14.3.3.5 HttpSessionBindingListener æ„ŸçŸ¥ç›‘å¬å™¨"></a>14.3.3.5 HttpSessionBindingListener æ„ŸçŸ¥ç›‘å¬å™¨</h4><p>â€¦â€¦</p><h4 id="14-3-3-6-HttpSessionActivationListener-æ„ŸçŸ¥ç›‘å¬å™¨"><a href="#14-3-3-6-HttpSessionActivationListener-æ„ŸçŸ¥ç›‘å¬å™¨" class="headerlink" title="14.3.3.6 HttpSessionActivationListener æ„ŸçŸ¥ç›‘å¬å™¨"></a>14.3.3.6 HttpSessionActivationListener æ„ŸçŸ¥ç›‘å¬å™¨</h4><p>â€¦â€¦</p><h1 id="15-JavaWeb-ä¸‰å¤§ç»„ä»¶ä¹‹-è¿‡æ»¤å™¨-Filter"><a href="#15-JavaWeb-ä¸‰å¤§ç»„ä»¶ä¹‹-è¿‡æ»¤å™¨-Filter" class="headerlink" title="15 JavaWeb ä¸‰å¤§ç»„ä»¶ä¹‹ è¿‡æ»¤å™¨ Filter"></a>15 JavaWeb ä¸‰å¤§ç»„ä»¶ä¹‹ è¿‡æ»¤å™¨ Filter</h1><h2 id="15-1-å®˜æ–¹æ–‡æ¡£"><a href="#15-1-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="15.1 å®˜æ–¹æ–‡æ¡£"></a>15.1 å®˜æ–¹æ–‡æ¡£</h2><h3 id="15-1-1-æ–‡æ¡£ï¼š-â€¦â€¦"><a href="#15-1-1-æ–‡æ¡£ï¼š-â€¦â€¦" class="headerlink" title="15.1.1 æ–‡æ¡£ï¼š â€¦â€¦"></a>15.1.1 æ–‡æ¡£ï¼š â€¦â€¦</h3><h2 id="15-2-Filter-è¿‡æ»¤å™¨è¯´æ˜"><a href="#15-2-Filter-è¿‡æ»¤å™¨è¯´æ˜" class="headerlink" title="15.2 Filter è¿‡æ»¤å™¨è¯´æ˜"></a>15.2 Filter è¿‡æ»¤å™¨è¯´æ˜</h2><h3 id="15-2-1-ä¸ºå•¥è¦è¿‡æ»¤å™¨-éœ€æ±‚ç¤ºæ„å›¾"><a href="#15-2-1-ä¸ºå•¥è¦è¿‡æ»¤å™¨-éœ€æ±‚ç¤ºæ„å›¾" class="headerlink" title="15.2.1 ä¸ºå•¥è¦è¿‡æ»¤å™¨-éœ€æ±‚ç¤ºæ„å›¾"></a>15.2.1 ä¸ºå•¥è¦è¿‡æ»¤å™¨-éœ€æ±‚ç¤ºæ„å›¾</h3><p>â— ä¸€å›¾èƒœåƒè¨€ </p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230715181935717.png" alt="image-20230715181935717"></p><h3 id="15-2-2-è¿‡æ»¤å™¨ä»‹ç»"><a href="#15-2-2-è¿‡æ»¤å™¨ä»‹ç»" class="headerlink" title="15.2.2 è¿‡æ»¤å™¨ä»‹ç»"></a>15.2.2 è¿‡æ»¤å™¨ä»‹ç»</h3><ol><li>Filter è¿‡æ»¤å™¨å®ƒæ˜¯ JavaWeb çš„ä¸‰å¤§ç»„ä»¶ä¹‹ä¸€(Servlet ç¨‹åºã€ Listener ç›‘å¬å™¨ã€ Filter è¿‡æ»¤å™¨)</li><li>Filter è¿‡æ»¤å™¨æ˜¯ JavaEE çš„è§„èŒƒï¼Œæ˜¯æ¥å£<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230715182105900.png" alt="image-20230715182105900" style="zoom: 50%;" /></li><li>Filter è¿‡æ»¤å™¨å®ƒçš„ä½œç”¨æ˜¯ï¼šæ‹¦æˆªè¯·æ±‚ï¼Œè¿‡æ»¤å“åº”ã€‚</li><li>åº”ç”¨åœºæ™¯</li></ol><ul><li>æƒé™æ£€æŸ¥</li><li>æ—¥å¿—æ“ä½œ</li><li>äº‹åŠ¡ç®¡ç†</li></ul><h2 id="15-3-Filter-è¿‡æ»¤å™¨åŸºæœ¬åŸç†"><a href="#15-3-Filter-è¿‡æ»¤å™¨åŸºæœ¬åŸç†" class="headerlink" title="15.3 Filter è¿‡æ»¤å™¨åŸºæœ¬åŸç†"></a>15.3 Filter è¿‡æ»¤å™¨åŸºæœ¬åŸç†</h2><p>â— ä¸€å›¾èƒœåƒè¨€</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230715182618162.png" alt="image-20230715182618162" style="zoom:50%;" /><h2 id="15-4-Filter-è¿‡æ»¤å™¨å¿«é€Ÿå…¥é—¨"><a href="#15-4-Filter-è¿‡æ»¤å™¨å¿«é€Ÿå…¥é—¨" class="headerlink" title="15.4 Filter è¿‡æ»¤å™¨å¿«é€Ÿå…¥é—¨"></a>15.4 Filter è¿‡æ»¤å™¨å¿«é€Ÿå…¥é—¨</h2><p>â— éœ€æ±‚: åœ¨ web å·¥ç¨‹ä¸‹ï¼Œ æœ‰åå°ç®¡ç†ç›®å½• manageï¼Œ è¦æ±‚è¯¥ç›®å½•ä¸‹æ‰€æœ‰èµ„æºï¼ˆhtmlã€ å›¾ç‰‡ã€jsp ã€ Servlet ç­‰ï¼‰ <strong>ç”¨æˆ·ç™»å½•åæ‰èƒ½è®¿é—®</strong></p><p>å¬è€å¸ˆè¯´æ˜, <strong>å®Œæˆæ¨¡å—çš„å¥—è·¯&#x2F;æµç¨‹</strong>[å¤šå¹´çš„ä½“ä¼š]</p><ol><li>å…ˆå®Œæˆä¸€ä¸ªæ­£ç¡®çš„æµç¨‹-çœ‹åˆ°ä¸€ä¸ªæ•ˆæœ-&gt; å†™åé¢ä»£ç å°±å¯ä»¥éªŒè¯</li><li>åŠ å…¥å…¶å®ƒçš„åŠŸèƒ½[åŠ å…¥ session,éªŒè¯åˆæ³•æ€§]</li><li>å®Œå–„åŠŸèƒ½</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hspedu.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è€éŸ©è§£è¯»</span></span><br><span class="line"><span class="comment"> * 1. filteråœ¨webé¡¹ç›®å¯åŠ¨æ—¶, ç”±tomcat æ¥åˆ›å»ºfilterå®ä¾‹, åªä¼šåˆ›å»ºä¸€ä¸ª</span></span><br><span class="line"><span class="comment"> * 2. ä¼šè°ƒç”¨filteré»˜è®¤çš„æ— å‚æ„é€ å™¨, åŒæ—¶ä¼šè°ƒç”¨ initæ–¹æ³•, åªä¼šè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line"><span class="comment"> * 3. åœ¨åˆ›å»ºfilterå®ä¾‹æ—¶ï¼ŒåŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªFilterConfigå¯¹è±¡,å¹¶é€šè¿‡initæ–¹æ³•ä¼ å…¥</span></span><br><span class="line"><span class="comment"> * 4. é€šè¿‡FilterConfigå¯¹è±¡ï¼Œç¨‹åºå‘˜å¯ä»¥è·å–è¯¥filterçš„ç›¸å…³é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * 5. å½“ä¸€ä¸ªhttpè¯·æ±‚å’Œè¯¥filterçš„çš„url-patteråŒ¹é…æ—¶ï¼Œå°±ä¼šè°ƒç”¨doFilteræ–¹æ³•</span></span><br><span class="line"><span class="comment"> * 6. åœ¨è°ƒç”¨doFilteræ–¹æ³•æ—¶,tomcatä¼šåŒæ—¶åˆ›å»ºServletRequest å’Œ ServletResponse å’Œ FilterChainå¯¹è±¡</span></span><br><span class="line"><span class="comment"> * , å¹¶é€šè¿‡doFilterä¼ å…¥.</span></span><br><span class="line"><span class="comment"> * 7. å¦‚æœåé¢çš„è¯·æ±‚ç›®æ ‡èµ„æº(jsp,servlet..) ä¼šä½¿ç”¨åˆ°requestï¼Œå’Œ responseï¼Œé‚£ä¹ˆä¼šç»§ç»­ä¼ é€’</span></span><br><span class="line"><span class="comment"> * 8. è€å¸ˆçš„æé†’:åˆ°javaweb - ssm - springboot , æœ‰ æµè§ˆå™¨å’Œ webæœåŠ¡å™¨(tomcat)å‚ä¸, è€Œè¿™ä¸¤ä¸ªéƒ¨åˆ†ä¸æ˜¯æˆ‘ä»¬</span></span><br><span class="line"><span class="comment"> *    ç¨‹åºå‘˜è‡ªå·±å†™ï¼Œæ‰€ä»¥ç†è§£èµ·æ¥æ¯” java seè¦å›°éš¾!!!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ManageFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="comment">//å½“Tomcat åˆ›å»º Filteråˆ›å»ºï¼Œå°±ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œè¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">        <span class="comment">//è€éŸ©æé†’ï¼šå›å¿†æˆ‘ä»¬è‡ªå·±å®ç°tomcatåº•å±‚æœºåˆ¶+servletç¨‹åºï¼Œ å°±ä¼šäº†ç„¶</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ManageFilter initè¢«è°ƒç”¨...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest,</span></span><br><span class="line"><span class="params">                         ServletResponse servletResponse,</span></span><br><span class="line"><span class="params">                         FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ManageFilter doFilter() è¢«è°ƒç”¨=&quot;</span> + (++count));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ°æ¯æ¬¡è°ƒç”¨è¯¥filteræ—¶ï¼ŒdoFilterå°±ä¼šè¢«è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœè¿™é‡Œï¼Œæ²¡æœ‰è°ƒç”¨ç»§ç»­è¯·æ±‚çš„æ–¹æ³•ï¼Œåˆ™å°±åœæ­¢</span></span><br><span class="line">        <span class="comment">//å¦‚æœç»§ç»­è®¿é—®ç›®æ ‡èµ„æº-&gt; ç­‰ä»·äºæ”¾è¡Œ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è€å¸ˆè¯´æ˜ï¼šåœ¨è°ƒç”¨è¿‡æ»¤å™¨å‰ï¼ŒservletRequestå¯¹è±¡=requestå·²ç»è¢«åˆ›å»ºå¹¶å°è£…</span></span><br><span class="line">        <span class="comment">//æ‰€ä»¥ï¼šæˆ‘ä»¬è¿™é‡Œå°±å¯ä»¥é€šè¿‡servletRequestè·å–å¾ˆå¤šä¿¡æ¯, æ¯”å¦‚è®¿é—®url , session</span></span><br><span class="line">        <span class="comment">//æ¯”å¦‚è®¿é—®çš„å‚æ•° ... å°±å¯ä»¥åšäº‹åŠ¡ç®¡ç†ï¼Œæ•°æ®è·å–ï¼Œæ—¥å¿—ç®¡ç†ç­‰</span></span><br><span class="line">        <span class="comment">//è·å–åˆ°session</span></span><br><span class="line">        <span class="comment">//å¯ä»¥ç»§ç»­ä½¿ç”¨ httpServletRequest æ–¹æ³•.</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">httpServletRequest</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¾“å…¥å¯†ç =&quot;</span> + httpServletRequest.getParameter(<span class="string">&quot;password&quot;</span>));</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> httpServletRequest.getSession();</span><br><span class="line">        <span class="comment">//è·å–username sessionå¯¹è±¡, è¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">username</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (username != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//è€éŸ©è§£è¯»filterChain.doFilter(servletRequest, servletResponse)</span></span><br><span class="line">            <span class="comment">//1. ç»§ç»­è®¿é—®ç›®æ ‡èµ„æºurl</span></span><br><span class="line">            <span class="comment">//2. servletRequest å’Œ servletResponse å¯¹è±¡ä¼šä¼ é€’ç»™ç›®æ ‡èµ„æº/æ–‡ä»¶</span></span><br><span class="line">            <span class="comment">//3. ä¸€å®šè¦ç†è§£filterä¼ é€’çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œå†åé¢çš„servlet/jsp æ˜¯åŒä¸€ä¸ªå¯¹è±¡(æŒ‡çš„æ˜¯åœ¨ä¸€æ¬¡httpè¯·æ±‚)</span></span><br><span class="line">            System.out.println(<span class="string">&quot;servletRequest=&quot;</span> + servletRequest);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ—¥å¿—ä¿¡æ¯==&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;è®¿é—®çš„ç”¨æˆ·å=&quot;</span> + username.toString());</span><br><span class="line">            System.out.println(<span class="string">&quot;è®¿é—®çš„url=&quot;</span> + httpServletRequest.getRequestURL());</span><br><span class="line">            System.out.println(<span class="string">&quot;è®¿é—®çš„IP=&quot;</span> + httpServletRequest.getRemoteAddr());</span><br><span class="line">            filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">//è¯´æ˜æ²¡æœ‰ç™»å½•è¿‡..å›åˆ°ç™»å½•é¡µé¢</span></span><br><span class="line">            servletRequest.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).</span><br><span class="line">                    forward(servletRequest, servletResponse);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å½“filterè¢«é”€æ¯æ—¶ï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ManageFilter destroy()è¢«è°ƒç”¨..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â—åœ¨ web.xml é…ç½®è¿‡æ»¤å™¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--è€å¸ˆè§£è¯»:filterä¸€èˆ¬å†™åœ¨å…¶å®ƒservletçš„å‰é¢</span></span><br><span class="line"><span class="comment">        1. è§‚å¯Ÿæˆ‘ä»¬å‘ç°filter é…ç½®å’Œ servlet éå¸¸ç›¸ä¼¼. filterä¹Ÿæ˜¯è¢«tomcatç®¡ç†å’Œç»´æŠ¤</span></span><br><span class="line"><span class="comment">        2. url-pattern å°±æ˜¯å½“è¯·æ±‚çš„url å’Œ åŒ¹é…çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨è¯¥filter</span></span><br><span class="line"><span class="comment">        3. /manage/* ç¬¬ä¸€ä¸ª / è§£ææˆ http://ip:port/å·¥ç¨‹è·¯å¾„</span></span><br><span class="line"><span class="comment">        4. å®Œæ•´çš„è·¯å¾„å°±æ˜¯ http://ip:port/å·¥ç¨‹è·¯å¾„/manage/* å½“è¯·æ±‚çš„èµ„æºurlæ»¡è¶³è¯¥æ¡ä»¶æ—¶</span></span><br><span class="line"><span class="comment">        éƒ½ä¼šè°ƒç”¨filter , /manage/admin.jsp</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>ManageFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.hspedu.filter.ManageFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>ManageFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/manage/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="15-5-Filter-è¿‡æ»¤å™¨-url-pattern"><a href="#15-5-Filter-è¿‡æ»¤å™¨-url-pattern" class="headerlink" title="15.5 Filter è¿‡æ»¤å™¨ url-pattern"></a>15.5 Filter è¿‡æ»¤å™¨ url-pattern</h2><p>1ã€ url-pattern : Filter çš„æ‹¦æˆªè·¯å¾„, å³<strong>æµè§ˆå™¨åœ¨è¯·æ±‚ä»€ä¹ˆä½ç½®çš„èµ„æºæ—¶ï¼Œ è¿‡æ»¤å™¨ä¼šè¿›è¡Œæ‹¦æˆªè¿‡æ»¤</strong> </p><p>2ã€<strong>ç²¾ç¡®åŒ¹é…</strong> <url-pattern>&#x2F;a.jsp</url-pattern> å¯¹åº”çš„ è¯·æ±‚åœ°å€ <a href="http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/a.jsp">http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/a.jsp</a> ä¼šæ‹¦æˆª</p><p>3ã€ <strong>ç›®å½•åŒ¹é…</strong> <url-pattern>&#x2F;manage&#x2F;*</url-pattern>å¯¹åº”çš„ è¯·æ±‚åœ°å€ <a href="http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/manage/xx">http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/manage/xx</a> , å³ web å·¥ç¨‹ manage ç›®å½•ä¸‹æ‰€æœ‰èµ„æº ä¼šæ‹¦æˆª</p><p>4ã€ <strong>åç¼€ååŒ¹é…</strong> <url-pattern>*.jsp</url-pattern> åç¼€åå¯å˜ï¼Œ æ¯”å¦‚ *.action *.do ç­‰ç­‰å¯¹åº”çš„ è¯·æ±‚åœ°å€ <a href="http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/xx.jsp">http://ip[åŸŸå]:port/å·¥ç¨‹è·¯å¾„/xx.jsp</a> , åç¼€åä¸º .jsp è¯·æ±‚ä¼šæ‹¦æˆª</p><p><strong>5ã€ Filter è¿‡æ»¤å™¨å®ƒåªå…³å¿ƒè¯·æ±‚çš„åœ°å€æ˜¯å¦åŒ¹é…ï¼Œ ä¸å…³å¿ƒè¯·æ±‚çš„èµ„æºæ˜¯å¦å­˜åœ¨</strong></p><h2 id="15-6-Filter-è¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸ"><a href="#15-6-Filter-è¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="15.6 Filter è¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸ"></a>15.6 Filter è¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸ</h2><p>â— Filter ç”Ÿå‘½å‘¨æœŸå›¾è§£</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230716085623113.png" alt="image-20230716085623113"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hspedu.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è€éŸ©è§£è¯»</span></span><br><span class="line"><span class="comment"> * 1. filteråœ¨webé¡¹ç›®å¯åŠ¨æ—¶, ç”±tomcat æ¥åˆ›å»ºfilterå®ä¾‹, åªä¼šåˆ›å»ºä¸€ä¸ª</span></span><br><span class="line"><span class="comment"> * 2. ä¼šè°ƒç”¨filteré»˜è®¤çš„æ— å‚æ„é€ å™¨, åŒæ—¶ä¼šè°ƒç”¨ initæ–¹æ³•, åªä¼šè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line"><span class="comment"> * 3. åœ¨åˆ›å»ºfilterå®ä¾‹æ—¶ï¼ŒåŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªFilterConfigå¯¹è±¡,å¹¶é€šè¿‡initæ–¹æ³•ä¼ å…¥</span></span><br><span class="line"><span class="comment"> * 4. é€šè¿‡FilterConfigå¯¹è±¡ï¼Œç¨‹åºå‘˜å¯ä»¥è·å–è¯¥filterçš„ç›¸å…³é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * 5. å½“ä¸€ä¸ªhttpè¯·æ±‚å’Œè¯¥filterçš„çš„url-patteråŒ¹é…æ—¶ï¼Œå°±ä¼šè°ƒç”¨doFilteræ–¹æ³•</span></span><br><span class="line"><span class="comment"> * 6. åœ¨è°ƒç”¨doFilteræ–¹æ³•æ—¶,tomcatä¼šåŒæ—¶åˆ›å»ºServletRequest å’Œ ServletResponse å’Œ FilterChainå¯¹è±¡</span></span><br><span class="line"><span class="comment"> * , å¹¶é€šè¿‡doFilterä¼ å…¥.</span></span><br><span class="line"><span class="comment"> * 7. å¦‚æœåé¢çš„è¯·æ±‚ç›®æ ‡èµ„æº(jsp,servlet..) ä¼šä½¿ç”¨åˆ°requestï¼Œå’Œ responseï¼Œé‚£ä¹ˆä¼šç»§ç»­ä¼ é€’</span></span><br><span class="line"><span class="comment"> * 8. è€å¸ˆçš„æé†’:åˆ°javaweb - ssm - springboot , æœ‰ æµè§ˆå™¨å’Œ webæœåŠ¡å™¨(tomcat)å‚ä¸, è€Œè¿™ä¸¤ä¸ªéƒ¨åˆ†ä¸æ˜¯æˆ‘ä»¬</span></span><br><span class="line"><span class="comment"> *    ç¨‹åºå‘˜è‡ªå·±å†™ï¼Œæ‰€ä»¥ç†è§£èµ·æ¥æ¯” java seè¦å›°éš¾!!!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ManageFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="comment">//å½“Tomcat åˆ›å»º Filteråˆ›å»ºï¼Œå°±ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œè¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">        <span class="comment">//è€éŸ©æé†’ï¼šå›å¿†æˆ‘ä»¬è‡ªå·±å®ç°tomcatåº•å±‚æœºåˆ¶+servletç¨‹åºï¼Œ å°±ä¼šäº†ç„¶</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ManageFilter initè¢«è°ƒç”¨...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest,</span></span><br><span class="line"><span class="params">                         ServletResponse servletResponse,</span></span><br><span class="line"><span class="params">                         FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ManageFilter doFilter() è¢«è°ƒç”¨=&quot;</span> + (++count));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ°æ¯æ¬¡è°ƒç”¨è¯¥filteræ—¶ï¼ŒdoFilterå°±ä¼šè¢«è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœè¿™é‡Œï¼Œæ²¡æœ‰è°ƒç”¨ç»§ç»­è¯·æ±‚çš„æ–¹æ³•ï¼Œåˆ™å°±åœæ­¢</span></span><br><span class="line">        <span class="comment">//å¦‚æœç»§ç»­è®¿é—®ç›®æ ‡èµ„æº-&gt; ç­‰ä»·äºæ”¾è¡Œ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è€å¸ˆè¯´æ˜ï¼šåœ¨è°ƒç”¨è¿‡æ»¤å™¨å‰ï¼ŒservletRequestå¯¹è±¡=requestå·²ç»è¢«åˆ›å»ºå¹¶å°è£…</span></span><br><span class="line">        <span class="comment">//æ‰€ä»¥ï¼šæˆ‘ä»¬è¿™é‡Œå°±å¯ä»¥é€šè¿‡servletRequestè·å–å¾ˆå¤šä¿¡æ¯, æ¯”å¦‚è®¿é—®url , session</span></span><br><span class="line">        <span class="comment">//æ¯”å¦‚è®¿é—®çš„å‚æ•° ... å°±å¯ä»¥åšäº‹åŠ¡ç®¡ç†ï¼Œæ•°æ®è·å–ï¼Œæ—¥å¿—ç®¡ç†ç­‰</span></span><br><span class="line">        <span class="comment">//è·å–åˆ°session</span></span><br><span class="line">        <span class="comment">//å¯ä»¥ç»§ç»­ä½¿ç”¨ httpServletRequest æ–¹æ³•.</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">httpServletRequest</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¾“å…¥å¯†ç =&quot;</span> + httpServletRequest.getParameter(<span class="string">&quot;password&quot;</span>));</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> httpServletRequest.getSession();</span><br><span class="line">        <span class="comment">//è·å–username sessionå¯¹è±¡, è¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">username</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (username != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//è€éŸ©è§£è¯»filterChain.doFilter(servletRequest, servletResponse)</span></span><br><span class="line">            <span class="comment">//1. ç»§ç»­è®¿é—®ç›®æ ‡èµ„æºurl</span></span><br><span class="line">            <span class="comment">//2. servletRequest å’Œ servletResponse å¯¹è±¡ä¼šä¼ é€’ç»™ç›®æ ‡èµ„æº/æ–‡ä»¶</span></span><br><span class="line">            <span class="comment">//3. ä¸€å®šè¦ç†è§£filterä¼ é€’çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œå†åé¢çš„servlet/jsp æ˜¯åŒä¸€ä¸ªå¯¹è±¡(æŒ‡çš„æ˜¯åœ¨ä¸€æ¬¡httpè¯·æ±‚)</span></span><br><span class="line">            System.out.println(<span class="string">&quot;servletRequest=&quot;</span> + servletRequest);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ—¥å¿—ä¿¡æ¯==&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;è®¿é—®çš„ç”¨æˆ·å=&quot;</span> + username.toString());</span><br><span class="line">            System.out.println(<span class="string">&quot;è®¿é—®çš„url=&quot;</span> + httpServletRequest.getRequestURL());</span><br><span class="line">            System.out.println(<span class="string">&quot;è®¿é—®çš„IP=&quot;</span> + httpServletRequest.getRemoteAddr());</span><br><span class="line">            filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">//è¯´æ˜æ²¡æœ‰ç™»å½•è¿‡..å›åˆ°ç™»å½•é¡µé¢</span></span><br><span class="line">            servletRequest.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).</span><br><span class="line">                    forward(servletRequest, servletResponse);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å½“filterè¢«é”€æ¯æ—¶ï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ManageFilter destroy()è¢«è°ƒç”¨..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ğŸŒŸ <strong>å¦‚æœåé¢çš„è¯·æ±‚ç›®æ ‡èµ„æº(jsp,servlet..) ä¼šä½¿ç”¨åˆ°request å’Œ responseï¼Œé‚£ä¹ˆä¼šç»§ç»­ä¼ é€’â€”â€”å³ä½¿è®¿é—®çš„urlä¸åŒäº†ï¼Œä½†æ˜¯åªè¦è¿˜æ˜¯è¢«è¿™ä¸ªfilteræ‹¦æˆªï¼Œé‚£ä¹ˆå°±æ˜¯ä¼ é€’ç›¸åŒçš„request å’Œ response</strong></p><h2 id="15-7-FilterConfig"><a href="#15-7-FilterConfig" class="headerlink" title="15.7 FilterConfig"></a>15.7 FilterConfig</h2><p>â— FilterConfig æ¥å£å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230716090922457.png" alt="image-20230716090922457" style="zoom:50%;" /><p>â— FilterConfig è¯´æ˜</p><ol><li>FilterConfig æ˜¯ Filter è¿‡æ»¤å™¨çš„é…ç½®ç±»</li><li>Tomcat æ¯æ¬¡åˆ›å»º Filter çš„æ—¶å€™ï¼Œä¹Ÿä¼šåˆ›å»ºä¸€ä¸ª FilterConfig å¯¹è±¡ï¼Œè¿™é‡ŒåŒ…å«äº† Filter é…ç½®æ–‡ä»¶çš„é…ç½®ä¿¡æ¯ã€‚</li><li>FilterConfig å¯¹è±¡ä½œç”¨æ˜¯<strong>è·å– filter è¿‡æ»¤å™¨çš„é…ç½®å†…å®¹</strong></li></ol><p>â— åº”ç”¨å®ä¾‹ FilterConfig_.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è€å¸ˆè§£è¯»ï¼š æ¼”ç¤ºFilterConfigä½¿ç”¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HspFilterConfig</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String ip; <span class="comment">//ä»é…ç½®è·å–çš„ip</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;HspFilterConfig init() è¢«è°ƒç”¨..&quot;</span>);</span><br><span class="line">        <span class="comment">//é€šè¿‡filterConfig è·å–ç›¸å…³çš„å‚æ•°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filterName</span> <span class="operator">=</span> filterConfig.getFilterName();</span><br><span class="line">        ip = filterConfig.getInitParameter(<span class="string">&quot;ip&quot;</span>);</span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> filterConfig.getServletContext();</span><br><span class="line">        <span class="comment">//å¯ä»¥è·å–åˆ°è¯¥filteræ‰€æœ‰çš„é…ç½®å‚æ•°å</span></span><br><span class="line">        Enumeration&lt;String&gt; initParameterNames =</span><br><span class="line">                filterConfig.getInitParameterNames();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//éå†æšä¸¾</span></span><br><span class="line">        <span class="keyword">while</span> (initParameterNames.hasMoreElements()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;åå­—=&quot;</span> + initParameterNames.nextElement());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;filterName= &quot;</span> + filterName);</span><br><span class="line">        System.out.println(<span class="string">&quot;ip= &quot;</span> + ip);</span><br><span class="line">        System.out.println(<span class="string">&quot;servletContext= &quot;</span> + servletContext);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šè¿‡forbidden ip æ¥è¿›è¡Œæ§åˆ¶</span></span><br><span class="line">        <span class="comment">//å…ˆè·å–åˆ°è®¿é—®ip</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">remoteAddr</span> <span class="operator">=</span> servletRequest.getRemoteAddr();</span><br><span class="line">        <span class="keyword">if</span>(remoteAddr.contains(ip)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å°æ€è¯¥ç½‘æ®µ..&quot;</span>);</span><br><span class="line">            servletRequest.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).</span><br><span class="line">                    forward(servletRequest,servletResponse);</span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">//ç›´æ¥è¿”å›</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»§ç»­è®¿é—®ç›®æ ‡èµ„æº</span></span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½® web.xml</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HspFilterConfig<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.hspedu.filter.HspFilterConfig<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--è¿™é‡Œå°±æ˜¯ç»™è¯¥filteré…ç½®çš„å‚æ•°-æœ‰ç¨‹åºå‘˜æ ¹æ®ä¸šåŠ¡é€»è¾‘æ¥è®¾ç½®--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>ip<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>127.0<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>port<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>8888<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>email<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>hsp@sohu.com<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HspFilterConfig<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/abc/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="15-8-FilterChain-è¿‡æ»¤å™¨é“¾"><a href="#15-8-FilterChain-è¿‡æ»¤å™¨é“¾" class="headerlink" title="15.8 FilterChain è¿‡æ»¤å™¨é“¾"></a>15.8 FilterChain è¿‡æ»¤å™¨é“¾</h2><h3 id="15-8-1-ä¸€å¥è¯-FilterChain-åœ¨å¤„ç†æŸäº›å¤æ‚ä¸šåŠ¡æ—¶ï¼Œ-ä¸€ä¸ªè¿‡æ»¤å™¨ä¸å¤Ÿï¼Œ-å¯ä»¥è®¾è®¡å¤šä¸ªè¿‡æ»¤å™¨å…±åŒå®Œæˆè¿‡æ»¤ä»»åŠ¡ï¼Œ-å½¢æˆè¿‡æ»¤å™¨é“¾ã€‚"><a href="#15-8-1-ä¸€å¥è¯-FilterChain-åœ¨å¤„ç†æŸäº›å¤æ‚ä¸šåŠ¡æ—¶ï¼Œ-ä¸€ä¸ªè¿‡æ»¤å™¨ä¸å¤Ÿï¼Œ-å¯ä»¥è®¾è®¡å¤šä¸ªè¿‡æ»¤å™¨å…±åŒå®Œæˆè¿‡æ»¤ä»»åŠ¡ï¼Œ-å½¢æˆè¿‡æ»¤å™¨é“¾ã€‚" class="headerlink" title="15.8.1 ä¸€å¥è¯: FilterChain: åœ¨å¤„ç†æŸäº›å¤æ‚ä¸šåŠ¡æ—¶ï¼Œ ä¸€ä¸ªè¿‡æ»¤å™¨ä¸å¤Ÿï¼Œ å¯ä»¥è®¾è®¡å¤šä¸ªè¿‡æ»¤å™¨å…±åŒå®Œæˆè¿‡æ»¤ä»»åŠ¡ï¼Œ å½¢æˆè¿‡æ»¤å™¨é“¾ã€‚"></a>15.8.1 ä¸€å¥è¯: FilterChain: åœ¨å¤„ç†æŸäº›å¤æ‚ä¸šåŠ¡æ—¶ï¼Œ ä¸€ä¸ªè¿‡æ»¤å™¨ä¸å¤Ÿï¼Œ å¯ä»¥è®¾è®¡å¤šä¸ªè¿‡æ»¤å™¨å…±åŒå®Œæˆè¿‡æ»¤ä»»åŠ¡ï¼Œ å½¢æˆè¿‡æ»¤å™¨é“¾ã€‚</h3><h4 id="15-8-2-åŸºæœ¬åŸç†ç¤ºæ„å›¾"><a href="#15-8-2-åŸºæœ¬åŸç†ç¤ºæ„å›¾" class="headerlink" title="15.8.2 åŸºæœ¬åŸç†ç¤ºæ„å›¾"></a>15.8.2 åŸºæœ¬åŸç†ç¤ºæ„å›¾</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230716093408721.png" alt="image-20230716093408721"></p><h3 id="15-8-3-åº”ç”¨å®ä¾‹-AFilter-java-BFilter-java-hi-jsp-web-xml"><a href="#15-8-3-åº”ç”¨å®ä¾‹-AFilter-java-BFilter-java-hi-jsp-web-xml" class="headerlink" title="15.8.3 åº”ç”¨å®ä¾‹ AFilter.java BFilter.java hi.jsp web.xml"></a>15.8.3 åº”ç”¨å®ä¾‹ AFilter.java BFilter.java hi.jsp web.xml</h3><ol><li>éœ€æ±‚ï¼š æ¼”ç¤ºè¿‡æ»¤å™¨é“¾çš„ä½¿ç”¨</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230716093621006.png" alt="image-20230716093621006"></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230716094326928.png" alt="image-20230716094326928" style="zoom: 50%;" /><p>15.8.4 FilterChain æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</p><ol><li><p><strong>å¤šä¸ª filter å’Œç›®æ ‡èµ„æº</strong>åœ¨<u>ä¸€æ¬¡ http è¯·æ±‚</u>ï¼Œ <u>åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­</u></p></li><li><p>å½“ä¸€ä¸ªè¯·æ±‚ url å’Œ filter çš„ url-pattern åŒ¹é…æ—¶, æ‰ä¼šè¢«æ‰§è¡Œ, å¦‚æœæœ‰å¤šä¸ªåŒ¹é…ä¸Šï¼Œ å°±ä¼šé¡ºåºæ‰§è¡Œï¼Œ å½¢æˆä¸€ä¸ª filter è°ƒç”¨é“¾(åº•å±‚å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ•°æ®ç»“æ„æå®š)</p></li><li><p>å¤šä¸ª filter å…±åŒæ‰§è¡Œæ—¶,å› ä¸ºæ˜¯ä¸€æ¬¡ http è¯·æ±‚, <strong>ä½¿ç”¨åŒä¸€ä¸ª request å¯¹è±¡</strong></p></li><li><p>å¤šä¸ª filter <strong>æ‰§è¡Œé¡ºåº</strong>ï¼Œ <strong>å’Œ web.xml é…ç½®é¡ºåºä¿æŒä¸€è‡´.</strong></p></li><li><p>chain.doFilter(req, resp)æ–¹æ³• <strong>å°†æ‰§è¡Œä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨çš„ doFilter æ–¹æ³•, å¦‚æœåé¢æ²¡æœ‰è¿‡æ»¤å™¨ï¼Œåˆ™æ‰§è¡Œç›®æ ‡èµ„æºã€‚</strong></p></li></ol><p><strong>å°ç»“</strong>ï¼š æ³¨æ„æ‰§è¡Œè¿‡æ»¤å™¨é“¾æ—¶, é¡ºåºæ˜¯(ç”¨å‰é¢çš„æ¡ˆä¾‹åˆ†æ) Httpè¯·æ±‚ -&gt; A è¿‡æ»¤å™¨ dofilter()-&gt; A è¿‡æ»¤å™¨å‰ç½®ä»£ç  -&gt; A è¿‡æ»¤å™¨ chain.doFilter() -&gt; B è¿‡æ»¤å™¨ dofilter() -&gt; B è¿‡æ»¤å™¨å‰ç½®ä»£ç  -&gt; Bè¿‡æ»¤å™¨ chain.doFilter() -&gt; ç›®æ ‡æ–‡ä»¶ -&gt; Bè¿‡æ»¤å™¨åç½®ä»£ç  -&gt; Aè¿‡æ»¤å™¨åç½®ä»£ç  -&gt;è¿”å›ç»™æµè§ˆå™¨é¡µé¢&#x2F;æ•°æ®</p><p>ğŸŒŸ<strong>åç½®ä»£ç æŒ‡ï¼šè¿‡æ»¤å™¨ä¸­ doFilter()æ–¹æ³•ä¸­ï¼Œchain.doFilter()ä¹‹åçš„ä»£ç </strong></p><h1 id="18-çº¿ç¨‹æ•°æ®å…±äº«å’Œå®‰å…¨-ThreadLocal"><a href="#18-çº¿ç¨‹æ•°æ®å…±äº«å’Œå®‰å…¨-ThreadLocal" class="headerlink" title="18 çº¿ç¨‹æ•°æ®å…±äº«å’Œå®‰å…¨ -ThreadLocal"></a>18 çº¿ç¨‹æ•°æ®å…±äº«å’Œå®‰å…¨ -ThreadLocal</h1><h2 id="18-1-ä»€ä¹ˆæ˜¯-ThreadLocal"><a href="#18-1-ä»€ä¹ˆæ˜¯-ThreadLocal" class="headerlink" title="18.1 ä»€ä¹ˆæ˜¯ ThreadLocal"></a>18.1 ä»€ä¹ˆæ˜¯ ThreadLocal</h2><ol><li>ThreadLocal çš„ä½œç”¨ï¼Œ å¯ä»¥å®ç°åœ¨åŒä¸€ä¸ªçº¿ç¨‹æ•°æ®å…±äº«, ä»è€Œè§£å†³å¤šçº¿ç¨‹æ•°æ®å®‰å…¨é—®é¢˜.</li><li>ThreadLocal å¯ä»¥ç»™å½“å‰çº¿ç¨‹å…³è”ä¸€ä¸ªæ•°æ®(æ™®é€šå˜é‡ã€å¯¹è±¡ã€æ•°ç»„)set æ–¹æ³• [æºç !]</li><li>ThreadLocal å¯ä»¥åƒ Map ä¸€æ ·å­˜å–æ•°æ®ï¼Œkey ä¸ºå½“å‰çº¿ç¨‹, get æ–¹æ³•</li><li>æ¯ä¸€ä¸ª ThreadLocal å¯¹è±¡ï¼Œåªèƒ½ä¸ºå½“å‰çº¿ç¨‹å…³è”ä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœè¦ä¸ºå½“å‰çº¿ç¨‹å…³è”å¤šä¸ªæ•°æ®ï¼Œå°±éœ€è¦ä½¿ç”¨å¤šä¸ª ThreadLocal å¯¹è±¡å®ä¾‹</li><li>æ¯ä¸ª ThreadLocal å¯¹è±¡å®ä¾‹å®šä¹‰çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¸º static ç±»å‹</li><li>ThreadLocal ä¸­ä¿å­˜æ•°æ®ï¼Œåœ¨çº¿ç¨‹é”€æ¯åï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230716164123672.png" alt="image-20230716164123672" style="zoom: 67%;" /><h2 id="18-2-å¿«é€Ÿå…¥é—¨-ThreadLocal"><a href="#18-2-å¿«é€Ÿå…¥é—¨-ThreadLocal" class="headerlink" title="18.2 å¿«é€Ÿå…¥é—¨ ThreadLocal"></a>18.2 å¿«é€Ÿå…¥é—¨ ThreadLocal</h2><p>â— éœ€æ±‚: æ¼”ç¤º ThreadLocal (ä½œç”¨ï¼š åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­, å…±äº«æ•°æ®(çº¿ç¨‹å®‰å…¨))çš„ä½¿ç”¨-ç”»å›¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">T1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºThreadLocalå¯¹è±¡, åšæˆpublic static.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;Object&gt; threadLocal1 = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;Object&gt; threadLocal2 = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Task æ˜¯çº¿ç¨‹ç±» -&gt; å†…éƒ¨ç±» / çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Task</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">            <span class="type">Pig</span> <span class="variable">pig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Pig</span>();</span><br><span class="line">            <span class="comment">//ç»™threadLocal1 å¯¹è±¡æ”¾å…¥set dog , éš”å±±æ‰“ç‰›</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Task æ”¾å…¥äº† dog= &quot;</span> + dog);</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                è€éŸ©è§£è¯»</span></span><br><span class="line"><span class="comment">                public void set(T value) &#123;</span></span><br><span class="line"><span class="comment">                    //1. è·å–å½“å‰çº¿ç¨‹, å…³è”åˆ°å½“å‰çº¿ç¨‹!</span></span><br><span class="line"><span class="comment">                    Thread t = Thread.currentThread();</span></span><br><span class="line"><span class="comment">                    //2. é€šè¿‡çº¿ç¨‹å¯¹è±¡, è·å–åˆ°ThreadLocalMap</span></span><br><span class="line"><span class="comment">                    //   ThreadLocalMap ç±»å‹ ThreadLocal.ThreadLocalMap</span></span><br><span class="line"><span class="comment">                    ThreadLocalMap map = getMap(t);</span></span><br><span class="line"><span class="comment">                    //3. å¦‚æœmapä¸ä¸ºnull, å°†æ•°æ®(dog,pig..) æ”¾å…¥map </span></span><br><span class="line"><span class="comment">                    -key:threadLocal value:å­˜æ”¾çš„æ•°æ®</span></span><br><span class="line"><span class="comment">                    //ä»è¿™ä¸ªæºç æˆ‘ä»¬å·²ç„¶çœ‹å‡ºä¸€ä¸ªthreadlocalåªèƒ½å…³è”ä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœä½ set, å°±ä¼šæ›¿æ¢</span></span><br><span class="line"><span class="comment">                    //4. å¦‚æœmapä¸ºnull, å°±åˆ›å»ºä¸€ä¸ªå’Œå½“å‰çº¿ç¨‹å…³è”çš„ThreadLocalMap, å¹¶ä¸”è¯¥æ•°æ®æ”¾å…¥</span></span><br><span class="line"><span class="comment">                    if (map != null)</span></span><br><span class="line"><span class="comment">                        map.set(this, value);</span></span><br><span class="line"><span class="comment">                    else</span></span><br><span class="line"><span class="comment">                        createMap(t, value);</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            threadLocal1.set(dog);</span><br><span class="line">            <span class="comment">//threadLocal1.set(pig);//æ›¿æ¢</span></span><br><span class="line">            threadLocal2.set(pig);<span class="comment">//è¿™ä¸ªæ•°æ®å°±ä¼šthreadLocal2å…³è”ï¼Œå¹¶ä¸”éƒ½è¢«å½“å‰Threadç®¡ç†</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Task åœ¨run æ–¹æ³•ä¸­ çº¿ç¨‹=&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">T1Service</span>().update();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Task</span>()).start();<span class="comment">//ä¸»çº¿ç¨‹å¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹,æ³¨æ„ä¸æ˜¯ä¸»çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="18-3-ThreadLocal-æºç è§£è¯»-ç”»å›¾"><a href="#18-3-ThreadLocal-æºç è§£è¯»-ç”»å›¾" class="headerlink" title="18.3 ThreadLocal æºç è§£è¯»+ç”»å›¾"></a>18.3 ThreadLocal æºç è§£è¯»+ç”»å›¾</h2><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230716181639550.png" alt="image-20230716181639550"></p><ol start="3"><li>è€éŸ©è¯´æ˜: è¿™é‡Œæ¶‰åŠåˆ°çš„å¼±å¼•ç”¨ï¼Œæ¶‰åŠåˆ°çŸ¥è¯†ç‚¹å¾ˆå¤šï¼Œæš‚ä¸æ·±å…¥</li></ol><p>ä¸€ä¸ªThreadæœ‰ä¸€ä¸ª threadLocals(TheadLocalMapç±»å‹) ï¼ŒthreadLocalsä¸­æœ‰ä¸€ä¸ªtableï¼Œtableä¸­æœ‰è®¸å¤šæ¡¶ï¼Œæ¯ä¸ªæ¡¶éƒ½æ˜¯Entryç±»å‹ï¼Œï¼ˆEntryçš„keyæ˜¯ThreadLocalç±»å‹ï¼Œvalueæ˜¯ä½ å­˜è¿›å»çš„æ•°æ®)</p><h3 id="âš ï¸ç–‘é—®ï¼š"><a href="#âš ï¸ç–‘é—®ï¼š" class="headerlink" title="âš ï¸ç–‘é—®ï¼š"></a>âš ï¸ç–‘é—®ï¼š</h3><p>ï¼ï¼ï¼threadLocalsä¸­åªæœ‰ä¸€ä¸ªtableï¼Œtableä¸­å­˜ç€è¯¥çº¿ç¨‹å­˜æ”¾çš„è®¸å¤šEntryï¼Œé—®ï¼šä¸ºä»€ä¹ˆä¸æŠŠEntryç›´æ¥æ”¾åœ¨threadLocalsä¸‹é¢ï¼Œè€Œæ˜¯è¦å¤šåŠ ä¸€å±‚tableï¼Ÿ</p><p>â€‹åˆ†å±‚ã€ç”¨äºæœªæ¥æ‰©å±•å§ï¼Ÿ</p>]]></content>
      
      
      <categories>
          
          <category> WebåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaWeb </tag>
            
            <tag> åç«¯å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux</title>
      <link href="/2023/06/20/Linux/"/>
      <url>/2023/06/20/Linux/</url>
      
        <content type="html"><![CDATA[<h1 id="Linuxå­¦ä¹ ğŸš€"><a href="#Linuxå­¦ä¹ ğŸš€" class="headerlink" title="Linuxå­¦ä¹ ğŸš€"></a>Linuxå­¦ä¹ ğŸš€</h1><p>æ“ä½œç³»ç»Ÿæ–‡ä»¶æ—¶ä¸€å®šè¦è®°å¾—å…ˆå¤‡ä»½ï¼ï¼ï¼</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620231850984.png" alt="image-20230620231850984" style="zoom:50%;" /><h2 id="Linuxå…¥é—¨ï¼š"><a href="#Linuxå…¥é—¨ï¼š" class="headerlink" title="Linuxå…¥é—¨ï¼š"></a>Linuxå…¥é—¨ï¼š</h2><h3 id="linuxçš„åº”ç”¨é¢†åŸŸï¼š"><a href="#linuxçš„åº”ç”¨é¢†åŸŸï¼š" class="headerlink" title="linuxçš„åº”ç”¨é¢†åŸŸï¼š"></a>linuxçš„åº”ç”¨é¢†åŸŸï¼š</h3><ul><li><strong>ä¸ªäººæ¡Œé¢é¢†åŸŸ</strong><ul><li>æ­¤é¢†åŸŸæ˜¯ä¼ ç»ŸLinuxåº”ç”¨è–„å¼±çš„ç¯èŠ‚ï¼Œè¿‘äº›å¹´æ¥éšç€ubuntuã€fedoraç­‰ä¼˜ç§€æ¡Œé¢ç¯å¢ƒçš„å…´èµ·ï¼ŒLinuxåœ¨ä¸ªäººæ¡Œé¢é¢†åŸŸçš„å æœ‰ç‡æ­£åœ¨é€æ¸çš„æé«˜</li></ul></li><li><strong>æœåŠ¡å™¨é¢†åŸŸ</strong><ul><li>linuxåœ¨<u>æœåŠ¡å™¨é¢†åŸŸçš„åº”ç”¨æ˜¯æœ€å¼ºçš„</u>ã€‚</li><li>linux <u><em>å…è´¹ã€ç¨³å®šã€é«˜æ•ˆ</em></u> ç­‰ç‰¹ç‚¹åœ¨è¿™é‡Œå¾—åˆ°äº†å¾ˆå¥½çš„ä½“ç°ï¼Œå°¤å…¶åœ¨ä¸€äº›é«˜ç«¯é¢†åŸŸå°¤ä¸ºå¹¿æ³›( c&#x2F;c+ + &#x2F;php&#x2F;java&#x2F;python) .</li></ul></li><li><strong>åµŒå…¥å¼é¢†åŸŸ</strong><ul><li>linuxè¿è¡Œç¨³å®šã€å¯¹ç½‘ç»œçš„è‰¯å¥½æ”¯æŒæ€§ï¼Œä½æˆæœ¬ï¼Œä¸”<strong>å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè½¯ä»¶è£å‰ª</strong>ï¼Œå†…æ ¸æœ€å°å¯ä»¥è¾¾åˆ°å‡ ç™¾KBç­‰ç‰¹ç‚¹ï¼Œä½¿å…¶è¿‘äº›å¹´æ¥åœ¨åµŒå…¥å¼é¢†åŸŸçš„åº”ç”¨å¾—åˆ°éå¸¸å¤§çš„æé«˜ï¼›</li><li>ä¸»è¦åº”ç”¨ï¼šæœºé¡¶ç›’ã€æ•°å®‡ç”µè§†ã€ç½‘ç»œç”µè¯ã€ç¨‹æ§äº¤æ¢æœºã€æ‰‹æœºã€PDAã€æ™ºèƒ½å®¶å±…ã€æ™ºèƒ½ç¡¬ä»¶ç­‰éƒ½æ˜¯å…¶åº”ç”¨é¢†åŸŸã€‚ä»¥ååœ¨ç‰©è”ç½‘ä¸­åº”ç”¨ä¼šæ›´åŠ å¹¿æ³›ã€‚</li></ul></li></ul><h3 id="ç½‘ç»œè¿æ¥çš„ä¸‰ç§æ–¹å¼ï¼š"><a href="#ç½‘ç»œè¿æ¥çš„ä¸‰ç§æ–¹å¼ï¼š" class="headerlink" title="ç½‘ç»œè¿æ¥çš„ä¸‰ç§æ–¹å¼ï¼š"></a>ç½‘ç»œè¿æ¥çš„ä¸‰ç§æ–¹å¼ï¼š</h3><ol><li><p>æ¡¥æ¥æ¨¡å¼</p></li><li><p>NATæ¨¡å¼</p></li><li><p>ä¸»æœºæ¨¡å¼</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/IMG_31492E73D3F2-1.jpeg" alt="IMG_31492E73D3F2-1"></p><h3 id="è™šæ‹Ÿæœºå…‹éš†-æ–¹ä¾¿å¿«é€Ÿæ„å»ºé›†ç¾¤"><a href="#è™šæ‹Ÿæœºå…‹éš†-æ–¹ä¾¿å¿«é€Ÿæ„å»ºé›†ç¾¤" class="headerlink" title="è™šæ‹Ÿæœºå…‹éš†(æ–¹ä¾¿å¿«é€Ÿæ„å»ºé›†ç¾¤)"></a>è™šæ‹Ÿæœºå…‹éš†(æ–¹ä¾¿å¿«é€Ÿæ„å»ºé›†ç¾¤)</h3><p>â€‹å¦‚æœä½ å·²ç»å®‰è£…äº†ä¸€åˆlinuxæ“ä½œç³»ç»Ÿï¼Œä½ è¿˜æƒ³å†æ›´å¤šçš„ï¼Œè€éŸ©æç¤ºå¤§å®¶ï¼šæ²¡æœ‰å¿…è¦å†é‡æ–°å®‰è£…ï¼Œä½ åªéœ€è¦å…‹éš†å°±å¯ä»¥ã€‚</p><ul><li>æ–¹å¼1ï¼šç›´æ¥æ‹·è´ä¸€ä»½å®‰è£…å¥½çš„è™›æ‹Ÿæœºæ–‡ä»¶</li><li>æ–¹å¼2ï¼šä½¿ç”¨vmwareçš„å…‹éš†æ“ä½œï¼Œæ³¨æ„ï¼Œå…‹éš†æ—¶ï¼Œéœ€è¦å…ˆå…³é—­linuxç³»ç»Ÿ</li></ul><h3 id="è™šæ‹Ÿæœºå¿«ç…§"><a href="#è™šæ‹Ÿæœºå¿«ç…§" class="headerlink" title="è™šæ‹Ÿæœºå¿«ç…§"></a>è™šæ‹Ÿæœºå¿«ç…§</h3><p>å¦‚æœä½ åœ¨ä½¿ç”¨è™›æ‹Ÿæœºç³»ç»Ÿçš„æ—¶å€™(æ¯”å¦‚linuxï¼‰ï¼Œä½ æƒ³<strong>å›åˆ°åŸå…ˆçš„æŸä¸€ä¸ªçŠ¶æ€</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ æ‹…å¿ƒå¯èƒ½æœ‰äº›è¯¯æ“ä½œé€ æˆç³»ç»Ÿå¼‚å¸¸ï¼Œéœ€è¦å›åˆ°åŸå…ˆæŸä¸ªæ­£å¸¸è¿è¡Œçš„çŠ¶æ€ï¼Œvmwareä¹Ÿæä¾›äº†è¿™æ ·çš„åŠŸèƒ½ï¼Œå°±å«å¿«ç…§ç®¡ç†ã€‚</p><h2 id="åŸºç¡€çŸ¥è¯†ï¼š"><a href="#åŸºç¡€çŸ¥è¯†ï¼š" class="headerlink" title="åŸºç¡€çŸ¥è¯†ï¼š"></a>åŸºç¡€çŸ¥è¯†ï¼š</h2><h3 id="å‘½ä»¤è¡Œç»“æ„ï¼š"><a href="#å‘½ä»¤è¡Œç»“æ„ï¼š" class="headerlink" title="å‘½ä»¤è¡Œç»“æ„ï¼š"></a>å‘½ä»¤è¡Œç»“æ„ï¼š</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@iZbp1cmlu7iso80jlaxx2uZ:~# pwd</span><br><span class="line">/root</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><ul><li><code>root</code>ï¼šè¡¨ç¤ºç”¨æˆ·åï¼›</li><li><code>iZbp1cmlu7iso80jlaxx2uZ</code>ï¼šè¡¨ç¤ºä¸»æœºåï¼›</li><li><code>~</code>ï¼šè¡¨ç¤ºç›®å‰æ‰€åœ¨ç›®å½•ä¸ºå®¶ç›®å½•ï¼Œå…¶ä¸­ <code>root</code> ç”¨æˆ·çš„å®¶ç›®å½•æ˜¯ <code>/root</code> æ™®é€šç”¨æˆ·çš„å®¶ç›®å½•åœ¨ <code>/home</code> ä¸‹ï¼›</li><li><code>#</code>ï¼šæŒ‡ç¤ºä½ æ‰€å…·æœ‰çš„æƒé™ï¼ˆ <code>root</code> ç”¨æˆ·ä¸º <code>#</code> ï¼Œæ™®é€šç”¨æˆ·ä¸º <code>$</code> ï¼‰ã€‚</li></ul><h3 id="ä¸€äº›å¿«æ·é”®ï¼š"><a href="#ä¸€äº›å¿«æ·é”®ï¼š" class="headerlink" title="ä¸€äº›å¿«æ·é”®ï¼š"></a>ä¸€äº›å¿«æ·é”®ï¼š</h3><ul><li>é€šè¿‡ä¸Šä¸‹æ–¹å‘é”® â†‘ â†“ æ¥è°ƒå–è¿‡å¾€æ‰§è¡Œè¿‡çš„ <code>Linux</code> å‘½ä»¤ï¼›</li><li>å‘½ä»¤æˆ–å‚æ•°ä»…éœ€è¾“å…¥å‰å‡ ä½å°±å¯ä»¥ç”¨ <code>Tab</code> é”®è¡¥å…¨ï¼›</li><li><code>Ctrl + R</code> ï¼šç”¨äºæŸ¥æ‰¾ä½¿ç”¨è¿‡çš„å‘½ä»¤ï¼ˆ<code>history</code> å‘½ä»¤ç”¨äºåˆ—å‡ºä¹‹å‰ä½¿ç”¨è¿‡çš„æ‰€æœ‰å‘½ä»¤ï¼Œç„¶åè¾“å…¥ <code>!</code> å‘½ä»¤åŠ ä¸Šç¼–å·( <code>!2</code> )å°±å¯ä»¥ç›´æ¥æ‰§è¡Œè¯¥å†å²å‘½ä»¤ï¼‰ï¼›</li><li><code>Ctrl + L</code>ï¼šæ¸…é™¤å±å¹•å¹¶å°†å½“å‰è¡Œç§»åˆ°é¡µé¢é¡¶éƒ¨ï¼›</li><li><code>Ctrl + C</code>ï¼šä¸­æ­¢å½“å‰æ­£åœ¨æ‰§è¡Œçš„å‘½ä»¤ï¼›</li><li><code>Ctrl + U</code>ï¼šä»å…‰æ ‡ä½ç½®å‰ªåˆ‡åˆ°è¡Œé¦–ï¼›</li><li><code>Ctrl + K</code>ï¼šä»å…‰æ ‡ä½ç½®å‰ªåˆ‡åˆ°è¡Œå°¾ï¼›</li><li><code>Ctrl + W</code>ï¼šå‰ªåˆ‡å…‰æ ‡å·¦ä¾§çš„ä¸€ä¸ªå•è¯ï¼›</li><li><code>Ctrl + Y</code>ï¼šç²˜è´´ <code>Ctrl + U | K | Y</code> å‰ªåˆ‡çš„å‘½ä»¤ï¼›</li><li><code>Ctrl + A</code>ï¼šå…‰æ ‡è·³åˆ°å‘½ä»¤è¡Œçš„å¼€å¤´ï¼›</li><li><code>Ctrl + E</code>ï¼šå…‰æ ‡è·³åˆ°å‘½ä»¤è¡Œçš„ç»“å°¾ï¼›</li><li><code>Ctrl + D</code>ï¼šå…³é—­ <code>Shell</code> ä¼šè¯ï¼›</li></ul><h3 id="å¸¸ç”¨å‘½ä»¤ï¼š"><a href="#å¸¸ç”¨å‘½ä»¤ï¼š" class="headerlink" title="å¸¸ç”¨å‘½ä»¤ï¼š"></a>å¸¸ç”¨å‘½ä»¤ï¼š</h3><h4 id="whichï¼š"><a href="#whichï¼š" class="headerlink" title="whichï¼š"></a>whichï¼š</h4><p>â€”â€”æŸ¥çœ‹å‘½ä»¤çš„å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨è·¯å¾„</p><p>â€‹<code>Linux</code> ä¸‹ï¼Œæ¯ä¸€æ¡å‘½ä»¤å…¶å®éƒ½å¯¹åº”ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥å‘½ä»¤ï¼ŒæŒ‰å›è½¦çš„æ—¶å€™ï¼Œå°±æ˜¯æ‰§è¡Œäº†å¯¹åº”çš„é‚£ä¸ªç¨‹åºï¼Œ <code>which</code> å‘½ä»¤æœ¬èº«å¯¹åº”çš„ç¨‹åºä¹Ÿå­˜åœ¨äº <code>Linux</code> ä¸­ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20231219111417608.png" alt="image-20231219111417608"></p><h4 id="cat"><a href="#cat" class="headerlink" title="cat:"></a>cat:</h4><p>ä¸€æ¬¡æ€§æ˜¾ç¤ºæ–‡ä»¶æ‰€æœ‰å†…å®¹ï¼Œæ›´é€‚åˆæŸ¥çœ‹å°çš„æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat cloud-init.log</span><br></pre></td></tr></table></figure><p>ã€å¸¸ç”¨å‚æ•°ã€‘</p><ul><li><code>-n</code> æ˜¾ç¤ºè¡Œå·ã€‚</li></ul><h4 id="lessï¼š"><a href="#lessï¼š" class="headerlink" title="lessï¼š"></a>lessï¼š</h4><p>åˆ†é¡µæ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼Œæ›´é€‚åˆæŸ¥çœ‹å¤§çš„æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">less cloud-init.log</span><br></pre></td></tr></table></figure><h4 id="headï¼š"><a href="#headï¼š" class="headerlink" title="headï¼š"></a>headï¼š</h4><p>æ˜¾ç¤ºæ–‡ä»¶çš„å¼€å¤´å‡ è¡Œï¼ˆé»˜è®¤æ˜¯10è¡Œï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head cloud-init.log</span><br></pre></td></tr></table></figure><p>ã€å‚æ•°ã€‘</p><ul><li><code>-n</code> æŒ‡å®šè¡Œæ•° <code>head cloud-init.log -n 2</code></li></ul><p>(è¦çœ‹å‡ è¡Œï¼Œè€Œä¸æ˜¯çœ‹ç¬¬å‡ è¡Œ)</p><h4 id="tailï¼š"><a href="#tailï¼š" class="headerlink" title="tailï¼š"></a>tailï¼š</h4><p>æ˜¾ç¤ºæ–‡ä»¶çš„ç»“å°¾å‡ è¡Œï¼ˆé»˜è®¤æ˜¯10è¡Œï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail cloud-init.logå¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ã€å‚æ•°ã€‘</p><ul><li><code>-n</code> æŒ‡å®šè¡Œæ•° <code>tail cloud-init.log -n 2</code></li><li><code>-f</code> ä¼šæ¯è¿‡1ç§’æ£€æŸ¥ä¸‹æ–‡ä»¶æ˜¯å¦æœ‰æ›´æ–°å†…å®¹ï¼Œä¹Ÿå¯ä»¥ç”¨ <code>-s</code> å‚æ•°æŒ‡å®šé—´éš”æ—¶é—´ <code>tail -f -s 4 xxx.log</code></li></ul><h4 id="touchï¼š"><a href="#touchï¼š" class="headerlink" title="touchï¼š"></a>touchï¼š</h4><p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch new_file</span><br></pre></td></tr></table></figure><h4 id="mkdirï¼š"><a href="#mkdirï¼š" class="headerlink" title="mkdirï¼š"></a>mkdirï¼š</h4><p>åˆ›å»ºä¸€ä¸ªç›®å½•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> new_folder</span><br></pre></td></tr></table></figure><p>ã€å¸¸ç”¨å‚æ•°ã€‘</p><ul><li><code>-p</code> é€’å½’çš„åˆ›å»ºç›®å½•ç»“æ„ <code>mkdir -p one/two/three</code></li></ul><h4 id="cpï¼š"><a href="#cpï¼š" class="headerlink" title="cpï¼š"></a>cpï¼š</h4><p>æ‹·è´æ–‡ä»¶å’Œç›®å½•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> file file_copy </span><br><span class="line">--&gt; file æ˜¯ç›®æ ‡æ–‡ä»¶ï¼Œfile_copy æ˜¯æ‹·è´å‡ºæ¥çš„æ–‡ä»¶</span><br><span class="line"><span class="built_in">cp</span> file one --&gt; æŠŠ file æ–‡ä»¶æ‹·è´åˆ° one ç›®å½•ä¸‹ï¼Œå¹¶ä¸”æ–‡ä»¶åä¾ç„¶ä¸º file</span><br><span class="line"><span class="built_in">cp</span> file one/file_copy --&gt; æŠŠ file æ–‡ä»¶æ‹·è´åˆ° one ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åä¸ºfile_copy</span><br><span class="line"><span class="built_in">cp</span> *.txt folder --&gt; æŠŠå½“å‰ç›®å½•ä¸‹æ‰€æœ‰ txt æ–‡ä»¶æ‹·è´åˆ° folder ç›®å½•ä¸‹</span><br></pre></td></tr></table></figure><p>ã€å¸¸ç”¨å‚æ•°ã€‘</p><ul><li><code>-r</code> é€’å½’çš„æ‹·è´ï¼Œå¸¸ç”¨æ¥æ‹·è´ä¸€æ•´ä¸ªç›®å½•</li></ul><h4 id="mvï¼š"><a href="#mvï¼š" class="headerlink" title="mvï¼š"></a>mvï¼š</h4><p>ç§»åŠ¨ï¼ˆé‡å‘½åï¼‰æ–‡ä»¶æˆ–ç›®å½•ï¼Œä¸cpå‘½ä»¤ç”¨æ³•ç›¸ä¼¼ã€‚</p><h4 id="rmï¼š"><a href="#rmï¼š" class="headerlink" title="rmï¼š"></a>rmï¼š</h4><p>åˆ é™¤æ–‡ä»¶å’Œç›®å½•ï¼Œç”±äº <code>Linux</code> ä¸‹æ²¡æœ‰å›æ”¶ç«™ï¼Œä¸€æ—¦åˆ é™¤éå¸¸éš¾æ¢å¤ï¼Œå› æ­¤éœ€è¦è°¨æ…æ“ä½œ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> new_file  --&gt; åˆ é™¤ new_file æ–‡ä»¶</span><br><span class="line"><span class="built_in">rm</span> f1 f2 f3  --&gt; åŒæ—¶åˆ é™¤ f1 f2 f3 3ä¸ªæ–‡ä»¶</span><br></pre></td></tr></table></figure><p>ã€å¸¸ç”¨å‚æ•°ã€‘</p><ul><li><code>-i</code> å‘ç”¨æˆ·ç¡®è®¤æ˜¯å¦åˆ é™¤ï¼›</li><li><code>-f</code> æ–‡ä»¶å¼ºåˆ¶åˆ é™¤ï¼›</li><li><code>-r</code> é€’å½’åˆ é™¤æ–‡ä»¶å¤¹ï¼Œè‘—åçš„åˆ é™¤æ“ä½œ <code>rm -rf</code> ã€‚</li></ul><h4 id="lnï¼š"><a href="#lnï¼š" class="headerlink" title="lnï¼š"></a>lnï¼š</h4><p>è‹±æ–‡ <code>Link</code> çš„ç¼©å†™ï¼Œè¡¨ç¤ºåˆ›å»ºé“¾æ¥ã€‚</p><p>å­¦ä¹ åˆ›å»ºé“¾æ¥ä¹‹å‰ï¼Œé¦–å…ˆè¦ç†è§£é“¾æ¥æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ <code>Linux</code> çš„æ–‡ä»¶æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼š</p><p><code>Linux</code> æ–‡ä»¶çš„å­˜å‚¨æ–¹å¼åˆ†ä¸º3ä¸ªéƒ¨åˆ†ï¼Œæ–‡ä»¶åã€æ–‡ä»¶å†…å®¹ä»¥åŠæƒé™ï¼Œå…¶ä¸­æ–‡ä»¶åçš„åˆ—è¡¨æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜çš„å…¶å®ƒåœ°æ–¹å’Œæ–‡ä»¶å†…å®¹æ˜¯åˆ†å¼€å­˜æ”¾çš„ï¼Œæ¯ä¸ªæ–‡ä»¶åé€šè¿‡ <code>inode</code> æ ‡è¯†ç»‘å®šåˆ°æ–‡ä»¶å†…å®¹ã€‚</p><p>Linux ä¸‹æœ‰ä¸¤ç§é“¾æ¥ç±»å‹ï¼šç¡¬é“¾æ¥å’Œè½¯é“¾æ¥ã€‚</p><h5 id="ç¡¬é“¾æ¥"><a href="#ç¡¬é“¾æ¥" class="headerlink" title="ç¡¬é“¾æ¥"></a>ç¡¬é“¾æ¥</h5><p>ä½¿é“¾æ¥çš„ä¸¤ä¸ªæ–‡ä»¶å…±äº«åŒæ ·æ–‡ä»¶å†…å®¹ï¼Œå°±æ˜¯åŒæ ·çš„ <code>inode</code> ï¼Œä¸€æ—¦æ–‡ä»¶1å’Œæ–‡ä»¶2ä¹‹é—´æœ‰äº†ç¡¬é“¾æ¥ï¼Œé‚£ä¹ˆä¿®æ”¹ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ï¼Œä¿®æ”¹çš„éƒ½æ˜¯åŒä¸€å—å†…å®¹ï¼Œå®ƒçš„ç¼ºç‚¹æ˜¯ï¼Œåªèƒ½åˆ›å»ºæŒ‡å‘æ–‡ä»¶(æ–‡ä»¶å†…å®¹)çš„ç¡¬é“¾æ¥ï¼Œä¸èƒ½åˆ›å»ºæŒ‡å‘ç›®å½•çš„ï¼ˆå…¶å®ä¹Ÿå¯ä»¥ï¼Œä½†æ¯”è¾ƒå¤æ‚ï¼‰è€Œè½¯é“¾æ¥éƒ½å¯ä»¥ï¼Œå› æ­¤è½¯é“¾æ¥ä½¿ç”¨æ›´åŠ å¹¿æ³›ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> file1 file2  --&gt; åˆ›å»º file2 ä¸º file1 çš„ç¡¬é“¾æ¥</span><br></pre></td></tr></table></figure><p><img src="https://mmbiz.qpic.cn/mmbiz/9aPYe0E1fb12HhSLxYibr9w8y4GKAfhTDefy14gyK7BcCLpEdwOKzTXcOStZOVy1mfY4AS462pbQ6iaOj5pqEoNQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡">å›¾ç‰‡</p><p>å¦‚æœæˆ‘ä»¬ç”¨ <code>rm file1</code> æ¥åˆ é™¤ <code>file1</code> ï¼Œå¯¹ <code>file2</code> æ²¡æœ‰ä»€ä¹ˆå½±å“ï¼Œå¯¹äºç¡¬é“¾æ¥æ¥è¯´ï¼Œåˆ é™¤ä»»æ„ä¸€æ–¹çš„æ–‡ä»¶ï¼Œå…±åŒæŒ‡å‘çš„æ–‡ä»¶å†…å®¹å¹¶ä¸ä¼šä»ç¡¬ç›˜ä¸Šåˆ é™¤ã€‚åªæœ‰åŒæ—¶åˆ é™¤äº† <code>file1</code> ä¸<code>file2</code> åï¼Œå®ƒä»¬å…±åŒæŒ‡å‘çš„æ–‡ä»¶å†…å®¹æ‰ä¼šæ¶ˆå¤±ã€‚</p><h5 id="è½¯é“¾æ¥"><a href="#è½¯é“¾æ¥" class="headerlink" title="è½¯é“¾æ¥"></a>è½¯é“¾æ¥</h5><p>è½¯é“¾æ¥å°±ç±»ä¼¼ <code>windows</code> ä¸‹å¿«æ·æ–¹å¼ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s file1 file2</span><br></pre></td></tr></table></figure><p><img src="https://mmbiz.qpic.cn/mmbiz/9aPYe0E1fb12HhSLxYibr9w8y4GKAfhTDnmrlUBQiaRyufJdTZnSoDUYlBgPQWnbGzyJl9NB9hPUfZtPOlQM5Yibg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡">å›¾ç‰‡</p><p>æ‰§è¡Œ <code>ls -l</code> å‘½åæŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ–‡ä»¶çš„å…·ä½“ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">total 0-rw-r--r-- 1 root root 0 Jan 14 06:29 </span><br><span class="line">file1lrwxrwxrwx 1 root root 5 Jan 14 06:42 </span><br><span class="line">file2 -&gt; file1  # è¡¨ç¤ºfile2 æŒ‡å‘ file1å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å…¶å® <code>file2</code> åªæ˜¯ <code>file1</code> çš„ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œå®ƒæŒ‡å‘çš„æ˜¯ <code>file1</code> ï¼Œæ‰€ä»¥æ˜¾ç¤ºçš„æ˜¯ <code>file1</code> çš„å†…å®¹ï¼Œä½†å…¶å® <code>file2</code> çš„ <code>inode</code> ä¸ <code>file1</code> å¹¶ä¸ç›¸åŒã€‚å¦‚æœæˆ‘ä»¬åˆ é™¤äº† <code>file2</code> çš„è¯ï¼Œ <code>file1</code>æ˜¯ä¸ä¼šå—å½±å“çš„ï¼Œä½†å¦‚æœåˆ é™¤ <code>file1</code> çš„è¯ï¼Œ <code>file2</code> å°±ä¼šå˜æˆæ­»é“¾æ¥ï¼Œå› ä¸ºæŒ‡å‘çš„æ–‡ä»¶ä¸è§äº†ã€‚</p><h3 id="ç”¨æˆ·ä¸æƒé™ï¼š"><a href="#ç”¨æˆ·ä¸æƒé™ï¼š" class="headerlink" title="ç”¨æˆ·ä¸æƒé™ï¼š"></a>ç”¨æˆ·ä¸æƒé™ï¼š</h3><p>linuxæ“ä½œç³»ç»Ÿä¸­ï¼Œrootç”¨æˆ·æ˜¯è¶…çº§ç”¨æˆ·ï¼Œæ‹¥æœ‰æœ€é«˜æƒé™</p><p>æ™®é€šç”¨æˆ·éœ€è¦æ›´é«˜æƒé™æ¥æ‰§è¡Œæ“ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>sudo</code>å‘½ä»¤</p><h4 id="åˆ›å»ºã€åˆ é™¤ç”¨æˆ·ï¼š"><a href="#åˆ›å»ºã€åˆ é™¤ç”¨æˆ·ï¼š" class="headerlink" title="åˆ›å»ºã€åˆ é™¤ç”¨æˆ·ï¼š"></a>åˆ›å»ºã€åˆ é™¤ç”¨æˆ·ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useradd lion --&gt; æ·»åŠ ä¸€ä¸ªlionç”¨æˆ·ï¼Œæ·»åŠ å®Œä¹‹ååœ¨ /home è·¯å¾„ä¸‹å¯ä»¥æŸ¥çœ‹</span><br><span class="line">passwd lion --&gt; ä¿®æ”¹lionç”¨æˆ·çš„å¯†ç </span><br><span class="line"></span><br><span class="line">userdel lion --&gt; åªä¼šåˆ é™¤ç”¨æˆ·åï¼Œä¸ä¼šä»/homeä¸­åˆ é™¤å¯¹åº”æ–‡ä»¶å¤¹</span><br><span class="line">userdel lion -r --&gt; ä¼šåŒæ—¶åˆ é™¤/homeä¸‹çš„å¯¹åº”æ–‡ä»¶å¤¹</span><br></pre></td></tr></table></figure><h4 id="suï¼š"><a href="#suï¼š" class="headerlink" title="suï¼š"></a>suï¼š</h4><p>åˆ‡æ¢ç”¨æˆ·ï¼Œéœ€è¦ <code>root</code> ç”¨æˆ·æƒé™</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo su --&gt; åˆ‡æ¢ä¸ºrootç”¨æˆ·ï¼ˆ<span class="built_in">exit</span> å‘½ä»¤æˆ– CTRL + D å¿«æ·é”®éƒ½å¯ä»¥ä½¿æ™®é€šç”¨æˆ·åˆ‡æ¢ä¸º root ç”¨æˆ·ï¼‰</span><br><span class="line">su lion --&gt; åˆ‡æ¢ä¸ºæ™®é€šç”¨æˆ·</span><br><span class="line">su - --&gt; åˆ‡æ¢ä¸ºrootç”¨æˆ·</span><br></pre></td></tr></table></figure><h4 id="ç¾¤ç»„çš„ç®¡ç†ï¼š"><a href="#ç¾¤ç»„çš„ç®¡ç†ï¼š" class="headerlink" title="ç¾¤ç»„çš„ç®¡ç†ï¼š"></a>ç¾¤ç»„çš„ç®¡ç†ï¼š</h4><p><code>Linux</code> ä¸­æ¯ä¸ªç”¨æˆ·éƒ½å±äºä¸€ä¸ªç‰¹å®šçš„ç¾¤ç»„ï¼Œå¦‚æœä½ ä¸è®¾ç½®ç”¨æˆ·çš„ç¾¤ç»„ï¼Œé»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ªå’Œå®ƒçš„ç”¨æˆ·åä¸€æ ·çš„ç¾¤ç»„ï¼Œå¹¶ä¸”æŠŠç”¨æˆ·åˆ’å½’åˆ°è¿™ä¸ªç¾¤ç»„ã€‚</p><h5 id="groupadd"><a href="#groupadd" class="headerlink" title="groupadd"></a>groupadd</h5><p>åˆ›å»ºç¾¤ç»„ï¼Œç”¨æ³•å’Œ <code>useradd</code> ç±»ä¼¼ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd friends</span><br></pre></td></tr></table></figure><h5 id="groupdel"><a href="#groupdel" class="headerlink" title="groupdel"></a>groupdel</h5><p>åˆ é™¤ä¸€ä¸ªå·²å­˜åœ¨çš„ç¾¤ç»„</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupdel foo  --&gt; åˆ é™¤fooç¾¤ç»„</span><br></pre></td></tr></table></figure><h5 id="groups"><a href="#groups" class="headerlink" title="groups"></a>groups</h5><p>æŸ¥çœ‹ç”¨æˆ·æ‰€åœ¨ç¾¤ç»„</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">groups</span> lion  --&gt; æŸ¥çœ‹ lion ç”¨æˆ·æ‰€åœ¨çš„ç¾¤ç»„</span><br></pre></td></tr></table></figure><h5 id="usermod"><a href="#usermod" class="headerlink" title="usermod:"></a>usermod:</h5><p>ç”¨äºä¿®æ”¹ç”¨æˆ·çš„è´¦æˆ·ã€‚</p><p>ã€å¸¸ç”¨å‚æ•°ã€‘</p><ul><li><code>-l</code> å¯¹ç”¨æˆ·é‡å‘½åã€‚éœ€è¦æ³¨æ„çš„æ˜¯ <code>/home</code> ä¸­çš„ç”¨æˆ·å®¶ç›®å½•çš„åå­—ä¸ä¼šæ”¹å˜ï¼Œéœ€è¦æ‰‹åŠ¨ä¿®æ”¹ã€‚</li><li><code>-g</code> ä¿®æ”¹ç”¨æˆ·æ‰€åœ¨çš„ç¾¤ç»„ï¼Œä¾‹å¦‚ <code>usermod -g friends lion</code>ä¿®æ”¹ <code>lion</code> ç”¨æˆ·çš„ç¾¤ç»„ä¸º <code>friends</code> ã€‚</li><li><code>-G</code> ä¸€æ¬¡æ€§è®©ç”¨æˆ·æ·»åŠ å¤šä¸ªç¾¤ç»„ï¼Œä¾‹å¦‚ <code>usermod -G friends,foo,bar lion</code> ã€‚</li><li><code>-a</code> <code>-G</code> ä¼šè®©ä½ ç¦»å¼€åŸå…ˆçš„ç¾¤ç»„ï¼Œå¦‚æœä½ ä¸æƒ³è¿™æ ·åšçš„è¯ï¼Œå°±å¾—å†æ·»åŠ  <code>-a</code> å‚æ•°ï¼Œæ„å‘³ç€<code>append</code> è¿½åŠ çš„æ„æ€ã€‚</li></ul><h5 id="chgrp"><a href="#chgrp" class="headerlink" title="chgrp"></a>chgrp</h5><p>ç”¨äºä¿®æ”¹æ–‡ä»¶çš„ç¾¤ç»„ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chgrp</span> bar file.txt --&gt; file.txtæ–‡ä»¶çš„ç¾¤ç»„ä¿®æ”¹ä¸ºbar</span><br></pre></td></tr></table></figure><h5 id="chown"><a href="#chown" class="headerlink" title="chown"></a>chown</h5><p>æ”¹å˜æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼Œéœ€è¦ <code>root</code> èº«ä»½æ‰èƒ½è¿è¡Œã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> lion file.txt --&gt; æŠŠå…¶å®ƒç”¨æˆ·åˆ›å»ºçš„file.txtè½¬è®©ç»™lionç”¨æˆ·</span><br><span class="line"><span class="built_in">chown</span> lion:bar file.txt --&gt; æŠŠfile.txtçš„ç”¨æˆ·æ”¹ä¸ºlionï¼Œç¾¤ç»„æ”¹ä¸ºbar</span><br></pre></td></tr></table></figure><p>ã€å¸¸ç”¨å‚æ•°ã€‘</p><ul><li><code>-R</code> é€’å½’è®¾ç½®å­ç›®å½•å’Œå­æ–‡ä»¶ï¼Œ <code>chown -R lion:lion /home/frank</code> æŠŠ <code>frank</code> æ–‡ä»¶å¤¹çš„ç”¨æˆ·å’Œç¾¤ç»„éƒ½æ”¹ä¸º <code>lion</code> ã€‚</li></ul><h3 id="æ–‡ä»¶æƒé™ç®¡ç†ï¼š"><a href="#æ–‡ä»¶æƒé™ç®¡ç†ï¼š" class="headerlink" title="æ–‡ä»¶æƒé™ç®¡ç†ï¼š"></a>æ–‡ä»¶æƒé™ç®¡ç†ï¼š</h3><h4 id="chmod"><a href="#chmod" class="headerlink" title="chmod:"></a>chmod:</h4><p>ä¿®æ”¹è®¿é—®æƒé™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 740 file.txt</span><br></pre></td></tr></table></figure><p>ã€å¸¸ç”¨å‚æ•°ã€‘</p><ul><li><code>-R</code> å¯ä»¥é€’å½’åœ°ä¿®æ”¹æ–‡ä»¶è®¿é—®æƒé™ï¼Œä¾‹å¦‚ <code>chmod -R 777 /home/lion</code></li></ul><p>ä¿®æ”¹æƒé™çš„ç¡®ç®€å•ï¼Œä½†æ˜¯ç†è§£å…¶æ·±å±‚æ¬¡çš„æ„ä¹‰æ‰æ˜¯æ›´åŠ é‡è¦çš„ã€‚ä¸‹é¢æˆ‘ä»¬æ¥ç³»ç»Ÿçš„å­¦ä¹ <code>Linux</code> çš„æ–‡ä»¶æƒé™ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@iZbp1cmlu7iso80jlaxx2uZ:/tangjy<span class="comment"># ll</span></span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec 19 14:40 ./</span><br><span class="line">drwxr-xr-x 20 root root 4096 Dec 19 14:08 ../</span><br><span class="line">-rw-r--r--  1 root root    0 Dec 19 14:40 file1</span><br><span class="line">lrwxrwxrwx  1 root root    5 Dec 19 14:40 file2 -&gt; file1</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>drwxr-xr-x</code> è¡¨ç¤ºæ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ¥è§£è¯»å®ƒå…·ä½“ä»£è¡¨ä»€ä¹ˆï¼Ÿ</p><ul><li><code>d</code> ï¼šè¡¨ç¤ºç›®å½•ï¼Œå°±æ˜¯è¯´è¿™æ˜¯ä¸€ä¸ªç›®å½•ï¼Œæ™®é€šæ–‡ä»¶æ˜¯ <code>-</code> ï¼Œé“¾æ¥æ˜¯ <code>l</code> ã€‚</li><li><code>r</code> ï¼š<code>read</code> è¡¨ç¤ºæ–‡ä»¶å¯è¯»ã€‚</li><li><code>w</code> ï¼š<code>write</code> è¡¨ç¤ºæ–‡ä»¶å¯å†™ï¼Œä¸€èˆ¬æœ‰å†™çš„æƒé™ï¼Œå°±æœ‰åˆ é™¤çš„æƒé™ã€‚</li><li><code>x</code> ï¼š<code>execute</code> è¡¨ç¤ºæ–‡ä»¶å¯æ‰§è¡Œã€‚</li><li><code>-</code> ï¼šè¡¨ç¤ºæ²¡æœ‰ç›¸åº”æƒé™ã€‚</li></ul><p>æƒé™çš„æ•´ä½“æ˜¯æŒ‰ç”¨æˆ·æ¥åˆ’åˆ†çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://mmbiz.qpic.cn/mmbiz/9aPYe0E1fb12HhSLxYibr9w8y4GKAfhTDNHjwSKdibbHRmf7PrjuxDSSGmlJcw3TibY3dxFU9hm783e6bibg3jzpsw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡">å›¾ç‰‡</p><p>ç°åœ¨å†æ¥ç†è§£è¿™å¥æƒé™ <code>drwxr-xr-x</code> çš„æ„æ€ï¼š</p><ul><li>å®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼›</li><li>å®ƒçš„<strong>æ‰€æœ‰è€…</strong>å…·æœ‰ï¼šè¯»ã€å†™ã€æ‰§è¡Œæƒé™ï¼›</li><li>å®ƒçš„<strong>ç¾¤ç»„ç”¨æˆ·</strong>å…·æœ‰ï¼šè¯»ã€æ‰§è¡Œçš„æƒé™ï¼Œæ²¡æœ‰å†™çš„æƒé™ï¼›</li><li>å®ƒçš„<strong>å…¶å®ƒç”¨æˆ·</strong>å…·æœ‰ï¼šè¯»ã€æ‰§è¡Œçš„æƒé™ï¼Œæ²¡æœ‰å†™çš„æƒé™ã€‚</li></ul><p>ç°åœ¨ç†è§£äº†æƒé™ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>chmod</code> æ¥å°è¯•ä¿®æ”¹æƒé™ã€‚<code>chmod</code> å®ƒä¸éœ€è¦æ˜¯ <code>root</code> ç”¨æˆ·æ‰èƒ½è¿è¡Œçš„ï¼Œ<u>åªè¦ä½ æ˜¯æ­¤æ–‡ä»¶æ‰€æœ‰è€…ï¼Œå°±å¯ä»¥ç”¨ <code>chmod</code> æ¥ä¿®æ”¹æ–‡ä»¶çš„è®¿é—®æƒé™ã€‚</u></p><h5 id="æ•°å­—åˆ†é…æƒé™"><a href="#æ•°å­—åˆ†é…æƒé™" class="headerlink" title="æ•°å­—åˆ†é…æƒé™"></a>æ•°å­—åˆ†é…æƒé™</h5><table><thead><tr><th align="left">æƒé™</th><th align="left">æ•°å­—</th></tr></thead><tbody><tr><td align="left">r</td><td align="left">4</td></tr><tr><td align="left">w</td><td align="left">2</td></tr><tr><td align="left">x</td><td align="left">1</td></tr></tbody></table><p>å› æ­¤è¦æ”¹å˜æƒé™ï¼Œåªè¦åšä¸€äº›ç®€å•çš„åŠ æ³•å°±è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 640 hello.c <span class="comment"># åˆ†æ6 = 4 + 2 + 0 è¡¨ç¤ºæ‰€æœ‰è€…å…·æœ‰ rw æƒé™4 = 4 + 0 + 0 è¡¨ç¤ºç¾¤ç»„ç”¨æˆ·å…·æœ‰ r æƒé™0 = 0 + 0 + 0 è¡¨ç¤ºå…¶å®ƒç”¨æˆ·æ²¡æœ‰æƒé™å¯¹åº”æ–‡å­—æƒé™ä¸ºï¼š-rw-r-----</span></span><br></pre></td></tr></table></figure><h5 id="ç”¨å­—æ¯æ¥åˆ†é…æƒé™"><a href="#ç”¨å­—æ¯æ¥åˆ†é…æƒé™" class="headerlink" title="ç”¨å­—æ¯æ¥åˆ†é…æƒé™"></a>ç”¨å­—æ¯æ¥åˆ†é…æƒé™</h5><ul><li><code>u</code> ï¼š<code>user</code> çš„ç¼©å†™ï¼Œç”¨æˆ·çš„æ„æ€ï¼Œè¡¨ç¤ºæ‰€æœ‰è€…ã€‚</li><li><code>g</code> ï¼š<code>group</code> çš„ç¼©å†™ï¼Œç¾¤ç»„çš„æ„æ€ï¼Œè¡¨ç¤ºç¾¤ç»„ç”¨æˆ·ã€‚</li><li><code>o</code> ï¼š<code>other</code> çš„ç¼©å†™ï¼Œå…¶å®ƒçš„æ„æ€ï¼Œè¡¨ç¤ºå…¶å®ƒç”¨æˆ·ã€‚</li><li><code>a</code> ï¼š<code>all</code> çš„ç¼©å†™ï¼Œæ‰€æœ‰çš„æ„æ€ï¼Œè¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·ã€‚</li><li><code>+</code> ï¼šåŠ å·ï¼Œè¡¨ç¤ºæ·»åŠ æƒé™ã€‚</li><li><code>-</code> ï¼šå‡å·ï¼Œè¡¨ç¤ºå»é™¤æƒé™ã€‚</li><li><code>=</code> ï¼šç­‰äºå·ï¼Œè¡¨ç¤ºåˆ†é…æƒé™ã€‚</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> u+rx file <span class="comment"># --&gt; æ–‡ä»¶fileçš„æ‰€æœ‰è€…å¢åŠ è¯»å’Œè¿è¡Œçš„æƒé™</span></span><br><span class="line"><span class="built_in">chmod</span> g+r file  <span class="comment"># --&gt; æ–‡ä»¶fileçš„ç¾¤ç»„ç”¨æˆ·å¢åŠ è¯»çš„æƒé™</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥æ‰¾æ–‡ä»¶ï¼š"><a href="#æŸ¥æ‰¾æ–‡ä»¶ï¼š" class="headerlink" title="æŸ¥æ‰¾æ–‡ä»¶ï¼š"></a>æŸ¥æ‰¾æ–‡ä»¶ï¼š</h3><h4 id="findå‘½ä»¤ï¼š"><a href="#findå‘½ä»¤ï¼š" class="headerlink" title="findå‘½ä»¤ï¼š"></a>findå‘½ä»¤ï¼š</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find &lt;ä½•å¤„(å“ªä¸ªæ–‡ä»¶å¤¹ä¸‹)&gt; &lt;æ¡ä»¶ï¼Œå¯ä»¥åŒæ—¶è®¾ç½®å¤šä¸ª&gt; &lt;åšä»€ä¹ˆ(å¯é€‰)&gt;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æ¡ä»¶å¯ä»¥æœ‰å¤šç§ï¼Œå¯ä»¥æ ¹æ®æ–‡ä»¶çš„åå­—æ¥æŸ¥æ‰¾ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å…¶å¤§å°æ¥æŸ¥æ‰¾ï¼Œè¿˜å¯ä»¥æ ¹æ®å…¶æœ€è¿‘è®¿é—®æ—¶é—´æ¥æŸ¥æ‰¾â€¦â€¦</p><p>ä¾‹å¦‚ï¼š</p><ul><li>-name â€œfile.txtâ€</li><li>-size +10M </li><li>-atime -7     #è¿‘7å¤©å†…è®¿é—®è¿‡çš„</li></ul><h3 id="é˜…è¯»æ‰‹å†Œ"><a href="#é˜…è¯»æ‰‹å†Œ" class="headerlink" title="é˜…è¯»æ‰‹å†Œ"></a>é˜…è¯»æ‰‹å†Œ</h3><h4 id="man"><a href="#man" class="headerlink" title="man:"></a>man:</h4><p><code>Linux</code> å‘½ä»¤ç§ç±»ç¹æ‚ï¼Œæˆ‘ä»¬å‡­å€Ÿè®°å¿†ä¸å¯èƒ½å…¨éƒ¨è®°ä½ï¼Œå› æ­¤å­¦ä¼šæŸ¥ç”¨æ‰‹å†Œæ˜¯éå¸¸é‡è¦çš„ã€‚</p><p>æŸ¥é˜…é˜…è¯»æ‰‹å†Œçš„å‘½ä»¤ä¸º<code>man</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">man å¾…æŸ¥é˜…çš„å‘½ä»¤åç§°</span><br><span class="line"><span class="comment">#å¦‚ï¼š</span></span><br><span class="line">man <span class="built_in">ls</span></span><br></pre></td></tr></table></figure><h4 id="help"><a href="#help" class="headerlink" title="help:"></a>help:</h4><p><code>man</code> å‘½ä»¤åƒæ–°åè¯å…¸ä¸€æ ·å¯ä»¥æŸ¥è¯¢åˆ°å‘½ä»¤æˆ–å‡½æ•°çš„è¯¦ç»†ä¿¡æ¯ï¼Œä½†å…¶å®æˆ‘ä»¬è¿˜æœ‰æ›´åŠ å¿«æ·çš„æ–¹å¼å»æŸ¥è¯¢ï¼Œ <code>command --help</code> æˆ– <code>command -h</code> ï¼Œå®ƒæ²¡æœ‰ <code>man</code> å‘½ä»¤æ˜¾ç¤ºçš„é‚£ä¹ˆè¯¦ç»†ï¼Œä½†æ˜¯å®ƒæ›´åŠ æ˜“äºé˜…è¯»ã€‚</p><h3 id="æ–‡æœ¬æ“ä½œï¼š"><a href="#æ–‡æœ¬æ“ä½œï¼š" class="headerlink" title="æ–‡æœ¬æ“ä½œï¼š"></a>æ–‡æœ¬æ“ä½œï¼š</h3><h4 id="grepï¼š"><a href="#grepï¼š" class="headerlink" title="grepï¼š"></a>grepï¼š</h4><p>å…¨å±€æœç´¢ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”æ‰“å°åˆ°å±å¹•ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼Œåœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾å…³é”®å­—ï¼Œå¹¶æ˜¾ç¤ºå…³é”®å­—æ‰€åœ¨è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è½¯ä»¶å·¥ç¨‹</title>
      <link href="/2023/06/07/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/"/>
      <url>/2023/06/07/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="è½¯ä»¶å·¥ç¨‹"><a href="#è½¯ä»¶å·¥ç¨‹" class="headerlink" title="è½¯ä»¶å·¥ç¨‹"></a>è½¯ä»¶å·¥ç¨‹</h1><h2 id="Chapter1-Introduction"><a href="#Chapter1-Introduction" class="headerlink" title="Chapter1 Introduction"></a>Chapter1 Introduction</h2><h3 id="è½¯ä»¶å·¥ç¨‹å­¦ç§‘äº§ç”Ÿçš„èƒŒæ™¯ï¼š"><a href="#è½¯ä»¶å·¥ç¨‹å­¦ç§‘äº§ç”Ÿçš„èƒŒæ™¯ï¼š" class="headerlink" title="è½¯ä»¶å·¥ç¨‹å­¦ç§‘äº§ç”Ÿçš„èƒŒæ™¯ï¼š"></a>è½¯ä»¶å·¥ç¨‹å­¦ç§‘äº§ç”Ÿçš„èƒŒæ™¯ï¼š</h3><h4 id="è½¯ä»¶å±æœºï¼š"><a href="#è½¯ä»¶å±æœºï¼š" class="headerlink" title="è½¯ä»¶å±æœºï¼š"></a>è½¯ä»¶å±æœºï¼š</h4><h5 id="ä»ç»“æœæ¥çœ‹ï¼Œè½¯ä»¶å±æœºä½“ç°åœ¨ï¼š"><a href="#ä»ç»“æœæ¥çœ‹ï¼Œè½¯ä»¶å±æœºä½“ç°åœ¨ï¼š" class="headerlink" title="ä»ç»“æœæ¥çœ‹ï¼Œè½¯ä»¶å±æœºä½“ç°åœ¨ï¼š"></a>ä»ç»“æœæ¥çœ‹ï¼Œè½¯ä»¶å±æœºä½“ç°åœ¨ï¼š</h5><ul><li>è½¯ä»¶è´¨é‡å·®ã€å¯é æ€§éš¾ä»¥ä¿è¯</li><li>æˆæœ¬éš¾ä»¥æ§åˆ¶</li><li>å¼€å‘è¿›åº¦éš¾ä»¥æŠŠæ¡</li><li>å¯ç»´æŠ¤æ€§è¾ƒå·®</li></ul><h5 id="ä»åŸå› æ¥çœ‹ï¼Œè½¯ä»¶å±æœºç”±ä»¥ä¸‹ä¸¤ç‚¹å¯¼è‡´ï¼š"><a href="#ä»åŸå› æ¥çœ‹ï¼Œè½¯ä»¶å±æœºç”±ä»¥ä¸‹ä¸¤ç‚¹å¯¼è‡´ï¼š" class="headerlink" title="ä»åŸå› æ¥çœ‹ï¼Œè½¯ä»¶å±æœºç”±ä»¥ä¸‹ä¸¤ç‚¹å¯¼è‡´ï¼š"></a>ä»åŸå› æ¥çœ‹ï¼Œè½¯ä»¶å±æœºç”±ä»¥ä¸‹ä¸¤ç‚¹å¯¼è‡´ï¼š</h5><ol><li>ä¸æ–­å¢é•¿çš„ç³»ç»Ÿå¤æ‚æ€§</li><li>æœªæœ‰æ•ˆé‡‡ç”¨è½¯ä»¶å·¥ç¨‹æ–¹æ³•è¿›è¡Œå¼€å‘</li></ol><h3 id="Frequently-asked-questions-about-software-engineering"><a href="#Frequently-asked-questions-about-software-engineering" class="headerlink" title="Frequently asked questions about software engineering"></a><strong>Frequently asked questions about software engineering</strong></h3><table><thead><tr><th><strong>Question</strong></th><th><strong>Answer</strong></th></tr></thead><tbody><tr><td>What  is software?</td><td><strong>Computer  programs</strong> and <strong>associated documentation</strong>. Software products may be developed for  a particular customer or may be developed for a general market.</td></tr><tr><td>What  are the attributes of good software?</td><td>Good  software should deliver the required functionality and performance to the  user and should be maintainable, dependable and usable.</td></tr><tr><td>What  is software engineering?</td><td>Software  engineering is an engineering discipline that is concerned with all aspects  of software production.</td></tr><tr><td>What  are the fundamental software engineering activities?</td><td>Software  specification(è§„èŒƒ), software development, software validation(éªŒè¯) and software  evolution(æ¼”è¿›).</td></tr><tr><td>What  is the difference between software engineering and computer science?</td><td>Computer  science focuses on theory and fundamentals; software engineering is concerned  with the practicalities of developing and delivering useful software.</td></tr><tr><td>What  is the difference between software engineering and system engineering?</td><td>System  engineering is concerned with all aspects of computer-based systems  development including hardware, software and process engineering. Software  engineering is part of this more general process.</td></tr><tr><td>What are the key challenges facing  software engineering?</td><td>Coping with increasing diversity,  demands for reduced delivery times and developing trustworthy software.</td></tr><tr><td>What  are the costs of software engineering?</td><td>Roughly  60% of software costs are development costs, 40% are testing costs. For  custom software, evolution costs often exceed development costs.</td></tr><tr><td>What  are the best software engineering techniques and methods?</td><td>While  all software projects have to be professionally managed and developed,  <strong>different techniques are appropriate for different types of system</strong>. For  example, games should always be developed using a series of prototypes  whereas safety critical control systems require a complete and analyzable  specification to be developed. You canâ€™t, therefore, say that one method is  better than another.</td></tr></tbody></table><h3 id="å¥½çš„è½¯ä»¶çš„åŸºæœ¬å±æ€§"><a href="#å¥½çš„è½¯ä»¶çš„åŸºæœ¬å±æ€§" class="headerlink" title="å¥½çš„è½¯ä»¶çš„åŸºæœ¬å±æ€§"></a>å¥½çš„è½¯ä»¶çš„åŸºæœ¬å±æ€§</h3><ul><li>å¯æ¥å—æ€§(æ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ï¼Œç”¨æˆ·èƒ½ç”¨ï¼Œå¥½ç”¨)</li><li>å¯ä¾èµ–æ€§å’Œä¿¡æ¯å®‰å…¨æ€§</li><li>æ•ˆç‡é«˜</li><li>å¯ç»´æŠ¤æ€§</li></ul><h3 id="è½¯ä»¶è¿‡ç¨‹â€”â€”å››é¡¹åŸºæœ¬æ´»åŠ¨"><a href="#è½¯ä»¶è¿‡ç¨‹â€”â€”å››é¡¹åŸºæœ¬æ´»åŠ¨" class="headerlink" title="è½¯ä»¶è¿‡ç¨‹â€”â€”å››é¡¹åŸºæœ¬æ´»åŠ¨"></a>è½¯ä»¶è¿‡ç¨‹â€”â€”å››é¡¹åŸºæœ¬æ´»åŠ¨</h3><ol><li><strong>è½¯ä»¶è§„æ ¼è¯´æ˜</strong>ï¼ˆlike éœ€æ±‚åˆ†æ</li><li><strong>è½¯ä»¶å¼€å‘</strong></li><li><strong>è½¯ä»¶ç¡®è®¤</strong>ï¼ˆlike éªŒæ”¶</li><li><strong>è½¯ä»¶æ¼”åŒ–</strong>ï¼ˆlike ç»´æŠ¤</li></ol><h2 id="Chapter2-è½¯ä»¶è¿‡ç¨‹"><a href="#Chapter2-è½¯ä»¶è¿‡ç¨‹" class="headerlink" title="Chapter2 è½¯ä»¶è¿‡ç¨‹"></a>Chapter2 è½¯ä»¶è¿‡ç¨‹</h2><h3 id="2-1è½¯ä»¶è¿‡ç¨‹æ¨¡å‹"><a href="#2-1è½¯ä»¶è¿‡ç¨‹æ¨¡å‹" class="headerlink" title="2.1è½¯ä»¶è¿‡ç¨‹æ¨¡å‹"></a>2.1è½¯ä»¶è¿‡ç¨‹æ¨¡å‹</h3><h4 id="ç€‘å¸ƒæ¨¡å‹ï¼š"><a href="#ç€‘å¸ƒæ¨¡å‹ï¼š" class="headerlink" title="ç€‘å¸ƒæ¨¡å‹ï¼š"></a>ç€‘å¸ƒæ¨¡å‹ï¼š</h4><p>â€‹å¦‚æœæ¯é˜¶æ®µåšçš„äº‹æ˜¯æ­£ç¡®çš„ï¼Œå°±èƒ½ä¿è¯æœ€ç»ˆç»“æœçš„æ­£ç¡®</p><p>â€‹ç³»ç»Ÿéœ€æ±‚&lt;&#x3D;&gt;è½¯ä»¶éœ€æ±‚&lt;&#x3D;&gt;éœ€æ±‚åˆ†æ&lt;&#x3D;&gt;è®¾è®¡&lt;&#x3D;&gt;ç¼–ç &lt;&#x3D;&gt;æµ‹è¯•&lt;&#x3D;&gt;è¿è¡Œ</p><h5 id="ç€‘å¸ƒæ¨¡å‹çš„ä¼˜ç‚¹ï¼š"><a href="#ç€‘å¸ƒæ¨¡å‹çš„ä¼˜ç‚¹ï¼š" class="headerlink" title="ç€‘å¸ƒæ¨¡å‹çš„ä¼˜ç‚¹ï¼š"></a>ç€‘å¸ƒæ¨¡å‹çš„ä¼˜ç‚¹ï¼š</h5><p>è™½ç„¶ç€‘å¸ƒæ¨¡å‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒ â€œè€â€çš„ã€‚ç”šè‡³è¿‡æ—¶çš„å¼€å‘æ¨¡å‹ï¼Œä½†å…¶ä¼˜ç‚¹ä¸ºï¼š</p><ul><li><p>åœ¨å†³å®šç³»ç»Ÿæ€æ ·åšä¹‹å‰ï¼Œå­˜åœ¨ä¸€ä¸ªéœ€æ±‚é˜¶æ®µã€‚<strong>é¼“åŠ±å¯¹ç³»ç»Ÿâ€œåšä»€ä¹ˆâ€ è¿›è¡Œè§„çº¦</strong>ï¼ˆå³è®¾è®¡ä¹‹å‰çš„è§„çº¦ï¼‰ã€‚</p></li><li><p>åœ¨å»ºé€ æ„ä»¶ä¹‹å‰ã€‚å­˜åœ¨ä¸€ä¸ªè®¾è®¡é˜¶æ®µï¼Œ<strong>é¼“åŠ±è§„åˆ’ç³»ç»Ÿç»“æ„</strong>ï¼ˆå³ç¼–ç ä¹‹å‰çš„è®¾è®¡ï¼‰ã€‚</p></li><li><p><u>åœ¨æ¯ä¸€é˜¶æ®µç»“æŸæ—¶è¿›è¡Œå¤å®¡ï¼Œå…è®¸è·å–æ–¹å’Œç”¨æˆ·çš„å‚ä¸ã€‚</u></p></li><li><p>å‰ä¸€æ­¥å·¥ä½œäº§å“å¯ä½œä¸ºä¸‹ä¸€æ­¥è¢«è®¤å¯çš„ã€‚æ–‡æ¡£åŒ–çš„åŸºçº¿ã€‚å…è®¸åŸºçº¿å’Œé…ç½®æ—©æœŸæ¥å—æ§åˆ¶ã€‚</p></li></ul><h5 id="ç€‘å¸ƒæ¨¡å‹çš„ç¼ºç‚¹ï¼š"><a href="#ç€‘å¸ƒæ¨¡å‹çš„ç¼ºç‚¹ï¼š" class="headerlink" title="ç€‘å¸ƒæ¨¡å‹çš„ç¼ºç‚¹ï¼š"></a>ç€‘å¸ƒæ¨¡å‹çš„ç¼ºç‚¹ï¼š</h5><p>ç€‘å¸ƒæ¨¡å‹ä¸‹ï¼Œå®¢æˆ·å’Œå¼€å‘è€…å¯èƒ½ä¼šè¿‡æ—©åœ°å†»ç»“äº†éœ€æ±‚ï¼Œè¿™æ ·çš„è¯åç»­å°±ä¸èƒ½å‘ç”Ÿè¿›ä¸€æ­¥çš„å˜åŒ–(é™¤éè¿”å·¥)</p><ul><li><p>å®¢æˆ·<u>å¿…é¡»èƒ½å¤Ÿå®Œæ•´ã€æ­£ç¡®å’Œæ¸…æ™°åœ°è¡¨è¾¾ä»–ä»¬çš„éœ€æ±‚</u>ï¼šå¼€å‘äººå‘˜ä¸€å¼€å§‹å°±å¿…é¡»ç†è§£éœ€æ±‚ã€‚</p></li><li><p>ç¼ºä¹çµæ´»æ€§ã€‚ä¸€æ—¦è½¯ä»¶éœ€æ±‚å­˜åœ¨åå·®ï¼Œå°±ä¼šå¯¼è‡´å¼€å‘å‡ºçš„è½¯ä»¶äº§å“ä¸èƒ½æ»¡è¶³ç”¨æˆ·çš„å®é™…è¦æ±‚(éœ€è¦è¿”å·¥)ã€‚</p></li><li><p>åœ¨ä¸€ä¸ªé¡¹ç›®çš„æ—©æœŸé˜¶æ®µï¼Œè¿‡åˆ†åœ°å¼ºè°ƒäº†åŸºçº¿å’Œé‡Œç¨‹ç¢‘å¤„çš„æ–‡æ¡£,å¯èƒ½è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´ï¼Œç”¨äºå»ºç«‹ä¸€äº›ç”¨å¤„ä¸å¤§çš„æ–‡æ¡£ã€‚</p></li><li><p>ç›´åˆ°é¡¹ç›®ç»“æŸä¹‹å‰ï¼Œéƒ½ä¸èƒ½æ¼”ç¤ºç³»ç»Ÿçš„èƒ½åŠ›,å¢åŠ äº†é¡¹ç›®çš„é£é™©ã€‚</p></li></ul><h4 id="å¢é‡æ¨¡å‹ï¼š"><a href="#å¢é‡æ¨¡å‹ï¼š" class="headerlink" title="å¢é‡æ¨¡å‹ï¼š"></a>å¢é‡æ¨¡å‹ï¼š</h4><p>â€‹è¯¥æ¨¡å‹æœ‰ä¸€ä¸ªå‡è®¾ï¼šå‡è®¾éœ€æ±‚å¯ä»¥åˆ†æ®µï¼Œæˆä¸ºä¸€ç³»åˆ—å¢é‡äº§å“ï¼Œæ¯ä¸€å¢é‡å¯ä»¥åˆ†åˆ«åœ°å¼€å‘ã€‚</p><p>ç³»ç»Ÿå¼€å‘ä½“ç°ä¸ºä¸€ç³»åˆ—çš„ç‰ˆæœ¬(å¢é‡)ï¼Œæ¯ä¸ªç‰ˆæœ¬åœ¨å‰ä¸€ç‰ˆæœ¬çš„åŸºç¡€ä¸Šå¢åŠ ä¸€äº›åŠŸèƒ½ã€‚</p><h5 id="å¢é‡æ¨¡å‹çš„ä¼˜ç‚¹ï¼š"><a href="#å¢é‡æ¨¡å‹çš„ä¼˜ç‚¹ï¼š" class="headerlink" title="å¢é‡æ¨¡å‹çš„ä¼˜ç‚¹ï¼š"></a>å¢é‡æ¨¡å‹çš„ä¼˜ç‚¹ï¼š</h5><p>ä½œä¸ºç€‘å¸ƒæ¨¡å‹çš„ç¬¬ä¸€ä¸ªå˜ä½“ï¼Œå…·æœ‰ç€‘å¸ƒæ¨¡å‹çš„æ‰€æœ‰ä¼˜ç‚¹ã€‚</p><p>æ­¤å¤–ï¼Œå®ƒè¿˜æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li><p>æ›´å®¹æ˜“è·å¾—ç”¨æˆ·çš„åé¦ˆ</p></li><li><p>ç¬¬ä¸€ä¸ªå¯äº¤ä»˜ç‰ˆæœ¬æ‰€éœ€è¦çš„æˆæœ¬å’Œæ—¶é—´æ˜¯å¾ˆå°‘çš„ï¼š</p></li><li><p>å¼€å‘ç”±å¢é‡è¡¨ç¤ºçš„å°ç³»ç»Ÿæ‰€æ‰¿æ‹…çš„é£é™©æ˜¯ä¸å¤§çš„ï¼š</p></li><li><p>ç”±äºå¾ˆå¿«å‘å¸ƒäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œå› æ­¤å¯ä»¥å‡å°‘ç”¨æˆ·éœ€æ±‚çš„å˜æ›´ï¼š</p></li><li><p>å…è®¸å¢é‡æŠ•èµ„ï¼Œå³åœ¨é¡¹ç›®å¼€å§‹æ—¶ï¼Œå¯ä»¥ä»…å¯¹ä¸€ä¸ªæˆ–ä¸¤ä¸ªå¢é‡æŠ•èµ„ã€‚</p></li></ul><p>æ³¨ï¼šå¦‚æœé‡‡ç”¨å¢é‡æŠ•èµ„æ–¹å¼ï¼Œé‚£ä¹ˆå®¢æˆ·å°±å¯ä»¥å¯¹ä¸€äº›å¢é‡è¿›è¡Œæ‹›æ ‡ã€‚</p><p>ç„¶åï¼Œå¼€å‘äººå‘˜æŒ‰æå‡ºçš„æˆªæ­¢æœŸé™è¿›è¡Œå¢é‡å¼€å‘ï¼Œè¿™æ ·å®¢æˆ·å°±å¯ä»¥ç”¨å¤šä¸ªå¥‘çº¦æ¥ç®¡ç†ç»„ç»‡çš„èµ„æºå’Œæˆæœ¬ã€‚</p><h5 id="å¢é‡æ¨¡å‹çš„ç¼ºç‚¹ï¼š"><a href="#å¢é‡æ¨¡å‹çš„ç¼ºç‚¹ï¼š" class="headerlink" title="å¢é‡æ¨¡å‹çš„ç¼ºç‚¹ï¼š"></a>å¢é‡æ¨¡å‹çš„ç¼ºç‚¹ï¼š</h5><p>å¦‚æœå¢é‡æ¨¡å‹ä¸é€‚äºæŸäº›é¡¹ç›®ï¼Œæˆ–ä½¿ç”¨æœ‰è¯¯ï¼Œåˆ™æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š</p><ul><li><p>ï»¿å¦‚æœæ²¡æœ‰å¯¹ç”¨æˆ·çš„å˜æ›´è¦æ±‚è¿›è¡Œè§„åˆ’ï¼Œé‚£ä¹ˆäº§ç”Ÿçš„åˆå§‹å¢é‡å¯èƒ½ä¼šé€ æˆåæ¥å¢é‡çš„ä¸ç¨³å®šï¼›</p></li><li><p>ï»¿å¦‚æœéœ€æ±‚ä¸åƒæ—©æœŸæ€è€ƒçš„é‚£æ ·ç¨³å®šå’Œå®Œæ•´ï¼Œé‚£ä¹ˆä¸€äº›å¢é‡å°±å¯èƒ½éœ€è¦é‡æ–°å¼€å‘(è¿”å·¥)ï¼Œé‡æ–°å‘å¸ƒï¼š</p></li><li><p>ç®¡ç†å‘ç”Ÿçš„æˆæœ¬ã€è¿›åº¦å’Œé…ç½®çš„å¤æ‚æ€§ï¼Œå¯èƒ½ä¼šè¶…å‡ºä¸€äº›ç»„ç»‡çš„èƒ½åŠ›ã€‚</p></li><li><p>è¿‡ç¨‹ä¸å¯è§ï¼šç®¡ç†è€…éœ€è¦å®šæœŸäº¤ä»˜æˆæœæ¥è¡¡é‡è¿›åº¦ã€‚å¦‚æœç³»ç»Ÿå¼€å‘è¿…é€Ÿï¼Œåˆ™ç”Ÿæˆåæ˜ ç³»ç»Ÿæ¯ä¸ªç‰ˆæœ¬çš„æ–‡æ¡£å¹¶ä¸å…·æœ‰æˆæœ¬æ•ˆç›Šã€‚</p></li></ul><h4 id="é›†æˆå’Œé…ç½®ï¼š"><a href="#é›†æˆå’Œé…ç½®ï¼š" class="headerlink" title="é›†æˆå’Œé…ç½®ï¼š"></a>é›†æˆå’Œé…ç½®ï¼š</h4><p>â€‹è¯¥æ–¹æ³•ä¾èµ–äºå¯å¤ç”¨çš„æ„ä»¶æˆ–ç³»ç»Ÿã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230610130513298.png" alt="image-20230610130513298"></p><h4 id="æ¼”åŒ–æ¨¡å‹ï¼š"><a href="#æ¼”åŒ–æ¨¡å‹ï¼š" class="headerlink" title="æ¼”åŒ–æ¨¡å‹ï¼š"></a>æ¼”åŒ–æ¨¡å‹ï¼š</h4><p>ï¼ˆé’ˆå¯¹ä¸€å¼€å§‹ä¸èƒ½æ˜ç¡®éœ€æ±‚çš„æƒ…å†µï¼š</p><p>æ˜¯ä¸€ç§æœ‰å¼¹æ€§çš„è¿‡ç¨‹æ¨¡å¼ï¼Œç”±ä¸€äº›å°çš„å¼€å‘æ­¥ç»„æˆï¼Œæ¯ä¸€æ­¥éƒ½å†ç»<strong>éœ€æ±‚åˆ†æã€è®¾è®¡ã€å®ç°å’ŒéªŒè¯</strong></p><h4 id="å–·æ³‰æ¨¡å‹ï¼š"><a href="#å–·æ³‰æ¨¡å‹ï¼š" class="headerlink" title="å–·æ³‰æ¨¡å‹ï¼š"></a>å–·æ³‰æ¨¡å‹ï¼š</h4><p>â€‹ç‰¹å¾ï¼š<strong>è¿­ä»£ã€æ— ç¼</strong></p><h2 id="chapter1-è½¯ä»¶å·¥ç¨‹æ¦‚è®º"><a href="#chapter1-è½¯ä»¶å·¥ç¨‹æ¦‚è®º" class="headerlink" title="chapter1 è½¯ä»¶å·¥ç¨‹æ¦‚è®º"></a>chapter1 è½¯ä»¶å·¥ç¨‹æ¦‚è®º</h2><h3 id="1-1-è½¯ä»¶çš„å®šä¹‰åŠç‰¹ç‚¹"><a href="#1-1-è½¯ä»¶çš„å®šä¹‰åŠç‰¹ç‚¹" class="headerlink" title="1.1 è½¯ä»¶çš„å®šä¹‰åŠç‰¹ç‚¹"></a>1.1 è½¯ä»¶çš„å®šä¹‰åŠç‰¹ç‚¹</h3><h3 id="1-2-è½¯ä»¶å·¥ç¨‹çš„èµ·æºå’Œæ¦‚å¿µ"><a href="#1-2-è½¯ä»¶å·¥ç¨‹çš„èµ·æºå’Œæ¦‚å¿µ" class="headerlink" title="1.2 è½¯ä»¶å·¥ç¨‹çš„èµ·æºå’Œæ¦‚å¿µ"></a>1.2 è½¯ä»¶å·¥ç¨‹çš„èµ·æºå’Œæ¦‚å¿µ</h3><h3 id="1-3-è½¯ä»¶å¼€å‘çš„æœ¬è´¨å’ŒåŸºæœ¬æ‰‹æ®µ"><a href="#1-3-è½¯ä»¶å¼€å‘çš„æœ¬è´¨å’ŒåŸºæœ¬æ‰‹æ®µ" class="headerlink" title="1.3 è½¯ä»¶å¼€å‘çš„æœ¬è´¨å’ŒåŸºæœ¬æ‰‹æ®µ"></a>1.3 è½¯ä»¶å¼€å‘çš„æœ¬è´¨å’ŒåŸºæœ¬æ‰‹æ®µ</h3><h3 id="1-4-è½¯ä»¶å·¥ç¨‹æ¡†æ¶"><a href="#1-4-è½¯ä»¶å·¥ç¨‹æ¡†æ¶" class="headerlink" title="1.4 è½¯ä»¶å·¥ç¨‹æ¡†æ¶"></a>1.4 è½¯ä»¶å·¥ç¨‹æ¡†æ¶</h3><h2 id="chapter2-è½¯ä»¶è¿‡ç¨‹"><a href="#chapter2-è½¯ä»¶è¿‡ç¨‹" class="headerlink" title="chapter2 è½¯ä»¶è¿‡ç¨‹"></a>chapter2 è½¯ä»¶è¿‡ç¨‹</h2><h3 id="2-1è½¯ä»¶ç”Ÿå­˜å‘¨æœŸè¿‡ç¨‹çš„æ¦‚å¿µ"><a href="#2-1è½¯ä»¶ç”Ÿå­˜å‘¨æœŸè¿‡ç¨‹çš„æ¦‚å¿µ" class="headerlink" title="2.1è½¯ä»¶ç”Ÿå­˜å‘¨æœŸè¿‡ç¨‹çš„æ¦‚å¿µ"></a>2.1è½¯ä»¶ç”Ÿå­˜å‘¨æœŸè¿‡ç¨‹çš„æ¦‚å¿µ</h3><h3 id="2-2è½¯ä»¶ç”Ÿå­˜å‘¨æœŸè¿‡ç¨‹çš„åˆ†ç±»"><a href="#2-2è½¯ä»¶ç”Ÿå­˜å‘¨æœŸè¿‡ç¨‹çš„åˆ†ç±»" class="headerlink" title="2.2è½¯ä»¶ç”Ÿå­˜å‘¨æœŸè¿‡ç¨‹çš„åˆ†ç±»"></a>2.2è½¯ä»¶ç”Ÿå­˜å‘¨æœŸè¿‡ç¨‹çš„åˆ†ç±»</h3><h3 id="2-3è½¯ä»¶ç”Ÿå­˜å‘¨æœŸæ¨¡å‹çš„æ¦‚å¿µ"><a href="#2-3è½¯ä»¶ç”Ÿå­˜å‘¨æœŸæ¨¡å‹çš„æ¦‚å¿µ" class="headerlink" title="2.3è½¯ä»¶ç”Ÿå­˜å‘¨æœŸæ¨¡å‹çš„æ¦‚å¿µ"></a>2.3è½¯ä»¶ç”Ÿå­˜å‘¨æœŸæ¨¡å‹çš„æ¦‚å¿µ</h3><h3 id="2-4å¸¸è§çš„è½¯ä»¶ç”Ÿå­˜å‘¨æœŸæ¨¡å‹"><a href="#2-4å¸¸è§çš„è½¯ä»¶ç”Ÿå­˜å‘¨æœŸæ¨¡å‹" class="headerlink" title="2.4å¸¸è§çš„è½¯ä»¶ç”Ÿå­˜å‘¨æœŸæ¨¡å‹"></a>2.4å¸¸è§çš„è½¯ä»¶ç”Ÿå­˜å‘¨æœŸæ¨¡å‹</h3><h4 id="ç€‘å¸ƒæ¨¡å‹ï¼š-1"><a href="#ç€‘å¸ƒæ¨¡å‹ï¼š-1" class="headerlink" title="ç€‘å¸ƒæ¨¡å‹ï¼š"></a>ç€‘å¸ƒæ¨¡å‹ï¼š</h4><p>â€‹å¦‚æœæ¯é˜¶æ®µåšçš„äº‹æ˜¯æ­£ç¡®çš„ï¼Œå°±èƒ½ä¿è¯æœ€ç»ˆç»“æœçš„æ­£ç¡®</p><p>â€‹ç³»ç»Ÿéœ€æ±‚&lt;&#x3D;&gt;è½¯ä»¶éœ€æ±‚&lt;&#x3D;&gt;éœ€æ±‚åˆ†æ&lt;&#x3D;&gt;è®¾è®¡&lt;&#x3D;&gt;ç¼–ç &lt;&#x3D;&gt;æµ‹è¯•&lt;&#x3D;&gt;è¿è¡Œ</p><h5 id="ç€‘å¸ƒæ¨¡å‹çš„ä¼˜ç‚¹ï¼š-1"><a href="#ç€‘å¸ƒæ¨¡å‹çš„ä¼˜ç‚¹ï¼š-1" class="headerlink" title="ç€‘å¸ƒæ¨¡å‹çš„ä¼˜ç‚¹ï¼š"></a>ç€‘å¸ƒæ¨¡å‹çš„ä¼˜ç‚¹ï¼š</h5><p>è™½ç„¶ç€‘å¸ƒæ¨¡å‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒ â€œè€â€çš„ã€‚ç”šè‡³è¿‡æ—¶çš„å¼€å‘æ¨¡å‹ï¼Œä½†å…¶ä¼˜ç‚¹ä¸ºï¼š</p><ul><li><p>åœ¨å†³å®šç³»ç»Ÿæ€æ ·åšä¹‹å‰ï¼Œå­˜åœ¨ä¸€ä¸ªéœ€æ±‚é˜¶æ®µã€‚<strong>é¼“åŠ±å¯¹ç³»ç»Ÿâ€œåšä»€ä¹ˆâ€ è¿›è¡Œè§„çº¦</strong>ï¼ˆå³è®¾è®¡ä¹‹å‰çš„è§„çº¦ï¼‰ã€‚</p></li><li><p>åœ¨å»ºé€ æ„ä»¶ä¹‹å‰ã€‚å­˜åœ¨ä¸€ä¸ªè®¾è®¡é˜¶æ®µï¼Œ<strong>é¼“åŠ±è§„åˆ’ç³»ç»Ÿç»“æ„</strong>ï¼ˆå³ç¼–ç ä¹‹å‰çš„è®¾è®¡ï¼‰ã€‚</p></li><li><p><u>åœ¨æ¯ä¸€é˜¶æ®µç»“æŸæ—¶è¿›è¡Œå¤å®¡ï¼Œå…è®¸è·å–æ–¹å’Œç”¨æˆ·çš„å‚ä¸ã€‚</u></p></li><li><p>å‰ä¸€æ­¥å·¥ä½œäº§å“å¯ä½œä¸ºä¸‹ä¸€æ­¥è¢«è®¤å¯çš„ã€‚æ–‡æ¡£åŒ–çš„åŸºçº¿ã€‚å…è®¸åŸºçº¿å’Œé…ç½®æ—©æœŸæ¥å—æ§åˆ¶ã€‚</p></li></ul><h5 id="ç€‘å¸ƒæ¨¡å‹çš„ç¼ºç‚¹ï¼š-1"><a href="#ç€‘å¸ƒæ¨¡å‹çš„ç¼ºç‚¹ï¼š-1" class="headerlink" title="ç€‘å¸ƒæ¨¡å‹çš„ç¼ºç‚¹ï¼š"></a>ç€‘å¸ƒæ¨¡å‹çš„ç¼ºç‚¹ï¼š</h5><ul><li><p>å®¢æˆ·<u>å¿…é¡»èƒ½å¤Ÿå®Œæ•´ã€æ­£ç¡®å’Œæ¸…æ™°åœ°è¡¨è¾¾ä»–ä»¬çš„éœ€æ±‚</u>ï¼šå¼€å‘äººå‘˜ä¸€å¼€å§‹å°±å¿…é¡»ç†è§£éœ€æ±‚ã€‚</p></li><li><p>ç¼ºä¹çµæ´»æ€§ã€‚ä¸€æ—¦è½¯ä»¶éœ€æ±‚å­˜åœ¨åå·®ï¼Œå°±ä¼šå¯¼è‡´å¼€å‘å‡ºçš„è½¯ä»¶äº§å“ä¸èƒ½æ»¡è¶³ç”¨æˆ·çš„å®é™…è¦æ±‚ã€‚</p></li><li><p>åœ¨ä¸€ä¸ªé¡¹ç›®çš„æ—©æœŸé˜¶æ®µï¼Œè¿‡åˆ†åœ°å¼ºè°ƒäº†åŸºçº¿å’Œé‡Œç¨‹ç¢‘å¤„çš„æ–‡æ¡£,å¯èƒ½è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´ï¼Œç”¨äºå»ºç«‹ä¸€äº›ç”¨å¤„ä¸å¤§çš„æ–‡æ¡£ã€‚</p></li><li><p>ç›´åˆ°é¡¹ç›®ç»“æŸä¹‹å‰ï¼Œéƒ½ä¸èƒ½æ¼”ç¤ºç³»ç»Ÿçš„èƒ½åŠ›,å¢åŠ äº†é¡¹ç›®çš„é£é™©ã€‚</p></li></ul><h4 id="å¢é‡æ¨¡å‹ï¼š-1"><a href="#å¢é‡æ¨¡å‹ï¼š-1" class="headerlink" title="å¢é‡æ¨¡å‹ï¼š"></a>å¢é‡æ¨¡å‹ï¼š</h4><p>â€‹è¯¥æ¨¡å‹æœ‰ä¸€ä¸ªå‡è®¾ï¼šå‡è®¾éœ€æ±‚å¯ä»¥åˆ†æ®µï¼Œæˆä¸ºä¸€ç³»åˆ—å¢é‡äº§å“ï¼Œæ¯ä¸€å¢é‡å¯ä»¥åˆ†åˆ«åœ°å¼€å‘ã€‚</p><h5 id="å¢é‡æ¨¡å‹çš„ä¼˜ç‚¹ï¼š-1"><a href="#å¢é‡æ¨¡å‹çš„ä¼˜ç‚¹ï¼š-1" class="headerlink" title="å¢é‡æ¨¡å‹çš„ä¼˜ç‚¹ï¼š"></a>å¢é‡æ¨¡å‹çš„ä¼˜ç‚¹ï¼š</h5><p>ä½œä¸ºç€‘å¸ƒæ¨¡å‹çš„ç¬¬ä¸€ä¸ªå˜ä½“ï¼Œå…·æœ‰ç€‘å¸ƒæ¨¡å‹çš„æ‰€æœ‰ä¼˜ç‚¹ã€‚</p><p>æ­¤å¤–ï¼Œå®ƒè¿˜æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li><p>ç¬¬ä¸€ä¸ªå¯äº¤ä»˜ç‰ˆæœ¬æ‰€éœ€è¦çš„æˆæœ¬å’Œæ—¶é—´æ˜¯å¾ˆå°‘çš„ï¼š</p></li><li><p>å¼€å‘ç”±å¢é‡è¡¨ç¤ºçš„å°ç³»ç»Ÿæ‰€æ‰¿æ‹…çš„é£é™©æ˜¯ä¸å¤§çš„ï¼š</p></li><li><p>ç”±äºå¾ˆå¿«å‘å¸ƒäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œå› æ­¤å¯ä»¥å‡å°‘ç”¨æˆ·éœ€æ±‚çš„å˜æ›´ï¼š</p></li><li><p>å…è®¸å¢é‡æŠ•èµ„ï¼Œå³åœ¨é¡¹ç›®å¼€å§‹æ—¶ï¼Œå¯ä»¥ä»…å¯¹ä¸€ä¸ªæˆ–ä¸¤ä¸ªå¢é‡æŠ•èµ„ã€‚</p></li></ul><p>æ³¨ï¼šå¦‚æœé‡‡ç”¨å¢é‡æŠ•èµ„æ–¹å¼ï¼Œé‚£ä¹ˆå®¢æˆ·å°±å¯ä»¥å¯¹ä¸€äº›å¢é‡è¿›è¡Œæ‹›æ ‡ã€‚</p><p>ç„¶åï¼Œå¼€å‘äººå‘˜æŒ‰æå‡ºçš„æˆªæ­¢æœŸé™è¿›è¡Œå¢é‡å¼€å‘ï¼Œè¿™æ ·å®¢æˆ·å°±å¯ä»¥ç”¨å¤šä¸ªå¥‘çº¦æ¥ç®¡ç†ç»„ç»‡çš„èµ„æºå’Œæˆæœ¬ã€‚</p><h5 id="å¢é‡æ¨¡å‹çš„ç¼ºç‚¹ï¼š-1"><a href="#å¢é‡æ¨¡å‹çš„ç¼ºç‚¹ï¼š-1" class="headerlink" title="å¢é‡æ¨¡å‹çš„ç¼ºç‚¹ï¼š"></a>å¢é‡æ¨¡å‹çš„ç¼ºç‚¹ï¼š</h5><p>å¦‚æœå¢é‡æ¨¡å‹ä¸é€‚äºæŸäº›é¡¹ç›®ï¼Œæˆ–ä½¿ç”¨æœ‰è¯¯ï¼Œåˆ™æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š</p><ul><li><p>ï»¿å¦‚æœæ²¡æœ‰å¯¹ç”¨æˆ·çš„å˜æ›´è¦æ±‚è¿›è¡Œè§„åˆ’ï¼Œé‚£ä¹ˆäº§ç”Ÿçš„åˆå§‹å¢é‡å¯èƒ½ä¼šé€ æˆåæ¥å¢é‡çš„ä¸ç¨³å®šï¼›</p></li><li><p>ï»¿å¦‚æœéœ€æ±‚ä¸åƒæ—©æœŸæ€è€ƒçš„é‚£æ ·ç¨³å®šå’Œå®Œæ•´ï¼Œé‚£ä¹ˆä¸€äº›å¢é‡å°±å¯èƒ½éœ€è¦é‡æ–°å¼€å‘ï¼Œé‡æ–°å‘å¸ƒï¼š</p></li><li><p>ç®¡ç†å‘ç”Ÿçš„æˆæœ¬ã€è¿›åº¦å’Œé…ç½®çš„å¤æ‚æ€§ï¼Œå¯èƒ½ä¼šè¶…å‡ºä¸€äº›ç»„ç»‡çš„èƒ½åŠ›ã€‚</p></li></ul><h4 id="æ¼”åŒ–æ¨¡å‹ï¼š-1"><a href="#æ¼”åŒ–æ¨¡å‹ï¼š-1" class="headerlink" title="æ¼”åŒ–æ¨¡å‹ï¼š"></a>æ¼”åŒ–æ¨¡å‹ï¼š</h4><p>ï¼ˆé’ˆå¯¹ä¸€å¼€å§‹ä¸èƒ½æ˜ç¡®éœ€æ±‚çš„æƒ…å†µï¼š</p><p>æ˜¯ä¸€ç§æœ‰å¼¹æ€§çš„è¿‡ç¨‹æ¨¡å¼ï¼Œç”±ä¸€äº›å°çš„å¼€å‘æ­¥ç»„æˆï¼Œæ¯ä¸€æ­¥éƒ½å†ç»<strong>éœ€æ±‚åˆ†æã€è®¾è®¡ã€å®ç°å’ŒéªŒè¯</strong></p><h4 id="å–·æ³‰æ¨¡å‹ï¼š-1"><a href="#å–·æ³‰æ¨¡å‹ï¼š-1" class="headerlink" title="å–·æ³‰æ¨¡å‹ï¼š"></a>å–·æ³‰æ¨¡å‹ï¼š</h4><p>â€‹ç‰¹å¾ï¼š<strong>è¿­ä»£ã€æ— ç¼</strong></p><h2 id="chapter3-è½¯ä»¶éœ€æ±‚ä¸è½¯ä»¶éœ€æ±‚è§„çº¦"><a href="#chapter3-è½¯ä»¶éœ€æ±‚ä¸è½¯ä»¶éœ€æ±‚è§„çº¦" class="headerlink" title="chapter3 è½¯ä»¶éœ€æ±‚ä¸è½¯ä»¶éœ€æ±‚è§„çº¦"></a>chapter3 è½¯ä»¶éœ€æ±‚ä¸è½¯ä»¶éœ€æ±‚è§„çº¦</h2><h3 id="3-1éœ€æ±‚çš„ä½œç”¨"><a href="#3-1éœ€æ±‚çš„ä½œç”¨" class="headerlink" title="3.1éœ€æ±‚çš„ä½œç”¨"></a>3.1éœ€æ±‚çš„ä½œç”¨</h3><p>â€‹è½¯ä»¶å¼€å‘çš„å·¥ä½œåŸºç¡€</p><h3 id="3-2éœ€æ±‚çš„å®šä¹‰"><a href="#3-2éœ€æ±‚çš„å®šä¹‰" class="headerlink" title="3.2éœ€æ±‚çš„å®šä¹‰"></a>3.2éœ€æ±‚çš„å®šä¹‰</h3><p>â€‹æè¿°äº†å¾…å¼€å‘äº§å“&#x2F;ç³»ç»ŸåŠŸèƒ½ä¸Šçš„èƒ½åŠ›ã€æ€§èƒ½å‚æ•°æˆ–å…¶ä»–æ€§è´¨</p><p>éœ€æ±‚çš„åŸºæœ¬æ€§è´¨ï¼š</p><ul><li>å¿…è¦æ€§æ˜¯è¦æ±‚çš„</li><li>æ— æ­§ä¹‰æ€§            æ˜¯å¦åªèƒ½ç”¨ä¸€ç§æ–¹å¼æ¥è§£é‡Š</li><li>å¯æµ‹çš„ (æµ‹è¯•)     èƒ½å¦è¿›è¡Œæµ‹è¯•ï¼Œå¯¹ä¸€å®šçš„è¾“å…¥ï¼Œä¼šæœ‰ç›¸åŒçš„è¾“å‡º</li><li>å¯è·Ÿè¸ªçš„            ä»ä¸€ä¸ªå¼€å‘é˜¶æ®µåˆ°å¦ä¸€ä¸ªé˜¶æ®µèƒ½å¦è¿›è¡Œè·Ÿè¸ª</li><li>å¯æµ‹é‡çš„            èƒ½å¦æµ‹é‡</li></ul><h3 id="3-3éœ€æ±‚çš„åˆ†ç±»"><a href="#3-3éœ€æ±‚çš„åˆ†ç±»" class="headerlink" title="3.3éœ€æ±‚çš„åˆ†ç±»"></a>3.3éœ€æ±‚çš„åˆ†ç±»</h3><h4 id="åŠŸèƒ½éœ€æ±‚ï¼š"><a href="#åŠŸèƒ½éœ€æ±‚ï¼š" class="headerlink" title="åŠŸèƒ½éœ€æ±‚ï¼š"></a>åŠŸèƒ½éœ€æ±‚ï¼š</h4><ul><li><p>å…³äºè¯¥åŠŸèƒ½è¾“å…¥çš„æ‰€æœ‰å‡å®šï¼Œæˆ–ä¸ºäº†éªŒè¯è¯¥åŠŸèƒ½è¾“å…¥æœ‰å…³æ£€æµ‹çš„å‡å®šã€‚</p></li><li><p>ï»¿åŠŸèƒ½å†…çš„ä»»ä¸€æ¬¡åºï¼Œè¿™ä¸€æ¬¡åºæ˜¯ä¸å¤–éƒ¨æœ‰å…³çš„ã€‚</p></li><li><p>ï»¿å¯¹å¼‚å¸¸æ¡ä»¶çš„å“åº”ï¼ŒåŒ…æ‹¬æ‰€æœ‰å†…å¤–éƒ¨æ‰€äº§ç”Ÿçš„é”™è¯¯ã€‚</p></li><li><p>ï»¿éœ€æ±‚çš„æ—¶åºæˆ–ä¼˜å…ˆç¨‹åº¦ã€‚</p></li><li><p>ï»¿åŠŸèƒ½ä¹‹é—´çš„äº’æ–¥è§„åˆ™ã€‚</p></li><li><p>ï»¿ç³»ç»Ÿå†…éƒ¨çŠ¶æ€çš„å‡å®šã€‚</p></li><li><p>ä¸ºäº†è¯¥åŠŸèƒ½çš„æ‰§è¡Œï¼Œæ‰€éœ€è¦çš„è¾“å…¥å’Œè¾“å‡ºæ¬¡åºã€‚</p></li><li><p>ç”¨äºè½¬æ¢æˆ–å†…éƒ¨è®¡ç®—æ‰€éœ€è¦çš„å…¬å¼ã€‚</p></li></ul><h4 id="æ€§èƒ½éœ€æ±‚ï¼š"><a href="#æ€§èƒ½éœ€æ±‚ï¼š" class="headerlink" title="æ€§èƒ½éœ€æ±‚ï¼š"></a>æ€§èƒ½éœ€æ±‚ï¼š</h4><p>â€‹è§„çº¦äº†ä¸€ä¸ªç³»ç»Ÿæˆ–ç³»ç»Ÿæ„å»ºå¿…é¡»å…·æœ‰çš„<strong>æ€§èƒ½ç‰¹æ€§</strong>(é€Ÿåº¦ã€å‡†ç¡®ç‡ã€å¹¶å‘ç­‰è¦æ±‚)</p><h4 id="å¤–éƒ¨æ¥å£éœ€æ±‚ï¼š"><a href="#å¤–éƒ¨æ¥å£éœ€æ±‚ï¼š" class="headerlink" title="å¤–éƒ¨æ¥å£éœ€æ±‚ï¼š"></a>å¤–éƒ¨æ¥å£éœ€æ±‚ï¼š</h4><p>â€‹å¤–éƒ¨æ¥å£éœ€æ±‚ (External interface requirement) è§„çº¦äº†ç³»ç»Ÿæˆ–ç³»ç»Ÿæ„ä»¶å¿…é¡»ä¸ä¹‹äº¤äº’çš„ç¡¬ä»¶ã€è½¯ä»¶æˆ–æ•°æ®åº“å…ƒç´ ã€‚å®ƒä¹Ÿå¯èƒ½è§„çº¦å…¶æ ¼å¼ã€æ—¶é—´æˆ–å…¶ä»–å› ç´ ã€‚</p><ul><li><p>ç³»ç»Ÿæ¥å£ (Systeminterfaces)ï¼šæè¿°ä¸€ä¸ªåº”ç”¨å¦‚ä½•ä¸ç³»ç»Ÿçš„å…¶ä»–åº”ç”¨è¿›è¡Œäº¤äº’ã€‚</p></li><li><p>ç”¨æˆ·æ¥å£ (User interfaces)ï¼šè§„çº¦äº†è½¯ä»¶äº§å“å’Œç”¨æˆ·ä¹‹é—´æ¥å£çš„é€»è¾‘ç‰¹æ€§ã€‚å³è§„çº¦å¯¹ç»™ç”¨æˆ·æ‰€æ˜¾ç¤ºçš„æ•°æ®ï¼Œå¯¹ç”¨æˆ·æ‰€è¦æ±‚çš„æ•°æ®ä»¥åŠç”¨æˆ·å¦‚ä½•æ§åˆ¶è¯¥ç”¨æˆ·æ¥å£ã€‚</p></li><li><p>ç¡¬ä»¶æ¥å£ (Hardware interfaces)ï¼šå¦‚æœè½¯ä»¶ç³»ç»Ÿå¿…é¡»ä¸ç¡¬ä»¶è®¾å¤‡è¿›è¡Œäº¤äº’ï¼Œé‚£ä¹ˆå°±åº”è¯´æ˜æ‰€è¦æ±‚çš„æ”¯æŒå’Œåè®®ç±»å‹ã€‚</p></li><li><p>è½¯ä»¶æ¥å£ (Software interfaces)ï¼šå…è®¸ä¸å…¶å®ƒè½¯ä»¶äº§å“è¿›è¡Œäº¤äº’ï¼Œå¦‚ï¼Œæ•°æ®ç®¡ç†ç³»ç»Ÿã€æ“ä½œç³»ç»Ÿæˆ–æ•°å­¦è½¯ä»¶åŒ…ã€‚</p></li><li><p>é€šè®¯æ¥å£ (Communications interfaces)ï¼šè§„çº¦å¾…å¼€å‘ç³»ç»Ÿä¸é€šè®¯è®¾æ–½ï¼ˆå¦‚ï¼Œå±€åŸŸç½‘ï¼‰ä¹‹é—´çš„äº¤äº’ã€‚å¦‚æœé€šè®¯éœ€æ±‚åŒ…å«äº†ç³»ç»Ÿå¿…é¡»ä½¿ç”¨çš„ç½‘ç»œç±»å‹ (TCP&#x2F;IP. WindowsNT. Novell)ï¼Œé‚£ä¹ˆæœ‰å…³ç±»å‹çš„ä¿¡æ¯å°±åº”åŒ…å«åœ¨SRSä¸­ã€‚</p></li></ul><p></p><h4 id="è®¾è®¡çº¦æŸéœ€æ±‚ï¼š"><a href="#è®¾è®¡çº¦æŸéœ€æ±‚ï¼š" class="headerlink" title="è®¾è®¡çº¦æŸéœ€æ±‚ï¼š"></a>è®¾è®¡çº¦æŸéœ€æ±‚ï¼š</h4><p>â€‹è®¾è®¡çº¦æŸ<strong>é™åˆ¶äº†ç³»ç»Ÿæˆ–ç³»ç»Ÿæ„ä»¶</strong>çš„è®¾è®¡æ–¹æ¡ˆã€‚å°±çº¦æŸçš„æœ¬èº«è€Œè¨€ã€‚å¯¹å…¶è¿›è¡Œæƒè¡¡æˆ–è°ƒæ•´æ˜¯ç›¸å½“å›°éš¾çš„ï¼Œç”šè‡³æ˜¯ä¸å¯èƒ½çš„ã€‚<u>å®ƒä»¬å¿…é¡»äºˆä»¥æ»¡è¶³</u>ã€‚è¿™ä¸€æ€§è´¨æ˜¯ä¸å…¶å®ƒéœ€æ±‚çš„æœ€ä¸»è¦å·®åˆ«ã€‚ä¸ºäº†æ»¡è¶³åŠŸèƒ½ã€æ€§èƒ½å’Œå…¶å®ƒéœ€æ±‚ï¼Œè®¸å¤šè®¾è®¡çº¦æŸå°†å¯¹è½¯ä»¶é¡¹ç›®è§„åˆ’ã€æ‰€éœ€è¦çš„é™„åŠ æˆæœ¬å’Œå·¥ä½œäº§ç”Ÿç›´æ¥å½±å“ã€‚ä¾‹å¦‚ï¼š</p><ul><li>ç³»ç»Ÿå¿…é¡»ç”¨C++æˆ–å…¶ä»–é¢å‘å¯¹è±¡è¯­æ–¹ç¼–å†™ã€‚ç³»ç»Ÿç”¨æˆ·æ¥å£éœ€è¦èœå•â€¦â€¦</li></ul><h4 id="è´¨é‡å±æ€§ï¼š"><a href="#è´¨é‡å±æ€§ï¼š" class="headerlink" title="è´¨é‡å±æ€§ï¼š"></a>è´¨é‡å±æ€§ï¼š</h4><p>â€‹è§„çº¦äº†è½¯ä»¶äº§å“å¿…é¡»å…·æœ‰çš„æ€§è´¨æ˜¯å¦è¾¾åˆ°è´¨é‡æ–¹é¢ä¸€ä¸ªæ‰€æœŸæœ›çš„æ°´å¹³</p><p>â€‹ä¾‹å¦‚ï¼š</p><p>â€‹å¯é æ€§è½¯ä»¶ç³»ç»Ÿåœ¨æŒ‡å®šç¯å¢ƒä¸­æ²¡æœ‰å¤±è´¥è€Œæ­£å¸¸è¿è¡Œçš„æ¦‚ç‡ã€‚</p><p>â€‹å­˜æ´»æ€§å½“ç³»ç»Ÿçš„æŸä¸€éƒ¨åˆ†ç³»ç»Ÿä¸èƒ½è¿è¡Œæ—¶ï¼Œè¯¥è½¯ä»¶ç»´ç»­è¿è¡Œæˆ–æ”¯æŒå…³é”®åŠŸèƒ½çš„å¯èƒ½æ€§ã€‚</p><p>â€‹å¯ç»´æŠ¤æ€§å‘ç¾å’Œæ”¹æ­£ä¸€ä¸ªè½¯ä»¶æ•…éšœæˆ–å¯¹ç‰¹å®šçš„èŠ±æ˜è¿›è¡Œä¿®æ”¹æ‰€è¦æ±‚çš„å¹³å‡å·¥ä½œã€‚</p><p>â€‹ç”¨æˆ·å‹å¥½æ€§    å­¦ä¹ å’Œä½¿ç”¨ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„å®¹æ˜“ç¨‹åº¦ã€‚</p><p>â€‹å®‰å…¨æ€§åœ¨ä¸€ä¸ªé¢„å®šçš„æ—¶é—´å†…ï¼Œä½¿è½¯ä»¶ç³»ç»Ÿå®‰å…¨çš„å¯èƒ½æ€§ã€‚</p><p>â€‹å¯ç§»æ¤æ€§è½¯ä»¶ç³»ç»Ÿè¿è¡Œçš„å¹³å°ç±»å‹ã€‚</p><h3 id="3-4éœ€æ±‚å‘ç°"><a href="#3-4éœ€æ±‚å‘ç°" class="headerlink" title="3.4éœ€æ±‚å‘ç°"></a>3.4éœ€æ±‚å‘ç°</h3><p>â€‹éœ€æ±‚æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿ</p><h4 id="è‡ªæ‚Ÿ-Introspection"><a href="#è‡ªæ‚Ÿ-Introspection" class="headerlink" title="è‡ªæ‚Ÿ(Introspection)"></a>è‡ªæ‚Ÿ(Introspection)</h4><p>â€‹éœ€æ±‚äººå‘˜æŠŠè‡ªå·±ä½œä¸ºç³»ç»Ÿçš„æœ€ç»ˆç”¨æˆ·ï¼Œå®¡è§†è¯¥ç³»ç»Ÿå¹¶æå‡ºé—®é¡Œï¼šâ€œå¦‚æœæ˜¯æˆ‘ä½¿ç”¨è¿™ä¸€ç³»ç»Ÿï¼Œåˆ™æˆ‘éœ€è¦â€¦â€</p><h5 id="é€‚ç”¨æ¡ä»¶ï¼š"><a href="#é€‚ç”¨æ¡ä»¶ï¼š" class="headerlink" title="é€‚ç”¨æ¡ä»¶ï¼š"></a>é€‚ç”¨æ¡ä»¶ï¼š</h5><p>â€‹éœ€æ±‚å·¥ç¨‹å¸ˆä¸èƒ½ç›´æ¥ä¸ç”¨æˆ·è¿›è¡Œäº¤æµï¼Œè‡ªæ‚Ÿä¼¼ä¹æ˜¯ä¸€ç§æ¯”è¾ƒæœ‰å¸å¼•åŠ›çš„æ–¹æ³•ï¼Œå¯èƒ½ç¡®å®æ˜¯å¿…é¡»çš„ã€‚</p><h5 id="æˆåŠŸæ¡ä»¶ï¼š"><a href="#æˆåŠŸæ¡ä»¶ï¼š" class="headerlink" title="æˆåŠŸæ¡ä»¶ï¼š"></a>æˆåŠŸæ¡ä»¶ï¼š</h5><p>â€‹è‹¥ä½¿è‡ªæ‚Ÿæ˜¯æˆåŠŸçš„ï¼Œéœ€æ±‚äººå‘˜å¿…é¡»å…·æœ‰æ¯”æœ€ç»ˆç”¨æˆ·è¿˜è¦å¤šçš„åº”ç”¨é¢†åŸŸå’Œè¿‡ç¨‹æ–¹é¢çš„çŸ¥è¯†ï¼Œå¹¶å…·æœ‰è‰¯å¥½çš„æƒ³è±¡èƒ½åŠ›ã€‚</p><h4 id="äº¤è°ˆ-Individual-interviews"><a href="#äº¤è°ˆ-Individual-interviews" class="headerlink" title="äº¤è°ˆ(Individual interviews)"></a>äº¤è°ˆ(Individual interviews)</h4><p>ä¸ºäº†ç¡®å®šç³»ç»Ÿåº”è¯¥æä¾›çš„åŠŸèƒ½ï¼Œéœ€æ±‚äººå‘˜é€šè¿‡æå‡ºé—®é¢˜ï¼Œç”¨æˆ·å›ç­”ï¼Œç›´æ¥è¯¢é—®ç”¨æˆ·æƒ³è¦çš„æ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„ç³»ç»Ÿã€‚</p><h5 id="æˆåŠŸæ¡ä»¶ï¼š-1"><a href="#æˆåŠŸæ¡ä»¶ï¼š-1" class="headerlink" title="æˆåŠŸæ¡ä»¶ï¼š"></a>æˆåŠŸæ¡ä»¶ï¼š</h5><p>äº¤è°ˆé€šå¸¸æ˜¯ä¸€ç§æ¯”è‡ªæ‚Ÿæ›´å¥½çš„æŠ€æœ¯ã€‚è¿™ç§é€”å¾„æˆåŠŸä¸å¦ä¾èµ–äºï¼š</p><p>ä¸€ä¸€éœ€æ±‚äººå‘˜æ˜¯å¦å…·æœ‰â€œ<u>æ­£ç¡®æå‡ºé—®é¢˜</u>çš„çš„èƒ½åŠ›ï¼Œ</p><p>ä¸€ä¸€å›ç­”äººå‘˜æ˜¯å¦å…·æœ‰â€œ<u>æ­ç¤ºéœ€æ±‚æœ¬æ„</u>â€çš„èƒ½åŠ›ã€‚</p><p>åœ¨åœ¨çš„é£é™©ï¼šåœ¨äº¤è°ˆæœŸé—´éœ€æ±‚å¯èƒ½ä¸æ–­å¢é•¿ï¼Œæˆ–æ˜¯ä»¥å‰æ²¡æœ‰è®¤è¯†åˆ°çš„åˆç†éœ€æ±‚çš„ä¸€ç§è¡¨ç°ï¼Œè¯´æ˜¯â€œå®Œç¾è •è¡Œâ€(Creepingelegance)ç—…ç—‡çš„ä½“ç°ï¼Œä»¥è‡³äºå¾ˆéš¾äºˆä»¥æ§åˆ¶ï¼Œå¯èƒ½å¯¼è‡´è¶…å‡ºé¡¹ç›®æˆæœ¬å’Œè¿›åº¦çš„é™åˆ¶ã€‚</p><h5 id="åº”å¯¹æªæ–½ï¼š"><a href="#åº”å¯¹æªæ–½ï¼š" class="headerlink" title="åº”å¯¹æªæ–½ï¼š"></a>åº”å¯¹æªæ–½ï¼š</h5><p>é¡¹ç›®ç®¡ç†äººå‘˜å’Œå®¢æˆ·ç®¡ç†äººå‘˜åº”è¯¥å®šæœŸåœ°å¯¹äº¤è°ˆè¿‡ç¨‹çš„ç»“æœè¿›è¡Œå¤è»Šã€‚å…¶ä¸­å…·æœ‰æŒ‘æˆ˜çš„é—®é¢˜æ˜¯ï¼š</p><p>åˆ¤æ–­ï¼š</p><p>ä¸€ä¸€ä»€ä¹ˆæ—¶å€™å¯¹è¿™ä¸€å¢é•¿åˆ’ç•Œï¼š</p><p>ä¸€ä¸€ä»€ä¹ˆæ—¶å€™å°†è¿™ä¸€å¢é•¿é€šçŸ¥å®¢æˆ·ã€‚</p><h4 id="è§‚å¯Ÿ-Observation"><a href="#è§‚å¯Ÿ-Observation" class="headerlink" title="è§‚å¯Ÿ(Observation)"></a>è§‚å¯Ÿ(Observation)</h4><p>é€šè¿‡è§‚å¯Ÿç”¨æˆ·æ‰§è¡Œå…¶ç°è¡Œçš„ä»»åŠ¡å’Œè¿‡ç¨‹ï¼Œæˆ–é€šè¿‡è§‚å¯Ÿä»–ä»¬å¦‚ä½•æ“ä½œä¸æ‰€æœŸæœ›çš„æ–°ç³»ç»Ÿæœ‰å…³çš„ç°æœ‰ç³»ç»Ÿï¼Œäº†è§£ç³»ç»Ÿè¿è¡Œçš„ç¯å¢ƒï¼Œç‰¹åˆ«æ˜¯äº†è§£è¦å»ºçš„æ–°ç³»ç»Ÿä¸ç°å­˜ç³»ç»Ÿã€è¿‡ç¨‹ä»¥åŠå·¥ä½œæ–¹æ³•ä¹‹é—´å¿…é¡»è¿›è¡Œçš„äº¤äº’ã€‚å°½ç®¡äº†è§£çš„è¿™äº›ä¿¡æ¯å¯ä»¥é€šè¿‡äº¤è°ˆè·å–ï¼Œä½†â€œç¬¬ä¸€æ‰‹ææ–™â€ä¸€èˆ¬æ€»æ˜¯èƒ½å¤Ÿæ¯”è¾ƒå¥½çš„ç¬¦åˆç°å®çš„ã€‚</p><h5 id="å­˜åœ¨çš„é£é™©ï¼š"><a href="#å­˜åœ¨çš„é£é™©ï¼š" class="headerlink" title="å­˜åœ¨çš„é£é™©ï¼š"></a>å­˜åœ¨çš„é£é™©ï¼š</h5><p>ä¸€ä¸€å®¢æˆ·å¯èƒ½æŠµè§¦è¿™ä¸€è§‚å¯Ÿã€‚å…¶åŸå› æ˜¯ä»–ä»¬è®¤ä¸ºå¼€å‘è€…æ‰“æ‰°äº†ä»–ä»¬çš„æ­£å¸¸ä¸šåŠ¡ã€‚</p><p>ä¸€ä¸€å®¢æˆ·è¿˜å¯èƒ½è®¤ä¸ºå¼€å‘è€…åœ¨ç­¾çº¦ä¹‹å‰ï¼Œå°±å·²ç»ç†Ÿæ‚‰äº†ä»–ä»¬çš„ä¸šåŠ¡ã€‚</p><h4 id="å°ç»„ä¼š-Group-session"><a href="#å°ç»„ä¼š-Group-session" class="headerlink" title="å°ç»„ä¼š(Group session)"></a>å°ç»„ä¼š(Group session)</h4><p>ä¸¾è¡Œå®¢æˆ·å’Œå¼€å‘äººå‘˜çš„è”å¸­ä¼šè®®ï¼Œä¸å®¢æˆ·ç»„ç»‡çš„ä¸€äº›ä»£è¡¨å…±åŒå¼€å‘éœ€æ±‚ã€‚å…¶ä¸­ï¼š</p><p>ä¸€é€šå¸¸æ˜¯ç”±<u>å¼€å‘ç»„ç»‡çš„ä¸€ä¸ªä»£è¡¨ä½œä¸ºé¦–å¸­éœ€æ±‚å·¥ç¨‹å¸ˆæˆ–è½¯ä»¶å·¥ç¨‹é¡¹ç›®ç»ç†</u>ï¼Œä¸»æŒè¿™ä¸€ä¼šè®®ã€‚ä½†è¿˜å¯ä»¥é‡‡ç”¨å…¶å®ƒå½¢å¼ï¼Œè¿™ä¾èµ–äºå…¶åº”ç”¨é¢†åŸå’Œä¸»æŒäººçš„èƒ½åŠ›ã€‚ä¸»æŒäººçš„ä½œç”¨ä¸»è¦æ˜¯æŒæ¡ä¼šè®®çš„è¿›ç¨‹ã€‚</p><p>ä¸€å¿…é¡»ä»”ç»†åœ°é€‰æ‹©è¯¥å°ç»„çš„æˆå‘˜ï¼Œä¸ä»…è¦è€ƒè™‘ä»–ä»¬å¯¹ç°å­˜çš„å’Œæœªæ¥è¿è¡Œç¯å¢ƒçš„ç†è§£ç¨‹åº¦ï¼Œè¿˜è¦è€ƒè™‘ä»–ä»¬çš„äººå“ã€‚</p><h4 id="æç‚¼-Extraction"><a href="#æç‚¼-Extraction" class="headerlink" title="æç‚¼(Extraction)"></a>æç‚¼(Extraction)</h4><p>å¤å®¡æŠ€æœ¯æ–‡æ¡£ï¼ˆä¾‹å¦‚ï¼Œæœ‰å…³éœ€è¦çš„é™ˆè¾¾ï¼ŒåŠŸèƒ½å’Œæ€§èƒ½ç›®æ ‡çš„é™ˆè¿°ï¼Œç³»ç»Ÿè§„çº¦æ¥å£æ ‡å‡†ï¼Œç¡¬ä»¶è®¾è®¡æ–‡æ¡£ä»¥åŠConOpsæ–‡æ¡£ï¼‰ï¼Œå¹¶æå‡ºç›¸å…³çš„ä¿¡æ¯ã€‚</p><h5 id="é€‚ç”¨æ¡ä»¶ï¼š-1"><a href="#é€‚ç”¨æ¡ä»¶ï¼š-1" class="headerlink" title="é€‚ç”¨æ¡ä»¶ï¼š"></a>é€‚ç”¨æ¡ä»¶ï¼š</h5><p>æç‚¼æ–¹æ³•æ˜¯é’ˆå¯¹<u><strong>å·±ç»æœ‰äº†éƒ¨åˆ†éœ€æ±‚æ–‡æ¡£çš„æƒ…å†µ</strong></u>ã€‚ä¾æ®äº§å“çš„æœ¬æ¥æƒ…å†µï¼Œå¯èƒ½æœ‰å¾ˆå¤šæ–‡æ¡£éœ€è¦å¤å®¡ï¼Œä»¥ç¡®å®šå…¶ä¸­æ˜¯å¦åŒ…å«ç›¸å…³è”çš„ä¿¡æ¯ã€‚åœ¨æœ‰çš„æƒ…å†µï¼Œä¹Ÿå¯èƒ½åªæœ‰å°‘æ•°æ–‡æ¡£éœ€è¦å¤å®¡ã€‚</p><p>åœ¨è®¸å¤šé¡¹ç›®ä¸­ï¼Œåœ¨ä»»ä½•äº¤è°ˆã€è§‚å¯Ÿã€å°ç»„ä¼šæˆ–è‡ªæ‚Ÿä¹‹å‰ï¼Œåº”è¯¥å¯¹è¯¥é¡¹ç›®çš„èƒŒæ™¯æ–‡æ¡£è¿›è¡Œå¤å®¡ï¼Œè¿˜åº”å¯¹ç³»ç»Ÿè§„çº¦è¿›è¡Œå¤å®¡ï¼ŒåŒæ—¶äº†è§£ç›¸å…³çš„æ ‡å‡†å’Œæ”¿ç­–ã€‚</p><h4 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h4><ul><li>åœ¨ä»»æ„ç‰¹å®šçš„ç¯å¢ƒä¸­ï¼Œæ¯é¡¹æŠ€æœ¯éƒ½æœ‰å…¶è‡ªå·±çš„ä¼˜ç‚¹å’Œä¸è¶³ã€‚åœ¨å®æ–½ä¸Šè¿°ä»»ä½•ä¸€é¡¹æŠ€æœ¯æ—¶ï¼Œéƒ½å¯ä»¥è¾…ä»¥å…¶ä»–</li></ul><p>æ–¹æ³•ï¼Œä¾‹å¦‚åŸå‹æ„é€ ï¼Œåœ¨ä¸¾è¡Œå°ç»„ä¼šæ—¶å¯ä»¥ä½¿ç”¨åŸå‹ï¼Œæ–¹ä¾¿äººå‘˜ä¹‹é—´çš„äº¤æµã€‚</p><ul><li><p>ä¾æ®éœ€æ±‚å·¥ç¨‹äººå‘˜çš„æŠ€èƒ½å’Œäº§å“ã€åˆåŒçš„å®é™…æƒ…å†µï¼Œå¾€å¾€éœ€è¦â€œç»„åˆâ€åœ°ä½¿ç”¨è¿™äº›æŠ€æœ¯æ¥å¼€å‘åˆå§‹éœ€æ±‚ã€‚</p></li><li><p>æ‰§è¡Œéœ€æ±‚å‘ç°è¿™é¡¹æ´»åŠ¨çš„äººï¼Œå…¶æŠ€èƒ½æ°´å¹³å°†å¯¹è¿™é¡¹æ´»åŠ¨çš„æˆåŠŸå…·æœ‰é‡å¤§çš„å½±å“ã€‚</p></li><li><p>å¤§å‹å¤æ‚é¡¹ç›®å’Œä¸€äº›æœ‰èƒ½åŠ›çš„ç»„ç»‡ï¼Œåœ¨å¼€å‘éœ€æ±‚æ–‡æ¡£æ—¶ï¼Œå¾€å¾€ä½¿ç”¨ç³»ç»ŸåŒ–çš„éœ€æ±‚è·å–ã€åˆ†ææŠ€æœ¯å’Œå·¥å…·ã€‚</p></li></ul><p>ä¸€äº›æ–¹æ³•æä¾›äº† ç³»ç»ŸåŒ–ã€è‡ªåŠ¨åŒ–çš„åŠŸèƒ½ï¼Œå¹¶å¯é€ä¸€éªŒè¯å•ä¸€éœ€æ±‚æ‰€å…·æœ‰çš„äº”ä¸ªæ€§è´¨ï¼ŒéªŒè¯éœ€æ±‚è§„çº¦æ˜¯å¦å…·</p><p>æœ‰å››ä¸ªæ€§è´¨ã€‚</p><h3 id="3-5éœ€æ±‚è§„çº¦-SRS"><a href="#3-5éœ€æ±‚è§„çº¦-SRS" class="headerlink" title="3.5éœ€æ±‚è§„çº¦(SRS)"></a>3.5éœ€æ±‚è§„çº¦(SRS)</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ:"></a>æ¦‚å¿µ:</h4><p>ä¸€ä¸ªéœ€æ±‚è§„çº¦æ˜¯ä¸€ä¸ªè½¯ä»¶é¡¹&#x2F;äº§å“&#x2F;ç³»ç»Ÿæ‰€æœ‰éœ€æ±‚é™ˆè¿°çš„æ­£å¼æ–‡æ¡£ï¼Œæ˜¯ä¸€ä¸ªè½¯ä»¶äº§å“&#x2F; ç³»ç»Ÿçš„æ¦‚å¿µæ¨¡å‹ã€‚</p><h4 id="åŸºæœ¬æ€§è´¨"><a href="#åŸºæœ¬æ€§è´¨" class="headerlink" title="åŸºæœ¬æ€§è´¨:"></a>åŸºæœ¬æ€§è´¨:</h4><p>ä¸€èˆ¬æ¥è¯´ï¼ŒSRSåº”å¿…é¡»å…·æœ‰ä»¥ä¸‹4ä¸ªæ€§è´¨ï¼š</p><ul><li><p>é‡è¦æ€§å’Œç¨³å®šæ€§ç¨‹åº¦ (Banlked for importaance and stability).ä¾‹å¦‚ï¼šåŸºæœ¬éœ€æ±‚ã€å¯é€çš„éœ€æ±‚å’ŒæœŸæœ›çš„éœ€æ±‚ã€‚</p></li><li><p>å¯ä¿®æ”¹çš„ (Modifiable)ï¼šåœ¨ä¸è¿‡å¤šåœ°å½±å“å…¶å®ƒéœ€æ±‚çš„å‰æä¸‹ï¼Œå¯ä»¥å®¹æ˜“åœ°ä¿®æ”¹ä¸€ä¸ªå•ä¸€éœ€æ±‚.</p></li><li><p>å®Œæ•´çš„(Couplete)ï¼šæ²¡æœ‰è¢«é—æ¼çš„éœ€æ±‚.</p></li><li><p>ä¸€è‡´çš„ (Consistent)ï¼šä¸å­˜åœ¨äº’æ–¥çš„éœ€æ±‚.</p></li></ul><h4 id="æ ¼å¼"><a href="#æ ¼å¼" class="headerlink" title="æ ¼å¼:"></a>æ ¼å¼:</h4><p>å¼•è¨€â€¦â€¦æ€»ä½“æè¿°â€¦â€¦ç‰¹å®šéœ€æ±‚â€¦â€¦</p><h3 id="3-6éœ€æ±‚è§„çº¦çš„ä½œç”¨"><a href="#3-6éœ€æ±‚è§„çº¦çš„ä½œç”¨" class="headerlink" title="3.6éœ€æ±‚è§„çº¦çš„ä½œç”¨"></a>3.6éœ€æ±‚è§„çº¦çš„ä½œç”¨</h3><p>ç¬¬ä¸€ï¼Œæ˜¯æœ€é‡è¦çš„ï¼Œä½œä¸ºè½¯ä»¶å¼€å‘ç»„ç»‡å’Œç”¨æˆ·ä¹‹é—´ä¸€ä»½äº‹å®ä¸Šçš„æŠ€æœ¯åˆåŒä¹¦ï¼›æ˜¯äº§å“åŠŸèƒ½åŠå…¶ç¯å¢ƒçš„ä½“ç°ã€‚</p><p>ç¬¬äºŒï¼Œå¯¹äºé¡¹ç›®çš„å…¶ä½™å¤§å¤šæ•°å·¥ä½œï¼Œå®ƒæ˜¯ä¸€ä¸ªç®¡ç†æ§åˆ¶ç‚¹ã€‚</p><p>ç¬¬ä¸‰ï¼Œå¯¹äºäº§å“çš„è®¾è®¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ­£å¼çš„ã€å—æ§çš„èµ·å§‹ç‚¹ã€‚</p><p>ç¬¬å››ï¼Œæ˜¯åˆ›å»ºäº§å“éªŒæ”¶æµ‹è¯•è®¡åˆ’å’Œç”¨æˆ·æŒ‡å—çš„åŸºç¡€ï¼Œå³åŸºäºéœ€æ±‚è§„çº¦ä¸€èˆ¬è¿˜ä¼šäº§ç”Ÿå¦å¤–ä¸¤ä¸ªæ–‡æ¡£â€”â€”<strong>åˆå§‹</strong></p><p><strong>æµ‹è¯•è®¡åˆ’</strong>å’Œ<strong>ç”¨æˆ·ç³»ç»Ÿæ“ä½œæè¿°</strong>ã€‚</p><h3 id="3-7é¡¹ç›®çš„éœ€æ±‚åŠéœ€æ±‚è§„çº¦"><a href="#3-7é¡¹ç›®çš„éœ€æ±‚åŠéœ€æ±‚è§„çº¦" class="headerlink" title="3.7é¡¹ç›®çš„éœ€æ±‚åŠéœ€æ±‚è§„çº¦"></a>3.7é¡¹ç›®çš„éœ€æ±‚åŠéœ€æ±‚è§„çº¦</h3><p>é¡¹ç›®éœ€æ±‚æ˜¯å®¢æˆ·å’Œå¼€å‘è€…ä¹‹é—´æœ‰å…³æŠ€æœ¯åˆåŒ-äº§å“&#x2F;ç³»ç»Ÿéœ€æ±‚çš„ç†è§£ï¼Œåº”è®°å½•åœ¨å·¥ä½œé™ˆè¿°SOWä¸­æˆ–å…¶ä»–æŸä¸€é¡¹ç›®æ–‡æ¡£ï¼ˆä¾‹å¦‚ï¼Œé¡¹ç›®ç®¡ç†è®¡åˆ’ï¼‰ä¸­ã€‚</p><p>å³<strong>éœ€æ±‚è§„çº¦</strong>(SRS)åº”åªå…³æ³¨äº§å“éœ€æ±‚ï¼Œå³ï¼š</p><p>â€‹äº§å“&#x2F;ç³»ç»Ÿéœ€æ±‚ä¸€â€œäº¤ä»˜ç»™å®¢æˆ·çš„äº§å“æ˜¯ä»€ä¹ˆâ€</p><p><strong>é¡¹ç›®çš„éœ€æ±‚</strong>(SOW)åº”å…³æ³¨é¡¹ç›®å·¥ä½œä¸ç®¡ç†ï¼Œå³ï¼š</p><p>â€‹é¡¹ç›®éœ€æ±‚-â€œå¼€å‘ç»„è¦åšçš„æ˜¯ä»€ä¹ˆâ€</p><h2 id="chapter4-ç»“æ„åŒ–åˆ†ææ–¹æ³•"><a href="#chapter4-ç»“æ„åŒ–åˆ†ææ–¹æ³•" class="headerlink" title="chapter4 ç»“æ„åŒ–åˆ†ææ–¹æ³•"></a>chapter4 ç»“æ„åŒ–åˆ†ææ–¹æ³•</h2><h3 id="ç»“æ„åŒ–åˆ†æï¼š"><a href="#ç»“æ„åŒ–åˆ†æï¼š" class="headerlink" title="ç»“æ„åŒ–åˆ†æï¼š"></a>ç»“æ„åŒ–åˆ†æï¼š</h3><p>â€‹éœ€æ±‚åˆ†æçš„ç›®æ ‡<br>â€‹å¯¹éœ€æ±‚é™ˆè¿°è¿›è¡Œåˆ†æï¼Œè§£å†³å…¶ä¸­çš„æ­§ä¹‰ã€ä¸ä¸€è‡´ç­‰é—®é¢˜ä»¥ç³»ç»ŸåŒ–çš„å½¢å¼è¡¨è¾¾ç”¨æˆ·çš„éœ€æ±‚ï¼Œå³ç»™å‡ºé—®é¢˜çš„å½¢å¼åŒ–æˆ–åŠå½¢å¼åŒ–çš„æè¿°(ç§°ä¸ºç³»ç»Ÿçš„æ¦‚å¿µæ¨¡å‹ï¼Œæˆ–ç³»ç»Ÿçš„éœ€æ±‚è§„çº¦æˆ–éœ€æ±‚è§„æ ¼è¯´æ˜)ã€‚ä½œä¸ºå¼€å‘äººå‘˜å’Œå®¢æˆ·é—´æŠ€æœ¯å¥‘çº¦çš„åŸºç¡€ï¼Œå¹¶ä½œä¸ºè€Œåå¼€å‘æ´»åŠ¨çš„ä¸€ä¸ªåŸºæœ¬è¾“å…¥ã€‚</p><p>2å®ç°è½¯ä»¶éœ€æ±‚åˆ†æçš„ç›®æ ‡å¯¹æ–¹æ³•å­¦çš„éœ€æ±‚</p><ul><li>**æä¾›ä¸€ç»„æœ¯è¯­(ç¬¦å·)**ï¼ŒæŒ‡å¯¼éœ€æ±‚æŠ½è±¡ä¸­éœ€è¦å…³æ³¨çš„ä¸»è¦æ–¹é¢ï¼Œå¹¶ç”¨äºè¡¨è¾¾åˆ†æä¸­æ‰€ä½¿ç”¨çš„ä¿¡æ¯ã€‚è¿™äº›æœ¯è¯­å½¢æˆä¸€ä¸ªç‰¹å®šçš„æŠ½è±¡å±‚ï¼Œå³éœ€æ±‚å±‚ã€‚</li><li>ä¾æ®è¿™äº›æœ¯è¯­æ‰€å½¢æˆçš„â€œç©ºé—´â€ï¼Œ<strong>ç»™å‡ºè¡¨è¾¾æ¨¡å‹çš„å·¥å…·</strong>,æ”¯æŒè¡¨è¾¾ç³»ç»ŸåŠŸèƒ½å½¢æ€ã€‚</li><li><strong>ç»™å‡ºè¿‡ç¨‹æŒ‡å¯¼</strong>ï¼Œä»¥æ”¯æŒç³»ç»ŸåŒ–åœ°ä½¿ç”¨ç›¸å…³ä¿¡æ¯å»ºé€ ç³»ç»Ÿæ¨¡å‹ã€‚</li></ul><p>åŸºæœ¬æœ¯è¯­ï¼š</p><p>æ¨¡å‹è¡¨è¾¾å·¥å…·</p><p>â€‹æ•°æ®æµå›¾ï¼š</p><p>â€‹æ•°æ®å­—å…¸ï¼šå®šä¹‰æ•°æ®æµå’Œæ•°æ®å­˜å‚¨</p><p>â€‹åŠ å·¥å°è¯´æ˜ï¼š</p><ul><li>ç»“æ„åŒ–è‡ªç„¶è¯­è¨€</li><li>åˆ¤å®šè¡¨ </li><li>åˆ¤å®šæ ‘</li></ul><h3 id="ç»“æ„åŒ–æ–¹æ³•ï¼š"><a href="#ç»“æ„åŒ–æ–¹æ³•ï¼š" class="headerlink" title="ç»“æ„åŒ–æ–¹æ³•ï¼š"></a>ç»“æ„åŒ–æ–¹æ³•ï¼š</h3><h4 id="ç»“æ„åŒ–åˆ†ææ–¹æ³•ï¼š"><a href="#ç»“æ„åŒ–åˆ†ææ–¹æ³•ï¼š" class="headerlink" title="ç»“æ„åŒ–åˆ†ææ–¹æ³•ï¼š"></a>ç»“æ„åŒ–åˆ†ææ–¹æ³•ï¼š</h4><p>â€‹</p><h4 id="ç»“æ„åŒ–è®¾è®¡æ–¹æ³•"><a href="#ç»“æ„åŒ–è®¾è®¡æ–¹æ³•" class="headerlink" title="ç»“æ„åŒ–è®¾è®¡æ–¹æ³•"></a>ç»“æ„åŒ–è®¾è®¡æ–¹æ³•</h4><h4 id="ç»“æ„åŒ–ç¨‹åºè®¾è®¡æ–¹æ³•"><a href="#ç»“æ„åŒ–ç¨‹åºè®¾è®¡æ–¹æ³•" class="headerlink" title="ç»“æ„åŒ–ç¨‹åºè®¾è®¡æ–¹æ³•"></a>ç»“æ„åŒ–ç¨‹åºè®¾è®¡æ–¹æ³•</h4><h2 id="chapter5"><a href="#chapter5" class="headerlink" title="chapter5"></a>chapter5</h2><h2 id="chapter6"><a href="#chapter6" class="headerlink" title="chapter6"></a>chapter6</h2><h2 id="chapter7"><a href="#chapter7" class="headerlink" title="chapter7"></a>chapter7</h2><h2 id="chapter8-è½¯ä»¶æµ‹è¯•"><a href="#chapter8-è½¯ä»¶æµ‹è¯•" class="headerlink" title="chapter8 è½¯ä»¶æµ‹è¯•"></a>chapter8 è½¯ä»¶æµ‹è¯•</h2><h2 id="chapter9-è½¯ä»¶é¡¹ç›®ç®¡ç†"><a href="#chapter9-è½¯ä»¶é¡¹ç›®ç®¡ç†" class="headerlink" title="chapter9 è½¯ä»¶é¡¹ç›®ç®¡ç†"></a>chapter9 è½¯ä»¶é¡¹ç›®ç®¡ç†</h2><h2 id="Chapter10-è½¯ä»¶å¼€å‘å·¥å…·ä¸ç¯å¢ƒ"><a href="#Chapter10-è½¯ä»¶å¼€å‘å·¥å…·ä¸ç¯å¢ƒ" class="headerlink" title="Chapter10 è½¯ä»¶å¼€å‘å·¥å…·ä¸ç¯å¢ƒ"></a>Chapter10 è½¯ä»¶å¼€å‘å·¥å…·ä¸ç¯å¢ƒ</h2>]]></content>
      
      
      <categories>
          
          <category> è½¯ä»¶å¼€å‘åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è½¯ä»¶å·¥ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ“ä½œç³»ç»Ÿ</title>
      <link href="/2023/06/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
      <url>/2023/06/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h1><p>(å‚ç…§æ¸…åâ€”â€”æ“ä½œç³»ç»Ÿè¯¾ç¨‹)ï¼š</p><p>osï¼šå¯¹ç¡¬ä»¶çš„ç®¡ç†å’Œæ§åˆ¶ æœ¬è¯¾ç¨‹ç€é‡å¯¹<strong>kernelå±‚</strong>çš„ç ”ç©¶</p><h2 id="Chapter1-æ¦‚è¿°"><a href="#Chapter1-æ¦‚è¿°" class="headerlink" title="Chapter1 æ¦‚è¿°"></a>Chapter1 æ¦‚è¿°</h2><h4 id="ä»€ä¹ˆæ˜¯OSï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯OSï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯OSï¼Ÿ"></a>ä»€ä¹ˆæ˜¯OSï¼Ÿ</h4><p>CPU â€”â€“&gt; è¿›ç¨‹</p><p>ç£ç›˜ â€”â€“&gt; æ–‡ä»¶</p><p>å†…å­˜ â€”â€“&gt; åœ°å€ç©ºé—´</p><h5 id="ç”¨æˆ·è§’åº¦ï¼š"><a href="#ç”¨æˆ·è§’åº¦ï¼š" class="headerlink" title="ç”¨æˆ·è§’åº¦ï¼š"></a>ç”¨æˆ·è§’åº¦ï¼š</h5><ul><li>ç®¡ç†åº”ç”¨ç¨‹åº</li><li>ä¸ºåº”ç”¨ç¨‹åºæä¾›æœåŠ¡</li><li>æ€æ­»åº”ç”¨ç¨‹åº</li></ul><h5 id="èµ„æºè§’åº¦ï¼š"><a href="#èµ„æºè§’åº¦ï¼š" class="headerlink" title="èµ„æºè§’åº¦ï¼š"></a>èµ„æºè§’åº¦ï¼š</h5><ul><li>èµ„æºç®¡ç†</li><li>ç®¡ç†å¤–è®¾ã€åˆ†é…èµ„æº</li></ul><h4 id="Kernelå±‚å†…éƒ¨ç»„ä»¶ï¼š"><a href="#Kernelå±‚å†…éƒ¨ç»„ä»¶ï¼š" class="headerlink" title="Kernelå±‚å†…éƒ¨ç»„ä»¶ï¼š"></a>Kernelå±‚å†…éƒ¨ç»„ä»¶ï¼š</h4><ul><li>CPUè°ƒåº¦å™¨</li><li>ç‰©ç†å†…å­˜ç®¡ç†</li><li>è™šæ‹Ÿå†…å­˜ç®¡ç†</li><li>æ–‡ä»¶ç³»ç»Ÿç®¡ç†</li><li>ä¸­æ–­å¤„ç†ä¸è®¾å¤‡é©±åŠ¨</li></ul><h4 id="OS-Kernelçš„ç‰¹å¾ï¼š"><a href="#OS-Kernelçš„ç‰¹å¾ï¼š" class="headerlink" title="OS Kernelçš„ç‰¹å¾ï¼š"></a>OS Kernelçš„ç‰¹å¾ï¼š</h4><ul><li><p>å¹¶å‘</p><ul><li>è®¡ç®—æœºç³»ç»Ÿä¸­åŒæ—¶å­˜åœ¨å¤šä¸ªè¿è¡Œçš„ç¨‹åºï¼Œéœ€è¦OSç®¡ç†å’Œè°ƒåº¦</li></ul></li><li><p>å…±äº«</p><ul><li>äº’æ–¥å…±äº«</li></ul></li><li><p>è™šæ‹Ÿ</p><ul><li>åˆ©ç”¨<strong>å¤šé“ç¨‹åºè®¾è®¡æŠ€æœ¯</strong>è®©æ¯ä¸ªç”¨æˆ·éƒ½è§‰å¾—æœ‰ä¸€ä¸ªè®¡ç®—æœºä¸“é—¨ä¸ºä»–æœåŠ¡ã€‚</li></ul></li><li><p>å¼‚æ­¥</p><ul><li>ç¨‹åºçš„æ‰§è¡Œä¸æ˜¯ä¸€è´¯åˆ°åº•ï¼Œè€Œæ˜¯èµ°èµ°åœåœï¼Œå‘å‰æ¨è¿›çš„é€Ÿåº¦ä¸å¯é¢„çŸ¥</li><li>åªè¦è¿è¡Œç¯å¢ƒç›¸åŒï¼ŒOSéœ€è¦ä¿è¯ç¨‹åºçš„è¿è¡Œç»“æœä¹Ÿç›¸åŒ</li></ul></li></ul><h2 id="Chapter2-æ“ä½œç³»ç»ŸåŸºç¡€æ“ä½œ"><a href="#Chapter2-æ“ä½œç³»ç»ŸåŸºç¡€æ“ä½œ" class="headerlink" title="Chapter2 æ“ä½œç³»ç»ŸåŸºç¡€æ“ä½œ"></a>Chapter2 æ“ä½œç³»ç»ŸåŸºç¡€æ“ä½œ</h2><h3 id="2-1-æ“ä½œç³»ç»Ÿçš„å¯åŠ¨"><a href="#2-1-æ“ä½œç³»ç»Ÿçš„å¯åŠ¨" class="headerlink" title="2.1 æ“ä½œç³»ç»Ÿçš„å¯åŠ¨"></a>2.1 æ“ä½œç³»ç»Ÿçš„å¯åŠ¨</h3><h4 id="å¼€æœºé¡ºåºï¼š"><a href="#å¼€æœºé¡ºåºï¼š" class="headerlink" title="å¼€æœºé¡ºåºï¼š"></a>å¼€æœºé¡ºåºï¼š</h4><p>â€‹ç”µè„‘å¼€æœºåï¼Œå°†å…ˆæ‰§è¡Œbootstrap programç¨‹åº(å¼•å¯¼ç¨‹åº)ï¼Œå¼•å¯¼ç¨‹åºä¸€èˆ¬ä½äºè®¡ç®—æœºçš„å›ºä»¶ä¸­ï¼Œç”±å®ƒåˆå§‹åŒ–ç³»ç»Ÿçš„å†…æ ¸ä»¥åŠå„ä¸ªç»„ä»¶ã€‚</p><h3 id="2-2-ä¸­æ–­ã€å¼‚å¸¸å’Œç³»ç»Ÿè°ƒç”¨"><a href="#2-2-ä¸­æ–­ã€å¼‚å¸¸å’Œç³»ç»Ÿè°ƒç”¨" class="headerlink" title="2.2 ä¸­æ–­ã€å¼‚å¸¸å’Œç³»ç»Ÿè°ƒç”¨"></a>2.2 ä¸­æ–­ã€å¼‚å¸¸å’Œç³»ç»Ÿè°ƒç”¨</h3><h4 id="ä¸­æ–­-from-å¤–è®¾"><a href="#ä¸­æ–­-from-å¤–è®¾" class="headerlink" title="ä¸­æ–­(from å¤–è®¾)"></a>ä¸­æ–­(from å¤–è®¾)</h4><ul><li><p>æ¥è‡ªä¸åŒçš„ç¡¬ä»¶è®¾å¤‡çš„è®¡æ—¶å™¨å’Œç½‘ç»œçš„ä¸­æ–­</p></li><li><p>å¼‚æ­¥</p></li><li><p>å¯¹ç”¨æˆ·åº”ç”¨ç¨‹åºæ˜¯é€æ˜çš„</p></li></ul><h5 id="ä¸­æ–­çš„å¤„ç†è¿‡ç¨‹ï¼š"><a href="#ä¸­æ–­çš„å¤„ç†è¿‡ç¨‹ï¼š" class="headerlink" title="ä¸­æ–­çš„å¤„ç†è¿‡ç¨‹ï¼š"></a>ä¸­æ–­çš„å¤„ç†è¿‡ç¨‹ï¼š</h5><h6 id="ç¡¬ä»¶ï¼š"><a href="#ç¡¬ä»¶ï¼š" class="headerlink" title="ç¡¬ä»¶ï¼š"></a>ç¡¬ä»¶ï¼š</h6><ul><li>è®¾ç½®ä¸­æ–­æ ‡è®°[CPUåˆå§‹åŒ–]<br>1. å°†å†…éƒ¨äº‹ä»¶ã€å¤–éƒ¨äº‹ä»¶è®¾ç½®ä¸­æ–­æ ‡è®°<br>      1. CPUé€šè¿‡æ ‡è®°è·å¾—ä¸­æ–­äº‹ä»¶çš„ID(å‡­å€Ÿä¸­æ–­å‘é‡è¡¨)</li></ul><p></p><h6 id="è½¯ä»¶ï¼š"><a href="#è½¯ä»¶ï¼š" class="headerlink" title="è½¯ä»¶ï¼š"></a>è½¯ä»¶ï¼š</h6><ul><li>ä¿å­˜å½“å‰å¤„ç†çŠ¶æ€</li><li>ä¸­æ–­æœåŠ¡ç¨‹åºå¤„ç†</li><li>æ¸…é™¤ä¸­æ–­æ ‡è®°</li><li>æ¢å¤ä¹‹å‰ä¿å­˜çš„å¤„ç†çŠ¶æ€</li></ul><h4 id="å¼‚å¸¸-from-ä¸è‰¯çš„åº”ç”¨ç¨‹åº"><a href="#å¼‚å¸¸-from-ä¸è‰¯çš„åº”ç”¨ç¨‹åº" class="headerlink" title="å¼‚å¸¸(from ä¸è‰¯çš„åº”ç”¨ç¨‹åº)"></a>å¼‚å¸¸(from ä¸è‰¯çš„åº”ç”¨ç¨‹åº)</h4><ul><li><p>åº”ç”¨ç¨‹åºäº§ç”Ÿï¼Œç”±äºéæ³•æŒ‡ä»¤æˆ–è€…å…¶ä»–åçš„å¤„ç†çŠ¶æ€</p></li><li><p>åŒæ­¥</p></li><li><p>æ€æ­»æˆ–é‡æ–°æ‰§è¡Œæ„æƒ³ä¸åˆ°çš„åº”ç”¨ç¨‹åºæŒ‡ä»¤</p></li></ul><h5 id="å¼‚å¸¸çš„å¤„ç†è¿‡ç¨‹ï¼š"><a href="#å¼‚å¸¸çš„å¤„ç†è¿‡ç¨‹ï¼š" class="headerlink" title="å¼‚å¸¸çš„å¤„ç†è¿‡ç¨‹ï¼š"></a>å¼‚å¸¸çš„å¤„ç†è¿‡ç¨‹ï¼š</h5><ul><li>ä¿å­˜ç°åœº</li><li>å¼‚å¸¸å¤„ç†<ul><li>æ€æ­»å¼‚å¸¸ç¨‹åº</li><li>æˆ–è€… é‡æ–°æ‰§è¡Œå¼‚å¸¸å‘½ä»¤</li></ul></li><li>æ¢å¤ç°åœº</li></ul><h4 id="ç³»ç»Ÿè°ƒç”¨-from-åº”ç”¨ç¨‹åº"><a href="#ç³»ç»Ÿè°ƒç”¨-from-åº”ç”¨ç¨‹åº" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨(from åº”ç”¨ç¨‹åº)"></a>ç³»ç»Ÿè°ƒç”¨(from åº”ç”¨ç¨‹åº)</h4><ul><li><p>åº”ç”¨ç¨‹åºä¸»åŠ¨å‘OSå‘é€æœåŠ¡è¯·æ±‚</p></li><li><p>åŒæ­¥æˆ–å¼‚æ­¥</p></li><li><p>ç­‰å¾…åç»§ç»­æ‰§è¡Œ</p></li></ul><h5 id="ç³»ç»Ÿè°ƒç”¨çš„å¤„ç†è¿‡ç¨‹ï¼š"><a href="#ç³»ç»Ÿè°ƒç”¨çš„å¤„ç†è¿‡ç¨‹ï¼š" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨çš„å¤„ç†è¿‡ç¨‹ï¼š"></a>ç³»ç»Ÿè°ƒç”¨çš„å¤„ç†è¿‡ç¨‹ï¼š</h5><p>â€‹è°ƒç”¨ç³»ç»Ÿå‡½æ•° å¦‚printf()åï¼Œä¼šè§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨å±å¹•ä¸Šæ‰“å°</p><p><u>å°†OSèƒ½æä¾›çš„ç³»ç»Ÿè°ƒç”¨è¿›è¡ŒæŸç§é›†æˆï¼Œå½¢æˆå„è‰²å„æ ·çš„APIä¾›å¼€å‘äººå‘˜ä½¿ç”¨</u></p><ul><li><p>Win32 API ç”¨äºWindows</p></li><li><p>POSIX API ç”¨äº POSIX-based systems(such as: UNIXã€LINUXã€MAX OS X)</p></li><li><p>Java API ç”¨äº JVM</p><ol><li>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç³»ç»Ÿè°ƒç”¨æœ‰è‡ªå·±çš„åºå·ï¼Œç³»ç»Ÿè°ƒç”¨æ¥å£æ ¹æ®è¿™äº›åºå·ç»´æŠ¤è¡¨çš„ç´¢å¼•</li><li>ç³»ç»Ÿè°ƒç”¨æ¥å£ è°ƒç”¨å†…æ ¸æ€ä¸­çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè¿”å›ç³»ç»Ÿè°ƒç”¨çš„çŠ¶æ€å’Œç»“æœ(å…¶è¿”å›å€¼)</li><li>ç”¨æˆ·ä¸éœ€è¦çŸ¥é“ç³»ç»Ÿè°ƒç”¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Œåªéœ€è¦è·å–å„ä¸ªAPIçš„ä½œç”¨å³å¯ï¼›æ“ä½œç³»ç»Ÿæ¥å£çš„ç»†èŠ‚å¤§éƒ¨åˆ†éšè—åœ¨APIä¸­</li></ol></li></ul><p><strong>ğŸŒŸç”¨æˆ·ä»ç³»ç»Ÿè°ƒç”¨çš„åº“ä¸­è°ƒç”¨ç³»ç»Ÿè°ƒç”¨æ¥å£ï¼Œåœ¨è°ƒç”¨ç³»ç»Ÿè°ƒç”¨æ¥å£æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªä»ç”¨æˆ·æ€-&gt;å†…æ ¸æ€çš„è½¬æ¢ï¼Œæ‰§è¡Œå†…æ ¸æ€ä¸­çš„ç³»ç»Ÿè°ƒç”¨ã€‚</strong></p><p>ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ä¼šå¤§äºæ™®é€šçš„å‡½æ•°è°ƒç”¨ï¼Œå› ä¸ºï¼š</p><p>â€‹ç³»ç»Ÿè°ƒç”¨ä¼šä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œéœ€è¦ä¸¤æ¬¡å»ºç«‹å‡½æ•°ç©ºé—´ï¼Œè€Œå‡½æ•°è°ƒç”¨åªæœ‰è‡ªå·±å”¯ä¸€çš„æ ˆç©ºé—´</p><h4 id="è·¨è¶Šæ“ä½œç³»ç»Ÿè¾¹ç•Œçš„å¼€é”€-ä¸­æ–­ã€å¼‚å¸¸ã€ç³»ç»Ÿè°ƒç”¨"><a href="#è·¨è¶Šæ“ä½œç³»ç»Ÿè¾¹ç•Œçš„å¼€é”€-ä¸­æ–­ã€å¼‚å¸¸ã€ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="è·¨è¶Šæ“ä½œç³»ç»Ÿè¾¹ç•Œçš„å¼€é”€(ä¸­æ–­ã€å¼‚å¸¸ã€ç³»ç»Ÿè°ƒç”¨)"></a>è·¨è¶Šæ“ä½œç³»ç»Ÿè¾¹ç•Œçš„å¼€é”€(ä¸­æ–­ã€å¼‚å¸¸ã€ç³»ç»Ÿè°ƒç”¨)</h4><p>åœ¨æ‰§è¡Œæ—¶é—´ä¸Šå¼€é”€è¶…è¿‡åº”ç”¨ç¨‹åº</p><p>å¼€é”€ä½“ç°äºï¼š</p><ul><li>å»ºç«‹ä¸­æ–­&#x2F;å¼‚å¸¸&#x2F;ç³»ç»Ÿ<strong>è°ƒç”¨å· ä¸ å¯¹åº”æœåŠ¡ä¾‹ç¨‹æ˜ å°„å…³ç³»çš„åˆå§‹åŒ–å¼€é”€</strong>(å› ä¸ºä½ è·¨è¶Šäº†OSè¾¹ç•Œï¼Œä¸èƒ½æŠŠåŸæœ¬çš„çŠ¶æ€å¸¦è¿‡å»ï¼Œæ‰€ä»¥éœ€è¦ä¸€å¼ æ˜ å°„è¡¨ï¼Œç”±ç¼–å·æ‰¾åˆ°ä½ éœ€è¦åšçš„äº‹)</li><li>å»ºç«‹å†…æ ¸å †æ ˆ(å› ä¸ºåœ¨å†…æ ¸æ€è¿›è¡Œæ“ä½œï¼Œéœ€è¦åœ¨å†…æ ¸æ€å»ºç«‹å˜é‡å­˜å‚¨ç©ºé—´)</li><li>éªŒè¯å‚æ•°(å†…æ ¸æ€ä¸ä¿¡ä»»ç”¨æˆ·æ€ï¼Œéœ€è¦è¿›è¡ŒéªŒè¯)</li><li>å†…æ ¸æ€æ˜ å°„åˆ°ç”¨æˆ·æ€çš„åœ°å€ç©ºé—´(å†…æ ¸æ€äº§ç”Ÿçš„æ•°æ®éœ€è¦æ‹·è´å›ç”¨æˆ·æ€)</li><li>å†…æ ¸æ€ç‹¬ç«‹åœ°å€ç©ºé—´(TLB)</li></ul><p>è¿™äº›å¼€é”€éƒ½æ˜¯å€¼å¾—çš„ï¼Œå®ƒä»¬ä¿è¯äº†OSçš„æ“ä½œå®‰å…¨ã€å¯é ï¼</p><h2 id="Chapter3-è¿ç»­å¼å†…å­˜åˆ†é…"><a href="#Chapter3-è¿ç»­å¼å†…å­˜åˆ†é…" class="headerlink" title="Chapter3 è¿ç»­å¼å†…å­˜åˆ†é…"></a>Chapter3 è¿ç»­å¼å†…å­˜åˆ†é…</h2><h3 id="è®¡ç®—æœºä½“ç³»ç»“æ„åŠå†…å­˜åˆ†å±‚ä½“ç³»"><a href="#è®¡ç®—æœºä½“ç³»ç»“æ„åŠå†…å­˜åˆ†å±‚ä½“ç³»" class="headerlink" title="è®¡ç®—æœºä½“ç³»ç»“æ„åŠå†…å­˜åˆ†å±‚ä½“ç³»"></a>è®¡ç®—æœºä½“ç³»ç»“æ„åŠå†…å­˜åˆ†å±‚ä½“ç³»</h3><p>åˆ†å±‚â€¦â€¦è®¡ç»„é‡Œéƒ½å­¦è¿‡</p><h4 id="æ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†æ–¹é¢çš„å››ä¸ªç›®æ ‡"><a href="#æ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†æ–¹é¢çš„å››ä¸ªç›®æ ‡" class="headerlink" title="æ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†æ–¹é¢çš„å››ä¸ªç›®æ ‡"></a>æ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†æ–¹é¢çš„å››ä¸ªç›®æ ‡</h4><ul><li>æŠ½è±¡<ul><li>é€»è¾‘åœ°å€ç©ºé—´</li></ul></li><li>ä¿æŠ¤<ul><li>ç‹¬ç«‹åœ°å€ç©ºé—´</li></ul></li><li>å…±äº«<ul><li>è®¿é—®ç›¸åŒå†…å­˜</li></ul></li><li>è™šæ‹ŸåŒ–<ul><li>æ›´å¤šçš„åœ°å€ç©ºé—´</li></ul></li></ul><h3 id="åœ°å€ç©ºé—´ä¸åœ°å€ç”Ÿæˆ"><a href="#åœ°å€ç©ºé—´ä¸åœ°å€ç”Ÿæˆ" class="headerlink" title="åœ°å€ç©ºé—´ä¸åœ°å€ç”Ÿæˆ"></a>åœ°å€ç©ºé—´ä¸åœ°å€ç”Ÿæˆ</h3><h4 id="1-åœ°å€ç©ºé—´å®šä¹‰"><a href="#1-åœ°å€ç©ºé—´å®šä¹‰" class="headerlink" title="1.åœ°å€ç©ºé—´å®šä¹‰"></a>1.åœ°å€ç©ºé—´å®šä¹‰</h4><p>â€‹ç‰©ç†åœ°å€ç©ºé—´ï¼šç¡¬ä»¶æ”¯æŒçš„åœ°å€ç©ºé—´</p><p>â€‹é€»è¾‘åœ°å€ç©ºé—´ï¼šä¸€ä¸ªè¿è¡Œçš„ç¨‹åºæ‰€æ‹¥æœ‰çš„å†…å­˜èŒƒå›´</p><h4 id="2-åœ°å€ç”Ÿæˆ"><a href="#2-åœ°å€ç”Ÿæˆ" class="headerlink" title="2.åœ°å€ç”Ÿæˆ"></a>2.åœ°å€ç”Ÿæˆ</h4><p>â€‹é€»è¾‘åœ°å€ç”Ÿæˆï¼šä»å˜é‡çš„ç¬¦å·ï¼Œé€šè¿‡ä¸€ç³»åˆ—æ“ä½œ(ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æ¥ã€è½½å…¥)å˜ä¸ºé€»è¾‘åœ°å€</p><p>â€‹ç‰©ç†åœ°å€ç”Ÿæˆï¼šå·²çŸ¥é€»è¾‘åœ°å€ï¼Œé€šè¿‡ç¡¬ä»¶MMUå°†é€»è¾‘åœ°å€æ˜ å°„åˆ°ç‰©ç†åœ°å€</p><h4 id="3-åœ°å€å®‰å…¨æ£€æŸ¥"><a href="#3-åœ°å€å®‰å…¨æ£€æŸ¥" class="headerlink" title="3.åœ°å€å®‰å…¨æ£€æŸ¥"></a>3.åœ°å€å®‰å…¨æ£€æŸ¥</h4><p>â€‹OSè®°å½•æ¯ä¸€ä¸ªç¨‹åºèƒ½å¤Ÿè®¿é—®çš„åœ°å€ç©ºé—´(å¼€å§‹ä½ç½®å’Œå¤§å°)</p><p>â€‹è¿™ä¸ªè¡¨ç”±OSç»´æŠ¤ï¼ŒCPUè¦æ‰§è¡ŒæŸä¸ªç¨‹åºæ—¶ï¼ŒOSæ£€æŸ¥è¯¥ç¨‹åºçš„åœ°å€æ˜¯å¦æ»¡è¶³è¡¨ä¸­çš„é™åˆ¶(ä¸ä¸å·²å ç”¨ç©ºé—´å†²çª)ï¼Œèƒ½æ»¡è¶³åˆ™æ­£å¸¸æ‰§è¡Œï¼›å¦åˆ™CPUäº§ç”Ÿå†…å­˜è®¿é—®å¼‚å¸¸ï¼Œè®©OSè¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚</p><h3 id="è¿ç»­å†…å­˜åˆ†é…ï¼šå†…å­˜ç¢ç‰‡ä¸åˆ†åŒºçš„åŠ¨æ€åˆ†é…"><a href="#è¿ç»­å†…å­˜åˆ†é…ï¼šå†…å­˜ç¢ç‰‡ä¸åˆ†åŒºçš„åŠ¨æ€åˆ†é…" class="headerlink" title="è¿ç»­å†…å­˜åˆ†é…ï¼šå†…å­˜ç¢ç‰‡ä¸åˆ†åŒºçš„åŠ¨æ€åˆ†é…"></a>è¿ç»­å†…å­˜åˆ†é…ï¼šå†…å­˜ç¢ç‰‡ä¸åˆ†åŒºçš„åŠ¨æ€åˆ†é…</h3><h4 id="å†…å­˜ç¢ç‰‡é—®é¢˜"><a href="#å†…å­˜ç¢ç‰‡é—®é¢˜" class="headerlink" title="å†…å­˜ç¢ç‰‡é—®é¢˜"></a>å†…å­˜ç¢ç‰‡é—®é¢˜</h4><p>ç©ºé—²å†…å­˜ä¸èƒ½è¢«åˆ©ç”¨</p><ul><li>å¤–éƒ¨ç¢ç‰‡</li></ul><p>åœ¨**åˆ†é…å•å…ƒ<u>é—´</u>**çš„æœªä½¿ç”¨å†…å­˜</p><ul><li>å†…éƒ¨ç¢ç‰‡</li></ul><p>åœ¨**åˆ†é…å•å…ƒ<u>ä¸­</u>**çš„æœªä½¿ç”¨å†…å­˜</p><h4 id="åˆ†åŒºçš„åŠ¨æ€åˆ†é…"><a href="#åˆ†åŒºçš„åŠ¨æ€åˆ†é…" class="headerlink" title="åˆ†åŒºçš„åŠ¨æ€åˆ†é…"></a>åˆ†åŒºçš„åŠ¨æ€åˆ†é…</h4><h5 id="å¸¸è§åˆ†é…ç­–ç•¥"><a href="#å¸¸è§åˆ†é…ç­–ç•¥" class="headerlink" title="å¸¸è§åˆ†é…ç­–ç•¥"></a>å¸¸è§åˆ†é…ç­–ç•¥</h5><h6 id="ç¬¬ä¸€é€‚é…"><a href="#ç¬¬ä¸€é€‚é…" class="headerlink" title="ç¬¬ä¸€é€‚é…"></a>ç¬¬ä¸€é€‚é…</h6><p>â€‹æ”¾åœ¨<strong>ç¬¬ä¸€ä¸ª</strong>èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚çš„ç©ºé—²å—ä¸­</p><p>â€‹<strong>ç®€å•å®ç°ï¼š</strong></p><ul><li>å¯¹ç©ºé—²å—åˆ—è¡¨æŒ‰åœ°å€æ’åº</li><li>åˆ†é…åˆ°ç¬¬ä¸€ä¸ªåˆé€‚çš„åˆ†åŒº</li><li>å›æ”¶æ—¶è¿›è¡Œæ£€æŸ¥ï¼Œçœ‹çœ‹è‡ªç”±åˆ†åŒºèƒ½ä¸èƒ½ä¸ç›¸é‚»çš„ç©ºé—²åˆ†åŒºåˆå¹¶<ul><li>ç¼ºç‚¹ï¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡ã€ä¸ç¡®å®šæ€§</li></ul></li></ul><h6 id="æœ€ä½³é€‚é…"><a href="#æœ€ä½³é€‚é…" class="headerlink" title="æœ€ä½³é€‚é…"></a>æœ€ä½³é€‚é…</h6><p>â€‹åœ¨èƒ½æ”¾ä¸‹ç©ºé—²å—çš„åˆ†åŒºä¸­ï¼Œå¯»æ‰¾<strong>æœ€å°</strong>çš„åˆ†åŒºï¼ˆé¿å…äº†åˆ†å‰²å¤§ç©ºé—²å—ï¼Œä¸ºäº†æœ€å°åŒ–å¤–éƒ¨ç¢ç‰‡äº§ç”Ÿçš„å°ºå¯¸ï¼‰</p><p>â€‹<strong>ç®€å•å®ç°ï¼š</strong></p><ul><li>æŒ‰å°ºå¯¸æ’åˆ—ç©ºé—²å—åˆ—è¡¨</li><li>åˆ†é…æ—¶éœ€è¦å¯»æ‰¾æœ€åˆé€‚çš„åˆ†åŒº</li><li>å›æ”¶æ—¶è¿›è¡Œæ£€æŸ¥ï¼Œçœ‹çœ‹è‡ªç”±åˆ†åŒºèƒ½ä¸èƒ½ä¸ç›¸é‚»çš„ç©ºé—²åˆ†åŒºåˆå¹¶<ul><li>ä¼˜åŠ¿ï¼šå½“å¤§éƒ¨åˆ†åˆ†é…æ˜¯å°å°ºå¯¸æ—¶ååˆ†æœ‰æ•ˆ</li><li>åŠ£åŠ¿ï¼šä¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡ï¼Œé‡åˆ†é…(å›æ”¶)æ…¢ï¼Œå®¹æ˜“äº§ç”Ÿå¾ˆå¤šå¾ˆå°çš„å†…éƒ¨ç¢ç‰‡</li></ul></li></ul><p></p><h6 id="æœ€å·®é€‚é…"><a href="#æœ€å·®é€‚é…" class="headerlink" title="æœ€å·®é€‚é…"></a>æœ€å·®é€‚é…</h6><p>â€‹åœ¨èƒ½æ”¾ä¸‹ç©ºé—²å—çš„åˆ†åŒºä¸­ï¼Œå¯»æ‰¾<strong>æœ€å¤§</strong>çš„åˆ†åŒºï¼ˆä¸ºäº†é¿å…æœ‰å¤ªå¤šå¾®å°çš„ç¢ç‰‡ï¼‰</p><p>â€‹<strong>ç®€å•å®ç°ï¼š</strong></p><ul><li>æŒ‰å°ºå¯¸æ’åˆ—ç©ºé—²å—åˆ—è¡¨(ä»å¤§åˆ°å°)</li><li>åˆ†é…æ—¶éœ€è¦å¯»æ‰¾æœ€åˆé€‚çš„åˆ†åŒº(æ‰¾æœ€å¤§çš„ï¼Œæ‰€ä»¥æ‰¾éå¸¸å¿«)</li><li>å›æ”¶æ—¶è¿›è¡Œæ£€æŸ¥ï¼Œçœ‹çœ‹è‡ªç”±åˆ†åŒºèƒ½ä¸èƒ½ä¸ç›¸é‚»çš„ç©ºé—²åˆ†åŒºåˆå¹¶<ul><li>ä¼˜åŠ¿ï¼šåˆ†é…ä¸­ç­‰å¤§å°çš„å—æ•ˆæœæœ€å¥½</li><li>åŠ£åŠ¿ï¼šé‡åˆ†é…æ…¢ã€å¤–éƒ¨ç¢ç‰‡ã€æ¯æ¬¡éƒ½ä½¿ç”¨å¤§ç©ºé—²å—å¯èƒ½å¯¼è‡´å¤§åˆ†åŒºæ— æ³•è¢«åˆ†é…</li></ul></li></ul><h4 id="å‹ç¼©å¼ç¢ç‰‡æ•´ç†"><a href="#å‹ç¼©å¼ç¢ç‰‡æ•´ç†" class="headerlink" title="å‹ç¼©å¼ç¢ç‰‡æ•´ç†"></a>å‹ç¼©å¼ç¢ç‰‡æ•´ç†</h4><p>â€‹åœ¨ç¨‹åºå¤„äºç­‰å¾…çŠ¶æ€æ—¶ï¼Œå°†å…¶è¿›è¡Œç§»åŠ¨ï¼Œä»è€Œæ¶ˆé™¤å¤–éƒ¨ç¢ç‰‡â€”â€”â€”â€”ç›®çš„æ˜¯æ¶ˆé™¤å¤–éƒ¨ç¢ç‰‡</p><h4 id="äº¤æ¢å¼ç¢ç‰‡æ•´ç†"><a href="#äº¤æ¢å¼ç¢ç‰‡æ•´ç†" class="headerlink" title="äº¤æ¢å¼ç¢ç‰‡æ•´ç†"></a>äº¤æ¢å¼ç¢ç‰‡æ•´ç†</h4><p>â€‹å¦‚æœè¿è¡Œä¸­çš„ç¨‹åºéœ€è¦æ¯”è¾ƒå¤§çš„å†…å­˜ç©ºé—´ï¼Œé‚£ä¹ˆå¯ä»¥è®©å®ƒ<u>æŠ¢å ç­‰å¾…ä¸­çš„ç¨‹åºçš„å†…å­˜ç©ºé—´(</u>å…ˆå°†å ç”¨äº†å†…å­˜ç©ºé—´çš„ç­‰å¾…ä¸­çš„ç¨‹åºè½¬å­˜åˆ°ç¡¬ç›˜ä¸­)</p><p>â€‹é—®é¢˜ï¼šå°†å“ªä¸ªç­‰å¾…ä¸­çš„ç¨‹åºæ¢å‡ºå‘¢ï¼Ÿä»€ä¹ˆæ—¶å€™æ‰§è¡Œæ¢å…¥ã€æ¢å‡ºçš„æ“ä½œå‘¢ï¼Ÿ</p><h2 id="Chapter4-éè¿ç»­å¼å†…å­˜åˆ†é…"><a href="#Chapter4-éè¿ç»­å¼å†…å­˜åˆ†é…" class="headerlink" title="Chapter4 éè¿ç»­å¼å†…å­˜åˆ†é…"></a>Chapter4 éè¿ç»­å¼å†…å­˜åˆ†é…</h2><h3 id="è¿ç»­å†…å­˜åˆ†é…çš„ç¼ºç‚¹ï¼š"><a href="#è¿ç»­å†…å­˜åˆ†é…çš„ç¼ºç‚¹ï¼š" class="headerlink" title="è¿ç»­å†…å­˜åˆ†é…çš„ç¼ºç‚¹ï¼š"></a>è¿ç»­å†…å­˜åˆ†é…çš„ç¼ºç‚¹ï¼š</h3><p>â€‹åˆ†é…ç»™ä¸€ä¸ªç¨‹åºçš„ç‰©ç†å†…å­˜æ˜¯è¿ç»­çš„ã€å†…å­˜åˆ©ç”¨ç‡è¾ƒä½ã€æœ‰å¤–ã€å†…éƒ¨ç¢ç‰‡çš„é—®é¢˜</p><h3 id="éè¿ç»­å†…å­˜åˆ†é…çš„ä¼˜ç‚¹ï¼š"><a href="#éè¿ç»­å†…å­˜åˆ†é…çš„ä¼˜ç‚¹ï¼š" class="headerlink" title="éè¿ç»­å†…å­˜åˆ†é…çš„ä¼˜ç‚¹ï¼š"></a>éè¿ç»­å†…å­˜åˆ†é…çš„ä¼˜ç‚¹ï¼š</h3><ul><li>æ›´å¥½çš„å†…å­˜åˆ©ç”¨å’Œç®¡ç†</li><li>å…è®¸å…±äº«ä»£ç ä¸æ•°æ®</li><li>æ”¯æŒåŠ¨æ€åŠ è½½å’ŒåŠ¨æ€é“¾æ¥</li></ul><h3 id="éè¿ç»­å†…å­˜åˆ†é…çš„ç¼ºç‚¹ï¼š"><a href="#éè¿ç»­å†…å­˜åˆ†é…çš„ç¼ºç‚¹ï¼š" class="headerlink" title="éè¿ç»­å†…å­˜åˆ†é…çš„ç¼ºç‚¹ï¼š"></a>éè¿ç»­å†…å­˜åˆ†é…çš„ç¼ºç‚¹ï¼š</h3><ul><li>å¦‚ä½•å»ºç«‹è™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€ä¹‹é—´çš„è”ç³»<ul><li>ç¡¬ä»¶æ–¹æ¡ˆ<ul><li>åˆ†æ®µ(åˆ†æ®µå’Œåˆ†é¡µçš„åŒºåˆ«ï¼šæ®µçš„å¤§å°å¯ä»¥æ”¹å˜ã€é¡µçš„å¤§å°æ˜¯å›ºå®šçš„)</li><li>åˆ†é¡µ</li></ul></li><li>è½¯ä»¶æ–¹æ¡ˆ(å¼€é”€å¤§ï¼Œä¸å±•å¼€è®¨è®º)</li></ul></li></ul><h3 id="åˆ†æ®µ"><a href="#åˆ†æ®µ" class="headerlink" title="åˆ†æ®µ"></a>åˆ†æ®µ</h3><h4 id="ç¨‹åºçš„åˆ†æ®µåœ°å€ç©ºé—´"><a href="#ç¨‹åºçš„åˆ†æ®µåœ°å€ç©ºé—´" class="headerlink" title="ç¨‹åºçš„åˆ†æ®µåœ°å€ç©ºé—´"></a>ç¨‹åºçš„åˆ†æ®µåœ°å€ç©ºé—´</h4><p>â€‹æœ‰å †ã€æ ˆã€å„ç§éƒ¨åˆ†  é€»è¾‘ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œä½†å®é™…ä¸Šç‰©ç†åœ°å€ç©ºé—´æ¯«æ— å…³è”(è·Ÿåˆ†é…ç­–ç•¥æœ‰å…³)</p><h4 id="åˆ†æ®µå¯»å€æ–¹æ¡ˆ"><a href="#åˆ†æ®µå¯»å€æ–¹æ¡ˆ" class="headerlink" title="åˆ†æ®µå¯»å€æ–¹æ¡ˆ"></a>åˆ†æ®µå¯»å€æ–¹æ¡ˆ</h4><h5 id="æ®µè®¿é—®æœºåˆ¶ï¼š"><a href="#æ®µè®¿é—®æœºåˆ¶ï¼š" class="headerlink" title="æ®µè®¿é—®æœºåˆ¶ï¼š"></a>æ®µè®¿é—®æœºåˆ¶ï¼š</h5><p>â€‹s + addr ï¼ˆæ®µå· + æ®µå†…åç§»ï¼‰å¤šåœ°å€ç©ºé—´</p><p>â€‹sä¸addrä¸€èµ·å­˜ å•åœ°å€ç©ºé—´</p><p>â€‹sé€šè¿‡ <strong>segment table(æ®µè¡¨)</strong> æ ¹æ®æ®µå· æŸ¥è¯¢ æ®µæ‰€å¯¹åº”çš„ç‰©ç†åœ°å€ï¼Œå†åŠ ä¸Šåç§»é‡å°± &#x3D; ç‰©ç†åœ°å€æ®µè¡¨ç”±OSå»ºç«‹</p><h3 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h3><ul><li>é€»è¾‘ç©ºé—´ï¼šé¡µç‰©ç†é¡µé¢ï¼šå¸§</li><li>ç‰©ç†å†…å­˜è¢«åˆ†æˆå¤§å°ç›¸åŒçš„å¸§</li></ul><p>ä¸€ä¸ªç¨‹åºçš„é€»è¾‘åœ°å€ç©ºé—´è¢«åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„é¡µ</p><p>â€‹<strong>ğŸŒŸ(é¡µå†…åç§»å¤§å°&#x3D;å¸§å†…åç§»å¤§å°ï¼›é¡µå·å¤§å° !&#x3D; å¸§å·å¤§å°{åœ¨é¡µè¡¨ä¸­ï¼Œé€šè¿‡é¡µå·å¾—åˆ°å¸§å·})</strong></p><ul><li>é¡µæ˜ å°„åˆ°å¸§</li><li>é¡µæ˜¯è¿ç»­çš„è™šæ‹Ÿå†…å­˜</li><li>å¸§æ˜¯éè¿ç»­çš„ç‰©ç†å†…å­˜</li><li>ä¸æ˜¯æ‰€æœ‰çš„é¡µéƒ½æœ‰å¯¹åº”çš„å¸§</li></ul><h4 id="åˆ†é¡µåœ°å€ç©ºé—´"><a href="#åˆ†é¡µåœ°å€ç©ºé—´" class="headerlink" title="åˆ†é¡µåœ°å€ç©ºé—´"></a>åˆ†é¡µåœ°å€ç©ºé—´</h4><p>â€‹å¸§çš„ç‰©ç†åœ°å€&#x3D;å¸§å· + å¸§å†…åç§»</p><h4 id="é¡µå¯»å€æ–¹æ¡ˆâ€”â€”é¡µè¡¨"><a href="#é¡µå¯»å€æ–¹æ¡ˆâ€”â€”é¡µè¡¨" class="headerlink" title="é¡µå¯»å€æ–¹æ¡ˆâ€”â€”é¡µè¡¨"></a>é¡µå¯»å€æ–¹æ¡ˆâ€”â€”é¡µè¡¨</h4><h5 id="åˆ†é¡µæœºåˆ¶æ€§èƒ½é—®é¢˜ï¼š"><a href="#åˆ†é¡µæœºåˆ¶æ€§èƒ½é—®é¢˜ï¼š" class="headerlink" title="åˆ†é¡µæœºåˆ¶æ€§èƒ½é—®é¢˜ï¼š"></a>åˆ†é¡µæœºåˆ¶æ€§èƒ½é—®é¢˜ï¼š</h5><h6 id="è®¿é—®ä¸€ä¸ªå†…å­˜å•å…ƒéœ€è¦2æ¬¡å†…å­˜è®¿é—®"><a href="#è®¿é—®ä¸€ä¸ªå†…å­˜å•å…ƒéœ€è¦2æ¬¡å†…å­˜è®¿é—®" class="headerlink" title="è®¿é—®ä¸€ä¸ªå†…å­˜å•å…ƒéœ€è¦2æ¬¡å†…å­˜è®¿é—®"></a>è®¿é—®ä¸€ä¸ªå†…å­˜å•å…ƒéœ€è¦2æ¬¡å†…å­˜è®¿é—®</h6><p>â€‹        1.ç”¨äºè·å–é¡µè¡¨é¡¹</p><p>â€‹2.æ ¹æ®è·å¾—çš„é¡µè¡¨é¡¹è®¿é—®æ•°æ®</p><h6 id="é¡µè¡¨å¯èƒ½éå¸¸å¤§"><a href="#é¡µè¡¨å¯èƒ½éå¸¸å¤§" class="headerlink" title="é¡µè¡¨å¯èƒ½éå¸¸å¤§"></a>é¡µè¡¨å¯èƒ½éå¸¸å¤§</h6><h5 id="å¦‚ä½•è§£å†³ï¼Ÿ"><a href="#å¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="å¦‚ä½•è§£å†³ï¼Ÿ"></a>å¦‚ä½•è§£å†³ï¼Ÿ</h5><h6 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h6><p>â€‹TLBï¼šç¼“å­˜è¿‘æœŸè®¿é—®çš„é¡µ-å¸§è½¬æ¢è¡¨é¡¹(TLBå­˜äºCacheä¸­)</p><h6 id="é—´æ¥è®¿é—®"><a href="#é—´æ¥è®¿é—®" class="headerlink" title="é—´æ¥è®¿é—®"></a>é—´æ¥è®¿é—®</h6><p>â€‹äºŒçº§ã€å¤šçº§é¡µè¡¨ï¼šå¤šæ¬¡å¯»å€é€Ÿåº¦é™ä½ï¼Œä½†æ˜¯ç¼©å‡äº†é¡µè¡¨(æ—¶é—´æ¢ç©ºé—´ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡TLBæé€Ÿï¼)</p><h6 id="åå‘é¡µè¡¨-è¯´å®è¯æ²¡å¬æ˜ç™½ï¼Œå…ˆæŒ–ä¸ªå‘ï¼Œå›é¡¾æ—¶å¡«ä¸Š"><a href="#åå‘é¡µè¡¨-è¯´å®è¯æ²¡å¬æ˜ç™½ï¼Œå…ˆæŒ–ä¸ªå‘ï¼Œå›é¡¾æ—¶å¡«ä¸Š" class="headerlink" title="åå‘é¡µè¡¨(è¯´å®è¯æ²¡å¬æ˜ç™½ï¼Œå…ˆæŒ–ä¸ªå‘ï¼Œå›é¡¾æ—¶å¡«ä¸Š)"></a><u>åå‘</u>é¡µè¡¨(è¯´å®è¯æ²¡å¬æ˜ç™½ï¼Œå…ˆæŒ–ä¸ªå‘ï¼Œå›é¡¾æ—¶å¡«ä¸Š)</h6><p>â€‹ç¨‹åºçš„åœ°å€ç©ºé—´å¾ˆå¤§æ—¶ï¼Œé€»è¾‘åœ°å€ç©ºé—´ä¼šå¤§äºå†…å­˜çš„ç‰©ç†åœ°å€ç©ºé—´</p><p>â€‹è¿™æ—¶ æˆ‘ä»¬<u>ä¸æ˜¯è®©é¡µè¡¨ä¸é€»è¾‘åœ°å€ç©ºé—´çš„å¤§å°ç›¸å¯¹åº”</u>ï¼Œè€Œæ˜¯<strong>è®©é¡µè¡¨ä¸ç‰©ç†åœ°å€ç©ºé—´çš„å¤§å°ç›¸å¯¹åº”</strong></p><p>â€‹åˆ©ï¼š</p><ul><li><p>è½¬æ¢è¡¨çš„å¤§å°ç›¸å¯¹äºç‰©ç†å†…å­˜æ¥è¯´å¾ˆå°</p></li><li><p>è½¬æ¢è¡¨çš„å¤§å°è·Ÿé€»è¾‘åœ°å€ç©ºé—´çš„å¤§å°æ— å…³</p><p>å¼Šï¼š</p></li><li><p>éœ€è¦çš„ä¿¡æ¯å¯¹è°ƒäº†ï¼Œå³ç°åœ¨åªèƒ½æ ¹æ®å¸§å·æ‰¾åˆ°é¡µå·</p></li><li><p>å¦‚ä½•è½¬æ¢å›æ¥ï¼Ÿå³å¦‚ä½•æ ¹æ®é¡µå·æ‰¾åˆ°å¸§å·ï¼Ÿ</p></li><li><p>éœ€è¦åœ¨åå‘é¡µè¡¨ä¸­æœç´¢æƒ³è¦çš„é¡µå·</p></li></ul><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*å¦‚ä½•å®ç°å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment">*å¯¹é¡µå·åšhashè®¡ç®—ï¼Œä¸ºäº†åœ¨â€œå¸§è¡¨â€ä¸­è·å–å¯¹åº”çš„å¸§å·</span></span><br><span class="line"><span class="comment">*é¡µiè¢«æ”¾ç½®åœ¨â€œå¸§è¡¨â€ä¸­f(i)çš„ä½ç½® #fä¸ºhashå‡½æ•°</span></span><br><span class="line"><span class="comment">*ä¸ºäº†æŸ¥æ‰¾é¡µiï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</span></span><br><span class="line"><span class="comment">*å¯¹äºé¡µiï¼Œè®¡ç®—f(i)å¹¶ä½¿ç”¨å®ƒä½œä¸ºé¡µå¯„å­˜å™¨è¡¨çš„ç´¢å¼•ï¼Œè·å–å¯¹åº”çš„é¡µå¯„å­˜å™¨</span></span><br><span class="line"><span class="comment">*æ£€æŸ¥å¯„å­˜å™¨æ ‡ç­¾æ˜¯å¦åŒ…å«iï¼Œå¦‚æœåŒ…å«ï¼Œåˆ™ä»£è¡¨æˆåŠŸè·å–å¸§å·ï¼Œå¦åˆ™å¤±è´¥ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="Chapter5-è™šæ‹Ÿå†…å­˜"><a href="#Chapter5-è™šæ‹Ÿå†…å­˜" class="headerlink" title="Chapter5 è™šæ‹Ÿå†…å­˜"></a>Chapter5 è™šæ‹Ÿå†…å­˜</h2><h3 id="è¦†ç›–æŠ€æœ¯ï¼š"><a href="#è¦†ç›–æŠ€æœ¯ï¼š" class="headerlink" title="è¦†ç›–æŠ€æœ¯ï¼š"></a>è¦†ç›–æŠ€æœ¯ï¼š</h3><p>â€‹ä¸ºäº†åœ¨è¾ƒå°çš„å†…å­˜ä¸­è¿è¡Œè¾ƒå¤§çš„ç¨‹åºï¼Œå¸¸ç”¨äºå¤šé“ç¨‹åºç³»ç»Ÿï¼Œä¸åˆ†åŒºå­˜å‚¨ç®¡ç†é…åˆä½¿ç”¨</p><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†:"></a>åŸç†:</h4><p>ç›®æ ‡ï¼šæŠŠç¨‹åºæŒ‰ç…§å…¶è‡ªèº«é€»è¾‘ç»“æ„ï¼Œåˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªåŠŸèƒ½ä¸Šç›¸å¯¹ç‹¬ç«‹çš„ç¨‹åºæ¨¡å—é‚£äº›ä¸ä¼šåŒæ—¶æ‰§è¡Œçš„æ¨¡å—å…±äº«åŒä¸€å—å†…å­˜åŒºåŸŸï¼ŒæŒ‰æ—¶é—´å…ˆåæ¥è¿è¡Œã€‚</p><ul><li><p>å¿…è¦éƒ¨åˆ† (å¸¸ç”¨åŠŸèƒ½)çš„ä»£ç å’Œæ•°æ®<strong>å¸¸é©»å†…å­˜</strong></p></li><li><p>å¯é€‰éƒ¨åˆ†(ä¸å¸¸ç”¨åŠŸèƒ½)åœ¨å…¶ä»–ç¨‹åºæ¨¡å—ä¸­å®ç°,<u><em>å¹³æ—¶å­˜æ”¾åœ¨å¤–å­˜ä¸­ï¼Œåœ¨éœ€è¦ç”¨åˆ°æ—¶æ‰è£…å…¥å†…å­˜</em></u>;</p><ul><li>ä¸å­˜åœ¨è°ƒç”¨å…³ç³»çš„æ¨¡å—ä¸å¿…åŒæ—¶è£…å…¥åˆ°å†…å­˜ï¼Œä»è€Œå¯ä»¥ç›¸äº’è¦†ç›–,å³è¿™äº›æ¨¡å—å…±ç”¨ä¸€ä¸ªåˆ†åŒºã€‚</li></ul></li></ul><h4 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h4><ul><li>ç¨‹åºçš„åˆ’åˆ†å¤æ‚ï¼Œè´¹æ—¶è´¹åŠ›</li><li>ç»å¸¸æ€§çš„ä»å¤–å­˜è¯»å–æ•°æ®ï¼Œå®é™…ä¸Šæ˜¯æ—¶é—´æ¢ç©ºé—´</li><li>éœ€è¦ç¨‹åºå‘˜è‡ªå·±æŠŠæ•´ä¸ªç¨‹åºåˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå°çš„åŠŸèƒ½æ¨¡å—ï¼Œå¹¶ç¡®å®šå„ä¸ªæ¨¡å—ä¹‹é—´çš„è¦†ç›–å…³ç³»ï¼Œå¢åŠ äº†ç¨‹åºå‘˜çš„è´Ÿæ‹…;</li></ul><h3 id="äº¤æ¢æŠ€æœ¯ï¼š"><a href="#äº¤æ¢æŠ€æœ¯ï¼š" class="headerlink" title="äº¤æ¢æŠ€æœ¯ï¼š"></a>äº¤æ¢æŠ€æœ¯ï¼š</h3><p>â€‹å¤šé“ç¨‹åºåœ¨å†…å­˜ä¸­æ—¶,è®©æ­£åœ¨è¿è¡Œçš„ç¨‹åºæˆ–éœ€è¦è¿è¡Œçš„ç¨‹åºè·å¾—æ›´å¤šçš„å†…å­˜èµ„æºã€‚</p><h4 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†:"></a>åŸç†:</h4><ul><li>â€‹å¯å°†æš‚æ—¶ä¸èƒ½è¿è¡Œçš„ç¨‹åºé€åˆ°å¤–å­˜ï¼Œä»è€Œè·å¾—ç©ºé—²å†…å­˜ç©ºé—´ã€‚</li><li>â€‹æ“ä½œç³»ç»ŸæŠŠä¸€ä¸ªè¿›ç¨‹çš„æ•´ä¸ªåœ°å€ç©ºé—´çš„å†…å®¹ä¿å­˜åˆ°å¤–å­˜ä¸­(æ¢å‡ºswap out)ï¼Œè€Œå°†å¤–å­˜ä¸­çš„æŸä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´è¯»å…¥åˆ°å†…å­˜ä¸­(æ¢å…¥swap in)ã€‚æ¢å…¥æ¢å‡ºå†…å®¹çš„å¤§å°ä¸ºæ•´ä¸ªç¨‹åºçš„åœ°å€ç©ºé—´ã€‚</li></ul><p></p><h4 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h4><ul><li>ä½•æ—¶äº¤æ¢ï¼Ÿ<ul><li>åªæœ‰å½“å†…å­˜ä¸å¤Ÿæˆ–è€…æœ‰ä¸å¤Ÿçš„é£é™©æ—¶è¿›è¡Œäº¤æ¢</li></ul></li><li>äº¤æ¢åŒºçš„å¤§å°<ul><li>å¿…é¡»è¶³å¤Ÿå­˜æ”¾ç”¨æˆ·è¿›ç¨‹ä¸­æ‰€æœ‰å†…å­˜æ˜ åƒçš„æ‹·è´</li><li>å¿…é¡»èƒ½å¯¹è¿™äº›å†…å­˜æ˜ åƒè¿›è¡Œç›´æ¥å­˜å–</li></ul></li><li>äº¤æ¢æŠ€æœ¯:ä»¥è¿›ç¨‹ä½œä¸ºäº¤æ¢çš„å•ä½ï¼Œéœ€è¦æŠŠè¿›ç¨‹çš„æ•´ä¸ªåœ°å€ç©ºé—´éƒ½æ¢è¿›æ¢å‡ºï¼Œå¢åŠ äº†å¤„ç†å™¨çš„å¼€é”€ã€‚</li></ul><h3 id="è¦†ç›–ä¸äº¤æ¢çš„æ¯”è¾ƒï¼š"><a href="#è¦†ç›–ä¸äº¤æ¢çš„æ¯”è¾ƒï¼š" class="headerlink" title="è¦†ç›–ä¸äº¤æ¢çš„æ¯”è¾ƒï¼š"></a>è¦†ç›–ä¸äº¤æ¢çš„æ¯”è¾ƒï¼š</h3><p><strong>è¦†ç›–æŠ€æœ¯</strong>åªèƒ½å‘ç”Ÿåœ¨é‚£äº›ç›¸äº’ä¹‹é—´æ²¡æœ‰è°ƒç”¨å…³ç³»çš„ç¨‹åºæ¨¡å—ä¹‹é—´ã€‚å› æ­¤ç¨‹åºå‘˜å¿…é¡»ç»™å‡ºç¨‹åºå†…çš„å„ä¸ªæ¨¡å—ä¹‹é—´çš„é€»è¾‘è¦†ç›–ç»“æ„ã€‚(ç§»åŠ¨çš„æœ€å°ç²’åº¦ä¸ºä¸€ä¸ªç¨‹åº)</p><p><strong>äº¤æ¢æŠ€æœ¯</strong>æ˜¯ä»¥åœ¨å†…å­˜ä¸­çš„ç¨‹åºå¤§å°ä¸ºå•ä½æ¥è¿›è¡Œçš„ï¼Œå®ƒä¸éœ€è¦ç¨‹åºå‘˜ç»™å‡ºå„ä¸ªæ¨¡å—ä¹‹é—´çš„é€»è¾‘è¦†ç›–ç»“æ„ã€‚(ç§»åŠ¨çš„æœ€å°ç²’åº¦ä¸ºç¨‹åºçš„ä¸€ä¸ªå­æ¨¡å—)</p><p>æ¢è¨€ä¹‹ï¼Œäº¤æ¢å‘ç”Ÿåœ¨å†…å­˜ä¸­ç¨‹åºä¸ç®¡ç†ç¨‹åºæˆ–æ“ä½œç³»ç»Ÿä¹‹é—´ï¼Œè€Œè¦†ç›–åˆ™å‘ç”Ÿåœ¨è¿è¡Œç¨‹åºçš„å†…éƒ¨ã€‚</p><h3 id="è™šå­˜æŠ€æœ¯ï¼š"><a href="#è™šå­˜æŠ€æœ¯ï¼š" class="headerlink" title="è™šå­˜æŠ€æœ¯ï¼š"></a>è™šå­˜æŠ€æœ¯ï¼š</h3><p>åƒè¦†ç›–æŠ€æœ¯é‚£æ ·ï¼Œ<u>ä¸æ˜¯æŠŠç¨‹åºçš„æ‰€æœ‰å†…å®¹éƒ½æ”¾åœ¨å†…å­˜ä¸­</u>ï¼Œå› è€Œèƒ½å¤Ÿè¿è¡Œæ¯”å½“å‰çš„ç©ºé—²å†…å­˜ç©ºé—´è¿˜è¦å¤§çš„ç¨‹åºã€‚ä½†åšå¾—æ›´å¥½ï¼Œç”±<u>æ“ä½œç³»ç»Ÿè‡ªåŠ¨æ¥å®Œæˆï¼Œæ— é¡»ç¨‹åºå‘˜çš„å¹²æ¶‰;</u></p><p>åƒäº¤æ¢æŠ€æœ¯é‚£æ ·ï¼Œèƒ½å¤Ÿå®ç°è¿›ç¨‹åœ¨å†…å­˜ä¸å¤–å­˜ä¹‹é—´çš„äº¤æ¢ï¼Œå› è€Œè·å¾—æ›´å¤šçš„ç©ºé—²å†…å­˜ç©ºé—´ã€‚ä½†åšå¾—æ›´å¥½ï¼Œ<u>åªå¯¹è¿›ç¨‹çš„éƒ¨åˆ†å†…å®¹åœ¨å†…å­˜å’Œå¤–å­˜ä¹‹é—´è¿›è¡Œäº¤æ¢ã€‚</u></p><h4 id="ç¨‹åºçš„å±€éƒ¨æ€§åŸç†-principle-of-locality"><a href="#ç¨‹åºçš„å±€éƒ¨æ€§åŸç†-principle-of-locality" class="headerlink" title="ç¨‹åºçš„å±€éƒ¨æ€§åŸç†(principle of locality):"></a>ç¨‹åºçš„å±€éƒ¨æ€§åŸç†(principle of locality):</h4><p>â€‹æŒ‡ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„<strong>ä¸€ä¸ªè¾ƒçŸ­æ—¶æœŸ</strong>ï¼Œæ‰€æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€å’ŒæŒ‡ä»¤çš„æ“ä½œæ•°åœ°å€ï¼Œåˆ†åˆ«<strong>å±€é™äºä¸€å®šåŒºåŸŸ</strong>ã€‚è¿™å¯ä»¥è¡¨ç°ä¸º:</p><ul><li><u>æ—¶é—´å±€éƒ¨æ€§</u>:ä¸€æ¡æŒ‡ä»¤çš„ä¸€æ¬¡æ‰§è¡Œå’Œä¸‹æ¬¡æ‰§è¡Œï¼Œä¸€ä¸ªæ•°æ®çš„ä¸€æ¬¡è®¿é—®å’Œä¸‹æ¬¡è®¿é—®éƒ½é›†ä¸­åœ¨ä¸€ä¸ªè¾ƒçŸ­æ—¶æœŸå†…;</li><li><u>ç©ºé—´å±€éƒ¨æ€§</u>:å½“å‰æŒ‡ä»¤å’Œé‚»è¿‘çš„å‡ æ¡æŒ‡ä»¤ï¼Œå½“å‰è®¿é—®çš„æ•°æ®å’Œé‚»è¿‘çš„å‡ ä¸ªæ•°æ®éƒ½é›†ä¸­åœ¨ä¸€ä¸ªè¾ƒå°åŒºåŸŸå†…ã€‚</li></ul><p>ç¨‹åºçš„å±€éƒ¨æ€§åŸç†è¡¨æ˜ï¼Œä»ç†è®ºä¸Šæ¥è¯´ï¼Œè™šæ‹Ÿå­˜å‚¨æŠ€æœ¯æ˜¯èƒ½å¤Ÿå®ç°çš„ï¼Œè€Œä¸”åœ¨å®ç°äº†ä»¥ååº”è¯¥æ˜¯èƒ½å¤Ÿå–å¾—ä¸€ä¸ªæ»¡æ„çš„æ•ˆæœçš„ã€‚</p><h4 id="åŸºæœ¬æ¦‚å¿µï¼š"><a href="#åŸºæœ¬æ¦‚å¿µï¼š" class="headerlink" title="åŸºæœ¬æ¦‚å¿µï¼š"></a>åŸºæœ¬æ¦‚å¿µï¼š</h4><p>â€‹å¯ä»¥åœ¨é¡µå¼æˆ–æ®µå¼å†…å­˜ç®¡ç†çš„åŸºç¡€ä¸Šå®ç°</p><ul><li><p>åœ¨è£…å…¥ç¨‹åºæ—¶ï¼Œä¸å¿…å°†å…¶å…¨éƒ¨è£…å…¥åˆ°å†…å­˜ï¼Œè€Œåªéœ€å°†å½“å‰éœ€è¦æ‰§è¡Œçš„éƒ¨åˆ†é¡µé¢æˆ–æ®µè£…å…¥åˆ°å†…å­˜ï¼Œå°±å¯è®©ç¨‹åºå¼€å§‹æ‰§è¡Œï¼›</p></li><li><p>åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœéœ€æ‰§è¡Œçš„æŒ‡ä»¤æˆ–è®¿é—®çš„æ•°æ®å°šæœªåœ¨å†…å­˜ï¼ˆç§°ä¸ºç¼ºé¡µæˆ–ç¼ºæ®µï¼‰ï¼Œåˆ™ç”±å¤„ç†å™¨é€šçŸ¥æ“ä½œç³»ç»Ÿå°†ç›¸åº”çš„é¡µé¢æˆ–æ®µè°ƒå…¥åˆ°å†…å­˜ï¼Œç„¶åç»§ç»­æ‰§è¡Œç¨‹åºï¼›</p></li><li><p>å¦ä¸€æ–¹é¢ï¼Œæ“ä½œç³»ç»Ÿå°†å†…å­˜ä¸­æš‚æ—¶ä¸ä½¿ç”¨çš„é¡µé¢æˆ–æ®µè°ƒå‡ºä¿å­˜åœ¨å¤–å­˜ä¸Šï¼Œä»è€Œè…¾å‡ºæ›´å¤šç©ºé—²ç©ºé—´å­˜æ”¾å°†è¦è£…å…¥çš„ç¨‹åºä»¥åŠå°†è¦è°ƒå…¥çš„é¡µé¢æˆ–æ®µã€‚</p></li></ul><h4 id="åŸºæœ¬ç‰¹å¾ï¼š"><a href="#åŸºæœ¬ç‰¹å¾ï¼š" class="headerlink" title="åŸºæœ¬ç‰¹å¾ï¼š"></a>åŸºæœ¬ç‰¹å¾ï¼š</h4><ul><li><p>å¤§çš„ç”¨æˆ·ç©ºé—´ï¼šé€šè¿‡æŠŠç‰©ç†å†…å­˜ä¸å¤–å­˜ç›¸ç»“åˆï¼Œæä¾›ç»™ç”¨æˆ·çš„è™šæ‹Ÿå†…å­˜ç©ºé—´é€šå¸¸å¤§äºå®é™…çš„ç‰©ç†å†…å­˜ï¼Œå³å®ç°äº†è¿™ä¸¤è€…çš„åˆ†ç¦»ã€‚å¦‚32ä½çš„è™šæ‹Ÿåœ°å€ç†è®ºä¸Šå¯ä»¥è®¿é—®4GBï¼Œè€Œå¯èƒ½è®¡ç®—æœºä¸Šä»… æœ‰256Mçš„ç‰©ç†å†…å­˜ï¼Œä½†ç¡¬ç›˜å®¹é‡å¤§äº4GBã€‚</p></li><li><p>éƒ¨åˆ†äº¤æ¢ï¼šä¸äº¤æ¢æŠ€æœ¯ç›¸æ¯”è¾ƒï¼Œè™šæ‹Ÿå­˜å‚¨çš„è°ƒå…¥å’Œè°ƒå‡ºæ˜¯å¯¹éƒ¨åˆ†è™›æ‹Ÿåœ°å€ç©ºé—´è¿›è¡Œçš„ï¼š</p></li><li><p>ä¸è¿ç»­æ€§ï¼šç‰©ç†å†…å­˜åˆ†é…çš„ä¸è¿ç»­ï¼Œè™šæ‹Ÿåœ°å€ç©ºé—´ä½¿ç”¨çš„ä¸è¿ç»­ã€‚</p></li></ul><h4 id="è™šæ‹Ÿé¡µå¼å†…å­˜ç®¡ç†ï¼š"><a href="#è™šæ‹Ÿé¡µå¼å†…å­˜ç®¡ç†ï¼š" class="headerlink" title="è™šæ‹Ÿé¡µå¼å†…å­˜ç®¡ç†ï¼š"></a>è™šæ‹Ÿé¡µå¼å†…å­˜ç®¡ç†ï¼š</h4><ul><li><p>å¤§éƒ¨åˆ†è™šæ‹Ÿå­˜å‚¨ç³»ç»Ÿéƒ½é‡‡ç”¨è™šæ‹Ÿé¡µå¼å­˜å‚¨ç®¡ç†æŠ€æœ¯ï¼Œå³åœ¨<strong>é¡µå¼å­˜å‚¨ç®¡ç†</strong>çš„åŸºç¡€ä¸Šï¼Œ<strong>å¢åŠ </strong><u>è¯·æ±‚è°ƒé¡µå’Œé¡µé¢ç½®æ¢åŠŸèƒ½</u>ã€‚</p></li><li><p>åŸºæœ¬æ€è·¯ï¼š</p><ul><li>å½“ä¸€ä¸ªç”¨æˆ·ç¨‹åºè¦è°ƒå…¥å†…å­˜è¿è¡Œæ—¶ï¼Œ<u>ä¸æ˜¯å°†è¯¥ç¨‹åºçš„æ‰€æœ‰é¡µé¢éƒ½è£…å…¥å†…å­˜ï¼Œè€Œæ˜¯åªè£…å…¥éƒ¨åˆ†çš„é¡µé¢</u>ï¼Œå°±å¯å¯åŠ¨ç¨‹åºè¿è¡Œã€‚</li><li>åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç°è¦è¿è¡Œçš„ç¨‹åºæˆ–è¦è®¿é—®æ•°æ®<u>ä¸åœ¨å†…å­˜ï¼Œåˆ™å‘ç³»ç»Ÿå‘å‡ºç¼ºé¡µä¸­æ–­è¯·æ±‚</u>ï¼Œç³»ç»Ÿåœ¨å¤„ç†è¿™ä¸ªä¸­æ–­æ—¶ï¼Œå°†å¤–å­˜ä¸­ç›¸åº”çš„é¡µé¢è°ƒå…¥å†…å­˜ï¼Œä½¿å¾—è¯¥ç¨‹åºèƒ½å¤Ÿç»§ç»­è¿è¡Œã€‚</li></ul></li></ul><h5 id="é¡µè¡¨è¡¨é¡¹éœ€è¦å¢åŠ ï¼š"><a href="#é¡µè¡¨è¡¨é¡¹éœ€è¦å¢åŠ ï¼š" class="headerlink" title="é¡µè¡¨è¡¨é¡¹éœ€è¦å¢åŠ ï¼š"></a>é¡µè¡¨è¡¨é¡¹éœ€è¦å¢åŠ ï¼š</h5><ol><li><strong>é©»ç•™ä½ï¼š1è¡¨ç¤ºè¯¥é¡µåœ¨å†…å­˜ä¸­ï¼›0è¡¨ç¤ºåœ¨å¤–å­˜ä¸­</strong></li><li><strong>ä¿æŠ¤ä½</strong>ï¼šè¡¨ç¤ºå…è®¸å¯¹è¯¥é¡µåšä½•ç§ç±»å‹çš„è®¿é—®ï¼Œå¦‚åªè¯»ã€å¯è¯»å†™ã€å¯æ‰§è¡Œç­‰</li><li><strong>ä¿®æ”¹ä½</strong>ï¼šè¡¨æ˜æ­¤é¡µåœ¨å†…å­˜ä¸­æ˜¯å¦è¢«ä¿®æ”¹è¿‡ã€‚è‹¥ä¿®æ”¹è¿‡ï¼Œåœ¨å›æ”¶æ­¤é¡µæ—¶éœ€è¦æŠŠè¿™ä¸ªé¡µçš„å†…å®¹åŒæ­¥åˆ°å¤–å­˜ã€‚</li><li><strong>è®¿é—®ä½</strong>ï¼šå¦‚æœæœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œç½®ä¸º1ï¼›ç”¨äºé¡µé¢ç½®æ¢ç®—æ³•</li></ol><h5 id="ç¼ºé¡µä¸­æ–­å¤„ç†è¿‡ç¨‹ï¼š"><a href="#ç¼ºé¡µä¸­æ–­å¤„ç†è¿‡ç¨‹ï¼š" class="headerlink" title="ç¼ºé¡µä¸­æ–­å¤„ç†è¿‡ç¨‹ï¼š"></a>ç¼ºé¡µä¸­æ–­å¤„ç†è¿‡ç¨‹ï¼š</h5><ol><li><p>å¦‚æœåœ¨å†…å­˜ä¸­æœ‰ç©ºé—²çš„ç‰©ç†é¡µé¢ï¼Œåˆ™åˆ†é…ä¸€ç‰©ç†é¡µå¸§fï¼Œç„¶åè½¬ç¬¬4æ­¥ï¼šå¦åˆ™è½¬ç¬¬2æ­¥ï¼š</p></li><li><p>é‡‡ç”¨æŸç§é¡µé¢ç½®æ¢ç®—æ³•ï¼Œé€‰æ‹©ä¸€ä¸ªå°†è¢«æ›¿æ¢çš„ç‰©ç†é¡µå¸§fï¼Œå®ƒæ‰€å¯¹åº”çš„é€»è¾‘é¡µä¸ºqã€‚å¦‚æœè¯¥é¡µåœ¨å†…å­˜æœŸé—´è¢«ä¿®æ”¹è¿‡ï¼Œåˆ™éœ€æŠŠå®ƒå†™å›å¤–å­˜ï¼›</p></li><li><p>å¯¹qæ‰€å¯¹åº”çš„é¡µè¡¨é¡¹è¿›è¡Œä¿®æ”¹ï¼ŒæŠŠé©»ç•™ä½ç½®ä¸º0ï¼›</p></li><li><p>å°†éœ€è¦è®¿é—®çš„é¡µpè£å…¥åˆ°ç‰©ç†é¡µé¢få½“ä¸­ï¼›</p></li><li><p>ä¿®æ”¹pæ‰€å¯¹åº”çš„é¡µè¡¨é¡¹çš„å†…å®¹ï¼ŒæŠŠé©»ç•™ä½ç½®ä¸º1ï¼ŒæŠŠç‰©ç†é¡µå¸§å·ç½®ä¸ºf</p></li><li><p>é‡æ–°è¿è¡Œè¢«ä¸­æ–­çš„æŒ‡ä»¤ã€‚</p></li></ol><h5 id="åå¤‡å­˜å‚¨-Backing-Store"><a href="#åå¤‡å­˜å‚¨-Backing-Store" class="headerlink" title="åå¤‡å­˜å‚¨ Backing Store"></a>åå¤‡å­˜å‚¨ Backing Store</h5><h6 id="æ¦‚å¿µï¼š"><a href="#æ¦‚å¿µï¼š" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h6><ul><li><p>ä¸€ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´çš„é¡µé¢å¯ä»¥è¢«æ˜ å°„åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼ˆåœ¨äºŒçº§å­˜å‚¨ä¸­ï¼‰ä¸­çš„æŸä¸ªä½ç½®</p></li><li><p>ä»£ç æ®µï¼šæ˜ å°„åˆ°å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</p></li><li><p>åŠ¨æ€åŠ è½½çš„å…±äº«åº“ç¨‹åºæ®µï¼šæ˜ å°„åˆ°åŠ¨æ€è°ƒç”¨çš„åº“æ–‡ä»¶</p></li><li><p>å…¶å®ƒæ®µï¼šå¯èƒ½è¢«æ˜ å°„åˆ°äº¤æ¢æ–‡ä»¶(swap file)</p></li></ul><p>â€‹åœ¨ä½•å¤„ä¿å­˜æœªè¢«æ˜ å°„çš„é¡µï¼Ÿ</p><ul><li><p>èƒ½å¤Ÿç®€å•åœ°è¯†åˆ«åœ¨äºŒçº§å­˜å‚¨å™¨ä¸­çš„é¡µ</p></li><li><p>äº¤æ¢ç©ºé—´ï¼ˆç£ç›˜æˆ–è€…æ–‡ä»¶ï¼‰ï¼šç‰¹æ®Šæ ¼å¼ï¼Œç”¨äºå­˜å‚¨æœ«è¢«æ˜ å°„çš„é¡µé¢</p></li></ul><h2 id="Chapter6-é¡µé¢ç½®æ¢ç®—æ³•"><a href="#Chapter6-é¡µé¢ç½®æ¢ç®—æ³•" class="headerlink" title="Chapter6 é¡µé¢ç½®æ¢ç®—æ³•"></a>Chapter6 é¡µé¢ç½®æ¢ç®—æ³•</h2><h3 id="å±€éƒ¨é¡µé¢ç½®æ¢ç®—æ³•"><a href="#å±€éƒ¨é¡µé¢ç½®æ¢ç®—æ³•" class="headerlink" title="å±€éƒ¨é¡µé¢ç½®æ¢ç®—æ³•"></a>å±€éƒ¨é¡µé¢ç½®æ¢ç®—æ³•</h3><h4 id="åŠŸèƒ½ä¸ç›®æ ‡"><a href="#åŠŸèƒ½ä¸ç›®æ ‡" class="headerlink" title="åŠŸèƒ½ä¸ç›®æ ‡"></a>åŠŸèƒ½ä¸ç›®æ ‡</h4><p><strong>åŠŸèƒ½</strong>ï¼šç¼ºé¡µï¼Œä½†ä¸»å­˜æ»¡äº†ï¼Œæ¢è°å‡ºå»ï¼Ÿ</p><p><strong>ç›®æ ‡</strong>ï¼š<strong>å°½å¯èƒ½å‡å°‘é¡µé¢æ›´æ¢çš„æ¬¡æ•°</strong>ï¼Œ(é€šå¸¸åœ¨å±€éƒ¨æ€§åŸç†æŒ‡å¯¼ä¸‹ä¾æ®è¿‡å»çš„ç»Ÿè®¡æ•°æ®è¿›è¡Œé¢„æµ‹)</p><p>&lt;é¡µé¢é”å®š&gt;:æœ‰äº›é¡µé¢å¿…é¡»å¸¸é©»äºå†…å­˜ä¸­ï¼Œä¸åº”å‚ä¸é¡µé¢ç½®æ¢ç®—æ³•ã€‚(é€šè¿‡åœ¨é¡µè¡¨ä¸­æ·»åŠ  â€˜é”å®šæ ‡å¿—ä½,lock bitâ€™ åˆ¤æ–­)</p><h4 id="6-1æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•"><a href="#6-1æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•" class="headerlink" title="6.1æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•"></a>6.1æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•</h4><p>â€‹æ˜¯ä¸€ç§ç†æƒ³æƒ…å†µä¸‹çš„é¡µé¢ç½®æ¢ç®—æ³•, è¯¥ç®—æ³•ä½¿ç”¨çš„å‰ææ˜¯OSæå‰çŸ¥é“æ¥ä¸‹æ¥è¦è®¿é—®çš„é¡µé¢ï¼Œæ¢å‡ºè¿‘æœŸæœ€ä¸ä¼šè¢«ç”¨åˆ°çš„é¡µé¢ã€‚</p><p>æ— å®é™…æ„ä¹‰ï¼Œä½†å¯ä»¥ç”¨äºè¯„ä»·åˆ«çš„ç®—æ³•çš„æ€§èƒ½ï¼Œä½œä¸ºä¸€ä¸ªç†æƒ³çš„æ ‡æ†</p><h4 id="6-2FIFOç®—æ³•"><a href="#6-2FIFOç®—æ³•" class="headerlink" title="6.2FIFOç®—æ³•"></a>6.2FIFOç®—æ³•</h4><p>ç³»ç»Ÿç»´æŠ¤ä¸€ä¸ªé¡µé¢çš„é“¾è¡¨ï¼Œ<strong>æ¯æ¬¡æ·˜æ±°é©»ç•™æ—¶é—´æœ€é•¿çš„é¡µé¢</strong>(ä¸€ä¸ªå·²ç»åœ¨é“¾è¡¨ä¸­çš„é¡µé¢å†æ¬¡è¢«ä½¿ç”¨å¹¶ä¸ä¼šåˆ·æ–°è¯¥é¡µé¢çš„é©»ç•™æ—¶é—´ï¼Œè€Œæ˜¯ç»§ç»­æŒ‰åŸæ¥çš„è®¡æ—¶)</p><p><strong>æ€§èƒ½è¾ƒå·®</strong>ï¼Œè°ƒå‡ºçš„é¡µé¢å¯èƒ½æ˜¯ç»å¸¸è¢«è°ƒç”¨çš„é¡µé¢ï¼Œå¹¶ä¸”æœ‰**<u><em>Beladyç°è±¡</em></u>**</p><h4 id="6-3æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç®—æ³•-LRU"><a href="#6-3æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç®—æ³•-LRU" class="headerlink" title="6.3æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç®—æ³•(LRU)"></a>6.3æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç®—æ³•(LRU)</h4><p>å½“ç¼ºé¡µä¸­æ–­å‘ç”Ÿæ—¶ï¼Œé€‰æ‹©æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢ï¼ˆæ ¹æ®å†å²ï¼Œæ¨æµ‹æœªæ¥ï¼Œä¾æ®ç¨‹åºçš„è®¿é—®å…·æœ‰å±€éƒ¨æ€§</p><p>â€‹LRUç®—æ³•éœ€è¦è®°å½•æ¯ä¸ªé¡µé¢ä½¿ç”¨æ—¶é—´çš„å…ˆåé¡ºåºï¼Œ<u><strong>å¼€é”€æ¯”è¾ƒå¤§</strong></u></p><p>ä¸¤ç§å¯èƒ½çš„å®ç°æ–¹æ³•ï¼š</p><ul><li>ç»´æŠ¤ä¸€ä¸ªé“¾è¡¨ï¼Œè¿è¡Œæ–°é¡µé¢ï¼šåˆ™æ”¾åœ¨é“¾è¡¨å¤´ï¼›è¿è¡Œé“¾è¡¨ä¸­å‡ºç°è¿‡çš„é¡µé¢ï¼šå°†è¯¥ç»“ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ï¼›è‹¥è¦æ·˜æ±°é¡µé¢ï¼Œåˆ™åˆ é™¤é˜Ÿå°¾çš„é¡µé¢ã€‚</li><li>ç»´æŠ¤ä¸€ä¸ªæ ˆï¼Œåˆšä½¿ç”¨çš„é¡µé¢æ”¾åœ¨æ ˆé¡¶ï¼Œå¦‚æœæ ˆä¸­å·²ç»æœ‰è¯¥é¡µé¢åˆ™è¿˜éœ€è¦å°†æ ˆä¸­è®°å½•åˆ å»ï¼Œè‹¥è¦æ·˜æ±°é¡µé¢ï¼Œåˆ™åˆ é™¤æ ˆåº•éƒ¨çš„é¡µé¢(ps:æ²¡å•¥åŒºåˆ«å•Š)</li></ul><h4 id="6-4æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•"><a href="#6-4æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•" class="headerlink" title="6.4æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•"></a>6.4æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³•</h4><ul><li>clocké¡µé¢ç½®æ¢ç®—æ³•ï¼ŒLRUçš„è¿‘ä¼¼ï¼Œæ˜¯å¯¹FIFOçš„ä¸€ç§æ”¹è¿›ï¼š</li></ul><h5 id="åŸºæœ¬æ€è·¯ï¼š"><a href="#åŸºæœ¬æ€è·¯ï¼š" class="headerlink" title="åŸºæœ¬æ€è·¯ï¼š"></a>åŸºæœ¬æ€è·¯ï¼š</h5><ul><li><p>ï»¿ï»¿éœ€è¦ç”¨åˆ°é¡µè¡¨é¡¹å½“ä¸­çš„è®¿é—®ä½ï¼Œå½“ä¸€ä¸ªé¡µé¢è¢«è£…å…¥å†…å­˜æ—¶ï¼ŒæŠŠè¯¥ä½åˆå§‹åŒ–ä¸º0ã€‚ç„¶åå¦‚æœè¿™ä¸ªé¡µé¢è¢«è®¿é—®ï¼ˆè¯»&#x2F;å†™)ï¼Œåˆ™æŠŠè¯¥ä½ç½®ä¸º1;</p></li><li><p>ï»¿æŠŠå„ä¸ªé¡µé¢ç»„ç»‡æˆç¯å½¢é“¾è¡¨ï¼ˆç±»ä¼¼é’Ÿè¡¨é¢ï¼‰ï¼ŒæŠŠæŒ‡é’ˆæŒ‡å‘æœ€è€çš„é¡µé¢ï¼ˆæœ€<br> å…ˆè¿›æ¥ï¼‰ï¼›</p></li><li><p>å½“å‘ç”Ÿä¸€ä¸ªç¼ºé¡µä¸­æ–­æ—¶ï¼Œè€ƒå¯ŸæŒ‡é’ˆæ‰€æŒ‡å‘çš„æœ€è€é¡µé¢ï¼Œè‹¥å®ƒçš„è®¿é—®ä½ä¸º0ï¼Œç«‹å³æ·˜æ±°ï¼šè‹¥è®¿é—®ä½ä¸º1ï¼Œåˆ™æŠŠè¯¥ä½ç½®ä¸º0ï¼Œç„¶åæŒ‡é’ˆå¾€ä¸‹ç§»åŠ¨ä¸€æ ¼ã€‚å¦‚æ­¤ä¸‹å»ï¼Œç›´åˆ°æ‰¾åˆ°è¢«æ·˜æ±°çš„é¡µé¢ï¼Œç„¶åæŠŠæŒ‡é’ˆç§»åŠ¨åˆ°å®ƒçš„ä¸‹ä¸€æ ¼ã€‚</p></li></ul><h4 id="6-5äºŒæ¬¡æœºä¼šæ³•"><a href="#6-5äºŒæ¬¡æœºä¼šæ³•" class="headerlink" title="6.5äºŒæ¬¡æœºä¼šæ³•"></a>6.5äºŒæ¬¡æœºä¼šæ³•</h4><p><strong>æ·»åŠ è„ä½</strong>(ç”¨äºæ ‡è¯†æœ‰æ²¡æœ‰è¢«å†™è¿‡)ï¼Œå¦‚æœè¢«æ·˜æ±°çš„é¡µåªè¢«è¯»è¿‡ï¼Œåˆ™ç›´æ¥åˆ é™¤ï¼›å¦‚æœè¯¥é¡µé¢è¢«ä¿®æ”¹è¿‡ï¼Œå°±éœ€è¦å°†æ›´æ–°çš„æ•°æ®åŒæ­¥è‡³ç¡¬ç›˜ã€‚</p><p>ç”¨è®¿é—®ä½ã€è„ä½ä¸¤ä¸ªä½æ¥åˆ¤æ–­è¢«æ·˜æ±°çš„é¡µé¢ï¼Œåªæœ‰éƒ½ä¸º0çš„é¡µé¢æ‰ä¼šç«‹å³è¢«æ·˜æ±°ï¼Œæœ‰1çš„é¡µé¢ä¼šé¦–å…ˆå¤±å»ä¸€ä¸ª1ï¼Œå¹¸å…äºæœ¬è½®å¾ªç¯ã€‚(è„ä½ç”±1å˜0æ—¶ï¼Œä¹Ÿéœ€è¦å†™å›ç¡¬ç›˜)</p><p>ç»™ä¿®æ”¹è¿‡çš„é¡µé¢æ›´å¤šçš„æœºä¼šç•™åœ¨ä¸»å­˜ä¸­(<u>å…¶å®åªé’ˆå¯¹ä¸€ç§æƒ…å†µï¼šè®¿é—®ä½ã€è„ä½éƒ½ä¸º1æ—¶ï¼Œé¡µé¢è¢«å¾ªç¯è½®åˆ°åä¼šå…ˆæŠŠè®¿é—®ä½ç½®ä¸º0ï¼Œè€Œä¸æ˜¯æ”¹å˜è„ä½ï¼Œè¿™æ ·å°±ç›¸å½“äºç»™è¿™ä¸ªé¡µé¢å¤šä¸€æ¡å‘½ï¼</u>)â€”â€”é€šè¿‡å‡å°‘å†™å›ç¡¬ç›˜çš„æ¬¡æ•°æ¥é™ä½å¼€é”€</p><h4 id="6-6æœ€ä¸å¸¸ç”¨æ³•"><a href="#6-6æœ€ä¸å¸¸ç”¨æ³•" class="headerlink" title="6.6æœ€ä¸å¸¸ç”¨æ³•"></a>6.6æœ€ä¸å¸¸ç”¨æ³•</h4><p>Least frequency used LFU:</p><h5 id="åŸºæœ¬æ€è·¯ï¼š-1"><a href="#åŸºæœ¬æ€è·¯ï¼š-1" class="headerlink" title="åŸºæœ¬æ€è·¯ï¼š"></a>åŸºæœ¬æ€è·¯ï¼š</h5><p>â€‹å½“ä¸€ä¸ªç¼ºé¡µä¸­æ–­äº§ç”Ÿæ—¶ï¼Œé€‰æ‹©è¢«è®¿é—®æ¬¡æ•°æœ€å°‘çš„é¡µé¢æ·˜æ±°</p><p>â€‹ç»™ä¸»å­˜ä¸­çš„æ¯ä¸ªé¡µéƒ½å®‰æ’ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ·˜æ±°è®¡æ•°å™¨å€¼æœ€å°çš„é¡µé¢</p><p>ç¼ºç‚¹ï¼šè®¡æ•°å™¨å¼€é”€å¤§</p><h4 id="6-7Beladyç°è±¡"><a href="#6-7Beladyç°è±¡" class="headerlink" title="6.7Beladyç°è±¡"></a>6.7Beladyç°è±¡</h4><p>â€‹åœ¨é‡‡ç”¨FIFOç®—æ³•æ—¶ï¼Œæœ‰æ—¶ä¼šå‡ºç°åˆ†é…çš„ç‰©ç†é¡µé¢æ•°å¢åŠ ï¼Œç¼ºé¡µç‡åè€Œæé«˜çš„ç°è±¡ï¼›</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230605214433150.png" alt="image-20230605214433150" style="zoom:30%;" /><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230605214507498.png" alt="image-20230605214507498" style="zoom:31%;" /><h4 id="6-8å±€éƒ¨é¡µé¢æ›¿æ¢ç®—æ³•çš„é—®é¢˜ã€å·¥ä½œé›†æ¨¡å‹"><a href="#6-8å±€éƒ¨é¡µé¢æ›¿æ¢ç®—æ³•çš„é—®é¢˜ã€å·¥ä½œé›†æ¨¡å‹" class="headerlink" title="6.8å±€éƒ¨é¡µé¢æ›¿æ¢ç®—æ³•çš„é—®é¢˜ã€å·¥ä½œé›†æ¨¡å‹"></a>6.8å±€éƒ¨é¡µé¢æ›¿æ¢ç®—æ³•çš„é—®é¢˜ã€å·¥ä½œé›†æ¨¡å‹</h4><p><strong>å·¥ä½œé›†ï¼šä¸€ä¸ªè¿›ç¨‹å½“å‰æ­£åœ¨ä½¿ç”¨çš„é€»è¾‘é¡µé¢é›†åˆï¼Œå¯ä»¥ç”¨ä¸€ä¸ªäºŒå…ƒå‡½æ•°w(tï¼Œâˆ†)æ¥è¡¨ç¤º</strong></p><ul><li><p>tæ˜¯å½“å‰çš„æ‰§è¡Œæ—¶åˆ»ï¼›</p></li><li><p>âˆ†ç§°ä¸ºå·¥ä½œé›†çª—å£ (working set windowï¼‰ï¼Œå³ä¸€ä¸ªå®šé•¿çš„é¡µé¢è®¿é—®çš„æ—¶åŒçª—å£ï¼š</p></li><li><p>w(tï¼Œâˆ†)ä¸€åœ¨å½“å‰æ—¶åˆ» t ä¹‹å‰çš„ âˆ†æ—¶é—´çª—å£å½“ä¸­çš„æ‰€æœ‰é¡µé¢æ‰€ç»„æˆçš„é›†åˆ(éšç€ t çš„å˜åŒ–ï¼Œè¯¥é›†åˆä¹Ÿåœ¨ä¸æ–­åœ°å˜åŒ–ï¼‰</p></li><li><p>|w(tï¼Œâˆ†ï¼‰|æŒ‡å·¥ä½œé›†çš„å¤§å°ï¼Œå³é¡µé¢æ•°ç›®ã€‚</p></li></ul><p><strong>å¸¸é©»é›†ï¼šæ˜¯æŒ‡åœ¨å½“å‰æ—¶åˆ»ï¼Œè¿›ç¨‹å®é™…é©»ç•™åœ¨å†…å­˜å½“ä¸­çš„é¡µé¢é›†åˆã€‚</strong></p><h5 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h5><ol><li><p>å·¥ä½œé›†æ˜¯è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å›ºæœ‰çš„æ€§è´¨ï¼Œè€Œå¸¸é©»é›†å–å†³äºç³»ç»Ÿåˆ†é…ç»™è¿›ç¨‹çš„ç‰©ç†é¡µé¢æ•°æ—¥ï¼Œä»¥åŠæ‰€é‡‡ç”¨çš„é¡µé¢ç½®æ¢ç®—æ³•ï¼›</p></li><li><p>å¦‚æœä¸€ä¸ªè¿›ç¨‹çš„æ•´ä¸ªå·¥ä½œé›†éƒ½åœ¨å†…å­˜å½“ä¸­ï¼Œå³å¸¸é©»é›†&gt;&#x3D;å·¥ä½œé›†ï¼Œé‚£ä¹ˆè¿›ç¨‹å°†å¾ˆé¡ºåˆ©åœ°è¿è¡Œï¼Œè€Œä¸ä¼šé€ æˆå¤ªå¤šçš„ç¼ºé¡µä¸­æ–­ï¼ˆç›´åˆ°å·¥ä½œé›†å‘ç”Ÿå‰§çƒˆå˜åŠ¨ï¼Œä»è€Œè¿‡æ¸¡åˆ°å¦ä¸€ä¸ªçŠ¶æ€ï¼‰</p></li><li><p>å½“è¿›ç¨‹å¸¸é©»é›†çš„å¤§å°è¾¾åˆ°æŸä¸ªæ•°ç›®ä¹‹åï¼Œå†ç»™å®ƒåˆ†é…æ›´å¤šçš„ç‰©ç†é¡µé¢ï¼Œç¼ºé¡µç‡ä¹Ÿä¸ä¼šæ˜æ˜¾ä¸‹é™ã€‚</p></li></ol><h3 id="å…¨å±€é¡µé¢ç½®æ¢ç®—æ³•ï¼š"><a href="#å…¨å±€é¡µé¢ç½®æ¢ç®—æ³•ï¼š" class="headerlink" title="å…¨å±€é¡µé¢ç½®æ¢ç®—æ³•ï¼š"></a>å…¨å±€é¡µé¢ç½®æ¢ç®—æ³•ï¼š</h3><h4 id="1-å·¥ä½œé›†é¡µé¢ç½®æ¢ç®—æ³•"><a href="#1-å·¥ä½œé›†é¡µé¢ç½®æ¢ç®—æ³•" class="headerlink" title="1.å·¥ä½œé›†é¡µé¢ç½®æ¢ç®—æ³•"></a>1.å·¥ä½œé›†é¡µé¢ç½®æ¢ç®—æ³•</h4><p>â€‹å¦‚æœé¡µé¢ä¸åœ¨å·¥ä½œé›†ä¸­ï¼Œé‚£ä¹ˆå³ä½¿æ²¡æœ‰å‘ç”Ÿç¼ºé¡µä¸­æ–­ï¼Œä¹Ÿä¼šæŠŠè¯¥é¡µé¢æ¢å‡ºã€‚</p><p>â€‹æ¯æ¬¡éƒ½çœ‹çœ‹è‡ªå·±çš„å¸¸é©»é›†å’Œå·¥ä½œé›†ï¼Œå¸¸é©»é›†é‡Œæœ‰ï¼Œä½†å·¥ä½œé›†ä¸­æ²¡æœ‰çš„é¡µé¢éƒ½ä¼šè¢«ç§»é™¤</p><h4 id="2-ç¼ºé¡µç‡é¡µé¢ç½®æ¢ç®—æ³•"><a href="#2-ç¼ºé¡µç‡é¡µé¢ç½®æ¢ç®—æ³•" class="headerlink" title="2.ç¼ºé¡µç‡é¡µé¢ç½®æ¢ç®—æ³•"></a>2.ç¼ºé¡µç‡é¡µé¢ç½®æ¢ç®—æ³•</h4><h5 id="å¯å˜åˆ†é…ç­–è·¯ï¼š"><a href="#å¯å˜åˆ†é…ç­–è·¯ï¼š" class="headerlink" title="å¯å˜åˆ†é…ç­–è·¯ï¼š"></a>å¯å˜åˆ†é…ç­–è·¯ï¼š</h5><p>â€‹å¸¸é©»é›†å¤§å°å¯å˜ï¼Œä¾‹å¦‚ï¼šæ¯ä¸ªè¿›ç¨‹åœ¨åˆšå¼€å§‹è¿è¡Œçš„æ—¶å€™ï¼Œå…ˆæ ¹æ®ç¨‹åºå¤§å°ç»™å®ƒåˆ†é…ä¸€å®šæ•°ç›®çš„ç‰©ç†é¡µé¢ï¼Œç„¶ååœ¨è¿›ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå†<u>åŠ¨æ€åœ°è°ƒæ•´å¸¸é©»é›†çš„å¤§å°</u>ã€‚</p><ul><li>å¯é‡‡ç”¨å…¨å±€é¡µé¢ç½®æ¢çš„æ–¹å¼ã€‚å½“å‘ç”Ÿä¸€ä¸ªç¼ºé¡µä¸­æ–­æ—¶ï¼Œè¢«ç½®æ¢çš„é¡µé¢å¯ä»¥æ˜¯åœ¨å…¶å®ƒè¿›ç¨‹å½“ä¸­ï¼Œå„ä¸ªå¹¶å‘è¿›ç¨‹ç«äº‰åœ°ä½¿ç”¨ç‰©ç†é¡µé¢ã€‚</li><li>ä¼˜ç¼ºç‚¹ï¼šæ€§èƒ½è¾ƒå¥½ã€‚ä½†å¢åŠ äº†ç³»ç»Ÿå¼€é”€ã€‚</li><li>å…·ä½“å®ç°ï¼šå¯ä»¥ä½¿ç”¨<strong>ç¼ºé¡µç‡ç®—æ³•</strong> (PPF, page fault freguency)æ¥åŠ¨æ€è°ƒæ•´å¸¸é©»é›†çš„å¤§å°ã€‚</li></ul><p><strong>ğŸŒŸå¦‚ä½•åŠ¨æ€åœ°è°ƒæ•´å¸¸é©»é›†çš„å¤§å°ï¼Ÿ</strong></p><p>â€‹è®¾ç½®ä¸€ä¸ªé˜ˆå€¼kï¼Œå°†æœ¬æ¬¡å‘ç”Ÿç¼ºé¡µçš„ä¸‹æ ‡ - ä¸Šæ¬¡å‘ç”Ÿç¼ºé¡µçš„ä¸‹æ ‡ ä¸ k è¿›è¡Œæ¯”è¾ƒï¼Œ</p><ul><li><p>å¦‚æœkæ¯”è¾ƒå¤§ï¼Œè¯´æ˜ä¸­æ–­å¼‚å¸¸å‡ºç°çš„å¤ªé¢‘ç¹äº†ï¼Œç›´æ¥å°†ç¼ºå¤±é¡µåŠ å…¥åˆ°å·¥ä½œé›†ä¸­(æ‰©å¤§å·¥ä½œé›†ï¼Œé™ä½ç¼ºé¡µæ¦‚ç‡)</p></li><li><p>å¦‚æœkæ¯”è¾ƒå°ï¼Œè¯´æ˜ä¸æ€ä¹ˆå‡ºç°ä¸­æ–­ï¼Œé‚£ä¹ˆæ‰§è¡Œä¸‹è¿°æ“ä½œï¼šå°†å·¥ä½œé›†ä¸­ä¸åœ¨[t_last, t_current]åŒºé—´å†…å‡ºç°çš„é¡µé¢ç§»é™¤   (t_last, t_currentæŒ‡ä¸Šä¸€æ¬¡ã€è¿™æ¬¡å‡ºç°ä¸­æ–­å¼‚å¸¸çš„æ—¶é—´ä¸‹æ ‡)</p></li></ul><h3 id="æŠ–åŠ¨é—®é¢˜ï¼š"><a href="#æŠ–åŠ¨é—®é¢˜ï¼š" class="headerlink" title="æŠ–åŠ¨é—®é¢˜ï¼š"></a>æŠ–åŠ¨é—®é¢˜ï¼š</h3><ul><li>ï»¿å¦‚æœåˆ†é…ç»™ä¸€ä¸ªè¿›ç¨‹çš„ç‰©ç†é¡µé¢å¤ªå°‘ï¼Œä¸èƒ½åŒ…å«æ•´ä¸ªçš„å·¥ä½œé›†ï¼Œå³å¸¸é©»é›†ï¼œ å·¥ä½œé›†ï¼Œé‚£ä¹ˆè¿›ç¨‹å°†ä¼šé€ æˆå¾ˆå¤šçš„ç¼ºé¡µä¸­æ–­ï¼Œéœ€è¦é¢‘ç¹åœ°åœ¨å†…å­˜ä¸å¤–å­˜ä¹‹é—´æ›¿æ¢é¡µé¢ï¼Œä»è€Œä½¿è¿›ç¨‹çš„è¿è¡Œé€Ÿåº¦å˜å¾—å¾ˆæ…¢ï¼Œæˆ‘ä»¬æŠŠè¿™ç§ç‹€æ€ç§°ä¸º â€œæŠ–åŠ¨â€ã€‚</li><li>ï»¿äº§ç”ŸæŠ–åŠ¨çš„åŸå› ï¼šéšç€é©»ç•™å†…å­˜çš„è¿›ç¨‹æ•°ç›®å¢åŠ ï¼Œåˆ†é…ç»™æ¯ä¸ªè¿›ç¨‹çš„ç‰©ç†é¡µé¢æ•°ä¸æ–­å‡å°ï¼Œå¯¼è‡´ç¼ºé¡µç‡ä¸æ–­ä¸Šå‡ã€‚æ‰€ä»¥<strong>osè¦é€‰æ‹©ä¸€ä¸ªé€‚å½“çš„è¿›ç¨‹æ•°ç›®å’Œè¿›ç¨‹éœ€è¦çš„å¸§æ•°</strong>ï¼Œä»¥ä¾¿åœ¨å¹¶å‘æ°´å¹³å’Œç¼ºé¡µç‡ä¹‹é—´è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ã€‚</li></ul><p>æŠ–åŠ¨é—®é¢˜åœ¨ä¸€äº›æƒ…å†µä¸‹å¯ä»¥è¢«æœ¬åœ°çš„é¡µé¢ç½®æ¢ç®—æ³•æ”¹å–„</p><h2 id="Chapter7-è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#Chapter7-è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="Chapter7 è¿›ç¨‹å’Œçº¿ç¨‹"></a>Chapter7 è¿›ç¨‹å’Œçº¿ç¨‹</h2><h3 id="7-1è¿›ç¨‹-process-çš„æè¿°"><a href="#7-1è¿›ç¨‹-process-çš„æè¿°" class="headerlink" title="7.1è¿›ç¨‹(process)çš„æè¿°"></a>7.1è¿›ç¨‹(process)çš„æè¿°</h3><h4 id="è¿›ç¨‹å®šä¹‰ï¼š"><a href="#è¿›ç¨‹å®šä¹‰ï¼š" class="headerlink" title="è¿›ç¨‹å®šä¹‰ï¼š"></a>è¿›ç¨‹å®šä¹‰ï¼š</h4><p>â€‹ä¸€ä¸ªå…·æœ‰ä¸€å®šåŠŸèƒ½çš„ç¨‹åºåœ¨ä¸€ä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡åŠ¨æ€æ‰§è¡Œçš„è¿‡ç¨‹</p><h4 id="è¿›ç¨‹ç»„æˆï¼š"><a href="#è¿›ç¨‹ç»„æˆï¼š" class="headerlink" title="è¿›ç¨‹ç»„æˆï¼š"></a>è¿›ç¨‹ç»„æˆï¼š</h4><p>åŒ…å«äº†ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„æ‰€æœ‰çŠ¶æ€ä¿¡æ¯</p><pre><code>        1. ç¨‹åºçš„ä»£ç         1. ç¨‹åºå¤„ç†çš„æ•°æ®        1. ç¨‹åºè®¡æ•°å™¨çš„å€¼ï¼ŒæŒ‡ç¤ºä¸‹ä¸€æ¡å³å°†è¿è¡Œçš„æŒ‡ä»¤        1. ä¸€ç»„é€šç”¨çš„å¯„å­˜å™¨çš„å½“å‰å€¼ï¼Œå †ã€æ ˆ        1. ä¸€ç»„ç³»ç»Ÿèµ„æº(å¦‚æ‰“å¼€çš„ç¨‹åº)</code></pre><h5 id="è¿›ç¨‹ä¸ç¨‹åºçš„è”ç³»ï¼š"><a href="#è¿›ç¨‹ä¸ç¨‹åºçš„è”ç³»ï¼š" class="headerlink" title="è¿›ç¨‹ä¸ç¨‹åºçš„è”ç³»ï¼š"></a>è¿›ç¨‹ä¸ç¨‹åºçš„è”ç³»ï¼š</h5><ul><li>ï»¿ç¨‹åºæ˜¯äº§ç”Ÿè¿›ç¨‹çš„åŸºç¡€</li><li>ï»¿<u>ç¨‹åºçš„æ¯æ¬¡è¿è¡Œæ„æˆä¸åŒçš„è¿›ç¨‹</u></li><li>ï»¿è¿›ç¨‹æ˜¯ç¨‹åºåŠŸèƒ½çš„ä½“ç°</li><li>ï»¿é€šè¿‡å¤šæ¬¡æ‰§è¡Œï¼Œä¸€ä¸ªç¨‹åºå¯å¯¹åº”å¤šä¸ªè¿›ç¨‹ï¼›é€šè¿‡è°ƒç”¨å…³ç³»ï¼Œä¸€ä¸ªè¿›ç¨‹å¯åŒ…æ‹¬å¤šä¸ªç¨‹åºã€‚</li></ul><h5 id="è¿›ç¨‹ä¸ç¨‹åºçš„åŒºåˆ«ï¼š"><a href="#è¿›ç¨‹ä¸ç¨‹åºçš„åŒºåˆ«ï¼š" class="headerlink" title="è¿›ç¨‹ä¸ç¨‹åºçš„åŒºåˆ«ï¼š"></a>è¿›ç¨‹ä¸ç¨‹åºçš„åŒºåˆ«ï¼š</h5><ul><li><p>è¿›ç¨‹æ˜¯åŠ¨æ€çš„ï¼Œç¨‹åºæ˜¯é™æ€çš„ï¼šç¨‹åºæ˜¯æœ‰åºä»£ç çš„é›†åˆï¼›è¿›ç¨‹æ˜¯ç¨‹åºçš„æ‰§è¡Œï¼Œè¿›ç¨‹æœ‰æ ¸å¿ƒæ€&#x2F;ç”¨æˆ·æ€</p></li><li><p>è¿›ç¨‹æ˜¯æš‚æ—¶çš„ï¼Œç¨‹åºçš„æ°¸ä¹…çš„ï¼šè¿›ç¨‹æ˜¯ä¸€ä¸ªçŠ¶æ€å˜åŒ–çš„è¿‡ç¨‹ï¼Œç¨‹åºå¯é•¿ä¹…ä¿å­˜</p></li><li><p>è¿›ç¨‹ä¸ç¨‹åºçš„ç»„æˆä¸åŒï¼šè¿›ç¨‹çš„ç»„æˆåŒ…æ‹¬**<u>ç¨‹åºã€æ•°æ®å’Œè¿›ç¨‹æ§åˆ¶å—</u>**ï¼ˆå³è¿›ç¨‹çŠ¶æ€ä¿¡æ¯ï¼‰</p></li></ul><h4 id="è¿›ç¨‹çš„ç‰¹ç‚¹ï¼š"><a href="#è¿›ç¨‹çš„ç‰¹ç‚¹ï¼š" class="headerlink" title="è¿›ç¨‹çš„ç‰¹ç‚¹ï¼š"></a>è¿›ç¨‹çš„ç‰¹ç‚¹ï¼š</h4><ul><li>ï»¿åŠ¨æ€æ€§ï¼šå¯åŠ¨æ€åœ°åˆ›å»ºã€ç»“æŸè¿›ç¨‹ï¼›</li><li>ï»¿å¹¶å‘æ€§ï¼šè¿›ç¨‹å¯ä»¥è¢«ç‹¬ç«‹è°ƒåº¦å¹¶å ç”¨å¤„ç†æœºè¿è¡Œï¼›(å¹¶å‘-&gt;ä¸²ã€å¹¶è¡Œ-&gt;å¹¶)</li><li>ï»¿ç‹¬ç«‹æ€§ï¼šä¸åŒè¿›ç¨‹çš„å·¥ä½œä¸ç›¸äº’å½±å“ï¼š</li><li>ï»¿åˆ¶çº¦æ€§ï¼šå› è®¿é—®å…±äº«æ•°æ®&#x2F;èµ„æºæˆ–è¿›ç¨‹é—´åŒæ­¥è€Œäº§ç”Ÿåˆ¶çº¦ã€‚</li></ul><h4 id="è¿›ç¨‹æ§åˆ¶ç»“æ„ï¼š"><a href="#è¿›ç¨‹æ§åˆ¶ç»“æ„ï¼š" class="headerlink" title="è¿›ç¨‹æ§åˆ¶ç»“æ„ï¼š"></a>è¿›ç¨‹æ§åˆ¶ç»“æ„ï¼š</h4><p>â€‹ç¨‹åº &#x3D; ç®—æ³• + æ•°æ®ç»“æ„</p><p>â€‹æè¿°è¿›ç¨‹çš„æ•°æ®ç»“æ„ï¼š<strong>è¿›ç¨‹æ§åˆ¶å—</strong>(Process Control Block, PCB)</p><p>è¿›ç¨‹æ§åˆ¶å—ï¼šOSç®¡ç†è¿›ç¨‹è¿è¡Œæ‰€ç”¨ä¿¡æ¯çš„é›†åˆï¼ŒOSç”¨PCBæè¿°<u>è¿›ç¨‹çš„åŸºæœ¬æƒ…å†µåŠè¿è¡Œå˜åŒ–çš„è¿‡ç¨‹</u>ï¼ŒPCBæ˜¯è¿›ç¨‹å­˜åœ¨çš„<strong>å”¯ä¸€æ ‡å¿—ã€‚</strong></p><h5 id="PCBä¸­åŒ…å«çš„å†…å®¹ï¼š"><a href="#PCBä¸­åŒ…å«çš„å†…å®¹ï¼š" class="headerlink" title="PCBä¸­åŒ…å«çš„å†…å®¹ï¼š"></a>PCBä¸­åŒ…å«çš„å†…å®¹ï¼š</h5><ol><li><p><strong>è¿›ç¨‹æ ‡è¯†ä¿¡æ¯</strong>ã€‚å¦‚æœ¬è¿›ç¨‹çš„æ ‡è¯†ï¼Œæœ¬è¿›ç¨‹çš„äº§ç”Ÿè€…æ ‡è¯†(çˆ¶è¿›ç¨‹æ ‡è¯†)ï¼›ç”¨æˆ·æ ‡è¯†ã€‚</p></li><li><p><strong>å¤„ç†æœºçŠ¶æ€ä¿¡æ¯ä¿å­˜åŒº</strong>ã€‚ä¿å­˜è¿›ç¨‹çš„è¿è¡Œç°åœºä¿¡æ¯ï¼š</p><ul><li><p>ï»¿ç”¨æˆ·å¯è§å¯„å­˜å™¨ï¼Œç”¨æˆ·ç¨‹åºå¯ä»¥ä½¿ç”¨çš„æ•°æ®ï¼Œåœ°å€ç­‰å¯„å­˜å™¨ã€‚</p></li><li><p>ï»¿æ§åˆ¶å’ŒçŠ¶æ€å¯„å­˜å™¨ï¼Œå¦‚ç¨‹åºè®¡æ•°å™¨(PC)ï¼Œç¨‹åºçŠ¶æ€å­— (PSW)ã€‚</p></li><li><p>ï»¿æ ˆæŒ‡é’ˆï¼Œè¿‡ç¨‹è°ƒç”¨&#x2F;ç³»ç»Ÿè°ƒç”¨&#x2F;ä¸­æ–­å¤„ç†å’Œè¿”å›æ—¶éœ€è¦ç”¨åˆ°å®ƒã€‚</p></li></ul></li><li><p><strong>è¿›ç¨‹æ§åˆ¶ä¿¡æ¯</strong></p></li></ol><ul><li><p>è°ƒåº¦å’ŒçŠ¶æ€ä¿¡æ¯ï¼Œç”¨äºæ“ä½œç³»ç»Ÿè°ƒåº¦è¿›ç¨‹å¹¶å ç”¨å¤„ç†æœºä½¿ç”¨ã€‚</p></li><li><p>è¿›ç¨‹é—´é€šä¿¡ä¿¡æ¯ï¼Œä¸ºæ”¯æŒè¿›ç¨‹é—®çš„ä¸é€šä¿¡ç›¸å…³çš„å„ç§æ ‡è¯†ã€ä¿¡å·ã€ä¿¡ä»¶ç­‰ï¼Œè¿™äº›ä¿¡æ¯å­˜åœ¨æ¥æ”¶æ–¹çš„è¿›ç¨‹æ§åˆ¶å—ä¸­ã€‚</p></li><li><p>å­˜å‚¨ç®¡ç†ä¿¡æ¯ï¼ŒåŒ…å«æœ‰æŒ‡å‘æœ¬è¿›ç¨‹æ˜ åƒå­˜å‚¨ç©ºé—´çš„æ•°æ®ç»“æ„ã€‚</p></li><li><p>ï»¿è¿›ç¨‹æ‰€ç”¨èµ„æºï¼Œè¯´æ˜ç”±è¿›ç¨‹æ‰“å¼€ã€ä½¿ç”¨çš„ç³»ç»Ÿèµ„æºï¼Œå¦‚æ‰“å¼€çš„æ–‡ä»¶ç­‰ã€‚</p></li><li><p>ï»¿æœ‰å…³æ•°æ®ç»“æ„è¿æ¥ä¿¡æ¯ï¼Œè¿›ç¨‹å¯ä»¥è¿æ¥åˆ°ä¸€ä¸ªè¿›ç¨‹é˜Ÿåˆ—ä¸­ï¼Œæˆ–è¿æ¥åˆ°ç›¸å…³çš„å…¶ä»–è¿›ç¨‹çš„PCBã€‚</p></li></ul><h5 id="PCBçš„ç»„ç»‡æ–¹å¼"><a href="#PCBçš„ç»„ç»‡æ–¹å¼" class="headerlink" title="PCBçš„ç»„ç»‡æ–¹å¼"></a>PCBçš„ç»„ç»‡æ–¹å¼</h5><ul><li>é“¾è¡¨(å¸¸ç”¨)ï¼šåŒä¸€çŠ¶æ€çš„è¿›ç¨‹å…¶PCBæˆä¸€é“¾è¡¨ï¼Œå¤šä¸ªçŠ¶æ€å¯¹åº”å¤šä¸ªä¸åŒçš„é“¾è¡¨</li></ul><p>å„çŠ¶æ€çš„è¿›ç¨‹å½¢æˆä¸åŒçš„é“¾è¡¨ï¼šå°±ç»ªé“¾è¡¨ã€é˜»å¡é“¾è¡¨</p><ul><li>ç´¢å¼•è¡¨ï¼šåŒä¸€çŠ¶æ€çš„è¿›ç¨‹å½’å…¥ä¸€ä¸ªindexè¡¨ï¼ˆç”±indexæŒ‡å‘PCB)ï¼Œå¤šä¸ªçŠ¶æ€å¯¹åº”å¤šä¸ªä¸åŒçš„indexè¡¨</li></ul><p>å„çŠ¶æ€çš„è¿›è¡Œå½¢æˆä¸åŒçš„ç´¢å¼•è¡¨ï¼šå°±ç»ªç´¢å¼•è¡¨ã€é˜»å¡ç´¢å¼•è¡¨</p><h3 id="7-2è¿›ç¨‹çŠ¶æ€"><a href="#7-2è¿›ç¨‹çŠ¶æ€" class="headerlink" title="7.2è¿›ç¨‹çŠ¶æ€"></a>7.2è¿›ç¨‹çŠ¶æ€</h3><h4 id="è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†"><a href="#è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†" class="headerlink" title="è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†"></a>è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†</h4><h5 id="è¿›ç¨‹åˆ›å»º"><a href="#è¿›ç¨‹åˆ›å»º" class="headerlink" title="è¿›ç¨‹åˆ›å»º"></a>è¿›ç¨‹åˆ›å»º</h5><h6 id="å¼•èµ·è¿›ç¨‹åˆ›å»ºçš„ä¸‰ä¸ªä¸»è¦äº‹ä»¶ï¼š"><a href="#å¼•èµ·è¿›ç¨‹åˆ›å»ºçš„ä¸‰ä¸ªä¸»è¦äº‹ä»¶ï¼š" class="headerlink" title="å¼•èµ·è¿›ç¨‹åˆ›å»ºçš„ä¸‰ä¸ªä¸»è¦äº‹ä»¶ï¼š"></a>å¼•èµ·è¿›ç¨‹åˆ›å»ºçš„ä¸‰ä¸ªä¸»è¦äº‹ä»¶ï¼š</h6><pre><code>    1. ç³»ç»Ÿåˆå§‹åŒ–æ—¶(åˆ›å»ºinitè¿›ç¨‹)    2. **ç”¨æˆ·è¯·æ±‚**åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹    3. æ­£åœ¨è¿è¡Œçš„**è¿›ç¨‹æ‰§è¡Œ**äº†åˆ›å»ºè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨</code></pre><h5 id="è¿›ç¨‹è¿è¡Œ"><a href="#è¿›ç¨‹è¿è¡Œ" class="headerlink" title="è¿›ç¨‹è¿è¡Œ"></a>è¿›ç¨‹è¿è¡Œ</h5><h6 id="å†…æ ¸é€‰æ‹©ä¸€ä¸ªå°±ç»ªçš„è¿›ç¨‹ï¼Œè®©å®ƒå ç”¨å¤„ç†æœºå¹¶æ‰§è¡Œ"><a href="#å†…æ ¸é€‰æ‹©ä¸€ä¸ªå°±ç»ªçš„è¿›ç¨‹ï¼Œè®©å®ƒå ç”¨å¤„ç†æœºå¹¶æ‰§è¡Œ" class="headerlink" title="å†…æ ¸é€‰æ‹©ä¸€ä¸ªå°±ç»ªçš„è¿›ç¨‹ï¼Œè®©å®ƒå ç”¨å¤„ç†æœºå¹¶æ‰§è¡Œ"></a>å†…æ ¸é€‰æ‹©ä¸€ä¸ªå°±ç»ªçš„è¿›ç¨‹<strong>ï¼Œè®©å®ƒå ç”¨å¤„ç†æœº</strong>å¹¶æ‰§è¡Œ</h6><h5 id="è¿›ç¨‹ç­‰å¾…"><a href="#è¿›ç¨‹ç­‰å¾…" class="headerlink" title="è¿›ç¨‹ç­‰å¾…"></a>è¿›ç¨‹ç­‰å¾…</h5><h6 id="ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œè¿›ç¨‹ç­‰å¾…ï¼š"><a href="#ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œè¿›ç¨‹ç­‰å¾…ï¼š" class="headerlink" title="ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œè¿›ç¨‹ç­‰å¾…ï¼š"></a>ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œè¿›ç¨‹ç­‰å¾…ï¼š</h6><ol><li>ï»¿<strong>è¯·æ±‚å¹¶ç­‰å¾…ç³»ç»ŸæœåŠ¡</strong>ï¼Œæ— æ³•é©¬ä¸Šå®Œæˆ</li><li>ï»¿<strong>å¯åŠ¨æŸç§æ“ä½œ</strong>ï¼Œæ— æ³•é©¬ä¸Šå®Œæˆ</li><li>ï»¿<strong>éœ€è¦çš„æ•°æ®æ²¡æœ‰åˆ°è¾¾</strong></li></ol><p><u>è¿›ç¨‹åªèƒ½è‡ªå·±é˜»å¡è‡ªå·±ï¼Œå› ä¸ºåªæœ‰è¿›ç¨‹è‡ªèº«æ‰èƒ½çŸ¥é“ä½•æ—¶éœ€è¦ç­‰å¾…æŸç§äº‹ä»¶çš„å‘ç”Ÿã€‚</u></p><h5 id="è¿›ç¨‹å”¤é†’"><a href="#è¿›ç¨‹å”¤é†’" class="headerlink" title="è¿›ç¨‹å”¤é†’"></a>è¿›ç¨‹å”¤é†’</h5><h6 id="å”¤é†’è¿›ç¨‹çš„åŸå› ï¼š"><a href="#å”¤é†’è¿›ç¨‹çš„åŸå› ï¼š" class="headerlink" title="å”¤é†’è¿›ç¨‹çš„åŸå› ï¼š"></a>å”¤é†’è¿›ç¨‹çš„åŸå› ï¼š</h6><ol><li>ï»¿è¢«é˜»å¡è¿›ç¨‹éœ€è¦çš„èµ„æºå¯è¢«æ»¡è¶³</li><li>ï»¿è¢«é˜»å¡è¿›ç¨‹ç­‰å¾…çš„äº‹ä»¶åˆ°è¾¾</li><li>ï»¿å°†è¯¥è¿›ç¨‹çš„PCBæ’å…¥åˆ°å°±ç»ªé˜Ÿåˆ—</li></ol><p><u>è¿›ç¨‹åªèƒ½è¢«åˆ«çš„è¿›ç¨‹æˆ–æ“ä½œç³»ç»Ÿå”¤é†’ã€‚</u></p><h5 id="è¿›ç¨‹ç»“æŸ"><a href="#è¿›ç¨‹ç»“æŸ" class="headerlink" title="è¿›ç¨‹ç»“æŸ"></a>è¿›ç¨‹ç»“æŸ</h5><h6 id="åœ¨ä»¥ä¸‹å››ç§æƒ…å½¢ä¸‹ï¼Œè¿›ç¨‹ç»“æŸï¼š"><a href="#åœ¨ä»¥ä¸‹å››ç§æƒ…å½¢ä¸‹ï¼Œè¿›ç¨‹ç»“æŸï¼š" class="headerlink" title="åœ¨ä»¥ä¸‹å››ç§æƒ…å½¢ä¸‹ï¼Œè¿›ç¨‹ç»“æŸï¼š"></a>åœ¨ä»¥ä¸‹å››ç§æƒ…å½¢ä¸‹ï¼Œè¿›ç¨‹ç»“æŸï¼š</h6><ul><li><p>æ­£å¸¸é€€å‡ºï¼ˆè‡ªæ„¿çš„ï¼‰</p></li><li><p>é”™è¯¯é€€å‡ºï¼ˆè‡ªæ„¿çš„ï¼‰</p></li><li><p>è‡´å‘½é”™è¯¯ï¼ˆå¼ºåˆ¶æ€§çš„ï¼‰</p></li><li><p>è¢«å…¶ä»–è¿›ç¨‹æ‰€æ€ï¼ˆå¼ºåˆ¶æ€§çš„ï¼‰</p></li></ul><h4 id="è¿›ç¨‹çŠ¶æ€å˜åŒ–æ¨¡å‹"><a href="#è¿›ç¨‹çŠ¶æ€å˜åŒ–æ¨¡å‹" class="headerlink" title="è¿›ç¨‹çŠ¶æ€å˜åŒ–æ¨¡å‹"></a>è¿›ç¨‹çŠ¶æ€å˜åŒ–æ¨¡å‹</h4><h5 id="è¿›ç¨‹çš„ä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼š"><a href="#è¿›ç¨‹çš„ä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼š" class="headerlink" title="è¿›ç¨‹çš„ä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼š"></a>è¿›ç¨‹çš„ä¸‰ç§<u>åŸºæœ¬</u>çŠ¶æ€ï¼š</h5><p>â€‹è¿›ç¨‹åœ¨ç”Ÿå‘½ç»“æŸå‰å¤„äºä¸”ä»…å¤„äºä¸‰ç§åŸºæœ¬çŠ¶æ€ä¹‹ä¸€</p><ul><li><p>è¿è¡ŒçŠ¶æ€(Running)ï¼šå½“ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨å¤„ç†æœºä¸Šè¿è¡Œæ—¶ã€‚</p></li><li><p>å°±ç»ªçŠ¶æ€(Ready)ï¼šä¸€ä¸ªè¿›ç¨‹è·å¾—äº†é™¤å¤„ç†æœºä¹‹å¤–çš„ä¸€åˆ‡æ‰€éœ€èµ„æºï¼Œä¸€æ—¦å¾—åˆ°å¤„ç†æœºå³å¯è¿è¡Œã€‚</p></li><li><p>ç­‰å¾…çŠ¶æ€ï¼ˆåˆç§°é˜»å¡çŠ¶æ€Blocked)ï¼šä¸€ä¸ªè¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸€äº‹ä»¶è€Œæš‚åœè¿è¡Œæ—¶ã€‚å¦‚ç­‰å¾…æŸèµ„æºï¼Œç­‰å¾…è¾“å…¥&#x2F;è¾“å‡ºå®Œæˆã€‚</p></li></ul><h5 id="è¿›ç¨‹å…¶å®ƒçš„åŸºæœ¬çŠ¶æ€ï¼š"><a href="#è¿›ç¨‹å…¶å®ƒçš„åŸºæœ¬çŠ¶æ€ï¼š" class="headerlink" title="è¿›ç¨‹å…¶å®ƒçš„åŸºæœ¬çŠ¶æ€ï¼š"></a>è¿›ç¨‹å…¶å®ƒçš„åŸºæœ¬çŠ¶æ€ï¼š</h5><ul><li><p>åˆ›å»ºçŠ¶æ€(New)ï¼šä¸€ä¸ªè¿›ç¨‹æ­£åœ¨è¢«åˆ›å»ºï¼Œè¿˜æ²¡è¢«è½¬åˆ°å°±ç»ªçŠ¶æ€ä¹‹å‰çš„çŠ¶æ€ã€‚</p></li><li><p>ç»“æŸçŠ¶æ€(Exit)ï¼šä¸€ä¸ªè¿›ç¨‹æ­£åœ¨ä»ç³»ç»Ÿä¸­æ¶ˆå¤±æ—¶çš„çŠ¶æ€ï¼Œè¿™æ˜¯å› ä¸ºè¿›ç¨‹ç»“æŸæˆ–ç”±äºå…¶ä»–åŸå› æ‰€å¯¼è‡´ã€‚</p></li></ul><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230606110651191.png" alt="image-20230606110651191" style="zoom:50%;" /><h4 id="è¿›ç¨‹æŒ‚èµ·æ¨¡å‹"><a href="#è¿›ç¨‹æŒ‚èµ·æ¨¡å‹" class="headerlink" title="è¿›ç¨‹æŒ‚èµ·æ¨¡å‹"></a>è¿›ç¨‹æŒ‚èµ·æ¨¡å‹</h4><p> è¿›ç¨‹æŒ‚èµ·ï¼šè¿›ç¨‹ä¸å ç”¨å†…å­˜ç©ºé—´ï¼Œå¤„äºæŒ‚èµ·çŠ¶æ€çš„è¿›ç¨‹æ˜ åƒåœ¨ç£ç›˜ä¸Šã€‚</p><h5 id="æŒ‚èµ·çŠ¶æ€ï¼š"><a href="#æŒ‚èµ·çŠ¶æ€ï¼š" class="headerlink" title="æŒ‚èµ·çŠ¶æ€ï¼š"></a>æŒ‚èµ·çŠ¶æ€ï¼š</h5><ul><li>ï»¿é˜»å¡æŒ‚èµ·çŠ¶æ€ (Blocked-suspendï¼‰ï¼šè¿›ç¨‹åœ¨å¤–å­˜å¹¶<strong>ç­‰å¾…æŸäº‹ä»¶çš„å‡ºç°</strong>ï¼›</li><li>ï»¿å°±ç»ªæŒ‚èµ·çŠ¶æ€ (Ready-suspendï¼‰ï¼šè¿›ç¨‹åœ¨å¤–å­˜ï¼Œä½†<strong>åªè¦è¿›å…¥å†…å­˜ï¼Œå³å¯è¿è¡Œ</strong>ï¼›</li></ul><h5 id="æŒ‚èµ·-Suspendï¼‰ï¼šæŠŠä¸€ä¸ªè¿›ç¨‹ä»å†…å­˜è½¬åˆ°å¤–å­˜ï¼›å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š"><a href="#æŒ‚èµ·-Suspendï¼‰ï¼šæŠŠä¸€ä¸ªè¿›ç¨‹ä»å†…å­˜è½¬åˆ°å¤–å­˜ï¼›å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š" class="headerlink" title="æŒ‚èµ· (Suspendï¼‰ï¼šæŠŠä¸€ä¸ªè¿›ç¨‹ä»å†…å­˜è½¬åˆ°å¤–å­˜ï¼›å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š"></a>æŒ‚èµ· (Suspendï¼‰ï¼šæŠŠä¸€ä¸ªè¿›ç¨‹ä»å†…å­˜è½¬åˆ°å¤–å­˜ï¼›å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</h5><ul><li><p>ï»¿é˜»å¡åˆ°é˜»å¡æŒ‚èµ·ï¼šæ²¡æœ‰è¿›ç¨‹å¤„äºå°±ç»ªçŠ¶æ€æˆ–å°±ç»ªè¿›ç¨‹è¦æ±‚æ›´å¤šå†…å­˜èµ„æºæ—¶ï¼Œä¼šè¿›è¡Œè¿™ç§è½¬æ¢ï¼Œä»¥æäº¤æ–°è¿›ç¨‹æˆ–è¿è¡Œå°±ç»ªè¿›ç¨‹ï¼›</p></li><li><p>ï»¿å°±ç»ªåˆ°å°±ç»ªæŒ‚èµ·ï¼šå½“æœ‰é«˜ä¼˜å…ˆçº§é˜»å¡(ç³»ç»Ÿè®¤ä¸ºä¼šå¾ˆå¿«å°±ç»ªçš„ï¼‰è¿›ç¨‹å’Œä½ä¼˜å…ˆå°±ç»ªè¿›ç¨‹æ—¶ï¼Œç³»ç»Ÿä¼šé€‰æ‹©æŒ‚èµ·ä½ä¼˜å…ˆçº§å°±ç»ªè¿›ç¨‹ï¼›</p></li><li><p>ï»¿è¿è¡Œåˆ°å°±ç»ªæŒ‚èµ·ï¼šå¯¹æŠ¢å…ˆå¼åˆ†æ—¶ç³»ç»Ÿï¼Œå½“æœ‰é«˜ä¼˜å…ˆçº§é˜»å¡æŒ‚èµ·è¿›ç¨‹å› äº‹ä»¶å‡ºç°è€Œè¿›å…¥å°±ç»ªæŒ‚èµ·æ—¶ï¼Œç³»ç»Ÿå¯èƒ½ä¼šæŠŠè¿è¡Œè¿›ç¨‹è½¬åˆ°å°±ç»ªæŒ‚èµ·çŠ¶æ€ï¼›</p></li></ul><h5 id="åœ¨å¤–å­˜æ—¶çš„çŠ¶æ€è½¬æ¢ï¼š"><a href="#åœ¨å¤–å­˜æ—¶çš„çŠ¶æ€è½¬æ¢ï¼š" class="headerlink" title="åœ¨å¤–å­˜æ—¶çš„çŠ¶æ€è½¬æ¢ï¼š"></a>åœ¨å¤–å­˜æ—¶çš„çŠ¶æ€è½¬æ¢ï¼š</h5><ul><li>ï»¿é˜»å¡æŒ‚èµ·åˆ°å°±ç»ªæŒ‚èµ·ï¼šå½“æœ‰é˜»å¡æŒ‚èµ·è¿›ç¨‹å› ç›¸å…³äº‹ä»¶å‡ºç°æ—¶ï¼Œç³»ç»Ÿä¼šæŠŠé˜»å¡æŒ‚èµ·è¿›ç¨‹è½¬æ¢ä¸ºå°±ç»ªæŒ‚èµ·è¿›ç¨‹ã€‚</li></ul><h5 id="è§£æŒ‚-x2F-æ¿€æ´»-Activateï¼‰ï¼šæŠŠä¸€ä¸ªè¿›ç¨‹ä»å¤–å­˜è½¬åˆ°å†…å­˜ï¼›å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š"><a href="#è§£æŒ‚-x2F-æ¿€æ´»-Activateï¼‰ï¼šæŠŠä¸€ä¸ªè¿›ç¨‹ä»å¤–å­˜è½¬åˆ°å†…å­˜ï¼›å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š" class="headerlink" title="è§£æŒ‚&#x2F;æ¿€æ´» (Activateï¼‰ï¼šæŠŠä¸€ä¸ªè¿›ç¨‹ä»å¤–å­˜è½¬åˆ°å†…å­˜ï¼›å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š"></a>è§£æŒ‚&#x2F;æ¿€æ´» (Activateï¼‰ï¼šæŠŠä¸€ä¸ªè¿›ç¨‹ä»å¤–å­˜è½¬åˆ°å†…å­˜ï¼›å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</h5><ul><li>ï»¿å°±ç»ªæŒ‚èµ·åˆ°å°±ç»ªï¼šæ²¡æœ‰å°±ç»ªè¿›ç¨‹æˆ–æŒ‚èµ·å°±ç»ªè¿›ç¨‹ä¼˜å…ˆçº§é«˜äºå°±ç»ªè¿›ç¨‹æ—¶ï¼Œä¼šè¿›è¡Œè¿™ç§è½¬æ¢ï¼›</li><li>ï»¿é˜»å¡æŒ‚èµ·åˆ°é˜»å¡ï¼šå½“ä¸€ä¸ªè¿›ç¨‹é‡Šæ”¾è¶³å¤Ÿå†…å­˜æ—¶ï¼Œç³»ç»Ÿä¼šæŠŠä¸€ä¸ªé«˜ä¼˜å…ˆçº§é˜»å¡æŒ‚èµ·ï¼ˆç³»ç»Ÿè®¤ä¸ºä¼šå¾ˆå¿«å‡ºç°æ‰€ç­‰å¾…çš„äº‹ä»¶ï¼‰è¿›ç¨‹è½¬æ¢ä¸ºé˜»å¡è¿›ç¨‹ï¼›</li></ul><h5 id="OSå¦‚ä½•é€šè¿‡PCBå®Œæˆè¿›ç¨‹çš„è°ƒåº¦ï¼Ÿ"><a href="#OSå¦‚ä½•é€šè¿‡PCBå®Œæˆè¿›ç¨‹çš„è°ƒåº¦ï¼Ÿ" class="headerlink" title="OSå¦‚ä½•é€šè¿‡PCBå®Œæˆè¿›ç¨‹çš„è°ƒåº¦ï¼Ÿ"></a>OSå¦‚ä½•é€šè¿‡PCBå®Œæˆè¿›ç¨‹çš„è°ƒåº¦ï¼Ÿ</h5><h6 id="ğŸŒŸçŠ¶æ€é˜Ÿåˆ—"><a href="#ğŸŒŸçŠ¶æ€é˜Ÿåˆ—" class="headerlink" title="ğŸŒŸçŠ¶æ€é˜Ÿåˆ—"></a>ğŸŒŸçŠ¶æ€é˜Ÿåˆ—</h6><ul><li><p>ï»¿ç”±æ“ä½œç³»ç»Ÿæ¥ç»´æŠ¤ä¸€ç»„é˜Ÿåˆ—ï¼Œç”¨æ¥è¡¨ç¤ºç³»ç»Ÿå½“ä¸­æ‰€æœ‰è¿›ç¨‹çš„å½“å‰çŠ¶æ€ï¼›</p></li><li><p>ï»¿<u><strong>ä¸åŒçš„çŠ¶æ€åˆ†åˆ«ç”¨ä¸åŒçš„é˜Ÿåˆ—æ¥è¡¨ç¤º</strong></u>(å°±ç»ªé˜Ÿåˆ—ã€å„ç§ç±»å‹çš„é˜»å¡é˜Ÿåˆ—ï¼‰ï¼›</p></li><li><p>æ¯ä¸ªè¿›ç¨‹çš„PCBéƒ½æ ¹æ®å®ƒçš„çŠ¶æ€åŠ å…¥åˆ°ç›¸åº”çš„é˜Ÿåˆ—å½“ä¸­ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒçš„PCBä»ä¸€ä¸ªçŠ¶æ€é˜Ÿåˆ—ä¸­è„±ç¦»å‡ºæ¥ï¼ŒåŠ å…¥åˆ°å¦å¤–ä¸€ä¸ªé˜Ÿåˆ—ã€‚</p></li></ul><h3 id="7-3çº¿ç¨‹"><a href="#7-3çº¿ç¨‹" class="headerlink" title="7.3çº¿ç¨‹"></a>7.3çº¿ç¨‹</h3><h4 id="ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹ï¼Ÿ</h4><p>â€‹å¤„ç†å¹¶è¡Œæ“ä½œæ—¶ï¼Œå¦‚æœä½¿ç”¨<strong>å¤šè¿›ç¨‹</strong>æ–¹å¼ï¼Œä¼šå¯¼è‡´å¼€é”€å·¨å¤§(è¿›ç¨‹å ç”¨èµ„æºã€è¿›ç¨‹åˆ‡æ¢å ç”¨æ—¶é—´ã€è¿›ç¨‹å…±äº«æ•°æ®äº§ç”Ÿå¼€é”€)</p><p>â€‹å› æ­¤ï¼Œæˆ‘ä»¬äºŸéœ€æå‡ºä¸€ç§å®ä½“ï¼Œæ»¡è¶³ï¼š1ï¼‰å®ä½“ä¹‹é—´å¯ä»¥å¹¶å‘è¿è¡Œï¼›2ï¼‰å®ä½“ä¹‹é—´å…±äº«åœ°å€ç©ºé—´</p><p>â€‹äºæ˜¯ <strong>çº¿ç¨‹</strong> è¢«æå‡ºï¼</p><h4 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ</h4><p>â€‹ï¼<em>è¿›ç¨‹å½“ä¸­çš„ä¸€æ¡æ‰§è¡Œæµç¨‹ã€‚</em></p><p>ä»ä¸¤ä¸ªæ–¹é¢æ¥é‡æ–°ç†è§£è¿›ç¨‹</p><ul><li>ï»¿ä»èµ„æºç»„åˆçš„è§’åº¦ï¼š<strong>è¿›ç¨‹</strong>æŠŠä¸€ç»„ç›¸å…³çš„èµ„æºç»„åˆèµ·æ¥ï¼Œ<strong>æ„æˆäº†ä¸€ä¸ªèµ„æºå¹³å°ï¼ˆç¯å¢ƒï¼‰</strong>ï¼ŒåŒ…æ‹¬åœ°å€ç©ºé—´ï¼ˆä»£ç æ®µã€æ•°æ®æ®µï¼‰ã€æ‰“å¼€çš„æ–‡ä»¶ç­‰å„ç§èµ„æºï¼›</li><li>ï»¿ä»è¿è¡Œçš„è§’åº¦ï¼šä»£ç åœ¨è¿™ä¸ªèµ„æºå¹³å°ä¸Šçš„ä¸€æ¡æ‰§è¡Œæµç¨‹ï¼ˆçº¿ç¨‹ï¼‰ã€‚</li></ul><h5 id="çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š"><a href="#çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š" class="headerlink" title="çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š"></a>çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š</h5><ul><li>ï»¿ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ªçº¿ç¨‹ï¼›</li><li>ï»¿å„ä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘åœ°æ‰§è¡Œï¼›</li><li>ï»¿å„ä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å…±äº«åœ°å€ç©ºé—´å’Œæ–‡ä»¶ç­‰èµ„æºã€‚</li></ul><h5 id="çº¿ç¨‹çš„ç¼ºç‚¹ï¼š"><a href="#çº¿ç¨‹çš„ç¼ºç‚¹ï¼š" class="headerlink" title="çº¿ç¨‹çš„ç¼ºç‚¹ï¼š"></a>çº¿ç¨‹çš„ç¼ºç‚¹ï¼š</h5><ul><li><strong>ä¸€ä¸ªçº¿ç¨‹å´©æºƒï¼Œä¼šå¯¼è‡´å…¶æ‰€å±è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹å´©æºƒ</strong>ã€‚(å› ä¸ºçº¿ç¨‹é—´å…±äº«æ•°æ®ï¼Œå› æ­¤ä¸€ä¸ªçº¿ç¨‹çš„æ•°æ®é”™è¯¯äº†ï¼Œå…¶ä»–çº¿ç¨‹éƒ½è¦é­æ®ƒ)</li></ul><h5 id="çº¿ç¨‹æ‰€éœ€çš„èµ„æºï¼š"><a href="#çº¿ç¨‹æ‰€éœ€çš„èµ„æºï¼š" class="headerlink" title="çº¿ç¨‹æ‰€éœ€çš„èµ„æºï¼š"></a>çº¿ç¨‹æ‰€éœ€çš„èµ„æºï¼š</h5><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230606161910704.png" alt="image-20230606161910704" style="zoom:50%;" /><h5 id="çº¿ç¨‹ä¸è¿›ç¨‹çš„æ¯”è¾ƒ"><a href="#çº¿ç¨‹ä¸è¿›ç¨‹çš„æ¯”è¾ƒ" class="headerlink" title="çº¿ç¨‹ä¸è¿›ç¨‹çš„æ¯”è¾ƒ"></a>çº¿ç¨‹ä¸è¿›ç¨‹çš„æ¯”è¾ƒ</h5><ul><li><p>ï»¿è¿›ç¨‹æ˜¯èµ„æºåˆ†é…å•ä½ï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦å•ä½ï¼›</p></li><li><p>ï»¿è¿›ç¨‹æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„èµ„æºå¹³å°ï¼Œè€Œçº¿ç¨‹åªç‹¬äº«å¿…ä¸å¯å°‘çš„èµ„æºï¼Œå¦‚å¯„å­˜å™¨å’Œæ ˆï¼›</p></li><li><p>ï»¿çº¿ç¨‹åŒæ ·å…·æœ‰å°±ç»ªã€é˜»å¡å’Œæ‰§è¡Œä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼ŒåŒæ ·å…·æœ‰çŠ¶æ€ä¹‹é—´çš„è½¬æ¢å…³ç³»ï¼›</p></li><li><p>ï»¿çº¿ç¨‹èƒ½å‡å°‘å¹¶å‘æ‰§è¡Œçš„æ—¶é—´å’Œç©ºé—´å¼€é”€ï¼š</p><ul><li><p>çº¿ç¨‹çš„åˆ›å»ºæ—¶é—´æ¯”è¿›ç¨‹çŸ­ï¼›(çº¿ç¨‹æ— éœ€åˆ›å»ºä»£ç å—ã€æ•°æ®ã€æ–‡ä»¶çš„ç®¡ç†ä¿¡æ¯)</p></li><li><p>çº¿ç¨‹çš„ç»ˆæ­¢æ—¶é—´æ¯”è¿›ç¨‹çŸ­ï¼›(çº¿ç¨‹æ— éœ€åˆ›å»ºä»£ç å—ã€æ•°æ®ã€æ–‡ä»¶çš„ç®¡ç†ä¿¡æ¯)</p></li><li><p>åŒä¸€è¿›ç¨‹å†…çš„çº¿ç¨‹åˆ‡æ¢æ—¶é—´æ¯”è¿›ç¨‹çŸ­ï¼›(åœ¨åŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹å…·æœ‰åŒä¸€ä¸ªé¡µè¡¨ï¼Œåˆ‡æ¢æ—¶æ— éœ€åˆ‡æ¢é¡µè¡¨)</p></li><li><p>ç”±äºåŒä¸€è¿›ç¨‹çš„å„çº¿ç¨‹é—´å…±äº«å†…å­˜å’Œæ–‡ä»¶èµ„æºï¼Œå¯ç›´æ¥è¿›è¡Œä¸é€šè¿‡å†…æ ¸çš„é€šä¿¡ï¼›</p></li></ul></li></ul><h4 id="çº¿ç¨‹çš„å®ç°ï¼š"><a href="#çº¿ç¨‹çš„å®ç°ï¼š" class="headerlink" title="çº¿ç¨‹çš„å®ç°ï¼š"></a>çº¿ç¨‹çš„å®ç°ï¼š</h4><p>â€‹ä¸‰ç§ä¸»è¦çš„å®ç°æ–¹å¼ï¼š</p><pre><code> 1. ç”¨æˆ·çº¿ç¨‹ï¼šåœ¨ç”¨æˆ·ç©ºé—´å®ç° 2. å†…æ ¸çº¿ç¨‹ï¼šåœ¨å†…æ ¸ä¸­å®ç° 3. è½»é‡çº§çº¿ç¨‹ï¼šåœ¨å†…æ ¸ä¸­å®ç°ï¼Œæ”¯æŒç”¨æˆ·çº¿ç¨‹</code></pre><h5 id="ğŸŒŸç”¨æˆ·çº¿ç¨‹ï¼š"><a href="#ğŸŒŸç”¨æˆ·çº¿ç¨‹ï¼š" class="headerlink" title="ğŸŒŸç”¨æˆ·çº¿ç¨‹ï¼š"></a>ğŸŒŸç”¨æˆ·çº¿ç¨‹ï¼š</h5><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230606163157885.png" alt="image-20230606163157885" style="zoom:50%;" /><p>OSçœ‹ä¸åˆ°TCBï¼Œåªèƒ½çœ‹åˆ°PCBï¼ŒåªçŸ¥é“è¿›ç¨‹ä¿¡æ¯ï¼Œè¿›ç¨‹ä¸­çš„çº¿ç¨‹ä¿¡æ¯ç”±çº¿ç¨‹åº“ç®¡ç†ã€‚</p><p>åœ¨ç”¨æˆ·ç©ºé—´å®ç°çš„çº¿ç¨‹æœºåˆ¶ï¼Œå®ƒ<strong>ä¸ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„å†…æ ¸</strong>ï¼Œ<strong>ç”±ä¸€ç»„ç”¨æˆ·çº§çš„çº¿ç¨‹åº“å‡½æ•°æ¥å®Œæˆçº¿ç¨‹çš„ç®¡ç†</strong>ï¼ŒåŒ…æ‹¬è¿›ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢ã€åŒæ­¥å’Œè°ƒåº¦ç­‰ã€‚</p><h6 id="ç”¨æˆ·çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š"><a href="#ç”¨æˆ·çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š" class="headerlink" title="ç”¨æˆ·çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š"></a>ç”¨æˆ·çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š</h6><ul><li>ï»¿ç”±äºç”¨æˆ·çº¿ç¨‹çš„ç»´æŠ¤ç”±ç›¸åº”è¿›ç¨‹æ¥å®Œæˆ ï¼ˆé€šè¿‡çº¿ç¨‹åº“å‡½æ•°ï¼‰ï¼Œä¸éœ€è¦æ“ä½œç³»ç»Ÿå†…æ ¸äº†è§£ç”¨æˆ·çº¿ç¨‹çš„å­˜åœ¨ï¼Œ<u>å¯ç”¨äºä¸æ”¯æŒçº¿ç¨‹æŠ€æœ¯çš„å¤šè¿›ç¨‹æ“ä½œç³»ç»Ÿï¼›</u></li><li>ï»¿æ¯ä¸ªè¿›ç¨‹éƒ½éœ€è¦å®ƒè‡ªå·±ç§æœ‰çš„çº¿ç¨‹æ§åˆ¶å—ï¼ˆTCBï¼‰åˆ—è¡¨ï¼Œç”¨æ¥è·Ÿè¸ªè®°å½•å®ƒçš„å„ä¸ªçº¿ç¨‹çš„çŠ¶æ€ä¿¡æ¯ (PCã€æ ˆæŒ‡é’ˆã€å¯„å­˜å™¨ï¼‰ï¼ŒTCBç”±çº¿ç¨‹åº“å‡½æ•°æ¥ç»´æŠ¤ï¼›</li><li>ï»¿ç”¨æˆ·çº¿ç¨‹çš„åˆ‡æ¢ä¹Ÿæ˜¯ç”±çº¿ç¨‹åº“å‡½æ•°æ¥å®Œæˆï¼æ— éœ€ç”¨æˆ·æ€&#x2F; æ ¸å¿ƒæ€åˆ‡æ¢ï¼Œæ‰€ä»¥é€Ÿåº¦ç‰¹åˆ«å¿«ï¼›</li><li>ï»¿å…è®¸æ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰è‡ªå®šä¹‰çš„çº¿ç¨‹è°ƒåº¦ç®—æ³•ã€‚</li></ul><h6 id="ç”¨æˆ·çº¿ç¨‹çš„ç¼ºç‚¹ï¼š"><a href="#ç”¨æˆ·çº¿ç¨‹çš„ç¼ºç‚¹ï¼š" class="headerlink" title="ç”¨æˆ·çº¿ç¨‹çš„ç¼ºç‚¹ï¼š"></a>ç”¨æˆ·çº¿ç¨‹çš„ç¼ºç‚¹ï¼š</h6><ul><li>ï»¿é˜»å¡æ€§çš„ç³»ç»Ÿè°ƒç”¨å¦‚ä½•å®ç°ï¼Ÿå¦‚æœä¸€ä¸ªçº¿ç¨‹å‘èµ·ç³»ç»Ÿè°ƒç”¨è€Œé˜»å¡ï¼Œåˆ™æ•´ä¸ªè¿›ç¨‹åœ¨ç­‰å¾…ï¼›(å› ä¸ºOSåœ¨å†…æ ¸æ€ä¸­åªèƒ½ç®¡ç†è¿›ç¨‹ï¼Œè€Œä¸èƒ½å•ç‹¬åœ°æŠŠè¿›ç¨‹ä¸­çš„æŸä¸ªçº¿ç¨‹é˜»å¡)</li><li>ï»¿å½“ä¸€ä¸ªçº¿ç¨‹å¼€å§‹è¿è¡Œåï¼Œé™¤éå®ƒä¸»åŠ¨åœ°äº¤å‡ºCPUçš„ä½¿ç”¨æƒï¼Œå¦åˆ™å®ƒæ‰€åœ¨çš„è¿›ç¨‹å½“ä¸­çš„å…¶ä»–çº¿ç¨‹å°†æ— æ³•è¿è¡Œï¼›(åŒæ ·ï¼Œå› ä¸ºOSåªèƒ½ç®¡ç†è¿›ç¨‹ï¼Œå› ä¸ºåªæœ‰OSæœ‰ç®¡ç†ä¸­æ–­çš„æƒåˆ©ï¼Œä½†æ˜¯OSçœ‹ä¸åˆ°çº¿ç¨‹)</li><li>ï»¿ç”±äºæ—¶é—´ç‰‡åˆ†é…ç»™è¿›ç¨‹ï¼Œæ•…ä¸å…¶å®ƒè¿›ç¨‹æ¯”ï¼Œåœ¨å¤šçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹å¾—åˆ°çš„æ—¶é—´ç‰‡è¾ƒå°‘ï¼Œæ‰§è¡Œä¼šè¾ƒæ…¢ã€‚</li></ul><h5 id="ğŸŒŸå†…æ ¸çº¿ç¨‹ï¼š"><a href="#ğŸŒŸå†…æ ¸çº¿ç¨‹ï¼š" class="headerlink" title="ğŸŒŸå†…æ ¸çº¿ç¨‹ï¼š"></a>ğŸŒŸå†…æ ¸çº¿ç¨‹ï¼š</h5><p>â€‹<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230606164400117.png" alt="image-20230606164400117" style="zoom:50%;" /></p><p><strong>TCBä¹Ÿæ”¾åœ¨å†…æ ¸ä¸­</strong></p><p>æ˜¯æŒ‡åœ¨æ“ä½œç³»ç»Ÿ<u>çš„å†…æ ¸å½“ä¸­å®ç°çš„ä¸€ç§çº¿ç¨‹æœºåˆ¶</u>ï¼Œç”±æ“ä½œç³»ç»Ÿçš„å†…æ ¸æ¥å®Œæˆçº¿ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢å’Œç®¡ç†ã€‚</p><ul><li>ï»¿åœ¨æ”¯æŒå†…æ ¸çº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œ**<u>ç”±å†…æ ¸æ¥ç»´æŠ¤è¿›ç¨‹å’Œçº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ ï¼ˆPCBå’ŒTCBï¼‰</u>**ï¼›</li><li>ï»¿çº¿ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢å’Œåˆ‡æ¢éƒ½æ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨&#x2F;å†…æ ¸å‡½æ•°çš„æ–¹å¼æ¥è¿›è¡Œï¼Œç”±å†…æ ¸æ¥å®Œæˆï¼Œå› æ­¤ç³»ç»Ÿå¼€é”€è¾ƒå¤§ï¼›</li><li>åœ¨ä¸€ä¸ªè¿›ç¨‹å½“ä¸­ï¼Œå¦‚æœæŸä¸ªå†…æ ¸çº¿ç¨‹å‘èµ·ç³»ç»Ÿè°ƒç”¨è€Œè¢«é˜³å¡ï¼Œäº•ä¸ä¼šå½±å“å…¶ä»–å†…æ ¸çº¿ç¨‹çš„è¿è¡Œï¼š</li><li>æ—¶é—´ç‰‡åˆ†é…ç»™çº¿ç¨‹ï¼Œå¤šçº¿ç¨‹çš„è¿›ç¨‹è·å¾—æ›´å¤šCPUæ—¶é—´ï¼›</li><li>Windows NTå’Œwindows 2000&#x2F;xPæ”¯æŒå†…æ ¸çº¿ç¨‹ã€‚</li></ul><h5 id="ğŸŒŸè½»é‡çº§è¿›ç¨‹-äº†è§£"><a href="#ğŸŒŸè½»é‡çº§è¿›ç¨‹-äº†è§£" class="headerlink" title="ğŸŒŸè½»é‡çº§è¿›ç¨‹(äº†è§£)"></a>ğŸŒŸè½»é‡çº§è¿›ç¨‹(äº†è§£)</h5><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230606164824053.png" alt="image-20230606164824053" style="zoom:30%;" /><h3 id="7-4ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#7-4ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="7.4ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>7.4ä¸Šä¸‹æ–‡åˆ‡æ¢</h3><p>â€‹åœæ­¢å½“å‰è¿è¡Œè¿›ç¨‹(ä»è¿è¡ŒçŠ¶æ€æ”¹å˜æˆå…¶ä»–çŠ¶æ€ï¼‰å¹¶ä¸”è°ƒåº¦å…¶ä»–è¿›ç¨‹ï¼ˆè½¬å˜æˆè¿è¡ŒçŠ¶æ€ï¼‰</p><ul><li>ï»¿å¿…é¡»åœ¨åˆ‡æ¢ä¹‹å‰å­˜å‚¨è®¸å¤šéƒ¨åˆ†çš„è¿›ç¨‹ä¸Šä¸‹æ–‡</li><li>ï»¿å¿…é¡»èƒ½å¤Ÿåœ¨ä¹‹åæ¢å¤ä»–ä»¬ï¼Œæ‰€ä»¥è¿›ç¨‹ä¸èƒ½æ˜¾ç¤ºå®ƒæ›¾ç»è¢«æš‚åœè¿‡</li><li>ï»¿å¿…é¡»å¿«é€Ÿï¼ˆä¸Šä¸‹æ–‡è½¬æ¢æ—¶éå¸¸é¢‘ç¹çš„ï¼‰</li></ul><p>â€‹éœ€è¦å­˜å‚¨ä»€ä¹ˆä¸Šä¸‹æ–‡ï¼Ÿ</p><ul><li><p>å¯„å­˜å™¨(PC, SPï¼Œ â€¦)ï¼ŒCPUçŠ¶æ€ï¼Œâ€¦â€¦</p></li><li><p>ä¸€äº›æ—¶å€™å¯èƒ½ä¼šè´¹æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°½å¯èƒ½é¿å…</p></li></ul><h3 id="7-5è¿›ç¨‹æ§åˆ¶"><a href="#7-5è¿›ç¨‹æ§åˆ¶" class="headerlink" title="7.5è¿›ç¨‹æ§åˆ¶"></a>7.5è¿›ç¨‹æ§åˆ¶</h3><h4 id="åˆ›å»ºè¿›ç¨‹"><a href="#åˆ›å»ºè¿›ç¨‹" class="headerlink" title="åˆ›å»ºè¿›ç¨‹"></a>åˆ›å»ºè¿›ç¨‹</h4><p>forkå‡½æ•°ï¼šforkå‡½æ•°ç”¨äº<u>ä»å·²ç»å­˜åœ¨çš„è¿›ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹</u>ã€‚æ–°çš„è¿›ç¨‹ç§°ä¸ºå­è¿›ç¨‹ï¼Œè€ŒåŸæ¥çš„è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹ã€‚</p><p><strong><u><em>è¿”å›å€¼ï¼šå­è¿›ç¨‹ä¸­è¿”å›0ï¼Œçˆ¶è¿›ç¨‹è¿”å›å­è¿›ç¨‹idï¼Œå‡ºé”™è¿”å›-1</em></u></strong></p><p>å½“ä¸€ä¸ªè¿›ç¨‹è°ƒç”¨forkä¹‹åï¼Œå°±æœ‰ä¸¤ä¸ªäºŒè¿›åˆ¶ä»£ç ç›¸åŒçš„è¿›ç¨‹ã€‚è€Œä¸”å®ƒä»¬éƒ½è¿è¡Œåˆ°ç›¸åŒçš„åœ°æ–¹ã€‚ä½†æ¯ä¸ªè¿›ç¨‹éƒ½å°†å¯ä»¥å¼€å§‹å®ƒä»¬è‡ªå·±çš„æ—…ç¨‹</p><p>fork()çš„ç®€å•å®ç°</p><ul><li>å¯¹å­è¿›ç¨‹åˆ†é…å†…å­˜</li><li>å¤åˆ¶çˆ¶è¿›ç¨‹çš„å†…å­˜å’ŒCPUå¯„å­˜å™¨åˆ°å­è¿›ç¨‹</li><li>å¼€é”€æ˜‚è´µ</li></ul><p>åœ¨99%çš„æƒ…å†µä¸‹,æˆ‘ä»¬åœ¨è°ƒç”¨fork()ä¹‹åè°ƒç”¨exec() â€”ä¾æ®å®é™…æƒ…å†µå¾—å‡º</p><ul><li>åœ¨fork()æ“ä½œä¸­å†…å­˜å¤åˆ¶æ˜¯æ²¡æœ‰ä½œç”¨çš„ï¼ˆå› ä¸ºä½ forkå®Œåç«‹é©¬å»æ‰§è¡Œæ–°çš„ç¨‹åºï¼Œä¼šæŠŠä½ å¤åˆ¶çš„ä¸œè¥¿éƒ½è¦†ç›–äº†</li><li>å­è¿›ç¨‹å°†å¯èƒ½å…³é—­æ‰“å¼€çš„æ–‡ä»¶å’Œè¿æ¥</li><li>å¼€é”€å› æ­¤æ˜¯æœ€é«˜çš„</li></ul><p>vfork()</p><ol><li><p>vforkç”¨äºåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹å…±äº«åœ°å€ç©ºé—´ã€‚(forkçš„å­è¿›ç¨‹æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´)</p></li><li><p>vforkä¿è¯å­è¿›ç¨‹å…ˆè¿è¡Œï¼Œåœ¨å­è¿›ç¨‹è°ƒç”¨execæˆ–exitä¹‹åçˆ¶è¿›ç¨‹æ‰å¯èƒ½è¢«è°ƒåº¦è¿è¡Œã€‚</p></li></ol><ul><li>ä¸€ä¸ªåˆ›å»ºè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨,ä¸éœ€è¦åˆ›å»ºä¸€ä¸ªåŒæ ·çš„å†…å­˜æ˜ åƒ</li><li>ä¸€äº›æ—¶å€™ç§°ä¸ºè½»é‡çº§fork()</li><li>å­è¿›ç¨‹åº”è¯¥å‡ ä¹ç«‹å³è°ƒç”¨exec()</li><li>ç°åœ¨ä¸å†ä½¿ç”¨å¦‚æœæˆ‘ä»¬ä½¿ç”¨ copy on write æŠ€æœ¯(æŒ‰éœ€å¤åˆ¶ï¼Œä¸å¤åˆ¶é‚£äº›ä¼šè¢«è¦†ç›–çš„éƒ¨åˆ†ï¼Œåªå¤åˆ¶è¿›ç¨‹åˆ›å»ºå¿…é¡»çš„éƒ¨åˆ†)</li></ul><h4 id="åŠ è½½å’Œæ‰§è¡Œè¿›ç¨‹"><a href="#åŠ è½½å’Œæ‰§è¡Œè¿›ç¨‹" class="headerlink" title="åŠ è½½å’Œæ‰§è¡Œè¿›ç¨‹"></a>åŠ è½½å’Œæ‰§è¡Œè¿›ç¨‹</h4><p>â€‹exec()å‡½æ•°ï¼šè®©å½“å‰è¿›ç¨‹æ‰§è¡Œæ–°çš„ç¨‹åº</p><p>â€‹exec()è°ƒç”¨å…è®¸ä¸€ä¸ªè¿›ç¨‹â€åŠ è½½â€ä¸€ä¸ªä¸åŒçš„ç¨‹åºå¹¶ä¸”åœ¨mainå¼€å§‹æ‰§è¡Œ(äº‹å®ä¸Š _start)</p><p>â€‹å®ƒå…è®¸ä¸€ä¸ªè¿›ç¨‹æŒ‡å®šå‚æ•°çš„æ•°é‡(argc)å’Œå®ƒå­—ç¬¦ä¸²å‚æ•°æ•°ç»„(argv)</p><h4 id="ç­‰å¾…å’Œç»ˆæ­¢è¿›ç¨‹"><a href="#ç­‰å¾…å’Œç»ˆæ­¢è¿›ç¨‹" class="headerlink" title="ç­‰å¾…å’Œç»ˆæ­¢è¿›ç¨‹"></a>ç­‰å¾…å’Œç»ˆæ­¢è¿›ç¨‹</h4><p>â€‹wait()ç³»ç»Ÿè°ƒç”¨ æ˜¯è¢«çˆ¶è¿›ç¨‹ç”¨æ¥ç­‰å¾…å­è¿›ç¨‹çš„ç»“æŸ</p><ul><li><p>ä¸€ä¸ªå­è¿›ç¨‹å‘çˆ¶è¿›ç¨‹è¿”å›ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥çˆ¶è¿›ç¨‹å¿…é¡»æ¥å—è¿™ä¸ªå€¼å¹¶å¤„ç†</p></li><li><p>ï»¿wait()ç³»ç»Ÿè°ƒç”¨æ‹…ä»»è¿™ä¸ªè¦æ±‚</p><ul><li><p>ï»¿å®ƒä½¿çˆ¶è¿›ç¨‹å»ç¡çœ æ¥ç­‰å¾…å­è¿›ç¨‹çš„ç»“æœ</p></li><li><p>ï»¿å½“ä¸€ä¸ªå­è¿›ç¨‹è°ƒç”¨exit(çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿè§£é”çˆ¶è¿›ç¨‹ï¼Œå¹¶ä¸”å°†é€šè¿‡exit()ä¼ é€’å¾—åˆ°çš„è¿”å›å€¼ä½œä¸ºwaitè°ƒç”¨çš„ä¸€ä¸ªç»“æœ(è¿åŒå­è¿›ç¨‹çš„pidä¸€èµ·ï¼‰å¦‚æœè¿™é‡Œæ²¡æœ‰å­è¿›ç¨‹å­˜æ´»ï¼Œwait()ç«‹åˆ»è¿”å›</p></li><li><p>å½“ç„¶ï¼Œå¦‚æœè¿™é‡Œæœ‰ä¸ºçˆ¶è¿›ç¨‹çš„åƒµå°¸ç­‰å¾…ï¼Œwait(ç«‹å³è¿”å›å…¶ä¸­ä¸€ä¸ªå€¼(å¹¶ä¸”è§£é™¤åƒµå°¸çŠ¶æ€ï¼‰</p></li></ul></li><li><p>ï»¿è¿›ç¨‹ç»“æŸæ‰§è¡Œä¹‹åï¼Œå®ƒè°ƒç”¨exit()</p></li><li><p>ï»¿è¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼š</p><ul><li><p>ï»¿å°†è¿™ç¨‹åºçš„ â€œç»“æœâ€ ä½œä¸ºä¸€ä¸ªå‚æ•°</p></li><li><p>ï»¿å…³é—­æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶ï¼Œè¿æ¥ç­‰ç­‰</p></li><li><p>ï»¿é‡Šæ”¾å†…å­˜</p></li><li><p>ï»¿é‡Šæ”¾å¤§éƒ¨åˆ†æ”¯æŒè¿›ç¨‹çš„æ“ä½œç³»ç»Ÿç»“æ„</p></li><li><p>ï»¿æ£€æŸ¥æ˜¯å¦çˆ¶è¿›ç¨‹æ˜¯å­˜æ´»ç€çš„ï¼š</p><ul><li><p>ï»¿ï»¿å¦‚æœæ˜¯çš„è¯ã€‚å®ƒä¿ç•™ç»“æœçš„å€¼ç›´åˆ°çˆ¶è¿›ç¨‹éœ€è¦å®ƒï¼šåœ¨è¿™ç§æƒ…å†µé‡Œã€‚è¿›ç¨‹æ²¡æœ‰çœŸæ­£<br> æ­»äº¡ï¼Œä½†æ˜¯å®ƒè¿›å…¥äº†åƒµå°¸ (zombie&#x2F; defunct)çŠ¶æ€</p></li><li><p>ï»¿å¦‚æœæ²¡æœ‰ï¼Œå­è¿›ç¨‹å°†è¢«initè¿›ç¨‹æ¥ç®¡ï¼Œinitä»£æ›¿å…¶çˆ¶è¿›ç¨‹ï¼Œé‡Šæ”¾å…¶æ‰€æœ‰çš„æ•°æ®ç»“æ„</p></li></ul></li><li><p>ï»¿æ¸…ç†æ‰€æœ‰ç­‰å¾…çš„åƒµå°¸è¿›ç¨‹</p></li></ul></li><li><p>ï»¿è¿›ç¨‹ç»ˆæ­¢æ˜¯æœ€ç»ˆçš„åƒåœ¾æ”¶é›†ï¼ˆèµ„æºå›æ”¶ï¼‰</p></li></ul><h4 id="è¿›ç¨‹çŠ¶æ€å›¾ï¼š"><a href="#è¿›ç¨‹çŠ¶æ€å›¾ï¼š" class="headerlink" title="è¿›ç¨‹çŠ¶æ€å›¾ï¼š"></a>è¿›ç¨‹çŠ¶æ€å›¾ï¼š</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230606200728246.png" alt="image-20230606200728246" style="zoom:50%;" /><h2 id="Chapter8-CPUè°ƒåº¦"><a href="#Chapter8-CPUè°ƒåº¦" class="headerlink" title="Chapter8 CPUè°ƒåº¦"></a>Chapter8 CPUè°ƒåº¦</h2><h3 id="8-1èƒŒæ™¯"><a href="#8-1èƒŒæ™¯" class="headerlink" title="8.1èƒŒæ™¯"></a>8.1èƒŒæ™¯</h3><h4 id="CPUè°ƒåº¦"><a href="#CPUè°ƒåº¦" class="headerlink" title="CPUè°ƒåº¦"></a>CPUè°ƒåº¦</h4><ul><li>ä»å°±ç»ªé˜Ÿåˆ—ä¸­æŒ‘é€‰ä¸€ä¸ªè¿›ç¨‹&#x2F;çº¿ç¨‹ä½œä¸ºCPUå°†è¦è¿è¡Œçš„ä¸‹ä¸€ä¸ªçº¿ç¨‹&#x2F;è¿›ç¨‹</li><li>è°ƒåº¦ç¨‹åºï¼šæŒ‘é€‰è¿›ç¨‹&#x2F;çº¿ç¨‹çš„å†…æ ¸å‡½æ•°(é€šè¿‡ä¸€äº›è°ƒåº¦ç­–ç•¥)</li><li>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œè°ƒåº¦ï¼Ÿâ€”â€”çº¿ç¨‹ã€è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸä¸­çŠ¶æ€çš„è½¬åŒ–æ—¶ï¼Œä¼šè¿›è¡Œè°ƒåº¦</li></ul><p></p><h4 id="CPUè°ƒåº¦æ—¶é—´"><a href="#CPUè°ƒåº¦æ—¶é—´" class="headerlink" title="CPUè°ƒåº¦æ—¶é—´"></a>CPUè°ƒåº¦æ—¶é—´</h4><p>â€‹æ»¡è¶³ä¸€æ¡å³å¯ï¼ši): ä¸€ä¸ªè¿›ç¨‹ä»è¿è¡ŒçŠ¶æ€-&gt;ç­‰å¾…çŠ¶æ€; ii):ä¸€ä¸ªè¿›ç¨‹è¢«ç»ˆç»“äº†</p><ul><li>ä¸å¯æŠ¢å ï¼š<ul><li>è°ƒåº¦ç¨‹åºå¿…é¡»ç­‰å¾…äº‹ä»¶ç»“æŸ</li></ul></li><li>å¯æŠ¢å ï¼š<ul><li>è°ƒåº¦ç¨‹åºåœ¨ä¸­æ–­è¢«å“åº”åæ‰§è¡Œ</li><li>å½“å‰çš„è¿›ç¨‹ä»è¿è¡Œåˆ‡æ¢åˆ°å°±ç»ªï¼Œæˆ–è€…ä¸€ä¸ªè¿›ç¨‹ä»ç­‰å¾…åˆ‡æ¢åˆ°å°±ç»ª</li><li>å½“å‰è¿è¡Œçš„è¿›ç¨‹å¯ä»¥è¢«æ¢å‡º</li></ul></li></ul><h3 id="8-2è°ƒåº¦å‡†åˆ™"><a href="#8-2è°ƒåº¦å‡†åˆ™" class="headerlink" title="8.2è°ƒåº¦å‡†åˆ™"></a>8.2è°ƒåº¦å‡†åˆ™</h3><h4 id="è°ƒåº¦ç­–ç•¥"><a href="#è°ƒåº¦ç­–ç•¥" class="headerlink" title="è°ƒåº¦ç­–ç•¥"></a>è°ƒåº¦ç­–ç•¥</h4><h4 id="ç¨‹åºæ‰§è¡Œæ¨¡å‹"><a href="#ç¨‹åºæ‰§è¡Œæ¨¡å‹" class="headerlink" title="ç¨‹åºæ‰§è¡Œæ¨¡å‹"></a>ç¨‹åºæ‰§è¡Œæ¨¡å‹</h4><p>â€‹ç¨‹åºåœ¨CPUçªå‘å’ŒI&#x2F;Oä¸­äº¤æ›¿</p><ul><li>æ¯ä¸ªè°ƒåº¦å†³å®šéƒ½æ˜¯å…³äºåœ¨ä¸‹ä¸€ä¸ªCPUçªå‘æ—¶å°†å“ªä¸ªå·¥ä½œäº¤ç»™CPU</li><li>åœ¨æ—¶é—´åˆ†ç‰‡æœºåˆ¶ä¸‹ï¼Œçº¿ç¨‹å¯èƒ½åœ¨ç»“æŸå½“å‰CPUçªå‘å‰è¢«è¿«æ”¾å¼ƒCPU</li></ul><h4 id="æ¯”è¾ƒè°ƒåº¦ç®—æ³•çš„å‡†åˆ™"><a href="#æ¯”è¾ƒè°ƒåº¦ç®—æ³•çš„å‡†åˆ™" class="headerlink" title="æ¯”è¾ƒè°ƒåº¦ç®—æ³•çš„å‡†åˆ™"></a>æ¯”è¾ƒè°ƒåº¦ç®—æ³•çš„å‡†åˆ™</h4><h5 id="1-CPUä½¿ç”¨ç‡"><a href="#1-CPUä½¿ç”¨ç‡" class="headerlink" title="1.CPUä½¿ç”¨ç‡"></a>1.CPUä½¿ç”¨ç‡</h5><ul><li>CPUå¤„äºå¿™çŠ¶æ€æ‰€å æ—¶é—´çš„ç™¾åˆ†æ¯”</li></ul><h5 id="2-ååé‡"><a href="#2-ååé‡" class="headerlink" title="2.ååé‡"></a>2.ååé‡</h5><ul><li>åœ¨å•ä½æ—¶é—´å†…å®Œæˆçš„è¿›ç¨‹æ•°é‡</li></ul><h5 id="3-å‘¨è½¬æ—¶é—´"><a href="#3-å‘¨è½¬æ—¶é—´" class="headerlink" title="3.å‘¨è½¬æ—¶é—´"></a>3.å‘¨è½¬æ—¶é—´</h5><ul><li><u>ä¸€ä¸ªè¿›ç¨‹ä»åˆå§‹åŒ–åˆ°ç»“æŸï¼ŒåŒ…æ‹¬æ‰€æœ‰ç­‰å¾…æ—¶é—´</u>æ‰€èŠ±è´¹çš„æ—¶é—´</li></ul><h5 id="4-ç­‰å¾…æ—¶é—´"><a href="#4-ç­‰å¾…æ—¶é—´" class="headerlink" title="4.ç­‰å¾…æ—¶é—´"></a>4.ç­‰å¾…æ—¶é—´</h5><ul><li>è¿›ç¨‹åœ¨<u>å°±ç»ªé˜Ÿåˆ—</u>ä¸­çš„æ€»æ—¶é—´</li></ul><h5 id="5-å“åº”æ—¶é—´"><a href="#5-å“åº”æ—¶é—´" class="headerlink" title="5.å“åº”æ—¶é—´"></a>5.å“åº”æ—¶é—´</h5><ul><li>ä»ä¸€ä¸ªè¯·æ±‚<u>è¢«æäº¤</u>åˆ°<u>äº§ç”Ÿç¬¬ä¸€æ¬¡å“åº”</u>æ‰€èŠ±è´¹çš„æ€»æ—¶é—´</li></ul><p>â€‹å‡å°‘å“åº”æ—¶é—´ï¼šåŠæ—¶å¤„ç†ç”¨æˆ·çš„è¾“å‡ºå¹¶ä¸”å°½å¿«å°†è¾“å‡ºæä¾›ç»™ç”¨æˆ·</p><p>â€‹å‡å°‘å¹³å‡å“åº”æ—¶é—´æ³¢åŠ¨ï¼šåœ¨äº¤äº’ç³»ç»Ÿä¸­ï¼Œå¯é¢„æµ‹æ€§æ¯”é«˜ä½å·®å¼‚å¹³å‡æ›´é‡è¦</p><p>â€‹å¢åŠ ååé‡ï¼ši): å‡å°‘å¼€é”€(æ“ä½œç³»ç»Ÿå¼€é”€ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢) ii):ç³»ç»Ÿèµ„æºçš„é«˜æ•ˆåˆ©ç”¨(CPUï¼ŒI&#x2F;Oè®¾å¤‡)ã€</p><p>â€‹å‡å°‘ç­‰å¾…æ—¶é—´</p><p>â€‹ä½å»¶è¿Ÿåˆ©äºç³»ç»Ÿä¸ç”¨æˆ·çš„äº¤äº’</p><p>â€‹å³ä½¿å­˜åœ¨è®¸å¤šäº¤äº’ä»»åŠ¡ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¿è¯ååé‡ä¸å—å½±å“</p><p>â€‹</p><h4 id="ååé‡vså»¶è¿Ÿ"><a href="#ååé‡vså»¶è¿Ÿ" class="headerlink" title="ååé‡vså»¶è¿Ÿ"></a>ååé‡vså»¶è¿Ÿ</h4><p>ååé‡æ˜¯OSçš„è®¡ç®—å¸¦å®½ï¼Œå“åº”æ—¶é—´æ˜¯OSçš„è®¡ç®—å»¶è¿Ÿ</p><h4 id="å…¬å¹³çš„ç›®æ ‡"><a href="#å…¬å¹³çš„ç›®æ ‡" class="headerlink" title="å…¬å¹³çš„ç›®æ ‡"></a>å…¬å¹³çš„ç›®æ ‡</h4><p>â€‹ä¿è¯æ¯ä¸ªè¿›ç¨‹å ç”¨ç›¸åŒçš„CPUæ—¶é—´â€”â€”ä¼šå¢åŠ å¹³å‡å“åº”æ—¶é—´(çœŸçš„è¦è®¾è®¡æˆå…¬å¹³çš„å—ï¼Ÿ)</p><h3 id="8-3è°ƒåº¦ç®—æ³•"><a href="#8-3è°ƒåº¦ç®—æ³•" class="headerlink" title="8.3è°ƒåº¦ç®—æ³•"></a>8.3è°ƒåº¦ç®—æ³•</h3><h4 id="1-å…ˆæ¥å…ˆæœåŠ¡-FCFS"><a href="#1-å…ˆæ¥å…ˆæœåŠ¡-FCFS" class="headerlink" title="1.å…ˆæ¥å…ˆæœåŠ¡(FCFS)"></a>1.å…ˆæ¥å…ˆæœåŠ¡(FCFS)</h4><h5 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h5><ul><li>ç®€å•</li></ul><h5 id="ç¼ºç‚¹ï¼š-1"><a href="#ç¼ºç‚¹ï¼š-1" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><ul><li>å¹³å‡ç­‰å¾…æ—¶é—´æ³¢åŠ¨è¾ƒå¤§</li><li>èŠ±è´¹æ—¶é—´å°‘çš„ä»»åŠ¡å¯èƒ½æ’åœ¨èŠ±è´¹æ—¶é—´é•¿çš„ä»»åŠ¡åé¢</li><li>å¯èƒ½å¯¼è‡´I&#x2F;0å’ŒCPUä¹‹é—´çš„é‡å å¤„ç†<ul><li>ï»¿CPUå¯†é›†å‹è¿›ç¨‹ä¼šå¯¼è‡´I&#x2F;0è®¾å¤‡é—²ç½®æ—¶ï¼ŒI&#x2F;0å¯†é›†å‹è¿›ç¨‹ä¹Ÿåœ¨ç­‰å¾…</li></ul></li></ul><h4 id="2-çŸ­è¿›ç¨‹ä¼˜å…ˆ-x2F-çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ"><a href="#2-çŸ­è¿›ç¨‹ä¼˜å…ˆ-x2F-çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ" class="headerlink" title="2.çŸ­è¿›ç¨‹ä¼˜å…ˆ&#x2F;çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ"></a>2.çŸ­è¿›ç¨‹ä¼˜å…ˆ&#x2F;çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆ</h4><p><strong>æœ‰æŠ¢å å¼</strong>ã€<strong>éæŠ¢å å¼</strong>çš„ä¸¤ç§æ–¹æ¡ˆ</p><h5 id="ä¼˜ç‚¹ï¼š-1"><a href="#ä¼˜ç‚¹ï¼š-1" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h5><ul><li>æœ€ä¼˜çš„å¹³å‡ç­‰å¾…æ—¶é—´</li></ul><h5 id="ç¼ºç‚¹ï¼š-2"><a href="#ç¼ºç‚¹ï¼š-2" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><ul><li>å¯èƒ½å¯¼è‡´é¥¥é¥¿<ul><li>è¿ç»­çš„çŸ­ä»»åŠ¡æµä¼š<strong>ä½¿é•¿ä»»åŠ¡é¥¥é¥¿</strong></li><li>çŸ­ä»»åŠ¡å¯ç”¨æ—¶ï¼Œä»»ä½•é•¿ä»»åŠ¡çš„CPUæ—¶é—´éƒ½ä¼šå¢åŠ å¹³å‡ç­‰å¾…æ—¶é—´</li></ul></li><li>éœ€è¦é¢„çŸ¥æœªæ¥<ul><li>æˆ‘ä»¬æ€ä¹ˆåœ¨è¿è¡Œè¿›ç¨‹ä¹‹å‰å°±æå‰çŸ¥é“è¿›ç¨‹è¦è¿è¡Œå¤šä¹…ï¼Ÿ<ul><li>æœ€ç®€å•çš„æ–¹æ³•â€”â€”è¯¢é—®ç”¨æˆ·ï¼Œå¦‚æœç”¨æˆ·æ’’è°ï¼Œå°±æ€æ­»è¿›ç¨‹</li><li>å¦‚æœç”¨äºä¸èƒ½ç»™å‡ºæ—¶é—´ï¼Œé‚£ä¹ˆOSè¿›è¡Œé¢„ä¼°(æ ¹æ®ä¹‹å‰çš„è®°å½•)</li></ul></li></ul></li></ul><h4 id="3-æœ€é«˜å“åº”æ¯”ä¼˜å…ˆ"><a href="#3-æœ€é«˜å“åº”æ¯”ä¼˜å…ˆ" class="headerlink" title="3.æœ€é«˜å“åº”æ¯”ä¼˜å…ˆ"></a>3.æœ€é«˜å“åº”æ¯”ä¼˜å…ˆ</h4><p>â€‹åœ¨2çš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ”¹è¿›ï¼Œè€ƒè™‘R ( R &#x3D; (w + s) &#x2F; s ) w:ç­‰å¾…æ—¶é—´ s:æ‰§è¡Œæ—¶é—´</p><h5 id="ä¼˜ç‚¹ï¼š-2"><a href="#ä¼˜ç‚¹ï¼š-2" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h5><ul><li>ä¸å¯æŠ¢å </li><li>å…³æ³¨è¿›ç¨‹ç­‰å¾…äº†å¤šé•¿æ—¶é—´</li><li>é˜²æ­¢æ— é™æœŸæ¨è¿Ÿ</li></ul><h5 id="ç¼ºç‚¹ï¼š-3"><a href="#ç¼ºç‚¹ï¼š-3" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><ul><li>éœ€è¦é¢„çŸ¥æœªæ¥<ul><li>æˆ‘ä»¬æ€ä¹ˆåœ¨è¿è¡Œè¿›ç¨‹ä¹‹å‰å°±æå‰çŸ¥é“è¿›ç¨‹è¦è¿è¡Œå¤šä¹…ï¼Ÿ<ul><li>æœ€ç®€å•çš„æ–¹æ³•â€”â€”è¯¢é—®ç”¨æˆ·ï¼Œå¦‚æœç”¨æˆ·æ’’è°ï¼Œå°±æ€æ­»è¿›ç¨‹</li><li>å¦‚æœç”¨äºä¸èƒ½ç»™å‡ºæ—¶é—´ï¼Œé‚£ä¹ˆOSè¿›è¡Œé¢„ä¼°(æ ¹æ®ä¹‹å‰çš„è®°å½•)</li></ul></li></ul></li></ul><h4 id="4-è½®è¯¢-RR"><a href="#4-è½®è¯¢-RR" class="headerlink" title="4.è½®è¯¢(RR)"></a>4.è½®è¯¢(RR)</h4><ul><li>ï»¿RR èŠ±é”€ï¼šé¢å¤–çš„<strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>å¼€é”€</li><li>ï»¿æ—¶é—´é‡å­å¤ªå¤§<ul><li>ç­‰å¾…æ—¶é—´è¿‡é•¿</li><li>æé™æƒ…å†µé€€åŒ–æˆFCFS</li></ul></li><li>ï»¿æ—¶é—´é‡å­å¤ªå°<ul><li>ååº”è¿…é€Ÿä½†æ˜¯åˆ‡æ¢é¢‘ç¹ï¼Œå¼€é”€å¤§</li><li>ååé‡ç”±äºå¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å—åˆ°å½±å“</li></ul></li><li>ï»¿ç›®æ ‡ï¼š<ul><li>é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æ—¶é—´é‡å­</li><li>ç»éªŒè§„åˆ™ï¼šç»´æŒä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¤„äº1%ä»¥å†…</li></ul></li></ul><p>â€”â€”RRçš„ä¼˜åŒ–</p><ul><li>ï»¿å°±ç»ªé˜Ÿåˆ—è¢«åˆ’åˆ†æˆç‹¬ç«‹çš„é˜Ÿåˆ—ï¼š<ul><li>E.g. å‰å°ï¼ˆäº¤äº’ï¼‰, åå°ï¼ˆæ‰¹å¤„ç†ï¼‰</li></ul></li><li>ï»¿æ¯ä¸ªé˜Ÿåˆ—æ‹¥æœ‰è‡ªå·±çš„è°ƒåº¦ç­–ç•¥<ul><li>E.g. å‰å°ä¸€RRï¼Œåå°â€”FCFS</li></ul></li><li>ï»¿è°ƒåº¦å¿…é¡»åœ¨é˜Ÿåˆ—é—´è¿›è¡Œ<ul><li>å›ºå®šä¼˜å…ˆçº§</li><li>ï»¿å…ˆå¤„ç†å‰å°ï¼Œç„¶åå¤„ç†åå°</li><li>å¯èƒ½å¯¼è‡´é¥¥é¥¿</li><li>æ—¶é—´åˆ‡ç‰‡<ul><li>æ¯ä¸ªé˜Ÿåˆ—éƒ½å¾—åˆ°ä¸€ä¸ªç¡®å®šçš„èƒ½å¤Ÿè°ƒåº¦å…¶è¿›ç¨‹çš„CPUæ€»æ—¶é—´</li><li>E.g. 80%ç»™ä½¿ç”¨RRçš„å‰å°ï¼Œ20%ç»™ä½¿ç”¨FCFSçš„åå°</li></ul></li></ul></li></ul><h4 id="5-å¤šçº§åé¦ˆé˜Ÿåˆ—"><a href="#5-å¤šçº§åé¦ˆé˜Ÿåˆ—" class="headerlink" title="5.å¤šçº§åé¦ˆé˜Ÿåˆ—"></a>5.å¤šçº§åé¦ˆé˜Ÿåˆ—</h4><ul><li>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åœ¨ä¸åŒé˜Ÿåˆ—ä¸­ç§»åŠ¨<ul><li>æ—¶é—´é‡å­å¤§å°éšä¼˜å…ˆçº§çº§åˆ«çš„å¢åŠ è€Œå¢åŠ </li><li>å¦‚æœä»»åŠ¡åœ¨å½“å‰çš„æ—¶é—´é‡å­ä¸­æ²¡æœ‰å®Œæˆï¼Œåˆ™é™åˆ°ä¸‹ä¸€ä¼˜å…ˆçº§</li></ul></li></ul><h5 id="ä¼˜ç‚¹ï¼š-3"><a href="#ä¼˜ç‚¹ï¼š-3" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h5><ul><li>CPUå¯†é›†å‹ä»»åŠ¡çš„ä¼˜å…ˆçº§ä¸‹é™å¾ˆå¿«</li><li>I&#x2F;Oå¯†é›†å‹ä»»åŠ¡åœç•™åœ¨é«˜ä¼˜å…ˆçº§</li></ul><h4 id="6-å…¬å¹³å…±äº«é˜Ÿåˆ—"><a href="#6-å…¬å¹³å…±äº«é˜Ÿåˆ—" class="headerlink" title="6.å…¬å¹³å…±äº«é˜Ÿåˆ—"></a>6.å…¬å¹³å…±äº«é˜Ÿåˆ—</h4><ul><li>FFSæ§åˆ¶ç”¨æˆ·å¯¹ç³»ç»Ÿèµ„æºçš„è®¿é—®<ul><li>ä¸€äº›ç”¨æˆ·ç»„æ¯”å…¶ä»–ç”¨æˆ·ç»„æ›´é‡è¦</li><li>ä¿è¯ä¸é‡è¦çš„ç»„æ— æ³•å„æ–­èµ„æº</li><li>æœªä½¿ç”¨çš„èµ„æºæŒ‰ç…§æ¯ä¸ªç»„æ‰€åˆ†é…çš„èµ„æºçš„æ¯”ä¾‹æ¥åˆ†é…</li><li>æ²¡æœ‰è¾¾åˆ°èµ„æºä½¿ç”¨ç‡ç›®æ ‡çš„ç»„è·å¾—æ›´é«˜çš„ä¼˜å…ˆçº§</li></ul></li></ul><h3 id="8-4å®æ—¶è°ƒåº¦"><a href="#8-4å®æ—¶è°ƒåº¦" class="headerlink" title="8.4å®æ—¶è°ƒåº¦"></a>8.4å®æ—¶è°ƒåº¦</h3><h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>â€‹æ­£ç¡®æ€§ä¾èµ–äºæ—¶é—´ä¸åŠŸèƒ½ä¸¤æ–¹é¢</p><p>â€‹<u>éœ€è¦ä¿è¯<strong>åŠæ—¶æ€§</strong></u>ï¼Œé€Ÿåº¦å’Œå¹³å‡æ€§èƒ½æ²¡é‚£ä¹ˆé‡è¦</p><ul><li><p>å¼ºå®æ—¶ç³»ç»Ÿ</p><ul><li>éœ€è¦åœ¨<u>ä¿è¯çš„æ—¶é—´å†…å®Œæˆé‡è¦çš„ä»»åŠ¡</u>ï¼Œå¿…é¡»å®Œæˆ</li></ul></li><li><p>å¼±å®æ—¶ç³»ç»Ÿ</p><ul><li>è¦æ±‚<u>é‡è¦çš„è¿›ç¨‹çš„ä¼˜å…ˆçº§æ›´é«˜</u>ï¼Œå°½é‡å®Œæˆï¼Œå¹¶éå¿…é¡»</li></ul></li><li><p>ç¡¬æ—¶é™</p><ul><li><p>å¦‚æœé”™è¿‡äº†æœ€åæœŸé™ï¼Œå¯èƒ½ä¼šå‘ç”Ÿç¾éš¾æ€§æˆ–éå¸¸ä¸¥é‡çš„åæœ</p></li><li><p>å¿…é¡»éªŒè¯ï¼šåœ¨æœ€åçš„æƒ…å†µä¸‹ä¹Ÿèƒ½å¤Ÿæ»¡è¶³æ—¶é™å—ï¼Ÿ</p></li><li><p>ä¿è¯ç¡®å®šæ€§</p></li></ul></li><li><p>è½¯æ—¶é™</p><ul><li><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œæ—¶é™åº”è¯¥è¢«æœ€å¤§æ»¡è¶³ã€‚å¦‚æœæœ‰æ—¶é™æ²¡æœ‰è¢«æ»¡è¶³ï¼Œé‚£ä¹ˆå°±ç›¸åº”åœ°é™ä½è¦æ±‚ã€‚</p></li><li><p>å°½æœ€å¤§åŠªåŠ›å»ä¿è¯</p></li></ul></li></ul><h4 id="è°ƒåº¦å‡†åˆ™"><a href="#è°ƒåº¦å‡†åˆ™" class="headerlink" title="è°ƒåº¦å‡†åˆ™"></a>è°ƒåº¦å‡†åˆ™</h4><p>â€‹é™æ€ã€åŠ¨æ€ä¼˜å…ˆçº§è°ƒåº¦(åœ¨ç¨‹åºæ‰§è¡Œä¹‹å‰å°±ç¡®å®šè¿›ç¨‹çš„ä¼˜å…ˆçº§&#x2F;åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼˜å…ˆçº§ä¼šä¸æ–­å˜åŒ–)</p><h3 id="8-5å¤šå¤„ç†å™¨è°ƒåº¦"><a href="#8-5å¤šå¤„ç†å™¨è°ƒåº¦" class="headerlink" title="8.5å¤šå¤„ç†å™¨è°ƒåº¦"></a>8.5å¤šå¤„ç†å™¨è°ƒåº¦</h3><ul><li>ï»¿å¤šå¤„ç†å™¨çš„CPUè°ƒåº¦æ›´åŠ å¤æ‚<ul><li>å¤šä¸ªç›¸åŒçš„å•å¤„ç†å™¨ç»„æˆä¸€ä¸ªå¤šå¤„ç†å™¨</li><li>ä¼˜ç‚¹ï¼šè´Ÿè½½å…±äº«</li></ul></li><li>ï»¿å¯¹ç§°å¤šå¤„ç†å™¨(SMP)<ul><li>æ¯ä¸ªå¤„ç†å™¨è¿è¡Œè‡ªå·±çš„è°ƒåº¦ç¨‹åº</li><li>éœ€è¦åœ¨è°ƒåº¦ç¨‹åºä¸­åŒæ­¥</li></ul></li></ul><h3 id="8-6ä¼˜å…ˆçº§åè½¬"><a href="#8-6ä¼˜å…ˆçº§åè½¬" class="headerlink" title="8.6ä¼˜å…ˆçº§åè½¬"></a>8.6ä¼˜å…ˆçº§åè½¬</h3><p>â€‹ç°æœ‰ä¼˜å…ˆçº§ T1 &lt; T2 &lt; T3ï¼Œ</p><p>T3å’ŒT1éƒ½éœ€è¦ç”¨åˆ°ä¸€å—å…±äº«èµ„æºï¼ŒT3å…ˆæ‰§è¡Œï¼Œé”å®šäº†å…±äº«èµ„æºï¼ŒT1å†æ‰§è¡Œ(æŠ¢å äº†T3)ï¼Œè™½ç„¶T1ä¼˜å…ˆäºT3ï¼Œä½†æ˜¯T3æŠŠT1è¦ç”¨åˆ°çš„èµ„æºé”ä½äº†ï¼Œæ‰€ä»¥T1æ— æ³•æ‰§è¡Œå®Œæ¯•ï¼Œå› æ­¤è®©T3ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶è®©T2å†æ‰§è¡Œï¼Œä¼šæŠ¢å T3ï¼Œ<u>è¿™æ—¶å€™ï¼ŒT1éœ€è¦ç­‰å¾…T3ï¼ŒT3åœ¨ç­‰å¾…T2ï¼Œå°±å‡ºç°äº†ä¼˜å…ˆçº§åè½¬é—®é¢˜ï¼</u></p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>(å½“å‡ºç°èµ„æºæŠ¢å ç°è±¡æ—¶)ä½ä¼˜å…ˆçº§ä»»åŠ¡ç»§æ‰¿é«˜ä¼˜å…ˆçº§ä»»åŠ¡çš„ä¼˜å…ˆçº§</li><li>ï»¿ä¼˜å…ˆçº§å¤©èŠ±æ¿ï¼š<ul><li>â€œèµ„æºâ€ çš„ä¼˜å…ˆçº§å’Œ â€œæ‰€æœ‰å¯ä»¥é”å®šè¯¥èµ„æºçš„ä»»åŠ¡ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„é‚£ä¸ªä»»åŠ¡â€ çš„ä¼˜å…ˆçº§ç›¸åŒ</li><li>é™¤éä¼˜å…ˆçº§é«˜äºç³»ç»Ÿä¸­æ‰€æœ‰è¢«é”å®šçš„èµ„æºçš„ä¼˜å…ˆçº§ä¸Šé™ï¼Œå¦åˆ™ä»»åŠ¡å°è¯•æ‰§è¡Œä¸´ç•ŒåŒºçš„æ—¶å€™ä¼šè¢«é˜»å¡</li><li>ï»¿æŒæœ‰æœ€é«˜ä¼˜å…ˆçº§ä¸Šé™ä¿¡å·é‡é”çš„ä»»åŠ¡ï¼Œä¼šç»§æ‰¿è¢«è¯¥é”æ‰€é˜³å¡çš„ä»»åŠ¡çš„ä¼˜å…ˆçº§</li></ul></li></ul><h2 id="Chapter9-åŒæ­¥"><a href="#Chapter9-åŒæ­¥" class="headerlink" title="Chapter9 åŒæ­¥"></a>Chapter9 åŒæ­¥</h2><h3 id="èƒŒæ™¯ï¼š"><a href="#èƒŒæ™¯ï¼š" class="headerlink" title="èƒŒæ™¯ï¼š"></a>èƒŒæ™¯ï¼š</h3><ul><li>ï»¿ç‹¬ç«‹çš„çº¿ç¨‹ï¼š<ul><li>ä¸å’Œå…¶ä»–çº¿ç¨‹å…±äº«èµ„æºæˆ–çŠ¶æ€</li><li>ç¡®å®šæ€§ï¼šä¸€è¾“å…¥çŠ¶æ€å†³å®šç»“æœ</li><li>å¯é‡ç°ï¼šä¸€ èƒ½å¤Ÿé‡ç°èµ·å§‹æ¡ä»¶ï¼ŒI&#x2F;0</li><li>è°ƒåº¦é¡ºåºä¸é‡è¦</li></ul></li><li>ï»¿åˆä½œçº¿ç¨‹ï¼š<ul><li>åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«çŠ¶æ€</li><li>ä¸ç¡®å®šæ€§</li><li>ä¸å¯é‡ç°</li></ul></li><li>ï»¿ä¸ç¡®å®šæ€§å’Œä¸å¯é‡ç°æ„å‘³ç€bugå¯èƒ½æ˜¯é—´æ­‡æ€§å‘ç”Ÿçš„</li></ul><p>è¿›ç¨‹é—´åˆä½œå·¥ä½œçš„åŸå› ï¼š</p><ul><li>ï»¿è¿›ç¨‹&#x2F;çº¿ç¨‹ï¼Œè®¡ç®—æœº&#x2F;è®¾å¤‡éœ€è¦åˆä½œ</li><li>ï»¿ä¼˜ç‚¹1ï¼šå…±äº«èµ„æº<ul><li>ä¸€å°ç”µè„‘ï¼Œå¤šä¸ªç”¨æˆ·</li><li>ä¸€ä¸ªé“¶è¡Œå­˜æ¬¾ä½™é¢ï¼Œå¤šå°ATMæœº</li><li>åµŒå…¥å¼ç³»ç»Ÿï¼ˆæœºå™¨äººæ§åˆ¶ï¼šæ‰‹è‡‚å’Œæ‰‹çš„åè°ƒï¼‰</li></ul></li><li>ï»¿ä¼˜ç‚¹2ï¼šåŠ é€Ÿ<ul><li>I&#x2F;0æ“ä½œå’Œè®¡ç®—å¯ä»¥é‡å </li><li>å¤šå¤„ç†å™¨ ä¸€ å°†ç¨‹åºåˆ†æˆå¤šä¸ªéƒ¨åˆ†äº•è¡Œæ‰§è¡Œ</li></ul></li><li>ï»¿ä¼˜ç‚¹3ï¼šæ¨¡å—åŒ–<ul><li>å°†å¤§ç¨‹åºåˆ†è§£æˆå°ç¨‹åº</li></ul></li><li>ï»¿ä»¥ç¼–è¯‘ä¸ºä¾‹ï¼Œgccä¼šè°ƒç”¨cpp, cc1, cc2. as, ldï¼Œä½¿ç³»ç»Ÿæ˜“äºæ‰©å±•</li></ul><p>ä½†æ˜¯è¿›ç¨‹å¹¶å‘ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦å¯¹å…¶è¿›è¡Œè§£å†³</p><h3 id="ä¸€äº›æ¦‚å¿µï¼š"><a href="#ä¸€äº›æ¦‚å¿µï¼š" class="headerlink" title="ä¸€äº›æ¦‚å¿µï¼š"></a>ä¸€äº›æ¦‚å¿µï¼š</h3><h4 id="åŸå­æ“ä½œï¼š"><a href="#åŸå­æ“ä½œï¼š" class="headerlink" title="åŸå­æ“ä½œï¼š"></a>åŸå­æ“ä½œï¼š</h4><ul><li>ï»¿åŸå­æ“ä½œæ˜¯æŒ‡ä¸€æ¬¡ä¸å­˜åœ¨ä»»ä½•ä¸­æ–­æˆ–è€…å¤±è´¥çš„æ‰§è¡Œ<ul><li>è¯¥æ‰§è¡ŒæˆåŠŸç»“æŸ</li><li>æˆ–è€…æ ¹æœ¬æ²¡æœ‰æ‰§è¡Œ</li><li>å¹¶ä¸”ä¸åº”è¯¥å‘ç°ä»»ä½•<strong>éƒ¨åˆ†æ‰§è¡Œ</strong>çš„çŠ¶æ€</li></ul></li><li>ï»¿å®é™…ä¸Šæ“ä½œå¾€å¾€ä¸æ˜¯åŸå­çš„<ul><li>æœ‰äº›çœ‹ä¸Šå»æ˜¯åŸå­æ“ä½œï¼Œå®é™…ä¸Šä¸æ˜¯</li><li>è¿x++è¿™æ ·çš„ç®€å•è¯­å¥ï¼Œå®é™…ä¸Šæ˜¯ç”±3æ¡æŒ‡ä»¤æ„æˆçš„</li><li>æœ‰æ—¶å€™ç”šè‡³è¿å•æ¡æœºå™¨æŒ‡ä»¤éƒ½ä¸æ˜¯åŸå­çš„</li></ul></li></ul><h4 id="Critical-section-ï¼ˆä¸´ç•ŒåŒºï¼‰"><a href="#Critical-section-ï¼ˆä¸´ç•ŒåŒºï¼‰" class="headerlink" title="Critical section ï¼ˆä¸´ç•ŒåŒºï¼‰"></a>Critical section ï¼ˆä¸´ç•ŒåŒºï¼‰</h4><p>ä¸´ç•ŒåŒºæ˜¯æŒ‡è¿›ç¨‹ä¸­çš„ä¸€æ®µéœ€è¦è®¿é—®å…±äº«èµ„æºå¹¶ä¸”å½“å¦ä¸€ä¸ªè¿›ç¨‹å¤„äºç›¸åº”ä»£ç åŒºåŸŸæ—¶ä¾¿ä¸ä¼šè¢«æ‰§è¡Œçš„ä»£ç åŒºåŸŸ</p><h4 id="Mutual-exclusion-ï¼ˆäº’æ–¥ï¼‰"><a href="#Mutual-exclusion-ï¼ˆäº’æ–¥ï¼‰" class="headerlink" title="Mutual exclusion ï¼ˆäº’æ–¥ï¼‰"></a>Mutual exclusion ï¼ˆäº’æ–¥ï¼‰</h4><p>å½“ä¸€ä¸ªè¿›ç¨‹å¤„äºä¸´ç•ŒåŒºäº•è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œæ²¡æœ‰å…¶ä»–è¿›ç¨‹ä¼šå¤„äºä¸´ç•ŒåŒºå¹¶ä¸”è®¿é—®ä»»ä½•ç›¸åŒçš„å…±äº«èµ„æº</p><h4 id="Dead-lock-ï¼ˆæ­»é”ï¼‰"><a href="#Dead-lock-ï¼ˆæ­»é”ï¼‰" class="headerlink" title="Dead lock ï¼ˆæ­»é”ï¼‰"></a>Dead lock ï¼ˆæ­»é”ï¼‰</h4><p>ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„è¿›ç¨‹ï¼Œåœ¨ç›¸äº’ç­‰å¾…å®Œæˆç‰¹å®šä»»åŠ¡ï¼Œè€Œæœ€ç»ˆæ²¡æ³•å°†è‡ªèº«ä»»åŠ¡è¿›è¡Œä¸‹å»</p><h4 id="Starvationï¼ˆé¥¥é¥¿ï¼‰"><a href="#Starvationï¼ˆé¥¥é¥¿ï¼‰" class="headerlink" title="Starvationï¼ˆé¥¥é¥¿ï¼‰"></a>Starvationï¼ˆé¥¥é¥¿ï¼‰</h4><p>ä¸€ä¸ªå¯æ‰§è¡Œçš„è¿›ç¨‹ï¼Œè¢«è°ƒåº¦å™¨æŒç»­å¿½ç•¥ï¼Œä»¥è‡³äºè™½ç„¶å¤„äºå¯æ‰§è¡ŒçŠ¶æ€å´ä¸è¢«æ‰§è¡Œ</p><h4 id="Critical-section-ä¸´ç•ŒåŒºï¼‰"><a href="#Critical-section-ä¸´ç•ŒåŒºï¼‰" class="headerlink" title="Critical section  (ä¸´ç•ŒåŒºï¼‰"></a>Critical section  (ä¸´ç•ŒåŒºï¼‰</h4><p>ä¸´ç•ŒåŒºæ˜¯æŒ‡è¿›ç¨‹ä¸­çš„ä¸€æ®µéœ€è¦è®¿é—®å…±äº«èµ„æºäº•ä¸”å½“å¦ä¸€ä¸ªè¿›ç¨‹å¤„äºç›¸åº”ä»£ç åŒºåŸŸæ—¶ä¾¿ä¸ä¼šè¢«æ‰§è¡Œçš„ä»£ç åŒºåŸŸ</p><ul><li>ï»¿äº’æ–¥ï¼šåŒä¸€æ—¶é—´ä¸´ç•ŒåŒºä¸­æœ€å¤šå­˜åœ¨ä¸€ä¸ªçº¿ç¨‹</li><li>ï»¿Progressï¼šå¦‚æœä¸€ä¸ªçº¿ç¨‹æƒ³è¦è¿›å…¥ä¸´ç•ŒåŒºï¼Œé‚£ä¹ˆå®ƒæœ€ç»ˆä¼šæˆåŠŸ</li><li>æœ‰é™ç­‰å¾…ï¼šå¦‚æœä¸€ä¸ªçº¿ç¨‹iå¤„äºå…¥å£åŒºï¼Œé‚£ä¹ˆåœ¨içš„è¯·æ±‚è¢«æ¥å—ä¹‹å‰ï¼Œå…¶ä»–çº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºçš„æ—¶é—´æ˜¯æœ‰é™åˆ¶çš„</li><li>ï»¿æ— å¿™ç­‰å¾…ï¼ˆå¯é€‰)ï¼šå¦‚æœä¸€ä¸ªè¿›ç¨‹åœ¨ç­‰å¾…è¿›å…¥ä¸´ç•ŒåŒºï¼Œé‚£ä¹ˆ<strong>åœ¨å®ƒå¯ä»¥è¿›å…¥ä¹‹å‰ä¼šè¢«æŒ‚èµ·</strong></li></ul><h4 id="Mutual-exclusionï¼ˆäº’æ–¥ï¼‰"><a href="#Mutual-exclusionï¼ˆäº’æ–¥ï¼‰" class="headerlink" title="Mutual exclusionï¼ˆäº’æ–¥ï¼‰"></a>Mutual exclusionï¼ˆäº’æ–¥ï¼‰</h4><p>å½“ä¸€ä¸ªè¿›ç¨‹å¤„äºä¸´ç•ŒåŒºå¹¶è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œæ²¡æœ‰å…¶ä»–è¿›ç¨‹ä¼šå¤„äºä¸´ç•ŒåŒºå¹¶ä¸”è®¿é—®ä»»ä½•ç›¸åŒçš„å…±äº«èµ„æº</p><h3 id="å®ç°å¯¹ä¸´ç•ŒåŒºä»£ç çš„ä¿æŠ¤"><a href="#å®ç°å¯¹ä¸´ç•ŒåŒºä»£ç çš„ä¿æŠ¤" class="headerlink" title="å®ç°å¯¹ä¸´ç•ŒåŒºä»£ç çš„ä¿æŠ¤"></a>å®ç°å¯¹ä¸´ç•ŒåŒºä»£ç çš„ä¿æŠ¤</h3><h4 id="æ–¹æ¡ˆ1â€”â€”ç¦ç”¨ç¡¬ä»¶ä¸­æ–­ï¼š"><a href="#æ–¹æ¡ˆ1â€”â€”ç¦ç”¨ç¡¬ä»¶ä¸­æ–­ï¼š" class="headerlink" title="æ–¹æ¡ˆ1â€”â€”ç¦ç”¨ç¡¬ä»¶ä¸­æ–­ï¼š"></a>æ–¹æ¡ˆ1â€”â€”ç¦ç”¨ç¡¬ä»¶ä¸­æ–­ï¼š</h4><ul><li>ï»¿æ²¡æœ‰ä¸­æ–­ï¼Œæ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå› æ­¤æ²¡æœ‰å¹¶å‘<ul><li>ç¡¬ä»¶å°†ä¸­æ–­å¤„ç†å»¶è¿Ÿåˆ°ä¸­æ–­è¢«å¯ç”¨ä¹‹å</li><li>å¤§å¤šæ•°ç°ä»£è®¡ç®—æœºä½“ç³»ç»“æ„éƒ½æä¾›æŒ‡ä»¤æ¥å®Œæˆ</li></ul></li><li>ï»¿è¿›å…¥ä¸´ç•ŒåŒº<ul><li>ç¦ç”¨ä¸­æ–­</li></ul></li><li>ï»¿ç¦»å¼€ä¸´ç•ŒåŒº<ul><li>å¼€å¯ä¸­æ–­</li></ul></li></ul><h5 id="ç¼ºç‚¹ï¼š-4"><a href="#ç¼ºç‚¹ï¼š-4" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><ul><li>ï»¿ä¸€æ—¦ä¸­æ–­è¢«ç¦ç”¨ï¼Œçº¿ç¨‹å°±æ— æ³•è¢«åœæ­¢<ul><li>æ•´ä¸ªç³»ç»Ÿéƒ½ä¼šä¸ºä½ åœä¸‹æ¥</li><li>å¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹å¤„äºé¥¥é¥¿çŠ¶æ€</li></ul></li><li>ï»¿è¦æ˜¯ä¸´ç•ŒåŒºå¯ä»¥ä»»æ„é•¿æ€ä¹ˆåŠ<ul><li>æ— æ³•é™åˆ¶å“åº”ä¸­æ–­æ‰€éœ€çš„æ—¶é—´(å¯èƒ½å­˜åœ¨ç¡¬ä»¶å½±å“ï¼‰</li></ul></li></ul><p>â€‹è¦å°å¿ƒä½¿ç”¨</p><ul><li>ä¸€èˆ¬åªèƒ½ç¦æ­¢å•CPUçš„ä¸­æ–­ï¼Œé‚£ä¹ˆé¢å¯¹å¤šCPUçš„æƒ…å†µå°±æ— æ³•ä½¿ ç¦ç”¨ç¡¬ä»¶ä¸­æ–­å¤±æ•ˆ</li></ul><h4 id="æ–¹æ¡ˆ2â€”â€”åŸºäºè½¯ä»¶çš„è§£å†³æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ2â€”â€”åŸºäºè½¯ä»¶çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ2â€”â€”åŸºäºè½¯ä»¶çš„è§£å†³æ–¹æ¡ˆ:"></a>æ–¹æ¡ˆ2â€”â€”åŸºäºè½¯ä»¶çš„è§£å†³æ–¹æ¡ˆ:</h4><ul><li>ï»¿ï»¿Dekkerç®—æ³• (1965ï¼‰ï¼šç¬¬ä¸€ä¸ªé’ˆå¯¹åŒçº¿ç¨‹ä¾‹å­çš„æ­£ç¡®è§£å†³æ–¹æ¡ˆ</li><li>ï»¿Bakeryç®—æ³• ( Lamport 1979ï¼‰ï¼šé’ˆå¯¹nçº¿ç¨‹çš„ä¸´ç•ŒåŒºé—®é¢˜è§£å†³æ–¹æ¡ˆ</li><li>ï»¿å¤æ‚<ul><li>éœ€è¦ä¸¤ä¸ªè¿›ç¨‹é—´çš„å…±äº«æ•°æ®é¡¹</li></ul></li><li>ï»¿éœ€è¦å¿™ç­‰å¾…<ul><li>æµªè´¹CPUæ—¶é—´</li></ul></li><li>ï»¿æ²¡æœ‰ç¡¬ä»¶ä¿è¯çš„æƒ…å†µä¸‹æ— çœŸæ­£çš„è½¯ä»¶è§£å†³æ–¹æ¡ˆ<ul><li>Petersonç®—æ³•éœ€è¦åŸå­çš„LOADå’ŒSTOREæŒ‡ä»¤</li></ul></li></ul><h4 id="æ–¹æ¡ˆ3â€”â€”æ›´é«˜çº§çš„æŠ½è±¡ï¼š"><a href="#æ–¹æ¡ˆ3â€”â€”æ›´é«˜çº§çš„æŠ½è±¡ï¼š" class="headerlink" title="æ–¹æ¡ˆ3â€”â€”æ›´é«˜çº§çš„æŠ½è±¡ï¼š"></a>æ–¹æ¡ˆ3â€”â€”æ›´é«˜çº§çš„æŠ½è±¡ï¼š</h4><ul><li>ï»¿å¤§å¤šæ•°ç°ä»£ä½“ç³»ç»“æ„éƒ½æä¾›ç‰¹æ®Šçš„åŸå­æ“ä½œæŒ‡ä»¤<ul><li>é€šè¿‡ç‰¹æ®Šçš„å†…å­˜è®¿é—®ç”µè·¯ï¼Œé’ˆå¯¹å•å¤„ç†å™¨å’Œå¤šå¤„ç†å™¨</li></ul></li><li>ï»¿ï»¿Test-and-Set æµ‹è¯•å’Œç½®ä½<ul><li>ä»å†…å­˜ä¸­è¯»å–å€¼</li><li>æµ‹è¯•è¯¥å€¼æ˜¯å¦ä¸º1ï¼ˆç„¶åè¿”å›çœŸæˆ–å‡ï¼‰</li><li>å†…å­˜å€¼è®¾ç½®ä¸º1</li></ul></li><li>ï»¿äº¤æ¢exchange<ul><li>äº¤æ¢å†…å­˜ä¸­çš„ä¸¤ä¸ªå€¼</li></ul></li></ul><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡Test-and-Set æˆ– exchange æ¥å®ç°å¹¶å‘çº¿ç¨‹çš„ç®¡ç†</p><h5 id="ä¼˜ç‚¹ï¼š-4"><a href="#ä¼˜ç‚¹ï¼š-4" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h5><ul><li>é€‚ç”¨äºå•å¤„ç†å™¨æˆ–è€…å…±äº«ä¸»å­˜çš„å¤šå¤„ç†å™¨ä¸­ä»»æ„æ•°é‡çš„è¿¸ç¨‹</li><li>ç®€å•å¹¶ä¸”å®¹æ˜“è¯æ˜</li><li>å¯ä»¥ç”¨äºæ”¯æŒå¤šä¸´ç•ŒåŒº</li></ul><h5 id="ç¼ºç‚¹ï¼š-5"><a href="#ç¼ºç‚¹ï¼š-5" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><ul><li>å¿™ç­‰å¾…æ¶ˆè€—å¤„ç†å™¨æ—¶é—´</li><li>å½“è¿›ç¨‹ç¦»å¼€ä¸´ç•ŒåŒºå¹¶ä¸”å¤šä¸ªè¿›ç¨‹åœ¨ç­‰å¾…çš„æ—¶å€™å¯èƒ½å¯¼è‡´<u>é¥¥é¥¿</u></li><li>æ­»é”</li><li>ï»¿å¦‚æœä¸€ä¸ªä½ä¼˜å…ˆçº§çš„è¿›ç¨‹æ‹¥æœ‰ä¸´ç•ŒåŒºå¹¶ä¸”ä¸€ä¸ªé«˜ä¼˜å…ˆçº§è¿›ç¨‹ä¹Ÿéœ€æ±‚ï¼Œé‚£ä¹ˆé«˜ä¼˜å…ˆçº§è¿›ç¨‹ä¼šè·å¾—å¤„ç†å™¨å¹¶ç­‰å¾…ä¸´ç•ŒåŒº</li></ul><h2 id="Chapter10-ä¿¡å·é‡å’Œç®¡ç¨‹"><a href="#Chapter10-ä¿¡å·é‡å’Œç®¡ç¨‹" class="headerlink" title="Chapter10 ä¿¡å·é‡å’Œç®¡ç¨‹"></a>Chapter10 ä¿¡å·é‡å’Œç®¡ç¨‹</h2><h3 id="èƒŒæ™¯ï¼š-1"><a href="#èƒŒæ™¯ï¼š-1" class="headerlink" title="èƒŒæ™¯ï¼š"></a>èƒŒæ™¯ï¼š</h3><ul><li>ï»¿å¹¶å‘é—®é¢˜ï¼šç«äº‰æ¡ä»¶ï¼ˆç«æ€æ¡ä»¶ï¼‰<ul><li>å¤šç¨‹åºå¹¶å‘å­˜åœ¨å¤§çš„é—®é¢˜</li></ul></li><li>ï»¿åŒæ­¥<ul><li>å¤šçº¿ç¨‹<strong>å…±äº«å…¬å…±æ•°æ®çš„åè°ƒæ‰§è¡Œ</strong></li><li>åŒ…æ‹¬äº’æ–¥ä¸æ¡ä»¶åŒæ­¥</li><li>äº’æ–¥ï¼šåœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œä¸´ç•ŒåŒº</li></ul></li><li>ï»¿ç¡®ä¿åŒæ­¥æ­£ç¡®å¾ˆéš¾ï¼Ÿ<ul><li>éœ€è¦é«˜å±‚æ¬¡çš„ç¼–ç¨‹æŠ½è±¡ï¼ˆå¦‚ï¼šé”ï¼‰</li><li>ä»åº•å±‚ç¡¬ä»¶æ”¯æŒç¼–è¯‘</li></ul></li></ul><h3 id="ä¿¡å·é‡ï¼š"><a href="#ä¿¡å·é‡ï¼š" class="headerlink" title="ä¿¡å·é‡ï¼š"></a>ä¿¡å·é‡ï¼š</h3><ul><li><p>æ˜¯ä¸€ä¸ªæ•´å½¢ï¼ˆsemï¼‰ï¼Œæœ‰ä¸¤ä¸ªåŸå­æ“ä½œ</p></li><li><p>P () :   sem å‡1ï¼Œå¦‚æœsem&lt;0ï¼Œ ç­‰å¾…ï¼Œå¦åˆ™ç»§ç»­</p></li><li><p>V () ï¼šsem åŠ 1ï¼Œå¦‚æœ sem&lt;&#x3D;0ï¼Œå”¤é†’ä¸€ä¸ªç­‰å¾…çš„P</p></li><li><p>ï»¿ä¿¡å·é‡æ˜¯è¢«ä¿æŠ¤çš„å˜é‡</p><ul><li>åˆå§‹åŒ–å®Œæˆåï¼Œå”¯ä¸€æ”¹å˜ä¸€ä¸ªä¿¡å·é‡çš„å€¼çš„åŠæ³•æ˜¯é€šè¿‡P0å’Œv0</li><li>æ“ä½œå¿…é¡»æ˜¯åŸå­</li></ul></li><li><p>ï»¿P () èƒ½å¤Ÿé˜»å¡ï¼ŒV () ä¸ä¼šé˜»å¡</p></li><li><p>ï»¿æˆ‘ä»¬å‡å®šä¿¡å·é‡æ˜¯   å…¬å¹³çš„</p><ul><li>æ²¡æœ‰çº¿ç¨‹è¢«é˜»å¡åœ¨P () if  V () è¢«æ— é™é¢‘ç¹è°ƒç”¨ï¼ˆå¯¹äºåŒä¸€ä¸ªä¿¡å·é‡ï¼‰</li><li>åœ¨å®è·µä¸­ï¼ŒFIFOç»å¸¸è¢«ä½¿ç”¨</li></ul></li><li><p>ï»¿ä¸¤ç§ç±»å‹ä¿¡å·é‡</p><ul><li>äºŒè¿›åˆ¶ä¿¡å·é‡ï¼šå¯ä»¥æ˜¯0æˆ–1</li><li>ä¸€èˆ¬&#x2F;è®¡æ•°ä¿¡å·é‡ï¼šå¯å–ä»»ä½•éè´Ÿå€¼</li><li>ä¸¤è€…ç›¸äº’è¡¨ç°(ç»™å®šä¸€ä¸ªå¯ä»¥å®ç°å¦ä¸€ä¸ª)</li></ul></li><li><p>ï»¿ä¿¡å·é‡å¯ä»¥ç”¨åœ¨2ä¸ªæ–¹é¢</p><ul><li>äº’æ–¥</li><li>æ¡ä»¶åŒæ­¥(è°ƒåº¦çº¦æŸä¸€ä¸€ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„äº‹æƒ…å‘ç”Ÿï¼‰</li></ul></li></ul><h3 id="ä¿¡å·é‡ç¼ºç‚¹ï¼š"><a href="#ä¿¡å·é‡ç¼ºç‚¹ï¼š" class="headerlink" title="ä¿¡å·é‡ç¼ºç‚¹ï¼š"></a>ä¿¡å·é‡ç¼ºç‚¹ï¼š</h3><ul><li>ä¿¡å·é‡çš„åŒç”¨é€”<ul><li>äº’æ–¥å’Œæ¡ä»¶åŒæ­¥</li><li>ä½†ç­‰å¾…æ¡ä»¶æ˜¯ç‹¬ç«‹çš„äº’æ–¥</li></ul></li><li>è¯»&#x2F;å¼€å‘ä»£ç æ¯”è¾ƒå›°éš¾<ul><li>ç¨‹åºå‘˜å¿…é¡»éå¸¸ç²¾é€šä¿¡å·é‡</li></ul></li><li>å®¹æ˜“å‡ºé”™<ul><li>ä½¿ç”¨çš„ä¿¡å·é‡å·±ç»è¢«å¦ä¸€ä¸ªçº¿ç¨‹å ç”¨</li><li>å¿˜è®°é‡Šæ”¾ä¿¡å·é‡</li></ul></li><li>ä¸èƒ½å¤Ÿå¤„ç†æ­»é”é—®é¢˜</li></ul><h3 id="ç®¡ç¨‹"><a href="#ç®¡ç¨‹" class="headerlink" title="ç®¡ç¨‹"></a>ç®¡ç¨‹</h3><ul><li><p>ï»¿ä»€ä¹ˆæ˜¯ç®¡ç¨‹</p><ul><li>ä¸€ä¸ªé”ï¼šæŒ‡å®šä¸´ç•ŒåŒº</li><li>0æˆ–è€…å¤šä¸ªæ¡ä»¶å˜é‡ï¼šç­‰å¾…&#x2F;é€šçŸ¥ä¿¡å·é‡ç”¨äºç®¡ç†å¹¶å‘è®¿é—®å…±äº«æ•°æ®</li></ul></li><li><p>ï»¿ä¸€èˆ¬æ–¹æ³•</p><ul><li>æ”¶é›†åœ¨å¯¹è±¡&#x2F;æ¨¡å—ä¸­çš„ç›¸å…³å…±äº«æ•°æ®</li><li>å®šä¹‰æ–¹æ³•æ¥è®¿é—®å…±äº«æ•°æ®</li></ul></li><li><p>ï»¿ï»¿Lock</p><ul><li>Lock::Acquireï¼ˆ ä¸€ ç­‰å¾…ç›´åˆ°é”å¯ç”¨ï¼Œç„¶åæŠ¢å é”</li><li>Lock::Release ï¼ˆä¸€é‡Šæ”¾é”ï¼Œå”¤é†’ç­‰å¾…è€…å¦‚æœæœ‰</li></ul></li><li><p>ï»¿ï»¿Condition Variable</p><ul><li><p>å…è®¸ç­‰å¾…çŠ¶æ€è¿›å…¥ä¸´ç•ŒåŒº</p><ul><li>ï»¿å…è®¸å¤„äºç­‰å¾…ï¼ˆç¡çœ ï¼‰çš„çº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒº</li><li>ï»¿æŸä¸ªæ—¶åˆ»åŸå­é‡Šæ”¾é”è¿›å…¥ç¡çœ </li></ul></li><li><p>Wait () operation</p><ul><li>ï»¿é‡Šæ”¾é”ï¼Œç¡çœ ï¼Œé‡æ–°è·å¾—é”è¿”å›å</li></ul></li><li><p>ï»¿ï»¿Signal () operation ( or broadcast () operation )</p><ul><li>å”¤é†’ç­‰å¾…è€…ï¼ˆæˆ–è€…æ‰€æœ‰ç­‰å¾…è€…ï¼‰ï¼Œå¦‚æœæœ‰</li></ul></li></ul></li></ul><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/IMG_C86C23D6FA1D-1.jpeg" alt="IMG_C86C23D6FA1D-1" style="zoom:50%;" /><h3 id="ç»å…¸åŒæ­¥é—®é¢˜"><a href="#ç»å…¸åŒæ­¥é—®é¢˜" class="headerlink" title="ç»å…¸åŒæ­¥é—®é¢˜"></a>ç»å…¸åŒæ­¥é—®é¢˜</h3><h4 id="è¯»è€…â€”å†™è€…é—®é¢˜ï¼š"><a href="#è¯»è€…â€”å†™è€…é—®é¢˜ï¼š" class="headerlink" title="è¯»è€…â€”å†™è€…é—®é¢˜ï¼š"></a>è¯»è€…â€”å†™è€…é—®é¢˜ï¼š</h4><ul><li><p>åŠ¨æœº</p><ul><li>å…±äº«æ•°æ®çš„è®¿é—®</li></ul></li><li><p>ä¸¤ç§ç±»å‹ä½¿ç”¨è€…</p><ul><li>è¯»è€…ï¼šä¸éœ€è¦ä¿®æ”¹æ•°æ®</li><li>å†™è€…ï¼šè¯»å–å’Œä¿®æ”¹æ•°æ®</li></ul></li><li><p>é—®é¢˜çš„çº¦æŸ</p><ul><li>å…è®¸åŒä¸€æ—¶é—´æœ‰å¤šä¸ªè¯»è€…ï¼Œä½†åœ¨ä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªå†™è€…</li><li>å½“æ²¡æœ‰å†™è€…æ˜¯è¯»è€…æ‰èƒ½è®¿é—®æ•°æ®</li><li>å½“æ²¡æœ‰è¯»è€…å’Œå†™è€…æ—¶å†™è€…æ‰èƒ½è®¿é—®æ•°æ®</li><li>åœ¨ä»»ä½•æ—¶å€™åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ“ä½œå…±äº«å˜é‡</li></ul></li><li><p>ï»¿å¤šä¸ªå¹¶å‘è¿›ç¨‹çš„æ•°æ®é›†å…±äº«</p><ul><li>è¯»è€…ä¸€åªè¯»æ•°æ®é›†ï¼›ä»–ä»¬ä¸æ‰§è¡Œä»»ä½•æ›´æ–°</li><li>å†™è€…-å¯ä»¥è¯»å–å’Œå†™å…¥</li></ul></li><li><p>ï»¿å…±äº«æ•°æ®</p><ul><li>æ•°æ®é›†</li><li>ä¿¡å·é‡CountMutexåˆå§‹åŒ–ä¸º1</li><li>ä¿¡å·é‡WriteMutexåˆå§‹åŒ–ä¸º1</li><li>æ•´æ•° Rcount åˆå§‹åŒ–ä¸º0</li></ul></li></ul><h5 id="è¯»è€…ä¼˜å…ˆå®ç°-ä½¿ç”¨ä¿¡å·é‡æ–¹å¼-ï¼š"><a href="#è¯»è€…ä¼˜å…ˆå®ç°-ä½¿ç”¨ä¿¡å·é‡æ–¹å¼-ï¼š" class="headerlink" title="è¯»è€…ä¼˜å…ˆå®ç°(ä½¿ç”¨ä¿¡å·é‡æ–¹å¼)ï¼š"></a>è¯»è€…ä¼˜å…ˆå®ç°(ä½¿ç”¨ä¿¡å·é‡æ–¹å¼)ï¼š</h5><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/IMG_4D5569A45E16-1.jpeg" alt="IMG_4D5569A45E16-1" style="zoom:50%;" /><h4 id="å“²å­¦å®¶å°±é¤é—®é¢˜ï¼š"><a href="#å“²å­¦å®¶å°±é¤é—®é¢˜ï¼š" class="headerlink" title="å“²å­¦å®¶å°±é¤é—®é¢˜ï¼š"></a>å“²å­¦å®¶å°±é¤é—®é¢˜ï¼š</h4><h2 id="Chapter11-æ­»é”"><a href="#Chapter11-æ­»é”" class="headerlink" title="Chapter11 æ­»é”"></a>Chapter11 æ­»é”</h2><h3 id="æ­»é”é—®é¢˜ï¼š"><a href="#æ­»é”é—®é¢˜ï¼š" class="headerlink" title="æ­»é”é—®é¢˜ï¼š"></a>æ­»é”é—®é¢˜ï¼š</h3><p>â€‹ä¸€ç»„é˜»å¡çš„è¿›ç¨‹æŒæœ‰ä¸€ç§èµ„æº ç­‰å¾…è·å– å¦ä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰çš„ä¸€ä¸ªèµ„æºã€‚</p><h3 id="ç³»ç»Ÿæ¨¡å‹ï¼š"><a href="#ç³»ç»Ÿæ¨¡å‹ï¼š" class="headerlink" title="ç³»ç»Ÿæ¨¡å‹ï¼š"></a>ç³»ç»Ÿæ¨¡å‹ï¼š</h3><h4 id="å¯é‡å¤ä½¿ç”¨çš„èµ„æº"><a href="#å¯é‡å¤ä½¿ç”¨çš„èµ„æº" class="headerlink" title="å¯é‡å¤ä½¿ç”¨çš„èµ„æº"></a>å¯é‡å¤ä½¿ç”¨çš„èµ„æº</h4><ul><li><p>ï»¿åœ¨ä¸€ä¸ªæ—¶é—´åªèƒ½ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ä¸”ä¸èƒ½è¢«åˆ é™¤</p></li><li><p>ï»¿è¿›ç¨‹è·å¾—èµ„æºï¼Œåæ¥é‡Šæ”¾ç”±å…¶ä»–è¿›ç¨‹é‡ç”¨</p></li><li><p>ï»¿å¤„ç†å™¨ï¼ŒI&#x2F;Oé€šé“ï¼Œä¸»å’Œå‰¯å­˜å‚¨å™¨ï¼Œè®¾å¤‡å’Œæ•°æ®ç»“æ„ï¼Œå¦‚æ–‡ä»¶ï¼Œæ•°æ®åº“å’Œä¿¡å·é‡</p></li><li><p>ï»¿å¦‚æœæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ä¸€ä¸ªèµ„æºå¹¶è¯·æ±‚å…¶å®ƒèµ„æºï¼Œæ­»é”å¯èƒ½å‘ç”Ÿ</p><h4 id="ä½¿ç”¨èµ„æº"><a href="#ä½¿ç”¨èµ„æº" class="headerlink" title="ä½¿ç”¨èµ„æº"></a>ä½¿ç”¨èµ„æº</h4></li><li><p>ï»¿ï»¿åˆ›å»ºå’Œé”€æ¯</p></li><li><p>ï»¿åœ¨I&#x2F;Oç¼“å†²åŒºçš„ä¸­æ–­ï¼Œä¿¡å·ï¼Œæ¶ˆæ¯ï¼Œä¿¡æ¯</p></li><li><p>ï»¿å¦‚æœæ¥æ”¶æ¶ˆæ¯é˜³å¡å¯èƒ½ä¼šå‘ç”Ÿæ­»é”</p></li><li><p>ï»¿å¯èƒ½å°‘è§çš„ç»„åˆäº‹ä»¶ä¼šå¼•èµ·æ­»é”</p></li></ul><h3 id="æ­»é”ç‰¹å¾ï¼š"><a href="#æ­»é”ç‰¹å¾ï¼š" class="headerlink" title="æ­»é”ç‰¹å¾ï¼š"></a>æ­»é”ç‰¹å¾ï¼š</h3><p>æ­»é”å‡ºç°çš„å¿…è¦æ¡ä»¶ï¼š</p><h4 id="1ã€-äº’æ–¥ï¼š"><a href="#1ã€-äº’æ–¥ï¼š" class="headerlink" title="1ã€ äº’æ–¥ï¼š"></a>1ã€ äº’æ–¥ï¼š</h4><p>è¿›ç¨‹è¦æ±‚å¯¹æ‰€åˆ†é…çš„èµ„æºï¼ˆå¦‚æ‰“å°æœºï¼‰è¿›è¡Œæ’ä»–æ€§æ§åˆ¶ï¼Œå³åœ¨ä¸€æ®µæ—¶é—´å†…æŸèµ„æºä»…ä¸ºä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰ã€‚æ­¤æ—¶è‹¥æœ‰å…¶ä»–è¿›ç¨‹è¯·æ±‚è¯¥èµ„æºï¼Œåˆ™è¯·æ±‚è¿›ç¨‹åªèƒ½ç­‰å¾…ã€‚</p><h4 id="2ã€å ç”¨å¹¶ç­‰å¾…ï¼š"><a href="#2ã€å ç”¨å¹¶ç­‰å¾…ï¼š" class="headerlink" title="2ã€å ç”¨å¹¶ç­‰å¾…ï¼š"></a>2ã€å ç”¨å¹¶ç­‰å¾…ï¼š</h4><p>è¿›ç¨‹å·²ç»ä¿æŒäº†è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œè¯¥èµ„æºå·²è¢«å…¶ä»–è¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è¯·æ±‚è¿›ç¨‹è¢«é˜»å¡ï¼Œä½†å¯¹è‡ªå·±å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚</p><h4 id="3ã€æ— æŠ¢å "><a href="#3ã€æ— æŠ¢å " class="headerlink" title="3ã€æ— æŠ¢å :"></a>3ã€æ— æŠ¢å :</h4><p>è¿›ç¨‹æ‰€è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œæ¯•ä¹‹å‰ï¼Œä¸èƒ½è¢«å…¶ä»–è¿›ç¨‹å¼ºè¡Œå¤ºèµ°ï¼Œå³åªèƒ½ç”±è·å¾—è¯¥èµ„æºçš„è¿›ç¨‹è‡ªå·±æ¥é‡Šæ”¾ï¼ˆåªèƒ½æ˜¯ä¸»åŠ¨é‡Šæ”¾)ã€‚</p><h4 id="4ã€å¾ªç¯ç­‰å¾…"><a href="#4ã€å¾ªç¯ç­‰å¾…" class="headerlink" title="4ã€å¾ªç¯ç­‰å¾…:"></a>4ã€å¾ªç¯ç­‰å¾…:</h4><p>å­˜åœ¨ä¸€ç§è¿›ç¨‹èµ„æºçš„å¾ªç¯ç­‰å¾…é“¾ï¼Œé“¾ä¸­æ¯ä¸€ä¸ªè¿›ç¨‹å·²è·å¾—çš„èµ„æºåŒæ—¶è¢« é“¾ä¸­ä¸‹ä¸€ä¸ªè¿›ç¨‹æ‰€è¯·æ±‚ã€‚å³å­˜åœ¨ä¸€ä¸ªå¤„äºç­‰å¾…çŠ¶æ€çš„è¿›ç¨‹é›†åˆ{Pl, P2, â€¦, pn}ï¼Œå…¶ä¸­Piç­‰ å¾…çš„èµ„æºè¢«P(i+1)å æœ‰ï¼ˆi&#x3D;0, 1, â€¦, n-1)ï¼ŒPnç­‰å¾…çš„èµ„æºè¢«P0å æœ‰ï¼›</p><h3 id="æ­»é”å¤„ç†æ–¹æ³•ï¼š"><a href="#æ­»é”å¤„ç†æ–¹æ³•ï¼š" class="headerlink" title="æ­»é”å¤„ç†æ–¹æ³•ï¼š"></a>æ­»é”å¤„ç†æ–¹æ³•ï¼š</h3><h4 id="æ­»é”é¢„é˜²ï¼š"><a href="#æ­»é”é¢„é˜²ï¼š" class="headerlink" title="æ­»é”é¢„é˜²ï¼š"></a>æ­»é”é¢„é˜²ï¼š</h4><p>ç ´åä»»æ„æ­»é”å‡ºç°çš„å¿…è¦æ¡ä»¶ï¼š</p><ul><li><p>äº’æ–¥â€”â€”å…±äº«èµ„æºä¸æ˜¯å¿…é¡»çš„ï¼Œå¿…é¡»å ç”¨éå…±äº«èµ„æºã€‚</p></li><li><p>å ç”¨å¹¶ç­‰å¾…â€”â€”å¿…é¡»ä¿è¯å½“ä¸€ä¸ªè¿›ç¨‹è¯·æ±‚çš„èµ„æºï¼Œå®ƒä¸æŒæœ‰ä»»ä½•å…¶ä»–èµ„æºã€‚</p><ul><li>éœ€è¦è¿›ç¨‹è¯·æ±‚å¹¶åˆ†é…å…¶æ‰€æœ‰èµ„æºï¼Œå®ƒå¼€å§‹æ‰§è¡Œä¹‹å‰æˆ–å…è®¸è¿›ç¨‹è¯·æ±‚èµ„æºä»…å½“è¿›ç¨‹æ²¡æœ‰èµ„æºã€‚</li><li>èµ„æºåˆ©ç”¨ç‡ä½;å¯èƒ½å‘ç”Ÿé¥¥é¥¿ã€‚</li></ul><p></p></li><li><p>æ— æŠ¢å </p><ul><li>å¦‚æœè¿›ç¨‹å æœ‰æŸäº›èµ„æºï¼Œå¹¶è¯·æ±‚å…¶å®ƒä¸èƒ½è¢«ç«‹å³åˆ†é…çš„èµ„æºï¼Œåˆ™é‡Šæ”¾å½“å‰æ­£å æœ‰çš„èµ„æº</li><li>è¢«æŠ¢å èµ„æºæ·»åŠ åˆ°èµ„æºåˆ—è¡¨ä¸­</li><li>åªæœ‰å½“å®ƒèƒ½å¤Ÿè·å¾—æ—§çš„èµ„æºä»¥åŠå®ƒè¯·æ±‚æ–°çš„èµ„æºï¼Œè¿›ç¨‹å¯ä»¥å¾—åˆ°æ‰§è¡Œ</li></ul></li><li><p>å¾ªç¯ç­‰å¾… â€”å¯¹æ‰€æœ‰èµ„æºç±»å‹è¿›è¡Œ<u><strong>æ’åº</strong></u>ï¼Œå¹¶<u><strong>è¦æ±‚æ¯ä¸ªè¿›ç¨‹æŒ‰ç…§èµ„æºçš„é¡ºåºè¿›è¡Œç”³è¯·</strong></u>ã€‚</p></li></ul><h4 id="æ­»é”é¿å…ï¼š"><a href="#æ­»é”é¿å…ï¼š" class="headerlink" title="æ­»é”é¿å…ï¼š"></a>æ­»é”é¿å…ï¼š</h4><p><u>éœ€è¦ç³»ç»Ÿå…·æœ‰ä¸€äº›é¢å¤–çš„å…ˆéªŒä¿¡æ¯æä¾›ã€‚</u></p><ul><li><p>ï»¿ï»¿æœ€ç®€å•å’Œæœ€æœ‰æ•ˆçš„æ¨¡å¼æ˜¯è¦æ±‚æ¯ä¸ªè¿›ç¨‹å£°æ˜å®ƒå¯èƒ½éœ€è¦çš„æ¯ä¸ªç±»å‹èµ„æºçš„<u>æœ€å¤§æ•°ç›®</u>ã€‚</p></li><li><p>ï»¿èµ„æºçš„åˆ†é…çŠ¶æ€æ˜¯é€šè¿‡é™å®š<u>æä¾›</u>ä¸<u>åˆ†é…</u>çš„èµ„æºæ•°é‡ï¼Œå’Œè¿›ç¨‹çš„<u>æœ€å¤§éœ€æ±‚</u>ã€‚</p></li><li><p>ï»¿æ­»é”é¿å…ç®—æ³•<u>åŠ¨æ€æ£€æŸ¥</u>çš„èµ„æºåˆ†é…çŠ¶æ€ï¼Œä»¥ç¡®ä¿æ°¸è¿œä¸ä¼šæœ‰ä¸€ä¸ªç¯å½¢ç­‰å¾…çŠ¶æ€ã€‚</p></li><li><p>ï»¿å½“ä¸€ä¸ªè¿›ç¨‹è¯·æ±‚å¯ç”¨èµ„æºï¼Œç³»ç»Ÿå¿…é¡»åˆ¤æ–­ç«‹å³åˆ†é…æ˜¯å¦èƒ½<strong>ä½¿ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€</strong>ã€‚</p></li><li><p>ï»¿ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€æŒ‡ï¼šé’ˆå¯¹æ‰€æœ‰è¿›ç¨‹ï¼Œå­˜åœ¨å®‰å…¨åºåˆ—ã€‚</p></li><li><p>ï»¿åºåˆ—&lt;P1ï¼Œp2,â€¦â€¦ï¼ŒPN&gt;æ˜¯å®‰å…¨çš„ï¼šé’ˆå¯¹æ¯ä¸ªPi, Piè¦æ±‚çš„èµ„æºèƒ½å¤Ÿç”±å½“å‰å¯ç”¨çš„èµ„æº+æ‰€æœ‰çš„ Pj æŒæœ‰çš„èµ„æºæ¥æ»¡è¶³ï¼Œå…¶ä¸­j&lt;iã€‚</p><ul><li>å¦‚æœ Pi èµ„æºçš„éœ€æ±‚ä¸æ˜¯ç«‹å³å¯ç”¨ï¼Œé‚£ä¹ˆ Pi å¯ä»¥ç­‰åˆ°æ‰€æœ‰ Pj å®Œæˆã€‚</li><li>å½“ Pi å®Œæˆåï¼ŒP i + 1 å¯ä»¥å¾—åˆ°æ‰€éœ€è¦çš„èµ„æºï¼Œæ‰§è¡Œï¼Œè¿”å›æ‰€åˆ†é…çš„èµ„æºï¼Œå¹¶ç»ˆæ­¢ã€‚</li><li>ï»¿ç”¨åŒæ ·çš„æ–¹æ³•ã€‚Pi+2, Pi+3ï¼Œå’Œ Pn èƒ½è·å¾—å…¶æ‰€éœ€çš„èµ„æºã€‚</li></ul></li></ul><h5 id="é“¶è¡Œå®¶ç®—æ³•-é€šè¿‡åˆç†åˆ†é…èµ„æºä½¿å¾—æ­»é”é¿å…"><a href="#é“¶è¡Œå®¶ç®—æ³•-é€šè¿‡åˆç†åˆ†é…èµ„æºä½¿å¾—æ­»é”é¿å…" class="headerlink" title="é“¶è¡Œå®¶ç®—æ³•(é€šè¿‡åˆç†åˆ†é…èµ„æºä½¿å¾—æ­»é”é¿å…)"></a>é“¶è¡Œå®¶ç®—æ³•(é€šè¿‡åˆç†åˆ†é…èµ„æºä½¿å¾—æ­»é”é¿å…)</h5><h4 id="æ­»é”æ£€æµ‹ï¼š"><a href="#æ­»é”æ£€æµ‹ï¼š" class="headerlink" title="æ­»é”æ£€æµ‹ï¼š"></a>æ­»é”æ£€æµ‹ï¼š</h4><p>â€‹å°±æ˜¯é“¶è¡Œå®¶ç®—æ³•ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½åœ¨ç°æœ‰èµ„æºä¸‹ï¼Œè®©æ‰€æœ‰è¿›ç¨‹éƒ½è·‘é€š(æ—¶é—´å¤æ‚åº¦å¤§ã€å¼€é”€å¤§)</p><h4 id="æ­»é”æ¢å¤ï¼š"><a href="#æ­»é”æ¢å¤ï¼š" class="headerlink" title="æ­»é”æ¢å¤ï¼š"></a>æ­»é”æ¢å¤ï¼š</h4><ul><li>ï»¿æ–¹æ³•1ï¼šç»ˆæ­¢æ‰€æœ‰çš„æ­»é”è¿›ç¨‹</li><li>ï»¿æ–¹æ³•2ï¼šåœ¨ä¸€ä¸ªæ—¶é—´å†…ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹ç›´åˆ°æ­»é”æ¶ˆé™¤<ul><li>ç»ˆæ­¢è¿›ç¨‹çš„é¡ºåºåº”è¯¥æ˜¯ï¼š<ul><li>è¿›ç¨‹çš„ä¼˜å…ˆçº§</li><li>è¿›ç¨‹è¿è¡Œäº†å¤šä¹…ä»¥åŠéœ€è¦å¤šå°‘æ—¶é—´æ‰èƒ½å®Œæˆ</li><li>è¿›ç¨‹å ç”¨çš„èµ„æº</li><li>è¿›ç¨‹å®Œæˆéœ€è¦çš„èµ„æº</li><li>å¤šå°‘è¿›ç¨‹éœ€è¦è¢«ç»ˆæ­¢</li><li>è¿¸ç¨‹æ˜¯äº¤äº’è¿˜æ˜¯æ‰¹å¤„ç†</li></ul></li></ul></li></ul><h2 id="Chapter12è¿›ç¨‹é—´é€šä¿¡-IPCâ€”â€”Inter-Process-Communication"><a href="#Chapter12è¿›ç¨‹é—´é€šä¿¡-IPCâ€”â€”Inter-Process-Communication" class="headerlink" title="Chapter12è¿›ç¨‹é—´é€šä¿¡(IPCâ€”â€”Inter Process Communication)"></a>Chapter12è¿›ç¨‹é—´é€šä¿¡(IPCâ€”â€”Inter Process Communication)</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><h4 id="é€šä¿¡æ¨¡å‹"><a href="#é€šä¿¡æ¨¡å‹" class="headerlink" title="é€šä¿¡æ¨¡å‹"></a>é€šä¿¡æ¨¡å‹</h4><ul><li><p>ï»¿è¿›ç¨‹é€šä¿¡çš„æœºåˆ¶åŠåŒæ­¥</p></li><li><p>ï»¿ä¸ä½¿ç”¨å…±äº«å˜é‡çš„è¿¸ç¨‹é€šä¿¡</p></li><li><p>ï»¿ï»¿IPC facility æä¾›2ä¸ªæ“ä½œï¼š</p><ul><li>send(messageï¼‰ä¸€æ¶ˆæ¯å¤§å°å›ºå®šæˆ–è€…å¯å˜</li><li>ï»¿ï»¿receive (message)</li></ul></li><li><p>ï»¿å¦‚æœPå’ŒQæƒ³é€šä¿¡ï¼Œéœ€è¦ï¼š</p><ul><li>åœ¨å®ƒä»¬ä¹‹é—´å»ºç«‹é€šä¿¡é“¾è·¯</li><li>é€šè¿‡ send&#x2F;receiveäº¤æ¢æ¶ˆæ¯</li></ul></li><li><p>ï»¿é€šä¿¡é“¾è·¯çš„å®ç°</p><ul><li><p>ç‰©ç†ï¼ˆä¾‹å¦‚ï¼Œ<strong>å…±äº«å†…å­˜</strong>ï¼Œ<strong>ç¡¬ä»¶æ€»çº¿</strong>ï¼‰</p></li><li><p>ï»¿é€»è¾‘ï¼ˆä¾‹å¦‚ï¼Œé€»è¾‘å±æ€§ï¼‰</p></li></ul></li></ul><h4 id="ç›´æ¥ä¸é—´æ¥é€šä¿¡"><a href="#ç›´æ¥ä¸é—´æ¥é€šä¿¡" class="headerlink" title="ç›´æ¥ä¸é—´æ¥é€šä¿¡"></a>ç›´æ¥ä¸é—´æ¥é€šä¿¡</h4><h5 id="ç›´æ¥é€šä¿¡"><a href="#ç›´æ¥é€šä¿¡" class="headerlink" title="ç›´æ¥é€šä¿¡:"></a>ç›´æ¥é€šä¿¡:</h5><ul><li>è¿›ç¨‹å¿…é¡»æ­£ç¡®çš„å‘½åå¯¹æ–¹ï¼š<ul><li>send (P, message)        ä¸€ å‘é€ä¿¡æ¯åˆ°è¿›ç¨‹P</li><li>receive (Q, messaseï¼‰ ä¸€ ä»è¿›ç¨‹Qæ¥å—æ¶ˆæ¯</li></ul></li><li>é€šä¿¡é“¾è·¯çš„å±æ€§:<ul><li>è‡ªåŠ¨å»ºç«‹é“¾è·¯</li><li>ä¸€æ¡é“¾è·¯æ°å¥½å¯¹åº”ä¸€å¯¹é€šä¿¡è¿›ç¨‹</li><li>æ¯å¯¹è¿›ç¨‹ä¹‹é—´åªæœ‰ä¸€ä¸ªé“¾æ¥å­˜åœ¨</li><li>é“¾æ¥å¯ä»¥æ˜¯å•å‘çš„ï¼Œä½†é€šå¸¸ä¸ºåŒå‘çš„</li></ul></li></ul><h5 id="é—´æ¥é€šä¿¡"><a href="#é—´æ¥é€šä¿¡" class="headerlink" title="é—´æ¥é€šä¿¡:"></a>é—´æ¥é€šä¿¡:</h5><ul><li>ï»¿å®šå‘ä»æ¶ˆæ¯é˜Ÿåˆ—æ¥æ”¶æ¶ˆæ¯<ul><li>æ¯ä¸ªæ¶ˆæ¯é˜Ÿåˆ—éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ID</li><li>åªæœ‰å®ƒä»¬å…±äº«äº†ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿›ç¨‹æ‰èƒ½å¤Ÿé€šä¿¡</li></ul></li><li>ï»¿é€šä¿¡é“¾è·¯çš„å±æ€§<ul><li>åªæœ‰è¿›ç¨‹å…±äº«ä¸€ä¸ªå…±åŒçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ‰å»ºç«‹é“¾è·¯</li><li>é“¾æ¥å¯ä»¥ä¸è®¸å¤šè¿›ç¨‹ç›¸å…³è”</li><li>æ¯å¯¹è¿›ç¨‹å¯ä»¥å…±äº«å¤šä¸ªé€šä¿¡é“¾è·¯</li><li>è¿æ¥å¯ä»¥æ˜¯å•å‘æˆ–åŒå‘</li></ul></li><li>ï»¿æ“ä½œ<ul><li>åˆ›å»ºä¸€ä¸ªæ–°çš„æ¶ˆæ¯é˜Ÿåˆ—</li><li>é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å‘é€å’Œæ¥æ”¶æ¶ˆæ¯</li><li>é”€æ¯æ¶ˆæ¯é˜Ÿåˆ—</li></ul></li><li>ï»¿åŸè¯­çš„å®šä¹‰å¦‚ä¸‹ï¼š<ul><li>send ï¼ˆA, messageï¼‰ä¸€ å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—A</li><li>receive (A,messageï¼‰ä¸€ ä»é˜Ÿåˆ— Aæ¥å—æ¶ˆæ¯</li></ul></li></ul><h4 id="é˜»å¡ä¸éé˜»å¡ï¼š"><a href="#é˜»å¡ä¸éé˜»å¡ï¼š" class="headerlink" title="é˜»å¡ä¸éé˜»å¡ï¼š"></a>é˜»å¡ä¸éé˜»å¡ï¼š</h4><p>â€‹é˜»å¡ï¼šå¼‚æ­¥</p><p>â€‹éé˜»å¡ï¼šåŒæ­¥(å‘é€æ–¹ä¸€å®šè¦ç­‰åˆ°æ¥æ”¶æ–¹æ”¶åˆ°æ¶ˆæ¯åå†è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ)</p><h4 id="é€šä¿¡é“¾è·¯ç¼“å†²ï¼š"><a href="#é€šä¿¡é“¾è·¯ç¼“å†²ï¼š" class="headerlink" title="é€šä¿¡é“¾è·¯ç¼“å†²ï¼š"></a>é€šä¿¡é“¾è·¯ç¼“å†²ï¼š</h4><ul><li>é˜Ÿåˆ—çš„æ¶ˆæ¯è¢«é™„åŠ åˆ°é“¾è·¯ï¼›å¯ä»¥æ˜¯ä»¥ä¸‹3ç§æ–¹å¼ä¹‹ä¸€ï¼š</li></ul><ol><li><p>ï»¿ï»¿ï»¿0å®¹é‡<br> å‘é€æ–¹å¿…é¡»ç­‰å¾…æ¥æ”¶æ–¹ (rendezvous)</p></li><li><p>ï»¿ï»¿æœ‰é™å®¹é‡ â€”â€” n messagesçš„æœ‰é™é•¿åº¦</p><p>â€‹å¦‚æœé˜Ÿåˆ—æ»¡ï¼Œå‘é€æ–¹å¿…é¡»ç­‰å¾…</p></li><li><p>ï»¿ï»¿ï»¿æ— é™å®¹é‡â€”â€”æ— é™é•¿åº¦<br> å‘é€æ–¹ä¸éœ€è¦ç­‰å¾…</p></li></ol><h3 id="ä¿¡å·"><a href="#ä¿¡å·" class="headerlink" title="ä¿¡å·"></a>ä¿¡å·</h3><ul><li><p><u><strong>è½¯ä»¶</strong></u>ä¸­æ–­é€šçŸ¥äº‹ä»¶å¤„ç†</p></li><li><p>Examples: SIGFPE, SIGKILL, SIGUSR1, SIGSTOP, SIGCONT</p></li><li><p>ï»¿æ¥æ”¶åˆ°ä¿¡å·æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ</p><ul><li>Catch:æŒ‡å®šä¿¡å·å¤„ç†å‡½æ•°è¢«è°ƒç”¨</li><li>Ignoreï¼šä¾é æ“ä½œç³»ç»Ÿçš„é»˜è®¤æ“ä½œ</li></ul></li><li><p>ï»¿ï»¿Example: Abort, memory dump, suspend or resume process</p><ul><li>Maskï¼šé—­å¡ä¿¡å·å› æ­¤ä¸ä¼šä¼ é€<ul><li>ï»¿å¯èƒ½æ˜¯æš‚æ—¶çš„ï¼ˆå½“å¤„ç†åŒæ ·ç±»å‹çš„ä¿¡å·ï¼‰</li></ul></li></ul></li><li><p>ï»¿ä¸è¶³<br> ä¸èƒ½ä¼ è¾“è¦äº¤æ¢çš„ä»»ä½•æ•°æ®</p></li></ul><h3 id="ç®¡é“"><a href="#ç®¡é“" class="headerlink" title="ç®¡é“"></a>ç®¡é“</h3><p>â€‹ä¸»è¦æ˜¯ä¸ºäº† å®ç°ä½¿ä¸€ä¸ªè¿›ç¨‹çš„è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥(è¿™ä¸¤ä¸ªè¿›ç¨‹éƒ½æ˜¯shellè¿›ç¨‹çš„å­è¿›ç¨‹ï¼Œshellè¿›ç¨‹ä¸ºå®ƒä»¬ä¹‹é—´çš„é€šä¿¡åˆ›å»ºé€šé“)</p><h3 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h3><p>â€‹<a href="https://tangjiayang.github.io/2023/06/02/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">https://tangjiayang.github.io/2023/06/02/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/</a></p><p>â€‹ä¸€ç§é—´æ¥é€šä¿¡æ–¹å¼</p><h3 id="å…±äº«å†…å­˜"><a href="#å…±äº«å†…å­˜" class="headerlink" title="å…±äº«å†…å­˜"></a>å…±äº«å†…å­˜</h3><ul><li><p>è¿›ç¨‹</p><ul><li>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç§æœ‰åœ°å€ç©ºé—´</li><li>åœ¨æ¯ä¸ªåœ°å€ç©ºé—´å†…ï¼Œæ˜ç¡®åœ°è®¾ç½®äº†å…±äº«å†…å­˜æ®µ</li></ul></li><li><p>ï»¿ä¼˜ç‚¹</p><ul><li>å¿«é€Ÿã€æ–¹ä¾¿åœ°å…±äº«æ•°æ®</li></ul></li><li><p>ï»¿ä¸è¶³</p><ul><li>å¿…é¡»åŒæ­¥æ•°æ®è®¿é—®</li></ul></li></ul><p></p><h2 id="Chapter13-æ–‡ä»¶ç³»ç»Ÿ"><a href="#Chapter13-æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="Chapter13 æ–‡ä»¶ç³»ç»Ÿ"></a>Chapter13 æ–‡ä»¶ç³»ç»Ÿ</h2><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><h4 id="æ–‡ä»¶ç³»ç»Ÿå’Œæ–‡ä»¶"><a href="#æ–‡ä»¶ç³»ç»Ÿå’Œæ–‡ä»¶" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿå’Œæ–‡ä»¶"></a>æ–‡ä»¶ç³»ç»Ÿå’Œæ–‡ä»¶</h4><ul><li><p>æ–‡ä»¶ç³»ç»Ÿï¼šä¸€ç§ç”¨äºæŒä¹…æ€§å­˜å‚¨çš„ç³»ç»ŸæŠ½è±¡</p><ul><li>åœ¨å­˜å‚¨å™¨ä¸Šï¼šç»„ç»‡ã€æ§åˆ¶ã€å¯¼èˆªã€è®¿é—®å’Œæ£€ç´¢æ•°æ®</li><li>å¤§å¤šæ•°è®¡ç®—æœºç³»ç»ŸåŒ…å«æ–‡ä»¶ç³»ç»Ÿ</li><li>ä¸ªäººç”µè„‘ã€æœåŠ¡å™¨ã€ç¬”è®°æœ¬ç”µè„‘</li><li>iPod.Tivo &#x2F;æœºé¡¶ç›’ã€æ‰‹æœº&#x2F;æŒä¸Šç”µè„‘</li><li>Google å¯èƒ½æ˜¯ç”±ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿæ„æˆçš„</li></ul></li><li><p>æ–‡ä»¶ï¼šæ–‡ä»¶ç³»ç»Ÿä¸­<strong>ä¸€ä¸ªå•å…ƒçš„ç›¸å…³æ•°æ®åœ¨æ“ä½œç³»ç»Ÿä¸­çš„æŠ½è±¡</strong></p></li></ul><h5 id="æ–‡ä»¶ç³»ç»Ÿçš„åŠŸèƒ½ï¼š"><a href="#æ–‡ä»¶ç³»ç»Ÿçš„åŠŸèƒ½ï¼š" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿçš„åŠŸèƒ½ï¼š"></a>æ–‡ä»¶ç³»ç»Ÿçš„åŠŸèƒ½ï¼š</h5><ul><li>ï»¿åˆ†é…æ–‡ä»¶ç£ç›˜ç©ºé—´<ul><li>ç®¡ç†<strong>æ–‡ä»¶å—</strong>ï¼ˆå“ªä¸€å—å±äºå“ªä¸€ä¸ªæ–‡ä»¶ï¼‰</li><li>ç®¡ç†<strong>ç©ºé—²ç©ºé—´</strong>(å“ªä¸€å—æ˜¯ç©ºé—²çš„ï¼‰</li><li>åˆ†é…ç®—æ³•ï¼ˆç­–ç•¥ï¼‰</li></ul></li><li>ï»¿ç®¡ç†æ–‡ä»¶é›†åˆ<ul><li><strong>å®šä½</strong>æ–‡ä»¶åŠå…¶å†…å®¹</li><li><strong>å‘½å</strong>ï¼šé€šè¿‡åå­—æ‰¾åˆ°æ–‡ä»¶çš„æ¥å£</li><li>æœ€å¸¸è§ï¼šåˆ†å±‚æ–‡ä»¶ç³»ç»Ÿ</li><li>æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ˆç»„ç»‡æ–‡ä»¶çš„ä¸åŒæ–¹å¼ï¼‰</li></ul></li><li>ï»¿æä¾›çš„ä¾¿åˆ©åŠç‰¹å¾<ul><li><strong>ä¿æŠ¤</strong>ï¼šåˆ†å±‚æ¥ä¿æŠ¤æ•°æ®å®‰å…¨</li><li><strong>å¯é æ€§&#x2F;æŒä¹…æ€§</strong>ï¼šä¿æŒæ–‡ä»¶çš„æŒä¹…å³ä½¿å‘ç”Ÿå´©æºƒã€åª’ä½“é”™è¯¯ã€æ”»å‡»ç­‰</li></ul></li></ul><h5 id="æ–‡ä»¶å’Œå—ï¼š"><a href="#æ–‡ä»¶å’Œå—ï¼š" class="headerlink" title="æ–‡ä»¶å’Œå—ï¼š"></a>æ–‡ä»¶å’Œå—ï¼š</h5><ul><li>ï»¿æ–‡ä»¶å±æ€§ï¼š<ul><li>åç§°ã€ç±»å‹ã€ä½ç½®ã€å¤§å°ï¼Œä¿æŠ¤ã€åˆ›å»ºè€…ã€åˆ›å»ºæ—¶é—´ã€æœ€è¿‘ä¿®æ”¹æ—¶é—´ã€â€¦</li></ul></li><li>ï»¿æ–‡ä»¶å¤´ï¼š<ul><li>åœ¨å­˜å‚¨å…ƒæ•°æ®ä¸­ä¿å­˜äº†æ¯ä¸ªæ–‡ä»¶çš„ä¿¡æ¯</li><li>ä¿å­˜æ–‡ä»¶çš„å±æ€§</li><li>è·Ÿè¸ªå“ªä¸€å—å­˜å‚¨å—å±äºé€»è¾‘ä¸Šæ–‡ä»¶ç»“æ„çš„å“ªä¸ªåç§»</li></ul></li></ul><h4 id="æ–‡ä»¶æè¿°ç¬¦"><a href="#æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦"></a>æ–‡ä»¶æè¿°ç¬¦</h4><ul><li><p>éœ€è¦å…ƒæ•°æ®æ•°æ®æ¥ç®¡ç†æ‰“å¼€æ–‡ä»¶ï¼š</p><ul><li>æ–‡ä»¶æŒ‡é’ˆï¼š<u>æŒ‡å‘æœ€è¿‘çš„ä¸€æ¬¡è¯»å†™ä½ç½®</u>ï¼Œæ¯ä¸ªæ‰“å¼€äº†è¿™ä¸ªæ–‡ä»¶çš„è¿›ç¨‹éƒ½æœ‰è¿™ä¸ªæŒ‡é’ˆ</li><li>æ–‡ä»¶æ‰“å¼€è®¡æ•°ï¼šè®°å½•æ–‡ä»¶æ‰“å¼€çš„æ¬¡æ•°â€”â€”å½“æœ€åä¸€ä¸ªè¿›ç¨‹å…³é—­äº†æ–‡ä»¶æ—¶ï¼Œå…è®¸å°†å…¶ä»æ‰“å¼€æ–‡ä»¶è¡¨ä¸­ç§»é™¤</li><li>æ–‡ä»¶ç£ç›˜ä½ç½®ï¼šç¼“å­˜æ•°æ®è®¿é—®ä¿¡æ¯</li><li>è®¿é—®æƒé™ï¼šæ¯ä¸ªç¨‹åºè®¿é—®æ¨¡å¼ä¿¡æ¯</li></ul></li><li><p>ï»¿ç”¨æˆ·æ€ä¹ˆè®¿é—®æ–‡ä»¶</p><ul><li>åœ¨ç³»ç»Ÿå±‚é¢éœ€è¦çŸ¥é“ç”¨æˆ·çš„è®¿é—®æ¨¡å¼ï¼š</li><li>ï»¿é¡ºåºè®¿é—®ï¼šæŒ‰å­—èŠ‚ä¾æ¬¡è¯»å–<ul><li>å‡ ä¹æ‰€æœ‰çš„è®¿é—®éƒ½æ˜¯è¿™ç§æ–¹å¼</li></ul></li><li>ï»¿éšæœºè®¿é—®ï¼šä»ä¸­é—´è¯»å†™<ul><li>ä¸å¸¸ç”¨ï¼Œä½†æ˜¯ä»ç„¶é‡è¦ï¼ä¾‹å¦‚ï¼Œè™šæ‹Ÿå†…å­˜æ”¯æŒæ–‡ä»¶ï¼šå†…å­˜é¡µå­˜å‚¨åœ¨æ–‡ä»¶ä¸­</li><li>æ›´åŠ å¿«é€Ÿ ä¸€ ä¸å¸Œæœ›è·å–æ–‡ä»¶ä¸­é—´çš„å†…å®¹çš„æ—¶å€™ä¹Ÿå¿…é¡»å…ˆè·å–å—å†…æ‰€æœ‰å­—èŠ‚ã€‚</li></ul></li><li>åŸºäºå†…å®¹è®¿é—®ï¼šé€šè¿‡ç‰¹å¾<ul><li>è®¸å¤šç³»ç»Ÿä¸æä¾›æ­¤ç§è®¿é—®æ–¹å¼ï¼Œç›¸åï¼Œæ•°æ®åº“æ˜¯å»ºç«‹åœ¨ç´¢å¼•å†…å®¹çš„ç£ç›˜è®¿é—®ä¸Šï¼ˆéœ€è¦é«˜æ•ˆçš„éšæœºè®¿é—®)</li></ul></li></ul></li><li><p>ï»¿ï»¿å¤šç”¨æˆ·ç³»ç»Ÿä¸­çš„æ–‡ä»¶å…±äº«ï¼š</p><ul><li>ï»¿è®¿é—®æ§åˆ¶<ul><li>è°èƒ½å¤Ÿè·å¾—å“ªäº›æ–‡ä»¶çš„å“ªäº›è®¿é—®æƒé™</li><li>è®¿é—®æ¨¡å¼ï¼šè¯»ã€å†™ã€æ‰§è¡Œã€åˆ é™¤ã€åˆ—ä¸¾ç­‰</li></ul></li><li>ï»¿æ–‡ä»¶è®¿é—®æ§åˆ¶åˆ—è¡¨ (ACL)<ul><li>&lt;æ–‡ä»¶å®ä½“ï¼Œæƒé™&gt;</li></ul></li><li>ï»¿Unix æ¨¡å¼<ul><li>ã€ˆç”¨æˆ·|ç»„|æ‰€æœ‰äººï¼Œè¯»|å†™|å¯æ‰§è¡Œã€‰</li><li>ç”¨æˆ·IDè¯†åˆ«ç”¨æˆ·ï¼Œè¡¨æ˜æ¯ä¸ªç”¨æˆ·æ‰€å…è®¸çš„æƒé™åŠä¿æŠ¤æ¨¡å¼</li><li>ç»„IDå…è®¸ç”¨æˆ·ç»„æˆç»„ï¼Œå¹¶æŒ‡å®šäº†ç»„è®¿é—®æƒé™</li></ul></li><li>ï»¿æŒ‡å®šå¤šç”¨æˆ·&#x2F;å®¢æˆ·å¦‚ä½•åŒæ—¶è®¿é—®å…±äº«æ–‡ä»¶<ul><li>å’Œè¿‡ç¨‹åŒæ­¥ç®—æ³•ç›¸ä¼¼</li><li>å› ç£ç›˜I&#x2F;0å’Œç½‘ç»œå»¶è¿Ÿè€Œè®¾è®¡ç®€å•</li></ul></li><li>ï»¿ï»¿Unix æ–‡ä»¶ç³»ç»Ÿ(UFS) è¯­ä¹‰<ul><li>å¯¹æ‰“å¼€æ–‡ä»¶çš„å†™å…¥å†…å®¹ç«‹å³å¯¹å…¶ä»–æ‰“å¼€åŒä¸€æ–‡ä»¶çš„å…¶ä»–ç”¨æˆ·å¯è§</li><li>å…±äº«æ–‡ä»¶æŒ‡é’ˆå…è®¸å¤šç”¨æˆ·åŒæ—¶è¯»å–å’Œå†™å…¥æ–‡ä»¶</li></ul></li><li>ï»¿ä¼šè¯è¯­ä¹‰<ul><li>å†™å…¥å†…å®¹åªæœ‰å½“æ–‡ä»¶å…³é—­æ—¶å¯è§</li></ul></li><li>ï»¿é”<ul><li>ä¸€äº›æ“ä½œç³»ç»Ÿå’Œæ–‡ä»¶ç³»ç»Ÿæä¾›è¯¥åŠŸèƒ½</li></ul></li></ul></li></ul><h4 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h4><ul><li><p>æ–‡ä»¶ä»¥ç›®å½•çš„æ–¹å¼ç»„ç»‡èµ·æ¥</p></li><li><p>ç›®å½•æ˜¯ä¸€ç±»ç‰¹æ®Šçš„æ–‡ä»¶</p><ul><li>æ¯ä¸ªç›®å½•éƒ½åŒ…å«äº†ä¸€å¼ è¡¨&lt;name, pointer to file header&gt;</li></ul></li><li><p>ç›®å½•å’Œæ–‡ä»¶çš„æ ‘å‹ç»“æ„</p><ul><li>æ—©æœŸçš„æ–‡ä»¶ç³»ç»Ÿæ˜¯æ‰å¹³çš„ ï¼ˆåªæœ‰ä¸€å±‚ç›®å½•ï¼‰</li></ul></li><li><p>ï»¿å…¸å‹æ“ä½œ</p><ul><li>æœç´¢æ–‡ä»¶</li><li>åˆ›å»ºæ–‡ä»¶</li><li>åˆ é™¤æ–‡ä»¶</li><li>æšä¸¾ç›®å½•</li><li>é‡å‘½åæ–‡ä»¶</li><li>åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­éå†ä¸€ä¸ªè·¯å¾„</li></ul></li><li><p>ï»¿æ“ä½œç³»ç»Ÿåº”è¯¥åªå…è®¸å†…æ ¸æ¨¡å¼ä¿®æ”¹ç›®å½•</p><ul><li>ç¡®ä¿æ˜ å°„çš„å®Œæ•´æ€§</li><li>åº”ç”¨ç¨‹åºèƒ½å¤Ÿè¯»ç›®å½• ï¼ˆå¦‚1s)</li></ul></li><li><p>ï»¿åå­—è§£æï¼šé€»è¾‘åå­—è½¬æ¢æˆç‰©ç†èµ„æºï¼ˆå¦‚æ–‡ä»¶ï¼‰çš„è¿‡ç¨‹</p><ul><li>åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼šåˆ°å®é™…æ–‡ä»¶çš„æ–‡ä»¶åï¼ˆè·¯å¾„ï¼‰</li><li>éå†æ–‡ä»¶ç›®å½•ç›´åˆ°æ‰¾åˆ°ç›®æ ‡æ–‡ä»¶</li></ul></li><li><p>ï»¿ä¸¾ä¾‹ï¼šè§£æ â€œ&#x2F;bin&#x2F;lsâ€</p><ul><li>è¯»å–rootçš„æ–‡ä»¶å¤´ï¼ˆåœ¨ç£ç›˜å›ºå®šä½ç½®ï¼‰</li><li>è¯»å–rootçš„æ•°æ®å—ï¼šæœç´¢ â€œbinâ€ é¡¹</li><li>è¯»å–binçš„æ–‡ä»¶å¤´</li><li>è¯»å–binçš„æ•°æ®å—ï¼šæœç´¢ â€œlsâ€ é¡¹</li><li>è¯»å–lsçš„æ–‡ä»¶å¤´</li></ul></li><li><p>ï»¿å½“å‰å·¥ä½œç›®å½•</p><ul><li>æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šæŒ‡å‘ä¸€ä¸ªæ–‡ä»¶ç›®å½•ç”¨äºè§£ææ–‡ä»¶å</li><li>å…è®¸ç”¨æˆ·æŒ‡å®šç›¸å¯¹è·¯å¾„æ¥ä»£æ›¿ç»å¯¹è·¯å¾„</li></ul></li></ul><h4 id="æ–‡ä»¶åˆ«å"><a href="#æ–‡ä»¶åˆ«å" class="headerlink" title="æ–‡ä»¶åˆ«å"></a>æ–‡ä»¶åˆ«å</h4><h5 id="åŸºæœ¬æ¦‚å¿µ-1"><a href="#åŸºæœ¬æ¦‚å¿µ-1" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h5><ul><li><p>ä¸¤ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶åå…³è”åŒä¸€ä¸ªæ–‡ä»¶</p></li><li><p>ï»¿ç¡¬é“¾æ¥ï¼š<strong>å¤šä¸ªæ–‡ä»¶é¡¹æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶</strong></p></li><li><p>ï»¿è½¯é“¾æ¥ï¼šä»¥â€œå¿«æ·æ–¹å¼â€æŒ‡å‘å…¶ä»–æ–‡ä»¶(**â€œ<u>å¿«æ·æ–¹å¼æ–‡ä»¶çš„å†…å®¹æ˜¯å¦ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„å</u>**â€)</p></li><li><p>ï»¿é€šè¿‡å­˜å‚¨çœŸå®æ–‡ä»¶çš„é€»è¾‘åç§°æ¥å®ç°</p></li></ul><h4 id="æ–‡ä»¶ç³»ç»Ÿç§ç±»"><a href="#æ–‡ä»¶ç³»ç»Ÿç§ç±»" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿç§ç±»"></a>æ–‡ä»¶ç³»ç»Ÿç§ç±»</h4><ul><li><p>ï»¿ç£ç›˜æ–‡ä»¶ç³»ç»Ÿ</p><ul><li>æ–‡ä»¶å­˜å‚¨åœ¨æ•°æ®å­˜å‚¨è®¾å¤‡ä¸Šï¼Œå¦‚ç£ç›˜ã€‚</li><li>ä¾‹å¦‚ï¼šFAT, NTFS, ext2&#x2F;3ï¼Œ IS09660ï¼Œç­‰</li></ul></li><li><p>ï»¿æ•°æ®åº“æ–‡ä»¶ç³»ç»Ÿ</p><ul><li>æ–‡ä»¶æ ¹æ®å…¶ç‰¹å¾æ˜¯å¯è¢«å¯»å€ï¼ˆè¾¨è¯†ï¼‰çš„</li><li>ä¾‹å¦‚ï¼šwinFS</li></ul></li><li><p>ï»¿æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿ</p><ul><li>è®°å½•æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹&#x2F;äº‹ä»¶</li><li>ä¾‹å¦‚ï¼šjournaling file system</li></ul></li><li><p>ï»¿ç½‘ç»œ&#x2F;åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ</p><ul><li><p>ï»¿æ–‡ä»¶å¯ä»¥é€šè¿‡ç½‘ç»œè¢«å…±äº«</p><ul><li>æ–‡ä»¶ä½äºè¿œç¨‹æœåŠ¡å™¨</li><li>å®¢æˆ·ç«¯è¿œç¨‹æŒ‚è½½æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿ</li><li>æ ‡å‡†ç³»ç»Ÿæ–‡ä»¶è®¿é—®è¢«è½¬æ¢æˆè¿œç¨‹è®¿é—®</li><li>æ ‡å‡†æ–‡ä»¶å…±äº«åè®®ï¼šNFS for Unix, CIFS for windows</li></ul></li><li><p>ï»¿åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„é—®é¢˜</p><ul><li>å®¢æˆ·ç«¯å’Œå®¢æˆ·ç«¯ä¸Šçš„ç”¨æˆ·è¾¨åˆ«èµ·æ¥å¾ˆå¤æ‚</li><li>ä¾‹å¦‚ï¼ŒNFSæ˜¯ä¸å®‰å…¨çš„</li><li><strong>ä¸€è‡´æ€§é—®é¢˜</strong></li><li>é”™è¯¯å¤„ç†æ¨¡å¼</li></ul></li><li><p>ä¾‹å¦‚ï¼šNFS, SMB, AFS, GFS</p></li></ul></li><li><p>ï»¿ç‰¹æ®Š&#x2F;è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</p></li></ul><h3 id="è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ"><a href="#è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ"></a>è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</h3><ul><li><p>åˆ†å±‚ç»“æ„</p><ul><li>ä¸Šå±‚ï¼šè™šæ‹Ÿ(é€»è¾‘)æ–‡ä»¶ç³»ç»Ÿ</li><li>åº•å±‚ï¼šç‰¹å®šæ–‡ä»¶ç³»ç»Ÿæ¨¡å—</li></ul></li><li><p>ï»¿ç›®çš„</p><ul><li>å¯¹æ‰€æœ‰ä¸åŒæ–‡ä»¶ç³»ç»Ÿçš„æŠ½è±¡(è®©ä¸Šå±‚ä½¿ç”¨ç»Ÿä¸€çš„æ¥å£å¯¹ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œç»Ÿä¸€ç®¡ç†)</li></ul></li><li><p>ï»¿åŠŸèƒ½</p><ul><li>æä¾›ç›¸åŒçš„æ–‡ä»¶å’Œæ–‡ä»¶ç³»ç»Ÿæ¥å£</li><li>ç®¡ç†æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶ç³»ç»Ÿå…³è”çš„æ•°æ®ç»“æ„</li><li>é«˜æ•ˆæŸ¥è¯¢ä¾‹ç¨‹ï¼Œéå†æ–‡ä»¶ç³»ç»Ÿ</li><li>ä¸ç‰¹å®šæ–‡ä»¶ç³»ç»Ÿæ¨¡å—çš„äº¤äº’</li></ul></li><li><p>å®ç°</p><ul><li>ï»¿å·æ§åˆ¶å— (Unix: â€œsuperblockâ€ï¼‰<ul><li>æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸€ä¸ª</li><li>æ–‡ä»¶ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯</li><li>å—ã€å—å¤§å°ï¼Œç©ºä½™å—ã€è®¡æ•°&#x2F;æŒ‡é’ˆç­‰</li></ul></li><li>ï»¿æ–‡ä»¶æ§åˆ¶å— (Unixï¼š â€vnodeâ€ or â€œinodeâ€ï¼‰<ul><li>æ¯ä¸ªæ–‡ä»¶ä¸€ä¸ª</li><li>æ–‡ä»¶è¯¦ç»†ä¿¡æ¯</li><li>è®¸å¯ã€æ‹¥æœ‰è€…ã€å¤§å°ã€æ•°æ®åº“ä½ç½®ç­‰</li></ul></li><li>ï»¿ç›®å½•èŠ‚ç‚¹ (Linux: â€dentryâ€ï¼‰<ul><li>æ¯ä¸ªç›®å½•é¡¹ä¸€ä¸ªï¼ˆç›®å½•å’Œæ–‡ä»¶ï¼‰</li><li>å°†ç›®å½•é¡¹æ•°æ®ç»“æ„åŠæ ‘å‹å¸ƒå±€ç¼–ç æˆæ ‘å‹æ•°æ®ç»“æ„</li><li>æŒ‡å‘æ–‡ä»¶æ§åˆ¶å—ã€çˆ¶èŠ‚ç‚¹ã€é¡¹ç›®åˆ—è¡¨ç­‰</li></ul></li></ul></li><li><p>æ–‡ä»¶ç³»ç»Ÿæ•°æ®ç»“æ„</p><ul><li>å·æ§åˆ¶å—ï¼ˆæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸€ä¸ªï¼‰</li><li>æ–‡ä»¶æ§åˆ¶å—ï¼ˆæ¯ä¸ªæ–‡ä»¶ä¸€ä¸ªï¼‰</li><li>ç›®å½•èŠ‚ç‚¹(æ¯ä¸ªç›®å½•é¡¹ä¸€ä¸ª)</li></ul></li><li><p>ï»¿æŒç»­å­˜å‚¨åœ¨äºŒçº§å­˜å‚¨ä¸­</p><ul><li>åˆ†é…åœ¨å­˜å‚¨è®¾å¤‡ä¸­çš„æ•°æ®å—ä¸­</li></ul></li><li><p>ï»¿å½“éœ€è¦æ—¶åŠ è½½è¿›å†…å­˜</p><ul><li>å·æ§åˆ¶æ¨¡å— ï¼šå½“æ–‡ä»¶ç³»ç»ŸæŒ‚è½½æ—¶è¿›å…¥å†…å­˜</li><li>æ–‡ä»¶æ§åˆ¶å—ï¼šå½“æ–‡ä»¶è¢«è®¿é—®æ—¶è¿›å…¥å†…å­˜</li><li>ç›®å½•èŠ‚ç‚¹ï¼šåœ¨éå†ä¸€ä¸ªæ–‡ä»¶è·¯å¾„æ—¶è¿›å…¥å†…å­˜</li></ul></li></ul><h3 id="æ•°æ®å—ç¼“å­˜"><a href="#æ•°æ®å—ç¼“å­˜" class="headerlink" title="æ•°æ®å—ç¼“å­˜"></a>æ•°æ®å—ç¼“å­˜</h3><ul><li>ï»¿æ•°æ®å—æŒ‰éœ€è¯»å…¥å†…å­˜<ul><li>æä¾› read() æ“ä½œ</li><li>é¢„è¯»ï¼šé¢„é€‰è¯»å–åé¢çš„æ•°æ®å—</li></ul></li><li>ï»¿æ•°æ®å—ä½¿ç”¨åè¢«ç¼“å­˜<ul><li>å‡è®¾æ•°æ®å°†ä¼šå†æ¬¡è¢«ä½¿ç”¨</li><li>å†™æ“ä½œå¯èƒ½è¢«ç¼“å­˜å’Œå»¶è¿Ÿå†™å…¥</li></ul></li><li>ï»¿ä¸¤ç§æ•°æ®å—ç¼“å­˜æ–¹å¼<ul><li>æ™®é€šç¼“å†²åŒºç¼“å­˜</li><li>é¡µç¼“å­˜ï¼šç»Ÿä¸€ç¼“å­˜æ•°æ®å—å’Œå†…å­˜é¡µ<ul><li>ï»¿åˆ†é¡µè¦æ±‚<ul><li>å½“éœ€è¦ä¸€ä¸ªé¡µæ—¶æ‰æ ¼å…¶è½½å…¥å†…å­˜</li></ul></li><li>ï»¿æ”¯æŒå­˜å‚¨<ul><li>ä¸€ä¸ªé¡µï¼ˆåœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼‰å¯ä»¥è¢«æ˜ å°„åˆ°ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶ä¸­ï¼ˆåœ¨äºŒçº§å­˜å‚¨ä¸­ï¼‰</li></ul></li><li>æ–‡ä»¶æ•°æ®å—çš„é¡µç¼“å­˜<ul><li>åœ¨è™šæ‹Ÿå†…å­˜ä¸­æ–‡ä»¶æ•°æ®å—è¢«æ˜ å°„æˆé¡µ</li><li>æ–‡ä»¶çš„è¯»&#x2F;å†™æ“ä½œè¢«è½¬æ¢æˆå¯¹å†…å­˜çš„è®¿é—®</li><li>å¯èƒ½å¯¼è‡´ç¼ºé¡µå’Œ&#x2F;æˆ–è®¾ç½®ä¸ºè„é¡µ</li></ul></li></ul></li></ul></li></ul><h3 id="æ‰“å¼€æ–‡ä»¶çš„æ•°æ®ç»“æ„"><a href="#æ‰“å¼€æ–‡ä»¶çš„æ•°æ®ç»“æ„" class="headerlink" title="æ‰“å¼€æ–‡ä»¶çš„æ•°æ®ç»“æ„"></a>æ‰“å¼€æ–‡ä»¶çš„æ•°æ®ç»“æ„</h3><ul><li>ï»¿æ‰“å¼€æ–‡ä»¶æè¿°<ul><li>æ–‡ä»¶çŠ¶æ€ä¿¡æ¯</li><li>ç›®å½•é¡¹ã€å½“å‰æ–‡ä»¶æŒ‡é’ˆã€æ–‡ä»¶æ“ä½œè®¾ç½®ç­‰</li></ul></li><li>ï»¿æ‰“å¼€æ–‡ä»¶è¡¨<ul><li>ä¸€ä¸ªè¿›ç¨‹ä¸€ä¸ª</li><li>ç³»ç»Ÿçº§</li><li>æ¯ä¸ªå·æ§åˆ¶å—ä¹Ÿä¼šä¿å­˜ä¸€ä¸ªåˆ—è¡¨</li><li>æ‰€ä»¥å¦‚æœæœ‰æ–‡ä»¶è¢«æ‰“å¼€å°†ä¸èƒ½è¢«å¸è½½</li></ul></li></ul><h3 id="æ–‡ä»¶åˆ†é…"><a href="#æ–‡ä»¶åˆ†é…" class="headerlink" title="æ–‡ä»¶åˆ†é…"></a>æ–‡ä»¶åˆ†é…</h3><ul><li><p>ï»¿å¤§å¤šæ•°æ–‡ä»¶éƒ½å¾ˆå°</p><ul><li>éœ€è¦å¯¹å°æ–‡ä»¶æä¾›å¼ºåŠ›çš„æ”¯æŒ</li><li>å—ç©ºé—´ä¸èƒ½å¤ªå¤§</li></ul></li><li><p>ï»¿ï»¿ä¸€äº›æ–‡ä»¶éå¸¸å¤§</p><ul><li>å¿…é¡»æ”¯æŒå¤§æ–‡ä»¶ ï¼ˆ64-bit æ–‡ä»¶åç§»ï¼‰</li><li>å¤§æ–‡ä»¶è®¿é—®éœ€è¦ç›¸å½“é«˜æ•ˆ</li></ul></li><li><p>ï»¿å¦‚ä½•ä¸ºä¸€ä¸ªæ–‡ä»¶åˆ†é…æ•°æ®å—</p><ul><li>ï»¿åˆ†é…æ–¹å¼<ul><li>è¿ç»­åˆ†é…<ul><li>ä¼˜ç‚¹ï¼š<ul><li>æ–‡ä»¶è¯»å–è¡¨ç°å¥½</li><li>é«˜æ•ˆçš„é¡ºåºå’Œéšæœºè®¿é—®</li></ul></li><li>ç¼ºç‚¹ï¼š<ul><li>ç¢ç‰‡</li><li>å¦‚æ–‡ä»¶å¢å¤§ï¼Œåˆ™ä¸å¥½å¤„ç†</li></ul></li></ul></li><li>é“¾å¼åˆ†é…<ul><li>æ–‡ä»¶ä»¥æ•°æ®å—é“¾è¡¨çš„æ–¹å¼å­˜å‚¨</li><li>æ–‡ä»¶å¤´åŒ…å«äº†ä»ç¬¬ä¸€å—åˆ°æœ€åä¸€å—çš„æŒ‡é’ˆ</li><li>ä¼˜ç‚¹ï¼š<ul><li>åˆ›å»ºã€å¢å¤§ã€ç¼©å°å®¹æ˜“</li><li>æ²¡æœ‰ç¢ç‰‡</li></ul></li><li>ç¼ºç‚¹ï¼š<ul><li>ä¸å¯èƒ½è¿›è¡ŒçœŸæ­£çš„éšæœºè®¿é—®(é“¾è¡¨ï¼Œæ‰€ä»¥åªèƒ½ä¸²å‹è®¿é—®)</li><li>å¯é æ€§(ä¸­é€”æ–­ç”µï¼Œå¯¼è‡´é“¾è¡¨è¢«ç ´å)</li></ul></li></ul></li><li>ç´¢å¼•åˆ†é…<ul><li>ï»¿ä¸ºæ¯ä¸ªæ–‡ä»¶åˆ›å»ºä¸€ä¸ªåä¸ºç´¢å¼•æ•°æ®å—çš„éæ•°æ®æ•°æ®å—<ul><li>åˆ°æ–‡ä»¶æ•°æ®å—çš„æŒ‡é’ˆåˆ—è¡¨</li></ul></li><li>ï»¿æ–‡ä»¶å¤´åŒ…å«äº†ç´¢å¼•æ•°æ®å—</li><li>ï»¿ä¼˜ç‚¹ï¼š<ul><li>åˆ›å»ºã€å¢å¤§ã€ç¼©å°å¾ˆå®¹æ˜“</li><li>æ²¡æœ‰ç¢ç‰‡</li><li>æ”¯æŒç›´æ¥è®¿é—®</li></ul></li><li>ç¼ºç‚¹ï¼š<ul><li>å½“æ–‡ä»¶å¾ˆå°æ—¶ï¼Œå­˜å‚¨ç´¢å¼•çš„å¼€é”€</li><li>å¦‚ä½•å¤„ç†å¤§æ–‡ä»¶ï¼Ÿ</li></ul></li></ul></li></ul></li><li>ï»¿æŒ‡æ ‡<ul><li>é«˜æ•ˆï¼šå¦‚å­˜å‚¨åˆ©ç”¨ ï¼ˆå¤–éƒ¨ç¢ç‰‡ï¼‰</li><li>è¡¨ç°ï¼šå¦‚è®¿é—®é€Ÿåº¦</li></ul></li></ul></li></ul><h3 id="ç©ºé—²ç©ºé—´åˆ—è¡¨"><a href="#ç©ºé—²ç©ºé—´åˆ—è¡¨" class="headerlink" title="ç©ºé—²ç©ºé—´åˆ—è¡¨"></a>ç©ºé—²ç©ºé—´åˆ—è¡¨</h3><p>â€¦â€¦</p><h3 id="å¤šç£ç›˜ç®¡ç†-RAID"><a href="#å¤šç£ç›˜ç®¡ç†-RAID" class="headerlink" title="å¤šç£ç›˜ç®¡ç† -RAID"></a>å¤šç£ç›˜ç®¡ç† -RAID</h3><p>ç£ç›˜é˜µåˆ—ï¼ˆRedundant Arrays of Independent Disksï¼ŒRAIDï¼‰ï¼Œâ€æ•°å—ç‹¬ç«‹ç£ç›˜æ„æˆå…·æœ‰å†—ä½™èƒ½åŠ›çš„é˜µåˆ—â€</p><p>ç£ç›˜é˜µåˆ—æ˜¯<strong>ç”±å¾ˆå¤šå—ç‹¬ç«‹çš„ç£ç›˜ï¼Œç»„åˆæˆä¸€ä¸ªå®¹é‡å·¨å¤§çš„ç£ç›˜ç»„</strong>ï¼Œ<u>åˆ©ç”¨ä¸ªåˆ«ç£ç›˜æä¾›æ•°æ®æ‰€äº§ç”ŸåŠ æˆæ•ˆæœæå‡æ•´ä¸ªç£ç›˜ç³»ç»Ÿæ•ˆèƒ½</u>ã€‚åˆ©ç”¨è¿™é¡¹æŠ€æœ¯ï¼Œ<strong>å°†æ•°æ®åˆ‡å‰²æˆè®¸å¤šåŒºæ®µï¼Œåˆ†åˆ«å­˜æ”¾åœ¨å„ä¸ªç¡¬ç›˜ä¸Š</strong>ã€‚</p><ul><li><p>ï»¿åˆ†åŒºï¼šç¡¬ä»¶ç£ç›˜çš„ä¸€ç§é€‚åˆæ“ä½œç³»ç»ŸæŒ‡å®šæ ¼å¼çš„åˆ’åˆ†</p></li><li><p>ï»¿å·ï¼šä¸€ä¸ªæ‹¥æœ‰ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿå®ä¾‹çš„å¯è®¿é—®çš„å­˜å‚¨ç©ºé—´</p><ul><li>é€šå¸¸å¸¸é©»åœ¨ç£ç›˜çš„å•ä¸ªåˆ†åŒºä¸Š</li></ul></li><li><p>ï»¿ä½¿ç”¨å¤šä¸ªå¹¶è¡Œç£ç›˜æ¥å¢åŠ </p><ul><li>ååé‡ï¼ˆé€šè¿‡å¹¶è¡Œ)</li><li>å¯é æ€§å’Œå¯ç”¨æ€§ï¼ˆé€šè¿‡å†—ä½™ï¼Œå¤šå­˜å‡ ä»½ï¼Œé˜²å¤‡æ„å¤–ï¼‰</li></ul></li><li><p>ï»¿RAID ä¸€ å†—ä½™ç£ç›˜é˜µåˆ—</p><ul><li>å„ç§ç£ç›˜ç®¡ç†æŠ€æœ¯</li><li>RAID levelsï¼šä¸åŒRAID åˆ†ç±»ï¼ˆå¦‚ï¼ŒRATD-0ï¼Œ RAID-1, RATD-5)</li></ul></li><li><p>ï»¿å®ç°</p><ul><li>åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸ï¼šå­˜å‚¨&#x2F;å·ç®¡ç†</li><li>RAIDç¡¬ä»¶æ§åˆ¶å™¨ (I&#x2F;0)</li></ul></li></ul><h3 id="ç£ç›˜è°ƒåº¦"><a href="#ç£ç›˜è°ƒåº¦" class="headerlink" title="ç£ç›˜è°ƒåº¦"></a>ç£ç›˜è°ƒåº¦</h3><ul><li>ï»¿è¯»å–æˆ–å†™å…¥æ—¶ï¼Œç£å¤´å¿…é¡»è¢«å®šä½åœ¨æœŸæœ›çš„ç£é“ï¼Œå¹¶ä»æ‰€æœŸæœ›çš„æ‰‡åŒºçš„å¼€å§‹</li><li>ï»¿å¯»é“æ—¶é—´<ul><li>å®šä½åˆ°æœŸæœ›çš„ç£é“æ‰€èŠ±è´¹çš„æ—¶é—´</li></ul></li><li>ï»¿æ—‹è½¬å»¶è¿Ÿ<ul><li>ä»æ‰‡åŒºçš„å¼€å§‹å¤„åˆ°åˆ°è¾¾ç›®çš„å¤„èŠ±è´¹çš„æ—¶é—´</li></ul></li></ul><h4 id="SCAN"><a href="#SCAN" class="headerlink" title="SCAN"></a>SCAN</h4><p>å¯¹äºæ‰«æç®—æ³•ï¼Œç£è‡‚ä»ç£ç›˜çš„ä¸€ç«¯å¼€å§‹ï¼Œå‘å¦ä¸€ç«¯ç§»åŠ¨ï¼›åœ¨ç§»è¿‡æ¯ä¸ªæŸ±é¢æ—¶ï¼Œå¤„ç†è¯·æ±‚ã€‚å½“åˆ°è¾¾ç£ç›˜çš„å¦ä¸€ç«¯æ—¶ï¼Œç£å¤´ç§»åŠ¨æ–¹å‘åè½¬ï¼Œå¹¶ç»§ç»­å¤„ç†ã€‚ç£å¤´è¿ç»­æ¥å›æ‰«æç£ç›˜ã€‚SCAN ç®—æ³•æœ‰æ—¶ç§°ä¸ºç”µæ¢¯ç®—æ³•ï¼Œå› ä¸ºç£å¤´çš„è¡Œä¸ºå°±åƒå¤§æ¥¼é‡Œé¢çš„ç”µæ¢¯ï¼Œå…ˆå¤„ç†æ‰€æœ‰å‘ä¸Šçš„è¯·æ±‚ï¼Œç„¶åå†å¤„ç†ç›¸åæ–¹å‘çš„è¯·æ±‚ã€‚</p><h4 id="C-LOOK"><a href="#C-LOOK" class="headerlink" title="C-LOOK"></a>C-LOOK</h4><p>åŸºäºSCANç®—æ³•ï¼ŒC-LOOKç§»åŠ¨ç£å¤´ä»ç£ç›˜ä¸€ç«¯åˆ°ç£ç›˜å¦ä¸€ç«¯ï¼ˆç£è‡‚åªéœ€ç§»åˆ°ä¸€ä¸ªæ–¹å‘çš„æœ€è¿œè¯·æ±‚ä¸ºæ­¢ï¼‰ï¼Œå¹¶ä¸”å¤„ç†è¡Œç¨‹ä¸Šçš„è¯·æ±‚ï¼Œç„¶è€Œï¼Œå½“ç£å¤´åˆ°è¾¾å¦ä¸€ç«¯æ—¶ï¼Œå®ƒç«‹å³è¿”å›åˆ°ç£ç›˜<strong>å¦ä¸€ç«¯</strong>æœ€è¿œçš„è¯·æ±‚ï¼Œè€Œå¹¶ä¸å¤„ç†ä»»ä½•å›ç¨‹ä¸Šçš„è¯·æ±‚ï¼Œç„¶åä»è¯¥æœ€è¿œçš„è¯·æ±‚å¼€å§‹ï¼Œç»§ç»­å¾€åŒä¸€æ–¹å‘ç§»åŠ¨ç£ç›˜å¤„ç†è¯·æ±‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis</title>
      <link href="/2023/06/02/Redis/"/>
      <url>/2023/06/02/Redis/</url>
      
        <content type="html"><![CDATA[<p>æœ¬åšå®¢å‚è€ƒäº†éŸ©é¡ºå¹³è€å¸ˆçš„ Redis è¯¾ç¨‹è®²ä¹‰ï¼</p><h1 id="1-Redis-åŸºç¡€çŸ¥è¯†"><a href="#1-Redis-åŸºç¡€çŸ¥è¯†" class="headerlink" title="1 Redis åŸºç¡€çŸ¥è¯†"></a>1 Redis åŸºç¡€çŸ¥è¯†</h1><h2 id="1-1-ç›¸å…³èµ„æ–™"><a href="#1-1-ç›¸å…³èµ„æ–™" class="headerlink" title="1.1 ç›¸å…³èµ„æ–™"></a>1.1 ç›¸å…³èµ„æ–™</h2><h3 id="1-1-1-å®˜ç½‘-https-redis-io"><a href="#1-1-1-å®˜ç½‘-https-redis-io" class="headerlink" title="1.1.1 å®˜ç½‘: https://redis.io"></a>1.1.1 å®˜ç½‘: <a href="https://redis.io/">https://redis.io</a></h3><h3 id="1-1-2ä¸‹è½½åœ°å€-https-redis-io-docs-getting-started-installation-install-redis-on-mac-os"><a href="#1-1-2ä¸‹è½½åœ°å€-https-redis-io-docs-getting-started-installation-install-redis-on-mac-os" class="headerlink" title="1.1.2ä¸‹è½½åœ°å€: https://redis.io/docs/getting-started/installation/install-redis-on-mac-os/"></a>1.1.2ä¸‹è½½åœ°å€: <a href="https://redis.io/docs/getting-started/installation/install-redis-on-mac-os/">https://redis.io/docs/getting-started/installation/install-redis-on-mac-os/</a></h3><h2 id="1-2-ä¸ºä»€ä¹ˆéœ€è¦-Redis"><a href="#1-2-ä¸ºä»€ä¹ˆéœ€è¦-Redis" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆéœ€è¦ Redis"></a>1.2 ä¸ºä»€ä¹ˆéœ€è¦ Redis</h2><h3 id="1-2-1-ä¼ä¸šéœ€æ±‚"><a href="#1-2-1-ä¼ä¸šéœ€æ±‚" class="headerlink" title="1.2.1 ä¼ä¸šéœ€æ±‚"></a>1.2.1 ä¼ä¸šéœ€æ±‚</h3><ul><li>é«˜å¹¶å‘</li><li>é«˜å¯ç”¨</li><li>é«˜æ€§èƒ½</li><li>æµ·é‡ç”¨æˆ·</li></ul><h3 id="1-2-2-å…³ç³»å‹æ•°æ®åº“-å¦‚-MySQL-é—®é¢˜"><a href="#1-2-2-å…³ç³»å‹æ•°æ®åº“-å¦‚-MySQL-é—®é¢˜" class="headerlink" title="1.2.2 å…³ç³»å‹æ•°æ®åº“(å¦‚ MySQL)-é—®é¢˜"></a>1.2.2 å…³ç³»å‹æ•°æ®åº“(å¦‚ MySQL)-é—®é¢˜</h3><ul><li>æ€§èƒ½ç“¶é¢ˆï¼š ç£ç›˜ IO æ€§èƒ½ä½ä¸‹</li><li>æ‰©å±•ç“¶é¢ˆï¼š æ•°æ®å…³ç³»å¤æ‚ï¼Œ æ‰©å±•æ€§å·®ï¼Œ ä¸ä¾¿äºå¤§è§„æ¨¡é›†ç¾¤</li></ul><h3 id="1-2-3-Redis-çš„ä¼˜åŠ¿"><a href="#1-2-3-Redis-çš„ä¼˜åŠ¿" class="headerlink" title="1.2.3 Redis çš„ä¼˜åŠ¿"></a>1.2.3 Redis çš„ä¼˜åŠ¿</h3><ul><li>å†…å­˜å­˜å‚¨-é™ä½ç£ç›˜ IO æ¬¡æ•°</li><li>ä¸å­˜å‚¨å…³ç³»ï¼Œ ä»…å­˜å‚¨æ•°æ®-æ•°æ®é—´å…³ç³»ï¼Œ è¶Šç®€å•è¶Šå¥½</li></ul><h2 id="1-3-Redis-ç®€ä»‹"><a href="#1-3-Redis-ç®€ä»‹" class="headerlink" title="1.3 Redis ç®€ä»‹"></a>1.3 Redis ç®€ä»‹</h2><h3 id="1-3-1-ç®€è¿°"><a href="#1-3-1-ç®€è¿°" class="headerlink" title="1.3.1 ç®€è¿°:"></a>1.3.1 ç®€è¿°:</h3><p>Redis (Remote DIctionary Server) æ˜¯ç”¨ C è¯­è¨€å¼€å‘çš„ä¸€ä¸ª<strong>å¼€æºçš„é«˜æ€§èƒ½é”®å€¼å¯¹ï¼ˆkey-valueï¼‰ æ•°æ®åº“</strong></p><h3 id="1-3-2-ç‰¹å¾"><a href="#1-3-2-ç‰¹å¾" class="headerlink" title="1.3.2 ç‰¹å¾"></a>1.3.2 ç‰¹å¾</h3><ul><li>æ•°æ®é—´æ²¡æœ‰å¿…ç„¶çš„å…³è”å…³ç³»</li><li>é«˜æ€§èƒ½â€”â€”å®˜æ–¹æä¾›æµ‹è¯•æ•°æ®ï¼Œ 50 ä¸ªå¹¶å‘æ‰§è¡Œ 100000 ä¸ªè¯·æ±‚,è¯»çš„é€Ÿåº¦æ˜¯ 110000 æ¬¡&#x2F;s,å†™çš„é€Ÿåº¦æ˜¯ 81000 æ¬¡&#x2F;s</li><li>å¤šç§æ•°æ®ç»“æ„æ”¯æŒ<ul><li><em>String</em> å­—ç¬¦ä¸²ç±»å‹</li><li><em>Hash</em>  åˆ—è¡¨ç±»å‹</li><li><em>List</em> æ•£åˆ—ç±»å‹</li><li><em>Set</em> é›†åˆç±»å‹</li><li><em>SortedSet</em> æœ‰åºé›†åˆæ¨¡å‹</li></ul></li><li>æŒä¹…åŒ–æ”¯æŒâ€”â€”å¯ä»¥è¿›è¡Œæ•°æ®ç¾éš¾æ¢å¤</li></ul><p></p><h3 id="1-3-3-åº”ç”¨åœºæ™¯"><a href="#1-3-3-åº”ç”¨åœºæ™¯" class="headerlink" title="1.3.3 åº”ç”¨åœºæ™¯"></a>1.3.3 åº”ç”¨åœºæ™¯</h3><p>â— ä¸ºçƒ­ç‚¹æ•°æ®åŠ é€ŸæŸ¥è¯¢ï¼Œ å¦‚çƒ­ç‚¹å•†å“ã€ çƒ­ç‚¹æ–°é—»ã€ çƒ­ç‚¹èµ„è®¯ã€ æ¨å¹¿ç±»ç­‰é«˜è®¿é—®é‡ä¿¡æ¯ç­‰</p><p>â— ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¦‚ç§’æ€ã€æŠ¢è´­ã€è´­ç¥¨æ’é˜Ÿç­‰</p><p>â— å³æ—¶ä¿¡æ¯æŸ¥è¯¢ï¼Œå¦‚æ’è¡Œæ¦œã€å„ç±»ç½‘ç«™è®¿é—®ç»Ÿè®¡</p><p>â— æ—¶æ•ˆæ€§ä¿¡æ¯æ§åˆ¶ï¼Œå¦‚éªŒè¯ç æ§åˆ¶ã€æŠ•ç¥¨æ§åˆ¶ç­‰</p><p>â— åˆ†å¸ƒå¼æ•°æ®å…±äº«ï¼Œå¦‚åˆ†å¸ƒå¼é›†ç¾¤æ¶æ„ä¸­çš„ session åˆ†ç¦»</p><p>â— æ¶ˆæ¯é˜Ÿåˆ—</p><p>â— åˆ†å¸ƒå¼é”</p><h1 id="2-NoSQL-æ•°æ®åº“"><a href="#2-NoSQL-æ•°æ®åº“" class="headerlink" title="2 NoSQL æ•°æ®åº“"></a>2 NoSQL æ•°æ®åº“</h1><h2 id="2-1-æ¦‚è¿°"><a href="#2-1-æ¦‚è¿°" class="headerlink" title="2.1 æ¦‚è¿°"></a>2.1 æ¦‚è¿°</h2><p>â€‹<strong>Not-Only SQLï¼ˆ æ³›æŒ‡éå…³ç³»å‹çš„æ•°æ®åº“ï¼‰ï¼Œ ä½œä¸ºå…³ç³»å‹æ•°æ®åº“çš„è¡¥å……</strong></p><h2 id="2-2-ä½œç”¨ï¼š"><a href="#2-2-ä½œç”¨ï¼š" class="headerlink" title="2.2 ä½œç”¨ï¼š"></a>2.2 ä½œç”¨ï¼š</h2><p>â€‹ åº”å¯¹åœ¨æµ·é‡ç”¨æˆ·å’Œæµ·é‡æ•°æ®çš„æƒ…å†µä¸‹ï¼Œ å¸¦æ¥çš„æ•°æ®å¤„ç†é—®é¢˜</p><h2 id="2-3ç‰¹ç‚¹"><a href="#2-3ç‰¹ç‚¹" class="headerlink" title="2.3ç‰¹ç‚¹"></a>2.3ç‰¹ç‚¹</h2><ul><li>å¯æ‰©å®¹ï¼Œ å¯ä¼¸ç¼©</li><li>å¤§æ•°æ®é‡ä¸‹é«˜æ€§èƒ½</li><li>çµæ´»çš„æ•°æ®æ¨¡å‹</li><li>é«˜å¯ç”¨</li></ul><h3 id="SQL-å…³ç³»å‹æ•°æ®åº“-ğŸ†š-NoSQL-éå…³ç³»å‹æ•°æ®åº“"><a href="#SQL-å…³ç³»å‹æ•°æ®åº“-ğŸ†š-NoSQL-éå…³ç³»å‹æ•°æ®åº“" class="headerlink" title="SQL(å…³ç³»å‹æ•°æ®åº“) ğŸ†š NoSQL(éå…³ç³»å‹æ•°æ®åº“)"></a>SQL(å…³ç³»å‹æ•°æ®åº“) ğŸ†š NoSQL(éå…³ç³»å‹æ•°æ®åº“)</h3><table><thead><tr><th></th><th>SQL</th><th>NoSQL</th></tr></thead><tbody><tr><td>æ•°æ®ç»“æ„</td><td>ç»“æ„åŒ–(å»ºäº†è¡¨å°±ä¸æ–¹ä¾¿å†æ”¹å˜)</td><td>éç»“æ„åŒ–</td></tr><tr><td>æ•°æ®å…³è”</td><td>å…³è”çš„</td><td>æ— å…³è”çš„</td></tr><tr><td>æŸ¥è¯¢æ–¹å¼</td><td>SQLè¯­å¥æŸ¥è¯¢</td><td>éSQLè¯­å¥</td></tr><tr><td>äº‹åŠ¡ç‰¹æ€§</td><td>ACID</td><td>BASE</td></tr><tr><td>å­˜å‚¨æ–¹å¼</td><td>ç£ç›˜</td><td>å†…å­˜</td></tr><tr><td>æ‰©å±•æ€§</td><td>å‚ç›´</td><td>æ°´å¹³</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>1ï¼‰æ•°æ®ç»“æ„å›ºå®š<br />2ï¼‰ç›¸å…³ä¸šåŠ¡å¯¹æ•°æ®å®‰å…¨æ€§ã€ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜</td><td>1ï¼‰æ•°æ®ç»“æ„ä¸ç¨³å®š<br />2ï¼‰å¯¹ä¸€è‡´æ€§ã€å®‰å…¨æ€§è¦æ±‚ä¸é«˜<br />3ï¼‰å¯¹æ€§èƒ½è¦æ±‚é«˜</td></tr></tbody></table><h2 id="2-4-å¸¸è§-Nosql-æ•°æ®åº“"><a href="#2-4-å¸¸è§-Nosql-æ•°æ®åº“" class="headerlink" title="2.4 å¸¸è§ Nosql æ•°æ®åº“"></a>2.4 å¸¸è§ Nosql æ•°æ®åº“</h2><ul><li>Redis</li><li>memcache</li><li>HBase</li><li>MongoDB</li></ul><h1 id="3-Redis-ä½¿ç”¨"><a href="#3-Redis-ä½¿ç”¨" class="headerlink" title="3 Redis ä½¿ç”¨"></a>3 Redis ä½¿ç”¨</h1><h2 id="å…³äºæœ¬æœºçš„redisä¿¡æ¯ï¼š"><a href="#å…³äºæœ¬æœºçš„redisä¿¡æ¯ï¼š" class="headerlink" title="å…³äºæœ¬æœºçš„redisä¿¡æ¯ï¼š"></a>å…³äºæœ¬æœºçš„redisä¿¡æ¯ï¼š</h2><ul><li><p>redis.conf åœ°å€ï¼š&#x2F;opt&#x2F;homebrew&#x2F;etc&#x2F;redis.conf</p></li><li><p>redis-serveråœ°å€ï¼š &#x2F;opt&#x2F;homebrew&#x2F;opt&#x2F;redis&#x2F;bin&#x2F;redis-server</p></li></ul><p>â€‹è¿è¡Œredisï¼šredis-server    æˆ–    &#x2F;opt&#x2F;homebrew&#x2F;opt&#x2F;redis&#x2F;bin&#x2F;redis-server</p><p>â€‹<strong>åœæ­¢redisï¼šredis-cli shutdown</strong></p><p>â€‹å¯†ç è®¾ç½®æˆäº† root æƒ³è¦çŸ¥é“æ”¹äº†ä»€ä¹ˆé…ç½®æ–‡ä»¶ï¼Œè¯·åˆ°&#x2F;opt&#x2F;homebrew&#x2F;etc&#x2F;redis.confå¯»æ‰¾#donn changed 20230411æ³¨é‡Š</p><h2 id="åŸºäºé…ç½®æ–‡ä»¶è¿è¡Œredisï¼š"><a href="#åŸºäºé…ç½®æ–‡ä»¶è¿è¡Œredisï¼š" class="headerlink" title="åŸºäºé…ç½®æ–‡ä»¶è¿è¡Œredisï¼š"></a>åŸºäºé…ç½®æ–‡ä»¶è¿è¡Œredisï¼š</h2><p>â€‹redis-server &#x2F;opt&#x2F;homebrew&#x2F;etc&#x2F;redis.conf</p><h2 id="æŸ¥æ‰¾rediså¯ç”¨çš„è¿›ç¨‹ï¼š"><a href="#æŸ¥æ‰¾rediså¯ç”¨çš„è¿›ç¨‹ï¼š" class="headerlink" title="æŸ¥æ‰¾rediså¯ç”¨çš„è¿›ç¨‹ï¼š"></a>æŸ¥æ‰¾rediså¯ç”¨çš„è¿›ç¨‹ï¼š</h2><pre><code> ps axu | grep redis          </code></pre><p>å¯ä»¥é€šè¿‡æ€æ­»è¿›ç¨‹æ¥å…³é—­redisæœåŠ¡ kill -9 è¿›ç¨‹å·</p><h2 id="redis-cli-ä½¿ç”¨ï¼š"><a href="#redis-cli-ä½¿ç”¨ï¼š" class="headerlink" title="redis-cli ä½¿ç”¨ï¼š"></a>redis-cli ä½¿ç”¨ï¼š</h2><p>â€‹redis-cli -h 127.0.0.1 -p 6379 -a root</p><p>â€‹-h æŒ‡å®šè¦è¿æ¥redisç»“ç‚¹çš„ipåœ°å€ï¼Œé»˜è®¤ä¸º 127.0.0.1</p><p>â€‹-p æŒ‡å®šè¦è¿æ¥çš„redisèŠ‚ç‚¹çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 6379</p><p>â€‹-a æŒ‡å®šredisçš„è®¿é—®å¯†ç (ä¸å»ºè®®åœ¨è¿æ¥å‰å°±è¾“å…¥å¯†ç ã€Œä¸å®‰å…¨ã€) </p><p>â€‹â€”-&gt; å»ºè®®å…ˆä¸è¾“å…¥å¯†ç ï¼Œå»ºç«‹è¿æ¥åè¾“å…¥ AUTH  ç”¨æˆ·å(æœ¬æœºæœªè®¾ç½®)  å¯†ç </p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/redis-cli.png" style="zoom:100%;" /><h2 id="macè®¾ç½®rediså¼€æœºè‡ªå¯åŠ¨ï¼š"><a href="#macè®¾ç½®rediså¼€æœºè‡ªå¯åŠ¨ï¼š" class="headerlink" title="macè®¾ç½®rediså¼€æœºè‡ªå¯åŠ¨ï¼š"></a>macè®¾ç½®rediså¼€æœºè‡ªå¯åŠ¨ï¼š</h2><p>â€‹1.sudo vim &#x2F;Library&#x2F;LaunchDaemons&#x2F;redis-server.plist     åˆ›å»ºplistæ–‡æ¡£ï¼Œç”¨äºè®°å½•rediså¯åŠ¨çš„é…ç½®çš„è·¯å¾„(æ€ä¹ˆå¡«å»ç½‘ä¸Šæ‰¾æ‰¾å°±è¡Œ)</p><p>â€‹2.è¿è¡Œä»¥ä¸‹å‘½ä»¤å®ç°å¼€æœºè‡ªå¯åŠ¨ï¼š</p><p>â€‹sudo launchctl load &#x2F;Library&#x2F;LaunchDaemons&#x2F;redis-server.plist </p><p>â€‹(è²Œä¼¼æ˜¯æ‰§è¡Œâ¬†ï¸è¿™æ¡è¯­å¥åï¼Œmacå¼€æœºå°±ä¼šè‡ªåŠ¨æ‰§è¡Œredis-server.plistï¼Œå³è‡ªåŠ¨å¼€å¯redis)</p><p>â€‹3.è¿è¡ŒæŒ‡ä»¤ï¼Œè‹¥rediså¯åŠ¨äº†å³é…ç½®æˆåŠŸ</p><p>â€‹sudo launchctl start redis-server (æ¨¡æ‹Ÿé‡å¯) </p><h2 id="å›¾å½¢åŒ–å®¢æˆ·ç«¯æ¼”ç¤º"><a href="#å›¾å½¢åŒ–å®¢æˆ·ç«¯æ¼”ç¤º" class="headerlink" title="å›¾å½¢åŒ–å®¢æˆ·ç«¯æ¼”ç¤º"></a>å›¾å½¢åŒ–å®¢æˆ·ç«¯æ¼”ç¤º</h2><p>â€‹åœ¨ç½‘ç«™ä¸‹è½½Macç‰ˆï¼š<a href="https://redis.com/thank-you/redisinsight-the-best-redis-gui-35/">https://redis.com/thank-you/redisinsight-the-best-redis-gui-35/</a>      ğŸŒŸç®€å•å¥½ç”¨</p><h1 id="4-Redis-æŒ‡ä»¤"><a href="#4-Redis-æŒ‡ä»¤" class="headerlink" title="4 Redis æŒ‡ä»¤"></a>4 Redis æŒ‡ä»¤</h1><h2 id="4-1-æŒ‡ä»¤æ–‡æ¡£"><a href="#4-1-æŒ‡ä»¤æ–‡æ¡£" class="headerlink" title="4.1 æŒ‡ä»¤æ–‡æ¡£:"></a>4.1 æŒ‡ä»¤æ–‡æ¡£:</h2><p><a href="http://redis.cn/commands.html">http://redis.cn/commands.html</a></p><p>å‘½ä»¤ååˆ†ä¸°å¯Œï¼Œ åŒ…æ‹¬çš„å‘½ä»¤ç»„æœ‰ Clusterã€ Connectionã€ Geoã€ Hashesã€ HyperLogLogã€Keysã€ Listsã€ Pub&#x2F;Subã€ Scriptingã€ Serverã€ Setsã€ Sorted Setsã€ Stringsã€ Transactions ä¸€å…± 14ä¸ª redis å‘½ä»¤ç»„ä¸¤ç™¾å¤šä¸ª redis å‘½ä»¤</p><h2 id="4-2-åŸºç¡€æ“ä½œ"><a href="#4-2-åŸºç¡€æ“ä½œ" class="headerlink" title="4.2 åŸºç¡€æ“ä½œ"></a>4.2 åŸºç¡€æ“ä½œ</h2><h3 id="4-2-1-é€šç”¨å‘½ä»¤"><a href="#4-2-1-é€šç”¨å‘½ä»¤" class="headerlink" title="4.2.1 é€šç”¨å‘½ä»¤"></a>4.2.1 é€šç”¨å‘½ä»¤</h3><ul><li>help å‘½ä»¤åç§°      â€”â€”&gt;        ä¼šè¿”å›è¯¥å‘½ä»¤çš„ç”¨æ³•æè¿°</li></ul><table><thead><tr><th align="center">KEYS</th><th align="center">æŸ¥çœ‹æ‰€æœ‰ç¬¦åˆæ¨¡æ¿çš„key(æ•ˆç‡ä½ï¼Œå› æ­¤ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒè®¾å¤‡ä¸Šä½¿ç”¨)</th></tr></thead><tbody><tr><td align="center"><strong>DEL</strong></td><td align="center"><strong>åˆ é™¤æŒ‡å®šçš„key   å¯ä»¥ä¸€æ¬¡åˆ é™¤å¤šä¸ªkey(ç”¨ç©ºæ ¼éš”å¼€å³å¯)</strong></td></tr><tr><td align="center"><strong>EXISTS</strong></td><td align="center"><strong>åˆ¤æ–­KEYæ˜¯å¦å­˜åœ¨</strong></td></tr><tr><td align="center"><strong>EXPIRE</strong></td><td align="center"><strong>Set a keyâ€™s time to live in seconds</strong>â€”â€“<strong>ç»™ä¸€ä¸ªkeyè®¾ç½®æœ‰æ•ˆæœŸï¼Œæœ‰æ•ˆæœŸåˆ°æœŸä¼šè‡ªåŠ¨åˆ é™¤key</strong></td></tr><tr><td align="center"><strong>TTL</strong></td><td align="center"><strong>Get the time to live for a key in seconds</strong> (ä¸€ä¸ªkeyçš„TTL &#x3D; -1è¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆï¼Œ-2è¡¨ç¤ºå·²è¿‡æœŸ)</td></tr><tr><td align="center"><strong>type</strong></td><td align="center"><strong>è·å–keyçš„ç±»å‹</strong></td></tr><tr><td align="center"><strong>unlink</strong></td><td align="center"><strong>æ ¹æ® value é€‰æ‹©<u>éé˜»å¡</u>åˆ é™¤ã€ ä»…å°† keys ä» keyspace å…ƒæ•°æ®ä¸­åˆ é™¤ï¼Œ çœŸæ­£çš„åˆ é™¤ä¼šåœ¨åç»­å¼‚æ­¥æ“ä½œã€‘</strong></td></tr></tbody></table><h3 id="4-2-2å¯¹-DB-æ•°æ®åº“-æ“ä½œ"><a href="#4-2-2å¯¹-DB-æ•°æ®åº“-æ“ä½œ" class="headerlink" title="4.2.2å¯¹ DB(æ•°æ®åº“)æ“ä½œ"></a>4.2.2å¯¹ DB(æ•°æ®åº“)æ“ä½œ</h3><ul><li><p><strong>selectï¼š å‘½ä»¤åˆ‡æ¢æ•°æ®åº“</strong></p><pre><code> 1. redis å®‰è£…åï¼Œ é»˜è®¤æœ‰ 16 ä¸ªåº“, 0-15</code></pre><ol start="2"><li>é»˜è®¤æ“ä½œçš„æ˜¯ redis çš„ 0 å·åº“</li></ol></li><li><p><strong>dbsizeï¼š æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„ key çš„æ•°é‡</strong></p></li><li><p><strong>flushdbï¼š æ¸…ç©ºå½“å‰åº“</strong></p></li><li><p><strong>flushallï¼š æ¸…ç©ºå…¨éƒ¨åº“</strong></p></li></ul><h1 id="5-Redis-äº”å¤§æ•°æ®ç±»å‹-x2F-ç»“æ„"><a href="#5-Redis-äº”å¤§æ•°æ®ç±»å‹-x2F-ç»“æ„" class="headerlink" title="5 Redis äº”å¤§æ•°æ®ç±»å‹&#x2F;ç»“æ„"></a>5 Redis äº”å¤§æ•°æ®ç±»å‹&#x2F;ç»“æ„</h1><h2 id="5-1-æ“ä½œæ–‡æ¡£"><a href="#5-1-æ“ä½œæ–‡æ¡£" class="headerlink" title="5.1 æ“ä½œæ–‡æ¡£"></a>5.1 æ“ä½œæ–‡æ¡£</h2><h3 id="5-1-1-å®˜æ–¹æ–‡æ¡£-https-redis-io-commands"><a href="#5-1-1-å®˜æ–¹æ–‡æ¡£-https-redis-io-commands" class="headerlink" title="5.1.1 å®˜æ–¹æ–‡æ¡£ : https://redis.io/commands"></a>5.1.1 å®˜æ–¹æ–‡æ¡£ : <a href="https://redis.io/commands">https://redis.io/commands</a></h3><h3 id="5-1-2-ä¸­æ–‡æ–‡æ¡£-http-redisdoc-com"><a href="#5-1-2-ä¸­æ–‡æ–‡æ¡£-http-redisdoc-com" class="headerlink" title="5.1.2 ä¸­æ–‡æ–‡æ¡£: http://redisdoc.com/"></a>5.1.2 ä¸­æ–‡æ–‡æ¡£: <a href="http://redisdoc.com/">http://redisdoc.com/</a></h3><h2 id="5-2-Redis-æ•°æ®å­˜å‚¨æ ¼å¼"><a href="#5-2-Redis-æ•°æ®å­˜å‚¨æ ¼å¼" class="headerlink" title="5.2 Redis æ•°æ®å­˜å‚¨æ ¼å¼"></a>5.2 Redis æ•°æ®å­˜å‚¨æ ¼å¼</h2><h3 id="5-2-1-ä¸€å¥è¯-redis-è‡ªèº«æ˜¯ä¸€ä¸ª-Mapï¼Œ-å…¶ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯é‡‡ç”¨-key-value-çš„å½¢å¼å­˜å‚¨"><a href="#5-2-1-ä¸€å¥è¯-redis-è‡ªèº«æ˜¯ä¸€ä¸ª-Mapï¼Œ-å…¶ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯é‡‡ç”¨-key-value-çš„å½¢å¼å­˜å‚¨" class="headerlink" title="5.2.1 ä¸€å¥è¯: redis è‡ªèº«æ˜¯ä¸€ä¸ª Mapï¼Œ å…¶ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯é‡‡ç”¨ key : value çš„å½¢å¼å­˜å‚¨"></a>5.2.1 ä¸€å¥è¯: redis è‡ªèº«æ˜¯ä¸€ä¸ª Mapï¼Œ å…¶ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯é‡‡ç”¨ key : value çš„å½¢å¼å­˜å‚¨</h3><h3 id="5-2-2-key-æ˜¯å­—ç¬¦ä¸²ï¼Œ-value-æ˜¯æ•°æ®ï¼Œ-æ•°æ®æ”¯æŒå¤šç§ç±»å‹-x2F-ç»“æ„"><a href="#5-2-2-key-æ˜¯å­—ç¬¦ä¸²ï¼Œ-value-æ˜¯æ•°æ®ï¼Œ-æ•°æ®æ”¯æŒå¤šç§ç±»å‹-x2F-ç»“æ„" class="headerlink" title="5.2.2 key æ˜¯å­—ç¬¦ä¸²ï¼Œ value æ˜¯æ•°æ®ï¼Œ æ•°æ®æ”¯æŒå¤šç§ç±»å‹&#x2F;ç»“æ„"></a>5.2.2 key æ˜¯å­—ç¬¦ä¸²ï¼Œ value æ˜¯æ•°æ®ï¼Œ æ•°æ®æ”¯æŒå¤šç§ç±»å‹&#x2F;ç»“æ„</h3><h2 id="5-3-Redis-æ•°æ®ç±»å‹-5-ç§å¸¸ç”¨"><a href="#5-3-Redis-æ•°æ®ç±»å‹-5-ç§å¸¸ç”¨" class="headerlink" title="5.3 Redis æ•°æ®ç±»å‹-5 ç§å¸¸ç”¨"></a>5.3 Redis æ•°æ®ç±»å‹-5 ç§å¸¸ç”¨</h2><ul><li><strong>string</strong></li><li><strong>hash</strong></li><li><strong>list</strong></li><li><strong>set</strong></li><li><strong>sorted_set</strong></li></ul><h2 id="5-4-Stringç±»å‹"><a href="#5-4-Stringç±»å‹" class="headerlink" title="5.4 Stringç±»å‹"></a>5.4 Stringç±»å‹</h2><h3 id="5-4-1-è¯´æ˜"><a href="#5-4-1-è¯´æ˜" class="headerlink" title="5.4.1 è¯´æ˜"></a>5.4.1 è¯´æ˜</h3><ol><li>String æ˜¯ Redis æœ€åŸºæœ¬çš„ç±»å‹ï¼Œ ä¸€ä¸ª key å¯¹åº”ä¸€ä¸ª valueã€‚</li><li>String ç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„, Redis çš„ string å¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚ æ¯”å¦‚ jpg å›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚</li><li>String ç±»å‹æ˜¯ Redis åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œ ä¸€ä¸ª Redis ä¸­å­—ç¬¦ä¸² value æœ€å¤šå¯ä»¥æ˜¯ 512M</li></ol><p>â€‹<strong>Stringåˆå¯ä»¥ç»†åˆ†</strong>ä¸ºï¼š    stringæ™®é€šå­—ç¬¦ä¸²</p><p>â€‹  int æ•´æ•°ç±»å‹ï¼Œå¯ä»¥è‡ªå¢ã€è‡ªå‡</p><p>â€‹  float  æµ®ç‚¹ç±»å‹ï¼Œå¯ä»¥è‡ªå¢ã€è‡ªå‡</p><p><u>åº•å±‚éƒ½æ˜¯ç”±å­—èŠ‚æ•°ç»„å­˜å‚¨ï¼ŒåŒºåˆ«åœ¨äºç¼–ç æ–¹å¼ä¸åŒ</u></p><ul><li><h5 id="Stringå¸¸è§å‘½ä»¤ï¼š"><a href="#Stringå¸¸è§å‘½ä»¤ï¼š" class="headerlink" title="Stringå¸¸è§å‘½ä»¤ï¼š"></a>Stringå¸¸è§å‘½ä»¤ï¼š</h5><table><thead><tr><th align="left">SET</th><th align="center">SET key value</th></tr></thead><tbody><tr><td align="left"><strong>GET</strong></td><td align="center"><strong>GET</strong> key</td></tr><tr><td align="left"><strong>append</strong></td><td align="center"><strong>append</strong> key value <strong>å°†ç»™å®šçš„ value è¿½åŠ åˆ°åŸå€¼çš„æœ«å°¾</strong><br/>(keyä¸å­˜åœ¨å°±åˆ›å»º)</td></tr><tr><td align="left"><strong>setnx</strong></td><td align="center"><strong>setnx</strong> key value<br/>åªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶ è®¾ç½® key çš„å€¼</td></tr><tr><td align="left"><strong>INCR</strong>(è‹¥valueä¸ºintï¼Œvalue++)</td><td align="center"><strong>INCR</strong> key</td></tr><tr><td align="left"><strong>DECR</strong>(è‹¥valueä¸ºintï¼Œvalue+&#x3D;-1)</td><td align="center"><strong>DECR</strong> key</td></tr><tr><td align="left"><strong>INCRBY</strong>(è‹¥valueä¸ºintï¼Œvalue+&#x3D; step)</td><td align="center"><strong>INCRBY</strong> key stepï¼ˆstepå¯ä¸ºä»»æ„é0æ•´æ•°ï¼‰</td></tr><tr><td align="left"><strong>INCRBYFLOAT</strong>(è‹¥valueä¸ºfloatï¼Œvalue +&#x3D; step)</td><td align="center"><strong>INCRBYFLOAT</strong> key step ( floatç±»å‹ )</td></tr><tr><td align="left"><strong>MSET</strong>(æ‰¹é‡æ·»åŠ é”®å€¼å¯¹)</td><td align="center"><strong>MSET</strong> key1 value1 key2 value2 â€¦</td></tr><tr><td align="left"><strong>MGET</strong>(æ‰¹é‡æŸ¥è¯¢values)</td><td align="center"><strong>MGET</strong> key1 key2 key3 â€¦</td></tr><tr><td align="left"><strong>msetnx</strong></td><td align="center"><strong>msetnx</strong> <key1><value1><key2><value2><br/> åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-value å¯¹ï¼Œ å½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®š key éƒ½ä¸å­˜åœ¨, åŸå­æ€§ï¼Œ æœ‰ä¸€ä¸ªå¤±è´¥åˆ™éƒ½å¤±è´¥</td></tr><tr><td align="left"><strong>getrange</strong></td><td align="center">getrange <key>&lt;èµ·å§‹ä½ç½®&gt;&lt;ç»“æŸä½ç½®&gt;<br/> è·å¾—å€¼çš„èŒƒå›´ï¼Œ ç±»ä¼¼ java ä¸­çš„ substring<br/>ä¸¤è¾¹éƒ½æ˜¯é—­åŒºé—´ï¼Œä¸‹æ ‡ä»0å¼€å§‹ï¼Œè´Ÿæ•°è¡¨ç¤ºä»åå¾€å‰æ•°</td></tr><tr><td align="left"><strong>setrange</strong></td><td align="center"><strong>setrange</strong><key>&lt;èµ·å§‹ä½ç½®&gt;<value>  <br/>è¦†å†™<key>æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œ ä»&lt;èµ·å§‹ä½ç½®&gt;å¼€å§‹(ç´¢å¼•ä» 0 å¼€å§‹)ã€‚</td></tr><tr><td align="left"><strong>SETEX</strong></td><td align="center"><strong>setex</strong> <key>&lt;è¿‡æœŸæ—¶é—´&gt;<value> <br/>è®¾ç½®é”®å€¼çš„åŒæ—¶ï¼Œ è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œ å•ä½ç§’</td></tr><tr><td align="left"><strong>getset</strong></td><td align="center"><strong>getset</strong> <key><value> ,<br/>ä»¥æ–°æ¢æ—§ï¼Œ è®¾ç½®äº†æ–°å€¼åŒæ—¶è·å¾—æ—§å€¼</td></tr></tbody></table><h5 id="æ€è€ƒï¼šRedisä¸­æ²¡æœ‰tableçš„æ¦‚å¿µï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•åŒºåˆ«ä¸åŒç±»å‹çš„keyå‘¢ï¼Ÿ-æ¯”å¦‚ä¸€ä¸ªå­¦ç”Ÿçš„id-x3D-1ï¼Œä¸€é—¨è¯¾ç¨‹çš„idä¹Ÿä¸º1"><a href="#æ€è€ƒï¼šRedisä¸­æ²¡æœ‰tableçš„æ¦‚å¿µï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•åŒºåˆ«ä¸åŒç±»å‹çš„keyå‘¢ï¼Ÿ-æ¯”å¦‚ä¸€ä¸ªå­¦ç”Ÿçš„id-x3D-1ï¼Œä¸€é—¨è¯¾ç¨‹çš„idä¹Ÿä¸º1" class="headerlink" title="æ€è€ƒï¼šRedisä¸­æ²¡æœ‰tableçš„æ¦‚å¿µï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•åŒºåˆ«ä¸åŒç±»å‹çš„keyå‘¢ï¼Ÿ(æ¯”å¦‚ä¸€ä¸ªå­¦ç”Ÿçš„id &#x3D; 1ï¼Œä¸€é—¨è¯¾ç¨‹çš„idä¹Ÿä¸º1)"></a>æ€è€ƒï¼šRedisä¸­æ²¡æœ‰tableçš„æ¦‚å¿µï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•åŒºåˆ«ä¸åŒç±»å‹çš„keyå‘¢ï¼Ÿ(æ¯”å¦‚ä¸€ä¸ªå­¦ç”Ÿçš„id &#x3D; 1ï¼Œä¸€é—¨è¯¾ç¨‹çš„idä¹Ÿä¸º1)</h5><p>â€‹Redisä¸­ key å…è®¸æœ‰å¤šä¸ªå•è¯(ç”¨äºå¹³æ›¿è¡¨çš„æ¦‚å¿µ)å½¢æˆå±‚çº§ç»“æ„ï¼Œå¤šä¸ªå•è¯é—´ç”¨ ï¼šéš”å¼€</p><p>â€‹æ ¼å¼ä¸¾ä¾‹â€”&gt;     é¡¹ç›®å ï¼šä¸šåŠ¡å ï¼šç±»å‹ ï¼šä½ ç»™keyèµ·çš„åç§°</p></li></ul><h2 id="5-5-Listç±»å‹-ç±»ä¼¼java-ä¸­çš„LinkedList"><a href="#5-5-Listç±»å‹-ç±»ä¼¼java-ä¸­çš„LinkedList" class="headerlink" title="5.5 Listç±»å‹(ç±»ä¼¼java ä¸­çš„LinkedList)"></a>5.5 Listç±»å‹(ç±»ä¼¼java ä¸­çš„LinkedList)</h2><h3 id="5-5-1-æ¦‚è¦"><a href="#5-5-1-æ¦‚è¦" class="headerlink" title="5.5.1 æ¦‚è¦"></a>5.5.1 æ¦‚è¦</h3><p>list ç±»å‹, ä¿å­˜å¤šä¸ªæ•°æ®ï¼Œ åº•å±‚ä½¿ç”¨åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„å®ç°â€”â€”(æ”¯æŒæ­£å‘ã€åå‘æ£€ç´¢)</p><h3 id="5-5-2-list-å­˜å‚¨ç»“æ„ç¤ºæ„å›¾"><a href="#5-5-2-list-å­˜å‚¨ç»“æ„ç¤ºæ„å›¾" class="headerlink" title="5.5.2 list å­˜å‚¨ç»“æ„ç¤ºæ„å›¾"></a>5.5.2 list å­˜å‚¨ç»“æ„ç¤ºæ„å›¾</h3><p>â€‹â— åŒå‘é“¾è¡¨ç¤ºæ„å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230727194906350.png" alt="image-20230727194906350"></p><p>â€‹<u>æœ‰åºã€å…ƒç´ å¯é‡å¤ã€å¢åˆ æ“ä½œå¿«ã€æŸ¥æ‰¾é€Ÿåº¦ä¸€èˆ¬</u></p><p>â— è€éŸ©è§£å›¾</p><pre><code>1. Redis åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨(å·¦è¾¹)æˆ–è€…å°¾éƒ¨(å³è¾¹)ã€‚2. åº•å±‚æ˜¯ä¸ªåŒå‘é“¾è¡¨ï¼Œå¯¹ä¸¤ç«¯çš„æ“ä½œæ€§èƒ½é«˜ï¼Œé€šè¿‡ç´¢å¼•ä¸‹æ ‡çš„æ“ä½œä¸­é—´çš„èŠ‚ç‚¹æ€§èƒ½è¾ƒå·®</code></pre><h3 id="5-5-3-Listç±»å‹å¸¸è§å‘½ä»¤ï¼š"><a href="#5-5-3-Listç±»å‹å¸¸è§å‘½ä»¤ï¼š" class="headerlink" title="5.5.3 Listç±»å‹å¸¸è§å‘½ä»¤ï¼š"></a>5.5.3 Listç±»å‹å¸¸è§å‘½ä»¤ï¼š</h3><table><thead><tr><th align="left"><strong>LPUSH <key><value1><value2><value3> â€¦</strong></th><th><strong>å‘åˆ—è¡¨<u>å·¦ä¾§</u>æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ (ä¸€ä¸ªä¸€ä¸ªpushï¼Œç¬¬ä¸€ä¸ªåœ¨æœ€å³è¾¹)</strong></th></tr></thead><tbody><tr><td align="left"><strong>LPOP <key></strong></td><td><strong>ç§»é™¤å¹¶è¿”å›åˆ—è¡¨å·¦ä¾§çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰åˆ™è¿”å›nil</strong></td></tr><tr><td align="left"><strong>RPUSH ** <key><value1><value2><value3> â€¦</strong>**</td><td><strong>å‘åˆ—è¡¨<u>å³ä¾§</u>æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </strong></td></tr><tr><td align="left"><strong>RPOP <key></strong></td><td><strong>ç§»é™¤å¹¶è¿”å›åˆ—è¡¨å³ä¾§çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰åˆ™è¿”å›nil</strong></td></tr><tr><td align="left"><strong>rpoplpush</strong> <key1> <key2></td><td><strong>ä»<key1>åˆ—è¡¨å³è¾¹åå‡ºä¸€ä¸ªå€¼ï¼Œ æ’åˆ°<key2>åˆ—è¡¨å·¦è¾¹</strong></td></tr><tr><td align="left"><strong>lrange</strong> <key><start><stop></td><td><strong>æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—ç´¢å¼•èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ (ä»å·¦åˆ°å³)</strong></td></tr><tr><td align="left"><strong>lrange mylist 0 -1</strong></td><td>0 å·¦è¾¹ç¬¬ä¸€ä¸ªï¼Œ -1 å³è¾¹ç¬¬ä¸€ä¸ªï¼Œ ï¼ˆ0-1 è¡¨ç¤ºè·å–æ‰€æœ‰ï¼‰</td></tr><tr><td align="left"><strong>lindex <key><index></strong></td><td><strong>æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡<u>è·å¾—</u>å…ƒç´ (ä»å·¦åˆ°å³)</strong></td></tr><tr><td align="left"><strong>llen</strong> <key></td><td><strong>è·å¾—åˆ—è¡¨é•¿åº¦</strong></td></tr><tr><td align="left"><strong>linsert <key> before <value><newvalue></strong></td><td><strong>åœ¨<value>çš„å‰é¢æ’å…¥<newvalue>æ’å…¥å€¼</strong></td></tr><tr><td align="left"><strong>lrem</strong> <key><n><value></td><td><strong>ä»å·¦è¾¹åˆ é™¤ n ä¸ª value(ä»å·¦åˆ°å³)</strong></td></tr><tr><td align="left"><strong>lset<key><index><value></strong></td><td><strong>å°†åˆ—è¡¨ key ä¸‹æ ‡ä¸º index çš„å€¼æ›¿æ¢æˆ value</strong></td></tr><tr><td align="left"><strong>BLPOP&#x2F;BRPOP <key> <time></strong></td><td><strong>ä¸LPOPå’ŒRPOPç±»ä¼¼ï¼Œ<u>åªä¸è¿‡åœ¨æ²¡æœ‰å…ƒç´ æ—¶ç­‰å¾…æŒ‡å®šæ—¶é—´</u>ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›nil</strong><br /><strong>é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´å†…è¿˜æ²¡èƒ½æœç´¢åˆ°Listä¸­å¯¹åº”çš„æ•°æ®ï¼Œæ‰ç®—æ˜¯æ‰¾ä¸åˆ°</strong></td></tr></tbody></table><h3 id="5-5-4-list-æœ€ä½³å®è·µ"><a href="#5-5-4-list-æœ€ä½³å®è·µ" class="headerlink" title="5.5.4 list æœ€ä½³å®è·µ"></a>5.5.4 list æœ€ä½³å®è·µ</h3><h4 id="5-5-4-1-redis-åº”ç”¨äºå…·æœ‰æ“ä½œå…ˆåé¡ºåºçš„æ•°æ®æ§åˆ¶"><a href="#5-5-4-1-redis-åº”ç”¨äºå…·æœ‰æ“ä½œå…ˆåé¡ºåºçš„æ•°æ®æ§åˆ¶" class="headerlink" title="5.5.4.1 redis åº”ç”¨äºå…·æœ‰æ“ä½œå…ˆåé¡ºåºçš„æ•°æ®æ§åˆ¶"></a>5.5.4.1 redis åº”ç”¨äºå…·æœ‰æ“ä½œå…ˆåé¡ºåºçš„æ•°æ®æ§åˆ¶</h4><h4 id="5-5-4-2-åº”ç”¨åœºæ™¯"><a href="#5-5-4-2-åº”ç”¨åœºæ™¯" class="headerlink" title="5.5.4.2 åº”ç”¨åœºæ™¯"></a>5.5.4.2 åº”ç”¨åœºæ™¯</h4><p>â€‹â— ç³»ç»Ÿé€šçŸ¥ï¼Œ æŒ‰ç…§æ—¶é—´é¡ºåºå±•ç¤ºï¼Œ å°†æœ€è¿‘çš„é€šçŸ¥åˆ—åœ¨å‰é¢</p><p>â€‹å¯ç”¨äº(å¦‚ä½ å‘äº†æœ‹å‹åœˆï¼Œè®°å½•ä¸ºæ‚¨ç‚¹èµçš„ç”¨æˆ·åŠå…¶ç‚¹èµé¡ºåº)</p><h2 id="5-6-Setç±»å‹-ç±»ä¼¼java-ä¸­çš„HashSet"><a href="#5-6-Setç±»å‹-ç±»ä¼¼java-ä¸­çš„HashSet" class="headerlink" title="5.6 Setç±»å‹(ç±»ä¼¼java ä¸­çš„HashSet)"></a>5.6 Setç±»å‹(ç±»ä¼¼java ä¸­çš„HashSet)</h2><h3 id="5-6-1-æ¦‚è¦"><a href="#5-6-1-æ¦‚è¦" class="headerlink" title="5.6.1 æ¦‚è¦:"></a>5.6.1 æ¦‚è¦:</h3><p> set æä¾›çš„åŠŸèƒ½ä¸ list ç±»ä¼¼æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„åŠŸèƒ½ï¼Œ ç‰¹æ®Šä¹‹å¤„åœ¨äº set æ˜¯å¯ä»¥è‡ªåŠ¨æ’é‡çš„, å³å€¼æ˜¯ä¸å…è®¸é‡å¤çš„</p><p>â€‹â€”â€”<u>æ— åºã€å…ƒç´ ä¸å¯é‡å¤ã€æŸ¥æ‰¾å¿«ã€æ”¯æŒäº¤å¹¶ç­‰é›†åˆæ“ä½œ</u></p><p>â€‹åƒæ˜¯ç”¨å“ˆå¸Œè¡¨å­˜å‚¨çš„é›†åˆ</p><h3 id="5-6-2-set-å¸¸ç”¨æŒ‡ä»¤-amp-ä½¿ç”¨"><a href="#5-6-2-set-å¸¸ç”¨æŒ‡ä»¤-amp-ä½¿ç”¨" class="headerlink" title="5.6.2 set å¸¸ç”¨æŒ‡ä»¤&amp;ä½¿ç”¨"></a>5.6.2 set å¸¸ç”¨æŒ‡ä»¤&amp;ä½¿ç”¨</h3><h4 id="5-6-2-1-set-æŒ‡ä»¤æ“ä½œç¤ºæ„å›¾"><a href="#5-6-2-1-set-æŒ‡ä»¤æ“ä½œç¤ºæ„å›¾" class="headerlink" title="5.6.2.1 set æŒ‡ä»¤æ“ä½œç¤ºæ„å›¾"></a>5.6.2.1 set æŒ‡ä»¤æ“ä½œç¤ºæ„å›¾</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230727202023870.png" alt="image-20230727202023870" style="zoom:50%;" /><h4 id="5-6-2-2-Setç±»å‹çš„å¸¸è§å‘½ä»¤ï¼š"><a href="#5-6-2-2-Setç±»å‹çš„å¸¸è§å‘½ä»¤ï¼š" class="headerlink" title="5.6.2.2 Setç±»å‹çš„å¸¸è§å‘½ä»¤ï¼š"></a>5.6.2.2 Setç±»å‹çš„å¸¸è§å‘½ä»¤ï¼š</h4><table><thead><tr><th><strong>SADD <key><value1><value2> â€¦..</strong></th><th><strong>å‘setä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ (ä¸€ä¸ªkeyï¼Œä»»æ„å¤šä¸ªå…ƒç´ )ï¼Œè‹¥å·²å­˜åœ¨ï¼Œåˆ™å¿½ç•¥</strong></th></tr></thead><tbody><tr><td><strong>SMEMBERS <key></strong></td><td><strong>è·å–setä¸­çš„æ‰€æœ‰å…ƒç´ </strong></td></tr><tr><td><strong>SISMEMBER <key> <member></strong></td><td><strong>åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºsetä¸­</strong></td></tr><tr><td><strong>SCARD <key></strong></td><td><strong>è¿”å›setä¸­å…ƒç´ çš„ä¸ªæ•°</strong></td></tr><tr><td><strong>SREM <key><value1><value2> â€¦.</strong></td><td><strong>ç§»é™¤setä¸­çš„æŒ‡å®šå…ƒç´ </strong></td></tr><tr><td><strong>spop <key></strong></td><td><strong>éšæœºä»è¯¥é›†åˆä¸­åå‡ºä¸€ä¸ªå€¼ã€‚</strong></td></tr><tr><td><strong>srandmember <key><n></strong></td><td><strong>éšæœºä»è¯¥é›†åˆä¸­å–å‡º n ä¸ªå€¼ã€‚ ä¸ä¼šä»é›†åˆä¸­åˆ é™¤</strong></td></tr><tr><td><strong>smove <source><destination>value</strong></td><td><strong>æŠŠé›†åˆä¸­ä¸€ä¸ªå€¼ä»ä¸€ä¸ªé›†åˆç§»åŠ¨åˆ°å¦ä¸€ä¸ªé›†åˆ</strong></td></tr><tr><td>**SINTER <key1> <key2> ** <br /><strong>SDIFFã€SUNIONâ€¦</strong></td><td><strong>æ±‚key1ä¸key2çš„äº¤é›†</strong><br /><strong>å·®é›†ã€å¹¶é›†â€¦</strong></td></tr></tbody></table><h2 id="5-7-Hashç±»å‹-ç±»ä¼¼java-ä¸­çš„Map"><a href="#5-7-Hashç±»å‹-ç±»ä¼¼java-ä¸­çš„Map" class="headerlink" title="5.7 Hashç±»å‹(ç±»ä¼¼java ä¸­çš„Map)"></a>5.7 Hashç±»å‹(ç±»ä¼¼java ä¸­çš„Map)</h2><h3 id="5-7-1-æ¦‚è¦"><a href="#5-7-1-æ¦‚è¦" class="headerlink" title="5.7.1 æ¦‚è¦:"></a>5.7.1 æ¦‚è¦:</h3><p> Redis hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆï¼Œ hash é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ï¼Œ ç±»ä¼¼ Java é‡Œé¢çš„Map&lt;String,Object&gt;</p><h3 id="5-7-2-ä¸€å›¾èƒœåƒè¨€ï¼š-Redis-hash-å­˜å‚¨ç»“æ„ç®€å•ç¤ºæ„å›¾"><a href="#5-7-2-ä¸€å›¾èƒœåƒè¨€ï¼š-Redis-hash-å­˜å‚¨ç»“æ„ç®€å•ç¤ºæ„å›¾" class="headerlink" title="5.7.2 ä¸€å›¾èƒœåƒè¨€ï¼š Redis hash å­˜å‚¨ç»“æ„ç®€å•ç¤ºæ„å›¾"></a>5.7.2 ä¸€å›¾èƒœåƒè¨€ï¼š Redis hash å­˜å‚¨ç»“æ„ç®€å•ç¤ºæ„å›¾</h3><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230727205233999.png" alt="image-20230727205233999" style="zoom:50%;" /><p>â€‹æ— åºå­—å…¸ï¼Œå¯ä»¥å¯¹å¯¹è±¡ä¸­çš„æ¯ä¸ªå­—æ®µç‹¬ç«‹å­˜å‚¨ï¼Œå¯ä»¥é’ˆå¯¹å•ä¸ªå­—æ®µCRUD</p><p>â€‹ä¸€æ¡hashç±»å‹çš„è®°å½•æœ‰ï¼š ä¸€ä¸ª <strong>key</strong> å’Œä¸€äº› <strong>field value</strong> å¯¹</p><h3 id="5-7-3-Hashç±»å‹å¸¸è§å‘½ä»¤ï¼š"><a href="#5-7-3-Hashç±»å‹å¸¸è§å‘½ä»¤ï¼š" class="headerlink" title="5.7.3 Hashç±»å‹å¸¸è§å‘½ä»¤ï¼š"></a>5.7.3 Hashç±»å‹å¸¸è§å‘½ä»¤ï¼š</h3><table><thead><tr><th><strong>hset <key1><field1><value1><field2><value2></strong></th><th><strong>æ‰¹é‡æ·»åŠ æˆ–è€…ä¿®æ”¹hashç±»å‹keyçš„<u>ä¸€ä¸ª</u>fieldçš„å€¼</strong></th></tr></thead><tbody><tr><td><strong>hget <key1><field></strong></td><td><strong>è·å–<u>ä¸€ä¸ª</u>hashç±»å‹keyçš„fieldçš„å€¼</strong></td></tr><tr><td><strong>hmset <key1><field1><value1><field2><value2>â€¦</strong></td><td><strong>æ‰¹é‡æ·»åŠ ã€ä¿®æ”¹hashç±»å‹keyçš„å¤šä¸ªfieldä¸value</strong></td></tr><tr><td><strong>hmget <key1><field1> <field2>â€¦</strong></td><td><strong>æ‰¹é‡è·å–hashç±»å‹keyçš„å¤šä¸ªfieldçš„å€¼</strong></td></tr><tr><td><strong>hexists<key1><field></strong></td><td><strong>æŸ¥çœ‹å“ˆå¸Œè¡¨ key ä¸­ï¼Œ ç»™å®šåŸŸ field æ˜¯å¦å­˜åœ¨</strong></td></tr><tr><td><strong>hkeys <key></strong></td><td><strong>åˆ—å‡ºè¯¥ hash é›†åˆçš„æ‰€æœ‰ field</strong></td></tr><tr><td><strong>hvals <key></strong></td><td><strong>åˆ—å‡ºè¯¥ hash é›†åˆçš„æ‰€æœ‰ value</strong></td></tr><tr><td><strong>hincrby <key><field><increment></strong></td><td><strong>ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼åŠ ä¸Šå¢é‡ increment</strong></td></tr><tr><td><strong>hsetnx <key><field><value></strong></td><td><strong>å°†å“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼è®¾ç½®ä¸º value ï¼Œ å½“ä¸”ä»…å½“åŸŸ field ä¸å­˜åœ¨</strong></td></tr><tr><td><strong>HGETALL key</strong></td><td><strong>è·å–ä¸€ä¸ªhashç±»å‹çš„keyä¸­çš„æ‰€æœ‰çš„fieldå’Œvalue</strong></td></tr><tr><td><strong>HINCRBY key field</strong></td><td><strong>è®©ä¸€ä¸ªhashç±»å‹keyçš„å­—æ®µå€¼è‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿</strong></td></tr><tr><td><strong>HSETNX key field value</strong></td><td><strong>æ·»åŠ ä¸€ä¸ªhashç±»å‹çš„keyçš„fieldå€¼ï¼Œå‰ææ˜¯è¿™ä¸ªfieldä¸å­˜åœ¨ï¼Œå¦åˆ™ä¸æ‰§è¡Œ</strong></td></tr></tbody></table><h2 id="5-8-SortedSet-Zsetç±»å‹-åŠŸèƒ½ç±»ä¼¼java-ä¸­çš„TreeSet"><a href="#5-8-SortedSet-Zsetç±»å‹-åŠŸèƒ½ç±»ä¼¼java-ä¸­çš„TreeSet" class="headerlink" title="5.8 SortedSet-Zsetç±»å‹(åŠŸèƒ½ç±»ä¼¼java ä¸­çš„TreeSet)"></a>5.8 SortedSet-Zsetç±»å‹(åŠŸèƒ½ç±»ä¼¼java ä¸­çš„TreeSet)</h2><h3 id="5-8-1-ç®€ä»‹"><a href="#5-8-1-ç®€ä»‹" class="headerlink" title="5.8.1 ç®€ä»‹"></a>5.8.1 ç®€ä»‹</h3><ol><li>Redis æœ‰åºé›†åˆ zset ä¸æ™®é€šé›†åˆ set éå¸¸ç›¸ä¼¼ï¼Œ æ˜¯ä¸€ä¸ª<strong>æ²¡æœ‰é‡å¤å…ƒç´ çš„å­—ç¬¦ä¸²é›†åˆ</strong>ã€‚</li><li>ä¸åŒä¹‹å¤„æ˜¯<strong>æœ‰åºé›†åˆçš„æ¯ä¸ªæˆå‘˜éƒ½å…³è”äº†ä¸€ä¸ªè¯„åˆ†(score),è¿™ä¸ªè¯„åˆ†(score)è¢«ç”¨æ¥æŒ‰ç…§ä»æœ€ä½åˆ†åˆ°æœ€é«˜åˆ†çš„æ–¹å¼æ’åºé›†åˆä¸­çš„æˆå‘˜</strong>ã€‚ é›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œ ä½†æ˜¯è¯„åˆ†å¯ä»¥æ˜¯é‡å¤çš„ ã€‚</li><li>å› ä¸ºå…ƒç´ æ˜¯æœ‰åºçš„, æ‰€ä»¥ä¹Ÿå¯ä»¥å¾ˆå¿«çš„æ ¹æ®è¯„åˆ†(score)æˆ–è€…æ¬¡åº(position)æ¥è·å–ä¸€ä¸ªèŒƒå›´çš„å…ƒç´ ã€‚</li><li>è®¿é—®æœ‰åºé›†åˆçš„ä¸­é—´å…ƒç´ ä¹Ÿæ˜¯éå¸¸å¿«çš„, ä½ èƒ½å¤Ÿä½¿ç”¨æœ‰åºé›†åˆä½œä¸ºä¸€ä¸ªæ²¡æœ‰é‡å¤æˆå‘˜çš„åˆ—è¡¨ã€‚</li></ol><p></p><p>â€‹â€”â€”<u>å¯æ’åºã€å…ƒç´ ä¸é‡å¤ã€æŸ¥è¯¢é€Ÿåº¦å¿«</u></p><p>â€‹å¸¸ç”¨äºå®ç°<u>æ’è¡Œæ¦œ</u>è¿™æ ·çš„åŠŸèƒ½</p><h3 id="5-8-2-SortedSetç±»å‹çš„å¸¸ç”¨å‘½ä»¤ï¼š"><a href="#5-8-2-SortedSetç±»å‹çš„å¸¸ç”¨å‘½ä»¤ï¼š" class="headerlink" title="5.8.2 SortedSetç±»å‹çš„å¸¸ç”¨å‘½ä»¤ï¼š"></a>5.8.2 Sorted<u>Set</u>ç±»å‹çš„å¸¸ç”¨å‘½ä»¤ï¼š</h3><table><thead><tr><th><strong>zadd <key><score1><value1><score2><value2>â€¦</strong></th><th><strong>æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ åˆ°sorted set ï¼Œå¦‚æœvalueå·²ç»å­˜åœ¨åˆ™æ›´æ–°å…¶scoreå€¼</strong></th></tr></thead><tbody><tr><td><strong>z(rev)range <key><start><stop> [WITHSCORES]</strong></td><td><strong>è¿”å›æœ‰åºé›† key ä¸­ï¼Œ <u>ä¸‹æ ‡</u>åœ¨<start><stop>ä¹‹é—´çš„å…ƒç´ ï¼Œå¸¦ WITHSCORESï¼Œ å¯ä»¥è®©åˆ†æ•°ä¸€èµ·å’Œå€¼è¿”å›åˆ°ç»“æœé›†(é»˜è®¤å‡åºã€revè¡¨ç¤ºåè½¬ï¼Œå³é™åº)</strong></td></tr><tr><td><strong>zscore <key><member></strong></td><td><strong>è·å–sorted setä¸­çš„æŒ‡å®šå…ƒç´ çš„scoreå€¼</strong></td></tr><tr><td><strong>z(rev)rangebyscore key min max [withscores]</strong></td><td><strong>è¿”å›æœ‰åºé›† key ä¸­ï¼Œ æ‰€æœ‰ score å€¼ä»‹äºmin å’Œ max ä¹‹é—´(åŒ…æ‹¬ç­‰äº min æˆ– max )çš„æˆå‘˜ã€‚ æœ‰åºé›†æˆå‘˜æŒ‰ score å€¼é€’å¢(ä»å°åˆ°å¤§)æ¬¡åºæ’åˆ—</strong></td></tr><tr><td><strong>zincrby <key><increment><value></strong></td><td><strong>ä¸ºå…ƒç´ çš„ score åŠ ä¸Šå¢é‡</strong></td></tr><tr><td><strong>zrem <key><value></strong></td><td><strong>åˆ é™¤è¯¥é›†åˆä¸‹ï¼Œ æŒ‡å®šå€¼çš„å…ƒç´ </strong></td></tr><tr><td><strong>zcount <key><min><max></strong></td><td><strong>ç»Ÿè®¡è¯¥é›†åˆï¼Œ åˆ†æ•°åŒºé—´å†…çš„å…ƒç´ ä¸ªæ•°</strong></td></tr><tr><td><strong>zrank <key><value></strong></td><td><strong>è¿”å›è¯¥å€¼åœ¨é›†åˆä¸­çš„æ’åï¼Œ ä» 0 å¼€å§‹</strong></td></tr><tr><td><strong>Z(REV)RANK <key><value></strong></td><td><strong>è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’å</strong>(ä»0å¼€å§‹ï¼Œé»˜è®¤å‡åº)</td></tr><tr><td><strong>ZCARD <key></strong></td><td><strong>è·å–sorted setä¸­çš„å…ƒç´ ä¸ªæ•°</strong></td></tr><tr><td><strong>ZCOUNT key min max</strong></td><td><strong>ç»Ÿè®¡<u>score</u>å€¼åœ¨ç»™å®šèŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ çš„ä¸ªæ•°</strong></td></tr><tr><td><strong>ZDIFFã€ZINTERã€ZUNION</strong></td><td><strong>æ±‚å·®é›†ã€äº¤é›†ã€å¹¶é›†</strong></td></tr></tbody></table><ul><li>ğŸŒŸæ³¨æ„ï¼šæ‰€æœ‰çš„æ’åé»˜è®¤éƒ½æ˜¯å‡åºï¼Œå¦‚æœè¦é™åºåˆ™åœ¨å‘½ä»¤çš„Zåé¢æ·»åŠ REVå³å¯</li></ul><h1 id="6-Redis-é…ç½®"><a href="#6-Redis-é…ç½®" class="headerlink" title="6 Redis é…ç½®"></a>6 Redis é…ç½®</h1><h2 id="6-1-é…ç½®æ–‡æ¡£"><a href="#6-1-é…ç½®æ–‡æ¡£" class="headerlink" title="6.1 é…ç½®æ–‡æ¡£"></a>6.1 é…ç½®æ–‡æ¡£</h2><h3 id="6-1-1-å‚è€ƒæ–‡æ¡£"><a href="#6-1-1-å‚è€ƒæ–‡æ¡£" class="headerlink" title="6.1.1 å‚è€ƒæ–‡æ¡£ :"></a>6.1.1 å‚è€ƒæ–‡æ¡£ :</h3><p><a href="https://www.cnblogs.com/nhdlb/p/14048083.html#_label0">https://www.cnblogs.com/nhdlb/p/14048083.html#_label0</a></p><h2 id="6-2-å¸¸è§„é…ç½®"><a href="#6-2-å¸¸è§„é…ç½®" class="headerlink" title="6.2 å¸¸è§„é…ç½®"></a>6.2 å¸¸è§„é…ç½®</h2><h3 id="6-2-1-è®¾ç½®å¯†ç "><a href="#6-2-1-è®¾ç½®å¯†ç " class="headerlink" title="6.2.1 è®¾ç½®å¯†ç "></a>6.2.1 è®¾ç½®å¯†ç </h3><h3 id="6-2-2-daemonize"><a href="#6-2-2-daemonize" class="headerlink" title="6.2.2 daemonize"></a>6.2.2 daemonize</h3><h3 id="6-2-3-loglevel"><a href="#6-2-3-loglevel" class="headerlink" title="6.2.3 loglevel"></a>6.2.3 loglevel</h3><h3 id="6-2-4-logfile"><a href="#6-2-4-logfile" class="headerlink" title="6.2.4 logfile"></a>6.2.4 logfile</h3><h3 id="6-2-5-è®¾å®šåº“çš„æ•°é‡"><a href="#6-2-5-è®¾å®šåº“çš„æ•°é‡" class="headerlink" title="6.2.5 è®¾å®šåº“çš„æ•°é‡"></a>6.2.5 è®¾å®šåº“çš„æ•°é‡</h3><h2 id="6-3-Units-å•ä½"><a href="#6-3-Units-å•ä½" class="headerlink" title="6.3 Units å•ä½"></a>6.3 Units å•ä½</h2><p>å¦‚å›¾:</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728083451434.png" alt="image-20230728083451434"></p><p>1ã€ é…ç½®å¤§å°å•ä½,å¼€å¤´å®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„åº¦é‡å•ä½ï¼Œ åªæ”¯æŒ bytesï¼Œ ä¸æ”¯æŒ bit</p><p>2ã€ ä¸åŒºåˆ†å¤§å°å†™</p><h2 id="6-4-INCLUDES"><a href="#6-4-INCLUDES" class="headerlink" title="6.4 #INCLUDES#"></a>6.4 #INCLUDES#</h2><p>å¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728083845886.png" alt="image-20230728083845886"></p><p><strong>å¤šå®ä¾‹çš„æƒ…å†µå¯ä»¥æŠŠå…¬ç”¨çš„é…ç½®æ–‡ä»¶æå–å‡ºæ¥, ç„¶å include</strong></p><h2 id="6-5-NETWORK"><a href="#6-5-NETWORK" class="headerlink" title="6.5 #NETWORK#"></a>6.5 #NETWORK#</h2><h3 id="6-5-1-bind"><a href="#6-5-1-bind" class="headerlink" title="6.5.1 bind"></a>6.5.1 bind</h3><p> å¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728084509521.png" alt="image-20230728084509521"></p><ul><li>é»˜è®¤æƒ…å†µ bind&#x3D;127.0.0.1 åªèƒ½æ¥å—æœ¬æœºçš„è®¿é—®è¯·æ±‚</li><li>å¦‚æœæœåŠ¡å™¨æ˜¯éœ€è¦è¿œç¨‹è®¿é—®çš„ï¼Œ éœ€è¦å°†å…¶æ³¨é‡Šæ‰</li></ul><h3 id="6-5-2-protected-mode"><a href="#6-5-2-protected-mode" class="headerlink" title="6.5.2 protected-mode"></a>6.5.2 protected-mode</h3><p>å¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728084720819.png" alt="image-20230728084720819"></p><ul><li>é»˜è®¤æ˜¯ä¿æŠ¤æ¨¡å¼</li><li>å¦‚æœæœåŠ¡å™¨æ˜¯éœ€è¦è¿œç¨‹è®¿é—®çš„, éœ€è¦å°† yes è®¾ç½®ä¸º no</li></ul><h3 id="6-5-3-port"><a href="#6-5-3-port" class="headerlink" title="6.5.3 port"></a>6.5.3 port</h3><p>å¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728084841445.png" alt="image-20230728084841445"></p><ul><li>Redis æœåŠ¡é»˜è®¤ç«¯å£ 6379</li></ul><h3 id="6-5-4-timeout"><a href="#6-5-4-timeout" class="headerlink" title="6.5.4 timeout"></a>6.5.4 timeout</h3><p>å¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728084955938.png" alt="image-20230728084955938"></p><ul><li>ä¸€ä¸ªç©ºé—²çš„å®¢æˆ·ç«¯ç»´æŒå¤šå°‘ç§’ä¼šå…³é—­ï¼Œ 0 è¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½, å³æ°¸ä¸è¶…æ—¶</li></ul><h3 id="6-5-5-tcp-keepalive"><a href="#6-5-5-tcp-keepalive" class="headerlink" title="6.5.5 tcp-keepalive"></a>6.5.5 tcp-keepalive</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728085057878.png" alt="image-20230728085057878"></p><ul><li>tcp-keepalive æ˜¯<strong>å¯¹è®¿é—®å®¢æˆ·ç«¯çš„ä¸€ç§å¿ƒè·³æ£€æµ‹</strong>ï¼Œ æ¯éš” n ç§’æ£€æµ‹ä¸€æ¬¡, å•ä½ä¸ºç§’</li><li>å¦‚æœè®¾ç½®ä¸º 0ï¼Œ åˆ™ä¸ä¼šè¿›è¡Œ Keepalive æ£€æµ‹ï¼Œ å»ºè®®è®¾ç½®æˆ 60</li><li>è€éŸ©è¯´æ˜: ä¸ºä»€ä¹ˆéœ€è¦å¿ƒè·³æ£€æµ‹æœºåˆ¶<ul><li>TCP åè®®ä¸­æœ‰é•¿è¿æ¥å’ŒçŸ­è¿æ¥ä¹‹åˆ†ã€‚ çŸ­è¿æ¥ç¯å¢ƒä¸‹ï¼Œ æ•°æ®äº¤äº’å®Œæ¯•åï¼Œ ä¸»åŠ¨é‡Šæ”¾è¿æ¥ï¼›</li><li>é•¿è¿æ¥çš„ç¯å¢ƒä¸‹ï¼Œ è¿›è¡Œä¸€æ¬¡æ•°æ®äº¤äº’åï¼Œ å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…æ— æ•°æ®äº¤äº’æ—¶ï¼Œ å®¢æˆ·ç«¯å¯èƒ½æ„å¤–æ–­å¼€ï¼Œ è¿™äº› TCP è¿æ¥å¹¶æœªæ¥å¾—åŠæ­£å¸¸é‡Šæ”¾ï¼Œ é‚£ä¹ˆï¼Œ è¿æ¥çš„å¦ä¸€æ–¹å¹¶ä¸çŸ¥é“å¯¹ç«¯çš„æƒ…å†µï¼Œå®ƒä¼šä¸€ç›´ç»´æŠ¤è¿™ä¸ªè¿æ¥ï¼Œ é•¿æ—¶é—´çš„ç§¯ç´¯ä¼šå¯¼è‡´éå¸¸å¤šçš„åŠæ‰“å¼€è¿æ¥ï¼Œ é€ æˆç«¯ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—å’Œæµªè´¹ï¼Œ ä¸”æœ‰å¯èƒ½å¯¼è‡´åœ¨ä¸€ä¸ªæ— æ•ˆçš„æ•°æ®é“¾è·¯å±‚é¢å‘é€ä¸šåŠ¡æ•°æ®ï¼Œ ç»“æœå°±æ˜¯å‘é€å¤±è´¥ã€‚æ‰€ä»¥æœåŠ¡å™¨ç«¯è¦åšåˆ°å¿«é€Ÿæ„ŸçŸ¥å¤±è´¥ï¼Œ å‡å°‘æ— æ•ˆé“¾æ¥æ“ä½œï¼Œ è¿™å°±æœ‰äº† TCP çš„ Keepalive(ä¿æ´»æ¢æµ‹)æœºåˆ¶</li></ul></li></ul><h2 id="6-6-GENERAL-é€šç”¨"><a href="#6-6-GENERAL-é€šç”¨" class="headerlink" title="6.6 #GENERAL é€šç”¨#"></a>6.6 #GENERAL é€šç”¨#</h2><h3 id="6-6-1-daemonize"><a href="#6-6-1-daemonize" class="headerlink" title="6.6.1 daemonize"></a>6.6.1 daemonize</h3><p>å¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728085407475.png" alt="image-20230728085407475"></p><ul><li>æ˜¯å¦ä¸ºåå°è¿›ç¨‹ï¼Œ è®¾ç½®ä¸º yes</li><li>è®¾ç½®ä¸º yes å, è¡¨ç¤ºå®ˆæŠ¤è¿›ç¨‹, åå°å¯åŠ¨</li></ul><h3 id="6-6-2-pidfile"><a href="#6-6-2-pidfile" class="headerlink" title="6.6.2 pidfile"></a>6.6.2 pidfile</h3><p>å¦‚å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728085518957.png" alt="image-20230728085518957"></p><ul><li>å­˜æ”¾ pid æ–‡ä»¶çš„ä½ç½®ï¼Œ æ¯ä¸ªå®ä¾‹ä¼šäº§ç”Ÿä¸€ä¸ªä¸åŒçš„ pid æ–‡ä»¶, <strong>è®°å½• redis çš„è¿›ç¨‹å·</strong></li></ul><h3 id="6-6-3-loglevel"><a href="#6-6-3-loglevel" class="headerlink" title="6.6.3 loglevel"></a>6.6.3 loglevel</h3><p>å¦‚å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728085914809.png" alt="image-20230728085914809"></p><ul><li><p>redis æ—¥å¿—åˆ†ä¸º 4 ä¸ªçº§åˆ«ï¼Œ é»˜è®¤çš„è®¾ç½®ä¸º notice, <strong>å¼€å‘æµ‹è¯•é˜¶æ®µå¯ä»¥ç”¨ debug</strong>(æ—¥å¿—å†…å®¹è¾ƒå¤š,ä¸å»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨)ï¼Œ ç”Ÿäº§æ¨¡å¼ä¸€èˆ¬é€‰ç”¨ notice</p></li><li><p>redis æ—¥å¿—åˆ†ä¸º 4 ä¸ªçº§åˆ«è¯´æ˜</p><ul><li>debugï¼š ä¼šæ‰“å°å‡ºå¾ˆå¤šä¿¡æ¯ï¼Œ é€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•é˜¶æ®µï¼›</li><li>verboseï¼ˆå†—é•¿çš„ï¼‰ï¼š åŒ…å«å¾ˆå¤šä¸å¤ªæœ‰ç”¨çš„ä¿¡æ¯ï¼Œ ä½†æ¯” debug è¦æ¸…çˆ½ä¸€äº›ï¼›</li><li>noticeï¼š é€‚ç”¨äºç”Ÿäº§æ¨¡å¼ï¼›</li><li>warning : è­¦å‘Šä¿¡æ¯ï¼›</li></ul></li></ul><h3 id="6-6-4-logfile"><a href="#6-6-4-logfile" class="headerlink" title="6.6.4 logfile"></a>6.6.4 logfile</h3><p>å¦‚å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728090613879.png" alt="image-20230728090613879"></p><ul><li>logfile â€œâ€ å°±æ˜¯è¯´ï¼Œ é»˜è®¤ä¸ºæ§åˆ¶å°æ‰“å°ï¼Œ å¹¶æ²¡æœ‰æ—¥å¿—æ–‡ä»¶ç”Ÿæˆ</li><li>å¯ä»¥ä¸º redis.conf çš„ logfile æŒ‡å®šé…ç½®é¡¹</li></ul><h3 id="6-6-5-databases-16"><a href="#6-6-5-databases-16" class="headerlink" title="6.6.5 databases 16"></a>6.6.5 databases 16</h3><p>å¦‚å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728090759061.png" alt="image-20230728090759061"></p><ul><li>è®¾å®šåº“çš„æ•°é‡ é»˜è®¤ 16ï¼Œ é»˜è®¤æ•°æ®åº“ä¸º 0 å·</li><li>å¯ä»¥ä½¿ç”¨ SELECT <dbid>å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“ id</li></ul><h2 id="6-7-SECURITY-å®‰å…¨"><a href="#6-7-SECURITY-å®‰å…¨" class="headerlink" title="6.7 #SECURITY å®‰å…¨#"></a>6.7 #SECURITY å®‰å…¨#</h2><h3 id="6-7-1-è®¾ç½®å¯†ç "><a href="#6-7-1-è®¾ç½®å¯†ç " class="headerlink" title="6.7.1 è®¾ç½®å¯†ç "></a>6.7.1 è®¾ç½®å¯†ç </h3><h4 id="6-7-1-1-redis-conf-ä¸­è®¾ç½®å¯†ç "><a href="#6-7-1-1-redis-conf-ä¸­è®¾ç½®å¯†ç " class="headerlink" title="6.7.1.1 redis.conf ä¸­è®¾ç½®å¯†ç "></a>6.7.1.1 redis.conf ä¸­è®¾ç½®å¯†ç </h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728090958792.png" alt="image-20230728090958792"></p><h4 id="6-7-1-2-å‘½ä»¤è¡Œè®¾ç½®å¯†ç -å¯†ç åªåœ¨æœ¬æ¬¡å¯åŠ¨è¿‡ç¨‹ä¸­ç”Ÿæ•ˆ"><a href="#6-7-1-2-å‘½ä»¤è¡Œè®¾ç½®å¯†ç -å¯†ç åªåœ¨æœ¬æ¬¡å¯åŠ¨è¿‡ç¨‹ä¸­ç”Ÿæ•ˆ" class="headerlink" title="6.7.1.2 å‘½ä»¤è¡Œè®¾ç½®å¯†ç (å¯†ç åªåœ¨æœ¬æ¬¡å¯åŠ¨è¿‡ç¨‹ä¸­ç”Ÿæ•ˆ)"></a>6.7.1.2 å‘½ä»¤è¡Œè®¾ç½®å¯†ç (å¯†ç åªåœ¨æœ¬æ¬¡å¯åŠ¨è¿‡ç¨‹ä¸­ç”Ÿæ•ˆ)</h4><p>åœ¨redisæœåŠ¡ä¸­ï¼Œ   config set requirepass å¯†ç </p><p><strong>åœ¨å‘½ä»¤ä¸­è®¾ç½®å¯†ç ï¼Œ æ˜¯ä¸´æ—¶çš„, é‡å¯ redis æœåŠ¡å™¨ï¼Œ å¯†ç å°±è¿˜åŸäº†</strong></p><h2 id="6-8-LIMITS-é™åˆ¶"><a href="#6-8-LIMITS-é™åˆ¶" class="headerlink" title="6.8 #LIMITS é™åˆ¶#"></a>6.8 #LIMITS é™åˆ¶#</h2><h3 id="6-8-1-maxclients"><a href="#6-8-1-maxclients" class="headerlink" title="6.8.1 maxclients"></a>6.8.1 maxclients</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728091350586.png" alt="image-20230728091350586"></p><ul><li>è®¾ç½® redis åŒæ—¶å¯ä»¥ä¸å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥</li><li>é»˜è®¤æƒ…å†µä¸‹ä¸º 10000 ä¸ªå®¢æˆ·ç«¯</li><li>å¦‚æœè¾¾åˆ°äº†æ­¤é™åˆ¶ï¼Œ redisä¼šæ‹’ç»æ–°çš„è¿æ¥è¯·æ±‚ï¼Œ å¹¶ä¸”å‘è¿™äº›è¿æ¥è¯·æ±‚æ–¹å‘å‡ºâ€max numberof clients reachedâ€</li></ul><h3 id="6-8-2-maxmemory"><a href="#6-8-2-maxmemory" class="headerlink" title="6.8.2 maxmemory"></a>6.8.2 maxmemory</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728091506781.png" alt="image-20230728091506781"></p><ul><li>åœ¨é»˜è®¤æƒ…å†µä¸‹, å¯¹ 32 ä½ å®ä¾‹ä¼šé™åˆ¶åœ¨ 3 GB, å› ä¸º 32 ä½çš„æœºå™¨æœ€å¤§åªæ”¯æŒ 4GB çš„å†…å­˜ï¼Œ è€Œç³»ç»Ÿæœ¬èº«å°±éœ€è¦ä¸€å®šçš„å†…å­˜èµ„æºæ¥æ”¯æŒè¿è¡Œï¼Œ æ‰€ä»¥ 32 ä½æœºå™¨é™åˆ¶æœ€å¤§ 3 GB çš„å¯ç”¨å†…å­˜æ˜¯éå¸¸åˆç†çš„ï¼Œ è¿™æ ·å¯ä»¥é¿å…å› ä¸ºå†…å­˜ä¸è¶³è€Œå¯¼è‡´ Redis å®ä¾‹å´©æºƒ</li><li>åœ¨é»˜è®¤æƒ…å†µä¸‹, å¯¹äº 64 ä½å®ä¾‹æ˜¯æ²¡æœ‰é™åˆ¶</li><li>å½“ç”¨æˆ·å¼€å¯äº† redis.conf é…ç½®æ–‡ä»¶çš„ maxmemory é€‰é¡¹ï¼Œ é‚£ä¹ˆ Redis å°†é™åˆ¶é€‰é¡¹çš„å€¼ä¸èƒ½å°äº 1 MB</li></ul><p><u><strong>å¯¹ maxmemory è®¾ç½®çš„å»ºè®®</strong></u></p><ol><li><p>Redis çš„ maxmemory è®¾ç½®å–å†³äºä½¿ç”¨æƒ…å†µ, æœ‰äº›ç½‘ç«™åªéœ€è¦ 32MBï¼Œ æœ‰äº›å¯èƒ½éœ€è¦ 12GBã€‚</p></li><li><p>maxmemory åªèƒ½æ ¹æ®å…·ä½“çš„ç”Ÿäº§ç¯å¢ƒæ¥è°ƒè¯•ï¼Œ ä¸è¦é¢„è®¾ä¸€ä¸ªå®šå€¼ï¼Œ ä»å°åˆ°å¤§æµ‹è¯•ï¼ŒåŸºæœ¬æ ‡å‡†æ˜¯ä¸å¹²æ‰°æ­£å¸¸ç¨‹åºçš„è¿è¡Œã€‚</p></li><li><p>Redis çš„æœ€å¤§ä½¿ç”¨å†…å­˜è·Ÿæ­é…æ–¹å¼æœ‰å…³ï¼Œ å¦‚æœåªæ˜¯ç”¨ Redis åšçº¯ç¼“å­˜, 64-128M å¯¹ä¸€èˆ¬å°å‹ç½‘ç«™å°±è¶³å¤Ÿäº†</p></li><li><p>å¦‚æœä½¿ç”¨ Redis åšæ•°æ®åº“çš„è¯ï¼Œ è®¾ç½®åˆ°ç‰©ç†å†…å­˜çš„ 1&#x2F;2 åˆ° 3&#x2F;4 å·¦å³éƒ½å¯ä»¥</p></li><li><p>å¦‚æœä½¿ç”¨äº†å¿«ç…§åŠŸèƒ½çš„è¯ï¼Œ æœ€å¥½ç”¨åˆ° 50%ä»¥ä¸‹ï¼Œ å› ä¸ºå¿«ç…§å¤åˆ¶æ›´æ–°éœ€è¦åŒå€å†…å­˜ç©ºé—´ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨å¿«ç…§è€Œè®¾ç½® redis ç¼“å­˜æ•°æ®åº“ï¼Œ å¯ä»¥ç”¨åˆ°å†…å­˜çš„ 80%å·¦å³ï¼Œ åªè¦èƒ½ä¿è¯ Javaã€NGINX ç­‰å…¶å®ƒç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œå°±è¡Œäº†</p></li></ol><h3 id="6-8-3-maxmemory-policy"><a href="#6-8-3-maxmemory-policy" class="headerlink" title="6.8.3 maxmemory-policy"></a>6.8.3 maxmemory-policy</h3><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728092049334.png" alt="image-20230728092049334" style="zoom:70%;" /><p>policy ä¸€è§ˆ:</p><ul><li>volatile-lruï¼š ä½¿ç”¨ LRU ç®—æ³•ç§»é™¤ keyï¼Œ åªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ï¼› (æœ€è¿‘æœ€å°‘ä½¿ç”¨)</li><li>allkeys-lruï¼š åœ¨æ‰€æœ‰é›†åˆ key ä¸­ï¼Œ ä½¿ç”¨ LRU ç®—æ³•ç§»é™¤ key</li><li>volatile-randomï¼š åœ¨è¿‡æœŸé›†åˆä¸­ç§»é™¤éšæœºçš„ keyï¼Œ åªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®</li><li>allkeys-randomï¼š åœ¨æ‰€æœ‰é›†åˆ key ä¸­ï¼Œ ç§»é™¤éšæœºçš„ key</li><li>volatile-ttlï¼š ç§»é™¤é‚£äº› TTL å€¼æœ€å°çš„ keyï¼Œ å³é‚£äº›æœ€è¿‘è¦è¿‡æœŸçš„ key</li><li>noevictionï¼š ä¸è¿›è¡Œç§»é™¤ã€‚ é’ˆå¯¹å†™æ“ä½œï¼Œ åªæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯</li></ul><h3 id="6-8-4-maxmemory-samples"><a href="#6-8-4-maxmemory-samples" class="headerlink" title="6.8.4 maxmemory-samples"></a>6.8.4 maxmemory-samples</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728091924891.png" alt="image-20230728091924891"></p><ul><li>è®¾ç½®æ ·æœ¬æ•°é‡ï¼Œ LRU ç®—æ³•å’Œæœ€å° TTL ç®—æ³•éƒ½å¹¶éæ˜¯ç²¾ç¡®çš„ç®—æ³•ï¼Œ è€Œæ˜¯ä¼°ç®—å€¼ï¼Œ æ‰€ä»¥ä½ å¯ä»¥è®¾ç½®æ ·æœ¬çš„å¤§å°ï¼Œ redis é»˜è®¤ä¼šæ£€æŸ¥è¿™ä¹ˆå¤šä¸ª key å¹¶é€‰æ‹©å…¶ä¸­ LRU çš„é‚£ä¸ª</li><li>ä¸€èˆ¬è®¾ç½® 3 åˆ° 7 çš„æ•°å­—ï¼Œ æ•°å€¼è¶Šå°æ ·æœ¬è¶Šä¸å‡†ç¡®ï¼Œ ä½†æ€§èƒ½æ¶ˆè€—è¶Šå°</li></ul><h1 id="7-å‘å¸ƒå’Œè®¢é˜…"><a href="#7-å‘å¸ƒå’Œè®¢é˜…" class="headerlink" title="7 å‘å¸ƒå’Œè®¢é˜…"></a>7 å‘å¸ƒå’Œè®¢é˜…</h1><h2 id="7-1-å‘å¸ƒå’Œè®¢é˜…æ˜¯ä»€ä¹ˆ"><a href="#7-1-å‘å¸ƒå’Œè®¢é˜…æ˜¯ä»€ä¹ˆ" class="headerlink" title="7.1 å‘å¸ƒå’Œè®¢é˜…æ˜¯ä»€ä¹ˆ"></a>7.1 å‘å¸ƒå’Œè®¢é˜…æ˜¯ä»€ä¹ˆ</h2><h3 id="7-1-1-æ¦‚è¿°ï¼š"><a href="#7-1-1-æ¦‚è¿°ï¼š" class="headerlink" title="7.1.1 æ¦‚è¿°ï¼š"></a>7.1.1 æ¦‚è¿°ï¼š</h3><p>Redis å‘å¸ƒè®¢é˜… (pub&#x2F;sub) æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼š å‘é€è€… (pub) å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€… (sub) æ¥æ”¶æ¶ˆæ¯</p><h3 id="7-1-2-Redis-å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“"><a href="#7-1-2-Redis-å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“" class="headerlink" title="7.1.2 Redis å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“"></a>7.1.2 Redis å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“</h3><h3 id="7-1-3-ä¸€å›¾èƒœåƒè¨€"><a href="#7-1-3-ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="7.1.3 ä¸€å›¾èƒœåƒè¨€"></a>7.1.3 ä¸€å›¾èƒœåƒè¨€</h3><p>1ã€ å®¢æˆ·ç«¯è®¢é˜…é¢‘é“ç¤ºæ„å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728092654620.png" alt="image-20230728092654620" style="zoom: 67%;" /><p>2ã€å½“ç»™è¿™ä¸ªé¢‘é“å‘å¸ƒæ¶ˆæ¯åï¼Œæ¶ˆæ¯å°±ä¼šå‘é€ç»™è®¢é˜…çš„å®¢æˆ·ç«¯</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728093005557.png" alt="image-20230728093005557" style="zoom:60%;" /><h2 id="7-2-å¦‚ä½•ç†è§£å‘å¸ƒå’Œè®¢é˜…æ¨¡å¼"><a href="#7-2-å¦‚ä½•ç†è§£å‘å¸ƒå’Œè®¢é˜…æ¨¡å¼" class="headerlink" title="7.2 å¦‚ä½•ç†è§£å‘å¸ƒå’Œè®¢é˜…æ¨¡å¼"></a>7.2 å¦‚ä½•ç†è§£å‘å¸ƒå’Œè®¢é˜…æ¨¡å¼</h2><h3 id="7-2-1-ä»»åŠ¡é˜Ÿåˆ—"><a href="#7-2-1-ä»»åŠ¡é˜Ÿåˆ—" class="headerlink" title="7.2.1 ä»»åŠ¡é˜Ÿåˆ—"></a>7.2.1 ä»»åŠ¡é˜Ÿåˆ—</h3><p>1ã€ é¡¾åæ€ä¹‰ï¼Œ å°±æ˜¯â€ä¼ é€’æ¶ˆæ¯çš„é˜Ÿåˆ—â€</p><p>2ã€ ä¸ä»»åŠ¡é˜Ÿåˆ—è¿›è¡Œäº¤äº’çš„å®ä½“æœ‰ä¸¤ç±»ï¼Œ ä¸€ç±»æ˜¯ç”Ÿäº§è€…ï¼ˆ producerï¼‰ï¼Œ å¦ä¸€ç±»åˆ™æ˜¯æ¶ˆè´¹è€…ï¼ˆconsumerï¼‰ã€‚ <strong>ç”Ÿäº§è€…å°†éœ€è¦å¤„ç†çš„ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œ è€Œæ¶ˆè´¹è€…åˆ™ä¸æ–­åœ°ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è¯»å…¥ä»»åŠ¡ä¿¡æ¯å¹¶æ‰§è¡Œ</strong></p><h3 id="7-2-2-å¦‚ä½•ç†è§£"><a href="#7-2-2-å¦‚ä½•ç†è§£" class="headerlink" title="7.2.2 å¦‚ä½•ç†è§£"></a>7.2.2 å¦‚ä½•ç†è§£</h3><p>â€‹å¯ä»¥è¿™ä¹ˆç®€å•çš„ç†è§£ï¼š</p><ol><li>Subscriberï¼š æ”¶éŸ³æœºï¼Œ å¯ä»¥æ”¶åˆ°å¤šä¸ªé¢‘é“ï¼Œ å¹¶ä»¥é˜Ÿåˆ—æ–¹å¼æ˜¾ç¤º</li><li>Publisherï¼š ç”µå°ï¼Œ å¯ä»¥å¾€ä¸åŒçš„ FM é¢‘é“ä¸­å‘æ¶ˆæ¯</li><li>Channelï¼š ä¸åŒé¢‘ç‡çš„ FM é¢‘é“</li></ol><p>ä» Pub&#x2F;Sub çš„æœºåˆ¶æ¥çœ‹ï¼Œ å®ƒæ›´åƒæ˜¯ä¸€ä¸ªå¹¿æ’­ç³»ç»Ÿï¼Œ å¤šä¸ªè®¢é˜…è€…ï¼ˆSubscriberï¼‰ å¯ä»¥è®¢é˜…å¤šä¸ªé¢‘é“ï¼ˆChannelï¼‰ï¼Œ å¤šä¸ªå‘å¸ƒè€…ï¼ˆPublisherï¼‰ å¯ä»¥å¾€å¤šä¸ªé¢‘é“ï¼ˆChannelï¼‰ ä¸­å‘å¸ƒæ¶ˆæ¯</p><h2 id="7-3-å‘å¸ƒè®¢é˜…æ¨¡å¼åˆ†ç±»"><a href="#7-3-å‘å¸ƒè®¢é˜…æ¨¡å¼åˆ†ç±»" class="headerlink" title="7.3 å‘å¸ƒè®¢é˜…æ¨¡å¼åˆ†ç±»"></a>7.3 å‘å¸ƒè®¢é˜…æ¨¡å¼åˆ†ç±»</h2><p>â€”â€”-å‘å¸ƒï¼šæä¾›æ•°æ®çš„</p><p>â€”â€”-è®¢é˜…ï¼šæ¥å—ã€å¤„ç†æ•°æ®çš„</p><h3 id="7-3-1-ä¸€ä¸ªå‘å¸ƒè€…ï¼Œ-å¤šä¸ªè®¢é˜…è€…"><a href="#7-3-1-ä¸€ä¸ªå‘å¸ƒè€…ï¼Œ-å¤šä¸ªè®¢é˜…è€…" class="headerlink" title="7.3.1 ä¸€ä¸ªå‘å¸ƒè€…ï¼Œ å¤šä¸ªè®¢é˜…è€…"></a>7.3.1 ä¸€ä¸ªå‘å¸ƒè€…ï¼Œ å¤šä¸ªè®¢é˜…è€…</h3><p>â€‹-ä¸»è¦åº”ç”¨ï¼š <strong>é€šçŸ¥ã€ å…¬å‘Š</strong></p><p>â€‹-å¯ä»¥<strong>ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—æˆ–è€…æ¶ˆæ¯ç®¡é“</strong></p><p>â€‹-ç¤ºæ„å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728093416754.png" alt="image-20230728093416754"></p><h3 id="7-3-2-å¤šä¸ªå‘å¸ƒè€…ï¼Œ-ä¸€ä¸ªè®¢é˜…è€…"><a href="#7-3-2-å¤šä¸ªå‘å¸ƒè€…ï¼Œ-ä¸€ä¸ªè®¢é˜…è€…" class="headerlink" title="7.3.2 å¤šä¸ªå‘å¸ƒè€…ï¼Œ ä¸€ä¸ªè®¢é˜…è€…"></a>7.3.2 å¤šä¸ªå‘å¸ƒè€…ï¼Œ ä¸€ä¸ªè®¢é˜…è€…</h3><p>â€‹-å„åº”ç”¨ç¨‹åºä½œä¸º Publisher å‘ Channel ä¸­å‘é€æ¶ˆæ¯ï¼Œ Subscriber ç«¯æ”¶åˆ°æ¶ˆæ¯åæ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ï¼Œ æ¯”å¦‚å†™æ•°æ®åº“ï¼Œ æ˜¾ç¤º..</p><p>â€‹-ä¸»è¦åº”ç”¨ï¼š<strong>æ’è¡Œæ¦œã€æŠ•ç¥¨ã€è®¡æ•°</strong></p><p>â€‹-ç¤ºæ„å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728093709916.png" alt="image-20230728093709916"></p><h3 id="7-3-3-å¤šä¸ªå‘å¸ƒè€…ï¼Œ-å¤šä¸ªè®¢é˜…è€…"><a href="#7-3-3-å¤šä¸ªå‘å¸ƒè€…ï¼Œ-å¤šä¸ªè®¢é˜…è€…" class="headerlink" title="7.3.3 å¤šä¸ªå‘å¸ƒè€…ï¼Œ å¤šä¸ªè®¢é˜…è€…"></a>7.3.3 å¤šä¸ªå‘å¸ƒè€…ï¼Œ å¤šä¸ªè®¢é˜…è€…</h3><p>-å¯ä»¥å‘ä¸åŒçš„ Channel ä¸­å‘é€æ¶ˆæ¯ï¼Œ ç”±ä¸åŒçš„ Subscriber æ¥æ”¶ã€‚</p><p>-ä¸»è¦åº”ç”¨ï¼š<strong>ç¾¤èŠã€èŠå¤©</strong></p><p>-ç¤ºæ„å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728093939273.png" alt="image-20230728093939273"></p><h2 id="7-4-å‘½ä»¤è¡Œå®ç°å‘å¸ƒå’Œè®¢é˜…"><a href="#7-4-å‘½ä»¤è¡Œå®ç°å‘å¸ƒå’Œè®¢é˜…" class="headerlink" title="7.4 å‘½ä»¤è¡Œå®ç°å‘å¸ƒå’Œè®¢é˜…"></a>7.4 å‘½ä»¤è¡Œå®ç°å‘å¸ƒå’Œè®¢é˜…</h2><h3 id="7-4-1-å‘å¸ƒã€è®¢é˜…æ“ä½œ"><a href="#7-4-1-å‘å¸ƒã€è®¢é˜…æ“ä½œ" class="headerlink" title="7.4.1 å‘å¸ƒã€è®¢é˜…æ“ä½œ"></a>7.4.1 å‘å¸ƒã€è®¢é˜…æ“ä½œ</h3><p>1ã€ <strong>PUBLISH channel msg</strong></p><p>å°†ä¿¡æ¯ message å‘é€åˆ°æŒ‡å®šçš„é¢‘é“ channel</p><p>2ã€ <strong>SUBSCRIBE channel [channel â€¦]</strong></p><p>è®¢é˜…é¢‘é“ï¼Œ å¯ä»¥åŒæ—¶è®¢é˜…å¤šä¸ªé¢‘é“</p><p>3ã€ <strong>UNSUBSCRIBE [channel â€¦]</strong></p><p>å–æ¶ˆè®¢é˜…æŒ‡å®šçš„é¢‘é“, å¦‚æœä¸æŒ‡å®šé¢‘é“ï¼Œ åˆ™ä¼šå–æ¶ˆè®¢é˜…æ‰€æœ‰é¢‘é“</p><p>4ã€ <strong>PSUBSCRIBE pattern [pattern â€¦]</strong></p><p>è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦åˆç»™å®šæ¨¡å¼çš„é¢‘é“ï¼Œ æ¯ä¸ªæ¨¡å¼ä»¥ * ä½œä¸ºåŒ¹é…ç¬¦ï¼Œ æ¯”å¦‚ it* åŒ¹é…æ‰€ æœ‰ä»¥ it å¼€å¤´çš„é¢‘é“( it.news ã€ it.blog ã€ it.tweets ç­‰ç­‰)ï¼Œ news.* åŒ¹é…æ‰€æœ‰ ä»¥ news. å¼€å¤´çš„é¢‘é“( news.it ã€ news.global.today ç­‰ç­‰)ï¼Œ è¯¸å¦‚æ­¤ç±»</p><p>5ã€ <strong>PUNSUBSCRIBE [pattern [pattern â€¦]]</strong></p><p>é€€è®¢æŒ‡å®šçš„è§„åˆ™, å¦‚æœæ²¡æœ‰å‚æ•°åˆ™ä¼šé€€è®¢æ‰€æœ‰è§„åˆ™</p><h3 id="7-4-2-å¿«é€Ÿå…¥é—¨"><a href="#7-4-2-å¿«é€Ÿå…¥é—¨" class="headerlink" title="7.4.2 å¿«é€Ÿå…¥é—¨"></a>7.4.2 å¿«é€Ÿå…¥é—¨</h3><p>1ã€ æ‰“å¼€ä¸€ä¸ªå®¢æˆ·ç«¯è®¢é˜… channel1</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728094614049.png" alt="image-20230728094614049" style="zoom:50%;" /><p>2ã€æ‰“å¼€å¦ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œç»™ channel1 å‘å¸ƒæ¶ˆæ¯ hello</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728094636960.png" alt="image-20230728094636960" style="zoom:50%;" /><p>3ã€è¿”å›çš„ 1, æ˜¯è®¢é˜…è€…æ•°é‡</p><p>4ã€å‘å¸ƒçš„æ¶ˆæ¯æ²¡æœ‰æŒä¹…åŒ–(å…³é—­redisåå°±æ²¡äº†)</p><p>5ã€è®¢é˜…çš„å®¢æˆ·ç«¯, åªèƒ½æ”¶åˆ°è®¢é˜…åå‘å¸ƒçš„æ¶ˆæ¯</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728094704271.png" alt="image-20230728094704271" style="zoom:50%;" /><h1 id="8-Jedis"><a href="#8-Jedis" class="headerlink" title="8 Jedis"></a>8 Jedis</h1><h2 id="8-1-API-æ–‡æ¡£"><a href="#8-1-API-æ–‡æ¡£" class="headerlink" title="8.1 API æ–‡æ¡£"></a>8.1 API æ–‡æ¡£</h2><h3 id="8-1-1-åœ¨çº¿æ–‡æ¡£-https-www-mklab-cn-onlineapi-jedis"><a href="#8-1-1-åœ¨çº¿æ–‡æ¡£-https-www-mklab-cn-onlineapi-jedis" class="headerlink" title="8.1.1 åœ¨çº¿æ–‡æ¡£ : https://www.mklab.cn/onlineapi/jedis/"></a>8.1.1 åœ¨çº¿æ–‡æ¡£ : <a href="https://www.mklab.cn/onlineapi/jedis/">https://www.mklab.cn/onlineapi/jedis/</a></h3><h2 id="8-2-Jedis-ä»‹ç»"><a href="#8-2-Jedis-ä»‹ç»" class="headerlink" title="8.2 Jedis ä»‹ç»"></a>8.2 Jedis ä»‹ç»</h2><p>-Java ç¨‹åºæ“ä½œ Redis çš„å·¥å…·</p><h2 id="8-3-Jedis-æ“ä½œ-Redis-æ•°æ®"><a href="#8-3-Jedis-æ“ä½œ-Redis-æ•°æ®" class="headerlink" title="8.3 Jedis æ“ä½œ Redis æ•°æ®"></a>8.3 Jedis æ“ä½œ Redis æ•°æ®</h2><p>â€‹<strong>(ä»¥rediså‘½åä½œä¸ºæ–¹æ³•åç§°ï¼Œå­¦ä¹ æˆæœ¬ä½ï¼Œä½†æ˜¯çº¿ç¨‹ä¸å®‰å…¨ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹éœ€è¦åŸºäºè¿æ¥æ± æ¥ä½¿ç”¨)</strong></p><h3 id="8-3-1-å¿«é€Ÿå…¥é—¨"><a href="#8-3-1-å¿«é€Ÿå…¥é—¨" class="headerlink" title="8.3.1 å¿«é€Ÿå…¥é—¨"></a>8.3.1 å¿«é€Ÿå…¥é—¨</h3><h5 id="step1-å¼•å…¥ä¾èµ–"><a href="#step1-å¼•å…¥ä¾èµ–" class="headerlink" title="step1:  å¼•å…¥ä¾èµ–"></a>step1:  å¼•å…¥ä¾èµ–</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="step2ï¼šå»ºç«‹è¿æ¥"><a href="#step2ï¼šå»ºç«‹è¿æ¥" class="headerlink" title="step2ï¼šå»ºç«‹è¿æ¥"></a>step2ï¼šå»ºç«‹è¿æ¥</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*** è€å¸ˆè§£è¯»</span></span><br><span class="line"><span class="comment">* 1. ç¡®ä¿ ip:6379 æ˜¯è¿é€šçš„, éœ€è¦æ‰“å¼€é˜²ç«å¢™çš„ç«¯å£</span></span><br><span class="line"><span class="comment">* 2. å¦‚æœ redis ä½ è®¾ç½®äº†å¯†ç , éœ€è¦æ‰§è¡Œ jedis.auth(&quot;hspedu&quot;);è¿›è¡Œæƒé™éªŒè¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">con</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;172.20.10.4&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        jedis.auth(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> jedis.ping();</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿æ¥æˆåŠŸï¼Œè¿”å›ç»“æœï¼š&quot;</span> + res);</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h5 id="step3ï¼šä½¿ç”¨Redis"><a href="#step3ï¼šä½¿ç”¨Redis" class="headerlink" title="step3ï¼šä½¿ç”¨Redis"></a>step3ï¼šä½¿ç”¨Redis</h5><p> (Jedisä¸­çš„APIå’Œredisä¸­çš„å‘½ä»¤ä¸€æ¨¡ä¸€æ ·ï¼)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">key</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;172.20.10.4&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">       jedis.auth(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">       jedis.set(<span class="string">&quot;q1&quot;</span>,<span class="string">&quot;123&quot;</span>);</span><br><span class="line">       jedis.set(<span class="string">&quot;q2&quot;</span>,<span class="string">&quot;234&quot;</span>);</span><br><span class="line">       jedis.set(<span class="string">&quot;q3&quot;</span>,<span class="string">&quot;345&quot;</span>);</span><br><span class="line"></span><br><span class="line">       Set&lt;String&gt; keys = jedis.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">       <span class="keyword">for</span> (String key : keys) &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;key--&gt;&quot;</span> + key);</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(jedis.exists(<span class="string">&quot;q1&quot;</span>));</span><br><span class="line">       System.out.println(jedis.ttl(<span class="string">&quot;q2&quot;</span>));</span><br><span class="line">       System.out.println(jedis.get(<span class="string">&quot;q2&quot;</span>));</span><br><span class="line">       jedis.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h5 id="step4ï¼šé‡Šæ”¾èµ„æº"><a href="#step4ï¼šé‡Šæ”¾èµ„æº" class="headerlink" title="step4ï¼šé‡Šæ”¾èµ„æº"></a>step4ï¼šé‡Šæ”¾èµ„æº</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (jedis != <span class="literal">null</span>)&#123;</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="8-3-2-è¿æ¥-Redis-æ³¨æ„äº‹é¡¹"><a href="#8-3-2-è¿æ¥-Redis-æ³¨æ„äº‹é¡¹" class="headerlink" title="8.3.2 è¿æ¥ Redis æ³¨æ„äº‹é¡¹"></a>8.3.2 è¿æ¥ Redis æ³¨æ„äº‹é¡¹</h3><p>1ã€ ç¡®ä¿ ip:6379 æ˜¯è¿é€šçš„, æ³¨æ„æ‰“å¼€é˜²ç«å¢™çš„ 6379 ç«¯å£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â— è®¾ç½®å¼€æ”¾çš„ç«¯å£å·</span><br><span class="line">firewall-cmd --add-port=6379/tcp --permanent</span><br><span class="line">â— é‡å¯é˜²ç«å¢™</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">â— æŸ¥çœ‹é˜²ç«å¢™</span><br><span class="line">firewall-cmd --list-all</span><br></pre></td></tr></table></figure><p>2ã€å¦‚æœ redis ä½ è®¾ç½®äº†å¯†ç , éœ€è¦æ‰§è¡Œ jedis.auth(â€œå¯†ç â€);è¿›è¡Œæƒé™éªŒè¯</p><h1 id="9-Spring-Boot2-æ•´åˆ-Redis"><a href="#9-Spring-Boot2-æ•´åˆ-Redis" class="headerlink" title="9 Spring Boot2 æ•´åˆ Redis"></a>9 Spring Boot2 æ•´åˆ Redis</h1><h2 id="9-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#9-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="9.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>9.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h2><ol><li>åœ¨ springboot ä¸­ , æ•´åˆ redis</li><li>å¯ä»¥é€šè¿‡ <strong>RedisTemplate</strong> å®Œæˆå¯¹ redis çš„æ“ä½œ, åŒ…æ‹¬è®¾ç½®æ•°æ®&#x2F;è·å–æ•°æ®</li><li>æ¯”å¦‚æ·»åŠ å’Œè¯»å–æ•°æ®</li></ol><h2 id="9-2-å…·ä½“æ•´åˆå®ç°"><a href="#9-2-å…·ä½“æ•´åˆå®ç°" class="headerlink" title="9.2 å…·ä½“æ•´åˆå®ç°"></a>9.2 å…·ä½“æ•´åˆå®ç°</h2><h3 id="9-2-1-åˆ›å»º-Maven-é¡¹ç›®"><a href="#9-2-1-åˆ›å»º-Maven-é¡¹ç›®" class="headerlink" title="9.2.1 åˆ›å»º Maven é¡¹ç›®"></a>9.2.1 åˆ›å»º Maven é¡¹ç›®</h3><h3 id="9-2-2-ä¿®æ”¹-pom-xml-å¼•å…¥ç›¸å…³ä¾èµ–"><a href="#9-2-2-ä¿®æ”¹-pom-xml-å¼•å…¥ç›¸å…³ä¾èµ–" class="headerlink" title="9.2.2 ä¿®æ”¹ pom.xml - å¼•å…¥ç›¸å…³ä¾èµ–"></a>9.2.2 ä¿®æ”¹ pom.xml - å¼•å…¥ç›¸å…³ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- redisä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- spring2.Xé›†æˆredisæ‰€éœ€common-pool--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ä¸è¦å¸¦ç‰ˆæœ¬å·,é˜²æ­¢å†²çª, ä½¿ç”¨ç‰ˆæœ¬ä»²è£å³å¯--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="9-2-3-é…ç½®"><a href="#9-2-3-é…ç½®" class="headerlink" title="9.2.3 é…ç½®"></a>9.2.3 é…ç½®</h3><h4 id="9-2-3-1-application-properties"><a href="#9-2-3-1-application-properties" class="headerlink" title="9.2.3.1 application.properties"></a>9.2.3.1 application.properties</h4><p>â€“ å®Œæˆ redis çš„åŸºæœ¬é…ç½®</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#RedisæœåŠ¡å™¨åœ°å€</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">172.20.10.4</span></span><br><span class="line"><span class="comment">#RedisæœåŠ¡å™¨è¿æ¥ç«¯å£</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="comment">#Rediså¯†ç </span></span><br><span class="line"><span class="attr">spring.redis.password</span>=<span class="string">root</span></span><br><span class="line"><span class="comment">#Redisæ•°æ®åº“ç´¢å¼•(é»˜è®¤ä¸º0</span></span><br><span class="line"><span class="attr">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="comment">#è¿æ¥è¶…æ—¶æ—¶é—´(æ¯«ç§’</span></span><br><span class="line"><span class="attr">spring.redis.timeout</span>=<span class="string">1800000</span></span><br><span class="line"><span class="comment">#è¿æ¥æ± æœ€å¤§è¿æ¥æ•°(ä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-active</span>=<span class="string">20</span></span><br><span class="line"><span class="comment">#æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´(ä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-wait</span>=<span class="string">-1</span></span><br><span class="line"><span class="comment">#è¿æ¥æ± ä¸­æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.max-idle</span>=<span class="string">5</span></span><br><span class="line"><span class="comment">#è¿æ¥æ± ä¸­æœ€å°ç©ºé—²è¿æ¥</span></span><br><span class="line"><span class="attr">spring.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br></pre></td></tr></table></figure><h4 id="9-2-3-2-redis-é…ç½®ç±»"><a href="#9-2-3-2-redis-é…ç½®ç±»" class="headerlink" title="9.2.3.2 redis é…ç½®ç±»"></a>9.2.3.2 redis é…ç½®ç±»</h4><p>1ã€ æ˜¯<strong>å¯¹è¦ä½¿ç”¨çš„ RedisTemplate bean å¯¹è±¡çš„é…ç½®</strong>, å¯ä»¥ç†è§£æˆæ˜¯ä¸€ä¸ªå¸¸è§„é…ç½®.</p><p>2ã€ åŒå­¦ä»¬æƒ³ä¸€æƒ³æˆ‘ä»¬ä»¥å‰å­¦ä¹ è¿‡ä¸€ä¸ª JdbcTemplate,è®¾è®¡ç†å¿µç±»ä¼¼</p><p>3ã€ å¦‚æœä¸é…ç½®, springboot ä¼šä½¿ç”¨é»˜è®¤é…ç½®, è¿™ä¸ªé»˜è®¤é…ç½®, ä¼šå‡ºç°ä¸€äº›é—®é¢˜, æ¯”å¦‚:redisTemplate çš„ key åºåˆ—åŒ–ç­‰, é—®é¢˜æ‰€ä»¥é€šå¸¸æˆ‘ä»¬éœ€è¦é…ç½®</p><p>4ã€åˆ› å»º RedisConfig.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> <span class="keyword">extends</span> <span class="title class_">CachingConfigurerSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template =</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        System.out.println(<span class="string">&quot;template=&gt;&quot;</span> + template);<span class="comment">//è¿™é‡Œå¯ä»¥éªŒè¯..</span></span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer =</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">jackson2JsonRedisSerializer</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>(Object.class);</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.activateDefaultTyping(</span><br><span class="line">                LaissezFaireSubTypeValidator.instance,</span><br><span class="line">                ObjectMapper.DefaultTyping.NON_FINAL,</span><br><span class="line">                JsonTypeInfo.As.WRAPPER_ARRAY);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">        <span class="comment">//keyåºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        template.setKeySerializer(redisSerializer);</span><br><span class="line">        <span class="comment">//valueåºåˆ—åŒ–</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">//value hashmapåºåˆ—åŒ–</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer =</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">jackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>(Object.class);</span><br><span class="line">        <span class="comment">//è§£å†³æŸ¥è¯¢ç¼“å­˜è½¬æ¢å¼‚å¸¸çš„é—®é¢˜</span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.activateDefaultTyping(</span><br><span class="line">                LaissezFaireSubTypeValidator.instance,</span><br><span class="line">                ObjectMapper.DefaultTyping.NON_FINAL,</span><br><span class="line">                JsonTypeInfo.As.WRAPPER_ARRAY);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        <span class="comment">// é…ç½®åºåˆ—åŒ–ï¼ˆè§£å†³ä¹±ç çš„é—®é¢˜ï¼‰,è¿‡æœŸæ—¶é—´600ç§’</span></span><br><span class="line">        <span class="type">RedisCacheConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofSeconds(<span class="number">600</span>))</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line">        <span class="type">RedisCacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> RedisCacheManager.builder(factory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="9-2-3-3-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#9-2-3-3-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="9.2.3.3 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>9.2.3.3 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p>1ã€ å¦‚æœæ²¡æœ‰æä¾› RedisConfig é…ç½®ç±» , springboot ä¼šä½¿ç”¨é»˜è®¤é…ç½®, ä¹Ÿå¯ä»¥ä½¿ç”¨,ä½†æ˜¯ä¼šå­˜åœ¨é—®é¢˜</p><p>2ã€ğŸŒŸ Unrecognized token â€˜beijingâ€™: was expecting (â€˜trueâ€™, â€˜falseâ€™ or â€˜nullâ€™)çœ‹æŠ¥é”™ï¼Œæ˜¯ jason è½¬æ¢å¼‚å¸¸ï¼Œå®é™…ä¸Šæ˜¯å› ä¸º <strong>redisTemplate åœ¨åšæ•°æ®å­˜å‚¨çš„æ—¶å€™ä¼šæŠŠå­˜å‚¨çš„å†…å®¹åºåˆ—åŒ–ï¼Œæ‰€ä»¥ï¼ŒredisTemplate è¯»å–çš„æ—¶å€™ä¹Ÿä¼šååºåˆ—åŒ–ï¼Œ</strong><u>è€Œåœ¨ <strong>redis å®¢æˆ·ç«¯</strong>set çš„æ—¶å€™å¹¶ä¸ä¼šåšåºåˆ—åŒ–ï¼Œå› æ­¤ set çš„è¿›å»çš„å€¼åœ¨ç”¨ redisTemplate è¯»çš„æ—¶å€™å°±ä¼šæŠ¥ç±»å‹è½¬æ¢å¼‚å¸¸äº†</u></p><p>â€”-è§£å†³æ–¹æ¡ˆ : æœ€ç®€å•çš„å°±æ˜¯<strong>ç”¨ç¨‹åº</strong>é‡æ–° set ä¸€éå³å¯</p><h4 id="9-2-3-4ç¼–å†™æ§åˆ¶å±‚ï¼Œæ¥æ”¶å‰ç«¯æ¶ˆæ¯åè¿›è¡Œrediså­˜å–æ“ä½œ"><a href="#9-2-3-4ç¼–å†™æ§åˆ¶å±‚ï¼Œæ¥æ”¶å‰ç«¯æ¶ˆæ¯åè¿›è¡Œrediså­˜å–æ“ä½œ" class="headerlink" title="9.2.3.4ç¼–å†™æ§åˆ¶å±‚ï¼Œæ¥æ”¶å‰ç«¯æ¶ˆæ¯åè¿›è¡Œrediså­˜å–æ“ä½œ"></a>9.2.3.4ç¼–å†™æ§åˆ¶å±‚ï¼Œæ¥æ”¶å‰ç«¯æ¶ˆæ¯åè¿›è¡Œrediså­˜å–æ“ä½œ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è£…é…RedisTemplate</span></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™æ–¹æ³•,æ¼”ç¤ºå¦‚ä½•æ“ä½œlist,hash,set,zset</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/t2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">t2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//list-å­˜</span></span><br><span class="line">    redisTemplate.opsForList().leftPush(<span class="string">&quot;books&quot;</span>, <span class="string">&quot;ç¬‘å‚²æ±Ÿæ¹–&quot;</span>);</span><br><span class="line">    redisTemplate.opsForList().leftPush(<span class="string">&quot;books&quot;</span>, <span class="string">&quot;hello,java&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//list-å–å‡º</span></span><br><span class="line">    <span class="type">List</span> <span class="variable">books</span> <span class="operator">=</span> redisTemplate.opsForList().range(<span class="string">&quot;books&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">booksList</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (Object book : books) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book--&gt;&quot;</span> + book.toString());</span><br><span class="line">        booksList += book.toString() + <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//hash</span></span><br><span class="line">    <span class="comment">//redisTemplate.opsForHash()</span></span><br><span class="line">    <span class="comment">//set</span></span><br><span class="line">    <span class="comment">//redisTemplate.opsForSet()</span></span><br><span class="line">    <span class="comment">//zset</span></span><br><span class="line">    <span class="comment">//redisTemplate.opsForZSet()</span></span><br><span class="line">    <span class="keyword">return</span> booksList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>RedisTemplateå·¥å…·ç±»çš„ä½¿ç”¨ï¼š</p><table><thead><tr><th align="center"><strong>API</strong></th><th align="center"><strong>è¿”å›å€¼ç±»å‹</strong></th><th align="center"><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td align="center"><strong>redisTemplate</strong>.opsForValue()</td><td align="center">ValueOperations</td><td align="center">æ“ä½œStringç±»å‹æ•°æ®</td></tr><tr><td align="center"><strong>redisTemplate</strong>.opsForHash()</td><td align="center">HashOperations</td><td align="center">æ“ä½œHashç±»å‹æ•°æ®</td></tr><tr><td align="center"><strong>redisTemplate</strong>.opsForList()</td><td align="center">ListOperations</td><td align="center">æ“ä½œListç±»å‹æ•°æ®</td></tr><tr><td align="center"><strong>redisTemplate</strong>.opsForSet()</td><td align="center">SetOperations</td><td align="center">æ“ä½œSetç±»å‹æ•°æ®</td></tr><tr><td align="center"><strong>redisTemplate</strong>.opsForZSet()</td><td align="center">ZSetOperations</td><td align="center">æ“ä½œSortedSetç±»å‹æ•°æ®</td></tr><tr><td align="center"><strong>redisTemplate</strong></td><td align="center"></td><td align="center">é€šç”¨çš„å‘½ä»¤</td></tr></tbody></table><h1 id="10-Redis-æŒä¹…åŒ–-RDB-è®°å½•æ•°æ®"><a href="#10-Redis-æŒä¹…åŒ–-RDB-è®°å½•æ•°æ®" class="headerlink" title="10 Redis æŒä¹…åŒ–-RDB(è®°å½•æ•°æ®)"></a>10 Redis æŒä¹…åŒ–-RDB(è®°å½•æ•°æ®)</h1><h2 id="10-1-å®˜æ–¹èµ„æ–™"><a href="#10-1-å®˜æ–¹èµ„æ–™" class="headerlink" title="10.1 å®˜æ–¹èµ„æ–™"></a>10.1 å®˜æ–¹èµ„æ–™</h2><h3 id="10-1-1-åœ¨çº¿æ–‡æ¡£-https-redis-io-topics-persistence"><a href="#10-1-1-åœ¨çº¿æ–‡æ¡£-https-redis-io-topics-persistence" class="headerlink" title="10.1.1 åœ¨çº¿æ–‡æ¡£ : https://redis.io/topics/persistence"></a>10.1.1 åœ¨çº¿æ–‡æ¡£ : <a href="https://redis.io/topics/persistence">https://redis.io/topics/persistence</a></h3><h2 id="10-2-æŒä¹…åŒ–æ–¹æ¡ˆ"><a href="#10-2-æŒä¹…åŒ–æ–¹æ¡ˆ" class="headerlink" title="10.2 æŒä¹…åŒ–æ–¹æ¡ˆ"></a>10.2 æŒä¹…åŒ–æ–¹æ¡ˆ</h2><h3 id="10-2-1-RDBï¼ˆRedis-DataBaseï¼‰"><a href="#10-2-1-RDBï¼ˆRedis-DataBaseï¼‰" class="headerlink" title="10.2.1 RDBï¼ˆRedis DataBaseï¼‰"></a>10.2.1 RDBï¼ˆRedis DataBaseï¼‰</h3><h3 id="10-2-2-AOFï¼ˆAppend-Of-Fileï¼‰"><a href="#10-2-2-AOFï¼ˆAppend-Of-Fileï¼‰" class="headerlink" title="10.2.2 AOFï¼ˆAppend Of Fileï¼‰"></a>10.2.2 AOFï¼ˆAppend Of Fileï¼‰</h3><h2 id="10-3-RDB-æ˜¯ä»€ä¹ˆ"><a href="#10-3-RDB-æ˜¯ä»€ä¹ˆ" class="headerlink" title="10.3 RDB æ˜¯ä»€ä¹ˆ?"></a>10.3 RDB æ˜¯ä»€ä¹ˆ?</h2><h3 id="10-3-1-åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œ-ä¹Ÿå°±-Snapshot-å¿«ç…§ï¼Œ-æ¢å¤æ—¶å°†å¿«ç…§æ–‡ä»¶è¯»åˆ°å†…å­˜"><a href="#10-3-1-åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œ-ä¹Ÿå°±-Snapshot-å¿«ç…§ï¼Œ-æ¢å¤æ—¶å°†å¿«ç…§æ–‡ä»¶è¯»åˆ°å†…å­˜" class="headerlink" title="10.3.1 åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œ ä¹Ÿå°± Snapshot å¿«ç…§ï¼Œ æ¢å¤æ—¶å°†å¿«ç…§æ–‡ä»¶è¯»åˆ°å†…å­˜"></a>10.3.1 åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…<u>å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜</u>ï¼Œ ä¹Ÿå°± Snapshot å¿«ç…§ï¼Œ æ¢å¤æ—¶å°†å¿«ç…§æ–‡ä»¶è¯»åˆ°å†…å­˜</h3><h2 id="10-4-RDB-æŒä¹…åŒ–æµç¨‹"><a href="#10-4-RDB-æŒä¹…åŒ–æµç¨‹" class="headerlink" title="10.4 RDB æŒä¹…åŒ–æµç¨‹"></a>10.4 RDB æŒä¹…åŒ–æµç¨‹</h2><h3 id="10-4-1-RDB-åŠå…¶æ‰§è¡Œæµç¨‹"><a href="#10-4-1-RDB-åŠå…¶æ‰§è¡Œæµç¨‹" class="headerlink" title="10.4.1 RDB åŠå…¶æ‰§è¡Œæµç¨‹"></a>10.4.1 RDB åŠå…¶æ‰§è¡Œæµç¨‹</h3><h4 id="1ã€-ä¸€å›¾èƒœåƒè¨€"><a href="#1ã€-ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="1ã€ ä¸€å›¾èƒœåƒè¨€"></a>1ã€ ä¸€å›¾èƒœåƒè¨€</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729092028338.png" alt="image-20230729092028338"></p><h4 id="2ã€å¯¹ä¸Šå›¾çš„è§£è¯»"><a href="#2ã€å¯¹ä¸Šå›¾çš„è§£è¯»" class="headerlink" title="2ã€å¯¹ä¸Šå›¾çš„è§£è¯»"></a>2ã€å¯¹ä¸Šå›¾çš„è§£è¯»</h4><p>â€‹å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><pre><code>1) redis å®¢æˆ·ç«¯æ‰§è¡Œ bgsave å‘½ä»¤æˆ–è€…è‡ªåŠ¨è§¦å‘ bgsave å‘½ä»¤ï¼›2) ä¸»è¿›ç¨‹åˆ¤æ–­å½“å‰æ˜¯å¦å·²ç»å­˜åœ¨æ­£åœ¨æ‰§è¡Œçš„å­è¿›ç¨‹ï¼Œå¦‚æœå­˜åœ¨ï¼Œé‚£ä¹ˆä¸»è¿›ç¨‹ç›´æ¥è¿”å›ï¼›3) å¦‚æœä¸å­˜åœ¨æ­£åœ¨æ‰§è¡Œçš„å­è¿›ç¨‹ï¼Œé‚£ä¹ˆå°± **fork ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹è¿›è¡ŒæŒä¹…åŒ–æ•°æ®**ï¼Œfork è¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œfork æ“ä½œå®Œæˆåä¸»è¿›ç¨‹å³å¯æ‰§è¡Œå…¶ä»–æ“ä½œï¼›4) å­è¿›ç¨‹å…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸´æ—¶çš„ rdb æ–‡ä»¶ä¸­ï¼Œ**å¾…å¿«ç…§æ•°æ®å†™å…¥å®Œæˆåå†åŸå­æ›¿æ¢**æ—§çš„ rdbæ–‡ä»¶</code></pre><ol start="5"><li>åŒæ—¶å‘é€ä¿¡å·ç»™ä¸»è¿›ç¨‹ï¼Œé€šçŸ¥ä¸»è¿›ç¨‹ rdb æŒä¹…åŒ–å®Œæˆï¼Œä¸»è¿›ç¨‹æ›´æ–°ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯</li></ol><h4 id="3ã€è€å¸ˆå°ç»“"><a href="#3ã€è€å¸ˆå°ç»“" class="headerlink" title="3ã€è€å¸ˆå°ç»“"></a>3ã€è€å¸ˆå°ç»“</h4><ol><li>æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½• IO æ“ä½œçš„(äº¤ç»™å­è¿›ç¨‹)ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½</li><li>å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤, ä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£ RDB æ–¹å¼è¦æ¯” AOF æ–¹å¼æ›´åŠ çš„é«˜æ•ˆ</li><li>RDB çš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±(æœ€åä¸€æ¬¡æŒä¹…åŒ–æœŸé—´è¿›æ¥çš„æ•°æ®ä¸ä¼šè¢«è®°å½•åˆ°rdbæ–‡ä»¶ä¸­)</li></ol><ul><li>å¦‚æœä½ æ˜¯æ­£å¸¸å…³é—­ Redis , å…³é—­æ—¶ä¼šå†è¿›è¡Œä¸€æ¬¡æŒä¹…åŒ–, ä¸ä¼šé€ æˆæ•°æ®ä¸¢å¤±</li><li>å¦‚æœæ˜¯ Redis å¼‚å¸¸ç»ˆæ­¢&#x2F;å®•æœº, å°±å¯èƒ½é€ æˆæ•°æ®ä¸¢å¤±</li><li>åé¢åœ¨è®²è§£å¿«ç…§é…ç½® , è¿˜ä¼šä¸¾ä¾‹è¯´æ˜</li></ul><h3 id="10-4-2-Fork-amp-Copy-On-Write"><a href="#10-4-2-Fork-amp-Copy-On-Write" class="headerlink" title="10.4.2 Fork&amp;Copy-On-Write"></a>10.4.2 Fork&amp;Copy-On-Write</h3><p>1ã€ Fork çš„ä½œç”¨æ˜¯å¤åˆ¶ä¸€ä¸ªä¸å½“å‰è¿›ç¨‹ä¸€æ ·çš„è¿›ç¨‹ã€‚ æ–°è¿›ç¨‹çš„æ‰€æœ‰æ•°æ®(å˜é‡ã€ ç¯å¢ƒå˜é‡ã€ç¨‹åºè®¡æ•°å™¨ç­‰) æ•°å€¼éƒ½å’ŒåŸè¿›ç¨‹ä¸€è‡´ï¼Œ ä½†æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ï¼Œ å¹¶ä½œä¸ºåŸè¿›ç¨‹çš„å­è¿›ç¨‹</p><p>â€”â€”å¯¹è¿›ç¨‹è¿›è¡Œæ·±æ‹·è´ï¼Œå¹¶å°†ç»“æœä½œä¸ºåŸè¿›ç¨‹çš„å­è¿›ç¨‹</p><p>2ã€ åœ¨ Linux ç¨‹åºä¸­ï¼Œ fork()ä¼šäº§ç”Ÿä¸€ä¸ªå’Œçˆ¶è¿›ç¨‹å®Œå…¨ç›¸åŒçš„å­è¿›ç¨‹ï¼Œ ä½†å­è¿›ç¨‹åœ¨æ­¤åå¤šä¼šexec ç³»ç»Ÿè°ƒç”¨ï¼Œ å‡ºäºæ•ˆç‡è€ƒè™‘ï¼Œ Linux ä¸­å¼•å…¥äº†â€å†™æ—¶å¤åˆ¶æŠ€æœ¯ å³: copy-on-writeâ€ , æœ‰å…´è¶£çš„å‚è€ƒ: <a href="https://blog.csdn.net/Code_beeps/article/details/92838520">https://blog.csdn.net/Code_beeps/article/details/92838520</a></p><p>3ã€ ä¸€èˆ¬æƒ…å†µçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¼šå…±ç”¨åŒä¸€æ®µç‰©ç†å†…å­˜ï¼Œ åªæœ‰è¿›ç¨‹ç©ºé—´çš„å„æ®µçš„å†…å®¹è¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ æ‰ä¼šå°†çˆ¶è¿›ç¨‹çš„å†…å®¹å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ã€‚</p><h2 id="10-5-RDB-é…ç½®"><a href="#10-5-RDB-é…ç½®" class="headerlink" title="10.5 RDB é…ç½®"></a>10.5 RDB é…ç½®</h2><h3 id="10-5-1-dump-rdb-æ–‡ä»¶"><a href="#10-5-1-dump-rdb-æ–‡ä»¶" class="headerlink" title="10.5.1 dump.rdb æ–‡ä»¶"></a>10.5.1 dump.rdb æ–‡ä»¶</h3><h4 id="10-5-1-1-ä»‹ç»"><a href="#10-5-1-1-ä»‹ç»" class="headerlink" title="10.5.1.1 ä»‹ç»"></a>10.5.1.1 ä»‹ç»</h4><p>â€‹åœ¨ redis.conf ä¸­é…ç½®æ–‡ä»¶åç§°, é»˜è®¤ä¸º dump.rdb</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729093257075.png" alt="image-20230729093257075" style="zoom:50%;" /><h4 id="10-5-1-2-å¦‚ä½•é…ç½®"><a href="#10-5-1-2-å¦‚ä½•é…ç½®" class="headerlink" title="10.5.1.2 å¦‚ä½•é…ç½®"></a>10.5.1.2 å¦‚ä½•é…ç½®</h4><h4 id="1ã€-é»˜è®¤ä¸º-Redis-å¯åŠ¨æ—¶å‘½ä»¤è¡Œæ‰€åœ¨çš„ç›®å½•ä¸‹"><a href="#1ã€-é»˜è®¤ä¸º-Redis-å¯åŠ¨æ—¶å‘½ä»¤è¡Œæ‰€åœ¨çš„ç›®å½•ä¸‹" class="headerlink" title="1ã€ é»˜è®¤ä¸º Redis å¯åŠ¨æ—¶å‘½ä»¤è¡Œæ‰€åœ¨çš„ç›®å½•ä¸‹"></a>1ã€ é»˜è®¤ä¸º Redis å¯åŠ¨æ—¶å‘½ä»¤è¡Œæ‰€åœ¨çš„ç›®å½•ä¸‹</h4><p>â€‹1) å¦‚å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729094325579.png" alt="image-20230729094325579"></p><p>è¯´æ˜ï¼šdump.rdbæ–‡ä»¶å­˜æ”¾ç€redisä¸­çš„æ•°æ®ï¼Œä½ æ¯æ¬¡å¯åŠ¨ï¼Œéƒ½ä¼šåˆ°ä½ è®¾å®šçš„è·¯å¾„ä¸‹çš„ dump.rdb ä¸­å¯»æ‰¾æ•°æ®ï¼Œå¦‚æœæ­¤å¤„è®¾ç½®çš„<strong>ä¸æ˜¯ç»å¯¹è·¯å¾„è€Œæ˜¯ç›¸å¯¹è·¯å¾„</strong>ï¼Œé‚£ä¹ˆä½ åœ¨ä¸åŒçš„ç›®å½•ä¸‹å¯åŠ¨redisæ—¶ï¼Œå°±ä¼šå»ä¸åŒçš„åœ°æ–¹å¯»æ‰¾å¤‡ä»½çš„æ•°æ®ï¼Œå³åœ¨ä¸åŒç›®å½•ä¸‹å¯åŠ¨å¾—åˆ°çš„å¤‡ä»½æ•°æ®æºä¸åŒï¼</p><h3 id="10-5-2-ç›¸å…³é…ç½®-amp-å‚æ•°-amp-æ“ä½œ"><a href="#10-5-2-ç›¸å…³é…ç½®-amp-å‚æ•°-amp-æ“ä½œ" class="headerlink" title="10.5.2 ç›¸å…³é…ç½®&amp;å‚æ•°&amp;æ“ä½œ"></a>10.5.2 ç›¸å…³é…ç½®&amp;å‚æ•°&amp;æ“ä½œ</h3><h4 id="10-5-2-1-é»˜è®¤å¿«ç…§é…ç½®"><a href="#10-5-2-1-é»˜è®¤å¿«ç…§é…ç½®" class="headerlink" title="10.5.2.1 é»˜è®¤å¿«ç…§é…ç½®"></a>10.5.2.1 é»˜è®¤å¿«ç…§é…ç½®</h4><h5 id="1ã€-é…ç½®å¦‚å›¾"><a href="#1ã€-é…ç½®å¦‚å›¾" class="headerlink" title="1ã€ é…ç½®å¦‚å›¾"></a>1ã€ é…ç½®å¦‚å›¾</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729095330539.png" alt="image-20230729095330539"></p><h5 id="2ã€æ³¨æ„ç†è§£è¿™ä¸ªæ—¶é—´æ®µçš„æ¦‚å¿µ"><a href="#2ã€æ³¨æ„ç†è§£è¿™ä¸ªæ—¶é—´æ®µçš„æ¦‚å¿µ" class="headerlink" title="2ã€æ³¨æ„ç†è§£è¿™ä¸ªæ—¶é—´æ®µçš„æ¦‚å¿µ"></a>2ã€æ³¨æ„ç†è§£è¿™ä¸ªæ—¶é—´æ®µçš„æ¦‚å¿µ</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729095537814.png" alt="image-20230729095537814"></p><h5 id="3ã€å¦‚æœæˆ‘ä»¬æ²¡æœ‰å¼€å¯-save-çš„æ³¨é‡Š-é‚£ä¹ˆåœ¨é€€å‡º-Redis-æ—¶-ä¹Ÿä¼šè¿›è¡Œå¤‡ä»½-æ›´æ–°-dump-db"><a href="#3ã€å¦‚æœæˆ‘ä»¬æ²¡æœ‰å¼€å¯-save-çš„æ³¨é‡Š-é‚£ä¹ˆåœ¨é€€å‡º-Redis-æ—¶-ä¹Ÿä¼šè¿›è¡Œå¤‡ä»½-æ›´æ–°-dump-db" class="headerlink" title="3ã€å¦‚æœæˆ‘ä»¬æ²¡æœ‰å¼€å¯ save çš„æ³¨é‡Š, é‚£ä¹ˆåœ¨é€€å‡º Redis æ—¶, ä¹Ÿä¼šè¿›è¡Œå¤‡ä»½, æ›´æ–° dump.db"></a>3ã€å¦‚æœæˆ‘ä»¬æ²¡æœ‰å¼€å¯ save çš„æ³¨é‡Š, é‚£ä¹ˆåœ¨é€€å‡º Redis æ—¶, ä¹Ÿä¼šè¿›è¡Œå¤‡ä»½, æ›´æ–° dump.db</h5><h4 id="10-5-2-2-save-VS-bgsave"><a href="#10-5-2-2-save-VS-bgsave" class="headerlink" title="10.5.2.2 save VS bgsave"></a>10.5.2.2 save VS bgsave</h4><p>1ã€ save ï¼š save æ—¶åªç®¡ä¿å­˜ï¼Œ å…¶å®ƒä¸ç®¡ï¼Œ å…¨éƒ¨é˜»å¡ã€‚ æ‰‹åŠ¨ä¿å­˜, <strong>ä¸å»ºè®®</strong>ã€‚</p><p>2ã€ bgsaveï¼š <u>Redis ä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œ å¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚</u></p><p>3ã€ å¯ä»¥é€šè¿‡ lastsave å‘½ä»¤è·å–æœ€åä¸€æ¬¡æˆåŠŸæ‰§è¡Œå¿«ç…§çš„æ—¶é—´(<strong>unix æ—¶é—´æˆ³</strong>) , å¯ä»¥ä½¿ç”¨å·¥å…·è½¬æ¢</p><p><a href="https://tool.lu/timestamp/">https://tool.lu/timestamp/</a></p><h4 id="10-5-2-3-flushall"><a href="#10-5-2-3-flushall" class="headerlink" title="10.5.2.3 flushall"></a>10.5.2.3 flushall</h4><p>1ã€æ‰§è¡Œ flushall å‘½ä»¤ï¼Œ ä¹Ÿä¼šäº§ç”Ÿ dump.rdb æ–‡ä»¶, æ•°æ®ä¸ºç©º</p><p>2ã€Redis Flushall å‘½ä»¤ç”¨äº<strong>æ¸…ç©ºæ•´ä¸ª Redis æœåŠ¡å™¨çš„æ•°æ®(åˆ é™¤æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰ key)</strong></p><p>10.5.2.4 Save</p><p>1ã€ æ ¼å¼ï¼š save ç§’é’Ÿ å†™æ“ä½œæ¬¡æ•°, å¦‚å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729100520528.png" alt="image-20230729100520528"></p><p>2ã€RDB æ˜¯æ•´ä¸ªå†…å­˜çš„å‹ç¼©è¿‡çš„ Snapshotï¼ŒRDB çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é…ç½®å¤åˆçš„å¿«ç…§è§¦å‘æ¡ä»¶(å³é…åˆsave)</p><p>3ã€ç¦ç”¨: ç»™ save ä¼ å…¥ç©ºå­—ç¬¦ä¸², å¯ä»¥çœ‹æ–‡æ¡£</p><h4 id="10-5-2-5-stop-writes-on-bgsave-error"><a href="#10-5-2-5-stop-writes-on-bgsave-error" class="headerlink" title="10.5.2.5 stop-writes-on-bgsave-error"></a>10.5.2.5 stop-writes-on-bgsave-error</h4><p>1ã€ é…ç½®å¦‚å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729100830128.png" alt="image-20230729100830128"></p><p>2ã€å½“ Redis æ— æ³•å†™å…¥ç£ç›˜çš„è¯(æ¯”å¦‚ç£ç›˜æ»¡äº†), ç›´æ¥å…³æ‰ Redis çš„å†™æ“ä½œã€‚æ¨è yes</p><h4 id="10-5-2-6-rdbcompression"><a href="#10-5-2-6-rdbcompression" class="headerlink" title="10.5.2.6 rdbcompression"></a>10.5.2.6 rdbcompression</h4><p>1ã€ é…ç½®å¦‚å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729100916375.png" alt="image-20230729100916375"></p><p>2ã€å¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œredis ä¼šé‡‡ç”¨LZF ç®—æ³•è¿›è¡Œå‹ç¼©ã€‚</p><p>3ã€å¦‚æœä½ ä¸æƒ³æ¶ˆè€— CPU æ¥è¿›è¡Œå‹ç¼©çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…³é—­æ­¤åŠŸèƒ½, é»˜è®¤ yes</p><h4 id="10-5-2-7-rdbchecksum"><a href="#10-5-2-7-rdbchecksum" class="headerlink" title="10.5.2.7 rdbchecksum"></a>10.5.2.7 rdbchecksum</h4><p>1ã€ é…ç½®å¦‚å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729101019969.png" alt="image-20230729101019969"></p><p>2ã€åœ¨å­˜å‚¨å¿«ç…§å, è¿˜å¯ä»¥è®© redis ä½¿ç”¨ CRC64 ç®—æ³•æ¥è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œä¿è¯æ–‡ä»¶æ˜¯å®Œæ•´çš„</p><p>3ã€ä½†æ˜¯è¿™æ ·åšä¼šå¢åŠ å¤§çº¦ 10%çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¦‚æœ<strong>å¸Œæœ›è·å–åˆ°æœ€å¤§çš„æ€§èƒ½æå‡ï¼Œå¯ä»¥å…³é—­æ­¤åŠŸèƒ½</strong>, æ¨è yes</p><h4 id="10-5-2-8-åŠ¨æ€åœæ­¢-RDB"><a href="#10-5-2-8-åŠ¨æ€åœæ­¢-RDB" class="headerlink" title="10.5.2.8 åŠ¨æ€åœæ­¢ RDB"></a>10.5.2.8 åŠ¨æ€åœæ­¢ RDB</h4><p>1ã€ åŠ¨æ€åœæ­¢ RDBï¼š redis-cli <strong>config set save â€œâ€</strong></p><p>2ã€è¯´æ˜: <strong>save åç»™ç©ºå€¼ï¼Œè¡¨ç¤ºç¦ç”¨ä¿å­˜ç­–ç•¥</strong></p><h3 id="10-5-3-å®ä¾‹æ¼”ç¤º"><a href="#10-5-3-å®ä¾‹æ¼”ç¤º" class="headerlink" title="10.5.3 å®ä¾‹æ¼”ç¤º"></a>10.5.3 å®ä¾‹æ¼”ç¤º</h3><p>1ã€ éœ€æ±‚: å¦‚æœ Redis çš„ key åœ¨ 30 ç§’å†…, æœ‰ 5 ä¸ª key å˜åŒ–, å°±è‡ªåŠ¨è¿›è¡Œ RDB å¤‡ä»½</p><p>ä¿®æ”¹redis.confä¸­çš„ save 30 5</p><h2 id="10-6-RDB-å¤‡ä»½-amp-æ¢å¤"><a href="#10-6-RDB-å¤‡ä»½-amp-æ¢å¤" class="headerlink" title="10.6 RDB å¤‡ä»½&amp;æ¢å¤"></a>10.6 RDB å¤‡ä»½&amp;æ¢å¤</h2><p>1ã€ å…³äº RDB å¤‡ä»½&amp;æ¢å¤, è€éŸ©è¦è¯´çš„</p><ul><li>è€éŸ©å…ˆè¯´æ˜ï¼šRedis å¯ä»¥å……å½“ç¼“å­˜, å¯¹é¡¹ç›®è¿›è¡Œä¼˜åŒ–, å› æ­¤<strong>é‡è¦&#x2F;æ•æ„Ÿçš„æ•°æ®å»ºè®®åœ¨ Mysqlè¦ä¿å­˜ä¸€ä»½</strong></li><li>ä»è®¾è®¡å±‚é¢æ¥è¯´, Redis çš„å†…å­˜æ•°æ®, éƒ½æ˜¯å¯ä»¥é‡æ–°è·å–çš„(å¯èƒ½æ¥è‡ªç¨‹åº, ä¹Ÿå¯èƒ½æ¥è‡ªMysql)</li><li>å› æ­¤æˆ‘ä»¬è¿™é‡Œè¯´çš„å¤‡ä»½&amp;æ¢å¤ä¸»è¦æ˜¯ç»™å¤§å®¶è¯´æ˜ä¸€ä¸‹ <strong>Redis å¯åŠ¨æ—¶, åˆå§‹åŒ–æ•°æ®æ˜¯ä»dump.rdb æ¥çš„, è¿™ä¸ªæœºåˆ¶</strong></li></ul><ol><li><p>config get dir æŸ¥è¯¢ rdb æ–‡ä»¶çš„ç›®å½•</p></li><li><p><strong>å°† dump.rdb è¿›è¡Œå¤‡ä»½</strong>, å¦‚æœæœ‰å¿…è¦å¯ä»¥å†™ shell è„šæœ¬æ¥å®šæ—¶å¤‡ä»½ [å‚è€ƒ Linux è¯¾ç¨‹ å®šæ—¶å¤‡ä»½ Mysql æ•°æ®åº“, è§†é¢‘åœ°å€ <a href="https://www.bilibili.com/video/BV1Sv411r7vd?p=105">https://www.bilibili.com/video/BV1Sv411r7vd?p=105</a> ] , è¿™é‡Œè€å¸ˆç®€å•å¤„ç†</p></li></ol><h2 id="10-7-RDB-æŒä¹…åŒ–å°ç»“"><a href="#10-7-RDB-æŒä¹…åŒ–å°ç»“" class="headerlink" title="10.7 RDB æŒä¹…åŒ–å°ç»“"></a>10.7 RDB æŒä¹…åŒ–å°ç»“</h2><h3 id="10-7-1-ä¼˜åŠ¿"><a href="#10-7-1-ä¼˜åŠ¿" class="headerlink" title="10.7.1 ä¼˜åŠ¿"></a>10.7.1 ä¼˜åŠ¿</h3><p>1ã€ é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤</p><p>2ã€å¯¹æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§è¦æ±‚ä¸é«˜æ›´é€‚åˆä½¿ç”¨</p><p>3ã€èŠ‚çœç£ç›˜ç©ºé—´</p><p>4ã€æ¢å¤é€Ÿåº¦å¿«</p><h3 id="10-7-2-åŠ£åŠ¿"><a href="#10-7-2-åŠ£åŠ¿" class="headerlink" title="10.7.2 åŠ£åŠ¿"></a>10.7.2 åŠ£åŠ¿</h3><ol><li><p>è™½ç„¶ Redis åœ¨ fork æ—¶ä½¿ç”¨äº†å†™æ—¶æ‹·è´æŠ€æœ¯(Copy-On-Write), ä½†æ˜¯å¦‚æœæ•°æ®åºå¤§æ—¶è¿˜æ˜¯æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚</p></li><li><p>åœ¨å¤‡ä»½å‘¨æœŸåœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡å¤‡ä»½ï¼Œ æ‰€ä»¥å¦‚æœ Redis æ„å¤– down æ‰çš„è¯(å¦‚æœæ­£å¸¸å…³é—­ Redis, ä»ç„¶ä¼šè¿›è¡Œ RDB å¤‡ä»½, ä¸ä¼šä¸¢å¤±æ•°æ®), å°±ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§åçš„æ‰€æœ‰ä¿®æ”¹</p></li></ol><h1 id="11-Redis-æŒä¹…åŒ–-AOF-è®°å½•æ“ä½œ"><a href="#11-Redis-æŒä¹…åŒ–-AOF-è®°å½•æ“ä½œ" class="headerlink" title="11 Redis æŒä¹…åŒ–-AOF(è®°å½•æ“ä½œ)"></a>11 Redis æŒä¹…åŒ–-AOF(è®°å½•æ“ä½œ)</h1><h2 id="11-1-å®˜æ–¹èµ„æ–™"><a href="#11-1-å®˜æ–¹èµ„æ–™" class="headerlink" title="11.1 å®˜æ–¹èµ„æ–™"></a>11.1 å®˜æ–¹èµ„æ–™</h2><h3 id="11-1-1-åœ¨çº¿æ–‡æ¡£-https-redis-io-topics-persistence"><a href="#11-1-1-åœ¨çº¿æ–‡æ¡£-https-redis-io-topics-persistence" class="headerlink" title="11.1.1 åœ¨çº¿æ–‡æ¡£ : https://redis.io/topics/persistence"></a>11.1.1 åœ¨çº¿æ–‡æ¡£ : <a href="https://redis.io/topics/persistence">https://redis.io/topics/persistence</a></h3><h2 id="11-2-AOF-æ˜¯ä»€ä¹ˆ"><a href="#11-2-AOF-æ˜¯ä»€ä¹ˆ" class="headerlink" title="11.2 AOF æ˜¯ä»€ä¹ˆ?"></a>11.2 AOF æ˜¯ä»€ä¹ˆ?</h2><p>1ã€ AOF(Append Only File)</p><p>2ã€ <u>ä»¥æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œ(å¢é‡ä¿å­˜)</u>ï¼Œ å°† Redis æ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥(æ¯”å¦‚ set&#x2F;del æ“ä½œä¼šè®°å½•, è¯»æ“ä½œ get ä¸è®°å½•) [åé¢æ¼”ç¤º]</p><p>3ã€ <strong>åªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶</strong></p><p>4ã€ redis <strong>å¯åŠ¨ä¹‹åˆä¼šè¯»å–è¯¥æ–‡ä»¶é‡æ–°æ„å»ºæ•°æ®</strong></p><p>5ã€ redis é‡å¯çš„è¯å°±æ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹**<u>å°†å†™æŒ‡ä»¤ä»å‰åˆ°åæ‰§è¡Œä¸€æ¬¡ä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œ</u>**</p><h2 id="11-3-AOF-æŒä¹…åŒ–æµç¨‹"><a href="#11-3-AOF-æŒä¹…åŒ–æµç¨‹" class="headerlink" title="11.3 AOF æŒä¹…åŒ–æµç¨‹"></a>11.3 AOF æŒä¹…åŒ–æµç¨‹</h2><p>1ã€ æŒä¹…åŒ–æµç¨‹ç¤ºæ„å›¾</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230729155117545.png" alt="image-20230729155117545" style="zoom:50%;" /><p>2ã€è§£è¯»</p><ol><li>å®¢æˆ·ç«¯çš„è¯·æ±‚å†™å‘½ä»¤ä¼šè¢« append <strong>è¿½åŠ åˆ° AOF ç¼“å†²åŒº</strong>å†…</li><li>AOF ç¼“å†²åŒºæ ¹æ® AOF æŒä¹…åŒ–ç­–ç•¥[always,everysec,no]å°†æ“ä½œ sync <strong>åŒæ­¥åˆ°ç£ç›˜çš„ AOF æ–‡ä»¶</strong>ä¸­ </li><li>AOF æ–‡ä»¶å¤§å°è¶…è¿‡é‡å†™ç­–ç•¥æˆ–æ‰‹åŠ¨é‡å†™æ—¶ï¼Œä¼šå¯¹ AOF æ–‡ä»¶ <strong>rewrite</strong> é‡å†™ï¼Œå‹ç¼© AOF æ–‡ä»¶å®¹é‡ </li><li>Redis æœåŠ¡<strong>é‡å¯æ—¶ï¼Œä¼šé‡æ–° load åŠ è½½ AOF æ–‡ä»¶ä¸­çš„å†™æ“ä½œè¾¾åˆ°æ•°æ®æ¢å¤çš„ç›®çš„</strong></li></ol><h2 id="11-4-AOF-å¼€å¯"><a href="#11-4-AOF-å¼€å¯" class="headerlink" title="11.4 AOF å¼€å¯"></a>11.4 AOF å¼€å¯</h2><p>1ã€ åœ¨ redis.conf ä¸­é…ç½®æ–‡ä»¶åç§°ï¼Œ é»˜è®¤ä¸º appendonly.aof</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729155850603.png" alt="image-20230729155850603"></p><p>2ã€<u><strong>AOF æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼ŒåŒ RDB çš„è·¯å¾„ä¸€è‡´ã€‚</strong></u></p><p>3ã€AOF å’Œ RDB åŒæ—¶å¼€å¯ï¼Œ<strong>ç³»ç»Ÿé»˜è®¤å– AOF çš„æ•°æ®</strong>ï¼ˆé»˜è®¤AOFä¼˜å…ˆçº§é«˜ï¼Œå¯æ‰‹åŠ¨ä¿®æ”¹ï¼‰</p><p>4ã€å½“å¼€å¯ AOF å, Redis ä» AOF æ–‡ä»¶å–æ•°æ®.</p><h2 id="11-5-AOF-å®ä¾‹æ¼”ç¤º"><a href="#11-5-AOF-å®ä¾‹æ¼”ç¤º" class="headerlink" title="11.5 AOF å®ä¾‹æ¼”ç¤º"></a>11.5 AOF å®ä¾‹æ¼”ç¤º</h2><p>â€¦â€¦â€¦â€¦</p><h2 id="11-6-AOF-å¯åŠ¨-x2F-ä¿®å¤-x2F-æ¢å¤"><a href="#11-6-AOF-å¯åŠ¨-x2F-ä¿®å¤-x2F-æ¢å¤" class="headerlink" title="11.6 AOF å¯åŠ¨&#x2F;ä¿®å¤&#x2F;æ¢å¤"></a>11.6 AOF å¯åŠ¨&#x2F;ä¿®å¤&#x2F;æ¢å¤</h2><h3 id="11-6-1-åŸºæœ¬è¯´æ˜"><a href="#11-6-1-åŸºæœ¬è¯´æ˜" class="headerlink" title="11.6.1 åŸºæœ¬è¯´æ˜"></a>11.6.1 åŸºæœ¬è¯´æ˜</h3><p>â€‹AOF çš„å¤‡ä»½æœºåˆ¶å’Œæ€§èƒ½è™½ç„¶å’Œ RDB ä¸åŒ, ä½†æ˜¯å¤‡ä»½å’Œæ¢å¤çš„æ“ä½œåŒ RDB ä¸€æ ·, <strong>éƒ½æ˜¯æ‹·è´å¤‡ä»½æ–‡ä»¶, éœ€è¦æ¢å¤æ—¶å†æ‹·è´åˆ° Redis å·¥ä½œç›®å½•ä¸‹ï¼Œ å¯åŠ¨ç³»ç»Ÿå³åŠ è½½</strong></p><h3 id="11-6-2-æ­£å¸¸æ¢å¤"><a href="#11-6-2-æ­£å¸¸æ¢å¤" class="headerlink" title="11.6.2 æ­£å¸¸æ¢å¤"></a>11.6.2 æ­£å¸¸æ¢å¤</h3><p>1ã€ ä¿®æ”¹é»˜è®¤çš„ appendonly noï¼Œ æ”¹ä¸º yes</p><p><strong>2ã€å°†æœ‰æ•°æ®çš„ aof æ–‡ä»¶å®šæ—¶å¤‡ä»½, éœ€è¦æ¢å¤æ—¶, å¤åˆ¶ä¸€ä»½ä¿å­˜åˆ°å¯¹åº”ç›®å½•(æŸ¥çœ‹ç›®å½•ï¼šconfig get dir)</strong></p><p>3ã€æ¢å¤ï¼šé‡å¯ redis ç„¶åé‡æ–°åŠ è½½</p><p>4ã€å’Œå‰é¢ RDB å¤‡ä»½&#x2F;æ¢å¤æœºåˆ¶ç±»ä¼¼</p><h3 id="11-6-3-å¼‚å¸¸æ¢å¤"><a href="#11-6-3-å¼‚å¸¸æ¢å¤" class="headerlink" title="11.6.3 å¼‚å¸¸æ¢å¤"></a>11.6.3 å¼‚å¸¸æ¢å¤</h3><p>1ã€ å¦‚é‡åˆ° AOF æ–‡ä»¶æŸåï¼Œ é€šè¿‡ [&#x2F;usr&#x2F;local&#x2F;bin]# .&#x2F;redis-check-aof â€“fix appendonly.aof è¿›è¡Œæ¢å¤</p><p>2ã€å»ºè®®å…ˆ: å¤‡ä»½è¢«å†™åçš„ AOF æ–‡ä»¶</p><p>3ã€æ¢å¤ï¼šé‡å¯ redisï¼Œç„¶åé‡æ–°åŠ è½½</p><h2 id="11-7-åŒæ­¥é¢‘ç‡è®¾ç½®"><a href="#11-7-åŒæ­¥é¢‘ç‡è®¾ç½®" class="headerlink" title="11.7 åŒæ­¥é¢‘ç‡è®¾ç½®"></a>11.7 åŒæ­¥é¢‘ç‡è®¾ç½®</h2><p>1ã€ é…ç½®ä½ç½®</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729161749574.png" alt="image-20230729161749574" style="zoom:50%;" /><p>2ã€è€éŸ©è§£è¯»ä¸Šå›¾</p><p>â€‹1)appendfsync always</p><p>â€‹å§‹ç»ˆåŒæ­¥ï¼Œæ¯æ¬¡ Redis çš„å†™å…¥éƒ½ä¼šç«‹åˆ»è®°å…¥æ—¥å¿—ï¼›æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½</p><p>â€‹2)appendfsync everysec</p><p>â€‹æ¯ç§’åŒæ­¥ï¼Œæ¯ç§’è®°å…¥æ—¥å¿—ä¸€æ¬¡ï¼Œå¦‚æœå®•æœºï¼Œæœ¬ç§’çš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚</p><p>â€‹3)appendfsync noredis </p><p>â€‹ä¸ä¸»åŠ¨è¿›è¡ŒåŒæ­¥ï¼ŒæŠŠåŒæ­¥æ—¶æœºäº¤ç»™æ“ä½œç³»ç»Ÿ</p><p>â€‹<a href="https://baijiahao.baidu.com/s?id=1740774723808931509&wfr=spider&for=pc">https://baijiahao.baidu.com/s?id=1740774723808931509&amp;wfr=spider&amp;for=pc</a></p><h2 id="11-8-Rewrite-å‹ç¼©"><a href="#11-8-Rewrite-å‹ç¼©" class="headerlink" title="11.8 Rewrite å‹ç¼©"></a>11.8 Rewrite å‹ç¼©</h2><h3 id="1ã€-rewrite-é‡å†™ä»‹ç»"><a href="#1ã€-rewrite-é‡å†™ä»‹ç»" class="headerlink" title="1ã€ rewrite é‡å†™ä»‹ç»"></a>1ã€ rewrite é‡å†™ä»‹ç»</h3><pre><code>1) AOF æ–‡ä»¶è¶Šæ¥è¶Šå¤§ï¼Œ**éœ€è¦å®šæœŸå¯¹ AOF æ–‡ä»¶è¿›è¡Œé‡å†™è¾¾åˆ°å‹ç¼©**1) æ—§çš„ AOF æ–‡ä»¶å«æœ‰&lt;u&gt;æ— æ•ˆå‘½ä»¤ä¼šè¢«å¿½ç•¥ï¼Œä¿ç•™æœ€æ–°çš„æ•°æ®å‘½ä»¤&lt;/u&gt; , æ¯”å¦‚ set a a1 ; set a b1 ;set a c1; ä¿ç•™æœ€åä¸€æ¡æŒ‡ä»¤å°±å¯ä»¥äº†1) &lt;u&gt;å¤šæ¡å†™å‘½ä»¤å¯ä»¥åˆå¹¶ä¸ºä¸€ä¸ª , æ¯”å¦‚ set a c1 b b1 c c1&lt;/u&gt;1) AOF é‡å†™é™ä½äº†æ–‡ä»¶å ç”¨ç©ºé—´1) æ›´å°çš„ AOF æ–‡ä»¶å¯ä»¥æ›´å¿«çš„è¢« redis åŠ è½½</code></pre><h3 id="2ã€é‡å†™è§¦å‘é…ç½®"><a href="#2ã€é‡å†™è§¦å‘é…ç½®" class="headerlink" title="2ã€é‡å†™è§¦å‘é…ç½®"></a>2ã€é‡å†™è§¦å‘é…ç½®</h3><p>â€‹1) æ‰‹åŠ¨è§¦å‘ç›´æ¥è°ƒç”¨ bgrewriteaof å‘½ä»¤</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729162232144.png" alt="image-20230729162232144" style="zoom:50%;" /><p>â€‹2ï¼‰è‡ªåŠ¨è§¦å‘</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729162701336.png" alt="image-20230729162701336"></p><ul><li><strong>auto-aof-rewrite-min-size: AOF æ–‡ä»¶æœ€å°é‡å†™å¤§å°</strong>, åªæœ‰å½“ AOF æ–‡ä»¶å¤§å°å¤§äºè¯¥å€¼æ—¶å€™æ‰èƒ½é‡å†™, é»˜è®¤é…ç½® 64MB</li><li>auto-aof-rewrite-percentage: å½“å‰ AOF æ–‡ä»¶å¤§å°å’Œæœ€åä¸€æ¬¡é‡å†™åçš„å¤§å°ä¹‹é—´çš„æ¯”ç‡ç­‰äºæˆ–è€…å¤§äºæŒ‡å®šçš„å¢é•¿ç™¾åˆ†æ¯”ï¼Œå¦‚ 100 ä»£è¡¨å½“å‰ AOF æ–‡ä»¶æ˜¯ä¸Šæ¬¡é‡å†™çš„ä¸¤å€æ—¶å€™æ‰é‡å†™</li></ul><p>ç³»ç»Ÿè½½å…¥æ—¶æˆ–è€…ä¸Šæ¬¡é‡å†™å®Œæ¯•æ—¶ï¼ŒRedis ä¼šè®°å½•æ­¤æ—¶ AOF å¤§å°ï¼Œè®¾ä¸ºbase_size, å¦‚æœ Redis çš„ AOF å½“å‰å¤§å°&gt;&#x3D; base_size +base_size*100% (é»˜è®¤)ä¸”å½“å‰å¤§å°&gt;&#x3D;64mb(é»˜è®¤)çš„æƒ…å†µä¸‹ï¼ŒRedis ä¼šå¯¹ AOF è¿›è¡Œé‡å†™</p><h2 id="11-9-AOF-æŒä¹…åŒ–å°ç»“"><a href="#11-9-AOF-æŒä¹…åŒ–å°ç»“" class="headerlink" title="11.9 AOF æŒä¹…åŒ–å°ç»“"></a>11.9 AOF æŒä¹…åŒ–å°ç»“</h2><h3 id="11-9-1-ä¼˜åŠ¿"><a href="#11-9-1-ä¼˜åŠ¿" class="headerlink" title="11.9.1 ä¼˜åŠ¿"></a>11.9.1 ä¼˜åŠ¿</h3><p>1ã€ å¤‡ä»½æœºåˆ¶æ›´ç¨³å¥ï¼Œ ä¸¢å¤±æ•°æ®æ¦‚ç‡æ›´ä½ã€‚</p><p>2ã€å¯è¯»çš„æ—¥å¿—æ–‡æœ¬ï¼Œé€šè¿‡æ“ä½œ AOF ç¨³å¥ï¼Œå¯ä»¥å¤„ç†è¯¯æ“ä½œ</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729175239380.png" alt="image-20230729175239380" style="zoom:50%;" /><h3 id="11-9-2-åŠ£åŠ¿"><a href="#11-9-2-åŠ£åŠ¿" class="headerlink" title="11.9.2 åŠ£åŠ¿"></a>11.9.2 åŠ£åŠ¿</h3><p>1ã€ æ¯”èµ· RDB å ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´</p><p>2ã€æ¢å¤å¤‡ä»½é€Ÿåº¦è¦æ…¢</p><p>3ã€æ¯æ¬¡è¯»å†™éƒ½åŒæ­¥çš„è¯ï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½å‹åŠ›</p><h2 id="11-10-RDB-è¿˜æ˜¯-AOF"><a href="#11-10-RDB-è¿˜æ˜¯-AOF" class="headerlink" title="11.10 RDB è¿˜æ˜¯ AOF?"></a>11.10 RDB è¿˜æ˜¯ AOF?</h2><p>1ã€ å®˜æ–¹æ–‡æ¡£åœ°å€: <a href="https://redis.io/topics/persistence">https://redis.io/topics/persistence</a></p><p>2ã€<strong>å®˜æ–¹æ¨èä¸¤ä¸ªéƒ½å¯ç”¨</strong></p><p>3ã€å¦‚æœåªåšç¼“å­˜ï¼šå¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨, ä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼</p><h1 id="12-Redisäº‹åŠ¡-é”æœºåˆ¶-ç§’æ€"><a href="#12-Redisäº‹åŠ¡-é”æœºåˆ¶-ç§’æ€" class="headerlink" title="12 Redisäº‹åŠ¡_ é”æœºåˆ¶ _ç§’æ€"></a>12 Redisäº‹åŠ¡_ é”æœºåˆ¶ _ç§’æ€</h1><h2 id="12-1-Redis-çš„äº‹åŠ¡æ˜¯ä»€ä¹ˆ"><a href="#12-1-Redis-çš„äº‹åŠ¡æ˜¯ä»€ä¹ˆ" class="headerlink" title="12.1 Redis çš„äº‹åŠ¡æ˜¯ä»€ä¹ˆ?"></a>12.1 Redis çš„äº‹åŠ¡æ˜¯ä»€ä¹ˆ?</h2><p>â€‹1ã€ Redis äº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼š äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€ æŒ‰é¡ºåºåœ°æ‰§è¡Œ</p><p>â€‹2ã€äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­</p><p>â€‹3ã€Redis äº‹åŠ¡çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¸²è”å¤šä¸ªå‘½ä»¤é˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿ</p><h2 id="12-2-Redis-äº‹åŠ¡ä¸‰ç‰¹æ€§"><a href="#12-2-Redis-äº‹åŠ¡ä¸‰ç‰¹æ€§" class="headerlink" title="12.2 Redis äº‹åŠ¡ä¸‰ç‰¹æ€§"></a>12.2 Redis äº‹åŠ¡ä¸‰ç‰¹æ€§</h2><h3 id="12-2-1-å•ç‹¬çš„éš”ç¦»æ“ä½œ"><a href="#12-2-1-å•ç‹¬çš„éš”ç¦»æ“ä½œ" class="headerlink" title="12.2.1 å•ç‹¬çš„éš”ç¦»æ“ä½œ"></a>12.2.1 å•ç‹¬çš„éš”ç¦»æ“ä½œ</h3><p>â€‹1ã€ äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼š<u>åºåˆ—åŒ–ã€ æŒ‰é¡ºåºåœ°æ‰§è¡Œ</u></p><p>â€‹2ã€ äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œ <u>ä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­</u></p><h3 id="12-2-2-æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ"><a href="#12-2-2-æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ" class="headerlink" title="12.2.2 æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ"></a>12.2.2 æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ</h3><p>â€‹é˜Ÿåˆ—ä¸­çš„å‘½ä»¤(æŒ‡ä»¤), <strong>åœ¨æ²¡æœ‰æäº¤å‰éƒ½ä¸ä¼šå®é™…è¢«æ‰§è¡Œ</strong></p><h3 id="12-2-3-ä¸ä¿è¯åŸå­æ€§"><a href="#12-2-3-ä¸ä¿è¯åŸå­æ€§" class="headerlink" title="12.2.3 ä¸ä¿è¯åŸå­æ€§"></a>12.2.3 ä¸ä¿è¯åŸå­æ€§</h3><p>â€‹äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­, å¦‚æœæœ‰æŒ‡ä»¤æ‰§è¡Œå¤±è´¥ï¼Œ å…¶å®ƒçš„æŒ‡ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œ, æ²¡æœ‰å›æ»š</p><h2 id="12-3-äº‹åŠ¡ç›¸å…³æŒ‡ä»¤-Multiã€-Execã€-discard"><a href="#12-3-äº‹åŠ¡ç›¸å…³æŒ‡ä»¤-Multiã€-Execã€-discard" class="headerlink" title="12.3 äº‹åŠ¡ç›¸å…³æŒ‡ä»¤ Multiã€ Execã€ discard"></a>12.3 äº‹åŠ¡ç›¸å…³æŒ‡ä»¤ Multiã€ Execã€ discard</h2><h3 id="12-3-1-ä¸€å›¾èƒœåƒè¨€"><a href="#12-3-1-ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="12.3.1 ä¸€å›¾èƒœåƒè¨€"></a>12.3.1 ä¸€å›¾èƒœåƒè¨€</h3><p>1ã€ Redis äº‹åŠ¡æŒ‡ä»¤ç¤ºæ„å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729180534083.png" alt="image-20230729180534083" style="zoom:50%;" /><p>2ã€è§£è¯»ä¸Šå›¾:</p><ol><li><strong>ä»è¾“å…¥ Multi å‘½ä»¤å¼€å§‹ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œ</strong>(ç±»ä¼¼ Mysqlçš„ start transaction å¼€å¯äº‹åŠ¡)</li><li><strong>è¾“å…¥ Exec åï¼ŒRedis ä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œ</strong>(ç±»ä¼¼ Mysql çš„ commit æäº¤äº‹åŠ¡)</li><li>ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥<strong>é€šè¿‡ discard æ¥æ”¾å¼ƒç»„é˜Ÿ</strong>(ç±»ä¼¼ Mysql çš„ rollback å›é¡¾äº‹åŠ¡)</li><li>âš ï¸ï¼š Redis äº‹åŠ¡å’Œ Mysql äº‹åŠ¡æœ¬è´¨æ˜¯å®Œå…¨ä¸åŒçš„, è¿™é‡Œåªæ˜¯ç”¨ Mysql çš„åšç±»ä¼¼è¯´æ˜, æ˜¯ä¸ºäº†è®©å°ä¼™ä¼´å¥½ç†è§£</li></ol><h3 id="12-3-2-å¿«é€Ÿå…¥é—¨"><a href="#12-3-2-å¿«é€Ÿå…¥é—¨" class="headerlink" title="12.3.2 å¿«é€Ÿå…¥é—¨"></a>12.3.2 å¿«é€Ÿå…¥é—¨</h3><p>â€¦â€¦</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729181130039.png" alt="image-20230729181130039"></p><h3 id="12-3-3-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#12-3-3-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="12.3.3 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>12.3.3 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><p>â€‹1ã€ ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­, å¯ä»¥é€šè¿‡ discard æ¥æ”¾å¼ƒç»„é˜Ÿ</p><p>â€‹<strong>2ã€å¦‚æœåœ¨ç»„é˜Ÿé˜¶æ®µæŠ¥é”™, ä¼šå¯¼è‡´ exec å¤±è´¥, é‚£ä¹ˆäº‹åŠ¡çš„æ‰€æœ‰æŒ‡ä»¤éƒ½ä¸ä¼šè¢«æ‰§è¡Œ</strong>(è¿™æ—¶å€™æ˜¯æœ‰åŸå­æ€§çš„)</p><p>â€‹3ã€å¦‚æœç»„é˜ŸæˆåŠŸ, ä½†æ˜¯æŒ‡ä»¤æœ‰ä¸èƒ½æ­£å¸¸æ‰§è¡Œçš„, é‚£ä¹ˆ exec æäº¤, ä¼šå‡ºç°æœ‰æˆåŠŸæœ‰å¤±è´¥æƒ…å†µ,ä¹Ÿå°±æ˜¯äº‹åŠ¡å¾—åˆ°éƒ¨åˆ†æ‰§è¡Œ, <strong>è¿™ç§æƒ…å†µä¸‹, Redis äº‹åŠ¡ä¸å…·å¤‡åŸå­æ€§.</strong></p><h2 id="12-4-äº‹åŠ¡å†²çªåŠè§£å†³æ–¹æ¡ˆ"><a href="#12-4-äº‹åŠ¡å†²çªåŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="12.4 äº‹åŠ¡å†²çªåŠè§£å†³æ–¹æ¡ˆ"></a>12.4 äº‹åŠ¡å†²çªåŠè§£å†³æ–¹æ¡ˆ</h2><h3 id="12-4-1-å…ˆçœ‹ä¸€ä¸ªé—®é¢˜"><a href="#12-4-1-å…ˆçœ‹ä¸€ä¸ªé—®é¢˜" class="headerlink" title="12.4.1 å…ˆçœ‹ä¸€ä¸ªé—®é¢˜"></a>12.4.1 å…ˆçœ‹ä¸€ä¸ªé—®é¢˜</h3><p>1ã€ ç»å…¸çš„æŠ¢ç¥¨é—®é¢˜(æ€»å…±åå¼ ç¥¨)</p><p>â€‹1) ä¸€ä¸ªè¯·æ±‚æƒ³è´­ä¹° 6</p><p>â€‹2) ä¸€ä¸ªè¯·æ±‚æƒ³è´­ä¹° 5</p><p>â€‹    3) ä¸€ä¸ªè¯·æ±‚æƒ³è´­ä¹° 1</p><p>â€”â€”å¦‚æœæ²¡æœ‰æ§åˆ¶, ä¼šé€ æˆè¶…å–ç°è±¡    ;  å¦‚æœ 3 ä¸ªæŒ‡ä»¤, éƒ½å¾—åˆ°æ‰§è¡Œ, æœ€åå‰©ä½™çš„ç¥¨æ•°æ˜¯ -2</p><h3 id="12-4-2-æ‚²è§‚é”"><a href="#12-4-2-æ‚²è§‚é”" class="headerlink" title="12.4.2 æ‚²è§‚é”"></a>12.4.2 æ‚²è§‚é”</h3><p>1ã€ å·¥ä½œç¤ºæ„å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729182017365.png" alt="image-20230729182017365"></p><p>2ã€è§£è¯»ä¸Šå›¾</p><ol><li>æ‚²è§‚é”(Pessimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œ<strong>æ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨è·å–æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”</strong></li><li>è¿™æ ·åˆ«äºº&#x2F;å…¶å®ƒè¯·æ±‚æƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼š blockï¼Œç›´åˆ°æ‹¿åˆ°é”ã€‚</li><li>æ‚²è§‚é”æ˜¯é”è®¾è®¡ç†å¿µ, ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”.</li></ol><h3 id="12-4-3-ä¹è§‚é”"><a href="#12-4-3-ä¹è§‚é”" class="headerlink" title="12.4.3 ä¹è§‚é”"></a>12.4.3 ä¹è§‚é”</h3><p>1ã€ å·¥ä½œç¤ºæ„å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729182519566.png" alt="image-20230729182519566"></p><p>2ã€è§£è¯»ä¸Šå›¾ï¼š</p><pre><code>1) ä¹è§‚é”(Optimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”1) ä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œ**å¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚**1) ä¹è§‚é”&lt;u&gt;**é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡**&lt;/u&gt;ã€‚Redis å°±æ˜¯åˆ©ç”¨è¿™ç§ check-and-setæœºåˆ¶å®ç°äº‹åŠ¡çš„1) ä¹è§‚é”æ˜¯é”è®¾è®¡ç†å¿µ(**ä¸ç”¨æ‹…å¿ƒåœ¨ä¿®æ”¹ç‰ˆæœ¬çš„ç¬é—´ï¼Œåˆ«äººæ­£å¥½è¯»åˆ°ç‰ˆæœ¬â€”â€”å› ä¸ºç‰ˆæœ¬ä¿®æ”¹é˜¶æ®µæ˜¯åŸå­æ€§çš„ï¼**)</code></pre><h3 id="12-4-4-watch-amp-unwatch"><a href="#12-4-4-watch-amp-unwatch" class="headerlink" title="12.4.4 watch &amp; unwatch"></a>12.4.4 watch &amp; unwatch</h3><h4 id="12-4-4-1-watch"><a href="#12-4-4-1-watch" class="headerlink" title="12.4.4.1 watch"></a>12.4.4.1 watch</h4><p>1ã€ åŸºæœ¬è¯­æ³•: watch key [key â€¦]</p><p>2ã€åœ¨æ‰§è¡Œ multi ä¹‹å‰ï¼Œ<strong>å…ˆæ‰§è¡Œ watch key1 [key2],å¯ä»¥ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key <u>è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨</u>ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­.</strong></p><p>3ã€è¿™é‡Œå¯ä»¥ç»“åˆä¹è§‚é”æœºåˆ¶è¿›è¡Œç†è§£</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729183535766.png" alt="image-20230729183535766"></p><h4 id="12-4-4-2-unwatch"><a href="#12-4-4-2-unwatch" class="headerlink" title="12.4.4.2 unwatch"></a>12.4.4.2 unwatch</h4><p>1ã€ åŸºæœ¬è¯­æ³•unwatch</p><p>2ã€å–æ¶ˆ watch å‘½ä»¤å¯¹æ‰€æœ‰ key çš„ç›‘è§†ã€‚</p><p>3ã€å¦‚æœåœ¨æ‰§è¡Œ watch å‘½ä»¤åï¼Œexec å‘½ä»¤æˆ– discard å‘½ä»¤å…ˆè¢«æ‰§è¡Œäº†çš„è¯ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å†æ‰§è¡Œ unwatch äº†</p><h2 id="12-5-ç«è½¦ç¥¨-æŠ¢ç¥¨"><a href="#12-5-ç«è½¦ç¥¨-æŠ¢ç¥¨" class="headerlink" title="12.5 ç«è½¦ç¥¨-æŠ¢ç¥¨"></a>12.5 ç«è½¦ç¥¨-æŠ¢ç¥¨</h2><h3 id="12-5-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#12-5-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="12.5.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>12.5.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h3><p>â€¦â€¦</p><h3 id="12-5-2-æ€è·¯åˆ†æ"><a href="#12-5-2-æ€è·¯åˆ†æ" class="headerlink" title="12.5.2 æ€è·¯åˆ†æ"></a>12.5.2 æ€è·¯åˆ†æ</h3><p>â€‹â€“ æ€è·¯åˆ†æ</p><p>â€‹1ã€ä¸€ä¸ª user åªèƒ½è´­ä¹°ä¸€å¼ ç¥¨, å³<u>ä¸èƒ½å¤è´­</u></p><p>â€‹2ã€<u>ä¸èƒ½å‡ºç°è¶…è´­</u>,ä¹Ÿæ˜¯å°±å¤šå–äº†.</p><p>â€‹3ã€ä¸èƒ½å‡ºç°ç«è½¦ç¥¨é—ç•™é—®é¢˜&#x2F;åº“å­˜é—ç•™, å³*<u>ç«è½¦ç¥¨ä¸èƒ½ç•™ä¸‹</u>*</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230730102256386.png" alt="image-20230730102256386" style="zoom: 67%;" /><h3 id="12-5-3-ç‰ˆæœ¬-1ï¼š-å®ŒæˆåŸºæœ¬è´­ç¥¨æµç¨‹-æš‚ä¸è€ƒè™‘äº‹åŠ¡å’Œå¹¶å‘é—®é¢˜"><a href="#12-5-3-ç‰ˆæœ¬-1ï¼š-å®ŒæˆåŸºæœ¬è´­ç¥¨æµç¨‹-æš‚ä¸è€ƒè™‘äº‹åŠ¡å’Œå¹¶å‘é—®é¢˜" class="headerlink" title="12.5.3 ç‰ˆæœ¬ 1ï¼š å®ŒæˆåŸºæœ¬è´­ç¥¨æµç¨‹, æš‚ä¸è€ƒè™‘äº‹åŠ¡å’Œå¹¶å‘é—®é¢˜"></a>12.5.3 ç‰ˆæœ¬ 1ï¼š å®ŒæˆåŸºæœ¬è´­ç¥¨æµç¨‹, æš‚ä¸è€ƒè™‘äº‹åŠ¡å’Œå¹¶å‘é—®é¢˜</h3><p>â€‹1ã€ åˆ›å»º Java Web é¡¹ç›®, å‚ç…§ä»¥å‰è®²è¿‡æ­å»º Java Web é¡¹ç›®æµç¨‹å³å¯</p><p>â€‹2ã€å¼•å…¥ç›¸å…³çš„ jar åŒ… å’Œ jquery</p><p>â€‹3ã€åˆ›å»º index.jsp(ä¹°ç¥¨ç•Œé¢)</p><p>â€‹4ã€åˆ›å»º SecKillRedis.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç§’æ€ç±»: å®Œæˆç§’æ€,æŠ¢è´­</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecKillRedis</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼–å†™ä¸€ä¸ªæµ‹è¯•æ–¹æ³•-çœ‹çœ‹æ˜¯å¦èƒ½å¤Ÿè¿é€šåˆ°æŒ‡å®šçš„Redis</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRedis</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.198.135&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="comment">//jedis.auth(&quot;foobared&quot;);//å¦‚æœéœ€è¦è®¤è¯, å°±ä½¿ç”¨auth</span></span><br><span class="line">        System.out.println(jedis.ping());</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§’æ€è¿‡ç¨‹/æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid      ç”¨æˆ·id - åœ¨åå°ç”Ÿæˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ticketNo ç¥¨çš„ç¼–å·, æ¯”å¦‚åŒ—äº¬-æˆéƒ½çš„ticketNo å°±æ˜¯bj_cd</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">doSecKill</span><span class="params">(String uid, String ticketNo)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//- uid å’Œ ticketNoè¿›è¡Œéç©ºæ ¡éªŒ</span></span><br><span class="line">        <span class="keyword">if</span> (uid == <span class="literal">null</span> || ticketNo == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//- è¿æ¥åˆ°Redis, å¾—åˆ°jediså¯¹è±¡</span></span><br><span class="line">        <span class="comment">//Jedis jedis = new Jedis(&quot;192.168.198.135&quot;, 6379);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//- é€šè¿‡è¿æ¥æ± è·å–åˆ°jediså¯¹è±¡/è¿æ¥</span></span><br><span class="line">        <span class="type">JedisPool</span> <span class="variable">jedisPoolInstance</span> <span class="operator">=</span> JedisPoolUtil.getJedisPoolInstance();</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> jedisPoolInstance.getResource();</span><br><span class="line">        System.out.println(<span class="string">&quot;---ä½¿ç”¨çš„è¿æ¥æ± æŠ€æœ¯----&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//- æ‹¼æ¥ç¥¨çš„åº“å­˜key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">stockKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span> + ticketNo + <span class="string">&quot;:ticket&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//- æ‹¼æ¥ç§’æ€ç”¨æˆ·è¦å­˜æ”¾åˆ°çš„seté›†åˆå¯¹åº”çš„key,è¿™ä¸ªseté›†åˆå¯ä»¥å­˜æ”¾å¤šä¸ªuserId</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span> + ticketNo + <span class="string">&quot;:user&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ğŸƒç›‘æ§åº“å­˜</span></span><br><span class="line">        jedis.watch(stockKey);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//- è·å–åˆ°å¯¹åº”çš„ç¥¨çš„åº“å­˜, åˆ¤æ–­æ˜¯å¦ä¸ºnull</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">stock</span> <span class="operator">=</span> jedis.get(stockKey);</span><br><span class="line">        <span class="keyword">if</span> (stock == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç§’æ€è¿˜æ²¡æœ‰å¼€å§‹, è¯·ç­‰å¾…..&quot;</span>);</span><br><span class="line">            jedis.close(); <span class="comment">//å¦‚æœjedisæ˜¯ä»è¿æ¥æ± è·å–çš„,åˆ™è¿™é‡Œçš„closeå°±æ˜¯å°†jediså¯¹è±¡/è¿æ¥é‡Šæ”¾åˆ°è¿æ¥æ± </span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//- åˆ¤æ–­ç”¨æˆ·æ˜¯å¦é‡å¤ç§’æ€/å¤è´­</span></span><br><span class="line">        <span class="keyword">if</span> (jedis.sismember(userKey, uid)) &#123;</span><br><span class="line">            System.out.println(uid + <span class="string">&quot; ä¸èƒ½é‡å¤ç§’æ€...&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//- åˆ¤æ–­ç«è½¦ç¥¨ï¼Œæ˜¯å¦è¿˜æœ‰å‰©ä½™</span></span><br><span class="line">        <span class="keyword">if</span> (Integer.parseInt(stock) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¥¨å·²ç»å–å®Œäº†, ç§’æ€ç»“æŸ..&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">////- å¯ä»¥è´­ä¹°</span></span><br><span class="line">        <span class="comment">////1. å°†ç¥¨çš„åº“å­˜é‡-1</span></span><br><span class="line">        <span class="comment">//jedis.decr(stockKey);</span></span><br><span class="line">        <span class="comment">////2. å°†è¯¥ç”¨æˆ·åŠ å…¥åˆ°æŠ¢è´­æˆåŠŸå¯¹åº”çš„seté›†åˆä¸­</span></span><br><span class="line">        <span class="comment">//jedis.sadd(userKey, uid);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨äº‹åŠ¡,å®Œæˆç§’æ€(é˜²æ­¢è¶…å–)</span></span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">multi</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»„é˜Ÿæ“ä½œ</span></span><br><span class="line">        multi.decr(stockKey);<span class="comment">//å‡å»ç¥¨çš„åº“å­˜</span></span><br><span class="line">        multi.sadd(userKey, uid);<span class="comment">//å°†è¯¥ç”¨æˆ·åŠ å…¥åˆ°æŠ¢è´­æˆåŠŸå¯¹åº”çš„seté›†åˆä¸­</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">        List&lt;Object&gt; results = multi.exec();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(results == <span class="literal">null</span> || results.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æŠ¢ç¥¨å¤±è´¥...&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(uid + <span class="string">&quot; ç§’æ€æˆåŠŸ..&quot;</span>);</span><br><span class="line">        jedis.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5ã€åˆ›å»ºSecKillServlet.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecKillServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. è¯·æ±‚æ—¶,æ¨¡æ‹Ÿç”Ÿæˆä¸€ä¸ªuserId</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">10000</span>) + <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//2. è·å–ç”¨æˆ·è¦è´­ä¹°çš„ç¥¨çš„ç¼–å·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ticketNo</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;ticketNo&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. è°ƒç”¨ç§’æ€çš„æ–¹æ³•</span></span><br><span class="line">        <span class="comment">//boolean isOk = SecKillRedis.doSecKill(userId, ticketNo);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. è°ƒç”¨luaè„šæœ¬å®Œæˆç§’æ€æ–¹æ³•</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isOk</span> <span class="operator">=</span> SecKillRedisByLua.doSecKill(userId, ticketNo);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. å°†ç»“æœè¿”å›ç»™å‰ç«¯-è¿™ä¸ªåœ°æ–¹å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦è°ƒæ•´</span></span><br><span class="line">        response.getWriter().print(isOk);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="12-5-4-æŠ¢ç¥¨å¹¶å‘æ¨¡æ‹Ÿ-å‡ºç°è¶…å–é—®é¢˜"><a href="#12-5-4-æŠ¢ç¥¨å¹¶å‘æ¨¡æ‹Ÿ-å‡ºç°è¶…å–é—®é¢˜" class="headerlink" title="12.5.4 æŠ¢ç¥¨å¹¶å‘æ¨¡æ‹Ÿ, å‡ºç°è¶…å–é—®é¢˜"></a>12.5.4 æŠ¢ç¥¨å¹¶å‘æ¨¡æ‹Ÿ, å‡ºç°è¶…å–é—®é¢˜</h3><p>å¹¶å‘æ¨¡æ‹Ÿ</p><p>å¯ä»¥ä½¿ç”¨postmanæ¨¡æ‹Ÿ</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230730110008609.png" alt="image-20230730110008609" style="zoom:50%;" /><h3 id="12-5-5-è¿æ¥æ± æŠ€æœ¯"><a href="#12-5-5-è¿æ¥æ± æŠ€æœ¯" class="headerlink" title="12.5.5 è¿æ¥æ± æŠ€æœ¯"></a>12.5.5 è¿æ¥æ± æŠ€æœ¯</h3><h4 id="12-5-5-1-è¿æ¥æ± ä»‹ç»"><a href="#12-5-5-1-è¿æ¥æ± ä»‹ç»" class="headerlink" title="12.5.5.1 è¿æ¥æ± ä»‹ç»"></a>12.5.5.1 è¿æ¥æ± ä»‹ç»</h4><p>â€‹1ã€ èŠ‚çœæ¯æ¬¡è¿æ¥ redis æœåŠ¡å¸¦æ¥çš„æ¶ˆè€—ï¼Œ <u><strong>æŠŠè¿æ¥å¥½çš„å®ä¾‹åå¤åˆ©ç”¨ã€‚</strong></u></p><p>â€‹2ã€ é“¾æ¥æ± å‚æ•°</p><pre><code>    - MaxTotalï¼š æ§åˆ¶**ä¸€ä¸ª pool å¯åˆ†é…å¤šå°‘ä¸ª jedis å®ä¾‹**ï¼Œ é€šè¿‡ pool.getResource()æ¥è·å–ï¼›å¦‚æœèµ‹å€¼ä¸º-1ï¼Œ åˆ™è¡¨ç¤ºä¸é™åˆ¶    - maxIdleï¼š æ§åˆ¶ä¸€ä¸ª pool æœ€å¤šæœ‰**å¤šå°‘ä¸ªçŠ¶æ€ä¸º idle(ç©ºé—²)çš„ jedis å®ä¾‹**</code></pre><ul><li><p>MaxWaitMillisï¼š è¡¨ç¤ºå½“è·å–ä¸€ä¸ª jedis å®ä¾‹æ—¶ï¼Œ æœ€å¤§çš„ç­‰å¾…æ¯«ç§’æ•°ï¼Œ å¦‚æœè¶…è¿‡ç­‰å¾…æ—¶é—´ï¼Œåˆ™ç›´æ¥æŠ› JedisConnectionException</p></li><li><p>testOnBorrowï¼š è·å¾—ä¸€ä¸ª jedis å®ä¾‹çš„æ—¶å€™æ˜¯å¦æ£€æŸ¥è¿æ¥å¯ç”¨æ€§ï¼ˆping()ï¼‰ï¼› å¦‚æœä¸º trueï¼Œåˆ™å¾—åˆ°çš„ jedis å®ä¾‹å‡æ˜¯å¯ç”¨çš„</p></li></ul><h4 id="12-5-5-2-ä½¿ç”¨è¿æ¥æ± -ä¼˜åŒ–è¿æ¥è¶…æ—¶"><a href="#12-5-5-2-ä½¿ç”¨è¿æ¥æ± -ä¼˜åŒ–è¿æ¥è¶…æ—¶" class="headerlink" title="12.5.5.2 ä½¿ç”¨è¿æ¥æ± , ä¼˜åŒ–è¿æ¥è¶…æ—¶"></a>12.5.5.2 ä½¿ç”¨è¿æ¥æ± , ä¼˜åŒ–è¿æ¥è¶…æ—¶</h4><p>â€‹1ã€ è€å¸ˆè¯´æ˜: é€šè¿‡è¿æ¥æ± ï¼Œ å¯ä»¥æŒ‡å®šè¿æ¥è¶…æ—¶æ—¶é—´, è¿™ä¸ªè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œ ä¹Ÿéœ€è¦åˆç†è®¾ç½® ï¼Œ è¦è€ƒè™‘åˆ°ç”¨æˆ·çš„å®é™…ä½“éªŒ</p><p>â€‹2 ã€ åˆ› å»º JedisPoolUtil.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨è¿æ¥æ± çš„æ–¹å¼æ¥è·å–Redisè¿æ¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisPoolUtil</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//è€å¸ˆè§£è¯»volatileä½œç”¨</span></span><br><span class="line">    <span class="comment">//1. çº¿ç¨‹çš„å¯è§æ€§: å½“ä¸€ä¸ªçº¿ç¨‹å»ä¿®æ”¹ä¸€ä¸ªå…±äº«å˜é‡æ—¶, å¦å¤–ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¯»å–è¿™ä¸ªä¿®æ”¹çš„å€¼</span></span><br><span class="line">    <span class="comment">//2. é¡ºåºçš„ä¸€è‡´æ€§: ç¦æ­¢æŒ‡ä»¤é‡æ’</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">JedisPool</span> <span class="variable">jedisPool</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">JedisPoolUtil</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¿è¯æ¯æ¬¡è°ƒç”¨è¿”å›çš„ jedisPoolæ˜¯å•ä¾‹-è¿™é‡Œè€å¸ˆä½¿ç”¨äº†åŒé‡æ ¡éªŒ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> JedisPool <span class="title function_">getJedisPoolInstance</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == jedisPool) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (JedisPoolUtil.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == jedisPool) &#123;</span><br><span class="line">                    <span class="type">JedisPoolConfig</span> <span class="variable">jedisPoolConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPoolConfig</span>();</span><br><span class="line">                    <span class="comment">//å¯¹è¿æ¥æ± è¿›è¡Œé…ç½®</span></span><br><span class="line">                    jedisPoolConfig.setMaxTotal(<span class="number">200</span>);</span><br><span class="line">                    jedisPoolConfig.setMaxIdle(<span class="number">32</span>);</span><br><span class="line">                    jedisPoolConfig.setMaxWaitMillis(<span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">                    jedisPoolConfig.setBlockWhenExhausted(<span class="literal">true</span>);</span><br><span class="line">                    jedisPoolConfig.setTestOnBorrow(<span class="literal">true</span>);</span><br><span class="line">                    jedisPool = <span class="keyword">new</span> <span class="title class_">JedisPool</span>(jedisPoolConfig, <span class="string">&quot;192.168.198.135&quot;</span>, <span class="number">6379</span>, <span class="number">60000</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jedisPool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‡Šæ”¾è¿æ¥èµ„æº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">release</span><span class="params">(Jedis jedis)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> != jedis) &#123;</span><br><span class="line">            jedis.close();<span class="comment">//å¦‚æœè¿™ä¸ªjedisæ˜¯ä»è¿æ¥æ± è·å–çš„,è¿™é‡Œjedis.close(),å°±æ˜¯å°†jediså¯¹è±¡/è¿æ¥ï¼Œé‡Šæ”¾åˆ°è¿æ¥æ± </span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ğŸŒŸvolatileï¼š"><a href="#ğŸŒŸvolatileï¼š" class="headerlink" title="ğŸŒŸvolatileï¼š"></a>ğŸŒŸvolatileï¼š</h4><p>è¿™æ˜¯å› ä¸º new å…³é”®å­—åˆ›å»ºå¯¹è±¡ä¸æ˜¯åŸâ¼¦æ“ä½œï¼Œåˆ›å»ºâ¼€ä¸ªå¯¹è±¡ä¼šç»å†ä¸‹â¾¯<br>çš„æ­¥éª¤ï¼š</p><ol><li>åœ¨å †å†…å­˜å¼€è¾Ÿå†…å­˜ç©ºé—´</li><li>è°ƒâ½¤æ„é€ â½…æ³•ï¼Œåˆå§‹åŒ–å¯¹è±¡</li><li>å¼•â½¤å˜é‡æŒ‡å‘å †å†…å­˜ç©ºé—´</li></ol><p>â€‹ä¸ºäº†æâ¾¼æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æ—¢å®šçš„ä»£ç æ‰§â¾é¡ºåºè¿›â¾æŒ‡ä»¤é‡æ’åºï¼Œä»æºç åˆ°æœ€ç»ˆæ‰§â¾æŒ‡ä»¤ä¼šç»å†å¦‚ä¸‹æµç¨‹ï¼š<br>æºç ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’åºæŒ‡ä»¤çº§å¹¶â¾é‡æ’åºå†…å­˜ç³»ç»Ÿé‡æ’åºæœ€ç»ˆæ‰§â¾æŒ‡ä»¤åºåˆ—æ‰€ä»¥ç»è¿‡æŒ‡ä»¤é‡æ’åºä¹‹åï¼Œåˆ›å»ºå¯¹è±¡çš„æ‰§â¾é¡ºåºå¯èƒ½ä¸º 1 2 3 æˆ–è€… 1 3 2 ï¼Œå› æ­¤å½“æŸä¸ªçº¿ç¨‹åœ¨ä¹±åºè¿â¾ 1 3 2 æŒ‡ä»¤çš„æ—¶å€™ï¼Œå¼•â½¤å˜é‡æŒ‡å‘å †å†…å­˜ç©ºé—´ï¼Œè¿™ä¸ªå¯¹è±¡ä¸ä¸º nullï¼Œä½†æ˜¯æ²¡æœ‰åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹æœ‰å¯èƒ½è¿™ä¸ªæ—¶å€™è¿›â¼Šäº† getInstance çš„ç¬¬â¼€ä¸ª if(instance &#x3D;&#x3D; null) åˆ¤æ–­ä¸ä¸º nulll ï¼Œå¯¼è‡´<strong>é”™è¯¯ä½¿â½¤äº†æ²¡æœ‰åˆå§‹åŒ–çš„â¾® null å®ä¾‹</strong>ï¼Œè¿™æ ·çš„è¯å°±ä¼šå‡ºç°å¼‚å¸¸ï¼Œè¿™ä¸ªå°±æ˜¯è‘—åçš„<br>DCL å¤±æ•ˆé—®é¢˜ã€‚<br>å½“æˆ‘ä»¬åœ¨å¼•â½¤å˜é‡ä¸Šâ¾¯æ·»åŠ  volatile å…³é”®å­—ä»¥åï¼Œä¼šé€šè¿‡åœ¨åˆ›å»ºå¯¹è±¡æŒ‡ä»¤çš„å‰åæ·»åŠ å†…å­˜å±éšœæ¥ç¦â½ŒæŒ‡ä»¤é‡æ’åºï¼Œå°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œâ½½ä¸”å¯¹volatile ä¿®é¥°çš„å˜é‡çš„ä¿®æ”¹å¯¹å…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½æ˜¯å¯â»…çš„ã€‚</p><h3 id="12-5-6-åˆ©ç”¨-Reids-äº‹åŠ¡æœºåˆ¶ï¼Œ-è§£å†³è¶…å–"><a href="#12-5-6-åˆ©ç”¨-Reids-äº‹åŠ¡æœºåˆ¶ï¼Œ-è§£å†³è¶…å–" class="headerlink" title="12.5.6 åˆ©ç”¨ Reids äº‹åŠ¡æœºåˆ¶ï¼Œ è§£å†³è¶…å–"></a>12.5.6 åˆ©ç”¨ Reids äº‹åŠ¡æœºåˆ¶ï¼Œ è§£å†³è¶…å–</h3><p>1ã€ æ§åˆ¶è¶…å–-Redis äº‹åŠ¡åº•å±‚(ä¹è§‚é”æœºåˆ¶åˆ†æ)</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230730133348196.png" alt="image-20230730133348196"></p><p>2 ã€ ä¿® æ”¹ SecKillRedis.java</p><p>ğŸ˜µâ€ğŸ’«è§12.5.3 çš„å®Œæ•´ä»£ç </p><h3 id="12-5-7-æŠ¢ç¥¨å¹¶å‘æ¨¡æ‹Ÿ-å‡ºç°åº“å­˜é—ç•™é—®é¢˜"><a href="#12-5-7-æŠ¢ç¥¨å¹¶å‘æ¨¡æ‹Ÿ-å‡ºç°åº“å­˜é—ç•™é—®é¢˜" class="headerlink" title="12.5.7 æŠ¢ç¥¨å¹¶å‘æ¨¡æ‹Ÿ,å‡ºç°åº“å­˜é—ç•™é—®é¢˜"></a>12.5.7 æŠ¢ç¥¨å¹¶å‘æ¨¡æ‹Ÿ,å‡ºç°åº“å­˜é—ç•™é—®é¢˜</h3><h4 id="1ã€-å…ˆé‡ç½®ä¸€ä¸‹-redis-çš„æ•°æ®ï¼ŒæŠŠåº“å­˜é‡è®¾çš„è¾ƒå¤§-ä¸º-600"><a href="#1ã€-å…ˆé‡ç½®ä¸€ä¸‹-redis-çš„æ•°æ®ï¼ŒæŠŠåº“å­˜é‡è®¾çš„è¾ƒå¤§-ä¸º-600" class="headerlink" title="1ã€ å…ˆé‡ç½®ä¸€ä¸‹ redis çš„æ•°æ®ï¼ŒæŠŠåº“å­˜é‡è®¾çš„è¾ƒå¤§ , ä¸º 600"></a>1ã€ å…ˆé‡ç½®ä¸€ä¸‹ redis çš„æ•°æ®ï¼ŒæŠŠåº“å­˜é‡è®¾çš„è¾ƒå¤§ , ä¸º 600</h4><h4 id="2ã€æ‰§è¡ŒæŒ‡ä»¤"><a href="#2ã€æ‰§è¡ŒæŒ‡ä»¤" class="headerlink" title="2ã€æ‰§è¡ŒæŒ‡ä»¤"></a>2ã€æ‰§è¡ŒæŒ‡ä»¤</h4><p>â€‹ab -n 1000 -c 300 -p ~&#x2F;postfile -T  application&#x2F;x-www-form-urlencoded<a href="http://ip:port/seckill/secKillServlet">http://ip:port/seckill/secKillServlet</a></p><p>â€‹è€éŸ©è§£è¯»:1) è¿™é‡Œæˆ‘ä»¬å¹¶å‘æ•°å˜å¤§ -c 300</p><h4 id="3ã€æ‰§è¡Œç»“æœ"><a href="#3ã€æ‰§è¡Œç»“æœ" class="headerlink" title="3ã€æ‰§è¡Œç»“æœ"></a>3ã€æ‰§è¡Œç»“æœ</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230730134144402.png" alt="image-20230730134144402" style="zoom:50%;" /><p>â€‹å¯ä»¥çœ‹åˆ°, å‰©ä½™ç¥¨æ•°ä¸º 543, å¹¶ä¸æ˜¯ 0</p><h4 id="4ã€å‡ºç°åº“å­˜é—ç•™é—®é¢˜çš„åˆ†æ"><a href="#4ã€å‡ºç°åº“å­˜é—ç•™é—®é¢˜çš„åˆ†æ" class="headerlink" title="4ã€å‡ºç°åº“å­˜é—ç•™é—®é¢˜çš„åˆ†æ"></a>4ã€å‡ºç°åº“å­˜é—ç•™é—®é¢˜çš„åˆ†æ</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230730134242569.png" alt="image-20230730134242569"></p><h3 id="12-5-8-LUA-è„šæœ¬"><a href="#12-5-8-LUA-è„šæœ¬" class="headerlink" title="12.5.8 LUA è„šæœ¬"></a>12.5.8 LUA è„šæœ¬</h3><h4 id="12-5-8-1-LUA-ä»‹ç»"><a href="#12-5-8-1-LUA-ä»‹ç»" class="headerlink" title="12.5.8.1 LUA ä»‹ç»"></a>12.5.8.1 LUA ä»‹ç»</h4><p>â€‹1ã€ Lua æ˜¯ä¸€ä¸ªå°å·§çš„è„šæœ¬è¯­è¨€ï¼Œ Lua è„šæœ¬å¯ä»¥å¾ˆå®¹æ˜“çš„è¢« C&#x2F;C++ ä»£ç è°ƒç”¨ï¼Œ ä¹Ÿå¯ä»¥åè¿‡æ¥è°ƒç”¨ C&#x2F;C++çš„å‡½æ•°ï¼Œ Lua å¹¶æ²¡æœ‰æä¾›å¼ºå¤§çš„åº“ï¼Œ ä¸€ä¸ªå®Œæ•´çš„ Lua è§£é‡Šå™¨ä¸è¿‡ 200kï¼Œæ‰€ä»¥ Lua ä¸é€‚åˆä½œä¸ºå¼€å‘ç‹¬ç«‹åº”ç”¨ç¨‹åºçš„è¯­è¨€ï¼Œ è€Œæ˜¯ä½œä¸º<strong>åµŒå…¥å¼è„šæœ¬è¯­è¨€</strong>ã€‚</p><p>â€‹2ã€å¾ˆå¤šåº”ç”¨ç¨‹åºã€æ¸¸æˆä½¿ç”¨ LUA ä½œä¸ºè‡ªå·±çš„åµŒå…¥å¼è„šæœ¬è¯­è¨€ï¼Œä»¥æ­¤æ¥å®ç°å¯é…ç½®æ€§ã€å¯æ‰©å±•æ€§ã€‚</p><p>â€‹3ã€å°†å¤æ‚çš„æˆ–è€…å¤šæ­¥çš„ Redis æ“ä½œï¼Œå†™ä¸ºä¸€ä¸ªè„šæœ¬ï¼Œä¸€æ¬¡æäº¤ç»™ redis æ‰§è¡Œï¼Œå‡å°‘åå¤è¿æ¥ redis çš„æ¬¡æ•°ã€‚æå‡æ€§èƒ½ã€‚</p><p>â€‹4ã€LUA è„šæœ¬æ˜¯ç±»ä¼¼ Redis äº‹åŠ¡ï¼Œæœ‰ä¸€å®šçš„åŸå­æ€§ï¼Œä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’é˜Ÿï¼Œ<strong>å¯ä»¥å®Œæˆä¸€äº› redis äº‹åŠ¡æ€§çš„æ“ä½œ</strong></p><p>â€‹5ã€Redis çš„ lua è„šæœ¬åŠŸèƒ½ï¼Œåªæœ‰åœ¨ Redis 2.6 ä»¥ä¸Šçš„ç‰ˆæœ¬æ‰å¯ä»¥ä½¿ç”¨</p><p>â€‹6ã€é€šè¿‡ lua è„šæœ¬è§£å†³äº‰æŠ¢é—®é¢˜ï¼Œå®é™…ä¸Šæ˜¯ Redis åˆ©ç”¨å…¶å•çº¿ç¨‹çš„ç‰¹æ€§ï¼Œ<strong>ç”¨ä»»åŠ¡é˜Ÿåˆ—çš„æ–¹å¼è§£å†³å¤šä»»åŠ¡å¹¶å‘é—®é¢˜</strong></p><h4 id="12-5-8-2-LUA-è„šæœ¬-è§£å†³åº“å­˜é—ç•™-æ€è·¯åˆ†æå›¾"><a href="#12-5-8-2-LUA-è„šæœ¬-è§£å†³åº“å­˜é—ç•™-æ€è·¯åˆ†æå›¾" class="headerlink" title="12.5.8.2 LUA è„šæœ¬, è§£å†³åº“å­˜é—ç•™-æ€è·¯åˆ†æå›¾"></a>12.5.8.2 LUA è„šæœ¬, è§£å†³åº“å­˜é—ç•™-æ€è·¯åˆ†æå›¾</h4><p>â€‹ä¸€å›¾èƒœåƒè¨€</p><p>â€‹<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230730135547720.png" alt="image-20230730135547720"></p><p>å¯¹ä¸Šå›¾è§£è¯»</p><pre><code>1) LUA è„šæœ¬æ˜¯ç±»ä¼¼ Redis äº‹åŠ¡ï¼Œæœ‰ä¸€å®šçš„åŸå­æ€§ï¼Œä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’é˜Ÿï¼Œèƒ½å®Œæˆ Redisäº‹åŠ¡æ€§çš„æ“ä½œ 1) é€šè¿‡ lua è„šæœ¬è§£å†³äº‰æŠ¢é—®é¢˜ï¼ŒRedis åˆ©ç”¨å…¶å•çº¿ç¨‹çš„ç‰¹æ€§ï¼Œå°†è¯·æ±‚å½¢æˆä»»åŠ¡é˜Ÿåˆ—, ä»è€Œè§£å†³å¤šä»»åŠ¡å¹¶å‘é—®é¢˜</code></pre><h4 id="12-5-8-3-LUA-è„šæœ¬-è§£å†³åº“å­˜é—ç•™-ä»£ç å®ç°"><a href="#12-5-8-3-LUA-è„šæœ¬-è§£å†³åº“å­˜é—ç•™-ä»£ç å®ç°" class="headerlink" title="12.5.8.3 LUA è„šæœ¬, è§£å†³åº“å­˜é—ç•™-ä»£ç å®ç°"></a>12.5.8.3 LUA è„šæœ¬, è§£å†³åº“å­˜é—ç•™-ä»£ç å®ç°</h4><p>1ã€ ç¼–å†™ lua è„šæœ¬æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨Luaè„šæœ¬å®Œæˆç§’æ€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecKillRedisByLua</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è€å¸ˆè¯´æ˜</span></span><br><span class="line"><span class="comment">     * 1. è¿™ä¸ªè„šæœ¬å­—ç¬¦ä¸²æ˜¯åœ¨luaè„šæœ¬ä¸Šä¿®æ”¹çš„, ä½†æ˜¯è¦æ³¨æ„ä¸å®Œå…¨æ˜¯å­—ç¬¦ä¸²å¤„ç†</span></span><br><span class="line"><span class="comment">     * 2. æ¯”å¦‚ : è¿™é‡Œæˆ‘å°±ä½¿ç”¨äº† \&quot; , è¿˜æœ‰æ¢è¡Œä½¿ç”¨äº† \r\n</span></span><br><span class="line"><span class="comment">     * 3. è¿™äº›éƒ½æ˜¯ç»†èŠ‚ï¼Œå¦‚æœä½ ç›´æ¥æŠŠluaè„šæœ¬ç²˜è´´è¿‡æ¥ï¼Œä¸å¥½ä½¿,ä¸€å®šè¦æ³¨æ„ç»†èŠ‚</span></span><br><span class="line"><span class="comment">     * 4. å¦‚æœå†™çš„ä¸æˆåŠŸï¼Œå°±åœ¨è€å¸ˆè¿™ä¸ªä»£ç ä¸Šä¿®æ”¹å³å¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="type">String</span> <span class="variable">secKillScript</span> <span class="operator">=</span> <span class="string">&quot;local userid=KEYS[1];\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;local ticketno=KEYS[2];\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;local stockKey=&#x27;sk:&#x27;..ticketno..\&quot;:ticket\&quot;;\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;local usersKey=&#x27;sk:&#x27;..ticketno..\&quot;:user\&quot;;\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;local userExists=redis.call(\&quot;sismember\&quot;,usersKey,userid);\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;if tonumber(userExists)==1 then \r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;   return 2;\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;end\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;local num= redis.call(\&quot;get\&quot; ,stockKey);\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;if tonumber(num)&lt;=0 then \r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;   return 0;\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;else \r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;   redis.call(\&quot;decr\&quot;,stockKey);\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;   redis.call(\&quot;sadd\&quot;,usersKey,userid);\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;end\r\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;return 1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä½¿ç”¨luaè„šæœ¬å®Œæˆç§’æ€çš„æ ¸å¿ƒæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">doSecKill</span><span class="params">(String uid,String ticketNo)</span> &#123;</span><br><span class="line">        <span class="comment">//å…ˆä»redisè¿æ¥æ± ï¼Œè·å–è¿æ¥</span></span><br><span class="line">        <span class="type">JedisPool</span> <span class="variable">jedisPoolInstance</span> <span class="operator">=</span> JedisPoolUtil.getJedisPoolInstance();</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> jedisPoolInstance.getResource();</span><br><span class="line">        <span class="comment">//å°±æ˜¯å°†luaè„šæœ¬è¿›è¡ŒåŠ è½½</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sha1</span> <span class="operator">=</span> jedis.scriptLoad(secKillScript);</span><br><span class="line">        <span class="comment">//evalshaæ˜¯æ ¹æ®æŒ‡å®šçš„ sha1æ ¡éªŒç , æ‰§è¡Œç¼“å­˜åœ¨æœåŠ¡å™¨çš„è„šæœ¬</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> jedis.evalsha(sha1, <span class="number">2</span>, uid, ticketNo);</span><br><span class="line">        <span class="type">String</span> <span class="variable">resString</span> <span class="operator">=</span> String.valueOf(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ ¹æ®luaè„šæœ¬æ‰§è¡Œè¿”å›çš„ç»“æœï¼Œåšç›¸åº”çš„å¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;0&quot;</span>.equals(resString)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¥¨å·²ç»å–å…‰äº†..&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;2&quot;</span>.equals(resString)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ä¸èƒ½é‡å¤è´­ä¹°..&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;1&quot;</span>.equals(resString)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æŠ¢è´­æˆåŠŸ&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è´­ç¥¨å¤±è´¥..&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="13-ä¸»ä»å¤åˆ¶"><a href="#13-ä¸»ä»å¤åˆ¶" class="headerlink" title="13 ä¸»ä»å¤åˆ¶"></a>13 ä¸»ä»å¤åˆ¶</h1><h2 id="13-1-ä¸»ä»å¤åˆ¶ä»‹ç»"><a href="#13-1-ä¸»ä»å¤åˆ¶ä»‹ç»" class="headerlink" title="13.1 ä¸»ä»å¤åˆ¶ä»‹ç»"></a>13.1 ä¸»ä»å¤åˆ¶ä»‹ç»</h2><h3 id="13-1-1-åˆ†æå•ä¸ª-Redis-çš„é—®é¢˜"><a href="#13-1-1-åˆ†æå•ä¸ª-Redis-çš„é—®é¢˜" class="headerlink" title="13.1.1 åˆ†æå•ä¸ª Redis çš„é—®é¢˜"></a>13.1.1 åˆ†æå•ä¸ª Redis çš„é—®é¢˜</h3><h3 id="13-1-2-ä¸€å›¾èƒœåƒè¨€"><a href="#13-1-2-ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="13.1.2 ä¸€å›¾èƒœåƒè¨€"></a>13.1.2 ä¸€å›¾èƒœåƒè¨€</h3><p>1ã€ Redis ä¸»ä»å¤åˆ¶çš„ç¤ºæ„å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230730230820880.png" alt="image-20230730230820880" style="zoom:67%;" /><p>2ã€å¯¹ä¸Šå›¾çš„è§£è¯»</p><ol><li><p>ä¸Šå›¾æè¿°äº†ä¸»æœºæ•°æ®æ›´æ–°å, è‡ªåŠ¨åŒæ­¥åˆ°å¤‡æœºçš„ master&#x2F;slaver æœºåˆ¶</p></li><li><p>Master ä»¥<strong>å†™</strong>ä¸ºä¸»ï¼ŒSlaver ä»¥<strong>è¯»</strong>ä¸ºä¸»</p></li><li><p>å¥½å¤„: è¯»å†™åˆ†ç¦», æå‡æ•ˆç‡ (ç†è§£: è¯»å†™åˆ†ç¦»å, å°†è¯»å’Œå†™æ“ä½œåˆ†å¸ƒåˆ°ä¸åŒçš„ Reids, å‡å°‘å•ä¸ª Redis çš„å‹åŠ›, æå‡æ•ˆç‡)</p></li><li><p>å¥½å¤„: å®¹ç¾å¿«é€Ÿæ¢å¤ (ç†è§£: <u>å¦‚æœæŸä¸ª slaver , ä¸èƒ½æ­£å¸¸å·¥ä½œ, å¯ä»¥åˆ‡æ¢åˆ°å¦ä¸€ä¸ª slaver</u>)</p></li><li><p>ä¸»ä»å¤åˆ¶, è¦æ±‚æ˜¯ <strong>1 ä¸»å¤šä»</strong>, ä¸èƒ½æœ‰å¤šä¸ª Master( ç†è§£: å¦‚æœæœ‰å¤šä¸ªä¸»æœåŠ¡å™¨ Master,é‚£ä¹ˆ slaver ä¸èƒ½ç¡®å®šå’Œå“ªä¸ª Master è¿›è¡ŒåŒæ­¥, å‡ºç°æ•°æ®ç´Šä¹±)</p></li><li><p>è¦è§£å†³ä¸»æœåŠ¡å™¨çš„é«˜å¯ç”¨æ€§, <u>å¯ä»¥ä½¿ç”¨ Redis é›†ç¾¤</u></p></li></ol><h2 id="13-2-æ­å»ºä¸€ä¸»å¤šä»"><a href="#13-2-æ­å»ºä¸€ä¸»å¤šä»" class="headerlink" title="13.2 æ­å»ºä¸€ä¸»å¤šä»"></a>13.2 æ­å»ºä¸€ä¸»å¤šä»</h2><p>1ã€ éœ€æ±‚è¯´æ˜</p><ol><li>æ­å»ºä¸»ä»å¤åˆ¶ç»“æ„</li><li>è¿™é‡Œæˆ‘ä»¬æ­å»º ä¸€ä¸»äºŒä»å³å¯, å…¶å®ƒ slaver å¯ä»¥ä¾æ­¤å®Œæˆ</li><li>åˆ†ææˆ‘æ­å»ºçš„æ€è·¯&#x2F;è®¤çœŸç†è§£</li></ol><p>æŠŠåŸæ¥çš„redis.confå¤åˆ¶ä¸‰ä»½ï¼Œåˆ†åˆ«è¿›è¡Œé…ç½®ï¼Œç”¨å®ƒä»¬æ¥å„è‡ªå¯åŠ¨redisæœåŠ¡ï¼Œå†é€šè¿‡æŒ‡ä»¤ï¼šã€Œslaveof <master_ip> <master_port>ã€æ¥è®¾ç½®ä¸»ä»å…³ç³»ï¼Œè¿™æ ·ä»¥åæˆ‘ä»¬å°±æ­å»ºå®Œæ¯•äº†</p><p>æ³¨æ„ï¼š</p><ul><li>æ­å»ºå®Œä»¥åï¼Œåœ¨ä¸»æœåŠ¡ä¸­æ·»åŠ ã€ä¿®æ”¹æ•°æ®ï¼Œå¯ä»¥åœ¨ä»æœåŠ¡å¤„è¯»å–</li><li>ä»æœåŠ¡æ— æ³•æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®ï¼Œåªèƒ½è¯»å–</li></ul><h2 id="13-3-ä¸»ä»å¤åˆ¶-åŸç†"><a href="#13-3-ä¸»ä»å¤åˆ¶-åŸç†" class="headerlink" title="13.3 ä¸»ä»å¤åˆ¶-åŸç†"></a>13.3 ä¸»ä»å¤åˆ¶-åŸç†</h2><p>1ã€ åŸç†ç¤ºæ„å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230730233615428.png" alt="image-20230730233615428" style="zoom: 67%;" /><p>2ã€è€å¸ˆè§£è¯»ä¸Šå›¾-ä¸»ä»å¤åˆ¶æµç¨‹</p><ul><li>Slave å¯åŠ¨æˆåŠŸè¿æ¥åˆ° master åä¼šå‘é€ä¸€ä¸ª <strong>sync å‘½ä»¤</strong></li><li>Master æ¥åˆ°å‘½ä»¤å¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œ åœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹å, master å°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ° slave,ä»¥å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥</li><li>slave æœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­, å³ <strong>å…¨é‡å¤åˆ¶</strong></li><li>Master æ•°æ®å˜åŒ–äº†, ä¼šå°†æ–°çš„æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™ slave, å®ŒæˆåŒæ­¥, å³ <strong>å¢é‡å¤åˆ¶</strong></li><li>ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥ master,ä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶)å°†è¢«è‡ªåŠ¨æ‰§è¡Œ</li></ul><p>æ€»ç»“ï¼š</p><p><strong><u>(ç¬¬ä¸€æ¬¡è¿ â€“&gt; å…¨é‡å¤åˆ¶ï¼›è¿ä¸Šåä¸»æœåŠ¡æ•°æ®å˜åŒ– â€“&gt; å¢é‡å¤åˆ¶ï¼›æ–­å¼€åé‡æ–°è¿ä¸Š â€“&gt; å…¨é‡å¤åˆ¶)</u></strong></p><h2 id="13-4-ä¸€ä¸»äºŒä»†"><a href="#13-4-ä¸€ä¸»äºŒä»†" class="headerlink" title="13.4 ä¸€ä¸»äºŒä»†"></a>13.4 ä¸€ä¸»äºŒä»†</h2><p>1ã€ å¦‚æœä»æœåŠ¡å™¨ down äº†, é‡æ–°å¯åŠ¨, ä»ç„¶å¯ä»¥è·å– Master çš„æœ€æ–°æ•°æ®</p><p>2ã€å¦‚æœä¸»æœåŠ¡å™¨ down äº†, <u>ä»æœåŠ¡å™¨å¹¶ä¸ä¼šæŠ¢å ä¸ºä¸»æœåŠ¡å™¨</u>, å½“ä¸»æœåŠ¡å™¨æ¢å¤å, ä»æœåŠ¡å™¨ä»ç„¶æŒ‡å‘åŸæ¥çš„ä¸»æœåŠ¡å™¨.</p><h2 id="13-5-è–ªç«ç›¸ä¼ "><a href="#13-5-è–ªç«ç›¸ä¼ " class="headerlink" title="13.5 è–ªç«ç›¸ä¼ "></a>13.5 è–ªç«ç›¸ä¼ </h2><p>1ã€ ç¤ºæ„å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731082350913.png" alt="image-20230731082350913" style="zoom:50%;" /><p>2ã€è€å¸ˆè§£è¯»ä¸Šå›¾</p><pre><code>1) ä¸Šä¸€ä¸ª Slave å¯ä»¥æ˜¯ä¸‹ä¸€ä¸ª slave çš„ Masterï¼ŒSlave åŒæ ·å¯ä»¥æ¥æ”¶å…¶ä»– slaves çš„è¿æ¥å’ŒåŒæ­¥è¯·æ±‚ï¼Œé‚£ä¹ˆè¯¥ &lt;u&gt;slave ä½œä¸ºäº†é“¾æ¡ä¸­ä¸‹ä¸€ä¸ªçš„ master, å¯ä»¥æœ‰æ•ˆå‡è½» master çš„å†™å‹åŠ›,&lt;/u&gt;å»ä¸­å¿ƒåŒ–é™ä½é£é™©1) ç”¨ **slaveof &lt;master_ip&gt;&lt;master_port&gt;     (ä»æœåŠ¡çš„ipã€port)**</code></pre><ol start="3"><li>é£é™©æ˜¯ä¸€æ—¦æŸä¸ª slave å®•æœºï¼Œåé¢çš„ slave éƒ½æ²¡æ³•åŒæ­¥</li><li>ä¸»æœºæŒ‚äº†ï¼Œä»æœºè¿˜æ˜¯ä»æœºï¼Œæ— æ³•å†™æ•°æ®äº†</li><li>ä½œä¸ºåˆ«äººmasterçš„ä»æœåŠ¡åªæ˜¯æ‹¥æœ‰äº†ä¸å…¶ä»æœåŠ¡åŒæ­¥æ•°æ®çš„èƒ½åŠ›ï¼Œå¹¶ä¸èƒ½ä¿®æ”¹æ•°æ®ï¼</li></ol><h2 id="13-6-åå®¢ä¸ºä¸»"><a href="#13-6-åå®¢ä¸ºä¸»" class="headerlink" title="13.6 åå®¢ä¸ºä¸»"></a>13.6 åå®¢ä¸ºä¸»</h2><p>1ã€ åœ¨è–ªç«ç›¸ä¼ çš„ç»“æ„ä¸‹, å½“ä¸€ä¸ª master å®•æœºå, <u>æŒ‡å‘ Master çš„ slave å¯ä»¥å‡ä¸º master, å…¶åé¢çš„ slave ä¸ç”¨åšä»»ä½•ä¿®æ”¹</u></p><p>2ã€ç”¨ slaveof no one å°†ä»æœºå˜ä¸ºä¸»æœº (è€éŸ©è¯´æ˜: åé¢å¯ä»¥ä½¿ç”¨å“¨å…µæ¨¡å¼, è‡ªåŠ¨å®Œæˆåˆ‡æ¢.)</p><h2 id="13-7-å“¨å…µæ¨¡å¼-sentinel"><a href="#13-7-å“¨å…µæ¨¡å¼-sentinel" class="headerlink" title="13.7 å“¨å…µæ¨¡å¼(sentinel)"></a>13.7 å“¨å…µæ¨¡å¼(sentinel)</h2><h3 id="13-7-1-å®ä¾‹æ¼”ç¤º"><a href="#13-7-1-å®ä¾‹æ¼”ç¤º" class="headerlink" title="13.7.1 å®ä¾‹æ¼”ç¤º"></a>13.7.1 å®ä¾‹æ¼”ç¤º</h3><p>1ã€ å·¥ä½œç¤ºæ„å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731083436662.png" alt="image-20230731083436662" style="zoom:50%;" /><p>2ã€å“¨å…µæ¨¡å¼(å¦‚å›¾): **<u>åå®¢ä¸ºä¸»çš„è‡ªåŠ¨ç‰ˆ</u>**ï¼Œèƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“</p><p>3ã€è€éŸ©å®éªŒ</p><p>â€‹1)è°ƒæ•´ä¸ºä¸€ä¸»äºŒä»†æ¨¡å¼ï¼Œ6379 å¸¦ç€ 6380ã€6381 , æ ¹æ®å‰é¢è®²è§£çš„è°ƒæ•´å³å¯</p><p>â€‹2)åˆ›å»º sentinel.conf , åå­—ä¸èƒ½ä¹±å†™, æŒ‰ç…§æŒ‡å®šçš„æ¥</p><p>â€‹<strong>å†™å…¥</strong>ï¼šsentinel monitor redis_master 127.0.0.1 6379 1</p><p>â€‹è¯´æ˜:</p><p>â€‹<strong>redis_master</strong> ä¸ºç›‘æ§å¯¹è±¡èµ·çš„æœåŠ¡å™¨åç§°</p><p>â€‹<strong>1</strong> è¡¨ç¤ºè‡³å°‘æœ‰å¤šå°‘ä¸ªå“¨å…µåŒæ„è¿ç§»çš„æ•°é‡, è¿™é‡Œæˆ‘é…ç½®1 è¡¨ç¤ºåªè¦æœ‰1ä¸ªå“¨å…µåŒæ„è¿ç§»å°±å¯ä»¥åˆ‡æ¢</p><p>â€‹3) å¯åŠ¨å“¨å…µ, æ³¨æ„çœ‹å“¨å…µçš„ç«¯å£æ˜¯ 26379</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731084427183.png" alt="image-20230731084427183"></p><p>â€‹4) å½“ä¸»æœºæŒ‚æ‰ï¼Œä»æœºé€‰ä¸¾ä¸­äº§ç”Ÿæ–°çš„ä¸»æœº</p><p>â€‹5) <strong><u>å¦‚æœåŸæ¥çš„ä¸»æœºé‡å¯, ä¼šè‡ªåŠ¨æˆä¸ºä»æœº</u></strong></p><h3 id="13-7-2-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#13-7-2-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="13.7.2 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>13.7.2 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><p>1ã€ åœ¨å“¨å…µæ¨¡å¼ä¸‹ï¼Œ ä¸»æœº down åçš„æ‰§è¡Œæµç¨‹åˆ†æ</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731084948786.png" alt="image-20230731084948786"></p><p>2ã€è§£è¯»ä¸Šå›¾ - å“¨å…µå¦‚ä½•åœ¨ä»æœºä¸­, æ¨é€‰æ–°çš„ Master ä¸»æœº, é€‰æ‹©çš„æ¡ä»¶ä¾æ¬¡ä¸º:</p><ol><li><strong>ä¼˜å…ˆçº§</strong>åœ¨ redis.conf ä¸­é»˜è®¤ï¼šreplica-priority 100ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</li><li><strong>åç§»é‡</strong>æ˜¯æŒ‡è·å¾—åŸä¸»æœºæ•°æ®çš„é‡, æ•°æ®é‡æœ€å…¨çš„ä¼˜å…ˆçº§é«˜</li><li>æ¯ä¸ª redis å®ä¾‹å¯åŠ¨åéƒ½ä¼šéšæœºç”Ÿæˆä¸€ä¸ª 40 ä½çš„ <strong>runid</strong>, å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</li></ol><h1 id="14-é›†ç¾¤"><a href="#14-é›†ç¾¤" class="headerlink" title="14 é›†ç¾¤"></a>14 é›†ç¾¤</h1><h2 id="14-1-ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤-é«˜å¯ç”¨æ€§"><a href="#14-1-ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤-é«˜å¯ç”¨æ€§" class="headerlink" title="14.1 ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤-é«˜å¯ç”¨æ€§"></a>14.1 ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤-é«˜å¯ç”¨æ€§</h2><p>1ã€ ç”Ÿäº§ç¯å¢ƒçš„å®é™…éœ€æ±‚å’Œé—®é¢˜</p><ul><li><strong>å®¹é‡ä¸å¤Ÿ</strong>ï¼Œredis å¦‚ä½•è¿›è¡Œæ‰©å®¹ï¼Ÿ</li><li><strong>å¹¶å‘</strong>å†™æ“ä½œï¼Œ redis å¦‚ä½•åˆ†æ‘Šï¼Ÿ</li><li>ä¸»ä»æ¨¡å¼ï¼Œè–ªç«ç›¸ä¼ æ¨¡å¼ï¼Œ<u>ä¸»æœºå®•æœºï¼Œä¼šå¯¼è‡´ ip åœ°å€å‘ç”Ÿå˜åŒ–ï¼Œåº”ç”¨ç¨‹åºä¸­é…ç½®éœ€è¦ä¿®æ”¹å¯¹åº”çš„ä¸»æœºåœ°å€ã€ç«¯å£ç­‰ä¿¡æ¯</u></li></ul><h3 id="2ã€ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆ-ä»£ç†ä¸»æœºæ¥è§£å†³"><a href="#2ã€ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆ-ä»£ç†ä¸»æœºæ¥è§£å†³" class="headerlink" title="2ã€ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆ-ä»£ç†ä¸»æœºæ¥è§£å†³"></a>2ã€ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆ-ä»£ç†ä¸»æœºæ¥è§£å†³</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731090153302.png" alt="image-20230731090153302"></p><p>è§£è¯»ä¸Šå›¾</p><ol><li><p>å®¢æˆ·ç«¯è¯·æ±‚å…ˆåˆ°ä»£ç†æœåŠ¡å™¨</p></li><li><p>ç”±ä»£ç†æœåŠ¡å™¨è¿›è¡Œ<strong>è¯·æ±‚è½¬å‘</strong>åˆ°å¯¹åº”çš„ä¸šåŠ¡å¤„ç†æœåŠ¡å™¨</p></li><li><p>ä¸ºäº†é«˜å¯ç”¨æ€§, ä»£ç†æœåŠ¡ã€A æœåŠ¡ã€B æœåŠ¡ã€C æœåŠ¡éƒ½éœ€è¦æ­å»ºä¸»ä»ç»“æ„(è‡³å°‘æ˜¯ä¸€ä¸»ä¸€ä»),è¿™æ ·å°±éœ€æ±‚æ­å»ºè‡³å°‘ 8 å°æœåŠ¡å™¨</p></li><li><p>è¿™ç§æ–¹æ¡ˆçš„ç¼ºç‚¹æ˜¯: <u>æˆæœ¬é«˜ï¼Œç»´æŠ¤å›°éš¾, å¦‚æœæ˜¯ä¸€ä¸»å¤šä», æˆæœ¬å°±ä¼šæ›´é«˜</u></p></li></ol><h3 id="3ã€redis3-0-æä¾›è§£å†³æ–¹æ¡ˆ-æ— ä¸­å¿ƒåŒ–é›†ç¾¤é…ç½®"><a href="#3ã€redis3-0-æä¾›è§£å†³æ–¹æ¡ˆ-æ— ä¸­å¿ƒåŒ–é›†ç¾¤é…ç½®" class="headerlink" title="3ã€redis3.0 æä¾›è§£å†³æ–¹æ¡ˆ-æ— ä¸­å¿ƒåŒ–é›†ç¾¤é…ç½®"></a>3ã€redis3.0 æä¾›è§£å†³æ–¹æ¡ˆ-æ— ä¸­å¿ƒåŒ–é›†ç¾¤é…ç½®</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731090351617.png" alt="image-20230731090351617"></p><p>è§£è¯»ä¸Šå›¾</p><pre><code>1) å„ä¸ª Redis æœåŠ¡ä»ç„¶é‡‡ç”¨ä¸»ä»ç»“æ„2) å„ä¸ª Redis æœåŠ¡æ˜¯è¿é€šçš„, **ä»»ä½•ä¸€å°æœåŠ¡å™¨, éƒ½å¯ä»¥ä½œä¸ºè¯·æ±‚å…¥å£**3) å„ä¸ª Redis æœåŠ¡å™¨å› ä¸ºæ˜¯è¿é€šçš„, å¯ä»¥è¿›è¡Œè¯·æ±‚è½¬å‘4) è¿™ç§æ–¹å¼, å°±æ— ä¸­å¿ƒåŒ–é›†ç¾¤é…ç½®, å¯ä»¥çœ‹åˆ°ï¼Œåªéœ€è¦ 6 å°æœåŠ¡å™¨å³å¯æå®š</code></pre><ol start="5"><li>æ— ä¸­å¿ƒåŒ–é›†ç¾¤é…ç½®, è¿˜ä¼šæ ¹æ® key å€¼, è®¡ç®— slot , æŠŠæ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„ä¸»æœº, ä»è€Œç¼“è§£å•ä¸ªä¸»æœºçš„å­˜å–å‹åŠ›.[åé¢è€å¸ˆä¼šæ¼”ç¤ºå’Œå†è¯´æ˜]</li><li>Redis æ¨èä½¿ç”¨æ— ä¸­å¿ƒåŒ–é›†ç¾¤é…ç½®</li><li>åœ¨å®é™…ç”Ÿæˆç¯å¢ƒ å„ä¸ª Redis æœåŠ¡å™¨, <u>åº”å½“éƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨</u>(é˜²æ­¢æœºå™¨å®•æœº, ä¸»ä»å¤åˆ¶å¤±æ•ˆ)</li></ol><h2 id="14-2-é›†ç¾¤ä»‹ç»"><a href="#14-2-é›†ç¾¤ä»‹ç»" class="headerlink" title="14.2 é›†ç¾¤ä»‹ç»"></a>14.2 é›†ç¾¤ä»‹ç»</h2><p>1ã€ Redis é›†ç¾¤å®ç°äº†å¯¹ Redis çš„æ°´å¹³æ‰©å®¹ï¼Œ å³å¯åŠ¨ N ä¸ª redis èŠ‚ç‚¹ï¼Œ å°†æ•´ä¸ªæ•°æ®åº“åˆ†å¸ƒå­˜å‚¨åœ¨è¿™ N ä¸ªèŠ‚ç‚¹ä¸­ï¼Œ æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ€»æ•°æ®çš„ 1&#x2F;Nã€‚</p><p>2ã€ Redis é›†ç¾¤é€šè¿‡åˆ†åŒºï¼ˆpartitionï¼‰ æ¥æä¾›ä¸€å®šç¨‹åº¦çš„<strong>å¯ç”¨æ€§</strong>ï¼ˆavailabilityï¼‰ï¼š å³ä½¿é›†ç¾¤ä¸­æœ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆæˆ–è€…æ— æ³•è¿›è¡Œé€šè®¯ï¼Œ é›†ç¾¤ä¹Ÿå¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚</p><h3 id="å®ç°ï¼š"><a href="#å®ç°ï¼š" class="headerlink" title="å®ç°ï¼š"></a>å®ç°ï¼š</h3><h4 id="1ã€ä¿®æ”¹ä¸»æœåŠ¡çš„confæ–‡ä»¶ä¸­çš„é…ç½®ï¼š"><a href="#1ã€ä¿®æ”¹ä¸»æœåŠ¡çš„confæ–‡ä»¶ä¸­çš„é…ç½®ï¼š" class="headerlink" title="1ã€ä¿®æ”¹ä¸»æœåŠ¡çš„confæ–‡ä»¶ä¸­çš„é…ç½®ï¼š"></a>1ã€ä¿®æ”¹ä¸»æœåŠ¡çš„confæ–‡ä»¶ä¸­çš„é…ç½®ï¼š</h4><p>â€‹cluster-enabled yes æ‰“å¼€é›†ç¾¤æ¨¡å¼</p><p>â€‹cluster-config-file nodes-6379.conf </p><p>â€‹è®¾å®šèŠ‚ç‚¹é…ç½®æ–‡ä»¶åcluster-node-timeout 15000 è®¾å®šèŠ‚ç‚¹å¤±è”æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé›†ç¾¤è‡ªåŠ¨è¿›è¡Œä¸»ä»åˆ‡æ¢</p><h4 id="2ã€å¯åŠ¨æœåŠ¡"><a href="#2ã€å¯åŠ¨æœåŠ¡" class="headerlink" title="2ã€å¯åŠ¨æœåŠ¡"></a>2ã€å¯åŠ¨æœåŠ¡</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731093504555.png" alt="image-20230731093504555"></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731093522619.png" alt="image-20230731093522619"></p><h4 id="3ã€å°†å…­ä¸ªèŠ‚ç‚¹åˆæˆä¸€ä¸ªé›†ç¾¤"><a href="#3ã€å°†å…­ä¸ªèŠ‚ç‚¹åˆæˆä¸€ä¸ªé›†ç¾¤" class="headerlink" title="3ã€å°†å…­ä¸ªèŠ‚ç‚¹åˆæˆä¸€ä¸ªé›†ç¾¤"></a>3ã€å°†å…­ä¸ªèŠ‚ç‚¹åˆæˆä¸€ä¸ªé›†ç¾¤</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731093608968.png" alt="image-20230731093608968"></p><p>å°†å…­ä¸ªèŠ‚ç‚¹åˆæˆä¸€ä¸ªé›†ç¾¤ çš„æŒ‡ä»¤:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster create --cluster-replicas 1 192.168.198.130:6379 192.168.198.130:6380 192.168.198.130:6381 192.168.198.130:6389192.168.198.130:6390 192.168.198.130:6391</span><br></pre></td></tr></table></figure><h5 id="æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h5><ol><li>ç»„åˆä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‰€æœ‰ redis å®ä¾‹å¯åŠ¨åï¼Œnodes-xxxx.conf æ–‡ä»¶éƒ½ç”Ÿæˆæ­£å¸¸</li><li>æ­¤å¤„ä¸è¦ç”¨ 127.0.0.1, è¯·ç”¨çœŸå® IP åœ°å€, åœ¨çœŸå®ç”Ÿäº§ç¯å¢ƒ, IP éƒ½æ˜¯ç‹¬ç«‹çš„.</li><li>replicas 1 é‡‡ç”¨æœ€ç®€å•çš„æ–¹å¼é…ç½®é›†ç¾¤ï¼Œä¸€å°ä¸»æœºï¼Œä¸€å°ä»æœºï¼Œæ­£å¥½ä¸‰ç»„</li><li>æ­å»ºé›†ç¾¤å¦‚æœæ²¡æœ‰æˆåŠŸ, æŠŠ sentinel è¿›ç¨‹ kill æ‰, å†è¯•ä¸€ä¸‹</li><li>åˆ†æä¸»ä»å¯¹åº”å…³ç³»</li></ol><h4 id="4ã€é›†ç¾¤æ–¹å¼ç™»å½•"><a href="#4ã€é›†ç¾¤æ–¹å¼ç™»å½•" class="headerlink" title="4ã€é›†ç¾¤æ–¹å¼ç™»å½•"></a>4ã€é›†ç¾¤æ–¹å¼ç™»å½•</h4><p>æŒ‡ä»¤: <strong>redis-cli -c -p 6379</strong></p><p>æŒ‡ä»¤: <strong><u>cluster nodes</u></strong> å‘½ä»¤æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯, ä¸»ä»çš„å¯¹åº”å…³ç³»</p><h3 id="14-3-2-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#14-3-2-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="14.3.2 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>14.3.2 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><p>1ã€ ä¸€ä¸ªé›†ç¾¤è‡³å°‘è¦æœ‰ä¸‰ä¸ªä¸»èŠ‚ç‚¹</p><p>2ã€ é€‰é¡¹ <strong>â€“cluster-replicas 1</strong> è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›ä¸ºé›†ç¾¤ä¸­çš„<u>æ¯ä¸ªä¸»èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªä»èŠ‚ç‚¹</u>ã€‚</p><p>3ã€ åˆ†é…åŸåˆ™ï¼š <u><strong>å°½é‡ä¿è¯ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨å„è‡ªè¿è¡Œåœ¨ä¸åŒçš„ IP åœ°å€(æœºå™¨), é˜²æ­¢æœºå™¨æ•…éšœå¯¼è‡´ä¸»ä»æœºåˆ¶å¤±æ•ˆ, é«˜å¯ç”¨æ€§å¾—ä¸åˆ°ä¿éšœ</strong></u></p><h2 id="14-4-Redis-é›†ç¾¤ä½¿ç”¨"><a href="#14-4-Redis-é›†ç¾¤ä½¿ç”¨" class="headerlink" title="14.4 Redis é›†ç¾¤ä½¿ç”¨"></a>14.4 Redis é›†ç¾¤ä½¿ç”¨</h2><p>1ã€ ä»€ä¹ˆæ˜¯ slots</p><p>1ï¼‰Redis é›†ç¾¤å¯åŠ¨å, ä½ ä¼šçœ‹åˆ°å¦‚ä¸‹æç¤º</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731094714287.png" alt="image-20230731094714287"></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731094732477.png" alt="image-20230731094732477"></p><p>2ï¼‰ä¸€ä¸ª Redis é›†ç¾¤åŒ…å« 16384 ä¸ªæ’æ§½ï¼ˆhash slotï¼‰ï¼Œç¼–å·ä» 0-16383, <u>Reids ä¸­çš„æ¯ä¸ªé”®éƒ½å±äºè¿™ 16384 ä¸ªæ’æ§½çš„å…¶ä¸­ä¸€ä¸ª</u></p><p>3ï¼‰é›†ç¾¤ä½¿ç”¨å…¬å¼ CRC16(key) % 16384 æ¥è®¡ç®—é”® key å±äºå“ªä¸ªæ§½ï¼Œ å…¶ä¸­ CRC16(key) è¯­å¥ç”¨äºè®¡ç®—é”® key çš„ CRC16 æ ¡éªŒå’Œ</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731094808015.png" alt="image-20230731094808015"></p><p>4)<u><strong>é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å¤„ç†ä¸€éƒ¨åˆ†æ’æ§½</strong></u>ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œ å¦‚æœä¸€ä¸ªé›†ç¾¤å¯ä»¥æœ‰ä¸»èŠ‚ç‚¹ï¼Œ å…¶ä¸­ï¼š</p><ul><li>èŠ‚ç‚¹ A è´Ÿè´£å¤„ç† 0 å·è‡³ 5460 å·æ’æ§½</li><li>èŠ‚ç‚¹ B è´Ÿè´£å¤„ç† 5461 å·è‡³ 10922 å·æ’æ§½</li><li>èŠ‚ç‚¹ C è´Ÿè´£å¤„ç† 10923 å·è‡³ 16383 å·æ’æ§½</li></ul><p>2ã€åœ¨é›†ç¾¤ä¸­å½•å…¥å€¼</p><p>1ï¼‰åœ¨ redis æ¯æ¬¡å½•å…¥ã€æŸ¥è¯¢é”®å€¼ï¼Œredis éƒ½ä¼šè®¡ç®—å‡ºè¯¥ key åº”è¯¥é€å¾€çš„æ’æ§½ï¼Œ<u>å¦‚æœä¸æ˜¯è¯¥å®¢æˆ·ç«¯å¯¹åº”æœåŠ¡å™¨çš„æ’æ§½ï¼Œredis ä¼šå‘ŠçŸ¥åº”å‰å¾€çš„ redis å®ä¾‹åœ°å€å’Œç«¯å£</u>ã€‚(å› ä¸ºä½ å¯ä»¥åœ¨é›†ç¾¤çš„ä»»æ„ç«¯å¯ç”¨redisæœåŠ¡)</p><p>2ï¼‰redis-cli å®¢æˆ·ç«¯æä¾›äº† â€“c å‚æ•°å®ç°<strong>è‡ªåŠ¨é‡å®šå‘</strong>ã€‚</p><p>3ï¼‰å¦‚ redis-cli -c â€“p 6379 ç™»å…¥åï¼Œå†å½•å…¥ã€æŸ¥è¯¢é”®å€¼å¯¹å¯ä»¥è‡ªåŠ¨é‡å®šå‘</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731095430316.png" alt="image-20230731095430316" style="zoom: 50%;" /><p>4ï¼‰**<u>ä¸åœ¨ä¸€ä¸ª slot ä¸‹çš„é”®å€¼</u>ï¼Œæ˜¯ä¸èƒ½ä½¿ç”¨ mget,mset ç­‰å¤šé”®æ“ä½œ**</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731095522774.png" alt="image-20230731095522774" style="zoom:50%;" /><p>5ï¼‰<strong>å¯ä»¥é€šè¿‡{}æ¥å®šä¹‰ç»„çš„æ¦‚å¿µï¼Œä»è€Œ<u>ä½¿ key ä¸­{}å†…ç›¸åŒå†…å®¹çš„é”®å€¼å¯¹æ”¾åˆ°ä¸€ä¸ª slot ä¸­</u>å»</strong>ï¼Œå¯ä»¥å¯¹ä¸€ä¸ªç»„çš„æ•°æ®è¿›è¡Œmgetç­‰å¤šé”®æ“ä½œ</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731095552328.png" alt="image-20230731095552328" style="zoom:50%;" /><p>3ã€<u>æŸ¥è¯¢é›†ç¾¤ä¸­çš„å€¼</u></p><p>1ï¼‰æŒ‡ä»¤: CLUSTER KEYSLOT <key> <strong>è¿”å› key å¯¹åº”çš„ slot å€¼</strong></p><p>2ï¼‰æŒ‡ä»¤: CLUSTER COUNTKEYSINSLOT <slot> <strong>è¿”å› slot æœ‰å¤šå°‘ä¸ª key</strong></p><p>3ï¼‰æŒ‡ä»¤: CLUSTER GETKEYSINSLOT <slot><count> <strong>è¿”å› count ä¸ª slot æ§½ä¸­çš„é”®</strong></p><p> <img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731100125306.png" alt="image-20230731100125306"></p><h2 id="14-5-Redis-é›†ç¾¤æ•…éšœæ¢å¤"><a href="#14-5-Redis-é›†ç¾¤æ•…éšœæ¢å¤" class="headerlink" title="14.5 Redis é›†ç¾¤æ•…éšœæ¢å¤"></a>14.5 Redis é›†ç¾¤æ•…éšœæ¢å¤</h2><p>1ã€ å¦‚æœä¸»èŠ‚ç‚¹ä¸‹çº¿, <u>ä»èŠ‚ç‚¹ä¼šè‡ªåŠ¨å‡ä¸ºä¸»èŠ‚ç‚¹</u>(æ³¨æ„ 15 ç§’è¶…æ—¶, å†è§‚å¯Ÿæ¯”è¾ƒå‡†ç¡®)</p><p>â€”æ˜¯è¯¥ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹æç”Ÿæˆmasterï¼Œè€Œä¸æ˜¯å…¶ä»–èŠ‚ç‚¹æ›¿ä»£è¿™ä¸ªèŠ‚ç‚¹</p><p>2ã€ä¸»èŠ‚ç‚¹æ¢å¤åï¼Œä¸»èŠ‚ç‚¹å›æ¥å˜æˆä»æœº</p><p>3ã€å¦‚æœæ‰€æœ‰æŸä¸€æ®µæ’æ§½çš„ä¸»ä»èŠ‚ç‚¹éƒ½å®•æ‰ï¼ŒRedis æœåŠ¡æ˜¯å¦è¿˜èƒ½ç»§ç»­, è¦æ ¹æ®ä¸åŒçš„é…ç½®è€Œè¨€</p><p>â€‹1ï¼‰å¦‚æœæŸä¸€æ®µæ’æ§½çš„ä¸»ä»éƒ½æŒ‚æ‰ï¼Œè€Œ <strong>cluster-require-full-coverage</strong> ä¸º yes ï¼Œé‚£ä¹ˆ ï¼Œæ•´ä¸ªé›†ç¾¤éƒ½æŒ‚æ‰</p><p>â€‹2ï¼‰å¦‚æœæŸä¸€æ®µæ’æ§½çš„ä¸»ä»éƒ½æŒ‚æ‰ï¼Œè€Œ <strong>cluster-require-full-coverage</strong> ä¸º no , é‚£ä¹ˆ, åªæ˜¯è¯¥æ’æ§½æ•°æ®ä¸èƒ½ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•å­˜å‚¨</p><p>â€‹3ï¼‰redis.conf ä¸­çš„å‚æ•° cluster-require-full-coverage</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731100749215.png" alt="image-20230731100749215"></p><h2 id="14-6-é›†ç¾¤çš„-Jedis-å¼€å‘"><a href="#14-6-é›†ç¾¤çš„-Jedis-å¼€å‘" class="headerlink" title="14.6 é›†ç¾¤çš„ Jedis å¼€å‘"></a>14.6 é›†ç¾¤çš„ Jedis å¼€å‘</h2><p>1ã€ å³ä½¿è¿æ¥çš„ä¸æ˜¯ä¸»æœºï¼Œ é›†ç¾¤ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸»æœºå­˜å‚¨ã€‚ ä¸»æœºå†™ï¼Œ ä»æœºè¯»ã€‚</p><p>2ã€æ— ä¸­å¿ƒåŒ–ä¸»ä»é›†ç¾¤ã€‚æ— è®ºä»å“ªå°ä¸»æœºå†™çš„æ•°æ®ï¼Œå…¶ä»–ä¸»æœºä¸Šéƒ½èƒ½è¯»åˆ°æ•°æ®</p><p>3ã€è€éŸ©å®éªŒ</p><p>â€‹1ï¼‰å°† Redis ç›¸å…³çš„ç«¯å£éƒ½æ‰“å¼€(é˜²ç«å¢™è®¾ç½®), å¦åˆ™ä¼šæŠ¥é”™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ“ä½œRedisé›†ç¾¤</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisCluster_</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 1. è¿™é‡Œçš„setå¯ä»¥åŠ å…¥å¤šä¸ªå…¥å£</span></span><br><span class="line"><span class="comment">         * 2. å› ä¸ºæˆ‘ä»¬æ²¡æœ‰åšæ—¥å¿—é…ç½®ï¼Œè¾“å‡ºæ—¶ï¼Œæœ‰äº›æç¤º,ä½†æ˜¯ä¸å½±å“ä½¿ç”¨</span></span><br><span class="line"><span class="comment">         * 3. å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é›†ç¾¤ï¼Œéœ€è¦æŠŠç›¸å…³çš„ç«¯å£éƒ½æ‰“å¼€ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment">         * 4. JedisClusterçš„æ„é€ å™¨æœ‰å¤šä¸ªï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¼ å…¥HostAndPort ä»£ç å¦‚ä¸‹</span></span><br><span class="line"><span class="comment">         * public JedisCluster(HostAndPort node) &#123;</span></span><br><span class="line"><span class="comment">         *         this(Collections.singleton(node));</span></span><br><span class="line"><span class="comment">         *     &#125;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Set&lt;HostAndPort&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;HostAndPort&gt;();</span><br><span class="line">        set.add(<span class="keyword">new</span> <span class="title class_">HostAndPort</span>(<span class="string">&quot;192.168.198.135&quot;</span>,<span class="number">6379</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">JedisCluster</span> <span class="variable">jedisCluster</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisCluster</span>(set);</span><br><span class="line">        jedisCluster.set(<span class="string">&quot;address&quot;</span>,<span class="string">&quot;bj~åŒ—äº¬&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> jedisCluster.get(<span class="string">&quot;address&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;address--&gt;&quot;</span> + address);</span><br><span class="line">        jedisCluster.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="14-7-Redis-é›†ç¾¤çš„ä¼˜ç¼ºç‚¹"><a href="#14-7-Redis-é›†ç¾¤çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="14.7 Redis é›†ç¾¤çš„ä¼˜ç¼ºç‚¹"></a>14.7 Redis é›†ç¾¤çš„ä¼˜ç¼ºç‚¹</h2><h3 id="14-7-1-ä¼˜ç‚¹"><a href="#14-7-1-ä¼˜ç‚¹" class="headerlink" title="14.7.1 ä¼˜ç‚¹"></a>14.7.1 ä¼˜ç‚¹</h3><p>â€‹1ã€ å®ç°æ‰©å®¹</p><p>â€‹2ã€åˆ†æ‘Šå‹åŠ›</p><p>â€‹3ã€æ— ä¸­å¿ƒé…ç½®ç›¸å¯¹ç®€å•</p><h3 id="14-7-2-ç¼ºç‚¹"><a href="#14-7-2-ç¼ºç‚¹" class="headerlink" title="14.7.2 ç¼ºç‚¹"></a>14.7.2 ç¼ºç‚¹</h3><p>â€‹1ã€ å¤šé”®æ“ä½œæ˜¯ä¸è¢«æ”¯æŒçš„</p><p>â€‹2ã€ å¤šé”®çš„ Redis äº‹åŠ¡æ˜¯ä¸è¢«æ”¯æŒçš„ã€‚ lua è„šæœ¬ä¸è¢«æ”¯æŒ</p><p>â€‹3ã€ ç”±äºé›†ç¾¤æ–¹æ¡ˆå‡ºç°è¾ƒæ™šï¼Œ å¾ˆå¤šå…¬å¸å·²ç»é‡‡ç”¨äº†å…¶ä»–çš„é›†ç¾¤æ–¹æ¡ˆï¼Œ è€Œå…¶å®ƒæ–¹æ¡ˆæƒ³è¦è¿ç§»è‡³ redis clusterï¼Œ éœ€è¦æ•´ä½“è¿ç§»è€Œä¸æ˜¯é€æ­¥è¿‡æ¸¡ï¼Œ å¤æ‚åº¦è¾ƒå¤§</p><h1 id="15-ç¼“å­˜ï¼š"><a href="#15-ç¼“å­˜ï¼š" class="headerlink" title="15 ç¼“å­˜ï¼š"></a>15 ç¼“å­˜ï¼š</h1><h2 id="15-1ç¼“å­˜ç©¿é€"><a href="#15-1ç¼“å­˜ç©¿é€" class="headerlink" title="15.1ç¼“å­˜ç©¿é€"></a>15.1ç¼“å­˜ç©¿é€</h2><h3 id="15-1-1ç¼“å­˜ç©¿é€çš„åŸå› "><a href="#15-1-1ç¼“å­˜ç©¿é€çš„åŸå› " class="headerlink" title="15.1.1ç¼“å­˜ç©¿é€çš„åŸå› "></a>15.1.1ç¼“å­˜ç©¿é€çš„åŸå› </h3><p>â€‹æŒ‡å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®åœ¨redisç¼“å­˜ä¸­å’Œæ•°æ®åº“ä¸­éƒ½ä¸å­˜åœ¨ï¼Œåœ¨redisä¸­æ‰¾ä¸åˆ°æ•°æ®ï¼Œè¿™äº›è¯·æ±‚éƒ½ä¼šæ‰“åˆ°æ•°æ®åº“ï¼Œå¯èƒ½å‹å®æ•°æ®åº“ã€‚</p><h3 id="15-1-2è§£å†³æ–¹æ¡ˆï¼š"><a href="#15-1-2è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="15.1.2è§£å†³æ–¹æ¡ˆï¼š"></a>15.1.2è§£å†³æ–¹æ¡ˆï¼š</h3><h4 id="ç¼“å­˜ç©ºå¯¹è±¡ï¼š"><a href="#ç¼“å­˜ç©ºå¯¹è±¡ï¼š" class="headerlink" title="ç¼“å­˜ç©ºå¯¹è±¡ï¼š"></a>ç¼“å­˜ç©ºå¯¹è±¡ï¼š</h4><p>â€‹æˆ‘ä»¬æŠŠæŸ¥ä¸åˆ°çš„æ•°æ®å½“ä½œnullå­˜åˆ°redisä¸­ï¼Œé˜²æ­¢å†å»æ•°æ®åº“ä¸­æ‰¾æ²¡æœ‰çš„å€¼ï¼›æˆ‘ä»¬éœ€è¦ç»™ç©ºç»“æœçš„è¿‡æœŸæ—¶é—´è®¾å¾—çŸ­ä¸€äº›ï¼Œé˜²æ­¢ä¸­é€”æ•°æ®åº“ä¸­äº§ç”Ÿäº†åˆšåˆšæŸ¥ä¸åˆ°çš„æ•°æ®ï¼Œä½†æ˜¯è¯·æ±‚ä¸€ç›´è¢«å¡åœ¨redisçš„æƒ…å†µ</p><p>â€‹ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç»´æŠ¤æ–¹ä¾¿</p><p>â€‹ç¼ºç‚¹ï¼šé¢å¤–çš„å†…å­˜æ¶ˆè€—ã€       å¯èƒ½é€ æˆçŸ­æœŸçš„ä¸ä¸€è‡´</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230416215655097.png" alt="image-20230416215655097" style="zoom:50%;" /><h4 id="è®¾ç½®å¯è®¿é—®çš„ç™½åå•"><a href="#è®¾ç½®å¯è®¿é—®çš„ç™½åå•" class="headerlink" title="è®¾ç½®å¯è®¿é—®çš„ç™½åå•"></a>è®¾ç½®å¯è®¿é—®çš„ç™½åå•</h4><p>â€‹åªè®©ä¸€äº›é€‰å®šçš„äººè®¿é—®ï¼Œé˜²æ­¢è¢«åˆ·</p><h4 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h4><p>â€‹ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨è¾ƒå°‘ï¼Œæ²¡æœ‰å¤šä½™key</p><p>â€‹ç¼ºç‚¹ï¼šå®ç°å¤æ‚ã€                  å­˜åœ¨è¯¯åˆ¤å¯èƒ½(hashå†²çª)</p><h4 id="è¿›è¡Œå®æ—¶ç›‘æ§"><a href="#è¿›è¡Œå®æ—¶ç›‘æ§" class="headerlink" title="è¿›è¡Œå®æ—¶ç›‘æ§"></a>è¿›è¡Œå®æ—¶ç›‘æ§</h4><p>â€‹å½“å‘ç°redisçš„å‘½ä¸­ç‡å¼€å§‹æ€¥é€Ÿé™ä½æ—¶ï¼Œéœ€è¦æ’æŸ¥è®¿é—®å¯¹è±¡å’Œè®¿é—®çš„æ•°æ®ï¼Œéœ€è¦ä¸“é—¨æ´¾äººç›‘ç£ï¼Œé…Œæƒ…ä½¿ç”¨é»‘åå•æˆ–é™åˆ¶æœåŠ¡</p><h2 id="15-2ç¼“å­˜å‡»ç©¿"><a href="#15-2ç¼“å­˜å‡»ç©¿" class="headerlink" title="15.2ç¼“å­˜å‡»ç©¿"></a>15.2ç¼“å­˜å‡»ç©¿</h2><h3 id="15-2-1ç¼“å­˜å‡»ç©¿çš„åŸå› "><a href="#15-2-1ç¼“å­˜å‡»ç©¿çš„åŸå› " class="headerlink" title="15.2.1ç¼“å­˜å‡»ç©¿çš„åŸå› "></a>15.2.1ç¼“å­˜å‡»ç©¿çš„åŸå› </h3><p>1ï¼‰<u>keyå¯¹åº”çš„æ•°æ®å­˜åœ¨ï¼Œä½†åœ¨redisä¸­è¿‡æœŸ</u>ï¼Œæ­¤æ—¶è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸï¼Œä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™æ—¶å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®</p><p>2ï¼‰æ¯”å¦‚æŸä¸ªçƒ­ç‚¹æ•°æ®ï¼Œå¯èƒ½ä¼šåœ¨æŸäº›æ—¶é—®ç‚¹ï¼Œè¢«è¶…é«˜å¹¶å‘åœ°è®¿é—®ï¼Œå®¹æ˜“å‡ºç°ç¼“å­˜å‡»ç©¿</p><h3 id="15-2-2ç¼“å­˜å‡»ç©¿çš„ç°è±¡-x2F-è¡¨è±¡"><a href="#15-2-2ç¼“å­˜å‡»ç©¿çš„ç°è±¡-x2F-è¡¨è±¡" class="headerlink" title="15.2.2ç¼“å­˜å‡»ç©¿çš„ç°è±¡&#x2F;è¡¨è±¡"></a>15.2.2ç¼“å­˜å‡»ç©¿çš„ç°è±¡&#x2F;è¡¨è±¡</h3><p>1)æ•°æ®åº“è®¿é—®å‹åŠ›ç¬æ—¶å¢åŠ </p><p>2)Redisé‡Œé¢<u>æ²¡æœ‰å‡ºç°å¤§é‡keyè¿‡æœŸ</u></p><p>3)Redisæ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œä½†æ˜¯æ•°æ®åº“å¯èƒ½ç˜«ç—ªäº†</p><h3 id="15-2-3è§£å†³æ–¹æ¡ˆ"><a href="#15-2-3è§£å†³æ–¹æ¡ˆ" class="headerlink" title="15.2.3è§£å†³æ–¹æ¡ˆ"></a>15.2.3è§£å†³æ–¹æ¡ˆ</h3><ul><li><p>é¢„å…ˆè®¾ç½®çƒ­é—¨æ•°æ®</p><ul><li>åœ¨redisé«˜å³°è®¿é—®ä¹‹å‰ï¼ŒæŠŠä¸€äº›æ•°æ®æå‰å­˜å…¥Reidsä¸­ï¼Œå¹¶åŠ å¤§è¿™äº›æ•°æ®çš„è¿‡æœŸæ—¶é—´</li></ul></li><li><p>å®æ—¶è°ƒæ•´</p><ul><li>ç°åœºç›‘æ§å“ªäº›æ•°æ®çƒ­é—¨ï¼Œå®æ—¶è°ƒæ•´keyçš„è¿‡æœŸæ—¶é•¿</li></ul></li><li><p>ä½¿ç”¨é”ï¼Œå¦‚å›¾ï¼š</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731145946233.png" alt="image-20230731145946233" style="zoom:50%;" /></li></ul><h2 id="15-3ç¼“å­˜é›ªå´©"><a href="#15-3ç¼“å­˜é›ªå´©" class="headerlink" title="15.3ç¼“å­˜é›ªå´©"></a>15.3ç¼“å­˜é›ªå´©</h2><h3 id="15-3-1ç¼“å­˜é›ªå´©çš„åŸå› "><a href="#15-3-1ç¼“å­˜é›ªå´©çš„åŸå› " class="headerlink" title="15.3.1ç¼“å­˜é›ªå´©çš„åŸå› "></a>15.3.1ç¼“å­˜é›ªå´©çš„åŸå› </h3><p>1ï¼‰keyå¯¹åº”çš„æ•°æ®å­˜åœ¨ï¼Œä½†åœ¨redisä¸­è¿‡æœŸï¼Œæ­¤æ—¶è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜</p><p>2ï¼‰è¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚</p><p>3ï¼‰ç¼“å­˜é›ªå´©ä¸ç¼“å­˜å‡»ç©¿çš„åŒºåˆ«åœ¨äºé›ªå´©é’ˆå¯¹å¾ˆå¤škeyç¼“å­˜åŒæ—¶è¿‡æœŸï¼Œå‰è€…åˆ™æ˜¯æŸä¸€ä¸ªkey</p><h3 id="15-3-2ç¼“å­˜é›ªå´©çš„ç°è±¡-x2F-è¡¨è±¡"><a href="#15-3-2ç¼“å­˜é›ªå´©çš„ç°è±¡-x2F-è¡¨è±¡" class="headerlink" title="15.3.2ç¼“å­˜é›ªå´©çš„ç°è±¡&#x2F;è¡¨è±¡"></a>15.3.2ç¼“å­˜é›ªå´©çš„ç°è±¡&#x2F;è¡¨è±¡</h3><p>1ï¼‰æ•°æ®åº“è®¿é—®å‹åŠ›å˜å¤§ï¼ŒæœåŠ¡å™¨å´©æºƒ</p><p>2ï¼‰åœ¨æçŸ­æ—¶é—´å†…ï¼Œè®¿é—®å¤§é‡Keyï¼Œè€Œ**<u>è¿™äº›Keyé›†ä¸­è¿‡æœŸ</u>**</p><h3 id="15-3-3è§£å†³æ–¹æ¡ˆ"><a href="#15-3-3è§£å†³æ–¹æ¡ˆ" class="headerlink" title="15.3.3è§£å†³æ–¹æ¡ˆ"></a>15.3.3è§£å†³æ–¹æ¡ˆ</h3><h5 id="1ï¼‰æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„"><a href="#1ï¼‰æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„" class="headerlink" title="1ï¼‰æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„"></a>1ï¼‰æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„</h5><p>nginxç¼“å­˜ï¼‹redisç¼“å­˜ ï¼‹å…¶ä»–ç¼“å­˜(ehcacheç­‰ï¼‰ï¼Œè¿™ç§æ–¹å¼å¼€å‘&#x2F; ç»´æŠ¤æˆæœ¬è¾ƒé«˜</p><h5 id="2ï¼‰ä½¿ç”¨é”æˆ–é˜Ÿåˆ—"><a href="#2ï¼‰ä½¿ç”¨é”æˆ–é˜Ÿåˆ—" class="headerlink" title="2ï¼‰ä½¿ç”¨é”æˆ–é˜Ÿåˆ—"></a>2ï¼‰ä½¿ç”¨é”æˆ–é˜Ÿåˆ—</h5><p>ç”¨åŠ é”æˆ–è€…é˜Ÿåˆ—çš„æ–¹å¼æ¥ä¿è¯ä¸ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹å¯¹æ•°æ®åº“ä¸€æ¬¡æ€§è¿›è¡Œè¯»å†™ï¼Œä»è€Œé¿å…å¤±æ•ˆæ—¶å¤§é‡çš„å¹¶å‘è¯·æ±‚è½åˆ°åº•å±‚å­˜å‚¨ç³»ç»Ÿä¸Šã€‚ä¸é€‚ç”¨é«˜å¹¶å‘æƒ…å†µã€‚</p><h5 id="3ï¼‰è®¾ç½®è¿‡æœŸæ ‡å¿—æ›´æ–°ç¼“å­˜"><a href="#3ï¼‰è®¾ç½®è¿‡æœŸæ ‡å¿—æ›´æ–°ç¼“å­˜" class="headerlink" title="3ï¼‰è®¾ç½®è¿‡æœŸæ ‡å¿—æ›´æ–°ç¼“å­˜"></a>3ï¼‰è®¾ç½®è¿‡æœŸæ ‡å¿—æ›´æ–°ç¼“å­˜</h5><p>è®°å½•ç¼“å­˜æ•°æ®æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸä¼šè§¦å‘é€šçŸ¥å¦å¤–çš„çº¿ç¨‹åœ¨åå°å»æ›´æ–°å®é™…keyçš„ç¼“å­˜ã€‚</p><h5 id="4ï¼‰å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€"><a href="#4ï¼‰å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€" class="headerlink" title="4ï¼‰å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€"></a>4ï¼‰å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€</h5><h2 id="15-4åˆ†å¸ƒå¼é”"><a href="#15-4åˆ†å¸ƒå¼é”" class="headerlink" title="15.4åˆ†å¸ƒå¼é”"></a>15.4åˆ†å¸ƒå¼é”</h2><p>1ã€å•ä½“å•æœºéƒ¨ç½²çš„ç³»ç»Ÿè¢«æ¼”åŒ–æˆåˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿåï¼Œ<u>ç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹å¹¶ä¸”åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šï¼Œè¿™å°†ä½¿åŸå•æœºéƒ¨ç½²æƒ…å†µä¸‹çš„å¹¶å‘æ§åˆ¶é”ç­–ç•¥å¤±æ•ˆ</u></p><p>3ã€å•çº¯çš„Java APIå¹¶ä¸èƒ½æä¾›åˆ†å¸ƒå¼é”çš„èƒ½åŠ›</p><p>4ã€ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å°±éœ€è¦ä¸€ç§è·¨JVMçš„äº’æ–¥æœºåˆ¶æ¥æ§åˆ¶å…±äº«èµ„æºçš„è®¿é—®ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”è¦è§£æ±ºçš„é—®é¢˜</p><p>5ã€ç¤ºæ„å›¾ï¼ˆè¯´æ˜ï¼šæˆ‘ä»¬æ¢è®¨çš„åˆ†å¸ƒå¼é”æ˜¯<u>é’ˆå¯¹åˆ†å¸ƒå¼é¡¹ç›®&#x2F;æ¶æ„</u>è€Œè¨€ï¼‰</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731151840509.png" alt="image-20230731151840509" style="zoom: 50%;" /><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731152158961.png" alt="image-20230731152158961"></p><h3 id="15-4-1åˆ†å¸ƒå¼é”ä¸»æµå®ç°æ–¹æ¡ˆï¼š"><a href="#15-4-1åˆ†å¸ƒå¼é”ä¸»æµå®ç°æ–¹æ¡ˆï¼š" class="headerlink" title="15.4.1åˆ†å¸ƒå¼é”ä¸»æµå®ç°æ–¹æ¡ˆï¼š"></a>15.4.1åˆ†å¸ƒå¼é”ä¸»æµå®ç°æ–¹æ¡ˆï¼š</h3><ul><li>åŸºäºæ•°æ®åº“å®ç°</li><li>åŸºäºç¼“å­˜(Redisç­‰)â€”â€”æ€§èƒ½æœ€é«˜</li><li>åŸºäºZookeeperâ€”â€”â€”-å¯é æ€§æœ€é«˜</li></ul><h4 id="Rediså®ç°åˆ†å¸ƒå¼é”"><a href="#Rediså®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="Rediså®ç°åˆ†å¸ƒå¼é”"></a>Rediså®ç°åˆ†å¸ƒå¼é”</h4><h5 id="å‘½ä»¤ï¼šsetnx-key-value"><a href="#å‘½ä»¤ï¼šsetnx-key-value" class="headerlink" title="å‘½ä»¤ï¼šsetnx key value"></a>å‘½ä»¤ï¼šsetnx key value</h5><p>â€‹é¦–å…ˆï¼Œå½“ç„¶æ˜¯æ­å»ºä¸€ä¸ªæœ€ç®€å•çš„å®ç°æ–¹å¼ï¼Œç›´æ¥ç”¨Redisçš„setnxå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤çš„è¯­æ³•æ˜¯ï¼š<strong>setnx key value</strong>å¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™ä¼šå°†keyè®¾ç½®ä¸ºvalueï¼Œ å¹¶è¿”å›1;å¦‚æœkeyå­˜åœ¨ï¼Œä¸ä¼šæœ‰ä»»åŠ¡å½±å“ï¼Œè¿”å›0ã€‚</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731155434255.png" alt="image-20230731155434255" style="zoom:50%;" /><h5 id="âš ï¸ï¼šä¸ºäº†é˜²æ­¢è·å–é”çš„æœåŠ¡æŒ‚æ‰ï¼Œå¯¼è‡´é”ä¸€ç›´ä¸è¢«é‡Šæ”¾ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºé”æ·»åŠ è¶…æ—¶æ—¶é—´"><a href="#âš ï¸ï¼šä¸ºäº†é˜²æ­¢è·å–é”çš„æœåŠ¡æŒ‚æ‰ï¼Œå¯¼è‡´é”ä¸€ç›´ä¸è¢«é‡Šæ”¾ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºé”æ·»åŠ è¶…æ—¶æ—¶é—´" class="headerlink" title="âš ï¸ï¼šä¸ºäº†é˜²æ­¢è·å–é”çš„æœåŠ¡æŒ‚æ‰ï¼Œå¯¼è‡´é”ä¸€ç›´ä¸è¢«é‡Šæ”¾ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºé”æ·»åŠ è¶…æ—¶æ—¶é—´"></a>âš ï¸ï¼šä¸ºäº†é˜²æ­¢è·å–é”çš„æœåŠ¡æŒ‚æ‰ï¼Œå¯¼è‡´é”ä¸€ç›´ä¸è¢«é‡Šæ”¾ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºé”æ·»åŠ è¶…æ—¶æ—¶é—´</h5><p>å‘½ä»¤ï¼š <strong>set key value nx ex seconds</strong>å…¶ä¸­nxè¡¨ç¤ºä¿è¯æ“ä½œçš„åŸå­æ€§ exè¡¨ç¤ºå¢åŠ äº†è¿‡æœŸæ—¶é—´ï¼Œsecondsä¸ºç§’æ•°</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731160005527.png" alt="image-20230731160005527" style="zoom:50%;" /><h5 id="âš ï¸ï¼šåŒæ ·çš„ä¸€æŠŠé”ï¼ŒæœåŠ¡Aå¯èƒ½æŒ‚æ‰æœåŠ¡Bçš„é”"><a href="#âš ï¸ï¼šåŒæ ·çš„ä¸€æŠŠé”ï¼ŒæœåŠ¡Aå¯èƒ½æŒ‚æ‰æœåŠ¡Bçš„é”" class="headerlink" title="âš ï¸ï¼šåŒæ ·çš„ä¸€æŠŠé”ï¼ŒæœåŠ¡Aå¯èƒ½æŒ‚æ‰æœåŠ¡Bçš„é”"></a>âš ï¸ï¼šåŒæ ·çš„ä¸€æŠŠé”ï¼ŒæœåŠ¡Aå¯èƒ½æŒ‚æ‰æœåŠ¡Bçš„é”</h5><p>å…·ä½“åœºæ™¯ï¼šAæŒæœ‰é”ï¼ŒAæ‰§è¡Œå…¶ä¸šåŠ¡ï¼Œä½†ç”±äºä¸šåŠ¡æµç¨‹é•¿æˆ–è€…ç½‘ç»œå»¶è¿Ÿå¯¼è‡´é”è¿‡æœŸäº†ï¼Œè¿™æ—¶å€™Bæ‹¿åˆ°äº†é”ï¼Œåœ¨Bè¿è¡Œä¸šåŠ¡æ—¶ï¼ŒAåšå®Œä¸šåŠ¡å›æ¥äº†ï¼å¹¶é‡Šæ”¾äº†é”ï¼è¿™å°±å¯¼è‡´äº†ä¸Šè¿°æƒ…æ™¯ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼šä¸ºğŸ”’åŠ ä¸Šowner</p><p>å‘½ä»¤ï¼š <strong>set key value  nx ex seconds</strong>â€”â€”-è¿™é‡Œéƒ½valueå°±æ˜¯ownerï¼ï¼ï¼ï¼</p><h5 id="âš ï¸ï¼šå¦‚æœä½ è·å–é”çš„æ—¶å€™è¿˜æ˜¯é”çš„ownerï¼Œä½†æ˜¯å› ä¸ºæ“ä½œä¸å…·æœ‰åŸå­æ€§ï¼Œæ­£å½“ä½ å‡†å¤‡åˆ é™¤æ—¶ï¼Œé”è¿‡æœŸäº†å¹¶ä¸”è¢«å…¶ä»–æœåŠ¡è·å–ï¼Œè¿™æ—¶æ‰§è¡Œåˆ é™¤ä¼šé€ æˆè¯¯åˆ ï¼"><a href="#âš ï¸ï¼šå¦‚æœä½ è·å–é”çš„æ—¶å€™è¿˜æ˜¯é”çš„ownerï¼Œä½†æ˜¯å› ä¸ºæ“ä½œä¸å…·æœ‰åŸå­æ€§ï¼Œæ­£å½“ä½ å‡†å¤‡åˆ é™¤æ—¶ï¼Œé”è¿‡æœŸäº†å¹¶ä¸”è¢«å…¶ä»–æœåŠ¡è·å–ï¼Œè¿™æ—¶æ‰§è¡Œåˆ é™¤ä¼šé€ æˆè¯¯åˆ ï¼" class="headerlink" title="âš ï¸ï¼šå¦‚æœä½ è·å–é”çš„æ—¶å€™è¿˜æ˜¯é”çš„ownerï¼Œä½†æ˜¯å› ä¸ºæ“ä½œä¸å…·æœ‰åŸå­æ€§ï¼Œæ­£å½“ä½ å‡†å¤‡åˆ é™¤æ—¶ï¼Œé”è¿‡æœŸäº†å¹¶ä¸”è¢«å…¶ä»–æœåŠ¡è·å–ï¼Œè¿™æ—¶æ‰§è¡Œåˆ é™¤ä¼šé€ æˆè¯¯åˆ ï¼"></a>âš ï¸ï¼šå¦‚æœä½ è·å–é”çš„æ—¶å€™è¿˜æ˜¯é”çš„ownerï¼Œä½†æ˜¯å› ä¸ºæ“ä½œä¸å…·æœ‰åŸå­æ€§ï¼Œæ­£å½“ä½ å‡†å¤‡åˆ é™¤æ—¶ï¼Œé”è¿‡æœŸäº†å¹¶ä¸”è¢«å…¶ä»–æœåŠ¡è·å–ï¼Œè¿™æ—¶æ‰§è¡Œåˆ é™¤ä¼šé€ æˆè¯¯åˆ ï¼</h5><p>ä¸šåŠ¡æ‰§è¡Œå®Œæˆä¹‹åï¼Œæ£€æŸ¥é”ã€åˆ é™¤é”è¿™äº›æ“ä½œä¸æ˜¯åŸå­åŒ–çš„ï¼Œè¿™ä¼šå¯¼è‡´ä¸Šè¿°æƒ…å†µå‘ç”Ÿ</p><p>æˆ‘ä»¬è¦æƒ³åŠæ³•æŠŠè¿™äº›æ“ä½œæ•´åˆæˆåŸå­æ“ä½œâ€”â€”Lua</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731161136468.png" alt="image-20230731161136468" style="zoom:50%;" /><h5 id="âš ï¸ï¼šå³ä¾¿è¿™æ ·ï¼Œå¯é æ€§è¿˜æ˜¯æ²¡æœ‰å¾—åˆ°ä¿è¯"><a href="#âš ï¸ï¼šå³ä¾¿è¿™æ ·ï¼Œå¯é æ€§è¿˜æ˜¯æ²¡æœ‰å¾—åˆ°ä¿è¯" class="headerlink" title="âš ï¸ï¼šå³ä¾¿è¿™æ ·ï¼Œå¯é æ€§è¿˜æ˜¯æ²¡æœ‰å¾—åˆ°ä¿è¯"></a>âš ï¸ï¼šå³ä¾¿è¿™æ ·ï¼Œå¯é æ€§è¿˜æ˜¯æ²¡æœ‰å¾—åˆ°ä¿è¯</h5><p>â€‹æˆ‘ä»¬å¯ä»¥ä¸ºredisé…ç½®ä»èŠ‚ç‚¹ã€å“¨å…µæ¨¡å¼ç­‰æ–¹å¼ä¸€å®šç¨‹åº¦ä¸Šæé«˜å¯é æ€§</p><p>æ²¡æœ‰å®Œå…¨å¯é çš„åˆ†å¸ƒå¼é”ï¼Œéœ€è¦ä¸ä¸šåŠ¡è”åŠ¨é…åˆï¼Œè¿›è¡Œå–èˆï¼Œé€‰æ‹©æœ€åˆé€‚çš„æ–¹æ¡ˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯å¼€å‘ç»„ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯å¼€å‘ç»„ä»¶ </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¶ˆæ¯é˜Ÿåˆ—</title>
      <link href="/2023/06/02/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
      <url>/2023/06/02/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h1><h2 id="1-MQçš„ç›¸å…³æ¦‚å¿µ-message-queue"><a href="#1-MQçš„ç›¸å…³æ¦‚å¿µ-message-queue" class="headerlink" title="1.MQçš„ç›¸å…³æ¦‚å¿µ(message queue)"></a>1.MQçš„ç›¸å…³æ¦‚å¿µ(message queue)</h2><h3 id="1-1ä»€ä¹ˆæ˜¯MQï¼š"><a href="#1-1ä»€ä¹ˆæ˜¯MQï¼š" class="headerlink" title="1.1ä»€ä¹ˆæ˜¯MQï¼š"></a>1.1ä»€ä¹ˆæ˜¯MQï¼š</h3><ul><li><p>â€‹æœ¬è´¨æ˜¯ä¸ªé˜Ÿåˆ—ï¼Œåªä¸è¿‡é˜Ÿåˆ—ä¸­çš„å†…å®¹æ˜¯messageè€Œå·²ï¼</p></li><li><p>â€‹ç”¨äºä¸Šä¸‹æ¸¸ä¼ é€’æ¶ˆæ¯</p></li></ul><h3 id="1-2ä¸ºä»€ä¹ˆè¦ä½¿ç”¨MQ"><a href="#1-2ä¸ºä»€ä¹ˆè¦ä½¿ç”¨MQ" class="headerlink" title="1.2ä¸ºä»€ä¹ˆè¦ä½¿ç”¨MQ"></a>1.2ä¸ºä»€ä¹ˆè¦ä½¿ç”¨MQ</h3><h4 id="1-æµé‡æ¶ˆå³°ï¼š"><a href="#1-æµé‡æ¶ˆå³°ï¼š" class="headerlink" title="1.æµé‡æ¶ˆå³°ï¼š"></a>1.æµé‡æ¶ˆå³°ï¼š</h4><p>â€‹åœ¨ç”¨æˆ·è®¿é—®ç³»ç»Ÿå‰æ·»åŠ MQï¼Œå¯¹è®¿é—®çš„æ¶ˆæ¯è¿›è¡Œæ’é˜Ÿï¼Œè™½ç„¶æ’é˜Ÿä¼šæ¶ˆè€—æ—¶é—´ä½†ä¸ä¼šå‡ºç°æµé‡è¿‡å¤§å¯¼è‡´æœåŠ¡å™¨å®•æœºçš„æƒ…å†µã€‚</p><h4 id="2-åº”ç”¨è§£è€¦ï¼š"><a href="#2-åº”ç”¨è§£è€¦ï¼š" class="headerlink" title="2.åº”ç”¨è§£è€¦ï¼š"></a>2.åº”ç”¨è§£è€¦ï¼š</h4><p>â€‹å¦‚æœæ²¡æœ‰MQï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨è®¢å•ç³»ç»Ÿä¸‹å•åï¼Œè®¢å•ç³»ç»Ÿä¼šç«‹å³è°ƒç”¨ç‰©æµç³»ç»Ÿï¼Œå¦‚æœç‰©æµç³»ç»Ÿæš‚æ—¶å‡ºæ•…éšœäº†ï¼Œé‚£ä¹ˆä¸‹å•æ“ä½œå°±ä¼šå¼‚å¸¸ã€‚</p><p>â€‹å¦‚æœä½¿ç”¨äº†MQï¼Œç”¨æˆ·åœ¨è®¢å•ç³»ç»Ÿä¸‹å•åï¼Œå¦‚æœç‰©æµç³»ç»Ÿæš‚æ—¶å‡ºæ•…éšœäº†ï¼Œç‰©æµç³»ç»Ÿéœ€è¦å¤„ç†çš„æ¶ˆæ¯ä¼šè¢«ç¼“å­˜åœ¨MQä¸­ï¼Œç­‰åˆ°ç‰©æµç³»ç»Ÿæ•…éšœä¿®å¤å®Œæˆï¼Œå°±å¯ä»¥ä»MQä¸­å–å‡ºå¾…å¤„ç†çš„ä¿¡æ¯ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·ä¸ä¼šæ„Ÿå—åˆ°ç‰©æµç³»ç»Ÿçš„æ•…éšœï¼Œå› æ­¤æå‡äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><h4 id="3-å¼‚æ­¥å¤„ç†ï¼š"><a href="#3-å¼‚æ­¥å¤„ç†ï¼š" class="headerlink" title="3.å¼‚æ­¥å¤„ç†ï¼š"></a>3.å¼‚æ­¥å¤„ç†ï¼š</h4><p>æœ‰äº›æœåŠ¡é—´è°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œä¾‹å¦‚ A è°ƒç”¨ Bï¼ŒB éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´æ‰§è¡Œï¼Œä½†æ˜¯ A éœ€è¦çŸ¥é“ B ä»€ä¹ˆæ—¶å€™å¯ä»¥æ‰§è¡Œå®Œã€‚</p><p>ä»¥å‰ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼ŒA è¿‡ä¸€æ®µæ—¶é—´å»è°ƒç”¨ B çš„æŸ¥è¯¢ api æŸ¥è¯¢ã€‚æˆ–è€… A æä¾›ä¸€ä¸ª callback apiï¼ŒB æ‰§è¡Œå®Œä¹‹åè°ƒç”¨ api é€šçŸ¥ A æœåŠ¡ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½ä¸æ˜¯å¾ˆä¼˜é›…ã€‚</p><p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å¾ˆæ–¹ä¾¿è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ A è°ƒç”¨ B æœåŠ¡åï¼Œåªéœ€è¦ç›‘å¬ B å¤„ç†å®Œæˆçš„æ¶ˆæ¯ï¼Œå½“ B å¤„ç†å®Œæˆåï¼Œä¼šå‘é€ä¸€æ¡æ¶ˆæ¯ç»™ MQï¼ŒMQ ä¼šå°†æ­¤æ¶ˆæ¯è½¬å‘ç»™ A æœåŠ¡ã€‚è¿™æ · A æœåŠ¡æ—¢ä¸ç”¨å¾ªç¯è°ƒç”¨ B çš„æŸ¥è¯¢ apiï¼Œä¹Ÿä¸ç”¨æä¾› callback apiã€‚åŒæ · B æœåŠ¡ä¹Ÿä¸ç”¨åšè¿™äº›æ“ä½œï¼ŒA æœåŠ¡è¿˜èƒ½åŠæ—¶çš„å¾—åˆ°å¼‚æ­¥å¤„ç†æˆåŠŸçš„æ¶ˆæ¯ã€‚</p><h2 id="2-RabbitMQ"><a href="#2-RabbitMQ" class="headerlink" title="2.RabbitMQ"></a>2.RabbitMQ</h2><h3 id="2-1-RabbitMQæ¦‚å¿µï¼š"><a href="#2-1-RabbitMQæ¦‚å¿µï¼š" class="headerlink" title="2.1 RabbitMQæ¦‚å¿µï¼š"></a>2.1 RabbitMQæ¦‚å¿µï¼š</h3><p>â€‹RabbitMQæ˜¯ä¸€ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œèƒ½å¤Ÿæ¥æ”¶ã€å­˜å‚¨å¹¶è½¬å‘æ¶ˆæ¯</p><h3 id="2-2-å››å¤§æ ¸å¿ƒæ¦‚å¿µï¼š"><a href="#2-2-å››å¤§æ ¸å¿ƒæ¦‚å¿µï¼š" class="headerlink" title="2.2 å››å¤§æ ¸å¿ƒæ¦‚å¿µï¼š"></a>2.2 å››å¤§æ ¸å¿ƒæ¦‚å¿µï¼š</h3><h4 id="ç”Ÿäº§è€…ï¼š"><a href="#ç”Ÿäº§è€…ï¼š" class="headerlink" title="ç”Ÿäº§è€…ï¼š"></a>ç”Ÿäº§è€…ï¼š</h4><p>â€‹äº§ç”Ÿæ•°æ®ï¼Œå‘é€æ¶ˆæ¯çš„ç¨‹åºæˆä¸ºç”Ÿäº§è€…</p><h4 id="äº¤æ¢æœºï¼š"><a href="#äº¤æ¢æœºï¼š" class="headerlink" title="äº¤æ¢æœºï¼š"></a>äº¤æ¢æœºï¼š</h4><p>â€‹æ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¹¶å°†æ¶ˆæ¯æ¨é€åˆ°é˜Ÿåˆ—ä¸­</p><p>â€‹ä¸€ä¸ªäº¤æ¢æœºå¯ä»¥ä¸å¤šä¸ªç‹¬ç«‹äº§ç”Ÿç»‘å®šå…³ç³»binding(äº¤æ¢æœºéœ€è¦çŸ¥é“å°†æ¶ˆæ¯æ¨é€ç»™ç‰¹å®šé˜Ÿåˆ—ã€å¤šä¸ªé˜Ÿåˆ—æˆ–æ˜¯ä¸¢å¼ƒâ€”ç”±äº¤æ¢æœºç±»å‹å†³å®š)</p><h4 id="é˜Ÿåˆ—ï¼š"><a href="#é˜Ÿåˆ—ï¼š" class="headerlink" title="é˜Ÿåˆ—ï¼š"></a>é˜Ÿåˆ—ï¼š</h4><p>â€‹é˜Ÿåˆ—  â€”â€“&gt;  ä¸€ä¸ªå¤§çš„æ¶ˆæ¯ç¼“å†²åŒº</p><p>â€‹å¤šä¸ªç”Ÿäº§è€…å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¸å¤šæ¶ˆè´¹è€…å¯ä»¥å°è¯•ä»ä¸€ä¸ªé˜Ÿåˆ—æ¥æ”¶æ•°æ®</p><h4 id="æ¶ˆè´¹è€…ï¼š"><a href="#æ¶ˆè´¹è€…ï¼š" class="headerlink" title="æ¶ˆè´¹è€…ï¼š"></a>æ¶ˆè´¹è€…ï¼š</h4><p>â€‹ç­‰å¾…æ¥æ”¶æ¶ˆæ¯çš„ç¨‹åº</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230426204426849.png" alt="image-20230426204426849"></p><h3 id="rebbitmqæœåŠ¡çš„ä½¿ç”¨ï¼š"><a href="#rebbitmqæœåŠ¡çš„ä½¿ç”¨ï¼š" class="headerlink" title="rebbitmqæœåŠ¡çš„ä½¿ç”¨ï¼š"></a>rebbitmqæœåŠ¡çš„ä½¿ç”¨ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">brew services start rabbitmq<span class="comment">//å¼€å¯æœåŠ¡</span></span><br><span class="line">brew services restart rabbitmq<span class="comment">//é‡å¯æœåŠ¡</span></span><br><span class="line">rabbitmqctl list_users<span class="comment">//æŸ¥çœ‹ç”¨æˆ·</span></span><br><span class="line">rabbitmqctl add_user admin <span class="number">123</span><span class="comment">//æ·»åŠ ç”¨æˆ·ç”¨æˆ·å:admin å¯†ç :123</span></span><br><span class="line">rabbitmqctl set_user_tags admin administrator<span class="comment">//å°† admin ç”¨æˆ· è®¾ç½®ä¸º administrator --&gt; è¶…çº§ç®¡ç†å‘˜</span></span><br><span class="line">rabbitmqctl set_permissions -p <span class="string">&quot;/&quot;</span> admin <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span><span class="comment">//ä¸ºadminç”¨æˆ·è®¾ç½®æƒé™</span></span><br><span class="line"></span><br><span class="line">rabbitMQå¯è§†åŒ–ç®¡ç†ç•Œé¢ï¼Œå³åå°ç®¡ç†ç•Œé¢åœ°å€ï¼šlocalhost:<span class="number">15672</span>        ip:<span class="number">15672</span></span><br></pre></td></tr></table></figure><h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h1><h2 id="å¼•å…¥ä¾èµ–ï¼š"><a href="#å¼•å…¥ä¾èµ–ï¼š" class="headerlink" title="å¼•å…¥ä¾èµ–ï¼š"></a>å¼•å…¥ä¾èµ–ï¼š</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ¶ˆæ¯ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯</p><h1 id="Work-Queues"><a href="#Work-Queues" class="headerlink" title="Work Queues"></a>Work Queues</h1><p>ä½¿ç”¨åœºæ™¯ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230427223442104.png" alt="image-20230427223442104"></p><p>â€‹</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯å¼€å‘ç»„ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯å¼€å‘ç»„ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼</title>
      <link href="/2023/06/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>/2023/06/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h6 id="å°šç¡…è°·è§†é¢‘çœ‹åˆ°P43"><a href="#å°šç¡…è°·è§†é¢‘çœ‹åˆ°P43" class="headerlink" title="å°šç¡…è°·è§†é¢‘çœ‹åˆ°P43"></a>å°šç¡…è°·è§†é¢‘çœ‹åˆ°P43</h6><h1 id="è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™ï¼š"><a href="#è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™ï¼š" class="headerlink" title="è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™ï¼š"></a>è®¾è®¡æ¨¡å¼ä¸ƒå¤§åŸåˆ™ï¼š</h1><h3 id="ç›®çš„ï¼š"><a href="#ç›®çš„ï¼š" class="headerlink" title="ç›®çš„ï¼š"></a>ç›®çš„ï¼š</h3><p>1ï¼‰ ä»£ç é‡ç”¨æ€§ï¼ˆå³ï¼šç›¸åŒåŠŸèƒ½çš„ä»£ç ï¼Œä¸ç”¨å¤šæ¬¡ç¼–å†™ï¼‰</p><p>2ï¼‰å¯è¯»æ€§ï¼ˆå³ï¼šç¼–ç¨‹è§„åˆ’æ€§ï¼Œä¾¿äºå…¶ä»–ç¨‹åºå‘˜çš„é˜…è¯»å’Œç†è§£ï¼‰</p><p>3ï¼‰å¯æ‰©å±•æ€§ï¼ˆå³ï¼šå½“éœ€è¦å¢åŠ æ–°çš„åŠŸèƒ½æ—¶ï¼Œéå¸¸çš„æ–¹ä¾¿ï¼Œç§°ä¸ºå¯ç»´æŠ¤)</p><p>4ï¼‰ å¯é æ€§ï¼ˆå³ï¼šå½“æˆ‘ä»¬å¢åŠ æ–°çš„åŠŸèƒ½åï¼Œå¯¹åŸæ¥çš„åŠŸèƒ½æ²¡æœ‰å½±å“ï¼‰</p><p>5ï¼‰ ä½¿ç¨‹åºå‘ˆç°é«˜å†…èšï¼Œä½è€¦åˆçš„ç‰¹æ€§</p><h3 id="å•ä¸€èŒè´£åŸåˆ™"><a href="#å•ä¸€èŒè´£åŸåˆ™" class="headerlink" title="å•ä¸€èŒè´£åŸåˆ™"></a>å•ä¸€èŒè´£åŸåˆ™</h3><p>â€‹ã€Œä¸€ä¸ªç±»åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€</p><p>å•ä¸€èŒè´£åŸåˆ™æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚ï¼š</p><p>â€‹1. é™ä½ç±»çš„å¤æ‚åº¦ï¼Œä¸€ä¸ªç±»åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€‚</p><p>â€‹2.æé«˜ç±»çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ã€‚</p><p>â€‹3.é™ä½å˜æ›´å¼•èµ·çš„é£é™©ã€‚</p><p>â€‹4.é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥éµå®ˆå•ä¸€èŒè´£åŸåˆ™ã€‚</p><p>â€‹ â€”â€”åªæœ‰<strong>é€»è¾‘è¶³å¤Ÿç®€å•</strong>æ—¶ï¼Œæ‰å¯ä»¥åœ¨<strong>ä»£ç çº§</strong>è¿åå•ä¸€èŒè´£åŸåˆ™ï¼›</p><p>â€‹ â€”â€”åªæœ‰ç±»å‹çš„<strong>æ–¹æ³•æ•°é‡è¶³å¤Ÿå°‘</strong>æ—¶ï¼Œæ‰å¯ä»¥æ‰<strong>æ–¹æ³•çº§åˆ«</strong>ä¿æŒå•ä¸€èŒè´£åŸåˆ™ã€‚</p><h3 id="æ¥å£éš”ç¦»åŸåˆ™"><a href="#æ¥å£éš”ç¦»åŸåˆ™" class="headerlink" title="æ¥å£éš”ç¦»åŸåˆ™"></a>æ¥å£éš”ç¦»åŸåˆ™</h3><p>å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ï¼Œ<strong>ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Š</strong>ã€‚</p><p>â€‹å› ä¸ºå¦‚æœä¸æ˜¯å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šï¼Œé‚£ä¹ˆå°±è¯´æ˜æœ‰å‡ ä¸ªæ¥å£ç™½ç™½è¢«å®ç°äº†(å®ç°ä½†æ˜¯æ²¡æœ‰è¢«ç”¨)ï¼Œè¿èƒŒäº†æ¥å£éš”ç¦»åŸåˆ™ï¼</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230523160645384.png" alt="image-20230523160645384" style="zoom:50%;" /><p>æ”¹è¿›åï¼šâ¬‡ï¸</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230523160702347.png" alt="image-20230523160702347" style="zoom:50%;" /><h3 id="ä¾èµ–å€’è½¬åŸåˆ™"><a href="#ä¾èµ–å€’è½¬åŸåˆ™" class="headerlink" title="ä¾èµ–å€’è½¬åŸåˆ™"></a>ä¾èµ–å€’è½¬åŸåˆ™</h3><ol><li><p>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥<strong>ä¾èµ–å…¶æŠ½è±¡</strong></p></li><li><p>æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡</p></li><li><p>ä¾èµ–å€’è½¬(å€’ç½®)çš„ä¸­å¿ƒæ€æƒ³æ˜¯<strong>ã€Œé¢å‘æ¥å£ç¼–ç¨‹ã€</strong></p></li><li><p>ä¾èµ–å€’è½¬åŸåˆ™æ˜¯åŸºäºè¿™æ ·çš„è®¾è®¡ç†å¿µï¼š<u>ç›¸å¯¹äºç»†èŠ‚çš„å¤šå˜æ€§ï¼ŒæŠ½è±¡çš„ä¸œè¥¿è¦ç¨³å®šçš„å¤šã€‚ä»¥æŠ½è±¡ä¸ºåŸºç¡€æ­å»ºçš„æ¶æ„æ¯”ä»¥ç»†èŠ‚ä¸ºåŸºç¡€çš„æ¶æ„è¦ç¨³å®šçš„å¤š</u>ã€‚åœ¨java ä¸­ï¼ŒæŠ½è±¡æŒ‡çš„æ˜¯æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œç»†èŠ‚å°±æ˜¯å…·ä½“çš„å®ç°ç±»</p></li><li><p>ä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»çš„ç›®çš„æ˜¯åˆ¶å®šå¥½è§„èŒƒï¼Œè€Œä¸æ¶‰åŠä»»ä½•å…·ä½“çš„æ“ä½œï¼ŒæŠŠå±•ç°ç»†èŠ‚çš„ä»»åŠ¡äº¤ç»™ä»–ä»¬çš„å®ç°ç±»å»å®Œæˆ</p></li></ol><p>ä¾èµ–å…³ç³»ä¼ é€’çš„ä¸‰ç§æ–¹å¼ï¼šä½ é€šè¿‡ä»€ä¹ˆæ–¹å¼æŠŠæ¥å£çš„å®ç°ç±»ä¼ ç»™ä½ è¦ä½¿ç”¨çš„ç±»</p><ul><li>æ¥å£ä¼ é€’(ç›´æ¥å°†å¯¹è±¡ä½œä¸ºæ–¹æ³•çš„å½¢å‚)</li><li>æ„é€ æ–¹æ³•ä¼ é€’(å°†å¯¹è±¡åœ¨æ„é€ æ—¶å­˜å…¥å¾…ä½¿ç”¨çš„ç±»)</li><li>setterä¼ é€’(setè¿›å»)</li></ul><p>æ³¨æ„äº‹é¡¹ï¼š</p><ol><li>ä½å±‚æ¨¡å—å°½é‡éƒ½è¦æœ‰æŠ½è±¡ç±»æˆ–æ¥å£ï¼Œæˆ–è€…ä¸¤è€…éƒ½æœ‰ï¼Œç¨‹åºç¨³å®šæ€§æ›´å¥½.</li><li>å˜é‡çš„å£°æ˜ç±»å‹å°½é‡æ˜¯æŠ½è±¡ç±»æˆ–æ¥å£ï¼Œè¿™æ ·æˆ‘ä»¬çš„å˜é‡å¼•ç”¨å’Œå®é™…å¯¹è±¡é—´ï¼Œå°±å­˜åœ¨ä¸€ä¸ªç¼“å†²å±‚ï¼Œåˆ©äºç¨‹åºæ‰©å±•å’Œä¼˜åŒ–</li><li>ç»§æ‰¿æ—¶éµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™</li></ol><h3 id="é‡Œæ°æ›¿æ¢åŸåˆ™"><a href="#é‡Œæ°æ›¿æ¢åŸåˆ™" class="headerlink" title="é‡Œæ°æ›¿æ¢åŸåˆ™"></a>é‡Œæ°æ›¿æ¢åŸåˆ™</h3><ol><li>ç»§æ‰¿åŒ…å«è¿™æ ·ä¸€å±‚å«ä¹‰ï¼šçˆ¶ç±»ä¸­å‡¡æ˜¯å·²ç»å®ç°å¥½çš„æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯åœ¨è®¾å®šè§„èŒƒå’Œå¥‘çº¦ï¼Œè™½ç„¶å®ƒä¸å¼ºåˆ¶è¦æ±‚æ‰€æœ‰çš„å­ç±»å¿…é¡»éµå¾ªè¿™äº›å¥‘çº¦ï¼Œ<strong>ä½†æ˜¯å¦‚æœå­ç±»å¯¹è¿™äº›å·²ç»å®ç°çš„æ–¹æ³•ä»»æ„ä¿®æ”¹ï¼Œå°±ä¼šå¯¹æ•´ä¸ªç»§æ‰¿ä½“ç³»é€ æˆç ´å</strong>ã€‚</li></ol><ol start="2"><li><strong>ç»§æ‰¿</strong>åœ¨ç»™ç¨‹åºè®¾è®¡å¸¦æ¥ä¾¿åˆ©çš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†å¼Šç«¯ã€‚æ¯”å¦‚ä½¿ç”¨ç»§æ‰¿ä¼šç»™ç¨‹åºå¸¦æ¥ä¾µå…¥æ€§ï¼Œç¨‹åºçš„å¯ç§»æ¤æ€§é™ä½ï¼Œ<strong>å¢åŠ å¯¹è±¡é—´çš„è€¦åˆæ€§</strong>ï¼Œå¦‚æœä¸€ä¸ªç±»è¢«å…¶ä»–çš„ç±»æ‰€ç»§æ‰¿ï¼Œåˆ™å½“è¿™ä¸ªç±»éœ€è¦ä¿®æ”¹æ—¶ï¼Œå¿…é¡»è€ƒè™‘åˆ°æ‰€æœ‰çš„å­ç±»ï¼Œå¹¶ä¸”çˆ¶ç±»ä¿®æ”¹åï¼Œæ‰€æœ‰æ¶‰åŠåˆ°å­ç±»çš„åŠŸèƒ½éƒ½æœ‰å¯èƒ½äº§ç”Ÿæ•…éšœ</li><li>é—®é¢˜æå‡ºï¼šåœ¨ç¼–ç¨‹ä¸­ï¼Œå¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨ç»§æ‰¿ï¼Ÿ&#x3D;ï¼é‡Œæ°æ›¿æ¢åŸåˆ™</li></ol><p>é‡Œæ°æ›¿æ¢åŸåˆ™çš„å«ä¹‰ï¼šæ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹éƒ½èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»</p><p>â€‹â€”â€”å­ç±»å°½é‡ä¸é‡å†™çˆ¶ç±»çš„æ–¹æ³•(é‡å†™åæ— æ³•æ»¡è¶³é‡Œæ°æ›¿æ¢åŸåˆ™)</p><p>â€‹â€”â€”å¦‚æœä½ ç»§æ‰¿äº†ç„¶åè¿˜é‡å†™ï¼Œé‚£ä½ ä½•å¿…ç»§æ‰¿å‘¢ï¼Ÿï¼ˆé™¤éè¿«ä¸å¾—å·²ï¼Œä¸è¦é‡å†™çˆ¶ç±»æ–¹æ³•ï¼‰</p><p>åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šé€šè¿‡é‡å†™çˆ¶ç±»çš„æ–¹æ³•å®Œæˆæ–°çš„åŠŸèƒ½ï¼Œè¿™æ ·å†™èµ·æ¥è™½ç„¶ç®€å•ï¼Œä½†æ•´ä¸ªç»§æ‰¿ä½“ç³»çš„å¤ç”¨æ€§æ¯”è¾ƒå·®ã€‚ç‰¹åˆ«æ˜¯è¿è¡Œå¤šæ€æ¯”è¾ƒé¢‘ç¹çš„æ—¶å€™ã€‚</p><p>é€šç”¨çš„åšæ³•æ˜¯ï¼š<strong>åŸæ¥çš„çˆ¶ç±»å’Œå­ç±»éƒ½ç»§æ‰¿ä¸€ä¸ªæ›´é€šä¿—çš„åŸºç±»ï¼ŒåŸæœ‰çš„ç»§æ‰¿å…³ç³»å»æ‰</strong>ï¼Œé‡‡ç”¨ä¾èµ–ï¼Œèšåˆï¼Œç»„åˆç­‰</p><p>å…³ç³»ä»£æ›¿.</p><h3 id="å¼€é—­åŸåˆ™"><a href="#å¼€é—­åŸåˆ™" class="headerlink" title="å¼€é—­åŸåˆ™"></a>å¼€é—­åŸåˆ™</h3><ul><li><p>æ˜¯ç¼–ç¨‹ä¸­æœ€åŸºç¡€ã€æœ€é‡è¦çš„è®¾è®¡åŸåˆ™</p></li><li><p>ä¸€ä¸ªè½¯ä»¶å®ä½“å¦‚ç±»ï¼Œæ¨¡å—å’Œå‡½æ•°åº”è¯¥<u><strong>å¯¹æ‰©å±•å¼€æ”¾(å¯¹æä¾›æ–¹)<strong>ï¼Œ</strong>å¯¹ä¿®æ”¹å…³é—­(å¯¹ä½¿ç”¨æ–¹)</strong></u>ã€‚ç”¨æŠ½è±¡æ„å»ºæ¡†æ¶ï¼Œç”¨å®ç°æ‰©å±•ç»†èŠ‚ã€‚</p></li><li><p>å½“è½¯ä»¶éœ€è¦å˜åŒ–æ—¶ï¼Œå°½é‡é€šè¿‡<u><em><strong>æ‰©å±•</strong></em></u>è½¯ä»¶å®ä½“çš„è¡Œä¸ºæ¥å®ç°å˜åŒ–ï¼Œè€Œ<strong>ä¸æ˜¯</strong>é€šè¿‡<strong>ä¿®æ”¹</strong>å·²æœ‰çš„ä»£ç æ¥å®ç°å˜åŒ–ã€‚</p></li><li><p><u>ç¼–ç¨‹ä¸­éµå¾ªå…¶å®ƒåŸåˆ™ï¼Œä»¥åŠä½¿ç”¨è®¾è®¡æ¨¡å¼çš„ç›®çš„å°±æ˜¯éµå¾ªå¼€é—­åŸåˆ™ã€‚</u></p></li></ul><h3 id="è¿ªç±³ç‰¹æ³•åˆ™"><a href="#è¿ªç±³ç‰¹æ³•åˆ™" class="headerlink" title="è¿ªç±³ç‰¹æ³•åˆ™"></a>è¿ªç±³ç‰¹æ³•åˆ™</h3><p>â€‹åŸºæœ¬ä»‹ç»</p><ol><li><p>ä¸€ä¸ªå¯¹è±¡åº”è¯¥<strong>å¯¹å…¶ä»–å¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£</strong></p></li><li><p>ç±»ä¸ç±»å…³ç³»è¶Šå¯†åˆ‡ï¼Œè€¦åˆåº¦è¶Šå¤§</p></li><li><p>è¿ªç±³ç‰¹æ³•åˆ™(Demeter Principle)åˆå«æœ€å°‘çŸ¥é“åŸåˆ™ï¼Œå³ä¸€ä¸ªç±»å¯¹è‡ªå·±ä¾èµ–çš„ç±»çŸ¥é“çš„è¶Šå°‘è¶Šå¥½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºè¢«ä¾èµ–çš„ç±»ä¸ç®¡å¤šä¹ˆå¤æ‚ï¼Œéƒ½å°½é‡å°†é€»è¾‘å°è£…åœ¨ç±»çš„å†…éƒ¨ã€‚å¯¹å¤–é™¤äº†æä¾›çš„ public æ–¹æ³•ï¼Œä¸å¯¹å¤–æ³„éœ²ä»»ä½•ä¿¡æ¯</p></li><li><p>è¿ªç±³ç‰¹æ³•åˆ™è¿˜æœ‰ä¸ªæ›´ç®€å•çš„å®šä¹‰ï¼šåªä¸ç›´æ¥çš„æœ‹å‹é€šä¿¡</p></li><li><p>ç›´æ¥çš„æœ‹å‹ï¼šæ¯ä¸ªå¯¹è±¡éƒ½ä¼šä¸å…¶ä»–å¯¹è±¡æœ‰è€¦åˆå…³ç³»ï¼Œåªè¦ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æœ‰è€¦åˆå…³ç³»ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´</p></li></ol><p>æ˜¯æœ‹å‹å…³ç³»ã€‚è€¦åˆçš„æ–¹å¼å¾ˆå¤šï¼Œä¾èµ–ï¼Œå…³è”ï¼Œç»„åˆï¼Œèšåˆç­‰ã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬ç§°å‡ºç°<strong>æˆå‘˜å˜é‡ï¼Œæ–¹æ³•å‚æ•°ï¼Œæ–¹æ³•è¿”</strong></p><p><strong>å›å€¼</strong>ä¸­çš„ç±»ä¸º<u>ç›´æ¥çš„æœ‹å‹</u>ï¼Œè€Œå‡ºç°åœ¨<strong>å±€éƒ¨å˜é‡ä¸­çš„ç±»</strong>ä¸æ˜¯ç›´æ¥çš„æœ‹å‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ**<u>ã€Œé™Œç”Ÿçš„ç±»æœ€å¥½ä¸è¦ä»¥å±€éƒ¨å˜</u>**</p><p>**<u>é‡çš„å½¢å¼å‡ºç°åœ¨ç±»çš„å†…éƒ¨ã€</u>**ã€‚</p><h3 id="åˆæˆå¤ç”¨åŸåˆ™"><a href="#åˆæˆå¤ç”¨åŸåˆ™" class="headerlink" title="åˆæˆå¤ç”¨åŸåˆ™"></a>åˆæˆå¤ç”¨åŸåˆ™</h3><p>â€‹<strong>åŸåˆ™æ˜¯å°½é‡ä½¿ç”¨åˆæˆ&#x2F;èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿</strong>(å› ä¸ºç»§æ‰¿ä¼šå¢åŠ è€¦åˆæ€§)</p><p>åœºæ™¯ï¼šæƒ³è®©Bä½¿ç”¨Aä¸­çš„æ–¹æ³•ï¼š</p><p>â€‹æˆ‘ä»¬å½“ç„¶å¯ä»¥è®©Bç»§æ‰¿Aï¼Œä½†æ˜¯è¿™æ ·ä¼šè®©Aä¸Bçš„è€¦åˆæ€§å¢å¼º</p><p>â€‹æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li>ä¾èµ–ï¼šåœ¨Bä¸­æ·»åŠ ä»¥Aä¸ºå½¢å‚çš„æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ä½¿ç”¨A</li><li>èšåˆï¼šå°†Aä½œä¸ºBç±»ä¸­çš„ä¸€ä¸ªæˆå‘˜å˜é‡(æ„é€ å‡½æ•°&#x2F;setæ–¹æ³•)ï¼Œåœ¨Bçš„ä»»æ„æ–¹æ³•ä¸­ä½¿ç”¨A</li><li>ç»„åˆï¼šå°†Aä½œä¸ºBç±»ä¸­çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œåœ¨åˆ›å»ºBçš„æ—¶å€™ç›´æ¥new A(), newä¸€ä¸ª</li></ul><h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>â€‹è®¾è®¡åŸåˆ™çš„æ ¸å¿ƒæ€æƒ³ï¼š</p><ul><li>æ‰¾å‡ºåº”ç”¨ä¸­çš„<strong>å¯èƒ½éœ€è¦å˜åŒ–ä¹‹å¤„</strong>ï¼ŒæŠŠä»–ä»¬<strong>ç‹¬ç«‹</strong>å‡ºæ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åœ¨ä¸€èµ·</li><li><strong>é’ˆå¯¹æ¥å£ç¼–ç¨‹</strong>ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹</li><li>ä¸ºäº†äº¤äº’å¯¹è±¡ä¹‹é—´çš„<strong>æ¾è€¦åˆè®¾è®¡</strong>è€ŒåŠªåŠ›</li></ul><p></p><p>â€‹</p><h1 id="UMLå›¾ï¼š"><a href="#UMLå›¾ï¼š" class="headerlink" title="UMLå›¾ï¼š"></a>UMLå›¾ï¼š</h1><ul><li><p>UMLâ€”Unified modeling language UML(ç»Ÿä¸€å»ºæ¨¡è¯­è¨€)ï¼Œæ˜¯ä¸€ç§<strong>ç”¨äºè½¯ä»¶ç³»ç»Ÿåˆ†æå’Œè®¾è®¡çš„è¯­è¨€å·¥å…·</strong>ï¼Œå®ƒç”¨äºå¸®åŠ©è½¯ä»¶å¼€å‘äººå‘˜è¿›è¡Œæ€è€ƒå’Œè®°å½•æ€è·¯çš„ç»“æœ</p></li><li><p>UML æœ¬èº«æ˜¯ä¸€å¥—ç¬¦å·çš„è§„å®šï¼Œå°±åƒæ•°å­¦ç¬¦å·å’ŒåŒ–å­¦ç¬¦å·ä¸€æ ·ï¼Œè¿™äº›ç¬¦å·ç”¨äºæè¿°è½¯ä»¶æ¨¡å‹ä¸­çš„å„ä¸ªå…ƒç´ å’Œä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼Œæ¯”å¦‚<strong>ç±»ã€æ¥å£ã€å®ç°ã€æ³›åŒ–ã€ä¾èµ–ã€ç»„åˆã€èšåˆ</strong>ç­‰</p></li></ul><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230524002012376.png" alt="image-20230524002012376" style="zoom:50%;" /><ol><li>ç”¨ä¾‹å›¾(use case)</li><li>é™æ€ç»“æ„å›¾ï¼š<strong>ç±»å›¾</strong>ã€å¯¹è±¡å›¾ã€åŒ…å›¾ã€ç»„ä»¶å›¾ã€éƒ¨ç½²å›¾</li><li>åŠ¨æ€è¡Œä¸ºå›¾ï¼šäº¤äº’å›¾(æ—¶åºå›¾ä¸åä½œå›¾ï¼‰ã€çŠ¶æ€å›¾ã€æ´»åŠ¨å›¾</li></ol><p>ç±»å›¾ç”¨äºæè¿°ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯UMLå›¾ä¸­çš„æ ¸å¿ƒ</p><h2 id="UMLç±»å›¾"><a href="#UMLç±»å›¾" class="headerlink" title="UMLç±»å›¾"></a>UMLç±»å›¾</h2><p>1ï¼‰ ç”¨äºæè¿°ç³»ç»Ÿä¸­çš„<strong>ç±»(å¯¹è±¡)æœ¬èº«çš„ç»„æˆ</strong>å’Œ<strong>ç±»(å¯¹è±¡)ä¹‹é—´çš„å„ç§é™æ€å…³ç³»</strong>ã€‚</p><p>2ï¼‰ ç±»ä¹‹é—´çš„å…³ç³»ï¼šä¾èµ–ã€æ³›åŒ–(ç»§æ‰¿)ã€å®ç°ã€å…³è”ã€èšåˆä¸ç»„åˆã€‚</p><h3 id="ä¾èµ–å…³ç³»ï¼š"><a href="#ä¾èµ–å…³ç³»ï¼š" class="headerlink" title="ä¾èµ–å…³ç³»ï¼š"></a>ä¾èµ–å…³ç³»ï¼š</h3><p>â€‹å¦‚æœAç±»ç”¨åˆ°äº†Bï¼Œåˆ™Aä¸Bå­˜åœ¨ä¾èµ–å…³ç³»ï¼ˆå¦‚æœæ²¡æœ‰å¯¹æ–¹ï¼Œå°±æ— æ³•ç¼–è¯‘é€šè¿‡ï¼‰</p><ul><li>ä½œä¸ºAçš„æˆå‘˜å±æ€§</li><li>æ˜¯Aä¸­æ–¹æ³•çš„è¿”å›ç±»å‹</li><li>æ˜¯Aä¸­æ–¹æ³•çš„æ¥æ”¶ç±»å‹(å½¢å‚ç±»å‹)</li><li>åœ¨Açš„æ–¹æ³•ä¸­ä½¿ç”¨åˆ°(ä½œä¸ºå±€éƒ¨å˜é‡)</li></ul><p>â€‹<u>ç”¨<strong>è™šçº¿ç®­å¤´</strong>æè¿°å…³ç³»</u></p><h3 id="æ³›åŒ–å…³ç³»ï¼š"><a href="#æ³›åŒ–å…³ç³»ï¼š" class="headerlink" title="æ³›åŒ–å…³ç³»ï¼š"></a>æ³›åŒ–å…³ç³»ï¼š</h3><p>â€‹å³ç»§æ‰¿å…³ç³»ï¼Œæ˜¯ä¾èµ–å…³ç³»çš„ç‰¹ä¾‹</p><p><u>ç”¨<strong>å®çº¿+ç©ºå¿ƒä¸‰è§’å½¢</strong>æè¿°</u></p><h3 id="å®ç°å…³ç³»ï¼š"><a href="#å®ç°å…³ç³»ï¼š" class="headerlink" title="å®ç°å…³ç³»ï¼š"></a>å®ç°å…³ç³»ï¼š</h3><p>â€‹å³æ¥å£çš„å®ç°å…³ç³»ï¼Œä¹Ÿæ˜¯ä¾èµ–å…³ç³»çš„ç‰¹ä¾‹<br><u>ç”¨<strong>è™šçº¿+ç©ºå¿ƒä¸‰è§’å½¢</strong>æè¿°</u></p><h3 id="å…³è”å…³ç³»ï¼š"><a href="#å…³è”å…³ç³»ï¼š" class="headerlink" title="å…³è”å…³ç³»ï¼š"></a>å…³è”å…³ç³»ï¼š</h3><p>â€‹æŒ‡ç±»ä¸ç±»ä¹‹é—´çš„è”ç³»ï¼Œæ˜¯ä¾èµ–å…³ç³»çš„ç‰¹ä¾‹</p><p>ç”¨äºæè¿°ä¸¤ä¸ªç±»ä¹‹é—´çš„å…³ç³»æ˜¯<strong>å•å‘</strong>è¿˜æ˜¯<strong>åŒå‘</strong>çš„</p><h3 id="èšåˆå…³ç³»ï¼š"><a href="#èšåˆå…³ç³»ï¼š" class="headerlink" title="èšåˆå…³ç³»ï¼š"></a>èšåˆå…³ç³»ï¼š</h3><p>â€‹è¡¨ç¤ºæ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ï¼Œ***<u>æ•´ä½“å’Œéƒ¨åˆ†å¯ä»¥åˆ†å¼€</u><em><strong>ï¼Œæ˜¯</strong>å…³è”å…³ç³»çš„ç‰¹ä¾‹</em>*</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¾‹å¦‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span>&#123;<span class="comment">//Computerä¸­çš„Mouseå¯ä»¥ä¸ºnull</span></span><br><span class="line">Mouse mouse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><u>ç”¨<strong>å®çº¿+ç©ºå¿ƒè±å½¢</strong>æè¿°</u></p><h3 id="ç»„åˆå…³ç³»ï¼š"><a href="#ç»„åˆå…³ç³»ï¼š" class="headerlink" title="ç»„åˆå…³ç³»ï¼š"></a>ç»„åˆå…³ç³»ï¼š</h3><p>â€‹è¡¨ç¤ºæ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ï¼Œ***<u>æ•´ä½“å’Œéƒ¨åˆ†ä¸å¯ä»¥åˆ†å¼€</u>***ï¼Œåˆ™æ˜¯ç»„åˆå…³ç³»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¾‹å¦‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span>&#123;<span class="comment">//Computerä¸Mouse å…±åˆ›å»ºã€å…±é”€æ¯</span></span><br><span class="line"><span class="type">Mouse</span> <span class="variable">mouse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mouse</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨å®çº¿+é»‘è±å½¢æè¿°</p><h1 id="è®¾è®¡æ¨¡å¼æ¦‚è¿°ï¼š"><a href="#è®¾è®¡æ¨¡å¼æ¦‚è¿°ï¼š" class="headerlink" title="è®¾è®¡æ¨¡å¼æ¦‚è¿°ï¼š"></a>è®¾è®¡æ¨¡å¼æ¦‚è¿°ï¼š</h1><h2 id="æŒæ¡è®¾è®¡æ¨¡å¼çš„å±‚æ¬¡ï¼š"><a href="#æŒæ¡è®¾è®¡æ¨¡å¼çš„å±‚æ¬¡ï¼š" class="headerlink" title="æŒæ¡è®¾è®¡æ¨¡å¼çš„å±‚æ¬¡ï¼š"></a>æŒæ¡è®¾è®¡æ¨¡å¼çš„å±‚æ¬¡ï¼š</h2><ul><li>ç¬¬1å±‚ï¼šåˆšå¼€å§‹å­¦ç¼–ç¨‹ä¸ä¹…ï¼Œå¬è¯´è¿‡ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼</li><li>ç¬¬2å±‚ï¼šæœ‰å¾ˆé•¿æ—¶é—´çš„ç¼–ç¨‹ç»éªŒï¼Œè‡ªå·±å†™äº†å¾ˆå¤šä»£ç ï¼Œå…¶ä¸­ç”¨åˆ°äº†è®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯è‡ªå·±å´ä¸çŸ¥é“</li><li>ç¬¬3å±‚ï¼šå­¦ä¹ è¿‡äº†è®¾è®¡æ¨¡å¼ï¼Œå‘ç°è‡ªå·±å·±ç»åœ¨ä½¿ç”¨äº†ï¼Œå¹¶ä¸”å‘ç°äº†ä¸€äº›æ–°çš„æ¨¡å¼æŒºå¥½ç”¨çš„</li><li>ç¬¬4å±‚ï¼šé˜…è¯»äº†å¾ˆå¤šåˆ«äººå†™çš„æºç å’Œæ¡†æ¶ï¼Œåœ¨å…¶ä¸­çœ‹åˆ°åˆ«äººè®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”èƒ½å¤Ÿé¢†ä¼šè®¾è®¡æ¨¡å¼çš„ç²¾å¦™å’Œå¸¦æ¥çš„å¥½å¤„ã€‚</li><li>ç¬¬5å±‚ï¼šä»£ç å†™ç€å†™ç€ï¼Œè‡ªå·±éƒ½æ²¡æœ‰æ„è¯†åˆ°ä½¿ç”¨äº†è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”ç†Ÿç»ƒçš„å†™äº†å‡ºæ¥ã€‚</li></ul><h2 id="è®¾è®¡æ¨¡å¼ä»‹ç»ï¼š"><a href="#è®¾è®¡æ¨¡å¼ä»‹ç»ï¼š" class="headerlink" title="è®¾è®¡æ¨¡å¼ä»‹ç»ï¼š"></a>è®¾è®¡æ¨¡å¼ä»‹ç»ï¼š</h2><ul><li>è®¾è®¡æ¨¡å¼æ˜¯ç¨‹åºå‘˜åœ¨é¢å¯¹åŒç±»è½¯ä»¶å·¥ç¨‹è®¾è®¡é—®é¢˜æ‰€æ€»ç»“å‡ºæ¥çš„æœ‰ç”¨çš„ç»éªŒï¼Œæ¨¡å¼ä¸æ˜¯ä»£ç ï¼Œè€Œæ˜¯æŸç±»é—®é¢˜çš„é€šç”¨è§£æ±ºæ–¹æ¡ˆï¼Œè®¾è®¡æ¨¡å¼ (Design patternï¼‰ä»£è¡¨äº†æœ€ä½³çš„å®è·µã€‚è¿™äº›è§£å†³æ–¹æ¡ˆæ˜¯ä¼—å¤šè½¯ä»¶å¼€å‘äººå‘˜ç»è¿‡ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´çš„è¯•éªŒå’Œé”™è¯¯æ€»ç»“å‡ºæ¥çš„ã€‚</li><li>è®¾è®¡æ¨¡å¼çš„æœ¬è´¨æé«˜ è½¯ä»¶çš„ç»´æŠ¤æ€§ï¼Œé€šç”¨æ€§å’Œæ‰©å±•æ€§ï¼Œå¹¶é™ä½è½¯ä»¶çš„å¤æ‚åº¦ã€‚</li><li>ï¼œ&lt;è®¾è®¡æ¨¡å¼&gt;ï¼æ˜¯ç»å…¸çš„ä¹¦ï¼Œä½œè€…æ˜¯ Erich Gammaã€ Richard Helmnã€ Ralph Johnson å’Œ John Vlissides Design ï¼ˆä¿—ç§°â€œå››äººç»„ GOFâ€)</li><li>è®¾è®¡æ¨¡å¼å¹¶ä¸å±€é™äºæŸç§è¯­è¨€ï¼Œjavaï¼Œphpï¼Œc++ éƒ½æœ‰è®¾è®¡æ¨¡å¼.</li></ul><h1 id="è®¾è®¡æ¨¡å¼è¯¦è§£ï¼š"><a href="#è®¾è®¡æ¨¡å¼è¯¦è§£ï¼š" class="headerlink" title="è®¾è®¡æ¨¡å¼è¯¦è§£ï¼š"></a>è®¾è®¡æ¨¡å¼è¯¦è§£ï¼š</h1><h2 id="åˆ›å»ºå‹æ¨¡å¼ï¼š"><a href="#åˆ›å»ºå‹æ¨¡å¼ï¼š" class="headerlink" title="åˆ›å»ºå‹æ¨¡å¼ï¼š"></a>åˆ›å»ºå‹æ¨¡å¼ï¼š</h2><p><strong>åˆ›å»ºå‹ï¼š åœ¨åˆ›å»ºå¯¹è±¡çš„åŒæ—¶éšè—åˆ›å»ºé€»è¾‘ï¼Œä¸ä½¿â½¤ new ç›´æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œç¨‹åºåœ¨åˆ¤æ–­éœ€è¦åˆ›å»ºå“ªäº›å¯¹è±¡æ—¶æ›´çµæ´»ã€‚åŒ…æ‹¬â¼¯â¼š&#x2F;æŠ½è±¡â¼¯â¼š&#x2F;å•ä¾‹&#x2F;å»ºé€ è€…&#x2F;åŸå‹æ¨¡å¼ã€‚</strong></p><h3 id="å•ä¾‹æ¨¡å¼ï¼š"><a href="#å•ä¾‹æ¨¡å¼ï¼š" class="headerlink" title="å•ä¾‹æ¨¡å¼ï¼š"></a>å•ä¾‹æ¨¡å¼ï¼š</h3><ol><li><p><strong>é¥¿æ±‰å¼(é™æ€å¸¸é‡)</strong></p><ul><li><p>æ„é€ å™¨ç§æœ‰åŒ–ä¿è¯å¤–éƒ¨ä¸èƒ½new</p></li><li><p>ç±»çš„å†…éƒ¨åˆ›å»º<strong>é™æ€å¯¹è±¡</strong>        åœ¨ç±»çš„å†…éƒ¨åˆ›å»ºè¯¥ç±»çš„é™æ€å¯¹è±¡ï¼Œåœ¨ç±»åŠ è½½æ—¶è‡ªåŠ¨ç”Ÿæˆ</p></li><li><p>å‘å¤–æš´éœ²ä¸€ä¸ªé™æ€çš„å…¬å…±æ–¹æ³•â€”â€”getInstance</p><p>ä¼˜ç‚¹ï¼šè¿™ç§å†™æ³•æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®ä¾‹åŒ–ã€‚é¿å…äº†çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚</p><p>ç¼ºç‚¹ï¼šåœ¨<strong>ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®ä¾‹åŒ–</strong>ï¼Œæ²¡æœ‰è¾¾åˆ°Lazy Loading çš„æ•ˆæœã€‚<u>å¦‚æœä»å§‹è‡³ç»ˆä»æœªä½¿ç”¨è¿‡è¿™ä¸ªå®ä¾‹ï¼Œåˆ™ä¼šé€ æˆå†…å­˜çš„æµªè´¹</u>ï¼›æ­£å› ä¸ºæ˜¯åœ¨ç±»åŠ è½½æ—¶å°±ä¼šåˆ›å»ºå¯¹è±¡ï¼Œæˆ‘ä»¬å¯èƒ½åœ¨åˆ«çš„åœ°æ–¹æ— æ„å¯¼è‡´è¯¥ç±»åŠ è½½è€Œä¸å»ä½¿ç”¨ï¼Œé€ æˆå†…å­˜æµªè´¹ã€‚</p></li></ul></li><li><p><strong>é¥¿æ±‰å¼(é™æ€ä»£ç å—)</strong></p><ul><li><p>åœ¨ç±»ä¸­å®šä¹‰è¯¥ç±»çš„é™æ€å˜é‡</p></li><li><p>åœ¨é™æ€ä»£ç å—ä¸­å®Œæˆè¯¥ç±»çš„é™æ€å˜é‡çš„åˆå§‹åŒ–</p><p>ä¼˜ç¼ºç‚¹åˆ†æï¼š</p><p>â€‹è¿™ç§æ–¹å¼å’Œä¸Šé¢çš„æ–¹å¼å…¶å®ç±»ä¼¼ï¼Œåªä¸è¿‡å°†ç±»å®ä¾‹åŒ–çš„è¿‡ç¨‹æ”¾åœ¨äº†é™æ€ä»£ç å—ä¸­ï¼Œä¹Ÿæ˜¯åœ¨ç±»è£…è½½çš„æ—¶å€™ï¼Œå°±æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç ï¼Œåˆå§‹åŒ–ç±»çš„å®ä¾‹ã€‚ä¼˜ç¼ºç‚¹ä¸ä¸Šé¢æ–¹æ³•ä¸€æ ·</p><p>ç»“è®ºï¼šè¿™ç§å•ä¾‹æ¨¡å¼å¯ç”¨ï¼Œä½†æ˜¯å¯èƒ½é€ æˆå†…å­˜æµªè´¹</p></li></ul></li><li><p>æ‡’æ±‰å¼(çº¿ç¨‹ä¸å®‰å…¨)</p><ul><li><p>æ„é€ å™¨ç§æœ‰åŒ– ä¿è¯å¤–éƒ¨ä¸èƒ½new</p></li><li><p>ç±»çš„å†…éƒ¨å®šä¹‰<strong>é™æ€å¯¹è±¡</strong>          åˆ›å»ºå¯¹è±¡ï¼Œä½†æ˜¯ä¸åˆ›å»º(ä¸ new)</p></li><li><p>å‘å¤–æš´éœ²ä¸€ä¸ªé™æ€çš„å…¬å…±æ–¹æ³•â€”â€”getInstance  åœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œæ‰å¯¹è¯¥ç±»çš„é™æ€å¯¹è±¡è¿›è¡Œåˆ›å»º</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230524105503814.png" alt="image-20230524105503814" style="zoom:45%;" /><p>ä¼˜ç¼ºç‚¹åˆ†æï¼š</p><p>â€‹èµ·åˆ°äº† Lazy Loading çš„æ•ˆæœï¼Œä½†æ˜¯åªèƒ½åœ¨å•çº¿ç¨‹ä¸‹ä½¿ç”¨ã€‚</p><p>â€‹å¦‚æœåœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹è¿›å…¥äº†**if(singleton&#x3D;&#x3D; null)**åˆ¤æ–­è¯­å¥å—ï¼Œè¿˜æœªæ¥å¾—åŠå¾€ä¸‹æ‰§è¡Œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿé€šè¿‡äº†è¿™ä¸ªåˆ¤æ–­è¯­å¥ï¼Œè¿™æ—¶ä¾¿ä¼šäº§ç”Ÿå¤šä¸ªå®ä¾‹ã€‚æ‰€ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸å¯ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚</p><p><strong>ç»“è®º</strong>ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸è¦ä½¿ç”¨è¿™ç§æ–¹å¼.</p></li></ul></li><li><p>æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•)</p><p>ç»™ getInstance æ·»åŠ  synchronize ä¿®é¥°ï¼Œä¿è¯åŒæ­¥</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230524112254631.png" alt="image-20230524112254631" style="zoom:40%;" /><p>ä¼˜ç¼ºç‚¹åˆ†æï¼š</p><p>â€‹è§£å†³äº†çº¿ç¨‹å®‰å…¨é—®é¢˜</p><p>â€‹<strong>æ•ˆç‡å¤ªä½äº†</strong>ï¼Œ<u>æ¯ä¸ªçº¿ç¨‹åœ¨æƒ³è·å¾—ç±»çš„å®ä¾‹æ—¶å€™ï¼Œæ‰§è¡Œ getinstance()æ–¹æ³•éƒ½è¦è¿›è¡ŒåŒæ­¥</u>ã€‚è€Œå…¶å®è¿™ä¸ªæ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡å®ä¾‹åŒ–ä»£ç å°±å¤Ÿäº†ï¼Œåé¢çš„æƒ³è·å¾—è¯¥ç±»å®ä¾‹ï¼Œç›´æ¥ return å°±è¡Œäº†ã€‚æ–¹æ³•è¿›è¡ŒåŒæ­¥æ•ˆç‡å¤ªä½</p><p><strong>ç»“è®º</strong>ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œ<strong>ä¸æ¨è</strong>ä½¿ç”¨è¿™ç§æ–¹å¼</p></li><li><p>æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥ä»£ç å—)</p><p>ä¸å¯ä½¿ç”¨ï¼Œå› ä¸ºä¸èƒ½ä¿è¯å•ä¾‹</p></li><li><p><strong>åŒé‡æ£€æŸ¥</strong></p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230524114249721.png" alt="image-20230524114249721" style="zoom:50%;" /><p>â€‹Double-Check æ¦‚å¿µæ˜¯å¤šçº¿ç¨‹å¼€å‘ä¸­å¸¸ä½¿ç”¨åˆ°çš„ï¼Œå¦‚ä»£ç ä¸­æ‰€ç¤ºï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸¤æ¬¡if(singleton&#x3D;&#x3D; null)æ£€æŸ¥ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚</p><p>â€‹è¿™æ ·ï¼Œå®ä¾‹åŒ–ä»£ç åªç”¨æ‰§è¡Œä¸€æ¬¡ï¼Œåé¢å†æ¬¡è®¿é—®æ—¶ï¼Œåˆ¤æ–­if(singleton&#x3D;&#x3D;null)ï¼Œç›´æ¥ return å®ä¾‹åŒ–å¯¹è±¡ï¼Œä¹Ÿé¿å…çš„åå¤è¿›è¡Œæ–¹æ³•åŒæ­¥.</p><p>â€‹çº¿ç¨‹å®‰å…¨ï¼›å»¶è¿ŸåŠ è½½ï¼›æ•ˆç‡è¾ƒé«˜</p><p>ç»“è®ºï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œ<strong>æ¨èä½¿ç”¨è¿™ç§å•ä¾‹è®¾è®¡æ¨¡å¼</strong></p><h4 id="ğŸŒŸè¿™â¾¥ä¸ºä»€ä¹ˆè¦ä½¿â½¤-volatile-ï¼Ÿ"><a href="#ğŸŒŸè¿™â¾¥ä¸ºä»€ä¹ˆè¦ä½¿â½¤-volatile-ï¼Ÿ" class="headerlink" title="ğŸŒŸè¿™â¾¥ä¸ºä»€ä¹ˆè¦ä½¿â½¤ volatile ï¼Ÿ"></a>ğŸŒŸè¿™â¾¥ä¸ºä»€ä¹ˆè¦ä½¿â½¤ volatile ï¼Ÿ</h4><p>è¿™æ˜¯å› ä¸º new å…³é”®å­—åˆ›å»ºå¯¹è±¡ä¸æ˜¯åŸâ¼¦æ“ä½œï¼Œåˆ›å»ºâ¼€ä¸ªå¯¹è±¡ä¼šç»å†ä¸‹â¾¯çš„æ­¥éª¤ï¼š</p><ol><li>åœ¨å †å†…å­˜å¼€è¾Ÿå†…å­˜ç©ºé—´</li><li>è°ƒâ½¤æ„é€ â½…æ³•ï¼Œåˆå§‹åŒ–å¯¹è±¡</li><li>å¼•â½¤å˜é‡æŒ‡å‘å †å†…å­˜ç©ºé—´<br>ä¸ºäº†æâ¾¼æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æ—¢å®šçš„ä»£ç æ‰§â¾é¡ºåºè¿›â¾æŒ‡ä»¤é‡æ’åºï¼Œä»æºç åˆ°æœ€ç»ˆæ‰§â¾æŒ‡ä»¤ä¼šç»å†å¦‚ä¸‹æµç¨‹ï¼š<br>æºç ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’åºæŒ‡ä»¤çº§å¹¶â¾é‡æ’åºå†…å­˜ç³»ç»Ÿé‡æ’åºæœ€ç»ˆæ‰§â¾æŒ‡ä»¤åºåˆ—æ‰€ä»¥ç»è¿‡**<u>æŒ‡ä»¤é‡æ’åº</u><strong>ä¹‹åï¼Œåˆ›å»ºå¯¹è±¡çš„æ‰§â¾é¡ºåºå¯èƒ½ä¸º 1 2 3 æˆ–è€… 1 3 2 ï¼Œå› æ­¤å½“æŸä¸ªçº¿ç¨‹åœ¨ä¹±åºè¿â¾ 1 3 2 æŒ‡ä»¤çš„æ—¶å€™ï¼Œå¼•â½¤å˜é‡æŒ‡å‘å †å†…å­˜ç©ºé—´ï¼Œè¿™ä¸ªå¯¹è±¡ä¸ä¸º nullï¼Œä½†æ˜¯æ²¡æœ‰åˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹æœ‰å¯èƒ½è¿™ä¸ªæ—¶å€™è¿›â¼Šäº† getInstance çš„ç¬¬â¼€ä¸ª if(instance &#x3D;&#x3D; null) åˆ¤æ–­ä¸ä¸º nulll ï¼Œå¯¼è‡´</strong>é”™è¯¯ä½¿â½¤äº†æ²¡æœ‰åˆå§‹åŒ–çš„â¾® null å®ä¾‹**ï¼Œè¿™æ ·çš„è¯å°±ä¼šå‡ºç°å¼‚å¸¸ï¼Œè¿™ä¸ªå°±æ˜¯è‘—åçš„<br>DCL å¤±æ•ˆé—®é¢˜ã€‚<br>å½“æˆ‘ä»¬åœ¨å¼•â½¤å˜é‡ä¸Šâ¾¯æ·»åŠ  volatile å…³é”®å­—ä»¥åï¼Œä¼šé€šè¿‡åœ¨åˆ›å»ºå¯¹è±¡æŒ‡ä»¤çš„å‰åæ·»åŠ å†…å­˜å±éšœæ¥ç¦â½ŒæŒ‡ä»¤é‡æ’åºï¼Œå°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œâ½½ä¸”å¯¹volatile ä¿®é¥°çš„å˜é‡çš„ä¿®æ”¹å¯¹å…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½æ˜¯å¯â»…çš„ã€‚</li></ol></li><li><p><strong>é™æ€å†…éƒ¨ç±»</strong></p><ul><li><p>æ„é€ å™¨ç§æœ‰åŒ– ä¿è¯å¤–éƒ¨ä¸èƒ½new</p></li><li><p>æ„å»ºä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå†…éƒ¨ç±»ä¸­æœ‰ä¸€ä¸ªé™æ€å±æ€§ï¼Œå¦‚æœåŠ è½½äº†é™æ€ç±»ï¼Œè¯¥å±æ€§ä¹Ÿä¼šåˆ›å»ºå¯¹è±¡</p></li><li><p>å‘å¤–æš´éœ²ä¸€ä¸ªé™æ€çš„å…¬å…±æ–¹æ³•â€”â€”getInstance  åœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œå¯¹é™æ€å†…éƒ¨ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿”å›é™æ€å†…éƒ¨ç±»å±æ€§</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230524115554993.png" alt="image-20230524115554993" style="zoom:50%;" /></li></ul><p>ä¼˜ç¼ºç‚¹åˆ†æï¼š</p><ul><li><p>è¿™ç§æ–¹å¼é‡‡ç”¨äº†ç±»è£…è½½çš„æœºåˆ¶æ¥ä¿è¯åˆå§‹åŒ–å®ä¾‹æ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚</p></li><li><p>é™æ€å†…éƒ¨ç±»æ–¹å¼åœ¨ Singleton ç±»è¢«è£…è½½æ—¶å¹¶ä¸ä¼šç«‹å³å®ä¾‹åŒ–ï¼Œè€Œæ˜¯åœ¨éœ€è¦å®ä¾‹åŒ–æ—¶ï¼Œè°ƒç”¨getinstance æ–¹æ³•ï¼Œæ‰ä¼šè£…è½½ Singletoninstance ç±»ï¼Œä»è€Œå®Œæˆ Singleton çš„å®ä¾‹åŒ–ã€‚</p></li><li><p>ç±»çš„é™æ€å±æ€§åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½ç±»çš„æ—¶å€™åˆå§‹åŒ–ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼ŒJVM å¸®åŠ©æˆ‘ä»¬ä¿è¯äº†çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œåœ¨ç±»è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œåˆ«çš„çº¿ç¨‹æ˜¯æ— æ³•è¿›å…¥çš„ã€‚</p></li><li><p>ä¼˜ç‚¹ï¼šé¿å…äº†çº¿ç¨‹ä¸å®‰å…¨ï¼Œåˆ©ç”¨é™æ€å†…éƒ¨ç±»ç‰¹ç‚¹å®ç°å»¶è¿ŸåŠ è½½ï¼Œæ•ˆç‡é«˜</p></li><li><p>ç¼ºç‚¹ï¼šgetInstance è¿˜æ˜¯è¢«synchronizedä¿®é¥°äº†</p></li></ul><p><strong>ç»“è®º</strong>ï¼šæ¨èä½¿ç”¨ï¼</p></li><li><p><strong>æšä¸¾</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€šè¿‡ Singleton.INSTANCE æ¥è·å–å•ä¾‹ï¼Œè·å–çš„å¯¹è±¡å¯ä»¥ä½¿ç”¨Singletonä¸­çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Singleton</span>&#123;</span><br><span class="line">  INSTANCE;<span class="comment">//å±æ€§</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">func</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;qwe&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>è¿™å€ŸåŠ© JDK1.5ä¸­æ·»åŠ çš„æšä¸¾æ¥å®ç°å•ä¾‹æ¨¡å¼ã€‚ä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥ é—®é¢˜ï¼Œè€Œä¸”è¿˜èƒ½é˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»º</p></li><li><p>æ–°çš„å¯¹è±¡ã€‚</p></li><li><p>è¿™ç§æ–¹å¼æ˜¯ Effective Java ä½œè€… Josh Bloch æå€¡çš„æ–¹å¼</p></li><li><p><strong>ç»“è®º</strong>ï¼šæ¨èä½¿ç”¨</p></li></ul><h4 id="å•ä¾‹æ¨¡å¼æ³¨æ„äº‹é¡¹ï¼š"><a href="#å•ä¾‹æ¨¡å¼æ³¨æ„äº‹é¡¹ï¼š" class="headerlink" title="å•ä¾‹æ¨¡å¼æ³¨æ„äº‹é¡¹ï¼š"></a>å•ä¾‹æ¨¡å¼æ³¨æ„äº‹é¡¹ï¼š</h4><ul><li><p>å•ä¾‹æ¨¡å¼ä¿è¯äº† ç³»ç»Ÿå†…å­˜ä¸­è¯¥ç±»åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼Œ<u>èŠ‚çœäº†ç³»ç»Ÿèµ„æº</u>ï¼Œ<strong>å¯¹äºä¸€äº›éœ€è¦é¢‘ç¹åˆ›å»ºé”€æ¯çš„å¯¹è±¡ï¼Œä½¿ç”¨å•ä¾‹æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿæ€§èƒ½</strong></p></li><li><p>å½“æƒ³å®ä¾‹åŒ–ä¸€ä¸ªå•ä¾‹ç±»çš„æ—¶å€™ï¼Œå¿…é¡»è¦è®°ä½ä½¿ç”¨ç›¸åº”çš„è·å–å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ new</p></li><li><p>å•ä¾‹æ¨¡å¼ä½¿ç”¨çš„åœºæ™¯ï¼š**<u><em>éœ€è¦é¢‘ç¹çš„è¿›è¡Œåˆ›å»ºå’Œé”€æ¯çš„å¯¹è±¡ã€åˆ›å»ºå¯¹è±¡æ—¶è€—æ—¶è¿‡å¤šæˆ–è€—è´¹èµ„æºè¿‡å¤šï¼ˆå³ï¼šé‡é‡çº§å¯¹è±¡ï¼‰ï¼Œä½†åˆç»å¸¸ç”¨åˆ°çš„å¯¹è±¡ã€å·¥å…·ç±»å¯¹è±¡ã€é¢‘ç¹è®¿é—®æ•°æ®åº“æˆ–æ–‡ä»¶çš„å¯¹è±¡(æ¯”å¦‚æ•°æ®æºã€session å·¥å‚ç­‰ï¼‰</em></u>**</p></li></ul></li></ol><h3 id="å·¥å‚æ¨¡å¼ï¼š"><a href="#å·¥å‚æ¨¡å¼ï¼š" class="headerlink" title="å·¥å‚æ¨¡å¼ï¼š"></a>å·¥å‚æ¨¡å¼ï¼š</h3><h4 id="ç®€å•å·¥å‚æ¨¡å¼ï¼š"><a href="#ç®€å•å·¥å‚æ¨¡å¼ï¼š" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼ï¼š"></a>ç®€å•å·¥å‚æ¨¡å¼ï¼š</h4><p>ã€Œé’ˆå¯¹æ¯ç§äº§å“ã€</p><p><u>ç®€å•â¼¯â¼šæ¨¡å¼æŒ‡ç”±â¼€ä¸ªâ¼¯â¼šå¯¹è±¡æ¥åˆ›å»ºå®ä¾‹ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å…³æ³¨åˆ›å»ºé€»è¾‘ï¼Œåªéœ€æä¾›ä¼ â¼Šâ¼¯â¼šçš„å‚æ•°ã€‚</u></p><ul><li><p>ç®€å•å·¥å‚æ¨¡å¼æ˜¯å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œæ˜¯å·¥å‚æ¨¡å¼çš„ä¸€ç§ã€‚ç®€å•å·¥å‚æ¨¡å¼æ˜¯ç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºå‡ºå“ªä¸€ç§äº§å“ç±»çš„å®ä¾‹ã€‚ç®€å•å·¥å‚æ¨¡å¼æ˜¯å·¥å‚æ¨¡å¼å®¶æ—ä¸­æœ€ç®€å•å®ç”¨çš„æ¨¡å¼</p></li><li><p>ç®€å•å·¥å‚æ¨¡å¼ï¼šå®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„ç±»ï¼Œç”±è¿™ä¸ªç±»æ¥å°è£…å®ä¾‹åŒ–å¯¹è±¡çš„è¡Œä¸º</p></li><li><p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå½“æˆ‘ä»¬<strong>ç”¨åˆ°å¤§é‡çš„åˆ›å»ºæŸç§ã€æŸç±»æˆ–è€…æŸæ‰¹å¯¹è±¡</strong>æ—¶ï¼Œå°±ä¼šä½¿ç”¨åˆ°å·¥å‚æ¨¡å¼.</p></li></ul><h4 id="å·¥å‚æ–¹æ³•æ¨¡å¼ï¼š"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼ï¼š" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼ï¼š"></a>å·¥å‚æ–¹æ³•æ¨¡å¼ï¼š</h4><p>ã€Œé’ˆå¯¹ä¸€ç±»äº§å“ã€</p><p>å’Œç®€å•â¼¯â¼šæ¨¡å¼ä¸­â¼¯â¼šè´Ÿè´£â½£äº§æ‰€æœ‰äº§å“ç›¸â½ï¼Œâ¼¯â¼šâ½…æ³•æ¨¡å¼å°†â½£æˆå…·ä½“äº§å“çš„ä»»åŠ¡åˆ†å‘ç»™å…·ä½“çš„äº§å“â¼¯â¼šã€‚</p><p>å…¶å®å°±æ˜¯åœ¨å·¥å‚è¿™è¾¹å†åˆ†å±‚ é€»è¾‘ä¸ºï¼šæ€»å·¥å‚&lt;â€“&gt;å­å·¥å‚1&#x2F;2&#x2F;3â€¦</p><p>â€‹å…¶ä¸­ï¼Œæ€»å·¥å‚å®šä¹‰äº†äº§å“çš„ç”Ÿäº§æ¥å£ï¼Œè€Œç”Ÿäº§æ¥å£ç”±ä¸åŒçš„å­å·¥å‚è¿›è¡Œå®ç°ã€‚ä»è€Œå¯¹å·¥å‚è¿›è¡Œäº†è¿›ä¸€æ­¥åˆ’åˆ†ã€‚</p><h4 id="æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š"></a>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š</h4><p>ã€Œé’ˆå¯¹å¤šç±»äº§å“ï¼Œæ¯ä¸ªç±»ä¸­è¿˜æœ‰å¤šç§äº§å“ï¼ã€</p><p>æ€»å·¥å‚ã€å­å·¥å‚éƒ½æ˜¯æŠ½è±¡çš„ã€‚è¦ç”Ÿäº§æŸç§äº§å“ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰¾åˆ°æ¨¡ç‰ˆç±»ä¼¼çš„å­ç±»ï¼Œå†å¯¹å­ç±»è¿›è¡Œå®ç°ï¼Œä»è€Œè¿›è¡Œåˆ›å»ºã€‚</p><h2 id="ç»“æ„å‹æ¨¡å¼ï¼š"><a href="#ç»“æ„å‹æ¨¡å¼ï¼š" class="headerlink" title="ç»“æ„å‹æ¨¡å¼ï¼š"></a>ç»“æ„å‹æ¨¡å¼ï¼š</h2><h3 id="é€‚é…å™¨æ¨¡å¼ï¼š"><a href="#é€‚é…å™¨æ¨¡å¼ï¼š" class="headerlink" title="é€‚é…å™¨æ¨¡å¼ï¼š"></a>é€‚é…å™¨æ¨¡å¼ï¼š</h3><p>æ¦‚è¿°ï¼šåœ¨æˆ‘ä»¬çš„åº”â½¤ç¨‹åºä¸­æˆ‘ä»¬å¯èƒ½éœ€è¦å°†ä¸¤ä¸ªä¸åŒæ¥â¼çš„ç±»æ¥è¿›â¾é€šä¿¡ï¼Œåœ¨ä¸ä¿®æ”¹è¿™ä¸¤ä¸ªçš„å‰æä¸‹æˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦æŸä¸ªä¸­é—´ä»¶æ¥å®Œæˆè¿™ä¸ªè¡”æ¥çš„è¿‡ç¨‹ã€‚è¿™ä¸ªä¸­é—´ä»¶å°±æ˜¯é€‚é…å™¨ã€‚æ‰€è°“é€‚é…å™¨æ¨¡å¼å°±æ˜¯<strong>å°†â¼€ä¸ªç±»çš„æ¥â¼ï¼Œè½¬æ¢æˆå®¢æˆ·æœŸæœ›çš„å¦â¼€ä¸ªæ¥â¼</strong>ã€‚å®ƒ<u>å¯ä»¥è®©åŸæœ¬ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥â¼èƒ½å¤Ÿâ½†ç¼å®Œæˆå¯¹æ¥</u>ã€‚</p><p>ä½œä¸ºä¸­é—´ä»¶çš„é€‚é…å™¨å°†â½¬æ ‡ç±»å’Œé€‚é…è€…è§£è€¦ï¼Œå¢åŠ äº†ç±»çš„é€æ˜æ€§å’Œå¯å¤â½¤æ€§ã€‚</p><p>â½¬æ ‡ç±»å’Œé€‚é…è€…ä¸å¿…æœ‰å¾ˆå¤§å…³è”ï¼Œå¯ä»¥é€šè¿‡é€‚é…å™¨å»ºç«‹è”ç³»ï¼Œä»è€Œå®ç°è§£è€¦ã€‚</p><h5 id="ç±»é€‚é…å™¨ï¼š"><a href="#ç±»é€‚é…å™¨ï¼š" class="headerlink" title="ç±»é€‚é…å™¨ï¼š"></a>ç±»é€‚é…å™¨ï¼š</h5><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230524201128653.png" alt="image-20230524201128653" style="zoom:50%;" /><p><strong>å¯¹è±¡é€‚é…å™¨ï¼š</strong></p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230524201140631.png" alt="image-20230524201140631" style="zoom:50%;" /><ul><li><p>Target: å®šä¹‰ Client çœŸæ­£éœ€è¦ä½¿â½¤çš„æ¥â¼ã€‚</p></li><li><p>Adaptee: å…¶ä¸­å®šä¹‰äº†â¼€ä¸ªå·²ç»å­˜åœ¨çš„æ¥â¼ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦è¿›â¾é€‚é…çš„æ¥â¼ã€‚</p></li><li><p>Adapter: å¯¹ Adaptee å’Œ Target çš„æ¥â¼è¿›â¾é€‚é…ï¼Œä¿è¯å¯¹ target ä¸­æ¥â¼çš„è°ƒâ½¤å¯ä»¥é—´æ¥è½¬æ¢ä¸ºå¯¹ Adaptee ä¸­æ¥â¼è¿›â¾è°ƒâ½¤ã€‚</p><ul><li>ä¼˜ç‚¹ï¼š</li></ul><ol><li>æâ¾¼äº†ç±»çš„å¤â½¤ï¼›</li><li>ç»„åˆè‹¥â¼²å…³è”å¯¹è±¡å½¢æˆå¯¹å¤–æä¾›ç»Ÿâ¼€æœåŠ¡çš„æ¥â¼ï¼›</li><li>æ‰©å±•æ€§ã€çµæ´»æ€§å¥½ã€‚</li></ol><ul><li>ç¼ºç‚¹ï¼š</li></ul><ol><li>è¿‡å¤šä½¿â½¤é€‚é…æ¨¡å¼å®¹æ˜“é€ æˆä»£ç åŠŸèƒ½å’Œé€»è¾‘æ„ä¹‰çš„æ··æ·†ã€‚</li><li>éƒ¨åˆ†è¯­â¾”å¯¹ç»§æ‰¿çš„é™åˆ¶ï¼Œå¯èƒ½â¾„å¤šåªèƒ½é€‚é…â¼€ä¸ªé€‚é…è€…ç±»ï¼Œâ½½ä¸”â½¬æ ‡ç±»å¿…é¡»æ˜¯æŠ½è±¡ç±»ã€‚</li></ol></li></ul><h3 id="è£…é¥°æ¨¡å¼ï¼š"><a href="#è£…é¥°æ¨¡å¼ï¼š" class="headerlink" title="è£…é¥°æ¨¡å¼ï¼š"></a>è£…é¥°æ¨¡å¼ï¼š</h3><p>è£…é¥°å™¨æ¨¡å¼ä¸»è¦å¯¹ç°æœ‰çš„ç±»å¯¹è±¡è¿›â¾åŒ…è£¹å’Œå°è£…ï¼Œä»¥æœŸæœ›åœ¨ä¸æ”¹å˜ç±»å¯¹è±¡åŠå…¶ç±»å®šä¹‰çš„æƒ…å†µä¸‹ï¼Œä¸ºå¯¹è±¡æ·»åŠ é¢å¤–åŠŸèƒ½ã€‚æ˜¯â¼€ç§å¯¹è±¡ç»“æ„å‹æ¨¡å¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒâ½¤è¢«åŒ…è£¹ä¹‹åçš„å¯¹è±¡å®ŒæˆåŠŸèƒ½æ·»åŠ çš„ï¼Œâ½½ä¸æ˜¯ç›´æ¥ä¿®æ”¹ç°æœ‰å¯¹è±¡çš„â¾ä¸ºï¼Œç›¸å½“äºå¢åŠ äº†ä¸­é—´å±‚ã€‚(AOP???)</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230524204945734.png" alt="image-20230524204945734" style="zoom:50%;" /><p><strong>Component</strong>: å¯¹è±¡çš„æ¥â¼ç±»ï¼Œå®šä¹‰è£…é¥°å¯¹è±¡å’Œè¢«è£…é¥°å¯¹è±¡çš„å…±åŒæ¥â¼ï¼›<br><strong>ConcreteComponent</strong>: è¢«è£…é¥°å¯¹è±¡çš„ç±»å®šä¹‰ï¼›<br><strong>Decorator</strong>: è£…é¥°å¯¹è±¡çš„æŠ½è±¡ç±»ï¼Œ<u><strong>æŒæœ‰â¼€ä¸ªå…·ä½“çš„è¢«ä¿®é¥°å¯¹è±¡</strong></u>ï¼Œå¹¶å®ç°æ¥â¼ç±»ç»§æ‰¿çš„å…¬å…±æ¥â¼ï¼›<br><strong>ConcreteDecorator</strong>:å…·ä½“çš„è£…é¥°å™¨ï¼Œè´Ÿè´£å¾€è¢«è£…é¥°å¯¹è±¡æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼›</p><h4 id="è®²è®²è£…é¥°å™¨æ¨¡å¼çš„åº”â½¤åœºæ™¯"><a href="#è®²è®²è£…é¥°å™¨æ¨¡å¼çš„åº”â½¤åœºæ™¯" class="headerlink" title="è®²è®²è£…é¥°å™¨æ¨¡å¼çš„åº”â½¤åœºæ™¯"></a>è®²è®²è£…é¥°å™¨æ¨¡å¼çš„åº”â½¤åœºæ™¯</h4><p>å¦‚æœä½ å¸Œæœ›åœ¨<u>â½†éœ€ä¿®æ”¹ä»£ç çš„</u>æƒ…å†µä¸‹å³å¯ä½¿â½¤å¯¹è±¡ï¼Œ ä¸”å¸Œæœ›åœ¨è¿â¾æ—¶<u>ä¸ºå¯¹è±¡æ–°å¢é¢å¤–çš„â¾ä¸º</u>ï¼Œ å¯ä»¥ä½¿â½¤è£…é¥°æ¨¡å¼ã€‚è£…é¥°èƒ½å°†ä¸šåŠ¡é€»è¾‘ç»„ç»‡ä¸ºå±‚æ¬¡ç»“æ„ï¼Œ ä½ å¯ä¸ºå„å±‚åˆ›å»ºâ¼€ä¸ªè£…é¥°ï¼Œ åœ¨è¿â¾æ—¶<br>å°†å„ç§ä¸åŒé€»è¾‘ç»„åˆæˆå¯¹è±¡ã€‚ ç”±äºè¿™äº›å¯¹è±¡éƒ½éµå¾ªé€šâ½¤æ¥â¼ï¼Œ å®¢æˆ·ç«¯ä»£ç èƒ½ä»¥ç›¸åŒçš„â½…å¼ä½¿â½¤è¿™äº›å¯¹è±¡ã€‚å¦‚æœâ½¤ç»§æ‰¿æ¥æ‰©å±•å¯¹è±¡â¾ä¸ºçš„â½…æ¡ˆéš¾ä»¥å®ç°æˆ–è€…æ ¹æœ¬ä¸å¯â¾ï¼Œ ä½ å¯ä»¥ä½¿â½¤è¯¥æ¨¡å¼ã€‚è®¸å¤šç¼–ç¨‹è¯­â¾”ä½¿â½¤ final æœ€ç»ˆå…³é”®å­—æ¥é™åˆ¶å¯¹æŸä¸ªç±»çš„è¿›â¼€æ­¥æ‰©å±•ã€‚ å¤â½¤æœ€ç»ˆç±»å·²æœ‰â¾ä¸ºçš„å”¯â¼€â½…æ³•æ˜¯ä½¿â½¤è£…é¥°æ¨¡å¼ï¼š â½¤å°è£…å™¨å¯¹å…¶è¿›â¾å°è£…ã€‚</p><h3 id="ä»£ç†æ¨¡å¼ï¼š"><a href="#ä»£ç†æ¨¡å¼ï¼š" class="headerlink" title="ä»£ç†æ¨¡å¼ï¼š"></a>ä»£ç†æ¨¡å¼ï¼š</h3><p>ä»£ç†æ¨¡å¼çš„æœ¬è´¨æ˜¯â¼€ä¸ªä¸­é—´ä»¶ï¼Œä¸»è¦â½¬çš„æ˜¯è§£è€¦åˆæœåŠ¡æä¾›è€…å’Œä½¿â½¤è€…ã€‚<strong>ä½¿â½¤è€…é€šè¿‡ä»£ç†é—´æ¥åœ°è®¿é—®æœåŠ¡æä¾›è€…</strong>ï¼Œ<u>ä¾¿äºåè€…çš„å°è£…å’Œæ§åˆ¶</u>ã€‚æ˜¯â¼€ç§ç»“æ„æ€§æ¨¡å¼ã€‚</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230524202229926.png" alt="image-20230524202229926" style="zoom:60%;" /><p>Subject: å®šä¹‰ RealSubject å¯¹å¤–çš„æ¥â¼ï¼Œä¸”è¿™äº›æ¥â¼å¿…é¡»è¢« Proxy å®ç°ï¼Œè¿™æ ·å¤–éƒ¨è°ƒâ½¤ proxy çš„æ¥â¼æœ€ç»ˆéƒ½è¢«è½¬åŒ–ä¸ºå¯¹ realsubject çš„è°ƒâ½¤ã€‚<br>RealSubject: çœŸæ­£çš„â½¬æ ‡å¯¹è±¡ã€‚<br>Proxy: â½¬æ ‡å¯¹è±¡çš„ä»£ç†ï¼Œè´Ÿè´£æ§åˆ¶å’Œç®¡ç†â½¬æ ‡å¯¹è±¡ï¼Œå¹¶é—´æ¥åœ°ä¼ é€’å¤–éƒ¨å¯¹â½¬æ ‡å¯¹è±¡çš„è®¿é—®ã€‚</p><p>Remote Proxy: å¯¹æœ¬åœ°çš„è¯·æ±‚ä»¥åŠå‚æ•°è¿›â¾åºåˆ—åŒ–ï¼Œå‘è¿œç¨‹å¯¹è±¡å‘é€è¯·æ±‚ï¼Œå¹¶å¯¹å“åº”ç»“æœè¿›â¾ååºåˆ—åŒ–ï¼Œå°†æœ€ç»ˆç»“æœåé¦ˆç»™è°ƒâ½¤è€…ï¼›<br>Virtual Proxy: å½“â½¬æ ‡å¯¹è±¡çš„åˆ›å»ºå¼€é”€â½è¾ƒâ¼¤çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿â½¤å»¶è¿Ÿæˆ–è€…å¼‚æ­¥çš„â½…å¼åˆ›å»ºâ½¬æ ‡å¯¹è±¡ï¼›<br>Protection Proxy: ç»†åŒ–å¯¹â½¬æ ‡å¯¹è±¡è®¿é—®æƒé™çš„æ§åˆ¶ï¼›</p><h4 id="é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«"><a href="#é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«" class="headerlink" title="é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«:"></a>é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«:</h4><ol><li>çµæ´»æ€§ ï¼šåŠ¨æ€ä»£ç†æ›´åŠ çµæ´»ï¼Œä¸éœ€è¦å¿…é¡»å®ç°æ¥â¼ï¼Œå¯ä»¥ç›´æ¥ä»£ç†å®ç°ç±»ï¼Œå¹¶ä¸”å¯ä»¥ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªâ½¬æ ‡ç±»éƒ½åˆ›å»ºâ¼€ä¸ªä»£ç†ç±»ã€‚å¦å¤–ï¼Œé™æ€ä»£ç†ä¸­ï¼Œæ¥â¼â¼€æ—¦æ–°å¢åŠ â½…æ³•ï¼Œâ½¬æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦è¿›â¾ä¿®æ”¹ï¼Œè¿™æ˜¯â¾®å¸¸éº»çƒ¦çš„ï¼</li><li>JVM å±‚â¾¯ ï¼š<u>é™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å°†æ¥â¼ã€å®ç°ç±»ã€ä»£ç†ç±»è¿™äº›éƒ½å˜æˆäº†â¼€ä¸ªä¸ªå®é™…çš„ class â½‚ä»¶</u>ã€‚â½½åŠ¨æ€ä»£ç†æ˜¯åœ¨è¿â¾æ—¶åŠ¨æ€â½£æˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ° JVM ä¸­çš„ã€‚</li></ol><h2 id="è¡Œä¸ºå‹æ¨¡å¼ï¼š"><a href="#è¡Œä¸ºå‹æ¨¡å¼ï¼š" class="headerlink" title="è¡Œä¸ºå‹æ¨¡å¼ï¼š"></a>è¡Œä¸ºå‹æ¨¡å¼ï¼š</h2><h3 id="è§‚å¯Ÿè€…æ¨¡å¼ï¼š"><a href="#è§‚å¯Ÿè€…æ¨¡å¼ï¼š" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼ï¼š"></a>è§‚å¯Ÿè€…æ¨¡å¼ï¼š</h3><p>è§‚å¯Ÿè€…æ¨¡å¼ä¸»è¦â½¤äº<u>å¤„ç†å¯¹è±¡é—´çš„â¼€å¯¹å¤šçš„å…³ç³»</u>ï¼Œæ˜¯â¼€ç§å¯¹è±¡â¾ä¸ºæ¨¡å¼ã€‚</p><p>è¯¥æ¨¡å¼çš„å®é™…åº”â½¤åœºæ™¯â½è¾ƒå®¹æ˜“ç¡®è®¤ï¼Œå½“â¼€ä¸ªå¯¹è±¡çŠ¶æ€å‘â½£å˜åŒ–æ—¶ï¼Œæ‰€æœ‰è¯¥å¯¹è±¡çš„å…³æ³¨è€…å‡èƒ½æ”¶åˆ°çŠ¶æ€å˜åŒ–é€šçŸ¥ï¼Œä»¥è¿›â¾ç›¸åº”çš„å¤„ç†ã€‚(æ€ä¹ˆè¿™ä¹ˆåƒwebsocketå•Š)</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230524203754928.png" alt="image-20230524203754928" style="zoom:50%;" /><p><strong>Subject</strong>: æŠ½è±¡è¢«è§‚å¯Ÿè€…ï¼Œä»…æä¾›æ³¨å†Œå’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡çš„æ¥â¼å£°æ˜ã€‚<br><strong>ConcreteSubject</strong>: å…·ä½“è¢«è§‚å¯Ÿè€…å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­æ”¶é›†äº†æ‰€æœ‰éœ€è¦è¢«é€šçŸ¥çš„è§‚å¯Ÿè€…ï¼Œå¹¶å¯ä»¥åŠ¨æ€çš„å¢åˆ é›†åˆä¸­çš„è§‚å¯Ÿè€…ã€‚å½“å…¶çŠ¶æ€å‘â½£å˜åŒ–æ—¶ä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ã€‚<br><strong>Observer</strong>: æŠ½è±¡è§‚å¯Ÿè€…ï¼Œä¸ºæ‰€æœ‰è§‚å¯Ÿè€…å®šä¹‰è·å¾—é€šçŸ¥çš„ç»Ÿâ¼€æ¥â¼ï¼›<br><strong>ConcreteObserver</strong>: è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå…¶å…³æ³¨å¯¹è±¡ä¸º Subjectï¼Œèƒ½æ¥å— Subjectå˜åŒ–æ—¶å‘å‡ºçš„é€šçŸ¥å¹¶æ›´æ–°â¾ƒèº«çŠ¶æ€ã€‚</p><ul><li>ä¼˜ç‚¹ï¼š</li></ul><ol><li>è¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…ä¹‹é—´æ˜¯æŠ½è±¡è€¦åˆçš„ï¼›</li><li>è€¦åˆåº¦è¾ƒä½ï¼Œä¸¤è€…ä¹‹é—´çš„å…³è”ä»…ä»…åœ¨äºæ¶ˆæ¯çš„é€šçŸ¥ï¼›</li><li>è¢«è§‚å¯Ÿè€…â½†éœ€å…³â¼¼ä»–çš„è§‚å¯Ÿè€…ï¼›</li><li>â½€æŒâ¼´æ’­é€šä¿¡ï¼›</li></ol><ul><li>ç¼ºç‚¹ï¼š</li></ul><ol><li>è§‚å¯Ÿè€…åªçŸ¥é“è¢«è§‚å¯Ÿå¯¹è±¡å‘â½£äº†å˜åŒ–ï¼Œä½†<strong>ä¸çŸ¥å˜åŒ–çš„è¿‡ç¨‹å’Œç¼˜ç”±</strong>ï¼›</li><li><strong>è§‚å¯Ÿè€…åŒæ—¶ä¹Ÿå¯èƒ½æ˜¯è¢«è§‚å¯Ÿè€…ï¼Œæ¶ˆæ¯ä¼ é€’çš„é“¾è·¯å¯èƒ½ä¼šè¿‡â»“ï¼Œå®Œæˆæ‰€æœ‰</strong><br><strong>é€šçŸ¥èŠ±è´¹æ—¶é—´è¾ƒå¤š</strong></li><li>å¦‚æœè§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä¹‹é—´äº§â½£å¾ªç¯ä¾èµ–ï¼Œæˆ–è€…æ¶ˆæ¯ä¼ é€’é“¾è·¯å½¢æˆé—­<br>ç¯ï¼Œä¼š<u>å¯¼è‡´â½†é™å¾ªç¯</u>ï¼›</li></ol><h4 id="ä½ çš„é¡¹â½¬æ˜¯æ€ä¹ˆâ½¤çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ"><a href="#ä½ çš„é¡¹â½¬æ˜¯æ€ä¹ˆâ½¤çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ" class="headerlink" title="ä½ çš„é¡¹â½¬æ˜¯æ€ä¹ˆâ½¤çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ"></a>ä½ çš„é¡¹â½¬æ˜¯æ€ä¹ˆâ½¤çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ</h4><p>åœ¨â½€ä»˜åœºæ™¯ä¸‹ï¼Œâ½¤æˆ·è´­ä¹°â¼€ä»¶å•†å“ï¼Œå½“â½€ä»˜æˆåŠŸä¹‹åä¸‰â½…ä¼šå›è°ƒâ¾ƒèº«ï¼Œåœ¨è¿™ä¸ªæ—¶å€™ç³»ç»Ÿå¯èƒ½ä¼šæœ‰å¾ˆå¤šéœ€è¦æ‰§â¾çš„é€»è¾‘ï¼ˆå¦‚ï¼šæ›´æ–°è®¢å•çŠ¶æ€ï¼Œå‘é€é‚®ä»¶é€šçŸ¥ï¼Œèµ é€ç¤¼å“â€¦ï¼‰ï¼Œè¿™äº›é€»è¾‘ä¹‹é—´å¹¶æ²¡æœ‰å¼ºè€¦åˆï¼Œå› æ­¤å¤©ç„¶é€‚åˆä½¿â½¤è§‚å¯Ÿè€…æ¨¡å¼å»å®ç°è¿™äº›åŠŸèƒ½ï¼Œå½“æœ‰æ›´å¤šçš„æ“ä½œæ—¶ï¼Œåªéœ€è¦æ·»åŠ æ–°çš„è§‚å¯Ÿè€…å°±èƒ½å®ç°ï¼Œå®Œç¾å®ç°äº†å¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾çš„å¼€é—­åŸåˆ™ã€‚</p><h3 id="è´£ä»»é“¾æ¨¡å¼ï¼š"><a href="#è´£ä»»é“¾æ¨¡å¼ï¼š" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼ï¼š"></a>è´£ä»»é“¾æ¨¡å¼ï¼š</h3><p>â¼€ä¸ªè¯·æ±‚æ²¿ç€â¼€æ¡â€œé“¾â€ä¼ é€’ï¼Œç›´åˆ°è¯¥â€œé“¾â€ä¸Šçš„æŸä¸ªå¤„ç†è€…å¤„ç†å®ƒä¸ºâ½Œã€‚</p><h4 id="è®²è®²è´£ä»»é“¾æ¨¡å¼çš„åº”â½¤åœºæ™¯"><a href="#è®²è®²è´£ä»»é“¾æ¨¡å¼çš„åº”â½¤åœºæ™¯" class="headerlink" title="è®²è®²è´£ä»»é“¾æ¨¡å¼çš„åº”â½¤åœºæ™¯"></a>è®²è®²è´£ä»»é“¾æ¨¡å¼çš„åº”â½¤åœºæ™¯</h4><ul><li><p>å½“ç¨‹åºéœ€è¦ä½¿â½¤ä¸åŒâ½…å¼å¤„ç†ä¸åŒç§ç±»è¯·æ±‚ï¼Œ â½½ä¸”è¯·æ±‚ç±»å‹å’Œé¡ºåºé¢„å…ˆæœªçŸ¥æ—¶ï¼Œ å¯ä»¥ä½¿â½¤è´£ä»»é“¾æ¨¡å¼ã€‚è¯¥æ¨¡å¼èƒ½å°†å¤šä¸ªå¤„ç†è€…è¿æ¥æˆâ¼€æ¡é“¾ã€‚ æ¥æ”¶åˆ°è¯·æ±‚åï¼Œ å®ƒä¼š â€œè¯¢é—®â€ æ¯ä¸ªå¤„ç†è€…æ˜¯å¦èƒ½å¤Ÿå¯¹å…¶è¿›â¾å¤„ç†ã€‚è¿™æ ·æ‰€æœ‰å¤„ç†è€…éƒ½æœ‰æœºä¼šæ¥å¤„ç†è¯·æ±‚ã€‚</p></li><li><p>å½“å¿…é¡»æŒ‰é¡ºåºæ‰§â¾å¤šä¸ªå¤„ç†è€…æ—¶ï¼Œ å¯ä»¥ä½¿â½¤è¯¥æ¨¡å¼ã€‚ â½†è®ºä½ ä»¥ä½•ç§é¡ºåºå°†å¤„ç†è€…è¿æ¥æˆâ¼€æ¡é“¾ï¼Œ æ‰€æœ‰è¯·æ±‚éƒ½ä¼šä¸¥æ ¼æŒ‰ç…§é¡ºåºé€šè¿‡é“¾ä¸Šçš„å¤„ç†è€…ã€‚</p></li></ul><h3 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h3><h4 id="ä»€ä¹ˆæ˜¯ç­–ç•¥æ¨¡å¼ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç­–ç•¥æ¨¡å¼ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç­–ç•¥æ¨¡å¼ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç­–ç•¥æ¨¡å¼ï¼Ÿ</h4><p>ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰å±äºå¯¹è±¡çš„â¾ä¸ºæ¨¡å¼ã€‚å…¶â½¤æ„æ˜¯é’ˆå¯¹â¼€ç»„ç®—æ³•ï¼Œå°†æ¯â¼€ä¸ªç®—æ³•å°è£…åˆ°å…·æœ‰å…±åŒæ¥â¼çš„ç‹¬â½´çš„ç±»ä¸­ï¼Œä»â½½ä½¿å¾—å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼ä½¿å¾—ç®—æ³•å¯ä»¥åœ¨ä¸å½±å“åˆ°å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹å‘â½£å˜åŒ–ã€‚å…¶ä¸»è¦â½¬çš„æ˜¯é€šè¿‡å®šä¹‰ç›¸ä¼¼çš„ç®—æ³•ï¼Œæ›¿æ¢ if else è¯­å¥å†™æ³•ï¼Œå¹¶ä¸”å¯ä»¥éšæ—¶ç›¸äº’æ›¿æ¢ã€‚</p><h4 id="ç­–ç•¥æ¨¡å¼æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"><a href="#ç­–ç•¥æ¨¡å¼æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ" class="headerlink" title="ç­–ç•¥æ¨¡å¼æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"></a>ç­–ç•¥æ¨¡å¼æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</h4><p>å®šä¹‰äº†â¼€ç³»åˆ—å°è£…äº†ç®—æ³•ã€â¾ä¸ºçš„å¯¹è±¡ï¼Œä»–ä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ä¸¾ä¾‹ï¼š Java.util.List å°±æ˜¯å®šä¹‰äº†â¼€ä¸ªå¢ï¼ˆ add ï¼‰ã€åˆ ï¼ˆ remove ï¼‰ã€æ”¹ï¼ˆ set ï¼‰ã€æŸ¥ï¼ˆ indexOf ï¼‰ç­–ç•¥ï¼Œâ¾„äºå®ç°è¿™ä¸ªç­–ç•¥çš„ArrayList ã€ LinkedList ç­‰ç±»ï¼Œåªæ˜¯åœ¨å…·ä½“å®ç°æ—¶é‡‡â½¤äº†ä¸åŒçš„ç®—æ³•ã€‚ä½†å› ä¸ºå®ƒä»¬ç­–ç•¥â¼€æ ·ï¼Œä¸è€ƒè™‘é€Ÿåº¦çš„æƒ…å†µä¸‹ï¼Œä½¿â½¤æ—¶å®Œå…¨å¯ä»¥äº’ç›¸æ›¿æ¢ä½¿â½¤ã€‚</p><h1 id="è®¾è®¡æ¨¡å¼å®ä¾‹ï¼š"><a href="#è®¾è®¡æ¨¡å¼å®ä¾‹ï¼š" class="headerlink" title="è®¾è®¡æ¨¡å¼å®ä¾‹ï¼š"></a>è®¾è®¡æ¨¡å¼å®ä¾‹ï¼š</h1><h2 id="Spring-ä½¿â½¤äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#Spring-ä½¿â½¤äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="Spring ä½¿â½¤äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>Spring ä½¿â½¤äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</h2><ul><li>â¼¯â¼šè®¾è®¡æ¨¡å¼ : Spring ä½¿â½¤â¼¯â¼šæ¨¡å¼é€šè¿‡BeanFactory ã€ ApplicationContext åˆ›å»º bean å¯¹è±¡ã€‚</li><li>ä»£ç†è®¾è®¡æ¨¡å¼ : Spring AOP åŠŸèƒ½çš„å®ç°(<strong>åŠ¨æ€ä»£ç†</strong>)ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> è½¯ä»¶å¼€å‘åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot</title>
      <link href="/2023/06/02/SpringBoot/"/>
      <url>/2023/06/02/SpringBoot/</url>
      
        <content type="html"><![CDATA[<p>æœ¬åšå®¢æ˜¯æ ¹æ®éŸ©é¡ºå¹³è€å¸ˆçš„SpingBootè¯¾ç¨‹è¿›è¡Œçš„çŸ¥è¯†æ€»ç»“ï¼</p><h3 id="SpringBootå¿«é€Ÿå…¥é—¨"><a href="#SpringBootå¿«é€Ÿå…¥é—¨" class="headerlink" title="SpringBootå¿«é€Ÿå…¥é—¨"></a>SpringBootå¿«é€Ÿå…¥é—¨</h3><ul><li>ç®€åŒ–äº†ä¼ ç»Ÿçš„SSMå¼€å‘ï¼Œç®€åŒ–æ•´åˆæ­¥éª¤ï¼Œæé«˜å¼€å‘æ•ˆç‡</li><li>ç®€åŒ–äº†Mavené¡¹ç›®çš„pom.xmlä¾èµ–å¯¼å…¥ï¼Œå¯ä»¥è¯´æ˜¯ä¸€é”®å¯¼å…¥</li></ul><p>@SpringBootApplication:ç”¨äºè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªspringbootåº”ç”¨&#x2F;é¡¹ç›®</p><h3 id="ä¾èµ–ç®¡ç†"><a href="#ä¾èµ–ç®¡ç†" class="headerlink" title="ä¾èµ–ç®¡ç†"></a>ä¾èµ–ç®¡ç†</h3><p>â€‹pom.xmlä¸­</p><p>â€‹å¯¼å…¥äº†çˆ¶å·¥ç¨‹</p><p>â€‹1.spring-boot-starter-parentä¸­è¿˜æœ‰çˆ¶é¡¹ç›®ï¼Œå£°æ˜äº†å¼€å‘ä¸­å¸¸ç”¨çš„ä¾èµ–çš„ç‰ˆæœ¬å·</p><p>â€‹2.ä¼šè‡ªè¡Œè¿›è¡Œç‰ˆæœ¬ä»²è£(ç¨‹åºå‘˜æ²¡æœ‰æŒ‡å®šæŸä¸ªjarä¾èµ–çš„ç‰ˆæœ¬ï¼Œåˆ™ä»¥çˆ¶é¡¹ç›®æŒ‡å®šçš„ç‰ˆæœ¬ä¸ºå‡†)</p><p>â€‹æƒ³è¦ä¿®æ”¹è‡ªåŠ¨ä»²è£çš„ç‰ˆæœ¬ï¼šï¼ˆä¾èµ–å°±è¿‘ä¼˜å…ˆåŸåˆ™ï¼‰</p><p>â€‹æ–¹å¼1ï¼šåœ¨pom.xmlè‡ªè¡Œæ˜¾å¼å¼•å…¥ä¾èµ–<dependency></p><p>â€‹æ–¹å¼2ï¼šåœ¨pom.xmlæ–‡ä»¶ä¸­çš„<properties>æ ‡ç­¾ä¸­æ‰§è¡Œç‰ˆæœ¬å·</p><h4 id="åœºæ™¯å¯åŠ¨å™¨"><a href="#åœºæ™¯å¯åŠ¨å™¨" class="headerlink" title="åœºæ™¯å¯åŠ¨å™¨"></a>åœºæ™¯å¯åŠ¨å™¨</h4><p>â€‹<strong>å®˜æ–¹</strong>ç»™çš„starterå½¢å¼ä¸ºï¼šspring-boot-starter-xxx</p><p>â€‹åœºæ™¯å¯åŠ¨å™¨èƒ½å¤Ÿå¸®ä½ æŠŠä½¿ç”¨xxxæ—¶æ‰€éœ€è¦çš„é…ç½®å…¨éƒ½é…å¥½ï¼Œæ¯”å¦‚webã€redisã€jdbcç­‰</p><p>â€‹<strong>ç¬¬ä¸‰æ–¹</strong>çš„starterå½¢å¼ä¸ºï¼šxxx-spring-boot-starter</p><h3 id="è‡ªåŠ¨é…ç½®"><a href="#è‡ªåŠ¨é…ç½®" class="headerlink" title="è‡ªåŠ¨é…ç½®"></a>è‡ªåŠ¨é…ç½®</h3><h4 id="è‡ªåŠ¨é…ç½®äº†ä»€ä¹ˆï¼Ÿ"><a href="#è‡ªåŠ¨é…ç½®äº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="è‡ªåŠ¨é…ç½®äº†ä»€ä¹ˆï¼Ÿ"></a>è‡ªåŠ¨é…ç½®äº†ä»€ä¹ˆï¼Ÿ</h4><p>â€‹â€“Tomcat</p><p>â€‹â€“SpringMVC</p><p>â€‹â€“è‡ªåŠ¨é…ç½®äº†Webå¸¸ç”¨åŠŸèƒ½å¦‚å­—ç¬¦è¿‡æ»¤å™¨ï¼Œå¹¶æ³¨å…¥åˆ°å®¹å™¨ä¸­</p><p>â€‹â€“ğŸŒŸè‡ªåŠ¨é…ç½®äº†é»˜è®¤æ‰«æåŒ…ç»“æ„ï¼šé»˜è®¤æ‰«æ <strong>springbootä¸»ç¨‹åºç›®å½•ä¸‹åŠå…¶å­ç›®å½•ä¸­</strong>çš„åŒ…åŒ…(å¯ä»¥è‡ªè¡Œé…ç½®)</p><h4 id="å¦‚ä½•ä¿®æ”¹é»˜è®¤é…ç½®ï¼Ÿ"><a href="#å¦‚ä½•ä¿®æ”¹é»˜è®¤é…ç½®ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¿®æ”¹é»˜è®¤é…ç½®ï¼Ÿ"></a>å¦‚ä½•ä¿®æ”¹é»˜è®¤é…ç½®ï¼Ÿ</h4><h5 id="ä¿®æ”¹é»˜è®¤æ‰«æåŒ…ç»“æ„-å¯ä»¥ä¼ å…¥ä¸€ä¸ªStringæ•°ç»„ï¼Œè¡¨ç¤ºéœ€è¦æ‰«æå¤šä¸ªä¸åŒçš„åŒ…"><a href="#ä¿®æ”¹é»˜è®¤æ‰«æåŒ…ç»“æ„-å¯ä»¥ä¼ å…¥ä¸€ä¸ªStringæ•°ç»„ï¼Œè¡¨ç¤ºéœ€è¦æ‰«æå¤šä¸ªä¸åŒçš„åŒ…" class="headerlink" title="ä¿®æ”¹é»˜è®¤æ‰«æåŒ…ç»“æ„(å¯ä»¥ä¼ å…¥ä¸€ä¸ªStringæ•°ç»„ï¼Œè¡¨ç¤ºéœ€è¦æ‰«æå¤šä¸ªä¸åŒçš„åŒ…)"></a>ä¿®æ”¹é»˜è®¤æ‰«æåŒ…ç»“æ„(å¯ä»¥ä¼ å…¥ä¸€ä¸ªStringæ•°ç»„ï¼Œè¡¨ç¤ºéœ€è¦æ‰«æå¤šä¸ªä¸åŒçš„åŒ…)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//scanBasePackages = &#123;&quot;com.study&quot;&#125;æŒ‡å®šspringbootè¦æ‰«æçš„åŒ…åŠå…¶å­åŒ…</span></span><br><span class="line"><span class="meta">@SpringBootApplication(scanBasePackages = &#123;&quot;com.study&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApp</span> &#123;...&#125;</span><br></pre></td></tr></table></figure><h5 id="ä¹Ÿå¯ä»¥åœ¨resources-x2F-application-propertiesæ–‡ä»¶ä¸­å®šä¹‰æ›´å¤šçš„-è‡ªå®šä¹‰é…ç½®"><a href="#ä¹Ÿå¯ä»¥åœ¨resources-x2F-application-propertiesæ–‡ä»¶ä¸­å®šä¹‰æ›´å¤šçš„-è‡ªå®šä¹‰é…ç½®" class="headerlink" title="ä¹Ÿå¯ä»¥åœ¨resources&#x2F;application.propertiesæ–‡ä»¶ä¸­å®šä¹‰æ›´å¤šçš„  è‡ªå®šä¹‰é…ç½®"></a>ä¹Ÿå¯ä»¥åœ¨resources&#x2F;application.propertiesæ–‡ä»¶ä¸­å®šä¹‰æ›´å¤šçš„  <u>è‡ªå®šä¹‰é…ç½®</u></h5><pre><code> âš ï¸æˆ‘ä»¬åœ¨resources/application.propertiesä¸­è‡ªå®šä¹‰äº†é…ç½®ï¼Œé‚£ä¹ˆspringbootåœ¨å“ªè¯»å–è¿™äº›é…ç½®çš„å‘¢ï¼Ÿ</code></pre><p>â€‹æˆ‘ä»¬åœ¨application.propertiesä¸­é…ç½®çš„ä¿¡æ¯ä¼šæ˜ å°„åˆ°è¯¥å±æ€§å¯¹åº”çš„æŸä¸ªç±»ä¸­(é»˜è®¤é…ç½®æœ€ç»ˆéƒ½ä¼šæ˜ å°„åˆ°å¯¹åº”çš„ç±»ä¸­)ï¼Œè¿™ä¸ªç±»ä¼šè¢«æ³¨å†Œè¿›IOCå®¹å™¨ä¸­ï¼Œå› æ­¤é…ç½®æ‰ä¼šç”Ÿæ•ˆï¼</p><p>â€‹è¿˜å¯ä»¥è‡ªå®šä¹‰é…ç½®ï¼Œç±»ä¼¼äºå®šä¹‰ä¸€ä¸ªå¸¸é‡</p><p>é…ç½®çš„å…³ç³»ï¼šapplication.properties  xxxProperties  xxxAutoConfiguration</p><p>xxxAutoConfigurationç±»ä¸­å«æœ‰ä¸€ä¸ªxxxPropertieså¯¹è±¡ï¼ŒxxxPropertieså¯¹è±¡ä¸­ä¿å­˜äº†é»˜è®¤é…ç½®çš„å€¼ï¼Œå¦‚æœç¨‹åºå‘˜åœ¨application.propertiesä¸­è¿›è¡Œäº†è‡ªå®šä¹‰çš„é…ç½®ï¼Œä¼šè¢«åæ˜ åˆ°xxxPropertiesä¸­ï¼Œè¦†ç›–å…¶ä¸­çš„é»˜è®¤å€¼ã€‚äºæ˜¯xxxAutoConfigurationä¸­æºå¸¦çš„é…ç½®å°±æ˜¯application.propertiesä¸xxxPropertiesä¸­çš„ä¿¡æ¯äº†ï¼ŒxxxAutoConfigurationå†è¢«æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ï¼Œäºæ˜¯é…ç½®å®Œæˆï¼</p><h3 id="SpringBootå®¹å™¨åŠŸèƒ½"><a href="#SpringBootå®¹å™¨åŠŸèƒ½" class="headerlink" title="SpringBootå®¹å™¨åŠŸèƒ½"></a>SpringBootå®¹å™¨åŠŸèƒ½</h3><h4 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h4><p>â€‹åœ¨SpringBootä¸­ä½¿ç”¨@Configurationæ·»åŠ &#x2F;æ³¨å…¥ç»„ä»¶</p><p>â€‹é…ç½®ç±»(è¢«@Configurationä¿®é¥°çš„ç±») é…ç½®ç±»ä¹Ÿä¼šæ³¨å…¥åˆ°å®¹å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>      <span class="comment">//è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»</span></span><br><span class="line"><span class="comment">//åœ¨@Configurationæ³¨è§£çš„ç±»ä¸­ï¼Œç¨‹åºå‘˜å¯ä»¥é€šè¿‡@Beanæ³¨è§£æ¥æ³¨å…¥beanå¯¹è±¡åˆ°å®¹å™¨</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span><span class="comment">//é»˜è®¤ä¸ºå•ä¾‹ï¼Œå¯ä»¥åœ¨scopeæ³¨è§£ä¸­è®¾ç½®ä¸ºå¤šä¾‹</span></span><br></pre></td></tr></table></figure><h5 id="proxyBeanMethods-ä»£ç†beançš„æ–¹æ³•"><a href="#proxyBeanMethods-ä»£ç†beançš„æ–¹æ³•" class="headerlink" title="proxyBeanMethods:ä»£ç†beançš„æ–¹æ³•"></a>proxyBeanMethods:ä»£ç†beançš„æ–¹æ³•</h5><p>â€‹@Configuration(proxyBeanMethods &#x3D; false)&#x2F;&#x2F;è¡¨ç¤ºæ¯ä¸ª@Beanæ–¹æ³•è¢«è°ƒç”¨è¿”å›çš„ç»„ä»¶<strong>éƒ½æ˜¯æ–°åˆ›å»ºçš„</strong>ï¼Œå¤šä¾‹ï¼Œä»£ç†æ–¹å¼ Liteæ¨¡å¼</p><p>â€‹@Configuration(proxyBeanMethods &#x3D; true) &#x2F;&#x2F;è¡¨ç¤ºæ¯ä¸ª@Beanæ–¹æ³•è¢«è°ƒç”¨è¿”å›çš„ç»„ä»¶<strong>éƒ½æ˜¯å•å®ä¾‹çš„</strong>ï¼Œå•ä¾‹ï¼Œéä»£ç†æ–¹å¼ Fullæ¨¡å¼</p><p>â€‹â¬†ï¸ä»¥ä¸Šé…ç½®è¦ç”Ÿæ•ˆï¼Œéœ€è¦å…ˆè·å–BeanConfigç»„ä»¶ï¼Œå†è°ƒç”¨æ–¹æ³•</p><p>â€‹å¦‚æœç›´æ¥é€šè¿‡å®¹å™¨è·å–ï¼Œåˆ™ä»¥ä¸Šè®¾ç½®æ— æ•ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç›´æ¥é€šè¿‡å®¹å™¨è·å–ï¼š        </span></span><br><span class="line"><span class="type">Monster</span> <span class="variable">monster01</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster01&quot;</span>, Monster.class);</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">monster02</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;monster01&quot;</span>, Monster.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;01---&quot;</span> + monster01 + <span class="string">&quot; &quot;</span> + monster01.hashCode());</span><br><span class="line">        System.out.println(<span class="string">&quot;02---&quot;</span> + monster02 + <span class="string">&quot; &quot;</span> + monster02.hashCode());</span><br><span class="line"><span class="comment">//è·å–BeanConfigç»„ä»¶ï¼Œå†è°ƒç”¨æ–¹æ³•ï¼š</span></span><br><span class="line">        <span class="type">BeanConfig</span> <span class="variable">beanConfig</span> <span class="operator">=</span> ioc.getBean(BeanConfig.class);</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">monster01</span> <span class="operator">=</span> beanConfig.monster01();</span><br><span class="line">        <span class="type">Monster</span> <span class="variable">monster02</span> <span class="operator">=</span> beanConfig.monster01();</span><br><span class="line">        System.out.println(<span class="string">&quot;01---&quot;</span> + monster01 + <span class="string">&quot; &quot;</span> + monster01.hashCode());</span><br><span class="line">        System.out.println(<span class="string">&quot;02---&quot;</span> + monster02 + <span class="string">&quot; &quot;</span> + monster02.hashCode());</span><br></pre></td></tr></table></figure><h5 id="é…ç½®ç±»â€”â€”configæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ª"><a href="#é…ç½®ç±»â€”â€”configæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ª" class="headerlink" title="é…ç½®ç±»â€”â€”configæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ª"></a>é…ç½®ç±»â€”â€”configæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ª</h5><p>â€‹æ¯ä¸ªç±»å¯ä»¥æœ‰å¤šç§Beanï¼Œç»™@Beanä¿®é¥°çš„æ–¹æ³•èµ·ä¸åŒçš„åå­—( id )å³å¯</p><p>&#x2F;&#x2F;monster02ä¸ºä½ ä¸ºè¯¥beanè®¾ç½®çš„idï¼Œå¦‚æœä½ æ²¡æœ‰ä¸ºå…¶åœ¨@beançš„nameå±æ€§ä¸­è®¾ç½®åç§°ï¼Œé‚£ä¹ˆé»˜è®¤ä¸ºä½ ä¿®é¥°çš„æ„é€ <strong>æ–¹æ³•å</strong><br>é€šè¿‡æ­¤æ­¥éª¤ï¼šioc.getBean(â€œmonster02â€, Monster.class);</p><h4 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h4><p>ä¿®é¥°é…ç½®ç±»ï¼Œå¯ä»¥é€šè¿‡ .classçš„æ•°ç»„ï¼Œæ¥æ³¨å…¥æŒ‡å®šç±»å‹çš„Bean</p><p>â€‹å¯ä»¥ç”¨äºæ³¨å…¥ç»„ä»¶ï¼Œä¾‹ï¼š@Import( {Dog.class, Cat.class} ) &#x2F;&#x2F;<strong><u><em>é»˜è®¤beançš„IDä¸ºè¯¥ç±»çš„å…¨ç±»å</em></u></strong></p><h4 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a>@Conditional</h4><p>â€‹æ¡ä»¶è£…é…ï¼šæ»¡è¶³ConditionalæŒ‡å®šçš„æ¡ä»¶ï¼Œåˆ™è¿›è¡Œç»„ä»¶æ³¨å…¥</p><p>ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å½“å®¹å™¨ä¸­æœ‰ä¸€ä¸ªbeanï¼Œå®ƒçš„åå­—æ˜¯ monster_nmw ,å°±æ³¨å…¥è¿™ä¸ªbeanï¼›æ²¡æœ‰åˆ™ä¸æ³¨å…¥//åªè¦åå­—okå°±è¡Œï¼Œå¯¹ç±»å‹ä¸åšè¦æ±‚</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(name = &quot;monster_nmw&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Dog <span class="title function_">dog01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ@Conditionalä¿®é¥°ç±»ï¼Œé‚£ä¹ˆè¿™ä¸ªé…ç½®ç±»ä¸­çš„æ‰€æœ‰ç»„ä»¶<strong>éƒ½</strong>éœ€è¦æ»¡è¶³è¯¥æ¡ä»¶</p><h4 id="ImportResource"><a href="#ImportResource" class="headerlink" title="@ImportResource"></a>@ImportResource</h4><p><strong>ç”¨äºé…ç½®ä¼ ç»Ÿæ–¹å¼(xmlæ–‡ä»¶)çš„bean</strong></p><p>â€‹ä¿®é¥°æŸä¸ªé…ç½®ç±»ï¼Œå°† .xml æ–‡ä»¶ä¸­çš„é…ç½®å¯¼å…¥åˆ°é…ç½®ç±»ä¸­ï¼Œå¹¶æµ‹è¯•æ˜¯å¦å¯ä»¥è·å¾— .xml æ–‡ä»¶ä¸­çš„ç»„ä»¶</p><p>resourcesç›®å½•ä¸‹çš„xmlæ–‡ä»¶ç”¨ @ImportResource( locations &#x3D; â€œclasspath:xxx.xmlâ€ )</p><h4 id="é…ç½®ç»‘å®šï¼š"><a href="#é…ç½®ç»‘å®šï¼š" class="headerlink" title="é…ç½®ç»‘å®šï¼š"></a>é…ç½®ç»‘å®šï¼š</h4><p>â€‹å°†application.propertiesä¸­æŒ‡å®šçš„k-vå€¼ ä¸ JavaBeanè¿›è¡Œç»‘å®šï¼</p><p>â€‹åŠŸèƒ½ï¼šè·å–JavaBeanæ—¶ï¼Œä¸€äº›æ•°æ®è‡ªåŠ¨ä»application.propertiesè·å–</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è®¾ç½®Furnçš„å±æ€§ k-v</span></span><br><span class="line"><span class="comment">#å…¶ä¸­ furn01 ç”¨äºæŒ‡å®š/åŒºåˆ†ä¸åŒçš„ç»‘å®šå¯¹è±¡ï¼Œè¿™æ ·å¯ä»¥åœ¨ç»‘å®šä¸åŒçš„Furn beanå±æ€§å€¼æ—¶</span></span><br><span class="line"><span class="comment">#é€šè¿‡furn01å‰ç¼€è¿›è¡ŒåŒºåˆ†</span></span><br><span class="line"><span class="comment">#furn01.idä¸­çš„idæ˜¯Furn beançš„å±æ€§å</span></span><br><span class="line"><span class="attr">furn01.id</span>=<span class="string">100</span></span><br><span class="line"><span class="attr">furn01.name</span>=<span class="string">TV</span></span><br><span class="line"><span class="attr">furn01.price</span>=<span class="string">1000.9</span></span><br></pre></td></tr></table></figure><p>åœ¨å¯¹åº”çš„<strong>bean</strong>ä¸­æ·»åŠ æ³¨è§£ï¼š@ConfigurationProperties(prefix &#x3D; â€œfurn01â€)</p><h4 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h4><p>â€‹ä¿®é¥°beanï¼Œç›´æ¥å°†beanæ³¨å†Œå…¥å®¹å™¨</p><h3 id="SpringBootåº•å±‚æœºåˆ¶åˆ†æ"><a href="#SpringBootåº•å±‚æœºåˆ¶åˆ†æ" class="headerlink" title="SpringBootåº•å±‚æœºåˆ¶åˆ†æ"></a>SpringBootåº•å±‚æœºåˆ¶åˆ†æ</h3><h3 id="P32å¼€å§‹"><a href="#P32å¼€å§‹" class="headerlink" title="P32å¼€å§‹"></a>P32å¼€å§‹</h3><h3 id="è·³åˆ°äº†P47"><a href="#è·³åˆ°äº†P47" class="headerlink" title="è·³åˆ°äº†P47"></a>è·³åˆ°äº†P47</h3><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h3 id="Lombok"><a href="#Lombok" class="headerlink" title="Lombok"></a>Lombok</h3><p>ç®€åŒ–Javabeançš„å¼€å‘ï¼Œjavabeanä¸­çš„getterã€setterã€tostringå‡å¯é€šè¿‡Lombokå®ç°</p><p>@Data æ³¨è§£åœ¨ç±»ä¸Šï¼Œæä¾›æ‰€æœ‰å±æ€§çš„getterã€setteræ–¹æ³•</p><p>@Getter</p><p>@Setter</p><p>@ToString</p><p>@NoargsConstructor</p><p>@AllargsConstructor</p><h3 id="Spring-Initializr"><a href="#Spring-Initializr" class="headerlink" title="Spring Initializr"></a>Spring Initializr</h3><p>ç¨‹åºå‘˜ä½¿ç”¨Maven Archetype æ¥ç”ŸæˆMavené¡¹ç›®ï¼Œé¡¹ç›®åŸå‹ç›¸å¯¹ç®€é™‹ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡Spring Initialzræ¥æ„å»ºMavené¡¹ç›®</p><h3 id="53-60è·³äº†ï¼"><a href="#53-60è·³äº†ï¼" class="headerlink" title="53-60è·³äº†ï¼"></a>53-60è·³äº†ï¼</h3><h3 id="yamlï¼š"><a href="#yamlï¼š" class="headerlink" title="yamlï¼š"></a>yamlï¼š</h3><h4 id="åŸºæœ¬è§„åˆ™ï¼š"><a href="#åŸºæœ¬è§„åˆ™ï¼š" class="headerlink" title="åŸºæœ¬è§„åˆ™ï¼š"></a>åŸºæœ¬è§„åˆ™ï¼š</h4><h5 id="æ ¼å¼ï¼š"><a href="#æ ¼å¼ï¼š" class="headerlink" title="æ ¼å¼ï¼š"></a>æ ¼å¼ï¼š</h5><p>â€‹        keyï¼š value        (key + : + ä¸€ä¸ªç©ºæ ¼ + value)<br>â€‹å¤§å°å†™æ•æ„Ÿ<br>â€‹ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»<br>â€‹    ç¼©è¿›ä¸å…è®¸ä½¿ç”¨Tabï¼Œåªèƒ½ä½¿ç”¨ç©ºæ ¼<br>â€‹    ç¼©è¿›çš„æ ¼æ•°ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦å¯¹é½å³å¯<br>â€‹    â€˜#â€™ è¡¨ç¤ºæ³¨é‡Š<br>â€‹å­—ç¬¦ä¸²æ— éœ€åŠ å¼•å·ï¼š<br>â€‹å•å¼•å·ä¼šå°† \n ä½œä¸ºå­—ç¬¦ä¸²è¾“å‡º<br>â€‹åŒå¼•å·ä¼šå°† \n ä½œä¸ºæ¢è¡Œè¾“å‡º</p><h5 id="è¡¨ç¤ºå¯¹è±¡ï¼š"><a href="#è¡¨ç¤ºå¯¹è±¡ï¼š" class="headerlink" title="è¡¨ç¤ºå¯¹è±¡ï¼š"></a>è¡¨ç¤ºå¯¹è±¡ï¼š</h5><p>â€‹    k: {k1: v1,k2: v2,â€¦.}<br>æˆ–<br>â€‹    k:<br>â€‹      k1: v1<br>â€‹      k2:v2<br>â€‹      k3:v3<br>â€‹      â€¦</p><h5 id="è¡¨ç¤ºæ•°ç»„ï¼š"><a href="#è¡¨ç¤ºæ•°ç»„ï¼š" class="headerlink" title="è¡¨ç¤ºæ•°ç»„ï¼š"></a>è¡¨ç¤ºæ•°ç»„ï¼š</h5><p>â€‹    k: [v1,v2,v3,â€¦]<br>æˆ–<br>â€‹    k:<br>â€‹&#x2F;- v1<br>â€‹&#x2F;-v2<br>â€‹&#x2F;-v3<br>â€‹â€¦â€¦</p><!--    åœ¨ymlæ–‡ä»¶ä¸­ï¼Œè¾“å…¥è‡ªå®šjavabeanæ—¶éœ€è¦æç¤ºï¼Œåªéœ€å¼•å…¥å¦‚ä¸‹ä¾èµ–    --><dependency>    <groupId>org.springframework.boot</groupId>    <artifactId>spring-boot-configuration-processor</artifactId>    <optional>true</optional></dependency><p>propertiesæ–‡ä»¶ä¸yamlæ–‡ä»¶ä¼šè¢«**é€ä¸ªè§£æ(æŒ‰æ–‡ä»¶é¡ºåº)**ï¼Œè‹¥å®šä¹‰äº†åŒæ ·çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆè°å…ˆå®šä¹‰å°±æŒ‰è°çš„æ¥</p><h3 id="WEBå¼€å‘-é™æ€èµ„æºè®¿é—®"><a href="#WEBå¼€å‘-é™æ€èµ„æºè®¿é—®" class="headerlink" title="WEBå¼€å‘-é™æ€èµ„æºè®¿é—®"></a>WEBå¼€å‘-é™æ€èµ„æºè®¿é—®</h3><h4 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h4><h5 id="é»˜è®¤é™æ€èµ„æºç›®å½•ï¼š"><a href="#é»˜è®¤é™æ€èµ„æºç›®å½•ï¼š" class="headerlink" title="é»˜è®¤é™æ€èµ„æºç›®å½•ï¼š"></a>é»˜è®¤é™æ€èµ„æºç›®å½•ï¼š</h5><p>â€‹æ”¾åœ¨resourceç›®å½•ä¸‹çš„å››ç§ç›®å½•ä¸­ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯é™æ€èµ„æºï¼š<br>â€‹    1.&#x2F;static<br>â€‹    2.&#x2F;public<br>â€‹    3.&#x2F;resources<br>â€‹    4.&#x2F;META-INF&#x2F;resources</p><p>â€‹å¯è‡ªè¡Œæ›´æ”¹æˆåˆ«çš„åŒ…ï¼Œä½†æ²¡å¿…è¦</p><p>ğŸŒŸä¸ºä»€ä¹ˆæ˜¯è¿™å‡ ä¸ªåŒ…å‘¢ï¼Ÿå› ä¸ºåœ¨Springå®¹å™¨ä¸­ï¼ŒWebProperties.javaåœ¨IOCå®¹å™¨ä¸­è¢«åŠ è½½ï¼Œè€Œåœ¨å…¶ä¸­å®šä¹‰äº†é»˜è®¤çš„é™æ€èµ„æºè·¯å¾„ï¼</p><h5 id="å¸¸è§é™æ€èµ„æºï¼š"><a href="#å¸¸è§é™æ€èµ„æºï¼š" class="headerlink" title="å¸¸è§é™æ€èµ„æºï¼š"></a>å¸¸è§é™æ€èµ„æºï¼š</h5><p>â€‹.js .css å›¾ç‰‡ å­—ä½“æ–‡ä»¶ç­‰ç­‰</p><h5 id="è®¿é—®æ–¹å¼ï¼š"><a href="#è®¿é—®æ–¹å¼ï¼š" class="headerlink" title="è®¿é—®æ–¹å¼ï¼š"></a>è®¿é—®æ–¹å¼ï¼š</h5><p>â€‹é¡¹ç›®æ ¹è·¯å¾„&#x2F; + é™æ€èµ„æºå (æ— éœ€ä¸­é—´çš„è·¯å¾„ï¼Œç›´æ¥èµ„æºåå³å¯)</p><p>â€‹åŸå› ï¼šåœ¨ WebProperties.java ä¸­ï¼Œå¸®ä½ åšäº†æ˜ å°„ã€‚å½“ç„¶ï¼Œä¸æ»¡æ„çš„è¯ä¹Ÿå¯ä»¥è‡ªå®šé…ç½®å®šä¹‰ã€‚</p><h5 id="æ³¨æ„äº‹é¡¹ï¼š"><a href="#æ³¨æ„äº‹é¡¹ï¼š" class="headerlink" title="æ³¨æ„äº‹é¡¹ï¼š"></a>æ³¨æ„äº‹é¡¹ï¼š</h5><h6 id="é™æ€èµ„æºè®¿é—®åŸç†ï¼š"><a href="#é™æ€èµ„æºè®¿é—®åŸç†ï¼š" class="headerlink" title="é™æ€èµ„æºè®¿é—®åŸç†ï¼š"></a>é™æ€èµ„æºè®¿é—®åŸç†ï¼š</h6><p>â€‹é™æ€æ˜ å°„æ˜¯ &#x2F;**  ä¹Ÿå°±æ˜¯å¯¹æ‰€æœ‰è¯·æ±‚æ‹¦æˆªï¼Œå½“æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œ<strong>å…ˆçœ‹Controllerèƒ½ä¸èƒ½å¤„ç†</strong>ï¼Œè‹¥ä¸èƒ½ï¼Œå†å°†è¯·æ±‚äº¤ç»™<strong>é™æ€èµ„æºå¤„ç†å™¨</strong>ï¼Œå¦‚æœé™æ€èµ„æºä¸­ä¹Ÿæ— æ³•åŒ¹é…ï¼Œåˆ™è¿”å›404é”™è¯¯   </p><p>â€‹ï¼ˆå³ï¼š<u>å…ˆçœ‹Controllerä¸­æœ‰æ— åŒ¹é…ï¼Œæ²¡æœ‰å†çœ‹é™æ€èµ„æºä¸­æœ‰æ²¡æœ‰</u>ï¼‰</p><p><strong>âš ï¸å› æ­¤Controllerä¸­çš„è¯·æ±‚å¯èƒ½å’Œé™æ€èµ„æºé‡åï¼Œå¯¼è‡´æ„å¤–çš„é”™è¯¯ï¼Œå› æ­¤æˆ‘ä»¬æœ‰æ—¶éœ€è¦å°†é™æ€èµ„æºçš„é»˜è®¤è®¿é—®å‰ç¼€è¿›è¡Œä¿®æ”¹ï¼Œä»è€Œé¿å…å†²çª</strong></p><h6 id="ä¿®æ”¹é™æ€èµ„æºè®¿é—®å‰ç¼€ï¼š"><a href="#ä¿®æ”¹é™æ€èµ„æºè®¿é—®å‰ç¼€ï¼š" class="headerlink" title="ä¿®æ”¹é™æ€èµ„æºè®¿é—®å‰ç¼€ï¼š"></a>ä¿®æ”¹é™æ€èµ„æºè®¿é—®å‰ç¼€ï¼š</h6><p>â€‹åœ¨ application.yaml ä¸­é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹é™æ€èµ„æºè®¿é—®çš„è·¯å¾„/ å‰ç¼€</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">/study/**</span></span><br></pre></td></tr></table></figure><h6 id="å¢åŠ ä¸€ä¸ªé™æ€èµ„æºç›®å½•ï¼š"><a href="#å¢åŠ ä¸€ä¸ªé™æ€èµ„æºç›®å½•ï¼š" class="headerlink" title="å¢åŠ ä¸€ä¸ªé™æ€èµ„æºç›®å½•ï¼š"></a>å¢åŠ ä¸€ä¸ªé™æ€èµ„æºç›®å½•ï¼š</h6><p>â€‹â€¦</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">static-locations:</span> [<span class="string">æ–°çš„è·¯å¾„</span>]<span class="comment"># å¦‚æœåŸæ¥çš„è¿˜æƒ³ç”¨ï¼Œé‚£ä¹ˆè¦æŠŠåŸæ¥çš„ä¹Ÿå¡«è¿›æ–°çš„è·¯å¾„ä¸­</span></span><br></pre></td></tr></table></figure><h3 id="Resté£æ ¼è¯·æ±‚å¤„ç†"><a href="#Resté£æ ¼è¯·æ±‚å¤„ç†" class="headerlink" title="Resté£æ ¼è¯·æ±‚å¤„ç†"></a>Resté£æ ¼è¯·æ±‚å¤„ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MonsterController</span> &#123;</span><br><span class="line"><span class="comment">//    @RequestMapping(value = &quot;/monster&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/monster&quot;)</span><span class="comment">//ä¸¤ç§å†™æ³•ä½œç”¨ç›¸åŒï¼</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMonster</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;GET-æŸ¥è¯¢&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/monster&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">saveMonster</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;POST-ä¿å­˜&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/monster&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">putMonster</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;PUT-ä¿®æ”¹&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/monster&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">deleteMonster</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;DELETE-åˆ é™¤&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯æ˜¯ PostMan å¯ä»¥ç›´æ¥å‘é€Putã€Delete è¯·æ±‚ï¼Œå¯ä»¥ä¸è®¾ç½®Filter</p><p>å¦‚æœè¦springbootæ”¯æŒ<strong>é¡µé¢è¡¨å•</strong>çš„ReståŠŸèƒ½ï¼Œéœ€è¦æ³¨æ„ï¼š</p><ul><li>Resté£æ ¼è¯·æ±‚ æ ¸å¿ƒFilterâ€”â€”HiddenHttpMethodFilterï¼Œè¡¨å•è¯·æ±‚ä¼šè¢«å…¶æ‹¦æˆªï¼Œè·å–è¡¨å•çš„ _methodå€¼ï¼Œå†åˆ¤æ–­æ˜¯PUT&#x2F;DELETE&#x2F;PATCH</li><li>éœ€è¦åœ¨application.ymlä¸­å¯åŠ¨filteråŠŸèƒ½</li><li>ä¿®æ”¹application.ymlï¼Œå¯ç”¨filteråŠŸèƒ½</li></ul><p>@RestController ä¸ @Controllerï¼š</p><p>â€‹@Controllerï¼šä¼šå°†æ–¹æ³•è¿”å›çš„Stringäº¤ç»™è§†å›¾è§£æå™¨ï¼Œå†è·³è½¬åˆ°é¡µé¢</p><p>â€‹1.å¦‚æœæ²¡æœ‰é…ç½®è§†å›¾è§£æå™¨ï¼Œçœ‹æœ‰æ²¡æœ‰å¯¹åº”è¿”å›Stringçš„å…¶ä»–Controllerï¼Œæœ‰ï¼Œè¿›å…¥å…¶ä»–controller</p><p>â€‹2.å¦‚æœé…ç½®äº†è§†å›¾è§£æå™¨ï¼Œåˆ™ç›´æ¥å¯»æ‰¾æœ‰æ— å¯¹åº”è§†å›¾è§£æå™¨ï¼Œæœ‰åˆ™ä½¿ç”¨è§†å›¾è§£æå™¨</p><p>â€‹3.æ‰¾ä¸åˆ°åˆ™è¿”å›404</p><p>â€‹@RestControllerï¼šä¼šç›´æ¥è¿”å›Stringï¼Œä¸ä¼šå¯»æ‰¾è§†å›¾è§£æå™¨è¿›è¡Œè·³è½¬</p><h2 id="å‚æ•°æ¥æ”¶ç›¸å…³æ³¨è§£"><a href="#å‚æ•°æ¥æ”¶ç›¸å…³æ³¨è§£" class="headerlink" title="å‚æ•°æ¥æ”¶ç›¸å…³æ³¨è§£"></a>å‚æ•°æ¥æ”¶ç›¸å…³æ³¨è§£</h2><h3 id="Springbootæ¥æ”¶å‚æ•°æ³¨è§£ä»‹ç»ï¼š"><a href="#Springbootæ¥æ”¶å‚æ•°æ³¨è§£ä»‹ç»ï¼š" class="headerlink" title="Springbootæ¥æ”¶å‚æ•°æ³¨è§£ä»‹ç»ï¼š"></a>Springbootæ¥æ”¶å‚æ•°æ³¨è§£ä»‹ç»ï¼š</h3><h4 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h4><p>â€‹æ¥æ”¶urlè·¯å¾„ä¸­çš„å˜é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParameterController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/monster/&#123;id&#125;/&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">pathVariable</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id,</span></span><br><span class="line"><span class="params">                               <span class="meta">@PathVariable(&quot;name&quot;)</span>String name,</span></span><br><span class="line"><span class="params">                               <span class="meta">@PathVariable</span> Map&lt;String, String&gt; map)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;id:&quot;</span> + id);</span><br><span class="line">        System.out.println(<span class="string">&quot;name:&quot;</span> + name);</span><br><span class="line">        System.out.println(<span class="string">&quot;map:&quot;</span> + map);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RequestHeader"><a href="#RequestHeader" class="headerlink" title="@RequestHeader"></a>@RequestHeader</h4><p>â€‹è·å–httpè¯·æ±‚å¤´ä¸­çš„å…¨éƒ¨æˆ–éƒ¨åˆ†ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–httpè¯·æ±‚å¤´ä¸­çš„hostä¿¡æ¯</span></span><br><span class="line"><span class="comment">//è·å–httpè¯·æ±‚å¤´ä¸­çš„æ‰€æœ‰ä¿¡æ¯</span></span><br><span class="line"><span class="meta">@GetMapping</span> (<span class="string">&quot;/requestHeader&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestHeader</span><span class="params">(<span class="meta">@RequestHeader(&quot;Host&quot;)</span>String host,</span></span><br><span class="line"><span class="params">                            <span class="meta">@RequestHeader</span> Map&lt;String, String&gt;header)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;host-&quot;</span> + host);</span><br><span class="line">    System.out.println(<span class="string">&quot;header-&quot;</span> + header);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ModelAttribute"><a href="#ModelAttribute" class="headerlink" title="@ModelAttribute"></a>@ModelAttribute</h4><h5 id="RequestAttribute"><a href="#RequestAttribute" class="headerlink" title="@RequestAttribute"></a>@RequestAttribute</h5><p>â€‹è·å–requeståŸŸå±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/ok&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">ok</span><span class="params">(<span class="meta">@RequestAttribute(value = &quot;user&quot;,required = false)</span>String user)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user:&quot;</span> + user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="SessionAttribute"><a href="#SessionAttribute" class="headerlink" title="@SessionAttribute"></a>@SessionAttribute</h5><p>â€‹è·å–sessionåŸŸå±æ€§ï¼Œä½¿ç”¨æ–¹æ³•ä¸@RequestAttributeç›¸åŒ</p><h4 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a>@RequestParam</h4><p>â€‹è·å–è¯·æ±‚å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¯·æ±‚ä¿¡æ¯ï¼š</span></span><br><span class="line">&lt;a href=<span class="string">&quot;/hi?name=xiaowoniu&amp;fruit=pear&amp;fruit=apple&quot;</span>&gt;<span class="meta">@RequestParam</span>-è·å–è¯·æ±‚å‚æ•°&lt;/a&gt;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@GetMapping(&quot;/hi&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hi</span><span class="params">(<span class="meta">@RequestParam(value=&quot;name&quot;)</span>String username,</span></span><br><span class="line"><span class="params">                 <span class="meta">@RequestParam(value = &quot;fruit&quot;)</span>List&lt;String&gt; fruits)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;username-&quot;</span> + username);</span><br><span class="line">    System.out.println(<span class="string">&quot;fruits-&quot;</span> + fruits);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CookieValue"><a href="#CookieValue" class="headerlink" title="@CookieValue"></a>@CookieValue</h4><p>â€‹è·å–cookieä¸­çš„ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/cookie&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">cookie</span><span class="params">(<span class="meta">@CookieValue(value = &quot;cookie_key&quot;,required = false)</span>String cookie_value,        <span class="meta">@CookieValue(value = &quot;username&quot;,required = false)</span> Cookie cookie)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;cookie_value:&quot;</span> + cookie_value);</span><br><span class="line">    <span class="keyword">if</span> (cookie != <span class="literal">null</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;username:&quot;</span> + cookie.getName() + <span class="string">&quot; - &quot;</span> + cookie.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h4><p>â€‹è·å–  <strong>POSTè¯·æ±‚ä½“</strong>  ï¼Œå¯ä»¥ç›´æ¥å°è£…åˆ°javabeanä¸­(<strong>åœ¨è‡ªå®šä¹‰å‚æ•°å¯¹è±¡ç« èŠ‚ä¸­teach</strong>)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">postMethod</span><span class="params">(<span class="meta">@RequestBody</span> String content)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;content:&quot;</span> + content);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤æ‚å‚æ•°"><a href="#å¤æ‚å‚æ•°" class="headerlink" title="å¤æ‚å‚æ•°"></a>å¤æ‚å‚æ•°</h3><h4 id="åŸºæœ¬ä»‹ç»-1"><a href="#åŸºæœ¬ä»‹ç»-1" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h4><p>controllerä¸­ï¼Œå¦‚æœæœ‰mapã€modelå½¢å‚ï¼Œå¦‚æœåœ¨æ–¹æ³•è¿‡ç¨‹ä¸­å‘å…¶ä¸­æ”¾å…¥äº†æ•°æ®ï¼Œé‚£ä¹ˆrequeståŸŸä¸­ä¼šä¿å­˜mapã€modelä¸­çš„æ‰€æœ‰æ•°æ®</p><h4 id="å¤æ‚å‚æ•°åº”ç”¨å®ä¾‹"><a href="#å¤æ‚å‚æ•°åº”ç”¨å®ä¾‹" class="headerlink" title="å¤æ‚å‚æ•°åº”ç”¨å®ä¾‹"></a>å¤æ‚å‚æ•°åº”ç”¨å®ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å“åº”ä¸€ä¸ªå¤æ‚è¯·æ±‚ï¼ˆæ³¨å†Œè¯·æ±‚</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/register&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">register</span><span class="params">(Map&lt;String, String&gt; map,</span></span><br><span class="line"><span class="params">                       Model model,</span></span><br><span class="line"><span class="params">                       HttpServletResponse response)</span>&#123;</span><br><span class="line">    <span class="comment">//å¦‚æœä¸€ä¸ªæ³¨å†Œè¯·æ±‚æ¥äº†ï¼Œæˆ‘ä»¬ä¼šå°†æ³¨å†Œçš„æ•°æ®å°è£…åˆ°mapæˆ–è€…modelä¸­</span></span><br><span class="line">    <span class="comment">//mapä¸modelä¸­çš„æ•°æ®ä¼šè¢«æ”¾å…¥requestä¸­</span></span><br><span class="line">    map.put(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;tjy&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;job&quot;</span>, <span class="string">&quot;java engineer&quot;</span>);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;sal&quot;</span>, <span class="number">80000</span>);</span><br><span class="line">    <span class="comment">//ä¸€ä¼šå†æµ‹è¯•responseçš„ä½¿ç”¨</span></span><br><span class="line">    <span class="comment">//æ¼”ç¤ºåˆ›å»º cookieï¼Œå¹¶é€šè¿‡responseæ·»åŠ åˆ°æµè§ˆå™¨</span></span><br><span class="line">    <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;123@qq.com&quot;</span>);</span><br><span class="line">    response.addCookie(cookie);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;forward:/registerOk&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/registerOk&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">registerOk</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user:&quot;</span> + request.getAttribute(<span class="string">&quot;user&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;job:&quot;</span> + request.getAttribute(<span class="string">&quot;job&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;sal:&quot;</span> + request.getAttribute(<span class="string">&quot;sal&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰å¯¹è±¡å‚æ•°-è‡ªåŠ¨å°è£…"><a href="#è‡ªå®šä¹‰å¯¹è±¡å‚æ•°-è‡ªåŠ¨å°è£…" class="headerlink" title="è‡ªå®šä¹‰å¯¹è±¡å‚æ•°-è‡ªåŠ¨å°è£…"></a>è‡ªå®šä¹‰å¯¹è±¡å‚æ•°-è‡ªåŠ¨å°è£…</h3><p>â€‹SpringBootåœ¨å“åº”è¯·æ±‚æ—¶ï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰å¯¹è±¡å‚æ•°</p><p>â€‹å®Œæˆè‡ªåŠ¨ç±»å‹è½¬æ¢ä¸æ ¼å¼åŒ–</p><p>â€‹æ”¯æŒçº§è”å°è£…</p><p>â€‹</p><h2 id="è‡ªå®šä¹‰è½¬æ¢å™¨"><a href="#è‡ªå®šä¹‰è½¬æ¢å™¨" class="headerlink" title="è‡ªå®šä¹‰è½¬æ¢å™¨"></a>è‡ªå®šä¹‰è½¬æ¢å™¨</h2><p>Convert</p><p>â€‹SpringBootåœ¨å“åº”å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œ<strong>å°†æäº¤çš„æ•°æ®å°è£…æˆå¯¹è±¡</strong>æ—¶ï¼Œä½¿ç”¨äº†<strong>å†…ç½®çš„è½¬åŒ–å™¨</strong></p><p>â€‹ä¹Ÿæ”¯æŒè‡ªå®šä¹‰è½¬æ¢å™¨</p><p>(ç”¨äºå°†æ¥æ”¶åˆ°çš„æ•°æ®å°è£…åˆ°javabeanä¸­æ—¶ï¼Œè‡ªå®šä¹‰çš„ç±»å‹è½¬æ¢â€”â€”å¦‚ï¼šæ¥æ”¶åˆ°äº†tom,123å¯ä»¥è½¬æ¢ä¸ºEmployeeå¯¹è±¡ï¼Œtom -&gt; Employee.name; 123 -&gt; Employee.salary)  </p><p>SpringBootåœ¨æ¥å—æ•°æ®æ—¶ ä¼šå¯¹<strong>æ¥æ”¶åˆ°çš„æ•°æ®ç±»å‹</strong>ä»¥åŠ<strong>å°†è¦è½¬æ¢çš„æ•°æ®ç±»å‹</strong>å¯»æ‰¾å¯¹åº”çš„è½¬æ¢å™¨ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰è½¬æ¢å™¨ï¼Œæˆ‘ä»¬ä¸èƒ½å°†ç›®æ ‡æ•°æ®ç±»å‹è®¾ä¸ºè‡ªå®šä¹‰ç±»å‹ï¼Œé™¤éä½ å†™äº†å¯¹åº”çš„è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨</p><p>â€‹<strong>å†™åœ¨ConfigåŒ…ä¸­</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springboot.config;</span><br><span class="line"><span class="keyword">import</span> com.study.springboot.bean.Car;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.convert.converter.Converter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.FormatterRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.ObjectUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/5/16</span></span><br><span class="line"><span class="comment"> * 11:05</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//è‡ªå®šä¹‰é…ç½®ç±»</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¡¨ç¤ºWebConfigæ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå¯ç”¨äº†Liteæ¨¡å¼</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”¨äºæ³¨å…¥bean WebMvcConfigurer</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFormatters</span><span class="params">(FormatterRegistry registry)</span> &#123;</span><br><span class="line">                <span class="comment">//1. åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„è½¬æ¢å™¨</span></span><br><span class="line">                <span class="comment">//2. String â€”â€”&gt; Car</span></span><br><span class="line">                <span class="comment">//3. å¢åŠ çš„è‡ªå®šä¹‰è½¬æ¢å™¨ä¼šæ³¨å†Œåˆ°Converterså®¹å™¨ä¸­</span></span><br><span class="line">                <span class="comment">//4. converter åº•å±‚ç»“æ„æ˜¯ ConcurrentHashMap å†…ç½®é»˜è®¤æœ‰124ä¸ªè½¬æ¢å™¨</span></span><br><span class="line">                registry.addConverter(<span class="keyword">new</span> <span class="title class_">Converter</span>&lt;String, Car&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Car <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">                        <span class="comment">//åœ¨æ­¤åŠ å…¥è‡ªå®šä¹‰çš„è½¬æ¢ä¸šåŠ¡ä»£ç </span></span><br><span class="line">                        <span class="keyword">if</span>(!ObjectUtils.isEmpty(source))&#123;</span><br><span class="line">                            <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line">                            String[] split = source.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                            car.setName(split[<span class="number">0</span>]);</span><br><span class="line">                            car.setPrice(Double.parseDouble(split[<span class="number">1</span>]));</span><br><span class="line">                            <span class="keyword">return</span> car;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Springbootä½¿ç”¨HashMapå­˜å‚¨æ‰€æœ‰è½¬æ¢å™¨ï¼Œå…¶ä¸­ keyç”±<strong>convertçš„åŸæ•°æ®ç±»å‹ä¸ç›®çš„æ•°æ®ç±»å‹ç»„æˆ</strong>ï¼Œé—®é¢˜æ¥äº†ï¼Œå¦‚æœå¯¹äºä¸€ç»„æ•°æ®ç±»å‹ï¼Œæ³¨å†Œäº†å¤šä¸ªè½¬æ¢å™¨ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿâ€”â€”â€”â€”â€”â€”åæ¥å†™çš„ä¼šæŠŠå‰é¢å†™çš„<u><strong>è¦†ç›–</strong></u>ï¼</p><p>@Controller</p><p>å¯¹äºreturnçš„Stringï¼Œåœ¨é™æ€èµ„æºä¸­å¯»æ‰¾å“åº”çš„é¡µé¢</p><p>@ResponseBody</p><p>å¯ä»¥ä»¥jsonæ ¼å¼è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡</p><p>ä¹Ÿå¯ä»¥ç›´æ¥åœ¨é¡µé¢ä¸Šè¿”å›Stringï¼Œè€Œä¸ä¼šè¿›è¡Œè§†å›¾è§£æ(å¯ä»¥ä¿®é¥°ç±»ï¼Œä¹Ÿå¯ä»¥ä¿®é¥°æ–¹æ³•)</p><p>@RestController &#x3D; @Controller + @ResponseBody</p><h2 id="å¤„ç†JSONæ ¼å¼æ•°æ®"><a href="#å¤„ç†JSONæ ¼å¼æ•°æ®" class="headerlink" title="å¤„ç†JSONæ ¼å¼æ•°æ®"></a>å¤„ç†JSONæ ¼å¼æ•°æ®</h2><h2 id="å†…å®¹åå•†"><a href="#å†…å®¹åå•†" class="headerlink" title="å†…å®¹åå•†"></a>å†…å®¹åå•†</h2><p>â€‹å®¢æˆ·ç«¯å‘é€å™¨è¯·æ±‚ï¼Œè¯·æ±‚ä¸­ä¼šæºå¸¦ä¸€ä¸ªACCEPTå­—æ®µï¼Œå‘Šè¯‰æœåŠ¡ç«¯åº”è¯¥è¿”å›ä»€ä¹ˆç±»å‹çš„æ•°æ®</p><p>â€‹åœ¨AbstractJackson2HttpMessageConverter.java ä¸­ï¼Œ contentTypeå­—æ®µä¼šè·å–è¯·æ±‚ä¸­çš„ä¿¡æ¯ï¼Œä»è€ŒçŸ¥é“åº”å½“è¿”å›ä»€ä¹ˆç±»å‹çš„æ•°æ®</p><p>ğŸŒŸæˆ‘ä»¬è¿˜å¯ä»¥å¯¹è¯·æ±‚Headerä¸­çš„ACCEPTå­—æ®µæ·»åŠ å¤šç§å¯ä»¥æ¥å—çš„æ•°æ®ç±»å‹ï¼Œå¹¶èµ‹äºˆæƒé‡ï¼Œè¿™æ ·å°±æ›´åŠ ä½“ç°äº†å†…å®¹åå•†çš„æ€æƒ³ï¼</p><p>â¬†ï¸é—®é¢˜ï¼špostmanä¸­å¯ä»¥éšæ„æ”¹å˜acceptä¸­çš„ä¿¡æ¯ï¼Œé‚£æµè§ˆå™¨ä¸­ä¸èƒ½ä¿®æ”¹ï¼Œåˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>â€”â€”å¼€å¯ <strong>åŸºäºè¯·æ±‚å‚æ•°çš„å†…å®¹åå•†åŠŸèƒ½</strong>â¬‡ï¸</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">contentnegotiation:</span></span><br><span class="line">      <span class="attr">favor-parameter:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="Thymeleaf"><a href="#Thymeleaf" class="headerlink" title="Thymeleaf"></a>Thymeleaf</h2><p>â€‹ä¸€ç§æœåŠ¡å™¨æ¸²æŸ“æŠ€æœ¯</p><p>thymeleafé¡µé¢æ— éœ€æœåŠ¡å™¨æ¸²æŸ“ä¹Ÿå¯ä»¥è¢«æµè§ˆå™¨è¿è¡Œï¼Œé¡µé¢ç®€æ´</p><p>ç¼ºç‚¹ï¼šå¹¶ä¸æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å¼•æ“ï¼Œé€‚ç”¨äºå•ä½“åº”ç”¨</p>]]></content>
      
      
      <categories>
          
          <category> Springå¼€å‘æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud</title>
      <link href="/2023/06/02/SpringCloud/"/>
      <url>/2023/06/02/SpringCloud/</url>
      
        <content type="html"><![CDATA[<p> æœ¬åšå®¢å‚ç…§äº†éŸ©é¡ºå¹³è€å¸ˆçš„ Sping Cloud è¯¾ç¨‹è®²ä¹‰ï¼</p><h1 id="1-Spring-Cloud-åŸºæœ¬ä»‹ç»"><a href="#1-Spring-Cloud-åŸºæœ¬ä»‹ç»" class="headerlink" title="1 Spring Cloud åŸºæœ¬ä»‹ç»"></a><strong>1 Spring Cloud</strong> åŸºæœ¬ä»‹ç»</h1><h2 id="1-1-å®˜æ–¹æ–‡æ¡£"><a href="#1-1-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="1.1 å®˜æ–¹æ–‡æ¡£"></a>1.1 å®˜æ–¹æ–‡æ¡£</h2><h3 id="1-1-1"><a href="#1-1-1" class="headerlink" title="1.1.1"></a>1.1.1</h3><h3 id="åœ°å€-https-spring-io-projects-spring-cloud"><a href="#åœ°å€-https-spring-io-projects-spring-cloud" class="headerlink" title="åœ°å€**: https://spring.io/projects/spring-cloud**"></a>åœ°å€**: <a href="https://spring.io/projects/spring-cloud">https://spring.io/projects/spring-cloud</a>**</h3><h2 id="1-2-å¾®æœåŠ¡å¼•å‡º"><a href="#1-2-å¾®æœåŠ¡å¼•å‡º" class="headerlink" title="1.2 å¾®æœåŠ¡å¼•å‡º"></a>1.2 å¾®æœåŠ¡å¼•å‡º</h2><h3 id="1-æ²¡æœ‰å¾®æœåŠ¡æŠ€æœ¯-æ˜¯ä¸æ˜¯ç¨‹åºå‘˜å°±ä¸èƒ½å¼€å‘å¤§å‹é¡¹ç›®"><a href="#1-æ²¡æœ‰å¾®æœåŠ¡æŠ€æœ¯-æ˜¯ä¸æ˜¯ç¨‹åºå‘˜å°±ä¸èƒ½å¼€å‘å¤§å‹é¡¹ç›®" class="headerlink" title="1.æ²¡æœ‰å¾®æœåŠ¡æŠ€æœ¯**,æ˜¯ä¸æ˜¯ç¨‹åºå‘˜å°±ä¸èƒ½å¼€å‘å¤§å‹é¡¹ç›®?**"></a>1.æ²¡æœ‰å¾®æœåŠ¡æŠ€æœ¯**,<strong>æ˜¯ä¸æ˜¯ç¨‹åºå‘˜å°±ä¸èƒ½å¼€å‘å¤§å‹é¡¹ç›®</strong>?**</h3><p>â€‹<strong>æ˜¯å¯ä»¥çš„, å¯¹å¤§å‹é¡¹ç›®è¿›è¡Œæ¨¡å—åˆ’åˆ†,å¯¹å„ä¸ªæ¨¡å—è¿›è¡Œå®ç°, æ¨¡å—ä¹‹é—´æ›´å¤šçš„æ˜¯ä»¥APIè°ƒç”¨å®Œæˆ,è€¦åˆåº¦è¾ƒé«˜, ä¸åˆ©äºæ‰©å±•å’Œç»´æŠ¤ã€‚</strong></p><h3 id="2-æ ‡å‡†çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆ-springcloud-å’Œcloud-alibaba-å‡ºç°åŸå› å’Œä»·å€¼æ˜¯ä»€ä¹ˆ"><a href="#2-æ ‡å‡†çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆ-springcloud-å’Œcloud-alibaba-å‡ºç°åŸå› å’Œä»·å€¼æ˜¯ä»€ä¹ˆ" class="headerlink" title="2.æ ‡å‡†çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆ(springcloud å’Œcloud alibaba)å‡ºç°åŸå› å’Œä»·å€¼æ˜¯ä»€ä¹ˆ?"></a>2.æ ‡å‡†çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆ(springcloud å’Œcloud alibaba)å‡ºç°åŸå› å’Œä»·å€¼æ˜¯ä»€ä¹ˆ?</h3><p>â€‹<strong>(1)</strong> **å¾®æœåŠ¡å¯ä»¥æ ¹æ®ä¸šåŠ¡ä¸åŒï¼Œå°†ä¸€ä¸ªå¤§é¡¹ç›® , åˆ†è§£æˆä¸åŒçš„æœåŠ¡(å¾®æœåŠ¡ï¼Œæ¯”å¦‚æœ ç´¢æœåŠ¡&#x2F;ç½‘å…³æœåŠ¡&#x2F;é…ç½®æœåŠ¡&#x2F;å­˜å‚¨æœåŠ¡&#x2F;å‘ç°æœåŠ¡ç­‰ç­‰) **</p><p>â€‹<strong>(2)å„ä¸ªæœåŠ¡é€šè¿‡åˆ†å¸ƒå¼æ–¹å¼è¿›è¡Œå·¥ ä½œï¼Œä»è€Œå¯ä»¥é«˜æ•ˆï¼Œå¿«é€Ÿï¼Œç¨³å®šçš„å®Œæˆå¤æ‚çš„åŠŸèƒ½</strong></p><p>â€‹<strong>(3) å¦‚æœå°ä¼™ä¼´è¿˜ä¸ç†è§£, ä½ ä¹Ÿå¯ä»¥ç†è§£æˆå°± å°†åŸæ¥å¤§é¡¹ç›®çš„æŸäº›æ¨¡å—-&gt;æŠ½å‡ºå½¢æˆå¾®æœåŠ¡-&gt;é…åˆåˆ†å¸ƒå¼å·¥ä½œæ–¹å¼-&gt;ä»è€Œé«˜æ•ˆï¼Œå¿«é€Ÿï¼Œç¨³å®šçš„å®Œæˆå¤æ‚ä¸šåŠ¡åŠŸèƒ½ã€‚</strong></p><h3 id="3-ä¸€å›¾èƒœåƒè¨€"><a href="#3-ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="3. ä¸€å›¾èƒœåƒè¨€"></a>3. ä¸€å›¾èƒœåƒè¨€</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519160836110.png" alt="image-20230519160836110"></p><h2 id="1-3-ç³»ç»Ÿæ¶æ„çš„æ¼”å˜è¿‡ç¨‹"><a href="#1-3-ç³»ç»Ÿæ¶æ„çš„æ¼”å˜è¿‡ç¨‹" class="headerlink" title="1.3 ç³»ç»Ÿæ¶æ„çš„æ¼”å˜è¿‡ç¨‹"></a>1.3 ç³»ç»Ÿæ¶æ„çš„æ¼”å˜è¿‡ç¨‹</h2><h3 id="1-3-1å•ä½“æ¶æ„ï¼š"><a href="#1-3-1å•ä½“æ¶æ„ï¼š" class="headerlink" title="1.3.1å•ä½“æ¶æ„ï¼š"></a>1.3.1å•ä½“æ¶æ„ï¼š</h3><p>â€‹<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519161225897.png" alt="image-20230519161225897"></p><p>ä»…é€‚åˆå°‘é‡ç”¨æˆ·çš„æƒ…å†µ</p><p>å¦‚æœç”¨æˆ·é‡å¤§ï¼Œserveræ— æ³•å“åº”å¤§é‡è¯·æ±‚ï¼›å¤§é‡æ“ä½œæ•°æ®åº“çš„è¯­å¥å†²å®DB</p><h3 id="1-3-2åŠ¨é™åˆ†ç¦»æ¶æ„ï¼š"><a href="#1-3-2åŠ¨é™åˆ†ç¦»æ¶æ„ï¼š" class="headerlink" title="1.3.2åŠ¨é™åˆ†ç¦»æ¶æ„ï¼š"></a>1.3.2åŠ¨é™åˆ†ç¦»æ¶æ„ï¼š</h3><p>â€‹<u>é™æ€ç¼“å­˜+æ–‡ä»¶å­˜å‚¨</u></p><p>åŠ¨é™åˆ†ç¦»ï¼š</p><p>1.å¯¹é™æ€èµ„æºã€åŠ¨æ€èµ„æºçš„è¯·æ±‚è¿›è¡Œåˆ†ç¦»è¿‡æ»¤ï¼Œå¯¹äºé™æ€èµ„æºçš„è¯·æ±‚ï¼Œç›´æ¥æ‰¾èµ„æºæœåŠ¡å™¨å“åº”ï¼›å¯¹äºåŠ¨æ€æœåŠ¡å™¨çš„è¯·æ±‚æ‰æ‰¾åˆ°åº”ç”¨æœåŠ¡å™¨è¿›è¡Œå“åº”ã€‚</p><p>2.å¯¹è¯·æ±‚çš„æ•°æ®è¿›è¡Œç¼“å­˜ï¼Œä½¿ç”¨redisç­‰ï¼Œé™ä½æ•°æ®åº“ç­‰è´Ÿè·ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519162426761.png" alt="image-20230519162426761"></p><h3 id="1-3-3åˆ†å¸ƒå¼æ¶æ„ï¼š"><a href="#1-3-3åˆ†å¸ƒå¼æ¶æ„ï¼š" class="headerlink" title="1.3.3åˆ†å¸ƒå¼æ¶æ„ï¼š"></a>1.3.3åˆ†å¸ƒå¼æ¶æ„ï¼š</h3><p>â€‹<u>ä¸šåŠ¡æ‹†åˆ†+è´Ÿè½½å‡è¡¡</u></p><p>â€‹<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519163644982.png" alt="image-20230519163644982"></p><h3 id="1-3-4å¾®æœåŠ¡æ¶æ„ï¼š"><a href="#1-3-4å¾®æœåŠ¡æ¶æ„ï¼š" class="headerlink" title="1.3.4å¾®æœåŠ¡æ¶æ„ï¼š"></a>1.3.4å¾®æœåŠ¡æ¶æ„ï¼š</h3><p>â€‹<u>ä½¿ç”¨Spring Cloud</u></p><p><img src="https://mp.processon.com/chart_image/id/5c77d08ae4b0628e8208c507.png" alt="ç‚¹å‡»æŸ¥çœ‹å›¾ç‰‡æ¥æº"></p><ul><li><p><strong>â€œå¾®æœåŠ¡â€ ä¸€è¯æºäº Martin Fowler çš„åä¸ºMicroservices çš„åšæ–‡ï¼Œç®€å•åœ°è¯´ï¼Œ å¾®æœ åŠ¡æ˜¯ç³»ç»Ÿæ¶æ„ä¸Šçš„ä¸€ç§è®¾è®¡é£æ ¼ï¼Œå®ƒçš„ä¸»æ—¨æ˜¯<u>å°†ä¸€ä¸ªåŸæœ¬ç‹¬ç«‹çš„ç³»ç»Ÿæ‹†åˆ†æˆå¤šä¸ªå°å‹æœåŠ¡ï¼Œè¿™äº›å°å‹æœåŠ¡éƒ½åœ¨å„è‡ªç‹¬ç«‹çš„è¿›ç¨‹ä¸­è¿è¡Œ</u>ï¼ŒæœåŠ¡ä¹‹é—´é€šè¿‡åŸºäºHTTP çš„ RESTful API è¿›è¡Œé€šä¿¡åä½œã€‚</strong></p></li><li><p><strong>è¢«æ‹†åˆ†æˆçš„æ¯ä¸€ä¸ªå°å‹æœåŠ¡éƒ½å›½ç»•ç€ç³»ç»Ÿä¸­çš„æŸä¸€é¡¹æˆ–ä¸€äº›è€¦åˆåº¦è¾ƒé«˜çš„ä¸šåŠ¡åŠŸèƒ½è¿›è¡Œæ„å»ºï¼Œ å¹¶ä¸”æ¯ä¸ªæœåŠ¡éƒ½ç»´æŠ¤ç€è‡ªèº«çš„æ•°æ®å­˜å‚¨ã€ä¸šåŠ¡å¼€å‘ã€è‡ªåŠ¨åŒ–æµ‹è¯•æ¡ˆä¾‹ä»¥åŠç‹¬ç«‹éƒ¨ç½²æœºåˆ¶ã€‚ ç”±äºæœ‰è½»é‡çº§çš„é€šä¿¡åä½œåŸºç¡€ï¼Œæ‰€ä»¥è¿™äº›å¾®æœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€æ¥ç¼–å†™ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ javaã€‚</strong></p></li></ul><h2 id="1-4-Spring-Coludå…¨é¢è¯´æ˜"><a href="#1-4-Spring-Coludå…¨é¢è¯´æ˜" class="headerlink" title="1.4 Spring Coludå…¨é¢è¯´æ˜"></a>1.4 Spring Coludå…¨é¢è¯´æ˜</h2><h4 id="1-Springcloud-æ¥æºäº-Springï¼Œæ˜¯æ›´é«˜å±‚æ¬¡çš„ã€-æ¶æ„è§†è§’çš„ç»¼åˆæ€§å¤§å‹é¡¹ç›®ï¼Œ-ç›®æ ‡æ—¨åœ¨æ„å»ºä¸€å¥—æ ‡å‡†åŒ–çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œè®©æ¶æ„å¸ˆåœ¨ä½¿ç”¨å¾®æœåŠ¡ç†å¿µæ„å»ºç³»ç»Ÿçš„æ—¶ï¼Œ-é¢å¯¹å„ç¯èŠ‚çš„é—®é¢˜éƒ½å¯ä»¥æ‰¾åˆ°ç›¸åº”çš„ç»„ä»¶æ¥å¤„ç†"><a href="#1-Springcloud-æ¥æºäº-Springï¼Œæ˜¯æ›´é«˜å±‚æ¬¡çš„ã€-æ¶æ„è§†è§’çš„ç»¼åˆæ€§å¤§å‹é¡¹ç›®ï¼Œ-ç›®æ ‡æ—¨åœ¨æ„å»ºä¸€å¥—æ ‡å‡†åŒ–çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œè®©æ¶æ„å¸ˆåœ¨ä½¿ç”¨å¾®æœåŠ¡ç†å¿µæ„å»ºç³»ç»Ÿçš„æ—¶ï¼Œ-é¢å¯¹å„ç¯èŠ‚çš„é—®é¢˜éƒ½å¯ä»¥æ‰¾åˆ°ç›¸åº”çš„ç»„ä»¶æ¥å¤„ç†" class="headerlink" title="1.Springcloud æ¥æºäº Springï¼Œæ˜¯æ›´é«˜å±‚æ¬¡çš„ã€ æ¶æ„è§†è§’çš„ç»¼åˆæ€§å¤§å‹é¡¹ç›®ï¼Œ ç›®æ ‡æ—¨åœ¨æ„å»ºä¸€å¥—æ ‡å‡†åŒ–çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œè®©æ¶æ„å¸ˆåœ¨ä½¿ç”¨å¾®æœåŠ¡ç†å¿µæ„å»ºç³»ç»Ÿçš„æ—¶ï¼Œ é¢å¯¹å„ç¯èŠ‚çš„é—®é¢˜éƒ½å¯ä»¥æ‰¾åˆ°ç›¸åº”çš„ç»„ä»¶æ¥å¤„ç†"></a>1.Springcloud æ¥æºäº Springï¼Œæ˜¯æ›´é«˜å±‚æ¬¡çš„ã€ æ¶æ„è§†è§’çš„ç»¼åˆæ€§å¤§å‹é¡¹ç›®ï¼Œ ç›®æ ‡æ—¨åœ¨æ„å»ºä¸€å¥—æ ‡å‡†åŒ–çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œè®©æ¶æ„å¸ˆåœ¨ä½¿ç”¨å¾®æœåŠ¡ç†å¿µæ„å»ºç³»ç»Ÿçš„æ—¶ï¼Œ é¢å¯¹å„ç¯èŠ‚çš„é—®é¢˜éƒ½å¯ä»¥æ‰¾åˆ°ç›¸åº”çš„ç»„ä»¶æ¥å¤„ç†</h4><h4 id="2-Spring-Cloud-æ˜¯Spring-ç¤¾åŒºä¸ºå¾®æœåŠ¡æ¶æ„æä¾›çš„ä¸€ä¸ª-â€œå…¨å®¶æ¡¶â€-å¥—é¤ã€‚å¥—é¤ä¸­å„ä¸ªç»„ä»¶ä¹‹é—´çš„é…åˆï¼Œå¯ä»¥å‡å°‘åœ¨ç»„ä»¶çš„é€‰å‹å’Œæ•´åˆä¸ŠèŠ±è´¹çš„ç²¾åŠ›ï¼Œå¯ä»¥å¿«é€Ÿæ„å»ºèµ·åŸºç¡€çš„å¾®æœåŠ¡æ¶æ„ç³»ç»Ÿï¼Œæ˜¯å¾®æœåŠ¡æ¶æ„çš„æœ€ä½³è½åœ°æ–¹æ¡ˆ"><a href="#2-Spring-Cloud-æ˜¯Spring-ç¤¾åŒºä¸ºå¾®æœåŠ¡æ¶æ„æä¾›çš„ä¸€ä¸ª-â€œå…¨å®¶æ¡¶â€-å¥—é¤ã€‚å¥—é¤ä¸­å„ä¸ªç»„ä»¶ä¹‹é—´çš„é…åˆï¼Œå¯ä»¥å‡å°‘åœ¨ç»„ä»¶çš„é€‰å‹å’Œæ•´åˆä¸ŠèŠ±è´¹çš„ç²¾åŠ›ï¼Œå¯ä»¥å¿«é€Ÿæ„å»ºèµ·åŸºç¡€çš„å¾®æœåŠ¡æ¶æ„ç³»ç»Ÿï¼Œæ˜¯å¾®æœåŠ¡æ¶æ„çš„æœ€ä½³è½åœ°æ–¹æ¡ˆ" class="headerlink" title="2.Spring Cloud æ˜¯Spring ç¤¾åŒºä¸ºå¾®æœåŠ¡æ¶æ„æä¾›çš„ä¸€ä¸ª â€œå…¨å®¶æ¡¶â€ å¥—é¤ã€‚å¥—é¤ä¸­å„ä¸ªç»„ä»¶ä¹‹é—´çš„é…åˆï¼Œå¯ä»¥å‡å°‘åœ¨ç»„ä»¶çš„é€‰å‹å’Œæ•´åˆä¸ŠèŠ±è´¹çš„ç²¾åŠ›ï¼Œå¯ä»¥å¿«é€Ÿæ„å»ºèµ·åŸºç¡€çš„å¾®æœåŠ¡æ¶æ„ç³»ç»Ÿï¼Œæ˜¯å¾®æœåŠ¡æ¶æ„çš„æœ€ä½³è½åœ°æ–¹æ¡ˆ"></a>2.Spring Cloud æ˜¯Spring ç¤¾åŒºä¸ºå¾®æœåŠ¡æ¶æ„æä¾›çš„ä¸€ä¸ª â€œå…¨å®¶æ¡¶â€ å¥—é¤ã€‚å¥—é¤ä¸­å„ä¸ªç»„ä»¶ä¹‹é—´çš„é…åˆï¼Œå¯ä»¥å‡å°‘åœ¨ç»„ä»¶çš„é€‰å‹å’Œæ•´åˆä¸ŠèŠ±è´¹çš„ç²¾åŠ›ï¼Œå¯ä»¥å¿«é€Ÿæ„å»ºèµ·åŸºç¡€çš„å¾®æœåŠ¡æ¶æ„ç³»ç»Ÿï¼Œæ˜¯å¾®æœåŠ¡æ¶æ„çš„æœ€ä½³è½åœ°æ–¹æ¡ˆ</h4><h4 id="3-Spirng-Cloud-å¤©ç„¶æ”¯æŒ-spring-Boot-æœ‰ç‰ˆæœ¬å¯¹åº”è¦æ±‚-ï¼Œä½¿ç”¨é—¨æ§›è¾ƒä½"><a href="#3-Spirng-Cloud-å¤©ç„¶æ”¯æŒ-spring-Boot-æœ‰ç‰ˆæœ¬å¯¹åº”è¦æ±‚-ï¼Œä½¿ç”¨é—¨æ§›è¾ƒä½" class="headerlink" title="3.Spirng Cloud å¤©ç„¶æ”¯æŒ spring Boot(æœ‰ç‰ˆæœ¬å¯¹åº”è¦æ±‚)ï¼Œä½¿ç”¨é—¨æ§›è¾ƒä½"></a>3.Spirng Cloud å¤©ç„¶æ”¯æŒ spring Boot(æœ‰ç‰ˆæœ¬å¯¹åº”è¦æ±‚)ï¼Œä½¿ç”¨é—¨æ§›è¾ƒä½</h4><h4 id="4-è§£å†³ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¤æ‚æ€§-ä¸€ç½‘ç»œé—®é¢˜ï¼Œå»¶è¿Ÿå¼€é”€ï¼Œå¸¦å®½å‘é¢˜ï¼Œå®‰å…¨é—®é¢˜"><a href="#4-è§£å†³ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¤æ‚æ€§-ä¸€ç½‘ç»œé—®é¢˜ï¼Œå»¶è¿Ÿå¼€é”€ï¼Œå¸¦å®½å‘é¢˜ï¼Œå®‰å…¨é—®é¢˜" class="headerlink" title="4.è§£å†³ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¤æ‚æ€§ ä¸€ç½‘ç»œé—®é¢˜ï¼Œå»¶è¿Ÿå¼€é”€ï¼Œå¸¦å®½å‘é¢˜ï¼Œå®‰å…¨é—®é¢˜"></a>4.è§£å†³ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¤æ‚æ€§ ä¸€ç½‘ç»œé—®é¢˜ï¼Œå»¶è¿Ÿå¼€é”€ï¼Œå¸¦å®½å‘é¢˜ï¼Œå®‰å…¨é—®é¢˜</h4><h4 id="5-å¤„ç†æœåŠ¡å‘ç°çš„èƒ½åŠ›-ä¸€-æœåŠ¡å‘ç°å…è®¸é›†ç¾¤ä¸­çš„è¿›ç¨‹å’ŒæœåŠ¡æ‰¾åˆ°å½¼æ­¤å¹¶è¿›è¡Œé€šä¿¡"><a href="#5-å¤„ç†æœåŠ¡å‘ç°çš„èƒ½åŠ›-ä¸€-æœåŠ¡å‘ç°å…è®¸é›†ç¾¤ä¸­çš„è¿›ç¨‹å’ŒæœåŠ¡æ‰¾åˆ°å½¼æ­¤å¹¶è¿›è¡Œé€šä¿¡" class="headerlink" title="5.å¤„ç†æœåŠ¡å‘ç°çš„èƒ½åŠ› ä¸€ æœåŠ¡å‘ç°å…è®¸é›†ç¾¤ä¸­çš„è¿›ç¨‹å’ŒæœåŠ¡æ‰¾åˆ°å½¼æ­¤å¹¶è¿›è¡Œé€šä¿¡"></a>5.å¤„ç†æœåŠ¡å‘ç°çš„èƒ½åŠ› ä¸€ æœåŠ¡å‘ç°å…è®¸é›†ç¾¤ä¸­çš„è¿›ç¨‹å’ŒæœåŠ¡æ‰¾åˆ°å½¼æ­¤å¹¶è¿›è¡Œé€šä¿¡</h4><h4 id="6-è§£æ±ºå†—ä½™é—®é¢˜-ä¸€-å…ƒä½™é—®é¢˜ç»å¸¸å‘ç”Ÿåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­"><a href="#6-è§£æ±ºå†—ä½™é—®é¢˜-ä¸€-å…ƒä½™é—®é¢˜ç»å¸¸å‘ç”Ÿåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­" class="headerlink" title="6.è§£æ±ºå†—ä½™é—®é¢˜ ä¸€ å…ƒä½™é—®é¢˜ç»å¸¸å‘ç”Ÿåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­"></a>6.è§£æ±ºå†—ä½™é—®é¢˜ ä¸€ å…ƒä½™é—®é¢˜ç»å¸¸å‘ç”Ÿåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­</h4><h4 id="7-è§£å†³è´Ÿè½½å‡è¡¡-ä¸€-æ”¹è¿›è·¨å¤šä¸ªè®¡ç®—èµ„æºï¼ˆä¾‹å¦‚è®¡ç®—æœºé›†ç¾¤ï¼Œç½‘ç»œé“¾æ¥ï¼Œä¸­å¤®å¤„ç†å•å…ƒï¼‰çš„å·¥ä½œè´Ÿè½½åˆ†å¸ƒ"><a href="#7-è§£å†³è´Ÿè½½å‡è¡¡-ä¸€-æ”¹è¿›è·¨å¤šä¸ªè®¡ç®—èµ„æºï¼ˆä¾‹å¦‚è®¡ç®—æœºé›†ç¾¤ï¼Œç½‘ç»œé“¾æ¥ï¼Œä¸­å¤®å¤„ç†å•å…ƒï¼‰çš„å·¥ä½œè´Ÿè½½åˆ†å¸ƒ" class="headerlink" title="7.è§£å†³è´Ÿè½½å‡è¡¡ ä¸€ æ”¹è¿›è·¨å¤šä¸ªè®¡ç®—èµ„æºï¼ˆä¾‹å¦‚è®¡ç®—æœºé›†ç¾¤ï¼Œç½‘ç»œé“¾æ¥ï¼Œä¸­å¤®å¤„ç†å•å…ƒï¼‰çš„å·¥ä½œè´Ÿè½½åˆ†å¸ƒ"></a>7.è§£å†³è´Ÿè½½å‡è¡¡ ä¸€ æ”¹è¿›è·¨å¤šä¸ªè®¡ç®—èµ„æºï¼ˆä¾‹å¦‚è®¡ç®—æœºé›†ç¾¤ï¼Œç½‘ç»œé“¾æ¥ï¼Œä¸­å¤®å¤„ç†å•å…ƒï¼‰çš„å·¥ä½œè´Ÿè½½åˆ†å¸ƒ</h4><h2 id="1-5-Spring-Cloud-æ ¸å¿ƒç»„ä»¶å›¾"><a href="#1-5-Spring-Cloud-æ ¸å¿ƒç»„ä»¶å›¾" class="headerlink" title="1.5 Spring Cloud æ ¸å¿ƒç»„ä»¶å›¾"></a>1.5 Spring Cloud æ ¸å¿ƒç»„ä»¶å›¾</h2><h3 id="1-5-1-æ–‡æ¡£-https-spring-io-projects-spring-cloud"><a href="#1-5-1-æ–‡æ¡£-https-spring-io-projects-spring-cloud" class="headerlink" title="1.5.1 æ–‡æ¡£ : https://spring.io/projects/spring-cloud"></a><strong>1.5.1</strong> æ–‡æ¡£ <strong>: <a href="https://spring.io/projects/spring-cloud">https://spring.io/projects/spring-cloud</a></strong></h3><h3 id="1-5-2ä¸€å›¾èƒœåƒè¨€"><a href="#1-5-2ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="1.5.2ä¸€å›¾èƒœåƒè¨€"></a>1.5.2ä¸€å›¾èƒœåƒè¨€</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519184405128.png" alt="image-20230519184405128"></p><h2 id="1-6-Spring-Cloud-åˆ†å¸ƒå¼ç¤ºæ„å›¾"><a href="#1-6-Spring-Cloud-åˆ†å¸ƒå¼ç¤ºæ„å›¾" class="headerlink" title="1.6 Spring Cloud åˆ†å¸ƒå¼ç¤ºæ„å›¾"></a>1.6 Spring Cloud åˆ†å¸ƒå¼ç¤ºæ„å›¾</h2><h3 id="1-6-1-æ–‡æ¡£-https-spring-io-microservices"><a href="#1-6-1-æ–‡æ¡£-https-spring-io-microservices" class="headerlink" title="1.6.1 æ–‡æ¡£ : https://spring.io/microservices"></a><strong>1.6.1</strong> æ–‡æ¡£ <strong>: <a href="https://spring.io/microservices">https://spring.io/microservices</a></strong></h3><h3 id="1-6-2-ä¸€å›¾èƒœåƒè¨€"><a href="#1-6-2-ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="1.6.2 ä¸€å›¾èƒœåƒè¨€"></a><strong>1.6.2</strong> ä¸€å›¾èƒœåƒè¨€</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519185237018.png" alt="image-20230519185237018"></p><ol><li><p>Spring cloud æ˜¯å¾®æœåŠ¡çš„è½åœ°</p></li><li><p>Spring cloud ä½“ç°äº†å¾®æœåŠ¡çš„å¼¹æ€§è®¾è®¡</p></li><li><p>å¾®æœåŠ¡çš„å·¥ä½œæ–¹å¼ä¸€èˆ¬æ˜¯åŸºäºåˆ†å¸ƒå¼çš„ã€‚</p></li><li><p>Spring Cloud ä»ç„¶æ˜¯ Spring å®¶æ—ä¸€å‘˜ï¼Œå¯ä»¥è§£å†³å¾®æœåŠ¡çš„åˆ†å¸ƒå¼å·¥ä½œæ–¹å¼å¸¦æ¥çš„å„ç§é—®é¢˜</p></li><li><p>Spring Cloud æä¾›å¾ˆå¤šç»„ä»¶ï¼Œæ¯”å¦‚ æœåŠ¡å‘ç°ï¼Œè´Ÿè½½å‡è¡—ï¼Œé“¾è·¯ä¸­æ–­ï¼Œåˆ†å¸ƒå¼è¿½è¸ªå’Œç›‘æ§ï¼Œç”šè‡³æä¾› API gateway åŠŸèƒ½.</p></li></ol><h3 id="1-6-3-SpringCloudå’ŒSpringBootç‰ˆæœ¬å¯¹åº”å…³ç³»"><a href="#1-6-3-SpringCloudå’ŒSpringBootç‰ˆæœ¬å¯¹åº”å…³ç³»" class="headerlink" title="1.6.3 SpringCloudå’ŒSpringBootç‰ˆæœ¬å¯¹åº”å…³ç³»"></a><strong>1.6.3 SpringCloud</strong>å’Œ<strong>SpringBoot</strong>ç‰ˆæœ¬å¯¹åº”å…³ç³»</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519190708371.png" alt="image-20230519190708371"></p><h2 id="1-7-Spring-Cloud-ç»„ä»¶é€‰å‹"><a href="#1-7-Spring-Cloud-ç»„ä»¶é€‰å‹" class="headerlink" title="1.7 Spring Cloud ç»„ä»¶é€‰å‹"></a>1.7 Spring Cloud ç»„ä»¶é€‰å‹</h2><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519190901580.png" alt="image-20230519190901580"></p><h1 id="2-Spring-Cloud-Alibaba-åŸºæœ¬ä»‹ç»"><a href="#2-Spring-Cloud-Alibaba-åŸºæœ¬ä»‹ç»" class="headerlink" title="2 Spring Cloud Alibaba åŸºæœ¬ä»‹ç»"></a><strong>2 Spring Cloud Alibaba</strong> åŸºæœ¬ä»‹ç»</h1><h2 id="2-1-å®˜æ–¹æ–‡æ¡£"><a href="#2-1-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="2.1 å®˜æ–¹æ–‡æ¡£"></a>2.1 å®˜æ–¹æ–‡æ¡£</h2><h3 id="2-1-1-è‹±æ–‡åœ°å€-https-github-com-alibaba-spring-cloud-alibaba"><a href="#2-1-1-è‹±æ–‡åœ°å€-https-github-com-alibaba-spring-cloud-alibaba" class="headerlink" title="2.1.1 è‹±æ–‡åœ°å€**: https://github.com/alibaba/spring-cloud-alibaba**"></a><strong>2.1.1</strong> è‹±æ–‡åœ°å€**: <a href="https://github.com/alibaba/spring-cloud-alibaba">https://github.com/alibaba/spring-cloud-alibaba</a>**</h3><h3 id="2-1-2è‹±-æ–‡-åœ°-å€-ä¸­-æ–‡-æ–‡-æ¡£-https-github-com-alibaba-spring-cloud-alibaba-blob-master-README-zh-md"><a href="#2-1-2è‹±-æ–‡-åœ°-å€-ä¸­-æ–‡-æ–‡-æ¡£-https-github-com-alibaba-spring-cloud-alibaba-blob-master-README-zh-md" class="headerlink" title="2.1.2è‹± æ–‡ åœ° å€ : ä¸­ æ–‡ æ–‡ æ¡£ : https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md"></a><strong>2.1.2</strong>è‹± æ–‡ åœ° å€ <strong>:</strong> ä¸­ æ–‡ æ–‡ æ¡£ <strong>: <a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></strong></h3><h2 id="2-2-SpringCloudAlibabaæ˜¯ä»€ä¹ˆ"><a href="#2-2-SpringCloudAlibabaæ˜¯ä»€ä¹ˆ" class="headerlink" title="2.2 SpringCloudAlibabaæ˜¯ä»€ä¹ˆ"></a>2.2 SpringCloudAlibabaæ˜¯ä»€ä¹ˆ</h2><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519192136898.png" alt="image-20230519192136898"></p><h2 id="2-3-ä¸»è¦åŠŸèƒ½ä¸€è§ˆ"><a href="#2-3-ä¸»è¦åŠŸèƒ½ä¸€è§ˆ" class="headerlink" title="2.3 ä¸»è¦åŠŸèƒ½ä¸€è§ˆ"></a>2.3 ä¸»è¦åŠŸèƒ½ä¸€è§ˆ</h2><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519192150299.png" alt="image-20230519192150299"></p><h2 id="2-4-Spring-Cloud-Alibaba-æ ¸å¿ƒç»„ä»¶"><a href="#2-4-Spring-Cloud-Alibaba-æ ¸å¿ƒç»„ä»¶" class="headerlink" title="2.4 Spring Cloud Alibaba æ ¸å¿ƒç»„ä»¶"></a>2.4 Spring Cloud Alibaba æ ¸å¿ƒç»„ä»¶</h2><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519192202912.png" alt="image-20230519192202912"></p><h2 id="2-5-åˆ†å¸ƒå¼å¾®æœåŠ¡æŠ€æœ¯é€‰å‹"><a href="#2-5-åˆ†å¸ƒå¼å¾®æœåŠ¡æŠ€æœ¯é€‰å‹" class="headerlink" title="2.5: åˆ†å¸ƒå¼å¾®æœåŠ¡æŠ€æœ¯é€‰å‹"></a>2.5: åˆ†å¸ƒå¼å¾®æœåŠ¡æŠ€æœ¯é€‰å‹</h2><h3 id="â€¢Spring-Cloud-åŸç”Ÿç»„ä»¶çš„å‡ å¤§ç—›ç‚¹"><a href="#â€¢Spring-Cloud-åŸç”Ÿç»„ä»¶çš„å‡ å¤§ç—›ç‚¹" class="headerlink" title="â€¢Spring Cloud åŸç”Ÿç»„ä»¶çš„å‡ å¤§ç—›ç‚¹"></a>â€¢Spring Cloud åŸç”Ÿç»„ä»¶çš„å‡ å¤§ç—›ç‚¹</h3><p>1.Spring Cloud éƒ¨åˆ†ç»„ä»¶åœæ­¢ç»´æŠ¤å’Œæ›´æ–°ï¼Œç»™å¼€å‘å¸¦æ¥ä¸ä¾¿</p><p>2.Spring cioud éƒ¨åˆ†ç¯å¢ƒæ­å»ºå¤æ‚ï¼Œæ²¡æœ‰å®Œå–„çš„å¯è§†åŒ–ç•Œé¢ï¼Œæˆ‘ä»¬éœ€è¦å¤§é‡çš„äºŒæ¬¡å¼€å‘å’Œå®šåˆ¶</p><p>3.Spring Cloud é…ç½®å¤æ‚ï¼Œéš¾ä»¥ä¸Šæ‰‹</p><h3 id="â€¢Spring-Cloud-Alibaba-çš„ä¼˜åŠ¿"><a href="#â€¢Spring-Cloud-Alibaba-çš„ä¼˜åŠ¿" class="headerlink" title="â€¢Spring Cloud Alibaba çš„ä¼˜åŠ¿"></a>â€¢Spring Cloud Alibaba çš„ä¼˜åŠ¿</h3><ol><li>é˜¿é‡Œä½¿ç”¨è¿‡çš„ç»„ä»¶ç»å†äº†è€ƒéªŒï¼ˆé«˜å¹¶å‘ï¼Œé«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨ï¼Œæ€§èƒ½å¼ºæ‚ï¼Œè®¾è®¡åˆç†ï¼Œç°åœ¨å¼€æº</li></ol><p>å‡ºæ¥ä¾›å¤§å®¶ä½¿ç”¨ã€‚</p><ol start="2"><li>æ­é…å®Œå–„çš„å¯è§†åŒ–ç•Œé¢ï¼Œç»™å¼€å‘è¿ç»´å¸¦æ¥æå¤§çš„ä¾¿åˆ©æ­å»ºç®€å•ï¼Œå­¦ä¹ æ›²çº¿ä½ã€‚</li></ol><ul><li><h3 id="åˆ†å¸ƒå¼å¾®æœåŠ¡æŠ€æœ¯é€‰å‹å»ºè®®"><a href="#åˆ†å¸ƒå¼å¾®æœåŠ¡æŠ€æœ¯é€‰å‹å»ºè®®" class="headerlink" title="åˆ†å¸ƒå¼å¾®æœåŠ¡æŠ€æœ¯é€‰å‹å»ºè®®"></a><strong>åˆ†å¸ƒå¼å¾®æœåŠ¡æŠ€æœ¯é€‰å‹å»ºè®®</strong></h3></li></ul><p>ä»¥Spring Cloud Alibabaä¸ºä¸»ï¼Œä»¥Spring Cloud åŸç”Ÿç»„ä»¶ä¸ºè¾…ã€‚</p><h1 id="3-å¾®æœåŠ¡åŸºç¡€ç¯å¢ƒæ­å»º"><a href="#3-å¾®æœåŠ¡åŸºç¡€ç¯å¢ƒæ­å»º" class="headerlink" title="3 å¾®æœåŠ¡åŸºç¡€ç¯å¢ƒæ­å»º"></a>3 å¾®æœåŠ¡åŸºç¡€ç¯å¢ƒæ­å»º</h1><h2 id="3-1-åˆ›å»ºçˆ¶å·¥ç¨‹-ï¼Œç”¨äºèšåˆå…¶å®ƒå¾®æœåŠ¡æ¨¡å—"><a href="#3-1-åˆ›å»ºçˆ¶å·¥ç¨‹-ï¼Œç”¨äºèšåˆå…¶å®ƒå¾®æœåŠ¡æ¨¡å—" class="headerlink" title="3.1 åˆ›å»ºçˆ¶å·¥ç¨‹ ï¼Œç”¨äºèšåˆå…¶å®ƒå¾®æœåŠ¡æ¨¡å—"></a>3.1 åˆ›å»ºçˆ¶å·¥ç¨‹ ï¼Œç”¨äºèšåˆå…¶å®ƒå¾®æœåŠ¡æ¨¡å—</h2><h3 id="3-1-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£"><a href="#3-1-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£" class="headerlink" title="3.1.1 éœ€æ±‚è¯´æ˜**&#x2F;**å›¾è§£"></a><strong>3.1.1</strong> éœ€æ±‚è¯´æ˜**&#x2F;**å›¾è§£</h3><h3 id="3-1-2-å®ç°æ­¥éª¤"><a href="#3-1-2-å®ç°æ­¥éª¤" class="headerlink" title="3.1.2 å®ç°æ­¥éª¤"></a><strong>3.1.2</strong> å®ç°æ­¥éª¤</h3><h4 id="3-1-2-1-åˆ›å»ºçˆ¶é¡¹ç›®-ä½œä¸ºèšåˆå…¶å®ƒå¾®æœåŠ¡æ¨¡å—"><a href="#3-1-2-1-åˆ›å»ºçˆ¶é¡¹ç›®-ä½œä¸ºèšåˆå…¶å®ƒå¾®æœåŠ¡æ¨¡å—" class="headerlink" title="3.1.2.1 åˆ›å»ºçˆ¶é¡¹ç›®, ä½œä¸ºèšåˆå…¶å®ƒå¾®æœåŠ¡æ¨¡å—"></a>3.1.2.1 åˆ›å»ºçˆ¶é¡¹ç›®, ä½œä¸ºèšåˆå…¶å®ƒå¾®æœåŠ¡æ¨¡å—</h4><p>###æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªçˆ¶é¡¹ç›®**,** è¯¥çˆ¶é¡¹ç›®ä¼šå»ç®¡ç†å¤šä¸ªå¾®æœåŠ¡æ¨¡å—(module)</p><p>Mavenåˆ›å»ºé¡¹ç›® ä½¿ç”¨webapp Mavenå·¥ä»¶</p><h4 id="3-1-2-2-é¡¹ç›®è®¾ç½®"><a href="#3-1-2-2-é¡¹ç›®è®¾ç½®" class="headerlink" title="3.1.2.2 é¡¹ç›®è®¾ç½®"></a>3.1.2.2 é¡¹ç›®è®¾ç½®</h4><ol><li></li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519194056058.png" alt="image-20230519194056058"></p><ol start="2"><li></li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519194231324.png" alt="image-20230519194231324"></p><p>3.çˆ¶é¡¹ç›®æœ¬èº«ä¸å†™ä»£ç ï¼Œæ˜¯ç”¨æ¥è¿›è¡Œç®¡ç†çš„</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519194329079.png" alt="image-20230519194329079"></p><h4 id="3-1-2-4-é…ç½®çˆ¶å·¥ç¨‹-pom-xml-ä½œä¸ºèšåˆå…¶å®ƒæ¨¡å—"><a href="#3-1-2-4-é…ç½®çˆ¶å·¥ç¨‹-pom-xml-ä½œä¸ºèšåˆå…¶å®ƒæ¨¡å—" class="headerlink" title="3.1.2.4 é…ç½®çˆ¶å·¥ç¨‹ pom.xml, ä½œä¸ºèšåˆå…¶å®ƒæ¨¡å—"></a>3.1.2.4 é…ç½®çˆ¶å·¥ç¨‹ pom.xml, ä½œä¸ºèšåˆå…¶å®ƒæ¨¡å—</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.study.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e-commerce-center<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  è¡¨æ˜æ˜¯ä¸€ä¸ªçˆ¶å·¥ç¨‹ï¼Œç”¨äºèšåˆç®¡ç†å…¶ä»–æ¨¡å—--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>e-commerce-center Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      è€å¸ˆè¯´æ˜: ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ log4j , é˜²æ­¢å®‰å…¨æ¼æ´</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>2.17.2<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.31<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis.spring.boot.version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">mybatis.spring.boot.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  1. dependencyManagement ä½œç”¨: å­æ¨¡å—ç»§æ‰¿å, é”å®šç‰ˆæœ¬,</span></span><br><span class="line"><span class="comment">  å­æ¨¡å—ä¸ç”¨å†å†™ version --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      è€å¸ˆè§£è¯»:</span></span><br><span class="line"><span class="comment">      1. type: pom å’Œ scope import é…åˆä½¿ç”¨</span></span><br><span class="line"><span class="comment">      2. è¡¨ç¤º çˆ¶é¡¹ç›®çš„å­æ¨¡å—, åœ¨å¼•å…¥ springboot ç›¸å…³ä¾èµ–æ—¶ é”å®šç‰ˆæœ¬ä¸º</span></span><br><span class="line"><span class="comment">      3. é€šè¿‡ pom + import è§£å†³ maven å•ç»§æ‰¿æœºåˆ¶</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.SR1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-1-3-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#3-1-3-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="3.1.3 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a><strong>3.1.3</strong> æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><h4 id="3-1-3-1-Mavençš„dependencyManagementè¯´æ˜"><a href="#3-1-3-1-Mavençš„dependencyManagementè¯´æ˜" class="headerlink" title="3.1.3.1 Mavençš„dependencyManagementè¯´æ˜"></a>3.1.3.1 Mavençš„dependencyManagementè¯´æ˜</h4><p>1ã€Maven ä½¿ç”¨ dependencyManagement å…ƒç´ æ¥æä¾›äº†ä¸€ç§ç®¡ç†ä¾èµ–ç‰ˆæœ¬å·çš„æ–¹å¼ã€‚é€šå¸¸åœ¨é¡¹ç›®</p><p>packaging ä¸º POMï¼Œä¸­ä½¿ç”¨dependencvManadement å…ƒç´ ã€‚</p><p>2ã€ä½¿ç”¨pom.xml ä¸­çš„dependencyManagement å…ƒç´ èƒ½è®©æ‰€æœ‰åœ¨å­é¡¹ç›®ä¸­å¼•ç”¨ä¸€ä¸ªä¾èµ–ï¼Œ Maven ä¼šæ²¿ç€çˆ¶å­å±‚æ¬¡å‘ä¸Šèµ°ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ‹¥æœ‰dependencyManagement å…ƒç´ çš„é¡¹ç›®ï¼Œç„¶åå®ƒå°±ä¼šä½¿ç”¨è¿™ä¸ªdependencyManagement å…ƒç´ ä¸­æŒ‡å®šçš„ç‰ˆæœ¬å·ã€‚</p><p>3ã€å¥½å¤„ï¼šå¦‚æœæœ‰å¤šä¸ªå­é¡¹ç›®éƒ½å·1ç”¨åŒä¸€æ ·ä¾èµ–ï¼Œåˆ™å¯ä»¥é¿å…åœ¨æ¯ä¸ªä½¿ç”¨çš„å­é¡¹ç›®é‡Œéƒ½å£°æ˜ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œå½“å¼€çº§æˆ–åˆ‡æ¢åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬æ—¶ï¼Œåªéœ€è¦åœ¨é¡¶å±‚çˆ¶å®¹å™¨é‡Œæ›´æ–°ï¼Œè€Œä¸éœ€è¦åˆ†åˆ«åœ¨å­é¡¹ç›®çš„ä¿®æ”¹;å¦å¤–å¦‚æœæŸä¸ªå­é¡¹ç›®éœ€è¦å¦å¤–çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œåªéœ€è¦å£°æ˜version å°±å¯ã€‚</p><p>4ã€dependency Management é‡Œåªæ˜¯å£°æ˜ä¾èµ–ï¼Œå¹¶ä¸å®ç°å¼•å…¥ï¼Œå› æ­¤å­é¡¹ç›®éœ€è¦æ˜¾ç¤ºçš„å£°æ˜éœ€è¦ç”¨çš„ä¾èµ–ã€‚</p><p>5ã€å¦‚æœä¸åœ¨å­é¡¹ç›®ä¸­å£°æ˜ä¾èµ–ï¼Œæ˜¯ä¸ä¼šä»çˆ¶é¡¹ç›®ä¸­ç»§æ‰¿ä¸‹æ¥çš„ï¼›åªæœ‰åœ¨å­é¡¹ç›®ä¸­å†™äº†è¯¥ä¾èµ–é¡¹ï¼Œå¹¶ä¸”æ²¡æœ‰æŒ‡å®šå…·ä½“ç‰ˆæœ¬ï¼Œæ‰ä¼šä»çˆ¶é¡¹ç›®ä¸­ç»§æ‰¿è¯¥é¡¹ï¼Œå¹¶ä¸”version å’Œ scope éƒ½è¯»å–è‡ªçˆ¶ pom</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230519202427190.png" alt="image-20230519202427190" style="zoom:50%;" /><p>6ã€å¦‚æœå­é¡¹ç›®ä¸­æŒ‡å®šäº†ç‰ˆæœ¬å·ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨å­é¡¹ç›®ä¸­æŒ‡å®šçš„ jar ç‰ˆæœ¬</p><h2 id="3-2-åˆ›å»ºä¼šå‘˜ä¸­å¿ƒå¾®æœåŠ¡æ¨¡å—-service-provider"><a href="#3-2-åˆ›å»ºä¼šå‘˜ä¸­å¿ƒå¾®æœåŠ¡æ¨¡å—-service-provider" class="headerlink" title="3.2 åˆ›å»ºä¼šå‘˜ä¸­å¿ƒå¾®æœåŠ¡æ¨¡å— -service provider"></a>3.2 åˆ›å»ºä¼šå‘˜ä¸­å¿ƒå¾®æœåŠ¡æ¨¡å— -service provider</h2><h3 id="3-2-1-éœ€æ±‚è¯´æ˜"><a href="#3-2-1-éœ€æ±‚è¯´æ˜" class="headerlink" title="3.2.1 éœ€æ±‚è¯´æ˜"></a><strong>3.2.1</strong> éœ€æ±‚è¯´æ˜</h3><h4 id="1ã€é€šè¿‡æµè§ˆå™¨å¯ä»¥è·å–ä¼šå‘˜ä¿¡æ¯-é€šè¿‡ä¼šå‘˜ä¸­å¿ƒå¾®æœåŠ¡æ¨¡å—"><a href="#1ã€é€šè¿‡æµè§ˆå™¨å¯ä»¥è·å–ä¼šå‘˜ä¿¡æ¯-é€šè¿‡ä¼šå‘˜ä¸­å¿ƒå¾®æœåŠ¡æ¨¡å—" class="headerlink" title="1ã€é€šè¿‡æµè§ˆå™¨å¯ä»¥è·å–ä¼šå‘˜ä¿¡æ¯**(é€šè¿‡ä¼šå‘˜ä¸­å¿ƒå¾®æœåŠ¡æ¨¡å—)**"></a><strong>1</strong>ã€é€šè¿‡æµè§ˆå™¨å¯ä»¥è·å–ä¼šå‘˜ä¿¡æ¯**(<strong>é€šè¿‡ä¼šå‘˜ä¸­å¿ƒå¾®æœåŠ¡æ¨¡å—</strong>)**</h4><h3 id="3-2-2-æ€è·¯åˆ†æ"><a href="#3-2-2-æ€è·¯åˆ†æ" class="headerlink" title="3.2.2 æ€è·¯åˆ†æ"></a><strong>3.2.2</strong> æ€è·¯åˆ†æ</h3><p>1ã€åˆ›å»º Moduel &amp; å®Œæˆé…ç½®</p><p>2ã€åˆ›å»ºæ•°æ®åº“&#x2F;è¡¨</p><p>3ã€åˆ›å»º entity-dao&#x2F;Mapper.xml-service-controller</p><p>4ã€å®Œæˆæµ‹è¯•</p><h3 id="3-2-3-å®ç°æ­¥éª¤"><a href="#3-2-3-å®ç°æ­¥éª¤" class="headerlink" title="3.2.3 å®ç°æ­¥éª¤"></a><strong>3.2.3</strong> å®ç°æ­¥éª¤</h3><p>â€‹application.yml:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-provider-10000</span><span class="comment">#åç§°ï¼Œå¯ä»¥è‡ªå·±æŒ‡å®š</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/booking?characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">QWEASDzxc123</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span> <span class="comment">#åé¢ mapper æ–‡ä»¶çš„ä½ç½®</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.study.springcloud.entity</span>  <span class="comment">#å®ä½“ç±»çš„åŒ…è·¯å¾„</span></span><br></pre></td></tr></table></figure><p>MemberMapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.study.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e-commerce-center<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>member-service-provider-10000<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;packaging&gt;war&lt;/packaging&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>member-service-provider-10000 Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        ä½¿ç”¨ç‰ˆæœ¬ä»²è£ï¼Œä»çˆ¶é¡¹ç›®ä¸­è·å–ç‰ˆæœ¬--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        springbootç¨‹åºçš„ç›‘æ§ç³»ç»Ÿï¼Œå®ç°ç³»ç»Ÿå¥åº·æ£€æµ‹</span></span><br><span class="line"><span class="comment">            å¯ä»¥é€šè¿‡ http://localhost:10000/actuator çœ‹åˆ°ç›¸å…³è¿æ¥</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>member-service-provider-10000<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-2-4-ğŸŒŸæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#3-2-4-ğŸŒŸæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="3.2.4 ğŸŒŸæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a><strong>3.2.4</strong> ğŸŒŸæ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><p><strong>ä¼ è¾“javabeanæ—¶</strong></p><p>1ã€æˆ‘ä»¬çš„å‰ç«¯å¦‚æœæ˜¯ä»¥ <strong>json æ ¼å¼</strong>æ¥å‘é€æ·»åŠ ä¿¡æ¯Memberï¼Œé‚£ä¹ˆæˆ‘ä»¬<strong>éœ€è¦ä½¿ç”¨@RequestBody</strong>,</p><p>æ‰èƒ½å°†æ•°æ®å°è£åˆ°å¯¹åº”çš„ beanï¼ŒåŒæ—¶ä¿è¯ http çš„è¯·æ±‚å¤´çš„ content-type æ˜¯å¯¹åº”çš„</p><p>2ã€å¦‚æœå‰ç«¯æ˜¯ä»¥ <strong>è¡¨å•</strong> æˆ–è€… <strong>parameters</strong> å½¢å¼æäº¤ï¼Œ åˆ™ä¸€å®šä¸èƒ½ä½¿ç”¨@RequestBodyï¼Œ æ‰</p><p>ä¼šè¿›è¡Œå¯¹è±¡å‚æ•°å°è£…ï¼ŒåŒæ—¶ä¿è¯http çš„è¯·æ±‚å¤´çš„ content-type æ˜¯å¯¹åº”</p><p>3ã€åœ¨è¿›è¡Œ SpringBoot åº”ç”¨ç¨‹åºæµ‹è¯•æ—¶ï¼Œå¼•å…¥çš„ jUnit æ˜¯ore.junit.jupiter.api.Test</p><p>4ã€ åœ¨è¿è¡Œç¨‹åºæ—¶ï¼Œä¸€å®šè¦ç¡®ä¿ä½ çš„ XxxxMapper.xml æ–‡ä»¶è¢«è‡ªåŠ¨æ”¾åˆ°çš„ target ç›®å½•çš„</p><p>classes æŒ‡å®šç›®å½•ã€‚</p><h2 id="3-3-åˆ›å»ºä½¿ç”¨ä¼šå‘˜å¾®æœåŠ¡æ¨¡å—-service-consumer"><a href="#3-3-åˆ›å»ºä½¿ç”¨ä¼šå‘˜å¾®æœåŠ¡æ¨¡å—-service-consumer" class="headerlink" title="3.3 åˆ›å»ºä½¿ç”¨ä¼šå‘˜å¾®æœåŠ¡æ¨¡å— -service consumer"></a>3.3 åˆ›å»ºä½¿ç”¨ä¼šå‘˜å¾®æœåŠ¡æ¨¡å— -service consumer</h2><h3 id="3-3-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£"><a href="#3-3-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£" class="headerlink" title="3.3.1 éœ€æ±‚è¯´æ˜**&#x2F;**å›¾è§£"></a><strong>3.3.1</strong> éœ€æ±‚è¯´æ˜**&#x2F;**å›¾è§£</h3><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230520114632421.png" alt="image-20230520114632421" style="zoom:30%;" /><p>-æµè§ˆå™¨: <a href="http://localhost/member/consumer/get/1">http://localhost/member/consumer/get/1</a></p><p>-æµ‹è¯•æ·»åŠ ä¼šå‘˜ : <a href="http://localhost/member/consumer/save">http://localhost/member/consumer/save</a></p><h3 id="3-3-2-æ€è·¯åˆ†æ-x2F-å›¾è§£"><a href="#3-3-2-æ€è·¯åˆ†æ-x2F-å›¾è§£" class="headerlink" title="3.3.2 æ€è·¯åˆ†æ**&#x2F;**å›¾è§£"></a><strong>3.3.2</strong> æ€è·¯åˆ†æ**&#x2F;**å›¾è§£</h3><p>1ã€åˆ›å»º Moduel(member-service-consumer-80) ï¼† å®Œæˆé…ç½</p><p>2ã€åˆ›å»º controller</p><p>3ã€å®Œæˆæµ‹è¯•</p><h3 id="3-3-3-å®ç°æ­¥éª¤"><a href="#3-3-3-å®ç°æ­¥éª¤" class="headerlink" title="3.3.3 å®ç°æ­¥éª¤"></a><strong>3.3.3</strong> å®ç°æ­¥éª¤</h3><h4 id="3-3-3-1-åˆ›å»º-Moduel-amp-å®Œæˆé…ç½®"><a href="#3-3-3-1-åˆ›å»º-Moduel-amp-å®Œæˆé…ç½®" class="headerlink" title="3.3.3.1 åˆ›å»º Moduel &amp; å®Œæˆé…ç½®"></a>3.3.3.1 åˆ›å»º Moduel &amp; å®Œæˆé…ç½®</h4><h5 id="åˆ›å»ºModuelï¼š"><a href="#åˆ›å»ºModuelï¼š" class="headerlink" title="åˆ›å»ºModuelï¼š"></a>åˆ›å»ºModuelï¼š</h5><p>åœ¨åˆ›å»ºModuelåï¼Œå…¶çˆ¶å·¥ç¨‹çš„ pom.xml ä¼šåšç›¸åº”å˜åŒ–ï¼Œåœ¨<modules>æ ‡ç­¾ä¸­å¢åŠ ç®¡ç†member-service-consumer-80å¾®æœåŠ¡æ¨¡å—</p><h5 id="å®Œæˆé…ç½®ï¼š"><a href="#å®Œæˆé…ç½®ï¼š" class="headerlink" title="å®Œæˆé…ç½®ï¼š"></a>å®Œæˆé…ç½®ï¼š</h5><p>pom.xml &#x2F; application.yaml å¯å‚è€ƒä¹‹å‰å†™çš„ï¼Œå–è‡ªå·±éœ€è¦çš„å³å¯ã€‚</p><h5 id="æ³¨å…¥-RestTemplateï¼š"><a href="#æ³¨å…¥-RestTemplateï¼š" class="headerlink" title="æ³¨å…¥ RestTemplateï¼š"></a>æ³¨å…¥ RestTemplateï¼š</h5><h6 id="RestTemplateåŸºæœ¬ä»‹ç»ï¼š"><a href="#RestTemplateåŸºæœ¬ä»‹ç»ï¼š" class="headerlink" title="RestTemplateåŸºæœ¬ä»‹ç»ï¼š"></a>RestTemplateåŸºæœ¬ä»‹ç»ï¼š</h6><p>â€‹1ã€<strong>RestTemplate</strong> æ˜¯Spring æä¾›çš„ç”¨äºè®¿é—® Rest æœåŠ¡çš„æ¨¡æ¿ç±»</p><p>â€‹2ã€RestTerplate æä¾›äº†å¤šç§<strong>ä¾¿æ·è®¿é—®è¿œç¨‹ Http æœåŠ¡</strong>çš„æ–¹æ³•</p><p>â€‹3ã€è¯´æ˜ï¼šå¯ä»¥è¿™æ ·ç†è§£ï¼Œé€šè¿‡ RestTemplateï¼Œæˆ‘ä»¬å¯ä»¥å‘å‡º http è¯·æ±‚(æ”¯æŒRestful é£æ ¼)ï¼Œå»è°ƒç”¨Controller æä¾›çš„ API æ¥å£ï¼Œå°±åƒæˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨å‘å‡ºhttp è¯·æ±‚è°ƒç”¨è¯¥ APIæ¥å£ä¸€æ ·ã€‚</p><p>â€‹4ã€ä½¿ç”¨ç®€å•ä¾¿æ·</p><h6 id="å®˜ç½‘åœ°å€ï¼š"><a href="#å®˜ç½‘åœ°å€ï¼š" class="headerlink" title="å®˜ç½‘åœ°å€ï¼š"></a>å®˜ç½‘åœ°å€ï¼š</h6><p><a href="https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html">https://docs.spring.io/spring-framework/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html</a></p><h6 id="åˆ›å»ºé…ç½®ç±»-com-x2F-hspedu-x2F-springcloud-x2F-config-x2F-CustomizationBean-java"><a href="#åˆ›å»ºé…ç½®ç±»-com-x2F-hspedu-x2F-springcloud-x2F-config-x2F-CustomizationBean-java" class="headerlink" title="åˆ›å»ºé…ç½®ç±»: com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;CustomizationBean.java"></a>åˆ›å»ºé…ç½®ç±»: com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;CustomizationBean.java</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomizationBean</span> &#123;</span><br><span class="line">    <span class="comment">//é…ç½®æ³¨å…¥RestTemplate bean å¯¹è±¡</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="åˆ›å»º-com-x2F-hspedu-x2F-springcloud-x2F-controller-x2F-MemberConsumerController-java"><a href="#åˆ›å»º-com-x2F-hspedu-x2F-springcloud-x2F-controller-x2F-MemberConsumerController-java" class="headerlink" title="åˆ›å»º:com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberConsumerController.java"></a>åˆ›å»º:com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberConsumerController.java</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberConsumerController</span> &#123;</span><br><span class="line">    <span class="comment">//urlç”±ï¼ˆipï¼šç«¯å£ï¼‰+ï¼ˆè¯·æ±‚åç§°ï¼‰ä¸¤éƒ¨åˆ†ç»„æˆ</span></span><br><span class="line">    <span class="comment">//å®šä¹‰member_service_provider_url</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MEMBER_SERVICE_PROVIDER_URL</span> <span class="operator">=</span></span><br><span class="line">            <span class="string">&quot;http://localhost:10000&quot;</span>;</span><br><span class="line">    <span class="comment">//æ–¹æ³•/æ¥å£ï¼Œæ·»åŠ memberå¯¹è±¡åˆ°æ•°æ®åº“/è¡¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è£…é…RestController</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;member/consumer/save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Member&gt; <span class="title function_">save</span><span class="params">(Member member)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;service-consumer member=&#123;&#125;&quot;</span>,member);</span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(</span><br><span class="line">                MEMBER_SERVICE_PROVIDER_URL+<span class="string">&quot;/member/save&quot;</span>,member, Result.class);</span><br><span class="line">        <span class="comment">//url,è¦saveçš„å¯¹è±¡ï¼Œè¿”å›å€¼çš„ç±»å‹</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®id è°ƒç”¨æœåŠ¡æ¥å£ï¼Œè¿”å›memberå¯¹è±¡ä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/member/consumer/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Member&gt; <span class="title function_">getMemberById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(</span><br><span class="line">                MEMBER_SERVICE_PROVIDER_URL+<span class="string">&quot;/member/get/&quot;</span> + id,Result.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-3-3-2-æ³¨æ„äº‹é¡¹å’Œä½¿ç”¨ç»†èŠ‚"><a href="#3-3-3-2-æ³¨æ„äº‹é¡¹å’Œä½¿ç”¨ç»†èŠ‚" class="headerlink" title="3.3.3.2 æ³¨æ„äº‹é¡¹å’Œä½¿ç”¨ç»†èŠ‚"></a>3.3.3.2 æ³¨æ„äº‹é¡¹å’Œä½¿ç”¨ç»†èŠ‚</h4><h5 id="æ·»åŠ ä¼šå‘˜æ•°æ®åº“ä¸­ä¸º-null-çš„è§£å†³æ–¹æ¡ˆ"><a href="#æ·»åŠ ä¼šå‘˜æ•°æ®åº“ä¸­ä¸º-null-çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æ·»åŠ ä¼šå‘˜æ•°æ®åº“ä¸­ä¸º null çš„è§£å†³æ–¹æ¡ˆ"></a>æ·»åŠ ä¼šå‘˜æ•°æ®åº“ä¸­ä¸º <strong>null</strong> çš„è§£å†³æ–¹æ¡ˆ</h5><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230520171355467.png" alt="image-20230520171355467" style="zoom:50%;" /><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230520171418620.png" alt="image-20230520171418620" style="zoom:50%;" /><h5 id="å¼€å¯-Run-DashBoard"><a href="#å¼€å¯-Run-DashBoard" class="headerlink" title="å¼€å¯ Run DashBoard"></a>å¼€å¯ <strong>Run DashBoard</strong></h5><p>â€‹å½“springcloud çš„æœåŠ¡æœ‰å¤šä¸ªæ—¶ï¼Œç®¡ç†å¤šä¸ªæœåŠ¡çš„å¯åŠ¨ä½¿ç”¨runä¼šä¸å¥½ç®¡ç†ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ </p><p>RunDashboard.</p><p>æ‰¾åˆ° ä½ çš„é¡¹ç›®&#x2F;.idea&#x2F;workspace.xml æ–‡ä»¶åœ¨å…¶ä¸­æ·»åŠ ä¸‹é¢çš„ä»£ç å³å¯</p><p>æ·»åŠ åœ¨ï¼šåŸæœ¬ç¬¬äºŒè¡Œ<project version="4">çš„ä¸‹ä¸€è¡Œå³å¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">name</span>=<span class="string">&quot;RunDashboard&quot;</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;configurationTypes&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;SpringBootApplicationConfigurationType&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;ruleStates&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RuleState</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ConfigurationTypeDashboardGroupingRule&quot;</span> /&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">RuleState</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RuleState</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;StatusDashboardGroupingRule&quot;</span> /&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">RuleState</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">option</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é‡å¯é¡¹ç›® </p><p>â€‹<strong>è§†å›¾-å·¥å…·çª—å£-æœåŠ¡</strong> å³å¯æ–¹ä¾¿ç®¡ç†å„ä¸ªä¸»ç¨‹åºï¼</p><h2 id="3-4-åˆ›å»ºå…±ç”¨æ¨¡å—-ä¾›å…¶å®ƒæ¨¡å—ä½¿ç”¨"><a href="#3-4-åˆ›å»ºå…±ç”¨æ¨¡å—-ä¾›å…¶å®ƒæ¨¡å—ä½¿ç”¨" class="headerlink" title="3.4 åˆ›å»ºå…±ç”¨æ¨¡å—-ä¾›å…¶å®ƒæ¨¡å—ä½¿ç”¨"></a>3.4 åˆ›å»ºå…±ç”¨æ¨¡å—-ä¾›å…¶å®ƒæ¨¡å—ä½¿ç”¨</h2><h3 id="3-4-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£"><a href="#3-4-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£" class="headerlink" title="3.4.1 éœ€æ±‚è¯´æ˜**&#x2F;**å›¾è§£"></a><strong>3.4.1</strong> éœ€æ±‚è¯´æ˜**&#x2F;**å›¾è§£</h3><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230520185154382.png" alt="image-20230520185154382" style="zoom:50%;" /><h3 id="3-4-2-æ€è·¯åˆ†æ-x2F-å›¾è§£"><a href="#3-4-2-æ€è·¯åˆ†æ-x2F-å›¾è§£" class="headerlink" title="3.4.2 æ€è·¯åˆ†æ**&#x2F;**å›¾è§£"></a><strong>3.4.2</strong> æ€è·¯åˆ†æ**&#x2F;**å›¾è§£</h3><p>1ã€åˆ›å»º Moduel &amp; å®Œæˆé…ç½®</p><p>2ã€åˆ›å»ºentityï¼ŒæŠŠå…±ç”¨çš„å®ä½“ç±»æ”¾åˆ°å¯¹åº”çš„åŒ…ä¸‹</p><p>3ã€å®Œæˆæµ‹è¯•</p><h3 id="3-4-3-å®ç°æ­¥éª¤"><a href="#3-4-3-å®ç°æ­¥éª¤" class="headerlink" title="3.4.3 å®ç°æ­¥éª¤"></a><strong>3.4.3</strong> å®ç°æ­¥éª¤</h3><h4 id="3-4-3-1-åˆ›å»º-Moduel-amp-å®Œæˆé…ç½®"><a href="#3-4-3-1-åˆ›å»º-Moduel-amp-å®Œæˆé…ç½®" class="headerlink" title="3.4.3.1 åˆ›å»º Moduel &amp; å®Œæˆé…ç½®"></a>3.4.3.1 åˆ›å»º Moduel &amp; å®Œæˆé…ç½®</h4><h5 id="3-4-3-1-1-åˆ›å»º-e-commerce-center-common-api"><a href="#3-4-3-1-1-åˆ›å»º-e-commerce-center-common-api" class="headerlink" title="3.4.3.1.1 åˆ›å»º e_commerce_center-common-api"></a><strong>3.4.3.1.1</strong> åˆ›å»º <strong>e_commerce_center-common-api</strong></h5><h6 id="åœ¨pom-xmlä¸­æå–å…¬å…±ä¾èµ–"><a href="#åœ¨pom-xmlä¸­æå–å…¬å…±ä¾èµ–" class="headerlink" title="åœ¨pom.xmlä¸­æå–å…¬å…±ä¾èµ–"></a>åœ¨pom.xmlä¸­æå–å…¬å…±ä¾èµ–</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--è€å¸ˆè§£è¯»&lt;optional&gt;true&lt;/optional&gt;:</span></span><br><span class="line"><span class="comment">    1. true è¡¨ç¤ºä¸¤ä¸ªé¡¹ç›®ä¹‹é—´ä¾èµ–ä¸ä¼ é€’</span></span><br><span class="line"><span class="comment">    2. å°ä¼™ä¼´å¯ä»¥è¿™é‡Œç†è§£&lt;optional&gt;true&lt;/optional&gt;: é˜²æ­¢å°†è¯¥ä¾èµ–ä¼ é€’åˆ°å…¶ä»–æ¨¡å—ä¸­</span></span><br><span class="line"><span class="comment">    è¯´çš„å†å…·ä½“ä¸€ç‚¹ï¼Œæ¯”å¦‚ member-service-consumer-80 æ¨¡å—ä¾èµ–äº†æœ¬é¡¹ç›®,</span></span><br><span class="line"><span class="comment">    é‚£ä¹ˆæœ¬é¡¹ç›®ä¸ä¼šæŠŠ lombok ä¼ é€’ç»™ member-service-consumer-80</span></span><br><span class="line"><span class="comment">    3. ä¸è®¾ç½® optional æˆ–è€… optional æ˜¯ falseï¼Œè¡¨ç¤ºä¼ é€’ä¾èµ–</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h6 id="æŠ½å–å…±ç”¨-API-x2F-ç±»"><a href="#æŠ½å–å…±ç”¨-API-x2F-ç±»" class="headerlink" title="æŠ½å–å…±ç”¨ API&#x2F;ç±»"></a>æŠ½å–å…±ç”¨ API&#x2F;ç±»</h6><p>â€‹å†™å…¥å…¬å…±çš„entity</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230520191145475.png" alt="image-20230520191145475" style="zoom:55%;" /><h6 id="ä½¿ç”¨-Maven-æ‰“åŒ…æˆ-jar"><a href="#ä½¿ç”¨-Maven-æ‰“åŒ…æˆ-jar" class="headerlink" title="ä½¿ç”¨ Maven æ‰“åŒ…æˆ jar"></a>ä½¿ç”¨ Maven æ‰“åŒ…æˆ jar</h6><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230520192050410.png" alt="image-20230520192050410" style="zoom:50%;" /><p>ä¼šåœ¨testç›®å½•ä¸­ç”Ÿæˆå¯¹åº”jaråŒ…</p><h6 id="å·¥ç¨‹é‡æ„"><a href="#å·¥ç¨‹é‡æ„" class="headerlink" title="å·¥ç¨‹é‡æ„"></a>å·¥ç¨‹é‡æ„</h6><p>â€‹1.åœ¨ <strong>member-service-consumer-80</strong> å¼•å…¥ <strong>e_commerce_center-common-api-1.0-SNAPSHOT.jar</strong></p><p>â€‹åˆ é™¤åŸæ¥çš„ <strong>entity</strong> åŒ…</p><p>â€‹ä¿®æ”¹ <strong>pom.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼•å…¥ e_commerce_center-common-api --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hspedu.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e_commerce_center-common-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®Œæˆäº†ï¼</p><h1 id="4-SpringCloud-Eureka-æœåŠ¡æ³¨å†Œä¸­å¿ƒ"><a href="#4-SpringCloud-Eureka-æœåŠ¡æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="4 SpringCloud Eureka æœåŠ¡æ³¨å†Œä¸­å¿ƒ"></a>4 SpringCloud Eureka æœåŠ¡æ³¨å†Œä¸­å¿ƒ</h1><h2 id="4-1-Eurekaä»‹ç»"><a href="#4-1-Eurekaä»‹ç»" class="headerlink" title="4.1 Eurekaä»‹ç»"></a>4.1 Eurekaä»‹ç»</h2><h3 id="4-1-1-å­¦-Eureka-å‰çš„è¯´æ˜"><a href="#4-1-1-å­¦-Eureka-å‰çš„è¯´æ˜" class="headerlink" title="4.1.1 å­¦ Eureka å‰çš„è¯´æ˜"></a><strong>4.1.1</strong> å­¦ <strong>Eureka</strong> å‰çš„è¯´æ˜</h3><h4 id="1ã€Spring-Cloud-ç»„ä»¶é€‰å‹å›¾"><a href="#1ã€Spring-Cloud-ç»„ä»¶é€‰å‹å›¾" class="headerlink" title="1ã€Spring Cloud ç»„ä»¶é€‰å‹å›¾"></a><strong>1</strong>ã€Spring Cloud ç»„ä»¶é€‰å‹å›¾</h4><p>![image-20230519190901580](&#x2F;Users&#x2F;donn&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230519190901580.png)</p><h4 id="2ã€ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œç›®å‰ä¸»æµçš„æœåŠ¡æ³¨å†Œ-amp-å‘ç°çš„ç»„ä»¶æ˜¯-Nacosï¼Œ-ä½†æ˜¯-Eureka-ä½œä¸ºä¸€ä¸ªè€ç‰Œç»å…¸çš„-æœåŠ¡æ³¨å†Œ-amp-å‘ç°æŠ€æœ¯è¿˜æ˜¯æœ‰å¿…è¦å­¦ä¹ ä¸€ä¸‹ï¼ŒåŸå› ï¼š"><a href="#2ã€ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œç›®å‰ä¸»æµçš„æœåŠ¡æ³¨å†Œ-amp-å‘ç°çš„ç»„ä»¶æ˜¯-Nacosï¼Œ-ä½†æ˜¯-Eureka-ä½œä¸ºä¸€ä¸ªè€ç‰Œç»å…¸çš„-æœåŠ¡æ³¨å†Œ-amp-å‘ç°æŠ€æœ¯è¿˜æ˜¯æœ‰å¿…è¦å­¦ä¹ ä¸€ä¸‹ï¼ŒåŸå› ï¼š" class="headerlink" title="2ã€ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œç›®å‰ä¸»æµçš„æœåŠ¡æ³¨å†Œ&amp;å‘ç°çš„ç»„ä»¶æ˜¯ Nacosï¼Œ ä½†æ˜¯ Eureka ä½œä¸ºä¸€ä¸ªè€ç‰Œç»å…¸çš„ æœåŠ¡æ³¨å†Œ&amp;å‘ç°æŠ€æœ¯è¿˜æ˜¯æœ‰å¿…è¦å­¦ä¹ ä¸€ä¸‹ï¼ŒåŸå› ï¼š"></a>2ã€ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œç›®å‰ä¸»æµçš„æœåŠ¡æ³¨å†Œ&amp;å‘ç°çš„ç»„ä»¶æ˜¯ Nacosï¼Œ ä½†æ˜¯ Eureka ä½œä¸ºä¸€ä¸ªè€ç‰Œç»å…¸çš„ æœåŠ¡æ³¨å†Œ&amp;å‘ç°æŠ€æœ¯è¿˜æ˜¯æœ‰å¿…è¦å­¦ä¹ ä¸€ä¸‹ï¼ŒåŸå› ï¼š</h4><p>ï¼ˆ1ï¼‰ ä¸€äº›æ—©æœŸçš„åˆ†å¸ƒå¼ å¾®æœåŠ¡é¡¹ç›®ä½¿ç”¨çš„æ˜¯ Eurekaï¼Œ å°ä¼™ä¼´åœ¨å·¥ä½œä¸­ï¼Œå®Œå…¨æœ‰å¯èƒ½é‡åˆ°è¿™ç§æƒ…å†µã€‚</p><p>ï¼ˆ2ï¼‰ åæœŸçš„æœåŠ¡æ³¨å†Œ&amp;å‘ç°ç»„ä»¶&#x2F;æŠ€æœ¯ï¼Œéƒ½å‚è€ƒäº† Eureka è®¾è®¡å’Œç†å¿µï¼Œå­¦ä¹ äº†Eureka åï¼Œæˆ‘ä»¬ä¸Šæ‰‹Nacoså®¹æ˜“å¾ˆå¤šï¼Œè€Œä¸”ç†è§£çš„æ›´æ·±åˆ»ã€‚</p><h3 id="4-1-2-å½“å‰é¡¹ç›®æ¶æ„é—®é¢˜åˆ†æ-å¼•å‡º-Eureka"><a href="#4-1-2-å½“å‰é¡¹ç›®æ¶æ„é—®é¢˜åˆ†æ-å¼•å‡º-Eureka" class="headerlink" title="4.1.2 å½“å‰é¡¹ç›®æ¶æ„é—®é¢˜åˆ†æ **-**å¼•å‡º Eureka"></a><strong>4.1.2</strong> å½“å‰é¡¹ç›®æ¶æ„é—®é¢˜åˆ†æ **-**å¼•å‡º Eureka</h3><p>ä¸€å›¾èƒœåƒè¨€</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230521192330770.png" alt="image-20230521192330770"></p><p>1.åœ¨ä¼ä¸šçº§é¡¹ç›®ä¸­ï¼ŒæœåŠ¡æ¶ˆè´¹è®¿é—®è¯·æ±‚ä¼šå­˜åœ¨é«˜å¹¶å‘ (ä¸€ä¸ªæœåŠ¡æä¾›æ¨¡å—å¯èƒ½æ— æ³•æ‰¿å—)</p><p>2.å¦‚æœåªæœ‰ä¸€ä¸ªä¼šå‘˜ä¸­å¿ƒ-æä¾›æœåŠ¡æ¨¡å—ï¼Œå¯ç”¨æ€§å·® (å¦‚æœåªæœ‰ä¸€ä¸ªæœåŠ¡æä¾›æ¨¡å—ï¼Œå¦‚æœæ•…éšœï¼Œç³»ç»Ÿå°†æ— æ³•ä½¿ç”¨ï¼Œå¯ç”¨æ€§å·®)</p><p>3.æ‰€ä»¥ï¼Œä¼šå‘˜ä¸­å¿ƒæä¾›æœåŠ¡å¾€å¾€æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šæœ‰<strong>å¤šä¸ªä¼šå‘˜ä¸­å¿ƒæä¾›æœåŠ¡å¾®æœåŠ¡æ¨¡å—</strong> ( é«˜å¯ç”¨ )  </p><p>4.é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œå°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šæœåŠ¡æ¶ˆè´¹æ–¹ï¼Œæ€ä¹ˆå»å‘ç°å¯ä»¥ä½¿ç”¨çš„æœåŠ¡ </p><p>5,å½“æœåŠ¡æ¶ˆè´¹æ–¹ï¼Œå‘ç°äº†å¯ä»¥ä½¿ç”¨çš„æœåŠ¡å(å¯èƒ½æ˜¯å¤šä¸ªï¼Œåˆå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šåˆ°åº•è°ƒç”¨ AæœåŠ¡ï¼Œè¿˜æ˜¯BæœåŠ¡ï¼Ÿ è¿™å°±å¼•å‡ºäº†æœåŠ¡æ³¨å†Œå’Œè´Ÿè½½å‡è¡¡)</p><p>6.Eureka å°±å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜</p><h3 id="4-1-3-å¼•å…¥-Eureka-é¡¹ç›®æ¶æ„"><a href="#4-1-3-å¼•å…¥-Eureka-é¡¹ç›®æ¶æ„" class="headerlink" title="4.1.3 å¼•å…¥ Eureka é¡¹ç›®æ¶æ„"></a><strong>4.1.3</strong> å¼•å…¥ <strong>Eureka</strong> é¡¹ç›®æ¶æ„</h3><h4 id="ä¸€å›¾èƒœåƒè¨€"><a href="#ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="ä¸€å›¾èƒœåƒè¨€"></a>ä¸€å›¾èƒœåƒè¨€</h4><p>â€‹<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230521193144050.png" alt="image-20230521193144050"></p><ol><li><p>ä¼šå‘˜ä¸­å¿ƒ-æ˜¯æä¾›æœåŠ¡çš„æ¨¡å—ï¼Œåœ¨é¡¹ç›®ä¸­ï¼Œä¼šåšæˆé›†ç¾¤ï¼Œæä¾›é«˜å¯ç”¨</p></li><li><p>Eureka Server æœ‰å¿…è¦çš„è¯ï¼Œä¹Ÿå¯ä»¥åšæˆé›†ç¾¤</p></li><li><p>Eureka åŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼šEureka Serverå’Œ Eureka Client</p></li><li><p>Eureka Server æä¾›æ³¨å†ŒæœåŠ¡ï¼Œå„ä¸ªå¾®æœåŠ¡èŠ‚ç‚¹é€šè¿‡é…ç½®å¯åŠ¨åï¼Œä¼šåœ¨ Eureka Serverä¸­è¿¸è¡Œæ³¨å†Œï¼Œè¿™æ · EurekaServer ä¸­çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­å°†ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒæœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯å¯ä»¥åœ¨ç•Œé¢ä¸­ç›´è§‚çœ‹åˆ°ã€‚</p></li><li><p>Euretka Client é€šè¿‡æ³¨å†Œä¸­å¿ƒè¿›è¡Œè®¿é—®ï¼Œæ˜¯ä¸€ä¸ªJava å®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ– Eureka Serverçš„äº¤äº’ï¼Œå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå…·å¤‡ä¸€ä¸ªå†…ç½®çš„ã€ä½¿ç”¨è½®è¯¢(round-robinï¼‰ è´Ÿè½½ç®—æ³•çš„è´Ÿè½½å‡è¡¡å™¨ã€‚åœ¨åº”ç”¨å¯åŠ¨åï¼Œå°†ä¼šå‘ Eureka Server å‘é€å¿ƒè·³ï¼ˆé»˜è®¤å‘¨æœŸä¸º 30ç§’)ã€‚å¦‚æœ Eureka Server åœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEurekaServer å°†ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æŠŠè¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ç§»é™¤(é»˜è®¤90ç§’)</p></li></ol><h3 id="4-1-4-æœåŠ¡æ²»ç†ä»‹ç»"><a href="#4-1-4-æœåŠ¡æ²»ç†ä»‹ç»" class="headerlink" title="4.1.4 æœåŠ¡æ²»ç†ä»‹ç»"></a><strong>4.1.4</strong> æœåŠ¡æ²»ç†ä»‹ç»</h3><h4 id="4-1-4-1-Eurekaå®ç°æœåŠ¡æ²»ç†"><a href="#4-1-4-1-Eurekaå®ç°æœåŠ¡æ²»ç†" class="headerlink" title="4.1.4.1 Eurekaå®ç°æœåŠ¡æ²»ç†"></a>4.1.4.1 Eurekaå®ç°æœåŠ¡æ²»ç†</h4><h4 id="4-1-4-2-åœ¨ä¼ ç»Ÿçš„-rpc-è¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œç®¡ç†å›°éš¾ï¼Œæ‰€ä»¥-éœ€è¦æ²»ç†æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»"><a href="#4-1-4-2-åœ¨ä¼ ç»Ÿçš„-rpc-è¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œç®¡ç†å›°éš¾ï¼Œæ‰€ä»¥-éœ€è¦æ²»ç†æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»" class="headerlink" title="4.1.4.2 åœ¨ä¼ ç»Ÿçš„ rpc è¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œç®¡ç†å›°éš¾ï¼Œæ‰€ä»¥ éœ€è¦æ²»ç†æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»"></a>4.1.4.2 åœ¨ä¼ ç»Ÿçš„ rpc è¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œç®¡ç†å›°éš¾ï¼Œæ‰€ä»¥ éœ€è¦æ²»ç†æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»</h4><h4 id="4-1-4-3-æœåŠ¡æ²»ç†å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œã€‚"><a href="#4-1-4-3-æœåŠ¡æ²»ç†å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œã€‚" class="headerlink" title="4.1.4.3 æœåŠ¡æ²»ç†å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œã€‚"></a>4.1.4.3 æœåŠ¡æ²»ç†å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œã€‚</h4><h4 id="4-1-4-4-äºŒè¯´åˆ†å¸ƒå¼å¼€å‘-https-jingyan-baidu-com-article-46650658def479f549e5f83e-html"><a href="#4-1-4-4-äºŒè¯´åˆ†å¸ƒå¼å¼€å‘-https-jingyan-baidu-com-article-46650658def479f549e5f83e-html" class="headerlink" title="4.1.4.4 äºŒè¯´åˆ†å¸ƒå¼å¼€å‘: https://jingyan.baidu.com/article/46650658def479f549e5f83e.html"></a>4.1.4.4 äºŒè¯´åˆ†å¸ƒå¼å¼€å‘: <a href="https://jingyan.baidu.com/article/46650658def479f549e5f83e.html">https://jingyan.baidu.com/article/46650658def479f549e5f83e.html</a></h4><h3 id="4-1-5-æœåŠ¡æ³¨å†Œå’Œå‘ç°"><a href="#4-1-5-æœåŠ¡æ³¨å†Œå’Œå‘ç°" class="headerlink" title="4.1.5 æœåŠ¡æ³¨å†Œå’Œå‘ç°"></a><strong>4.1.5</strong> æœåŠ¡æ³¨å†Œå’Œå‘ç°</h3><p>Eurekaé‡‡ç”¨äº†CS [client-server-javaåŸºç¡€æˆ‘ä»¬è®²è¿‡ä¸€ä¸ªå¤šäººèŠå¤©é¡¹ç›®] çš„è®¾è®¡æ¶æ„ï¼ŒEureka Server ä½œä¸ºæœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚</p><p>ç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œ<strong>ä½¿ç”¨ Eurekaçš„å®¢æˆ·ç«¯è¿æ¥åˆ° Eureka Server</strong>å¹¶ç»´æŒå¿ƒè·³è¿æ¥ï¼Œé€šè¿‡ Eureka Server æ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚</p><p>åœ¨æœåŠ¡æ³¨å†Œä¸å‘ç°ä¸­ï¼Œæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒã€‚å½“æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰è‡ªå·±æœåŠ¡å™¨çš„ä¿¡æ¯ æ¯”å¦‚ æœåŠ¡åœ°å€é€šè®¯åœ°å€ç­‰ä»¥åˆ«åæ–¹å¼æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šã€‚</p><p>æœåŠ¡æ¶ˆè´¹è€…æˆ–è€…æœåŠ¡æä¾›è€…ï¼Œä»¥æœåŠ¡åˆ«åçš„æ–¹å¼å»æ³¨å†Œä¸­å¿ƒä¸Šè·å–åˆ°å®é™…çš„æœåŠ¡æä¾›è€…é€šè®¯åœ°å€ï¼Œç„¶åé€šè¿‡RPCè°ƒç”¨æœåŠ¡ã€‚</p><h2 id="4-2-åˆ›å»ºå•æœº-Eureka-Server-æ³¨å†Œä¸­å¿ƒ"><a href="#4-2-åˆ›å»ºå•æœº-Eureka-Server-æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="4.2 åˆ›å»ºå•æœº Eureka Server-æ³¨å†Œä¸­å¿ƒ"></a>4.2 åˆ›å»ºå•æœº Eureka Server-æ³¨å†Œä¸­å¿ƒ</h2><h3 id="4-2-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£"><a href="#4-2-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£" class="headerlink" title="4.2.1 éœ€æ±‚è¯´æ˜**&#x2F;**å›¾è§£"></a><strong>4.2.1</strong> éœ€æ±‚è¯´æ˜**&#x2F;**å›¾è§£</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230522104534270.png" alt="image-20230522104534270"></p><h3 id="4-2-2-å®ç°æ­¥éª¤"><a href="#4-2-2-å®ç°æ­¥éª¤" class="headerlink" title="4.2.2 å®ç°æ­¥éª¤"></a><strong>4.2.2</strong> å®ç°æ­¥éª¤</h3><h4 id="4-2-2-1-åˆ›å»º-Moduel-amp-å®Œæˆé…ç½®"><a href="#4-2-2-1-åˆ›å»º-Moduel-amp-å®Œæˆé…ç½®" class="headerlink" title="4.2.2.1 åˆ›å»º Moduel &amp; å®Œæˆé…ç½®"></a>4.2.2.1 åˆ›å»º Moduel &amp; å®Œæˆé…ç½®</h4><h5 id="4-2-2-1-1-åˆ›å»º-e-commerce-eureka-server-9001-å¾®æœåŠ¡æ¨¡å—-ä½œä¸ºæ³¨å†Œä¸­å¿ƒ"><a href="#4-2-2-1-1-åˆ›å»º-e-commerce-eureka-server-9001-å¾®æœåŠ¡æ¨¡å—-ä½œä¸ºæ³¨å†Œä¸­å¿ƒ" class="headerlink" title="4.2.2.1.1 åˆ›å»º e-commerce-eureka-server-9001 å¾®æœåŠ¡æ¨¡å—**[**ä½œä¸ºæ³¨å†Œä¸­å¿ƒ]"></a>4.2.2.1.1 åˆ›å»º <strong>e-commerce-eureka-server-9001</strong> å¾®æœåŠ¡æ¨¡å—**[**ä½œä¸ºæ³¨å†Œä¸­å¿ƒ]</h5><h6 id="åˆ›å»º-module"><a href="#åˆ›å»º-module" class="headerlink" title="åˆ›å»º module"></a>åˆ›å»º <strong>module</strong></h6><h6 id="4-2-2-1-2-ä¿®æ”¹-e-commerce-eureka-server-9001-çš„-pom-xml-åŠ å…¥ä¾èµ–"><a href="#4-2-2-1-2-ä¿®æ”¹-e-commerce-eureka-server-9001-çš„-pom-xml-åŠ å…¥ä¾èµ–" class="headerlink" title="4.2.2.1.2 ä¿®æ”¹ e-commerce-eureka-server-9001 çš„ pom.xml , åŠ å…¥ä¾èµ–"></a>4.2.2.1.2 ä¿®æ”¹ <strong>e-commerce-eureka-server-9001</strong> çš„ <strong>pom.xml ,</strong> åŠ å…¥ä¾èµ–</h6><h6 id="4-2-2-1-3-åˆ›å»º-resources-x2F-application-yml"><a href="#4-2-2-1-3-åˆ›å»º-resources-x2F-application-yml" class="headerlink" title="4.2.2.1.3 åˆ›å»º resources&#x2F;application.yml"></a><strong>4.2.2.1.3</strong> åˆ›å»º <strong>resources&#x2F;application.yml</strong></h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"><span class="comment"># é…ç½®eureka-server</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment">#æœåŠ¡å®ä¾‹å</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment">#ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment">#è¡¨ç¤ºè‡ªå·±å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œä½œç”¨æ˜¯ç»´æŠ¤æ³¨å†ŒæœåŠ¡å®ä¾‹ï¼Œä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure><h6 id="4-2-2-1-4-åˆ›å»ºä¸»å¯åŠ¨ç±»-com-x2F-hspedu-x2F-springcloud-x2F-EurekaApplication-java"><a href="#4-2-2-1-4-åˆ›å»ºä¸»å¯åŠ¨ç±»-com-x2F-hspedu-x2F-springcloud-x2F-EurekaApplication-java" class="headerlink" title="4.2.2.1.4 åˆ›å»ºä¸»å¯åŠ¨ç±» com&#x2F;hspedu&#x2F;springcloud&#x2F;EurekaApplication.java"></a><strong>4.2.2.1.4</strong> åˆ›å»ºä¸»å¯åŠ¨ç±» <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;EurekaApplication.java</strong></h6><p>è®°å¾—æ·»åŠ @EnableEurekaServerï¼Œè¡¨ç¤ºè¯¥ç¨‹åºä½œä¸ºEurekaServer</p><h3 id="4-2-3-å°†-member-service-provider-10000-ä½œ-ä¸º-EurekaClient-æ³¨-å†Œ-åˆ°-e-commerce-eureka-server-9001-æˆä¸ºæœåŠ¡æä¾›è€…"><a href="#4-2-3-å°†-member-service-provider-10000-ä½œ-ä¸º-EurekaClient-æ³¨-å†Œ-åˆ°-e-commerce-eureka-server-9001-æˆä¸ºæœåŠ¡æä¾›è€…" class="headerlink" title="4.2.3 å°† member-service-provider-10000 ä½œ ä¸º EurekaClient æ³¨ å†Œ åˆ° e-commerce-eureka-server-9001 æˆä¸ºæœåŠ¡æä¾›è€…"></a><strong>4.2.3</strong> å°† <strong>member-service-provider-10000</strong> ä½œ ä¸º <strong>EurekaClient</strong> æ³¨ å†Œ åˆ° <strong>e-commerce-eureka-server-9001</strong> æˆä¸ºæœåŠ¡æä¾›è€…</h3><h4 id="4-2-3-1-æ¶æ„ç¤ºæ„å›¾"><a href="#4-2-3-1-æ¶æ„ç¤ºæ„å›¾" class="headerlink" title="4.2.3.1 æ¶æ„ç¤ºæ„å›¾"></a>4.2.3.1 æ¶æ„ç¤ºæ„å›¾</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230522124755649.png" alt="image-20230522124755649" style="zoom:50%;" /><h4 id="4-2-3-2-ä¿®æ”¹-member-service-provider-10000-çš„-pom-xml"><a href="#4-2-3-2-ä¿®æ”¹-member-service-provider-10000-çš„-pom-xml" class="headerlink" title="4.2.3.2 ä¿®æ”¹ member-service-provider-10000 çš„ pom.xml"></a>4.2.3.2 ä¿®æ”¹ member-service-provider-10000 çš„ pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--       å¼•å…¥eureka-clientåœºæ™¯å¯åŠ¨å™¨starter--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-2-3-3-ä¿®æ”¹-member-service-provider-10000-çš„-resources-x2F-application-yml"><a href="#4-2-3-3-ä¿®æ”¹-member-service-provider-10000-çš„-resources-x2F-application-yml" class="headerlink" title="4.2.3.3 ä¿®æ”¹ member-service-provider-10000 çš„ resources&#x2F;application.yml"></a>4.2.3.3 ä¿®æ”¹ member-service-provider-10000 çš„ resources&#x2F;application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-provider-10000</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/e_commerce_center_db?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">QWEASDzxc123</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.study.springcloud.entity</span></span><br><span class="line"><span class="comment">#é…ç½®eureka-client</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#å°†è‡ªå·±æ³¨å†Œåˆ°Eureka-server</span></span><br><span class="line">    <span class="comment">#è¡¨ç¤ºä»Eureka-serveræŠ“å–æ³¨å†Œä¿¡æ¯</span></span><br><span class="line">    <span class="comment">#å¦‚æœæ˜¯å•èŠ‚ç‚¹ï¼Œå¯ä»¥ä¸é…ç½®ï¼›</span></span><br><span class="line">    <span class="comment">#ä½†æ˜¯provideræ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œåˆ™å¿…é¡»å°†æ­¤é¡¹é…ç½®ä¸ºtrueï¼Œè¿™æ ·æ‰èƒ½é…åˆRibbonä½¿ç”¨è´Ÿè½½å‡è¡¡åŠŸèƒ½</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># è¡¨ç¤ºå°†è‡ªå·±æ³¨å†Œåˆ°å“ªä¸ªeureka-server</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:9001/eureka</span></span><br></pre></td></tr></table></figure><h4 id="4-2-3-4-ä¿®æ”¹-member-service-provider-10000-çš„-com-x2F-hspedu-x2F-springcloud-x2F-MemberApplication-java"><a href="#4-2-3-4-ä¿®æ”¹-member-service-provider-10000-çš„-com-x2F-hspedu-x2F-springcloud-x2F-MemberApplication-java" class="headerlink" title="4.2.3.4 ä¿®æ”¹ member-service-provider-10000 çš„ com&#x2F;hspedu&#x2F;springcloud&#x2F;MemberApplication.java"></a>4.2.3.4 ä¿®æ”¹ member-service-provider-10000 çš„ com&#x2F;hspedu&#x2F;springcloud&#x2F;MemberApplication.java</h4><p>æ·»åŠ æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@EnableEurekaClient,å°†è¯¥ç¨‹åºæ ‡è¯†ä¸ºEureka-client</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br></pre></td></tr></table></figure><h4 id="4-2-3-5-å®Œæˆæµ‹è¯•"><a href="#4-2-3-5-å®Œæˆæµ‹è¯•" class="headerlink" title="4.2.3.5 å®Œæˆæµ‹è¯•"></a>4.2.3.5 å®Œæˆæµ‹è¯•</h4><h5 id="4-2-3-5-1-å¯åŠ¨-e-commerce-eureka-server-9001"><a href="#4-2-3-5-1-å¯åŠ¨-e-commerce-eureka-server-9001" class="headerlink" title="4.2.3.5.1 å¯åŠ¨ **e-commerce-eureka-server-9001 **"></a><strong>4.2.3.5.1</strong> å¯åŠ¨ **e-commerce-eureka-server-9001 **</h5><h5 id="4-2-3-5-2-å¯åŠ¨-member-service-provider-10000"><a href="#4-2-3-5-2-å¯åŠ¨-member-service-provider-10000" class="headerlink" title="4.2.3.5.2 å¯åŠ¨ **member-service-provider-10000 **"></a><strong>4.2.3.5.2</strong> å¯åŠ¨ **member-service-provider-10000 **</h5><h5 id="4-2-3-5-3-æµè§ˆå™¨-http-localhost-9001"><a href="#4-2-3-5-3-æµè§ˆå™¨-http-localhost-9001" class="headerlink" title="4.2.3.5.3 æµè§ˆå™¨**: http://localhost:9001**"></a><strong>4.2.3.5.3</strong> æµè§ˆå™¨**: <a href="http://localhost:9001/">http://localhost:9001</a>**</h5><h5 id="4-2-3-5-4-å¾®æœåŠ¡æ³¨å†Œåé…ç½®è¯´æ˜"><a href="#4-2-3-5-4-å¾®æœåŠ¡æ³¨å†Œåé…ç½®è¯´æ˜" class="headerlink" title="4.2.3.5.4 å¾®æœåŠ¡æ³¨å†Œåé…ç½®è¯´æ˜"></a><strong>4.2.3.5.4</strong> å¾®æœåŠ¡æ³¨å†Œåé…ç½®è¯´æ˜</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230522130616526.png" alt="image-20230522130616526"></p><h3 id="4-2-4-é…-ç½®-member-service-consumer-80-ä½œ-ä¸º-EurekaClientï¼Œ-å¯-ä»¥-æ‹‰å–-x2F-è·-å–e-commerce-eureka-server-9001-æä¾›çš„æœåŠ¡ä¿¡æ¯"><a href="#4-2-4-é…-ç½®-member-service-consumer-80-ä½œ-ä¸º-EurekaClientï¼Œ-å¯-ä»¥-æ‹‰å–-x2F-è·-å–e-commerce-eureka-server-9001-æä¾›çš„æœåŠ¡ä¿¡æ¯" class="headerlink" title="4.2.4 é… ç½® member-service-consumer-80 ä½œ ä¸º EurekaClientï¼Œ å¯ ä»¥ æ‹‰å– &#x2F; è· å–e-commerce-eureka-server-9001 æä¾›çš„æœåŠ¡ä¿¡æ¯"></a><strong>4.2.4</strong> é… ç½® <strong>member-service-consumer-80</strong> ä½œ ä¸º <strong>EurekaClient</strong>ï¼Œ å¯ ä»¥ æ‹‰å– <strong>&#x2F;</strong> è· å–e-commerce-eureka-server-9001 æä¾›çš„æœåŠ¡ä¿¡æ¯</h3><h4 id="4-2-4-1-æ¶æ„ç¤ºæ„å›¾"><a href="#4-2-4-1-æ¶æ„ç¤ºæ„å›¾" class="headerlink" title="4.2.4.1 æ¶æ„ç¤ºæ„å›¾"></a>4.2.4.1 æ¶æ„ç¤ºæ„å›¾</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230522202407897.png" alt="image-20230522202407897"></p><h4 id="4-2-4-2-ä¿®æ”¹-pom-xml"><a href="#4-2-4-2-ä¿®æ”¹-pom-xml" class="headerlink" title="4.2.4.2 ä¿®æ”¹ pom.xml"></a>4.2.4.2 ä¿®æ”¹ pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--       å¼•å…¥eureka-clientåœºæ™¯å¯åŠ¨å™¨starter--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-2-4-3-ä¿®æ”¹-application-yml"><a href="#4-2-4-3-ä¿®æ”¹-application-yml" class="headerlink" title="4.2.4.3 ä¿®æ”¹ application.yml"></a>4.2.4.3 ä¿®æ”¹ application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">åœ¨åŸæœ¬çš„é…ç½®åœ¨å¢åŠ ï¼š</span></span><br><span class="line"><span class="comment">#é…ç½®eureka-client</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#å°†è‡ªå·±æ³¨å†Œåˆ°Eureka-server</span></span><br><span class="line">    <span class="comment">#è¡¨ç¤ºä»Eureka-serveræŠ“å–æ³¨å†Œä¿¡æ¯</span></span><br><span class="line">    <span class="comment">#å¦‚æœæ˜¯å•èŠ‚ç‚¹ï¼Œå¯ä»¥ä¸é…ç½®ï¼›</span></span><br><span class="line">    <span class="comment">#ä½†æ˜¯provideræ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œåˆ™å¿…é¡»å°†æ­¤é¡¹é…ç½®ä¸ºtrueï¼Œè¿™æ ·æ‰èƒ½é…åˆRibbonä½¿ç”¨è´Ÿè½½å‡è¡¡åŠŸèƒ½</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># è¡¨ç¤ºå°†è‡ªå·±æ³¨å†Œåˆ°å“ªä¸ªeureka-server</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:9001/eureka</span></span><br></pre></td></tr></table></figure><h4 id="4-2-4-4-ä¿®æ”¹-MemberConsumerApplication-java"><a href="#4-2-4-4-ä¿®æ”¹-MemberConsumerApplication-java" class="headerlink" title="4.2.4.4 ä¿®æ”¹ MemberConsumerApplication.java"></a>4.2.4.4 ä¿®æ”¹ MemberConsumerApplication.java</h4><p>æ·»åŠ æ³¨è§£ï¼š@EnableEurekaClient             å°†è¯¥ç¨‹åºæ ‡è¯†ä¸ºEureka-client</p><h4 id="4-2-4-5-å®Œæˆæµ‹è¯•"><a href="#4-2-4-5-å®Œæˆæµ‹è¯•" class="headerlink" title="4.2.4.5 å®Œæˆæµ‹è¯•"></a>4.2.4.5 å®Œæˆæµ‹è¯•</h4><h5 id="4-2-4-5-1-å¯åŠ¨-e-commerce-eureka-server-9001"><a href="#4-2-4-5-1-å¯åŠ¨-e-commerce-eureka-server-9001" class="headerlink" title="4.2.4.5.1 å¯åŠ¨ **e-commerce-eureka-server-9001 **"></a><strong>4.2.4.5.1</strong> å¯åŠ¨ **e-commerce-eureka-server-9001 **</h5><h5 id="4-2-4-5-2-å¯åŠ¨-member-service-consumer-80"><a href="#4-2-4-5-2-å¯åŠ¨-member-service-consumer-80" class="headerlink" title="4.2.4.5.2 å¯åŠ¨ **member-service-consumer-80 **"></a><strong>4.2.4.5.2</strong> å¯åŠ¨ **member-service-consumer-80 **</h5><h5 id="4-2-4-5-3-æµè§ˆå™¨-http-localhost-9001"><a href="#4-2-4-5-3-æµè§ˆå™¨-http-localhost-9001" class="headerlink" title="4.2.4.5.3 æµè§ˆå™¨**: http://localhost:9001**"></a><strong>4.2.4.5.3</strong> æµè§ˆå™¨**: <a href="http://localhost:9001/">http://localhost:9001</a>**</h5><h3 id="4-2-5-Service-Consumer-ã€Service-Provider-ã€EurekaServer-çš„ç»´æŠ¤æœºåˆ¶"><a href="#4-2-5-Service-Consumer-ã€Service-Provider-ã€EurekaServer-çš„ç»´æŠ¤æœºåˆ¶" class="headerlink" title="4.2.5 Service Consumer ã€Service Provider ã€EurekaServer çš„ç»´æŠ¤æœºåˆ¶"></a><strong>4.2.5 Service Consumer</strong> ã€<strong>Service Provider</strong> ã€<strong>EurekaServer</strong> çš„ç»´æŠ¤æœºåˆ¶</h3><p>EurekaServerä¸­ç»´æŠ¤äº†æœåŠ¡ä¿¡æ¯â€”â€”ä¸€ä¸ªé”®å€¼å¯¹ï¼škeyæ˜¯<strong>æœåŠ¡å</strong>ï¼Œvalueæ˜¯ <strong>è°ƒç”¨æœåŠ¡çš„åœ°å€</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230526170804321.png" alt="image-20230526170804321"></p><h3 id="4-2-6-Eurekaè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼"><a href="#4-2-6-Eurekaè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼" class="headerlink" title="4.2.6 Eurekaè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼"></a><strong>4.2.6 Eureka</strong>è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼</h3><h4 id="4-2-6-1-è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ç†è®º"><a href="#4-2-6-1-è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ç†è®º" class="headerlink" title="4.2.6.1 è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ç†è®º"></a>4.2.6.1 è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ç†è®º</h4><ol><li><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ <strong>Eureka å¯åŠ¨äº†è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼</strong></p></li><li><p>è‡ªæˆ‘ä¿è¯æœºåˆ¶&#x2F;æ¨¡å¼è¯´æ˜</p><ul><li><p>é»˜è®¤æƒ…æ³ä¸‹Eurekaclientå®šæ—¶å‘EurekaServerç«¯å‘é€å¿ƒè·³åŒ…ã€‚</p></li><li><p>å¦‚æœEurekaåœ¨serverç«¯åœ¨ä¸€å®šæ—¶é—´å†…ï¼ˆé»˜è®¤90ç§’ï¼‰æ²¡æœ‰æ”¶åˆ°Eurekaclientå‘é€å¿ƒè·³åŒ…ï¼Œä¾¿ä¼šç›´æ¥ä»æœåŠ¡æ³¨å†Œåˆ—è¡¨ä¸­å‰”é™¤è¯¥æœåŠ¡ã€‚</p></li><li><p>å¦‚æœEureka å¼€å¯äº†è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼&#x2F;æœºåˆ¶ï¼Œé‚£ä¹ˆåœ¨çŸ­æ—¶é—´ (90ç§’ä¸­ï¼‰å†…ä¸¢å¤±äº†å¤§é‡çš„æœåŠ¡å®ä¾‹å¿ƒè·³ï¼Œè¿™æ—¶å€™EurekaServerä¼šå¼€å¯è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œä¸ä¼šå‰”é™¤è¯¥æœåŠ¡ï¼ˆè¯¥ç°è±¡å¯èƒ½å‡ºç°åœ¨å¦‚æœç½‘ç»œä¸é€šæˆ–è€…é˜»é‘«) å› ä¸ºå®¢æˆ·ç«¯è¿˜èƒ½æ­£å¸¸å‘é€å¿ƒè·³ï¼Œåªæ˜¯ç½‘ç»œå»¶è¿Ÿé—®é¢˜ï¼Œè€Œä¿æŠ¤æœºåˆ¶æ˜¯ä¸ºäº†è§£å†³æ­¤é—®é¢˜è€Œäº§ç”Ÿçš„ã€‚</p></li></ul></li><li><p>è‡ªæˆ‘ä¿æŠ¤æ˜¯å±äº <strong>CAP</strong> é‡Œé¢çš„ AP åˆ†æ”¯ï¼Œ ä¿è¯é«˜å¯ç”¨å’Œåˆ†åŒºå®¹é”™æ€§ã€‚(capè§£è¯»ï¼š<a href="https://blog.csdn.net/wangliangluang/article/details/120626014">https://blog.csdn.net/wangliangluang/article/details/120626014</a>)</p></li><li><p>è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼æ˜¯â€”ç§<strong>åº”å¯¹ç½‘ç»œå¼‚å¸¸çš„å®‰å…¨ä¿æŠ¤æªæ–½</strong>ã€‚å®ƒçš„æ¶æ„å“²å­¦æ˜¯å®å¯åŒæ—¶ä¿ç•™æ‰€æœ‰å¾®æœåŠ¡(å¥åº·çš„å¾®æœåŠ¡å’Œä¸å¥åº·çš„å¾®æœåŠ¡éƒ½ä¼šä¿ç•™)ä¹Ÿä¸ç›²ç›®æ³¨é”€ä»»ä½•å¥åº·çš„å¾®æœ åŠ¡ã€‚ä½¿ç”¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œå¯ä»¥è®© Eureka é›†ç¾¤æ›´åŠ çš„å¥å£®ã€ç¨³å®šã€‚</p></li><li><p>æµ‹è¯•ï¼š</p><p>â€¦â€¦</p></li></ol><h2 id="4-3-æ­å»º-EurekaServer-é›†ç¾¤-å®ç°è´Ÿè½½å‡è¡¡-amp-æ•…éšœå®¹é”™"><a href="#4-3-æ­å»º-EurekaServer-é›†ç¾¤-å®ç°è´Ÿè½½å‡è¡¡-amp-æ•…éšœå®¹é”™" class="headerlink" title="4.3 æ­å»º EurekaServer é›†ç¾¤- å®ç°è´Ÿè½½å‡è¡¡&amp;æ•…éšœå®¹é”™"></a>4.3 æ­å»º EurekaServer é›†ç¾¤- å®ç°è´Ÿè½½å‡è¡¡&amp;æ•…éšœå®¹é”™</h2><h3 id="4-3-1-ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤-Eureka-Server"><a href="#4-3-1-ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤-Eureka-Server" class="headerlink" title="4.3.1 ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤ Eureka Server"></a><strong>4.3.1</strong> ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤ Eureka Server</h3><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230528115636389.png" alt="image-20230528115636389" style="zoom:50%;" /><ol><li><p>å¾®æœåŠ¡ RPC è¿œç¨‹æœåŠ¡è°ƒç”¨æœ€æ ¸å¿ƒçš„æ˜¯å®ç°é«˜å¯ç”¨</p></li><li><p>å¦‚æœæ³¨å†Œä¸­å¿ƒåªæœ‰1ä¸ªï¼Œå®ƒå‡ºæ•…éšœï¼Œä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡ç¯å¢ƒä¸å¯ç”¨</p></li><li><p>è§£å†³åŠæ³•ï¼šæ­å»º <strong>Eureka æ³¨å†Œä¸­å¿ƒé›†ç¾¤</strong>ï¼Œ<strong>å®ç°è´Ÿè½½å‡è¡¡+æ•…éšœå®¹é”™</strong></p></li></ol><h3 id="4-3-2éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#4-3-2éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="4.3.2éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£"></a>4.3.2éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230528120007909.png" alt="image-20230528120007909"></p><h3 id="4-3-3-æ­å»º-Eureka-Server-é›†ç¾¤"><a href="#4-3-3-æ­å»º-Eureka-Server-é›†ç¾¤" class="headerlink" title="4.3.3 æ­å»º Eureka Server é›†ç¾¤"></a><strong>4.3.3</strong> æ­å»º <strong>Eureka Server</strong> é›†ç¾¤</h3><h4 id="4-3-3-1-åˆ›å»º-e-commerce-eureka-server-9002-å¾®æœåŠ¡æ¨¡å—-ä½œä¸ºæ³¨å†Œä¸­å¿ƒ"><a href="#4-3-3-1-åˆ›å»º-e-commerce-eureka-server-9002-å¾®æœåŠ¡æ¨¡å—-ä½œä¸ºæ³¨å†Œä¸­å¿ƒ" class="headerlink" title="4.3.3.1 åˆ›å»º e-commerce-eureka-server-9002 å¾®æœåŠ¡æ¨¡å—[ä½œä¸ºæ³¨å†Œä¸­å¿ƒ]"></a>4.3.3.1 åˆ›å»º e-commerce-eureka-server-9002 å¾®æœåŠ¡æ¨¡å—[ä½œä¸ºæ³¨å†Œä¸­å¿ƒ]</h4><h5 id="4-3-3-1-1-åˆ›å»ºæ­¥éª¤å‚è€ƒ-e-commerce-eureka-server-9001"><a href="#4-3-3-1-1-åˆ›å»ºæ­¥éª¤å‚è€ƒ-e-commerce-eureka-server-9001" class="headerlink" title="4.3.3.1.1 åˆ›å»ºæ­¥éª¤å‚è€ƒ e-commerce-eureka-server-9001"></a><strong>4.3.3.1.1</strong> åˆ›å»ºæ­¥éª¤å‚è€ƒ <strong>e-commerce-eureka-server-9001</strong></h5><h5 id="4-3-3-1-2-ä¿®æ”¹-pom-xml-åŠ å…¥ä¾èµ–"><a href="#4-3-3-1-2-ä¿®æ”¹-pom-xml-åŠ å…¥ä¾èµ–" class="headerlink" title="4.3.3.1.2 ä¿®æ”¹ pom.xml , åŠ å…¥ä¾èµ–"></a><strong>4.3.3.1.2</strong> ä¿®æ”¹ <strong>pom.xml ,</strong> åŠ å…¥ä¾èµ–</h5><h5 id="4-3-3-1-3-åˆ›å»º-resources-x2F-application-yml"><a href="#4-3-3-1-3-åˆ›å»º-resources-x2F-application-yml" class="headerlink" title="4.3.3.1.3 åˆ›å»º resources&#x2F;application.yml"></a><strong>4.3.3.1.3</strong> åˆ›å»º <strong>resources&#x2F;application.yml</strong></h5><h5 id="4-3-3-1-4-åˆ›å»ºä¸»å¯åŠ¨ç±»-EurekaApplication9002-java"><a href="#4-3-3-1-4-åˆ›å»ºä¸»å¯åŠ¨ç±»-EurekaApplication9002-java" class="headerlink" title="4.3.3.1.4 åˆ›å»ºä¸»å¯åŠ¨ç±» EurekaApplication9002.java"></a><strong>4.3.3.1.4</strong> åˆ›å»ºä¸»å¯åŠ¨ç±» <strong>EurekaApplication9002.java</strong></h5><h4 id="4-3-3-2-ä¿®æ”¹-e-commerce-eureka-server-9001-å¾®æœåŠ¡æ¨¡å—"><a href="#4-3-3-2-ä¿®æ”¹-e-commerce-eureka-server-9001-å¾®æœåŠ¡æ¨¡å—" class="headerlink" title="4.3.3.2 ä¿®æ”¹ e-commerce-eureka-server-9001 å¾®æœåŠ¡æ¨¡å—"></a>4.3.3.2 ä¿®æ”¹ e-commerce-eureka-server-9001 å¾®æœåŠ¡æ¨¡å—</h4><h5 id="4-3-3-2-1-ä¿®æ”¹-resources-x2F-application-yml"><a href="#4-3-3-2-1-ä¿®æ”¹-resources-x2F-application-yml" class="headerlink" title="4.3.3.2.1 ä¿®æ”¹ resources&#x2F;application.yml"></a><strong>4.3.3.2.1</strong> ä¿®æ”¹ <strong>resources&#x2F;application.yml</strong></h5><h5 id="4-3-3-2-2-ä¿®æ”¹ä¸»å¯åŠ¨ç±»åä¸º-EurekaApplication9001-java"><a href="#4-3-3-2-2-ä¿®æ”¹ä¸»å¯åŠ¨ç±»åä¸º-EurekaApplication9001-java" class="headerlink" title="4.3.3.2.2 ä¿®æ”¹ä¸»å¯åŠ¨ç±»åä¸º EurekaApplication9001.java"></a><strong>4.3.3.2.2</strong> ä¿®æ”¹ä¸»å¯åŠ¨ç±»åä¸º <strong>EurekaApplication9001.java</strong></h5><h4 id="4-3-3-3-ä¿®æ”¹-hosts-æ–‡ä»¶"><a href="#4-3-3-3-ä¿®æ”¹-hosts-æ–‡ä»¶" class="headerlink" title="4.3.3.3 ä¿®æ”¹ hosts æ–‡ä»¶"></a>4.3.3.3 ä¿®æ”¹ hosts æ–‡ä»¶</h4><p>â€‹åŸŸåè½¬ipåœ°å€ï¼šå…ˆæ‰¾æœ¬æœºçš„hostæ–‡ä»¶ï¼Œhostsæ–‡ä»¶ä¸­æ²¡æœ‰æ‰å»DNSæœåŠ¡å™¨å¯»æ‰¾ï¼Œ</p><p>â€‹ç°åœ¨æˆ‘ä»¬éœ€è¦è®¿é—®eureka9001.comè¿™æ ·çš„å½¢å¼ï¼Œå°±éœ€è¦è‡ªè¡Œåœ¨æœ¬æœºçš„hostsæ–‡ä»¶æ·»åŠ é”®å€¼å¯¹å®ç°åŸŸå-&gt;ip</p><p>&#x2F;private&#x2F;etc&#x2F;hostså¤åˆ¶å‡ºæ¥ï¼Œä¿®æ”¹ï¼Œè¦†ç›–åŸæ¥çš„æ–‡ä»¶å³å¯å®Œæˆä¿®æ”¹</p><p>â€‹åœ¨hostsæ–‡ä»¶ä¸­æ·»åŠ å†…å®¹ï¼š</p><p>â€‹<strong>#eureka</strong> ä¸»æœºåå’Œ <strong>ip</strong> æ˜ å°„ </p><p>â€‹**127.0.0.1 eureka9001.com **</p><p>â€‹<strong>127.0.0.1 eureka9002.com</strong></p><h4 id="4-3-3-4-å®Œæˆæµ‹è¯•"><a href="#4-3-3-4-å®Œæˆæµ‹è¯•" class="headerlink" title="4.3.3.4 å®Œæˆæµ‹è¯•"></a>4.3.3.4 å®Œæˆæµ‹è¯•</h4><h5 id="4-3-3-4-1-å¯åŠ¨-e-commerce-eureka-server-9001"><a href="#4-3-3-4-1-å¯åŠ¨-e-commerce-eureka-server-9001" class="headerlink" title="4.3.3.4.1 å¯åŠ¨ **e-commerce-eureka-server-9001"></a><strong>4.3.3.4.1</strong> å¯åŠ¨ **e-commerce-eureka-server-9001</h5><h5 id="4-3-3-4-2-å¯åŠ¨-e-commerce-eureka-server-9002"><a href="#4-3-3-4-2-å¯åŠ¨-e-commerce-eureka-server-9002" class="headerlink" title="4.3.3.4.2** å¯åŠ¨ **e-commerce-eureka-server-9002"></a>4.3.3.4.2** å¯åŠ¨ **e-commerce-eureka-server-9002</h5><h5 id="4-3-3-4-3-æµè§ˆå™¨-http-eureka9001-com-9001-æµè§ˆå™¨-http-eureka9002-com-9002"><a href="#4-3-3-4-3-æµè§ˆå™¨-http-eureka9001-com-9001-æµè§ˆå™¨-http-eureka9002-com-9002" class="headerlink" title="4.3.3.4.3** æµè§ˆå™¨**: http://eureka9001.com:9001** æµè§ˆå™¨**: http://eureka9002.com:9002**"></a>4.3.3.4.3** æµè§ˆå™¨**: <a href="http://eureka9001.com:9001/">http://eureka9001.com:9001</a>** æµè§ˆå™¨**: <a href="http://eureka9002.com:9002/">http://eureka9002.com:9002</a>**</h5><h4 id="4-3-3-5-å°†-member-service-provider-10000-æ³¨å†Œåˆ°-EurekaServer-é›†ç¾¤-ç›®å‰-2-å°"><a href="#4-3-3-5-å°†-member-service-provider-10000-æ³¨å†Œåˆ°-EurekaServer-é›†ç¾¤-ç›®å‰-2-å°" class="headerlink" title="4.3.3.5 å°† member-service-provider-10000 æ³¨å†Œåˆ° EurekaServer é›†ç¾¤(ç›®å‰ 2 å°)"></a>4.3.3.5 å°† member-service-provider-10000 æ³¨å†Œåˆ° EurekaServer é›†ç¾¤(ç›®å‰ 2 å°)</h4><h5 id="4-3-3-5-1-ä¿®æ”¹-resources-x2F-application-yml"><a href="#4-3-3-5-1-ä¿®æ”¹-resources-x2F-application-yml" class="headerlink" title="4.3.3.5.1 ä¿®æ”¹ resources&#x2F;application.yml"></a><strong>4.3.3.5.1</strong> ä¿®æ”¹ <strong>resources&#x2F;application.yml</strong></h5><p>â€˜â€™â€™</p><p>defaultZone: <a href="http://eureka9001.com:9001/eureka">http://eureka9001.com:9001/eureka</a>, <a href="http://eureka9002.com:9002/eureka">http://eureka9002.com:9002/eureka</a></p><p>*#*è¡¨ç¤ºå°†è‡ªå·±æ³¨å†Œåˆ°å“ªä¸ª <em>eurekaServer</em></p><p>å°†æœ¬å¾®æœåŠ¡æ³¨å†Œåˆ°å¤šä¸ª <em>eurekaServer,</em> ä½¿ç”¨é€—å·éš”å¼€</p><p>â€˜â€™â€™</p><h5 id="4-3-3-5-2-å®Œæˆæµ‹è¯•"><a href="#4-3-3-5-2-å®Œæˆæµ‹è¯•" class="headerlink" title="4.3.3.5.2 å®Œæˆæµ‹è¯•"></a><strong>4.3.3.5.2</strong> å®Œæˆæµ‹è¯•</h5><p><strong>1.</strong> <strong>å¯åŠ¨</strong> <strong>e-commerce-eureka-server-9001</strong> <strong>å’Œ</strong> <strong>e-commerce-eureka-server-9002</strong></p><p><strong>2. å¯åŠ¨</strong> <strong>member-service-provider-10000<br>3.</strong> <strong>è§‚å¯Ÿ</strong> <strong>member-service-provider-10000</strong> <strong>æ˜¯å¦æ³¨å†Œåˆ°</strong> <strong>Eureka</strong> <strong>é›†ç¾¤</strong>å‰ <strong>2</strong> <strong>å°</strong>)</p><h4 id="4-3-3-6-å°†-member-service-consumer-80-æ³¨å†Œåˆ°-EurekaServer-é›†ç¾¤-ç›®å‰-2-å°"><a href="#4-3-3-6-å°†-member-service-consumer-80-æ³¨å†Œåˆ°-EurekaServer-é›†ç¾¤-ç›®å‰-2-å°" class="headerlink" title="4.3.3.6 å°† member-service-consumer-80 æ³¨å†Œåˆ° EurekaServer é›†ç¾¤(ç›®å‰ 2 å°)"></a>4.3.3.6 å°† member-service-consumer-80 æ³¨å†Œåˆ° EurekaServer é›†ç¾¤(ç›®å‰ 2 å°)</h4><h5 id="4-3-3-6-1-ä¿®æ”¹-resources-x2F-application-yml"><a href="#4-3-3-6-1-ä¿®æ”¹-resources-x2F-application-yml" class="headerlink" title="4.3.3.6.1 ä¿®æ”¹ resources&#x2F;application.yml"></a><strong>4.3.3.6.1</strong> ä¿®æ”¹ <strong>resources&#x2F;application.yml</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaultZone: http://eureka9001.com:9001/eureka,http://eureka9002.com:9002/eureka</span><br></pre></td></tr></table></figure><h5 id="4-3-3-6-2-å®Œæˆæµ‹è¯•"><a href="#4-3-3-6-2-å®Œæˆæµ‹è¯•" class="headerlink" title="4.3.3.6.2 å®Œæˆæµ‹è¯•"></a><strong>4.3.3.6.2</strong> å®Œæˆæµ‹è¯•</h5><p><strong>1.</strong> <strong>å¯åŠ¨</strong> <strong>e-commerce-eureka-server-9001</strong> <strong>å’Œ</strong> <strong>e-commerce-eureka-server-9002</strong><br><strong>2.</strong> <strong>å¯åŠ¨</strong> <strong>member-service-consumer-80<br>3.</strong> <strong>è§‚å¯Ÿ</strong> <strong>member-service-consumer-80</strong> <strong>æ˜¯å¦æ³¨å†Œåˆ°</strong> <strong>Eureka</strong> <strong>é›†ç¾¤</strong>(<strong>ç›®å‰</strong> <strong>2</strong> <strong>å°</strong>)</p><h3 id="4-3-4-æ­å»ºä¼šå‘˜ä¸­å¿ƒæœåŠ¡æä¾›æ–¹-é›†ç¾¤"><a href="#4-3-4-æ­å»ºä¼šå‘˜ä¸­å¿ƒæœåŠ¡æä¾›æ–¹-é›†ç¾¤" class="headerlink" title="4.3.4 æ­å»ºä¼šå‘˜ä¸­å¿ƒæœåŠ¡æä¾›æ–¹**-**é›†ç¾¤"></a><strong>4.3.4</strong> æ­å»ºä¼šå‘˜ä¸­å¿ƒæœåŠ¡æä¾›æ–¹**-**é›†ç¾¤</h3><h4 id="4-3-4-1-æ¶æ„ç¤ºæ„å›¾"><a href="#4-3-4-1-æ¶æ„ç¤ºæ„å›¾" class="headerlink" title="4.3.4.1 æ¶æ„ç¤ºæ„å›¾"></a>4.3.4.1 æ¶æ„ç¤ºæ„å›¾</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230528140357541.png" alt="image-20230528140357541"></p><h4 id="4-3-4-2-åˆ›å»ºmember-service-provider-10002"><a href="#4-3-4-2-åˆ›å»ºmember-service-provider-10002" class="headerlink" title="4.3.4.2 åˆ›å»ºmember-service-provider-10002"></a>4.3.4.2 åˆ›å»ºmember-service-provider-10002</h4><p>1.å‚è€ƒmember-service-provider-10000 æ¥åˆ›å»º member-service-provider-10002 å³å¯</p><p>2.åˆ›å»ºå¥½åï¼Œä½¿ç”¨memberservice-provider-10000 çš„æº ç å’Œé…ç½®æ›¿æ›member-service-provider-10002 ç”Ÿæˆçš„ä»£ç ï¼ˆä¸è¦åˆ°ç£ç›˜æ•´ä½“æ‹·è´ï¼Œä¼šå‡ºç°å…³è”åˆ° member-service-provider-10000 çš„é—®é¢˜ï¼Œå¾ˆéº»çƒ¦ï¼Œå¯ä»¥åˆ›å»ºå¥½æ–°é¡¹ç›®çš„åŒ…ï¼Œç„¶åå†æ‹·è´å¯¹åº”åŒ…ä¸‹çš„æ–‡ä»¶ï¼Œå°±ä¸ä¼šå‡ºå‘é¢˜ï¼‰</p><p>3.æé†’ï¼Œæ‹·è´æ—¶ä¸è¦å¿˜è®°æ‹·è´ resources&#x2F;mapper&#x2F;Mem berMapper:xml è¿™äº›xaos.xml æ–‡ä»¶</p><h4 id="4-3-4-3-åˆ›å»º-resources-x2F-application-yml"><a href="#4-3-4-3-åˆ›å»º-resources-x2F-application-yml" class="headerlink" title="4.3.4.3 åˆ›å»º resources&#x2F;application.yml"></a>4.3.4.3 åˆ›å»º resources&#x2F;application.yml</h4><p><strong>1.</strong> åˆ›å»ºå¥½ <strong>application.yml</strong></p><p><strong>2.</strong> ä» <strong>member-service-provider-10000</strong> æ‹·è´ <strong>application.yml</strong> çš„å†…å®¹</p><p><strong>3.</strong> ä¿®æ”¹ç«¯å£å·å³å¯</p><h4 id="4-3-4-4-ä¿®æ”¹ä¸»å¯åŠ¨ç±»å"><a href="#4-3-4-4-ä¿®æ”¹ä¸»å¯åŠ¨ç±»å" class="headerlink" title="4.3.4.4 ä¿®æ”¹ä¸»å¯åŠ¨ç±»å"></a>4.3.4.4 ä¿®æ”¹ä¸»å¯åŠ¨ç±»å</h4><p><strong>1.</strong> ä¿®æ”¹ <strong>member-service-provider-10000</strong> çš„ä¸»å¯åŠ¨ç±»ä¸º <strong>MemberProviderApplication10000</strong></p><p><strong>2.</strong> <strong>ä¿®æ”¹</strong> <strong>member-service-provider-10002</strong> <strong>çš„ä¸»å¯åŠ¨ç±»ä¸º</strong> <strong>MemberProviderApplication10002</strong></p><h4 id="4-3-4-5-å®Œæˆæµ‹è¯•"><a href="#4-3-4-5-å®Œæˆæµ‹è¯•" class="headerlink" title="4.3.4.5 å®Œæˆæµ‹è¯•"></a>4.3.4.5 å®Œæˆæµ‹è¯•</h4><p>â€¦â€¦</p><h4 id="4-3-4-6-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#4-3-4-6-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="4.3.4.6 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>4.3.4.6 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><ol><li>å› ä¸º member-service-provider-10000 å’Œ mem ber-service-provider-10002 ä½œä¸ºä¸€ä¸ªé›†ç¾¤æä¾›æœåŠ¡ï¼Œå› æ­¤éœ€è¦å°‡ spring.application.name è¿›è¡Œç»Ÿä¸€ã€‚</li><li>è¿™æ ·æ¶ˆè´¹æ–¹é€šè¿‡ç»Ÿä¸€çš„åˆ«åè¿›è¡Œè´Ÿè½½å‡è¡¡è°ƒç”¨ã€‚</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230528142117680.png" alt="image-20230528142117680" style="zoom:33%;" /><p>å°†ç›¸åŒæœåŠ¡çš„æä¾›æ–¹å¯¹å¤–æš´éœ²çš„åç§°è®¾ç½®ä¸ºç›¸åŒçš„ï¼Œè¿™æ ·å°±æ–¹ä¾¿ç®¡ç†äº†ã€‚</p><h3 id="4-3-5-é…ç½®æœåŠ¡æ¶ˆè´¹ç«¯-member-service-consumer-80-ä½¿ç”¨ä¼šå‘˜ä¸­å¿ƒæœåŠ¡é›†ç¾¤"><a href="#4-3-5-é…ç½®æœåŠ¡æ¶ˆè´¹ç«¯-member-service-consumer-80-ä½¿ç”¨ä¼šå‘˜ä¸­å¿ƒæœåŠ¡é›†ç¾¤" class="headerlink" title="4.3.5 é…ç½®æœåŠ¡æ¶ˆè´¹ç«¯ member-service-consumer-80 ä½¿ç”¨ä¼šå‘˜ä¸­å¿ƒæœåŠ¡é›†ç¾¤"></a><strong>4.3.5</strong> é…ç½®æœåŠ¡æ¶ˆè´¹ç«¯ <strong>member-service-consumer-80</strong> ä½¿ç”¨ä¼šå‘˜ä¸­å¿ƒæœåŠ¡é›†ç¾¤</h3><h4 id="4-3-5-1-æ¶æ„å›¾"><a href="#4-3-5-1-æ¶æ„å›¾" class="headerlink" title="4.3.5.1 æ¶æ„å›¾"></a>4.3.5.1 æ¶æ„å›¾</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230528143413873.png" alt="image-20230528143413873"></p><h4 id="4-3-5-2-ä¿®æ”¹-MemberConsumerController-java"><a href="#4-3-5-2-ä¿®æ”¹-MemberConsumerController-java" class="headerlink" title="4.3.5.2 ä¿®æ”¹ MemberConsumerController.java"></a>4.3.5.2 ä¿®æ”¹ MemberConsumerController.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MEMBER_SERVICE_PROVIDER_URL</span> <span class="operator">=</span> <span class="string">&quot;http://member-service-provider&quot;</span>;</span><br><span class="line"><span class="comment">//member-service-providerä¸ºæœåŠ¡æä¾›é›†ç¾¤å¯¹å¤–æš´éœ²çš„ç»Ÿä¸€åç§°</span></span><br></pre></td></tr></table></figure><h4 id="4-3-5-3-ä¿®æ”¹-CustomizationBean-java"><a href="#4-3-5-3-ä¿®æ”¹-CustomizationBean-java" class="headerlink" title="4.3.5.3 ä¿®æ”¹ CustomizationBean.java"></a>4.3.5.3 ä¿®æ”¹ CustomizationBean.java</h4><p>â€‹ç»™ RestTemplateæ·»åŠ æ³¨è§£ï¼š**@LoadBalanced**</p><p>â€‹ç›®çš„æ˜¯ï¼šèµ‹äºˆ <em>RestTemplate</em> è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›</p><h4 id="4-3-5-5-å®Œæˆæµ‹è¯•"><a href="#4-3-5-5-å®Œæˆæµ‹è¯•" class="headerlink" title="4.3.5.5 å®Œæˆæµ‹è¯•"></a>4.3.5.5 å®Œæˆæµ‹è¯•</h4><h5 id="4-3-5-5-1-å¯åŠ¨-eureka-server-é›†ç¾¤-ç›®å‰-2-å°"><a href="#4-3-5-5-1-å¯åŠ¨-eureka-server-é›†ç¾¤-ç›®å‰-2-å°" class="headerlink" title="4.3.5.5.1 å¯åŠ¨ eureka server é›†ç¾¤**(ç›®å‰ 2 å°)**"></a>4.3.5.5.1 å¯åŠ¨ <strong>eureka server</strong> é›†ç¾¤**(<strong>ç›®å‰ <strong>2</strong> å°</strong>)**</h5><h5 id="4-3-5-5-2-å¯åŠ¨-member-service-provider-10000"><a href="#4-3-5-5-2-å¯åŠ¨-member-service-provider-10000" class="headerlink" title="4.3.5.5.2 å¯åŠ¨ member-service-provider-10000"></a>4.3.5.5.2 å¯åŠ¨ <strong>member-service-provider-10000</strong></h5><h5 id="4-3-5-5-3-å¯åŠ¨-member-service-provider-10002"><a href="#4-3-5-5-3-å¯åŠ¨-member-service-provider-10002" class="headerlink" title="4.3.5.5.3 å¯åŠ¨ member-service-provider-10002"></a>4.3.5.5.3 å¯åŠ¨ <strong>member-service-provider-10002</strong></h5><h5 id="4-3-5-5-4ä¸æ€¥ï¼Œå…ˆæµ‹è¯•-http-localhost-10000-member-get-1-å’Œ-http-localhost-10002-member-get-1"><a href="#4-3-5-5-4ä¸æ€¥ï¼Œå…ˆæµ‹è¯•-http-localhost-10000-member-get-1-å’Œ-http-localhost-10002-member-get-1" class="headerlink" title="4.3.5.5.4ä¸æ€¥ï¼Œå…ˆæµ‹è¯• : http://localhost:10000/member/get/1 å’Œ http://localhost:10002/member/get/1"></a><strong>4.3.5.5.4</strong>ä¸æ€¥ï¼Œå…ˆæµ‹è¯• <strong>: <a href="http://localhost:10000/member/get/1">http://localhost:10000/member/get/1</a></strong> å’Œ <strong><a href="http://localhost:10002/member/get/1">http://localhost:10002/member/get/1</a></strong></h5><p>å…ˆçœ‹çœ‹ç›´æ¥ä½¿ç”¨æœåŠ¡æä¾›æ–¹æ—¶æœ‰æ²¡æœ‰é—®é¢˜ï¼Œæ²¡é—®é¢˜å†è¿›è¡Œä¸‹ä¸€æ­¥æµ‹è¯•(æ–¹ä¾¿æ’é”™ï¼)</p><h5 id="4-3-5-5-5-å¯åŠ¨-member-service-consumer-80"><a href="#4-3-5-5-5-å¯åŠ¨-member-service-consumer-80" class="headerlink" title="4.3.5.5.5 å¯åŠ¨ member-service-consumer-80"></a><strong>4.3.5.5.5</strong> å¯åŠ¨ <strong>member-service-consumer-80</strong></h5><h5 id="4-3-5-5-6-æµè§ˆå™¨è®¿é—®-http-localhost-member-consumer-get-1"><a href="#4-3-5-5-6-æµè§ˆå™¨è®¿é—®-http-localhost-member-consumer-get-1" class="headerlink" title="4.3.5.5.6 æµè§ˆå™¨è®¿é—®**: http://localhost/member/consumer/get/1**"></a><strong>4.3.5.5.6</strong> æµè§ˆå™¨è®¿é—®**: <a href="http://localhost/member/consumer/get/1">http://localhost/member/consumer/get/1</a>**</h5><h4 id="4-3-5-6-äº¤æ›¿è®¿é—®memberæœåŠ¡è¯´æ˜"><a href="#4-3-5-6-äº¤æ›¿è®¿é—®memberæœåŠ¡è¯´æ˜" class="headerlink" title="4.3.5.6 äº¤æ›¿è®¿é—®memberæœåŠ¡è¯´æ˜:"></a>4.3.5.6 äº¤æ›¿è®¿é—®memberæœåŠ¡è¯´æ˜:</h4><ol><li>æ³¨è§£@LoadBalanced åº•å±‚æ˜¯Ribbonæ”¯æŒç®—æ³•</li><li>2.Ribbonå’ŒEureka æ•´åˆåconsumer ç›´æ¥è°ƒç”¨æœåŠ¡è€Œä¸ç”¨å†å…³å¿ƒåœ°å€å’Œç«¯å£å·ï¼Œä¸”è¯¥æœåŠ¡è¿˜æœ‰è´Ÿè½½åŠŸèƒ½</li></ol><h3 id="4-3-6-è·å–-Eureka-Server-æœåŠ¡æ³¨å†Œä¿¡æ¯-DiscoveryClient"><a href="#4-3-6-è·å–-Eureka-Server-æœåŠ¡æ³¨å†Œä¿¡æ¯-DiscoveryClient" class="headerlink" title="4.3.6 è·å– Eureka Server æœåŠ¡æ³¨å†Œä¿¡æ¯ -DiscoveryClient"></a><strong>4.3.6</strong> è·å– <strong>Eureka Server</strong> æœåŠ¡æ³¨å†Œä¿¡æ¯ <strong>-DiscoveryClient</strong></h3><h4 id="4-3-6-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#4-3-6-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="4.3.6.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>4.3.6.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>1.</strong> éœ€æ±‚åˆ†æç¤ºæ„å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230528150507261.png" alt="image-20230528150507261"></p><p><strong>2.</strong> <strong>è¿™é‡Œæˆ‘ä»¬ä»¥æœåŠ¡æ¶ˆè´¹æ–¹</strong>ï¼Œ <strong>å»è·å–</strong> <strong>Eureka Server</strong> <strong>çš„æœåŠ¡æ³¨å†Œä¿¡æ¯ä¸ºä¾‹è®²è§£</strong></p><p><strong>3.</strong> <strong>å½“ç„¶ä¹Ÿå¯ä»¥åœ¨æœåŠ¡æä¾›æ–¹è·å–</strong> <strong>Eureka Server</strong> <strong>çš„æœåŠ¡æ³¨å†Œä¿¡æ¯</strong></p><h4 id="4-3-6-2-ä»£ç å®ç°"><a href="#4-3-6-2-ä»£ç å®ç°" class="headerlink" title="4.3.6.2 ä»£ç å®ç°"></a>4.3.6.2 ä»£ç å®ç°</h4><ol><li><strong>æ‰€åœ¨æ¨¡å—  member-service-consumer-80</strong></li><li><strong>ä¿®æ”¹</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberConsumerController.java</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è£…é…DiscoveryClient</span></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> DiscoveryClient discoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/member/consumer/discovery&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">discovery</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;String&gt; services = discoveryClient.getServices();</span><br><span class="line">    <span class="keyword">for</span> (String service : services)&#123;</span><br><span class="line">        log.info(<span class="string">&quot;æœåŠ¡å=&#123;&#125;&quot;</span>,service);</span><br><span class="line">        List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(service);</span><br><span class="line">        <span class="keyword">for</span> (ServiceInstance instance : instances)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;id=&#123;&#125;,host=&#123;&#125;,port=&#123;&#125;,uri=&#123;&#125;&quot;</span>,instance.getServiceId(),instance.getHost(),instance.getPort(),instance.getUri());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> discoveryClient;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3.</strong> <strong>è¿™é‡Œä¿®æ”¹ä¸»å¯åŠ¨ç±»</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;MemberConsumerApplication.java</strong></p><p>æ·»åŠ æ³¨è§£ï¼š@EnableDiscoveryClient</p><h4 id="4-3-6-3-æµ‹è¯•"><a href="#4-3-6-3-æµ‹è¯•" class="headerlink" title="4.3.6.3 æµ‹è¯•"></a>4.3.6.3 æµ‹è¯•</h4><p><strong>1.</strong> <strong>é‡å¯</strong> <strong>member-service-consumer-80</strong></p><p><strong>2.</strong> <strong>æµè§ˆå™¨è¾“å‡º</strong> <strong><a href="http://localhost/member/consumer/discovery">http://localhost/member/consumer/discovery</a></strong></p><h4 id="4-3-6-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"><a href="#4-3-6-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜" class="headerlink" title="4.3.6.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"></a>4.3.6.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜</h4><ol><li><p>åœ¨å¼•å…¥ <strong>DiscoveryClient</strong> æ—¶ï¼Œä¸è¦å¼•å…¥é”™è¯¯çš„åŒ…ï¼š</p><p>æ­£ç¡®çš„åŒ…**:** <strong>import</strong> <strong>org.springframework.cloud.client.discovery.DiscoveryClient</strong>;</p><p>é”™è¯¯çš„åŒ…**:** <strong>import</strong> <strong>com.netflix.discovery.DiscoveryClient</strong>;</p></li></ol><h2 id="4-4-Eurekaåç»­è¯´æ˜"><a href="#4-4-Eurekaåç»­è¯´æ˜" class="headerlink" title="4.4 Eurekaåç»­è¯´æ˜"></a>4.4 Eurekaåç»­è¯´æ˜</h2><p><strong>1. Eureka</strong> åœæ›´è¯´æ˜**: <a href="https://github.com/Netflix/eureka/wiki">https://github.com/Netflix/eureka/wiki</a>**</p><p><strong>2.</strong> <strong>å¯¹äºä¸€äº›æ—©æœŸä½¿ç”¨</strong> <strong>Eureka</strong> <strong>é¡¹ç›®ï¼ŒæŒæ¡è€å¸ˆè®²è§£æŠ€æœ¯åŸºæœ¬å¯ä»¥åº”ä»˜äº†</strong>(<strong>è¿™ä¹Ÿæ˜¯è€å¸ˆä¸ºä»€ä¹ˆè¿˜ è¦è®²</strong> <strong>Eureka</strong> <strong>çš„åŸå› </strong>)</p><p><strong>3.ç›®å‰æ›¿ä»£ Eureka åšæœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼Œå‡è¡¡è´Ÿè½½çš„ æœ€ä½³ç»„ä»¶æ˜¯ spring Cloud Alibaba Nacosï¼Œåé¢è€å¸ˆä¼šé‡ç‚¹è®²è§£ã€‚</strong></p><p><strong>4.è™½ç„¶Eureka åœæ›´ï¼Œç›®å‰ç”¨çš„ä¸å¤šï¼Œä½†æ˜¯å®ƒçš„æœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼Œå‡è¡¡è´Ÿè½½çš„æ€æƒ³æ˜¯ä¼˜å…ˆçš„ï¼Œæœ‰äº†Eureka çš„åŸºç¡€ï¼Œæˆ‘ä»¬å­¦ä¹  Spring Cloud Alibaba Nacos ä¼šè½»æ¾å¾ˆå¤š</strong></p><h1 id="5-SpringCloudRibbonæœåŠ¡è´Ÿè½½å‡è¡¡"><a href="#5-SpringCloudRibbonæœåŠ¡è´Ÿè½½å‡è¡¡" class="headerlink" title="5 SpringCloudRibbonæœåŠ¡è´Ÿè½½å‡è¡¡"></a><strong>5 SpringCloudRibbon</strong>æœåŠ¡è´Ÿè½½å‡è¡¡</h1><h2 id="5-1-Ribbonä»‹ç»"><a href="#5-1-Ribbonä»‹ç»" class="headerlink" title="5.1 Ribbonä»‹ç»"></a>5.1 Ribbonä»‹ç»</h2><h3 id="5-1-1-Ribbonæ˜¯ä»€ä¹ˆ"><a href="#5-1-1-Ribbonæ˜¯ä»€ä¹ˆ" class="headerlink" title="5.1.1 Ribbonæ˜¯ä»€ä¹ˆ"></a><strong>5.1.1 Ribbon</strong>æ˜¯ä»€ä¹ˆ</h3><ol><li><p>Spring Cloud Ribbon æ˜¯<strong>åŸºäº Netflix Ribbon</strong> å®ç°çš„ä¸€å¥—**<u>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</u>**çš„å·¥å…·ã€‚</p></li><li><p>Ribbon ä¸»è¦åŠŸèƒ½æ˜¯<strong>æä¾›å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨</strong></p></li><li><p>Ribbon å®¢æˆ·ç«¯ç»„ä»¶æä¾›ä¸€ç³»åˆ—å®Œå–„çš„é…ç½®é¡¹å¦‚è¿æ¥è¶…æ—¶ï¼Œé‡è¯•ç­‰ã€‚</p></li><li><p>Ribbon ä¼šåŸºäºæŸç§è§„åˆ™ï¼ˆå¦‚ç®€å•è½®è¯¢ï¼Œéšæœºè¿æ¥ç­‰ï¼‰å»è¿æ¥æŒ‡å®šæœåŠ¡</p></li><li><p>ç¨‹åºå‘˜å¾ˆå®¹æ˜“ä½¿ç”¨ Ribbon çš„è´Ÿè½½å‡è¡¡ç®—æ³•å®ç°è´Ÿè½½å‡è¡¡</p></li><li><p>ä¸€å¥è¯ï¼šRibbonï¼š <strong>è´Ÿè½½å‡è¡¡+RestTemplateè°ƒç”¨</strong></p></li></ol><h3 id="5-1-2-å®˜ç½‘"><a href="#5-1-2-å®˜ç½‘" class="headerlink" title="5.1.2 å®˜ç½‘"></a><strong>5.1.2</strong> å®˜ç½‘</h3><h4 id="5-1-2-1-https-github-com-Netflix-ribbon"><a href="#5-1-2-1-https-github-com-Netflix-ribbon" class="headerlink" title="5.1.2.1 https://github.com/Netflix/ribbon"></a>5.1.2.1 <a href="https://github.com/Netflix/ribbon">https://github.com/Netflix/ribbon</a></h4><h3 id="5-1-3-Ribbonè¿›å…¥ç»´æŠ¤çŠ¶æ€"><a href="#5-1-3-Ribbonè¿›å…¥ç»´æŠ¤çŠ¶æ€" class="headerlink" title="5.1.3 Ribbonè¿›å…¥ç»´æŠ¤çŠ¶æ€"></a><strong>5.1.3 Ribbon</strong>è¿›å…¥ç»´æŠ¤çŠ¶æ€</h3><p><strong>Ribbon ç›®å‰è¿›å…¥ç»´æŠ¤æ¨¡å¼, æœªæ¥æ›¿æ¢æ–¹æ¡ˆ æ˜¯ <u>Spring Cloud LoadBalancer</u></strong></p><h3 id="5-1-4-LB-Load-Balance"><a href="#5-1-4-LB-Load-Balance" class="headerlink" title="5.1.4 LB(Load Balance)"></a>5.1.4 LB(Load Balance)</h3><h4 id="5-1-4-1-LBåˆ†ç±»"><a href="#5-1-4-1-LBåˆ†ç±»" class="headerlink" title="5.1.4.1 LBåˆ†ç±»"></a>5.1.4.1 LBåˆ†ç±»</h4><h5 id="é›†ä¸­å¼-LB"><a href="#é›†ä¸­å¼-LB" class="headerlink" title="é›†ä¸­å¼ LB"></a>é›†ä¸­å¼ LB</h5><ul><li><p>å³åœ¨æœåŠ¡çš„æ¶ˆè´¹æ–¹å’Œæä¾›æ–¹ä¹‹é—´ä½¿ç”¨ç‹¬ç«‹çš„LBè®¾æ–½ï¼ˆå¯ä»¥æ˜¯ç¡¬ä»¶ï¼Œå¦‚F5ï¼Œä¹Ÿå¯ä»¥æ˜¯è½¯ä»¶ï¼Œå¦‚Nginx)ï¼Œç”±è¯¥è®¾æ–½è´Ÿè´£æŠŠè®¿å‘è¯·æ±‚é€šè¿‡æŸç§ç­–ç•¥è½¬å‘è‡³æœåŠ¡çš„æä¾›æ–¹ï¼š</p></li><li><p>LB(Load Balance è´Ÿè½½å‡è¡¡ï¼‰</p></li></ul><h5 id="è¿›ç¨‹å†…-LB"><a href="#è¿›ç¨‹å†…-LB" class="headerlink" title="è¿›ç¨‹å†… LB"></a>è¿›ç¨‹å†… LB</h5><ul><li><p>å°†LBé€»è¾‘é›†æˆåˆ°æ¶ˆè´¹æ–¹ï¼Œæ¶ˆè´¹æ–¹ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·çŸ¥æœ‰å“ªäº›æœåŠ¡åœ°å€å¯ç”¨ï¼Œç„¶åå†ä»è¿™äº›åœ°å€ä¸­é€‰æ‹©å‡ºä¸€ä¸ªåˆé€‚çš„æœåŠ¡åœ°å€ã€‚</p></li><li><p>Ribbonå°±å±äºè¿›ç¨‹å†…LBï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç±»åº“ï¼Œé›†æˆäºæ¶ˆè´¹æ–¹è¿›ç¨‹ï¼Œæ¶ˆè´¹æ–¹é€šè¿‡å®ƒæ¥è·å–åˆ°æœåŠ¡æä¾›æ–¹çš„åœ°å€ã€‚</p></li></ul><h4 id="5-1-4-2-å®ä¾‹-å‰é¢-member-consumer-è½®è¯¢è´Ÿè½½è®¿é—®-10000-x2F-10002-åº•å±‚å°±æ˜¯-Ribbon-é»˜è®¤çš„è½®è¯¢è´Ÿè½½ç®—æ³•"><a href="#5-1-4-2-å®ä¾‹-å‰é¢-member-consumer-è½®è¯¢è´Ÿè½½è®¿é—®-10000-x2F-10002-åº•å±‚å°±æ˜¯-Ribbon-é»˜è®¤çš„è½®è¯¢è´Ÿè½½ç®—æ³•" class="headerlink" title="5.1.4.2 å®ä¾‹-å‰é¢ member-consumer è½®è¯¢è´Ÿè½½è®¿é—® 10000&#x2F;10002 åº•å±‚å°±æ˜¯ Ribbon é»˜è®¤çš„è½®è¯¢è´Ÿè½½ç®—æ³•"></a>5.1.4.2 å®ä¾‹-å‰é¢ member-consumer è½®è¯¢è´Ÿè½½è®¿é—® 10000&#x2F;10002 åº•å±‚å°±æ˜¯ Ribbon é»˜è®¤çš„è½®è¯¢è´Ÿè½½ç®—æ³•</h4><h2 id="5-2-RibbonåŸç†"><a href="#5-2-RibbonåŸç†" class="headerlink" title="5.2 RibbonåŸç†"></a>5.2 RibbonåŸç†</h2><h3 id="5-2-1-Ribbonæ¶æ„å›¾-amp-æœºåˆ¶"><a href="#5-2-1-Ribbonæ¶æ„å›¾-amp-æœºåˆ¶" class="headerlink" title="5.2.1 Ribbonæ¶æ„å›¾**&amp;**æœºåˆ¶"></a><strong>5.2.1 Ribbon</strong>æ¶æ„å›¾**&amp;**æœºåˆ¶</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230529203201726.png" alt="image-20230529203201726">Ribbon æœºåˆ¶</p><ol><li><strong>å…ˆé€‰æ‹© EurekaServer</strong>ï¼Œå®ƒ<u>ä¼˜å…ˆé€‰æ‹©åœ¨åŒä¸€ä¸ªåŒºåŸŸå†…è´Ÿè½½è¾ƒå°‘çš„ serve</u>r</li><li><strong>å†æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç­–ç•¥</strong>ï¼Œåœ¨<u>ä» serverå–åˆ°çš„æœåŠ¡æ³¨å†Œåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªåœ°å€</u></li><li>Ribbon æä¾›äº†å¤šç§ç­–ç•¥ï¼šæ¯”å¦‚è½®è¯¢ã€éšæœºå’Œæ ¹æ®å“åº”æ—¶é—´åŠ æƒã€‚</li></ol><h3 id="5-2-2-Ribbonå¸¸è§è´Ÿè½½ç®—æ³•"><a href="#5-2-2-Ribbonå¸¸è§è´Ÿè½½ç®—æ³•" class="headerlink" title="5.2.2 Ribbonå¸¸è§è´Ÿè½½ç®—æ³•"></a><strong>5.2.2 Ribbon</strong>å¸¸è§è´Ÿè½½ç®—æ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230529203353777.png" alt="image-20230529203353777"></p><h2 id="5-3-æ›¿æ¢è´Ÿè½½å‡è¡¡ç®—æ³•-åº”ç”¨å®ä¾‹"><a href="#5-3-æ›¿æ¢è´Ÿè½½å‡è¡¡ç®—æ³•-åº”ç”¨å®ä¾‹" class="headerlink" title="5.3 æ›¿æ¢è´Ÿè½½å‡è¡¡ç®—æ³•-åº”ç”¨å®ä¾‹"></a>5.3 æ›¿æ¢è´Ÿè½½å‡è¡¡ç®—æ³•-åº”ç”¨å®ä¾‹</h2><h3 id="5-3-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#5-3-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="5.3.1 éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£"></a><strong>5.3.1</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</h3><ol><li>éœ€æ±‚ï¼šå°†é»˜è®¤çš„è½®è¯¢ç®—æ³•æ”¹æˆéšæœºç®—æ³• RandomRule</li><li>æµè§ˆå™¨è¾“å…¥ï¼šhtp:&#x2F;&#x2F;ocalhost&#x2F;member&#x2F;consuimer&#x2F;get&#x2F;1</li><li>è¦æ±‚ å½·é—®çš„ 10000&#x2F;10002 ç«¯å£çš„æœåŠ¡æ˜¯éšæœºçš„</li></ol><h3 id="5-3-2ä»£ç å®ç°"><a href="#5-3-2ä»£ç å®ç°" class="headerlink" title="5.3.2ä»£ç å®ç°"></a>5.3.2ä»£ç å®ç°</h3><ol><li>åˆ›å»º member-service-consumer-80com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;RibbonRule.java</li></ol><h3 id="5-3-3-æµ‹è¯•"><a href="#5-3-3-æµ‹è¯•" class="headerlink" title="5.3.3 æµ‹è¯•"></a><strong>5.3.3</strong> æµ‹è¯•</h3><p><strong>1.</strong> æµè§ˆå™¨è¾“å…¥ **: <a href="http://localhost/member/consumer/get/1">http://localhost/member/consumer/get/1</a> **</p><p><strong>2.</strong> <strong>è§‚å¯Ÿè®¿é—®çš„</strong> <strong>10000&#x2F;10002</strong> <strong>ç«¯å£çš„æœåŠ¡æ˜¯éšæœºçš„</strong></p><h1 id="6-SpringCloud-Open-FeignæœåŠ¡è°ƒç”¨"><a href="#6-SpringCloud-Open-FeignæœåŠ¡è°ƒç”¨" class="headerlink" title="6 SpringCloud Open FeignæœåŠ¡è°ƒç”¨"></a>6 SpringCloud Open FeignæœåŠ¡è°ƒç”¨</h1><h2 id="6-1-OpenFeignä»‹ç»"><a href="#6-1-OpenFeignä»‹ç»" class="headerlink" title="6.1 OpenFeignä»‹ç»"></a>6.1 OpenFeignä»‹ç»</h2><h3 id="6-1-1-OpenFeignæ˜¯ä»€ä¹ˆ"><a href="#6-1-1-OpenFeignæ˜¯ä»€ä¹ˆ" class="headerlink" title="6.1.1 OpenFeignæ˜¯ä»€ä¹ˆ"></a><strong>6.1.1 OpenFeign</strong>æ˜¯ä»€ä¹ˆ</h3><ol><li><p>0penFeign æ˜¯ä¸ªå£°æ˜å¼ Webservice å®¢æˆ·ç«¯ï¼Œä½¿ç”¨ OpenFeign è®©ç¼–å†™ web Service å®¢æˆ·ç«¯æ›´ç®€å•</p></li><li><p>å®ƒçš„ä½¿ç”¨æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡æ¥å£ç„¶ååœ¨ä¸Šé¢æ·»åŠ æ³¨è§£</p></li><li><p>0penFeign ä¹Ÿæ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œè§£ç å™¨ã€‚</p></li><li><p>Spring cloud å¯¹ OpenFeign è¿›è¡Œäº†å°è£…ä½¿å…¶æ”¯æŒäº† Spring Mvc æ ‡å‡†æ³¨è§£å’ŒHttpMessageConverters</p></li><li><p>0penFeign å¯ä»¥ä¸Eureka å’Œ Ribbon ç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡</p></li></ol><h3 id="6-1-2-å®˜ç½‘"><a href="#6-1-2-å®˜ç½‘" class="headerlink" title="6.1.2 å®˜ç½‘"></a><strong>6.1.2</strong> å®˜ç½‘</h3><h4 id="6-1-2-1-https-github-com-spring-cloud-spring-cloud-openfeign"><a href="#6-1-2-1-https-github-com-spring-cloud-spring-cloud-openfeign" class="headerlink" title="6.1.2.1 https://github.com/spring-cloud/spring-cloud-openfeign"></a>6.1.2.1 <a href="https://github.com/spring-cloud/spring-cloud-openfeign">https://github.com/spring-cloud/spring-cloud-openfeign</a></h4><h3 id="6-1-3-Feignå’ŒOpenFeignåŒºåˆ«"><a href="#6-1-3-Feignå’ŒOpenFeignåŒºåˆ«" class="headerlink" title="6.1.3 Feignå’ŒOpenFeignåŒºåˆ«"></a><strong>6.1.3 Feign</strong>å’Œ<strong>OpenFeign</strong>åŒºåˆ«</h3><p>â€‹Feign(ä¸å¥½ç”¨ï¼Œæ²¡äººç”¨äº†)ï¼š</p><ul><li><p>Feignæ˜¯Spring Cioudç»„ä»¶ä¸­çš„ä¸€ä¸ªè½»é‡çº§RESTfulçš„HTTPæœåŠ¡å®¢æˆ·ç«¯</p></li><li><p>Feignå†…ç½®äº†Ribbonï¼Œç”¨æ¥åšå®¢æˆ·ç«¯å…è½½å‡è¡¡ï¼Œ å»è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚</p></li><li><p>Feignçš„ä½¿ç”¨æ–¹å¼æ˜¯ï¼šä½¿ç”¨Feignçš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡</p></li><li><p>Feignæ”¯æŒçš„æ³¨è§£å’Œç”¨æ³•è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://githulb.com/OpenFeign/feign">https://githulb.com/OpenFeign/feign</a></p></li><li><p>Feignæœ¬èº«ä¸æ”¯æŒSpring MvCçš„æ³¨è§£ï¼Œå®ƒæœ‰ä¸€å¥—è‡ªå·±çš„æ³¨è§£</p></li></ul><p>â€‹</p><p>â€‹OpenFeignï¼š</p><ul><li><p>openFeignæ˜¯Spring Cloud **<u>åœ¨Feignçš„åŸºç¡€ä¸Šæ”¯æŒäº†Spring MvCçš„æ³¨è§£</u>**ï¼Œå¦‚@Requesappingç­‰ç­‰ã€‚</p></li><li><p>OpenFeignçš„@FeignClientå¯ä»¥è§£æSpringvCçš„@RequestMappingæ³¨è§£ä¸‹çš„æ¥å£</p></li><li><p>OpenFeigné€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»ï¼Œå®ç°<strong>ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡</strong></p></li></ul><p>ç²¾ç®€ä¸€å¥è¯ : <strong>OpenFeign å°±æ˜¯åœ¨ Feign åŸºç¡€ä¸Šåšäº†åŠ å¼º</strong> , æœ‰äº›ç¨‹åºå‘˜ä¸ºäº†æ–¹ä¾¿ï¼Œè¯´ <u>Feign å°±æ˜¯æŒ‡çš„ OpenFeign</u></p><h2 id="6-2-OpenFeign-åº”ç”¨å®ä¾‹"><a href="#6-2-OpenFeign-åº”ç”¨å®ä¾‹" class="headerlink" title="6.2 OpenFeign-åº”ç”¨å®ä¾‹"></a>6.2 OpenFeign-åº”ç”¨å®ä¾‹</h2><h3 id="6-2-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#6-2-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="6.2.1 éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£"></a><strong>6.2.1</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230529210545959.png" alt="image-20230529210545959"></p><p>(Eurekaå®ç°è·å–æœåŠ¡ã€Ribbonå®ç°è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç®—æ³•ã€RestTemplateå®ç°è¿œç¨‹è°ƒç”¨)</p><p>(Eurekaå®ç°è·å–æœåŠ¡ã€OpenFeignå®ç°è´Ÿè½½å‡è¡¡+è¿œç¨‹è°ƒç”¨)</p><h3 id="6-2-2-åˆ›å»ºæœåŠ¡æ¶ˆè´¹æ¨¡å—-é€šè¿‡-OpenFeigen-å®ç°è¿œç¨‹è°ƒç”¨"><a href="#6-2-2-åˆ›å»ºæœåŠ¡æ¶ˆè´¹æ¨¡å—-é€šè¿‡-OpenFeigen-å®ç°è¿œç¨‹è°ƒç”¨" class="headerlink" title="6.2.2 åˆ›å»ºæœåŠ¡æ¶ˆè´¹æ¨¡å— **-**é€šè¿‡ OpenFeigen å®ç°è¿œç¨‹è°ƒç”¨"></a><strong>6.2.2</strong> åˆ›å»ºæœåŠ¡æ¶ˆè´¹æ¨¡å— **-**é€šè¿‡ <strong>OpenFeigen</strong> å®ç°è¿œç¨‹è°ƒç”¨</h3><p><strong>1.</strong> å‚è€ƒ <strong>member-service-consumer-80</strong> åˆ›å»º **member-service-consumer-openfeign-80(**å…·ä½“æ­¥éª¤å‚è€ƒä»¥å‰)</p><p><strong>2.</strong> <strong>ä¿®æ”¹</strong> <strong>pom.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    å¼•å…¥openfeign-startï¼Œå³åœºæ™¯å¯åŠ¨å™¨    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>**3.åˆ›å»º application.yml å†…å®¹å¦‚ä¸‹:**ã€</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">e-commerce-consumer-openfeign</span></span><br><span class="line"><span class="comment">#é…ç½®eureka-client</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#å°†è‡ªå·±æ³¨å†Œåˆ°Eureka-server</span></span><br><span class="line">    <span class="comment">#è¡¨ç¤ºä»Eureka-serveræŠ“å–æ³¨å†Œä¿¡æ¯</span></span><br><span class="line">    <span class="comment">#å¦‚æœæ˜¯å•èŠ‚ç‚¹ï¼Œå¯ä»¥ä¸é…ç½®ï¼›</span></span><br><span class="line">    <span class="comment">#ä½†æ˜¯provideræ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œåˆ™å¿…é¡»å°†æ­¤é¡¹é…ç½®ä¸ºtrueï¼Œè¿™æ ·æ‰èƒ½é…åˆRibbonä½¿ç”¨è´Ÿè½½å‡è¡¡åŠŸèƒ½</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># è¡¨ç¤ºå°†è‡ªå·±æ³¨å†Œåˆ°å“ªä¸ªeureka-server</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka9001.com:9001/eureka,http://eureka9002.com:9002/eureka</span></span><br></pre></td></tr></table></figure><p>4.åˆ›å»ºä¸»å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span> <span class="comment">//å¯åŠ¨openFeignClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberConsumerOpenfeignApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MemberConsumerOpenfeignApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>åˆ›å»º com&#x2F;study&#x2F;springcloud&#x2F;service&#x2F;MemberFeignService.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;MEMBER-SERVICE-PROVIDER&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MemberFeignService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•â€”â€”è¿œç¨‹è°ƒç”¨æœåŠ¡æä¾›æ–¹ç»™çš„æ¥å£</span></span><br><span class="line">    <span class="comment">//åŸæ¥æ˜¯ä½¿ç”¨RestControllerå®ç°åŠŸèƒ½çš„</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.è¿œç¨‹è°ƒç”¨çš„æ–¹å¼æ˜¯get</span></span><br><span class="line">    <span class="comment">//2.è¿œç¨‹è°ƒç”¨çš„url http:MEMBER-SERVICE-PROVIDER/member/get/&#123;id&#125;</span></span><br><span class="line">    <span class="comment">//3.MEMBER-SERVICE-PROVIDERæ˜¯æœåŠ¡æä¾›æ–¹åœ¨Eureka Serveræ³¨å†Œçš„æœåŠ¡</span></span><br><span class="line">    <span class="comment">//4.openfeignä¼šæ ¹æ®è´Ÿè½½å‡è¡¡æ¥å†³å®šè°ƒç”¨å“ªä¸ªæœåŠ¡-é»˜è®¤æ˜¯è½®è¯¢</span></span><br><span class="line">    <span class="comment">//5.ä¼˜ç‚¹ï¼šopenfeignæ”¯æŒäº†springMVCæ³¨è§£ + æ¥å£ --&gt;è§£è€¦</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/member/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">getMemberById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li>åˆ›å»º com&#x2F;study&#x2F;springcloud&#x2F;controller&#x2F;MemberConsumerFeignController.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span> <span class="comment">//ç»“æœä»¥jsonæ ¼å¼è¿”å›</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberConsumerFeignController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è£…é…MemberFeignService</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MemberFeignService memberFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/member/consumer/openfeign/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">getMemberById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> memberFeignService.getMemberById(id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-3-æµ‹è¯•"><a href="#6-2-3-æµ‹è¯•" class="headerlink" title="6.2.3 æµ‹è¯•"></a><strong>6.2.3</strong> æµ‹è¯•</h3><p>â€‹æµè§ˆå™¨è¾“å…¥ <strong>: <a href="http://localhost/member/consumer/openfeign/get/1">http://localhost/member/consumer/openfeign/get/1</a></strong></p><h3 id="6-2-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#6-2-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="6.2.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a><strong>6.2.4</strong> æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><ul><li><p>é…Openfeignçš„ä½¿ç”¨ç‰¹ç‚¹æ˜¯ å¾®æœåŠ¡è°ƒç”¨æ¥å£+@Feignclientï¼Œä½¿ç”¨æ¥å£è¿›è¡Œ<strong>è§£è€¦</strong></p></li><li><p>@FeignClient(value &#x3D; â€œMEMBER-SERVICE-PROVIDERâ€)ï¼Œè¿™é‡ŒMEMBER-SERVICE-PROVIDERå°±æ˜¯Eureka ServeræœåŠ¡æä¾›æ–¹æ³¨å†Œçš„åç§°ï¼Œä¸è¦å†™é”™äº†</p></li><li><p>æ¥å£æ–¹æ³•ä¸Šï¼š valueæ˜¯ä¸èƒ½ä¹±å†™ï¼Œè¿œç¨‹è°ƒç”¨çš„url ä¸º<a href="http://member-service-provider/member/get/%7Bid%7D">http://MEMBER-SERVICE-PROVIDER/member/get/{id}</a></p></li></ul><p>â€‹@GetMapping(â€œ&#x2F;member&#x2F;get&#x2F;{id}â€)<br>â€‹    public Result getMemberById(@PathVariable(â€œidâ€)Long id);</p><h2 id="6-3-æ—¥å¿—é…ç½®"><a href="#6-3-æ—¥å¿—é…ç½®" class="headerlink" title="6.3 æ—¥å¿—é…ç½®"></a>6.3 æ—¥å¿—é…ç½®</h2><h3 id="6-3-1-åŸºæœ¬ä»‹ç»"><a href="#6-3-1-åŸºæœ¬ä»‹ç»" class="headerlink" title="6.3.1 åŸºæœ¬ä»‹ç»"></a><strong>6.3.1</strong> åŸºæœ¬ä»‹ç»</h3><p>1ï¼è¯´æ˜ï¼šFeign æä¾›äº†æ—¥å¿—æ‰“å°åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡é…ç½æ¥è°ƒæ•´æ—¥å¿—çº§åˆ«ï¼Œä»è€Œå¯¹ Feign æ¥å£çš„è°ƒç”¨æƒ…å†µè¿›è¡Œç›‘æ§å’Œè¾“å‡º</p><p>2.æ—¥å¿—çº§åˆ«</p><ul><li><p><strong>NONE</strong> ï¼šé»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—</p></li><li><p><strong>BASIC</strong>ï¼šä»…è®°å½•è¯·æ±‚æ–¹æ³•ã€URLã€å“åº”çŠ¶æ€ç åŠæ‰§è¡Œæ—¶é—´;</p></li><li><p><strong>HEADERS</strong> ï¼š é™¤äº† BASICä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯;</p></li><li><p><strong>FULL</strong>ï¼šé™¤äº†HEADERSä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ®ã€‚</p></li></ul><h3 id="6-3-2-é…ç½®æ—¥å¿—-åº”ç”¨å®ä¾‹"><a href="#6-3-2-é…ç½®æ—¥å¿—-åº”ç”¨å®ä¾‹" class="headerlink" title="6.3.2 é…ç½®æ—¥å¿—**-**åº”ç”¨å®ä¾‹"></a><strong>6.3.2</strong> é…ç½®æ—¥å¿—**-**åº”ç”¨å®ä¾‹</h3><p><strong>1.</strong> åœ¨ <strong>member-service-consumer-openfeign-80</strong> åˆ› å»º</p><p><strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;OpenFeignConfig.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenFeignConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger.Level <span class="title function_">loggerLevel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2.</strong> åœ¨ <strong>member-service-consumer-openfeign-80</strong> ä¿®æ”¹ <strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯¹MemberFeignServiceæ¥å£è°ƒç”¨è¿‡ç¨‹æ‰“å°ä¿¡æ¯-debug</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.study.springcloud.service.MemberFeignService:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230530125632781.png" alt="image-20230530125632781" style="zoom:50%;" /><h3 id="6-3-3-æµ‹è¯•"><a href="#6-3-3-æµ‹è¯•" class="headerlink" title="6.3.3 æµ‹è¯•"></a><strong>6.3.3</strong> æµ‹è¯•</h3><p>â€¦â€¦</p><h2 id="6-4-OpenFeignè¶…æ—¶"><a href="#6-4-OpenFeignè¶…æ—¶" class="headerlink" title="6.4 OpenFeignè¶…æ—¶"></a>6.4 OpenFeignè¶…æ—¶</h2><p>è‹¥æœåŠ¡æä¾›æ–¹(å¯èƒ½ç”±äºå„ç§åŸå› ï¼Œæ¯”å¦‚æ“ä½œæ•°æ®åº“æ—¶é—´è¿‡é•¿)å“åº”è¶…è¿‡OpenFeignçš„ç­‰å¾…æ—¶é—´(é»˜è®¤1ç§’)ï¼Œä¼šè¿”å›è¶…æ—¶é”™è¯¯(time out)</p><p>â€¦â€¦</p><h3 id="6-4-3-è®¾ç½®OpenFeignè¶…æ—¶æ—¶é—´"><a href="#6-4-3-è®¾ç½®OpenFeignè¶…æ—¶æ—¶é—´" class="headerlink" title="6.4.3 è®¾ç½®OpenFeignè¶…æ—¶æ—¶é—´"></a><strong>6.4.3</strong> è®¾ç½®OpenFeignè¶…æ—¶æ—¶é—´</h3><p>åœ¨æœåŠ¡æ¶ˆè´¹æ–¹çš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œå“åº”é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="comment"># read-timeout å»ºç«‹è¿æ¥ï¼šä»æœåŠ¡æä¾›æ–¹è·å–å¯ç”¨èµ„æºçš„å…¨éƒ¨æ—¶é—´</span></span><br><span class="line"><span class="comment"># connect-timeout ä¸¤ç«¯è¿æ¥æ‰€ç”¨æ—¶é—´</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">connect-timeout:</span> <span class="number">5000</span></span><br><span class="line">        <span class="attr">read-timeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure><h3 id="6-4-4-æµ‹è¯•"><a href="#6-4-4-æµ‹è¯•" class="headerlink" title="6.4.4 æµ‹è¯•"></a><strong>6.4.4</strong> æµ‹è¯•</h3><p>â€¦â€¦</p><h1 id="7-ğŸŒŸSpringCloudGateway-æœåŠ¡ç½‘å…³"><a href="#7-ğŸŒŸSpringCloudGateway-æœåŠ¡ç½‘å…³" class="headerlink" title="7 ğŸŒŸSpringCloudGateway æœåŠ¡ç½‘å…³"></a>7 ğŸŒŸSpringCloudGateway æœåŠ¡ç½‘å…³</h1><h2 id="7-1-Gatewayä»‹ç»"><a href="#7-1-Gatewayä»‹ç»" class="headerlink" title="7.1 Gatewayä»‹ç»"></a>7.1 Gatewayä»‹ç»</h2><h3 id="7-1-1-çœ‹ä¸€ä¸ªéœ€æ±‚ï¼Œå¼•å‡ºç½‘å…³æœåŠ¡"><a href="#7-1-1-çœ‹ä¸€ä¸ªéœ€æ±‚ï¼Œå¼•å‡ºç½‘å…³æœåŠ¡" class="headerlink" title="7.1.1 çœ‹ä¸€ä¸ªéœ€æ±‚ï¼Œå¼•å‡ºç½‘å…³æœåŠ¡"></a><strong>7.1.1</strong> çœ‹ä¸€ä¸ªéœ€æ±‚ï¼Œå¼•å‡ºç½‘å…³æœåŠ¡</h3><p><strong>1</strong>ã€æœ‰ä¸€ä¸ªå‰åç«¯åˆ†ç¦»é¡¹ç›®**,** åˆ†æå¦‚å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230530144204835.png" alt="image-20230530144204835"></p><p>2ã€ä½¿ç”¨ç½‘å…³æœåŠ¡, é‡æ„é¡¹ç›®æ¶æ„</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230530144645171.png" alt="image-20230530144645171"></p><h3 id="7-1-2-ğŸŒŸGateway-ç½‘ç»œæ‹“æ‰‘å›¾"><a href="#7-1-2-ğŸŒŸGateway-ç½‘ç»œæ‹“æ‰‘å›¾" class="headerlink" title="7.1.2 ğŸŒŸGateway ç½‘ç»œæ‹“æ‰‘å›¾"></a><strong>7.1.2 ğŸŒŸGateway</strong> ç½‘ç»œæ‹“æ‰‘å›¾</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230530151559362.png" alt="image-20230530151559362"></p><h3 id="7-1-3-Gatewayæ˜¯ä»€ä¹ˆ"><a href="#7-1-3-Gatewayæ˜¯ä»€ä¹ˆ" class="headerlink" title="7.1.3 Gatewayæ˜¯ä»€ä¹ˆ"></a><strong>7.1.3 Gateway</strong>æ˜¯ä»€ä¹ˆ</h3><ol><li><p>Gateway æ˜¯åœ¨ Spring ç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„ API ç½‘å…³æœåŠ¡ï¼ŒåŸºäº spring , Spring Boot å’Œ Project Reactor ç­‰æŠ€æœ¯ã€‚</p></li><li><p>Gateway æ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹ API è¿›è¡Œè·¯ç”±ï¼Œä»¥åŠæä¾›ä¸€äº›å¼ºå¤§çš„è¿‡æ»¤å™¨åŠŸèƒ½ï¼Œä¾‹å¦‚ ï¼šç†”æ–­ã€é™æµã€é‡è¯•ç­‰ã€‚</p></li></ol><h3 id="7-1-4-å®˜ç½‘"><a href="#7-1-4-å®˜ç½‘" class="headerlink" title="7.1.4 å®˜ç½‘"></a>7.1.4 å®˜ç½‘</h3><h4 id="7-1-4-1-https-cloud-spring-io-spring-cloud-static-spring-cloud-gateway-2-2-1-RELEASE-reference-html"><a href="#7-1-4-1-https-cloud-spring-io-spring-cloud-static-spring-cloud-gateway-2-2-1-RELEASE-reference-html" class="headerlink" title="7.1.4.1 https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/"></a>7.1.4.1 <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/</a></h4><h3 id="7-1-5-Gateway-æ ¸å¿ƒåŠŸèƒ½"><a href="#7-1-5-Gateway-æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="7.1.5 Gateway æ ¸å¿ƒåŠŸèƒ½"></a><strong>7.1.5 Gateway</strong> æ ¸å¿ƒåŠŸèƒ½</h3><h4 id="7-1-5-1-é‰´æƒ"><a href="#7-1-5-1-é‰´æƒ" class="headerlink" title="7.1.5.1 é‰´æƒ"></a>7.1.5.1 é‰´æƒ</h4><h4 id="7-1-5-2-æµé‡æ§åˆ¶"><a href="#7-1-5-2-æµé‡æ§åˆ¶" class="headerlink" title="7.1.5.2 æµé‡æ§åˆ¶"></a>7.1.5.2 æµé‡æ§åˆ¶</h4><h4 id="7-1-5-3-ç†”æ–­"><a href="#7-1-5-3-ç†”æ–­" class="headerlink" title="7.1.5.3 ç†”æ–­"></a>7.1.5.3 ç†”æ–­</h4><h4 id="7-1-5-4-æ—¥å¿—ç›‘æ§"><a href="#7-1-5-4-æ—¥å¿—ç›‘æ§" class="headerlink" title="7.1.5.4 æ—¥å¿—ç›‘æ§"></a>7.1.5.4 æ—¥å¿—ç›‘æ§</h4><h4 id="7-1-5-5-åå‘ä»£ç†"><a href="#7-1-5-5-åå‘ä»£ç†" class="headerlink" title="7.1.5.5 åå‘ä»£ç†"></a>7.1.5.5 åå‘ä»£ç†</h4><h3 id="7-1-6-Gateway-vs-Zuul"><a href="#7-1-6-Gateway-vs-Zuul" class="headerlink" title="7.1.6 Gateway vs Zuul"></a><strong>7.1.6 Gateway vs Zuul</strong></h3><h4 id="7-1-6-1-Gateway-å’Œ-Zuul-åŒºåˆ«"><a href="#7-1-6-1-Gateway-å’Œ-Zuul-åŒºåˆ«" class="headerlink" title="7.1.6.1 Gateway å’Œ Zuul åŒºåˆ«"></a>7.1.6.1 Gateway å’Œ Zuul åŒºåˆ«</h4><ol><li><p>SpringCloud Gateway ä½œä¸º Spring Cloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£ Zuul</p></li><li><p>SpringCloud Gateway æ˜¯åŸºäº Spring WebFluxæ¡†æ¶å®ç°çš„</p></li><li><p>Spring WebFlux æ¡†æ¶åº•å±‚åˆ™ä½¿ç”¨äº†é«˜æ€§èƒ½çš„ Reactor æ¨¡å¼é€šä¿¡æ¡†æ¶ Nettyï¼Œæå‡äº†ç½‘å…³æ€§èƒ½</p></li></ol><h4 id="7-1-6-2-Gateway-ç‰¹æ€§"><a href="#7-1-6-2-Gateway-ç‰¹æ€§" class="headerlink" title="7.1.6.2 Gateway ç‰¹æ€§"></a>7.1.6.2 Gateway ç‰¹æ€§</h4><p>â€‹Spring Cloud Gateway åŸº äº Spring Framework(æ”¯ ç‰¹ Spring WebFlux)ï¼Œ project Reactor å’Œ spring Boot è¿›è¡Œæ„å»ºï¼Œå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š</p><ul><li>åŠ¨æ€è·¯ç”±</li><li>å¯ä»¥å¯¹è·¯ç”±æŒ‡å®š predicate(æ–­è¨€)å’ŒFilter(è¿‡æ»¤å™¨ï¼‰</li><li>é›†æˆHystrixçš„æ–­è·¯å™¨åŠŸèƒ½</li><li>é›†æˆ Spring Cloud æœåŠ¡å‘ç°åŠŸèƒ½</li><li>è¯·æ±‚é™æµåŠŸèƒ½</li><li>æ”¯æŒè·¯å¾„é‡å†™</li></ul><h2 id="7-2-GatewayåŸºæœ¬åŸç†"><a href="#7-2-GatewayåŸºæœ¬åŸç†" class="headerlink" title="7.2 GatewayåŸºæœ¬åŸç†"></a>7.2 GatewayåŸºæœ¬åŸç†</h2><h3 id="7-2-1-Gatewayæ ¸å¿ƒç»„ä»¶"><a href="#7-2-1-Gatewayæ ¸å¿ƒç»„ä»¶" class="headerlink" title="7.2.1 Gatewayæ ¸å¿ƒç»„ä»¶"></a><strong>7.2.1 Gateway</strong>æ ¸å¿ƒç»„ä»¶</h3><h4 id="7-2-1-1-ä¸€å¼ å›¾"><a href="#7-2-1-1-ä¸€å¼ å›¾" class="headerlink" title="7.2.1.1 ä¸€å¼ å›¾"></a>7.2.1.1 ä¸€å¼ å›¾</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230530152704594.png" alt="image-20230530152704594" style="zoom:50%;" /><ol><li><p>web è¯·æ±‚é€šè¿‡ä¸€äº›åŒ¹é…æ¡ä»¶ï¼Œå®šä½åˆ°çœŸæ­£çš„æœåŠ¡èŠ‚ç‚¹&#x2F;å¾®æœåŠ¡æ¨¡å—ï¼Œåœ¨è¿™ä¸ªè½¬å‘è¿‡ç¨‹çš„å‰åï¼Œè¿›è¡Œä¸€äº›ç²¾ç»†åŒ–æ§åˆ¶ã€‚</p></li><li><p>predicateï¼šå°±æ˜¯åŒ¹é…æ¡ä»¶(è¯·æ±‚æ˜¯å¦èƒ½è¢«æ¥å—ä½¿ç”¨)</p></li><li><p>filterï¼šå¯ä»¥ç†è§£ä¸ºæ˜¯ç½‘å…³çš„è¿‡æ»¤æœºåˆ¶ã€‚</p><p>æœ‰äº†predicate å’Œfilterï¼Œå†åŠ ä¸Šç›®æ ‡ URL,å°±å¯ä»¥å®ç°ä¸€ä¸ªå…·ä½“çš„è·¯ç”±</p></li></ol><h4 id="7-2-1-2-Route-è·¯ç”±"><a href="#7-2-1-2-Route-è·¯ç”±" class="headerlink" title="7.2.1.2 Route(è·¯ç”±)"></a>7.2.1.2 Route(è·¯ç”±)</h4><p>ä¸€å¥è¯ï¼šè·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”± <strong>ID</strong>ï¼Œ<strong>ç›®æ ‡ URL</strong>ï¼Œ<strong>ä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨</strong>ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸º true åˆ™åŒ¹é…è¯¥è·¯ç”±ã€‚</p><h4 id="7-2-1-3-Predicate-æ–­è¨€"><a href="#7-2-1-3-Predicate-æ–­è¨€" class="headerlink" title="7.2.1.3 Predicate(æ–­è¨€)"></a>7.2.1.3 Predicate(æ–­è¨€)</h4><ol><li><p>ä¸€å¥è¯ï¼šå¯¹ HTTP è¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°ï¼‰è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±</p></li><li><p>ç®€å•ä¸¾ä¾‹ï¼Œæ¯”å¦‚é…ç½®è·¯å¾„ï¼Œ- Path&#x3D;&#x2F;member&#x2F;get&#x2F;**             æ–­è¨€,è·¯ç»ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±è½¬å‘ï¼Œå¦‚æœHttp è¯·æ±‚çš„è·¯å¾„ä¸åŒ¹é…ï¼Œåˆ™ä¸è¿›è¡Œè·¯ç”±è½¬å‘ã€‚</p></li></ol><h4 id="7-2-1-4-Filter-è¿‡æ»¤"><a href="#7-2-1-4-Filter-è¿‡æ»¤" class="headerlink" title="7.2.1.4 Filter(è¿‡æ»¤)"></a>7.2.1.4 Filter(è¿‡æ»¤)</h4><p>1ã€ä¸€å¥è¯ï¼šä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨<strong>è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹å</strong>å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†</p><p>2ã€ä½ å¯ä»¥ç†è§£æˆï¼Œåœ¨å¯¹ Http è¯·æ±‚æ–­è¨€åŒ¹é…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡ç½‘å…³çš„è¿‡æ»¤æœºåˆ¶ï¼Œå¯¹Http è¯·æ±‚å¤„ç†</p><h3 id="7-2-2-HowItWorkså·¥ä½œæœºåˆ¶"><a href="#7-2-2-HowItWorkså·¥ä½œæœºåˆ¶" class="headerlink" title="7.2.2 HowItWorkså·¥ä½œæœºåˆ¶"></a><strong>7.2.2 HowItWorks</strong>å·¥ä½œæœºåˆ¶</h3><h4 id="7-2-2-1-ä¸€å›¾èƒœåƒè¨€"><a href="#7-2-2-1-ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="7.2.2.1 ä¸€å›¾èƒœåƒè¨€"></a>7.2.2.1 ä¸€å›¾èƒœåƒè¨€</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230530163559159.png" alt="image-20230530163559159" style="zoom:50%;" /><ol><li><p>å®¢æˆ·ç«¯å‘ Spring Cloud Gateway å‘å‡ºè¯·æ±‚ã€‚ç„¶ååœ¨ Gateway Handler Mapping ä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°‡å…¶å‘é€åˆ° Gateway Web Handlerã€‚</p></li><li><p>Handler å†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚</p></li><li><p>è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰ï¼ˆâ€preâ€ï¼‰æˆ–ä¹‹å(â€œpostâ€ï¼‰æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚</p></li><li><p>Filter åœ¨â€preâ€ç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åš<strong>å‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºã€åè®®è½¬æ¢</strong>ç­‰ï¼Œ</p></li><li><p>åœ¨â€postâ€ç±»å‹çš„è¿‡æ»¤å™¨ä¸­å¯ä»¥åšå“åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹ï¼Œæ—¥å¿—çš„è¾“å‡ºï¼Œæµé‡ç›‘æ§ç­‰æœ‰ç€éå¸¸é‡è¦çš„ä½œç”¨ã€‚</p></li></ol><p>ä¸€å¥è¯è¯´ï¼šè·¯ç”±è½¬å‘ï¼‹æ‰§è¡Œè¿‡æ»¤å™¨é“¾</p><h2 id="7-3-æ­å»º-Gateway-å¾®æœåŠ¡"><a href="#7-3-æ­å»º-Gateway-å¾®æœåŠ¡" class="headerlink" title="7.3 æ­å»º Gateway å¾®æœåŠ¡"></a>7.3 æ­å»º Gateway å¾®æœåŠ¡</h2><h3 id="7-3-1-æ­å»º-Gateway-åº”ç”¨å®ä¾‹"><a href="#7-3-1-æ­å»º-Gateway-åº”ç”¨å®ä¾‹" class="headerlink" title="7.3.1 æ­å»º **Gateway-**åº”ç”¨å®ä¾‹"></a><strong>7.3.1</strong> æ­å»º **Gateway-**åº”ç”¨å®ä¾‹</h3><h4 id="7-3-1-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#7-3-1-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="7.3.1.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>7.3.1.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p>â€“ å¼•å…¥ <strong>Gateway</strong> é¡¹ç›®æ¶æ„</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230531095247037.png" alt="image-20230531095247037"></p><p><strong>1.</strong> <strong>é€šè¿‡ç½‘å…³æš´éœ²çš„æ¥å£ï¼Œå®ç°è°ƒç”¨çœŸæ­£çš„æœåŠ¡</strong> </p><p><strong>2.</strong> <strong>ç½‘å…³æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¾®æœåŠ¡æ¨¡å—</strong></p><h4 id="7-3-1-2-ä»£ç å®ç°"><a href="#7-3-1-2-ä»£ç å®ç°" class="headerlink" title="7.3.1.2 ä»£ç å®ç°"></a>7.3.1.2 ä»£ç å®ç°</h4><p><strong>1.</strong> å‚è€ƒ <strong>member-service-consumer-80</strong> åˆ›å»º **e-commerce-gateway-20000(**å…·ä½“æ­¥éª¤å‚è€ƒä»¥å‰)<br><strong>2.</strong> ä¿®æ”¹ <strong>pom.xml,</strong> éƒ¨åˆ†å†…å®¹å¯ä»¥ä» <strong>member-service-consumer-80</strong> çš„ <strong>pom.xml</strong> æ‹·è´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.study.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e-commerce-center<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e-commerce-gateway-20000<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--       å¼•å…¥gateway startï¼Œ ç½‘å…³åœºæ™¯å¯åŠ¨å™¨--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--       å¼•å…¥eureka-clientåœºæ™¯å¯åŠ¨å™¨starter--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--è€å¸ˆç‰¹åˆ«è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">    ä¸è¦å¼•å…¥ï¼šspring-boot-starter-webã€spring-boot-starter-actuator</span></span><br><span class="line"><span class="comment">    å¦åˆ™ä¼šå‡ºç°å†²çª</span></span><br><span class="line"><span class="comment">    å› ä¸ºgatewayæ˜¯ä¸€ä¸ªæœåŠ¡ç½‘å…³ï¼Œä¸éœ€è¦web</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥ e_commerce_center-common-api --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.study.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e_commerce_center-common-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>3.<strong>åˆ›å»º <strong>application.yml(<strong>é‡ç‚¹æ ¸å¿ƒ</strong>)</strong> å†…å®¹å¦‚ä¸‹</strong>:</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">20000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">e-commerce-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span> <span class="comment">#é…ç½®è·¯ç”±ï¼Œå¯ä»¥é…ç½®å¤šä¸ª List&lt;RouteDefinition&gt; routes</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">member_route01</span> <span class="comment">#è·¯ç”±çš„idï¼Œç¨‹åºå‘˜è‡ªè¡Œé…ç½®</span></span><br><span class="line">          <span class="comment">#gateway æœ€ç»ˆè®¿é—®çš„url æ˜¯ uri + path</span></span><br><span class="line">          <span class="comment">#åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ï¼šä¹Ÿå¯ä»¥æ˜¯å¤–ç½‘ å¦‚www.baidu.com</span></span><br><span class="line">          <span class="comment">#æ¯”å¦‚ï¼šå®¢æˆ·ç«¯/æµè§ˆå™¨è¯·æ±‚urlï¼šhttp:localhost:20000/member/get/1</span></span><br><span class="line">          <span class="comment">#ç½‘å…³å¯¹è¯·æ±‚urlä¸­çš„pathè¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…å¤±è´¥ï¼Œè¿”å›404</span></span><br><span class="line">          <span class="comment">#å¦‚æœåŒ¹é…æˆåŠŸï¼Œæœ€ç»ˆè®¿é—®çš„url=http://localhost:10000/member/get/1</span></span><br><span class="line">          <span class="comment">#                     å³ uri + path</span></span><br><span class="line">          <span class="comment">#è¿™é‡Œâ¬‡ï¸çš„uriæ˜¯å›ºå®šä¸å˜çš„ï¼Œåœ¨å½“å‰è¿™ç§æƒ…å†µä¸‹æ˜¯å¯ä»¥ä¸ä½¿ç”¨Eureka Server çš„</span></span><br><span class="line">          <span class="comment">#åé¢ä¼šä½¿ç”¨çµæ´»urié…ç½®ï¼Œä¼šç”¨åˆ°Eureka Server</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://localhost:10000</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># æ–­è¨€ï¼Œå¯ä»¥æœ‰å¤šç§å½¢å¼</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/member/get/**</span></span><br><span class="line"><span class="comment"># é…ç½®Eureka Client</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">e-commerce-service</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#å°†è‡ªå·±æ³¨å†Œåˆ°Eureka-server</span></span><br><span class="line">    <span class="comment">#è¡¨ç¤ºä»Eureka-serveræŠ“å–æ³¨å†Œä¿¡æ¯</span></span><br><span class="line">    <span class="comment">#å¦‚æœæ˜¯å•èŠ‚ç‚¹ï¼Œå¯ä»¥ä¸é…ç½®ï¼›</span></span><br><span class="line">    <span class="comment">#ä½†æ˜¯provideræ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œåˆ™å¿…é¡»å°†æ­¤é¡¹é…ç½®ä¸ºtrueï¼Œè¿™æ ·æ‰èƒ½é…åˆRibbonä½¿ç”¨è´Ÿè½½å‡è¡¡åŠŸèƒ½</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># è¡¨ç¤ºå°†è‡ªå·±æ³¨å†Œåˆ°å“ªä¸ªeureka-server</span></span><br><span class="line">      <span class="comment">#è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œå°±ä½¿ç”¨9001ç«¯å£ä¸€ä¸ªserver</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka9001.com:9001/eureka</span></span><br></pre></td></tr></table></figure><p>**4.**åˆ›å»ºä¸»å¯åŠ¨ç±» <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;GateWayApplication20000.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GateWayApplication20000</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GateWayApplication20000.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-3-1-3-æµ‹è¯•"><a href="#7-3-1-3-æµ‹è¯•" class="headerlink" title="7.3.1.3 æµ‹è¯•"></a>7.3.1.3 æµ‹è¯•</h4><p>â€¦â€¦</p><h4 id="7-3-1-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#7-3-1-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="7.3.1.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>7.3.1.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p>å› ä¸ºæˆ‘ä»¬çš„ member çš„ controller çš„æ–¹æ³•å‚æ•°ä½¿ç”¨äº†@RequestBody ,æ‰€ä»¥åœ¨ä½¿ç”¨ postmanæ—¶ï¼Œéœ€è¦ä½¿ç”¨ json æ ¼å¼å‘é€æ•°æ®, å¦åˆ™ä¼šæŠ¥400é”™è¯¯ã€‚</p><h3 id="7-3-2-äºŒè¯´-Gateway-è·¯ç”±é…ç½®"><a href="#7-3-2-äºŒè¯´-Gateway-è·¯ç”±é…ç½®" class="headerlink" title="7.3.2 äºŒè¯´ Gateway è·¯ç”±é…ç½®"></a><strong>7.3.2</strong> äºŒè¯´ <strong>Gateway</strong> è·¯ç”±é…ç½®</h3><h4 id="7-3-2-1-æ–¹å¼-1-application-yml-ä¸­é…ç½®-å‰é¢è®²è¿‡"><a href="#7-3-2-1-æ–¹å¼-1-application-yml-ä¸­é…ç½®-å‰é¢è®²è¿‡" class="headerlink" title="7.3.2.1 æ–¹å¼ 1: application.yml ä¸­é…ç½®-å‰é¢è®²è¿‡"></a>7.3.2.1 æ–¹å¼ 1: application.yml ä¸­é…ç½®-å‰é¢è®²è¿‡</h4><h4 id="7-3-2-2-æ–¹å¼-2-ç¼–å†™é…ç½®ç±»æ³¨å…¥ã€äº†è§£ã€‘"><a href="#7-3-2-2-æ–¹å¼-2-ç¼–å†™é…ç½®ç±»æ³¨å…¥ã€äº†è§£ã€‘" class="headerlink" title="7.3.2.2 æ–¹å¼ 2: ç¼–å†™é…ç½®ç±»æ³¨å…¥ã€äº†è§£ã€‘"></a>7.3.2.2 æ–¹å¼ 2: ç¼–å†™é…ç½®ç±»æ³¨å…¥ã€äº†è§£ã€‘</h4><p>â€‹<strong>1.</strong> å…ˆæ³¨é”€ <strong>application.yml</strong> å¯¹ç½‘å…³è·¯ç”±éƒ¨åˆ†æ³¨é”€</p><p>â€‹<strong>2.</strong> <strong>é‡å¯</strong> <strong>e-commerce-gateway-20000,</strong> <strong>å†æ¬¡æµ‹è¯•ï¼Œç½‘å…³è·¯ç”±å¤±æ•ˆ</strong></p><p><strong>3.</strong> å‚è€ƒå®˜æ–¹æ–‡æ¡£:<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#spring-cloud-circuitbreaker-filter-factory">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#spring-cloud-circuitbreaker-filter-factory</a> ï¼Œ åˆ› å»ºcom&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;GateWayRoutesConfig.java</p><h4 id="7-3-2-3-æµ‹è¯•"><a href="#7-3-2-3-æµ‹è¯•" class="headerlink" title="7.3.2.3 æµ‹è¯•"></a>7.3.2.3 æµ‹è¯•</h4><p>â€¦â€¦</p><h3 id="7-3-3-åŠ¨æ€è·¯ç”±"><a href="#7-3-3-åŠ¨æ€è·¯ç”±" class="headerlink" title="7.3.3 åŠ¨æ€è·¯ç”±"></a><strong>7.3.3</strong> åŠ¨æ€è·¯ç”±</h3><h4 id="7-3-3-1-éœ€æ±‚åˆ†æ-x2F-å›¾"><a href="#7-3-3-1-éœ€æ±‚åˆ†æ-x2F-å›¾" class="headerlink" title="7.3.3.1 éœ€æ±‚åˆ†æ&#x2F;å›¾"></a>7.3.3.1 éœ€æ±‚åˆ†æ&#x2F;å›¾</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230531150741007.png" alt="image-20230531150741007"></p><h4 id="7-3-3-2-ä»£ç å®ç°"><a href="#7-3-3-2-ä»£ç å®ç°" class="headerlink" title="7.3.3.2 ä»£ç å®ç°"></a>7.3.3.2 ä»£ç å®ç°</h4><p><strong>1.</strong> ä¿®æ”¹ <strong>e-commerce-gateway-20000</strong> çš„ <strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">20000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">e-commerce-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="comment"># å¯ç”¨ DiscoveryClient æœåŠ¡å‘ç°</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">routes:</span> <span class="comment">#é…ç½®è·¯ç”±ï¼Œå¯ä»¥é…ç½®å¤šä¸ª List&lt;RouteDefinition&gt; routes</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">member_route01</span> <span class="comment">#è·¯ç”±çš„idï¼Œç¨‹åºå‘˜è‡ªè¡Œé…ç½®</span></span><br><span class="line">          <span class="comment"># 1. lb:è´Ÿè½½å‡è¡¡åè®®åç§°</span></span><br><span class="line">          <span class="comment">#    member-service-providerï¼šæ³¨å†Œåˆ°eureka serverçš„æœåŠ¡å(å°å†™)</span></span><br><span class="line">          <span class="comment"># 2. é»˜è®¤æƒ…å†µä¸‹ï¼Œè´Ÿè½½å‡è¡¡ç®—æ³•ä¸ºè½®è¯¢</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://member-service-provider</span></span><br><span class="line">          <span class="attr">predicates:</span> </span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/member/get/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">member_route02</span> </span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://member-service-provider</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/member/save</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">member_route03</span> </span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://member-service-provider</span></span><br><span class="line">          <span class="attr">predicates:</span> </span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/</span></span><br><span class="line"><span class="comment"># é…ç½®Eureka Client</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">e-commerce-service</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#å°†è‡ªå·±æ³¨å†Œåˆ°Eureka-server</span></span><br><span class="line">    <span class="comment">#è¡¨ç¤ºä»Eureka-serveræŠ“å–æ³¨å†Œä¿¡æ¯</span></span><br><span class="line">    <span class="comment">#å¦‚æœæ˜¯å•èŠ‚ç‚¹ï¼Œå¯ä»¥ä¸é…ç½®ï¼›</span></span><br><span class="line">    <span class="comment">#ä½†æ˜¯provideræ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œåˆ™å¿…é¡»å°†æ­¤é¡¹é…ç½®ä¸ºtrueï¼Œè¿™æ ·æ‰èƒ½é…åˆRibbonä½¿ç”¨è´Ÿè½½å‡è¡¡åŠŸèƒ½</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># è¡¨ç¤ºå°†è‡ªå·±æ³¨å†Œåˆ°å“ªä¸ªeureka-server</span></span><br><span class="line">      <span class="comment">#è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œå°±ä½¿ç”¨9001ç«¯å£ä¸€ä¸ªserver</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka9001.com:9001/eureka</span></span><br></pre></td></tr></table></figure><h4 id="7-3-3-3-æµ‹è¯•"><a href="#7-3-3-3-æµ‹è¯•" class="headerlink" title="7.3.3.3 æµ‹è¯•"></a>7.3.3.3 æµ‹è¯•</h4><h5 id="7-3-3-3-1-å¯åŠ¨-e-commerce-eureka-server-9001"><a href="#7-3-3-3-1-å¯åŠ¨-e-commerce-eureka-server-9001" class="headerlink" title="7.3.3.3.1 å¯åŠ¨ e-commerce-eureka-server-9001"></a>7.3.3.3.1 å¯åŠ¨ e-commerce-eureka-server-9001</h5><h5 id="7-3-3-3-2-å¯åŠ¨-member-service-provider-10000"><a href="#7-3-3-3-2-å¯åŠ¨-member-service-provider-10000" class="headerlink" title="7.3.3.3.2 å¯åŠ¨ member-service-provider-10000"></a>7.3.3.3.2 å¯åŠ¨ member-service-provider-10000</h5><h5 id="7-3-3-3-3-å¯åŠ¨-member-service-provider-10002"><a href="#7-3-3-3-3-å¯åŠ¨-member-service-provider-10002" class="headerlink" title="7.3.3.3.3 å¯åŠ¨ member-service-provider-10002"></a>7.3.3.3.3 å¯åŠ¨ member-service-provider-10002</h5><h5 id="7-3-3-3-4-å¯åŠ¨-e-commerce-gateway-20000"><a href="#7-3-3-3-4-å¯åŠ¨-e-commerce-gateway-20000" class="headerlink" title="7.3.3.3.4 å¯åŠ¨ e-commerce-gateway-20000"></a>7.3.3.3.4 å¯åŠ¨ e-commerce-gateway-20000</h5><h5 id="7-3-3-3-5-æµè§ˆå™¨-é€šè¿‡ç½‘å…³è®¿é—®-http-localhost-20000-member-get-1"><a href="#7-3-3-3-5-æµè§ˆå™¨-é€šè¿‡ç½‘å…³è®¿é—®-http-localhost-20000-member-get-1" class="headerlink" title="7.3.3.3.5 æµè§ˆå™¨**:(é€šè¿‡ç½‘å…³è®¿é—®) http://localhost:20000/member/get/1**"></a>7.3.3.3.5 æµè§ˆå™¨**:(<strong>é€šè¿‡ç½‘å…³è®¿é—®</strong>) <a href="http://localhost:20000/member/get/1">http://localhost:20000/member/get/1</a>**</h5><p>â€‹æµè§ˆå™¨è¾“å…¥**: <a href="http://localhost:20000/member/get/1">http://localhost:20000/member/get/1</a>**</p><h4 id="7-3-3-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#7-3-3-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="7.3.3.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>7.3.3.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><h5 id="7-3-3-4-1-é…ç½®å¥½åŠ¨æ€è·¯ç”±å-Gateway-ä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡åï¼Œä¸ºè¯·æ±‚åˆ›å»ºåŠ¨æ€è·¯ç”±ï¼Œå®ç°-åŠ¨æ€è·¯ç”±-åŠŸèƒ½"><a href="#7-3-3-4-1-é…ç½®å¥½åŠ¨æ€è·¯ç”±å-Gateway-ä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡åï¼Œä¸ºè¯·æ±‚åˆ›å»ºåŠ¨æ€è·¯ç”±ï¼Œå®ç°-åŠ¨æ€è·¯ç”±-åŠŸèƒ½" class="headerlink" title="7.3.3.4.1 é…ç½®å¥½åŠ¨æ€è·¯ç”±å Gateway ä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡åï¼Œä¸ºè¯·æ±‚åˆ›å»ºåŠ¨æ€è·¯ç”±ï¼Œå®ç° åŠ¨æ€è·¯ç”± åŠŸèƒ½"></a><strong>7.3.3.4.1</strong> é…ç½®å¥½åŠ¨æ€è·¯ç”±å <strong>Gateway</strong> ä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡åï¼Œä¸ºè¯·æ±‚åˆ›å»ºåŠ¨æ€è·¯ç”±ï¼Œå®ç° åŠ¨æ€è·¯ç”± åŠŸèƒ½</h5><h5 id="7-3-3-4-2-ä½¿ç”¨çš„-lb-åè®®æ”¯æŒè´Ÿè½½å‡è¡¡-è½®è¯¢ç®—æ³•"><a href="#7-3-3-4-2-ä½¿ç”¨çš„-lb-åè®®æ”¯æŒè´Ÿè½½å‡è¡¡-è½®è¯¢ç®—æ³•" class="headerlink" title="7.3.3.4.2 ä½¿ç”¨çš„ lb åè®®æ”¯æŒè´Ÿè½½å‡è¡¡**-**è½®è¯¢ç®—æ³•"></a><strong>7.3.3.4.2</strong> ä½¿ç”¨çš„ <strong>lb</strong> åè®®æ”¯æŒè´Ÿè½½å‡è¡¡**-**è½®è¯¢ç®—æ³•</h5><h5 id="7-3-3-4-3-é…ç½®è‡ªå·±çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œ-æµ‹è¯•å®Œæ¯•æ¢å¤æˆåŸæ¥çš„è½®è¯¢ç®—æ³•"><a href="#7-3-3-4-3-é…ç½®è‡ªå·±çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œ-æµ‹è¯•å®Œæ¯•æ¢å¤æˆåŸæ¥çš„è½®è¯¢ç®—æ³•" class="headerlink" title="7.3.3.4.3 é…ç½®è‡ªå·±çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œ æµ‹è¯•å®Œæ¯•æ¢å¤æˆåŸæ¥çš„è½®è¯¢ç®—æ³•"></a><strong>7.3.3.4.3</strong> é…ç½®è‡ªå·±çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œ æµ‹è¯•å®Œæ¯•æ¢å¤æˆåŸæ¥çš„è½®è¯¢ç®—æ³•</h5><h2 id="7-4-Predicate-x2F-æ–­è¨€"><a href="#7-4-Predicate-x2F-æ–­è¨€" class="headerlink" title="7.4 Predicate&#x2F;æ–­è¨€"></a>7.4 Predicate&#x2F;æ–­è¨€</h2><h3 id="7-4-1-åŸºæœ¬ä»‹ç»"><a href="#7-4-1-åŸºæœ¬ä»‹ç»" class="headerlink" title="7.4.1 åŸºæœ¬ä»‹ç»"></a><strong>7.4.1</strong> åŸºæœ¬ä»‹ç»</h3><h4 id="7-4-1-1-ä¸€å¥è¯-Predicate-å°±æ˜¯ä¸€ç»„åŒ¹é…è§„åˆ™ï¼Œå½“è¯·æ±‚åŒ¹é…æˆåŠŸï¼Œå°±æ‰§è¡Œå¯¹åº”Route-åŒ¹é…å¤±è´¥ï¼Œæ”¾å¼ƒ-å¤„ç†-x2F-è½¬å‘"><a href="#7-4-1-1-ä¸€å¥è¯-Predicate-å°±æ˜¯ä¸€ç»„åŒ¹é…è§„åˆ™ï¼Œå½“è¯·æ±‚åŒ¹é…æˆåŠŸï¼Œå°±æ‰§è¡Œå¯¹åº”Route-åŒ¹é…å¤±è´¥ï¼Œæ”¾å¼ƒ-å¤„ç†-x2F-è½¬å‘" class="headerlink" title="7.4.1.1 ä¸€å¥è¯: Predicate å°±æ˜¯ä¸€ç»„åŒ¹é…è§„åˆ™ï¼Œå½“è¯·æ±‚åŒ¹é…æˆåŠŸï¼Œå°±æ‰§è¡Œå¯¹åº”Route, åŒ¹é…å¤±è´¥ï¼Œæ”¾å¼ƒ å¤„ç†&#x2F;è½¬å‘"></a>7.4.1.1 ä¸€å¥è¯: Predicate å°±æ˜¯ä¸€ç»„åŒ¹é…è§„åˆ™ï¼Œå½“è¯·æ±‚åŒ¹é…æˆåŠŸï¼Œå°±æ‰§è¡Œå¯¹åº”Route, åŒ¹é…å¤±è´¥ï¼Œæ”¾å¼ƒ å¤„ç†&#x2F;è½¬å‘</h4><h4 id="7-4-1-2-RoutePredicateFactories"><a href="#7-4-1-2-RoutePredicateFactories" class="headerlink" title="7.4.1.2 RoutePredicateFactories"></a>7.4.1.2 RoutePredicateFactories</h4><p><strong>æ–‡æ¡£åœ°å€</strong>: <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories</a></p><ul><li>Spring Cloud GatewayåŒ…æ‹¬è®¸å¤šå†…ç½®çš„Route Predicateå·¥å‚ï¼Œæ‰€æœ‰è¿™äº›Predicateéƒ½ä¸HTTPè¯·æ±‚çš„ä¸åŒå±æ€§åŒ¹é…ï¼Œå¯ä»¥ç»„åˆä½¿ç”¨ï¼</li><li>Spring Cloud Gateway åˆ›å»º Route å¯¹è±¡æ—¶ï¼Œä½¿ç”¨RoutePredicateFactory åˆ›å»ºPredicateå¯¹è±¡ï¼ŒPredicate å¯¹è±¡å¯ä»¥èµ‹å€¼ç»™Routeã€‚</li><li>æ‰€æœ‰è¿™äº›è°“è¯éƒ½åŒ¹é…HTTPè¯·æ±‚çš„ä¸åŒå±æ€§ã€‚å¤šç§è°“è¯å·¥å‚å¯ä»¥ç»„åˆ</li></ul><p>å…¶å®å°±æ˜¯åˆ©ç”¨å·¥å‚ä¸­çš„apiè¿›è¡Œæ–­è¨€</p><h3 id="7-4-2-RoutePredicateå®ä¾‹-æ ¹æ®ä¸Šè¿°æ–‡æ¡£è¿›è¡Œæ“ä½œæ¼”ç¤º"><a href="#7-4-2-RoutePredicateå®ä¾‹-æ ¹æ®ä¸Šè¿°æ–‡æ¡£è¿›è¡Œæ“ä½œæ¼”ç¤º" class="headerlink" title="7.4.2 RoutePredicateå®ä¾‹(æ ¹æ®ä¸Šè¿°æ–‡æ¡£è¿›è¡Œæ“ä½œæ¼”ç¤º)"></a>7.4.2 RoutePredicateå®ä¾‹(æ ¹æ®ä¸Šè¿°æ–‡æ¡£è¿›è¡Œæ“ä½œæ¼”ç¤º)</h3><h4 id="7-4-2-1-AfterRoutePredicate"><a href="#7-4-2-1-AfterRoutePredicate" class="headerlink" title="7.4.2.1 AfterRoutePredicate"></a>7.4.2.1 AfterRoutePredicate</h4><h5 id="7-4-2-1-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#7-4-2-1-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="7.4.2.1.1 éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£"></a><strong>7.4.2.1.1</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</h5><p><strong>1.</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</p><p>â€‹éœ€æ±‚**:** åªæœ‰ 2022-11-18 12:35:50 <u><strong>ä¹‹å</strong></u>çš„è¯·æ±‚æ‰è¿›è¡ŒåŒ¹é…**&#x2F;<strong>è½¬å‘</strong>,** ä¸æ»¡è¶³è¯¥æ¡ä»¶çš„ï¼Œä¸å¤„ç†</p><h5 id="7-4-2-1-2-ä»£ç å®ç°"><a href="#7-4-2-1-2-ä»£ç å®ç°" class="headerlink" title="7.4.2.1.2 ä»£ç å®ç°"></a><strong>7.4.2.1.2</strong> ä»£ç å®ç°</h5><h5 id="1-å‚è€ƒæ–‡æ¡£-https-cloud-spring-io-spring-cloud-static-spring-cloud-gateway-2-2-1-RELEASE-reference-html-gateway-request-predicates-factories"><a href="#1-å‚è€ƒæ–‡æ¡£-https-cloud-spring-io-spring-cloud-static-spring-cloud-gateway-2-2-1-RELEASE-reference-html-gateway-request-predicates-factories" class="headerlink" title="1. å‚è€ƒæ–‡æ¡£ : https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories"></a><strong>1.</strong> å‚è€ƒæ–‡æ¡£ <strong>: <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories</a></strong></h5><p><strong>2.</strong> <strong>ä¿®æ”¹</strong> <strong>e-commerce-gateway-20000</strong> <strong>çš„</strong> <strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">after_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">After=2017-01-20T17:42:47.789-07:00[America/Denver]</span></span><br></pre></td></tr></table></figure><h4 id="7-4-2-2-BeforeRoutePredicate"><a href="#7-4-2-2-BeforeRoutePredicate" class="headerlink" title="7.4.2.2 BeforeRoutePredicate"></a>7.4.2.2 BeforeRoutePredicate</h4><p><strong>1.</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</p><p>éœ€æ±‚**:** åªæœ‰ 2022-11-18 12:35:50 <u><strong>ä¹‹å‰</strong></u>çš„è¯·æ±‚æ‰è¿›è¡ŒåŒ¹é…**&#x2F;<strong>è½¬å‘</strong>,** ä¸æ»¡è¶³è¯¥æ¡ä»¶çš„ï¼Œä¸å¤„ç†</p><h5 id="7-4-2-2-2-ä»£ç å®ç°"><a href="#7-4-2-2-2-ä»£ç å®ç°" class="headerlink" title="7.4.2.2.2 ä»£ç å®ç°"></a><strong>7.4.2.2.2</strong> ä»£ç å®ç°</h5><p><strong>1.</strong> å‚è€ƒæ–‡æ¡£ <strong>: <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories</a></strong></p><p><strong>2.</strong> <strong>ä¿®æ”¹</strong> <strong>e-commerce-gateway-20000</strong> <strong>çš„</strong> <strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">before_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Before=2017-01-20T17:42:47.789-07:00[America/Denver]</span></span><br></pre></td></tr></table></figure><h4 id="7-4-2-3-BetweenRoutePredicate"><a href="#7-4-2-3-BetweenRoutePredicate" class="headerlink" title="7.4.2.3 BetweenRoutePredicate"></a>7.4.2.3 BetweenRoutePredicate</h4><p><strong>1.</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</p><p>éœ€æ±‚**:** åªæœ‰ <strong>2020-11-18 12:35:50</strong> å’Œ <strong>2022-11-18 12:35:50</strong> <u><em>ä¹‹é—´</em></u> çš„è¯·æ±‚æ‰è¿›è¡ŒåŒ¹é…**&#x2F;<strong>è½¬ å‘</strong>,** ä¸æ»¡è¶³è¯¥æ¡ä»¶çš„ï¼Œä¸å¤„ç†</p><h5 id="7-4-2-3-2-ä»£ç å®ç°"><a href="#7-4-2-3-2-ä»£ç å®ç°" class="headerlink" title="7.4.2.3.2 ä»£ç å®ç°"></a><strong>7.4.2.3.2</strong> ä»£ç å®ç°</h5><p><strong>1.</strong> å‚è€ƒæ–‡æ¡£ <strong>: <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories</a></strong></p><p><strong>2.</strong> <strong>ä¿®æ”¹</strong> <strong>e-commerce-gateway-20000</strong> <strong>çš„</strong> <strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">between_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Between=2017-01-20T17:42:47.789-07:00[America/Denver],</span> <span class="number">2017-01-21T17:42:47.789-07:00</span>[<span class="string">America/Denver</span>]</span><br></pre></td></tr></table></figure><h4 id="7-4-2-4-CookieRoutePredicate"><a href="#7-4-2-4-CookieRoutePredicate" class="headerlink" title="7.4.2.4 CookieRoutePredicate"></a>7.4.2.4 CookieRoutePredicate</h4><h5 id="7-4-2-4-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#7-4-2-4-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="7.4.2.4.1 éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£"></a><strong>7.4.2.4.1</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</h5><p>â€‹éœ€æ±‚**:** è¯·æ±‚å¸¦æœ‰ <strong>cookie</strong> é”®**: user** å€¼**: hsp** æ‰åŒ¹é…**&#x2F;**æ–­è¨€æˆåŠŸ</p><p><strong>1.4.2.4.2</strong> ä»£ç å®ç°</p><p><strong>1.</strong> å‚è€ƒæ–‡æ¡£ <strong>: <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gateway-request-predicates-factories</a></strong></p><p><strong>2.</strong> <strong>ä¿®æ”¹</strong> <strong>e-commerce-gateway-20000</strong> <strong>çš„</strong> <strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">cookie_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Cookie=chocolate,</span> <span class="string">ch.p</span></span><br><span class="line">        <span class="comment"># chocolate æ˜¯ cookie åå­— ch.p æ˜¯ cookie çš„å€¼ï¼Œæ˜¯æŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…çš„</span></span><br></pre></td></tr></table></figure><h4 id="7-4-2-5-HeaderRoutePredicate"><a href="#7-4-2-5-HeaderRoutePredicate" class="headerlink" title="7.4.2.5 HeaderRoutePredicate"></a>7.4.2.5 HeaderRoutePredicate</h4><h5 id="7-4-2-5-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#7-4-2-5-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="7.4.2.5.1 éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£"></a><strong>7.4.2.5.1</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</h5><p><strong>1.</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</p><p><strong>éœ€æ±‚</strong>: <strong>è¯·æ±‚å¤´</strong> <strong>Header</strong> <strong>æœ‰</strong> <strong>X-Request-Id</strong>ï¼Œ å¹¶ä¸”å€¼ä¸ºxxxxx æ‰åŒ¹é…&#x2F;æ–­è¨€æˆåŠŸ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">header_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span></span><br><span class="line">        <span class="comment"># X-Request-Id æ˜¯ header çš„åç§°, \d+ æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼</span></span><br></pre></td></tr></table></figure><h4 id="7-4-2-6-HostRoutePredicate"><a href="#7-4-2-6-HostRoutePredicate" class="headerlink" title="7.4.2.6 HostRoutePredicate"></a>7.4.2.6 HostRoutePredicate</h4><h5 id="7-4-2-6-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#7-4-2-6-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="7.4.2.6.1 éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£"></a><strong>7.4.2.6.1</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</h5><p><strong>1.</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</p><p>éœ€æ±‚ï¼š <strong>è¯·æ±‚</strong> <strong>Host</strong> <strong>æ˜¯</strong><em><strong>*.hspedu.*</strong></em> æ‰åŒ¹é…&#x2F;æ–­è¨€æˆåŠŸ <strong>,</strong> <strong>æ¯”å¦‚</strong> <strong>Hostï¼š <a href="http://www.hspedu.com/">www.hspedu.com</a></strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">host_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Host=**.somehost.org,**.anotherhost.org</span></span><br><span class="line">        <span class="comment">#Host å¯ä»¥æœ‰å¤šä¸ª, ä½¿ç”¨é€—å·é—´éš”</span></span><br></pre></td></tr></table></figure><h4 id="7-4-2-7-MethodRoutePredicate"><a href="#7-4-2-7-MethodRoutePredicate" class="headerlink" title="7.4.2.7 MethodRoutePredicate"></a>7.4.2.7 MethodRoutePredicate</h4><p><strong>1.4.2.7.1</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</p><p><strong>éœ€æ±‚</strong>: <strong>è¯·æ±‚æ˜¯</strong> <strong>XXXXXX</strong> <strong>æ–¹å¼æ‰åŒ¹é…</strong>&#x2F;<strong>æ–­è¨€æˆåŠŸ</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">method_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Method=GET,POST</span></span><br><span class="line">        <span class="comment"># è¯·æ±‚æ–¹å¼å¯ä»¥æœ‰å¤šä¸ª, ä½¿ç”¨é€—å·é—´éš”</span></span><br></pre></td></tr></table></figure><h4 id="7-4-2-8-PathRoutePredicate"><a href="#7-4-2-8-PathRoutePredicate" class="headerlink" title="7.4.2.8 PathRoutePredicate"></a>7.4.2.8 PathRoutePredicate</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">host_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/red/&#123;segment&#125;,/blue/&#123;segment&#125;</span></span><br><span class="line">        <span class="comment"># Path å¯ä»¥æœ‰å¤šä¸ª, ä½¿ç”¨é€—å·é—´éš”</span></span><br></pre></td></tr></table></figure><h4 id="7-4-2-9-QueryRoutePredicate"><a href="#7-4-2-9-QueryRoutePredicate" class="headerlink" title="7.4.2.9 QueryRoutePredicate"></a>7.4.2.9 QueryRoutePredicate</h4><h5 id="1-4-2-9-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#1-4-2-9-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="1.4.2.9.1 éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£"></a><strong>1.4.2.9.1</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</h5><p>éœ€æ±‚**:** è¯·æ±‚æœ‰å‚æ•° <strong>email ,<strong>å¹¶ä¸”æ»¡è¶³ç”µå­é‚®ä»¶çš„åŸºæœ¬æ ¼å¼</strong>,</strong> æ‰èƒ½åŒ¹é…**&#x2F;**æ–­è¨€æˆåŠŸ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">query_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Query=red,</span> <span class="string">gree.</span></span><br><span class="line">        <span class="comment">#red æ˜¯å‚æ•°å gree. æ˜¯å€¼, æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼.</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#å¯¹åº”é‚®ç®±ï¼š</span></span><br><span class="line">      <span class="comment"># - Query=email, [\w-]+@([a-zA-Z]+\.)+[a-zA-Z]+</span></span><br></pre></td></tr></table></figure><h4 id="7-4-2-10-RemoteAddr-Route-Predicate"><a href="#7-4-2-10-RemoteAddr-Route-Predicate" class="headerlink" title="7.4.2.10 RemoteAddr Route Predicate"></a>7.4.2.10 RemoteAddr Route Predicate</h4><h5 id="7-4-2-10-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#7-4-2-10-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="7.4.2.10.1 éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£"></a><strong>7.4.2.10.1</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</h5><p><strong>éœ€æ±‚</strong>: <strong>è¯·æ±‚çš„</strong> <strong>IP</strong> <strong>æ˜¯</strong> <strong>127.0.0.1,</strong> <strong>æ‰èƒ½åŒ¹é…</strong>&#x2F;æ–­è¨€æˆåŠŸ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">remoteaddr_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">RemoteAddr=192.168.1.1/24</span></span><br></pre></td></tr></table></figure><h2 id="7-5-Filter-x2F-è¿‡æ»¤å™¨"><a href="#7-5-Filter-x2F-è¿‡æ»¤å™¨" class="headerlink" title="7.5 Filter&#x2F;è¿‡æ»¤å™¨"></a>7.5 Filter&#x2F;è¿‡æ»¤å™¨</h2><h3 id="7-5-1-åŸºæœ¬ä»‹ç»"><a href="#7-5-1-åŸºæœ¬ä»‹ç»" class="headerlink" title="7.5.1 åŸºæœ¬ä»‹ç»"></a><strong>7.5.1</strong> åŸºæœ¬ä»‹ç»</h3><p><strong>1.</strong> æ–‡æ¡£åœ°å€ <strong>: <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gatewayfilter-factories">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#gatewayfilter-factories</a></strong></p><p> <strong>è·¯ç”±è¿‡æ»¤å™¨å¯ç”¨äºä¿®æ”¹è¿›å…¥çš„HTTPè¯·æ±‚å’Œè¿”å›çš„HTTPå“åº”</strong></p><p><strong>Spring Cloud Gateway å†…ç½®äº†å¤šç§è·¯ç”±è¿‡æ»¤å™¨ï¼Œä»–ä»¬éƒ½ç”±GatewayFilterçš„å·¥å‚ç±»æ¥äº§ç”Ÿ</strong></p><h3 id="7-5-2-ç±»å‹"><a href="#7-5-2-ç±»å‹" class="headerlink" title="7.5.2 ç±»å‹"></a><strong>7.5.2</strong> ç±»å‹</h3><h4 id="7-5-2-1-GatewayFilter"><a href="#7-5-2-1-GatewayFilter" class="headerlink" title="7.5.2.1 GatewayFilter"></a>7.5.2.1 GatewayFilter</h4><h4 id="7-5-2-2-GlobalFilter"><a href="#7-5-2-2-GlobalFilter" class="headerlink" title="7.5.2.2 GlobalFilter"></a>7.5.2.2 GlobalFilter</h4><p>ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨å®˜æ–¹çš„filterï¼Œéƒ½æ˜¯è‡ªå®šä¹‰æ»¡è¶³éœ€æ±‚ï¼Œå› æ­¤åªä»‹ç»ä¸€ä¸ªå®˜æ–¹filter</p><h3 id="7-5-3-GatewayFilterä½¿ç”¨"><a href="#7-5-3-GatewayFilterä½¿ç”¨" class="headerlink" title="7.5.3 GatewayFilterä½¿ç”¨"></a><strong>7.5.3 GatewayFilter</strong>ä½¿ç”¨</h3><h4 id="7-5-3-1-å¼€å‘ç›´æ¥ä½¿ç”¨-GatewayFilter-è¾ƒå°‘ï¼Œä¸€èˆ¬æ˜¯è‡ªå®šä¹‰è¿‡æ»¤å™¨"><a href="#7-5-3-1-å¼€å‘ç›´æ¥ä½¿ç”¨-GatewayFilter-è¾ƒå°‘ï¼Œä¸€èˆ¬æ˜¯è‡ªå®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="7.5.3.1 å¼€å‘ç›´æ¥ä½¿ç”¨ GatewayFilter è¾ƒå°‘ï¼Œä¸€èˆ¬æ˜¯è‡ªå®šä¹‰è¿‡æ»¤å™¨"></a>7.5.3.1 å¼€å‘ç›´æ¥ä½¿ç”¨ GatewayFilter è¾ƒå°‘ï¼Œä¸€èˆ¬æ˜¯è‡ªå®šä¹‰è¿‡æ»¤å™¨</h4><p>â€‹æ¼”ç¤ºï¼šThe AddRequestParameter GatewayFilter Factory</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">add_request_parameter_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestParameter=color,</span> <span class="string">blue</span></span><br></pre></td></tr></table></figure><h3 id="7-5-4-è‡ªå®šä¹‰-GlobalFilter"><a href="#7-5-4-è‡ªå®šä¹‰-GlobalFilter" class="headerlink" title="7.5.4 è‡ªå®šä¹‰ GlobalFilter"></a><strong>7.5.4</strong> è‡ªå®šä¹‰ <strong>GlobalFilter</strong></h3><h4 id="7-5-4-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#7-5-4-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="7.5.4.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>7.5.4.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>1.</strong> è‡ªå®šä¹‰å…¨å±€ <strong>GlobalFilter</strong> è¿‡æ»¤å™¨<br><strong>2.</strong> å¦‚æœè¯·æ±‚å‚æ•° <strong>user&#x3D;hspedu , pwd&#x3D;123456</strong> åˆ™æ”¾è¡Œ**,** å¦åˆ™ä¸èƒ½é€šè¿‡éªŒè¯</p><h4 id="7-5-4-2-ä»£ç å®ç°"><a href="#7-5-4-2-ä»£ç å®ç°" class="headerlink" title="7.5.4.2 ä»£ç å®ç°"></a>7.5.4.2 ä»£ç å®ç°</h4><p><strong>1.</strong> åœ¨ <strong>e-commerce-gateway-20000</strong> åˆ›å»º<strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;filter&#x2F;CustomGateWayFilter.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/6/1</span></span><br><span class="line"><span class="comment"> * 11:14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomGateWayFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//filteræ˜¯æ ¸å¿ƒçš„æ–¹æ³•ï¼Œå°†æˆ‘ä»¬çš„è¿‡æ»¤ä¸šåŠ¡å†™åœ¨è¯¥æ–¹æ³•ä¸­</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="comment">//å…ˆè·å–åˆ°å¯¹åº”çš„å‚æ•°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span></span><br><span class="line">                exchange.getRequest().getQueryParams().getFirst(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span></span><br><span class="line">                exchange.getRequest().getQueryParams().getFirst(<span class="string">&quot;pwd&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="string">&quot;hspedu&quot;</span>.equals(user) &amp;&amp; <span class="string">&quot;123456&quot;</span>.equals(pwd)))&#123;</span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¡¨ç¤ºè¿‡æ»¤å™¨æ‰§è¡Œçš„é¡ºåºï¼Œæ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-5-4-3-æµ‹è¯•"><a href="#7-5-4-3-æµ‹è¯•" class="headerlink" title="7.5.4.3 æµ‹è¯•"></a>7.5.4.3 æµ‹è¯•</h4><h5 id="7-5-4-3-1-å¯åŠ¨-e-commerce-eureka-server-9001"><a href="#7-5-4-3-1-å¯åŠ¨-e-commerce-eureka-server-9001" class="headerlink" title="7.5.4.3.1 å¯åŠ¨ e-commerce-eureka-server-9001"></a><strong>7.5.4.3.1</strong> å¯åŠ¨ e-commerce-eureka-server-9001</h5><h5 id="7-5-4-3-2-å¯åŠ¨-member-service-provider-10000-x2F-10002"><a href="#7-5-4-3-2-å¯åŠ¨-member-service-provider-10000-x2F-10002" class="headerlink" title="7.5.4.3.2 å¯åŠ¨ member-service-provider-10000&#x2F;10002"></a>7.5.4.3.2 å¯åŠ¨ member-service-provider-10000&#x2F;10002</h5><h5 id="7-5-4-3-3-å¯åŠ¨-e-commerce-gateway-20000"><a href="#7-5-4-3-3-å¯åŠ¨-e-commerce-gateway-20000" class="headerlink" title="7.5.4.3.3 å¯åŠ¨ e-commerce-gateway-20000"></a>7.5.4.3.3 å¯åŠ¨ e-commerce-gateway-20000</h5><h5 id="7-5-4-3-4-æµè§ˆå™¨-é€šè¿‡ç½‘å…³è®¿é—®-http-localhost-20000-member-get-1-user-hspedu-amp-pwd-123456-è¾“å…¥-http-localhost-20000-member-get-1-user-hspedu-amp-pwd-123456"><a href="#7-5-4-3-4-æµè§ˆå™¨-é€šè¿‡ç½‘å…³è®¿é—®-http-localhost-20000-member-get-1-user-hspedu-amp-pwd-123456-è¾“å…¥-http-localhost-20000-member-get-1-user-hspedu-amp-pwd-123456" class="headerlink" title="7.5.4.3.4 æµè§ˆå™¨**:(é€šè¿‡ç½‘å…³è®¿é—®) http://localhost:20000/member/get/1?user=hspedu&amp;pwd=123456** è¾“å…¥**: http://localhost:20000/member/get/1?user=hspedu&amp;pwd=123456**"></a>7.5.4.3.4 æµè§ˆå™¨**:(<strong>é€šè¿‡ç½‘å…³è®¿é—®</strong>) <a href="http://localhost:20000/member/get/1?user=hspedu&pwd=123456">http://localhost:20000/member/get/1?user=hspedu&amp;pwd=123456</a>** è¾“å…¥**: <a href="http://localhost:20000/member/get/1?user=hspedu&pwd=123456">http://localhost:20000/member/get/1?user=hspedu&amp;pwd=123456</a>**</h5><h4 id="7-5-4-4-æµ‹è¯•å®Œæ¯•ï¼Œè®°å¾—ä»£ç æ¢å¤åˆ°æµ‹è¯•å‰"><a href="#7-5-4-4-æµ‹è¯•å®Œæ¯•ï¼Œè®°å¾—ä»£ç æ¢å¤åˆ°æµ‹è¯•å‰" class="headerlink" title="7.5.4.4 æµ‹è¯•å®Œæ¯•ï¼Œè®°å¾—ä»£ç æ¢å¤åˆ°æµ‹è¯•å‰"></a>7.5.4.4 æµ‹è¯•å®Œæ¯•ï¼Œè®°å¾—ä»£ç æ¢å¤åˆ°æµ‹è¯•å‰</h4><h1 id="8-SpringCloud-Sleuth-Zipkin-æœåŠ¡è·Ÿè¸ª"><a href="#8-SpringCloud-Sleuth-Zipkin-æœåŠ¡è·Ÿè¸ª" class="headerlink" title="8 SpringCloud Sleuth+Zipkin æœåŠ¡è·Ÿè¸ª"></a>8 SpringCloud Sleuth+Zipkin æœåŠ¡è·Ÿè¸ª</h1><h2 id="8-1-Sleuth-x2F-ZipKinåŸºç¡€"><a href="#8-1-Sleuth-x2F-ZipKinåŸºç¡€" class="headerlink" title="8.1 Sleuth&#x2F;ZipKinåŸºç¡€"></a>8.1 Sleuth&#x2F;ZipKinåŸºç¡€</h2><h3 id="8-1-1-å®˜ç½‘"><a href="#8-1-1-å®˜ç½‘" class="headerlink" title="8.1.1 å®˜ç½‘"></a><strong>8.1.1</strong> å®˜ç½‘</h3><h4 id="8-1-1-1-https-github-com-spring-cloud-spring-cloud-sleuth"><a href="#8-1-1-1-https-github-com-spring-cloud-spring-cloud-sleuth" class="headerlink" title="8.1.1.1 https://github.com/spring-cloud/spring-cloud-sleuth"></a>8.1.1.1 <a href="https://github.com/spring-cloud/spring-cloud-sleuth">https://github.com/spring-cloud/spring-cloud-sleuth</a></h4><h3 id="8-1-2-Sleuth-x2F-Zipkinæ˜¯ä»€ä¹ˆ"><a href="#8-1-2-Sleuth-x2F-Zipkinæ˜¯ä»€ä¹ˆ" class="headerlink" title="8.1.2 Sleuth&#x2F;Zipkinæ˜¯ä»€ä¹ˆ?"></a><strong>8.1.2 Sleuth&#x2F;Zipkin</strong>æ˜¯ä»€ä¹ˆ?</h3><h4 id="8-1-2-1-æ¦‚è¿°-ä¸¤å¼ å›¾"><a href="#8-1-2-1-æ¦‚è¿°-ä¸¤å¼ å›¾" class="headerlink" title="8.1.2.1 æ¦‚è¿°(ä¸¤å¼ å›¾)"></a>8.1.2.1 æ¦‚è¿°(ä¸¤å¼ å›¾)</h4><ol><li><p>åœ¨å¾®æœåŠ¡æ¡†æ¶ä¸­ï¼Œä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚åœ¨åç«¯ç³»ç»Ÿä¸­ä¼šç»è¿‡å¤šä¸ªä¸åŒçš„æœåŠ¡èŠ‚ç‚¹è°ƒç”¨**,** æ¥ååŒäº§ç”Ÿæœ€åçš„è¯·æ±‚ç»“æœï¼Œæ¯ä¸€ä¸ªè¯·æ±‚éƒ½ä¼šå½¢æˆä¸€æ¡å¤æ‚çš„åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨é“¾è·¯</p></li><li><p>é“¾è·¯ä¸­çš„ä»»ä½•ä¸€ç¯å‡ºç°é«˜å»¶æ—¶æˆ–é”™è¯¯éƒ½ä¼šå¼•èµ·æ•´ä¸ªè¯·æ±‚æœ€åçš„å¤±è´¥,å› æ­¤<u>å¯¹æ•´ä¸ªæœåŠ¡çš„è°ƒç”¨è¿›è¡Œé“¾è·¯è¿½è¸ªå’Œåˆ†æ</u>å°±éå¸¸çš„é‡è¦</p></li><li><p>Sleuth å’Œ Zipkinç®€å•å…³ç³»å›¾</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230601125136474.png" alt="image-20230601125136474"></p><h4 id="8-1-2-2-ä¸€å¥è¯-Sleuth-æä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆ-å¹¶å…¼å®¹-Zipkin"><a href="#8-1-2-2-ä¸€å¥è¯-Sleuth-æä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆ-å¹¶å…¼å®¹-Zipkin" class="headerlink" title="8.1.2.2 ä¸€å¥è¯: Sleuth æä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆ å¹¶å…¼å®¹ Zipkin"></a>8.1.2.2 ä¸€å¥è¯: Sleuth æä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆ å¹¶å…¼å®¹ Zipkin</h4><h4 id="8-1-2-3-æ¢³ç†-ğŸŒŸSleuth-åšé“¾è·¯è¿½è¸ª-Zipkin-åšæ•°æ®æœé›†-x2F-å­˜å‚¨-x2F-å¯è§†åŒ–"><a href="#8-1-2-3-æ¢³ç†-ğŸŒŸSleuth-åšé“¾è·¯è¿½è¸ª-Zipkin-åšæ•°æ®æœé›†-x2F-å­˜å‚¨-x2F-å¯è§†åŒ–" class="headerlink" title="8.1.2.3 æ¢³ç†: ğŸŒŸSleuth åšé“¾è·¯è¿½è¸ª , Zipkin åšæ•°æ®æœé›†&#x2F;å­˜å‚¨&#x2F;å¯è§†åŒ–"></a>8.1.2.3 æ¢³ç†: ğŸŒŸ<u>Sleuth åšé“¾è·¯è¿½è¸ª , Zipkin åšæ•°æ®æœé›†&#x2F;å­˜å‚¨&#x2F;å¯è§†åŒ–</u></h4><h3 id="8-1-3-Sleuthå·¥ä½œåŸç†"><a href="#8-1-3-Sleuthå·¥ä½œåŸç†" class="headerlink" title="8.1.3 Sleuthå·¥ä½œåŸç†"></a><strong>8.1.3 Sleuth</strong>å·¥ä½œåŸç†</h3><p><strong>1. Span</strong> å’Œ <strong>Trace</strong> åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ä½¿ç”¨ <strong>Zipkin</strong> çš„è¿‡ç¨‹**-**å›¾å½¢åŒ–</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230603152155135.png" alt="image-20230603152155135"></p><ul><li><p>è¡¨ç¤ºä¸€è¯·æ±‚é“¾è·¯ï¼Œä¸€æ¡é“¾è·¯é€šè¿‡Trace idå”¯ä¸€æ ‡è¯†ï¼Œspanæ ‡è¯†å‘èµ·çš„è¯·æ±‚ä¿¡æ¯ï¼Œå„spané€šè¿‡parent idå…³è”èµ·æ¥</p></li><li><p>Traceï¼šç±»ä¼¼äºæ ‘ç»“æ„çš„Spané›†åˆï¼Œè¡¨ç¤ºä¸€æ¡è°ƒç”¨é“¾è·¯ï¼Œå­˜åœ¨å”¯ä¸€æ ‡è¯† (ä¸€æ¡è¯·æ±‚é“¾è·¯åªæœ‰å”¯ä¸€ä¸€ä¸ªTrace id)</p></li><li><p>Spanï¼šåŸºæœ¬å·¥ä½œå•å…ƒï¼Œè¡¨ç¤ºè°ƒç”¨é“¾è·¯æ¥æºï¼Œé€šä¿—çš„ç†è§£spanå°±æ˜¯ä¸€æ¬¡è¯·æ±‚ä¿¡æ¯</p></li></ul><p><strong>2. spans</strong> <strong>çš„</strong> <strong>parent&#x2F;child</strong> <strong>å…³ç³»å›¾å½¢åŒ–</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230603152459615.png" alt="image-20230603152459615"></p><ul><li><p>å°ä¼™ä¼´æ³¨æ„çœ‹è€å¸ˆæ ‡è¯†çš„çº¢çº¿ï¼Œåä¸€ä¸ªspanèŠ‚ç‚¹çš„parentid æŒ‡å‘&#x2F;è®°å½• äº†ä¸Šä¸€ä¸ªSpanç»“ç‚¹</p></li><li><p>spanå°±æ˜¯ä¸€æ¬¡è¯·æ±‚ä¿¡æ¯</p></li><li><p>å¤šä¸ªSpané›†åˆå°±æ„æˆ<u>ä¸€æ¡è°ƒç”¨é“¾è·¯</u></p></li><li><p>åœ¨span&#x3D;C è¿™ä¸ªèŠ‚ç‚¹å­˜åœ¨åˆ†æ”¯</p></li></ul><h2 id="8-2-Sleuth-x2F-ZipKin-æ­å»ºé“¾è·¯ç›‘æ§å®ä¾‹"><a href="#8-2-Sleuth-x2F-ZipKin-æ­å»ºé“¾è·¯ç›‘æ§å®ä¾‹" class="headerlink" title="8.2 Sleuth&#x2F;ZipKin-æ­å»ºé“¾è·¯ç›‘æ§å®ä¾‹"></a>8.2 Sleuth&#x2F;ZipKin-æ­å»ºé“¾è·¯ç›‘æ§å®ä¾‹</h2><h3 id="8-2-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£"><a href="#8-2-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£" class="headerlink" title="8.2.1 éœ€æ±‚è¯´æ˜**&#x2F;**å›¾è§£"></a><strong>8.2.1</strong> éœ€æ±‚è¯´æ˜**&#x2F;**å›¾è§£</h3><p><strong>è¦æ±‚</strong>: <strong>é€šè¿‡</strong> <strong>Sleuth</strong> <strong>å’Œ</strong> <strong>Zipkin</strong> <strong>å¯ä»¥å¯¹</strong>æœåŠ¡è°ƒç”¨é“¾è·¯<strong>è¿›è¡Œç›‘æ§</strong>, <strong>å¹¶åœ¨</strong> <strong>Zipkin</strong> <strong>è¿›è¡Œæ˜¾ç¤º</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230603152942262.png" alt="image-20230603152942262"></p><h3 id="8-2-2-å®‰è£…-x2F-ä½¿ç”¨-Zipkin"><a href="#8-2-2-å®‰è£…-x2F-ä½¿ç”¨-Zipkin" class="headerlink" title="8.2.2 å®‰è£…**&#x2F;**ä½¿ç”¨ Zipkin"></a><strong>8.2.2</strong> å®‰è£…**&#x2F;**ä½¿ç”¨ <strong>Zipkin</strong></h3><h4 id="8-2-2-1-ä¸‹è½½"><a href="#8-2-2-1-ä¸‹è½½" class="headerlink" title="8.2.2.1 ä¸‹è½½"></a>8.2.2.1 ä¸‹è½½</h4><ol><li><p>ä¸‹è½½åœ°å€ï¼š<a href="https://repo1.maven.org/maven2/io/zipkin/zipkin-server/">https://repo1.maven.org/maven2/io/zipkin/zipkin-server/</a></p></li><li><p>å¾—åˆ° zipkin-server-2.14.1-exec.jar</p></li></ol><h4 id="8-2-2-2-è¿è¡Œ"><a href="#8-2-2-2-è¿è¡Œ" class="headerlink" title="8.2.2.2 è¿è¡Œ"></a>8.2.2.2 è¿è¡Œ</h4><ol><li>è¿›å…¥ zipkin-server-2.14.1-exec.jar æ‰€åœ¨ç›®å½•çš„ç»ˆç«¯</li><li>æ‰§è¡Œå‘½ä»¤  java -jar zipkin-server-2.14.1-exec.jar    å¼€å¯zipkinæœåŠ¡</li></ol><h4 id="8-2-2-3-è®¿é—®"><a href="#8-2-2-3-è®¿é—®" class="headerlink" title="8.2.2.3 è®¿é—®"></a>8.2.2.3 è®¿é—®</h4><p>â€‹æµè§ˆå™¨è¾“å…¥**:<a href="http://localhost:9411/zipkin/">http://localhost:9411/zipkin/</a>**</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230603225430611.png" alt="image-20230603225430611"></p><h3 id="8-2-3-æœåŠ¡æä¾›æ–¹é›†æˆ-Sleuth-x2F-Zipkin"><a href="#8-2-3-æœåŠ¡æä¾›æ–¹é›†æˆ-Sleuth-x2F-Zipkin" class="headerlink" title="8.2.3 æœåŠ¡æä¾›æ–¹é›†æˆ Sleuth&#x2F;Zipkin"></a><strong>8.2.3</strong> æœåŠ¡æä¾›æ–¹é›†æˆ <strong>Sleuth&#x2F;Zipkin</strong></h3><p><strong>1.</strong> ä¿®æ”¹ <strong>member-service-provider-10000</strong> çš„ <strong>pom.xml ,</strong> å¢åŠ å¼•å…¥ <strong>sleuth+zipkin</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    å¼•å…¥sleuthä¸zipkinç›¸å…³ä¾èµ–    --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--åŒ…å«äº† sleuth+zipkin--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230603230040079.png" alt="image-20230603230040079" style="zoom:50%;" /><p><strong>2.</strong> <strong>ä¿®æ”¹</strong> <strong>member-service-provider-10000</strong> <strong>çš„</strong> <strong>appliaction.xml ,</strong> <strong>æŒ‡å®š</strong> <strong>Zipkin</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-provider</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/e_commerce_center_db?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">QWEASDzxc123</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="comment">#é…ç½®sleuthå’Œzipkin</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">base-url:</span> <span class="string">http://localhost:9411</span></span><br><span class="line">  <span class="attr">sleuth:</span></span><br><span class="line">    <span class="attr">sampler:</span></span><br><span class="line">      <span class="comment"># é‡‡æ ·ç‡ åœ¨0ï½1ä¹‹é—´ï¼Œ1è¡¨ç¤ºå…¨éƒ¨é‡‡é›†</span></span><br><span class="line">      <span class="attr">probability:</span> <span class="number">1</span></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.study.springcloud.entity</span></span><br><span class="line"><span class="comment">#é…ç½®eureka-client</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span> <span class="comment">#å°†è‡ªå·±æ³¨å†Œåˆ°Eureka-server</span></span><br><span class="line">    <span class="comment">#è¡¨ç¤ºä»Eureka-serveræŠ“å–æ³¨å†Œä¿¡æ¯</span></span><br><span class="line">    <span class="comment">#å¦‚æœæ˜¯å•èŠ‚ç‚¹ï¼Œå¯ä»¥ä¸é…ç½®ï¼›</span></span><br><span class="line">    <span class="comment">#ä½†æ˜¯provideræ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œåˆ™å¿…é¡»å°†æ­¤é¡¹é…ç½®ä¸ºtrueï¼Œè¿™æ ·æ‰èƒ½é…åˆRibbonä½¿ç”¨è´Ÿè½½å‡è¡¡åŠŸèƒ½</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment"># è¡¨ç¤ºå°†è‡ªå·±æ³¨å†Œåˆ°å“ªä¸ªeureka-</span></span><br><span class="line">      <span class="comment"># å°†æœ¬æœåŠ¡æ³¨å†Œåˆ°å¤šä¸ªeureka-serverï¼Œä½¿ç”¨é€—å·é—´éš”å³å¯</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka9001.com:9001/eureka,http://eureka9002.com:9002/eureka</span></span><br><span class="line"><span class="comment">#  instance:</span></span><br><span class="line">    <span class="comment">#1ç§’å‘é€ä¸€æ¬¡å¿ƒè·³(é»˜è®¤æ˜¯90ç§’</span></span><br><span class="line"><span class="comment">#    lease-renewal-interval-in-seconds: 1</span></span><br><span class="line">    <span class="comment">#æœåŠ¡ç«¯æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åçš„ç­‰å¾…æ—¶é—´ä¸Šé™</span></span><br><span class="line"><span class="comment">#    lease-expiration-duration-in-seconds: 2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="8-2-4-æœåŠ¡æ¶ˆè´¹æ–¹é›†æˆ-Sleuth-x2F-Zipkin"><a href="#8-2-4-æœåŠ¡æ¶ˆè´¹æ–¹é›†æˆ-Sleuth-x2F-Zipkin" class="headerlink" title="8.2.4 æœåŠ¡æ¶ˆè´¹æ–¹é›†æˆ Sleuth&#x2F;Zipkin"></a>8.2.4 æœåŠ¡æ¶ˆè´¹æ–¹é›†æˆ Sleuth&#x2F;Zipkin</h3><p><strong>1.</strong> ä¿®æ”¹ <strong>member-service-consumer-80</strong> çš„ <strong>pom.xml ,</strong> å¢åŠ å¼•å…¥ <strong>sleuth+zipkin</strong></p><p><strong>2.</strong> ä¿®æ”¹ <strong>member-service-consumer-80</strong> çš„ <strong>appliaction.xml ,</strong> æŒ‡å®š <strong>Zipkin</strong></p><h3 id="8-2-5-æµ‹è¯•"><a href="#8-2-5-æµ‹è¯•" class="headerlink" title="8.2.5 æµ‹è¯•"></a><strong>8.2.5</strong> æµ‹è¯•</h3><h4 id="8-2-5-1-å¯åŠ¨-e-commerce-eureka-server-9001"><a href="#8-2-5-1-å¯åŠ¨-e-commerce-eureka-server-9001" class="headerlink" title="8.2.5.1 å¯åŠ¨ e-commerce-eureka-server-9001"></a>8.2.5.1 å¯åŠ¨ e-commerce-eureka-server-9001</h4><h4 id="8-2-5-2-å¯åŠ¨-member-service-provider-10000"><a href="#8-2-5-2-å¯åŠ¨-member-service-provider-10000" class="headerlink" title="8.2.5.2 å¯åŠ¨ member-service-provider-10000"></a>8.2.5.2 å¯åŠ¨ member-service-provider-10000</h4><h4 id="8-2-5-3-å¯åŠ¨-member-service-consumer-80"><a href="#8-2-5-3-å¯åŠ¨-member-service-consumer-80" class="headerlink" title="8.2.5.3 å¯åŠ¨ member-service-consumer-80"></a>8.2.5.3 å¯åŠ¨ member-service-consumer-80</h4><h4 id="8-2-5-4-æµè§ˆå™¨-æµè§ˆå™¨è¾“å…¥-http-localhost-member-consumer-get-1"><a href="#8-2-5-4-æµè§ˆå™¨-æµè§ˆå™¨è¾“å…¥-http-localhost-member-consumer-get-1" class="headerlink" title="8.2.5.4 æµè§ˆå™¨: æµè§ˆå™¨è¾“å…¥: http://localhost/member/consumer/get/1"></a>8.2.5.4 æµè§ˆå™¨: æµè§ˆå™¨è¾“å…¥: <a href="http://localhost/member/consumer/get/1">http://localhost/member/consumer/get/1</a></h4><h3 id="8-2-6-æŸ¥çœ‹ç›‘æ§-amp-åˆ†æç»“æœ"><a href="#8-2-6-æŸ¥çœ‹ç›‘æ§-amp-åˆ†æç»“æœ" class="headerlink" title="8.2.6 æŸ¥çœ‹ç›‘æ§**&amp;**åˆ†æç»“æœ"></a>8.2.6 æŸ¥çœ‹ç›‘æ§**&amp;**åˆ†æç»“æœ</h3><h4 id="8-2-6-1-æŸ¥çœ‹ç›‘æ§-amp-åˆ†æç»“æœ"><a href="#8-2-6-1-æŸ¥çœ‹ç›‘æ§-amp-åˆ†æç»“æœ" class="headerlink" title="8.2.6.1 æŸ¥çœ‹ç›‘æ§&amp;åˆ†æç»“æœ"></a>8.2.6.1 æŸ¥çœ‹ç›‘æ§&amp;åˆ†æç»“æœ</h4><p><strong>1.</strong> æŸ¥çœ‹ **Zipkin : <a href="http://localhost:9411/zipkin/">http://localhost:9411/zipkin/</a> **</p><p><strong>2.</strong> <strong>é€‰æ‹©æŸä¸ªæœåŠ¡ï¼Œçœ‹ç»“æœ</strong></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230604102426067.png" alt="image-20230604102426067" style="zoom:50%;" /><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230604102442418.png" alt="image-20230604102442418" style="zoom:50%;" /><p><strong>3.</strong> æŸ¥çœ‹ä¸€æ¬¡è°ƒç”¨é“¾è·¯çš„æ·±åº¦ï¼Œä»¥åŠè¯¥é“¾è·¯åŒ…å«è¯·æ±‚,å„ä¸ªè¯·æ±‚è€—æ—¶ï¼Œ**<u><em>æ‰¾åˆ°è¯·æ±‚ç“¶é¢ˆï¼Œä¸ºä¼˜åŒ–æä¾›ä¾æ®</em></u>**(é‡è¦)</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230604102455803.png" alt="image-20230604102455803" style="zoom:50%;" /><p><strong>4.</strong> <strong>æŸ¥çœ‹æœåŠ¡è°ƒç”¨çš„ä¾èµ–å…³ç³»</strong></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230604102509066.png" alt="image-20230604102509066" style="zoom:50%;" /><h1 id="9-ğŸŒŸSpringCloudAlibabaNacos-æœåŠ¡æ³¨å†Œä¸­å¿ƒ-æœåŠ¡é…ç½®"><a href="#9-ğŸŒŸSpringCloudAlibabaNacos-æœåŠ¡æ³¨å†Œä¸­å¿ƒ-æœåŠ¡é…ç½®" class="headerlink" title="9 ğŸŒŸSpringCloudAlibabaNacos æœåŠ¡æ³¨å†Œä¸­å¿ƒ+æœåŠ¡é…ç½®"></a>9 ğŸŒŸSpringCloudAlibabaNacos æœåŠ¡æ³¨å†Œä¸­å¿ƒ+æœåŠ¡é…ç½®</h1><h2 id="9-1-NacosåŸºç¡€"><a href="#9-1-NacosåŸºç¡€" class="headerlink" title="9.1 NacosåŸºç¡€"></a>9.1 NacosåŸºç¡€</h2><h3 id="9-1-1-å®˜ç½‘"><a href="#9-1-1-å®˜ç½‘" class="headerlink" title="9.1.1 å®˜ç½‘"></a>9.1.1 å®˜ç½‘</h3><h4 id="9-1-1-1-https-github-com-alibaba-Nacos"><a href="#9-1-1-1-https-github-com-alibaba-Nacos" class="headerlink" title="9.1.1.1 https://github.com/alibaba/Nacos"></a>9.1.1.1 <a href="https://github.com/alibaba/Nacos">https://github.com/alibaba/Nacos</a></h4><h3 id="9-1-2-Nacosæ˜¯ä»€ä¹ˆ"><a href="#9-1-2-Nacosæ˜¯ä»€ä¹ˆ" class="headerlink" title="9.1.2 Nacosæ˜¯ä»€ä¹ˆ?"></a>9.1.2 Nacosæ˜¯ä»€ä¹ˆ?</h3><h4 id="9-1-2-1-ä¸€å¥è¯-Nacos-å°±æ˜¯æ³¨å†Œä¸­å¿ƒ-æ›¿ä»£-Eureka-é…ç½®ä¸­å¿ƒ-æ›¿ä»£-Config"><a href="#9-1-2-1-ä¸€å¥è¯-Nacos-å°±æ˜¯æ³¨å†Œä¸­å¿ƒ-æ›¿ä»£-Eureka-é…ç½®ä¸­å¿ƒ-æ›¿ä»£-Config" class="headerlink" title="9.1.2.1 ä¸€å¥è¯: Nacos å°±æ˜¯æ³¨å†Œä¸­å¿ƒ[æ›¿ä»£ Eureka]+é…ç½®ä¸­å¿ƒ[æ›¿ä»£ Config]"></a>9.1.2.1 ä¸€å¥è¯: <u>Nacos å°±æ˜¯æ³¨å†Œä¸­å¿ƒ[æ›¿ä»£ Eureka]+é…ç½®ä¸­å¿ƒ[æ›¿ä»£ Config]</u></h4><h4 id="9-1-2-2-Nacos-Dynamic-Naming-and-Configuration-Service"><a href="#9-1-2-2-Nacos-Dynamic-Naming-and-Configuration-Service" class="headerlink" title="9.1.2.2 Nacos:Dynamic Naming and Configuration Service"></a>9.1.2.2 Nacos:Dynamic Naming and Configuration Service</h4><h4 id="9-1-2-3-Nacos-æ¶æ„ç†è®ºåŸºç¡€-CAP-ç†è®º-æ”¯æŒ-AP-å’Œ-CP-å¯ä»¥åˆ‡æ¢"><a href="#9-1-2-3-Nacos-æ¶æ„ç†è®ºåŸºç¡€-CAP-ç†è®º-æ”¯æŒ-AP-å’Œ-CP-å¯ä»¥åˆ‡æ¢" class="headerlink" title="9.1.2.3 Nacos:æ¶æ„ç†è®ºåŸºç¡€: CAP ç†è®º (æ”¯æŒ AP å’Œ CP, å¯ä»¥åˆ‡æ¢)"></a>9.1.2.3 Nacos:æ¶æ„ç†è®ºåŸºç¡€: CAP ç†è®º (æ”¯æŒ AP å’Œ CP, å¯ä»¥åˆ‡æ¢)</h4><p>CAPç†è®ºï¼š</p><p>â€‹ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³<strong>ä¸€è‡´æ€§</strong>ï¼ˆConsistencyï¼‰ã€<strong>å¯ç”¨æ€§</strong>ï¼ˆAvailabilityï¼‰å’Œ<strong>åˆ†åŒºå®¹é”™æ€§</strong>ï¼ˆPartition toleranceï¼‰è¿™ä¸‰é¡¹ä¸­çš„ä¸¤é¡¹ã€‚</p><ul><li><strong>ä¸€è‡´æ€§</strong>æŒ‡ â€œall nodes see the same data at the same timeâ€ï¼Œå³æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çš„æ•°æ®å®Œå…¨ä¸€è‡´ã€‚å³å¤šå‰¯æœ¬ï¼ˆReplicationsï¼‰é—®é¢˜ä¸­çš„æ•°æ®ä¸€è‡´æ€§</li><li><strong>å¯ç”¨æ€§</strong>æŒ‡â€œ<code>Reads and writes always succeed</code>â€ï¼Œå³æœåŠ¡åœ¨æ­£å¸¸å“åº”æ—¶é—´å†…ä¸€ç›´å¯ç”¨ã€‚å¥½çš„å¯ç”¨æ€§ä¸»è¦æ˜¯æŒ‡ç³»ç»Ÿèƒ½å¤Ÿå¾ˆå¥½çš„ä¸ºç”¨æˆ·æœåŠ¡ï¼Œä¸å‡ºç°ç”¨æˆ·æ“ä½œå¤±è´¥æˆ–è€…è®¿é—®è¶…æ—¶ç­‰ç”¨æˆ·ä½“éªŒä¸å¥½çš„æƒ…å†µã€‚</li><li><strong>åˆ†åŒºå®¹é”™æ€§</strong>æŒ‡â€œthe system continues to operate despite arbitrary message loss or failure of part of the systemâ€ï¼Œå³åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°æŸèŠ‚ç‚¹æˆ–ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§æˆ–å¯ç”¨æ€§çš„æœåŠ¡ã€‚</li></ul><p>æ¯”å¦‚å¯¹äºä¸¤ä¸ªç»“ç‚¹å¦‚æœå®ƒä»¬ä¹‹é—´çš„ç½‘ç»œæ–­å¼€äº†ï¼Œæˆ‘ä»¬å‡è®¾éœ€è¦æ»¡è¶³åˆ†åŒºå®¹é”™æ€§ï¼Œé‚£ä¹ˆä¸€å®šè¦åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¹‹é—´è¿›è¡Œå–èˆ(åˆ†åŒºå®¹é”™æ€§æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ»¡è¶³ä¸€è‡´æ€§é‚£å°±å¿…é¡»ç­‰å¾…ç½‘ç»œæ¢å¤åæ•°æ®è¿›è¡ŒåŒæ­¥åæ‰èƒ½æä¾›æœåŠ¡â€”â€”æ”¾å¼ƒäº†å¯ç”¨æ€§ï¼›åä¹‹ï¼Œå¦‚æœé€‰æ‹©äº†å¯ç”¨æ€§ï¼Œé‚£ä¹ˆä¸¤ä¸ªç»“ç‚¹æä¾›çš„æ•°æ®ä¸€å®šä¸èƒ½ä¿è¯ä¸€è‡´æ€§â€”â€”ç‰ºç‰²äº†ä¸€è‡´æ€§)</p><h3 id="9-1-3-Nacosä¸‹è½½-amp-è¿è¡Œ"><a href="#9-1-3-Nacosä¸‹è½½-amp-è¿è¡Œ" class="headerlink" title="9.1.3 Nacosä¸‹è½½&amp;è¿è¡Œ"></a>9.1.3 Nacosä¸‹è½½&amp;è¿è¡Œ</h3><h4 id="9-1-3-1-ä¸‹è½½-https-github-com-alibaba-nacos-releases-tag-1-2-1"><a href="#9-1-3-1-ä¸‹è½½-https-github-com-alibaba-nacos-releases-tag-1-2-1" class="headerlink" title="9.1.3.1 ä¸‹è½½: https://github.com/alibaba/nacos/releases/tag/1.2.1"></a>9.1.3.1 ä¸‹è½½: <a href="https://github.com/alibaba/nacos/releases/tag/1.2.1">https://github.com/alibaba/nacos/releases/tag/1.2.1</a></h4><h4 id="9-1-3-2-ç¯å¢ƒè¦æ±‚-Java8-x2F-Maven-3-2-x"><a href="#9-1-3-2-ç¯å¢ƒè¦æ±‚-Java8-x2F-Maven-3-2-x" class="headerlink" title="9.1.3.2 ç¯å¢ƒè¦æ±‚: Java8&#x2F;Maven 3.2.x+"></a>9.1.3.2 ç¯å¢ƒè¦æ±‚: Java8&#x2F;Maven 3.2.x+</h4><h4 id="9-1-3-3-è§£å‹"><a href="#9-1-3-3-è§£å‹" class="headerlink" title="9.1.3.3 è§£å‹"></a>9.1.3.3 è§£å‹</h4><p>åœ¨æˆ‘çš„macä¸­æ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /Applications/nacos/bin//å› ä¸ºæˆ‘æŠŠnacosæ”¾åœ¨äº†/Applicationsç›®å½•ä¸‹</span><br><span class="line">sh startup.sh -m standalone//åœ¨nacos/binç›®å½•ä¸‹æ‰§è¡Œè¯¥è¯­å¥å³å¯æˆåŠŸå¯åŠ¨nacosæœåŠ¡</span><br><span class="line">sh shutdown.sh//å…³é—­nacos</span><br></pre></td></tr></table></figure><h4 id="9-1-3-4-æµè§ˆå™¨-http-localhost-8848-nacos"><a href="#9-1-3-4-æµè§ˆå™¨-http-localhost-8848-nacos" class="headerlink" title="9.1.3.4 æµè§ˆå™¨ http://localhost:8848/nacos"></a>9.1.3.4 æµè§ˆå™¨ <a href="http://localhost:8848/nacos">http://localhost:8848/nacos</a></h4><h4 id="9-1-3-5-ç”¨æˆ·å-x2F-å¯†ç -ä¸º-nacos"><a href="#9-1-3-5-ç”¨æˆ·å-x2F-å¯†ç -ä¸º-nacos" class="headerlink" title="9.1.3.5 ç”¨æˆ·å&#x2F;å¯†ç  ä¸º nacos"></a>9.1.3.5 ç”¨æˆ·å&#x2F;å¯†ç  ä¸º nacos</h4><h2 id="9-2-åˆ›å»º-Nacos-æœåŠ¡æä¾›è€…"><a href="#9-2-åˆ›å»º-Nacos-æœåŠ¡æä¾›è€…" class="headerlink" title="9.2 åˆ›å»º Nacos æœåŠ¡æä¾›è€…"></a>9.2 åˆ›å»º Nacos æœåŠ¡æä¾›è€…</h2><h3 id="9-2-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£"><a href="#9-2-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£" class="headerlink" title="9.2.1 éœ€æ±‚è¯´æ˜&#x2F;å›¾è§£"></a>9.2.1 éœ€æ±‚è¯´æ˜&#x2F;å›¾è§£</h3><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230604111207532.png" alt="image-20230604111207532" style="zoom:50%;" /><h3 id="9-2-2-åˆ›å»º-member-service-nacos-provider-10004-å¹¶æ³¨å†Œåˆ°-NacosServer8848"><a href="#9-2-2-åˆ›å»º-member-service-nacos-provider-10004-å¹¶æ³¨å†Œåˆ°-NacosServer8848" class="headerlink" title="9.2.2 åˆ›å»º member-service-nacos-provider-10004 å¹¶æ³¨å†Œåˆ° NacosServer8848"></a><strong>9.2.2</strong> åˆ›å»º member-service-nacos-provider-10004 å¹¶æ³¨å†Œåˆ° NacosServer8848</h3><h4 id="9-2-2-1-åˆ›å»º-member-service-nacos-provider-10004"><a href="#9-2-2-1-åˆ›å»º-member-service-nacos-provider-10004" class="headerlink" title="9.2.2.1 åˆ›å»º member-service-nacos-provider-10004"></a>9.2.2.1 åˆ›å»º member-service-nacos-provider-10004</h4><ol><li><p>å‚è€ƒ<strong>member-service-provider-10000</strong> æ¥åˆ›å»º <strong>member-service-nacos-provider-10004</strong> å³å¯</p></li><li><p>åˆ›å»ºå¥½åï¼Œä½¿ç”¨member-service-provider-10000 çš„æºç å’Œé…ç½®æ›¿æ¢member-service-nacos-provider-10004 ç”Ÿæˆçš„ä»£ç </p></li><li><p>æé†’ï¼Œæ‹·è´æ—¶ä¸è¦å¿˜è®°æ‹·è´ resources&#x2F;mapper&#x2F;MernberrVapper.xml è¿™äº›xeox.xrl æ–‡ä»¶</p></li></ol><h4 id="9-2-2-2-ä¿®æ”¹çˆ¶é¡¹ç›®-pom-xml"><a href="#9-2-2-2-ä¿®æ”¹çˆ¶é¡¹ç›®-pom-xml" class="headerlink" title="9.2.2.2 ä¿®æ”¹çˆ¶é¡¹ç›® pom.xml"></a>9.2.2.2 ä¿®æ”¹çˆ¶é¡¹ç›® pom.xml</h4><p><strong>1.</strong> å‚è€ƒå®˜æ–¹æ–‡æ¡£ <strong><a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery</a></strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="9-2-2-3-ä¿®æ”¹æœ¬æ¨¡å—-pom-xml"><a href="#9-2-2-3-ä¿®æ”¹æœ¬æ¨¡å—-pom-xml" class="headerlink" title="9.2.2.3 ä¿®æ”¹æœ¬æ¨¡å— pom.xml"></a>9.2.2.3 ä¿®æ”¹æœ¬æ¨¡å— pom.xml</h4><p><strong>1.</strong> å°† <strong>member-service-provider-10000</strong> çš„ <strong>pom.xml</strong> çš„<dependencies>â€¦</dependencies></p><p>æ‹·è´è¿‡æ¥ï¼Œä¿®æ”¹å³å¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.study.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e-commerce-center<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>member-service-nacos-provider-10004<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--å¼•å…¥nacos-start nacosåœºæ™¯å¯åŠ¨å™¨--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--        ä½¿ç”¨ç‰ˆæœ¬ä»²è£ï¼Œä»çˆ¶é¡¹ç›®ä¸­è·å–ç‰ˆæœ¬--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        springbootç¨‹åºçš„ç›‘æ§ç³»ç»Ÿï¼Œå®ç°ç³»ç»Ÿå¥åº·æ£€æµ‹</span></span><br><span class="line"><span class="comment">                    å¯ä»¥é€šè¿‡ http://localhost:10000/actuator çœ‹åˆ°ç›¸å…³è¿æ¥</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.31<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥ e_commerce_center-common-api --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.study.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e_commerce_center-common-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="9-2-2-4-åˆ›å»º-application-yml"><a href="#9-2-2-4-åˆ›å»º-application-yml" class="headerlink" title="9.2.2.4 åˆ›å»º application.yml"></a>9.2.2.4 åˆ›å»º application.yml</h4><p><strong>1.</strong> å°† <strong>member-service-provider-10000</strong> çš„ <strong>application.xml</strong> æ‹·è´è¿‡æ¥ï¼Œä¿®æ”¹å³å¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10004</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-nacos-provider</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/e_commerce_center_db?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">QWEASDzxc123</span></span><br><span class="line"><span class="comment">#  é…ç½®nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#é…ç½®nacos serverçš„åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.study.springcloud.entity</span></span><br><span class="line"><span class="comment">#é…ç½®æš´éœ²æ‰€æœ‰çš„ç›‘æ§ç‚¹</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="9-2-2-5-åˆ›å»ºä¸»å¯åŠ¨ç±»"><a href="#9-2-2-5-åˆ›å»ºä¸»å¯åŠ¨ç±»" class="headerlink" title="9.2.2.5 åˆ›å»ºä¸»å¯åŠ¨ç±»"></a>9.2.2.5 åˆ›å»ºä¸»å¯åŠ¨ç±»</h4><p><strong>1.</strong> åˆ›å»ºä¸»å¯åŠ¨ç±» MemberNacosProviderApplication10004</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼•å…¥nacoså‘ç°çš„æ³¨è§£</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberNacosProviderApplication10004</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MemberNacosProviderApplication10004.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="9-2-2-6-ä¸ºçœ‹åˆ°æ›´å¥½æç¤ºï¼Œä¿®æ”¹-Controller"><a href="#9-2-2-6-ä¸ºçœ‹åˆ°æ›´å¥½æç¤ºï¼Œä¿®æ”¹-Controller" class="headerlink" title="9.2.2.6 ä¸ºçœ‹åˆ°æ›´å¥½æç¤ºï¼Œä¿®æ”¹ Controller"></a>9.2.2.6 ä¸ºçœ‹åˆ°æ›´å¥½æç¤ºï¼Œä¿®æ”¹ Controller</h4><p>â€¦â€¦</p><h4 id="9-2-2-7-æµ‹è¯•"><a href="#9-2-2-7-æµ‹è¯•" class="headerlink" title="9.2.2.7 æµ‹è¯•"></a>9.2.2.7 æµ‹è¯•</h4><h5 id="9-2-2-7-1-å¯åŠ¨-Nacos-Server-8848"><a href="#9-2-2-7-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="9.2.2.7.1 å¯åŠ¨ Nacos Server 8848"></a><strong>9.2.2.7.1</strong> å¯åŠ¨ Nacos Server 8848</h5><h5 id="9-2-2-7-2-å¯åŠ¨-member-service-nacos-provider-10004"><a href="#9-2-2-7-2-å¯åŠ¨-member-service-nacos-provider-10004" class="headerlink" title="9.2.2.7.2 å¯åŠ¨ member-service-nacos-provider-10004"></a>9.2.2.7.2 å¯åŠ¨ <strong>member-service-nacos-provider-10004</strong></h5><h5 id="9-2-2-7-3-è§‚å¯Ÿ-nacos-æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ"><a href="#9-2-2-7-3-è§‚å¯Ÿ-nacos-æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ" class="headerlink" title="9.2.2.7.3 è§‚å¯Ÿ nacos æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ"></a><strong>9.2.2.7.3</strong> è§‚å¯Ÿ <strong>nacos</strong> æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230604130757230.png" alt="image-20230604130757230"></p><h3 id="9-2-3-åˆ›å»º-member-service-nacos-provider-10006-å¹¶æ³¨å†Œåˆ°-NacosServer8848"><a href="#9-2-3-åˆ›å»º-member-service-nacos-provider-10006-å¹¶æ³¨å†Œåˆ°-NacosServer8848" class="headerlink" title="9.2.3 åˆ›å»º member-service-nacos-provider-10006 å¹¶æ³¨å†Œåˆ° NacosServer8848"></a>9.2.3 åˆ›å»º member-service-nacos-provider-10006 å¹¶æ³¨å†Œåˆ° NacosServer8848</h3><h4 id="9-2-3-1-åˆ›å»º-member-service-nacos-provider-10006"><a href="#9-2-3-1-åˆ›å»º-member-service-nacos-provider-10006" class="headerlink" title="9.2.3.1 åˆ›å»º member-service-nacos-provider-10006"></a>9.2.3.1 åˆ›å»º member-service-nacos-provider-10006</h4><ol><li><p>å‚è€ƒmember-service-nacos-provider-10004 æ¥åˆ›å»º member-service-nacos-provider-10006 å³å¯</p></li><li><p>åˆ›å»ºå¥½åï¼Œä½¿ç”¨member-service-nacos-provider-10004 çš„æºç å’Œé…ç½æ›¿æ¢member-service-nacos-provider-10006 ç”Ÿæˆçš„ä»£ç </p></li><li><p>æé†’ï¼Œæ‹·è´æ—¶ä¸è¦å¿˜è®°æ‹·è´ resources&#x2F;mapper&#x2F;MemberMapper.xml è¿™äº›xoxx.xmlæ–‡ä»¶</p></li></ol><h4 id="9-2-3-2-ä¿®æ”¹æœ¬æ¨¡å—-pom-xml"><a href="#9-2-3-2-ä¿®æ”¹æœ¬æ¨¡å—-pom-xml" class="headerlink" title="9.2.3.2 ä¿®æ”¹æœ¬æ¨¡å— pom.xml"></a>9.2.3.2 ä¿®æ”¹æœ¬æ¨¡å— pom.xml</h4><p><strong>1.</strong> å°† <strong>member-service-provider-10000</strong> çš„ <strong>pom.xml</strong> çš„<dependencies>â€¦</dependencies></p><p>æ‹·è´è¿‡æ¥ï¼Œä¿®æ”¹å³å¯</p><h4 id="9-2-3-3-åˆ›å»º-application-yml"><a href="#9-2-3-3-åˆ›å»º-application-yml" class="headerlink" title="9.2.3.3 åˆ›å»º application.yml"></a>9.2.3.3 åˆ›å»º application.yml</h4><p><strong>1.</strong> å°† <strong>member-service-nacos-provider-10004</strong> çš„ <strong>application.xml</strong> æ‹·è´è¿‡æ¥ï¼Œä¿®æ”¹ç«¯å£å³å¯</p><h4 id="9-2-3-4-åˆ›å»ºä¸»å¯åŠ¨ç±»"><a href="#9-2-3-4-åˆ›å»ºä¸»å¯åŠ¨ç±»" class="headerlink" title="9.2.3.4 åˆ›å»ºä¸»å¯åŠ¨ç±»"></a>9.2.3.4 åˆ›å»ºä¸»å¯åŠ¨ç±»</h4><p><strong>1.</strong> åˆ›å»ºä¸»å¯åŠ¨ç±» MemberNacosProviderApplication10006 (ä¹Ÿå¤åˆ¶è¿‡æ¥ï¼Œæ”¹ä¸ªåç§°å³å¯)</p><h4 id="9-2-3-5-ä¸ºçœ‹åˆ°æ›´å¥½æç¤ºï¼Œä¿®æ”¹-Controller"><a href="#9-2-3-5-ä¸ºçœ‹åˆ°æ›´å¥½æç¤ºï¼Œä¿®æ”¹-Controller" class="headerlink" title="9.2.3.5 ä¸ºçœ‹åˆ°æ›´å¥½æç¤ºï¼Œä¿®æ”¹ Controller"></a>9.2.3.5 ä¸ºçœ‹åˆ°æ›´å¥½æç¤ºï¼Œä¿®æ”¹ Controller</h4><h4 id="9-2-3-6-æµ‹è¯•"><a href="#9-2-3-6-æµ‹è¯•" class="headerlink" title="9.2.3.6 æµ‹è¯•"></a>9.2.3.6 æµ‹è¯•</h4><h5 id="9-2-3-6-1-ä¿è¯-Nacos-Server-8848-æ˜¯å¯åŠ¨çš„"><a href="#9-2-3-6-1-ä¿è¯-Nacos-Server-8848-æ˜¯å¯åŠ¨çš„" class="headerlink" title="9.2.3.6.1 ä¿è¯ Nacos Server 8848 æ˜¯å¯åŠ¨çš„"></a><strong>9.2.3.6.1</strong> ä¿è¯ <strong>Nacos Server 8848</strong> æ˜¯å¯åŠ¨çš„</h5><h5 id="9-2-3-6-2-å¯åŠ¨-member-service-nacos-provider-10006"><a href="#9-2-3-6-2-å¯åŠ¨-member-service-nacos-provider-10006" class="headerlink" title="9.2.3.6.2 å¯åŠ¨ **member-service-nacos-provider-10006 **"></a><strong>9.2.3.6.2</strong> å¯åŠ¨ **member-service-nacos-provider-10006 **</h5><h5 id="9-2-3-6-3-è§‚å¯Ÿ-nacos-æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ"><a href="#9-2-3-6-3-è§‚å¯Ÿ-nacos-æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ" class="headerlink" title="9.2.3.6.3 è§‚å¯Ÿ nacos æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ"></a><strong>9.2.3.6.3</strong> è§‚å¯Ÿ <strong>nacos</strong> æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ</h5><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230605235515301.png" alt="image-20230605235515301"></p><h5 id="9-2-3-6-4-æµè§ˆå™¨-http-localhost-10006-member-get-1"><a href="#9-2-3-6-4-æµè§ˆå™¨-http-localhost-10006-member-get-1" class="headerlink" title="9.2.3.6.4 æµè§ˆå™¨**: http://localhost:10006/member/get/1**"></a><strong>9.2.3.6.4</strong> æµè§ˆå™¨**: <a href="http://localhost:10006/member/get/1">http://localhost:10006/member/get/1</a>**</h5><h2 id="9-3-åˆ›å»º-Nacos-çš„æœåŠ¡æ¶ˆè´¹è€…"><a href="#9-3-åˆ›å»º-Nacos-çš„æœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="9.3 åˆ›å»º Nacos çš„æœåŠ¡æ¶ˆè´¹è€…"></a>9.3 åˆ›å»º Nacos çš„æœåŠ¡æ¶ˆè´¹è€…</h2><h3 id="9-3-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£"><a href="#9-3-1-éœ€æ±‚è¯´æ˜-x2F-å›¾è§£" class="headerlink" title="9.3.1 éœ€æ±‚è¯´æ˜**&#x2F;**å›¾è§£"></a><strong>9.3.1</strong> éœ€æ±‚è¯´æ˜**&#x2F;**å›¾è§£</h3><p><strong>â€“</strong> ç¤ºæ„å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230619155537025.png" alt="image-20230619155537025" style="zoom:50%;" /><h3 id="9-3-2-åˆ›å»º-member-service-nacos-consumer-80-å¹¶æ³¨å†Œåˆ°-NacosServer8848"><a href="#9-3-2-åˆ›å»º-member-service-nacos-consumer-80-å¹¶æ³¨å†Œåˆ°-NacosServer8848" class="headerlink" title="9.3.2 åˆ›å»º member-service-nacos-consumer-80 å¹¶æ³¨å†Œåˆ° NacosServer8848"></a><strong>9.3.2</strong> åˆ›å»º <strong>member-service-nacos-consumer-80</strong> å¹¶æ³¨å†Œåˆ° <strong>NacosServer8848</strong></h3><h4 id="9-3-2-1-åˆ›å»º-member-service-nacos-consumer-80"><a href="#9-3-2-1-åˆ›å»º-member-service-nacos-consumer-80" class="headerlink" title="9.3.2.1 åˆ›å»º member-service-nacos-consumer-80"></a>9.3.2.1 åˆ›å»º member-service-nacos-consumer-80</h4><ol><li>å‚è€ƒ member-service-consumer-80 æ¥åˆ›å»º member-service-nacos-consumer-80 å³å¯</li></ol><h4 id="9-3-2-2-ä¿®æ”¹-pom-xml"><a href="#9-3-2-2-ä¿®æ”¹-pom-xml" class="headerlink" title="9.3.2.2 ä¿®æ”¹ pom.xml"></a>9.3.2.2 ä¿®æ”¹ pom.xml</h4><p>å°† <strong>member-service-consumer-80</strong> çš„ <strong>pom.xml</strong> çš„<dependencies>â€¦</dependencies> æ‹· è´è¿‡æ¥ï¼Œä¿®æ”¹å³å¯</p><h4 id="9-3-2-3-åˆ›å»º-application-yml"><a href="#9-3-2-3-åˆ›å»º-application-yml" class="headerlink" title="9.3.2.3 åˆ›å»º application.yml"></a>9.3.2.3 åˆ›å»º application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-consumer-80</span></span><br><span class="line">    <span class="comment">#é…ç½®nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#å¯åŠ¨nacosæœåŠ¡çš„ipä»¥åŠç«¯å£</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br></pre></td></tr></table></figure><h4 id="9-3-2-4-åˆ›å»ºä¸»å¯åŠ¨ç±»"><a href="#9-3-2-4-åˆ›å»ºä¸»å¯åŠ¨ç±»" class="headerlink" title="9.3.2.4 åˆ›å»ºä¸»å¯åŠ¨ç±»"></a>9.3.2.4 åˆ›å»ºä¸»å¯åŠ¨ç±»</h4><p>â€¦â€¦</p><h4 id="9-3-2-5-ä¸šåŠ¡ç±»"><a href="#9-3-2-5-ä¸šåŠ¡ç±»" class="headerlink" title="9.3.2.5 ä¸šåŠ¡ç±»"></a>9.3.2.5 ä¸šåŠ¡ç±»</h4><p><em>nacos</em> æœ¬èº«å°±é›†æˆäº† <em>Ribbon,</em> ç›´æ¥æ”¯æŒ <em>Ribbon(è´Ÿè½½å‡è¡¡)+RestTemplate(è¿œç¨‹è°ƒç”¨)</em> è°ƒç”¨</p><p><strong>1.</strong> åˆ›å»ºé…ç½®ç±» <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;CustomizationBean.java</strong></p><p><strong>2.</strong> åˆ›å»º <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberNacosConsumerController.java</strong></p><h4 id="9-3-2-6-æµ‹è¯•"><a href="#9-3-2-6-æµ‹è¯•" class="headerlink" title="9.3.2.6 æµ‹è¯•"></a>9.3.2.6 æµ‹è¯•</h4><h5 id="9-3-2-6-1-å¯åŠ¨-Nacos-Server-8848"><a href="#9-3-2-6-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="9.3.2.6.1 å¯åŠ¨ Nacos Server 8848"></a><strong>9.3.2.6.1</strong> å¯åŠ¨ Nacos Server 8848</h5><h5 id="9-3-2-6-2-å¯åŠ¨-member-service-nacos-provider-10004-x2F-10006-9-3-2-6-3-å¯åŠ¨-member-service-nacos-consumer-80"><a href="#9-3-2-6-2-å¯åŠ¨-member-service-nacos-provider-10004-x2F-10006-9-3-2-6-3-å¯åŠ¨-member-service-nacos-consumer-80" class="headerlink" title="9.3.2.6.2 å¯åŠ¨ member-service-nacos-provider-10004&#x2F;10006 9.3.2.6.3 å¯åŠ¨ member-service-nacos-consumer-80"></a>9.3.2.6.2 å¯åŠ¨ <strong>member-service-nacos-provider-10004&#x2F;10006 9.3.2.6.3</strong> å¯åŠ¨ member-service-nacos-consumer-80</h5><h5 id="9-3-2-6-4-æµè§ˆå™¨-http-localhost-member-nacos-consumer-get-1"><a href="#9-3-2-6-4-æµè§ˆå™¨-http-localhost-member-nacos-consumer-get-1" class="headerlink" title="9.3.2.6.4 æµè§ˆå™¨**: http://localhost/member/nacos/consumer/get/1**"></a>9.3.2.6.4 æµè§ˆå™¨**: <a href="http://localhost/member/nacos/consumer/get/1">http://localhost/member/nacos/consumer/get/1</a>**</h5><h4 id="9-3-2-7-é…ç½®è‡ªå·±çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œ-æµ‹è¯•å®Œæ¯•æ¢å¤æˆåŸæ¥çš„è½®è¯¢ç®—æ³•"><a href="#9-3-2-7-é…ç½®è‡ªå·±çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œ-æµ‹è¯•å®Œæ¯•æ¢å¤æˆåŸæ¥çš„è½®è¯¢ç®—æ³•" class="headerlink" title="9.3.2.7 é…ç½®è‡ªå·±çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œ æµ‹è¯•å®Œæ¯•æ¢å¤æˆåŸæ¥çš„è½®è¯¢ç®—æ³•"></a>9.3.2.7 é…ç½®è‡ªå·±çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œ æµ‹è¯•å®Œæ¯•æ¢å¤æˆåŸæ¥çš„è½®è¯¢ç®—æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.netflix.loadbalancer.IRule;</span><br><span class="line"><span class="keyword">import</span> com.netflix.loadbalancer.RandomRule;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/6/19</span></span><br><span class="line"><span class="comment"> * 16:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * RibbonRuleé…ç½®ç±»ï¼Œé…ç½®è‡ªå·±çš„è´Ÿè½½å‡è¡¡ç®—æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RibbonRule</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IRule <span class="title function_">myRibbonRule</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-4-NacosAPå’ŒCPåˆ‡æ¢-ç†è®º"><a href="#9-4-NacosAPå’ŒCPåˆ‡æ¢-ç†è®º" class="headerlink" title="9.4 NacosAPå’ŒCPåˆ‡æ¢-ç†è®º"></a>9.4 NacosAPå’ŒCPåˆ‡æ¢-ç†è®º</h2><h3 id="9-4-1-å„ç§æ³¨å†Œä¸­å¿ƒå¯¹æ¯”"><a href="#9-4-1-å„ç§æ³¨å†Œä¸­å¿ƒå¯¹æ¯”" class="headerlink" title="9.4.1 å„ç§æ³¨å†Œä¸­å¿ƒå¯¹æ¯”"></a><strong>9.4.1</strong> å„ç§æ³¨å†Œä¸­å¿ƒå¯¹æ¯”</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230619224742402.png" alt="image-20230619224742402"></p><h3 id="9-4-2-é€‰æ‹©-AP-è¿˜æ˜¯-CP"><a href="#9-4-2-é€‰æ‹©-AP-è¿˜æ˜¯-CP" class="headerlink" title="9.4.2 é€‰æ‹© AP è¿˜æ˜¯ CP?"></a><strong>9.4.2</strong> é€‰æ‹© <strong>AP</strong> è¿˜æ˜¯ <strong>CP?</strong></h3><p> <strong>1</strong>ã€<strong>CP:</strong> æœåŠ¡å¯ä»¥ä¸èƒ½ç”¨ï¼Œä½†å¿…é¡»è¦ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚<br> <strong>2</strong>ã€<strong>AP:</strong> æ•°æ®å¯ä»¥çŸ­æš‚ä¸ä¸€è‡´ï¼Œä½†æœ€ç»ˆæ˜¯éœ€è¦ä¸€è‡´çš„ï¼Œæ— è®ºå¦‚ä½•éƒ½è¦ä¿è¯æœåŠ¡çš„å¯ç”¨ã€‚<br> <strong>3</strong>ã€å–èˆ:åªèƒ½åœ¨ <strong>CP</strong> å’Œ <strong>AP</strong> é€‰æ‹©ä¸€ä¸ªå¹³è¡¡ç‚¹**,** å¤§å¤šæ•°éƒ½æ˜¯é€‰æ‹© <strong>AP</strong> æ¨¡å¼</p><h3 id="9-4-3-APå’ŒCPåˆ‡æ¢"><a href="#9-4-3-APå’ŒCPåˆ‡æ¢" class="headerlink" title="9.4.3 APå’ŒCPåˆ‡æ¢"></a><strong>9.4.3 AP</strong>å’Œ<strong>CP</strong>åˆ‡æ¢</h3><p><strong>Nacos</strong> é›†ç¾¤é»˜è®¤æ”¯æŒçš„æ˜¯<strong>CAP</strong>åŸåˆ™ä¸­çš„<strong>AP</strong>åŸåˆ™ï¼Œä½†æ˜¯ä¹Ÿå¯åˆ‡æ¢ä¸º<strong>CP</strong>åŸåˆ™**(<strong>ä¸€èˆ¬ä¸åˆ‡æ¢</strong>)**</p><h4 id="9-4-3-2-å‚è€ƒ-https-www-jianshu-com-p-c56e22c222bb"><a href="#9-4-3-2-å‚è€ƒ-https-www-jianshu-com-p-c56e22c222bb" class="headerlink" title="9.4.3.2 å‚è€ƒ: https://www.jianshu.com/p/c56e22c222bb"></a>9.4.3.2 å‚è€ƒ: <a href="https://www.jianshu.com/p/c56e22c222bb">https://www.jianshu.com/p/c56e22c222bb</a></h4><h2 id="9-5-Nacos-é…ç½®ä¸­å¿ƒå®ä¾‹"><a href="#9-5-Nacos-é…ç½®ä¸­å¿ƒå®ä¾‹" class="headerlink" title="9.5 Nacos é…ç½®ä¸­å¿ƒå®ä¾‹"></a>9.5 Nacos é…ç½®ä¸­å¿ƒå®ä¾‹</h2><h3 id="9-5-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#9-5-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="9.5.1 éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£"></a><strong>9.5.1</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</h3><p>å¾®æœåŠ¡å„ä¸ªæ¨¡å—ä¸­æœ‰è®¸å¤šé…ç½®æ˜¯ç›¸åŒçš„ï¼Œåœ¨é…ç½®ä¸­å¿ƒè¿›è¡Œç»Ÿä¸€çš„é…ç½®ä¸ä»…é…ç½®æ›´æ–¹ä¾¿ï¼Œä¹Ÿä¾¿äºæ—¥åä¿®æ”¹ã€‚</p><p><strong>â€“</strong> ç¤ºæ„å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230619225914409.png" alt="image-20230619225914409" style="zoom: 33%;" /><h3 id="9-5-2-åœ¨-Nacos-Server-åŠ å…¥é…ç½®"><a href="#9-5-2-åœ¨-Nacos-Server-åŠ å…¥é…ç½®" class="headerlink" title="9.5.2 åœ¨ Nacos Server åŠ å…¥é…ç½®"></a><strong>9.5.2</strong> åœ¨ <strong>Nacos Server</strong> åŠ å…¥é…ç½®</h3><ol><li>è¿›å…¥åˆ° Nacos Server</li><li>åŠ å…¥é…ç½®ï¼Œ è€éŸ©ç‰¹åˆ«æé†’: æ–‡ä»¶åç¼€.yaml åˆ«å¿˜äº†</li></ol><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230619230758715.png" alt="image-20230619230758715" style="zoom:50%;" /><p><strong>Data ID: e-commerce-nacos-config-client-dev.yaml</strong></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230619230855754.png" alt="image-20230619230855754" style="zoom:50%;" /><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230619230930267.png" alt="image-20230619230930267" style="zoom:50%;" /><h3 id="9-5-3-åˆ›å»º-Nacos-é…ç½®å®¢æˆ·ç«¯æ¨¡å—-e-commerce-nacos-config-client5000"><a href="#9-5-3-åˆ›å»º-Nacos-é…ç½®å®¢æˆ·ç«¯æ¨¡å—-e-commerce-nacos-config-client5000" class="headerlink" title="9.5.3 åˆ›å»º Nacos é…ç½®å®¢æˆ·ç«¯æ¨¡å— e-commerce-nacos-config-client5000"></a><strong>9.5.3</strong> åˆ›å»º <strong>Nacos</strong> é…ç½®å®¢æˆ·ç«¯æ¨¡å— <strong>e-commerce-nacos-config-client5000</strong></h3><h4 id="9-5-3-1-åˆ›å»º-Module"><a href="#9-5-3-1-åˆ›å»º-Module" class="headerlink" title="9.5.3.1 åˆ›å»º Module"></a>9.5.3.1 åˆ›å»º Module</h4><p>å…ˆåˆ›å»º <strong>e-commerce-nacos-config-client5000</strong> æ¨¡å—ï¼Œå‚è€ƒä»¥å‰çš„æ–¹æ³•</p><h4 id="9-5-3-2-ä¿®æ”¹-pom-xml"><a href="#9-5-3-2-ä¿®æ”¹-pom-xml" class="headerlink" title="9.5.3.2 ä¿®æ”¹ pom.xml"></a>9.5.3.2 ä¿®æ”¹ pom.xml</h4><p><strong>1.</strong> ä¿®æ”¹ <strong>pom.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ä¹‹å‰çš„æ¶ˆè´¹æ–¹xmlæ–‡ä»¶çš„åŸºç¡€ä¸Šæ·»åŠ ï¼š</span><br><span class="line"><span class="comment">&lt;!--nacos-config--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="9-5-3-3-åˆ›å»º-application-xml"><a href="#9-5-3-3-åˆ›å»º-application-xml" class="headerlink" title="9.5.3.3 åˆ›å»º application.xml"></a>9.5.3.3 åˆ›å»º application.xml</h4><p>åˆ›å»º <strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment">#æŒ‡å®šç¯å¢ƒï¼Œå¸¸è§çš„ç¯å¢ƒæœ‰ dev/test/prod å¼€å‘ï¼Œæµ‹è¯•ï¼Œç”Ÿäº§</span></span><br></pre></td></tr></table></figure><p>å‚è€ƒ*: <a href="https://blog.csdn.net/zsl131557/article/details/80886114">https://blog.csdn.net/zsl131557/article/details/80886114</a>*</p><h4 id="9-5-3-4-åˆ›å»º-bootstrap-yml"><a href="#9-5-3-4-åˆ›å»º-bootstrap-yml" class="headerlink" title="9.5.3.4 åˆ›å»º bootstrap.yml"></a>9.5.3.4 åˆ›å»º bootstrap.yml</h4><p>åˆ›å»º <strong>bootstrap.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">5000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œçš„name éœ€è¦å‚è€ƒnacosé…ç½®ä¸­å¿ƒçš„DataId</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">e-commerce-nacos-config-client</span></span><br><span class="line">  <span class="comment">#é…ç½®nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacosé…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#æŒ‡å®šè¯»å–é…ç½®ä¸­å¿ƒçš„yamlåç¼€çš„é…ç½®</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#è€éŸ©è§£è¯»[é‡è¦]</span></span><br><span class="line"><span class="comment">#nacos é…ç½®å®¢æˆ·ç«¯ï¼Œä¼šæ ¹æ®é…ç½®ï¼Œæ‰¾åˆ°èµ„æºè·å–é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#(1 config-server-addr)                       localhost:8848</span></span><br><span class="line"><span class="comment">#(2 spring.application.name/å¯¹åº” DataId)       e-commerce-nacos-config-client </span></span><br><span class="line"><span class="comment">#(3 spring.profiles.active)                   dev</span></span><br><span class="line"><span class="comment">#(4 spring.cloud.nacos.config.file-extension æ–‡ä»¶æ‰©å±•å)    .yaml</span></span><br><span class="line"><span class="comment">#ä¹Ÿå°±åˆ° localhost:8848 ä¸‹çš„ e-commerce-nacos-config-client-dev.yaml è·å–é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">#è§„åˆ™æ€»ç»“: $&#123;spring.application.name&#125;-$&#123;spring.profile.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span></span><br></pre></td></tr></table></figure><h4 id="9-5-3-5-ä¸»å¯åŠ¨ç±»"><a href="#9-5-3-5-ä¸»å¯åŠ¨ç±»" class="headerlink" title="9.5.3.5 ä¸»å¯åŠ¨ç±»"></a>9.5.3.5 ä¸»å¯åŠ¨ç±»</h4><p>â€¦â€¦</p><h4 id="9-5-3-6-ä¸šåŠ¡ç±»"><a href="#9-5-3-6-ä¸šåŠ¡ç±»" class="headerlink" title="9.5.3.6 ä¸šåŠ¡ç±»"></a>9.5.3.6 ä¸šåŠ¡ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/6/20</span></span><br><span class="line"><span class="comment"> * 15:32</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosConfigClientController</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è§£è¯» <span class="doctag">@Value</span>(&quot;$&#123;config.ip&#125;&quot;)</span></span><br><span class="line"><span class="comment">    * 1. client ä¼šæ‹‰å– Nacos Server çš„ e-commerce-nacos-config-client-dev.yaml * config:</span></span><br><span class="line"><span class="comment">    * ip: &quot;122.11.11.11&quot;</span></span><br><span class="line"><span class="comment">    * name: &quot;éŸ©é¡ºå¹³æ•™è‚²&quot;</span></span><br><span class="line"><span class="comment">    * 2. <span class="doctag">@Value</span>(&quot;$&#123;config.ip&#125;&quot;) ä¼šå°† config.ip èµ‹ç»™ configIp</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.ip&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configIp;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/nacos/config/ip&quot;)</span> <span class="keyword">public</span> String <span class="title function_">getConfigIp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configIp; &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/nacos/config/name&quot;)</span> <span class="keyword">public</span> String <span class="title function_">getConfigName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configName; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="9-5-3-7-æµ‹è¯•"><a href="#9-5-3-7-æµ‹è¯•" class="headerlink" title="9.5.3.7 æµ‹è¯•"></a>9.5.3.7 æµ‹è¯•</h4><h5 id="9-5-3-7-1-å¯åŠ¨-Nacos-Server"><a href="#9-5-3-7-1-å¯åŠ¨-Nacos-Server" class="headerlink" title="9.5.3.7.1 å¯åŠ¨ **Nacos Server"></a><strong>9.5.3.7.1</strong> å¯åŠ¨ **Nacos Server</h5><h5 id="9-5-3-7-2-å¯åŠ¨-e-commerce-nacos-config-client5000"><a href="#9-5-3-7-2-å¯åŠ¨-e-commerce-nacos-config-client5000" class="headerlink" title="9.5.3.7.2 å¯åŠ¨ **e-commerce-nacos-config-client5000 **"></a>9.5.3.7.2 å¯åŠ¨ **e-commerce-nacos-config-client5000 **</h5><h5 id="9-5-3-7-3-æµè§ˆå™¨-http-localhost-5000-nacos-config-ip"><a href="#9-5-3-7-3-æµè§ˆå™¨-http-localhost-5000-nacos-config-ip" class="headerlink" title="9.5.3.7.3 æµè§ˆå™¨**: http://localhost:5000/nacos/config/ip**"></a><strong>9.5.3.7.3</strong> æµè§ˆå™¨**: <a href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a>**</h5><p>â€‹æµè§ˆå™¨è¾“å…¥**: <a href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a>**</p><h4 id="9-5-3-8-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#9-5-3-8-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="9.5.3.8 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>9.5.3.8 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p><strong>0. src\main\java\com\study\springcloud\controller\NacosConfigClientController.java</strong> çš„ @Value(â€œ${config.ip}â€), æ˜¯ import org.springframework.beans.factory.annotation.Value; è€Œä¸æ˜¯ lombok åŒ…ä¸‹çš„.</p><p><strong>1.</strong> <strong>é…ç½®æ–‡ä»¶</strong> <strong>application.yml</strong> <strong>å’Œ</strong> <strong>bootstrap.yml</strong> ç»“åˆä¼šå¾—åˆ°é…ç½®æ–‡ä»¶&#x2F;èµ„æºçš„åœ°å€</p><p> <strong>2.</strong> <strong>å‚è€ƒæ–‡æ¡£</strong>: <a href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html">https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html</a></p><p><strong>3.</strong> <strong>æ³¨æ„åœ¨</strong> <strong>Nacos Server</strong> <strong>çš„é…ç½®æ–‡ä»¶çš„åç¼€æ˜¯</strong> <strong>.yaml ,</strong> <strong>è€Œä¸æ˜¯</strong> <strong>.yml</strong></p><p><strong>4.</strong> <strong>åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ï¼Œè¦ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®æ‹‰å–ï¼Œæ‹‰å–é…ç½®ä¹‹åï¼Œæ‰èƒ½ä¿è¯é¡¹ç›®çš„æ­£å¸¸å¯åŠ¨</strong>, <strong>ä¹Ÿå°±æ˜¯è¯´å¦‚æœé¡¹ç›®ä¸èƒ½æ­£ç¡®çš„è·å–åˆ°</strong> <strong>Nacos Server</strong> <strong>çš„é…ç½®æ•°æ®ï¼Œé¡¹ç›®æ˜¯å¯åŠ¨ä¸äº†çš„</strong>.[<strong>æ¼”ç¤º</strong>]</p><p><strong>5. springboot</strong> <strong>ä¸­é…ç½®æ–‡ä»¶çš„åŠ è½½æ˜¯å­˜åœ¨ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œ</strong>bootstrap.yml <strong>ä¼˜å…ˆçº§é«˜äº</strong> <strong>application.yml</strong></p><p>ğŸŒŸ<strong>6.</strong> <strong>@RefreshScope</strong> <strong>æ˜¯</strong> <strong>springcloud</strong> <strong>åŸç”Ÿæ³¨è§£ï¼Œå®ç°é…ç½®ä¿¡æ¯è‡ªåŠ¨åˆ·æ–°</strong>, <strong>å¦‚æœåœ¨</strong> <strong>Nacos Server</strong> <strong>ä¿®æ”¹äº†é…ç½®æ•°æ®ï¼Œ</strong>Client <strong>ç«¯å°±ä¼šå¾—åˆ°æœ€æ–°é…ç½®</strong></p><h2 id="9-6-Nacos-åˆ†ç±»é…ç½®-å®ç°é…ç½®éš”ç¦»"><a href="#9-6-Nacos-åˆ†ç±»é…ç½®-å®ç°é…ç½®éš”ç¦»" class="headerlink" title="9.6 Nacos åˆ†ç±»é…ç½® (å®ç°é…ç½®éš”ç¦»)"></a>9.6 Nacos åˆ†ç±»é…ç½® (å®ç°é…ç½®éš”ç¦»)</h2><h3 id="9-6-1-DataIDæ–¹æ¡ˆ"><a href="#9-6-1-DataIDæ–¹æ¡ˆ" class="headerlink" title="9.6.1 DataIDæ–¹æ¡ˆ"></a><strong>9.6.1 DataID</strong>æ–¹æ¡ˆ</h3><h4 id="9-6-1-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#9-6-1-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="9.6.1.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>9.6.1.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>â€“</strong> ç¤ºæ„å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620155605713.png" alt="image-20230620155605713" style="zoom:50%;" /><h4 id="9-6-1-2-è§£å†³æ–¹æ¡ˆåˆ†æ"><a href="#9-6-1-2-è§£å†³æ–¹æ¡ˆåˆ†æ" class="headerlink" title="9.6.1.2 è§£å†³æ–¹æ¡ˆåˆ†æ"></a>9.6.1.2 è§£å†³æ–¹æ¡ˆåˆ†æ</h4><h5 id="9-6-1-2-1-ä½¿ç”¨-Data-ID-æ–¹æ¡ˆè§£å†³"><a href="#9-6-1-2-1-ä½¿ç”¨-Data-ID-æ–¹æ¡ˆè§£å†³" class="headerlink" title="9.6.1.2.1 ä½¿ç”¨ Data ID æ–¹æ¡ˆè§£å†³"></a><strong>9.6.1.2.1</strong> ä½¿ç”¨ <strong>Data ID</strong> æ–¹æ¡ˆè§£å†³</h5><h4 id="9-6-1-3-é…ç½®å®ç°"><a href="#9-6-1-3-é…ç½®å®ç°" class="headerlink" title="9.6.1.3 é…ç½®å®ç°"></a>9.6.1.3 é…ç½®å®ç°</h4><p><strong>1.</strong> åœ¨ <strong>nacos server</strong> åˆ›å»ºæ–°çš„é…ç½®:<strong>e-commerce-nacos-config-client-test.yaml</strong></p><h4 id="9-6-1-4-ä¿®æ”¹-application-yml"><a href="#9-6-1-4-ä¿®æ”¹-application-yml" class="headerlink" title="9.6.1.4 ä¿®æ”¹ application.yml"></a>9.6.1.4 ä¿®æ”¹ application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">test</span> <span class="comment">#æŒ‡å®šç¯å¢ƒï¼Œå¸¸è§çš„ç¯å¢ƒæœ‰ dev/test/prod å¼€å‘ï¼Œæµ‹è¯•ï¼Œç”Ÿäº§</span></span><br></pre></td></tr></table></figure><h4 id="9-6-1-5-æµ‹è¯•"><a href="#9-6-1-5-æµ‹è¯•" class="headerlink" title="9.6.1.5 æµ‹è¯•"></a>9.6.1.5 æµ‹è¯•</h4><h5 id="9-6-1-5-1-æµè§ˆå™¨-http-localhost-5000-nacos-config-ip"><a href="#9-6-1-5-1-æµè§ˆå™¨-http-localhost-5000-nacos-config-ip" class="headerlink" title="9.6.1.5.1 æµè§ˆå™¨**: http://localhost:5000/nacos/config/ip**"></a><strong>9.6.1.5.1</strong> æµè§ˆå™¨**: <a href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a>**</h5><p>**1.**æµè§ˆå™¨è¾“å…¥: <a href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a></p><h3 id="9-6-2-Groupæ–¹æ¡ˆ"><a href="#9-6-2-Groupæ–¹æ¡ˆ" class="headerlink" title="9.6.2 Groupæ–¹æ¡ˆ"></a><strong>9.6.2 Group</strong>æ–¹æ¡ˆ</h3><h4 id="9-6-2-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#9-6-2-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="9.6.2.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>9.6.2.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>â€“</strong> ç¤ºæ„å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620161153853.png" alt="image-20230620161153853" style="zoom:50%;" /><h4 id="9-6-2-2-è§£å†³æ–¹æ¡ˆåˆ†æ"><a href="#9-6-2-2-è§£å†³æ–¹æ¡ˆåˆ†æ" class="headerlink" title="9.6.2.2 è§£å†³æ–¹æ¡ˆåˆ†æ"></a>9.6.2.2 è§£å†³æ–¹æ¡ˆåˆ†æ</h4><h5 id="9-6-2-2-1-ä½¿ç”¨-Group-æ–¹æ¡ˆè§£å†³"><a href="#9-6-2-2-1-ä½¿ç”¨-Group-æ–¹æ¡ˆè§£å†³" class="headerlink" title="9.6.2.2.1 ä½¿ç”¨ Group æ–¹æ¡ˆè§£å†³"></a><strong>9.6.2.2.1</strong> ä½¿ç”¨ <strong>Group</strong> æ–¹æ¡ˆè§£å†³</h5><h4 id="9-6-2-3-é…ç½®å®ç°"><a href="#9-6-2-3-é…ç½®å®ç°" class="headerlink" title="9.6.2.3 é…ç½®å®ç°"></a>9.6.2.3 é…ç½®å®ç°</h4><p><strong>1.</strong> åœ¨ <strong>nacos server</strong> åˆ›å»ºæ–°çš„é…ç½®:<strong>order&#x2F;e-commerce-nacos-config-client-dev.yaml</strong></p><p><strong>2.</strong> <strong>åœ¨</strong> <strong>nacos server</strong> **åˆ›å»ºæ–°çš„é…ç½®:**seckill&#x2F;e-commerce-nacos-config-client-dev.yaml</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230620161749751.png" alt="image-20230620161749751" style="zoom:50%;" /><h4 id="9-6-2-4-ä¿®æ”¹-application-yml"><a href="#9-6-2-4-ä¿®æ”¹-application-yml" class="headerlink" title="9.6.2.4 ä¿®æ”¹ application.yml"></a>9.6.2.4 ä¿®æ”¹ application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment">#æŒ‡å®šç¯å¢ƒï¼Œå¸¸è§çš„ç¯å¢ƒæœ‰ dev/test/prod å¼€å‘ï¼Œæµ‹è¯•ï¼Œç”Ÿäº§</span></span><br></pre></td></tr></table></figure><h4 id="9-6-2-5-ä¿®æ”¹-bootstrap-yml"><a href="#9-6-2-5-ä¿®æ”¹-bootstrap-yml" class="headerlink" title="9.6.2.5 ä¿®æ”¹ bootstrap.yml"></a>9.6.2.5 ä¿®æ”¹ bootstrap.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">20000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œçš„name éœ€è¦å‚è€ƒnacosé…ç½®ä¸­å¿ƒçš„DataId</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">e-commerce-nacos-config-client</span></span><br><span class="line">  <span class="comment">#é…ç½®nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacosé…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#æŒ‡å®šè¯»å–é…ç½®ä¸­å¿ƒçš„yamlåç¼€çš„é…ç½®</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">order</span> <span class="comment">#æŒ‡å®šorderç»„ï¼Œé»˜è®¤ä¸ºDEFAULT_GROUP</span></span><br></pre></td></tr></table></figure><h4 id="9-6-2-6-æµ‹è¯•"><a href="#9-6-2-6-æµ‹è¯•" class="headerlink" title="9.6.2.6 æµ‹è¯•"></a>9.6.2.6 æµ‹è¯•</h4><h5 id="9-6-2-6-1-æµè§ˆå™¨-http-localhost-5000-nacos-config-ip"><a href="#9-6-2-6-1-æµè§ˆå™¨-http-localhost-5000-nacos-config-ip" class="headerlink" title="9.6.2.6.1 æµè§ˆå™¨**: http://localhost:5000/nacos/config/ip**"></a><strong>9.6.2.6.1</strong> æµè§ˆå™¨**: <a href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a>**</h5><p>**1.**æµè§ˆå™¨è¾“å…¥: <a href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a></p><h3 id="9-6-3-Namespaceæ–¹æ¡ˆ"><a href="#9-6-3-Namespaceæ–¹æ¡ˆ" class="headerlink" title="9.6.3 Namespaceæ–¹æ¡ˆ"></a><strong>9.6.3 Namespace</strong>æ–¹æ¡ˆ</h3><h4 id="9-6-3-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#9-6-3-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="9.6.3.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>9.6.3.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>â€“</strong> ç¤ºæ„å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620162224978.png" alt="image-20230620162224978" style="zoom:50%;" /><h4 id="9-6-3-2-è§£å†³æ–¹æ¡ˆåˆ†æ"><a href="#9-6-3-2-è§£å†³æ–¹æ¡ˆåˆ†æ" class="headerlink" title="9.6.3.2 è§£å†³æ–¹æ¡ˆåˆ†æ"></a>9.6.3.2 è§£å†³æ–¹æ¡ˆåˆ†æ</h4><h5 id="9-6-3-2-1-ä½¿ç”¨-Namespace-æ–¹æ¡ˆè§£å†³"><a href="#9-6-3-2-1-ä½¿ç”¨-Namespace-æ–¹æ¡ˆè§£å†³" class="headerlink" title="9.6.3.2.1 ä½¿ç”¨ Namespace æ–¹æ¡ˆè§£å†³"></a><strong>9.6.3.2.1</strong> ä½¿ç”¨ <strong>Namespace</strong> æ–¹æ¡ˆè§£å†³</h5><h4 id="9-6-3-3-é…ç½®å®ç°"><a href="#9-6-3-3-é…ç½®å®ç°" class="headerlink" title="9.6.3.3 é…ç½®å®ç°"></a>9.6.3.3 é…ç½®å®ç°</h4><p><strong>1.</strong> åœ¨ <strong>nacos server</strong> åˆ›å»ºæ–°çš„ <strong>namespace , baidu</strong> å’Œ <strong>alibaba</strong></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620162934242.png" alt="image-20230620162934242" style="zoom:50%;" /><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620163057931.png" alt="image-20230620163057931" style="zoom:50%;" /><p><strong>2.</strong> <strong>åœ¨</strong> <strong>nacos server</strong> <strong>åˆ›å»ºæ–°çš„</strong> <strong>group&#x2F;dataid</strong></p><h4 id="9-6-3-4-ä¿®æ”¹-application-yml"><a href="#9-6-3-4-ä¿®æ”¹-application-yml" class="headerlink" title="9.6.3.4 ä¿®æ”¹ application.yml"></a>9.6.3.4 ä¿®æ”¹ application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment">#æŒ‡å®šç¯å¢ƒï¼Œå¸¸è§çš„ç¯å¢ƒæœ‰ dev/test/prod å¼€å‘ï¼Œæµ‹è¯•ï¼Œç”Ÿäº§</span></span><br></pre></td></tr></table></figure><h4 id="9-6-3-5-ä¿®æ”¹-bootstrap-yml"><a href="#9-6-3-5-ä¿®æ”¹-bootstrap-yml" class="headerlink" title="9.6.3.5 ä¿®æ”¹ bootstrap.yml"></a>9.6.3.5 ä¿®æ”¹ bootstrap.yml</h4><p><strong>1.</strong> å¢åŠ  <strong>Namespace</strong> å‚æ•°</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">20000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œçš„name éœ€è¦å‚è€ƒnacosé…ç½®ä¸­å¿ƒçš„DataId</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">e-commerce-nacos-config-client</span></span><br><span class="line">  <span class="comment">#é…ç½®nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacosé…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#æŒ‡å®šè¯»å–é…ç½®ä¸­å¿ƒçš„yamlåç¼€çš„é…ç½®</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">seckill</span> <span class="comment">#æŒ‡å®šorderç»„ï¼Œé»˜è®¤ä¸ºDEFAULT_GROUP</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">8b005a7a-89b9-40ba-a5da-aac3e6c7a564</span></span><br></pre></td></tr></table></figure><h4 id="9-6-3-6-æµ‹è¯•"><a href="#9-6-3-6-æµ‹è¯•" class="headerlink" title="9.6.3.6 æµ‹è¯•"></a>9.6.3.6 æµ‹è¯•</h4><h5 id="9-6-3-6-1-æµè§ˆå™¨-http-localhost-5000-nacos-config-ip"><a href="#9-6-3-6-1-æµè§ˆå™¨-http-localhost-5000-nacos-config-ip" class="headerlink" title="9.6.3.6.1 æµè§ˆå™¨**: http://localhost:5000/nacos/config/ip**"></a><strong>9.6.3.6.1</strong> æµè§ˆå™¨**: <a href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a>**</h5><p>**1.**æµè§ˆå™¨è¾“å…¥: <a href="http://localhost:5000/nacos/config/ip">http://localhost:5000/nacos/config/ip</a></p><h3 id="9-6-4-Namespace-x2F-Group-x2F-Data-ID-å…³ç³»"><a href="#9-6-4-Namespace-x2F-Group-x2F-Data-ID-å…³ç³»" class="headerlink" title="9.6.4 Namespace&#x2F;Group&#x2F;Data ID å…³ç³»"></a><strong>9.6.4 Namespace&#x2F;Group&#x2F;Data ID</strong> å…³ç³»</h3><h4 id="9-6-4-1-ä¸€å›¾èƒœåƒè¨€"><a href="#9-6-4-1-ä¸€å›¾èƒœåƒè¨€" class="headerlink" title="9.6.4.1 ä¸€å›¾èƒœåƒè¨€"></a>9.6.4.1 ä¸€å›¾èƒœåƒè¨€</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620164046357.png" alt="image-20230620164046357" style="zoom:50%;" /><h4 id="9-6-4-2-è¯¦è§£ä»‹ç»"><a href="#9-6-4-2-è¯¦è§£ä»‹ç»" class="headerlink" title="9.6.4.2 è¯¦è§£ä»‹ç»"></a>9.6.4.2 è¯¦è§£ä»‹ç»</h4><p><strong>1. namespace &#x2F; group &#x2F; data id</strong> çš„å…³ç³»</p><p>2.æ¢³ç†:</p><ul><li><p>Nacosé»˜è®¤çš„å‘½åç©ºé—´æ˜¯publicï¼ŒNamespaceä¸»è¦ç”¨æ¥å®ç°é…ç½®éš”ç¦»,éš”ç¦»èŒƒå›´å¤§</p></li><li><p>Groupé»˜è®¤æ˜¯DEFAULT GROUP, Groupå¯ä»¥æŠŠä¸åŒçš„å¾®æœåŠ¡åˆ’åˆ†åˆ°åŒä¸€ä¸ªåˆ†ç»„é‡Œé¢å»</p></li><li><p>Serviceå°±æ˜¯å¾®æœåŠ¡,ç›¸åŒçš„Serviceå¯ä»¥æ˜¯ä¸€ä¸ªCluster(ç°‡&#x2F;é›†ç¾¤), Instanceå°±æ˜¯å¾®æœåŠ¡çš„å®ä¾‹</p></li></ul><h1 id="10-SpringCloud-Alibaba-Sentinelâ€”â€”åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµé‡å“¨å…µ"><a href="#10-SpringCloud-Alibaba-Sentinelâ€”â€”åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµé‡å“¨å…µ" class="headerlink" title="10 SpringCloud Alibaba Sentinelâ€”â€”åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµé‡å“¨å…µ"></a>10 SpringCloud Alibaba Sentinelâ€”â€”åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµé‡å“¨å…µ</h1><h2 id="10-1-SentinelåŸºç¡€"><a href="#10-1-SentinelåŸºç¡€" class="headerlink" title="10.1 SentinelåŸºç¡€"></a>10.1 SentinelåŸºç¡€</h2><h3 id="10-1-1-å®˜ç½‘"><a href="#10-1-1-å®˜ç½‘" class="headerlink" title="10.1.1 å®˜ç½‘"></a><strong>10.1.1</strong> å®˜ç½‘</h3><h4 id="10-1-1-1-Github-https-github-com-alibaba-Sentinel"><a href="#10-1-1-1-Github-https-github-com-alibaba-Sentinel" class="headerlink" title="10.1.1.1 Github: https://github.com/alibaba/Sentinel"></a>10.1.1.1 Github: <a href="https://github.com/alibaba/Sentinel">https://github.com/alibaba/Sentinel</a></h4><h4 id="10-1-1-2-å¿«é€Ÿå¼€å§‹-https-sentinelguard-io-zh-cn-docs-quick-start-html"><a href="#10-1-1-2-å¿«é€Ÿå¼€å§‹-https-sentinelguard-io-zh-cn-docs-quick-start-html" class="headerlink" title="10.1.1.2 å¿«é€Ÿå¼€å§‹: https://sentinelguard.io/zh-cn/docs/quick-start.html"></a>10.1.1.2 å¿«é€Ÿå¼€å§‹: <a href="https://sentinelguard.io/zh-cn/docs/quick-start.html">https://sentinelguard.io/zh-cn/docs/quick-start.html</a></h4><h4 id="10-1-1-3-ä¸­æ–‡-https-github-com-alibaba-Sentinel-wiki-E4-BB-8B-E7-BB-8D"><a href="#10-1-1-3-ä¸­æ–‡-https-github-com-alibaba-Sentinel-wiki-E4-BB-8B-E7-BB-8D" class="headerlink" title="10.1.1.3 ä¸­æ–‡: https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D"></a>10.1.1.3 ä¸­æ–‡: <a href="https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D">https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D</a></h4><h4 id="10-1-1-4-ä½¿-ç”¨-æ‰‹-å†Œ-https-spring-cloud-alibaba-group-github-io-github-pages-greenwich-spring-cloud-alibaba-html-spring-cloud-alibaba-sentinel"><a href="#10-1-1-4-ä½¿-ç”¨-æ‰‹-å†Œ-https-spring-cloud-alibaba-group-github-io-github-pages-greenwich-spring-cloud-alibaba-html-spring-cloud-alibaba-sentinel" class="headerlink" title="10.1.1.4 ä½¿ ç”¨ æ‰‹ å†Œ https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel"></a>10.1.1.4 ä½¿ ç”¨ æ‰‹ å†Œ <a href="https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel">https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_sentinel</a></h4><h3 id="10-1-2-Sentinelæ˜¯ä»€ä¹ˆ"><a href="#10-1-2-Sentinelæ˜¯ä»€ä¹ˆ" class="headerlink" title="10.1.2 Sentinelæ˜¯ä»€ä¹ˆ?"></a><strong>10.1.2 Sentinel</strong>æ˜¯ä»€ä¹ˆ?</h3><h4 id="10-1-2-1-Sentinel-æ¦‚è¿°"><a href="#10-1-2-1-Sentinel-æ¦‚è¿°" class="headerlink" title="10.1.2.1 Sentinel æ¦‚è¿°"></a>10.1.2.1 Sentinel æ¦‚è¿°</h4><ol><li>Sentinel æ˜¯ä»€ä¹ˆ?</li></ol><p>éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p><ol start="2"><li>Sentinel çš„ä¸»è¦ç‰¹æ€§</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620201315601.png" alt="image-20230620201315601"></p><p><strong>æ¢³ç†</strong>: sentinel **å¯ä»¥å®Œæˆçš„åŠŸèƒ½ **: <strong>ç»¿è‰²æ–¹æ¡†</strong>åˆ—å‡ºçš„éƒ¨åˆ†</p><ol start="3"><li>Sentinel çš„å¼€æºç”Ÿæ€</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620201431927.png" alt="image-20230620201431927"></p><h4 id="10-1-2-2-ä¸€å¥è¯-Sentinel-åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµé‡é˜²å«å…µ-ä¿æŠ¤ä½ çš„å¾®æœåŠ¡"><a href="#10-1-2-2-ä¸€å¥è¯-Sentinel-åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµé‡é˜²å«å…µ-ä¿æŠ¤ä½ çš„å¾®æœåŠ¡" class="headerlink" title="10.1.2.2 ä¸€å¥è¯: Sentinel: åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµé‡é˜²å«å…µ, ä¿æŠ¤ä½ çš„å¾®æœåŠ¡"></a>10.1.2.2 ä¸€å¥è¯: Sentinel: åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµé‡é˜²å«å…µ, ä¿æŠ¤ä½ çš„å¾®æœåŠ¡</h4><h3 id="10-1-3-Sentinelæ ¸å¿ƒåŠŸèƒ½"><a href="#10-1-3-Sentinelæ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="10.1.3 Sentinelæ ¸å¿ƒåŠŸèƒ½"></a><strong>10.1.3 Sentinel</strong>æ ¸å¿ƒåŠŸèƒ½</h3><h4 id="10-1-3-1-æµé‡æ§åˆ¶"><a href="#10-1-3-1-æµé‡æ§åˆ¶" class="headerlink" title="10.1.3.1 æµé‡æ§åˆ¶"></a>10.1.3.1 æµé‡æ§åˆ¶</h4><h4 id="10-1-3-2-ç†”æ–­é™çº§"><a href="#10-1-3-2-ç†”æ–­é™çº§" class="headerlink" title="10.1.3.2 ç†”æ–­é™çº§"></a>10.1.3.2 ç†”æ–­é™çº§</h4><p><strong>-</strong> åœ¨è°ƒç”¨ç³»ç»Ÿçš„æ—¶å€™ï¼Œå¦‚æœè°ƒç”¨é“¾è·¯ä¸­çš„æŸä¸ªèµ„æºå‡ºç°äº†ä¸ç¨³å®šï¼Œæœ€ç»ˆä¼šå¯¼è‡´è¯·æ±‚å‘ç”Ÿå †ç§¯ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620201814295.png" alt="image-20230620201814295" style="zoom:50%;" /><p><strong>è§£è¯»</strong>ï¼š</p><p>â€‹<u>ç†”æ–­é™çº§å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</u>ï¼Œæ‰€è°“çš„ç†”æ–­é™çº§å°±æ˜¯å½“æ£€æµ‹åˆ°è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç°ä¸ç¨³å®šçš„è¡¨ç°ï¼Œä¾‹å¦‚è¯·æ±‚å“åº”æ—¶é—´é•¿æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜çš„æ—¶å€™ï¼Œåˆ™<u>å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œè®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“åˆ°å…¶å®ƒçš„èµ„æºè€Œå¯¼è‡´çº§è”æ•…éšœ</u>ã€‚</p><h4 id="10-1-3-3-ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤"><a href="#10-1-3-3-ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤" class="headerlink" title="10.1.3.3 ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤"></a>10.1.3.3 ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤</h4><p>â€‹æ ¹æ®ç³»ç»Ÿèƒ½å¤Ÿå¤„ç†çš„è¯·æ±‚ï¼Œå’Œå…è®¸è¿›æ¥çš„è¯·æ±‚ï¼Œæ¥åšå¹³è¡¡ï¼Œè¿½æ±‚çš„ç›®æ ‡æ˜¯åœ¨ç³»ç»Ÿä¸è¢«æ‹–å®çš„æƒ…å†µä¸‹**,** æé«˜ç³»ç»Ÿçš„ååç‡</p><h4 id="10-1-3-4-æ¶ˆæ¯å‰Šå³°å¡«è°·"><a href="#10-1-3-4-æ¶ˆæ¯å‰Šå³°å¡«è°·" class="headerlink" title="10.1.3.4 æ¶ˆæ¯å‰Šå³°å¡«è°·"></a>10.1.3.4 æ¶ˆæ¯å‰Šå³°å¡«è°·</h4><p>â€‹æŸç¬æ—¶æ¥äº†å¤§æµé‡çš„è¯·æ±‚**,** è€Œå¦‚æœæ­¤æ—¶è¦å¤„ç†æ‰€æœ‰è¯·æ±‚ï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿè´Ÿè½½è¿‡é«˜ï¼Œå½±å“ç¨³å®šæ€§ã€‚</p><p>â€‹ä½†å…¶å®å¯èƒ½åé¢å‡ ç§’ä¹‹å†…éƒ½æ²¡æœ‰æ¶ˆæ¯æŠ•é€’ï¼Œè‹¥ç›´æ¥æŠŠå¤šä½™çš„æ¶ˆæ¯ä¸¢æ‰åˆ™æ²¡æœ‰å……åˆ†åˆ©ç”¨ç³»ç»Ÿå¤„ç†æ¶ˆæ¯çš„èƒ½åŠ›</p><p><strong>- Sentinel çš„Rate Limiteræ¨¡å¼èƒ½åœ¨æŸä¸€æ®µæ—¶é—´é—´éš”å†…ä»¥åŒ€é€Ÿæ–¹å¼å¤„ç†è¿™æ ·çš„è¯·æ±‚, å……åˆ†åˆ©ç”¨ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›, ä¹Ÿå°±æ˜¯å‰Šå³°å¡«è°·, ä¿è¯èµ„æºçš„ç¨³å®šæ€§</strong></p><h3 id="10-1-4-Sentinelä¸¤ä¸ªç»„æˆéƒ¨åˆ†"><a href="#10-1-4-Sentinelä¸¤ä¸ªç»„æˆéƒ¨åˆ†" class="headerlink" title="10.1.4 Sentinelä¸¤ä¸ªç»„æˆéƒ¨åˆ†"></a><strong>10.1.4 Sentinel</strong>ä¸¤ä¸ªç»„æˆéƒ¨åˆ†</h3><h4 id="10-1-4-1-æ ¸å¿ƒåº“-Java-å®¢æˆ·ç«¯-ä¸ä¾èµ–ä»»ä½•æ¡†æ¶-x2F-åº“ï¼Œèƒ½å¤Ÿè¿è¡Œåœ¨æ‰€æœ‰-Javaè¿è¡Œæ—¶ç¯å¢ƒï¼Œå¯¹-Spring-Cloudæœ‰è¾ƒå¥½çš„æ”¯æŒ"><a href="#10-1-4-1-æ ¸å¿ƒåº“-Java-å®¢æˆ·ç«¯-ä¸ä¾èµ–ä»»ä½•æ¡†æ¶-x2F-åº“ï¼Œèƒ½å¤Ÿè¿è¡Œåœ¨æ‰€æœ‰-Javaè¿è¡Œæ—¶ç¯å¢ƒï¼Œå¯¹-Spring-Cloudæœ‰è¾ƒå¥½çš„æ”¯æŒ" class="headerlink" title="10.1.4.1 æ ¸å¿ƒåº“:(Java å®¢æˆ·ç«¯)ä¸ä¾èµ–ä»»ä½•æ¡†æ¶&#x2F;åº“ï¼Œèƒ½å¤Ÿè¿è¡Œåœ¨æ‰€æœ‰ Javaè¿è¡Œæ—¶ç¯å¢ƒï¼Œå¯¹ Spring Cloudæœ‰è¾ƒå¥½çš„æ”¯æŒ"></a>10.1.4.1 æ ¸å¿ƒåº“:(Java å®¢æˆ·ç«¯)ä¸ä¾èµ–ä»»ä½•æ¡†æ¶&#x2F;åº“ï¼Œèƒ½å¤Ÿè¿è¡Œåœ¨æ‰€æœ‰ Javaè¿è¡Œæ—¶ç¯å¢ƒï¼Œå¯¹ Spring Cloudæœ‰è¾ƒå¥½çš„æ”¯æŒ</h4><h4 id="10-1-4-2-æ§åˆ¶å°-Dashboard-åŸºäº-Spring-Boot-å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„-Tomcat-ç­‰åº”ç”¨å®¹å™¨-å°±è·Ÿnacosã€eurekaé‚£ç§æ§åˆ¶å°é‚£æ ·"><a href="#10-1-4-2-æ§åˆ¶å°-Dashboard-åŸºäº-Spring-Boot-å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„-Tomcat-ç­‰åº”ç”¨å®¹å™¨-å°±è·Ÿnacosã€eurekaé‚£ç§æ§åˆ¶å°é‚£æ ·" class="headerlink" title="10.1.4.2 æ§åˆ¶å°:(Dashboard)åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨(å°±è·Ÿnacosã€eurekaé‚£ç§æ§åˆ¶å°é‚£æ ·)"></a>10.1.4.2 æ§åˆ¶å°:(Dashboard)åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨(å°±è·Ÿnacosã€eurekaé‚£ç§æ§åˆ¶å°é‚£æ ·)</h4><h2 id="10-2-Sentinelæ§åˆ¶å°"><a href="#10-2-Sentinelæ§åˆ¶å°" class="headerlink" title="10.2 Sentinelæ§åˆ¶å°"></a>10.2 Sentinelæ§åˆ¶å°</h2><h3 id="10-2-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-2-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.2.1 éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£"></a><strong>10.2.1</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</h3><p><strong>1.</strong> éœ€æ±‚**:** æ­å»º <strong>Sentinel</strong> æ§åˆ¶å°ï¼Œç”¨äºæ˜¾ç¤ºå„ä¸ªå¾®æœåŠ¡çš„ä½¿ç”¨æƒ…å†µ</p><h3 id="10-2-2-ä¸‹è½½"><a href="#10-2-2-ä¸‹è½½" class="headerlink" title="10.2.2 ä¸‹è½½"></a><strong>10.2.2</strong> ä¸‹è½½</h3><h4 id="10-2-2-1-https-github-com-alibaba-Sentinel-releases-tag-v1-8-0"><a href="#10-2-2-1-https-github-com-alibaba-Sentinel-releases-tag-v1-8-0" class="headerlink" title="10.2.2.1 https://github.com/alibaba/Sentinel/releases/tag/v1.8.0"></a>10.2.2.1 <a href="https://github.com/alibaba/Sentinel/releases/tag/v1.8.0">https://github.com/alibaba/Sentinel/releases/tag/v1.8.0</a></h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620203427041.png" alt="image-20230620203427041" style="zoom:50%;" /><h3 id="10-2-3-è¿è¡Œ"><a href="#10-2-3-è¿è¡Œ" class="headerlink" title="10.2.3 è¿è¡Œ"></a><strong>10.2.3</strong> è¿è¡Œ</h3><h4 id="10-2-3-1-æŒ‡ä»¤"><a href="#10-2-3-1-æŒ‡ä»¤" class="headerlink" title="10.2.3.1 æŒ‡ä»¤:"></a>10.2.3.1 æŒ‡ä»¤:</h4><p>æˆ‘æŠŠä¸‹è½½çš„jaråŒ…æ”¾åœ¨ &#x2F;Applications&#x2F;Java&#x2F;jaråŒ…èµ„æº æ­¤å¤„äº†</p><p>å› æ­¤åœ¨ç»ˆç«¯è¿è¡Œä»¥ä¸‹æŒ‡ä»¤å³å¯å¯åŠ¨ Sentinel</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /Applications/Java/jaråŒ…èµ„æº</span><br><span class="line">java -jar sentinel-dashboard-1.8.0.jar //å¯åŠ¨</span><br><span class="line">java -jar sentinel-dashboard-1.8.0.jar --server.port=9999//ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç«¯å£è¿è¡Œè¯¥è¿›ç¨‹</span><br><span class="line">Ctrl+Cå³å¯å…³é—­æœåŠ¡</span><br></pre></td></tr></table></figure><h4 id="10-2-3-2-æ³¨æ„-Sentinel-æ§åˆ¶å°-é»˜è®¤ç«¯å£æ˜¯-8080"><a href="#10-2-3-2-æ³¨æ„-Sentinel-æ§åˆ¶å°-é»˜è®¤ç«¯å£æ˜¯-8080" class="headerlink" title="10.2.3.2 æ³¨æ„: Sentinel æ§åˆ¶å° é»˜è®¤ç«¯å£æ˜¯ 8080"></a>10.2.3.2 æ³¨æ„: Sentinel æ§åˆ¶å° é»˜è®¤ç«¯å£æ˜¯ 8080</h4><h3 id="10-2-4-è®¿é—®"><a href="#10-2-4-è®¿é—®" class="headerlink" title="10.2.4 è®¿é—®"></a><strong>10.2.4</strong> è®¿é—®</h3><h4 id="10-2-4-1-æµè§ˆå™¨-http-localhost-8080"><a href="#10-2-4-1-æµè§ˆå™¨-http-localhost-8080" class="headerlink" title="10.2.4.1 æµè§ˆå™¨: http://localhost:8080"></a>10.2.4.1 æµè§ˆå™¨: <a href="http://localhost:8080/">http://localhost:8080</a></h4><h4 id="10-2-4-2-æ§åˆ¶å°é¡µé¢"><a href="#10-2-4-2-æ§åˆ¶å°é¡µé¢" class="headerlink" title="10.2.4.2 æ§åˆ¶å°é¡µé¢"></a>10.2.4.2 æ§åˆ¶å°é¡µé¢</h4><p><strong>1.</strong> æµè§ˆå™¨è¾“å…¥**: <a href="http://localhost:8080/">http://localhost:8080</a> ,** ç”¨æˆ·**&#x2F;**å¯†ç éƒ½æ˜¯ <strong>sentinel</strong></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620203842208.png" alt="image-20230620203842208" style="zoom:25%;" /><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620204626829.png" alt="image-20230620204626829" style="zoom:50%;" /><p><strong>2.</strong> <strong>ç™»å½•æˆåŠŸåçš„é¡µé¢</strong>, <strong>ç›®å‰æ˜¯ç©ºçš„ï¼Œå› ä¸º</strong> <strong>sentinel</strong> <strong>è¿˜æ²¡æœ‰è¿›è¡Œæµé‡ç›‘æ§</strong></p><h2 id="10-3-Sentinelç›‘æ§å¾®æœåŠ¡"><a href="#10-3-Sentinelç›‘æ§å¾®æœåŠ¡" class="headerlink" title="10.3 Sentinelç›‘æ§å¾®æœåŠ¡"></a>10.3 Sentinelç›‘æ§å¾®æœåŠ¡</h2><h3 id="10-3-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-3-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.3.1 éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£"></a><strong>10.3.1</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</h3><ol><li>éœ€æ±‚**:** ä½¿ç”¨ <strong>Sentinel</strong> æ§åˆ¶å°å¯¹ <strong>member-service-nacos-provider-10004</strong> å¾®æœåŠ¡ è¿›è¡Œå®æ—¶ç›‘æ§</li></ol><p><strong>â€“</strong> ç¤ºæ„å›¾</p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230620204744222.png" alt="image-20230620204744222" style="zoom: 50%;" /><ol start="2"><li>å½“è°ƒç”¨äº†member-service-nacos-provider-10004å¾®æœåŠ¡æ—¶,å¯ä»¥ç›‘æ§åˆ°è¯·æ±‚çš„<strong>url&#x2F;QPS(æ¯ç§’æŸ¥è¯¢ç‡)&#x2F;å“åº”æ—¶é—´&#x2F;æµé‡</strong></li></ol><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230620205650814.png" alt="image-20230620205650814" style="zoom:50%;" /><h3 id="10-3-2-ä»£ç -x2F-é…ç½®å®ç°"><a href="#10-3-2-ä»£ç -x2F-é…ç½®å®ç°" class="headerlink" title="10.3.2 ä»£ç **&#x2F;**é…ç½®å®ç°"></a><strong>10.3.2</strong> ä»£ç **&#x2F;**é…ç½®å®ç°</h3><p><strong>1.</strong> ä¿®æ”¹ <strong>member-service-nacos-provider-10004</strong> çš„ <strong>pom.xml,</strong> å¼•å…¥ <strong>alibaba-sentinel</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    å¼•å…¥alibaba-sentinel starter    --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2.</strong> <strong>ä¿®æ”¹</strong> <strong>member-service-nacos-provider-10004</strong> <strong>çš„</strong> <strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10004</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-nacos-provider</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/e_commerce_center_db?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">QWEASDzxc123</span></span><br><span class="line"><span class="comment">#  é…ç½®nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#é…ç½®nacos serverçš„åœ°å€</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span> <span class="comment">#è¿™ä¸ªæ˜¯ sentinel æ§åˆ¶å°(sentinel dashboard)çš„åœ°å€ </span></span><br><span class="line">        <span class="comment">#è§£è¯» spring.cloud.sentinel.transport.portï¼š</span></span><br><span class="line">        <span class="comment">#1. spring.cloud.sentinel.transport.port ç«¯å£é…ç½®ä¼šåœ¨è¢«ç›‘æ§çš„å¾®æœåŠ¡</span></span><br><span class="line">        <span class="comment"># å¯¹åº”çš„æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ª Http Server</span></span><br><span class="line">        <span class="comment">#2. è¯¥ Server ä¼šä¸ Sentinel æ§åˆ¶å°åšäº¤äº’</span></span><br><span class="line">        <span class="comment">#3. æ¯”å¦‚ Sentinel æ§åˆ¶å°æ·»åŠ äº† 1 ä¸ªé™æµè§„åˆ™ï¼Œä¼šæŠŠè§„åˆ™æ•°æ® push ç»™è¿™ä¸ª</span></span><br><span class="line">        <span class="comment"># Http Server æ¥æ”¶ï¼ŒHttp Server å†å°†è§„åˆ™æ³¨å†Œåˆ° å¾®æœåŠ¡ ä¸­</span></span><br><span class="line">        <span class="comment">#4. ç®€å•çš„è¯´æ˜: spring.cloud.sentinel.transport.port:æŒ‡å®šè¢«ç›‘æ§çš„å¾®æœåŠ¡åº”ç”¨ä¸</span></span><br><span class="line">        <span class="comment"># Sentinel æ§åˆ¶å°äº¤äº’çš„ç«¯å£ï¼Œå¾®æœåŠ¡åº”ç”¨æœ¬åœ°ä¼šèµ·ä¸€ä¸ªè¯¥ç«¯å£å ç”¨çš„ Http Server</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span> <span class="comment">#é»˜è®¤ 8719ï¼Œå‡å¦‚è¢«å ç”¨äº†, ä¼šè‡ªåŠ¨ä» 8719 å¼€å§‹ä¾æ¬¡+1 æ‰«æã€‚</span></span><br><span class="line">        <span class="comment">#ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.study.springcloud.entity</span></span><br><span class="line"><span class="comment">#é…ç½®æš´éœ²æ‰€æœ‰çš„ç›‘æ§ç‚¹</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>3.</strong> <strong>æˆåŠŸå¯åŠ¨å</strong>, netstat -anb <strong>å¯ä»¥æŸ¥çœ‹åˆ°è¯¥ç«¯å£</strong>.</p><h3 id="10-3-3-æµ‹è¯•"><a href="#10-3-3-æµ‹è¯•" class="headerlink" title="10.3.3 æµ‹è¯•"></a><strong>10.3.3</strong> æµ‹è¯•</h3><h4 id="10-3-3-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-3-3-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.3.3.1 å¯åŠ¨ Nacos Server 8848"></a>10.3.3.1 å¯åŠ¨ Nacos Server 8848</h4><h4 id="10-3-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-3-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.3.3.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å° &#x2F; Sentinel dashboard"></a>10.3.3.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å° &#x2F; Sentinel dashboard</h4><h4 id="10-3-3-3-å¯åŠ¨-member-service-nacos-provider-10004"><a href="#10-3-3-3-å¯åŠ¨-member-service-nacos-provider-10004" class="headerlink" title="10.3.3.3 å¯åŠ¨ member-service-nacos-provider-10004"></a>10.3.3.3 å¯åŠ¨ member-service-nacos-provider-10004</h4><h4 id="10-3-3-4-æµè§ˆå™¨-localhost-10004-x2F-member-x2F-get-x2F-1"><a href="#10-3-3-4-æµè§ˆå™¨-localhost-10004-x2F-member-x2F-get-x2F-1" class="headerlink" title="10.3.3.4 æµè§ˆå™¨: localhost:10004&#x2F;member&#x2F;get&#x2F;1"></a>10.3.3.4 æµè§ˆå™¨: localhost:10004&#x2F;member&#x2F;get&#x2F;1</h4><h4 id="10-3-3-5-Sentinel-æ§åˆ¶å°ç›‘æ§é¡µé¢"><a href="#10-3-3-5-Sentinel-æ§åˆ¶å°ç›‘æ§é¡µé¢" class="headerlink" title="10.3.3.5 Sentinel æ§åˆ¶å°ç›‘æ§é¡µé¢"></a>10.3.3.5 Sentinel æ§åˆ¶å°ç›‘æ§é¡µé¢</h4><p><strong>1.</strong> æµè§ˆå™¨è¾“å…¥**: <a href="http://localhost:10004/member/get/1">http://localhost:10004/member/get/1</a>**</p><p><strong>2.</strong> <strong>è¿›å…¥åˆ°</strong> <strong>Sentinel</strong> <strong>æŸ¥çœ‹å®æ—¶ç›‘æ§æ•ˆæœ</strong>, <a href="http://localhost:8080/#/dashboard">http://localhost:8080/#/dashboard</a></p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230620211122568.png" alt="image-20230620211122568" style="zoom:50%;" /><h3 id="10-3-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#10-3-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="10.3.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a><strong>10.3.4</strong> æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><h4 id="10-3-4-1-QPS-Queries-Per-Second-æ¯ç§’æŸ¥è¯¢ç‡-ï¼Œæ˜¯æœåŠ¡å™¨æ¯ç§’å“åº”çš„æŸ¥è¯¢æ¬¡æ•°"><a href="#10-3-4-1-QPS-Queries-Per-Second-æ¯ç§’æŸ¥è¯¢ç‡-ï¼Œæ˜¯æœåŠ¡å™¨æ¯ç§’å“åº”çš„æŸ¥è¯¢æ¬¡æ•°" class="headerlink" title="10.3.4.1 QPS: Queries Per Second(æ¯ç§’æŸ¥è¯¢ç‡)ï¼Œæ˜¯æœåŠ¡å™¨æ¯ç§’å“åº”çš„æŸ¥è¯¢æ¬¡æ•°"></a>10.3.4.1 QPS: Queries Per Second(æ¯ç§’æŸ¥è¯¢ç‡)ï¼Œæ˜¯æœåŠ¡å™¨æ¯ç§’å“åº”çš„æŸ¥è¯¢æ¬¡æ•°</h4><h4 id="10-3-4-2-Sentinelé‡‡ç”¨çš„æ˜¯æ‡’åŠ è½½ï¼Œåªæœ‰è°ƒç”¨äº†æŸä¸ªæ¥å£-x2F-æœåŠ¡ï¼Œæ‰èƒ½çœ‹åˆ°ç›‘æ§æ•°æ®"><a href="#10-3-4-2-Sentinelé‡‡ç”¨çš„æ˜¯æ‡’åŠ è½½ï¼Œåªæœ‰è°ƒç”¨äº†æŸä¸ªæ¥å£-x2F-æœåŠ¡ï¼Œæ‰èƒ½çœ‹åˆ°ç›‘æ§æ•°æ®" class="headerlink" title="10.3.4.2 Sentinelé‡‡ç”¨çš„æ˜¯æ‡’åŠ è½½ï¼Œåªæœ‰è°ƒç”¨äº†æŸä¸ªæ¥å£&#x2F;æœåŠ¡ï¼Œæ‰èƒ½çœ‹åˆ°ç›‘æ§æ•°æ®"></a>10.3.4.2 Sentinelé‡‡ç”¨çš„æ˜¯æ‡’åŠ è½½ï¼Œåªæœ‰è°ƒç”¨äº†æŸä¸ªæ¥å£&#x2F;æœåŠ¡ï¼Œæ‰èƒ½çœ‹åˆ°ç›‘æ§æ•°æ®</h4><h2 id="10-4-Sentinelæµé‡æ§åˆ¶"><a href="#10-4-Sentinelæµé‡æ§åˆ¶" class="headerlink" title="10.4 Sentinelæµé‡æ§åˆ¶"></a>10.4 Sentinelæµé‡æ§åˆ¶</h2><h3 id="10-4-1-è§„åˆ™"><a href="#10-4-1-è§„åˆ™" class="headerlink" title="10.4.1 è§„åˆ™"></a><strong>10.4.1</strong> è§„åˆ™</h3><p><strong>1.</strong> å…ˆçœ‹ä¸€å¼ å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230620211426555.png" alt="image-20230620211426555" style="zoom:40%;" /><ol start="2"><li>å¯¹ä¸Šå›¾çš„è§£è¯»</li></ol><ul><li><p>èµ„æºåï¼šå”¯ä¸€åç§°ï¼Œé»˜è®¤è¯·æ±‚è·¯å¾„</p></li><li><p>é’ˆå¯¹æ¥æºï¼šSentineå¯ä»¥<u>é’ˆå¯¹è°ƒç”¨è€…è¿›è¡Œé™æµï¼Œå¡«å†™å¾®æœåŠ¡å</u>ï¼Œé»˜è®¤defaultï¼ˆä¸åŒºåˆ†æ¥æºï¼‰</p></li><li><p>é˜ˆå€¼ç±»å‹&#x2F;å•æœºé˜ˆå€¼ï¼š</p><ul><li>QPSï¼ˆæ¯ç§’é’Ÿçš„è¯·æ±‚æ•°é‡ï¼‰ï¼šå½“è°ƒç”¨è¯¥ api çš„ QPS è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµ</li><li>çº¿ç¨‹æ•°ï¼šå½“è°ƒç”¨è¯¥ api çš„çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµ</li></ul></li></ul><p>è§£è¯»ï¼š <strong>QPSå’Œçº¿ç¨‹æ•°çš„åŒºåˆ«</strong>ï¼Œæ³¨æ„å¬ï¼Œæ¯”å¦‚ QPSå’Œçº¿ç¨‹æˆ‘ä»¬éƒ½è®¾ç½®é˜ˆå€¼ä¸º1</p><p>ï¼ˆ1ï¼‰å¯¹QPSè€Œè¨€ï¼Œå¦‚æœåœ¨1ç§’å†…ï¼Œå®¢æˆ·ç«¯å‘å‡ºäº†2 æ¬¡è¯·æ±‚ï¼Œå°±è¾¾åˆ°é˜ˆå€¼ï¼Œä»è€Œé™æµ</p><p>ï¼ˆ2ï¼‰å¯¹çº¿ç¨‹æ•°è€Œè¨€ï¼Œå¦‚æœåœ¨1ç§’å†…ï¼Œå®¢æˆ·ç«¯å‘å‡ºäº†2 æ¬¡è¯·æ±‚ï¼Œä¸ä¸€å®šè¾¾åˆ°çº¿ç¨‹é™åˆ¶çš„åœ‹å€¼ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬1 æ¬¡è¯·æ±‚åå°ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯è¿™ä¸ªè¯·æ±‚å®Œæˆæ—¶é—´æ˜¯ 0.1 ç§’ï¼ˆå¯ä»¥è§†ä¸ºè¯¥è¯·æ±‚å¯¹åº”çš„çº¿ç¨‹å­˜æ´» 0.1 ç§’)ï¼Œæ‰€ä»¥å½“å®¢æˆ·ç«¯ç¬¬2 æ¬¡è¯·æ±‚æ—¶(æ¯”å¦‚å®¢æˆ·ç«¯æ˜¯åœ¨0.3ç§’å‘å‡ºçš„ï¼‰ï¼Œè¿™æ—¶ç¬¬ 1ä¸ªè¯·æ±‚çš„çº¿ç¨‹å°±å·±ç»ç»“æŸäº†ï¼Œå› æ­¤å°±æ²¡æœ‰è¾¾åˆ°çº¿ç¨‹çš„é—»å€¼ï¼Œä¹Ÿä¸ä¼šé™æµã€‚</p><p>ï¼ˆ3ï¼‰å°ä¼™ä¼´å¯ä»¥è¿™æ ·ç†è§£ï¼Œå¦‚æœ1ä¸ªè¯·æ±‚å¯¹åº”çš„çº¿ç¨‹å¹³å‡æ‰§è¡Œæ—¶é—´ä¸º 0.1 é‚£ä¹ˆï¼Œå°±ç›¸å½“äº QPS ä¸º 10</p><ul><li><p>æ˜¯å¦é›†ç¾¤ï¼šä¸éœ€è¦é›†ç¾¤</p></li><li><p>æµæ§æ¨¡å¼ï¼š</p><ul><li>ç›´æ¥ï¼šapi è¾¾åˆ°é™æµæ¡ä»¶æ—¶ï¼Œç›´æ¥é™æµ</li><li>å…³è”ï¼šå½“å…³è”çš„èµ„æºè¾¾åˆ°é—»å€¼æ—¶ï¼Œå°±é™æµè‡ªå·±</li><li>é“¾è·¯ï¼šå½“ä»æŸä¸ªæ¥å£è¿‡æ¥çš„èµ„æºè¾¾åˆ°é™æµæ¡ä»¶æ—¶ï¼Œå¼€å¯é™æµ</li></ul></li><li><p>æµæ§æ•ˆæœï¼š</p><ul><li>å¿«é€Ÿå¤±è´¥ï¼šç›´æ¥å¤±è´¥ï¼ŒæŠ›å¼‚å¸¸</li><li>Warm Upï¼šæ ¹æ® code Factorï¼ˆå†·åŠ è½½å› å­ï¼Œé»˜è®¤3ï¼‰çš„å€¼ï¼Œä»é˜ˆå€¼&#x2F;codeFactorï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿ï¼Œæ‰è¾¾åˆ°è®¾ç½®çš„ QPS é˜ˆå€¼</li><li>æ’é˜Ÿç­‰å¾…ï¼šåŒ€é€Ÿæ’é˜Ÿï¼Œè®©è¯·æ±‚ä»¥åŒ€é€Ÿçš„é€Ÿåº¦é€šè¿‡ï¼Œé˜ˆå€¼ç±»å‹å¿…é¡»è®¾ç½®ä¸º QPSï¼Œ å¦åˆ™æ— æ•ˆ</li></ul></li></ul><h3 id="10-4-2-æµé‡æ§åˆ¶å®ä¾‹-QPS"><a href="#10-4-2-æµé‡æ§åˆ¶å®ä¾‹-QPS" class="headerlink" title="10.4.2 æµé‡æ§åˆ¶å®ä¾‹**-QPS**"></a><strong>10.4.2</strong> æµé‡æ§åˆ¶å®ä¾‹**-QPS**</h3><h4 id="10-4-2-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-4-2-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.4.2.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.4.2.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p> <strong>1.</strong> éœ€æ±‚**:** é€šè¿‡ <strong>Sentinel</strong> å®ç° æµé‡æ§åˆ¶<br> <strong>2.</strong> <strong>å½“è°ƒç”¨</strong> <strong>member-service-nacos-provider-10004</strong> <strong>çš„</strong> <strong>&#x2F;member&#x2F;get&#x2F;</strong>   **API **æ—¶ï¼Œé™åˆ¶ <strong>1</strong>ç§’å†…æœ€å¤šè®¿é—® <strong>1</strong> <strong>æ¬¡ï¼Œå¦åˆ™ç›´æ¥å¤±è´¥ï¼ŒæŠ›å¼‚å¸¸</strong></p><h4 id="10-4-2-2-é…ç½®å®ç°æ­¥éª¤"><a href="#10-4-2-2-é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.4.2.2 é…ç½®å®ç°æ­¥éª¤"></a>10.4.2.2 é…ç½®å®ç°æ­¥éª¤</h4><p> <strong>1.</strong> ä¸º**&#x2F;member&#x2F;get&#x2F;1** å¢åŠ æµæ§è§„åˆ™</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230622221155249.png" alt="image-20230622221155249"></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230622221223336.png" alt="image-20230622221223336" style="zoom:40%;" /><p><strong>2.</strong> <strong>åœ¨æµæ§è§„åˆ™èœå•ï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢çš„æµæ§è§„åˆ™</strong></p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230622221447805.png" alt="image-20230622221447805" style="zoom: 33%;" /><h4 id="10-4-2-3-æµ‹è¯•"><a href="#10-4-2-3-æµ‹è¯•" class="headerlink" title="10.4.2.3 æµ‹è¯•"></a>10.4.2.3 æµ‹è¯•</h4><h5 id="10-4-2-3-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-4-2-3-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.4.2.3.1 å¯åŠ¨ Nacos Server 8848"></a><strong>10.4.2.3.1</strong> å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-4-2-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard-10-4-2-3-3-å¯åŠ¨-member-service-nacos-provider-10004"><a href="#10-4-2-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard-10-4-2-3-3-å¯åŠ¨-member-service-nacos-provider-10004" class="headerlink" title="10.4.2.3.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°**&#x2F;Sentinel dashboard 10.4.2.3.3** å¯åŠ¨ **member-service-nacos-provider-10004 **"></a>10.4.2.3.2 å¯åŠ¨ <strong>Sentinel8080</strong> æ§åˆ¶å°**&#x2F;Sentinel dashboard 10.4.2.3.3** å¯åŠ¨ **member-service-nacos-provider-10004 **</h5><h5 id="10-4-2-3-4-æµè§ˆå™¨-localhost-10004-x2F-member-x2F-get-x2F-1"><a href="#10-4-2-3-4-æµè§ˆå™¨-localhost-10004-x2F-member-x2F-get-x2F-1" class="headerlink" title="10.4.2.3.4 æµè§ˆå™¨**: localhost:10004&#x2F;member&#x2F;get&#x2F;1 **"></a><strong>10.4.2.3.4</strong> æµè§ˆå™¨**: localhost:10004&#x2F;member&#x2F;get&#x2F;1 **</h5><h5 id="10-4-2-3-5-Sentinel-æ§åˆ¶å°ç›‘æ§é¡µé¢"><a href="#10-4-2-3-5-Sentinel-æ§åˆ¶å°ç›‘æ§é¡µé¢" class="headerlink" title="10.4.2.3.5 Sentinel æ§åˆ¶å°ç›‘æ§é¡µé¢"></a><strong>10.4.2.3.5 Sentinel</strong> æ§åˆ¶å°ç›‘æ§é¡µé¢</h5><p><strong>1.</strong> æµè§ˆå™¨è¾“å…¥**: <a href="http://localhost:10004/member/get/1">http://localhost:10004/member/get/1</a> , 1** ç§’é’Ÿå†…è®¿é—®æ¬¡æ•°ä¸è¶…è¿‡ <strong>1</strong> æ¬¡**,** é¡µ é¢æ˜¾ç¤ºæ­£å¸¸</p><p><strong>2.</strong> <strong>æµè§ˆå™¨è¾“å…¥</strong>:<a href="http://localhost:10004/member/get/1">http://localhost:10004/member/get/1</a> ,1ç§’é’Ÿå†…è®¿é—®æ¬¡æ•°è¶…è¿‡1æ¬¡, <strong>é¡µé¢å‡ºç°é”™è¯¯æç¤º</strong></p><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230622221636917.png" alt="image-20230622221636917" style="zoom:33%;" /><h4 id="10-4-2-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#10-4-2-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="10.4.2.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>10.4.2.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><h5 id="1-æµé‡è§„åˆ™æ”¹åŠ¨ï¼Œå®æ—¶ç”Ÿæ•ˆï¼Œä¸éœ€é‡å¯å¾®æœåŠ¡-Sentinel-æ§åˆ¶å°"><a href="#1-æµé‡è§„åˆ™æ”¹åŠ¨ï¼Œå®æ—¶ç”Ÿæ•ˆï¼Œä¸éœ€é‡å¯å¾®æœåŠ¡-Sentinel-æ§åˆ¶å°" class="headerlink" title="1. æµé‡è§„åˆ™æ”¹åŠ¨ï¼Œå®æ—¶ç”Ÿæ•ˆï¼Œä¸éœ€é‡å¯å¾®æœåŠ¡ , Sentinel æ§åˆ¶å°"></a><strong>1.</strong> æµé‡è§„åˆ™æ”¹åŠ¨ï¼Œå®æ—¶ç”Ÿæ•ˆï¼Œ<u>ä¸éœ€é‡å¯å¾®æœåŠ¡ <strong>, Sentinel</strong> æ§åˆ¶å°</u></h5><p>â€‹ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºsentinelä¸­è§„åˆ™ä¸€å‘ç”Ÿæ”¹åŠ¨ï¼Œå°±ä¼šå°†ä¿¡æ¯pushåˆ°å¾®æœåŠ¡ä¸»æœºç›‘å¬sentinelæœåŠ¡çš„è¿›ç¨‹</p><h5 id="2-åœ¨-sentinel-é…ç½®æµé‡è§„åˆ™æ—¶ï¼Œå¦‚ä½•é…ç½®é€šé…ç¬¦é—®é¢˜ï¼Œ-æ¯”å¦‚-x2F-member-x2F-get-x2F-1-x2F-member-x2F-get-x2F-2-ç»Ÿä¸€ä½¿ç”¨ä¸€ä¸ªè§„åˆ™"><a href="#2-åœ¨-sentinel-é…ç½®æµé‡è§„åˆ™æ—¶ï¼Œå¦‚ä½•é…ç½®é€šé…ç¬¦é—®é¢˜ï¼Œ-æ¯”å¦‚-x2F-member-x2F-get-x2F-1-x2F-member-x2F-get-x2F-2-ç»Ÿä¸€ä½¿ç”¨ä¸€ä¸ªè§„åˆ™" class="headerlink" title="2. åœ¨ sentinel é…ç½®æµé‡è§„åˆ™æ—¶ï¼Œå¦‚ä½•é…ç½®é€šé…ç¬¦é—®é¢˜ï¼Œ æ¯”å¦‚ &#x2F;member&#x2F;get&#x2F;1 &#x2F;member&#x2F;get&#x2F;2 ç»Ÿä¸€ä½¿ç”¨ä¸€ä¸ªè§„åˆ™"></a><strong>2.</strong> åœ¨ sentinel é…ç½®æµé‡è§„åˆ™æ—¶ï¼Œå¦‚ä½•é…ç½®é€šé…ç¬¦é—®é¢˜ï¼Œ æ¯”å¦‚ &#x2F;member&#x2F;get&#x2F;1 &#x2F;member&#x2F;get&#x2F;2 ç»Ÿä¸€ä½¿ç”¨ä¸€ä¸ªè§„åˆ™</h5><ul><li>æ–¹æ¡ˆ1: åœ¨sentinelä¸­ &#x2F;member&#x2F;get?id&#x3D;1 å’Œ &#x2F;member&#x2F;get?id&#x3D;2 è¢«ç»Ÿä¸€è®¤ä¸ºæ˜¯**&#x2F;member&#x2F;get** æ‰€ä»¥åªè¦å¯¹&#x2F;member&#x2F;get é™æµå°±OKäº†.      (å°†è¦æºå¸¦çš„å‚æ•°æ”¾åœ¨è½½è·è€Œä¸æ˜¯è·¯å¾„ä¸­)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/member/get&quot;, params = &quot;id&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getgetMemberById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">    <span class="type">Member</span> <span class="variable">member</span> <span class="operator">=</span> memberService.queryMemberById(id);</span><br><span class="line">    <span class="keyword">if</span>(member != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;æŸ¥è¯¢æˆåŠŸ member-service-nacos-provider-10004&quot;</span>,member);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;402&quot;</span>,<span class="string">&quot;ID = &quot;</span>+ id + <span class="string">&quot;ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/Users/donn/Library/Application Support/typora-user-images/image-20230622223803411.png" alt="image-20230622223803411" style="zoom: 50%;" /><p>è®¿é—®ï¼š<a href="http://localhost:10004/member/get?id=3">http://localhost:10004/member/get?id=3</a></p><ul><li>æ–¹æ¡ˆ2: URLèµ„æºæ¸…æ´—<br>å¯ä»¥é€šè¿‡ UrlCleaner æ¥å£æ¥å®ç°èµ„æºæ¸…æ´—ï¼Œä¹Ÿå°±æ˜¯å¯¹äº&#x2F;member&#x2F;get&#x2F;{id}è¿™ä¸ª URLï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿä¸€å½’é›†åˆ°&#x2F;member&#x2F;get&#x2F;*èµ„æºä¸‹ï¼Œå…·ä½“é…ç½®ä»£ç å¦‚ä¸‹ï¼Œå®ç° UrlCleaner æ¥å£ï¼Œå¹¶é‡å†™ clean æ–¹æ³•å³å¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ·»åŠ ä»£ç ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.study.springcloud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.adapter.servlet.callback.UrlCleaner;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/6/22</span></span><br><span class="line"><span class="comment"> * 22:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomUrlCleaner</span> <span class="keyword">implements</span> <span class="title class_">UrlCleaner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">clean</span><span class="params">(String originURL)</span> &#123;</span><br><span class="line">        <span class="comment">//èµ„æºæ¸…æ´—</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(originURL))&#123;</span><br><span class="line">            <span class="keyword">return</span> originURL;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (originURL.startsWith(<span class="string">&quot;/member/get&quot;</span>))&#123;</span><br><span class="line">            <span class="comment">// 1. å¦‚æœè¯·æ±‚çš„æ˜¯æ¥å£ /member/get å¼€å¤´çš„, æ¯”å¦‚/member/get/1</span></span><br><span class="line">            <span class="comment">// 2. ç»™ sentinel çš„è¿”å›çš„èµ„æºåå°±æ˜¯ /member/get/*</span></span><br><span class="line">            <span class="comment">// 3. åœ¨ sentinel å¯¹ /member/get/* æ·»åŠ æµæ§è§„åˆ™å³å¯</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;/member/get/*&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦åˆ™ è¿”å›æ”¶åˆ°çš„URLå³å¯</span></span><br><span class="line">        <span class="keyword">return</span> originURL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-å¦‚æœ-sentinel-æµæ§è§„åˆ™æ²¡æœ‰æŒä¹…åŒ–ï¼Œå½“æˆ‘ä»¬é‡å¯è°ƒç”¨-API-æ‰€åœ¨å¾®æœåŠ¡æ¨¡å—åï¼Œè§„åˆ™ä¼šä¸¢å¤±ï¼Œéœ€è¦é‡æ–°åŠ å…¥"><a href="#3-å¦‚æœ-sentinel-æµæ§è§„åˆ™æ²¡æœ‰æŒä¹…åŒ–ï¼Œå½“æˆ‘ä»¬é‡å¯è°ƒç”¨-API-æ‰€åœ¨å¾®æœåŠ¡æ¨¡å—åï¼Œè§„åˆ™ä¼šä¸¢å¤±ï¼Œéœ€è¦é‡æ–°åŠ å…¥" class="headerlink" title="3. å¦‚æœ sentinel æµæ§è§„åˆ™æ²¡æœ‰æŒä¹…åŒ–ï¼Œå½“æˆ‘ä»¬é‡å¯è°ƒç”¨ API æ‰€åœ¨å¾®æœåŠ¡æ¨¡å—åï¼Œè§„åˆ™ä¼šä¸¢å¤±ï¼Œéœ€è¦é‡æ–°åŠ å…¥"></a><strong>3.</strong> <strong>å¦‚æœ</strong> <strong>sentinel</strong> <strong>æµæ§è§„åˆ™æ²¡æœ‰æŒä¹…åŒ–ï¼Œå½“æˆ‘ä»¬é‡å¯è°ƒç”¨</strong> <strong>API</strong> <strong>æ‰€åœ¨å¾®æœåŠ¡æ¨¡å—åï¼Œè§„åˆ™ä¼šä¸¢å¤±ï¼Œéœ€è¦é‡æ–°åŠ å…¥</strong></h5><h3 id="10-4-3-æµé‡æ§åˆ¶å®ä¾‹-çº¿ç¨‹æ•°"><a href="#10-4-3-æµé‡æ§åˆ¶å®ä¾‹-çº¿ç¨‹æ•°" class="headerlink" title="10.4.3 æµé‡æ§åˆ¶å®ä¾‹**-**çº¿ç¨‹æ•°"></a><strong>10.4.3</strong> æµé‡æ§åˆ¶å®ä¾‹**-**çº¿ç¨‹æ•°</h3><h4 id="10-4-3-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-4-3-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.4.3.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.4.3.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p> <strong>1.</strong> éœ€æ±‚**:** é€šè¿‡ <strong>Sentinel</strong> å®ç° æµé‡æ§åˆ¶<br> <strong>2.</strong> å½“è°ƒç”¨ <strong>member-service-nacos-provider-10004</strong> çš„ <strong>&#x2F;member&#x2F;get&#x2F;*</strong>   <strong>API</strong> æ—¶ï¼Œ<u>é™åˆ¶åªæœ‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹</u>ï¼Œå¦åˆ™ç›´æ¥å¤±è´¥ï¼ŒæŠ›å¼‚å¸¸**.**</p><h4 id="10-4-3-2-é…ç½®å®ç°æ­¥éª¤"><a href="#10-4-3-2-é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.4.3.2 é…ç½®å®ç°æ­¥éª¤"></a>10.4.3.2 é…ç½®å®ç°æ­¥éª¤</h4><p><strong>1.</strong> ä¸º**&#x2F;member&#x2F;get&#x2F;*** å¢åŠ æµæ§è§„åˆ™</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623143357430.png" alt="image-20230623143357430"></p><p><strong>2.</strong> <strong>åœ¨æµæ§è§„åˆ™èœå•ï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢çš„æµæ§è§„åˆ™</strong></p><h4 id="10-4-3-3-æµ‹è¯•"><a href="#10-4-3-3-æµ‹è¯•" class="headerlink" title="10.4.3.3 æµ‹è¯•"></a>10.4.3.3 æµ‹è¯•</h4><h5 id="10-4-3-3-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-4-3-3-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.4.3.3.1 å¯åŠ¨ Nacos Server 8848"></a><strong>10.4.3.3.1</strong> å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-4-3-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-4-3-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.4.3.3.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°**&#x2F;Sentinel dashboard **"></a>10.4.3.3.2 å¯åŠ¨ <strong>Sentinel8080</strong> æ§åˆ¶å°**&#x2F;Sentinel dashboard **</h5><h5 id="10-4-3-3-3-å¯åŠ¨-member-service-nacos-provider-10004"><a href="#10-4-3-3-3-å¯åŠ¨-member-service-nacos-provider-10004" class="headerlink" title="10.4.3.3.3 å¯åŠ¨ **member-service-nacos-provider-10004 **"></a><strong>10.4.3.3.3</strong> å¯åŠ¨ **member-service-nacos-provider-10004 **</h5><h5 id="10-4-3-3-4-æµè§ˆå™¨-localhost-10004-x2F-member-x2F-get-x2F-1"><a href="#10-4-3-3-4-æµè§ˆå™¨-localhost-10004-x2F-member-x2F-get-x2F-1" class="headerlink" title="10.4.3.3.4 æµè§ˆå™¨**: localhost:10004&#x2F;member&#x2F;get&#x2F;1 **"></a><strong>10.4.3.3.4</strong> æµè§ˆå™¨**: localhost:10004&#x2F;member&#x2F;get&#x2F;1 **</h5><h5 id="10-4-3-3-5-ç»“æœé¡µé¢"><a href="#10-4-3-3-5-ç»“æœé¡µé¢" class="headerlink" title="10.4.3.3.5 ç»“æœé¡µé¢"></a><strong>10.4.3.3.5</strong> ç»“æœé¡µé¢</h5><p><strong>1.</strong> æµè§ˆå™¨è¾“å…¥**: <a href="http://localhost:10004/member/get/1">http://localhost:10004/member/get/1</a> ,** å¿«é€Ÿåˆ·æ–°**,** é¡µé¢æ˜¾ç¤ºæ­£å¸¸**(<strong>åŸå› æ˜¯æœåŠ¡æ‰§è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œåˆ·æ–°ä¸‹ä¸€æ¬¡çš„æ—¶å€™ï¼Œå¯åŠ¨çš„å·¥ä½œçº¿ç¨‹ï¼Œå·²ç»å®Œæˆ</strong>)**</p><p><strong>2.</strong> <strong>ä¸ºäº†çœ‹åˆ°æ•ˆæœï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸‹</strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®©å®ƒç¡çœ ä¸€ä¸‹</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    TimeUnit.MILLISECONDS.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3.</strong> <strong>é‡å¯</strong> <strong>member-service-nacos-provider-10004 ,</strong> <strong>æ³¨æ„</strong>éœ€è¦é‡æ–°åŠ å…¥æµæ§è§„åˆ™.</p><p><strong>4.</strong> <strong>æµè§ˆå™¨è¾“å…¥</strong>: <a href="http://localhost:10004/member/get/1">http://localhost:10004/member/get/1</a> , <strong>å¿«é€Ÿåˆ·æ–°</strong>, <strong>é¡µé¢å‡ºç°å¼‚å¸¸</strong></p><h4 id="10-4-3-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#10-4-3-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="10.4.3.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>10.4.3.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p> <strong>1.</strong> <u>å½“æˆ‘ä»¬è¯·æ±‚ä¸€æ¬¡å¾®æœåŠ¡çš„ <strong>API</strong> æ¥å£æ—¶ï¼Œåå°ä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹</u></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623144551449.png" alt="image-20230623144551449" style="zoom:50%;" /><p>2.é˜ˆå€¼ç±»å‹ QPS å’Œ çº¿ç¨‹æ•°çš„åŒºåˆ«è®¨è®º</p><ul><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹å¹³å‡æ‰§è¡Œæ—¶é—´ä¸º0.05ç§’ï¼Œå°±è¯´æ˜åœ¨1ç§’é’Ÿï¼Œå¯ä»¥æ‰§è¡Œ20æ¬¡(ç›¸å½“äº QPSä¸º20)</li><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹å¹³å‡æ‰§è¡Œæ—¶é—´ä¸º1ç§’ï¼Œè¯´æ˜1ç§’é’Ÿï¼Œå¯ä»¥æ‰§è¡Œ1æ¬¡(ç›¸å½“äº QPSä¸º1)</li><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹å¹³å‡æ‰§è¡Œæ—¶é—´ä¸º2ç§’ï¼Œè¯´æ˜2ç§’é’Ÿå†…ï¼Œæ‰èƒ½æ‰§è¡Œ1æ¬¡è¯·æ±‚</li></ul><h3 id="10-4-4-æµé‡æ§åˆ¶å®ä¾‹-å…³è”"><a href="#10-4-4-æµé‡æ§åˆ¶å®ä¾‹-å…³è”" class="headerlink" title="10.4.4 æµé‡æ§åˆ¶å®ä¾‹**-**å…³è”"></a><strong>10.4.4</strong> æµé‡æ§åˆ¶å®ä¾‹**-**å…³è”</h3><h4 id="10-4-4-1-å…³è”çš„å«ä¹‰"><a href="#10-4-4-1-å…³è”çš„å«ä¹‰" class="headerlink" title="10.4.4.1 å…³è”çš„å«ä¹‰"></a>10.4.4.1 å…³è”çš„å«ä¹‰</h4><h5 id="10-4-4-1-1-å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±"><a href="#10-4-4-1-1-å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±" class="headerlink" title="10.4.4.1.1 å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±"></a><strong>10.4.4.1.1</strong> <u>å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±</u></h5><h4 id="10-4-4-2-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-4-4-2-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.4.4.2 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.4.4.2 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>1.</strong> éœ€æ±‚**:** é€šè¿‡ <strong>Sentinel</strong> å®ç° æµé‡æ§åˆ¶</p><p><strong>2.</strong> å½“è°ƒç”¨ <strong>member-service-nacos-provider-10004</strong> çš„ <strong>&#x2F;t2 API</strong> æ¥å£æ—¶ï¼Œå¦‚æœ <strong>QPS</strong> è¶…è¿‡ <strong>1</strong>ï¼Œè¿™æ—¶è°ƒç”¨ <strong>&#x2F;t1 API</strong> æ¥å£ ç›´æ¥å¤±è´¥ï¼ŒæŠ›å¼‚å¸¸**.** </p><p>â€‹æ¢³ç†: <strong>&#x2F;t2</strong> æ˜¯å…³è”çš„èµ„æº <strong>,</strong> é™æµçš„èµ„æºæ˜¯**&#x2F;t1**</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/t1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;t1æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/t2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;t2æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="10-4-4-3-é…ç½®å®ç°æ­¥éª¤"><a href="#10-4-4-3-é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.4.4.3 é…ç½®å®ç°æ­¥éª¤"></a>10.4.4.3 é…ç½®å®ç°æ­¥éª¤</h4><p> <strong>1.</strong> ä¸º**&#x2F;t1** å¢åŠ æµæ§è§„åˆ™</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623150310128.png" alt="image-20230623150310128" style="zoom:50%;" /><p><strong>2.</strong> <strong>åœ¨æµæ§è§„åˆ™èœå•ï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢çš„æµæ§è§„åˆ™</strong></p><h4 id="10-4-4-4-æµ‹è¯•"><a href="#10-4-4-4-æµ‹è¯•" class="headerlink" title="10.4.4.4 æµ‹è¯•"></a>10.4.4.4 æµ‹è¯•</h4><h5 id="10-4-4-4-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-4-4-4-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.4.4.4.1 å¯åŠ¨ Nacos Server 8848"></a><strong>10.4.4.4.1</strong> å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-4-4-4-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-4-4-4-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.4.4.4.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°**&#x2F;Sentinel dashboard**"></a>10.4.4.4.2 å¯åŠ¨ <strong>Sentinel8080</strong> æ§åˆ¶å°**&#x2F;Sentinel dashboard**</h5><h5 id="10-4-4-4-3-å¯åŠ¨-member-service-nacos-provider-10004"><a href="#10-4-4-4-3-å¯åŠ¨-member-service-nacos-provider-10004" class="headerlink" title="10.4.4.4.3 å¯åŠ¨ **member-service-nacos-provider-10004 **"></a>10.4.4.4.3 å¯åŠ¨ **member-service-nacos-provider-10004 **</h5><h5 id="10-4-4-4-4-ã€ŒPostmanæ¨¡æ‹Ÿé«˜å¹¶å‘è®¿é—®-x2F-t2-ã€"><a href="#10-4-4-4-4-ã€ŒPostmanæ¨¡æ‹Ÿé«˜å¹¶å‘è®¿é—®-x2F-t2-ã€" class="headerlink" title="10.4.4.4.4 ã€ŒPostmanæ¨¡æ‹Ÿé«˜å¹¶å‘è®¿é—®**&#x2F;t2**ã€"></a><strong>10.4.4.4.4 ã€ŒPostman</strong>æ¨¡æ‹Ÿé«˜å¹¶å‘è®¿é—®**&#x2F;t2**ã€</h5><p><strong>1.</strong> åˆ›å»ºæ–°çš„ <strong>http request</strong></p><p><strong>2.</strong> <strong>ä¿å­˜</strong> <strong>request</strong> <strong>åˆ° ä¸€ä¸ªæ–°çš„</strong> <strong>collection</strong> <strong>ä¸­</strong></p><p><strong>3.</strong> <strong>è®¾ç½®</strong> <strong>run collection</strong> <strong>å‚æ•°</strong>, <strong>å¹¶è¿è¡Œ</strong></p><p><strong>4.</strong> <strong>æµè§ˆå™¨è®¿é—®</strong>: <a href="http://localhost:10004/t1">http://localhost:10004/t1</a></p><h5 id="10-4-4-4-5-æµè§ˆå™¨-localhost-10004-x2F-t1"><a href="#10-4-4-4-5-æµè§ˆå™¨-localhost-10004-x2F-t1" class="headerlink" title="10.4.4.4.5 æµè§ˆå™¨: localhost:10004&#x2F;t1"></a><strong>10.4.4.4.5</strong> æµè§ˆå™¨: localhost:10004&#x2F;t1</h5><p><strong>1.</strong> æµè§ˆå™¨è®¿é—® <strong><a href="http://localhost:10004/t1">http://localhost:10004/t1</a></strong> çš„ç»“æœé¡µé¢</p><h4 id="10-4-4-5-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#10-4-4-5-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="10.4.4.5 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>10.4.4.5 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p> <strong>10.4.4.5.1</strong> åœ¨ <strong>postman</strong> æ‰§è¡Œ é«˜å¹¶å‘è®¿é—® <strong>&#x2F;t2</strong> æ²¡æœ‰ç»“æŸæ—¶ï¼Œ å»è®¿é—® <strong>&#x2F;t1</strong> æ‰èƒ½çœ‹åˆ°æµæ§å¼‚å¸¸å‡ºç°</p><h3 id="10-4-5-æµé‡æ§åˆ¶å®ä¾‹-Warm-up"><a href="#10-4-5-æµé‡æ§åˆ¶å®ä¾‹-Warm-up" class="headerlink" title="10.4.5 æµé‡æ§åˆ¶å®ä¾‹**-Warm up**"></a>10.4.5 æµé‡æ§åˆ¶å®ä¾‹**-Warm up**</h3><h4 id="10-4-5-1-Warm-up-ä»‹ç»"><a href="#10-4-5-1-Warm-up-ä»‹ç»" class="headerlink" title="10.4.5.1 Warm up ä»‹ç»"></a>10.4.5.1 Warm up ä»‹ç»</h4><p><strong>1.</strong> æ¦‚è¿°</p><ul><li><strong>å½“æµé‡çªç„¶å¢å¤§çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šå¸Œæœ›ç³»ç»Ÿä»ç©ºé—²çŠ¶æ€åˆ°ç¹å¿™çŠ¶æ€çš„åˆ‡æ¢çš„æ—¶é—´é•¿ ä¸€äº›ã€‚å³å¦‚æœç³»ç»Ÿåœ¨æ­¤ä¹‹å‰é•¿æœŸå¤„äºç©ºé—²çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¸Œæœ›å¤„ç†è¯·æ±‚çš„æ•°é‡æ˜¯ç¼“æ­¥çš„ å¢å¤šï¼Œç»è¿‡é¢„æœŸçš„æ—¶é—´ä»¥åï¼Œåˆ°è¾¾ç³»ç»Ÿå¤„ç†è¯·æ±‚ä¸ªæ•°çš„æœ€å¤§å€¼ã€‚</strong>Warm Up(<strong>å†·å¯åŠ¨ï¼Œ é¢„çƒ­</strong>)<strong>æ¨¡å¼å°±æ˜¯ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„çš„ã€‚</strong></li><li><strong>è¿™ä¸ªåœºæ™¯ä¸»è¦ç”¨äºå¯åŠ¨éœ€è¦é¢å¤–å¼€é”€çš„åœºæ™¯ï¼Œä¾‹å¦‚å»ºç«‹æ•°æ®åº“è¿æ¥ç­‰</strong></li></ul><p><strong>2.</strong> <strong>ä¸€å¼ å›¾</strong></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623215536876.png" alt="image-20230623215536876" style="zoom:50%;" /><ul><li><strong>é€šå¸¸å†·å¯åŠ¨çš„è¿‡ç¨‹ç³»ç»Ÿå…è®¸é€šè¿‡çš„</strong> <strong>QPS</strong> <strong>æ›²çº¿å›¾</strong>(ä¸Šå›¾)</li><li><strong>é»˜è®¤</strong> <strong>coldFactor</strong> <strong>ä¸º</strong> <strong>3</strong>ï¼Œå³è¯·æ±‚ <strong>QPS</strong> <strong>ä»</strong> <strong>threshold &#x2F; 3</strong> <strong>å¼€å§‹ï¼Œç»é¢„çƒ­æ—¶é•¿é€æ¸å‡è‡³è®¾å®šçš„</strong> <strong>QPS</strong> <strong>é˜ˆå€¼</strong></li><li><strong>è¿™é‡Œçš„</strong>threshold <strong>å°±æ˜¯æœ€ç»ˆè¦è¾¾åˆ°çš„</strong>QPSé˜ˆå€¼.</li></ul><h5 id="10-4-5-1-1-æ–‡-æ¡£"><a href="#10-4-5-1-1-æ–‡-æ¡£" class="headerlink" title="10.4.5.1.1 æ–‡ æ¡£ :"></a><strong>10.4.5.1.1</strong> æ–‡ æ¡£ <strong>:</strong></h5><p><strong><a href="https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8">https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8</a></strong></p><h5 id="10-4-5-1-2-é»˜è®¤-coldFactor-ä¸º-3ï¼Œå³è¯·æ±‚-QPS-ä»-threshold-x2F-3-å¼€å§‹ï¼Œç»é¢„çƒ­æ—¶é•¿é€æ¸å‡è‡³è®¾å®šçš„-QPS-é˜ˆå€¼"><a href="#10-4-5-1-2-é»˜è®¤-coldFactor-ä¸º-3ï¼Œå³è¯·æ±‚-QPS-ä»-threshold-x2F-3-å¼€å§‹ï¼Œç»é¢„çƒ­æ—¶é•¿é€æ¸å‡è‡³è®¾å®šçš„-QPS-é˜ˆå€¼" class="headerlink" title="10.4.5.1.2 é»˜è®¤ coldFactor ä¸º 3ï¼Œå³è¯·æ±‚ QPS ä» threshold &#x2F; 3 å¼€å§‹ï¼Œç»é¢„çƒ­æ—¶é•¿é€æ¸å‡è‡³è®¾å®šçš„ QPS é˜ˆå€¼"></a><strong>10.4.5.1.2</strong> é»˜è®¤ <strong>coldFactor</strong> ä¸º <strong>3</strong>ï¼Œå³è¯·æ±‚ <strong>QPS</strong> ä» <strong>threshold &#x2F; 3</strong> å¼€å§‹ï¼Œç»é¢„çƒ­æ—¶é•¿é€æ¸å‡è‡³è®¾å®šçš„ <strong>QPS</strong> é˜ˆå€¼</h5><h5 id="10-4-5-1-3-Warm-up-ç§°ä¸º-å†·å¯åŠ¨-x2F-é¢„çƒ­"><a href="#10-4-5-1-3-Warm-up-ç§°ä¸º-å†·å¯åŠ¨-x2F-é¢„çƒ­" class="headerlink" title="10.4.5.1.3 Warm up ç§°ä¸º å†·å¯åŠ¨**&#x2F;**é¢„çƒ­"></a><strong>10.4.5.1.3 Warm up</strong> ç§°ä¸º å†·å¯åŠ¨**&#x2F;**é¢„çƒ­</h5><h5 id="10-4-5-1-4-åº”ç”¨åœºæ™¯-ç§’æ€åœ¨å¼€å¯ç¬é—´ï¼Œå¤§æµé‡å¾ˆå®¹æ˜“é€ æˆå†²å®ç³»ç»Ÿï¼ŒWarmup-å¯æ…¢æ…¢çš„æŠŠæµé‡æ”¾å…¥ï¼Œæœ€ç»ˆå°†é˜€å€¼å¢é•¿åˆ°è®¾ç½®é˜€å€¼"><a href="#10-4-5-1-4-åº”ç”¨åœºæ™¯-ç§’æ€åœ¨å¼€å¯ç¬é—´ï¼Œå¤§æµé‡å¾ˆå®¹æ˜“é€ æˆå†²å®ç³»ç»Ÿï¼ŒWarmup-å¯æ…¢æ…¢çš„æŠŠæµé‡æ”¾å…¥ï¼Œæœ€ç»ˆå°†é˜€å€¼å¢é•¿åˆ°è®¾ç½®é˜€å€¼" class="headerlink" title="10.4.5.1.4 åº”ç”¨åœºæ™¯**:** ç§’æ€åœ¨å¼€å¯ç¬é—´ï¼Œå¤§æµé‡å¾ˆå®¹æ˜“é€ æˆå†²å®ç³»ç»Ÿï¼ŒWarmup å¯æ…¢æ…¢çš„æŠŠæµé‡æ”¾å…¥ï¼Œæœ€ç»ˆå°†é˜€å€¼å¢é•¿åˆ°è®¾ç½®é˜€å€¼"></a><strong>10.4.5.1.4</strong> åº”ç”¨åœºæ™¯**:** ç§’æ€åœ¨å¼€å¯ç¬é—´ï¼Œå¤§æµé‡å¾ˆå®¹æ˜“é€ æˆå†²å®ç³»ç»Ÿï¼Œ<strong>Warmup</strong> å¯æ…¢æ…¢çš„æŠŠæµé‡æ”¾å…¥ï¼Œæœ€ç»ˆå°†é˜€å€¼å¢é•¿åˆ°è®¾ç½®é˜€å€¼</h5><h4 id="10-4-5-2-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-4-5-2-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.4.5.2 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.4.5.2 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>1.</strong> éœ€æ±‚**:** é€šè¿‡ <strong>Sentinel</strong> å®ç°æµé‡æ§åˆ¶**,**æ¼”ç¤º <strong>Warm up</strong></p><p><strong>2.</strong> è°ƒç”¨ <strong>member-service-nacos-provider-10004</strong> çš„ <strong>&#x2F;t2 API</strong> æ¥å£ï¼Œå°† <strong>QPS</strong> è®¾ç½®ä¸º <strong>9,</strong> è®¾ç½® <strong>Warm up</strong> å€¼ä¸º <strong>3</strong></p><p><strong>4.</strong> å«ä¹‰ä¸º è¯·æ±‚ <strong>&#x2F;t2</strong> çš„ <strong>QPS</strong> ä» <strong>threshold &#x2F; 3( 9 &#x2F;3 &#x3D; 3)</strong> å¼€å§‹ï¼Œç»é¢„çƒ­æ—¶é•¿**(3** ç§’**)<strong>é€æ¸å‡è‡³ è®¾å®šçš„ <strong>QPS</strong> é˜ˆå€¼</strong>(9)**</p><p><strong>5.</strong> ä¸ºä»€ä¹ˆæ˜¯ <strong>9 &#x2F; 3,</strong> è¿™ä¸ªæ˜¯ <strong>3</strong> å°±æ˜¯é»˜è®¤å†·å¯åŠ¨å¯åŠ¨åŠ è½½å› å­ <strong>coldFactor&#x3D;3</strong></p><p><strong>6.</strong> æµ‹è¯•é¢„æœŸæ•ˆæœ**:** åœ¨å‰ <strong>3</strong> ç§’ï¼Œå¦‚æœè®¿é—® <strong>&#x2F;t2</strong> çš„ <strong>QPS</strong> è¶…è¿‡ <strong>3,</strong> ä¼šç›´æ¥æŠ¥é”™ï¼Œåœ¨ <strong>3</strong> ç§’å è®¿é—® <strong>&#x2F;t2</strong> çš„ <strong>QPS</strong> è¶…è¿‡ <strong>3,</strong> å°äºç­‰äº <strong>9,</strong> æ˜¯æ­£å¸¸è®¿é—®</p><h4 id="10-4-5-3-é…ç½®å®ç°æ­¥éª¤"><a href="#10-4-5-3-é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.4.5.3 é…ç½®å®ç°æ­¥éª¤"></a>10.4.5.3 é…ç½®å®ç°æ­¥éª¤</h4><p><strong>1.</strong> ä¸º**&#x2F;t2** å¢åŠ æµæ§è§„åˆ™</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623220623200.png" alt="image-20230623220623200" style="zoom:50%;" /><p><strong>2.</strong> <strong>åœ¨æµæ§è§„åˆ™èœå•ï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢çš„æµæ§è§„åˆ™</strong></p><h4 id="10-4-5-4-æµ‹è¯•"><a href="#10-4-5-4-æµ‹è¯•" class="headerlink" title="10.4.5.4 æµ‹è¯•"></a>10.4.5.4 æµ‹è¯•</h4><h5 id="10-4-5-4-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-4-5-4-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.4.5.4.1 å¯åŠ¨ Nacos Server 8848"></a><strong>10.4.5.4.1</strong> å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-4-5-4-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-4-5-4-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.4.5.4.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°**&#x2F;Sentinel dashboard **"></a>10.4.5.4.2 å¯åŠ¨ <strong>Sentinel8080</strong> æ§åˆ¶å°**&#x2F;Sentinel dashboard **</h5><h5 id="10-4-5-4-3-å¯åŠ¨-member-service-nacos-provider-10004"><a href="#10-4-5-4-3-å¯åŠ¨-member-service-nacos-provider-10004" class="headerlink" title="10.4.5.4.3 å¯åŠ¨ **member-service-nacos-provider-10004 **"></a><strong>10.4.5.4.3</strong> å¯åŠ¨ **member-service-nacos-provider-10004 **</h5><h5 id="10-4-5-4-4-æµè§ˆå™¨-localhost-10004-x2F-t2"><a href="#10-4-5-4-4-æµè§ˆå™¨-localhost-10004-x2F-t2" class="headerlink" title="10.4.5.4.4 æµè§ˆå™¨**: localhost:10004&#x2F;t2**"></a><strong>10.4.5.4.4</strong> æµè§ˆå™¨**: localhost:10004&#x2F;t2**</h5><p><strong>1.</strong> æµè§ˆå™¨è®¿é—® <strong><a href="http://localhost:10004/t2">http://localhost:10004/t2</a></strong> å¿«é€Ÿåˆ·æ–°é¡µé¢ï¼Œåœ¨å‰ <strong>3</strong> ç§’ï¼Œä¼šå‡ºç°æµæ§å¼‚å¸¸ï¼Œ å <strong>3</strong> ç§’å°±æ­£å¸¸äº†**(<strong>å¦‚æœä½ åˆ·æ–°éå¸¸å¿« <strong>QPS&gt;9</strong> <strong>,</strong> ä»ç„¶ä¼šå‡ºç°æµæ§å¼‚å¸¸</strong>)**</p><h4 id="10-4-5-5-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#10-4-5-5-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="10.4.5.5 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>10.4.5.5 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p> <strong>10.4.5.5.1</strong> æµ‹è¯• <strong>Warm up</strong> æ•ˆæœä¸æ˜¯å¾ˆå¥½æµ‹ï¼Œå¦‚æœå‡ºä¸æ¥å¯ä»¥å°è¯•ï¼Œè°ƒæ•´æµæ§è§„åˆ™**:** æ¯”å¦‚ <strong>QPS</strong> ä¸º **11, Warm up é¢„çƒ­æ—¶é—´ **6 ç§’</p><h5 id="10-4-5-5-2-å¦‚æœè¯·æ±‚åœæ­¢-å³-ä¸€æ®µæ—¶é—´æ²¡æœ‰è¾¾åˆ°é˜ˆå€¼-Warm-up-è¿‡ç¨‹å°†é‡å¤-å°ä¼™ä¼´å¯ä»¥ç†è§£æ˜¯ä¸€ä¸ªå¼¹æ€§è¿‡ç¨‹"><a href="#10-4-5-5-2-å¦‚æœè¯·æ±‚åœæ­¢-å³-ä¸€æ®µæ—¶é—´æ²¡æœ‰è¾¾åˆ°é˜ˆå€¼-Warm-up-è¿‡ç¨‹å°†é‡å¤-å°ä¼™ä¼´å¯ä»¥ç†è§£æ˜¯ä¸€ä¸ªå¼¹æ€§è¿‡ç¨‹" class="headerlink" title="10.4.5.5.2 å¦‚æœè¯·æ±‚åœæ­¢**(å³:** ä¸€æ®µæ—¶é—´æ²¡æœ‰è¾¾åˆ°é˜ˆå€¼**), Warm up** è¿‡ç¨‹å°†é‡å¤**,** å°ä¼™ä¼´å¯ä»¥ç†è§£æ˜¯ä¸€ä¸ªå¼¹æ€§è¿‡ç¨‹"></a><strong>10.4.5.5.2</strong> å¦‚æœè¯·æ±‚åœæ­¢**(<strong>å³</strong>:** ä¸€æ®µæ—¶é—´æ²¡æœ‰è¾¾åˆ°é˜ˆå€¼**), Warm up** è¿‡ç¨‹å°†é‡å¤**,** å°ä¼™ä¼´å¯ä»¥ç†è§£æ˜¯ä¸€ä¸ªå¼¹æ€§è¿‡ç¨‹</h5><h3 id="10-4-6-æµé‡æ§åˆ¶å®ä¾‹-æ’é˜Ÿ"><a href="#10-4-6-æµé‡æ§åˆ¶å®ä¾‹-æ’é˜Ÿ" class="headerlink" title="10.4.6 æµé‡æ§åˆ¶å®ä¾‹**-**æ’é˜Ÿ"></a>10.4.6 æµé‡æ§åˆ¶å®ä¾‹**-**æ’é˜Ÿ</h3><h4 id="10-4-6-1-æ’é˜Ÿ-ä»‹ç»"><a href="#10-4-6-1-æ’é˜Ÿ-ä»‹ç»" class="headerlink" title="10.4.6.1 æ’é˜Ÿ ä»‹ç»"></a>10.4.6.1 æ’é˜Ÿ ä»‹ç»</h4><p><strong>1.</strong> æ’é˜Ÿæ–¹å¼:è¿™ç§æ–¹å¼ä¸¥æ ¼æ§åˆ¶äº†è¯·æ±‚é€šè¿‡çš„é—´éš”æ—¶é—´ï¼Œä¹Ÿå³æ˜¯è®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œå¯¹åº”çš„æ˜¯æ¼æ¡¶ç®—æ³•</p><p><strong>2.</strong> <strong>ä¸€å¼ å›¾</strong></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623221119829.png" alt="image-20230623221119829" style="zoom:33%;" /><p><strong>3.</strong> <strong>è¿™ç§æ–¹å¼ä¸»è¦ç”¨äºå¤„ç†é—´éš”æ€§çªå‘çš„æµé‡ï¼Œä¾‹å¦‚æ¶ˆæ¯é˜Ÿåˆ—ã€‚æ¯”å¦‚è¿™æ ·çš„åœºæ™¯ï¼Œåœ¨æŸä¸€ç§’æœ‰å¤§é‡çš„è¯·æ±‚åˆ°æ¥ï¼Œè€Œæ¥ä¸‹æ¥çš„å‡ ç§’åˆ™å¤„äºç©ºé—²çŠ¶æ€ï¼Œ<u>æˆ‘ä»¬å¸Œæœ›ç³»ç»Ÿèƒ½å¤Ÿåœ¨æ¥ä¸‹æ¥çš„ç©ºé—²æœŸé—´é€æ¸å¤„ç†è¿™äº›è¯·æ±‚</u>ï¼Œè€Œä¸æ˜¯åœ¨ç¬¬ä¸€ç§’ç›´æ¥æ‹’ç»å¤šä½™çš„è¯·æ±‚ã€‚-ç±»ä¼¼å‰é¢è¯´çš„å‰Šå³°å¡«è°·</strong></p><p><strong>4.</strong> <strong>åŒ€é€Ÿæ’é˜Ÿï¼Œé˜ˆå€¼å¿…é¡»è®¾ç½®ä¸ºQPS</strong></p><h4 id="10-4-6-2-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-4-6-2-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.4.6.2 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.4.6.2 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>1.</strong> éœ€æ±‚**:** é€šè¿‡ <strong>Sentinel</strong> å®ç° æµé‡æ§åˆ¶**-<strong>æ’é˜Ÿ<br><strong>2.</strong> è°ƒç”¨ <strong>member-service-nacos-provider-10004</strong> çš„ <strong>&#x2F;t2 API</strong> æ¥å£ï¼Œå°† <strong>QPS</strong> è®¾ç½®ä¸º <strong>1 **<br><strong>3.</strong> å½“è°ƒç”¨ <strong>&#x2F;t2</strong> çš„ <strong>QPS</strong> è¶…è¿‡ <strong>1</strong> æ—¶ï¼Œä¸æ‹’ç»è¯·æ±‚ï¼Œè€Œæ˜¯æ’é˜Ÿç­‰å¾…</strong>,</strong> ä¾æ¬¡æ‰§è¡Œ<br><strong>4.<strong>å½“ç­‰å¾…æ—¶é—´è¶…è¿‡ <strong>10</strong> ç§’ï¼Œåˆ™ä¸ºç­‰å¾…è¶…æ—¶â€”â€”</strong>ç­‰å¾…è¶…æ—¶å°±ä¸è¦äº†</strong></p><h4 id="10-4-6-3-ä¿®æ”¹ä¸šåŠ¡ç±»"><a href="#10-4-6-3-ä¿®æ”¹ä¸šåŠ¡ç±»" class="headerlink" title="10.4.6.3 ä¿®æ”¹ä¸šåŠ¡ç±»"></a>10.4.6.3 ä¿®æ”¹ä¸šåŠ¡ç±»</h4><p><strong>1.</strong> ä¸ºäº†æµ‹è¯•çœ‹åˆ°æ•ˆæœï¼Œä¿®æ”¹ <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/t2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//æ¨¡æ‹Ÿçº¿ç¨‹æ‰§è¡Œæ—¶é—´ä¸º1ç§’</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.MILLISECONDS.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  log.info(<span class="string">&quot;æ‰§è¡Œ t2() çº¿ç¨‹ id= &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;t2æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="10-4-6-4-é…ç½®å®ç°æ­¥éª¤"><a href="#10-4-6-4-é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.4.6.4 é…ç½®å®ç°æ­¥éª¤"></a>10.4.6.4 é…ç½®å®ç°æ­¥éª¤</h4><p><strong>1.</strong> ä¸º**&#x2F;t2** å¢åŠ æµæ§è§„åˆ™</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623222712777.png" alt="image-20230623222712777" style="zoom:50%;" /><p><strong>2.</strong> <strong>åœ¨æµæ§è§„åˆ™èœå•ï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢çš„æµæ§è§„åˆ™</strong></p><h4 id="10-4-6-5-æµ‹è¯•"><a href="#10-4-6-5-æµ‹è¯•" class="headerlink" title="10.4.6.5 æµ‹è¯•"></a>10.4.6.5 æµ‹è¯•</h4><h5 id="10-4-6-5-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-4-6-5-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.4.6.5.1 å¯åŠ¨ Nacos Server 8848"></a><strong>10.4.6.5.1</strong> å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-4-6-5-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-4-6-5-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.4.6.5.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°**&#x2F;Sentinel dashboard **"></a>10.4.6.5.2 å¯åŠ¨ <strong>Sentinel8080</strong> æ§åˆ¶å°**&#x2F;Sentinel dashboard **</h5><h5 id="10-4-6-5-3-å¯åŠ¨-member-service-nacos-provider-10004"><a href="#10-4-6-5-3-å¯åŠ¨-member-service-nacos-provider-10004" class="headerlink" title="10.4.6.5.3 å¯åŠ¨ **member-service-nacos-provider-10004 **"></a><strong>10.4.6.5.3</strong> å¯åŠ¨ **member-service-nacos-provider-10004 **</h5><h5 id="10-4-6-5-4-æµè§ˆå™¨-localhost-10004-x2F-t2"><a href="#10-4-6-5-4-æµè§ˆå™¨-localhost-10004-x2F-t2" class="headerlink" title="10.4.6.5.4 æµè§ˆå™¨**: localhost:10004&#x2F;t2**"></a><strong>10.4.6.5.4</strong> æµè§ˆå™¨**: localhost:10004&#x2F;t2**</h5><p><strong>1.</strong> æµè§ˆå™¨è®¿é—® <strong><a href="http://localhost:10004/t2">http://localhost:10004/t2</a></strong> å¿«é€Ÿåˆ·æ–°é¡µé¢ <strong>9</strong> æ¬¡ï¼Œè§‚å¯Ÿå‰å°**&#x2F;**åå°è¾“å‡ºçš„æƒ…å†µ</p><p>è¾“å‡ºç»“æœåˆ†æï¼šæ²¡æœ‰æŠ¥é”™è¯¯ï¼Œåå°è¯·æ±‚æ’é˜Ÿæ‰§è¡Œï¼Œæ¯éš”1såŒ€é€Ÿæ‰§è¡Œ</p><p><strong>2.</strong> <strong>æµè§ˆå™¨è®¿é—®</strong> <strong><a href="http://localhost:10004/t2">http://localhost:10004/t2</a></strong> <strong>å¿«é€Ÿåˆ·æ–°é¡µé¢</strong>20<strong>æ¬¡ï¼Œå½“è¯·æ±‚ç­‰å¾…æ—¶é—´è¶…è¿‡</strong>10S, <strong>ä»ç„¶å‡ºç°æµæ§å¼‚å¸¸</strong></p><h2 id="10-5-Sentinelç†”æ–­é™çº§"><a href="#10-5-Sentinelç†”æ–­é™çº§" class="headerlink" title="10.5 Sentinelç†”æ–­é™çº§"></a>10.5 Sentinelç†”æ–­é™çº§</h2><h3 id="10-5-1-çº¿ç¨‹å †ç§¯å¼•å‡ºç†”æ–­é™çº§"><a href="#10-5-1-çº¿ç¨‹å †ç§¯å¼•å‡ºç†”æ–­é™çº§" class="headerlink" title="10.5.1 çº¿ç¨‹å †ç§¯å¼•å‡ºç†”æ–­é™çº§"></a><strong>10.5.1</strong> çº¿ç¨‹å †ç§¯å¼•å‡ºç†”æ–­é™çº§</h3><p><strong>1.</strong> ä¸€ä¸ªæœåŠ¡å¸¸å¸¸ä¼šè°ƒç”¨åˆ«çš„æ¨¡å—ï¼Œå¯èƒ½æ˜¯å¦å¤–çš„ä¸€ä¸ªè¿œç¨‹æœåŠ¡ã€æ•°æ®åº“ï¼Œæˆ–è€…ç¬¬ä¸‰æ–¹ API ç­‰ã€‚</p><p><strong>2.</strong> ä¾‹å¦‚ï¼Œæ”¯ä»˜çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦è¿œç¨‹è°ƒç”¨é“¶è”æä¾›çš„ API;æŸ¥è¯¢æŸä¸ªå•†å“çš„ä»·æ ¼ï¼Œå¯èƒ½éœ€ è¦è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ã€‚ç„¶è€Œï¼Œè¿™ä¸ªè¢«ä¾èµ–æœåŠ¡çš„ç¨³å®šæ€§æ˜¯ä¸èƒ½ä¿è¯çš„ã€‚å¦‚æœä¾èµ–çš„æœåŠ¡å‡ºç° äº†ä¸ç¨³å®šçš„æƒ…å†µï¼Œè¯·æ±‚çš„å“åº”æ—¶é—´å˜é•¿ï¼Œé‚£ä¹ˆè°ƒç”¨æœåŠ¡çš„æ–¹æ³•çš„å“åº”æ—¶é—´ä¹Ÿä¼šå˜é•¿ï¼Œçº¿ç¨‹ä¼šäº§ç”Ÿå †ç§¯ï¼Œæœ€ç»ˆå¯èƒ½è€—å°½ä¸šåŠ¡è‡ªèº«çš„çº¿ç¨‹æ± ï¼ŒæœåŠ¡æœ¬èº«ä¹Ÿå˜å¾—ä¸å¯ç”¨</p><p><strong>3.</strong> è¿™æ—¶ï¼Œæˆ‘ä»¬<u>å¯¹ä¸ç¨³å®šçš„æœåŠ¡è¿›è¡Œç†”æ–­é™çº§ï¼Œè®©å…¶å¿«é€Ÿè¿”å›ç»“æœï¼Œä¸è¦é€ æˆçº¿ç¨‹å †ç§¯</u></p><h3 id="10-5-2-æ–‡æ¡£åœ°å€-https-sentinelguard-io-zh-cn-docs-circuit-breaking-html"><a href="#10-5-2-æ–‡æ¡£åœ°å€-https-sentinelguard-io-zh-cn-docs-circuit-breaking-html" class="headerlink" title="10.5.2 æ–‡æ¡£åœ°å€**: https://sentinelguard.io/zh-cn/docs/circuit-breaking.html**"></a><strong>10.5.2</strong> æ–‡æ¡£åœ°å€**: <a href="https://sentinelguard.io/zh-cn/docs/circuit-breaking.html">https://sentinelguard.io/zh-cn/docs/circuit-breaking.html</a>**</h3><h3 id="10-5-3-åŸºæœ¬ä»‹ç»"><a href="#10-5-3-åŸºæœ¬ä»‹ç»" class="headerlink" title="10.5.3 åŸºæœ¬ä»‹ç»"></a><strong>10.5.3</strong> åŸºæœ¬ä»‹ç»</h3><p><strong>1.</strong> ä¸€å¼ å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623223928543.png" alt="image-20230623223928543" style="zoom:50%;" /><p><strong>2.</strong> <strong>è§£è¯»ä¸Šå›¾</strong>:</p><ul><li><strong>ç°ä»£å¾®æœåŠ¡æ¶æ„éƒ½æ˜¯åˆ†å¸ƒå¼çš„ï¼Œç”±éå¸¸å¤šçš„æœåŠ¡ç»„æˆã€‚ä¸åŒæœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨ï¼Œç»„æˆå¤æ‚çš„è°ƒç”¨é“¾è·¯ã€‚</strong></li><li><strong>é“¾è·¯è°ƒç”¨ä¸­ä¼šäº§ç”Ÿæ”¾å¤§çš„æ•ˆæœã€‚å¤æ‚é“¾è·¯ä¸Šçš„æŸä¸€ç¯ä¸ç¨³å®šï¼Œå°±å¯èƒ½ä¼šå±‚å±‚çº§è”ï¼Œæœ€ç»ˆå¯¼è‡´æ•´ä¸ªé“¾è·¯éƒ½ä¸å¯ç”¨ã€‚</strong></li><li><strong>å› æ­¤éœ€è¦å¯¹ä¸ç¨³å®šçš„å¼±ä¾èµ–æœåŠ¡è°ƒç”¨è¿›è¡Œç†”æ–­é™çº§ï¼Œæš‚æ—¶åˆ‡æ–­ä¸ç¨³å®šè°ƒç”¨ï¼Œé¿å…å±€éƒ¨ä¸ç¨³å®šå› ç´ å¯¼è‡´æ•´ä½“çš„é›ªå´©</strong></li></ul><p><strong>3.</strong> <strong>ç†”æ–­,é™çº§,é™æµä¸‰è€…çš„å…³ç³»</strong></p><ul><li><p>ç†”æ–­ï¼šå¼ºè°ƒçš„æ˜¯æœåŠ¡ä¹‹é—´çš„è°ƒç”¨èƒ½å®ç°è‡ªæˆ‘æ¢å¤çš„çŠ¶æ€ </p></li><li><p>é™æµï¼šæ˜¯ä»ç³»ç»Ÿçš„æµé‡å…¥å£è€ƒè™‘, ä»è¿›å…¥çš„æµé‡ä¸Šè¿›è¡Œé™åˆ¶**, **è¾¾åˆ°ä¿æŠ¤ç³»ç»Ÿçš„ä½œç”¨</p></li><li><p>é™çº§ï¼šæ˜¯ä»ç³»ç»Ÿä¸šåŠ¡çš„ç»´åº¦è€ƒè™‘ï¼Œæµé‡å¤§äº†æˆ–è€…é¢‘ç¹å¼‚å¸¸, å¯ä»¥ç‰ºç‰²ä¸€äº›éæ ¸å¿ƒä¸šåŠ¡ï¼Œä¿æŠ¤æ ¸å¿ƒæµç¨‹æ­£å¸¸ä½¿ç”¨</p></li></ul><p>-ç†”æ–­æ˜¯é™çº§æ–¹å¼çš„ä¸€ç§</p><p>-é™çº§åˆæ˜¯é™æµçš„ä¸€ç§æ–¹å¼  </p><p>-ä¸‰è€…éƒ½æ˜¯ä¸ºäº†é€šè¿‡ä¸€å®šçš„æ–¹å¼<strong>åœ¨æµé‡è¿‡å¤§æˆ–è€…å‡ºç°å¼‚å¸¸æ—¶,ä¿æŠ¤ç³»ç»Ÿçš„æ‰‹æ®µ</strong></p><h3 id="10-5-4-ç†”æ–­ç­–ç•¥"><a href="#10-5-4-ç†”æ–­ç­–ç•¥" class="headerlink" title="10.5.4 ç†”æ–­ç­–ç•¥"></a><strong>10.5.4</strong> ç†”æ–­ç­–ç•¥</h3><h4 id="10-5-4-1-æ…¢è°ƒç”¨æ¯”ä¾‹"><a href="#10-5-4-1-æ…¢è°ƒç”¨æ¯”ä¾‹" class="headerlink" title="10.5.4.1 æ…¢è°ƒç”¨æ¯”ä¾‹"></a>10.5.4.1 æ…¢è°ƒç”¨æ¯”ä¾‹</h4><p>1ã€æ…¢è°ƒç”¨æ¯”ä¾‹ (SLOW_REQUEST_RATIO):é€‰æ‹©ä»¥æ…¢è°ƒç”¨æ¯”ä¾‹ä½œä¸ºé˜ˆå€¼ï¼Œéœ€è¦è®¾ç½®å…è®¸çš„æ…¢è°ƒç”¨ <strong>RT</strong>(å³æœ€å¤§çš„å“åº”æ—¶é—´)ï¼Œ<strong>è¯·æ±‚çš„å“åº”æ—¶é—´å¤§äºè¯¥å€¼åˆ™ç»Ÿè®¡ä¸º<u>æ…¢è°ƒç”¨</u></strong></p><p>2ã€å½“<strong>å•ä½ç»Ÿè®¡æ—¶é•¿(statIntervalMs)å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®</strong>ï¼Œå¹¶ä¸”<strong>æ…¢è°ƒç”¨çš„<u>æ¯”ä¾‹</u>å¤§äºé˜ˆå€¼</strong>ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­</p><p>3ã€ç†”æ–­æ—¶é•¿å,ç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€(HALF-OPEN çŠ¶æ€)ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚å“åº”æ—¶é—´å°äºè®¾ç½®çš„æ…¢è°ƒç”¨RTåˆ™ç»“æŸç†”æ–­ï¼Œè‹¥å¤§äºè®¾ç½®çš„æ…¢è°ƒç”¨RT åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­</p><p>4ã€é…ç½®å‚è€ƒ</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623225930567.png" alt="image-20230623225930567" style="zoom:33%;" /><h4 id="10-5-4-2-å¼‚å¸¸æ¯”ä¾‹"><a href="#10-5-4-2-å¼‚å¸¸æ¯”ä¾‹" class="headerlink" title="10.5.4.2 å¼‚å¸¸æ¯”ä¾‹"></a>10.5.4.2 å¼‚å¸¸æ¯”ä¾‹</h4><p>1ã€å¼‚å¸¸æ¯”ä¾‹ (ERROR_RATIO):å½“å•ä½ç»Ÿè®¡æ—¶é•¿(statIntervalMs)å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”å¼‚å¸¸çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­</p><p>2ã€ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€(HALF-OPENçŠ¶æ€) </p><p>3ã€è‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆ(æ²¡æœ‰é”™è¯¯)åˆ™ç»“æŸç†”æ–­,å¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­</p><p>4ã€å¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯[0.0, 1.0]ï¼Œä»£è¡¨0% - 100%</p><p>5ã€é…ç½®å‚è€ƒ</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623230152696.png" alt="image-20230623230152696" style="zoom:33%;" /><p>6ã€å·¥ä½œç¤ºæ„å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623230238823.png" alt="image-20230623230238823" style="zoom:33%;" /><h4 id="10-5-4-3-å¼‚å¸¸æ•°"><a href="#10-5-4-3-å¼‚å¸¸æ•°" class="headerlink" title="10.5.4.3 å¼‚å¸¸æ•°"></a>10.5.4.3 å¼‚å¸¸æ•°</h4><p>1ã€å¼‚å¸¸æ•° (ERROR_COUNT):<u>å½“å•ä½ç»Ÿè®¡æ—¶é•¿å†…çš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè‡ªåŠ¨è¿›è¡Œç†”æ–­</u></p><p>2ã€ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€(HALF-OPEN çŠ¶æ€) </p><p>3ã€è‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆ(æ²¡æœ‰é”™è¯¯)åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­</p><p>4ã€é…ç½®å‚è€ƒ</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623230424805.png" alt="image-20230623230424805" style="zoom:33%;" /><h3 id="10-5-5-ç†”æ–­é™çº§å®ä¾‹-æ…¢è°ƒç”¨æ¯”ä¾‹"><a href="#10-5-5-ç†”æ–­é™çº§å®ä¾‹-æ…¢è°ƒç”¨æ¯”ä¾‹" class="headerlink" title="10.5.5 ç†”æ–­é™çº§å®ä¾‹**-**æ…¢è°ƒç”¨æ¯”ä¾‹"></a><strong>10.5.5</strong> ç†”æ–­é™çº§å®ä¾‹**-**æ…¢è°ƒç”¨æ¯”ä¾‹</h3><h4 id="10-5-5-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-5-5-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.5.5.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.5.5.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>1.</strong> éœ€æ±‚**:** é€šè¿‡ <strong>Sentinel</strong> å®ç° ç†”æ–­é™çº§æ§åˆ¶**-**<u>æ…¢è°ƒç”¨æ¯”ä¾‹</u></p><p><strong>2.</strong> <strong>å½“è°ƒç”¨</strong> <strong>member-service-nacos-provider-10004</strong> <strong>çš„</strong> <strong>&#x2F;t3 API</strong> <strong>æ¥å£æ—¶ï¼Œå¦‚æœåœ¨</strong> <strong>1s</strong> <strong>å†…æŒç»­è¿›å…¥äº†</strong> <strong>5</strong> <strong>ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”è¯·æ±‚çš„å¹³å‡å“åº”æ—¶é—´è¶…è¿‡</strong> <strong>200ms,</strong> <strong>é‚£ä¹ˆå°±åœ¨æœªæ¥</strong> <strong>10</strong> <strong>ç§’é’Ÿå†…ï¼Œæ–­è·¯å™¨æ‰“å¼€</strong>, <strong>è®©</strong> <strong>&#x2F;t3 API</strong> <strong>æ¥å£å¾®æœåŠ¡ä¸å¯ç”¨</strong></p><p><strong>3.</strong> <strong>åé¢å¯¹</strong>&#x2F;t3 API <strong>æ¥å£è®¿é—®é™åˆ°</strong> <strong>1S</strong> <strong>å†…</strong> <strong>1</strong> <strong>ä¸ªè¯·æ±‚ï¼Œé™ä½è®¿é—®é‡äº†ï¼Œæ–­è·¯å™¨å…³é—­ï¼Œå¾®æœåŠ¡æ¢å¤</strong></p><h4 id="10-5-5-2-ä¿®æ”¹ä¸šåŠ¡ç±»"><a href="#10-5-5-2-ä¿®æ”¹ä¸šåŠ¡ç±»" class="headerlink" title="10.5.5.2 ä¿®æ”¹ä¸šåŠ¡ç±»"></a>10.5.5.2 ä¿®æ”¹ä¸šåŠ¡ç±»</h4><p><strong>1.</strong> ä¿®æ”¹ <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong> å¢åŠ æ–¹æ³• <strong>t3()</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/t3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t3</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//æ¨¡æ‹Ÿçº¿ç¨‹æ‰§è¡Œæ—¶é—´ä¸º1ç§’</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;ç†”æ–­é™çº§æµ‹è¯• æ‰§è¡Œ t3() çº¿ç¨‹ id= &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;t3æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="10-5-5-3-é…ç½®å®ç°æ­¥éª¤"><a href="#10-5-5-3-é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.5.5.3 é…ç½®å®ç°æ­¥éª¤"></a>10.5.5.3 é…ç½®å®ç°æ­¥éª¤</h4><p><strong>1.</strong> ä¸º**&#x2F;t3** å¢åŠ é™çº§è§„åˆ™</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230623231431243.png" alt="image-20230623231431243" style="zoom:50%;" /><p><strong>2.</strong> <strong>åœ¨æµæ§è§„åˆ™èœå•ï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢çš„é™çº§è§„åˆ™</strong></p><h4 id="10-5-5-4-æµ‹è¯•"><a href="#10-5-5-4-æµ‹è¯•" class="headerlink" title="10.5.5.4 æµ‹è¯•"></a>10.5.5.4 æµ‹è¯•</h4><h5 id="10-5-5-4-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-5-5-4-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.5.5.4.1 å¯åŠ¨ Nacos Server 8848"></a><strong>10.5.5.4.1</strong> å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-5-5-4-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-5-5-4-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.5.5.4.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°**&#x2F;Sentinel dashboard **"></a>10.5.5.4.2 å¯åŠ¨ <strong>Sentinel8080</strong> æ§åˆ¶å°**&#x2F;Sentinel dashboard **</h5><h5 id="10-5-5-4-3-å¯åŠ¨-member-service-nacos-provider-10004"><a href="#10-5-5-4-3-å¯åŠ¨-member-service-nacos-provider-10004" class="headerlink" title="10.5.5.4.3 å¯åŠ¨ member-service-nacos-provider-10004"></a><strong>10.5.5.4.3</strong> å¯åŠ¨ <strong>member-service-nacos-provider-10004</strong></h5><h5 id="10-5-5-4-4-Postmanæµ‹è¯•"><a href="#10-5-5-4-4-Postmanæµ‹è¯•" class="headerlink" title="10.5.5.4.4 Postmanæµ‹è¯•"></a><strong>10.5.5.4.4 Postman</strong>æµ‹è¯•</h5><p><strong>1.</strong> å…ˆåˆ›å»º <strong>collection ,</strong> ä¹Ÿå¯ä»¥åœ¨å·²ç»å­˜åœ¨çš„ <strong>collection</strong> è¿›è¡Œä¿®æ”¹</p><p>â€¦â€¦â€¦â€¦</p><h4 id="10-5-5-5-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#10-5-5-5-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="10.5.5.5 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>10.5.5.5 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><h5 id="10-5-5-5-1-å¹³å‡å“åº”æ—¶é—´è¶…å‡ºé˜ˆå€¼ä¸”åœ¨-1s-å†…é€šè¿‡çš„è¯·æ±‚-gt-x3D-5-ï¼Œ-ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³åè§¦å‘é™çº§"><a href="#10-5-5-5-1-å¹³å‡å“åº”æ—¶é—´è¶…å‡ºé˜ˆå€¼ä¸”åœ¨-1s-å†…é€šè¿‡çš„è¯·æ±‚-gt-x3D-5-ï¼Œ-ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³åè§¦å‘é™çº§" class="headerlink" title="10.5.5.5.1 å¹³å‡å“åº”æ—¶é—´è¶…å‡ºé˜ˆå€¼ä¸”åœ¨ 1s å†…é€šè¿‡çš„è¯·æ±‚**&gt;&#x3D;5**ï¼Œ ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³åè§¦å‘é™çº§"></a>10.5.5.5.1 å¹³å‡å“åº”æ—¶é—´è¶…å‡ºé˜ˆå€¼ä¸”åœ¨ <strong>1s</strong> å†…é€šè¿‡çš„è¯·æ±‚**&gt;&#x3D;5**ï¼Œ ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³åè§¦å‘é™çº§</h5><h5 id="10-5-5-5-2-ç†”æ–­æ—¶é—´è¿‡åï¼Œå…³é—­æ–­è·¯å™¨ï¼Œè®¿é—®æ¢å¤æ­£å¸¸"><a href="#10-5-5-5-2-ç†”æ–­æ—¶é—´è¿‡åï¼Œå…³é—­æ–­è·¯å™¨ï¼Œè®¿é—®æ¢å¤æ­£å¸¸" class="headerlink" title="10.5.5.5.2 ç†”æ–­æ—¶é—´è¿‡åï¼Œå…³é—­æ–­è·¯å™¨ï¼Œè®¿é—®æ¢å¤æ­£å¸¸"></a>10.5.5.5.2 ç†”æ–­æ—¶é—´è¿‡åï¼Œå…³é—­æ–­è·¯å™¨ï¼Œè®¿é—®æ¢å¤æ­£å¸¸</h5><h3 id="10-5-6-ç†”æ–­é™çº§å®ä¾‹-å¼‚å¸¸æ¯”ä¾‹"><a href="#10-5-6-ç†”æ–­é™çº§å®ä¾‹-å¼‚å¸¸æ¯”ä¾‹" class="headerlink" title="10.5.6 ç†”æ–­é™çº§å®ä¾‹-å¼‚å¸¸æ¯”ä¾‹"></a>10.5.6 ç†”æ–­é™çº§å®ä¾‹-å¼‚å¸¸æ¯”ä¾‹</h3><h4 id="10-5-6-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-5-6-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.5.6.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.5.6.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>1.</strong> éœ€æ±‚**:** é€šè¿‡ <strong>Sentinel</strong> å®ç° ç†”æ–­é™çº§æ§åˆ¶</p><p><strong>2.</strong> å½“è°ƒç”¨ <strong>member-service-nacos-provider-10004</strong> çš„ <strong>&#x2F;t4 API</strong> æ¥å£æ—¶ï¼Œå½“èµ„æºçš„æ¯ç§’è¯·æ±‚é‡**&gt;&#x3D;5<strong>ï¼Œå¹¶ä¸”æ¯ç§’å¼‚å¸¸æ€»æ•°å é€šè¿‡é‡çš„æ¯”å€¼è¶…è¿‡</strong>20%(<strong>å³å¼‚å¸¸æ¯”ä¾‹åˆ°</strong>20%),** æ–­è·¯å™¨æ‰“å¼€**(<strong>å³</strong>:** è¿›å…¥é™çº§çŠ¶æ€**),** è®© <strong>&#x2F;t4 API</strong> æ¥å£å¾®æœåŠ¡ä¸å¯ç”¨</p><p><strong>3.</strong> å½“å¯¹**&#x2F;t4 API** æ¥å£ è®¿é—®é™åˆ° <strong>1S</strong> å†… <strong>1</strong> ä¸ªè¯·æ±‚ï¼Œé™ä½è®¿é—®é‡äº†ï¼Œæ–­è·¯å™¨å…³é—­ï¼Œ<strong>5</strong> ç§’åå¾®æœåŠ¡æ¢å¤</p><h4 id="10-5-6-2-ä¿®æ”¹ä¸šåŠ¡ç±»"><a href="#10-5-6-2-ä¿®æ”¹ä¸šåŠ¡ç±»" class="headerlink" title="10.5.6.2 ä¿®æ”¹ä¸šåŠ¡ç±»"></a>10.5.6.2 ä¿®æ”¹ä¸šåŠ¡ç±»</h4><p><strong>1.</strong> ä¿®æ”¹ <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong> å¢åŠ æ–¹æ³• <strong>t4()</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>; </span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/t4&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t4</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((++num) % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//å¼‚å¸¸æ¯”ä¾‹ 50% System.out.println(3 / 0);</span></span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;ç†”æ–­é™çº§æµ‹è¯•ã€å¼‚å¸¸æ¯”ä¾‹ã€‘ æ‰§è¡Œ t4() çº¿ç¨‹ id= &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;t4()æ‰§è¡Œ&quot;</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="10-5-6-3-é…ç½®å®ç°æ­¥éª¤"><a href="#10-5-6-3-é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.5.6.3 é…ç½®å®ç°æ­¥éª¤"></a>10.5.6.3 é…ç½®å®ç°æ­¥éª¤</h4><p><strong>1.</strong> ä¸º**&#x2F;t4** å¢åŠ é™çº§è§„åˆ™</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624094738411.png" alt="image-20230624094738411" style="zoom:50%;" /><p><strong>2.</strong> <strong>åœ¨æµæ§è§„åˆ™èœå•ï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢çš„é™çº§è§„åˆ™</strong></p><h4 id="10-5-6-4-æµ‹è¯•"><a href="#10-5-6-4-æµ‹è¯•" class="headerlink" title="10.5.6.4 æµ‹è¯•"></a>10.5.6.4 æµ‹è¯•</h4><h5 id="10-5-6-4-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-5-6-4-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.5.6.4.1 å¯åŠ¨ Nacos Server 8848"></a>10.5.6.4.1 å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-5-6-4-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-5-6-4-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.5.6.4.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°&#x2F;Sentinel dashboard"></a>10.5.6.4.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°&#x2F;Sentinel dashboard</h5><h5 id="10-5-6-4-3-å¯åŠ¨-member-service-nacos-provider-10004"><a href="#10-5-6-4-3-å¯åŠ¨-member-service-nacos-provider-10004" class="headerlink" title="10.5.6.4.3 å¯åŠ¨ member-service-nacos-provider-10004"></a>10.5.6.4.3 å¯åŠ¨ member-service-nacos-provider-10004</h5><h5 id="10-5-6-4-4-Postmanæµ‹è¯•"><a href="#10-5-6-4-4-Postmanæµ‹è¯•" class="headerlink" title="10.5.6.4.4 Postmanæµ‹è¯•"></a>10.5.6.4.4 Postmanæµ‹è¯•</h5><p><strong>1.</strong> å…ˆåˆ›å»ºç»™ <strong>collection ,</strong> ä¹Ÿå¯ä»¥åœ¨å·²ç»å­˜åœ¨çš„ <strong>collection</strong> è¿›è¡Œä¿®æ”¹**,** ä¸€å®šç¡®ä¿æ›´æ–°æˆåŠŸ**.**</p><p><strong>2.</strong> <strong>ç‚¹å‡»</strong> <strong>Run sentinel</strong></p><p><strong>3.</strong> æµè§ˆå™¨è®¿é—®: <a href="http://localhost:10004/t4">http://localhost:10004/t4</a> å‡ºç° Blocked by Sentinel (flow limiting)</p><p><strong>4.</strong> <strong>åœæ­¢</strong> <strong>Postman</strong></p><p><strong>5.</strong> æµè§ˆå™¨è®¿é—®: <a href="http://localhost:10004/t4">http://localhost:10004/t4</a> , ç»“æœæ­£å¸¸äº†(ä¸€æ¬¡è¿”å›å¼‚å¸¸ï¼Œä¸€æ¬¡è¿”å›æ­£ç¡®ç»“ æœ)</p><h4 id="10-5-7-5æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#10-5-7-5æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="10.5.7.5æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>10.5.7.5æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><h5 id="10-5-7-5-1-èµ„æºåœ¨-1-åˆ†é’Ÿçš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè¿›è¡Œç†”æ–­é™çº§"><a href="#10-5-7-5-1-èµ„æºåœ¨-1-åˆ†é’Ÿçš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè¿›è¡Œç†”æ–­é™çº§" class="headerlink" title="10.5.7.5.1 èµ„æºåœ¨ 1 åˆ†é’Ÿçš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè¿›è¡Œç†”æ–­é™çº§"></a><strong>10.5.7.5.1</strong> èµ„æºåœ¨ <strong>1</strong> åˆ†é’Ÿçš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè¿›è¡Œç†”æ–­é™çº§</h5><p><strong>10.5.7.5.2</strong> å¼‚å¸¸æ•°ç»Ÿè®¡æ˜¯åˆ†é’Ÿçº§åˆ«çš„ï¼Œè‹¥ è®¾ç½®çš„æ—¶é—´çª—å£ å°äº <strong>60s</strong>ï¼Œåˆ™ç»“æŸç†”æ–­çŠ¶æ€åä»å¯èƒ½å†è¿›å…¥ç†”æ–­çŠ¶æ€**,** æµ‹è¯•æ—¶ï¼Œæœ€å¥½å°†æ—¶é—´çª—å£è®¾ç½®è¶…è¿‡ <strong>60S</strong></p><h2 id="10-6-Sentinel-çƒ­ç‚¹è§„åˆ™"><a href="#10-6-Sentinel-çƒ­ç‚¹è§„åˆ™" class="headerlink" title="10.6 Sentinel çƒ­ç‚¹è§„åˆ™"></a>10.6 Sentinel çƒ­ç‚¹è§„åˆ™</h2><h3 id="10-6-1-ä¸€ä¸ªé—®é¢˜å¼•å‡ºçƒ­ç‚¹-key-é™æµ"><a href="#10-6-1-ä¸€ä¸ªé—®é¢˜å¼•å‡ºçƒ­ç‚¹-key-é™æµ" class="headerlink" title="10.6.1 ä¸€ä¸ªé—®é¢˜å¼•å‡ºçƒ­ç‚¹ key é™æµ"></a><strong>10.6.1</strong> ä¸€ä¸ªé—®é¢˜å¼•å‡ºçƒ­ç‚¹ <strong>key</strong> é™æµ</h3><p><strong>1.</strong> çƒ­ç‚¹**:** çƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡çƒ­ç‚¹æ•°æ®ä¸­**,** è®¿é—®é¢‘æ¬¡æœ€é«˜çš„ <strong>Top K</strong> æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™åˆ¶ã€‚</p><p><strong>2.</strong> æ¯”å¦‚æŸæ¡æ–°é—»ä¸Šçƒ­æœ ï¼Œåœ¨æŸæ®µæ—¶é—´å†…é«˜é¢‘è®¿é—®ï¼Œ ä¸ºäº†é˜²æ­¢ç³»ç»Ÿé›ªå´©**,** å¯ä»¥å¯¹è¯¥æ¡æ–°é—»è¿›è¡Œçƒ­ç‚¹é™æµ</p><h3 id="10-6-2æ–‡æ¡£åœ°å€"><a href="#10-6-2æ–‡æ¡£åœ°å€" class="headerlink" title="10.6.2æ–‡æ¡£åœ°å€ :"></a>10.6.2æ–‡æ¡£åœ°å€ :</h3><p> <a href="https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81">https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81</a></p><h3 id="10-6-3-åŸºæœ¬ä»‹ç»"><a href="#10-6-3-åŸºæœ¬ä»‹ç»" class="headerlink" title="10.6.3 åŸºæœ¬ä»‹ç»"></a><strong>10.6.3</strong> åŸºæœ¬ä»‹ç»</h3><p><strong>1.</strong> ä¸€å¼ å›¾<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624102921499.png" alt="image-20230624102921499"></p><p><strong>2.</strong> è§£è¯»ä¸Šå›¾:</p><ul><li><p>çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµã€‚</p></li><li><p>çƒ­ç‚¹å‚æ•°é™æµå¯ä»¥çœ‹åšæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµé‡æ§åˆ¶ï¼Œä»…å¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨ç”Ÿæ•ˆ</p></li><li><p>Sentinel åˆ©ç”¨ LRU ç­–ç•¥ç»Ÿè®¡æœ€è¿‘æœ€å¸¸è®¿é—®çš„çƒ­ç‚¹å‚æ•°ï¼Œç»“åˆä»¤ç‰Œæ¡¶ç®—æ³•æ¥è¿›è¡Œå‚æ•°çº§åˆ«çš„æµæ§ <strong><a href="https://blog.csdn.net/qq_34416331/article/details/106668747">https://blog.csdn.net/qq_34416331/article/details/106668747</a></strong></p></li><li><p>çƒ­ç‚¹å‚æ•°é™æµæ”¯æŒé›†ç¾¤æ¨¡å¼</p></li></ul><h3 id="10-6-4-çƒ­ç‚¹-Key-é™æµ-å®ä¾‹"><a href="#10-6-4-çƒ­ç‚¹-Key-é™æµ-å®ä¾‹" class="headerlink" title="10.6.4 çƒ­ç‚¹ Key é™æµ**-**å®ä¾‹"></a><strong>10.6.4</strong> çƒ­ç‚¹ <strong>Key</strong> é™æµ**-**å®ä¾‹</h3><h4 id="10-6-4-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-6-4-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.6.4.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.6.4.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p> <strong>1.</strong> éœ€æ±‚**:** é€šè¿‡ <strong>Sentinel</strong> å®ç°çƒ­ç‚¹ <strong>Key</strong> é™æµ<br> <strong>2.</strong> å¯¹ <strong>member-service-nacos-provider-10004</strong> çš„ <strong>&#x2F;news?id&#x3D;x&amp;type&#x3D;x API</strong> æ¥å£è¿›è¡Œçƒ­ç‚¹é™æµ<br> <strong>3.</strong> å‡å®š <strong>id&#x3D;10</strong> è¿™ä¸€æ¡æ–°é—»æ˜¯å½“å‰çš„çƒ­ç‚¹æ–°é—»ï¼Œ å½“æŸ¥è¯¢æ–°é—»æ—¶ï¼Œå¯¹é€šå¸¸çš„ <strong>id(<strong>éçƒ­ç‚¹æ–°é—»</strong>)<strong>è¯·æ±‚ <strong>QPS</strong> é™å®šä¸º <strong>2,</strong> å¦‚æœ <strong>id&#x3D;10 QPS</strong> é™å®šä¸º <strong>100<br> 4.</strong> å¦‚æœè®¿é—®è¶…å‡ºäº†è§„å®šçš„ <strong>QPS,</strong> è§¦å‘çƒ­ç‚¹é™æµæœºåˆ¶</strong>,</strong> è°ƒç”¨è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œç»™å‡ºæç¤ºä¿¡æ¯**. **</p><p> <strong>5.</strong> å½“å¯¹ <strong>&#x2F;news?id&#x3D;x&amp;type&#x3D;x API</strong> æ¥å£é™ä½è®¿é—®é‡ï¼Œ<strong>QPS</strong> è¾¾åˆ°è§„å®šèŒƒå›´**,** æœåŠ¡æ¢å¤</p><h4 id="10-6-4-2-ä¿®æ”¹ä¸šåŠ¡ç±»"><a href="#10-6-4-2-ä¿®æ”¹ä¸šåŠ¡ç±»" class="headerlink" title="10.6.4.2 ä¿®æ”¹ä¸šåŠ¡ç±»"></a>10.6.4.2 ä¿®æ”¹ä¸šåŠ¡ç±»</h4><p><strong>1.</strong> ä¿® æ”¹ <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong> å¢ åŠ  æ–¹ æ³• <strong>queryNews()</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨æ„ <span class="doctag">@GetMapping</span> æ˜¯ url å¸¦æœ‰ / , <span class="doctag">@SentinelResource</span> çš„ value æ˜¯æ²¡æœ‰ /çš„</span></span><br><span class="line"><span class="comment"> * * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment"> * * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/news&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;news&quot;,blockHandler = &quot;newsBlockHandler&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryNews</span><span class="params">(<span class="meta">@RequestParam(value = &quot;id&quot;,required = false)</span> String id,</span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam(value = &quot;type&quot;,required = false)</span> String type)</span></span><br><span class="line">&#123;</span><br><span class="line">    log.info(<span class="string">&quot;åˆ° DB æŸ¥è¯¢æ•°æ®åº“.... &quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;è¿”å› id= &quot;</span> + id + <span class="string">&quot; æ–°é—» fromDB&quot;</span>); &#125;</span><br><span class="line"><span class="comment">//çƒ­ç‚¹ key é™åˆ¶å¼‚å¸¸å¤„ç†æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">newsBlockHandler</span><span class="params">(String id, String type, BlockException exception)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;æŸ¥è¯¢ id= &quot;</span> + id</span><br><span class="line">            + <span class="string">&quot; æ–°é—» è§¦å‘çƒ­ç‚¹ key é™åˆ¶ä¿æŠ¤.. sorry&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="10-6-4-3-æµ‹è¯•"><a href="#10-6-4-3-æµ‹è¯•" class="headerlink" title="10.6.4.3 æµ‹è¯•"></a>10.6.4.3 æµ‹è¯•</h4><h5 id="10-6-4-3-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-6-4-3-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.6.4.3.1 å¯åŠ¨ Nacos Server 8848"></a><strong>10.6.4.3.1</strong> å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-6-4-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-6-4-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.6.4.3.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°&#x2F;Sentinel dashboard"></a>10.6.4.3.2 å¯åŠ¨ <strong>Sentinel8080</strong> æ§åˆ¶å°&#x2F;Sentinel dashboard</h5><h5 id="10-6-4-3-3-å¯åŠ¨-member-service-nacos-provider-10004"><a href="#10-6-4-3-3-å¯åŠ¨-member-service-nacos-provider-10004" class="headerlink" title="10.6.4.3.3 å¯åŠ¨ member-service-nacos-provider-10004"></a>10.6.4.3.3 å¯åŠ¨ member-service-nacos-provider-10004</h5><h5 id="10-6-4-3-4-é…ç½®å®ç°æ­¥éª¤"><a href="#10-6-4-3-4-é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.6.4.3.4 é…ç½®å®ç°æ­¥éª¤"></a>10.6.4.3.4 é…ç½®å®ç°æ­¥éª¤</h5><p><strong>1.</strong> ä¸ºèµ„æº <strong>news</strong> å¢åŠ çƒ­ç‚¹è§„åˆ™**,** æ³¨æ„ä¸æ˜¯ <strong>&#x2F;news</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624104344763.png" alt="image-20230624104344763"></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624104402958.png" alt="image-20230624104402958" style="zoom: 33%;" /><p><strong>2.</strong> <strong>åœ¨çƒ­ç‚¹å‚æ•°é™æµè§„åˆ™èœå•ï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢è§„åˆ™</strong></p><h5 id="10-6-4-3-5-æµè§ˆå™¨-http-localhost-10004-news-id-1-amp-type-E6-95-99-E8-82-B2"><a href="#10-6-4-3-5-æµè§ˆå™¨-http-localhost-10004-news-id-1-amp-type-E6-95-99-E8-82-B2" class="headerlink" title="10.6.4.3.5 æµè§ˆå™¨**: http://localhost:10004/news?id=1&amp;type=%E6%95%99%E8%82%B2**"></a>10.6.4.3.5 æµè§ˆå™¨**: <a href="http://localhost:10004/news?id=1&type=%E6%95%99%E8%82%B2">http://localhost:10004/news?id=1&amp;type=%E6%95%99%E8%82%B2</a>**</h5><p>å¦‚æœQPSæ²¡æœ‰è¶…è¿‡2,åˆ™è¿”å›æ­£ç¡®ç»“æœ</p><p>å¦‚æœQPSè¶…è¿‡2,åˆ™è¿”å›çƒ­ç‚¹keyå¤„ç†ä¿¡æ¯</p><h5 id="10-6-4-3-6-ç‹¬ç«‹è®¾ç½®çƒ­ç‚¹-id-x3D-10-çš„-QPS-é˜ˆå€¼-å³æ·»åŠ ä¾‹å¤–"><a href="#10-6-4-3-6-ç‹¬ç«‹è®¾ç½®çƒ­ç‚¹-id-x3D-10-çš„-QPS-é˜ˆå€¼-å³æ·»åŠ ä¾‹å¤–" class="headerlink" title="10.6.4.3.6 ç‹¬ç«‹è®¾ç½®çƒ­ç‚¹ id&#x3D;10 çš„ QPS é˜ˆå€¼(å³æ·»åŠ ä¾‹å¤–)"></a>10.6.4.3.6 ç‹¬ç«‹è®¾ç½®çƒ­ç‚¹ id&#x3D;10 çš„ QPS é˜ˆå€¼(å³æ·»åŠ ä¾‹å¤–)</h5><p><strong>1.</strong> ç‹¬ç«‹è®¾ç½®çƒ­ç‚¹ <strong>id&#x3D;10</strong> çš„ <strong>QPS</strong> é˜ˆå€¼**(<strong>å³æ·»åŠ ä¾‹å¤–</strong>)**</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624104744651.png" alt="image-20230624104744651" style="zoom: 50%;" /><h5 id="10-6-4-3-7-æµè§ˆå™¨-http-localhost-10004-news-id-10-amp-type-E6-95-99-E8-82-B2"><a href="#10-6-4-3-7-æµè§ˆå™¨-http-localhost-10004-news-id-10-amp-type-E6-95-99-E8-82-B2" class="headerlink" title="10.6.4.3.7 æµè§ˆå™¨: http://localhost:10004/news?id=10&amp;type=%E6%95%99%E8%82%B2"></a>10.6.4.3.7 æµè§ˆå™¨: <a href="http://localhost:10004/news?id=10&type=%E6%95%99%E8%82%B2">http://localhost:10004/news?id=10&amp;type=%E6%95%99%E8%82%B2</a></h5><p><strong>1.</strong> æµè§ˆå™¨è¾“å…¥: <a href="http://localhost:10004/news?id=10&type=%E6%95%99%E8%82%B2">http://localhost:10004/news?id=10&amp;type=%E6%95%99%E8%82%B2</a> , å¦‚æœQPSæ²¡æœ‰è¶…è¿‡ 100,åˆ™è¿”å›æ­£ç¡®ç»“æœ</p><p><strong>2.</strong> <strong>æµè§ˆå™¨è®¿é—®çš„</strong> <strong>id</strong> <strong>ä¸æ˜¯</strong>10 <strong>çš„ï¼Œä»ç„¶éµå®ˆ</strong> <strong>QPS</strong> <strong>ä¸èƒ½è¶…è¿‡</strong> <strong>2</strong> <strong>çš„çƒ­ç‚¹é™åˆ¶</strong></p><h3 id="10-6-5-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#10-6-5-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="10.6.5 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>10.6.5 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><h4 id="10-6-5-1-çƒ­ç‚¹å‚æ•°ç±»å‹æ˜¯-byte-x2F-int-x2F-long-x2F-float-x2F-double-x2F-char-x2F-String"><a href="#10-6-5-1-çƒ­ç‚¹å‚æ•°ç±»å‹æ˜¯-byte-x2F-int-x2F-long-x2F-float-x2F-double-x2F-char-x2F-String" class="headerlink" title="10.6.5.1 çƒ­ç‚¹å‚æ•°ç±»å‹æ˜¯(byte&#x2F;int&#x2F;long&#x2F;float&#x2F;double&#x2F;char&#x2F;String)"></a>10.6.5.1 çƒ­ç‚¹å‚æ•°ç±»å‹æ˜¯(byte&#x2F;int&#x2F;long&#x2F;float&#x2F;double&#x2F;char&#x2F;String)</h4><h4 id="10-6-5-2-çƒ­ç‚¹å‚æ•°å€¼ï¼Œå¯ä»¥é…ç½®å¤šä¸ª"><a href="#10-6-5-2-çƒ­ç‚¹å‚æ•°å€¼ï¼Œå¯ä»¥é…ç½®å¤šä¸ª" class="headerlink" title="10.6.5.2 çƒ­ç‚¹å‚æ•°å€¼ï¼Œå¯ä»¥é…ç½®å¤šä¸ª"></a>10.6.5.2 çƒ­ç‚¹å‚æ•°å€¼ï¼Œå¯ä»¥é…ç½®å¤šä¸ª</h4><h4 id="10-6-5-3-çƒ­ç‚¹è§„åˆ™åªå¯¹æŒ‡å®šçš„å‚æ•°ç”Ÿæ•ˆ-æ¯”å¦‚æœ¬å®ä¾‹å¯¹-id-ç”Ÿæ•ˆ-å¯¹-type-ä¸ç”Ÿæ•ˆ"><a href="#10-6-5-3-çƒ­ç‚¹è§„åˆ™åªå¯¹æŒ‡å®šçš„å‚æ•°ç”Ÿæ•ˆ-æ¯”å¦‚æœ¬å®ä¾‹å¯¹-id-ç”Ÿæ•ˆ-å¯¹-type-ä¸ç”Ÿæ•ˆ" class="headerlink" title="10.6.5.3 çƒ­ç‚¹è§„åˆ™åªå¯¹æŒ‡å®šçš„å‚æ•°ç”Ÿæ•ˆ (æ¯”å¦‚æœ¬å®ä¾‹å¯¹ id ç”Ÿæ•ˆ, å¯¹ type ä¸ç”Ÿæ•ˆ)"></a>10.6.5.3 çƒ­ç‚¹è§„åˆ™åªå¯¹æŒ‡å®šçš„å‚æ•°ç”Ÿæ•ˆ (æ¯”å¦‚æœ¬å®ä¾‹å¯¹ id ç”Ÿæ•ˆ, å¯¹ type ä¸ç”Ÿæ•ˆ)</h4><h2 id="10-7-ç³»ç»Ÿè§„åˆ™"><a href="#10-7-ç³»ç»Ÿè§„åˆ™" class="headerlink" title="10.7 ç³»ç»Ÿè§„åˆ™"></a>10.7 ç³»ç»Ÿè§„åˆ™</h2><h3 id="10-7-1-ä¸€ä¸ªé—®é¢˜å¼•å‡ºç³»ç»Ÿè§„åˆ™"><a href="#10-7-1-ä¸€ä¸ªé—®é¢˜å¼•å‡ºç³»ç»Ÿè§„åˆ™" class="headerlink" title="10.7.1 ä¸€ä¸ªé—®é¢˜å¼•å‡ºç³»ç»Ÿè§„åˆ™"></a><strong>10.7.1</strong> ä¸€ä¸ªé—®é¢˜å¼•å‡ºç³»ç»Ÿè§„åˆ™</h3><p>1.å¦‚æˆ‘ä»¬ç³»ç»Ÿæœ€å¤§æ€§èƒ½èƒ½æŠ— 100QPSï¼Œå¦‚ä½•åˆ†é… &#x2F;t1 &#x2F;t2 çš„ QPS?</p><p><strong>æ–¹æ¡ˆ1:</strong> &#x2F;t1 åˆ†é… QPS&#x3D;50ï¼›&#x2F;t2 åˆ†é… QPS&#x3D;50ï¼Œé—®é¢˜ï¼Œå¦‚æœ&#x2F;t1 å½“å‰ QPS è¾¾åˆ° 50ï¼Œè€Œ&#x2F;t2 çš„ QPS æ‰ 10ï¼Œä¼šé€ æˆæ²¡æœ‰å……åˆ†åˆ©ç”¨æœåŠ¡å™¨æ€§èƒ½</p><p><strong>æ–¹æ¡ˆ2:</strong> &#x2F;t1 åˆ†é… QPS&#x3D;100 &#x2F;t2 åˆ†é… QPS&#x3D;100ï¼Œé—®é¢˜ï¼Œå®¹æ˜“é€ æˆç³»ç»Ÿæ²¡æœ‰æµé‡ä¿æŠ¤é€ æˆè¯·æ±‚çº¿ç¨‹å †ç§¯ï¼Œå½¢æˆé›ªå´©</p><p><u><strong>æœ‰æ²¡æœ‰å¯¹å„ä¸ªèµ„æºè¯·æ±‚çš„QPSå¼¹æ€§è®¾ç½®ï¼Œåªè¦æ€»æ•°ä¸è¶…è¿‡ç³»ç»Ÿæœ€å¤§QPSçš„æµé‡ä¿æŠ¤è§„åˆ™?&#x3D;&gt; ç³»ç»Ÿè§„åˆ™</strong></u></p><h3 id="10-7-2æ–‡-æ¡£-åœ°-å€"><a href="#10-7-2æ–‡-æ¡£-åœ°-å€" class="headerlink" title="10.7.2æ–‡ æ¡£ åœ° å€ :"></a><strong>10.7.2</strong>æ–‡ æ¡£ åœ° å€ <strong>:</strong></h3><p><strong><a href="https://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81">https://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81</a></strong></p><h3 id="10-7-3-ä¸€å¥è¯-ç³»ç»Ÿè§„åˆ™ä½œç”¨-åœ¨ç³»ç»Ÿç¨³å®šçš„å‰æä¸‹ï¼Œä¿æŒç³»ç»Ÿçš„ååé‡"><a href="#10-7-3-ä¸€å¥è¯-ç³»ç»Ÿè§„åˆ™ä½œç”¨-åœ¨ç³»ç»Ÿç¨³å®šçš„å‰æä¸‹ï¼Œä¿æŒç³»ç»Ÿçš„ååé‡" class="headerlink" title="10.7.3 ä¸€å¥è¯**:** ç³»ç»Ÿè§„åˆ™ä½œç”¨**,** åœ¨ç³»ç»Ÿç¨³å®šçš„å‰æä¸‹ï¼Œä¿æŒç³»ç»Ÿçš„ååé‡"></a><strong>10.7.3</strong> ä¸€å¥è¯**:** ç³»ç»Ÿè§„åˆ™ä½œç”¨**,** åœ¨ç³»ç»Ÿç¨³å®šçš„å‰æä¸‹ï¼Œä¿æŒç³»ç»Ÿçš„ååé‡</h3><h3 id="10-7-4-åŸºæœ¬ä»‹ç»"><a href="#10-7-4-åŸºæœ¬ä»‹ç»" class="headerlink" title="10.7.4 åŸºæœ¬ä»‹ç»"></a><strong>10.7.4</strong> åŸºæœ¬ä»‹ç»</h3><p><strong>1.</strong> ä¸€å¼ å›¾<img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624105741809.png" alt="image-20230624105741809" style="zoom:50%;" /></p><p>**2.**è§£è¯»ä¸Šå›¾:</p><p>ç³»ç»Ÿå¤„ç†è¯·æ±‚çš„è¿‡ç¨‹æƒ³è±¡ä¸ºä¸€ä¸ªæ°´ç®¡ï¼Œåˆ°æ¥çš„è¯·æ±‚æ˜¯å¾€è¿™ä¸ªæ°´ç®¡çŒæ°´ï¼Œå½“ç³»ç»Ÿå¤„ç†é¡ºç•…çš„æ—¶å€™ï¼Œè¯·æ±‚ä¸éœ€è¦æ’é˜Ÿï¼Œç›´æ¥ä»æ°´ç®¡ä¸­ç©¿è¿‡ï¼Œè¿™ä¸ªè¯·æ±‚çš„RTæ˜¯æœ€çŸ­çš„ï¼Œåä¹‹ï¼Œå½“è¯·æ±‚å †ç§¯çš„æ—¶å€™ï¼Œé‚£ä¹ˆå¤„ç†è¯·æ±‚çš„æ—¶é—´åˆ™ä¼šå˜ä¸º:æ’é˜Ÿæ—¶é—´ + æœ€çŸ­å¤„ç†æ—¶é—´</p><p>**3.**ç³»ç»Ÿè§„åˆ™(å‚è€ƒä»¥ä¸‹äº”ç§æ•°æ®æ¥åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦è¶…è´Ÿè·)</p><ul><li><p>Load è‡ªé€‚åº”(ä»…å¯¹ Linux&#x2F;Unix-like æœºå™¨ç”Ÿæ•ˆ): ç³»ç»Ÿçš„ load1 ä½œä¸ºå¯å‘æŒ‡æ ‡ï¼Œè¿›è¡Œè‡ªé€‚åº”ç³»ç»Ÿä¿æŠ¤ã€‚å½“ç³»ç»Ÿ <u>load1 è¶…è¿‡è®¾å®šçš„å¯å‘å€¼</u>ï¼Œä¸”<u>ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ä¼°ç®—çš„ç³»ç»Ÿå®¹é‡</u>æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤(BBR é˜¶æ®µ)ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„ maxQps * minRt ä¼°ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯ CPU cores *2.5</p></li><li><p>CPU usage (1.5.0+ ç‰ˆæœ¬): å½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ (å–å€¼èŒƒå›´0.0-1.0)ï¼Œæ¯”è¾ƒçµæ•ã€‚</p></li><li><p>å¹³å‡ RT: å½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</p></li><li><p>å¹¶å‘çº¿ç¨‹æ•°:å½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</p></li><li><p>å…¥å£ QPS:å½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</p></li></ul><h3 id="10-7-5-å®ä¾‹"><a href="#10-7-5-å®ä¾‹" class="headerlink" title="10.7.5 å®ä¾‹"></a><strong>10.7.5</strong> å®ä¾‹</h3><h4 id="10-7-5-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-7-5-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.7.5.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.7.5.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>1.<strong>éœ€æ±‚</strong>:</strong> é€šè¿‡ <strong>Sentinel</strong> å®ç° ç³»ç»Ÿè§„åˆ™**-**å…¥å£ <strong>QPS</strong></p><p><strong>2.<strong>å¯¹ <strong>member-service-nacos-provider-10004</strong> çš„ æ‰€æœ‰ <strong>API</strong> æ¥å£è¿›è¡Œæµé‡ä¿æŠ¤ï¼Œä¸ç®¡è®¿é—®å“ªä¸ª <strong>API</strong> æ¥å£</strong>,</strong> ç³»ç»Ÿå…¥å£æ€»çš„ <strong>QPS</strong> ä¸èƒ½å¤§äº <strong>2,</strong> å¤§äº <strong>2</strong>ï¼Œå°±è¿›è¡Œé™æµæ§åˆ¶ </p><p><strong>3.</strong> æç¤º**:** ä¸Šé¢çš„ <strong>QPS</strong> æ˜¯ä¸ºäº†æ–¹ä¾¿çœ‹æ•ˆæœ**,** è®¾ç½®çš„å¾ˆå°</p><h4 id="10-7-5-2-é…ç½®å®ç°æ­¥éª¤"><a href="#10-7-5-2-é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.7.5.2 é…ç½®å®ç°æ­¥éª¤"></a>10.7.5.2 é…ç½®å®ç°æ­¥éª¤</h4><p><strong>1.</strong> å¢åŠ å…¥å£ <strong>QPS</strong> ç³»ç»Ÿè§„åˆ™</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624110601568.png" alt="image-20230624110601568"></p><h4 id="10-7-5-3-æµ‹è¯•"><a href="#10-7-5-3-æµ‹è¯•" class="headerlink" title="10.7.5.3 æµ‹è¯•"></a>10.7.5.3 æµ‹è¯•</h4><h5 id="10-7-5-3-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-7-5-3-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.7.5.3.1 å¯åŠ¨ Nacos Server 8848"></a>10.7.5.3.1 å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-7-5-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-7-5-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.7.5.3.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°&#x2F;Sentinel dashboard"></a>10.7.5.3.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°&#x2F;Sentinel dashboard</h5><h5 id="10-7-5-3-3-å¯åŠ¨-member-service-nacos-provider-10004"><a href="#10-7-5-3-3-å¯åŠ¨-member-service-nacos-provider-10004" class="headerlink" title="10.7.5.3.3 å¯åŠ¨ member-service-nacos-provider-10004"></a>10.7.5.3.3 å¯åŠ¨ member-service-nacos-provider-10004</h5><h5 id="10-7-5-3-4-æµè§ˆå™¨-http-localhost-10004-t1"><a href="#10-7-5-3-4-æµè§ˆå™¨-http-localhost-10004-t1" class="headerlink" title="10.7.5.3.4 æµè§ˆå™¨: http://localhost:10004/t1"></a>10.7.5.3.4 æµè§ˆå™¨: <a href="http://localhost:10004/t1">http://localhost:10004/t1</a></h5><p><strong>1.</strong> æµè§ˆå™¨è¾“å…¥**: <a href="http://localhost:10004/t1">http://localhost:10004/t1</a> ,** å¦‚æœ <strong>QPS</strong> è¶…è¿‡ <strong>2,</strong> æ‰“å¼€æ–­è·¯å™¨ï¼Œè¿”å›æµæ§ä¿¡æ¯</p><p><strong>2.</strong> æµè§ˆå™¨è¾“å…¥: <a href="http://localhost:10004/news?id=1&type=%E6%95%99%E8%82%B2">http://localhost:10004/news?id=1&amp;type=%E6%95%99%E8%82%B2</a> , å¦‚æœQPS è¶…è¿‡2, æ‰“å¼€æ–­è·¯å™¨ï¼Œè¿”å›æµæ§ä¿¡æ¯(è¯´æ˜: é¡¹ç›®çš„ &#x2F;t2 èµ„æºå¯¹åº”æ–¹æ³•æœ‰ä¼‘çœ ä»£ç ï¼Œæ‰€ä»¥ä½¿ç”¨ &#x2F;news?id&#x3D;x&amp;type&#x3D;x æµ‹è¯•)</p><h2 id="10-8-SentinelResource"><a href="#10-8-SentinelResource" class="headerlink" title="10.8 @SentinelResource"></a>10.8 @SentinelResource</h2><h3 id="10-8-1-è‡ªå®šä¹‰å…¨å±€é™æµå¤„ç†ç±»"><a href="#10-8-1-è‡ªå®šä¹‰å…¨å±€é™æµå¤„ç†ç±»" class="headerlink" title="10.8.1 è‡ªå®šä¹‰å…¨å±€é™æµå¤„ç†ç±»"></a><strong>10.8.1</strong> è‡ªå®šä¹‰å…¨å±€é™æµå¤„ç†ç±»</h3><h4 id="10-8-1-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-8-1-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.8.1.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.8.1.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>1.</strong> å…ˆçœ‹å‰é¢çš„ä¸€æ®µä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/news&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;news&quot;,blockHandler = &quot;newsBlockHandler&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryNews</span><span class="params">(<span class="meta">@RequestParam(value = &quot;id&quot;,required = false)</span> String id,</span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam(value = &quot;type&quot;,required = false)</span> String type)</span></span><br><span class="line">&#123;</span><br><span class="line">    log.info(<span class="string">&quot;åˆ° DB æŸ¥è¯¢æ•°æ®åº“.... &quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;è¿”å› id= &quot;</span> + id + <span class="string">&quot; æ–°é—» fromDB&quot;</span>); &#125;</span><br><span class="line"><span class="comment">//çƒ­ç‚¹ key é™åˆ¶å¼‚å¸¸å¤„ç†æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">newsBlockHandler</span><span class="params">(String id, String type, BlockException exception)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;æŸ¥è¯¢ id= &quot;</span> + id</span><br><span class="line">            + <span class="string">&quot; æ–°é—» è§¦å‘çƒ­ç‚¹ key é™åˆ¶ä¿æŠ¤.. sorry&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>: <strong>å½“é…ç½®çš„èµ„æºå</strong> news <strong>è§¦å‘é™æµæœºåˆ¶æ—¶ï¼Œä¼šè°ƒç”¨</strong> newsBlockHandler <strong>æ–¹æ³•</strong></p><p><strong>2.</strong> <strong>ä¸Šé¢çš„å¤„ç†æ–¹æ¡ˆå­˜åœ¨ä¸€äº›é—®é¢˜</strong></p><ul><li><p><strong>æ¯ä¸ª</strong>@SentinelResource <strong>å¯¹åº”ä¸€ä¸ªå¼‚å¸¸å¤„ç†æ–¹æ³•ï¼Œä¼šé€ æˆæ–¹æ³•å¾ˆå¤š</strong> </p></li><li><p>å¼‚å¸¸å¤„ç†æ–¹æ³•å’Œèµ„æºè¯·æ±‚æ–¹æ³•åœ¨ä¸€èµ·ï¼Œä¸åˆ©äºä¸šåŠ¡é€»è¾‘çš„åˆ†ç¦»</p></li></ul><ul><li><strong>è§£å†³æ–¹æ¡ˆ</strong>-&gt; è‡ªå®šä¹‰å…¨å±€é™æµå¤„ç†ç±»</li></ul><p><strong>3.</strong> <strong>éœ€æ±‚</strong>: <strong>è¯·ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰å…¨å±€é™æµå¤„ç†ç±»ï¼Œå®Œæˆå¯¹å¼‚å¸¸å¤„ç†</strong>.</p><h4 id="10-8-1-2-ä»£ç å®ç°"><a href="#10-8-1-2-ä»£ç å®ç°" class="headerlink" title="10.8.1.2 ä»£ç å®ç°"></a>10.8.1.2 ä»£ç å®ç°</h4><p><strong>1.</strong> ä¿®æ”¹ <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong> å¢åŠ æ–¹æ³• <strong>t6()</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£è¯»ï¼š</span></span><br><span class="line"><span class="comment"> * value = &quot;t6&quot;: SentinelResource èµ„æºå</span></span><br><span class="line"><span class="comment"> * blockHandlerClass = CustomGlobalBlockHandler.class: å…¨å±€é™æµå¤„ç†ç±» * blockHandler = &quot;handlerMethod1&quot;: å…¨å±€é™æµå¤„ç†ç±»çš„å“ªä¸ªæ–¹æ³•,å¯ä»¥æŒ‡å®š. */</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/t6&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(</span></span><br><span class="line"><span class="meta">        value = &quot;t6&quot;,</span></span><br><span class="line"><span class="meta">        blockHandlerClass = CustomGlobalBlockHandler.class, blockHandler = &quot;handlerMethod1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t6</span><span class="params">()</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;æ‰§è¡Œ t6() çº¿ç¨‹ id= &quot;</span> + Thread.currentThread().getId()); <span class="keyword">return</span> Result.success(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;t6()æ‰§è¡ŒæˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2.</strong> <strong>åˆ›å»º</strong> com&#x2F;hspedu&#x2F;springcloud&#x2F;handler&#x2F;CustomGlobalBlockHandler.java </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.slots.block.BlockException;</span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Result;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/6/24</span></span><br><span class="line"><span class="comment"> * 13:54</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºçš„å¼‚å¸¸å¤„ç†æ–¹æ³•éœ€è¦æ˜¯ static</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomGlobalBlockHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">handlerMethod1</span> <span class="params">(BlockException exception)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;400&quot;</span>, <span class="string">&quot;å®¢æˆ·è‡ªå®šä¹‰å¼‚å¸¸å¤„ç† handlerm1()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">handlerMethod2</span> <span class="params">(BlockException exception)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;401&quot;</span>, <span class="string">&quot;å®¢æˆ·è‡ªå®šä¹‰å¼‚å¸¸å¤„ç† handlerm2()&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="10-8-1-3-é…ç½®å®ç°æ­¥éª¤"><a href="#10-8-1-3-é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.8.1.3 é…ç½®å®ç°æ­¥éª¤"></a>10.8.1.3 é…ç½®å®ç°æ­¥éª¤</h4><p><strong>1.</strong> ä¸ºèµ„æº <strong>&#x2F;t6</strong> å¢åŠ æµæ§è§„åˆ™**,**æ–¹ä¾¿æµ‹è¯•</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624135913223.png" alt="image-20230624135913223" style="zoom:50%;" /><p><strong>2.</strong> <strong>åœ¨æµæ§è§„åˆ™èœå•ï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢è§„åˆ™</strong></p><h4 id="10-8-1-4-æµ‹è¯•"><a href="#10-8-1-4-æµ‹è¯•" class="headerlink" title="10.8.1.4 æµ‹è¯•"></a>10.8.1.4 æµ‹è¯•</h4><h5 id="10-8-1-4-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-8-1-4-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.8.1.4.1 å¯åŠ¨ Nacos Server 8848"></a><strong>10.8.1.4.1</strong> å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-8-1-4-2-å¯åŠ¨-Sentinel8080æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-8-1-4-2-å¯åŠ¨-Sentinel8080æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.8.1.4.2 å¯åŠ¨ Sentinel8080æ§åˆ¶å°&#x2F;Sentinel dashboard"></a>10.8.1.4.2 å¯åŠ¨ Sentinel8080æ§åˆ¶å°&#x2F;Sentinel dashboard</h5><h5 id="10-8-1-4-3-å¯åŠ¨-member-service-nacos-provider-10004"><a href="#10-8-1-4-3-å¯åŠ¨-member-service-nacos-provider-10004" class="headerlink" title="10.8.1.4.3 å¯åŠ¨ member-service-nacos-provider-10004"></a>10.8.1.4.3 å¯åŠ¨ member-service-nacos-provider-10004</h5><h5 id="10-8-1-4-4-æµè§ˆå™¨-http-localhost-10004-t6"><a href="#10-8-1-4-4-æµè§ˆå™¨-http-localhost-10004-t6" class="headerlink" title="10.8.1.4.4 æµè§ˆå™¨: http://localhost:10004/t6"></a>10.8.1.4.4 æµè§ˆå™¨: <a href="http://localhost:10004/t6">http://localhost:10004/t6</a></h5><p><strong>1.</strong> æµè§ˆå™¨è¾“å…¥**: <a href="http://localhost:10004/t6">http://localhost:10004/t6</a> ,** å¦‚æœ <strong>QPS</strong> æ²¡æœ‰è¶…è¿‡ <strong>1,</strong> è¿”å›æ­£å¸¸ç»“æœ</p><p><strong>2.</strong> æµè§ˆå™¨è¾“å…¥: <a href="http://localhost:10004/t6">http://localhost:10004/t6</a> ,å¦‚æœQPS è¶…è¿‡ 1, æ–­è·¯å™¨æ‰“å¼€ï¼Œè¿”å›è‡ªå®šä¹‰é™æµå¤„ç†æ–¹æ³•ä¿¡æ¯</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624140131429.png" alt="image-20230624140131429" style="zoom:50%;" /><h3 id="10-8-2-fallbackè‡ªå®šä¹‰ç¨‹åºé”™è¯¯å¤„ç†"><a href="#10-8-2-fallbackè‡ªå®šä¹‰ç¨‹åºé”™è¯¯å¤„ç†" class="headerlink" title="10.8.2 fallbackè‡ªå®šä¹‰ç¨‹åºé”™è¯¯å¤„ç†"></a>10.8.2 fallbackè‡ªå®šä¹‰ç¨‹åºé”™è¯¯å¤„ç†</h3><h4 id="10-8-2-1-çœ‹ä¸€æ®µä»£ç -å¼•å‡º-fallback"><a href="#10-8-2-1-çœ‹ä¸€æ®µä»£ç -å¼•å‡º-fallback" class="headerlink" title="10.8.2.1 çœ‹ä¸€æ®µä»£ç -å¼•å‡º fallback"></a>10.8.2.1 çœ‹ä¸€æ®µä»£ç -å¼•å‡º fallback</h4><p><strong>1.</strong> ä¿® æ”¹ <strong>member-service-nacos-provider-10004</strong> çš„<strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong> å¢åŠ ä¸€æ®µä»£ç **.**</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/t6&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(</span></span><br><span class="line"><span class="meta">        value = &quot;t6&quot;,</span></span><br><span class="line"><span class="meta">        blockHandlerClass = CustomGlobalBlockHandler.class, blockHandler = &quot;handlerMethod1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t6</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//å‡å®š: å½“è®¿é—® t6 èµ„æºæ¬¡æ•°æ˜¯ 5 çš„å€æ•°æ—¶ï¼Œå°±å‡ºç°äº†ä¸€ä¸ª java çš„å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (++num % <span class="number">5</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;num çš„å€¼å¼‚å¸¸ num= &quot;</span> + num); &#125;</span><br><span class="line">        log.info(<span class="string">&quot;æ‰§è¡Œ t6() çº¿ç¨‹ id= &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;t6()æ‰§è¡ŒæˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2.</strong> æµè§ˆå™¨: <a href="http://localhost:10004/t6">http://localhost:10004/t6</a> , çœ‹æ•ˆæœå½“numä¸º 5çš„æ•´æ•°æ—¶ï¼Œè¿”å›çš„æ˜¯erroré¡µé¢ï¼Œä¸å‹å¥½.</p><p><strong>3.</strong> æ€ä¹ˆè§£å†³&#x3D;&gt; ä½¿ç”¨ fallback</p><h4 id="10-8-2-2-åŸºæœ¬ä»‹ç»"><a href="#10-8-2-2-åŸºæœ¬ä»‹ç»" class="headerlink" title="10.8.2.2 åŸºæœ¬ä»‹ç»"></a>10.8.2.2 åŸºæœ¬ä»‹ç»</h4><h5 id="10-8-2-2-1-blockHandleråªè´Ÿè´£sentinelæ§åˆ¶å°é…ç½®è¿è§„"><a href="#10-8-2-2-1-blockHandleråªè´Ÿè´£sentinelæ§åˆ¶å°é…ç½®è¿è§„" class="headerlink" title="10.8.2.2.1 blockHandleråªè´Ÿè´£sentinelæ§åˆ¶å°é…ç½®è¿è§„"></a>10.8.2.2.1 blockHandleråªè´Ÿè´£sentinelæ§åˆ¶å°é…ç½®è¿è§„</h5><h5 id="10-8-2-2-2-fallbackè´Ÿè´£Javaå¼‚å¸¸-x2F-ä¸šåŠ¡å¼‚å¸¸"><a href="#10-8-2-2-2-fallbackè´Ÿè´£Javaå¼‚å¸¸-x2F-ä¸šåŠ¡å¼‚å¸¸" class="headerlink" title="10.8.2.2.2 fallbackè´Ÿè´£Javaå¼‚å¸¸&#x2F;ä¸šåŠ¡å¼‚å¸¸"></a>10.8.2.2.2 fallback<strong>è´Ÿè´£</strong>Java<strong>å¼‚å¸¸</strong>&#x2F;ä¸šåŠ¡å¼‚å¸¸</h5><h4 id="10-8-2-3-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-8-2-3-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.8.2.3 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.8.2.3 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>1.</strong> éœ€æ±‚**:** è¯·ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰å…¨å±€ <strong>fallback</strong> å¤„ç†ç±»**,** å¤„ç† <strong>java</strong> å¼‚å¸¸**&#x2F;**ä¸šåŠ¡å¼‚å¸¸ </p><p><strong>2.</strong> ä¹Ÿå°±æ˜¯è§£å†³å‰é¢æˆ‘ä»¬æå‡ºçš„é—®é¢˜</p><h4 id="10-8-2-4-ä»£ç å®ç°"><a href="#10-8-2-4-ä»£ç å®ç°" class="headerlink" title="10.8.2.4 ä»£ç å®ç°"></a>10.8.2.4 ä»£ç å®ç°</h4><p><strong>1.</strong> åœ¨ <strong>member-service-nacos-provider-10004</strong> åˆ›å»º<strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;handler&#x2F;CustomGlobalFallbackHandler.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomGlobalFallbackHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">fallBackHandlerMethod1</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;400&quot;</span>, <span class="string">&quot;java å¼‚å¸¸ä¿¡æ¯= &quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">fallBackHandlerMethod2</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;401&quot;</span>, <span class="string">&quot;java å¼‚å¸¸ä¿¡æ¯= &quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2.<strong>åœ¨ member-service-nacos-provider-10004ä¿®æ”¹</strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;MemberController.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£è¯»</span></span><br><span class="line"><span class="comment"> * value = &quot;t6&quot;: SentinelResource èµ„æºå</span></span><br><span class="line"><span class="comment"> * blockHandlerClass = CustomGlobalBlockHandler.class: å…¨å±€é™æµå¤„ç†ç±» * blockHandler = &quot;handlerMethod1&quot;: å…¨å±€é™æµå¤„ç†ç±»çš„å“ªä¸ªæ–¹æ³•,å¯ä»¥æŒ‡å®š. */</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/t6&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(</span></span><br><span class="line"><span class="meta">        value = &quot;t6&quot;,</span></span><br><span class="line"><span class="meta">        fallbackClass = CustomGlobalFallbackHandler.class,</span></span><br><span class="line"><span class="meta">        fallback = &quot;fallBackHandlerMethod1&quot;,</span></span><br><span class="line"><span class="meta">        blockHandlerClass = CustomGlobalBlockHandler.class,</span></span><br><span class="line"><span class="meta">        blockHandler = &quot;handlerMethod1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t6</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//å‡å®š: å½“è®¿é—® t6 èµ„æºæ¬¡æ•°æ˜¯ 5 çš„å€æ•°æ—¶ï¼Œå°±å‡ºç°äº†ä¸€ä¸ª java çš„å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (++num % <span class="number">5</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;num çš„å€¼å¼‚å¸¸ num= &quot;</span> + num); &#125;</span><br><span class="line">        log.info(<span class="string">&quot;æ‰§è¡Œ t6() çº¿ç¨‹ id= &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;t6()æ‰§è¡ŒæˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="10-8-2-5-æµ‹è¯•"><a href="#10-8-2-5-æµ‹è¯•" class="headerlink" title="10.8.2.5 æµ‹è¯•"></a>10.8.2.5 æµ‹è¯•</h4><h5 id="10-8-2-5-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-8-2-5-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.8.2.5.1 å¯åŠ¨ Nacos Server 8848"></a>10.8.2.5.1 å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-8-2-5-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-8-2-5-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.8.2.5.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°&#x2F;Sentinel dashboard"></a>10.8.2.5.2 å¯åŠ¨ <strong>Sentinel8080</strong> æ§åˆ¶å°&#x2F;Sentinel dashboard</h5><h5 id="10-8-2-5-3-å¯åŠ¨-member-service-nacos-provider-10004"><a href="#10-8-2-5-3-å¯åŠ¨-member-service-nacos-provider-10004" class="headerlink" title="10.8.2.5.3 å¯åŠ¨ member-service-nacos-provider-10004"></a>10.8.2.5.3 å¯åŠ¨ member-service-nacos-provider-10004</h5><h5 id="10-8-2-5-4-æµè§ˆå™¨-http-localhost-10004-t6"><a href="#10-8-2-5-4-æµè§ˆå™¨-http-localhost-10004-t6" class="headerlink" title="10.8.2.5.4 æµè§ˆå™¨: http://localhost:10004/t6"></a>10.8.2.5.4 æµè§ˆå™¨: <a href="http://localhost:10004/t6">http://localhost:10004/t6</a></h5><p><strong>1.</strong> æµè§ˆå™¨è¾“å…¥**: <a href="http://localhost:10004/t6">http://localhost:10004/t6</a> ,** è®¿é—®æ¬¡æ•°ä¸æ˜¯ <strong>5</strong> çš„å€æ•°**,** è¿”å›æ­£å¸¸ç»“æœ</p><p><strong>2.</strong> æµè§ˆå™¨è¾“å…¥: <a href="http://localhost:10004/t6">http://localhost:10004/t6</a> , è®¿é—®æ¬¡æ•°æ˜¯ 5 çš„å€æ•°, è¿”å› fallbackæŒ‡å®šæ–¹æ³•ä¿¡æ¯</p><p><strong>3.</strong> <strong>ä¸ºèµ„æº</strong> <strong>&#x2F;t6</strong> <strong>å¢åŠ æµæ§è§„åˆ™</strong>,æ–¹ä¾¿æµ‹è¯•</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230624142029799.png" alt="image-20230624142029799" style="zoom:50%;" /><p><strong>4.</strong> <strong>åœ¨æµæ§è§„åˆ™èœå•ï¼Œå¯ä»¥çœ‹åˆ°æ–°å¢è§„åˆ™</strong></p><p><strong>5.</strong> æµè§ˆå™¨è¾“å…¥: <a href="http://localhost:10004/t6">http://localhost:10004/t6</a> , <strong>å¦‚æœè®¿é—® QPS å¤§äº1 , ç”±blockHandleræŒ‡å®šçš„æ–¹æ³•å¤„ç†,è®¿é—®æ¬¡æ•°æ˜¯ 5 çš„å€æ•°, ç”±fallbackæŒ‡å®šæ–¹æ³•å¤„ç†,å…¶å®ƒæƒ…å†µè¿”å›æ­£å¸¸çš„ç»“æœ.</strong></p><h3 id="10-8-3-exceptionsToIgnore-å¸Œæœ›å¿½ç•¥æŸä¸ªå¼‚å¸¸"><a href="#10-8-3-exceptionsToIgnore-å¸Œæœ›å¿½ç•¥æŸä¸ªå¼‚å¸¸" class="headerlink" title="10.8.3 exceptionsToIgnore  å¸Œæœ›å¿½ç•¥æŸä¸ªå¼‚å¸¸"></a>10.8.3 exceptionsToIgnore  å¸Œæœ›å¿½ç•¥æŸä¸ªå¼‚å¸¸</h3><h4 id="10-8-3-1-å¦‚æœå¸Œæœ›å¿½ç•¥æŸä¸ªå¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨-exceptionsToIgnore"><a href="#10-8-3-1-å¦‚æœå¸Œæœ›å¿½ç•¥æŸä¸ªå¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨-exceptionsToIgnore" class="headerlink" title="10.8.3.1 å¦‚æœå¸Œæœ›å¿½ç•¥æŸä¸ªå¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨ exceptionsToIgnore"></a>10.8.3.1 å¦‚æœå¸Œæœ›å¿½ç•¥æŸä¸ªå¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨ exceptionsToIgnore</h4><h4 id="10-8-3-2-åº”ç”¨å®ä¾‹"><a href="#10-8-3-2-åº”ç”¨å®ä¾‹" class="headerlink" title="10.8.3.2 åº”ç”¨å®ä¾‹"></a>10.8.3.2 åº”ç”¨å®ä¾‹</h4><p><strong>1.</strong> å¦‚æœå¸Œæœ›å¿½ç•¥æŸä¸ªå¼‚å¸¸**(<strong>æ”¯æŒæ•°ç»„</strong>)**ï¼Œå¯ä»¥ä½¿ç”¨ <strong>exceptionsToIgnore</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/t6&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(</span></span><br><span class="line"><span class="meta">        value = &quot;t6&quot;,</span></span><br><span class="line"><span class="meta">        fallbackClass = CustomGlobalFallbackHandler.class,</span></span><br><span class="line"><span class="meta">        fallback = &quot;fallBackHandlerMethod1&quot;,</span></span><br><span class="line"><span class="meta">        blockHandlerClass = CustomGlobalBlockHandler.class,</span></span><br><span class="line"><span class="meta">        blockHandler = &quot;handlerMethod1&quot;,</span></span><br><span class="line"><span class="meta">        exceptionsToIgnore = &#123;RuntimeException.class&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">t6</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//å‡å®š: å½“è®¿é—® t6 èµ„æºæ¬¡æ•°æ˜¯ 5 çš„å€æ•°æ—¶ï¼Œå°±å‡ºç°äº†ä¸€ä¸ª java çš„å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (++num % <span class="number">5</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;num çš„å€¼å¼‚å¸¸ num= &quot;</span> + num);</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;æ‰§è¡Œ t6() çº¿ç¨‹ id= &quot;</span> + Thread.currentThread().getId());</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;t6()æ‰§è¡ŒæˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2.</strong> æµè§ˆå™¨è¾“å…¥: <a href="http://localhost:10004/t6">http://localhost:10004/t6</a> , ä½ ä¼šå‘ç°è®¿é—®æ¬¡æ•°ä¸º 5 çš„å€æ•°æ—¶ï¼Œä¸å†è°ƒç”¨ fallback æŒ‡å®šæ–¹æ³•å¤„ç†</p><p>â€‹è€Œæ˜¯ä½¿ç”¨RuntimeException.classä¸­çš„æ–¹å¼(å³é»˜è®¤æ–¹å¼)å¤„ç†</p><h3 id="10-8-4-æ¥å…¥-Sentinel-çš„æ–¹å¼"><a href="#10-8-4-æ¥å…¥-Sentinel-çš„æ–¹å¼" class="headerlink" title="10.8.4 æ¥å…¥ Sentinel çš„æ–¹å¼"></a>10.8.4 æ¥å…¥ Sentinel çš„æ–¹å¼</h3><p><u>å³(ä¸è¿›å…¥sentinelæ§åˆ¶å°ç½‘é¡µè€Œä½¿ç”¨sentinel)</u></p><h4 id="10-8-4-1-ä»£ç æ–¹å¼-ç¡¬ç¼–ç ï¼Œä¾µå…¥æ€§å¼º-ä¸æ¨è"><a href="#10-8-4-1-ä»£ç æ–¹å¼-ç¡¬ç¼–ç ï¼Œä¾µå…¥æ€§å¼º-ä¸æ¨è" class="headerlink" title="10.8.4.1 ä»£ç æ–¹å¼(ç¡¬ç¼–ç ï¼Œä¾µå…¥æ€§å¼º, ä¸æ¨è)"></a>10.8.4.1 ä»£ç æ–¹å¼(ç¡¬ç¼–ç ï¼Œä¾µå…¥æ€§å¼º, ä¸æ¨è)</h4><p><strong>1.</strong> æ–‡æ¡£åœ°å€**:** <strong><a href="https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D">https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D</a></strong></p><p><strong>2.</strong> åŸºæœ¬ä½¿ç”¨</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230629202935657.png" alt="image-20230629202935657" style="zoom:50%;" /><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230629203105770.png" alt="image-20230629203105770"></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230629203336858.png" alt="image-20230629203336858"></p><h4 id="10-8-4-2-æ³¨è§£æ–¹å¼-ä½ä¾µå…¥æ€§-å‰é¢ç”¨è¿‡-æ¨è"><a href="#10-8-4-2-æ³¨è§£æ–¹å¼-ä½ä¾µå…¥æ€§-å‰é¢ç”¨è¿‡-æ¨è" class="headerlink" title="10.8.4.2 æ³¨è§£æ–¹å¼(ä½ä¾µå…¥æ€§, å‰é¢ç”¨è¿‡, æ¨è)"></a>10.8.4.2 æ³¨è§£æ–¹å¼(ä½ä¾µå…¥æ€§, å‰é¢ç”¨è¿‡, æ¨è)</h4><p><strong>1.</strong> æ³¨è§£æ–¹å¼åŸ‹ç‚¹ä¸æ”¯æŒ <strong>private</strong> æ–¹æ³•</p><p><a href="https://xue.baidu.com/okam/pages/strategy-tp/index?strategyId=136707206360879&source=natural">https://xue.baidu.com/okam/pages/strategy-tp/index?strategyId=136707206360879&amp;source=natural</a></p><p><strong>2.</strong> @SentinelResource ç”¨äºå®šä¹‰èµ„æºï¼Œå¹¶æä¾›å¯é€‰çš„å¼‚å¸¸å¤„ç†å’Œfallbacké…ç½®é¡¹ã€‚</p><p><strong>3. @SentinelResource</strong> <strong>æ³¨è§£åŒ…å«ä»¥ä¸‹å±æ€§</strong>(æˆ‘ä»¬å†æ¢³ç†ä¸€ä¸‹)</p><ul><li><p><strong>value</strong>:èµ„æºåç§°ï¼Œå¿…éœ€é¡¹(ä¸èƒ½ä¸ºç©º)</p></li><li><p><strong>entryType</strong>:entry ç±»å‹ï¼Œå¯é€‰é¡¹(é»˜è®¤ä¸ºEntryType.OUT)</p></li><li><p><strong>blockHandler &#x2F; blockHandlerClass</strong>: blockHandler <strong>å¯¹åº”å¤„ç†</strong> <strong>BlockException</strong> çš„å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹blockHandler<u>å‡½æ•°è®¿é—®èŒƒå›´éœ€è¦æ˜¯public</u>ï¼Œè¿”å›ç±»å‹éœ€è¦ä¸åŸæ–¹æ³•ç›¸åŒ¹é…ï¼Œå‚æ•°ç±»å‹éœ€è¦å’ŒåŸæ–¹æ³•ç›¸åŒ¹é…å¹¶ä¸”æœ€ååŠ ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œç±»å‹ä¸ºBlockExceptionã€‚blockHandler å‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®šblockHandlerClassä¸ºå¯¹åº”çš„ç±»çš„Classå¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸º static å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</p></li><li><p><strong>fallback &#x2F; fallbackClass</strong>:fallback å‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œ<u>ç”¨äºåœ¨æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™æä¾›fallbackå¤„ç†é€»è¾‘</u>ã€‚fallbackå‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸(é™¤äº†exceptionsToIgnoreé‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹)è¿›è¡Œå¤„ç†ã€‚fallback å‡½æ•°ç­¾åå’Œä½ç½®è¦æ±‚:</p></li></ul><ol><li>è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´;</li><li>æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦å’ŒåŸå‡½æ•°ä¸€è‡´ï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ªThrowableç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚</li><li>fallbackå‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®š<u>fallbackClass</u>ä¸ºå¯¹åº”çš„ç±»çš„Classå¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸ºstaticå‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</li></ol><ul><li><strong>defaultFallback(since 1.6.0</strong>):é»˜è®¤çš„ fallbackå‡½æ•°åç§°ï¼Œå¯é€‰é¡¹ï¼Œé€šå¸¸ç”¨äºé€šç”¨çš„fallbacké€»è¾‘(å³å¯ä»¥ç”¨äºå¾ˆå¤šæœåŠ¡æˆ–æ–¹æ³•)ã€‚é»˜è®¤fallbackå‡½æ•°å¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹ çš„å¼‚å¸¸(é™¤äº†exceptionsToIgnoreé‡Œé¢æ’é™¤æ‰çš„å¼‚å¸¸ç±»å‹)è¿›è¡Œå¤„ç†ã€‚è‹¥åŒæ—¶é…ç½®äº†fallbackå’ŒdefaultFallbackï¼Œåˆ™åªæœ‰fallbackä¼šç”Ÿæ•ˆã€‚defaultFallback å‡½æ•°ç­¾åè¦æ±‚:</li></ul><ol><li>è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°è¿”å›å€¼ç±»å‹ä¸€è‡´;</li><li>æ–¹æ³•å‚æ•°åˆ—è¡¨éœ€è¦ä¸ºç©ºï¼Œæˆ–è€…å¯ä»¥é¢å¤–å¤šä¸€ä¸ªThrowableç±»å‹çš„å‚æ•°ç”¨äºæ¥æ”¶å¯¹åº”çš„å¼‚å¸¸ã€‚</li><li>defaultFallbackå‡½æ•°é»˜è®¤éœ€è¦å’ŒåŸæ–¹æ³•åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚è‹¥å¸Œæœ›ä½¿ç”¨å…¶ä»–ç±»çš„å‡½æ•°ï¼Œ åˆ™å¯ä»¥æŒ‡å®šfallbackClassä¸ºå¯¹åº”çš„ç±»çš„Classå¯¹è±¡ï¼Œæ³¨æ„å¯¹åº”çš„å‡½æ•°å¿…éœ€ä¸ºstaticå‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æã€‚</li></ol><ul><li>exceptionsToIgnore(since 1.6.0)ï¼šç”¨äºæŒ‡å®šå“ªäº›å¼‚å¸¸è¢«æ’é™¤æ‰ï¼Œä¸ä¼šè¿›å…¥å¼‚å¸¸ç»Ÿè®¡ä¸­ï¼Œä¹Ÿä¸ä¼šè¿›å…¥fallbacké€»è¾‘ä¸­ï¼Œè€Œæ˜¯ä¼šåŸæ ·æŠ›å‡ºã€‚</li></ul><h2 id="10-9-openFeign-sentinel-å¯¹è¿œç¨‹è°ƒç”¨ç†”æ–­é™çº§"><a href="#10-9-openFeign-sentinel-å¯¹è¿œç¨‹è°ƒç”¨ç†”æ–­é™çº§" class="headerlink" title="10.9 openFeign+sentinel å¯¹è¿œç¨‹è°ƒç”¨ç†”æ–­é™çº§"></a>10.9 openFeign+sentinel å¯¹è¿œç¨‹è°ƒç”¨ç†”æ–­é™çº§</h2><h3 id="10-9-1-å½“å‰å¾®æœåŠ¡åŸºç¡€ç¯å¢ƒ"><a href="#10-9-1-å½“å‰å¾®æœåŠ¡åŸºç¡€ç¯å¢ƒ" class="headerlink" title="10.9.1 å½“å‰å¾®æœåŠ¡åŸºç¡€ç¯å¢ƒ"></a><strong>10.9.1</strong> å½“å‰å¾®æœåŠ¡åŸºç¡€ç¯å¢ƒ</h3><h4 id="10-9-1-1-å½“å‰å¾®æœåŠ¡ç¯å¢ƒæ¶æ„å›¾"><a href="#10-9-1-1-å½“å‰å¾®æœåŠ¡ç¯å¢ƒæ¶æ„å›¾" class="headerlink" title="10.9.1.1 å½“å‰å¾®æœåŠ¡ç¯å¢ƒæ¶æ„å›¾"></a>10.9.1.1 å½“å‰å¾®æœåŠ¡ç¯å¢ƒæ¶æ„å›¾</h4><p>â€“ ç¤ºæ„å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230629205804092.png" alt="image-20230629205804092"></p><h4 id="10-9-1-2-æµ‹è¯•"><a href="#10-9-1-2-æµ‹è¯•" class="headerlink" title="10.9.1.2 æµ‹è¯•"></a>10.9.1.2 æµ‹è¯•</h4><h5 id="10-9-1-2-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-9-1-2-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.9.1.2.1 å¯åŠ¨ Nacos Server 8848"></a>10.9.1.2.1 å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-9-1-2-2-å¯åŠ¨-member-service-nacos-provider-10004-x2F-10006"><a href="#10-9-1-2-2-å¯åŠ¨-member-service-nacos-provider-10004-x2F-10006" class="headerlink" title="10.9.1.2.2 å¯åŠ¨ member-service-nacos-provider-10004&#x2F;10006"></a>10.9.1.2.2 å¯åŠ¨ member-service-nacos-provider-10004&#x2F;10006</h5><h5 id="10-9-1-2-3-å¯åŠ¨-member-service-nacos-consumer-80"><a href="#10-9-1-2-3-å¯åŠ¨-member-service-nacos-consumer-80" class="headerlink" title="10.9.1.2.3 å¯åŠ¨ member-service-nacos-consumer-80"></a>10.9.1.2.3 å¯åŠ¨ member-service-nacos-consumer-80</h5><h5 id="10-9-1-2-4-æµè§ˆå™¨-http-localhost-member-nacos-consumer-get-1"><a href="#10-9-1-2-4-æµè§ˆå™¨-http-localhost-member-nacos-consumer-get-1" class="headerlink" title="10.9.1.2.4 æµè§ˆå™¨**: http://localhost/member/nacos/consumer/get/1**"></a>10.9.1.2.4 æµè§ˆå™¨**: <a href="http://localhost/member/nacos/consumer/get/1">http://localhost/member/nacos/consumer/get/1</a>**</h5><p><strong>1.</strong> æµ è§ˆ å™¨ è¾“ å…¥ <strong>: <a href="http://localhost/member/nacos/consumer/get/1">http://localhost/member/nacos/consumer/get/1</a> ,</strong> ç›® å‰ æ˜¯ <strong>Ribbon+RestTemplate</strong></p><h3 id="10-9-2-æœåŠ¡æ¶ˆè´¹è€…æ•´åˆ-Openfeign"><a href="#10-9-2-æœåŠ¡æ¶ˆè´¹è€…æ•´åˆ-Openfeign" class="headerlink" title="10.9.2 æœåŠ¡æ¶ˆè´¹è€…æ•´åˆ Openfeign"></a><strong>10.9.2</strong> æœåŠ¡æ¶ˆè´¹è€…æ•´åˆ Openfeign</h3><p><strong>1.</strong> éœ€æ±‚:åœ¨ <strong>member-service-nacos-consumer-80</strong> æ•´åˆ <strong>Openfeign</strong> å®ç°è¿œç¨‹è°ƒç”¨</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230629210226986.png" alt="image-20230629210226986"></p><h4 id="10-9-2-2-ä»£ç -é…ç½®å®ç°æ­¥éª¤"><a href="#10-9-2-2-ä»£ç -é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.9.2.2 ä»£ç +é…ç½®å®ç°æ­¥éª¤"></a>10.9.2.2 ä»£ç +é…ç½®å®ç°æ­¥éª¤</h4><p><strong>1.</strong> ä¿®æ”¹ <strong>member-service-nacos-consumer-80</strong> çš„ <strong>pom.xml</strong> åŠ å…¥ <strong>openfeign</strong> ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    å¼•å…¥openfeign-startï¼Œå³åœºæ™¯å¯åŠ¨å™¨    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2.</strong> <strong>åœ¨</strong> <strong>member-service-nacos-consumer-80</strong> <strong>åˆ› å»º</strong>com&#x2F;study&#x2F;springcloud&#x2F;service&#x2F;MemberOpenFeignService.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Member;</span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Result;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/6/29</span></span><br><span class="line"><span class="comment"> * 21:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;member-service-nacos-provider&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MemberOpenFeignService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è€éŸ©è§£è¯»</span></span><br><span class="line"><span class="comment">     * 1. è¿œç¨‹è°ƒç”¨çš„æ–¹å¼ä¸º get</span></span><br><span class="line"><span class="comment">     * 2. è¿œç¨‹è°ƒç”¨çš„ url ä¸º http://member-service-nacos-provider/member/get/&#123;id&#125;</span></span><br><span class="line"><span class="comment">     * 3. member-service-nacos-provider æ˜¯ nacos æ³¨å†Œä¸­å¿ƒæœåŠ¡ member-service-nacos-provider:10004/10006 </span></span><br><span class="line"><span class="comment">     * 4. ä¼šæ ¹æ® OpenFeign çš„å‡è¡¡ç®—æ³•æ¥å†³å®šæ˜¯è°ƒç”¨ 10004 è¿˜æ˜¯ 10006</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/member/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Member&gt; <span class="title function_">getMembertById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3.</strong> <strong>åœ¨</strong> <strong>member-service-nacos-consumer-80</strong> <strong>ä¿®æ”¹</strong> <strong>com&#x2F;study&#x2F;springcloud&#x2F;controller&#x2F;MemberNacosConsumerController.java</strong> å¢åŠ æ–¹æ³•getMemberOpenfeignById()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/member/openfeign/consumer/get/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;Member&gt; <span class="title function_">getMemberOpenfeignById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//è¿™é‡Œä½¿ç”¨ Openfeign æ¥å£æ–¹å¼è¿œç¨‹è°ƒç”¨æœåŠ¡</span></span><br><span class="line">    System.out.println(<span class="string">&quot;é€šè¿‡ openfeignd+è´Ÿè½½å‡è¡¡ è°ƒç”¨æœåŠ¡&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> memberOpenFeignService.getMemberById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4.</strong> <strong>å†åœ¨</strong> <strong>member-service-nacos-consumer-80</strong> <strong>çš„ä¸»å¯åŠ¨ç±»åŠ å…¥æ³¨è§£</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;MemberNacosConsumerApplication80.java</strong></p><p>ã€Œ@EnableFeignClientsã€</p><h4 id="10-9-2-3-æµ‹è¯•"><a href="#10-9-2-3-æµ‹è¯•" class="headerlink" title="10.9.2.3 æµ‹è¯•"></a>10.9.2.3 æµ‹è¯•</h4><h5 id="10-9-2-3-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-9-2-3-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.9.2.3.1 å¯åŠ¨ Nacos Server 8848"></a>10.9.2.3.1 å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-9-2-3-2-å¯åŠ¨-member-service-nacos-provider-10004-x2F-10006"><a href="#10-9-2-3-2-å¯åŠ¨-member-service-nacos-provider-10004-x2F-10006" class="headerlink" title="10.9.2.3.2 å¯åŠ¨ **member-service-nacos-provider-10004&#x2F;10006 **"></a>10.9.2.3.2 å¯åŠ¨ **member-service-nacos-provider-10004&#x2F;10006 **</h5><h5 id="10-9-2-3-3-å¯åŠ¨-member-service-nacos-consumer-80"><a href="#10-9-2-3-3-å¯åŠ¨-member-service-nacos-consumer-80" class="headerlink" title="10.9.2.3.3 å¯åŠ¨ member-service-nacos-consumer-80"></a><strong>10.9.2.3.3</strong> å¯åŠ¨ member-service-nacos-consumer-80</h5><h5 id="10-9-2-3-4-æµè§ˆå™¨-http-localhost-member-openfeign-consumer-get-1"><a href="#10-9-2-3-4-æµè§ˆå™¨-http-localhost-member-openfeign-consumer-get-1" class="headerlink" title="10.9.2.3.4 æµè§ˆå™¨**: http://localhost/member/openfeign/consumer/get/1**"></a>10.9.2.3.4 æµè§ˆå™¨**: <a href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a>**</h5><p><strong>1.</strong> æµè§ˆå™¨è¾“å…¥**: <a href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a> , ç›®å‰æ˜¯ <strong>Openfeign è°ƒç”¨</strong>(<strong>è´Ÿè½½å‡è¡¡</strong>)**</p><h3 id="10-9-3-æœåŠ¡æ¶ˆè´¹è€…æ•´åˆ-Sentinel"><a href="#10-9-3-æœåŠ¡æ¶ˆè´¹è€…æ•´åˆ-Sentinel" class="headerlink" title="10.9.3 æœåŠ¡æ¶ˆè´¹è€…æ•´åˆ Sentinel"></a>10.9.3 æœåŠ¡æ¶ˆè´¹è€…æ•´åˆ Sentinel</h3><h4 id="10-9-3-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-9-3-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.9.3.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.9.3.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>1.</strong> éœ€æ±‚:åœ¨ <strong>member-service-nacos-consumer-80</strong> æ•´åˆ <strong>Sentinel</strong> èƒ½è¢« <strong>Sentinel</strong> ç›‘æ§</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630165412038.png" alt="image-20230630165412038" style="zoom:50%;" /><h4 id="10-9-3-2-ä»£ç -é…ç½®å®ç°æ­¥éª¤"><a href="#10-9-3-2-ä»£ç -é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.9.3.2 ä»£ç +é…ç½®å®ç°æ­¥éª¤"></a>10.9.3.2 ä»£ç +é…ç½®å®ç°æ­¥éª¤</h4><p><strong>1.</strong> ä¿®æ”¹ <strong>member-service-nacos-consumer-80</strong> çš„ <strong>pom.xml</strong> åŠ å…¥ <strong>sentinel</strong> ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼•å…¥ alibaba-sentinel --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2.</strong> ä¿®æ”¹ <strong>member-service-nacos-consumer-80</strong> çš„ <strong>application.yml</strong> é…ç½® <strong>sentinel</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">member-service-consumer-80</span></span><br><span class="line">    <span class="comment">#é…ç½®nacos</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#å¯åŠ¨nacosæœåŠ¡çš„ipä»¥åŠç«¯å£</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span> <span class="comment">#è¿™ä¸ªæ˜¯ sentinel æ§åˆ¶å°(sentinel dashboard)çš„åœ°å€</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span> <span class="comment">#é»˜è®¤ 8719ï¼Œå‡å¦‚è¢«å ç”¨äº†, ä¼šè‡ªåŠ¨ä» 8719 å¼€å§‹ä¾æ¬¡+1 æ‰«æã€‚ç›´è‡³æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£</span></span><br><span class="line"><span class="attr">management:</span> <span class="comment">#æš´éœ²æ‰€æœ‰ç›‘æ§ç‚¹</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="10-9-3-3-æµ‹è¯•"><a href="#10-9-3-3-æµ‹è¯•" class="headerlink" title="10.9.3.3 æµ‹è¯•"></a>10.9.3.3 æµ‹è¯•</h4><h5 id="10-9-3-3-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-9-3-3-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.9.3.3.1 å¯åŠ¨ Nacos Server 8848"></a><strong>10.9.3.3.1</strong> å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-9-3-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-9-3-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.9.3.3.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°&#x2F;Sentinel dashboard"></a>10.9.3.3.2 å¯åŠ¨ <strong>Sentinel8080</strong> æ§åˆ¶å°&#x2F;Sentinel dashboard</h5><h5 id="10-9-3-3-3-å¯åŠ¨-member-service-nacos-provider-10004-x2F-10006"><a href="#10-9-3-3-3-å¯åŠ¨-member-service-nacos-provider-10004-x2F-10006" class="headerlink" title="10.9.3.3.3 å¯åŠ¨ **member-service-nacos-provider-10004&#x2F;10006 **"></a>10.9.3.3.3 å¯åŠ¨ **member-service-nacos-provider-10004&#x2F;10006 **</h5><h5 id="10-9-3-3-4-å¯åŠ¨-member-service-nacos-consumer-80"><a href="#10-9-3-3-4-å¯åŠ¨-member-service-nacos-consumer-80" class="headerlink" title="10.9.3.3.4 å¯åŠ¨ member-service-nacos-consumer-80"></a><strong>10.9.3.3.4</strong> å¯åŠ¨ member-service-nacos-consumer-80</h5><h5 id="10-9-3-3-5-æµè§ˆå™¨-http-localhost-member-openfeign-consumer-get-1"><a href="#10-9-3-3-5-æµè§ˆå™¨-http-localhost-member-openfeign-consumer-get-1" class="headerlink" title="10.9.3.3.5 æµè§ˆå™¨**: http://localhost/member/openfeign/consumer/get/1**"></a>10.9.3.3.5 æµè§ˆå™¨**: <a href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a>**</h5><p><strong>1.</strong> æµè§ˆå™¨è¾“å…¥**: <a href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a> ,** ç›®å‰æ˜¯ <strong>Openfeign</strong> è°ƒç”¨**(<strong>è´Ÿè½½å‡è¡¡</strong>)**</p><p><strong>2.</strong> <strong>ç™»å½•</strong> <strong>sentinel</strong> <strong>æ§åˆ¶å°</strong>: <strong>å¯ä»¥çœ‹åˆ°å·²ç»ç›‘æ§åˆ°</strong> <strong>member-service-nacos-consumer</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630170804677.png" alt="image-20230630170804677"></p><h3 id="10-9-4-openFeign-sentinel-å¯¹è¿œç¨‹è°ƒç”¨ç†”æ–­é™çº§"><a href="#10-9-4-openFeign-sentinel-å¯¹è¿œç¨‹è°ƒç”¨ç†”æ–­é™çº§" class="headerlink" title="10.9.4 openFeign+sentinel å¯¹è¿œç¨‹è°ƒç”¨ç†”æ–­é™çº§"></a>10.9.4 openFeign+sentinel å¯¹è¿œç¨‹è°ƒç”¨ç†”æ–­é™çº§</h3><h4 id="10-9-4-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-9-4-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.9.4.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.9.4.1 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>1.</strong> éœ€æ±‚**&#x2F;<strong>å¦‚å›¾:åœ¨ <strong>member-service-nacos-consumer-80</strong> è°ƒç”¨æŸä¸ªæ— æ•ˆæœåŠ¡æ—¶ï¼Œå¯åŠ¨ Sentinel çš„ç†”æ–­é™çº§æœºåˆ¶ <strong>,</strong> èƒ½å¤Ÿå¿«é€Ÿè¿”å›å“åº”ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„è¶…æ—¶æœºåˆ¶(å› ä¸ºè¶…æ—¶æœºåˆ¶å®¹æ˜“çº¿ç¨‹å †ç§¯</strong>,** ä»è€Œå¯¼è‡´é›ªå´©)</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630170956206.png" alt="image-20230630170956206"></p><p><strong>2.</strong> <strong>å…ˆæµ‹è¯•ä¸€ä¸‹ï¼Œå…³é—­</strong> <strong>10004&#x2F;10006,</strong> <strong>è¿™æ—¶</strong> <strong>openfeign</strong> <strong>å»è°ƒç”¨ä¼šæ€ä¹ˆæ ·</strong>? (è¿”å› <strong>time out)</strong></p><p><strong>3.</strong> <strong>è¿˜å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼Œè®©</strong> <strong>10004</strong> <strong>æœåŠ¡å¯¹åº”çš„</strong> <strong>API</strong> <strong>æ‰§è¡Œæ—¶é—´å¾ˆé•¿</strong>(æ¯”å¦‚ä¼‘çœ  <strong>2</strong> <strong>ç§’</strong>), <strong>è¿™ æ—¶</strong> <strong>openfeign</strong> <strong>å»è°ƒç”¨ä¼šæ€ä¹ˆæ ·</strong>?</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630171235813.png" alt="image-20230630171235813"></p><h4 id="10-9-4-2-ä»£ç -é…ç½®å®ç°æ­¥éª¤"><a href="#10-9-4-2-ä»£ç -é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.9.4.2 ä»£ç +é…ç½®å®ç°æ­¥éª¤"></a>10.9.4.2 ä»£ç +é…ç½®å®ç°æ­¥éª¤</h4><p><strong>1.</strong> ä¿® æ”¹ <strong>member-service-nacos-consumer-80</strong> çš„</p><p><strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;MemberOpenFeignService.java,</strong> åŠ å…¥ <strong>fallback</strong> çš„å¤„ç†ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Member;</span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Result;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/6/29</span></span><br><span class="line"><span class="comment"> * 21:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;member-service-nacos-provider&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MemberOpenFeignService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è€éŸ©è§£è¯»</span></span><br><span class="line"><span class="comment">     * 1. è¿œç¨‹è°ƒç”¨çš„æ–¹å¼ä¸º get</span></span><br><span class="line"><span class="comment">     * 2. è¿œç¨‹è°ƒç”¨çš„ url ä¸º http://member-service-nacos-provider/member/get/&#123;id&#125;</span></span><br><span class="line"><span class="comment">     * 3. member-service-nacos-provider æ˜¯</span></span><br><span class="line"><span class="comment">     * nacos æ³¨å†Œä¸­å¿ƒæœåŠ¡ member-service-nacos-provider:10004/10006 </span></span><br><span class="line"><span class="comment">     * 4. ä¼šæ ¹æ® OpenFeign çš„å‡è¡¡ç®—æ³•æ¥å†³å®šæ˜¯è°ƒç”¨ 10004 è¿˜æ˜¯ 10006</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/member/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Member&gt; <span class="title function_">getMemberById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2.</strong> åˆ›å»º <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;MemberFeignFallbackService.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Member;</span><br><span class="line"><span class="keyword">import</span> com.study.springcloud.entity.Result;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/6/30</span></span><br><span class="line"><span class="comment"> * 17:15</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberFeignFallbackService</span> <span class="keyword">implements</span> <span class="title class_">MemberOpenFeignService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Member&gt; <span class="title function_">getMemberById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;500&quot;</span>, <span class="string">&quot;è¢«è°ƒç”¨æœåŠ¡å¼‚å¸¸, ç†”æ–­é™çº§ï¼Œå¿«é€Ÿè¿”å›ç»“æœ, é˜²æ­¢çº¿ç¨‹å † ç§¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3.</strong> ä¿®æ”¹ <strong>member-service-nacos-consumer-80</strong> çš„ <strong>application.yml ,</strong> åŠ å…¥ <strong>openfeign</strong> å’Œ <strong>sentinel</strong> æ•´åˆé…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">æœ«å°¾æ·»åŠ ä»¥ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">#openfeign å’Œ sentinel æ•´åˆï¼Œå¿…é¡»é…</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h4 id="10-9-4-3-æµ‹è¯•"><a href="#10-9-4-3-æµ‹è¯•" class="headerlink" title="10.9.4.3 æµ‹è¯•"></a>10.9.4.3 æµ‹è¯•</h4><h5 id="10-9-4-3-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-9-4-3-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.9.4.3.1 å¯åŠ¨ Nacos Server 8848"></a><strong>10.9.4.3.1</strong> å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-9-4-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-9-4-3-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.9.4.3.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°&#x2F;Sentinel dashboard"></a>10.9.4.3.2 å¯åŠ¨ <strong>Sentinel8080</strong> æ§åˆ¶å°&#x2F;Sentinel dashboard</h5><h5 id="10-9-4-3-3-å…³é—­-member-service-nacos-provider-10004-x2F-10006"><a href="#10-9-4-3-3-å…³é—­-member-service-nacos-provider-10004-x2F-10006" class="headerlink" title="10.9.4.3.3 å…³é—­ **member-service-nacos-provider-10004&#x2F;10006 **"></a>10.9.4.3.3 å…³é—­ **member-service-nacos-provider-10004&#x2F;10006 **</h5><h5 id="10-9-4-3-4-å¯åŠ¨-member-service-nacos-consumer-80"><a href="#10-9-4-3-4-å¯åŠ¨-member-service-nacos-consumer-80" class="headerlink" title="10.9.4.3.4 å¯åŠ¨ member-service-nacos-consumer-80"></a><strong>10.9.4.3.4</strong> å¯åŠ¨ member-service-nacos-consumer-80</h5><h5 id="10-9-4-3-5-æµè§ˆå™¨-http-localhost-member-openfeign-consumer-get-1"><a href="#10-9-4-3-5-æµè§ˆå™¨-http-localhost-member-openfeign-consumer-get-1" class="headerlink" title="10.9.4.3.5 æµè§ˆå™¨**: http://localhost/member/openfeign/consumer/get/1**"></a>10.9.4.3.5 æµè§ˆå™¨**: <a href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a>**</h5><p><strong>1.</strong> æµè§ˆå™¨è¾“å…¥**: <a href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a> ,** ç›®å‰æ˜¯ <strong>Openfeign</strong> è°ƒç”¨**(<strong>è´Ÿè½½å‡è¡¡</strong>)**</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630172238879.png" alt="image-20230630172238879" style="zoom:50%;" /><h4 id="10-9-4-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"><a href="#10-9-4-4-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜" class="headerlink" title="10.9.4.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜"></a>10.9.4.4 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜</h4><p><strong>1.</strong> å› ä¸º <strong>member-service-nacos-consumer-80</strong> å·²ç»è¢« <strong>sentinel</strong> ç›‘æ§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åŠ å…¥ç›¸</p><p>å…³çš„æµæ§è§„åˆ™**,** æ¯”å¦‚ä¸º <strong>&#x2F;member&#x2F;openfeign&#x2F;consumer&#x2F;get&#x2F;1</strong> åŠ å…¥æµæ§è§„åˆ™ <strong>qps &#x3D; 1</strong></p><p><strong>æµ‹è¯•</strong>: <strong>å¦‚æœ</strong>&#x2F;member&#x2F;openfeign&#x2F;consumer&#x2F;get&#x2F;1 <strong>è¯·æ±‚</strong> <strong>QPS</strong> <strong>è¶…è¿‡</strong> <strong>1,</strong> <strong>ä¼šè¾“å‡ºBlocked by Sentinel (flow limiting)</strong></p><p><strong>QPS</strong> <strong>æ²¡æœ‰è¶…è¿‡</strong> <strong>1,</strong> <strong>ä¼šè¢«</strong> <strong>fallback</strong> <strong>å¤„ç†</strong></p><p><strong>2.</strong> <strong>å¦‚æœè¿œç¨‹æœåŠ¡æ¢å¤æ­£å¸¸</strong>, <strong>åˆä¼šæ­£å¸¸è°ƒç”¨</strong>.</p><h2 id="10-10-è§„åˆ™æŒä¹…åŒ–"><a href="#10-10-è§„åˆ™æŒä¹…åŒ–" class="headerlink" title="10.10 è§„åˆ™æŒä¹…åŒ–"></a>10.10 è§„åˆ™æŒä¹…åŒ–</h2><h3 id="10-10-1-è§„åˆ™æ²¡æœ‰æŒä¹…åŒ–çš„é—®é¢˜"><a href="#10-10-1-è§„åˆ™æ²¡æœ‰æŒä¹…åŒ–çš„é—®é¢˜" class="headerlink" title="10.10.1 è§„åˆ™æ²¡æœ‰æŒä¹…åŒ–çš„é—®é¢˜"></a><strong>10.10.1</strong> è§„åˆ™æ²¡æœ‰æŒä¹…åŒ–çš„é—®é¢˜</h3><h4 id="10-10-1-1-å¦‚æœ-sentinel-æµæ§è§„åˆ™æ²¡æœ‰æŒä¹…åŒ–ï¼Œå½“é‡å¯è°ƒç”¨-API-x2F-æ¥å£-æ‰€åœ¨å¾®æœåŠ¡åï¼Œè§„åˆ™å°±ä¼šä¸¢å¤±ï¼Œéœ€è¦-é‡æ–°åŠ å…¥"><a href="#10-10-1-1-å¦‚æœ-sentinel-æµæ§è§„åˆ™æ²¡æœ‰æŒä¹…åŒ–ï¼Œå½“é‡å¯è°ƒç”¨-API-x2F-æ¥å£-æ‰€åœ¨å¾®æœåŠ¡åï¼Œè§„åˆ™å°±ä¼šä¸¢å¤±ï¼Œéœ€è¦-é‡æ–°åŠ å…¥" class="headerlink" title="10.10.1.1 å¦‚æœ sentinel æµæ§è§„åˆ™æ²¡æœ‰æŒä¹…åŒ–ï¼Œå½“é‡å¯è°ƒç”¨ API&#x2F;æ¥å£ æ‰€åœ¨å¾®æœåŠ¡åï¼Œè§„åˆ™å°±ä¼šä¸¢å¤±ï¼Œéœ€è¦ é‡æ–°åŠ å…¥"></a>10.10.1.1 å¦‚æœ sentinel æµæ§è§„åˆ™æ²¡æœ‰æŒä¹…åŒ–ï¼Œå½“é‡å¯è°ƒç”¨ API&#x2F;æ¥å£ æ‰€åœ¨å¾®æœåŠ¡åï¼Œè§„åˆ™å°±ä¼šä¸¢å¤±ï¼Œéœ€è¦ é‡æ–°åŠ å…¥</h4><h4 id="10-10-1-2-è§£å†³æ–¹æ¡ˆ-é€šè¿‡-Nacos-è¿›è¡ŒæŒä¹…åŒ–"><a href="#10-10-1-2-è§£å†³æ–¹æ¡ˆ-é€šè¿‡-Nacos-è¿›è¡ŒæŒä¹…åŒ–" class="headerlink" title="10.10.1.2 è§£å†³æ–¹æ¡ˆ:é€šè¿‡ Nacos è¿›è¡ŒæŒä¹…åŒ–"></a>10.10.1.2 è§£å†³æ–¹æ¡ˆ:é€šè¿‡ Nacos è¿›è¡ŒæŒä¹…åŒ–</h4><h3 id="10-10-2-è§„åˆ™æŒä¹…åŒ–æ–¹æ¡ˆ"><a href="#10-10-2-è§„åˆ™æŒä¹…åŒ–æ–¹æ¡ˆ" class="headerlink" title="10.10.2 è§„åˆ™æŒä¹…åŒ–æ–¹æ¡ˆ"></a><strong>10.10.2</strong> è§„åˆ™æŒä¹…åŒ–æ–¹æ¡ˆ</h3><h4 id="10-10-2-1-é˜¿é‡Œäº‘-Ahas-æœ€æ–¹ä¾¿-x2F-ä»˜è´¹"><a href="#10-10-2-1-é˜¿é‡Œäº‘-Ahas-æœ€æ–¹ä¾¿-x2F-ä»˜è´¹" class="headerlink" title="10.10.2.1 é˜¿é‡Œäº‘ Ahas[æœ€æ–¹ä¾¿&#x2F;ä»˜è´¹]"></a>10.10.2.1 é˜¿é‡Œäº‘ Ahas[æœ€æ–¹ä¾¿&#x2F;ä»˜è´¹]</h4><p><strong>1.</strong> å®˜æ–¹æ–‡æ¡£ <strong>: <a href="https://help.aliyun.com/product/87450.html?spm=5176.cnahas.0.0.78034bb7ef0y86">https://help.aliyun.com/product/87450.html?spm=5176.cnahas.0.0.78034bb7ef0y86</a></strong></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630190919413.png" alt="image-20230630190919413" style="zoom:50%;" /><h4 id="10-10-2-2-ğŸŒŸåœ¨-Nacos-Server-é…ç½®è§„åˆ™-å®ŒæˆæŒä¹…åŒ–-å®˜æ–¹æ¨è"><a href="#10-10-2-2-ğŸŒŸåœ¨-Nacos-Server-é…ç½®è§„åˆ™-å®ŒæˆæŒä¹…åŒ–-å®˜æ–¹æ¨è" class="headerlink" title="10.10.2.2 ğŸŒŸåœ¨ Nacos Server é…ç½®è§„åˆ™, å®ŒæˆæŒä¹…åŒ– -å®˜æ–¹æ¨è"></a>10.10.2.2 ğŸŒŸåœ¨ Nacos Server é…ç½®è§„åˆ™, å®ŒæˆæŒä¹…åŒ– -å®˜æ–¹æ¨è</h4><h4 id="10-10-2-3-å°†è§„åˆ™æŒä¹…åŒ–åˆ°æœ¬åœ°æ–‡ä»¶-å®šæ—¶åŒæ­¥"><a href="#10-10-2-3-å°†è§„åˆ™æŒä¹…åŒ–åˆ°æœ¬åœ°æ–‡ä»¶-å®šæ—¶åŒæ­¥" class="headerlink" title="10.10.2.3 å°†è§„åˆ™æŒä¹…åŒ–åˆ°æœ¬åœ°æ–‡ä»¶, å®šæ—¶åŒæ­¥"></a>10.10.2.3 å°†è§„åˆ™æŒä¹…åŒ–åˆ°æœ¬åœ°æ–‡ä»¶, å®šæ—¶åŒæ­¥</h4><h4 id="10-10-2-4-å…¶å®ƒâ€¦"><a href="#10-10-2-4-å…¶å®ƒâ€¦" class="headerlink" title="10.10.2.4 å…¶å®ƒâ€¦"></a>10.10.2.4 å…¶å®ƒâ€¦</h4><h3 id="10-10-3-Nacos-Server-é…ç½®ä¸­å¿ƒ-è§„åˆ™æŒä¹…åŒ–å®ä¾‹"><a href="#10-10-3-Nacos-Server-é…ç½®ä¸­å¿ƒ-è§„åˆ™æŒä¹…åŒ–å®ä¾‹" class="headerlink" title="10.10.3 Nacos Server é…ç½®ä¸­å¿ƒ**-**è§„åˆ™æŒä¹…åŒ–å®ä¾‹"></a><strong>10.10.3 Nacos Server</strong> é…ç½®ä¸­å¿ƒ**-**è§„åˆ™æŒä¹…åŒ–å®ä¾‹</h3><h4 id="10-10-3-1-å·¥ä½œåŸç†ç¤ºæ„å›¾"><a href="#10-10-3-1-å·¥ä½œåŸç†ç¤ºæ„å›¾" class="headerlink" title="10.10.3.1 å·¥ä½œåŸç†ç¤ºæ„å›¾"></a>10.10.3.1 å·¥ä½œåŸç†ç¤ºæ„å›¾</h4><p>å…¶å®å°±æ˜¯é æŠŠè§„åˆ™ä¿å­˜åˆ°nacosä¸­ï¼Œä¸‹æ¬¡é‡å¯æœåŠ¡æ—¶å†ä»nacosä¸­è·å–å…ˆå‰è®¾ç½®çš„è§„åˆ™ä¿¡æ¯</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630191350485.png" alt="image-20230630191350485"></p><h4 id="10-10-3-2-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#10-10-3-2-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="10.10.3.2 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£"></a>10.10.3.2 éœ€æ±‚åˆ†æ&#x2F;å›¾è§£</h4><p><strong>1.</strong> éœ€ æ±‚ <strong>:</strong> ä¸º <strong>member-service-nacos-consumer-80</strong> å¾®æœåŠ¡çš„**&#x2F;member&#x2F;openfeign&#x2F;consumer&#x2F;get&#x2F;1 API** æ¥å£æ·»åŠ æµæ§è§„åˆ™ **QPS&#x3D;1&#x2F;**å¿«é€Ÿå¤±è´¥ <strong>.</strong></p><p><strong>2.</strong> <strong>è¦æ±‚å°†è¯¥æµæ§è§„åˆ™åŠ å…¥åˆ°</strong> <strong>nacos server</strong> <strong>é…ç½®ä¸­å¿ƒï¼Œå®ç°æŒä¹…åŒ–</strong></p><h4 id="10-10-3-3-ä»£ç -é…ç½®å®ç°æ­¥éª¤"><a href="#10-10-3-3-ä»£ç -é…ç½®å®ç°æ­¥éª¤" class="headerlink" title="10.10.3.3 ä»£ç +é…ç½®å®ç°æ­¥éª¤"></a>10.10.3.3 ä»£ç +é…ç½®å®ç°æ­¥éª¤</h4><p><strong>1.</strong> åœ¨ <strong>Nacos Server</strong> é…ç½®ä¸­å¿ƒå¢åŠ  <strong>Sentinel</strong> å®¢æˆ·ç«¯**&#x2F;**å¾®æœåŠ¡æ¨¡å—çš„æµæ§è§„åˆ™</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630191715975.png" alt="image-20230630191715975" style="zoom:50%;" /><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;resource&quot;</span><span class="punctuation">:</span><span class="string">&quot;/member/openfeign/consumer/get/1&quot;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;limitApp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;grade&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;strategy&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;controlBehavior&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;clusterMode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630192956899.png" alt="image-20230630192956899"></p><p><strong>2.</strong> <strong>åœ¨</strong> <strong>Nacos Server</strong> <strong>é…ç½®ä¸­å¿ƒå¢åŠ </strong> <strong>Sentinel</strong> <strong>å®¢æˆ·ç«¯</strong>&#x2F;å¾®æœåŠ¡æ¨¡å—çš„æµæ§è§„åˆ™å‚æ•°è¯´æ˜</p><ul><li><strong>resource</strong> âˆ¶ èµ„æºåç§°;</li><li><strong>limlitApp</strong> âˆ¶  æ¥æºåº”ç”¨;</li><li>**grade **âˆ¶ é˜ˆå€¼ç±»å‹ï¼Œ0 è¡¨ç¤ºçº¿ç¨‹æ•°ï¼Œ1 è¡¨ç¤ºQPS;</li><li><strong>count</strong> âˆ¶ å•æœºé˜ˆå€¼;</li><li>**strategy **âˆ¶ æµæ§æ¨¡å¼ï¼Œ0 è¡¨ç¤ºç›´æ¥ï¼Œ1 è¡¨ç¤ºå…³è”ï¼Œ2 è¡¨ç¤ºé“¾è·¯;</li><li>**controlBehavior **âˆ¶ æµæ§æ•ˆæœï¼Œ0 è¡¨ç¤ºå¿«é€Ÿå¤±è´¥ï¼Œ1 è¡¨ç¤ºWarm Upï¼Œ2 è¡¨ç¤ºæ’é˜Ÿç­‰å¾…;</li><li>**clusterMode **âˆ¶ æ˜¯å¦é›†ç¾¤</li></ul><p><strong>3.</strong> <strong>ä¿®æ”¹</strong> <strong>member-service-nacos-consumer-80</strong> <strong>çš„</strong> <strong>pom.xml,</strong> <strong>åŠ å…¥</strong> <strong>sentinel</strong> <strong>å’Œ</strong> <strong>nacos</strong> <strong>æŒä¹…åŒ–æ•´åˆä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åŠ å…¥ sentinel å’Œ nacos æŒä¹…åŒ–æ•´åˆä¾èµ– --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>4.</strong> <strong>ä¿®æ”¹</strong> <strong>member-service-nacos-consumer-80</strong>çš„application.yml , é…ç½®è¯¥å¾®æœåŠ¡ä»Nacos  Serverè·å–æµæ§è§„åˆ™</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨åŸæœ¬çš„åŸºç¡€ä¸Šæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">    <span class="comment"># é…ç½®è¯¥å¾®æœåŠ¡ä» Nacos Server è·å–æµæ§è§„åˆ™</span></span><br><span class="line">      <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">ds1:</span></span><br><span class="line">          <span class="attr">nacos:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="attr">dataId:</span> <span class="string">member-service-nacos-consumer</span></span><br><span class="line">        <span class="attr">groupId:</span> <span class="string">DEFAULT_GROUP</span></span><br><span class="line">        <span class="attr">data-type:</span> <span class="string">json</span></span><br><span class="line">        <span class="attr">rule-type:</span> <span class="string">flow</span></span><br></pre></td></tr></table></figure><h4 id="10-10-3-4-æµ‹è¯•"><a href="#10-10-3-4-æµ‹è¯•" class="headerlink" title="10.10.3.4 æµ‹è¯•"></a>10.10.3.4 æµ‹è¯•</h4><h5 id="10-10-3-4-1-å¯åŠ¨-Nacos-Server-8848"><a href="#10-10-3-4-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="10.10.3.4.1 å¯åŠ¨ Nacos Server 8848"></a><strong>10.10.3.4.1</strong> å¯åŠ¨ Nacos Server 8848</h5><h5 id="10-10-3-4-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard"><a href="#10-10-3-4-2-å¯åŠ¨-Sentinel8080-æ§åˆ¶å°-x2F-Sentinel-dashboard" class="headerlink" title="10.10.3.4.2 å¯åŠ¨ Sentinel8080 æ§åˆ¶å°&#x2F;Sentinel dashboard"></a>10.10.3.4.2 å¯åŠ¨ <strong>Sentinel8080</strong> æ§åˆ¶å°&#x2F;Sentinel dashboard</h5><h5 id="10-10-3-4-3-å¯åŠ¨-member-service-nacos-provider-10004-x2F-10006"><a href="#10-10-3-4-3-å¯åŠ¨-member-service-nacos-provider-10004-x2F-10006" class="headerlink" title="10.10.3.4.3 å¯åŠ¨ **member-service-nacos-provider-10004&#x2F;10006 **"></a>10.10.3.4.3 å¯åŠ¨ **member-service-nacos-provider-10004&#x2F;10006 **</h5><h5 id="10-10-3-4-4-å¯åŠ¨-member-service-nacos-consumer-80"><a href="#10-10-3-4-4-å¯åŠ¨-member-service-nacos-consumer-80" class="headerlink" title="10.10.3.4.4 å¯åŠ¨ member-service-nacos-consumer-80"></a><strong>10.10.3.4.4</strong> å¯åŠ¨ member-service-nacos-consumer-80</h5><h5 id="10-10-3-4-5-æµè§ˆå™¨-http-localhost-member-openfeign-consumer-get-1"><a href="#10-10-3-4-5-æµè§ˆå™¨-http-localhost-member-openfeign-consumer-get-1" class="headerlink" title="10.10.3.4.5 æµè§ˆå™¨**: http://localhost/member/openfeign/consumer/get/1**"></a>10.10.3.4.5 æµè§ˆå™¨**: <a href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a>**</h5><p><strong>1.</strong> æµè§ˆå™¨è¾“å…¥**: <a href="http://localhost/member/openfeign/consumer/get/1">http://localhost/member/openfeign/consumer/get/1</a> ,** ç›®å‰æ˜¯ <strong>Openfeign</strong> è°ƒç”¨**(<strong>è´Ÿè½½å‡è¡¡</strong>),** <u><em><strong>è€Œä¸”æµæ§è§„åˆ™å·²ç»ç”Ÿæ•ˆäº†.</strong></em></u></p><p><strong>2.</strong> <strong>æŸ¥çœ‹</strong> <strong>Sentinel</strong> <strong>æ§åˆ¶å°</strong>,<strong>å‘ç°å·²ç»åŒæ­¥äº†æµæ§è§„åˆ™</strong></p><h4 id="10-10-3-5-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#10-10-3-5-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="10.10.3.5 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>10.10.3.5 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p><strong>1.</strong> åœ¨ <strong>nacos server</strong> é…ç½® <strong>sentinel</strong> æµæ§è§„åˆ™çš„ <strong>Data ID</strong> ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šï¼Œæ¯”å¦‚å†™æˆ <strong>hsp-id,</strong> åªè¦åœ¨ **sentinel client&#x2F;**å¾®æœåŠ¡ çš„ <strong>applicaion.yml</strong> çš„ <strong>datasource.ds1.nacos.dataId</strong> çš„å€¼ä¿æŒä¸€è‡´å³å¯</p><p><strong>2.</strong> <strong>å¦‚å›¾æ‰€ç¤º</strong></p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630194533516.png" alt="image-20230630194533516" style="zoom:50%;" /><h1 id="11-SpringCloud-Alibaba-Seataå…¨å±€äº‹åŠ¡"><a href="#11-SpringCloud-Alibaba-Seataå…¨å±€äº‹åŠ¡" class="headerlink" title="11 SpringCloud Alibaba Seataå…¨å±€äº‹åŠ¡"></a>11 SpringCloud Alibaba Seataå…¨å±€äº‹åŠ¡</h1><p><strong>å…¨å±€äº‹åŠ¡</strong>â€”â€”ä¿è¯ä¸€ä¸ªç‰µæ‰¯ä¿®æ”¹å¤šä¸ªæ•°æ®åº“çš„æ“ä½œç”±äºæ„å¤–æƒ…å†µå¯¼è‡´æ•°æ®åº“ä¸­æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ</p><h2 id="11-1-SeataåŸºç¡€"><a href="#11-1-SeataåŸºç¡€" class="headerlink" title="11.1 SeataåŸºç¡€"></a>11.1 SeataåŸºç¡€</h2><h3 id="11-1-1-å…ˆçœ‹ä¸€ä¸ªé—®é¢˜ï¼Œå¼•å‡º-Seata"><a href="#11-1-1-å…ˆçœ‹ä¸€ä¸ªé—®é¢˜ï¼Œå¼•å‡º-Seata" class="headerlink" title="11.1.1 å…ˆçœ‹ä¸€ä¸ªé—®é¢˜ï¼Œå¼•å‡º Seata"></a><strong>11.1.1</strong> å…ˆçœ‹ä¸€ä¸ªé—®é¢˜ï¼Œå¼•å‡º <strong>Seata</strong></h3><p><strong>1.</strong> å•æœºå•åº“**(<strong>å¤šè¡¨</strong>)**å¤„ç†äº‹åŠ¡ç¤ºæ„å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630203651434.png" alt="image-20230630203651434"></p><p><strong>2.</strong> <strong>åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ä¸‹çš„æ•°æ®åº“äº‹åŠ¡ç¤ºæ„å›¾</strong>ï¼ˆRPCï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230630204333902.png" alt="image-20230630204333902" style="zoom:50%;" /><p><strong>3.</strong> <strong>æ¢³ç†ä¸Šå›¾</strong></p><p>ç”¨æˆ·è´­ä¹°å•†å“çš„ä¸šåŠ¡é€»è¾‘ã€‚æ•´ä¸ªä¸šåŠ¡é€»è¾‘ç”±3ä¸ªå¾®æœåŠ¡æä¾›æ”¯æŒâˆ¶</p><ul><li><strong>ä»“å‚¨æœåŠ¡âˆ¶å¯¹ç»™å®šçš„å•†å“æ‰£é™¤ä»“åº“&#x2F;å•†å“æ•°é‡</strong></li><li><strong>è®¢å•æœåŠ¡;æ ¹æ®é‡‡è´­éœ€æ±‚åˆ›å»ºè®¢å•</strong></li><li><strong>å¸æˆ·æœåŠ¡âˆ¶ä»ç”¨æˆ·å¸æˆ·ä¸­æ‰£é™¤ä½™é¢</strong></li></ul><p><strong>4.</strong> <strong>é—®é¢˜åˆ†æ</strong></p><ul><li><p><strong>å•ä½“åº”ç”¨è¢«æ‹†åˆ†æˆå¾®æœåŠ¡åº”ç”¨ï¼ŒåŸæ¥çš„ä¸‰ä¸ªæ¨¡å—è¢«æ‹†åˆ†æˆä¸‰ä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œåˆ†åˆ«ä½¿ç”¨ä¸‰ä¸ªç‹¬ç«‹çš„æ•°æ®æº</strong></p></li><li><p>ä¸šåŠ¡æ“ä½œéœ€è¦è°ƒç”¨ä¸‰ä¸ªæœåŠ¡æ¥å®Œæˆã€‚æ­¤æ—¶<strong>æ¯ä¸ªæœåŠ¡å†…éƒ¨çš„æ•°æ®ä¸€è‡´æ€§ç”±æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯</strong></p></li><li><p><strong>ä½†æ˜¯å…¨å±€çš„æ•°æ®â€”è‡´æ€§é—®é¢˜æ²¡æ³•ä¿è¯</strong></p></li><li><p>ç®€å•çš„è¯´: <u>ä¸€æ¬¡ä¸šåŠ¡æ“ä½œéœ€è¦è·¨å¤šä¸ªæ•°æ®æºæˆ–éœ€è¦è·¨å¤šä¸ªç³»ç»Ÿè¿›è¡Œè¿œç¨‹è°ƒç”¨</u>ï¼Œå°±ä¼š<strong>äº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</strong>â€”â€“</p><p>â€”â€”-&gt;seata</p></li></ul><h3 id="11-1-2-åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜-amp-è§£å†³æ–¹æ¡ˆ"><a href="#11-1-2-åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜-amp-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="11.1.2 åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜**&amp;**è§£å†³æ–¹æ¡ˆ"></a><strong>11.1.2</strong> åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜**&amp;**è§£å†³æ–¹æ¡ˆ</h3><h4 id="11-1-2-1-åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ä¸‹çš„å…¨å±€æ•°æ®ä¸€è‡´æ€§é—®é¢˜-å³-åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"><a href="#11-1-2-1-åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ä¸‹çš„å…¨å±€æ•°æ®ä¸€è‡´æ€§é—®é¢˜-å³-åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜" class="headerlink" title="11.1.2.1 åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ä¸‹çš„å…¨å±€æ•°æ®ä¸€è‡´æ€§é—®é¢˜ [å³: åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜]"></a>11.1.2.1 åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ä¸‹çš„å…¨å±€æ•°æ®ä¸€è‡´æ€§é—®é¢˜ [å³: åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜]</h4><h4 id="11-1-2-2-è§£å†³æ–¹æ¡ˆ-Seata"><a href="#11-1-2-2-è§£å†³æ–¹æ¡ˆ-Seata" class="headerlink" title="11.1.2.2 è§£å†³æ–¹æ¡ˆ: Seata"></a>11.1.2.2 è§£å†³æ–¹æ¡ˆ: Seata</h4><h3 id="11-1-3-å®˜ç½‘"><a href="#11-1-3-å®˜ç½‘" class="headerlink" title="11.1.3 å®˜ç½‘"></a><strong>11.1.3</strong> å®˜ç½‘</h3><h4 id="11-1-3-1-http-seata-io-zh-cn"><a href="#11-1-3-1-http-seata-io-zh-cn" class="headerlink" title="11.1.3.1 http://seata.io/zh-cn/"></a>11.1.3.1 <a href="http://seata.io/zh-cn/">http://seata.io/zh-cn/</a></h4><h4 id="11-1-3-2-ä½¿ç”¨æ‰‹å†Œ-https-seata-io-zh-cn-docs-overview-what-is-seata-html"><a href="#11-1-3-2-ä½¿ç”¨æ‰‹å†Œ-https-seata-io-zh-cn-docs-overview-what-is-seata-html" class="headerlink" title="11.1.3.2 ä½¿ç”¨æ‰‹å†Œ: https://seata.io/zh-cn/docs/overview/what-is-seata.html"></a>11.1.3.2 ä½¿ç”¨æ‰‹å†Œ: <a href="https://seata.io/zh-cn/docs/overview/what-is-seata.html">https://seata.io/zh-cn/docs/overview/what-is-seata.html</a></h4><h3 id="11-1-4-Seataæ˜¯ä»€ä¹ˆ"><a href="#11-1-4-Seataæ˜¯ä»€ä¹ˆ" class="headerlink" title="11.1.4 Seataæ˜¯ä»€ä¹ˆ?"></a>11.1.4 Seataæ˜¯ä»€ä¹ˆ?</h3><p>Seata æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äº<strong>åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹æä¾›<u>é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡</u></strong></p><h2 id="11-2-ğŸŒŸSeata-å·¥ä½œæœºåˆ¶-x2F-è¿”è®²"><a href="#11-2-ğŸŒŸSeata-å·¥ä½œæœºåˆ¶-x2F-è¿”è®²" class="headerlink" title="11.2 ğŸŒŸSeata å·¥ä½œæœºåˆ¶&#x2F;è¿”è®²"></a>11.2 ğŸŒŸSeata å·¥ä½œæœºåˆ¶&#x2F;è¿”è®²</h2><h3 id="11-2-1-åˆ†å¸ƒå¼äº‹åŠ¡è¿‡ç¨‹åˆ†æ"><a href="#11-2-1-åˆ†å¸ƒå¼äº‹åŠ¡è¿‡ç¨‹åˆ†æ" class="headerlink" title="11.2.1 åˆ†å¸ƒå¼äº‹åŠ¡è¿‡ç¨‹åˆ†æ"></a><strong>11.2.1</strong> åˆ†å¸ƒå¼äº‹åŠ¡è¿‡ç¨‹åˆ†æ</h3><p><strong>1. Seata</strong> åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†è¿‡ç¨‹-ID+ä¸‰ç»„ä»¶æ¨¡å‹</p><p><strong>2.</strong> ä¸€å›¾èƒœåƒè¨€</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703150121800.png" alt="image-20230703150121800"></p><p>ä¸Šå›¾å±•ç¤ºäº†ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡åœ¨Seataçš„å¤„ç†è¿‡ç¨‹</p><ul><li>Transaction ID <strong>XID</strong>:å…¨å±€å”¯ä¸€çš„äº‹åŠ¡ID</li><li>Transaction Coordinator(<strong>TC</strong>): äº‹åŠ¡åè°ƒå™¨ï¼Œ<u>ç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€</u>ï¼Œè´Ÿè´£<u>åè°ƒå¹¶é©±åŠ¨å…¨å±€äº‹åŠ¡çš„æäº¤æˆ–å›æ»š</u></li><li>Transaction Manager(<strong>TM</strong>): æ§åˆ¶<u>å…¨å±€äº‹åŠ¡</u>çš„è¾¹ç•Œï¼Œè´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶æœ€ç»ˆå‘èµ·å…¨å±€æäº¤æˆ–å…¨å±€å›æ»šçš„å†³è®®;</li><li>Resource Manager(<strong>RM</strong>):æ§åˆ¶<u>åˆ†æ”¯äº‹åŠ¡</u>ï¼Œè´Ÿè´£åˆ†æ”¯æ³¨å†Œï¼ŒçŠ¶æ€æ±‡æŠ¥ï¼Œå¹¶æ¥æ”¶äº‹åŠ¡åè°ƒå™¨çš„æŒ‡ä»¤ï¼Œé©±åŠ¨åˆ†æ”¯ (æœ¬åœ°)äº‹åŠ¡çš„<strong>æäº¤å’Œå›æ»š</strong></li></ul><p>æ‰§è¡Œè¿‡ç¨‹</p><ul><li>TMå‘ TCç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XID</li><li>XIDåœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­</li><li>RM å‘ TCæ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾–</li><li>TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®®ã€‚</li><li>TC è°ƒåº¦ XIDä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚</li></ul><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703152243363.png" alt="image-20230703152243363" style="zoom:150%;" /><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703152337277.png" alt="image-20230703152337277"></p><h3 id="11-2-2-Seata-äº‹åŠ¡æ¨¡å¼"><a href="#11-2-2-Seata-äº‹åŠ¡æ¨¡å¼" class="headerlink" title="11.2.2 Seata äº‹åŠ¡æ¨¡å¼"></a>11.2.2 Seata äº‹åŠ¡æ¨¡å¼</h3><p><strong>1.</strong> <strong>åœ°å€</strong>: <a href="https://seata.io/zh-cn/docs/overview/what-is-seata.html">https://seata.io/zh-cn/docs/overview/what-is-seata.html</a></p><h4 id="11-2-2-1-AT-é»˜è®¤æ¨¡å¼"><a href="#11-2-2-1-AT-é»˜è®¤æ¨¡å¼" class="headerlink" title="11.2.2.1 AT(é»˜è®¤æ¨¡å¼)"></a>11.2.2.1 AT(é»˜è®¤æ¨¡å¼)</h4><h4 id="11-2-2-2-TCC"><a href="#11-2-2-2-TCC" class="headerlink" title="11.2.2.2 TCC"></a>11.2.2.2 TCC</h4><h4 id="11-2-2-3-SAGA"><a href="#11-2-2-3-SAGA" class="headerlink" title="11.2.2.3 SAGA"></a>11.2.2.3 SAGA</h4><h4 id="11-2-2-4-XA"><a href="#11-2-2-4-XA" class="headerlink" title="11.2.2.4 XA"></a>11.2.2.4 XA</h4><h3 id="11-2-3-ATæ— ä¾µå…¥æ¨¡å¼"><a href="#11-2-3-ATæ— ä¾µå…¥æ¨¡å¼" class="headerlink" title="11.2.3 ATæ— ä¾µå…¥æ¨¡å¼"></a>11.2.3 ATæ— ä¾µå…¥æ¨¡å¼</h3><h4 id="11-2-3-1-æ–‡æ¡£-https-seata-io-zh-cn-docs-overview-what-is-seata-html"><a href="#11-2-3-1-æ–‡æ¡£-https-seata-io-zh-cn-docs-overview-what-is-seata-html" class="headerlink" title="11.2.3.1 æ–‡æ¡£: https://seata.io/zh-cn/docs/overview/what-is-seata.html"></a>11.2.3.1 æ–‡æ¡£: <a href="https://seata.io/zh-cn/docs/overview/what-is-seata.html">https://seata.io/zh-cn/docs/overview/what-is-seata.html</a></h4><h4 id="11-2-3-2-ä¸€é˜¶æ®µåŠ è½½"><a href="#11-2-3-2-ä¸€é˜¶æ®µåŠ è½½" class="headerlink" title="11.2.3.2 ä¸€é˜¶æ®µåŠ è½½"></a>11.2.3.2 ä¸€é˜¶æ®µåŠ è½½</h4><p>åœ¨ä¸€é˜¶æ®µï¼Œ<strong>Seata</strong> ä¼šæ‹¦æˆª**â€**ä¸šåŠ¡ <strong>SQLâ€</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703161643439.png" alt="image-20230703161643439"></p><ol><li><p>è§£æ SQL è¯­ä¹‰ï¼Œæ‰¾åˆ°â€œä¸šåŠ¡SQLâ€è¦æ›´æ–°çš„ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°å‰ï¼Œå°†å…¶ä¿å­˜æˆâ€before imageâ€(å‰ç½é•œåƒï¼‰</p></li><li><p>æ‰§è¡Œâ€ä¸šåŠ¡ SQLâ€æ›´æ–°ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®æ›´æ–°ä¹‹åï¼Œå…¶ä¿å­˜æˆâ€after imageâ€ &#x2F;åç½®é•œåƒ</p></li><li><p>æœ€åç”Ÿæˆè¡Œé”</p></li><li><p>ä»¥ä¸Šæ“ä½œå…¨éƒ¨åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å†…å®Œæˆï¼Œè¿™æ ·ä¿è¯äº†ä¸€é˜¶æ®µæ“ä½œçš„åŸå­æ€§</p></li></ol><p>å…¶ä¸­ï¼Œ<strong>å‰åƒä¸ååƒå­˜äºundo_logæ•°æ®è¡¨ä¸­</strong></p><h4 id="11-2-3-3-äºŒé˜¶æ®µæäº¤"><a href="#11-2-3-3-äºŒé˜¶æ®µæäº¤" class="headerlink" title="11.2.3.3 äºŒé˜¶æ®µæäº¤"></a>11.2.3.3 äºŒé˜¶æ®µæäº¤</h4><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703162629147.png" alt="image-20230703162629147" style="zoom: 40%;" /><p><strong>1.</strong> <strong>äºŒé˜¶æ®µå¦‚æœæ˜¯é¡ºåˆ©æäº¤</strong></p><p><strong>2.</strong> <strong>å› ä¸ºâ€ä¸šåŠ¡ SQLâ€åœ¨ä¸€é˜¶æ®µå·²ç»æäº¤è‡³æ•°æ®åº“ï¼Œæ‰€ä»¥ Seata æ¡†æ¶åªéœ€å°†ä¸€é˜¶æ®µä¿å­˜çš„å¿«ç…§æ•°æ®å’Œè¡Œé”åˆ æ‰ï¼Œå®Œæˆæ•°æ®æ¸…ç†å³å¯</strong></p><h4 id="11-2-3-4-äºŒé˜¶æ®µå›æ»š"><a href="#11-2-3-4-äºŒé˜¶æ®µå›æ»š" class="headerlink" title="11.2.3.4 äºŒé˜¶æ®µå›æ»š"></a>11.2.3.4 äºŒé˜¶æ®µå›æ»š</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703162812449.png" alt="image-20230703162812449"></p><ol><li><p>äºŒé˜¶æ®µå¦‚æœæ˜¯å›æ»šçš„è¯ï¼Œseata å°±éœ€è¦<strong>å›æ»šä¸€é˜¶æ®µå·±ç»æ‰§è¡Œçš„â€œä¸šåŠ¡ SQLâ€â€˜ï¼Œè¿˜åŸä¸šåŠ¡æ•°æ®</strong>ã€‚</p></li><li><p>å›æ»šæ–¹å¼ä¾¿æ˜¯ç”¨â€before imageâ€è¿˜åŸä¸šåŠ¡æ•°æ®;ä½†åœ¨è¿˜åŸå‰è¦é¦–å…ˆè¦æ ¡éªŒè„å·ï¼Œå¯¹æ¯”â€æ•°æ®åº“å½“å‰ä¸šåŠ¡æ•°æ®â€å’Œâ€after image å¦‚æœä¸¤ä»½æ•°æ®å®Œå…¨ä¸€è‡´å°±è¯´æ˜æ²¡æœ‰è„å†™ï¼Œå¯ä»¥è¿˜åŸä¸šåŠ¡æ•°æ®</p></li><li><p>å¦‚æœä¸ä¸€è‡´å°±è¯´æ˜æœ‰è„å†™ï¼Œå‡ºç°è„å†™å°±éœ€è¦è½¬äººå·¥å¤„ç†</p></li></ol><h3 id="11-2-4-ATäº‹åŠ¡æ¨¡å¼DebugéªŒè¯"><a href="#11-2-4-ATäº‹åŠ¡æ¨¡å¼DebugéªŒè¯" class="headerlink" title="11.2.4 ATäº‹åŠ¡æ¨¡å¼DebugéªŒè¯"></a>11.2.4 AT<strong>äº‹åŠ¡æ¨¡å¼</strong>DebugéªŒè¯</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703163149523.png" alt="image-20230703163149523"></p><h3 id="11-2-5-SEATAçš„åˆ†å¸ƒå¼äº¤æ˜“è§£å†³æ–¹æ¡ˆ"><a href="#11-2-5-SEATAçš„åˆ†å¸ƒå¼äº¤æ˜“è§£å†³æ–¹æ¡ˆ" class="headerlink" title="11.2.5 SEATAçš„åˆ†å¸ƒå¼äº¤æ˜“è§£å†³æ–¹æ¡ˆ"></a>11.2.5 SEATAçš„åˆ†å¸ƒå¼äº¤æ˜“è§£å†³æ–¹æ¡ˆ</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703163341180.png" alt="image-20230703163341180"></p><h2 id="11-3-SeataServerå®‰è£…"><a href="#11-3-SeataServerå®‰è£…" class="headerlink" title="11.3 SeataServerå®‰è£…"></a>11.3 SeataServerå®‰è£…</h2><h3 id="11-3-1-ä¸‹è½½"><a href="#11-3-1-ä¸‹è½½" class="headerlink" title="11.3.1 ä¸‹è½½"></a><strong>11.3.1</strong> ä¸‹è½½</h3><h4 id="11-3-1-1-https-github-com-seata-seata-releases-tag-v0-9-0"><a href="#11-3-1-1-https-github-com-seata-seata-releases-tag-v0-9-0" class="headerlink" title="11.3.1.1 https://github.com/seata/seata/releases/tag/v0.9.0"></a>11.3.1.1 <a href="https://github.com/seata/seata/releases/tag/v0.9.0">https://github.com/seata/seata/releases/tag/v0.9.0</a></h4><h3 id="11-3-2-å®‰è£…å’Œé…ç½®"><a href="#11-3-2-å®‰è£…å’Œé…ç½®" class="headerlink" title="11.3.2 å®‰è£…å’Œé…ç½®"></a><strong>11.3.2</strong> å®‰è£…å’Œé…ç½®</h3><p><strong>1.</strong> å°† <strong>seata-server-0.9.0.zip</strong> è§£å‹åˆ° æŒ‡å®šç›®å½•ï¼Œæ¯”å¦‚ <strong>d:\program</strong></p><p><strong>2.</strong> <strong>ä¿®æ”¹</strong> <strong>conf\file.conf</strong> <strong>æ–‡ä»¶</strong>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">transport &#123;</span><br><span class="line">  # tcp udt unix-domain-socket</span><br><span class="line">  type = <span class="string">&quot;TCP&quot;</span></span><br><span class="line">  #<span class="variable constant_">NIO</span> <span class="variable constant_">NATIVE</span></span><br><span class="line">  server = <span class="string">&quot;NIO&quot;</span></span><br><span class="line">  #enable heartbeat</span><br><span class="line">  heartbeat = <span class="literal">true</span></span><br><span class="line">  #thread factory <span class="keyword">for</span> netty</span><br><span class="line">  thread-factory &#123;</span><br><span class="line">    boss-thread-prefix = <span class="string">&quot;NettyBoss&quot;</span></span><br><span class="line">    worker-thread-prefix = <span class="string">&quot;NettyServerNIOWorker&quot;</span></span><br><span class="line">    server-executor-thread-prefix = <span class="string">&quot;NettyServerBizHandler&quot;</span></span><br><span class="line">    share-boss-worker = <span class="literal">false</span></span><br><span class="line">    client-selector-thread-prefix = <span class="string">&quot;NettyClientSelector&quot;</span></span><br><span class="line">    client-selector-thread-size = <span class="number">1</span></span><br><span class="line">    client-worker-thread-prefix = <span class="string">&quot;NettyClientWorkerThread&quot;</span></span><br><span class="line">    # netty boss thread size,will not be used <span class="keyword">for</span> <span class="variable constant_">UDT</span></span><br><span class="line">    boss-thread-size = <span class="number">1</span></span><br><span class="line">    #auto <span class="keyword">default</span> pin or <span class="number">8</span></span><br><span class="line">    worker-thread-size = <span class="number">8</span></span><br><span class="line">  &#125;</span><br><span class="line">  shutdown &#123;</span><br><span class="line">    # when destroy server, wait seconds</span><br><span class="line">    wait = <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">  serialization = <span class="string">&quot;seata&quot;</span></span><br><span class="line">  compressor = <span class="string">&quot;none&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">service &#123;</span><br><span class="line">  #vgroup-&gt;rgroup</span><br><span class="line">  #vgroup_mapping.<span class="property">my_test_tx_group</span> = <span class="string">&quot;default&quot;</span></span><br><span class="line">  vgroup_mapping.<span class="property">my_test_tx_group</span> = <span class="string">&quot;hspedu_order_tx_group&quot;</span></span><br><span class="line">  #only support single node</span><br><span class="line">  <span class="keyword">default</span>.<span class="property">grouplist</span> = <span class="string">&quot;127.0.0.1:8091&quot;</span></span><br><span class="line">  #degrade current not support</span><br><span class="line">  enableDegrade = <span class="literal">false</span></span><br><span class="line">  #disable</span><br><span class="line">  disable = <span class="literal">false</span></span><br><span class="line">  #unit ms,s,m,h,d represents milliseconds, seconds, minutes, hours, days, <span class="keyword">default</span> permanent</span><br><span class="line">  max.<span class="property">commit</span>.<span class="property">retry</span>.<span class="property">timeout</span> = <span class="string">&quot;-1&quot;</span></span><br><span class="line">  max.<span class="property">rollback</span>.<span class="property">retry</span>.<span class="property">timeout</span> = <span class="string">&quot;-1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">client &#123;</span><br><span class="line">  <span class="keyword">async</span>.<span class="property">commit</span>.<span class="property">buffer</span>.<span class="property">limit</span> = <span class="number">10000</span></span><br><span class="line">  lock &#123;</span><br><span class="line">    retry.<span class="property">internal</span> = <span class="number">10</span></span><br><span class="line">    retry.<span class="property">times</span> = <span class="number">30</span></span><br><span class="line">  &#125;</span><br><span class="line">  report.<span class="property">retry</span>.<span class="property">count</span> = <span class="number">5</span></span><br><span class="line">  tm.<span class="property">commit</span>.<span class="property">retry</span>.<span class="property">count</span> = <span class="number">1</span></span><br><span class="line">  tm.<span class="property">rollback</span>.<span class="property">retry</span>.<span class="property">count</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## transaction log store</span><br><span class="line">store &#123;</span><br><span class="line">  ## store <span class="attr">mode</span>: fileã€db</span><br><span class="line">  ##mode = <span class="string">&quot;file&quot;</span></span><br><span class="line">  mode = <span class="string">&quot;db&quot;</span></span><br><span class="line"></span><br><span class="line">  ## file store</span><br><span class="line">  file &#123;</span><br><span class="line">    dir = <span class="string">&quot;sessionStore&quot;</span></span><br><span class="line"></span><br><span class="line">    # branch session size , <span class="keyword">if</span> exceeded first <span class="keyword">try</span> compress lockkey, still exceeded throws exceptions</span><br><span class="line">    max-branch-session-size = <span class="number">16384</span></span><br><span class="line">    # globe session size , <span class="keyword">if</span> exceeded throws exceptions</span><br><span class="line">    max-<span class="variable language_">global</span>-session-size = <span class="number">512</span></span><br><span class="line">    # file buffer size , <span class="keyword">if</span> exceeded allocate <span class="keyword">new</span> buffer</span><br><span class="line">    file-write-buffer-cache-size = <span class="number">16384</span></span><br><span class="line">    # when recover batch read size</span><br><span class="line">    session.<span class="property">reload</span>.<span class="property">read_size</span> = <span class="number">100</span></span><br><span class="line">    # <span class="keyword">async</span>, sync</span><br><span class="line">    flush-disk-mode = <span class="keyword">async</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ## database store</span><br><span class="line">  db &#123;</span><br><span class="line">    ## the implement <span class="keyword">of</span> javax.<span class="property">sql</span>.<span class="property">DataSource</span>, such <span class="keyword">as</span> <span class="title class_">DruidDataSource</span>(druid)/<span class="title class_">BasicDataSource</span>(dbcp) etc.</span><br><span class="line">    datasource = <span class="string">&quot;dbcp&quot;</span></span><br><span class="line">    ## mysql/oracle/h2/oceanbase etc.</span><br><span class="line">    db-type = <span class="string">&quot;mysql&quot;</span></span><br><span class="line">    driver-<span class="keyword">class</span>-name = <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span><br><span class="line">    url = <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/seata&quot;</span></span><br><span class="line">    ##user = <span class="string">&quot;mysql&quot;</span></span><br><span class="line">    user = <span class="string">&quot;root&quot;</span></span><br><span class="line">    ##password = <span class="string">&quot;mysql&quot;</span></span><br><span class="line">    password = <span class="string">&quot;QWEASDzxc123&quot;</span></span><br><span class="line">    min-conn = <span class="number">1</span></span><br><span class="line">    max-conn = <span class="number">3</span></span><br><span class="line">    <span class="variable language_">global</span>.<span class="property">table</span> = <span class="string">&quot;global_table&quot;</span></span><br><span class="line">    branch.<span class="property">table</span> = <span class="string">&quot;branch_table&quot;</span></span><br><span class="line">    lock-table = <span class="string">&quot;lock_table&quot;</span></span><br><span class="line">    query-limit = <span class="number">100</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">lock &#123;</span><br><span class="line">  ## the lock store <span class="attr">mode</span>: localã€remote</span><br><span class="line">  mode = <span class="string">&quot;remote&quot;</span></span><br><span class="line"></span><br><span class="line">  local &#123;</span><br><span class="line">    ## store locks <span class="keyword">in</span> user<span class="string">&#x27;s database</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  remote &#123;</span></span><br><span class="line"><span class="string">    ## store locks in the seata&#x27;</span>s server</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">recovery &#123;</span><br><span class="line">  #schedule committing retry period <span class="keyword">in</span> milliseconds</span><br><span class="line">  committing-retry-period = <span class="number">1000</span></span><br><span class="line">  #schedule asyn committing retry period <span class="keyword">in</span> milliseconds</span><br><span class="line">  asyn-committing-retry-period = <span class="number">1000</span></span><br><span class="line">  #schedule rollbacking retry period <span class="keyword">in</span> milliseconds</span><br><span class="line">  rollbacking-retry-period = <span class="number">1000</span></span><br><span class="line">  #schedule timeout retry period <span class="keyword">in</span> milliseconds</span><br><span class="line">  timeout-retry-period = <span class="number">1000</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">transaction &#123;</span><br><span class="line">  undo.<span class="property">data</span>.<span class="property">validation</span> = <span class="literal">true</span></span><br><span class="line">  undo.<span class="property">log</span>.<span class="property">serialization</span> = <span class="string">&quot;jackson&quot;</span></span><br><span class="line">  undo.<span class="property">log</span>.<span class="property">save</span>.<span class="property">days</span> = <span class="number">7</span></span><br><span class="line">  #schedule <span class="keyword">delete</span> expired undo_log <span class="keyword">in</span> milliseconds</span><br><span class="line">  undo.<span class="property">log</span>.<span class="property">delete</span>.<span class="property">period</span> = <span class="number">86400000</span></span><br><span class="line">  undo.<span class="property">log</span>.<span class="property">table</span> = <span class="string">&quot;undo_log&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## metrics settings</span><br><span class="line">metrics &#123;</span><br><span class="line">  enabled = <span class="literal">false</span></span><br><span class="line">  registry-type = <span class="string">&quot;compact&quot;</span></span><br><span class="line">  # multi exporters use comma divided</span><br><span class="line">  exporter-list = <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">  exporter-prometheus-port = <span class="number">9898</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">support &#123;</span><br><span class="line">  ## spring</span><br><span class="line">  spring &#123;</span><br><span class="line">    # auto proxy the <span class="title class_">DataSource</span> bean</span><br><span class="line">    datasource.<span class="property">autoproxy</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3.</strong> <strong>åœ¨</strong> <strong>mysql5.7</strong> <strong>åˆ›å»º</strong> <strong>seata</strong> <strong>æ•°æ®åº“</strong></p><p><strong>4.</strong> <strong>ä¿®æ”¹</strong> <strong>seata</strong> <strong>çš„</strong> <strong>\conf\registry.conf ,</strong> <strong>é…ç½®æ³¨å†Œä¸­å¿ƒ</strong> <strong>nacos server</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">registry &#123;</span><br><span class="line">  # file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa</span><br><span class="line">  # type = <span class="string">&quot;file&quot;</span></span><br><span class="line">  type = <span class="string">&quot;nacos&quot;</span></span><br><span class="line"></span><br><span class="line">  nacos &#123;</span><br><span class="line">    # serverAddr = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;localhost:8848&quot;</span></span><br><span class="line">    namespace = <span class="string">&quot;&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  eureka &#123;</span><br><span class="line">    serviceUrl = <span class="string">&quot;http://localhost:8761/eureka&quot;</span></span><br><span class="line">    application = <span class="string">&quot;default&quot;</span></span><br><span class="line">    weight = <span class="string">&quot;1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  redis &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;localhost:6379&quot;</span></span><br><span class="line">    db = <span class="string">&quot;0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  zk &#123;</span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:2181&quot;</span></span><br><span class="line">    session.<span class="property">timeout</span> = <span class="number">6000</span></span><br><span class="line">    connect.<span class="property">timeout</span> = <span class="number">2000</span></span><br><span class="line">  &#125;</span><br><span class="line">  consul &#123;</span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:8500&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  etcd3 &#123;</span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;http://localhost:2379&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  sofa &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:9603&quot;</span></span><br><span class="line">    application = <span class="string">&quot;default&quot;</span></span><br><span class="line">    region = <span class="string">&quot;DEFAULT_ZONE&quot;</span></span><br><span class="line">    datacenter = <span class="string">&quot;DefaultDataCenter&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    group = <span class="string">&quot;SEATA_GROUP&quot;</span></span><br><span class="line">    addressWaitTime = <span class="string">&quot;3000&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  file &#123;</span><br><span class="line">    name = <span class="string">&quot;file.conf&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">config &#123;</span><br><span class="line">  # fileã€nacos ã€apolloã€zkã€consulã€etcd3</span><br><span class="line">  type = <span class="string">&quot;file&quot;</span></span><br><span class="line"></span><br><span class="line">  nacos &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">    namespace = <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  consul &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:8500&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  apollo &#123;</span><br><span class="line">    app.<span class="property">id</span> = <span class="string">&quot;seata-server&quot;</span></span><br><span class="line">    apollo.<span class="property">meta</span> = <span class="string">&quot;http://192.168.1.204:8801&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  zk &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:2181&quot;</span></span><br><span class="line">    session.<span class="property">timeout</span> = <span class="number">6000</span></span><br><span class="line">    connect.<span class="property">timeout</span> = <span class="number">2000</span></span><br><span class="line">  &#125;</span><br><span class="line">  etcd3 &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;http://localhost:2379&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  file &#123;</span><br><span class="line">    name = <span class="string">&quot;file.conf&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="11-3-3-å¯åŠ¨"><a href="#11-3-3-å¯åŠ¨" class="headerlink" title="11.3.3 å¯åŠ¨"></a><strong>11.3.3</strong> å¯åŠ¨</h3><h4 id="11-3-3-1-å¯åŠ¨-Nacos-Server-8848"><a href="#11-3-3-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="11.3.3.1 å¯åŠ¨ Nacos Server 8848"></a>11.3.3.1 å¯åŠ¨ Nacos Server 8848</h4><h4 id="11-3-3-2-åŒå‡»-Seata-çš„-bin-seata-server-bat-å¯åŠ¨-Seata-Server"><a href="#11-3-3-2-åŒå‡»-Seata-çš„-bin-seata-server-bat-å¯åŠ¨-Seata-Server" class="headerlink" title="11.3.3.2 åŒå‡» Seata çš„\bin\seata-server.bat , å¯åŠ¨ Seata Server"></a>11.3.3.2 åŒå‡» Seata çš„\bin\seata-server.bat , å¯åŠ¨ Seata Server</h4><p><strong>1.</strong> å¯åŠ¨ <strong>seata-server.bat ,</strong> çœ‹åˆ°å¦‚ä¸‹ç•Œé¢è¯´æ˜æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /Applications/seata/bin</span><br><span class="line">./seata-server.sh -h 127.0.0.1 -p 8848 -m db -n 1 </span><br></pre></td></tr></table></figure><h4 id="11-3-3-3-ç™»å½•-Nacos-Server-æŸ¥çœ‹-Seata-Server-æ˜¯å¦æ³¨å†ŒæˆåŠŸ"><a href="#11-3-3-3-ç™»å½•-Nacos-Server-æŸ¥çœ‹-Seata-Server-æ˜¯å¦æ³¨å†ŒæˆåŠŸ" class="headerlink" title="11.3.3.3 ç™»å½• Nacos Server , æŸ¥çœ‹ Seata Server æ˜¯å¦æ³¨å†ŒæˆåŠŸ"></a>11.3.3.3 ç™»å½• Nacos Server , æŸ¥çœ‹ Seata Server æ˜¯å¦æ³¨å†ŒæˆåŠŸ</h4><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230702162714540.png" alt="image-20230702162714540"></p><h2 id="11-4-Seata-åˆ†å¸ƒå¼äº‹åŠ¡-åº”ç”¨å®ä¾‹"><a href="#11-4-Seata-åˆ†å¸ƒå¼äº‹åŠ¡-åº”ç”¨å®ä¾‹" class="headerlink" title="11.4 Seata åˆ†å¸ƒå¼äº‹åŠ¡-åº”ç”¨å®ä¾‹"></a>11.4 Seata åˆ†å¸ƒå¼äº‹åŠ¡-åº”ç”¨å®ä¾‹</h2><h3 id="11-4-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£"><a href="#11-4-1-éœ€æ±‚åˆ†æ-x2F-å›¾è§£" class="headerlink" title="11.4.1 éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£"></a><strong>11.4.1</strong> éœ€æ±‚åˆ†æ**&#x2F;**å›¾è§£</h3><p><strong>1.</strong> éœ€æ±‚:å®Œæˆä¸‹è®¢å•åŠŸèƒ½ï¼Œç”±ä¸‰ä¸ªå¾®æœåŠ¡æ¨¡å—ååŒå®Œæˆ**,** æ¶‰åŠåˆ°å¤šæ•°æ®åº“**,** å¤šå¼ è¡¨</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230702164527518.png" alt="image-20230702164527518" style="zoom:50%;" /><h3 id="11-4-2-åˆ›å»ºæ•°æ®åº“å’Œè¡¨"><a href="#11-4-2-åˆ›å»ºæ•°æ®åº“å’Œè¡¨" class="headerlink" title="11.4.2 åˆ›å»ºæ•°æ®åº“å’Œè¡¨"></a>11.4.2 åˆ›å»ºæ•°æ®åº“å’Œè¡¨</h3><p><strong>1.</strong> åˆ›å»ºä¸šåŠ¡æ•°æ®åº“å’Œè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è®¢å•å¾®æœåŠ¡çš„æ•°æ®åº“</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE order_micro_service </span><br><span class="line">USE order_micro_service</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">order</span>`(</span><br><span class="line">id <span class="type">BIGINT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">user_id <span class="type">BIGINT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">product_id <span class="type">BIGINT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">nums <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">money <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`status` <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;0:åˆ›å»ºä¸­; 1:å·²å®Œç»“&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `<span class="keyword">order</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åº“å­˜å¾®æœåŠ¡çš„æ•°æ®åº“`storage``order` </span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE storage_micro_service </span><br><span class="line">USE storage_micro_service</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `storage`(</span><br><span class="line">id <span class="type">BIGINT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY, </span><br><span class="line">  product_id <span class="type">BIGINT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">amount <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åº“å­˜é‡&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆå§‹åŒ–åº“å­˜è¡¨</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `storage` <span class="keyword">VALUES</span>(<span class="keyword">NULL</span>, <span class="number">1</span>, <span class="number">10</span>); </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `storage`</span><br><span class="line"><span class="comment">-- è´¦å·å¾®æœåŠ¡çš„æ•°æ®åº“</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE account_micro_service </span><br><span class="line">USE account_micro_service</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `account`(</span><br><span class="line">id <span class="type">BIGINT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY , </span><br><span class="line">  user_id <span class="type">BIGINT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">money <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è´¦æˆ·é‡‘é¢&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆå§‹åŒ–è´¦æˆ·è¡¨</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `account` <span class="keyword">VALUES</span>(<span class="keyword">NULL</span>, <span class="number">666</span>, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure><p><strong>2.</strong> åˆ†åˆ«ä¸º <strong>3</strong> åº“åˆ›å»ºå¯¹åº”çš„å›æ»šæ—¥å¿—è¡¨**,** è¯´æ˜å›æ»šæ—¥å¿—è¡¨åœ¨ <strong>seata</strong> çš„ <strong>\conf\db_undo_log.sql</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">use order_micro_service </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT, </span><br><span class="line">  `branch_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `log_status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`log_created` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `ext` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line"><span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">use storage_micro_service </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT, </span><br><span class="line">  `branch_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `log_status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`log_created` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `ext` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line"><span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">use account_micro_service </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `undo_log` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT, </span><br><span class="line">  `branch_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`xid` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`context` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `rollback_info` longblob <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `log_status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`log_created` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `log_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  `ext` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line"><span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="11-4-3-å¼€å‘-seata-storage-micro-service-10010-å¾®æœåŠ¡"><a href="#11-4-3-å¼€å‘-seata-storage-micro-service-10010-å¾®æœåŠ¡" class="headerlink" title="11.4.3 å¼€å‘ seata_storage_micro_service-10010 å¾®æœåŠ¡"></a>11.4.3 å¼€å‘ seata_storage_micro_service-10010 å¾®æœåŠ¡</h3><p><strong>1.</strong> å‚è€ƒä»¥å‰çš„æ–¹å¼ï¼Œåˆ›å»º <strong>seata_storage_micro_service-10010</strong> å¾®æœåŠ¡æ¨¡å—</p><p><strong>2.</strong> <strong>ä¿®æ”¹</strong> <strong>pom.xml,</strong> <strong>æ·»åŠ ç›¸å…³çš„</strong> <strong>jar</strong> <strong>ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æç¤º application.yml --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¼•å…¥ openfeignï¼Œå› ä¸ºå¯èƒ½éœ€è¦ç”¨åˆ°è¿œç¨‹è°ƒç”¨ --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- åœ¨å¾®æœåŠ¡æ¨¡å—å¼•å…¥ nacos-discovery starter --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--seata--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æ’é™¤è‡ªå¸¦çš„ seata-all --&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å¼•å…¥æŒ‡å®šç‰ˆæœ¬çš„ io.seata --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.seata<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>seata-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å¼•å…¥ e_commerce_center-common-api --&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hspedu.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>e_commerce_center-common-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- è¿™é‡Œæˆ‘ä»¬é‡æ–°æŒ‡å®šä¸€ä¸‹ version --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>3.</strong> <strong>åˆ›å»º</strong> <strong>application.yml,</strong> <strong>è¿›è¡Œç›¸å…³çš„é…ç½®</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">seata_storage_micor_service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">alibaba:</span></span><br><span class="line">      <span class="attr">seata:</span></span><br><span class="line">        <span class="comment">#è‡ªå®šä¹‰äº‹åŠ¡ç»„åç§°éœ€è¦ä¸ seata-server ä¸­çš„å¯¹åº”,çœ‹ \conf\file.conf</span></span><br><span class="line">        <span class="attr">tx-service-group:</span> <span class="string">hspedu_order_tx_group</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#é…ç½® Nacos Server</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/storage_micro_service</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">QWEASDzxc123</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">io:</span></span><br><span class="line">      <span class="attr">seata:</span> <span class="string">info</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure><p><strong>4.</strong> <strong>åˆ›å»º</strong> <strong>file.conf,</strong> <strong>è¿›è¡Œç›¸å…³çš„é…ç½®</strong>, <strong>è¯´æ˜:è¯¥æ–‡ä»¶ä»</strong> <strong>seata</strong> <strong>çš„</strong>\conf\file.conf <strong>æ‹·è´ï¼Œè¿›è¡Œä¿®æ”¹å³å¯</strong></p><p><strong>5.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;entity&#x2F;Storage.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/7/2</span></span><br><span class="line"><span class="comment"> * 20:33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Storage</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line">    <span class="keyword">private</span> Integer amount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>6.</strong> <strong>åˆ›å»º</strong> com&#x2F;hspedu&#x2F;springcloud&#x2F;dao&#x2F;StorageDao.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StorageDao</span> &#123;</span><br><span class="line">    <span class="comment">//æ‰£å‡åº“å­˜ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(<span class="meta">@Param(&quot;productId&quot;)</span> Long productId, <span class="meta">@Param(&quot;nums&quot;)</span> Integer nums)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>7.</strong> <strong>åˆ›å»º</strong> **resources&#x2F;**mapper&#x2F;StorageMapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.hspedu.springcloud.dao.StorageDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.hspedu.springcloud.entity.Storage&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;product_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;productId&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;amount&quot;</span> <span class="attr">property</span>=<span class="string">&quot;amount&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å‡å°‘åº“å­˜ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;reduce&quot;</span>&gt;</span></span><br><span class="line">        UPDATE</span><br><span class="line">            storage</span><br><span class="line">        SET</span><br><span class="line">            amount = amount - #&#123;nums&#125;</span><br><span class="line">        WHERE</span><br><span class="line">            product_id = #&#123;productId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>8.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;StorageService.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StorageService</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰£å‡åº“å­˜</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Long productId, Integer nums)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>9.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;impl&#x2F;StorageServiceImpl.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StorageServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">StorageService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    private static final Logger LOGGER = LoggerFactory.getLogger(StorageServiceImpl.class);</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StorageDao storageDao;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Long productId, Integer nums)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;==========seata_storage_micro_service-10010 æ‰£ å‡ åº“ å­˜ start==========&quot;</span>);</span><br><span class="line">        storageDao.reduce(productId, nums);</span><br><span class="line">        log.info(<span class="string">&quot;==========seata_storage_micro_service-10010 æ‰£ å‡ åº“ å­˜ end==========&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>10.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;StorageController.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StorageController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StorageService storageService;</span><br><span class="line">    <span class="comment">//æ‰£å‡åº“å­˜</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/storage/reduce&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">reduce</span><span class="params">(Long productId, Integer nums)</span> &#123;</span><br><span class="line">        storageService.reduce(productId, nums);</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;æ‰£å‡åº“å­˜æˆåŠŸ ok&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>11.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;MyBatisConfig.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&#123;&quot;com.hspedu.springcloud.dao&quot;&#125;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>12.</strong> <strong>åˆ›å»ºcom&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;DataSourceProxyConfig.java ,å¸¸è§„é…ç½®(æ‹¿æ¥ä½¿ç”¨å³å¯)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> io.seata.rm.datasource.DataSourceProxy;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.transaction.SpringManagedTransactionFactory; <span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/7/3</span></span><br><span class="line"><span class="comment"> * 11:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProxyConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;mybatis.mapperLocations&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mapperLocations;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druidDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceProxy <span class="title function_">dataSourceProxy</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceProxy</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSourceProxy dataSourceProxy)</span></span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>(); sqlSessionFactoryBean.setDataSource(dataSourceProxy);</span><br><span class="line">                sqlSessionFactoryBean.setMapperLocations(<span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>().getResources(mapperLocations));</span><br><span class="line">        sqlSessionFactoryBean.setTransactionFactory(<span class="keyword">new</span> <span class="title class_">SpringManagedTransactionFactory</span>()); <span class="keyword">return</span> sqlSessionFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>13.</strong> <strong>åˆ› å»º ä¸» å¯ åŠ¨ ç±»</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;SeataStorageMicroServiceApplication10010.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.study.springcloud;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æµ¦åŸ</span></span><br><span class="line"><span class="comment"> * 2023/7/3</span></span><br><span class="line"><span class="comment"> * 12:24</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeataStorageMicroServiceApplication10010</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SeataStorageMicroServiceApplication10010.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="11-4-4-æµ‹è¯•-seata-storage-micro-service-10010-å¾®æœåŠ¡"><a href="#11-4-4-æµ‹è¯•-seata-storage-micro-service-10010-å¾®æœåŠ¡" class="headerlink" title="11.4.4 æµ‹è¯• seata_storage_micro_service-10010 å¾®æœåŠ¡"></a><strong>11.4.4</strong> æµ‹è¯• <strong>seata_storage_micro_service-10010</strong> å¾®æœåŠ¡</h3><h4 id="11-4-4-1-å¯åŠ¨-Nacos-Server-8848"><a href="#11-4-4-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="11.4.4.1 å¯åŠ¨ Nacos Server 8848"></a>11.4.4.1 å¯åŠ¨ Nacos Server 8848</h4><h4 id="11-4-4-2-åŒå‡»-Seata-çš„-bin-seata-server-bat-å¯åŠ¨-Seata-Server"><a href="#11-4-4-2-åŒå‡»-Seata-çš„-bin-seata-server-bat-å¯åŠ¨-Seata-Server" class="headerlink" title="11.4.4.2 åŒå‡» Seata çš„\bin\seata-server.bat , å¯åŠ¨ Seata Server"></a>11.4.4.2 åŒå‡» Seata çš„\bin\seata-server.bat , å¯åŠ¨ Seata Server</h4><h4 id="11-4-4-3-å¯åŠ¨-seata-storage-micro-service-10010"><a href="#11-4-4-3-å¯åŠ¨-seata-storage-micro-service-10010" class="headerlink" title="11.4.4.3 å¯åŠ¨ seata_storage_micro_service-10010"></a>11.4.4.3 å¯åŠ¨ seata_storage_micro_service-10010</h4><h4 id="11-4-4-4-ç™»å½•-Nacos-Server-æŸ¥çœ‹-10010-å¾®æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ"><a href="#11-4-4-4-ç™»å½•-Nacos-Server-æŸ¥çœ‹-10010-å¾®æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ" class="headerlink" title="11.4.4.4 ç™»å½• Nacos Server , æŸ¥çœ‹ 10010 å¾®æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ"></a>11.4.4.4 ç™»å½• Nacos Server , æŸ¥çœ‹ 10010 å¾®æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ</h4><p><strong>1.</strong> ç™»å½• <strong>Nacos Server,</strong> æŸ¥çœ‹ <strong>10010</strong> æ˜¯å¦æ³¨å†ŒæˆåŠŸ</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703125536604.png" alt="image-20230703125536604"></p><h3 id="11-4-5-å¼€å‘-seata-account-micro-service-10012-å¾®æœåŠ¡"><a href="#11-4-5-å¼€å‘-seata-account-micro-service-10012-å¾®æœåŠ¡" class="headerlink" title="11.4.5 å¼€å‘ seata_account_micro_service-10012 å¾®æœåŠ¡"></a><strong>11.4.5</strong> å¼€å‘ <strong>seata_account_micro_service-10012</strong> å¾®æœåŠ¡</h3><p>(accountæ¨¡å—ï¼Œå‚ç…§ä¸Šé¢storageæ¨¡å—çš„åˆ›å»ºè¿‡ç¨‹å³å¯)</p><p><strong>1.</strong> å‚è€ƒä»¥å‰çš„æ–¹å¼ï¼Œåˆ›å»º <strong>seata_account_micro_service-10012</strong> å¾®æœåŠ¡æ¨¡å—</p><p><strong>2.</strong> <strong>ä¿®æ”¹</strong> <strong>pom.xml,</strong> <strong>æ·»åŠ ç›¸å…³çš„</strong> <strong>jar</strong> <strong>ä¾èµ–</strong></p><p><strong>3.</strong> <strong>åˆ›å»º</strong> <strong>application.yml,</strong> <strong>è¿›è¡Œç›¸å…³çš„é…ç½®</strong></p><p><strong>4.1</strong> <strong>åˆ›å»º</strong> <strong>file.conf,</strong> <strong>è¿›è¡Œç›¸å…³çš„é…ç½®</strong>, <strong>è¯´æ˜:è¯¥æ–‡ä»¶ä»</strong> <strong>seata</strong> <strong>çš„</strong>\conf\file.conf <strong>æ‹·è´ï¼Œè¿›è¡Œä¿® æ”¹å³å¯</strong></p><p><strong>4.2</strong> <strong>åˆ›å»º</strong> <strong>registry.conf,</strong> <strong>è¿›è¡Œç›¸å…³çš„é…ç½®</strong>, <strong>è¯´æ˜:è¯¥æ–‡ä»¶ä»</strong> <strong>seata</strong> <strong>çš„</strong>\conf\registry.conf <strong>æ‹·è´ï¼Œ è¿›è¡Œä¿®æ”¹å³å¯</strong></p><p><strong>5.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;entity&#x2F;Account.java</strong></p><p><strong>6.</strong> <strong>åˆ›å»º</strong> com&#x2F;hspedu&#x2F;springcloud&#x2F;dao&#x2F;AccountDao.java</p><p><strong>7.</strong> <strong>åˆ›å»º</strong> **resources&#x2F;**mapper&#x2F;AccountMapper.xml</p><p><strong>8.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;AccountService.java</strong></p><p><strong>9.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;impl&#x2F;AccountServiceImpl.java</strong></p><p><strong>10.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;AccountController.java</strong></p><p><strong>11.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;MyBatisConfig.java</strong></p><p><strong>12.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;DataSourceProxyConfig.java ,</strong> <strong>å¸¸è§„é…ç½®</strong>(æ‹¿æ¥ä½¿ç”¨å³å¯)</p><p><strong>13.</strong> <strong>åˆ› å»º ä¸» å¯ åŠ¨ ç±»</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;SeataAccountMicroServiceApplication10012.java</strong></p><h3 id="11-4-6-æµ‹è¯•-seata-account-micro-service-10012-å¾®æœåŠ¡"><a href="#11-4-6-æµ‹è¯•-seata-account-micro-service-10012-å¾®æœåŠ¡" class="headerlink" title="11.4.6 æµ‹è¯• seata_account_micro_service-10012 å¾®æœåŠ¡"></a><strong>11.4.6</strong> æµ‹è¯• <strong>seata_account_micro_service-10012</strong> å¾®æœåŠ¡</h3><h4 id="11-4-6-1-å¯åŠ¨-Nacos-Server-8848"><a href="#11-4-6-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="11.4.6.1 å¯åŠ¨ Nacos Server 8848"></a>11.4.6.1 å¯åŠ¨ Nacos Server 8848</h4><h4 id="11-4-6-2-åŒå‡»-Seata-çš„-bin-seata-server-bat-å¯åŠ¨-Seata-Server"><a href="#11-4-6-2-åŒå‡»-Seata-çš„-bin-seata-server-bat-å¯åŠ¨-Seata-Server" class="headerlink" title="11.4.6.2 åŒå‡» Seata çš„\bin\seata-server.bat , å¯åŠ¨ Seata Server"></a>11.4.6.2 åŒå‡» Seata çš„\bin\seata-server.bat , å¯åŠ¨ Seata Server</h4><h4 id="11-4-6-3-å¯åŠ¨-seata-account-micro-service-10012"><a href="#11-4-6-3-å¯åŠ¨-seata-account-micro-service-10012" class="headerlink" title="11.4.6.3 å¯åŠ¨ seata_account_micro_service-10012"></a>11.4.6.3 å¯åŠ¨ seata_account_micro_service-10012</h4><h4 id="11-4-6-4-ç™»å½•-Nacos-Server-æŸ¥çœ‹-10012-å¾®æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ"><a href="#11-4-6-4-ç™»å½•-Nacos-Server-æŸ¥çœ‹-10012-å¾®æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ" class="headerlink" title="11.4.6.4 ç™»å½• Nacos Server , æŸ¥çœ‹ 10012 å¾®æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ"></a>11.4.6.4 ç™»å½• Nacos Server , æŸ¥çœ‹ 10012 å¾®æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ</h4><p><strong>1.</strong> ç™»å½• <strong>Nacos Server,</strong> æŸ¥çœ‹ <strong>10012</strong> æ˜¯å¦æ³¨å†ŒæˆåŠŸ</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703143135194.png" alt="image-20230703143135194"></p><p><strong>11.4.7</strong> å¼€å‘ <strong>seata-order-micro-service-10008</strong> å¾®æœåŠ¡</p><p>(Orderæ¨¡å—ï¼Œå‚ç…§ä¸Šé¢storageæ¨¡å—çš„åˆ›å»ºè¿‡ç¨‹å³å¯)</p><p><strong>1.</strong> å‚è€ƒä»¥å‰çš„æ–¹å¼ï¼Œåˆ›å»º <strong>seata-order-micro-service-10008</strong> å¾®æœåŠ¡æ¨¡å—</p><p><strong>2.</strong> <strong>ä¿®æ”¹</strong> <strong>pom.xml,</strong> <strong>æ·»åŠ ç›¸å…³çš„</strong> <strong>jar</strong> <strong>ä¾èµ–</strong></p><p><strong>3.</strong> <strong>åˆ›å»º</strong> <strong>application.yml,</strong> <strong>è¿›è¡Œç›¸å…³çš„é…ç½®</strong></p><p><strong>4.1</strong> <strong>åˆ›å»º</strong> <strong>file.conf,</strong> <strong>è¿›è¡Œç›¸å…³çš„é…ç½®</strong>, <strong>è¯´æ˜:è¯¥æ–‡ä»¶ä»</strong> <strong>seata</strong> <strong>çš„</strong>\conf\file.conf <strong>æ‹·è´ï¼Œè¿›è¡Œä¿® æ”¹å³å¯</strong></p><p><strong>4.2</strong> <strong>åˆ›å»º</strong> <strong>registry.conf,</strong> <strong>è¿›è¡Œç›¸å…³çš„é…ç½®</strong>, <strong>è¯´æ˜:è¯¥æ–‡ä»¶ä»</strong> <strong>seata</strong> <strong>çš„</strong>\conf\registry.conf <strong>æ‹·è´ï¼Œ è¿›è¡Œä¿®æ”¹å³å¯</strong></p><p><strong>5.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;entity&#x2F;Order.java</strong></p><p><strong>6.</strong> <strong>åˆ›å»º</strong> com&#x2F;hspedu&#x2F;springcloud&#x2F;dao&#x2F;OrderDao.java</p><p><strong>7.</strong> <strong>åˆ›å»º</strong> **resources&#x2F;**mapper&#x2F;OrderMapper.xml</p><p><strong>8.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;OrderService.java</strong></p><p><strong>9.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;AccountService.java</strong></p><p><strong>10.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;service&#x2F;impl&#x2F;OrderServiceImpl.java</strong></p><p><strong>11.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;OrderController.java</strong></p><p><strong>12.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;MyBatisConfig.java</strong></p><p><strong>13.</strong> <strong>åˆ›å»º</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;config&#x2F;DataSourceProxyConfig.java ,</strong> <strong>å¸¸è§„é…ç½®</strong>(æ‹¿æ¥ä½¿ç”¨å³å¯)</p><p><strong>14.</strong> <strong>åˆ› å»º ä¸» å¯ åŠ¨ ç±»</strong> <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;SeataOrderMicroServiceApplication10008.java</strong></p><h3 id="11-4-8-æµ‹è¯•-seata-order-micro-service-10008-å¾®æœåŠ¡"><a href="#11-4-8-æµ‹è¯•-seata-order-micro-service-10008-å¾®æœåŠ¡" class="headerlink" title="11.4.8 æµ‹è¯• seata-order-micro-service-10008 å¾®æœåŠ¡"></a><strong>11.4.8</strong> æµ‹è¯• <strong>seata-order-micro-service-10008</strong> å¾®æœåŠ¡</h3><p>â€¦â€¦</p><h3 id="11-4-9-é›†æˆæµ‹è¯•-1-ä¸‰ä¸ªå¾®æœåŠ¡ååŒå®Œæˆ-æ­£å¸¸ä¸‹å•"><a href="#11-4-9-é›†æˆæµ‹è¯•-1-ä¸‰ä¸ªå¾®æœåŠ¡ååŒå®Œæˆ-æ­£å¸¸ä¸‹å•" class="headerlink" title="11.4.9 é›†æˆæµ‹è¯•**(1)** ä¸‰ä¸ªå¾®æœåŠ¡ååŒå®Œæˆ**-**æ­£å¸¸ä¸‹å•"></a><strong>11.4.9</strong> é›†æˆæµ‹è¯•**(1)** ä¸‰ä¸ªå¾®æœåŠ¡ååŒå®Œæˆ**-**æ­£å¸¸ä¸‹å•</h3><h4 id="11-4-9-1-å¯åŠ¨-Nacos-Server-8848"><a href="#11-4-9-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="11.4.9.1 å¯åŠ¨ Nacos Server 8848"></a>11.4.9.1 å¯åŠ¨ Nacos Server 8848</h4><h4 id="11-4-9-2-åŒå‡»-Seata-çš„-bin-seata-server-bat-å¯åŠ¨-Seata-Server"><a href="#11-4-9-2-åŒå‡»-Seata-çš„-bin-seata-server-bat-å¯åŠ¨-Seata-Server" class="headerlink" title="11.4.9.2 åŒå‡» Seata çš„\bin\seata-server.bat , å¯åŠ¨ Seata Server"></a>11.4.9.2 åŒå‡» Seata çš„\bin\seata-server.bat , å¯åŠ¨ Seata Server</h4><h4 id="11-4-9-3-å¯åŠ¨-seata-order-micro-service-10010-x2F-10012-x2F-10008-ä¸‰ä¸ªå¾®æœåŠ¡"><a href="#11-4-9-3-å¯åŠ¨-seata-order-micro-service-10010-x2F-10012-x2F-10008-ä¸‰ä¸ªå¾®æœåŠ¡" class="headerlink" title="11.4.9.3 å¯åŠ¨ seata-order-micro-service-10010 &#x2F;10012&#x2F;10008 ä¸‰ä¸ªå¾®æœåŠ¡"></a>11.4.9.3 å¯åŠ¨ seata-order-micro-service-10010 &#x2F;10012&#x2F;10008 ä¸‰ä¸ªå¾®æœåŠ¡</h4><h4 id="11-4-9-4-æµè§ˆå™¨-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100"><a href="#11-4-9-4-æµè§ˆå™¨-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100" class="headerlink" title="11.4.9.4 æµè§ˆå™¨ : http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100"></a>11.4.9.4 æµè§ˆå™¨ : <a href="http://localhost:10008/order/save?userId=666&productId=1&nums=1&money=100">http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100</a></h4><p><strong>1.</strong> æµ è§ˆ å™¨ <strong>: <a href="http://localhost:10008/order/save?userId=666&productId=1&nums=1&money=100">http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100</a></strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703143712667.png" alt="image-20230703143712667"></p><p><strong>2.</strong> <strong>æŸ¥çœ‹æ•°æ®åº“&#x2F;è¡¨çš„æƒ…å†µæ˜¯å¦æ­£å¸¸,ç»“è®º:å¦‚æœæ²¡æœ‰å¼‚å¸¸å‡ºç°ï¼Œæ­£å¸¸ä¸‹å•ï¼Œæ•°æ®åº“ä¸‰å¼ è¡¨ æ•°æ®ä¸€è‡´æ€§æ˜¯OKçš„</strong></p><h4 id="11-4-9-5-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#11-4-9-5-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="11.4.9.5 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a>11.4.9.5 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h4><p><strong>1. MySQL</strong> å‡ºç° <strong>too many connections</strong>(<strong>1040</strong>)é”™è¯¯è§£å†³æ–¹æ³•ï¼š</p><p>åœ¨ <strong>my.ini</strong> è®¾ç½® </p><p><strong>max_connections&#x3D;1000</strong></p><p><strong>2.</strong> å¦‚æœå‡ºç°**: service id not legal hostname<br>** æŠ¥é”™ <strong>Service id not legal hostname</strong> çš„åŸå› æ˜¯æœåŠ¡åç§°ä¸èƒ½å¸¦æœ‰ä¸‹åˆ’çº¿ï¼Œå¯ä»¥ä½¿ç”¨ä¸­åˆ’çº¿**,**</p><p><strong>springcloud</strong> æ— æ³•è¯†åˆ«ä¸‹åˆ’çº¿ï¼ŒæŠŠä¸‹åˆ’çº¿æ”¹æˆä¸­åˆ’çº¿å°±å¥½</p><h3 id="11-4-10-é›†æˆæµ‹è¯•-2-ä¸‰ä¸ªå¾®æœåŠ¡ååŒå®Œæˆ-æ¨¡æ‹Ÿå¼‚å¸¸"><a href="#11-4-10-é›†æˆæµ‹è¯•-2-ä¸‰ä¸ªå¾®æœåŠ¡ååŒå®Œæˆ-æ¨¡æ‹Ÿå¼‚å¸¸" class="headerlink" title="11.4.10 é›†æˆæµ‹è¯•**(2)** ä¸‰ä¸ªå¾®æœåŠ¡ååŒå®Œæˆ**-**æ¨¡æ‹Ÿå¼‚å¸¸"></a><strong>11.4.10</strong> é›†æˆæµ‹è¯•**(2)** ä¸‰ä¸ªå¾®æœåŠ¡ååŒå®Œæˆ**-**æ¨¡æ‹Ÿå¼‚å¸¸</h3><h4 id="11-4-10-1-å¯åŠ¨-Nacos-Server-8848"><a href="#11-4-10-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="11.4.10.1 å¯åŠ¨ Nacos Server 8848"></a>11.4.10.1 å¯åŠ¨ Nacos Server 8848</h4><h4 id="11-4-10-2-åŒå‡»-Seata-çš„-bin-seata-server-bat-å¯åŠ¨-Seata-Server"><a href="#11-4-10-2-åŒå‡»-Seata-çš„-bin-seata-server-bat-å¯åŠ¨-Seata-Server" class="headerlink" title="11.4.10.2 åŒå‡» Seata çš„\bin\seata-server.bat , å¯åŠ¨ Seata Server"></a>11.4.10.2 åŒå‡» Seata çš„\bin\seata-server.bat , å¯åŠ¨ Seata Server</h4><h4 id="11-4-10-3-å¯åŠ¨-seata-order-micro-service-100010-x2F-10012-x2F-10008-ä¸‰ä¸ªå¾®æœåŠ¡"><a href="#11-4-10-3-å¯åŠ¨-seata-order-micro-service-100010-x2F-10012-x2F-10008-ä¸‰ä¸ªå¾®æœåŠ¡" class="headerlink" title="11.4.10.3 å¯åŠ¨ seata-order-micro-service-100010 &#x2F;10012&#x2F;10008 ä¸‰ä¸ªå¾®æœåŠ¡"></a>11.4.10.3 å¯åŠ¨ seata-order-micro-service-100010 &#x2F;10012&#x2F;10008 ä¸‰ä¸ªå¾®æœåŠ¡</h4><h4 id="11-4-10-4-æµè§ˆå™¨-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100"><a href="#11-4-10-4-æµè§ˆå™¨-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100" class="headerlink" title="11.4.10.4 æµè§ˆå™¨ : http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100"></a>11.4.10.4 æµè§ˆå™¨ : <a href="http://localhost:10008/order/save?userId=666&productId=1&nums=1&money=100">http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100</a></h4><p><strong>1.</strong> ä¿® æ”¹ <strong>seata_account_micro_service-10012</strong> çš„<strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;AccountController.java</strong>ï¼Œ æ¨¡æ‹Ÿå¼‚å¸¸å‡ºç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/account/reduce&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">result</span><span class="params">(<span class="meta">@RequestParam(&quot;userId&quot;)</span> Long userId, <span class="meta">@RequestParam(&quot;money&quot;)</span> Integer money)</span>&#123;</span><br><span class="line"><span class="comment">//æ¨¡æ‹Ÿå¼‚å¸¸, è¶…æ—¶</span></span><br><span class="line"><span class="comment">//openfeign æ¥å£è°ƒç”¨é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 1s try &#123;</span></span><br><span class="line">TimeUnit.SECONDS.sleep(<span class="number">12</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace(); &#125;</span><br><span class="line">accountService.reduce(userId,money);</span><br><span class="line"><span class="keyword">return</span> Result.success(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;æ‰£å‡è´¦æˆ·ä½™é¢ OK&quot;</span>); &#125;</span><br></pre></td></tr></table></figure><p><strong>2.</strong> <strong>æµ è§ˆ å™¨</strong> <strong>: <a href="http://localhost:10008/order/save?userId=666&productId=1&nums=1&money=100">http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100</a></strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703143951841.png" alt="image-20230703143951841"></p><p><strong>3.</strong> <strong>æŸ¥çœ‹æ•°æ®åº“&#x2F;è¡¨çš„æƒ…å†µæ˜¯å¦æ­£å¸¸</strong></p><p><strong>ç»“è®º</strong>:è¿™æ—¶æ•°æ®åº“&#x2F;è¡¨ï¼Œå‡ºç°æ•°æ®ä¸ä¸€è‡´ç°è±¡, è®¢å•æ˜¯<u>æœªæ”¯ä»˜</u>ï¼Œä½†æ˜¯<u>åº“å­˜å‡å°‘äº†</u>ï¼Œè´¦å·<u>é’±ä¹Ÿæ‰£äº†</u>(æç¤º:ç­‰ä¼‘çœ æ—¶é—´å®Œæˆåï¼Œå†æŸ¥çœ‹accountè¡¨ï¼Œä¼šçœ‹åˆ°æ•°æ®ä¸ä¸€è‡´)</p><h3 id="11-4-11-é›†æˆæµ‹è¯•-3-ä¸‰ä¸ªå¾®æœåŠ¡ååŒå®Œæˆ-ä½¿ç”¨-GlobalTransactional-å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶-å‡ºç°å¼‚å¸¸ï¼Œä¹Ÿèƒ½ä¿è¯æ•°æ®ä¸€è‡´æ€§"><a href="#11-4-11-é›†æˆæµ‹è¯•-3-ä¸‰ä¸ªå¾®æœåŠ¡ååŒå®Œæˆ-ä½¿ç”¨-GlobalTransactional-å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶-å‡ºç°å¼‚å¸¸ï¼Œä¹Ÿèƒ½ä¿è¯æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="11.4.11 é›†æˆæµ‹è¯•**(3)** ä¸‰ä¸ªå¾®æœåŠ¡ååŒå®Œæˆ**-ä½¿ç”¨@GlobalTransactional** å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶(å‡ºç°å¼‚å¸¸ï¼Œä¹Ÿèƒ½ä¿è¯æ•°æ®ä¸€è‡´æ€§)"></a><strong>11.4.11</strong> é›†æˆæµ‹è¯•**(3)** ä¸‰ä¸ªå¾®æœåŠ¡ååŒå®Œæˆ**-<strong>ä½¿ç”¨</strong>@GlobalTransactional** å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶(å‡ºç°å¼‚å¸¸ï¼Œä¹Ÿèƒ½ä¿è¯æ•°æ®ä¸€è‡´æ€§)</h3><h4 id="11-4-11-1-å¯åŠ¨-Nacos-Server-8848"><a href="#11-4-11-1-å¯åŠ¨-Nacos-Server-8848" class="headerlink" title="11.4.11.1 å¯åŠ¨ Nacos Server 8848"></a>11.4.11.1 å¯åŠ¨ Nacos Server 8848</h4><h4 id="11-4-11-2-åŒå‡»-Seata-çš„-bin-seata-server-bat-å¯åŠ¨-Seata-Server"><a href="#11-4-11-2-åŒå‡»-Seata-çš„-bin-seata-server-bat-å¯åŠ¨-Seata-Server" class="headerlink" title="11.4.11.2 åŒå‡» Seata çš„\bin\seata-server.bat , å¯åŠ¨ Seata Server"></a>11.4.11.2 åŒå‡» Seata çš„\bin\seata-server.bat , å¯åŠ¨ Seata Server</h4><h4 id="11-4-11-3-å¯åŠ¨-seata-order-micro-service-10008-x2F-10010-x2F-10012-ä¸‰ä¸ªå¾®æœåŠ¡"><a href="#11-4-11-3-å¯åŠ¨-seata-order-micro-service-10008-x2F-10010-x2F-10012-ä¸‰ä¸ªå¾®æœåŠ¡" class="headerlink" title="11.4.11.3 å¯åŠ¨ seata-order-micro-service-10008 &#x2F;10010&#x2F;10012 ä¸‰ä¸ªå¾®æœåŠ¡"></a>11.4.11.3 å¯åŠ¨ seata-order-micro-service-10008 &#x2F;10010&#x2F;10012 ä¸‰ä¸ªå¾®æœåŠ¡</h4><h4 id="11-4-11-4-æµè§ˆå™¨-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100"><a href="#11-4-11-4-æµè§ˆå™¨-http-localhost-10008-order-save-userId-666-amp-productId-1-amp-nums-1-amp-money-100" class="headerlink" title="11.4.11.4 æµè§ˆå™¨ : http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100"></a>11.4.11.4 æµè§ˆå™¨ : <a href="http://localhost:10008/order/save?userId=666&productId=1&nums=1&money=100">http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100</a></h4><p><strong>1.</strong> ä¿® æ”¹ <strong>seata_account_micro_service-10012</strong> çš„ <strong>com&#x2F;hspedu&#x2F;springcloud&#x2F;controller&#x2F;AccountController.java</strong>ï¼Œ æ¨¡æ‹Ÿå¼‚å¸¸å‡ºç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">AccountService accountService; </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ‰£å‡è´¦æˆ·ä½™é¢</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/account/reduce&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">result</span><span class="params">(<span class="meta">@RequestParam(&quot;userId&quot;)</span> Long userId, <span class="meta">@RequestParam(&quot;money&quot;)</span> Integer money)</span>&#123;</span><br><span class="line"><span class="comment">//æ¨¡æ‹Ÿå¼‚å¸¸, è¶…æ—¶ï¼Œæˆ–è€… int i = 9 / 0; </span></span><br><span class="line">  <span class="comment">//openfeign æ¥å£è°ƒç”¨é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 1s</span></span><br><span class="line">  <span class="comment">//è¯´æ˜ 1. ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒæ–¹å¼æ¨¡æ‹Ÿå¼‚å¸¸, ä½†åœ¨ Debug çœ‹ Seata åˆ†å¸ƒå¼äº‹åŠ¡æœºåˆ¶ä¸æ–¹ä¾¿, ä¸å¥½çœ‹æ•ˆæœ , æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨è¶…æ—¶å¼‚å¸¸</span></span><br><span class="line"><span class="comment">//è¯´æ˜ 2. å› ä¸ºæ˜¯è¶…æ—¶å¼‚å¸¸, æ‰€ä»¥åœ¨ Debug åˆ†æ Seata æœºåˆ¶æ—¶, å¯èƒ½ä¼šå‘ç°æŸå¼ è¡¨ è¢«é”å‡ æ¡è®°å½•, å› ä¸º seata ä¼šåšæœ€ç»ˆä¸€è‡´æ€§æ“ä½œ(å³å°è¯•å†æäº¤ä¸Šæ¬¡è¶…æ—¶çš„äº‹åŠ¡).</span></span><br><span class="line"><span class="keyword">try</span> &#123; </span><br><span class="line">    TimeUnit.SECONDS.sleep(<span class="number">12</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123; </span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">accountService.reduce(userId,money);</span><br><span class="line"><span class="keyword">return</span> Result.success(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;æ‰£å‡è´¦æˆ·ä½™é¢ OK&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**2.**ä¿® æ”¹ <strong>seata-order-micro-service-10008</strong> <strong>çš„</strong>com&#x2F;study&#x2F;springcloud&#x2F;service&#x2F;impl&#x2F;OrderServicelmpl.java</p><p><strong>ä½¿ç”¨<u>@GlobalTransactional</u>æ§åˆ¶åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* åˆ›å»ºè®¢å•-&gt;è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜-&gt;è°ƒç”¨è´¦æˆ·æœåŠ¡æ‰£å‡è´¦æˆ·ä½™é¢-&gt;ä¿®æ”¹è®¢å•çŠ¶æ€ </span></span><br><span class="line"><span class="comment">* è§£è¯»</span></span><br><span class="line"><span class="comment">* 1. <span class="doctag">@GlobalTransactional</span>: åˆ†å¸ƒå¼å…¨å±€äº‹åŠ¡æ§åˆ¶</span></span><br><span class="line"><span class="comment">* 2. name = &quot;hspedu-save-order&quot; åç§°è‡ªå·±å†™ï¼Œä¿è¯å”¯ä¸€å³å¯</span></span><br><span class="line"><span class="comment">* 3. rollbackFor = Exception.class æŒ‡å®šå‘ç”Ÿä»€ä¹ˆå¼‚å¸¸å°±å›æ»šï¼Œ</span></span><br><span class="line"><span class="comment">* è¿™é‡ŒæŒ‡å®šåªè¦å‘ç”Ÿå¼‚å¸¸å°±å›æ»š</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="comment">//ä¸‹é¢è¿™å¥è¯æ˜¯åšå…¨å±€äº‹åŠ¡æ§åˆ¶çš„, å¦‚æœæ²¡æœ‰ï¼Œåˆ™æ²¡æœ‰åˆ†å¸ƒå¼å…¨å±€äº‹åŠ¡æ§åˆ¶ </span></span><br><span class="line"><span class="meta">@GlobalTransactional(name = &quot;hspedu-save-order&quot;, rollbackFor = Exception.class)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">log.info(<span class="string">&quot;=========å¼€å§‹æ–°å»ºè®¢å• start ==========&quot;</span>); </span><br><span class="line">  <span class="comment">//æ–°å»ºè®¢å•</span></span><br><span class="line">orderDao.save(order);</span><br><span class="line">System.out.println(<span class="string">&quot;order=&quot;</span> + order); </span><br><span class="line">  log.info(<span class="string">&quot;=========å‡åº“å­˜ start ==========&quot;</span>); </span><br><span class="line">  storageService.reduce(order.getProductId(), order.getNums()); </span><br><span class="line">  log.info(<span class="string">&quot;=========å‡åº“å­˜ end ==========&quot;</span>);</span><br><span class="line">log.info(<span class="string">&quot;=========å‡è´¦æˆ·é‡‘é¢ start ==========&quot;</span>); </span><br><span class="line">  accountService.reduce(order.getUserId(), order.getMoney()); </span><br><span class="line">  log.info(<span class="string">&quot;=========å‡è´¦æˆ·é‡‘é¢ end ==========&quot;</span>);</span><br><span class="line">log.info(<span class="string">&quot;=========ä¿®æ”¹è®¢å•çŠ¶æ€ start ==========&quot;</span>); </span><br><span class="line">  orderDao.update(order.getUserId(), <span class="number">0</span>); </span><br><span class="line">  log.info(<span class="string">&quot;=========ä¿®æ”¹è®¢å•çŠ¶æ€ end ==========&quot;</span>); </span><br><span class="line">  log.info(<span class="string">&quot;=========ä¸‹è®¢å• end==========&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>3.</strong> <strong>é‡å¯</strong> <strong>seata-order-micro-service-10008</strong></p><p><strong>4.</strong> <strong>æµ è§ˆ å™¨</strong> <strong>: <a href="http://localhost:10008/order/save?userId=666&productId=1&nums=1&money=100">http://localhost:10008/order/save?userId=666&amp;productId=1&amp;nums=1&amp;money=100</a></strong></p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230703143951841.png" alt="image-20230703143951841"></p><p><strong>5.</strong> æŸ¥çœ‹æ•°æ®åº“&#x2F;è¡¨çš„æƒ…å†µæ˜¯å¦æ­£å¸¸, ç»“è®º:è¿™æ—¶æ•°æ®åº“&#x2F;è¡¨ï¼Œæ•°æ®ä¸ä¸€è‡´æ€§å¾—åˆ°ä¿è¯.</p><h3 id="11-4-12-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"><a href="#11-4-12-æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚" class="headerlink" title="11.4.12 æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚"></a><strong>11.4.12</strong> æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚</h3><h4 id="11-4-12-1-å¦‚æœæ•°æ®åº“-x2F-è¡¨ä½¿ç”¨åˆ°å…³é”®å­—ï¼Œéœ€è¦ä½¿ç”¨åå¼•å·"><a href="#11-4-12-1-å¦‚æœæ•°æ®åº“-x2F-è¡¨ä½¿ç”¨åˆ°å…³é”®å­—ï¼Œéœ€è¦ä½¿ç”¨åå¼•å·" class="headerlink" title="11.4.12.1 å¦‚æœæ•°æ®åº“&#x2F;è¡¨ä½¿ç”¨åˆ°å…³é”®å­—ï¼Œéœ€è¦ä½¿ç”¨åå¼•å·"></a>11.4.12.1 å¦‚æœæ•°æ®åº“&#x2F;è¡¨ä½¿ç”¨åˆ°å…³é”®å­—ï¼Œéœ€è¦ä½¿ç”¨åå¼•å·</h4><ul><li>ä¸¾ä¾‹è¯´æ˜**:** æ¯”å¦‚<strong>mapper&#x2F;OrderMapper.xml ,</strong> è¿™é‡Œçš„ <strong>order</strong> å°±è¦ä½¿ç”¨**&#96;&#96;,** å¦åˆ™ä¼šæŠ¥é”™</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;save&quot;</span>&gt;</span></span><br><span class="line">insert into `order` (id,user_id,product_id,nums,money,status) </span><br><span class="line">  values (null,#&#123;userId&#125;,#&#123;productId&#125;,#&#123;nums&#125;,#&#123;money&#125;,0);</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">update `order` set status = 1</span><br><span class="line">where user_id=#&#123;userId&#125; and status = #&#123;status&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="11-4-12-2-openfeignåœ¨è¿œç¨‹è°ƒç”¨apiæ¥å£æ—¶ï¼Œé»˜è®¤è¶…æ—¶æ—¶é—´ä¸º1s"><a href="#11-4-12-2-openfeignåœ¨è¿œç¨‹è°ƒç”¨apiæ¥å£æ—¶ï¼Œé»˜è®¤è¶…æ—¶æ—¶é—´ä¸º1s" class="headerlink" title="11.4.12.2 openfeignåœ¨è¿œç¨‹è°ƒç”¨apiæ¥å£æ—¶ï¼Œé»˜è®¤è¶…æ—¶æ—¶é—´ä¸º1s"></a>11.4.12.2 openfeignåœ¨è¿œç¨‹è°ƒç”¨apiæ¥å£æ—¶ï¼Œé»˜è®¤è¶…æ—¶æ—¶é—´ä¸º1s</h4>]]></content>
      
      
      <categories>
          
          <category> Springå¼€å‘æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo å†™æ–‡ç« æ­¥éª¤</title>
      <link href="/2023/06/02/hexo-%E5%86%99%E6%96%87%E7%AB%A0%E6%AD%A5%E9%AA%A4/"/>
      <url>/2023/06/02/hexo-%E5%86%99%E6%96%87%E7%AB%A0%E6%AD%A5%E9%AA%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="hexoæ­å»ºåšå®¢é…ç½®æ³¨æ„äº‹é¡¹ï¼š"><a href="#hexoæ­å»ºåšå®¢é…ç½®æ³¨æ„äº‹é¡¹ï¼š" class="headerlink" title="hexoæ­å»ºåšå®¢é…ç½®æ³¨æ„äº‹é¡¹ï¼š"></a>hexoæ­å»ºåšå®¢é…ç½®æ³¨æ„äº‹é¡¹ï¼š</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯¹æ–‡ä»¶å¤¹è¿›è¡Œé…ç½®</span></span><br><span class="line">hexo init</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºæ–°æ–‡ç« </span></span><br><span class="line">hexo <span class="keyword">new</span> <span class="string">&quot;æ–‡ç« åç§°&quot;</span></span><br><span class="line">hexo n <span class="string">&quot;æ–‡ç« åç§°&quot;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//æ¸…ç†hexoç¼“å­˜</span></span><br><span class="line">hexo clean</span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡æ–°ç”Ÿæˆåšå®¢çš„é™æ€æ–‡ä»¶</span></span><br><span class="line">hexo g</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ¬åœ°è¿è¡Œåšå®¢è‹¥æ— æ³•è¿è¡Œéœ€è¦å®‰è£…ä¾èµ–ï¼šnpm install hexo-server --save</span></span><br><span class="line">hexo s</span><br><span class="line"></span><br><span class="line"><span class="comment">//éƒ¨ç½²åšå®¢åˆ°githubä»“åº“</span></span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure><p>åœ¨blogçš„package.jsonä¸­ä¿®æ”¹ï¼š</p><p>â€œserverâ€: â€œhexo serverâ€ ğŸ‘‰ â€œserverâ€: â€œhexo clean &amp;&amp; hexo generate &amp;&amp; hexo serverâ€</p><p>æ­¤å æ‰§è¡Œnpm run server &#x3D; åŒæ—¶æ‰§è¡Œä»¥ä¸Šä¸‰ä¸ªå‘½ä»¤</p><h2 id="åšå®¢é…ç½®æ³¨æ„äº‹é¡¹ï¼š"><a href="#åšå®¢é…ç½®æ³¨æ„äº‹é¡¹ï¼š" class="headerlink" title="åšå®¢é…ç½®æ³¨æ„äº‹é¡¹ï¼š"></a>åšå®¢é…ç½®æ³¨æ„äº‹é¡¹ï¼š</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ç« å¤´éƒ¨ï¼š</span><br><span class="line">title: æ–‡ç« æ ‡é¢˜</span><br><span class="line">date: 2023-06-02 12:04:52</span><br><span class="line">tags: åšå®¢åˆ›å»º</span><br><span class="line">categories: åšå®¢åˆ›å»º</span><br><span class="line">cover: https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">titleã€å¿…éœ€ã€‘æ–‡ç« æ ‡é¢˜</span><br><span class="line">dateã€å¿…éœ€ã€‘æ–‡ç« åˆ›å»ºæ—¥æœŸ</span><br><span class="line">updatedã€å¯é€‰ã€‘æ–‡ç« æ›´æ–°æ—¥æœŸ</span><br><span class="line">tagsã€å¯é€‰ã€‘æ–‡ç« æ ‡ç­¾</span><br><span class="line">categoriesã€å¯é€‰ã€‘æ–‡ç« åˆ†ç±»</span><br><span class="line">keywordsã€å¯é€‰ã€‘æ–‡ç« å…³é”®å­—</span><br><span class="line">descriptionã€å¯é€‰ã€‘æ–‡ç« æè¿°</span><br><span class="line">top_imgã€å¯é€‰ã€‘æ–‡ç« é¡¶éƒ¨å›¾ç‰‡</span><br><span class="line">coverã€å¯é€‰ã€‘æ–‡ç« ç¼©ç•¥å›¾(å¦‚æœæ²¡æœ‰è®¾ç½®top_img,æ–‡ç« é¡µé¡¶éƒ¨å°†æ˜¾ç¤ºç¼©ç•¥å›¾ï¼Œå¯è®¾ä¸ºfalse/å›¾ç‰‡åœ°å€/ç•™ç©º)</span><br><span class="line">commentsã€å¯é€‰ã€‘æ˜¾ç¤ºæ–‡ç« è¯„è®ºæ¨¡å—(é»˜è®¤ true)</span><br><span class="line">tocã€å¯é€‰ã€‘æ˜¾ç¤ºæ–‡ç« TOC(é»˜è®¤ä¸ºè®¾ç½®ä¸­tocçš„enableé…ç½®)</span><br><span class="line">toc_numberã€å¯é€‰ã€‘æ˜¾ç¤ºtoc_number(é»˜è®¤ä¸ºè®¾ç½®ä¸­tocçš„numberé…ç½®)</span><br><span class="line">toc_style_simpleã€å¯é€‰ã€‘æ˜¾ç¤º toc ç®€æ´æ¨¡å¼</span><br><span class="line">copyrightã€å¯é€‰ã€‘æ˜¾ç¤ºæ–‡ç« ç‰ˆæƒæ¨¡å—(é»˜è®¤ä¸ºè®¾ç½®ä¸­post_copyrightçš„enableé…ç½®)</span><br><span class="line">copyright_authorã€å¯é€‰ã€‘æ–‡ç« ç‰ˆæƒæ¨¡å—çš„æ–‡ç« ä½œè€…</span><br><span class="line">copyright_author_hrefã€å¯é€‰ã€‘æ–‡ç« ç‰ˆæƒæ¨¡å—çš„æ–‡ç« ä½œè€…é“¾æ¥</span><br><span class="line">copyright_urlã€å¯é€‰ã€‘æ–‡ç« ç‰ˆæƒæ¨¡å—çš„æ–‡ç« è¿ç»“é“¾æ¥</span><br><span class="line">copyright_infoã€å¯é€‰ã€‘æ–‡ç« ç‰ˆæƒæ¨¡å—çš„ç‰ˆæƒå£°æ˜æ–‡å­—</span><br><span class="line">mathjaxã€å¯é€‰ã€‘æ˜¾ç¤ºmathjax(å½“è®¾ç½® mathjax çš„ per_page: false æ—¶ï¼Œæ‰éœ€è¦é…ç½®ï¼Œé»˜è®¤ false )</span><br><span class="line">katexã€å¯é€‰ã€‘æ˜¾ç¤º katex (å½“è®¾ç½® katex çš„ per_page: false æ—¶ï¼Œæ‰éœ€è¦é…ç½®ï¼Œé»˜è®¤ false )</span><br><span class="line">aplayerã€å¯é€‰ã€‘åœ¨éœ€è¦çš„é¡µé¢åŠ è½½ aplayer çš„ js å’Œ css,è¯·å‚è€ƒæ–‡ç« ä¸‹é¢çš„éŸ³ä¹ é…ç½®</span><br><span class="line">highlight_shrinkã€å¯é€‰ã€‘é…ç½®ä»£ç æ¡†æ˜¯å¦å±•å¼€(true/false)(é»˜è®¤ä¸ºè®¾ç½®ä¸­ highlight_shrink çš„é…ç½®)</span><br><span class="line">asideã€å¯é€‰ã€‘æ˜¾ç¤ºä¾§è¾¹æ  (é»˜è®¤ true)</span><br><span class="line">abcjsã€å¯é€‰ã€‘åŠ è½½ abcjs (å½“è®¾ç½® abcjs çš„ per_page: false æ—¶ï¼Œæ‰éœ€è¦é…ç½®ï¼Œé»˜è®¤ false )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä½œè€…: Jerry</span><br><span class="line">é€£çµ: https://butterfly.js.org/posts/dc584b87/#Post-Front-matter</span><br><span class="line">ä¾†æº: Butterfly</span><br><span class="line">è‘—ä½œæ¬Šæ­¸ä½œè€…æ‰€æœ‰ã€‚å•†æ¥­è½‰è¼‰è«‹è¯çµ¡ä½œè€…ç²å¾—æˆæ¬Šï¼Œéå•†æ¥­è½‰è¼‰è«‹è¨»æ˜å‡ºè™•ã€‚</span><br></pre></td></tr></table></figure><h2 id="å¯¹åšå®¢è¿›è¡Œgitç‰ˆæœ¬æ§åˆ¶ï¼š"><a href="#å¯¹åšå®¢è¿›è¡Œgitç‰ˆæœ¬æ§åˆ¶ï¼š" class="headerlink" title="å¯¹åšå®¢è¿›è¡Œgitç‰ˆæœ¬æ§åˆ¶ï¼š"></a>å¯¹åšå®¢è¿›è¡Œgitç‰ˆæœ¬æ§åˆ¶ï¼š</h2><p>å°†æœ¬åœ°blogæ–‡ä»¶å¤¹æ¨é€åˆ°ä»“åº“</p><p>å½“éœ€è¦é‡æ–°æ‹‰å–blogæ–‡ä»¶å¤¹æ—¶ï¼Œåªéœ€è¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//è¿›å…¥æƒ³è¦æ”¾ç½®blogçš„ç»ˆç«¯</span><br><span class="line">git clone ä»“åº“é“¾æ¥</span><br><span class="line">//å®‰è£…ä¾èµ–</span><br><span class="line">cd blog</span><br><span class="line">npm install</span><br><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>å°†æœ¬åœ°ä»£ç æ›´æ–°åˆ°ä»“åº“ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åœ¨blogç›®å½•ä¸‹ä¸­ç«¯æ‰§è¡Œï¼š</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;commitçš„åç§°(ä¸ªäººä¹ æƒ¯ï¼š20230604commit01)&quot;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><h2 id="hexo-å†™æ–‡ç« æ­¥éª¤ï¼š"><a href="#hexo-å†™æ–‡ç« æ­¥éª¤ï¼š" class="headerlink" title="hexo å†™æ–‡ç« æ­¥éª¤ï¼š"></a>hexo å†™æ–‡ç« æ­¥éª¤ï¼š</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">donn@Macc blog % hexo new &quot;ç®—æ³•å°ç»“&quot;</span><br><span class="line"></span><br><span class="line">INFO Validating config</span><br><span class="line"></span><br><span class="line">INFO Created: /opt/blog/source/_posts/ç®—æ³•å°ç»“.md</span><br></pre></td></tr></table></figure><ol><li><p>hexo new â€œæ–‡ç« åç§°â€</p></li><li><p>åœ¨å¯¹åº”æ–‡ä»¶ä¸­å†™å†…å®¹</p></li><li><p>å®Œæˆéƒ¨ç½²ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo g -c</span><br><span class="line">hexo s</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure></li></ol><p>ğŸŒŸpushåˆ°githubä»“åº“æ—¶å‡ºç°è¶…æ—¶æŠ¥é”™çš„è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fatal: unable to access &#x27;https://github.com/Tangjiayang/Tangjiayang.github.io.git/&#x27;: Failed to connect to github.com port 443 after 75012 ms: Couldn&#x27;t connect to server</span><br><span class="line">FATAL Something&#x27;s wrong. Maybe you can find the solution here: https://hexo.io/docs/troubleshooting.html</span><br><span class="line">Error: Spawn failed</span><br><span class="line">    at ChildProcess.&lt;anonymous&gt; (/opt/blog/node_modules/hexo-util/lib/spawn.js:51:21)</span><br><span class="line">    at ChildProcess.emit (node:events:511:28)</span><br><span class="line">    at ChildProcess._handle.onexit (node:internal/child_process:293:12)</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å–æ¶ˆå…¨å±€ä»£ç†ï¼š</span><br><span class="line">git config --global --unset http.proxy</span><br><span class="line">git config --global --unset https.proxy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¦‚æœè¿˜ä¸èƒ½è§£å†³ï¼š</span><br><span class="line">å°è¯•åˆ·æ–°DNSç¼“å­˜</span><br><span class="line">macç”¨æˆ·åˆ·æ–°DNSç¼“å­˜æŒ‡ä»¤ï¼š</span><br><span class="line">sudo killall -HUP mDNSResponder</span><br><span class="line">åˆ·æ–°åå°±å¯ä»¥å•¦ï½</span><br></pre></td></tr></table></figure><p>æ–‡ç« æ“ä½œï¼š</p><p>â€‹æ–‡ç« ç½®é¡¶ï¼š</p><p>â€‹æ·»åŠ é…ç½®      sticky: 1</p><h3 id="ä½¿ç”¨picgo-githubæ­å»ºå…è´¹ä¸ªäººå›¾åºŠï¼"><a href="#ä½¿ç”¨picgo-githubæ­å»ºå…è´¹ä¸ªäººå›¾åºŠï¼" class="headerlink" title="ä½¿ç”¨picgo+githubæ­å»ºå…è´¹ä¸ªäººå›¾åºŠï¼"></a>ä½¿ç”¨picgo+githubæ­å»ºå…è´¹ä¸ªäººå›¾åºŠï¼</h3><p>gitä½¿ç”¨ï¼š<a href="https://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html">https://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html</a></p><p><a href="https://blog.csdn.net/Jimmy_wei_2010/article/details/130268408">https://blog.csdn.net/Jimmy_wei_2010/article/details/130268408</a></p><p><a href="https://blog.csdn.net/qq_41982020/article/details/121437344">https://blog.csdn.net/qq_41982020/article/details/121437344</a></p><p>æœ‰å…³sshkeyï¼š <a href="https://blog.csdn.net/D_Ray_/article/details/120240909">https://blog.csdn.net/D_Ray_/article/details/120240909</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> åšå®¢åˆ›å»º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis-Plus</title>
      <link href="/2023/06/02/MyBatis-Plus/"/>
      <url>/2023/06/02/MyBatis-Plus/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€MyBatis-Plus"><a href="#ä¸€ã€MyBatis-Plus" class="headerlink" title="ä¸€ã€MyBatis-Plus"></a>ä¸€ã€MyBatis-Plus</h1><h2 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1.ç®€ä»‹"></a>1.ç®€ä»‹</h2><p><a href="https://github.com/baomidou/mybatis-plus">MyBatis-Plus (opens new window)</a>ï¼ˆç®€ç§° MPï¼‰æ˜¯ä¸€ä¸ª <a href="https://www.mybatis.org/mybatis-3/">MyBatis (opens new window)</a>çš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚</p><blockquote><p>æˆ‘ä»¬çš„æ„¿æ™¯æ˜¯æˆä¸º MyBatis æœ€å¥½çš„æ­æ¡£ï¼Œå°±åƒ <a href="https://baomidou.com/img/contra.jpg">é­‚æ–—ç½—</a> ä¸­çš„ 1Pã€2Pï¼ŒåŸºå‹æ­é…ï¼Œæ•ˆç‡ç¿»å€ã€‚</p></blockquote><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/relationship-with-mybatis.png" alt="img"></p><h2 id="2-ç‰¹æ€§"><a href="#2-ç‰¹æ€§" class="headerlink" title="2.ç‰¹æ€§"></a>2.ç‰¹æ€§</h2><ul><li><strong>æ— ä¾µå…¥</strong>ï¼šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œå¼•å…¥å®ƒä¸ä¼šå¯¹ç°æœ‰å·¥ç¨‹äº§ç”Ÿå½±å“ï¼Œå¦‚ä¸èˆ¬é¡ºæ»‘</li><li><strong>æŸè€—å°</strong>ï¼šå¯åŠ¨å³ä¼šè‡ªåŠ¨æ³¨å…¥åŸºæœ¬ CURDï¼Œæ€§èƒ½åŸºæœ¬æ— æŸè€—ï¼Œç›´æ¥é¢å‘å¯¹è±¡æ“ä½œ</li><li><strong>å¼ºå¤§çš„ CRUD æ“ä½œ</strong>ï¼šå†…ç½®é€šç”¨ Mapperã€é€šç”¨ Serviceï¼Œä»…ä»…é€šè¿‡å°‘é‡é…ç½®å³å¯å®ç°å•è¡¨å¤§éƒ¨åˆ† CRUD æ“ä½œï¼Œæ›´æœ‰å¼ºå¤§çš„æ¡ä»¶æ„é€ å™¨ï¼Œæ»¡è¶³å„ç±»ä½¿ç”¨éœ€æ±‚</li><li><strong>æ”¯æŒ Lambda å½¢å¼è°ƒç”¨</strong>ï¼šé€šè¿‡ Lambda è¡¨è¾¾å¼ï¼Œæ–¹ä¾¿çš„ç¼–å†™å„ç±»æŸ¥è¯¢æ¡ä»¶ï¼Œæ— éœ€å†æ‹…å¿ƒå­—æ®µå†™é”™</li><li><strong>æ”¯æŒä¸»é”®è‡ªåŠ¨ç”Ÿæˆ</strong>ï¼šæ”¯æŒå¤šè¾¾ 4 ç§ä¸»é”®ç­–ç•¥ï¼ˆå†…å«åˆ†å¸ƒå¼å”¯ä¸€ ID ç”Ÿæˆå™¨ - Sequenceï¼‰ï¼Œå¯è‡ªç”±é…ç½®ï¼Œå®Œç¾è§£å†³ä¸»é”®é—®é¢˜</li><li><strong>æ”¯æŒ ActiveRecord æ¨¡å¼</strong>ï¼šæ”¯æŒ ActiveRecord å½¢å¼è°ƒç”¨ï¼Œå®ä½“ç±»åªéœ€ç»§æ‰¿ Model ç±»å³å¯è¿›è¡Œå¼ºå¤§çš„ CRUD æ“ä½œ</li><li><strong>æ”¯æŒè‡ªå®šä¹‰å…¨å±€é€šç”¨æ“ä½œ</strong>ï¼šæ”¯æŒå…¨å±€é€šç”¨æ–¹æ³•æ³¨å…¥ï¼ˆ Write once, use anywhere ï¼‰</li><li><strong>å†…ç½®ä»£ç ç”Ÿæˆå™¨</strong>ï¼šé‡‡ç”¨ä»£ç æˆ–è€… Maven æ’ä»¶å¯å¿«é€Ÿç”Ÿæˆ Mapper ã€ Model ã€ Service ã€ Controller å±‚ä»£ç ï¼Œæ”¯æŒæ¨¡æ¿å¼•æ“ï¼Œæ›´æœ‰è¶…å¤šè‡ªå®šä¹‰é…ç½®ç­‰æ‚¨æ¥ä½¿ç”¨</li><li><strong>å†…ç½®åˆ†é¡µæ’ä»¶</strong>ï¼šåŸºäº MyBatis ç‰©ç†åˆ†é¡µï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒå…·ä½“æ“ä½œï¼Œé…ç½®å¥½æ’ä»¶ä¹‹åï¼Œå†™åˆ†é¡µç­‰åŒäºæ™®é€š List æŸ¥è¯¢</li><li><strong>åˆ†é¡µæ’ä»¶æ”¯æŒå¤šç§æ•°æ®åº“</strong>ï¼šæ”¯æŒ MySQLã€MariaDBã€Oracleã€DB2ã€H2ã€HSQLã€SQLiteã€Postgreã€SQLServer ç­‰å¤šç§æ•°æ®åº“</li><li><strong>å†…ç½®æ€§èƒ½åˆ†ææ’ä»¶</strong>ï¼šå¯è¾“å‡º SQL è¯­å¥ä»¥åŠå…¶æ‰§è¡Œæ—¶é—´ï¼Œå»ºè®®å¼€å‘æµ‹è¯•æ—¶å¯ç”¨è¯¥åŠŸèƒ½ï¼Œèƒ½å¿«é€Ÿæªå‡ºæ…¢æŸ¥è¯¢</li><li><strong>å†…ç½®å…¨å±€æ‹¦æˆªæ’ä»¶</strong>ï¼šæä¾›å…¨è¡¨ delete ã€ update æ“ä½œæ™ºèƒ½åˆ†æé˜»æ–­ï¼Œä¹Ÿå¯è‡ªå®šä¹‰æ‹¦æˆªè§„åˆ™ï¼Œé¢„é˜²è¯¯æ“ä½œ</li></ul><h2 id="3-æ”¯æŒæ•°æ®åº“"><a href="#3-æ”¯æŒæ•°æ®åº“" class="headerlink" title="3.æ”¯æŒæ•°æ®åº“"></a>3.æ”¯æŒæ•°æ®åº“</h2><blockquote><p>ä»»ä½•èƒ½ä½¿ç”¨ <code>MyBatis</code> è¿›è¡Œ CRUD, å¹¶ä¸”æ”¯æŒæ ‡å‡† SQL çš„æ•°æ®åº“ï¼Œå…·ä½“æ”¯æŒæƒ…å†µå¦‚ä¸‹ï¼Œå¦‚æœä¸åœ¨ä¸‹åˆ—è¡¨æŸ¥çœ‹åˆ†é¡µéƒ¨åˆ†æ•™ç¨‹ PR æ‚¨çš„æ”¯æŒã€‚</p></blockquote><ul><li>MySQLï¼ŒOracleï¼ŒDB2ï¼ŒH2ï¼ŒHSQLï¼ŒSQLiteï¼ŒPostgreSQLï¼ŒSQLServerï¼ŒPhoenixï¼ŒGauss ï¼ŒClickHouseï¼ŒSybaseï¼ŒOceanBaseï¼ŒFirebirdï¼ŒCubridï¼ŒGoldilocksï¼Œcsiidb</li><li>è¾¾æ¢¦æ•°æ®åº“ï¼Œè™šè°·æ•°æ®åº“ï¼Œäººå¤§é‡‘ä»“æ•°æ®åº“ï¼Œå—å¤§é€šç”¨(ååº“)æ•°æ®åº“ï¼Œå—å¤§é€šç”¨æ•°æ®åº“ï¼Œç¥é€šæ•°æ®åº“ï¼Œç€šé«˜æ•°æ®åº“</li></ul><h2 id="4-æ¡†æ¶ç»“æ„"><a href="#4-æ¡†æ¶ç»“æ„" class="headerlink" title="4.æ¡†æ¶ç»“æ„"></a>4.æ¡†æ¶ç»“æ„</h2><p>![image-20230517103049072](&#x2F;Users&#x2F;donn&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230517103049072.png)</p><h2 id="5-å®˜æ–¹åœ°å€"><a href="#5-å®˜æ–¹åœ°å€" class="headerlink" title="5.å®˜æ–¹åœ°å€"></a>5.å®˜æ–¹åœ°å€</h2><blockquote><p><strong>å®˜æ–¹ç½‘ç«™ï¼š</strong><a href="https://baomidou.com/">https://baomidou.com/</a></p><p><strong>å®˜æ–¹æ–‡æ¡£ï¼š</strong><a href="https://baomidou.com/pages/24112f/">https://baomidou.com/pages/24112f/</a></p></blockquote><h1 id="äºŒã€å…¥é—¨æ¡ˆä¾‹"><a href="#äºŒã€å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="äºŒã€å…¥é—¨æ¡ˆä¾‹"></a>äºŒã€å…¥é—¨æ¡ˆä¾‹</h1><h2 id="1-å¼€å‘ç¯å¢ƒ"><a href="#1-å¼€å‘ç¯å¢ƒ" class="headerlink" title="1.å¼€å‘ç¯å¢ƒ"></a>1.å¼€å‘ç¯å¢ƒ</h2><ul><li><strong>IDEï¼šIDEA 2019.3.5</strong></li><li><strong>JDKï¼šJDK8+</strong></li><li><strong>æ„å»ºå·¥å…·ï¼šMaven 3.5.4</strong></li><li><strong>MySQLï¼šMySQL 8.0.24</strong></li><li><strong>Navicatï¼šNavicat Premium 15</strong></li><li><strong>Spring Bootï¼š2.6.7</strong></li><li><strong>MyBatis-Plusï¼š3.5.1</strong></li></ul><h2 id="2-å»ºåº“å»ºè¡¨"><a href="#2-å»ºåº“å»ºè¡¨" class="headerlink" title="2.å»ºåº“å»ºè¡¨"></a>2.å»ºåº“å»ºè¡¨</h2><ul><li><p><strong>æ‰“å¼€Navicatè¿è¡Œä»¥ä¸‹SQLè„šæœ¬è¿›è¡Œå»ºåº“å»ºè¡¨</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE `mybatis_plus` <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8mb4 */</span>; </span><br><span class="line">use `mybatis_plus`; </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>` ( </span><br><span class="line">    `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>, </span><br><span class="line">    `name` <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å§“å&#x27;</span>, </span><br><span class="line">    `age` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¹´é¾„&#x27;</span>, </span><br><span class="line">    `email` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é‚®ç®±&#x27;</span>, </span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`) </span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ’å…¥å‡ æ¡æµ‹è¯•æ•°æ®</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> (id, name, age, email) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;Jone&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;test1@baomidou.com&#x27;</span>), </span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;test2@baomidou.com&#x27;</span>), </span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;Tom&#x27;</span>, <span class="number">28</span>, <span class="string">&#x27;test3@baomidou.com&#x27;</span>), </span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;Sandy&#x27;</span>, <span class="number">21</span>, <span class="string">&#x27;test4@baomidou.com&#x27;</span>), </span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;Billie&#x27;</span>, <span class="number">24</span>, <span class="string">&#x27;test5@baomidou.com&#x27;</span>);</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-åˆ›å»ºå·¥ç¨‹"><a href="#3-åˆ›å»ºå·¥ç¨‹" class="headerlink" title="3.åˆ›å»ºå·¥ç¨‹"></a>3.åˆ›å»ºå·¥ç¨‹</h2><ul><li><p><strong>ä½¿ç”¨<code>Spring Initializer</code>å¿«é€Ÿåˆå§‹åŒ–ä¸€ä¸ª Spring Boot å·¥ç¨‹</strong></p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220519140839640.png" alt="image-20220519140839640" style="zoom:80%;" /><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220519141335981.png" alt="image-20220519141335981" style="zoom:80%;" /><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220519141737405.png" alt="image-20220519141737405" style="zoom:80%;" /><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220519141849937.png" alt="image-20220519141849937" style="zoom:80%;" /></li><li><p><strong>å¼•å…¥<code>MyBatis-Plus</code>çš„ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å…¶ä»–ç›¸å…³ä¾èµ–ï¼š</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.31<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å®‰è£…<code>Lombok</code>æ’ä»¶</strong></p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220519143257305.png" alt="image-20220519143257305" style="zoom:80%;" /></li></ul><h2 id="4-é…ç½®ç¼–ç "><a href="#4-é…ç½®ç¼–ç " class="headerlink" title="4.é…ç½®ç¼–ç "></a>4.é…ç½®ç¼–ç </h2><ul><li><p><strong>é…ç½®<code>application.yml</code>æ–‡ä»¶</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é…ç½®ç«¯å£</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment">#é…ç½®æ•°æ®æº</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#é…ç½®æ•°æ®æºç±»å‹</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="comment">#é…ç½®è¿æ¥æ•°æ®åº“çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis_plus?characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> &#123;<span class="string">username</span>&#125;</span><br><span class="line">    <span class="attr">password:</span> &#123;<span class="string">password</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#MyBatis-Plusç›¸å…³é…ç½®</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#é…ç½®æ—¥å¿—</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure></li><li><p><strong>åœ¨ Spring Boot å¯åŠ¨ç±»ä¸­æ·»åŠ  <code>@MapperScan</code> æ³¨è§£ï¼Œæ‰«æ Mapper æ–‡ä»¶å¤¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;æŒ‡å®šMapperæ¥å£æ‰€åœ¨çš„åŒ…&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusDemoApplication</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(MybatisPlusDemoApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ç¼–å†™å®ä½“ç±» <code>User.java</code>ï¼ˆæ­¤å¤„ä½¿ç”¨äº† Lombok ç®€åŒ–ä»£ç ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ç¼–å†™ Mapper åŒ…ä¸‹çš„ <code>UserMapper</code>æ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="5-æµ‹è¯•æŸ¥è¯¢"><a href="#5-æµ‹è¯•æŸ¥è¯¢" class="headerlink" title="5.æµ‹è¯•æŸ¥è¯¢"></a>5.æµ‹è¯•æŸ¥è¯¢</h2><ul><li><p><strong>ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»<code>MyBatisPlusTest.java</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisPlusTest</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹è¯•æŸ¥è¯¢æ‰€æœ‰æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSelectList</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//é€šè¿‡æ¡ä»¶æ„é€ å™¨æŸ¥è¯¢ä¸€ä¸ªlisté›†åˆï¼Œè‹¥æ²¡æœ‰æ¡ä»¶ï¼Œåˆ™å¯ä»¥è®¾ç½®nullä¸ºå‚æ•°</span></span><br><span class="line">        List&lt;User&gt; users = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ§åˆ¶å°æ‰“å°æŸ¥è¯¢ç»“æœ</strong></p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220519150454211.png" alt="image-20220519150454211"></p></li></ul><h1 id="ä¸‰ã€å¢åˆ æ”¹æŸ¥"><a href="#ä¸‰ã€å¢åˆ æ”¹æŸ¥" class="headerlink" title="ä¸‰ã€å¢åˆ æ”¹æŸ¥"></a>ä¸‰ã€å¢åˆ æ”¹æŸ¥</h1><h2 id="1-BaseMapper-lt-T-gt"><a href="#1-BaseMapper-lt-T-gt" class="headerlink" title="1.BaseMapper&lt;T&gt;"></a>1.BaseMapper&lt;T&gt;</h2><blockquote><p>è¯´æ˜:</p><ul><li>é€šç”¨ CRUD å°è£…BaseMapper æ¥å£ï¼Œä¸º <code>Mybatis-Plus</code> å¯åŠ¨æ—¶è‡ªåŠ¨è§£æå®ä½“è¡¨å…³ç³»æ˜ å°„è½¬æ¢ä¸º <code>Mybatis</code> å†…éƒ¨å¯¹è±¡æ³¨å…¥å®¹å™¨</li><li>æ³›å‹ <code>T</code> ä¸ºä»»æ„å®ä½“å¯¹è±¡</li><li>å‚æ•° <code>Serializable</code> ä¸ºä»»æ„ç±»å‹ä¸»é”® <code>Mybatis-Plus</code> ä¸æ¨èä½¿ç”¨å¤åˆä¸»é”®çº¦å®šæ¯ä¸€å¼ è¡¨éƒ½æœ‰è‡ªå·±çš„å”¯ä¸€ <code>id</code> ä¸»é”®</li><li>å¯¹è±¡ <code>Wrapper</code> ä¸ºæ¡ä»¶æ„é€ å™¨</li></ul></blockquote><p>MyBatis-Plusä¸­çš„åŸºæœ¬CRUDåœ¨å†…ç½®çš„BaseMapperä¸­éƒ½å·²å¾—åˆ°äº†å®ç°ï¼Œå› æ­¤æˆ‘ä»¬ç»§æ‰¿è¯¥æ¥å£ä»¥åå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><p>æœ¬æ¬¡æ¼”ç¤ºçš„CRUDæ“ä½œä¸åŒ…å«å‚æ•°å¸¦æœ‰æ¡ä»¶æ„é€ å™¨çš„æ–¹æ³•ï¼Œå…³äºæ¡ä»¶æ„é€ å™¨å°†å•ç‹¬åœ¨ä¸€ä¸ªç« èŠ‚è¿›è¡Œæ¼”ç¤ºã€‚</p><hr><blockquote><p><strong>BaseMapperä¸­æä¾›çš„CRUDæ–¹æ³•ï¼š</strong></p></blockquote><ul><li><p><strong>å¢åŠ ï¼šInsert</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ’å…¥ä¸€æ¡è®°å½•</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insert</span><span class="params">(T entity)</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ é™¤ï¼šDelete</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ® entity æ¡ä»¶ï¼Œåˆ é™¤è®°å½•</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; wrapper)</span>;</span><br><span class="line"><span class="comment">// åˆ é™¤ï¼ˆæ ¹æ®ID æ‰¹é‡åˆ é™¤ï¼‰</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteBatchIds</span><span class="params">(<span class="meta">@Param(Constants.COLLECTION)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® ID åˆ é™¤</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® columnMap æ¡ä»¶ï¼Œåˆ é™¤è®°å½•</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteByMap</span><span class="params">(<span class="meta">@Param(Constants.COLUMN_MAP)</span> Map&lt;String, Object&gt; columnMap)</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¿®æ”¹ï¼šUpdate</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ® whereWrapper æ¡ä»¶ï¼Œæ›´æ–°è®°å½•</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(<span class="meta">@Param(Constants.ENTITY)</span> T updateEntity, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; whereWrapper)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® ID ä¿®æ”¹</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateById</span><span class="params">(<span class="meta">@Param(Constants.ENTITY)</span> T entity)</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>æŸ¥è¯¢ï¼šSelete</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ® ID æŸ¥è¯¢</span></span><br><span class="line">T <span class="title function_">selectById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® entity æ¡ä»¶ï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½•</span></span><br><span class="line">T <span class="title function_">selectOne</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢ï¼ˆæ ¹æ®ID æ‰¹é‡æŸ¥è¯¢ï¼‰</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">selectBatchIds</span><span class="params">(<span class="meta">@Param(Constants.COLLECTION)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® entity æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½•</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">selectList</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢ï¼ˆæ ¹æ® columnMap æ¡ä»¶ï¼‰</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">selectByMap</span><span class="params">(<span class="meta">@Param(Constants.COLUMN_MAP)</span> Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½•</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectMaps</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½•ã€‚æ³¨æ„ï¼š åªè¿”å›ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼</span></span><br><span class="line">List&lt;Object&gt; <span class="title function_">selectObjs</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ® entity æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½•ï¼ˆå¹¶ç¿»é¡µï¼‰</span></span><br><span class="line">IPage&lt;T&gt; <span class="title function_">selectPage</span><span class="params">(IPage&lt;T&gt; page, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½•ï¼ˆå¹¶ç¿»é¡µï¼‰</span></span><br><span class="line">IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectMapsPage</span><span class="params">(IPage&lt;T&gt; page, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢æ€»è®°å½•æ•°</span></span><br><span class="line">Integer <span class="title function_">selectCount</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br></pre></td></tr></table></figure></li></ul><h2 id="2-è°ƒç”¨Mapperå±‚å®ç°CRUD"><a href="#2-è°ƒç”¨Mapperå±‚å®ç°CRUD" class="headerlink" title="2.è°ƒç”¨Mapperå±‚å®ç°CRUD"></a>2.è°ƒç”¨Mapperå±‚å®ç°CRUD</h2><h3 id="2-1æ’å…¥"><a href="#2-1æ’å…¥" class="headerlink" title="2.1æ’å…¥"></a>2.1æ’å…¥</h3><hr><blockquote><p><strong>æœ€ç»ˆæ‰§è¡Œçš„ç»“æœï¼Œæ‰€è·å–çš„idä¸º1527206783590903810</strong></p><p><strong>è¿™æ˜¯å› ä¸ºMyBatis-Plusåœ¨å®ç°æ’å…¥æ•°æ®æ—¶ï¼Œä¼šé»˜è®¤åŸºäºé›ªèŠ±ç®—æ³•çš„ç­–ç•¥ç”Ÿæˆid</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æµ‹è¯•æ’å…¥ä¸€æ¡æ•°æ®</span></span><br><span class="line"><span class="comment">  * MyBatis-Plusåœ¨å®ç°æ’å…¥æ•°æ®æ—¶ï¼Œä¼šé»˜è®¤åŸºäºé›ªèŠ±ç®—æ³•çš„ç­–ç•¥ç”Ÿæˆid</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setName(<span class="string">&quot;Vz&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">21</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;vz@oz6.cn&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.insert(user);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;æ·»åŠ æˆåŠŸï¼&quot;</span> : <span class="string">&quot;æ·»åŠ å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å—å½±å“çš„è¡Œæ•°ä¸ºï¼š&quot;</span> + result);</span><br><span class="line">    <span class="comment">//1527206783590903810ï¼ˆå½“å‰ id ä¸ºé›ªèŠ±ç®—æ³•è‡ªåŠ¨ç”Ÿæˆçš„idï¼‰</span></span><br><span class="line">    System.out.println(<span class="string">&quot;idè‡ªåŠ¨è·å–&quot;</span> + user.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2åˆ é™¤"><a href="#2-2åˆ é™¤" class="headerlink" title="2.2åˆ é™¤"></a>2.2åˆ é™¤</h3><hr><h4 id="aã€æ ¹æ®IDåˆ é™¤æ•°æ®"><a href="#aã€æ ¹æ®IDåˆ é™¤æ•°æ®" class="headerlink" title="aã€æ ¹æ®IDåˆ é™¤æ•°æ®"></a>aã€æ ¹æ®IDåˆ é™¤æ•°æ®</h4><blockquote><p><strong>è°ƒç”¨æ–¹æ³•ï¼šint deleteById(Serializable id);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æµ‹è¯•æ ¹æ®idåˆ é™¤ä¸€æ¡æ•°æ®</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteById</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.deleteById(<span class="number">1527206783590903810L</span>);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span> : <span class="string">&quot;åˆ é™¤å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å—å½±å“çš„è¡Œæ•°ä¸ºï¼š&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="bã€æ ¹æ®IDæ‰¹é‡åˆ é™¤æ•°æ®"><a href="#bã€æ ¹æ®IDæ‰¹é‡åˆ é™¤æ•°æ®" class="headerlink" title="bã€æ ¹æ®IDæ‰¹é‡åˆ é™¤æ•°æ®"></a>bã€æ ¹æ®IDæ‰¹é‡åˆ é™¤æ•°æ®</h4><blockquote><p><strong>è°ƒç”¨æ–¹æ³•ï¼šint deleteBatchIds(@Param(Constants.COLLECTION) Collection&lt;? extends Serializable&gt; idList);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æµ‹è¯•é€šè¿‡idæ‰¹é‡åˆ é™¤æ•°æ®</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteBatchIds</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Long&gt; ids = Arrays.asList(<span class="number">6L</span>,<span class="number">7L</span>,<span class="number">8L</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.deleteBatchIds(ids);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span> : <span class="string">&quot;åˆ é™¤å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å—å½±å“çš„è¡Œæ•°ä¸ºï¼š&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="cã€æ ¹æ®Mapæ¡ä»¶åˆ é™¤æ•°æ®"><a href="#cã€æ ¹æ®Mapæ¡ä»¶åˆ é™¤æ•°æ®" class="headerlink" title="cã€æ ¹æ®Mapæ¡ä»¶åˆ é™¤æ•°æ®"></a>cã€æ ¹æ®Mapæ¡ä»¶åˆ é™¤æ•°æ®</h4><blockquote><p><strong>è°ƒç”¨æ–¹æ³•ï¼šint deleteByMap(@Param(Constants.COLUMN_MAP) Map&lt;String, Object&gt; columnMap);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æµ‹è¯•æ ¹æ®Mapé›†åˆä¸­æ‰€è®¾ç½®çš„æ¡ä»¶åˆ é™¤æ•°æ®</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteByMap</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//å½“å‰æ¼”ç¤ºä¸ºæ ¹æ®nameå’Œageåˆ é™¤æ•°æ®</span></span><br><span class="line">    <span class="comment">//æ‰§è¡ŒSQLä¸ºï¼šDELETE FROM user WHERE name = ? AND age = ?</span></span><br><span class="line">    Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Vz&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;age&quot;</span>,<span class="number">21</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.deleteByMap(map);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span> : <span class="string">&quot;åˆ é™¤å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å—å½±å“çš„è¡Œæ•°ä¸ºï¼š&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3ä¿®æ”¹"><a href="#2-3ä¿®æ”¹" class="headerlink" title="2.3ä¿®æ”¹"></a>2.3ä¿®æ”¹</h3><blockquote><p><strong>è°ƒç”¨æ–¹æ³•ï¼šint updateById(@Param(Constants.ENTITY) T entity);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æµ‹è¯•æ ¹æ®idä¿®æ”¹ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateById</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//æ‰§è¡ŒSQLä¸ºï¼š UPDATE user SET name=?, age=?, email=? WHERE id=?</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setId(<span class="number">6L</span>);</span><br><span class="line">    user.setName(<span class="string">&quot;VzUpdate&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">18</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;Vz@sina.com&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.updateById(user);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;ä¿®æ”¹æˆåŠŸï¼&quot;</span> : <span class="string">&quot;ä¿®æ”¹å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å—å½±å“çš„è¡Œæ•°ä¸ºï¼š&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-4æŸ¥è¯¢"><a href="#2-4æŸ¥è¯¢" class="headerlink" title="2.4æŸ¥è¯¢"></a>2.4æŸ¥è¯¢</h3><hr><h4 id="aã€æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯"><a href="#aã€æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="aã€æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯"></a>aã€æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</h4><blockquote><p><strong>è°ƒç”¨æ–¹æ³•ï¼šT selectById(Serializable id);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æµ‹è¯•æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·æ•°æ®</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="bã€æ ¹æ®å¤šä¸ªIDæŸ¥è¯¢å¤šä¸ªç”¨æˆ·ä¿¡æ¯"><a href="#bã€æ ¹æ®å¤šä¸ªIDæŸ¥è¯¢å¤šä¸ªç”¨æˆ·ä¿¡æ¯" class="headerlink" title="bã€æ ¹æ®å¤šä¸ªIDæŸ¥è¯¢å¤šä¸ªç”¨æˆ·ä¿¡æ¯"></a>bã€æ ¹æ®å¤šä¸ªIDæŸ¥è¯¢å¤šä¸ªç”¨æˆ·ä¿¡æ¯</h4><blockquote><p><strong>è°ƒç”¨æ–¹æ³•ï¼šList<T> selectBatchIds(@Param(Constants.COLLECTION) Collection&lt;? extends Serializable&gt; idList);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æ ¹æ®å¤šä¸ªidæŸ¥è¯¢ç”¨æˆ·æ•°æ®</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBatchIds</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//æ‰§è¡ŒSQLä¸ºï¼šSELECT id,name,age,email FROM user WHERE id IN ( ? , ? , ? )</span></span><br><span class="line">    List&lt;Long&gt; ids = Arrays.asList(<span class="number">1L</span>,<span class="number">2L</span>,<span class="number">3L</span>);</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectBatchIds(ids);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="cã€æ ¹æ®Mapæ¡ä»¶æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯"><a href="#cã€æ ¹æ®Mapæ¡ä»¶æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="cã€æ ¹æ®Mapæ¡ä»¶æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯"></a>cã€æ ¹æ®Mapæ¡ä»¶æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</h4><blockquote><p><strong>è°ƒç”¨æ–¹æ³•ï¼šList<T> selectByMap(@Param(Constants.COLUMN_MAP) Map&lt;String, Object&gt; columnMap);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æ ¹æ®Mapæ‰€è®¾ç½®çš„æ¡ä»¶æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByMap</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//æ‰§è¡ŒSQLä¸ºï¼šSELECT id,name,age,email FROM user WHERE age = ?</span></span><br><span class="line">    Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;age&quot;</span>,<span class="number">18</span>);</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectByMap(map);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="dã€æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯"><a href="#dã€æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="dã€æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯"></a>dã€æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯</h4><blockquote><p><strong>è°ƒç”¨æ–¹æ³•ï¼šList<T> selectList(@Param(Constants.WRAPPER) Wrapper<T> queryWrapper);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æµ‹è¯•æŸ¥è¯¢æ‰€æœ‰æ•°æ®</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSelectList</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-é€šç”¨Service"><a href="#3-é€šç”¨Service" class="headerlink" title="3.é€šç”¨Service"></a>3.é€šç”¨Service</h2><blockquote><p>è¯´æ˜:</p><ul><li>é€šç”¨ Service CRUD å°è£…<code>IService</code>æ¥å£ï¼Œè¿›ä¸€æ­¥å°è£… CRUD é‡‡ç”¨ <code>get æŸ¥è¯¢å•è¡Œ</code> <code>remove åˆ é™¤</code> <code>list æŸ¥è¯¢é›†åˆ</code> <code>page åˆ†é¡µ</code> å‰ç¼€å‘½åæ–¹å¼åŒºåˆ† <code>Mapper</code> å±‚é¿å…æ··æ·†ï¼Œ</li><li>æ³›å‹ <code>T</code> ä¸ºä»»æ„å®ä½“å¯¹è±¡</li><li>å»ºè®®å¦‚æœå­˜åœ¨è‡ªå®šä¹‰é€šç”¨ Service æ–¹æ³•çš„å¯èƒ½ï¼Œè¯·åˆ›å»ºè‡ªå·±çš„ <code>IBaseService</code> ç»§æ‰¿ <code>Mybatis-Plus</code> æä¾›çš„åŸºç±»</li><li>å¯¹è±¡ <code>Wrapper</code> ä¸º æ¡ä»¶æ„é€ å™¨</li></ul></blockquote><p>MyBatis-Plusä¸­æœ‰ä¸€ä¸ªæ¥å£ **<code>IService</code>**å’Œå…¶å®ç°ç±» **<code>ServiceImpl</code>**ï¼Œå°è£…äº†å¸¸è§çš„ä¸šåŠ¡å±‚é€»è¾‘ï¼Œè¯¦æƒ…æŸ¥çœ‹æºç IServiceå’ŒServiceImpl</p><p>å› æ­¤æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™ä»…éœ€åœ¨è‡ªå·±å®šä¹‰çš„**<code>Service</code><strong>æ¥å£ä¸­ç»§æ‰¿</strong><code>IService</code><strong>æ¥å£ï¼Œåœ¨è‡ªå·±çš„å®ç°ç±»ä¸­å®ç°è‡ªå·±çš„Serviceå¹¶ç»§æ‰¿</strong><code>ServiceImpl</code>**å³å¯</p><hr><blockquote><p><strong>IServiceä¸­çš„CRUDæ–¹æ³•</strong></p></blockquote><ul><li><p><strong>å¢åŠ ï¼šSaveã€SaveOrUpdate</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ’å…¥ä¸€æ¡è®°å½•ï¼ˆé€‰æ‹©å­—æ®µï¼Œç­–ç•¥æ’å…¥ï¼‰</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">save</span><span class="params">(T entity)</span>;</span><br><span class="line"><span class="comment">// æ’å…¥ï¼ˆæ‰¹é‡ï¼‰</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveBatch</span><span class="params">(Collection&lt;T&gt; entityList)</span>;</span><br><span class="line"><span class="comment">// æ’å…¥ï¼ˆæ‰¹é‡ï¼‰</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveBatch</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TableId æ³¨è§£å­˜åœ¨æ›´æ–°è®°å½•ï¼Œå¦æ’å…¥ä¸€æ¡è®°å½•</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveOrUpdate</span><span class="params">(T entity)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ®updateWrapperå°è¯•æ›´æ–°ï¼Œå¦ç»§ç»­æ‰§è¡ŒsaveOrUpdate(T)æ–¹æ³•</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveOrUpdate</span><span class="params">(T entity, Wrapper&lt;T&gt; updateWrapper)</span>;</span><br><span class="line"><span class="comment">// æ‰¹é‡ä¿®æ”¹æ’å…¥</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveOrUpdateBatch</span><span class="params">(Collection&lt;T&gt; entityList)</span>;</span><br><span class="line"><span class="comment">// æ‰¹é‡ä¿®æ”¹æ’å…¥</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveOrUpdateBatch</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ é™¤ï¼šRemove</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ® entity æ¡ä»¶ï¼Œåˆ é™¤è®°å½•</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® ID åˆ é™¤</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">removeById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® columnMap æ¡ä»¶ï¼Œåˆ é™¤è®°å½•</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">removeByMap</span><span class="params">(Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line"><span class="comment">// åˆ é™¤ï¼ˆæ ¹æ®ID æ‰¹é‡åˆ é™¤ï¼‰</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">removeByIds</span><span class="params">(Collection&lt;? extends Serializable&gt; idList)</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¿®æ”¹ï¼šUpdate</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ® UpdateWrapper æ¡ä»¶ï¼Œæ›´æ–°è®°å½• éœ€è¦è®¾ç½®sqlset</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">update</span><span class="params">(Wrapper&lt;T&gt; updateWrapper)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® whereWrapper æ¡ä»¶ï¼Œæ›´æ–°è®°å½•</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">update</span><span class="params">(T updateEntity, Wrapper&lt;T&gt; whereWrapper)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® ID é€‰æ‹©ä¿®æ”¹</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">updateById</span><span class="params">(T entity)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ®ID æ‰¹é‡æ›´æ–°</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">updateBatchById</span><span class="params">(Collection&lt;T&gt; entityList)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ®ID æ‰¹é‡æ›´æ–°</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">updateBatchById</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>æŸ¥è¯¢ï¼šGetã€Listã€Count</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ® ID æŸ¥è¯¢</span></span><br><span class="line">T <span class="title function_">getById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapperï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½•ã€‚ç»“æœé›†ï¼Œå¦‚æœæ˜¯å¤šä¸ªä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œéšæœºå–ä¸€æ¡åŠ ä¸Šé™åˆ¶æ¡ä»¶ wrapper.last(&quot;LIMIT 1&quot;)</span></span><br><span class="line">T <span class="title function_">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapperï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½•</span></span><br><span class="line">T <span class="title function_">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, <span class="type">boolean</span> throwEx)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapperï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½•</span></span><br><span class="line">Map&lt;String, Object&gt; <span class="title function_">getMap</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapperï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½•</span></span><br><span class="line">&lt;V&gt; V <span class="title function_">getObj</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢æ‰€æœ‰</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢åˆ—è¡¨</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">list</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢ï¼ˆæ ¹æ®ID æ‰¹é‡æŸ¥è¯¢ï¼‰</span></span><br><span class="line">Collection&lt;T&gt; <span class="title function_">listByIds</span><span class="params">(Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢ï¼ˆæ ¹æ® columnMap æ¡ä»¶ï¼‰</span></span><br><span class="line">Collection&lt;T&gt; <span class="title function_">listByMap</span><span class="params">(Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢æ‰€æœ‰åˆ—è¡¨</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">listMaps</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢åˆ—è¡¨</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">listMaps</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢å…¨éƒ¨è®°å½•</span></span><br><span class="line">List&lt;Object&gt; <span class="title function_">listObjs</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢å…¨éƒ¨è®°å½•</span></span><br><span class="line">&lt;V&gt; List&lt;V&gt; <span class="title function_">listObjs</span><span class="params">(Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½•</span></span><br><span class="line">List&lt;Object&gt; <span class="title function_">listObjs</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½•</span></span><br><span class="line">&lt;V&gt; List&lt;V&gt; <span class="title function_">listObjs</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢æ€»è®°å½•æ•°</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">count</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢æ€»è®°å½•æ•°</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">count</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ†é¡µï¼šPage</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ® ID æŸ¥è¯¢</span></span><br><span class="line">T <span class="title function_">getById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapperï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½•ã€‚ç»“æœé›†ï¼Œå¦‚æœæ˜¯å¤šä¸ªä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œéšæœºå–ä¸€æ¡åŠ ä¸Šé™åˆ¶æ¡ä»¶ wrapper.last(&quot;LIMIT 1&quot;)</span></span><br><span class="line">T <span class="title function_">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapperï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½•</span></span><br><span class="line">T <span class="title function_">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, <span class="type">boolean</span> throwEx)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapperï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½•</span></span><br><span class="line">Map&lt;String, Object&gt; <span class="title function_">getMap</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// æ ¹æ® Wrapperï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½•</span></span><br><span class="line">&lt;V&gt; V <span class="title function_">getObj</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span>;</span><br></pre></td></tr></table></figure></li></ul><h2 id="4-è°ƒç”¨Serviceå±‚æ“ä½œæ•°æ®"><a href="#4-è°ƒç”¨Serviceå±‚æ“ä½œæ•°æ®" class="headerlink" title="4.è°ƒç”¨Serviceå±‚æ“ä½œæ•°æ®"></a>4.è°ƒç”¨Serviceå±‚æ“ä½œæ•°æ®</h2><blockquote><p>æˆ‘ä»¬åœ¨è‡ªå·±çš„Serviceæ¥å£ä¸­é€šè¿‡ç»§æ‰¿MyBatis-Plusæä¾›çš„IServiceæ¥å£ï¼Œä¸ä»…å¯ä»¥è·å¾—å…¶æä¾›çš„CRUDæ–¹æ³•ï¼Œè€Œä¸”è¿˜å¯ä»¥ä½¿ç”¨è‡ªèº«å®šä¹‰çš„æ–¹æ³•ã€‚</p></blockquote><ul><li><p><strong>åˆ›å»º<code>UserService</code>å¹¶ç»§æ‰¿<code>IService</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * UserServiceç»§æ‰¿IServiceæ¨¡æ¿æä¾›çš„åŸºç¡€åŠŸèƒ½ </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ›å»º<code>UserService</code>çš„å®ç°ç±»å¹¶ç»§æ‰¿<code>ServiceImpl</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * ServiceImplå®ç°äº†IServiceï¼Œæä¾›äº†IServiceä¸­åŸºç¡€åŠŸèƒ½çš„å®ç° </span></span><br><span class="line"><span class="comment">  * è‹¥ServiceImplæ— æ³•æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è‡ªå®šçš„UserServiceå®šä¹‰æ–¹æ³•ï¼Œå¹¶åœ¨å®ç°ç±»ä¸­å®ç°</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper,User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æµ‹è¯•æŸ¥è¯¢è®°å½•æ•°</strong></p><blockquote><p><strong>è°ƒç”¨æ–¹æ³•ï¼šint count();</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetCount</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢æ€»è®°å½•æ•°</span></span><br><span class="line">    <span class="comment">//æ‰§è¡Œçš„SQLä¸ºï¼šSELECT COUNT( * ) FROM user</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> userService.count();</span><br><span class="line">    System.out.println(<span class="string">&quot;æ€»è®°å½•æ•°ï¼š&quot;</span> + count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æµ‹è¯•æ‰¹é‡æ’å…¥æ•°æ®</strong></p><blockquote><p><strong>è°ƒç”¨æ–¹æ³•ï¼šboolean saveBatch(Collection<T> entityList);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;User&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;Vz&quot;</span>+i);</span><br><span class="line">        user.setAge(<span class="number">20</span>+i);</span><br><span class="line">        list.add(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> userService.saveBatch(list);</span><br><span class="line">    System.out.println(b ? <span class="string">&quot;æ·»åŠ æˆåŠŸï¼&quot;</span> : <span class="string">&quot;æ·»åŠ å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="å››ã€å¸¸ç”¨æ³¨è§£"><a href="#å››ã€å¸¸ç”¨æ³¨è§£" class="headerlink" title="å››ã€å¸¸ç”¨æ³¨è§£"></a>å››ã€å¸¸ç”¨æ³¨è§£</h1><blockquote><p>MyBatis-Plusæä¾›çš„æ³¨è§£å¯ä»¥å¸®æˆ‘ä»¬è§£å†³ä¸€äº›æ•°æ®åº“ä¸å®ä½“ä¹‹é—´ç›¸äº’æ˜ å°„çš„é—®é¢˜ã€‚</p></blockquote><h2 id="1-TableName"><a href="#1-TableName" class="headerlink" title="1.@TableName"></a>1.@TableName</h2><blockquote><p>ç»è¿‡ä»¥ä¸Šçš„æµ‹è¯•ï¼Œåœ¨ä½¿ç”¨MyBatis-Pluså®ç°åŸºæœ¬çš„CRUDæ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æŒ‡å®šè¦æ“ä½œçš„è¡¨ï¼Œåªæ˜¯åœ¨Mapperæ¥å£ç»§æ‰¿BaseMapperæ—¶ï¼Œè®¾ç½®äº†æ³›å‹Userï¼Œè€Œæ“ä½œçš„è¡¨ä¸ºuserè¡¨ï¼Œç”±æ­¤å¾—å‡ºç»“è®ºï¼ŒMyBatis-Plusåœ¨ç¡®å®šæ“ä½œçš„è¡¨æ—¶ï¼Œç”±BaseMapperçš„æ³›å‹å†³å®šï¼Œå³å®ä½“ç±»å‹å†³å®šï¼Œä¸”é»˜è®¤æ“ä½œçš„è¡¨åå’Œå®ä½“ç±»å‹çš„ç±»åä¸€è‡´ã€‚</p></blockquote><h3 id="1-1å¼•å‡ºé—®é¢˜"><a href="#1-1å¼•å‡ºé—®é¢˜" class="headerlink" title="1.1å¼•å‡ºé—®é¢˜"></a>1.1å¼•å‡ºé—®é¢˜</h3><hr><blockquote><p><strong>è‹¥å®ä½“ç±»ç±»å‹çš„ç±»åå’Œè¦æ“ä½œçš„è¡¨çš„è¡¨åä¸ä¸€è‡´ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p></blockquote><ul><li><p>æˆ‘ä»¬å°†è¡¨<code>user</code>æ›´åä¸º<code>t_user</code>ï¼Œæµ‹è¯•æŸ¥è¯¢åŠŸèƒ½</p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520093844842.png" alt="image-20220520093844842"></p></li><li><p>ç¨‹åºæŠ›å‡ºå¼‚å¸¸ï¼Œ<strong>Table â€˜mybatis_plus.userâ€™ doesnâ€™t exist</strong>ï¼Œå› ä¸ºç°åœ¨çš„è¡¨åä¸º<code>t_user</code>ï¼Œè€Œé»˜è®¤æ“ä½œçš„è¡¨åå’Œå®ä½“ç±»å‹çš„ç±»åä¸€è‡´ï¼Œå³<code>user</code>è¡¨</p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520094126411.png" alt="image-20220520094126411"></p></li></ul><h3 id="1-2è§£å†³é—®é¢˜"><a href="#1-2è§£å†³é—®é¢˜" class="headerlink" title="1.2è§£å†³é—®é¢˜"></a>1.2è§£å†³é—®é¢˜</h3><hr><h4 id="aã€ä½¿ç”¨æ³¨è§£è§£å†³é—®é¢˜"><a href="#aã€ä½¿ç”¨æ³¨è§£è§£å†³é—®é¢˜" class="headerlink" title="aã€ä½¿ç”¨æ³¨è§£è§£å†³é—®é¢˜"></a>aã€ä½¿ç”¨æ³¨è§£è§£å†³é—®é¢˜</h4><blockquote><p><strong>åœ¨å®ä½“ç±»ç±»å‹ä¸Šæ·»åŠ <code>@TableName(&quot;t_user&quot;)</code>ï¼Œæ ‡è¯†å®ä½“ç±»å¯¹åº”çš„è¡¨ï¼Œå³å¯æˆåŠŸæ‰§è¡ŒSQLè¯­å¥</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;t_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="bã€ä½¿ç”¨å…¨å±€é…ç½®è§£å†³é—®é¢˜"><a href="#bã€ä½¿ç”¨å…¨å±€é…ç½®è§£å†³é—®é¢˜" class="headerlink" title="bã€ä½¿ç”¨å…¨å±€é…ç½®è§£å†³é—®é¢˜"></a>bã€ä½¿ç”¨å…¨å±€é…ç½®è§£å†³é—®é¢˜</h4><blockquote><p><strong>åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°ä»¥ä¸Šçš„é—®é¢˜ï¼Œå³å®ä½“ç±»æ‰€å¯¹åº”çš„è¡¨éƒ½æœ‰å›ºå®šçš„å‰ç¼€ï¼Œä¾‹å¦‚ <code>t_</code> æˆ– <code>tbl_</code> æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨MyBatis-Plusæä¾›çš„å…¨å±€é…ç½®ï¼Œä¸ºå®ä½“ç±»æ‰€å¯¹åº”çš„è¡¨åè®¾ç½®é»˜è®¤çš„å‰ç¼€ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦åœ¨æ¯ä¸ªå®ä½“ç±»ä¸Šé€šè¿‡@TableNameæ ‡è¯†å®ä½“ç±»å¯¹åº”çš„è¡¨</strong></p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment"># è®¾ç½®å®ä½“ç±»æ‰€å¯¹åº”çš„è¡¨çš„ç»Ÿä¸€å‰ç¼€</span></span><br><span class="line">      <span class="attr">table-prefix:</span> <span class="string">t_</span></span><br></pre></td></tr></table></figure><h2 id="2-TableId"><a href="#2-TableId" class="headerlink" title="2.@TableId"></a>2.@TableId</h2><blockquote><p><strong>ç»è¿‡ä»¥ä¸Šçš„æµ‹è¯•ï¼ŒMyBatis-Plusåœ¨å®ç°CRUDæ—¶ï¼Œä¼šé»˜è®¤å°†idä½œä¸ºä¸»é”®åˆ—ï¼Œå¹¶åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œé»˜è®¤åŸºäºé›ªèŠ±ç®—æ³•çš„ç­–ç•¥ç”Ÿæˆid</strong></p></blockquote><h3 id="2-1å¼•å‡ºé—®é¢˜"><a href="#2-1å¼•å‡ºé—®é¢˜" class="headerlink" title="2.1å¼•å‡ºé—®é¢˜"></a>2.1å¼•å‡ºé—®é¢˜</h3><hr><blockquote><p><strong>è‹¥å®ä½“ç±»å’Œè¡¨ä¸­è¡¨ç¤ºä¸»é”®çš„ä¸æ˜¯idï¼Œè€Œæ˜¯å…¶ä»–å­—æ®µï¼Œä¾‹å¦‚uidï¼ŒMyBatis-Plusä¼šè‡ªåŠ¨è¯†åˆ«uidä¸ºä¸»é”®åˆ—å—ï¼Ÿ</strong></p></blockquote><ul><li><p>æˆ‘ä»¬å®ä½“ç±»ä¸­çš„å±æ€§<code>id</code>æ”¹ä¸º<code>uid</code>ï¼Œå°†è¡¨ä¸­çš„å­—æ®µ<code>id</code>ä¹Ÿæ”¹ä¸º<code>uid</code>ï¼Œæµ‹è¯•æ·»åŠ åŠŸèƒ½</p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520100939157.png" alt="image-20220520100939157"></p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520100715109.png" alt="image-20220520100715109"></p></li><li><p>ç¨‹åºæŠ›å‡ºå¼‚å¸¸ï¼Œ<strong>Field â€˜uidâ€™ doesnâ€™t have a default value</strong>ï¼Œè¯´æ˜MyBatis-Plusæ²¡æœ‰å°†<code>uid</code>ä½œä¸ºä¸»é”®èµ‹å€¼</p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520101317761.png" alt="image-20220520101317761"></p></li></ul><h3 id="2-2è§£å†³é—®é¢˜"><a href="#2-2è§£å†³é—®é¢˜" class="headerlink" title="2.2è§£å†³é—®é¢˜"></a>2.2è§£å†³é—®é¢˜</h3><hr><blockquote><p><strong>åœ¨å®ä½“ç±»ä¸­uidå±æ€§ä¸Šé€šè¿‡<code>@TableId</code>å°†å…¶æ ‡è¯†ä¸ºä¸»é”®ï¼Œå³å¯æˆåŠŸæ‰§è¡ŒSQLè¯­å¥</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Date</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long uid;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-TableIdçš„valueå±æ€§"><a href="#2-3-TableIdçš„valueå±æ€§" class="headerlink" title="2.3@TableIdçš„valueå±æ€§"></a>2.3@TableIdçš„valueå±æ€§</h3><hr><blockquote><p>è‹¥å®ä½“ç±»ä¸­ä¸»é”®å¯¹åº”çš„å±æ€§ä¸ºidï¼Œè€Œè¡¨ä¸­è¡¨ç¤ºä¸»é”®çš„å­—æ®µä¸ºuidï¼Œæ­¤æ—¶è‹¥åªåœ¨å±æ€§idä¸Šæ·»åŠ æ³¨è§£@TableIdï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸**Unknown column â€˜idâ€™ in â€˜field listâ€™**ï¼Œå³MyBatis-Plusä»ç„¶ä¼šå°†idä½œä¸ºè¡¨çš„ä¸»é”®æ“ä½œï¼Œè€Œè¡¨ä¸­è¡¨ç¤ºä¸»é”®çš„æ˜¯å­—æ®µuidæ­¤æ—¶éœ€è¦é€šè¿‡@TableIdæ³¨è§£çš„valueå±æ€§ï¼ŒæŒ‡å®šè¡¨ä¸­çš„ä¸»é”®å­—æ®µï¼Œ<code>@TableId(&quot;uid&quot;)</code>æˆ–<code>@TableId(value=&quot;uid&quot;)</code></p></blockquote><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520103030977.png" alt="image-20220520103030977"></p><h3 id="2-4-TableIdçš„typeå±æ€§"><a href="#2-4-TableIdçš„typeå±æ€§" class="headerlink" title="2.4@TableIdçš„typeå±æ€§"></a>2.4@TableIdçš„typeå±æ€§</h3><hr><blockquote><p><strong>typeå±æ€§ç”¨æ¥å®šä¹‰ä¸»é”®ç­–ç•¥ï¼šé»˜è®¤é›ªèŠ±ç®—æ³•</strong></p></blockquote><p><strong>å¸¸ç”¨çš„ä¸»é”®ç­–ç•¥ï¼š</strong></p><table><thead><tr><th align="center">å€¼</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">IdType.ASSIGN_IDï¼ˆé»˜è®¤ï¼‰</td><td align="center">åŸºäºé›ªèŠ±ç®—æ³•çš„ç­–ç•¥ç”Ÿæˆæ•°æ®idï¼Œä¸æ•°æ®åº“idæ˜¯å¦è®¾ç½®è‡ªå¢æ— å…³</td></tr><tr><td align="center">IdType.AUTO</td><td align="center">ä½¿ç”¨æ•°æ®åº“çš„è‡ªå¢ç­–ç•¥ï¼Œæ³¨æ„ï¼Œè¯¥ç±»å‹è¯·ç¡®ä¿æ•°æ®åº“è®¾ç½®äº†idè‡ªå¢ï¼Œ</td></tr></tbody></table><p><strong>é…ç½®å…¨å±€ä¸»é”®ç­–ç•¥ï¼š</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MyBatis-Plusç›¸å…³é…ç½®</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#é…ç½®æ—¥å¿—</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment">#é…ç½®mpçš„ä¸»é”®ç­–ç•¥ä¸ºè‡ªå¢</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">      <span class="comment"># è®¾ç½®å®ä½“ç±»æ‰€å¯¹åº”çš„è¡¨çš„ç»Ÿä¸€å‰ç¼€</span></span><br><span class="line">      <span class="attr">table-prefix:</span> <span class="string">t_</span></span><br></pre></td></tr></table></figure><h2 id="3-TbaleField"><a href="#3-TbaleField" class="headerlink" title="3.@TbaleField"></a>3.@TbaleField</h2><blockquote><p>ç»è¿‡ä»¥ä¸Šçš„æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒMyBatis-Plusåœ¨æ‰§è¡ŒSQLè¯­å¥æ—¶ï¼Œè¦ä¿è¯å®ä½“ç±»ä¸­çš„å±æ€§åå’Œè¡¨ä¸­çš„å­—æ®µåä¸€è‡´</p><p>å¦‚æœå®ä½“ç±»ä¸­çš„å±æ€§åå’Œå­—æ®µåä¸ä¸€è‡´çš„æƒ…å†µï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p></blockquote><h3 id="3-1æƒ…å†µä¸€"><a href="#3-1æƒ…å†µä¸€" class="headerlink" title="3.1æƒ…å†µä¸€"></a>3.1æƒ…å†µä¸€</h3><hr><p>è‹¥å®ä½“ç±»ä¸­çš„å±æ€§ä½¿ç”¨çš„æ˜¯é©¼å³°å‘½åé£æ ¼ï¼Œè€Œè¡¨ä¸­çš„å­—æ®µä½¿ç”¨çš„æ˜¯ä¸‹åˆ’çº¿å‘½åé£æ ¼</p><p>ä¾‹å¦‚å®ä½“ç±»å±æ€§<code>userName</code>ï¼Œè¡¨ä¸­å­—æ®µ<code>user_name</code></p><p>æ­¤æ—¶MyBatis-Plusä¼š<strong>è‡ªåŠ¨</strong>å°†ä¸‹åˆ’çº¿å‘½åé£æ ¼è½¬åŒ–ä¸ºé©¼å³°å‘½åé£æ ¼</p><p>ç›¸å½“äºåœ¨MyBatisä¸­é…ç½®</p><h3 id="3-2æƒ…å†µäºŒ"><a href="#3-2æƒ…å†µäºŒ" class="headerlink" title="3.2æƒ…å†µäºŒ"></a>3.2æƒ…å†µäºŒ</h3><hr><blockquote><p>è‹¥å®ä½“ç±»ä¸­çš„å±æ€§å’Œè¡¨ä¸­çš„å­—æ®µä¸æ»¡è¶³æƒ…å†µ1</p><p>ä¾‹å¦‚å®ä½“ç±»å±æ€§<code>name</code>ï¼Œè¡¨ä¸­å­—æ®µ<code>username</code></p><p>æ­¤æ—¶éœ€è¦åœ¨å®ä½“ç±»å±æ€§ä¸Šä½¿ç”¨<code>@TableField(&quot;username&quot;)</code>è®¾ç½®å±æ€§æ‰€å¯¹åº”çš„å­—æ®µå</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(&quot;uid&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@TableField(&quot;username&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-TableLogic"><a href="#4-TableLogic" class="headerlink" title="4.@TableLogic"></a>4.@TableLogic</h2><h3 id="4-1é€»è¾‘åˆ é™¤"><a href="#4-1é€»è¾‘åˆ é™¤" class="headerlink" title="4.1é€»è¾‘åˆ é™¤"></a>4.1é€»è¾‘åˆ é™¤</h3><hr><blockquote><p>ç‰©ç†åˆ é™¤ï¼šçœŸå®åˆ é™¤ï¼Œå°†å¯¹åº”æ•°æ®ä»æ•°æ®åº“ä¸­åˆ é™¤ï¼Œä¹‹åæŸ¥è¯¢ä¸åˆ°æ­¤æ¡è¢«åˆ é™¤çš„æ•°æ®</p><p>é€»è¾‘åˆ é™¤ï¼šå‡åˆ é™¤ï¼Œå°†å¯¹åº”æ•°æ®ä¸­ä»£è¡¨æ˜¯å¦è¢«åˆ é™¤å­—æ®µçš„çŠ¶æ€ä¿®æ”¹ä¸ºâ€œè¢«åˆ é™¤çŠ¶æ€â€ï¼Œä¹‹ååœ¨æ•°æ®åº“ä¸­ä»æ—§èƒ½çœ‹åˆ°æ­¤æ¡æ•°æ®è®°å½•</p><p>ä½¿ç”¨åœºæ™¯ï¼šå¯ä»¥è¿›è¡Œæ•°æ®æ¢å¤</p></blockquote><h3 id="4-2å®ç°é€»è¾‘åˆ é™¤"><a href="#4-2å®ç°é€»è¾‘åˆ é™¤" class="headerlink" title="4.2å®ç°é€»è¾‘åˆ é™¤"></a>4.2å®ç°é€»è¾‘åˆ é™¤</h3><hr><ul><li><p><strong>æ•°æ®åº“ä¸­åˆ›å»ºé€»è¾‘åˆ é™¤çŠ¶æ€åˆ—ï¼Œè®¾ç½®é»˜è®¤å€¼ä¸º0</strong></p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520134529809.png" alt="image-20220520134529809"></p></li><li><p><strong>å®ä½“ç±»ä¸­æ·»åŠ é€»è¾‘åˆ é™¤å±æ€§</strong></p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520134636112.png" alt="image-20220520134636112"></p></li><li><p><strong>æµ‹è¯•åˆ é™¤åŠŸèƒ½ï¼ŒçœŸæ­£æ‰§è¡Œçš„æ˜¯ä¿®æ”¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteById</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.deleteById(<span class="number">1527472864163348482L</span>);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span> : <span class="string">&quot;åˆ é™¤å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å—å½±å“çš„è¡Œæ•°ä¸ºï¼š&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520135637388.png" alt="image-20220520135637388"></p></li><li><p><strong>æ­¤æ—¶æ‰§è¡ŒæŸ¥è¯¢æ–¹æ³•ï¼ŒæŸ¥è¯¢çš„ç»“æœä¸ºè‡ªåŠ¨æ·»åŠ æ¡ä»¶<code>is_deleted=0</code></strong></p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520140036445.png" alt="image-20220520140036445"></p></li></ul><h1 id="äº”ã€æ¡ä»¶æ„é€ å™¨"><a href="#äº”ã€æ¡ä»¶æ„é€ å™¨" class="headerlink" title="äº”ã€æ¡ä»¶æ„é€ å™¨"></a>äº”ã€æ¡ä»¶æ„é€ å™¨</h1><h2 id="1-Wrapperä»‹ç»"><a href="#1-Wrapperä»‹ç»" class="headerlink" title="1.Wrapperä»‹ç»"></a>1.Wrapperä»‹ç»</h2><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220521092812125.png" alt="image-20220521092812125"></p><ul><li><p><code>Wrapper</code> ï¼š æ¡ä»¶æ„é€ æŠ½è±¡ç±»ï¼Œæœ€é¡¶ç«¯çˆ¶ç±»</p><ul><li><p><code>AbstractWrapper </code>ï¼š ç”¨äºæŸ¥è¯¢æ¡ä»¶å°è£…ï¼Œç”Ÿæˆ sql çš„ where æ¡ä»¶</p><ul><li><p><code>QueryWrapper </code>ï¼š æŸ¥è¯¢æ¡ä»¶å°è£…</p></li><li><p><code>UpdateWrapper </code>ï¼š Update æ¡ä»¶å°è£…</p></li><li><p><code>AbstractLambdaWrapper </code>ï¼š ä½¿ç”¨Lambda è¯­æ³•</p><ul><li><p><code>LambdaQueryWrapper </code>ï¼šç”¨äºLambdaè¯­æ³•ä½¿ç”¨çš„æŸ¥è¯¢Wrapper</p></li><li><p><code>LambdaUpdateWrapper </code>ï¼š Lambda æ›´æ–°å°è£…Wrapper</p></li></ul></li></ul></li></ul></li></ul><h2 id="2-QueryWrapper"><a href="#2-QueryWrapper" class="headerlink" title="2.QueryWrapper"></a>2.QueryWrapper</h2><ul><li><p><strong>ç»„è£…æŸ¥è¯¢æ¡ä»¶</strong></p><blockquote><p><strong>æ‰§è¡ŒSQLï¼š</strong>SELECT uid AS id,username AS name,age,email,is_deleted FROM t_user WHERE is_deleted&#x3D;0 AND (username LIKE ? AND age BETWEEN ? AND ? AND email IS NOT NULL)</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢ç”¨æˆ·ååŒ…å«aï¼Œå¹´é¾„åœ¨20åˆ°30ä¹‹é—´ï¼Œé‚®ç®±ä¿¡æ¯ä¸ä¸ºnullçš„ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.like(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;a&quot;</span>).between(<span class="string">&quot;age&quot;</span>,<span class="number">20</span>,<span class="number">30</span>).isNotNull(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(queryWrapper);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ç»„è£…æ’åºæ¡ä»¶</strong></p><blockquote><p><strong>æ‰§è¡ŒSQLï¼š</strong>SELECT uid AS id,username AS name,age,email,is_deleted FROM t_user WHERE is_deleted&#x3D;0 ORDER BY age DESC,id ASC</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ŒæŒ‰ç…§å¹´é¾„çš„é™åºæ’åºï¼Œè‹¥å¹´é¾„ç›¸åŒï¼Œåˆ™æŒ‰ç…§idå‡åºæ’åº</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.orderByDesc(<span class="string">&quot;age&quot;</span>).orderByAsc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(queryWrapper);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ç»„è£…åˆ é™¤æ¡ä»¶</strong></p><blockquote><p><strong>æ‰§è¡ŒSQLï¼š</strong>UPDATE t_user SET is_deleted&#x3D;1 WHERE is_deleted&#x3D;0 AND (email IS NULL)</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//åˆ é™¤é‚®ç®±åœ°å€ä¸ºnullçš„ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.isNull(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.delete(queryWrapper);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span> : <span class="string">&quot;åˆ é™¤å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å—å½±å“çš„è¡Œæ•°ä¸ºï¼š&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ¡ä»¶çš„ä¼˜å…ˆçº§</strong></p><blockquote><p><strong>æ‰§è¡ŒSQLï¼š</strong>UPDATE t_user SET user_name&#x3D;?, email&#x3D;? WHERE is_deleted&#x3D;0 AND (age &gt; ? AND user_name LIKE ? OR email IS NULL)</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//å°†ï¼ˆå¹´é¾„å¤§äº20å¹¶ä¸”ç”¨æˆ·åä¸­åŒ…å«æœ‰aï¼‰æˆ–é‚®ç®±ä¸ºnullçš„ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹</span></span><br><span class="line">    UpdateWrapper&lt;User&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.gt(<span class="string">&quot;age&quot;</span>,<span class="number">20</span>).like(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;a&quot;</span>).or().isNull(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setName(<span class="string">&quot;Oz&quot;</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;test@oz6.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.update(user, updateWrapper);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;ä¿®æ”¹æˆåŠŸï¼&quot;</span> : <span class="string">&quot;ä¿®æ”¹å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å—å½±å“çš„è¡Œæ•°ä¸ºï¼š&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ‰§è¡ŒSQLï¼š</strong>UPDATE t_user SET username&#x3D;?, email&#x3D;? WHERE is_deleted&#x3D;0 AND (username LIKE ? AND (age &gt; ? OR email IS NULL))</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test05</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//å°†ç”¨æˆ·åä¸­åŒ…å«æœ‰aå¹¶ä¸”ï¼ˆå¹´é¾„å¤§äº20æˆ–é‚®ç®±ä¸ºnullï¼‰çš„ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹</span></span><br><span class="line">    UpdateWrapper&lt;User&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.like(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;a&quot;</span>).and(i-&gt;i.gt(<span class="string">&quot;age&quot;</span>,<span class="number">20</span>).or().isNull(<span class="string">&quot;email&quot;</span>));</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setName(<span class="string">&quot;Vz7797&quot;</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;test@ss8o.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.update(user, updateWrapper);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;ä¿®æ”¹æˆåŠŸï¼&quot;</span> : <span class="string">&quot;ä¿®æ”¹å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å—å½±å“çš„è¡Œæ•°ä¸ºï¼š&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ç»„è£…selectå­å¥</strong></p><blockquote><p><strong>æ‰§è¡ŒSQLï¼š</strong>SELECT username,age,email FROM t_user WHERE is_deleted&#x3D;0</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test06</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢ç”¨æˆ·çš„ç”¨æˆ·åã€å¹´é¾„ã€é‚®ç®±ä¿¡æ¯</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.select(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;email&quot;</span>);</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; maps = userMapper.selectMaps(queryWrapper);</span><br><span class="line">    maps.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å®ç°å­æŸ¥è¯¢</strong></p><blockquote><p><strong>æ‰§è¡ŒSQLï¼š</strong>SELECT uid AS id,user_name AS name,age,email,is_deleted FROM t_user WHERE is_deleted&#x3D;0 AND (uid IN (select uid from t_user where uid &lt;&#x3D; 100))</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test07</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢idå°äºç­‰äº100çš„ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.inSql(<span class="string">&quot;uid&quot;</span>, <span class="string">&quot;select uid from t_user where uid &lt;= 100&quot;</span>);</span><br><span class="line">    List&lt;User&gt; list = userMapper.selectList(queryWrapper);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-UpdateWrapper"><a href="#3-UpdateWrapper" class="headerlink" title="3.UpdateWrapper"></a>3.UpdateWrapper</h2><blockquote><p>UpdateWrapperä¸ä»…æ‹¥æœ‰QueryWrapperçš„ç»„è£…æ¡ä»¶åŠŸèƒ½ï¼Œè¿˜æä¾›äº†setæ–¹æ³•è¿›è¡Œä¿®æ”¹å¯¹åº”æ¡ä»¶çš„æ•°æ®åº“ä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test08</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//å°†ç”¨æˆ·åä¸­åŒ…å«æœ‰aå¹¶ä¸”ï¼ˆå¹´é¾„å¤§äº20æˆ–é‚®ç®±ä¸ºnullï¼‰çš„ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹</span></span><br><span class="line">    UpdateWrapper&lt;User&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.like(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;a&quot;</span>).and( i -&gt; i.gt(<span class="string">&quot;age&quot;</span>,<span class="number">20</span>).or().isNull(<span class="string">&quot;email&quot;</span>)).set(<span class="string">&quot;email&quot;</span>,<span class="string">&quot;svip@qq.com&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.update(<span class="literal">null</span>, updateWrapper);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;ä¿®æ”¹æˆåŠŸï¼&quot;</span> : <span class="string">&quot;ä¿®æ”¹å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å—å½±å“çš„è¡Œæ•°ä¸ºï¼š&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-condition"><a href="#4-condition" class="headerlink" title="4.condition"></a>4.condition</h2><blockquote><p>åœ¨çœŸæ­£å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œç»„è£…æ¡ä»¶æ˜¯å¸¸è§çš„åŠŸèƒ½ï¼Œè€Œè¿™äº›æ¡ä»¶æ•°æ®æ¥æºäºç”¨æˆ·è¾“å…¥ï¼Œæ˜¯å¯é€‰çš„ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ç»„è£…è¿™äº›æ¡ä»¶æ—¶ï¼Œ<strong>å¿…é¡»å…ˆåˆ¤æ–­ç”¨æˆ·æ˜¯å¦é€‰æ‹©äº†è¿™äº›æ¡ä»¶ï¼Œè‹¥é€‰æ‹©åˆ™éœ€è¦ç»„è£…è¯¥æ¡ä»¶</strong>ï¼Œè‹¥æ²¡æœ‰é€‰æ‹©åˆ™ä¸€å®šä¸èƒ½ç»„è£…ï¼Œä»¥å…å½±å“SQLæ‰§è¡Œçš„ç»“æœ</p></blockquote><ul><li><p><strong>æ€è·¯ä¸€</strong></p><blockquote><p><strong>æ‰§è¡ŒSQLï¼š</strong>SELECT uid AS id,user_name AS name,age,email,is_deleted FROM t_user WHERE is_deleted&#x3D;0 AND (user_name LIKE ? AND age &lt;&#x3D; ?)</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test09</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">ageBegin</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">ageEnd</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isNotBlank(username))&#123;</span><br><span class="line">        <span class="comment">//isNotBlankåˆ¤æ–­æŸä¸ªå­—ç¬¦åˆ›æ˜¯å¦ä¸ä¸ºç©ºå­—ç¬¦ä¸²ã€ä¸ä¸ºnullã€ä¸ä¸ºç©ºç™½ç¬¦</span></span><br><span class="line">        queryWrapper.like(<span class="string">&quot;user_name&quot;</span>, username);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ageBegin != <span class="literal">null</span>)&#123;</span><br><span class="line">        queryWrapper.ge(<span class="string">&quot;age&quot;</span>, ageBegin);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ageEnd != <span class="literal">null</span>)&#123;</span><br><span class="line">        queryWrapper.le(<span class="string">&quot;age&quot;</span>, ageEnd);</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;User&gt; list = userMapper.selectList(queryWrapper);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ€è·¯äºŒ</strong></p><blockquote><p>ä¸Šé¢çš„å®ç°æ–¹æ¡ˆæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ä»£ç æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¦conditionå‚æ•°çš„é‡è½½æ–¹æ³•æ„å»ºæŸ¥è¯¢æ¡ä»¶ï¼Œç®€åŒ–ä»£ç çš„ç¼–å†™</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test10</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">ageBegin</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">ageEnd</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.like(StringUtils.isNotBlank(username), <span class="string">&quot;user_name&quot;</span>, username)</span><br><span class="line">        .ge(ageBegin != <span class="literal">null</span>, <span class="string">&quot;age&quot;</span>, ageBegin)</span><br><span class="line">        .le(ageEnd != <span class="literal">null</span>, <span class="string">&quot;age&quot;</span>, ageEnd);</span><br><span class="line">    List&lt;User&gt; list = userMapper.selectList(queryWrapper);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="5-LambdaQueryWrapper"><a href="#5-LambdaQueryWrapper" class="headerlink" title="5.LambdaQueryWrapper"></a>5.LambdaQueryWrapper</h2><blockquote><p>åŠŸèƒ½ç­‰åŒäºQueryWrapperï¼Œæä¾›äº†Lambdaè¡¨è¾¾å¼çš„è¯­æ³•å¯ä»¥é¿å…å¡«é”™åˆ—åã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test11</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">ageBegin</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">ageEnd</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">    LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.like(StringUtils.isNotBlank(username), User::getName, username)</span><br><span class="line">        .ge(ageBegin != <span class="literal">null</span>, User::getAge, ageBegin)</span><br><span class="line">        .le(ageEnd != <span class="literal">null</span>, User::getAge, ageEnd);</span><br><span class="line">    List&lt;User&gt; list = userMapper.selectList(queryWrapper);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-LambdaUpdateWrapper"><a href="#6-LambdaUpdateWrapper" class="headerlink" title="6.LambdaUpdateWrapper"></a>6.LambdaUpdateWrapper</h2><blockquote><p>åŠŸèƒ½ç­‰åŒäºUpdateWrapperï¼Œæä¾›äº†Lambdaè¡¨è¾¾å¼çš„è¯­æ³•å¯ä»¥é¿å…å¡«é”™åˆ—åã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test12</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//å°†ç”¨æˆ·åä¸­åŒ…å«æœ‰aå¹¶ä¸”ï¼ˆå¹´é¾„å¤§äº20æˆ–é‚®ç®±ä¸ºnullï¼‰çš„ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹</span></span><br><span class="line">    LambdaUpdateWrapper&lt;User&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.like(User::getName, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">        .and(i -&gt; i.gt(User::getAge, <span class="number">20</span>).or().isNull(User::getEmail));</span><br><span class="line">    updateWrapper.set(User::getName, <span class="string">&quot;å°é»‘&quot;</span>).set(User::getEmail,<span class="string">&quot;abc@atguigu.com&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.update(<span class="literal">null</span>, updateWrapper);</span><br><span class="line">    System.out.println(<span class="string">&quot;resultï¼š&quot;</span>+result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å…­ã€å¸¸ç”¨æ’ä»¶"><a href="#å…­ã€å¸¸ç”¨æ’ä»¶" class="headerlink" title="å…­ã€å¸¸ç”¨æ’ä»¶"></a>å…­ã€å¸¸ç”¨æ’ä»¶</h1><h2 id="1-åˆ†é¡µæ’ä»¶"><a href="#1-åˆ†é¡µæ’ä»¶" class="headerlink" title="1.åˆ†é¡µæ’ä»¶"></a>1.åˆ†é¡µæ’ä»¶</h2><blockquote><p>MyBatis Plusè‡ªå¸¦åˆ†é¡µæ’ä»¶ï¼Œåªè¦ç®€å•çš„é…ç½®å³å¯å®ç°åˆ†é¡µåŠŸèƒ½</p></blockquote><ul><li><p><strong>æ·»åŠ é…ç½®ç±»<code>MyBatisPlusConfig</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.mybatisplus.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">//æ·»åŠ åˆ†é¡µæ’ä»¶</span></span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ç¼–å†™æµ‹è¯•æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPage</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//new Page()ä¸­çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯å½“å‰é¡µç ï¼Œæ¯é¡µæ˜¾ç¤ºæ•°é‡</span></span><br><span class="line">    Page&lt;User&gt; page = userMapper.selectPage(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">1</span>, <span class="number">2</span>), <span class="literal">null</span>);</span><br><span class="line">    List&lt;User&gt; users = page.getRecords();</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="2-è‡ªå®šä¹‰åˆ†é¡µ"><a href="#2-è‡ªå®šä¹‰åˆ†é¡µ" class="headerlink" title="2.è‡ªå®šä¹‰åˆ†é¡µ"></a>2.è‡ªå®šä¹‰åˆ†é¡µ</h2><blockquote><p>ä¸Šé¢è°ƒç”¨çš„æ˜¯MyBatis-Plusæä¾›çš„å¸¦æœ‰åˆ†é¡µçš„æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„æ–¹æ³•å¦‚ä½•å®ç°åˆ†é¡µå‘¢ï¼Ÿ</p></blockquote><ul><li><p><strong>åœ¨<code>UserMapper</code>æ¥å£ä¸­å®šä¹‰ä¸€ä¸ªæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æ ¹æ®å¹´é¾„æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ï¼Œåˆ†é¡µæ˜¾ç¤º </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> page åˆ†é¡µå¯¹è±¡,xmlä¸­å¯ä»¥ä»é‡Œé¢è¿›è¡Œå–å€¼,ä¼ é€’å‚æ•° Page å³è‡ªåŠ¨åˆ†é¡µ,å¿…é¡»æ”¾åœ¨ç¬¬ä¸€ä½ </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> age å¹´é¾„ </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">Page&lt;User&gt; <span class="title function_">selectPageVo</span><span class="params">(<span class="meta">@Param(&quot;page&quot;)</span> Page&lt;User&gt; page,<span class="meta">@Param(&quot;age&quot;)</span> Integer age)</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>åœ¨<code>UserMapper.xml</code>ä¸­ç¼–å†™SQLå®ç°è¯¥æ–¹æ³•</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectPageVo&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select id,username as name,age,email from t_user where age &gt; #&#123;age&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ç¼–å†™æµ‹è¯•æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPageVo</span><span class="params">()</span>&#123;</span><br><span class="line">    Page&lt;User&gt; page = userMapper.selectPageVo(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;User&gt;(<span class="number">1</span>,<span class="number">2</span>), <span class="number">20</span>);</span><br><span class="line">    List&lt;User&gt; users = page.getRecords();</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-ä¹è§‚é”"><a href="#3-ä¹è§‚é”" class="headerlink" title="3.ä¹è§‚é”"></a>3.ä¹è§‚é”</h2><blockquote><p><strong>ä½œç”¨ï¼šå½“è¦æ›´æ–°ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œå¸Œæœ›è¿™æ¡è®°å½•æ²¡æœ‰è¢«åˆ«äººæ›´æ–°</strong></p></blockquote><p>ä¹è§‚é”çš„å®ç°æ–¹å¼ï¼š</p><ul><li>å–å‡ºè®°å½•æ—¶ï¼Œè·å–å½“å‰ version</li><li>æ›´æ–°æ—¶ï¼Œå¸¦ä¸Šè¿™ä¸ª version</li><li>æ‰§è¡Œæ›´æ–°æ—¶ï¼Œ set version &#x3D; newVersion where version &#x3D; oldVersion</li><li>å¦‚æœ version ä¸å¯¹ï¼Œå°±æ›´æ–°å¤±è´¥</li></ul><h3 id="3-1åœºæ™¯"><a href="#3-1åœºæ™¯" class="headerlink" title="3.1åœºæ™¯"></a>3.1åœºæ™¯</h3><hr><ul><li>ä¸€ä»¶å•†å“ï¼Œæˆæœ¬ä»·æ˜¯80å…ƒï¼Œå”®ä»·æ˜¯100å…ƒã€‚è€æ¿å…ˆæ˜¯é€šçŸ¥å°æï¼Œè¯´ä½ å»æŠŠå•†å“ä»·æ ¼å¢åŠ 50å…ƒã€‚å°ææ­£åœ¨ç©æ¸¸æˆï¼Œè€½æäº†ä¸€ä¸ªå°æ—¶ã€‚æ­£å¥½ä¸€ä¸ªå°æ—¶åï¼Œè€æ¿è§‰å¾—å•†å“ä»·æ ¼å¢åŠ åˆ°150å…ƒï¼Œä»·æ ¼å¤ªé«˜ï¼Œå¯èƒ½ä¼šå½±å“é”€é‡ã€‚åˆé€šçŸ¥å°ç‹ï¼Œä½ æŠŠå•†å“ä»·æ ¼é™ä½30å…ƒã€‚</li><li>æ­¤æ—¶ï¼Œå°æå’Œå°ç‹åŒæ—¶æ“ä½œå•†å“åå°ç³»ç»Ÿã€‚å°ææ“ä½œçš„æ—¶å€™ï¼Œç³»ç»Ÿå…ˆå–å‡ºå•†å“ä»·æ ¼100å…ƒï¼›å°ç‹ä¹Ÿåœ¨æ“ä½œï¼Œå–å‡ºçš„å•†å“ä»·æ ¼ä¹Ÿæ˜¯100å…ƒã€‚å°æå°†ä»·æ ¼åŠ äº†50å…ƒï¼Œå¹¶å°†100+50&#x3D;150å…ƒå­˜å…¥äº†æ•°æ®åº“ï¼›å°ç‹å°†å•†å“å‡äº†30å…ƒï¼Œå¹¶å°†100-30&#x3D;70å…ƒå­˜å…¥äº†æ•°æ®åº“ã€‚æ˜¯çš„ï¼Œå¦‚æœæ²¡æœ‰é”ï¼Œå°æçš„æ“ä½œå°±å®Œå…¨è¢«å°ç‹çš„è¦†ç›–äº†ã€‚</li><li>ç°åœ¨å•†å“ä»·æ ¼æ˜¯70å…ƒï¼Œæ¯”æˆæœ¬ä»·ä½10å…ƒã€‚å‡ åˆ†é’Ÿåï¼Œè¿™ä¸ªå•†å“å¾ˆå¿«å‡ºå”®äº†1åƒå¤šä»¶å•†å“ï¼Œè€æ¿äº1ä¸‡å¤šã€‚</li></ul><h3 id="3-2ä¹è§‚é”ä¸æ‚²è§‚é”"><a href="#3-2ä¹è§‚é”ä¸æ‚²è§‚é”" class="headerlink" title="3.2ä¹è§‚é”ä¸æ‚²è§‚é”"></a>3.2ä¹è§‚é”ä¸æ‚²è§‚é”</h3><hr><ul><li>ä¸Šé¢çš„æ•…äº‹ï¼Œå¦‚æœæ˜¯ä¹è§‚é”ï¼Œå°ç‹ä¿å­˜ä»·æ ¼å‰ï¼Œä¼šæ£€æŸ¥ä¸‹ä»·æ ¼æ˜¯å¦è¢«äººä¿®æ”¹è¿‡äº†ã€‚å¦‚æœè¢«ä¿®æ”¹è¿‡äº†ï¼Œåˆ™é‡æ–°å–å‡ºçš„è¢«ä¿®æ”¹åçš„ä»·æ ¼ï¼Œ150å…ƒï¼Œè¿™æ ·ä»–ä¼šå°†120å…ƒå­˜å…¥æ•°æ®åº“ã€‚</li><li>å¦‚æœæ˜¯æ‚²è§‚é”ï¼Œå°æå–å‡ºæ•°æ®åï¼Œå°ç‹åªèƒ½ç­‰å°ææ“ä½œå®Œä¹‹åï¼Œæ‰èƒ½å¯¹ä»·æ ¼è¿›è¡Œæ“ä½œï¼Œä¹Ÿä¼šä¿è¯æœ€ç»ˆçš„ä»·æ ¼æ˜¯120å…ƒã€‚</li></ul><h3 id="3-3æ¨¡æ‹Ÿä¿®æ”¹å†²çª"><a href="#3-3æ¨¡æ‹Ÿä¿®æ”¹å†²çª" class="headerlink" title="3.3æ¨¡æ‹Ÿä¿®æ”¹å†²çª"></a>3.3æ¨¡æ‹Ÿä¿®æ”¹å†²çª</h3><hr><ul><li><p><strong>æ•°æ®åº“ä¸­å¢åŠ å•†å“è¡¨</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_product ( </span><br><span class="line">    id <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>, </span><br><span class="line">    NAME <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å•†å“åç§°&#x27;</span>, </span><br><span class="line">    price <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;ä»·æ ¼&#x27;</span>, </span><br><span class="line">    VERSION <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;ä¹è§‚é”ç‰ˆæœ¬å·&#x27;</span>, </span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id) </span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p><strong>æ·»åŠ ä¸€æ¡æ•°æ®</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_product (id, NAME, price) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;å¤–æ˜Ÿäººç¬”è®°æœ¬&#x27;</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong>æ·»åŠ ä¸€ä¸ªå®ä½“ç±»<code>Product</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ·»åŠ ä¸€ä¸ªMapperæ¥å£<code>ProductMapper</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Product&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æµ‹è¯•æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProduct01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1.å°æè·å–å•†å“ä»·æ ¼</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">productLi</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å°æè·å–çš„å•†å“ä»·æ ¼ä¸ºï¼š&quot;</span> + productLi.getPrice());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.å°ç‹è·å–å•†å“ä»·æ ¼</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">productWang</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å°æè·å–çš„å•†å“ä»·æ ¼ä¸ºï¼š&quot;</span> + productWang.getPrice());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.å°æä¿®æ”¹å•†å“ä»·æ ¼+50</span></span><br><span class="line">    productLi.setPrice(productLi.getPrice()+<span class="number">50</span>);</span><br><span class="line">    productMapper.updateById(productLi);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.å°ç‹ä¿®æ”¹å•†å“ä»·æ ¼-30</span></span><br><span class="line">    productWang.setPrice(productWang.getPrice()-<span class="number">30</span>);</span><br><span class="line">    productMapper.updateById(productWang);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.è€æ¿æŸ¥è¯¢å•†å“ä»·æ ¼</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">productBoss</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;è€æ¿è·å–çš„å•†å“ä»·æ ¼ä¸ºï¼š&quot;</span> + productBoss.getPrice());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ‰§è¡Œç»“æœ</strong></p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220521225803162.png" alt="image-20220521225803162"></p></li></ul><h3 id="3-4ä¹è§‚é”è§£å†³é—®é¢˜"><a href="#3-4ä¹è§‚é”è§£å†³é—®é¢˜" class="headerlink" title="3.4ä¹è§‚é”è§£å†³é—®é¢˜"></a>3.4ä¹è§‚é”è§£å†³é—®é¢˜</h3><hr><ul><li><p><strong>å®ä½“ç±»<code>version</code>å­—æ®µæ·»åŠ æ³¨è§£<code>@Version</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    <span class="meta">@Version</span></span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ·»åŠ ä¹è§‚é”æ’ä»¶é…ç½®</strong>(åœ¨é…ç½®ç±»ä¸­æ·»åŠ )</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">    <span class="comment">//æ·»åŠ åˆ†é¡µæ’ä»¶</span></span><br><span class="line">    interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));</span><br><span class="line">    <span class="comment">//æ·»åŠ ä¹è§‚é”æ’ä»¶</span></span><br><span class="line">    interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">OptimisticLockerInnerInterceptor</span>());</span><br><span class="line">    <span class="keyword">return</span> interceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å†æ¬¡æ‰§è¡Œæµ‹è¯•æ–¹æ³•</strong></p><blockquote><p>å°ææŸ¥è¯¢å•†å“ä¿¡æ¯ï¼š</p><p>â€‹SELECT id,name,price,version FROM t_product WHERE id&#x3D;?</p><p>å°ç‹æŸ¥è¯¢å•†å“ä¿¡æ¯ï¼š</p><p>â€‹SELECT id,name,price,version FROM t_product WHERE id&#x3D;?</p><p>å°æä¿®æ”¹å•†å“ä»·æ ¼ï¼Œè‡ªåŠ¨å°†version+1</p><p>â€‹UPDATE t_product SET name&#x3D;?, price&#x3D;?, version&#x3D;? WHERE id&#x3D;? AND version&#x3D;?</p><p>â€‹Parameters: å¤–æ˜Ÿäººç¬”è®°æœ¬(String), 150(Integer), 1(Integer), 1(Long), 0(Integer)</p><p>å°ç‹ä¿®æ”¹å•†å“ä»·æ ¼ï¼Œæ­¤æ—¶versionå·²æ›´æ–°ï¼Œæ¡ä»¶ä¸æˆç«‹ï¼Œä¿®æ”¹å¤±è´¥</p><p>â€‹UPDATE t_product SET name&#x3D;?, price&#x3D;?, version&#x3D;? WHERE id&#x3D;? AND version&#x3D;?</p><p>â€‹Parameters: å¤–æ˜Ÿäººç¬”è®°æœ¬(String), 70(Integer), 1(Integer), 1(Long), 0(Integer)</p><p>æœ€ç»ˆï¼Œå°ç‹ä¿®æ”¹å¤±è´¥ï¼ŒæŸ¥è¯¢ä»·æ ¼ï¼š150</p><p>â€‹SELECT id,name,price,version FROM t_product WHERE id&#x3D;?</p></blockquote></li><li><p><strong>ä¼˜åŒ–æ‰§è¡Œæµç¨‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProduct01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1.å°æè·å–å•†å“ä»·æ ¼</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">productLi</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å°æè·å–çš„å•†å“ä»·æ ¼ä¸ºï¼š&quot;</span> + productLi.getPrice());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.å°ç‹è·å–å•†å“ä»·æ ¼</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">productWang</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;å°æè·å–çš„å•†å“ä»·æ ¼ä¸ºï¼š&quot;</span> + productWang.getPrice());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.å°æä¿®æ”¹å•†å“ä»·æ ¼+50</span></span><br><span class="line">    productLi.setPrice(productLi.getPrice()+<span class="number">50</span>);</span><br><span class="line">    productMapper.updateById(productLi);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.å°ç‹ä¿®æ”¹å•†å“ä»·æ ¼-30</span></span><br><span class="line">    productWang.setPrice(productWang.getPrice()-<span class="number">30</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> productMapper.updateById(productWang);</span><br><span class="line">    <span class="keyword">if</span>(result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//æ“ä½œå¤±è´¥ï¼Œé‡è¯•</span></span><br><span class="line">        <span class="type">Product</span> <span class="variable">productNew</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">        productNew.setPrice(productNew.getPrice()-<span class="number">30</span>);</span><br><span class="line">        productMapper.updateById(productNew);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.è€æ¿æŸ¥è¯¢å•†å“ä»·æ ¼</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">productBoss</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;è€æ¿è·å–çš„å•†å“ä»·æ ¼ä¸ºï¼š&quot;</span> + productBoss.getPrice());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220521230448577.png" alt="image-20220521230448577"></p></li></ul><h1 id="ä¸ƒã€é€šç”¨æšä¸¾"><a href="#ä¸ƒã€é€šç”¨æšä¸¾" class="headerlink" title="ä¸ƒã€é€šç”¨æšä¸¾"></a>ä¸ƒã€é€šç”¨æšä¸¾</h1><blockquote><p>è¡¨ä¸­çš„æœ‰äº›å­—æ®µå€¼æ˜¯å›ºå®šçš„ï¼Œä¾‹å¦‚æ€§åˆ«ï¼ˆç”·æˆ–å¥³ï¼‰ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨MyBatis-Plusçš„é€šç”¨æšä¸¾æ¥å®ç°</p></blockquote><ul><li><p><strong>æ•°æ®åº“è¡¨æ·»åŠ å­—æ®µ<code>sex</code></strong></p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220521231317777.png" alt="image-20220521231317777"></p></li><li><p><strong>åˆ›å»ºé€šç”¨æšä¸¾ç±»å‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">SexEnum</span> &#123;</span><br><span class="line">    MALE(<span class="number">1</span>, <span class="string">&quot;ç”·&quot;</span>),</span><br><span class="line">    FEMALE(<span class="number">2</span>, <span class="string">&quot;å¥³&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EnumValue</span> <span class="comment">//å°†æ³¨è§£æ‰€æ ‡è¯†çš„å±æ€§çš„å€¼å­˜å‚¨åˆ°æ•°æ®åº“ä¸­</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> sex;</span><br><span class="line">    <span class="keyword">private</span> String sexName;</span><br><span class="line"></span><br><span class="line">    SexEnum(Integer sex, String sexName) &#123;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">        <span class="built_in">this</span>.sexName = sexName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>Userå®ä½“ç±»ä¸­æ·»åŠ å±æ€§sex</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@TableField(&quot;username&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> isDeleted;  <span class="comment">//é€»è¾‘åˆ é™¤</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SexEnum sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>é…ç½®æ‰«æé€šç”¨æšä¸¾</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MyBatis-Plusç›¸å…³é…ç½®</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="comment">#æŒ‡å®šmapperæ–‡ä»¶æ‰€åœ¨çš„åœ°å€</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#é…ç½®æ—¥å¿—</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">banner:</span> <span class="string">off</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment">#é…ç½®mpçš„ä¸»é”®ç­–ç•¥ä¸ºè‡ªå¢</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">      <span class="comment"># è®¾ç½®å®ä½“ç±»æ‰€å¯¹åº”çš„è¡¨çš„ç»Ÿä¸€å‰ç¼€</span></span><br><span class="line">      <span class="attr">table-prefix:</span> <span class="string">t_</span></span><br><span class="line">  <span class="comment">#é…ç½®ç±»å‹åˆ«åæ‰€å¯¹åº”çš„åŒ…</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.atguigu.mybatisplus.pojo</span></span><br><span class="line">  <span class="comment"># æ‰«æé€šç”¨æšä¸¾çš„åŒ…</span></span><br><span class="line">  <span class="attr">type-enums-package:</span> <span class="string">com.atguigu.mybatisplus.enums</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ‰§è¡Œæµ‹è¯•æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setName(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">33</span>);</span><br><span class="line">    user.setSex(SexEnum.MALE);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.insert(user);</span><br><span class="line">    System.out.println(<span class="string">&quot;result:&quot;</span>+result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="å…«ã€å¤šæ•°æ®æº"><a href="#å…«ã€å¤šæ•°æ®æº" class="headerlink" title="å…«ã€å¤šæ•°æ®æº"></a>å…«ã€å¤šæ•°æ®æº</h1><blockquote><p>é€‚ç”¨äºå¤šç§åœºæ™¯ï¼šçº¯ç²¹å¤šåº“ã€ è¯»å†™åˆ†ç¦»ã€ ä¸€ä¸»å¤šä»ã€ æ··åˆæ¨¡å¼ç­‰</p></blockquote><p>åœºæ™¯è¯´æ˜ï¼š</p><p>æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªåº“ï¼Œåˆ†åˆ«ä¸ºï¼š<code>mybatis_plus</code>ï¼ˆä»¥å‰çš„åº“ä¸åŠ¨ï¼‰ä¸<code>mybatis_plus_1</code>ï¼ˆæ–°å»ºï¼‰ï¼Œå°†mybatis_plusåº“çš„<code>product</code>è¡¨ç§»åŠ¨åˆ°mybatis_plus_1åº“ï¼Œè¿™æ ·æ¯ä¸ªåº“ä¸€å¼ è¡¨ï¼Œé€šè¿‡ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹åˆ†åˆ«è·å–ç”¨æˆ·æ•°æ®ä¸å•†å“æ•°æ®ï¼Œå¦‚æœè·å–åˆ°è¯´æ˜å¤šåº“æ¨¡æ‹ŸæˆåŠŸ</p><h2 id="1-åˆ›å»ºæ•°æ®åº“åŠè¡¨"><a href="#1-åˆ›å»ºæ•°æ®åº“åŠè¡¨" class="headerlink" title="1.åˆ›å»ºæ•°æ®åº“åŠè¡¨"></a>1.åˆ›å»ºæ•°æ®åº“åŠè¡¨</h2><ul><li><p><strong>åˆ›å»ºæ•°æ®åº“<code>mybatis_plus_1</code>å’Œè¡¨&#96;product</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE `mybatis_plus_1` <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8mb4 */</span>;</span><br><span class="line">use `mybatis_plus_1`; </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> product ( </span><br><span class="line">    id <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¸»é”®ID&#x27;</span>, </span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å•†å“åç§°&#x27;</span>, </span><br><span class="line">    price <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;ä»·æ ¼&#x27;</span>, </span><br><span class="line">    version <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;ä¹è§‚é”ç‰ˆæœ¬å·&#x27;</span>, </span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id) </span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p><strong>æ·»åŠ æµ‹è¯•æ•°æ®</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> product (id, NAME, price) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;å¤–æ˜Ÿäººç¬”è®°æœ¬&#x27;</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ é™¤<code>mybatis_plus</code>åº“ä¸­çš„<code>product</code>è¡¨</strong> </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use mybatis_plus; </span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> product;</span><br></pre></td></tr></table></figure></li></ul><h2 id="2-æ–°å»ºå·¥ç¨‹å¼•å…¥ä¾èµ–"><a href="#2-æ–°å»ºå·¥ç¨‹å¼•å…¥ä¾èµ–" class="headerlink" title="2.æ–°å»ºå·¥ç¨‹å¼•å…¥ä¾èµ–"></a>2.æ–°å»ºå·¥ç¨‹å¼•å…¥ä¾èµ–</h2><blockquote><p><strong>è‡ªè¡Œæ–°å»ºä¸€ä¸ªSpring Bootå·¥ç¨‹å¹¶é€‰æ‹©MySQLé©±åŠ¨åŠLombokä¾èµ–</strong></p></blockquote><p><strong>å¼•å…¥MyBaits-Plusçš„ä¾èµ–åŠå¤šæ•°æ®æºçš„ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dynamic-datasource-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-ç¼–å†™é…ç½®æ–‡ä»¶"><a href="#3-ç¼–å†™é…ç½®æ–‡ä»¶" class="headerlink" title="3.ç¼–å†™é…ç½®æ–‡ä»¶"></a>3.ç¼–å†™é…ç½®æ–‡ä»¶</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># é…ç½®æ•°æ®æºä¿¡æ¯</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">dynamic:</span></span><br><span class="line">      <span class="comment"># è®¾ç½®é»˜è®¤çš„æ•°æ®æºæˆ–è€…æ•°æ®æºç»„,é»˜è®¤å€¼å³ä¸ºmaster</span></span><br><span class="line">      <span class="attr">primary:</span> <span class="string">master</span></span><br><span class="line">      <span class="comment"># ä¸¥æ ¼åŒ¹é…æ•°æ®æº,é»˜è®¤false.trueæœªåŒ¹é…åˆ°æŒ‡å®šæ•°æ®æºæ—¶æŠ›å¼‚å¸¸,falseä½¿ç”¨é»˜è®¤æ•°æ®æº</span></span><br><span class="line">      <span class="attr">strict:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">master:</span></span><br><span class="line">          <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis_plus?characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">          <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">          <span class="attr">password:</span> <span class="number">132537</span></span><br><span class="line">        <span class="attr">slave_1:</span></span><br><span class="line">          <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis_plus_1?characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">          <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">          <span class="attr">password:</span> <span class="number">132537</span></span><br></pre></td></tr></table></figure><h2 id="4-åˆ›å»ºå®ä½“ç±»"><a href="#4-åˆ›å»ºå®ä½“ç±»" class="headerlink" title="4.åˆ›å»ºå®ä½“ç±»"></a>4.åˆ›å»ºå®ä½“ç±»</h2><ul><li><p>æ–°å»ºä¸€ä¸ª<code>User</code>å®ä½“ç±»ï¼ˆå¦‚æœæ•°æ®åº“è¡¨åæœ‰t_å‰ç¼€è®°å¾—é…ç½®ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ–°å»ºä¸€ä¸ªå®ä½“ç±»<code>Product</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="5-åˆ›å»ºMapperåŠService"><a href="#5-åˆ›å»ºMapperåŠService" class="headerlink" title="5.åˆ›å»ºMapperåŠService"></a>5.åˆ›å»ºMapperåŠService</h2><ul><li><p>æ–°å»ºæ¥å£<code>UserMapper</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ–°å»ºæ¥å£<code>ProductMapper</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Product&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ–°å»ºServiceæ¥å£<code>UserService</code>æŒ‡å®šæ“ä½œçš„æ•°æ®æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DS(&quot;master&quot;)</span> <span class="comment">//æŒ‡å®šæ“ä½œçš„æ•°æ®æºï¼Œmasterä¸ºuserè¡¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ–°å»ºServiceæ¥å£<code>ProductService</code>æŒ‡å®šæ“ä½œçš„æ•°æ®æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DS(&quot;slave_1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Product&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>è‡ªè¡Œå»ºç«‹Serviceçš„å®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...</span><br></pre></td></tr></table></figure></li></ul><h2 id="6-ç¼–å†™æµ‹è¯•æ–¹æ³•"><a href="#6-ç¼–å†™æµ‹è¯•æ–¹æ³•" class="headerlink" title="6.ç¼–å†™æµ‹è¯•æ–¹æ³•"></a>6.ç¼–å†™æµ‹è¯•æ–¹æ³•</h2><blockquote><p><strong>è®°å¾—åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ æ³¨è§£<code>@MapperScan()</code></strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestDatasourceApplicationTests</span> &#123;</span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line">UserService userService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line">ProductService productService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(<span class="number">1L</span>);</span><br><span class="line"><span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productService.getById(<span class="number">1L</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;User = &quot;</span> + user);</span><br><span class="line">System.out.println(<span class="string">&quot;Product = &quot;</span> + product);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522113049945.png" alt="image-20220522113049945"></p><h1 id="ä¹ã€MyBatisXæ’ä»¶"><a href="#ä¹ã€MyBatisXæ’ä»¶" class="headerlink" title="ä¹ã€MyBatisXæ’ä»¶"></a>ä¹ã€MyBatisXæ’ä»¶</h1><blockquote><p>MyBatis-Plusä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„mapperå’Œserviceæ¨¡æ¿ï¼Œèƒ½å¤Ÿå¤§å¤§çš„æé«˜å¼€å‘æ•ˆç‡ã€‚</p><p>ä½†æ˜¯åœ¨çœŸæ­£å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒMyBatis-Pluså¹¶ä¸èƒ½ä¸ºæˆ‘ä»¬è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œä¾‹å¦‚ä¸€äº›å¤æ‚çš„SQLï¼Œå¤šè¡¨è”æŸ¥ï¼Œæˆ‘ä»¬å°±éœ€è¦è‡ªå·±å»ç¼–å†™ä»£ç å’ŒSQLè¯­å¥ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¿«é€Ÿçš„è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨MyBatisXæ’ä»¶ã€‚</p><p>MyBatisXä¸€æ¬¾åŸºäº IDEA çš„å¿«é€Ÿå¼€å‘æ’ä»¶ï¼Œä¸ºæ•ˆç‡è€Œç”Ÿã€‚</p></blockquote><h2 id="1-å®‰è£…MyBatisXæ’ä»¶"><a href="#1-å®‰è£…MyBatisXæ’ä»¶" class="headerlink" title="1.å®‰è£…MyBatisXæ’ä»¶"></a>1.å®‰è£…MyBatisXæ’ä»¶</h2><blockquote><p><strong>æ‰“å¼€IDEAï¼ŒFile-&gt; Setteings-&gt;Plugins-&gt;MyBatisXï¼Œæœç´¢æ æœç´¢MyBatisXç„¶åå®‰è£…ã€‚</strong></p></blockquote><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522115718361.png" alt="image-20220522115718361"></p><h2 id="2-å¿«é€Ÿç”Ÿæˆä»£ç "><a href="#2-å¿«é€Ÿç”Ÿæˆä»£ç " class="headerlink" title="2.å¿«é€Ÿç”Ÿæˆä»£ç "></a>2.å¿«é€Ÿç”Ÿæˆä»£ç </h2><ul><li><p>æ–°å»ºä¸€ä¸ªSpring Booté¡¹ç›®å¼•å…¥ä¾èµ–ï¼ˆåˆ›å»ºå·¥ç¨‹æ—¶è®°å¾—å‹¾é€‰lombokåŠmysqlé©±åŠ¨ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dynamic-datasource-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>é…ç½®æ•°æ®æºä¿¡æ¯</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis_plus?characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">132537</span></span><br></pre></td></tr></table></figure></li><li><p>åœ¨IDEAä¸­ä¸æ•°æ®åº“å»ºç«‹é“¾æ¥</p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522120758740.png" alt="image-20220522120758740"></p></li><li><p>å¡«å†™æ•°æ®åº“ä¿¡æ¯å¹¶ä¿å­˜</p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522121434468.png" alt="image-20220522121434468"></p></li><li><p>æ‰¾åˆ°æˆ‘ä»¬éœ€è¦ç”Ÿæˆçš„è¡¨ç‚¹å‡»å³é”®</p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522121613909.png" alt="image-20220522121613909"></p></li><li><p>å¡«å†™å®Œä¿¡æ¯ä»¥åä¸‹ä¸€æ­¥</p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522122127649.png" alt="image-20220522122127649"></p></li><li><p>ç»§ç»­å¡«å†™ä¿¡æ¯</p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522122525598.png" alt="image-20220522122525598"></p></li><li><p><strong>å¤§åŠŸå‘Šæˆï¼ˆçœŸç‰¹ä¹ˆå¥½ç”¨yydsï¼‰</strong></p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522122612334.png" alt="image-20220522122612334"></p></li></ul><h2 id="3-å¿«é€Ÿç”ŸæˆCRUD"><a href="#3-å¿«é€Ÿç”ŸæˆCRUD" class="headerlink" title="3.å¿«é€Ÿç”ŸæˆCRUD"></a>3.å¿«é€Ÿç”ŸæˆCRUD</h2><blockquote><p>MyBaitsXå¯ä»¥æ ¹æ®æˆ‘ä»¬åœ¨Mapperæ¥å£ä¸­è¾“å…¥çš„æ–¹æ³•åå¿«é€Ÿå¸®æˆ‘ä»¬ç”Ÿæˆå¯¹åº”çš„sqlè¯­å¥</p></blockquote><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522123143852.png" alt="image-20220522123143852"></p><p><img src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522123202310.png" alt="image-20220522123202310"></p><h1 id="åã€è‡´è°¢"><a href="#åã€è‡´è°¢" class="headerlink" title="åã€è‡´è°¢"></a>åã€è‡´è°¢</h1><p>æ„Ÿè°¢å°šç¡…è°·æ¨åšè¶…è€å¸ˆï¼š<a href="https://www.bilibili.com/video/BV12R4y157Be?p=1">https://www.bilibili.com/video/BV12R4y157Be?p=1</a></p><p>æ„Ÿè°¢MyBatis-Plusä½œè€…è‹ç±³è±†ï¼š<a href="https://baomidou.com/">https://baomidou.com/</a></p><p>æ„Ÿè°¢è‡ªå·±åˆåšæŒå­¦ä¹ äº†ä¸€é—¨è¯¾ç¨‹ï¼š<a href="https://www.oz6.cn/">https://www.oz6.cn/</a></p><h1 id="ä»£ç ç”Ÿæˆå™¨ï¼š"><a href="#ä»£ç ç”Ÿæˆå™¨ï¼š" class="headerlink" title="ä»£ç ç”Ÿæˆå™¨ï¼š"></a>ä»£ç ç”Ÿæˆå™¨ï¼š</h1><h2 id="MyBatis-Plus-é€†å‘ç¨‹ä¾èµ–ï¼š"><a href="#MyBatis-Plus-é€†å‘ç¨‹ä¾èµ–ï¼š" class="headerlink" title="MyBatis-Plus é€†å‘ç¨‹ä¾èµ–ï¼š"></a>MyBatis-Plus é€†å‘ç¨‹ä¾èµ–ï¼š</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--MyBatis-Plus é€†å‘å·¥ç¨‹ä¾èµ–ä»£ç ç”Ÿæˆå™¨çš„æ ¸å¿ƒä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä¸€ä¸ªæ¨¡æ¿çš„ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.freemarker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.31<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ç”Ÿæˆä»£ç ï¼š"><a href="#ç”Ÿæˆä»£ç ï¼š" class="headerlink" title="ç”Ÿæˆä»£ç ï¼š"></a>ç”Ÿæˆä»£ç ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastAutoGeneratorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®æˆ‘ä»¬éœ€è¦åˆ›å»ºåœ¨å“ªçš„è·¯å¾„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;/Users/luxiaogen/Documents/RoadTo2w/Java/å°šç¡…è°·/MyBatisPlus-2022/demo&quot;</span>;</span><br><span class="line">        <span class="comment">// è¿™é‡Œæˆ‘æ˜¯mysql8 5ç‰ˆæœ¬å¯ä»¥æ¢æˆ jdbc:mysql://localhost:3306/mybatis_plus?characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">        FastAutoGenerator.create(<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis_plus?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>)</span><br><span class="line">                .globalConfig(builder -&gt; &#123;</span><br><span class="line">                    builder.author(<span class="string">&quot;atguigu&quot;</span>) <span class="comment">// è®¾ç½®ä½œè€…</span></span><br><span class="line">                    <span class="comment">// .enableSwagger() // å¼€å¯ swagger æ¨¡å¼</span></span><br><span class="line">                    .fileOverride() <span class="comment">// è¦†ç›–å·²ç”Ÿæˆæ–‡ä»¶</span></span><br><span class="line">                    .outputDir(path); <span class="comment">// æŒ‡å®šè¾“å‡ºç›®å½•</span></span><br><span class="line">                &#125;)</span><br><span class="line">                .packageConfig(builder -&gt; &#123;</span><br><span class="line">                    builder.parent(<span class="string">&quot;com.atguigu&quot;</span>) <span class="comment">// è®¾ç½®çˆ¶åŒ…å</span></span><br><span class="line">                            .moduleName(<span class="string">&quot;mybatisplus&quot;</span>) <span class="comment">// è®¾ç½®çˆ¶åŒ…æ¨¡å—å</span></span><br><span class="line">                            .pathInfo(Collections.singletonMap(OutputFile.mapperXml, path)); <span class="comment">// è®¾ç½®mapperXmlç”Ÿæˆè·¯å¾„</span></span><br><span class="line">                &#125;)</span><br><span class="line">                .strategyConfig(builder -&gt; &#123;</span><br><span class="line">                    builder.addInclude(<span class="string">&quot;t_user&quot;</span>) <span class="comment">// è®¾ç½®éœ€è¦ç”Ÿæˆçš„è¡¨å</span></span><br><span class="line">                            .addTablePrefix(<span class="string">&quot;t_&quot;</span>, <span class="string">&quot;c_&quot;</span>); <span class="comment">// è®¾ç½®è¿‡æ»¤è¡¨å‰ç¼€</span></span><br><span class="line">                &#125;).templateEngine(<span class="keyword">new</span> <span class="title class_">FreemarkerTemplateEngine</span>()) <span class="comment">// ä½¿ç”¨Freemarker å¼•æ“æ¨¡æ¿ï¼Œé»˜è®¤çš„æ˜¯Velocityå¼•æ“æ¨¡æ¿</span></span><br><span class="line">                .execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å°ç»“ï¼š"><a href="#å°ç»“ï¼š" class="headerlink" title="å°ç»“ï¼š"></a>å°ç»“ï¼š</h1><h4 id="MyBatisPlus-æ·»åŠ æ–°çš„å®ä½“ï¼š"><a href="#MyBatisPlus-æ·»åŠ æ–°çš„å®ä½“ï¼š" class="headerlink" title="MyBatisPlus æ·»åŠ æ–°çš„å®ä½“ï¼š"></a>MyBatisPlus æ·»åŠ æ–°çš„å®ä½“ï¼š</h4><p>â€‹1.åœ¨entityåŒ…ä¸­ç¼–å†™å®ä½“ç±»ï¼Œæ·»åŠ @Dateæ³¨è§£</p><p>â€‹2.åœ¨mapperåŒ…ä¸­æ·»åŠ å¯¹åº”çš„mapperæ¥å£</p><p>â€‹éœ€è¦ç»§æ‰¿BaseMapperï¼šextends BaseMapper&lt;å®ä½“ç±»å&gt;</p><p>å› ä¸ºåœ¨éœ€è¦å¯¹æ•°æ®åº“è¿›è¡Œå®ä½“ç±»ç›¸åº”çš„è¡¨çš„æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°xxMapperçš„å®ç°ç±»ï¼Œ</p><p>ç„¶è€ŒxxMapperæ˜¯æ¥å£ï¼Œæ²¡æœ‰å®ç°ç±»ï¼Œå› æ­¤æˆ‘ä»¬åœ¨@Autowiredå®šä¹‰çš„å®ç°ç±»åä¼šæŠ¥é”™ï¼Œ</p><p>å› æ­¤æˆ‘ä»¬éœ€è¦<strong>åœ¨Mapperæ¥å£ä¸­æ·»åŠ @Repositoryæ³¨è§£</strong></p><p>â€‹3.</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ç›¸å…³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis-Plus </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMæ¢ç©¶</title>
      <link href="/2023/05/26/JVM%E6%8E%A2%E7%A9%B6/"/>
      <url>/2023/05/26/JVM%E6%8E%A2%E7%A9%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="JVMï¼š"><a href="#JVMï¼š" class="headerlink" title="JVMï¼š"></a>JVMï¼š</h1><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728164853677.png" alt="image-20230728164853677"></p><h3 id="è¿è¡Œè¿‡ç¨‹ï¼š"><a href="#è¿è¡Œè¿‡ç¨‹ï¼š" class="headerlink" title="è¿è¡Œè¿‡ç¨‹ï¼š"></a>è¿è¡Œè¿‡ç¨‹ï¼š</h3><p>â€‹Java æºæ–‡ä»¶ï¼Œé€šè¿‡ç¼–è¯‘å™¨ï¼Œèƒ½å¤Ÿç”Ÿäº§ç›¸åº”çš„.Class æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å­—èŠ‚ç æ–‡ä»¶ï¼Œè€Œå­—èŠ‚ç æ–‡ä»¶åˆé€šè¿‡ <strong>Java è™šæ‹Ÿæœºä¸­çš„è§£é‡Šå™¨</strong>ï¼Œç¼–è¯‘æˆç‰¹å®šæœºå™¨ä¸Šçš„æœºå™¨ç  ã€‚</p><p>â‘  Java æºæ–‡ä»¶(.java)â€”-&gt;ç¼–è¯‘å™¨(javac)â€”-&gt;å­—èŠ‚ç æ–‡ä»¶(.class)</p><p>â‘¡ å­—èŠ‚ç æ–‡ä»¶(.class)â€”-&gt;JVMâ€”-&gt;æœºå™¨ç </p><h3 id="1-1çº¿ç¨‹"><a href="#1-1çº¿ç¨‹" class="headerlink" title="1.1çº¿ç¨‹"></a>1.1çº¿ç¨‹</h3><p>â€‹è¿™é‡Œæ‰€è¯´çš„çº¿ç¨‹æŒ‡ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹å®ä½“ã€‚ JVM å…è®¸ä¸€ä¸ªåº”ç”¨å¹¶å‘æ‰§è¡Œå¤šä¸ªçº¿ç¨‹ã€‚<u>Hotspot JVM ä¸­çš„ Java çº¿ç¨‹ä¸åŸç”Ÿæ“ä½œç³»ç»Ÿçº¿ç¨‹æœ‰ç›´æ¥çš„æ˜ å°„å…³ç³»ã€‚</u> <strong>å½“çº¿ç¨‹æœ¬åœ°å­˜å‚¨ã€ç¼“å†²åŒºåˆ†é…ã€åŒæ­¥å¯¹è±¡ã€æ ˆã€ç¨‹åºè®¡æ•°å™¨ç­‰å‡†å¤‡å¥½ä»¥åï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹ã€‚Java çº¿ç¨‹ç»“æŸï¼ŒåŸç”Ÿçº¿ç¨‹éšä¹‹è¢«å›æ”¶ã€‚æ“ä½œç³»ç»Ÿè´Ÿè´£è°ƒåº¦æ‰€æœ‰çº¿ç¨‹ï¼Œå¹¶æŠŠå®ƒä»¬åˆ†é…åˆ°ä»»ä½•å¯ç”¨çš„ CPU ä¸Šã€‚å½“åŸç”Ÿçº¿ç¨‹åˆå§‹åŒ–å®Œæ¯•ï¼Œå°±ä¼šè°ƒç”¨ Java çº¿ç¨‹çš„ run() æ–¹æ³•ã€‚å½“çº¿ç¨‹ç»“æŸæ—¶ï¼Œä¼šé‡Šæ”¾åŸç”Ÿçº¿ç¨‹å’Œ Java çº¿ç¨‹çš„æ‰€æœ‰èµ„æºã€‚</strong></p><h3 id="1-2JVMå†…å­˜åŒºåŸŸ"><a href="#1-2JVMå†…å­˜åŒºåŸŸ" class="headerlink" title="1.2JVMå†…å­˜åŒºåŸŸ"></a>1.2JVMå†…å­˜åŒºåŸŸ</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728184623227.png" alt="image-20230728184623227"></p><p>JVMå†…å­˜åŒºåŸŸåˆ†ä¸ºï¼š</p><ul><li>çº¿ç¨‹ç§æœ‰åŒºåŸŸ<ul><li>ç¨‹åºè®¡æ•°å™¨</li><li>è™šæ‹Ÿæœºæ ˆ</li><li>æœ¬åœ°æ–¹æ³•åŒº</li></ul></li><li>çº¿ç¨‹å…±äº«åŒºåŸŸï¼ˆJAVA8ä¹‹å‰ï¼‰<ul><li>JAVA<strong>å †</strong></li><li>æ–¹æ³•åŒº<ul><li>å¸¸é‡æ± </li></ul></li></ul></li><li>ç›´æ¥å†…å­˜</li></ul><ol><li><p><strong>çº¿ç¨‹ç§æœ‰æ•°æ®åŒºåŸŸç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒ, ä¾èµ–ç”¨æˆ·çº¿ç¨‹çš„å¯åŠ¨&#x2F;ç»“æŸ è€Œ åˆ›å»º&#x2F;é”€æ¯</strong>(åœ¨ HotspotVM å†…, <u>æ¯ä¸ªçº¿ç¨‹éƒ½ä¸æ“ä½œç³»ç»Ÿçš„æœ¬åœ°çº¿ç¨‹ç›´æ¥æ˜ å°„</u>, å› æ­¤è¿™éƒ¨åˆ†å†…å­˜åŒºåŸŸçš„å­˜&#x2F;å¦è·Ÿéšæœ¬åœ°çº¿ç¨‹çš„ç”Ÿ&#x2F;æ­»å¯¹åº”)ã€‚</p></li><li><p><strong>çº¿ç¨‹å…±äº«åŒºåŸŸ</strong>éšè™šæ‹Ÿæœºçš„ å¯åŠ¨&#x2F;å…³é—­ è€Œ åˆ›å»º&#x2F;é”€æ¯ </p></li><li><p><strong>ç›´æ¥å†…å­˜</strong>å¹¶ä¸æ˜¯ JVM è¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†, ä½†ä¹Ÿä¼šè¢«é¢‘ç¹çš„ä½¿ç”¨</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230728185217834.png" alt="image-20230728185217834"></p><h4 id="1-2-1ç¨‹åºè®¡æ•°å™¨-çº¿ç¨‹ç§æœ‰"><a href="#1-2-1ç¨‹åºè®¡æ•°å™¨-çº¿ç¨‹ç§æœ‰" class="headerlink" title="1.2.1ç¨‹åºè®¡æ•°å™¨(çº¿ç¨‹ç§æœ‰)"></a>1.2.1ç¨‹åºè®¡æ•°å™¨(çº¿ç¨‹ç§æœ‰)</h4><ul><li>ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´, æ˜¯<strong>å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨</strong>ï¼Œæ¯æ¡çº¿ç¨‹éƒ½è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œè¿™ç±»å†…å­˜ä¹Ÿç§°ä¸ºâ€œçº¿ç¨‹ç§æœ‰â€ çš„å†…å­˜ã€‚</li><li>æ­£åœ¨æ‰§è¡Œ java æ–¹æ³•çš„è¯ï¼Œè®¡æ•°å™¨è®°å½•çš„æ˜¯è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼ˆå½“å‰æŒ‡ä»¤çš„åœ°å€ï¼‰ã€‚å¦‚æœè¿˜æ˜¯ Native æ–¹æ³•ï¼Œåˆ™ä¸ºç©ºã€‚</li></ul><h4 id="1-2-2è™šæ‹Ÿæœºæ ˆ-çº¿ç¨‹ç§æœ‰"><a href="#1-2-2è™šæ‹Ÿæœºæ ˆ-çº¿ç¨‹ç§æœ‰" class="headerlink" title="1.2.2è™šæ‹Ÿæœºæ ˆ(çº¿ç¨‹ç§æœ‰)"></a>1.2.2è™šæ‹Ÿæœºæ ˆ(çº¿ç¨‹ç§æœ‰)</h4><p>â€‹æ˜¯<strong>æè¿°java<u>æ–¹æ³•</u>æ‰§è¡Œçš„å†…å­˜æ¨¡å‹</strong>ï¼Œæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨äº<u>å­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£</u>ç­‰ä¿¡æ¯ã€‚ æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p><h4 id="1-2-3æœ¬åœ°æ–¹æ³•åŒº-çº¿ç¨‹ç§æœ‰"><a href="#1-2-3æœ¬åœ°æ–¹æ³•åŒº-çº¿ç¨‹ç§æœ‰" class="headerlink" title="1.2.3æœ¬åœ°æ–¹æ³•åŒº(çº¿ç¨‹ç§æœ‰)"></a>1.2.3æœ¬åœ°æ–¹æ³•åŒº(çº¿ç¨‹ç§æœ‰)</h4><p>â€‹æœ¬åœ°æ–¹æ³•åŒºå’Œ è™šæ‹Ÿæœºæ ˆ ä½œç”¨ç±»ä¼¼, åŒºåˆ«æ˜¯<strong>è™šæ‹Ÿæœºæ ˆä¸ºæ‰§è¡Œ Java æ–¹æ³•æœåŠ¡, è€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºNative æ–¹æ³•æœåŠ¡</strong>, å¦‚æœä¸€ä¸ª VM å®ç°ä½¿ç”¨ C-linkage æ¨¡å‹æ¥æ”¯æŒ Native è°ƒç”¨, é‚£ä¹ˆè¯¥æ ˆå°†ä¼šæ˜¯ä¸€ä¸ªC æ ˆï¼Œä½† <u>HotSpot VM ç›´æ¥å°±æŠŠæœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€</u>ã€‚</p><h4 id="1-2-4-å †ï¼ˆHeap-çº¿ç¨‹å…±äº«ï¼‰-è¿è¡Œæ—¶æ•°æ®åŒº"><a href="#1-2-4-å †ï¼ˆHeap-çº¿ç¨‹å…±äº«ï¼‰-è¿è¡Œæ—¶æ•°æ®åŒº" class="headerlink" title="1.2.4. å †ï¼ˆHeap-çº¿ç¨‹å…±äº«ï¼‰-è¿è¡Œæ—¶æ•°æ®åŒº"></a>1.2.4. å †ï¼ˆHeap-çº¿ç¨‹å…±äº«ï¼‰-è¿è¡Œæ—¶æ•°æ®åŒº</h4><p>â€‹æ˜¯è¢«çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œ <strong>åˆ›å»ºçš„<u>å¯¹è±¡å’Œæ•°ç»„</u>éƒ½ä¿å­˜åœ¨ Java å †å†…å­˜ä¸­</strong>ï¼Œä¹Ÿæ˜¯<strong>åƒåœ¾æ”¶é›†å™¨è¿›è¡Œåƒåœ¾æ”¶é›†</strong>çš„æœ€é‡è¦çš„å†…å­˜åŒºåŸŸã€‚ ç”±äºç°ä»£ VM é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•, å› æ­¤ Java å †ä» GC çš„è§’åº¦è¿˜å¯ä»¥ç»†åˆ†ä¸º: æ–°ç”Ÿä»£(Eden åŒºã€ From Survivor åŒºå’Œ To Survivor åŒº)å’Œè€å¹´ä»£ã€‚</p><h4 id="1-2-5-æ–¹æ³•åŒº-x2F-æ°¸ä¹…ä»£ï¼ˆçº¿ç¨‹å…±äº«ï¼‰"><a href="#1-2-5-æ–¹æ³•åŒº-x2F-æ°¸ä¹…ä»£ï¼ˆçº¿ç¨‹å…±äº«ï¼‰" class="headerlink" title="1.2.5. æ–¹æ³•åŒº&#x2F;æ°¸ä¹…ä»£ï¼ˆçº¿ç¨‹å…±äº«ï¼‰"></a>1.2.5. æ–¹æ³•åŒº&#x2F;æ°¸ä¹…ä»£ï¼ˆçº¿ç¨‹å…±äº«ï¼‰</h4><p>â€‹å³æˆ‘ä»¬å¸¸è¯´çš„æ°¸ä¹…ä»£(Permanent Generation), ç”¨äºå­˜å‚¨è¢« JVM åŠ è½½çš„<strong>ç±»ä¿¡æ¯ã€ å¸¸é‡ã€ é™æ€å˜é‡ã€ å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç </strong>ç­‰æ•°æ®. </p><p>â€‹HotSpot VMæŠŠGCåˆ†ä»£æ”¶é›†æ‰©å±•è‡³æ–¹æ³•åŒº, å³ä½¿ç”¨Javaå †çš„æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒº, è¿™æ · HotSpot çš„åƒåœ¾æ”¶é›†å™¨å°±å¯ä»¥åƒç®¡ç† Java å †ä¸€æ ·ç®¡ç†è¿™éƒ¨åˆ†å†…å­˜,è€Œä¸å¿…ä¸ºæ–¹æ³•åŒºå¼€å‘ä¸“é—¨çš„å†…å­˜ç®¡ç†å™¨(æ°¸ä¹…ä»£çš„å†…å­˜å›æ”¶çš„ä¸»è¦ç›®æ ‡æ˜¯é’ˆå¯¹<u><strong>å¸¸é‡æ± çš„å›æ”¶å’Œç±»å‹çš„å¸è½½</strong></u>, å› æ­¤æ”¶ç›Šä¸€èˆ¬å¾ˆå°)ã€‚</p><p>â€‹è¿è¡Œæ—¶**<u>å¸¸é‡æ± </u><strong>ï¼ˆRuntime Constant Poolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚ Class æ–‡ä»¶ä¸­é™¤äº†æœ‰</strong>ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ç­‰ä¿¡æ¯**å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼ˆConstant Pool Tableï¼‰ï¼Œç”¨äº<u>å­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨</u>ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚ Java è™šæ‹Ÿæœºå¯¹ Class æ–‡ä»¶çš„æ¯ä¸€éƒ¨åˆ†ï¼ˆè‡ªç„¶ä¹ŸåŒ…æ‹¬å¸¸é‡æ± ï¼‰çš„æ ¼å¼éƒ½æœ‰ä¸¥æ ¼çš„è§„å®šï¼Œæ¯ä¸€ä¸ªå­—èŠ‚ç”¨äºå­˜å‚¨å“ªç§æ•°æ®éƒ½å¿…é¡»ç¬¦åˆè§„èŒƒä¸Šçš„è¦æ±‚ï¼Œè¿™æ ·æ‰ä¼šè¢«è™šæ‹Ÿæœºè®¤å¯ã€è£…è½½å’Œæ‰§è¡Œã€‚</p><h3 id="1-3-JVM-è¿è¡Œæ—¶å†…å­˜"><a href="#1-3-JVM-è¿è¡Œæ—¶å†…å­˜" class="headerlink" title="1.3 JVM è¿è¡Œæ—¶å†…å­˜"></a>1.3 JVM è¿è¡Œæ—¶å†…å­˜</h3><p>javaå †å¯ä»¥ç»†åˆ†ä¸º</p><ul><li><p><em>æ–°ç”Ÿä»£</em>â€”â€”ç”¨äºå­˜æ”¾æ–°ç”Ÿçš„å¯¹è±¡ï¼Œ<strong>ä¸€èˆ¬å æ®1&#x2F;3å †ç©ºé—´</strong>ï¼Œç”±äºé¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œæ‰€ä»¥<strong>æ–°ç”Ÿä»£ä¼šé¢‘ç¹è§¦å‘MinorGC è¿›è¡Œåƒåœ¾å›æ”¶</strong>ï¼Œæ–°ç”Ÿä»£ç»†åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªåŒºåŸŸï¼š</p><ul><li><p><strong>EdenåŒº</strong>ï¼š<strong>Java æ–°å¯¹è±¡çš„å‡ºç”Ÿåœ°</strong>ï¼ˆå¦‚æœæ–°åˆ›å»ºçš„å¯¹è±¡å ç”¨å†…å­˜å¾ˆå¤§ï¼Œåˆ™ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼‰ã€‚<u>å½“ Eden åŒºå†…å­˜ä¸å¤Ÿçš„æ—¶å€™å°±ä¼šè§¦å‘ MinorGCï¼Œå¯¹<strong>æ–°ç”Ÿä»£åŒº</strong>è¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ã€‚</u></p></li><li><p><strong>ServivorFromåŒº</strong>ï¼šä¸Šä¸€æ¬¡ GC çš„å¹¸å­˜è€…ï¼Œä½œä¸ºè¿™ä¸€æ¬¡ GC çš„è¢«æ‰«æè€…ã€‚</p></li><li><p><strong>ServivorToåŒº</strong>ï¼š<u>ä¿ç•™</u>äº†ä¸€æ¬¡ MinorGC è¿‡ç¨‹ä¸­çš„<u>å¹¸å­˜è€…</u></p><ul><li><p>MinorGC çš„è¿‡ç¨‹ï¼ˆå¤åˆ¶-&gt;æ¸…ç©º-&gt;äº’æ¢ï¼‰MinorGC é‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ã€‚</p><ul><li><p>1ï¼š edenã€ servicorFrom å¤åˆ¶åˆ° ServicorToï¼Œå¹´é¾„+1ã€‚<br>é¦–å…ˆï¼ŒæŠŠ Eden å’Œ ServivorFrom åŒºåŸŸä¸­å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ° ServicorTo åŒºåŸŸï¼ˆ<u>å¦‚æœæœ‰å¯¹è±¡çš„å¹´é¾„ä»¥åŠè¾¾åˆ°äº†è€å¹´çš„æ ‡å‡†ï¼Œåˆ™èµ‹å€¼åˆ°è€å¹´ä»£åŒº</u>ï¼‰ï¼ŒåŒæ—¶æŠŠè¿™äº›å¯¹è±¡çš„å¹´é¾„+1ï¼ˆ<u>å¦‚æœ ServicorTo ä¸å¤Ÿä½ç½®äº†å°±æ”¾åˆ°è€å¹´åŒº</u>ï¼‰ï¼›</p></li><li><p>2ï¼š æ¸…ç©º edenã€ servicorFrom</p><p>â€‹ç„¶åï¼Œæ¸…ç©º Eden å’Œ ServicorFrom ä¸­çš„å¯¹è±¡ï¼›</p></li><li><p>3ï¼š ServicorTo å’Œ ServicorFrom äº’æ¢</p><p>â€‹æœ€åï¼Œ ServicorTo å’Œ ServicorFrom äº’æ¢ï¼ŒåŸ ServicorTo æˆä¸ºä¸‹ä¸€æ¬¡ GC æ—¶çš„ ServicorFromåŒºã€‚</p></li></ul></li></ul></li></ul></li><li><p><em>è€å¹´ä»£</em></p></li></ul><p>â€‹<strong>ä¸»è¦å­˜æ”¾åº”ç”¨ç¨‹åºä¸­ç”Ÿå‘½å‘¨æœŸé•¿çš„å†…å­˜å¯¹è±¡ã€‚</strong></p><p>â€‹è€å¹´ä»£çš„å¯¹è±¡æ¯”è¾ƒç¨³å®šï¼Œæ‰€ä»¥ MajorGC ä¸ä¼šé¢‘ç¹æ‰§è¡Œã€‚åœ¨è¿›è¡Œ MajorGC å‰ä¸€èˆ¬éƒ½å…ˆè¿›è¡Œäº†ä¸€æ¬¡ MinorGCï¼Œä½¿å¾—æœ‰æ–°ç”Ÿä»£çš„å¯¹è±¡æ™‹èº«å…¥è€å¹´ä»£ï¼Œå¯¼è‡´ç©ºé—´ä¸å¤Ÿç”¨æ—¶æ‰è§¦å‘ã€‚<strong>å½“æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´åˆ†é…ç»™æ–°åˆ›å»ºçš„è¾ƒå¤§å¯¹è±¡æ—¶ä¹Ÿä¼šæå‰è§¦å‘ä¸€æ¬¡ MajorGC è¿›è¡Œåƒåœ¾å›æ”¶è…¾å‡ºç©ºé—´</strong>ã€‚</p><p>â€‹MajorGC é‡‡ç”¨<strong>æ ‡è®°æ¸…é™¤ç®—æ³•</strong>ï¼šé¦–å…ˆæ‰«æä¸€æ¬¡æ‰€æœ‰è€å¹´ä»£ï¼Œ<u>æ ‡è®°å‡ºå­˜æ´»çš„å¯¹è±¡ï¼Œç„¶åå›æ”¶æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡</u>ã€‚ MajorGC çš„è€—æ—¶æ¯”è¾ƒé•¿ï¼Œå› ä¸ºè¦æ‰«æå†å›æ”¶ã€‚ MajorGC ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œä¸ºäº†å‡å°‘å†…å­˜æŸè€—ï¼Œæˆ‘ä»¬ä¸€èˆ¬éœ€è¦è¿›è¡Œåˆå¹¶æˆ–è€…æ ‡è®°å‡ºæ¥æ–¹ä¾¿ä¸‹æ¬¡ç›´æ¥åˆ†é…ã€‚å½“è€å¹´ä»£ä¹Ÿæ»¡äº†è£…ä¸ä¸‹çš„æ—¶å€™ï¼Œå°±ä¼šæŠ›å‡º OOMï¼ˆOut of Memoryï¼‰å¼‚å¸¸ã€‚</p><ul><li>!!!<em>æ°¸ä¹…ä»£</em></li></ul><p>â€‹æŒ‡å†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºåŸŸï¼Œä¸»è¦å­˜æ”¾ <strong>Class å’Œ Metaï¼ˆå…ƒæ•°æ®ï¼‰</strong>çš„ä¿¡æ¯,<u>Class åœ¨è¢«åŠ è½½çš„æ—¶å€™è¢«æ”¾å…¥æ°¸ä¹…åŒºåŸŸï¼Œ å®ƒå’Œå’Œå­˜æ”¾å®ä¾‹çš„åŒºåŸŸä¸åŒ,GC ä¸ä¼šåœ¨ä¸»ç¨‹åºè¿è¡ŒæœŸå¯¹æ°¸ä¹…åŒºåŸŸè¿›è¡Œæ¸…ç†ã€‚</u>æ‰€ä»¥è¿™ä¹Ÿå¯¼è‡´äº†<u>æ°¸ä¹…ä»£çš„åŒºåŸŸä¼šéšç€åŠ è½½çš„ Class çš„å¢å¤šè€Œèƒ€æ»¡ï¼Œæœ€</u>ç»ˆæŠ›å‡º OOM å¼‚å¸¸ã€‚</p><p>ï¼ï¼ï¼åœ¨JDK 1.8 çš„æ—¶å€™ï¼Œ<code>HotSpot</code>çš„æ°¸ä¹…ä»£è¢«å½»åº•ç§»é™¤ ï¼Œè¢«ä¸€ä¸ªç§°ä¸ºâ€œå…ƒæ•°æ®åŒºâ€ï¼ˆå…ƒç©ºé—´ï¼‰çš„åŒºåŸŸæ‰€å–ä»£ã€‚å…ƒç©ºé—´çš„æœ¬è´¨å’Œæ°¸ä¹…ä»£ç±»ä¼¼ï¼Œå…ƒç©ºé—´ä¸æ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼š <strong>å…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚</strong>å› æ­¤ï¼Œ<u>é»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜é™åˆ¶ã€‚ ç±»çš„å…ƒæ•°æ®æ”¾å…¥ nativememory, å­—ç¬¦ä¸²æ± å’Œç±»çš„é™æ€å˜é‡æ”¾å…¥ java å †ä¸­ï¼Œ è¿™æ ·å¯ä»¥åŠ è½½å¤šå°‘ç±»çš„å…ƒæ•°æ®å°±ä¸å†ç”±MaxPermSize æ§åˆ¶, è€Œç”±ç³»ç»Ÿçš„å®é™…å¯ç”¨ç©ºé—´æ¥æ§åˆ¶ã€‚</u></p><h3 id="é¢è¯•é¢˜ï¼šè¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«ï¼Ÿ"><a href="#é¢è¯•é¢˜ï¼šè¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="é¢è¯•é¢˜ï¼šè¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«ï¼Ÿ"></a>é¢è¯•é¢˜ï¼šè¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«ï¼Ÿ</h3><ol><li>**<u>å †çš„ç‰©ç†åœ°å€åˆ†é…æ˜¯ä¸è¿ç»­çš„ï¼Œæ€§èƒ½è¾ƒæ…¢</u>**ï¼›æ ˆçš„ç‰©ç†åœ°å€åˆ†é…æ˜¯è¿ç»­çš„ï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒå¿«ã€‚</li><li>å †å­˜æ”¾çš„æ˜¯å¯¹è±¡çš„å®ä¾‹å’Œæ•°ç»„ï¼›æ ˆå­˜æ”¾çš„æ˜¯å±€éƒ¨å˜é‡ï¼Œæ“ä½œæ•°æ ˆï¼Œè¿”å›ç»“æœç­‰ã€‚</li><li>å †æ˜¯çº¿ç¨‹å…±äº«çš„ï¼›æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</li></ol><h3 id="ğŸŒŸJAVA8åŠä»¥åï¼ŒJVMå†…å­˜åˆ†å¸ƒï¼š"><a href="#ğŸŒŸJAVA8åŠä»¥åï¼ŒJVMå†…å­˜åˆ†å¸ƒï¼š" class="headerlink" title="ğŸŒŸJAVA8åŠä»¥åï¼ŒJVMå†…å­˜åˆ†å¸ƒï¼š"></a>ğŸŒŸJAVA8åŠä»¥åï¼ŒJVMå†…å­˜åˆ†å¸ƒï¼š</h3><p>![image-20230821101241186](&#x2F;Users&#x2F;donn&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230821101241186.png)</p><h3 id="é¢è¯•é¢˜ï¼šJava-ä¸­-OutOfMemoryErrorå’ŒStackOverFlowErrorçš„åŒºåˆ«ï¼Ÿ"><a href="#é¢è¯•é¢˜ï¼šJava-ä¸­-OutOfMemoryErrorå’ŒStackOverFlowErrorçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="é¢è¯•é¢˜ï¼šJava ä¸­ OutOfMemoryErrorå’ŒStackOverFlowErrorçš„åŒºåˆ«ï¼Ÿ"></a>é¢è¯•é¢˜ï¼šJava ä¸­ OutOfMemoryErrorå’ŒStackOverFlowErrorçš„åŒºåˆ«ï¼Ÿ</h3><ul><li><p>OutOfMemoryErrorï¼ˆå†…å­˜æº¢å‡ºé”™è¯¯ï¼‰ï¼šå½“Javaç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ— æ³•åˆ†é…è¶³å¤Ÿçš„å†…å­˜ç©ºé—´æ—¶ï¼Œå°±ä¼šæŠ›å‡ºOutOfMemoryErrorã€‚è¿™ç§æƒ…å†µé€šå¸¸å‘ç”Ÿåœ¨åˆ›å»ºè¿‡å¤šçš„å¯¹è±¡ã€æŒç»­å¤§é‡çš„é€’å½’è°ƒç”¨æˆ–è€…å†…å­˜æ³„æ¼ç­‰æƒ…å†µä¸‹ã€‚å¦‚æœç³»ç»Ÿä¸­æœ‰å¤§é‡çš„å¯¹è±¡æ— æ³•åŠæ—¶è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶é‡Šæ”¾ï¼Œå°±å¯èƒ½å¯¼è‡´å†…å­˜è€—å°½ï¼Œä»è€Œè§¦å‘OutOfMemoryErrorã€‚</p></li><li><p>StackOverFlowErrorï¼ˆæ ˆæº¢å‡ºé”™è¯¯ï¼‰ï¼šå½“ä¸€ä¸ªçº¿ç¨‹çš„æ–¹æ³•è°ƒç”¨å †æ ˆè¶…å‡ºäº†æ ˆçš„æœ€å¤§æ·±åº¦é™åˆ¶æ—¶ï¼Œå°±ä¼šæŠ›å‡ºStackOverFlowErrorã€‚è¿™ç§æƒ…å†µé€šå¸¸å‘ç”Ÿåœ¨æ–¹æ³•é€’å½’è°ƒç”¨è¿‡å¤šæˆ–è€…æ­»å¾ªç¯åµŒå¥—ç­‰æƒ…å†µä¸‹ã€‚å½“æ–¹æ³•è°ƒç”¨çš„å±‚çº§è¿‡æ·±ï¼Œæ ˆç©ºé—´è¢«è€—å°½ï¼Œå°±ä¼šè§¦å‘StackOverFlowErrorã€‚</p></li></ul><p>æ€»ç»“èµ·æ¥ï¼Œ<strong>OutOfMemoryErroræŒ‡çš„æ˜¯ç¨‹åºæ— æ³•åˆ†é…åˆ°è¶³å¤Ÿçš„ <em>å †å†…å­˜</em> ç©ºé—´</strong>ï¼Œè€ŒStackOverFlowErroråˆ™æ˜¯æŒ‡æ–¹æ³•è°ƒç”¨é“¾è¿‡äºæ·±å…¥å¯¼è‡´**<u>æ ˆç©ºé—´æº¢å‡º</u>**ã€‚ä¸¤è€…çš„è§¦å‘æ¡ä»¶å’ŒåŸå› ä¸åŒï¼Œä½†éƒ½æç¤ºäº†Javaç¨‹åºåœ¨å†…å­˜ç®¡ç†æˆ–æ–¹æ³•è°ƒç”¨æ–¹é¢å‡ºç°äº†é—®é¢˜ï¼Œå¹¶ä¸”åœ¨å¤„ç†ä¸Šéœ€è¦è€ƒè™‘ç›¸åº”çš„è°ƒæ•´å’Œä¼˜åŒ–ã€‚</p><h3 id="1-4åƒåœ¾å›æ”¶ä¸ç®—æ³•"><a href="#1-4åƒåœ¾å›æ”¶ä¸ç®—æ³•" class="headerlink" title="1.4åƒåœ¾å›æ”¶ä¸ç®—æ³•"></a>1.4åƒåœ¾å›æ”¶ä¸ç®—æ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729200359311.png" alt="image-20230729200359311"></p><h4 id="1-4-1å¦‚ä½•ç¡®å®šåƒåœ¾"><a href="#1-4-1å¦‚ä½•ç¡®å®šåƒåœ¾" class="headerlink" title="1.4.1å¦‚ä½•ç¡®å®šåƒåœ¾"></a>1.4.1å¦‚ä½•ç¡®å®šåƒåœ¾</h4><h5 id="1-4-1-1å¼•ç”¨è®¡æ•°æ³•"><a href="#1-4-1-1å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="1.4.1.1å¼•ç”¨è®¡æ•°æ³•"></a>1.4.1.1å¼•ç”¨è®¡æ•°æ³•</h5><p>â€‹ä¸€ä¸ªå¯¹è±¡å¦‚æœæ²¡æœ‰ä»»ä½•ä¸ä¹‹å…³è”çš„å¼•ç”¨ï¼Œ å³ä»–ä»¬çš„å¼•ç”¨è®¡æ•°éƒ½ä¸º 0ï¼Œ åˆ™è¯´æ˜å¯¹è±¡ä¸å¤ªå¯èƒ½å†è¢«ç”¨åˆ°ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æ˜¯å¯å›æ”¶å¯¹è±¡ã€‚</p><h5 id="1-4-1-2-å¯è¾¾æ€§åˆ†æ"><a href="#1-4-1-2-å¯è¾¾æ€§åˆ†æ" class="headerlink" title="1.4.1.2. å¯è¾¾æ€§åˆ†æ"></a>1.4.1.2. å¯è¾¾æ€§åˆ†æ</h5><p>ä¸ºäº†è§£å†³å¼•ç”¨è®¡æ•°æ³•çš„å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œ Java ä½¿ç”¨äº†å¯è¾¾æ€§åˆ†æçš„æ–¹æ³•ã€‚é€šè¿‡ä¸€ç³»åˆ—çš„â€œGC rootsâ€å¯¹è±¡ä½œä¸ºèµ·ç‚¹æœç´¢ã€‚å¦‚æœåœ¨â€œGC rootsâ€å’Œä¸€ä¸ªå¯¹è±¡ä¹‹é—´æ²¡æœ‰å¯è¾¾è·¯å¾„ï¼Œåˆ™ç§°è¯¥å¯¹è±¡æ˜¯ä¸å¯è¾¾çš„ã€‚</p><p><strong><u>GC Roots æ˜¯ä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ã€‚ç”¨é€šä¿—çš„è¯æ¥è¯´ï¼Œå°±æ˜¯ç¨‹åºæ¥ä¸‹æ¥é€šè¿‡ç›´æ¥å¼•ç”¨æˆ–è€…é—´æ¥å¼•ç”¨ï¼Œèƒ½å¤Ÿè®¿é—®åˆ°çš„æ½œåœ¨è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚</u></strong></p><p>è¦æ³¨æ„çš„æ˜¯ï¼Œä¸å¯è¾¾å¯¹è±¡ä¸ç­‰ä»·äºå¯å›æ”¶å¯¹è±¡ï¼Œ ä¸å¯è¾¾å¯¹è±¡å˜ä¸ºå¯å›æ”¶å¯¹è±¡è‡³å°‘è¦ç»è¿‡ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ã€‚ä¸¤æ¬¡æ ‡è®°åä»ç„¶æ˜¯å¯å›æ”¶å¯¹è±¡ï¼Œåˆ™å°†é¢ä¸´å›æ”¶ã€‚</p><h4 id="1-4-2åƒåœ¾å›æ”¶ç®—æ³•"><a href="#1-4-2åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="1.4.2åƒåœ¾å›æ”¶ç®—æ³•"></a>1.4.2åƒåœ¾å›æ”¶ç®—æ³•</h4><h5 id="1-4-2-1-æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰"><a href="#1-4-2-1-æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰" class="headerlink" title="1.4.2.1 æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰"></a>1.4.2.1 æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰</h5><p>æœ€åŸºç¡€çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œæ ‡æ³¨å’Œæ¸…é™¤ã€‚æ ‡è®°é˜¶æ®µæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œæ¸…é™¤é˜¶æ®µå›æ”¶è¢«æ ‡è®°çš„å¯¹è±¡æ‰€å ç”¨çš„ç©ºé—´ã€‚å¦‚å›¾</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729204014222.png" alt="image-20230729204014222" style="zoom:55%;" /><p>ä»å›¾ä¸­æˆ‘ä»¬å°±å¯ä»¥å‘ç°ï¼Œè¯¥ç®—æ³•æœ€å¤§çš„é—®é¢˜æ˜¯<strong>å†…å­˜ç¢ç‰‡åŒ–ä¸¥é‡</strong>ï¼Œåç»­å¯èƒ½å‘ç”Ÿå¤§å¯¹è±¡ä¸èƒ½æ‰¾åˆ°å¯åˆ©ç”¨ç©ºé—´çš„é—®é¢˜ã€‚</p><h5 id="1-4-2-2-å¤åˆ¶ç®—æ³•ï¼ˆcopyingï¼‰"><a href="#1-4-2-2-å¤åˆ¶ç®—æ³•ï¼ˆcopyingï¼‰" class="headerlink" title="1.4.2.2 å¤åˆ¶ç®—æ³•ï¼ˆcopyingï¼‰"></a>1.4.2.2 å¤åˆ¶ç®—æ³•ï¼ˆcopyingï¼‰</h5><p>ä¸ºäº†è§£å†³ Mark-Sweep ç®—æ³•å†…å­˜ç¢ç‰‡åŒ–çš„ç¼ºé™·è€Œè¢«æå‡ºçš„ç®—æ³•ã€‚<strong>æŒ‰å†…å­˜å®¹é‡å°†å†…å­˜åˆ’åˆ†ä¸ºç­‰å¤§å°çš„ä¸¤å—</strong>ã€‚æ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œ<u><strong>å½“è¿™ä¸€å—å†…å­˜æ»¡åå°†å°šå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šå»ï¼ŒæŠŠå·²ä½¿ç”¨çš„å†…å­˜æ¸…æ‰</strong></u>ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729204457458.png" alt="image-20230729204457458"></p><p>è¿™ç§ç®—æ³•è™½ç„¶<u>å®ç°ç®€å•ï¼Œå†…å­˜æ•ˆç‡é«˜ï¼Œä¸æ˜“äº§ç”Ÿç¢ç‰‡</u>ï¼Œä½†æ˜¯æœ€å¤§çš„é—®é¢˜æ˜¯**<u>å¯ç”¨å†…å­˜è¢«å‹ç¼©åˆ°äº†åŸæœ¬çš„ä¸€åŠ</u>**ã€‚ä¸”å­˜æ´»å¯¹è±¡å¢å¤šçš„è¯ï¼Œ Copying ç®—æ³•çš„æ•ˆç‡ä¼šå¤§å¤§é™ä½ã€‚</p><h5 id="1-4-2-3-æ ‡è®°æ•´ç†ç®—æ³•-Mark-Compact"><a href="#1-4-2-3-æ ‡è®°æ•´ç†ç®—æ³•-Mark-Compact" class="headerlink" title="1.4.2.3 æ ‡è®°æ•´ç†ç®—æ³•(Mark-Compact)"></a>1.4.2.3 æ ‡è®°æ•´ç†ç®—æ³•(Mark-Compact)</h5><p>â€‹ç»“åˆäº†ä»¥ä¸Šä¸¤ä¸ªç®—æ³•ï¼Œä¸ºäº†é¿å…ç¼ºé™·è€Œæå‡ºã€‚<strong>æ ‡è®°é˜¶æ®µå’Œ Mark-Sweep ç®—æ³•ç›¸åŒï¼Œ æ ‡è®°åä¸æ˜¯æ¸…ç†å¯¹è±¡ï¼Œè€Œæ˜¯å°†å­˜æ´»å¯¹è±¡ç§»å‘å†…å­˜çš„ä¸€ç«¯ã€‚</strong>ç„¶åæ¸…é™¤ç«¯è¾¹ç•Œå¤–çš„å¯¹è±¡ã€‚å¦‚å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230729204701947.png" alt="image-20230729204701947"></p><h5 id="1-4-2-4-ğŸŒŸåˆ†ä»£æ”¶é›†ç®—æ³•"><a href="#1-4-2-4-ğŸŒŸåˆ†ä»£æ”¶é›†ç®—æ³•" class="headerlink" title="1.4.2.4 ğŸŒŸåˆ†ä»£æ”¶é›†ç®—æ³•"></a>1.4.2.4 ğŸŒŸåˆ†ä»£æ”¶é›†ç®—æ³•</h5><p>â€”â€”æ ¹æ®å¯¹è±¡é”€æ¯é¢‘ç‡ç‰¹ç‚¹è¿›è¡Œåˆ†åŒºï¼Œå„ä¸ªåˆ†åŒºé‡‡ç”¨åˆé€‚çš„ç®—æ³•</p><p>åˆ†ä»£æ”¶é›†æ³•æ˜¯ç›®å‰å¤§éƒ¨åˆ† JVM æ‰€é‡‡ç”¨çš„æ–¹æ³•ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯<strong>æ ¹æ®å¯¹è±¡å­˜æ´»çš„ä¸åŒç”Ÿå‘½å‘¨æœŸå°†å†…å­˜åˆ’åˆ†ä¸ºä¸åŒçš„åŸŸï¼Œä¸€èˆ¬æƒ…å†µä¸‹å°† GC å †åˆ’åˆ†ä¸ºè€ç”Ÿä»£(Tenured&#x2F;Old Generation)å’Œæ–°ç”Ÿä»£(YoungGeneration)ã€‚</strong><u>è€ç”Ÿä»£çš„ç‰¹ç‚¹æ˜¯æ¯æ¬¡åƒåœ¾å›æ”¶æ—¶åªæœ‰å°‘é‡å¯¹è±¡éœ€è¦è¢«å›æ”¶ï¼Œæ–°ç”Ÿä»£çš„ç‰¹ç‚¹æ˜¯æ¯æ¬¡åƒåœ¾å›æ”¶æ—¶éƒ½æœ‰å¤§é‡åƒåœ¾éœ€è¦è¢«å›æ”¶ï¼Œå› æ­¤å¯ä»¥æ ¹æ®ä¸åŒåŒºåŸŸé€‰æ‹©ä¸åŒçš„ç®—æ³•ã€‚</u></p><h4 id="1-4-3å¦‚ä»Šå¹¿æ³›é‡‡ç”¨çš„å›æ”¶æ–¹æ³•ï¼š"><a href="#1-4-3å¦‚ä»Šå¹¿æ³›é‡‡ç”¨çš„å›æ”¶æ–¹æ³•ï¼š" class="headerlink" title="1.4.3å¦‚ä»Šå¹¿æ³›é‡‡ç”¨çš„å›æ”¶æ–¹æ³•ï¼š"></a>1.4.3å¦‚ä»Šå¹¿æ³›é‡‡ç”¨çš„å›æ”¶æ–¹æ³•ï¼š</h4><ul><li><strong>æ–°ç”Ÿä»£ä¸å¤åˆ¶ç®—æ³•</strong></li></ul><p>â€‹ç›®å‰å¤§éƒ¨åˆ† JVM çš„ GC å¯¹äºæ–°ç”Ÿä»£éƒ½é‡‡å– Copying ç®—æ³•ï¼Œå› ä¸ºæ–°ç”Ÿä»£ä¸­<u>æ¯æ¬¡åƒåœ¾å›æ”¶éƒ½è¦å›æ”¶å¤§éƒ¨åˆ†å¯¹è±¡</u>ï¼Œå³è¦å¤åˆ¶çš„æ“ä½œæ¯”è¾ƒå°‘ï¼Œä½†é€šå¸¸å¹¶ä¸æ˜¯æŒ‰ç…§ 1ï¼š 1 æ¥åˆ’åˆ†æ–°ç”Ÿä»£ã€‚ä¸€èˆ¬å°†æ–°ç”Ÿä»£åˆ’åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„ Edenç©ºé—´(<strong>å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡</strong>) å’Œä¸¤ä¸ªè¾ƒå°çš„ Survivor ç©ºé—´(From Space, To Spaceï¼Œå­˜æ”¾å­˜æ´»å¯¹è±¡)ï¼Œæ¯æ¬¡ä½¿ç”¨Eden ç©ºé—´å’Œå…¶ä¸­çš„ä¸€å— Survivor ç©ºé—´ï¼Œå½“è¿›è¡Œå›æ”¶æ—¶ï¼Œå°†è¯¥ä¸¤å—ç©ºé—´ä¸­è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å— Survivor ç©ºé—´ä¸­ã€‚</p><ul><li><strong>è€å¹´ä»£ä¸æ ‡è®°å¤åˆ¶ç®—æ³•</strong></li></ul><p>â€‹è€Œè€å¹´ä»£å› ä¸ºæ¯æ¬¡åªå›æ”¶å°‘é‡å¯¹è±¡ï¼Œå› è€Œé‡‡ç”¨ <strong>Mark-Compact(æ ‡è®°æ•´ç†)</strong> ç®—æ³•ã€‚</p><h4 id="1-4-4-ğŸŒŸåƒåœ¾å›æ”¶æ–¹æ³•æ€»ç»“ï¼šï¼ï¼ï¼ï¼ï¼"><a href="#1-4-4-ğŸŒŸåƒåœ¾å›æ”¶æ–¹æ³•æ€»ç»“ï¼šï¼ï¼ï¼ï¼ï¼" class="headerlink" title="1.4.4 ğŸŒŸåƒåœ¾å›æ”¶æ–¹æ³•æ€»ç»“ï¼šï¼ï¼ï¼ï¼ï¼"></a>1.4.4 ğŸŒŸåƒåœ¾å›æ”¶æ–¹æ³•æ€»ç»“ï¼šï¼ï¼ï¼ï¼ï¼</h4><ol><li>JAVA è™šæ‹Ÿæœºæåˆ°è¿‡çš„å¤„äºæ–¹æ³•åŒºçš„æ°¸ç”Ÿä»£(Permanet Generation)ï¼Œ å®ƒç”¨æ¥å­˜å‚¨ class ç±»ï¼Œå¸¸é‡ï¼Œæ–¹æ³•æè¿°ç­‰ã€‚<strong>å¯¹æ°¸ç”Ÿä»£çš„å›æ”¶ä¸»è¦åŒ…æ‹¬åºŸå¼ƒå¸¸é‡å’Œæ— ç”¨çš„ç±»</strong>ã€‚</li><li>å¯¹è±¡çš„å†…å­˜åˆ†é…ä¸»è¦åœ¨æ–°ç”Ÿä»£çš„ Eden Space å’Œ Survivor Space çš„ From Space(Survivor ç›®å‰å­˜æ”¾å¯¹è±¡çš„é‚£ä¸€å—)ï¼Œå°‘æ•°æƒ…å†µä¼šç›´æ¥åˆ†é…åˆ°è€ç”Ÿä»£(å¯¹è±¡è¿‡å¤§ï¼Œ To Space åŒºè£…ä¸ä¸‹)ã€‚</li><li><strong>å½“æ–°ç”Ÿä»£çš„ Eden Space å’Œ From Space ç©ºé—´ä¸è¶³æ—¶å°±ä¼šå‘ç”Ÿä¸€æ¬¡ GC</strong>ï¼Œè¿›è¡Œ GC åï¼Œ EdenSpace å’Œ From Space åŒºçš„å­˜æ´»å¯¹è±¡ä¼šè¢«æŒªåˆ° To Spaceï¼Œç„¶åå°† Eden Space å’Œ FromSpace è¿›è¡Œæ¸…ç†ã€‚</li><li>å¦‚æœ To Space æ— æ³•è¶³å¤Ÿå­˜å‚¨æŸä¸ªå¯¹è±¡(å¤ªå¤§)ï¼Œåˆ™å°†<u>è¿™ä¸ªå¯¹è±¡å­˜å‚¨åˆ°è€ç”Ÿä»£</u>ã€‚</li><li>åœ¨è¿›è¡Œ GC åï¼Œä½¿ç”¨çš„ä¾¿æ˜¯ Eden Space å’Œ To Space äº†ï¼Œå¦‚æ­¤åå¤å¾ªç¯ã€‚</li><li>å½“å¯¹è±¡åœ¨ Survivor åŒºèº²è¿‡ä¸€æ¬¡ GC åï¼Œå…¶å¹´é¾„å°±ä¼š+1ã€‚ <strong>é»˜è®¤æƒ…å†µä¸‹<u>å¹´é¾„åˆ°è¾¾ 15 çš„å¯¹è±¡ä¼šè¢«ç§»åˆ°è€ç”Ÿä»£ä¸­</u>ã€‚</strong></li></ol><h3 id="1-5-JAVAä¸­-å››ç§å¼•ç”¨ç±»å‹"><a href="#1-5-JAVAä¸­-å››ç§å¼•ç”¨ç±»å‹" class="headerlink" title="1.5 JAVAä¸­ å››ç§å¼•ç”¨ç±»å‹"></a>1.5 JAVAä¸­ å››ç§å¼•ç”¨ç±»å‹</h3><h4 id="1-5-1-å¼ºå¼•ç”¨"><a href="#1-5-1-å¼ºå¼•ç”¨" class="headerlink" title="1.5.1. å¼ºå¼•ç”¨"></a>1.5.1. å¼ºå¼•ç”¨</h4><p>åœ¨ Java ä¸­æœ€å¸¸è§çš„å°±æ˜¯å¼ºå¼•ç”¨ï¼Œ æŠŠä¸€ä¸ªå¯¹è±¡èµ‹ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸ªå¼•ç”¨å˜é‡å°±æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚<u>å½“ä¸€ä¸ªå¯¹è±¡è¢«å¼ºå¼•ç”¨å˜é‡å¼•ç”¨æ—¶ï¼Œå®ƒå¤„äºå¯è¾¾çŠ¶æ€ï¼Œå®ƒæ˜¯ä¸å¯èƒ½è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶</u>çš„ï¼Œå³ä½¿è¯¥å¯¹è±¡ä»¥åæ°¸è¿œéƒ½ä¸ä¼šè¢«ç”¨åˆ° JVM ä¹Ÿä¸ä¼šå›æ”¶ã€‚å› æ­¤å¼ºå¼•ç”¨æ˜¯é€ æˆ Java å†…å­˜æ³„æ¼çš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚</p><h4 id="1-5-2-è½¯å¼•ç”¨"><a href="#1-5-2-è½¯å¼•ç”¨" class="headerlink" title="1.5.2. è½¯å¼•ç”¨"></a>1.5.2. è½¯å¼•ç”¨</h4><p>è½¯å¼•ç”¨éœ€è¦ç”¨ SoftReference ç±»æ¥å®ç°ï¼Œå¯¹äºåªæœ‰è½¯å¼•ç”¨çš„å¯¹è±¡æ¥è¯´ï¼Œå½“ç³»ç»Ÿå†…å­˜è¶³å¤Ÿæ—¶å®ƒä¸ä¼šè¢«å›æ”¶ï¼Œ<u>å½“ç³»ç»Ÿå†…å­˜ç©ºé—´ä¸è¶³æ—¶å®ƒä¼šè¢«å›æ”¶</u>ã€‚è½¯å¼•ç”¨é€šå¸¸ç”¨åœ¨å¯¹å†…å­˜æ•æ„Ÿçš„ç¨‹åºä¸­ã€‚</p><h4 id="1-5-3-å¼±å¼•ç”¨"><a href="#1-5-3-å¼±å¼•ç”¨" class="headerlink" title="1.5.3. å¼±å¼•ç”¨"></a>1.5.3. å¼±å¼•ç”¨</h4><p>å¼±å¼•ç”¨éœ€è¦ç”¨ WeakReference ç±»æ¥å®ç°ï¼Œå®ƒæ¯”è½¯å¼•ç”¨çš„ç”Ÿå­˜æœŸæ›´çŸ­ï¼Œå¯¹äºåªæœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ¥è¯´ï¼Œ<u>åªè¦åƒåœ¾å›æ”¶æœºåˆ¶ä¸€è¿è¡Œï¼Œä¸ç®¡ JVM çš„å†…å­˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œæ€»ä¼šå›æ”¶è¯¥å¯¹è±¡å ç”¨çš„å†…å­˜ã€‚</u></p><h4 id="1-5-4-è™šå¼•ç”¨"><a href="#1-5-4-è™šå¼•ç”¨" class="headerlink" title="1.5.4. è™šå¼•ç”¨"></a>1.5.4. è™šå¼•ç”¨</h4><p>è™šå¼•ç”¨éœ€è¦ PhantomReference ç±»æ¥å®ç°ï¼Œå®ƒä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—è”åˆä½¿ç”¨ã€‚ è™šå¼•ç”¨çš„ä¸»è¦ä½œç”¨æ˜¯<u>è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„çŠ¶æ€</u>ã€‚</p><h3 id="1-6-GC-åˆ†ä»£æ”¶é›†ç®—æ³•-VS-åˆ†åŒºæ”¶é›†ç®—æ³•"><a href="#1-6-GC-åˆ†ä»£æ”¶é›†ç®—æ³•-VS-åˆ†åŒºæ”¶é›†ç®—æ³•" class="headerlink" title="1.6.GC åˆ†ä»£æ”¶é›†ç®—æ³• VS åˆ†åŒºæ”¶é›†ç®—æ³•"></a>1.6.GC åˆ†ä»£æ”¶é›†ç®—æ³• VS åˆ†åŒºæ”¶é›†ç®—æ³•</h3><h4 id="1-6-1-åˆ†ä»£æ”¶é›†ç®—æ³•-1-4-2-4ä¸­æåˆ°è¿‡ï¼Œåªåšä»‹ç»ï¼Œåˆ†æè¯·çœ‹å‰æ–‡"><a href="#1-6-1-åˆ†ä»£æ”¶é›†ç®—æ³•-1-4-2-4ä¸­æåˆ°è¿‡ï¼Œåªåšä»‹ç»ï¼Œåˆ†æè¯·çœ‹å‰æ–‡" class="headerlink" title="1.6.1. åˆ†ä»£æ”¶é›†ç®—æ³•(1.4.2.4ä¸­æåˆ°è¿‡ï¼Œåªåšä»‹ç»ï¼Œåˆ†æè¯·çœ‹å‰æ–‡)"></a>1.6.1. åˆ†ä»£æ”¶é›†ç®—æ³•(1.4.2.4ä¸­æåˆ°è¿‡ï¼Œåªåšä»‹ç»ï¼Œåˆ†æè¯·çœ‹å‰æ–‡)</h4><p>â€‹å½“å‰ä¸»æµ VM åƒåœ¾æ”¶é›†éƒ½é‡‡ç”¨â€åˆ†ä»£æ”¶é›†â€ (Generational Collection)ç®—æ³•, è¿™ç§ç®—æ³•ä¼šæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—, å¦‚ JVM ä¸­çš„ æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ï¼Œ è¿™æ ·å°±å¯ä»¥æ ¹æ®å„å¹´ä»£ç‰¹ç‚¹åˆ†åˆ«é‡‡ç”¨æœ€é€‚å½“çš„ GC ç®—æ³•</p><h5 id="1-6-1-1-åœ¨æ–°ç”Ÿä»£-å¤åˆ¶ç®—æ³•"><a href="#1-6-1-1-åœ¨æ–°ç”Ÿä»£-å¤åˆ¶ç®—æ³•" class="headerlink" title="1.6.1.1. åœ¨æ–°ç”Ÿä»£-å¤åˆ¶ç®—æ³•"></a>1.6.1.1. åœ¨æ–°ç”Ÿä»£-å¤åˆ¶ç®—æ³•</h5><p>â€‹æ¯æ¬¡åƒåœ¾æ”¶é›†éƒ½èƒ½å‘ç°å¤§æ‰¹å¯¹è±¡å·²æ­», åªæœ‰å°‘é‡å­˜æ´». å› æ­¤é€‰ç”¨å¤åˆ¶ç®—æ³•, åªéœ€è¦ä»˜å‡ºå°‘é‡å­˜æ´»å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ”¶é›†.</p><h5 id="1-6-1-2-åœ¨è€å¹´ä»£-æ ‡è®°æ•´ç†ç®—æ³•"><a href="#1-6-1-2-åœ¨è€å¹´ä»£-æ ‡è®°æ•´ç†ç®—æ³•" class="headerlink" title="1.6.1.2. åœ¨è€å¹´ä»£-æ ‡è®°æ•´ç†ç®—æ³•"></a>1.6.1.2. åœ¨è€å¹´ä»£-æ ‡è®°æ•´ç†ç®—æ³•</h5><p>â€‹å› ä¸ºå¯¹è±¡å­˜æ´»ç‡é«˜ã€æ²¡æœ‰é¢å¤–ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿, å°±å¿…é¡»é‡‡ç”¨â€œæ ‡è®°â€”æ¸…ç†â€æˆ–â€œæ ‡è®°â€”æ•´ç†â€ ç®—æ³•æ¥è¿›è¡Œå›æ”¶, ä¸å¿…è¿›è¡Œå†…å­˜å¤åˆ¶, ä¸”ç›´æ¥è…¾å‡ºç©ºé—²å†…å­˜.</p><h4 id="1-6-2-åˆ†åŒºæ”¶é›†ç®—æ³•"><a href="#1-6-2-åˆ†åŒºæ”¶é›†ç®—æ³•" class="headerlink" title="1.6.2. åˆ†åŒºæ”¶é›†ç®—æ³•"></a>1.6.2. åˆ†åŒºæ”¶é›†ç®—æ³•</h4><h5 id="åˆ†åŒºæ”¶é›†ç®—æ³•äº§ç”ŸèƒŒæ™¯ï¼š"><a href="#åˆ†åŒºæ”¶é›†ç®—æ³•äº§ç”ŸèƒŒæ™¯ï¼š" class="headerlink" title="åˆ†åŒºæ”¶é›†ç®—æ³•äº§ç”ŸèƒŒæ™¯ï¼š"></a>åˆ†åŒºæ”¶é›†ç®—æ³•äº§ç”ŸèƒŒæ™¯ï¼š</h5><p>åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨è½¯ä»¶å°†å¤„äºä¸€ç§Stop the World çš„çŠ¶æ€ã€‚åœ¨Stop the Word çŠ¶æ€ä¸‹ï¼Œåº”ç”¨ç¨‹åºæ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¼šæŒ‚èµ·ï¼Œæš‚åœä¸€åˆ‡æ­£å¸¸çš„å·¥ä½œï¼Œç­‰å¾…åƒåœ¾å›æ”¶çš„å®Œæˆï¼Œå¦‚æœåƒåœ¾å›æ”¶æ—¶é—´è¿‡é•¿ï¼Œåº”ç”¨ç¨‹åºä¼šè¢«æŒ‚èµ·å¾ˆä¹…ï¼Œå°†ä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒæˆ–è€…ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</p><p>â€‹åˆ†åŒºç®—æ³•åˆ™<u>å°†æ•´ä¸ªå †ç©ºé—´åˆ’åˆ†ä¸ºè¿ç»­çš„ä¸åŒå°åŒºé—´, æ¯ä¸ªå°åŒºé—´ç‹¬ç«‹ä½¿ç”¨, ç‹¬ç«‹å›æ”¶</u>.å‡å°‘åº”ç”¨ç¨‹åºè¢«æŒ‚èµ·çš„æ—¶é—´ </p><p>â€‹è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶ä¸€æ¬¡å›æ”¶å¤šå°‘ä¸ªå°åŒºé—´ , æ ¹æ®ç›®æ ‡åœé¡¿æ—¶é—´, æ¯æ¬¡åˆç†åœ°å›æ”¶è‹¥å¹²ä¸ªå°åŒºé—´(è€Œä¸æ˜¯æ•´ä¸ªå †), ä»è€Œå‡å°‘ä¸€æ¬¡ GC æ‰€äº§ç”Ÿçš„åœé¡¿ã€‚</p><p>ç”±äºåˆ†å—è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä¼šå¯¼è‡´é¢å¤–çš„ç®¡ç†å¼€é”€ã€‚</p><h3 id="1-7-GC-åƒåœ¾æ”¶é›†å™¨"><a href="#1-7-GC-åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="1.7.GC åƒåœ¾æ”¶é›†å™¨"></a>1.7.GC åƒåœ¾æ”¶é›†å™¨</h3><p>java è™šæ‹Ÿä¸­é’ˆå¯¹æ–°ç”Ÿä»£å’Œå¹´è€ä»£åˆ†åˆ«æä¾›äº†å¤šç§ä¸åŒçš„åƒåœ¾æ”¶é›†å™¨ï¼Œ JDK1.6 ä¸­ Sun HotSpot è™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†å™¨å¦‚ä¸‹ï¼š</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230730161121359.png" alt="image-20230730161121359" style="zoom: 40%;" /><h4 id="1-7-1-Serial-åƒåœ¾æ”¶é›†å™¨ï¼ˆå•çº¿ç¨‹ã€-å¤åˆ¶ç®—æ³•ï¼‰"><a href="#1-7-1-Serial-åƒåœ¾æ”¶é›†å™¨ï¼ˆå•çº¿ç¨‹ã€-å¤åˆ¶ç®—æ³•ï¼‰" class="headerlink" title="1.7.1. Serial åƒåœ¾æ”¶é›†å™¨ï¼ˆå•çº¿ç¨‹ã€ å¤åˆ¶ç®—æ³•ï¼‰"></a>1.7.1. Serial åƒåœ¾æ”¶é›†å™¨ï¼ˆå•çº¿ç¨‹ã€ å¤åˆ¶ç®—æ³•ï¼‰</h4><p>â€‹Serial æ˜¯æœ€åŸºæœ¬åƒåœ¾æ”¶é›†å™¨ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œæ›¾ç»æ˜¯JDK1.3.1 ä¹‹å‰æ–°ç”Ÿä»£å”¯ä¸€çš„åƒåœ¾æ”¶é›†å™¨ã€‚ Serial æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œå®ƒä¸ä½†åªä¼šä½¿ç”¨ä¸€ä¸ª CPU æˆ–ä¸€æ¡çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œå¹¶ä¸”åœ¨è¿›è¡Œåƒåœ¾æ”¶é›†çš„åŒæ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°åƒåœ¾æ”¶é›†ç»“æŸã€‚Serial åƒåœ¾æ”¶é›†å™¨è™½ç„¶åœ¨æ”¶é›†åƒåœ¾è¿‡ç¨‹ä¸­éœ€è¦æš‚åœæ‰€æœ‰å…¶ä»–çš„å·¥ä½œçº¿ç¨‹ï¼Œä½†æ˜¯å®ƒç®€å•é«˜æ•ˆï¼Œ<u>å¯¹äºé™å®šå•ä¸ª CPU ç¯å¢ƒæ¥è¯´ï¼Œæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œå¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹åƒåœ¾æ”¶é›†æ•ˆç‡</u>ï¼Œå› æ­¤ Serialåƒåœ¾æ”¶é›†å™¨ä¾ç„¶æ˜¯ <u>java è™šæ‹Ÿæœºè¿è¡Œåœ¨ <strong>Client æ¨¡å¼</strong>ä¸‹é»˜è®¤çš„æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ã€‚</u></p><h4 id="1-7-2-ParNew-åƒåœ¾æ”¶é›†å™¨ï¼ˆSerial-å¤šçº¿ç¨‹ï¼‰"><a href="#1-7-2-ParNew-åƒåœ¾æ”¶é›†å™¨ï¼ˆSerial-å¤šçº¿ç¨‹ï¼‰" class="headerlink" title="1.7.2. ParNew åƒåœ¾æ”¶é›†å™¨ï¼ˆSerial+å¤šçº¿ç¨‹ï¼‰"></a>1.7.2. ParNew åƒåœ¾æ”¶é›†å™¨ï¼ˆSerial+å¤šçº¿ç¨‹ï¼‰</h4><p>â€‹ParNew åƒåœ¾æ”¶é›†å™¨å…¶å®æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œä¹Ÿä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œé™¤äº†<strong>ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†ä¹‹å¤–</strong>ï¼Œå…¶ä½™çš„è¡Œä¸ºå’Œ Serial æ”¶é›†å™¨å®Œå…¨ä¸€æ ·ï¼Œ ParNew åƒåœ¾æ”¶é›†å™¨åœ¨åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­<u>åŒæ ·ä¹Ÿè¦æš‚åœ<strong>æ‰€æœ‰</strong>å…¶ä»–çš„å·¥ä½œçº¿ç¨‹ã€‚</u></p><p>â€‹ParNew æ”¶é›†å™¨é»˜è®¤å¼€å¯å’Œ CPU æ•°ç›®ç›¸åŒçš„çº¿ç¨‹æ•°ï¼Œå¯ä»¥é€šè¿‡-XX:ParallelGCThreads å‚æ•°æ¥é™åˆ¶åƒåœ¾æ”¶é›†å™¨çš„çº¿ç¨‹æ•°ã€‚ParNew è™½ç„¶æ˜¯é™¤äº†å¤šçº¿ç¨‹å¤–å’ŒSerial æ”¶é›†å™¨å‡ ä¹å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯ParNewåƒåœ¾æ”¶é›†å™¨æ˜¯å¾ˆå¤š javaè™šæ‹Ÿæœºè¿è¡Œåœ¨ <u><strong>Server æ¨¡å¼</strong>ä¸‹æ–°ç”Ÿä»£çš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨ã€‚</u></p><h4 id="1-7-3-Parallel-Scavenge-æ”¶é›†å™¨ï¼ˆå¤šçº¿ç¨‹å¤åˆ¶ç®—æ³•ã€é«˜æ•ˆï¼‰"><a href="#1-7-3-Parallel-Scavenge-æ”¶é›†å™¨ï¼ˆå¤šçº¿ç¨‹å¤åˆ¶ç®—æ³•ã€é«˜æ•ˆï¼‰" class="headerlink" title="1.7.3. Parallel Scavenge æ”¶é›†å™¨ï¼ˆå¤šçº¿ç¨‹å¤åˆ¶ç®—æ³•ã€é«˜æ•ˆï¼‰"></a>1.7.3. Parallel Scavenge æ”¶é›†å™¨ï¼ˆå¤šçº¿ç¨‹å¤åˆ¶ç®—æ³•ã€é«˜æ•ˆï¼‰</h4><p>â€‹Parallel Scavenge æ”¶é›†å™¨ä¹Ÿæ˜¯ä¸€ä¸ªæ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ï¼ŒåŒæ ·ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¤šçº¿ç¨‹çš„åƒåœ¾æ”¶é›†å™¨ï¼Œ å®ƒé‡ç‚¹å…³æ³¨çš„æ˜¯ç¨‹åºè¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThoughputï¼Œ CPU ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´&#x2F;CPU æ€»æ¶ˆè€—æ—¶é—´ï¼Œå³ååé‡&#x3D;è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´&#x2F;(è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´)ï¼‰ï¼Œ<strong>é«˜ååé‡</strong>å¯ä»¥æœ€é«˜æ•ˆç‡åœ°åˆ©ç”¨ CPU æ—¶é—´ï¼Œå°½å¿«åœ°å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦<u>é€‚ç”¨äºåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡</u>ã€‚ è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ä¹Ÿæ˜¯ ParallelScavenge æ”¶é›†å™¨ä¸ ParNew æ”¶é›†å™¨çš„ä¸€ä¸ªé‡è¦åŒºåˆ«ã€‚</p><h4 id="1-7-4-Serial-Old-æ”¶é›†å™¨ï¼ˆå•çº¿ç¨‹æ ‡è®°æ•´ç†ç®—æ³•-ï¼‰"><a href="#1-7-4-Serial-Old-æ”¶é›†å™¨ï¼ˆå•çº¿ç¨‹æ ‡è®°æ•´ç†ç®—æ³•-ï¼‰" class="headerlink" title="1.7.4. Serial Old æ”¶é›†å™¨ï¼ˆå•çº¿ç¨‹æ ‡è®°æ•´ç†ç®—æ³• ï¼‰"></a>1.7.4. Serial Old æ”¶é›†å™¨ï¼ˆå•çº¿ç¨‹æ ‡è®°æ•´ç†ç®—æ³• ï¼‰</h4><p>â€‹Serial Old æ˜¯ <strong>Serial åƒåœ¾æ”¶é›†å™¨å¹´è€ä»£ç‰ˆæœ¬</strong>ï¼Œå®ƒåŒæ ·æ˜¯ä¸ªå•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œè¿™ä¸ªæ”¶é›†å™¨ä¹Ÿä¸»è¦æ˜¯è¿è¡Œåœ¨ <u>Clientç«¯</u> é»˜è®¤çš„ java è™šæ‹Ÿæœºé»˜è®¤çš„å¹´è€ä»£åƒåœ¾æ”¶é›†å™¨ã€‚</p><h4 id="1-7-5-Parallel-Old-æ”¶é›†å™¨ï¼ˆå¤šçº¿ç¨‹æ ‡è®°æ•´ç†ç®—æ³•ï¼‰"><a href="#1-7-5-Parallel-Old-æ”¶é›†å™¨ï¼ˆå¤šçº¿ç¨‹æ ‡è®°æ•´ç†ç®—æ³•ï¼‰" class="headerlink" title="1.7.5. Parallel Old æ”¶é›†å™¨ï¼ˆå¤šçº¿ç¨‹æ ‡è®°æ•´ç†ç®—æ³•ï¼‰"></a>1.7.5. Parallel Old æ”¶é›†å™¨ï¼ˆå¤šçº¿ç¨‹æ ‡è®°æ•´ç†ç®—æ³•ï¼‰</h4><p>â€‹Parallel Old æ”¶é›†å™¨æ˜¯<strong>Parallel Scavengeçš„å¹´è€ä»£ç‰ˆæœ¬</strong>ï¼Œä½¿ç”¨å¤šçº¿ç¨‹çš„æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œåœ¨ JDK1.6æ‰å¼€å§‹æä¾›ã€‚åœ¨ JDK1.6 ä¹‹å‰ï¼Œæ–°ç”Ÿä»£ä½¿ç”¨ ParallelScavenge æ”¶é›†å™¨åªèƒ½æ­é…å¹´è€ä»£çš„ Serial Old æ”¶é›†å™¨ï¼Œåªèƒ½ä¿è¯æ–°ç”Ÿä»£çš„ååé‡ä¼˜å…ˆï¼Œæ— æ³•ä¿è¯æ•´ä½“çš„ååé‡ï¼Œ Parallel Old æ­£æ˜¯ä¸ºäº†åœ¨å¹´è€ä»£åŒæ ·æä¾›ååé‡ä¼˜å…ˆçš„åƒåœ¾æ”¶é›†å™¨ï¼Œ <u>å¦‚æœç³»ç»Ÿå¯¹ååé‡è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘æ–°ç”Ÿä»£ Parallel Scavengeå’Œå¹´è€ä»£ Parallel Old æ”¶é›†å™¨çš„æ­é…ç­–ç•¥ã€‚</u></p><h4 id="1-7-6-CMS-æ”¶é›†å™¨ï¼ˆå¤šçº¿ç¨‹æ ‡è®°æ¸…é™¤ç®—æ³•ï¼‰"><a href="#1-7-6-CMS-æ”¶é›†å™¨ï¼ˆå¤šçº¿ç¨‹æ ‡è®°æ¸…é™¤ç®—æ³•ï¼‰" class="headerlink" title="1.7.6. CMS æ”¶é›†å™¨ï¼ˆå¤šçº¿ç¨‹æ ‡è®°æ¸…é™¤ç®—æ³•ï¼‰"></a>1.7.6. CMS æ”¶é›†å™¨ï¼ˆå¤šçº¿ç¨‹æ ‡è®°æ¸…é™¤ç®—æ³•ï¼‰</h4><p>Concurrent mark sweep(CMS)æ”¶é›†å™¨æ˜¯ä¸€ç§<strong>å¹´è€ä»£åƒåœ¾æ”¶é›†å™¨</strong>ï¼Œå…¶æœ€ä¸»è¦ç›®æ ‡æ˜¯è·å–<u>æœ€çŸ­åƒåœ¾å›æ”¶åœé¡¿æ—¶é—´</u>ï¼Œ å’Œå…¶ä»–å¹´è€ä»£ä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ä¸åŒï¼Œå®ƒ<u>ä½¿ç”¨å¤šçº¿ç¨‹çš„æ ‡è®°-æ¸…é™¤ç®—æ³•</u>ã€‚æœ€çŸ­çš„åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´å¯ä»¥ä¸ºäº¤äº’æ¯”è¾ƒé«˜çš„ç¨‹åºæé«˜ç”¨æˆ·ä½“éªŒã€‚CMS å·¥ä½œæœºåˆ¶ç›¸æ¯”å…¶ä»–çš„åƒåœ¾æ”¶é›†å™¨æ¥è¯´æ›´å¤æ‚ï¼Œæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹ 4 ä¸ªé˜¶æ®µï¼š</p><h5 id="1-7-6-1-åˆå§‹æ ‡è®°"><a href="#1-7-6-1-åˆå§‹æ ‡è®°" class="headerlink" title="1.7.6.1. åˆå§‹æ ‡è®°"></a>1.7.6.1. åˆå§‹æ ‡è®°</h5><p>â€‹åªæ˜¯æ ‡è®°ä¸€ä¸‹ GC Roots <u>èƒ½ç›´æ¥å…³è”çš„å¯¹è±¡</u>ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œä»ç„¶<u>éœ€è¦æš‚åœæ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹</u>ã€‚</p><h5 id="1-7-6-2-å¹¶å‘æ ‡è®°"><a href="#1-7-6-2-å¹¶å‘æ ‡è®°" class="headerlink" title="1.7.6.2. å¹¶å‘æ ‡è®°"></a>1.7.6.2. å¹¶å‘æ ‡è®°</h5><p>â€‹è¿›è¡Œ GC Roots è·Ÿè¸ªçš„è¿‡ç¨‹ï¼Œå’Œç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œ<u>ä¸éœ€è¦æš‚åœå·¥ä½œçº¿ç¨‹</u>ã€‚</p><h5 id="1-7-6-3-é‡æ–°æ ‡è®°"><a href="#1-7-6-3-é‡æ–°æ ‡è®°" class="headerlink" title="1.7.6.3. é‡æ–°æ ‡è®°"></a>1.7.6.3. é‡æ–°æ ‡è®°</h5><p>â€‹ä¸ºäº†<u>ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•</u>ï¼Œä»ç„¶<u>éœ€è¦æš‚åœæ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹</u>ã€‚</p><h5 id="1-7-6-4-å¹¶å‘æ¸…é™¤"><a href="#1-7-6-4-å¹¶å‘æ¸…é™¤" class="headerlink" title="1.7.6.4. å¹¶å‘æ¸…é™¤"></a>1.7.6.4. å¹¶å‘æ¸…é™¤</h5><p>â€‹æ¸…é™¤ GC Roots ä¸å¯è¾¾å¯¹è±¡ï¼Œå’Œç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œ<u>ä¸éœ€è¦æš‚åœå·¥ä½œçº¿ç¨‹</u>ã€‚**<u>ç”±äºè€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹ä¸­ï¼Œåƒåœ¾æ”¶é›†çº¿ç¨‹å¯ä»¥å’Œç”¨æˆ·ç°åœ¨ä¸€èµ·å¹¶å‘å·¥ä½œï¼Œ æ‰€ä»¥æ€»ä½“ä¸Šæ¥çœ‹CMS æ”¶é›†å™¨çš„å†…å­˜å›æ”¶å’Œç”¨æˆ·çº¿ç¨‹æ˜¯ä¸€èµ·å¹¶å‘åœ°æ‰§è¡Œã€‚</u>**</p><h4 id="1-7-7-G1-æ”¶é›†å™¨"><a href="#1-7-7-G1-æ”¶é›†å™¨" class="headerlink" title="1.7.7. G1 æ”¶é›†å™¨"></a>1.7.7. G1 æ”¶é›†å™¨</h4><p>â€”CMSæ”¶é›†å™¨çš„å‡çº§ç‰ˆ</p><p>Garbage first åƒåœ¾æ”¶é›†å™¨æ˜¯ç›®å‰åƒåœ¾æ”¶é›†å™¨ç†è®ºå‘å±•çš„æœ€å‰æ²¿æˆæœï¼Œç›¸æ¯”ä¸ CMS æ”¶é›†å™¨ï¼Œ G1 æ”¶é›†å™¨ä¸¤ä¸ªæœ€çªå‡ºçš„æ”¹è¿›æ˜¯ï¼š</p><p>â€‹<strong>åŸºäºæ ‡è®°-æ•´ç†ç®—æ³•ï¼Œä¸äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</strong></p><ol><li>å¯ä»¥éå¸¸ç²¾ç¡®æ§åˆ¶åœé¡¿æ—¶é—´ï¼Œåœ¨ä¸ç‰ºç‰²ååé‡å‰æä¸‹ï¼Œå®ç°ä½åœé¡¿åƒåœ¾å›æ”¶ã€‚G1 æ”¶é›†å™¨é¿å…å…¨åŒºåŸŸåƒåœ¾æ”¶é›†ï¼Œå®ƒ<u>æŠŠå †å†…å­˜åˆ’åˆ†ä¸ºå¤§å°å›ºå®šçš„å‡ ä¸ªç‹¬ç«‹åŒºåŸŸï¼Œå¹¶ä¸”è·Ÿè¸ªè¿™äº›åŒºåŸŸçš„åƒåœ¾æ”¶é›†è¿›åº¦ï¼ŒåŒæ—¶åœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆçº§åˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®æ‰€å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œ ä¼˜å…ˆå›æ”¶åƒåœ¾æœ€å¤šçš„åŒºåŸŸã€‚</u></li><li>åŒºåŸŸåˆ’åˆ†å’Œä¼˜å…ˆçº§åŒºåŸŸå›æ”¶æœºåˆ¶ï¼Œç¡®ä¿ G1 æ”¶é›†å™¨å¯ä»¥åœ¨æœ‰é™æ—¶é—´è·å¾—æœ€é«˜çš„åƒåœ¾æ”¶é›†æ•ˆç‡</li></ol><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p><p>G1åƒåœ¾æ”¶é›†å™¨çš„ç›®æ ‡æ˜¯åœ¨ä¸åŒåº”ç”¨åœºæ™¯ä¸­è¿½æ±‚é«˜ååé‡å’Œä½åœé¡¿ä¹‹é—´çš„æœ€ä½³å¹³è¡¡ã€‚</p><p>G1å°†æ•´ä¸ªå †åˆ†æˆç›¸åŒå¤§å°çš„åˆ†åŒºï¼ˆ<code>Region</code>ï¼‰ï¼Œæœ‰å››ç§ä¸åŒç±»å‹çš„åˆ†åŒºï¼š<code>Edenã€Survivorã€Oldå’ŒHumongous</code>ã€‚åˆ†åŒºçš„å¤§å°å–å€¼èŒƒå›´ä¸º 1M åˆ° 32Mï¼Œéƒ½æ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚åˆ†åŒºå¤§å°å¯ä»¥é€šè¿‡<code>-XX:G1HeapRegionSize</code>å‚æ•°æŒ‡å®šã€‚<code>Humongous</code>åŒºåŸŸç”¨äºå­˜å‚¨å¤§å¯¹è±¡ã€‚G1è§„å®šåªè¦å¤§å°è¶…è¿‡äº†ä¸€ä¸ªåˆ†åŒºå®¹é‡ä¸€åŠçš„å¯¹è±¡å°±è®¤ä¸ºæ˜¯å¤§å¯¹è±¡ã€‚</p><p>G1 æ”¶é›†å™¨å¯¹å„ä¸ªåˆ†åŒºå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°å’Œå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼è¿›è¡Œæ’åºï¼Œå¾—åˆ°ä¸€ä¸ªä¼˜å…ˆçº§åˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®ç”¨æˆ·è®¾ç½®çš„æœ€å¤§å›æ”¶åœé¡¿æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„åˆ†åŒºã€‚</p><p>ç‰¹ç‚¹ï¼šå¯ä»¥ç”±ç”¨æˆ·æŒ‡å®šæœŸæœ›çš„åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´ã€‚</p><p>G1 æ”¶é›†å™¨çš„å›æ”¶è¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li>åˆå§‹æ ‡è®°ã€‚æš‚åœæ‰€æœ‰å…¶ä»–çº¿ç¨‹ï¼Œè®°å½•ç›´æ¥ä¸ <code>GC Roots</code> ç›´æ¥ç›¸è¿çš„å¯¹è±¡ï¼Œè€—æ—¶è¾ƒçŸ­ ã€‚</li><li>å¹¶å‘æ ‡è®°ã€‚ä»<code>GC Roots</code>å¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾å‡ºè¦å›æ”¶çš„å¯¹è±¡ï¼Œè€—æ—¶è¾ƒé•¿ï¼Œä¸è¿‡å¯ä»¥å’Œç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚</li><li>æœ€ç»ˆæ ‡è®°ã€‚éœ€å¯¹å…¶ä»–çº¿ç¨‹åšçŸ­æš‚çš„æš‚åœï¼Œç”¨äºå¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µå¯¹è±¡å¼•ç”¨å‡ºç°å˜åŠ¨çš„åŒºåŸŸã€‚</li><li>ç­›é€‰å›æ”¶ã€‚å¯¹å„ä¸ªåˆ†åŒºçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œç„¶åæŠŠå†³å®šå›æ”¶çš„åˆ†åŒºçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ç©ºçš„åˆ†åŒºä¸­ï¼Œå†æ¸…ç†æ‰æ•´ä¸ªæ—§çš„åˆ†åŒºçš„å…¨éƒ¨ç©ºé—´ã€‚è¿™é‡Œçš„æ“ä½œæ¶‰åŠå­˜æ´»å¯¹è±¡çš„ç§»åŠ¨ï¼Œä¼šæš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç”±å¤šæ¡æ”¶é›†å™¨çº¿ç¨‹å¹¶è¡Œå®Œæˆã€‚</li></ul><h3 id="1-8-JAVA-IO-x2F-NIO"><a href="#1-8-JAVA-IO-x2F-NIO" class="headerlink" title="1.8. JAVA IO&#x2F;NIO"></a>1.8. JAVA IO&#x2F;NIO</h3><h4 id="1-8-1å¸¸è§I-x2F-Oæ¨¡å‹"><a href="#1-8-1å¸¸è§I-x2F-Oæ¨¡å‹" class="headerlink" title="1.8.1å¸¸è§I&#x2F;Oæ¨¡å‹"></a>1.8.1å¸¸è§I&#x2F;Oæ¨¡å‹</h4><h5 id="1-8-1-1-é˜»å¡-IO-æ¨¡å‹"><a href="#1-8-1-1-é˜»å¡-IO-æ¨¡å‹" class="headerlink" title="1.8.1.1 é˜»å¡ IO æ¨¡å‹"></a>1.8.1.1 é˜»å¡ IO æ¨¡å‹</h5><p>â€‹æœ€ä¼ ç»Ÿçš„ä¸€ç§ IO æ¨¡å‹ï¼Œå³<u>åœ¨è¯»å†™æ•°æ®è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿé˜»å¡ç°è±¡</u>ã€‚å½“ç”¨æˆ·çº¿ç¨‹å‘å‡º IO è¯·æ±‚ä¹‹åï¼Œå†…æ ¸ä¼šå»æŸ¥çœ‹æ•°æ®æ˜¯å¦å°±ç»ªï¼Œå¦‚æœæ²¡æœ‰å°±ç»ªå°±ä¼šç­‰å¾…æ•°æ®å°±ç»ªï¼Œè€Œç”¨æˆ·çº¿ç¨‹å°±ä¼šå¤„äºé˜»å¡çŠ¶æ€ï¼Œç”¨æˆ·çº¿ç¨‹äº¤å‡º CPUã€‚å½“æ•°æ®å°±ç»ªä¹‹åï¼Œå†…æ ¸ä¼šå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çº¿ç¨‹ï¼Œå¹¶è¿”å›ç»“æœç»™ç”¨æˆ·çº¿ç¨‹ï¼Œç”¨æˆ·çº¿ç¨‹æ‰è§£é™¤ block çŠ¶æ€ã€‚å…¸å‹çš„é˜»å¡ IO æ¨¡å‹çš„ä¾‹å­ä¸ºï¼š data &#x3D; socket.read();å¦‚æœæ•°æ®æ²¡æœ‰å°±ç»ªï¼Œå°±ä¼šä¸€ç›´é˜»å¡åœ¨ read æ–¹æ³•ã€‚</p><p>â€”â€”ç”¨æˆ·çº¿ç¨‹å¾—ä¸åˆ°æ•°æ®å°±ä¼šé˜»å¡(æ”¾å¼ƒCPU)ï¼Œç›´åˆ°æ•°æ®å°±ç»ª</p><h5 id="1-8-1-2-éé˜»å¡-IO-æ¨¡å‹"><a href="#1-8-1-2-éé˜»å¡-IO-æ¨¡å‹" class="headerlink" title="1.8.1.2. éé˜»å¡ IO æ¨¡å‹"></a>1.8.1.2. éé˜»å¡ IO æ¨¡å‹</h5><p>â€‹å½“ç”¨æˆ·çº¿ç¨‹å‘èµ·ä¸€ä¸ª read æ“ä½œåï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…ï¼Œè€Œæ˜¯é©¬ä¸Šå°±å¾—åˆ°äº†ä¸€ä¸ªç»“æœã€‚ å¦‚æœç»“æœæ˜¯ä¸€ä¸ªerror æ—¶ï¼Œå®ƒå°±çŸ¥é“æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œäºæ˜¯å®ƒå¯ä»¥å†æ¬¡å‘é€ read æ“ä½œã€‚ä¸€æ—¦å†…æ ¸ä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå¹¶ä¸”åˆå†æ¬¡æ”¶åˆ°äº†ç”¨æˆ·çº¿ç¨‹çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒé©¬ä¸Šå°±å°†æ•°æ®æ‹·è´åˆ°äº†ç”¨æˆ·çº¿ç¨‹ï¼Œç„¶åè¿”å›ã€‚æ‰€ä»¥äº‹å®ä¸Šï¼Œ<u>åœ¨éé˜»å¡ IO æ¨¡å‹ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹éœ€è¦ä¸æ–­åœ°è¯¢é—®å†…æ ¸æ•°æ®æ˜¯å¦å°±ç»ªï¼Œä¹Ÿå°±è¯´éé˜»å¡ IOä¸ä¼šäº¤å‡º CPUï¼Œè€Œä¼šä¸€ç›´å ç”¨ CPU</u>ã€‚ å…¸å‹çš„éé˜»å¡ IO æ¨¡å‹ä¸€èˆ¬å¦‚ä¸‹ï¼š</p><p>â€”â€”ç”¨æˆ·çº¿ç¨‹å¾—ä¸åˆ°æ•°æ®ä¼šä¸€ç›´è¯¢é—®(ä¸€ç›´å ç”¨CPU)ï¼Œç›´åˆ°è·å–æ•°æ®</p><p>âš ï¸éé˜»å¡IOåœ¨è·å–ä¸åˆ°æ•°æ®æ—¶ä¼šä¸æ–­è¯¢é—®ï¼Œå¯¼è‡´CPUå ç”¨ç‡å¾ˆé«˜</p><h5 id="1-8-1-3-å¤šè·¯å¤ç”¨-IO-æ¨¡å‹"><a href="#1-8-1-3-å¤šè·¯å¤ç”¨-IO-æ¨¡å‹" class="headerlink" title="1.8.1.3. å¤šè·¯å¤ç”¨ IO æ¨¡å‹"></a>1.8.1.3. å¤šè·¯å¤ç”¨ IO æ¨¡å‹</h5><p>â€‹å¤šè·¯å¤ç”¨ IO æ¨¡å‹æ˜¯ç›®å‰ä½¿ç”¨å¾—æ¯”è¾ƒå¤šçš„æ¨¡å‹ã€‚ Java NIO å®é™…ä¸Šå°±æ˜¯å¤šè·¯å¤ç”¨ IOã€‚<br>â€‹åœ¨å¤šè·¯å¤ç”¨ IOæ¨¡å‹ä¸­ï¼Œ<u>ä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹ä¸æ–­å»è½®è¯¢å¤šä¸ª socket çš„çŠ¶æ€</u>ï¼Œåªæœ‰å½“ socket çœŸæ­£æœ‰è¯»å†™äº‹ä»¶æ—¶ï¼Œæ‰çœŸæ­£è°ƒç”¨å®é™…çš„ IO è¯»å†™æ“ä½œã€‚å› ä¸ºåœ¨å¤šè·¯å¤ç”¨ IO æ¨¡å‹ä¸­ï¼Œåªéœ€è¦ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥ç®¡ç†å¤šä¸ªsocketï¼Œç³»ç»Ÿä¸éœ€è¦å»ºç«‹æ–°çš„è¿›ç¨‹æˆ–è€…çº¿ç¨‹ï¼Œä¹Ÿä¸å¿…ç»´æŠ¤è¿™äº›çº¿ç¨‹å’Œè¿›ç¨‹ï¼Œå¹¶ä¸”åªæœ‰åœ¨çœŸæ­£æœ‰socket è¯»å†™äº‹ä»¶è¿›è¡Œæ—¶ï¼Œæ‰ä¼šä½¿ç”¨ IO èµ„æºï¼Œæ‰€ä»¥å®ƒå¤§å¤§å‡å°‘äº†èµ„æºå ç”¨ã€‚åœ¨ Java NIO ä¸­ï¼Œæ˜¯é€šè¿‡ selector.select()å»æŸ¥è¯¢æ¯ä¸ªé€šé“æ˜¯å¦æœ‰åˆ°è¾¾äº‹ä»¶ï¼Œå¦‚æœæ²¡æœ‰äº‹ä»¶ï¼Œåˆ™ä¸€ç›´é˜»å¡åœ¨é‚£é‡Œï¼Œå› æ­¤è¿™ç§æ–¹å¼ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹çš„é˜»å¡ã€‚<u>å¤šè·¯å¤ç”¨ IO æ¨¡å¼ï¼Œé€šè¿‡ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥ç®¡ç†å¤šä¸ª socketï¼Œåªæœ‰å½“socket çœŸæ­£æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿæ‰ä¼šå ç”¨èµ„æºæ¥è¿›è¡Œå®é™…çš„è¯»å†™æ“ä½œã€‚å› æ­¤ï¼Œå¤šè·¯å¤ç”¨ IO æ¯”è¾ƒé€‚åˆè¿æ¥æ•°æ¯”è¾ƒå¤šçš„æƒ…å†µã€‚</u></p><p>âš ï¸å¤šè·¯å¤ç”¨ IO æ¨¡å‹æ˜¯é€šè¿‡è½®è¯¢çš„æ–¹å¼æ¥æ£€æµ‹æ˜¯å¦æœ‰äº‹ä»¶åˆ°è¾¾ï¼Œå¹¶ä¸”å¯¹åˆ°è¾¾çš„äº‹ä»¶é€ä¸€è¿›è¡Œå“åº”ã€‚å› æ­¤å¯¹äºå¤šè·¯å¤ç”¨ IO æ¨¡å‹æ¥è¯´ï¼Œä¸€æ—¦äº‹ä»¶å“åº”ä½“å¾ˆå¤§ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´åç»­çš„äº‹ä»¶è¿Ÿè¿Ÿå¾—ä¸åˆ°å¤„ç†ï¼Œå¹¶ä¸”ä¼šå½±å“æ–°çš„äº‹ä»¶è½®è¯¢ã€‚</p><h5 id="1-8-1-4-ä¿¡å·é©±åŠ¨-IO-æ¨¡å‹"><a href="#1-8-1-4-ä¿¡å·é©±åŠ¨-IO-æ¨¡å‹" class="headerlink" title="1.8.1.4. ä¿¡å·é©±åŠ¨ IO æ¨¡å‹"></a>1.8.1.4. ä¿¡å·é©±åŠ¨ IO æ¨¡å‹</h5><p>â€‹åœ¨ä¿¡å·é©±åŠ¨ IO æ¨¡å‹ä¸­ï¼Œå½“ç”¨æˆ·çº¿ç¨‹å‘èµ·ä¸€ä¸ª IO è¯·æ±‚æ“ä½œï¼Œä¼š<u>ç»™å¯¹åº”çš„ socket æ³¨å†Œä¸€ä¸ªä¿¡å·å‡½æ•°ï¼Œç„¶åç”¨æˆ·çº¿ç¨‹ä¼šç»§ç»­æ‰§è¡Œï¼Œå½“å†…æ ¸æ•°æ®å°±ç»ªæ—¶ä¼šå‘é€ä¸€ä¸ªä¿¡å·ç»™ç”¨æˆ·çº¿ç¨‹</u>ï¼Œç”¨æˆ·çº¿ç¨‹æ¥æ”¶åˆ°ä¿¡å·ä¹‹åï¼Œä¾¿åœ¨ä¿¡å·å‡½æ•°ä¸­è°ƒç”¨ IO è¯»å†™æ“ä½œæ¥è¿›è¡Œå®é™…çš„ IO è¯·æ±‚æ“ä½œã€‚</p><p>âš ï¸ä¿¡å·æ˜¯å‘Šè¯‰ä½ æ•°æ®å·²ç»å¥½äº†ï¼Œç”¨æˆ·çº¿ç¨‹è‡ªå·±æ¥è°ƒç”¨</p><h5 id="1-8-1-5-å¼‚æ­¥-IO-æ¨¡å‹"><a href="#1-8-1-5-å¼‚æ­¥-IO-æ¨¡å‹" class="headerlink" title="1.8.1.5. å¼‚æ­¥ IO æ¨¡å‹"></a>1.8.1.5. å¼‚æ­¥ IO æ¨¡å‹</h5><p>â€‹å¼‚æ­¥ IO æ¨¡å‹æ‰æ˜¯<u>æœ€ç†æƒ³</u>çš„ IO æ¨¡å‹ï¼Œåœ¨å¼‚æ­¥ IO æ¨¡å‹ä¸­ï¼Œå½“ç”¨æˆ·çº¿ç¨‹å‘èµ· read æ“ä½œä¹‹åï¼Œç«‹åˆ»å°±å¯ä»¥å¼€å§‹å»åšå…¶å®ƒçš„äº‹ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œä»å†…æ ¸çš„è§’åº¦ï¼Œå½“å®ƒå—åˆ°ä¸€ä¸ª asynchronous read ä¹‹åï¼Œå®ƒä¼šç«‹åˆ»è¿”å›ï¼Œè¯´æ˜ read è¯·æ±‚å·²ç»æˆåŠŸå‘èµ·äº†ï¼Œå› æ­¤ä¸ä¼šå¯¹ç”¨æˆ·çº¿ç¨‹äº§ç”Ÿä»»ä½• blockã€‚ç„¶åï¼Œå†…æ ¸ä¼šç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œç„¶åå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çº¿ç¨‹ï¼Œå½“è¿™ä¸€åˆ‡éƒ½å®Œæˆä¹‹åï¼Œå†…æ ¸ä¼šç»™ç”¨æˆ·çº¿ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œå‘Šè¯‰å®ƒ read æ“ä½œå®Œæˆäº†ã€‚ä¹Ÿå°±è¯´ç”¨æˆ·çº¿ç¨‹å®Œå…¨ä¸éœ€è¦å®é™…çš„æ•´ä¸ª IO æ“ä½œæ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼Œ åªéœ€è¦å…ˆå‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œå½“æ¥æ”¶å†…æ ¸è¿”å›çš„æˆåŠŸä¿¡å·æ—¶è¡¨ç¤º IO æ“ä½œå·²ç»å®Œæˆï¼Œå¯ä»¥ç›´æ¥å»ä½¿ç”¨æ•°æ®äº†ã€‚</p><p>â€‹ä¹Ÿå°±è¯´åœ¨å¼‚æ­¥ IO æ¨¡å‹ä¸­ï¼Œ IO æ“ä½œçš„ä¸¤ä¸ªé˜¶æ®µéƒ½ä¸ä¼šé˜»å¡ç”¨æˆ·çº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µéƒ½æ˜¯ç”±å†…æ ¸è‡ªåŠ¨å®Œæˆï¼Œç„¶åå‘é€ä¸€ä¸ªä¿¡å·å‘ŠçŸ¥ç”¨æˆ·çº¿ç¨‹æ“ä½œå·²å®Œæˆã€‚ç”¨æˆ·çº¿ç¨‹ä¸­ä¸éœ€è¦å†æ¬¡è°ƒç”¨ IO å‡½æ•°è¿›è¡Œå…·ä½“çš„è¯»å†™ã€‚è¿™ç‚¹æ˜¯å’Œä¿¡å·é©±åŠ¨æ¨¡å‹æœ‰æ‰€ä¸åŒçš„ï¼Œåœ¨ä¿¡å·é©±åŠ¨æ¨¡å‹ä¸­ï¼Œå½“ç”¨æˆ·çº¿ç¨‹æ¥æ”¶åˆ°ä¿¡å·è¡¨ç¤ºæ•°æ®å·²ç»å°±ç»ªï¼Œç„¶åéœ€è¦ç”¨æˆ·çº¿ç¨‹è°ƒç”¨ IO å‡½æ•°è¿›è¡Œå®é™…çš„è¯»å†™æ“ä½œï¼›è€Œ<u><strong>åœ¨å¼‚æ­¥ IO æ¨¡å‹ä¸­ï¼Œæ”¶åˆ°ä¿¡å·è¡¨ç¤º IO æ“ä½œå·²ç»å®Œæˆï¼Œä¸éœ€è¦å†åœ¨ç”¨æˆ·çº¿ç¨‹ä¸­è°ƒç”¨ IO å‡½æ•°è¿›è¡Œå®é™…çš„è¯»å†™æ“ä½œã€‚</strong></u></p><p>âš ï¸å†…æ ¸å¸®ä½ è¯»äº†æ•°æ®å¹¶ä¸”å¤åˆ¶ç»™ä½ äº†ï¼Œä½ ä»€ä¹ˆä¸è¢«è€½è¯¯å°±æ”¶åˆ°äº†æ•°æ®ï¼</p><h4 id="1-8-2-Java-NIO"><a href="#1-8-2-Java-NIO" class="headerlink" title="1.8.2.Java NIO"></a>1.8.2.Java NIO</h4><p>NIO ä¸»è¦æœ‰ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†ï¼š <strong>Channel(é€šé“)ï¼Œ Buffer(ç¼“å†²åŒº), Selector</strong>ã€‚*<u>ä¼ ç»Ÿ IO åŸºäºå­—èŠ‚æµå’Œå­—ç¬¦æµè¿›è¡Œæ“ä½œ</u>*ï¼Œ è€Œ NIO åŸºäº Channel å’Œ Buffer(ç¼“å†²åŒº)è¿›è¡Œæ“ä½œï¼Œ<u>æ•°æ®æ€»æ˜¯ä»é€šé“è¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œæˆ–è€…ä»ç¼“å†²åŒºå†™å…¥åˆ°é€šé“ä¸­</u>ã€‚ Selector(é€‰æ‹©åŒº)ç”¨äº<u>ç›‘å¬å¤šä¸ªé€šé“çš„äº‹ä»¶ï¼ˆæ¯”å¦‚ï¼šè¿æ¥æ‰“å¼€ï¼Œæ•°æ®åˆ°è¾¾ï¼‰</u>ã€‚å› æ­¤ï¼Œå•ä¸ªçº¿ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ªæ•°æ®é€šé“ã€‚</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731140704880.png" alt="image-20230731140704880" style="zoom:50%;" /><p>ğŸŒŸNIO å’Œä¼ ç»Ÿ IO ä¹‹é—´ç¬¬ä¸€ä¸ªæœ€å¤§çš„åŒºåˆ«æ˜¯ï¼Œ IO æ˜¯é¢å‘æµçš„ï¼Œ NIO æ˜¯é¢å‘ç¼“å†²åŒºçš„ã€‚</p><h5 id="1-8-2-1-NIO-çš„ç¼“å†²åŒº"><a href="#1-8-2-1-NIO-çš„ç¼“å†²åŒº" class="headerlink" title="1.8.2.1. NIO çš„ç¼“å†²åŒº"></a>1.8.2.1. NIO çš„ç¼“å†²åŒº</h5><p>â€‹Java IO é¢å‘æµæ„å‘³ç€æ¯æ¬¡ä»æµä¸­è¯»ä¸€ä¸ªæˆ–å¤šä¸ªå­—èŠ‚ï¼Œç›´è‡³è¯»å–æ‰€æœ‰å­—èŠ‚ï¼Œ<u>å®ƒä»¬æ²¡æœ‰è¢«ç¼“å­˜åœ¨ä»»ä½•åœ°æ–¹</u>ã€‚æ­¤å¤–ï¼Œå®ƒä¸èƒ½å‰åç§»åŠ¨æµä¸­çš„æ•°æ®ã€‚å¦‚æœéœ€è¦å‰åç§»åŠ¨ä»æµä¸­è¯»å–çš„æ•°æ®ï¼Œ éœ€è¦å…ˆå°†å®ƒç¼“å­˜åˆ°ä¸€ä¸ªç¼“å†²åŒºã€‚ NIO çš„ç¼“å†²å¯¼å‘æ–¹æ³•ä¸åŒã€‚æ•°æ®è¯»å–åˆ°ä¸€ä¸ªå®ƒç¨åå¤„ç†çš„ç¼“å†²åŒºï¼Œéœ€è¦æ—¶å¯åœ¨ç¼“å†²åŒºä¸­å‰åç§»åŠ¨ã€‚è¿™å°±å¢åŠ äº†å¤„ç†è¿‡ç¨‹ä¸­çš„çµæ´»æ€§ã€‚ä½†æ˜¯ï¼Œè¿˜éœ€è¦æ£€æŸ¥è¯¥ç¼“å†²åŒºä¸­æ˜¯å¦åŒ…å«æ‚¨éœ€è¦å¤„ç†çš„æ•°æ®ã€‚è€Œä¸”éœ€ç¡®ä¿å½“æ›´å¤šçš„æ•°æ®è¯»å…¥ç¼“å†²åŒºæ—¶ï¼Œä¸èƒ½è¦†ç›–ç¼“å†²åŒºé‡Œå°šæœªå¤„ç†çš„æ•°æ®ã€‚</p><h5 id="1-8-2-2-NIO-çš„éé˜»å¡"><a href="#1-8-2-2-NIO-çš„éé˜»å¡" class="headerlink" title="1.8.2.2. NIO çš„éé˜»å¡"></a>1.8.2.2. NIO çš„éé˜»å¡</h5><p>â€‹IO çš„å„ç§æµæ˜¯é˜»å¡çš„ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ read() æˆ– write()æ—¶ï¼Œè¯¥çº¿ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æœ‰ä¸€äº›æ•°æ®è¢«è¯»å–ï¼Œæˆ–æ•°æ®å®Œå…¨å†™å…¥ã€‚è¯¥çº¿ç¨‹åœ¨æ­¤æœŸé—´ä¸èƒ½å†å¹²ä»»ä½•äº‹æƒ…äº†ã€‚ NIO çš„éé˜»å¡æ¨¡å¼ï¼Œä½¿ä¸€ä¸ªçº¿ç¨‹ä»æŸé€šé“å‘é€è¯·æ±‚è¯»å–æ•°æ®ï¼Œä½†æ˜¯<u>å®ƒä»…èƒ½å¾—åˆ°ç›®å‰å¯ç”¨çš„æ•°æ®</u>ï¼Œå¦‚æœç›®å‰æ²¡æœ‰æ•°æ®å¯ç”¨æ—¶ï¼Œå°±ä»€ä¹ˆéƒ½ä¸ä¼šè·å–ã€‚è€Œä¸æ˜¯ä¿æŒçº¿ç¨‹é˜»å¡ï¼Œ<u>æ‰€ä»¥ç›´è‡³æ•°æ®å˜çš„å¯ä»¥è¯»å–ä¹‹å‰ï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç»§ç»­åšå…¶ä»–çš„äº‹æƒ…</u>ã€‚ éé˜»å¡å†™ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™å…¥ä¸€äº›æ•°æ®åˆ°æŸé€šé“ï¼Œä½†<u>ä¸éœ€è¦ç­‰å¾…å®ƒå®Œå…¨å†™å…¥ï¼Œè¿™ä¸ªçº¿ç¨‹åŒæ—¶å¯ä»¥å»åšåˆ«çš„äº‹æƒ…</u>ã€‚ çº¿ç¨‹é€šå¸¸å°†éé˜»å¡ IO çš„ç©ºé—²æ—¶é—´ç”¨äºåœ¨å…¶å®ƒé€šé“ä¸Šæ‰§è¡Œ IO æ“ä½œï¼Œæ‰€ä»¥ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ç°åœ¨å¯ä»¥ç®¡ç†å¤šä¸ªè¾“å…¥å’Œè¾“å‡ºé€šé“ï¼ˆchannelï¼‰ã€‚</p><h5 id="1-8-2-3-Channel"><a href="#1-8-2-3-Channel" class="headerlink" title="1.8.2.3. Channel"></a>1.8.2.3. Channel</h5><p>é¦–å…ˆè¯´ä¸€ä¸‹ Channelï¼Œå›½å†…å¤§å¤šç¿»è¯‘æˆâ€œé€šé“â€ã€‚ Channel å’Œ IO ä¸­çš„ Stream(æµ)æ˜¯å·®ä¸å¤šä¸€ä¸ªç­‰çº§çš„ã€‚ åªä¸è¿‡ Stream æ˜¯å•å‘çš„ï¼Œè­¬å¦‚ï¼š InputStream, OutputStreamï¼Œ è€Œ <u>Channel æ˜¯åŒå‘çš„ï¼Œæ—¢å¯ä»¥ç”¨æ¥è¿›è¡Œè¯»æ“ä½œï¼Œåˆå¯ä»¥ç”¨æ¥è¿›è¡Œå†™æ“ä½œ</u>ã€‚</p><p>NIO ä¸­çš„ Channel çš„ä¸»è¦å®ç°æœ‰ï¼š</p><ol><li><p>FileChannel</p></li><li><p>DatagramChannel</p></li><li><p>SocketChannel</p></li><li><p>ServerSocketChannel</p></li></ol><p>è¿™é‡Œçœ‹åå­—å°±å¯ä»¥çŒœå‡ºä¸ªæ‰€ä»¥ç„¶æ¥ï¼šåˆ†åˆ«å¯ä»¥å¯¹åº”æ–‡ä»¶ IOã€ UDP å’Œ TCPï¼ˆServer å’Œ Clientï¼‰ã€‚</p><h5 id="1-8-2-4-Buffer"><a href="#1-8-2-4-Buffer" class="headerlink" title="1.8.2.4. Buffer"></a>1.8.2.4. Buffer</h5><p>Bufferï¼Œæ•…åæ€æ„ï¼Œ ç¼“å†²åŒºï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªè¿ç»­æ•°ç»„ã€‚ Channel æä¾›ä»æ–‡ä»¶ã€ç½‘ç»œè¯»å–æ•°æ®çš„æ¸ é“ï¼Œä½†æ˜¯è¯»å–æˆ–å†™å…¥çš„æ•°æ®éƒ½å¿…é¡»ç»ç”± Bufferã€‚</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731141618555.png" alt="image-20230731141618555" style="zoom:40%;" /><h5 id="1-8-2-5-Selector"><a href="#1-8-2-5-Selector" class="headerlink" title="1.8.2.5. Selector"></a>1.8.2.5. Selector</h5><p>â€‹Selector ç±»æ˜¯ NIO çš„æ ¸å¿ƒç±»ï¼Œ <u>Selector èƒ½å¤Ÿæ£€æµ‹å¤šä¸ªæ³¨å†Œçš„é€šé“ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œå¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œä¾¿è·å–äº‹ä»¶ç„¶åé’ˆå¯¹æ¯ä¸ªäº‹ä»¶è¿›è¡Œç›¸åº”çš„å“åº”å¤„ç†</u>ã€‚è¿™æ ·ä¸€æ¥ï¼Œåªæ˜¯ç”¨ä¸€ä¸ªå•çº¿ç¨‹å°±å¯ä»¥ç®¡ç†å¤šä¸ªé€šé“ï¼Œä¹Ÿå°±æ˜¯ç®¡ç†å¤šä¸ªè¿æ¥ã€‚è¿™æ ·ä½¿å¾—åªæœ‰åœ¨è¿æ¥çœŸæ­£æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰ä¼šè°ƒç”¨å‡½æ•°æ¥è¿›è¡Œè¯»å†™ï¼Œå°±å¤§å¤§åœ°å‡å°‘äº†ç³»ç»Ÿå¼€é”€ï¼Œå¹¶ä¸”ä¸å¿…ä¸ºæ¯ä¸ªè¿æ¥éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ç”¨å»ç»´æŠ¤å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´çš„å¼€é”€ã€‚</p><h3 id="1-9-JVM-ç±»åŠ è½½æœºåˆ¶"><a href="#1-9-JVM-ç±»åŠ è½½æœºåˆ¶" class="headerlink" title="1.9.JVM ç±»åŠ è½½æœºåˆ¶"></a>1.9.JVM ç±»åŠ è½½æœºåˆ¶</h3><p>JVM ç±»<u>åŠ è½½æœºåˆ¶</u>åˆ†ä¸ºäº”ä¸ªéƒ¨åˆ†ï¼š<strong>åŠ è½½ï¼ŒéªŒè¯ï¼Œå‡†å¤‡ï¼Œè§£æï¼Œåˆå§‹åŒ–</strong>ï¼Œä¸‹é¢æˆ‘ä»¬å°±åˆ†åˆ«æ¥çœ‹ä¸€ä¸‹è¿™äº”ä¸ªè¿‡ç¨‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731230933568.png" alt="image-20230731230933568"></p><h4 id="1-9-1-åŠ è½½"><a href="#1-9-1-åŠ è½½" class="headerlink" title="1.9.1. åŠ è½½"></a>1.9.1. åŠ è½½</h4><p>åŠ è½½é˜¶æ®µä¼šåš3ä»¶äº‹æƒ…ï¼š</p><ul><li><u>é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</u></li><li>å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚</li><li><u><strong>åœ¨Javaå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡</strong></u>ï¼Œä½œä¸ºå¯¹æ–¹æ³•åŒºä¸­è¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ã€‚</li></ul><p>â€‹æ³¨æ„è¿™é‡Œä¸ä¸€å®šéå¾—è¦ä»ä¸€ä¸ª Class æ–‡ä»¶è·å–ï¼Œè¿™é‡Œæ—¢å¯ä»¥ä» ZIP åŒ…ä¸­è¯»å–ï¼ˆæ¯”å¦‚ä» jar åŒ…å’Œ war åŒ…ä¸­è¯»å–ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆï¼ˆåŠ¨æ€ä»£ç†ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”±å…¶å®ƒæ–‡ä»¶ç”Ÿæˆï¼ˆæ¯”å¦‚å°† JSP æ–‡ä»¶è½¬æ¢æˆå¯¹åº”çš„ Class ç±»ï¼‰ã€‚</p><h4 id="1-9-2-éªŒè¯"><a href="#1-9-2-éªŒè¯" class="headerlink" title="1.9.2. éªŒè¯"></a>1.9.2. éªŒè¯</h4><p>è¿™ä¸€é˜¶æ®µçš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†<u>ç¡®ä¿ Class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯æ˜¯å¦ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚</u></p><h4 id="1-9-3-å‡†å¤‡"><a href="#1-9-3-å‡†å¤‡" class="headerlink" title="1.9.3. å‡†å¤‡"></a>1.9.3. å‡†å¤‡</h4><p><strong><u>â€“é™æ€å˜é‡åˆå§‹åŒ–ä¸º0ã€nullç­‰é»˜è®¤å€¼ï¼Œåªæœ‰finalä¿®é¥°çš„å˜é‡åœ¨æ­¤é˜¶æ®µå°±èƒ½è¢«èµ‹äºˆç»™å®šçš„å€¼</u></strong></p><p>å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡çš„åˆå§‹å€¼é˜¶æ®µï¼Œå³**<u>åœ¨æ–¹æ³•åŒºä¸­</u>**åˆ†é…è¿™äº›å˜é‡æ‰€ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚æ³¨æ„è¿™é‡Œæ‰€è¯´çš„åˆå§‹å€¼æ¦‚å¿µï¼Œæ¯”å¦‚ä¸€ä¸ªç±»å˜é‡å®šä¹‰ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> <span class="number">8080</span>;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šå˜é‡ v åœ¨å‡†å¤‡é˜¶æ®µè¿‡åçš„åˆå§‹å€¼ä¸º 0 è€Œä¸æ˜¯ 8080ï¼Œ å°† v èµ‹å€¼ä¸º 8080 çš„ put static æŒ‡ä»¤æ˜¯ç¨‹åºè¢«ç¼–è¯‘åï¼Œ å­˜æ”¾äºç±»æ„é€ å™¨<client>æ–¹æ³•ä¹‹ä¸­ã€‚</p><p>âš ï¸ä½†æ˜¯æ³¨æ„å¦‚æœå£°æ˜ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> <span class="number">8080</span>;</span><br></pre></td></tr></table></figure><p>åœ¨ç¼–è¯‘é˜¶æ®µä¼šä¸º v ç”Ÿæˆ ConstantValue å±æ€§ï¼Œåœ¨å‡†å¤‡é˜¶æ®µè™šæ‹Ÿæœºä¼šæ ¹æ® ConstantValue å±æ€§å°† vèµ‹å€¼ä¸º 8080ã€‚</p><h4 id="1-9-4-è§£æ"><a href="#1-9-4-è§£æ" class="headerlink" title="1.9.4. è§£æ"></a>1.9.4. è§£æ</h4><p>â€”â€”åœ¨å†…å­˜ä¸­å®å®åœ¨åœ¨åœ°ä¸ºå˜é‡åˆ†é…å†…å­˜ç©ºé—´</p><p>è§£æé˜¶æ®µæ˜¯æŒ‡è™šæ‹Ÿæœº<u>å°†å¸¸é‡æ± ä¸­çš„<strong>ç¬¦å·å¼•ç”¨</strong>æ›¿æ¢ä¸º<strong>ç›´æ¥å¼•ç”¨</strong></u>çš„è¿‡ç¨‹ã€‚ç¬¦å·å¼•ç”¨å°±æ˜¯ class æ–‡ä»¶ä¸­çš„ï¼š</p><ol><li><p>CONSTANT_Class_info</p></li><li><p>CONSTANT_Field_info</p></li><li><p>CONSTANT_Method_info     ç­‰ç±»å‹çš„å¸¸é‡</p></li></ol><h5 id="1-9-4-1-ç¬¦å·å¼•ç”¨"><a href="#1-9-4-1-ç¬¦å·å¼•ç”¨" class="headerlink" title="1.9.4.1. ç¬¦å·å¼•ç”¨"></a>1.9.4.1. ç¬¦å·å¼•ç”¨</h5><ul><li>ç¬¦å·å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å¸ƒå±€æ— å…³ï¼Œ <strong>å¼•ç”¨çš„ç›®æ ‡å¹¶ä¸ä¸€å®šè¦å·²ç»åŠ è½½åˆ°å†…å­˜ä¸­</strong>ã€‚ <u>å„ç§è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€å¯ä»¥å„ä¸ç›¸åŒï¼Œä½†æ˜¯å®ƒä»¬èƒ½æ¥å—çš„ç¬¦å·å¼•ç”¨å¿…é¡»æ˜¯ä¸€è‡´çš„</u>ï¼Œå› ä¸ºç¬¦å·å¼•ç”¨çš„å­—é¢é‡å½¢å¼æ˜ç¡®å®šä¹‰åœ¨ Java è™šæ‹Ÿæœºè§„èŒƒçš„ Class æ–‡ä»¶æ ¼å¼ä¸­ã€‚</li></ul><h5 id="1-9-4-2-ç›´æ¥å¼•ç”¨"><a href="#1-9-4-2-ç›´æ¥å¼•ç”¨" class="headerlink" title="1.9.4.2. ç›´æ¥å¼•ç”¨"></a>1.9.4.2. ç›´æ¥å¼•ç”¨</h5><ul><li>ç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯<u>æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆï¼Œç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„</u>ã€‚å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£<strong>å¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»åœ¨å†…å­˜ä¸­å­˜åœ¨ã€‚</strong></li></ul><h4 id="1-9-5-åˆå§‹åŒ–"><a href="#1-9-5-åˆå§‹åŒ–" class="headerlink" title="1.9.5. åˆå§‹åŒ–"></a>1.9.5. åˆå§‹åŒ–</h4><p>åˆå§‹åŒ–é˜¶æ®µæ˜¯ç±»åŠ è½½æœ€åä¸€ä¸ªé˜¶æ®µï¼Œå‰é¢çš„ç±»åŠ è½½é˜¶æ®µä¹‹åï¼Œé™¤äº†åœ¨åŠ è½½é˜¶æ®µå¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä»¥å¤–ï¼Œå…¶å®ƒæ“ä½œéƒ½ç”± JVM ä¸»å¯¼ã€‚åˆ°äº†åˆå§‹é˜¶æ®µï¼Œæ‰å¼€å§‹çœŸæ­£æ‰§è¡Œç±»ä¸­å®šä¹‰çš„ Java ç¨‹åºä»£ç ã€‚</p><h5 id="1-9-5-1-ç±»æ„é€ å™¨-lt-c-l-i-e-n-t-gt"><a href="#1-9-5-1-ç±»æ„é€ å™¨-lt-c-l-i-e-n-t-gt" class="headerlink" title="1.9.5.1 ç±»æ„é€ å™¨ &lt; c l i e n t &gt;"></a>1.9.5.1 ç±»æ„é€ å™¨ &lt; c l i e n t &gt;</h5><p>â€‹ğŸŒŸåˆå§‹åŒ–é˜¶æ®µæ˜¯<u>æ‰§è¡Œç±»æ„é€ å™¨<client>æ–¹æ³•</u>çš„è¿‡ç¨‹ã€‚ <client>æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨<em><strong>æ”¶é›†ç±»ä¸­çš„ç±»å˜é‡çš„èµ‹å€¼æ“ä½œ</strong></em>å’Œ<em><strong>é™æ€è¯­å¥å—ä¸­çš„è¯­å¥</strong></em>åˆå¹¶è€Œæˆçš„ã€‚è™šæ‹Ÿæœºä¼šä¿è¯å­<client>æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„<client>æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œ <u>å¦‚æœä¸€ä¸ªç±»ä¸­æ²¡æœ‰å¯¹é™æ€å˜é‡èµ‹å€¼ä¹Ÿæ²¡æœ‰é™æ€è¯­å¥å—ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¿™ä¸ªç±»ç”Ÿæˆ<client>()æ–¹æ³•ã€‚</u></p><h5 id="âš ï¸æ³¨æ„ä»¥ä¸‹å‡ ç§æƒ…å†µä¸ä¼šæ‰§è¡Œç±»åˆå§‹åŒ–ï¼š"><a href="#âš ï¸æ³¨æ„ä»¥ä¸‹å‡ ç§æƒ…å†µä¸ä¼šæ‰§è¡Œç±»åˆå§‹åŒ–ï¼š" class="headerlink" title="âš ï¸æ³¨æ„ä»¥ä¸‹å‡ ç§æƒ…å†µä¸ä¼šæ‰§è¡Œç±»åˆå§‹åŒ–ï¼š"></a>âš ï¸æ³¨æ„ä»¥ä¸‹å‡ ç§æƒ…å†µ<u>ä¸ä¼š</u>æ‰§è¡Œç±»åˆå§‹åŒ–ï¼š</h5><ol><li><u><em>é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–ï¼Œè€Œä¸ä¼šè§¦å‘å­ç±»çš„åˆå§‹åŒ–ã€‚</em></u></li><li><u><em>å®šä¹‰å¯¹è±¡æ•°ç»„ï¼Œä¸ä¼šè§¦å‘è¯¥ç±»çš„åˆå§‹åŒ–ã€‚</em></u></li><li><u><em>å¸¸é‡åœ¨ç¼–è¯‘æœŸé—´ä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ç›´æ¥å¼•ç”¨å®šä¹‰å¸¸é‡çš„ç±»ï¼Œä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡æ‰€åœ¨çš„ç±»ã€‚</em></u></li><li><u><em>é€šè¿‡ç±»åè·å– Class å¯¹è±¡ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ–ã€‚</em></u></li><li><u><em>é€šè¿‡ Class.forName åŠ è½½æŒ‡å®šç±»æ—¶ï¼Œå¦‚æœæŒ‡å®šå‚æ•° initialize ä¸º false æ—¶ï¼Œä¹Ÿä¸ä¼šè§¦å‘ç±»åˆå§‹åŒ–ï¼Œå…¶å®è¿™ä¸ªå‚æ•°æ˜¯å‘Šè¯‰è™šæ‹Ÿæœºï¼Œæ˜¯å¦è¦å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ã€‚</em></u></li><li><u><em>é€šè¿‡ ClassLoader é»˜è®¤çš„ loadClass æ–¹æ³•ï¼Œä¹Ÿä¸ä¼šè§¦å‘åˆå§‹åŒ–åŠ¨ä½œã€‚</em></u></li></ol><h5 id="1-9-5-2-ç±»åŠ è½½å™¨"><a href="#1-9-5-2-ç±»åŠ è½½å™¨" class="headerlink" title="1.9.5.2 ç±»åŠ è½½å™¨"></a>1.9.5.2 ç±»åŠ è½½å™¨</h5><h6 id="1-9-5-2-1-å¯åŠ¨ç±»åŠ è½½å™¨-Bootstrap-ClassLoader"><a href="#1-9-5-2-1-å¯åŠ¨ç±»åŠ è½½å™¨-Bootstrap-ClassLoader" class="headerlink" title="1.9.5.2.1. å¯åŠ¨ç±»åŠ è½½å™¨(Bootstrap ClassLoader)"></a>1.9.5.2.1. å¯åŠ¨ç±»åŠ è½½å™¨(Bootstrap ClassLoader)</h6><p>â€‹è´Ÿè´£åŠ è½½ JAVA_HOME\lib ç›®å½•ä¸­çš„ï¼Œ æˆ–é€šè¿‡-Xbootclasspath å‚æ•°æŒ‡å®šè·¯å¾„ä¸­çš„ï¼Œ ä¸”è¢«è™šæ‹Ÿæœºè®¤å¯ï¼ˆæŒ‰æ–‡ä»¶åè¯†åˆ«ï¼Œ å¦‚ rt.jarï¼‰ çš„ç±»ã€‚</p><h6 id="1-9-5-2-2-æ‰©å±•ç±»åŠ è½½å™¨-Extension-ClassLoader"><a href="#1-9-5-2-2-æ‰©å±•ç±»åŠ è½½å™¨-Extension-ClassLoader" class="headerlink" title="1.9.5.2.2. æ‰©å±•ç±»åŠ è½½å™¨(Extension ClassLoader)"></a>1.9.5.2.2. æ‰©å±•ç±»åŠ è½½å™¨(Extension ClassLoader)</h6><p>â€‹è´Ÿè´£åŠ è½½ JAVA_HOME\lib\ext ç›®å½•ä¸­çš„ï¼Œæˆ–é€šè¿‡ java.ext.dirs ç³»ç»Ÿå˜é‡æŒ‡å®šè·¯å¾„ä¸­çš„ç±»åº“ã€‚</p><h6 id="1-9-5-2-3-åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨-Application-ClassLoader-ï¼š"><a href="#1-9-5-2-3-åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨-Application-ClassLoader-ï¼š" class="headerlink" title="1.9.5.2.3. åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨(Application ClassLoader)ï¼š"></a>1.9.5.2.3. åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨(Application ClassLoader)ï¼š</h6><p>â€‹è´Ÿè´£åŠ è½½ç”¨æˆ·è·¯å¾„ï¼ˆclasspathï¼‰ä¸Šçš„ç±»åº“ã€‚JVM é€šè¿‡åŒäº²å§”æ´¾æ¨¡å‹è¿›è¡Œç±»çš„åŠ è½½ï¼Œ å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç»§æ‰¿ java.lang.ClassLoaderå®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚</p><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230731232552332.png" alt="image-20230731232552332" style="zoom: 33%;" /><h5 id="1-9-5-3-åŒäº²å§”æ´¾"><a href="#1-9-5-3-åŒäº²å§”æ´¾" class="headerlink" title="1.9.5.3 åŒäº²å§”æ´¾"></a>1.9.5.3 åŒäº²å§”æ´¾</h5><p>â€‹å½“ä¸€ä¸ªç±»æ”¶åˆ°äº†<strong>âš ï¸æœªçŸ¥çš„</strong>ç±»åŠ è½½è¯·æ±‚ï¼Œä»–é¦–å…ˆä¸ä¼šå°è¯•è‡ªå·±å»åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠ<u>è¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»å»å®Œæˆ</u>ï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚éƒ½åº”è¯¥ä¼ é€åˆ°å¯åŠ¨ç±»åŠ è½½å…¶ä¸­ï¼Œåªæœ‰<u>å½“çˆ¶ç±»åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼ˆåœ¨å®ƒçš„åŠ è½½è·¯å¾„ä¸‹æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€åŠ è½½çš„Classï¼‰ï¼Œ å­ç±»åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚</u></p><p>â€‹é‡‡ç”¨åŒäº²å§”æ´¾çš„ä¸€ä¸ªå¥½å¤„æ˜¯æ¯”å¦‚åŠ è½½ä½äº rt.jar åŒ…ä¸­çš„ç±» java.lang.Objectï¼Œä¸ç®¡æ˜¯å“ªä¸ªåŠ è½½å™¨åŠ è½½è¿™ä¸ªç±»ï¼Œæœ€ç»ˆéƒ½æ˜¯å§”æ‰˜ç»™é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œ<u>è¿™æ ·å°±ä¿è¯äº†ä½¿ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨æœ€ç»ˆå¾—åˆ°çš„éƒ½æ˜¯åŒæ ·ä¸€ä¸ª Object å¯¹è±¡ã€‚</u></p><h6 id="ä¸ºä»€ä¹ˆéœ€è¦åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ</h6><p>åŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„ï¼š å¦‚æœæ²¡æœ‰åŒäº²å§”æ´¾æ¨¡å‹è€Œæ˜¯ç”±å„ä¸ªç±»åŠ è½½å™¨è‡ªè¡ŒåŠ è½½çš„è¯ï¼Œå¦‚æœç”¨æˆ·ç¼–å†™äº†ä¸€ä¸ª<code>java.lang.Object</code>çš„åŒåç±»å¹¶æ”¾åœ¨<code>ClassPath</code>ä¸­ï¼Œå¤šä¸ªç±»åŠ è½½å™¨éƒ½å»åŠ è½½è¿™ä¸ªç±»åˆ°å†…å­˜ä¸­ï¼Œç³»ç»Ÿä¸­å°†ä¼šå‡ºç°å¤šä¸ªä¸åŒçš„<code>Object</code>ç±»ï¼Œé‚£ä¹ˆç±»ä¹‹é—´çš„æ¯”è¾ƒç»“æœåŠç±»çš„å”¯ä¸€æ€§å°†æ— æ³•ä¿è¯ã€‚</p><h6 id="ğŸŒŸåŒäº²å§”æ´¾æµç¨‹å›¾ï¼š"><a href="#ğŸŒŸåŒäº²å§”æ´¾æµç¨‹å›¾ï¼š" class="headerlink" title="ğŸŒŸåŒäº²å§”æ´¾æµç¨‹å›¾ï¼š"></a>ğŸŒŸåŒäº²å§”æ´¾æµç¨‹å›¾ï¼š</h6><img src="https://cdn.jsdelivr.net/gh/Tangjiayang/picodemo/img/image-20230911091721446.png" alt="image-20230911091721446" style="zoom:50%;" /><h3 id="ğŸ’˜æ¢ç©¶ï¼šClassLoaderè¯¦è§£ï¼š"><a href="#ğŸ’˜æ¢ç©¶ï¼šClassLoaderè¯¦è§£ï¼š" class="headerlink" title="ğŸ’˜æ¢ç©¶ï¼šClassLoaderè¯¦è§£ï¼š"></a>ğŸ’˜æ¢ç©¶ï¼šClassLoaderè¯¦è§£ï¼š</h3><p>â€‹ClassLoaderæ˜¯ç”¨æ¥æŸ¥æ‰¾Classçš„ï¼Œè´Ÿè´£å°† **Class çš„å­—èŠ‚ç (.classæ–‡ä»¶)**å½¢å¼è½¬æ¢æˆå†…å­˜å½¢å¼çš„ Class å¯¹è±¡ã€‚</p><p>â€‹æ¯ä¸ª Class å¯¹è±¡çš„å†…éƒ¨éƒ½æœ‰ä¸€ä¸ª <code>classLoader</code> å­—æ®µæ¥æ ‡è¯†è‡ªå·±æ˜¯ç”±å“ªä¸ª ClassLoader åŠ è½½çš„ã€‚ClassLoader å°±åƒä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢è£…äº†å¾ˆå¤šå·²ç»åŠ è½½çš„ Class å¯¹è±¡ã€‚</p><p>â€‹ClassLoaderçš„å†…éƒ¨ç»“æ„å¦‚ä¸‹ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªå…³é”®æ–¹æ³•ï¼š</p><ul><li>loadClass()</li><li>findClass()</li><li>defineClass()</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŠ è½½å…¥å£ï¼Œå®šä¹‰äº†åŒäº²å§”æ´¾è§„åˆ™</span></span><br><span class="line">  Class <span class="title function_">loadClass</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="comment">// å…ˆçœ‹çœ‹è‡ªå·±æ˜¯å¦ã€Œå·²ç»ã€åŠ è½½è¿‡äº†</span></span><br><span class="line">    <span class="type">Class</span> <span class="variable">t</span> <span class="operator">=</span> <span class="built_in">this</span>.findFromLoaded(name);</span><br><span class="line">    <span class="keyword">if</span>(t == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// è‡ªå·±æ²¡åŠ è½½è¿‡ï¼Œåˆ™äº¤ç»™åŒäº²</span></span><br><span class="line">      t = <span class="built_in">this</span>.parent.loadClass(name)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(t == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// åŒäº²éƒ½ä¸è¡Œï¼Œåªèƒ½é è‡ªå·±äº†</span></span><br><span class="line">      t = <span class="built_in">this</span>.findClass(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// äº¤ç»™å­ç±»è‡ªå·±å»å®ç°</span></span><br><span class="line">  Class <span class="title function_">findClass</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> ClassNotFoundException();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç»„è£…Classå¯¹è±¡</span></span><br><span class="line">  Class <span class="title function_">defineClass</span><span class="params">(<span class="type">byte</span>[] code, String name)</span> &#123;</span><br><span class="line">    <span class="comment">//å°†ç±»çš„å­—èŠ‚ç è½¬æ¢ä¸ºClasså¯¹è±¡å¹¶è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> buildClassFromCode(code, name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line"></span><br><span class="line">  Class <span class="title function_">findClass</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="comment">// å¯»æ‰¾å­—èŠ‚ç </span></span><br><span class="line">    <span class="type">byte</span>[] code = findCodeFromSomewhere(name);</span><br><span class="line">    <span class="comment">// ç»„è£…Classå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.defineClass(code, name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹</p><h3 id="1-10-å¯¹è±¡åˆ›å»ºè¿‡ç¨‹"><a href="#1-10-å¯¹è±¡åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="1.10.å¯¹è±¡åˆ›å»ºè¿‡ç¨‹"></a>1.10.å¯¹è±¡åˆ›å»ºè¿‡ç¨‹</h3><ol><li><strong>ç±»åŠ è½½æ£€æŸ¥</strong>ï¼šJVMé‡åˆ°ä¸€æ¡newæŒ‡ä»¤æ—¶ï¼Œå…ˆæ£€æŸ¥èƒ½ä¸èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¯¥ç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½ã€è§£æå’Œåˆå§‹åŒ–ã€‚å¦‚æœæ²¡æœ‰å°±è¦å…ˆè¿›è¡Œç±»åŠ è½½ã€‚ç±»å·²è¢«åŠ è½½å°±é€šè¿‡æ£€æŸ¥ã€‚</li><li><strong>åˆ†é…å†…å­˜</strong>ï¼šç±»åŠ è½½æ£€æŸ¥é€šè¿‡åJVMä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ï¼Œå¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåå°±ç¡®å®šäº†ï¼ŒJVMä¼šåœ¨å †ä¸­æŒ‰ç…§æŒ‡é’ˆç¢°æ’æˆ–ç©ºé—²åˆ—è¡¨çš„æ–¹å¼ä¸ºå¯¹è±¡åˆ’åˆ†å‡ºä¸€å—ç©ºé—´ï¼Œé€‰æ‹©å“ªç§æ–¹å¼ä¼šæ ¹æ®åƒåœ¾æ”¶é›†å™¨çš„ç®—æ³•è€Œå®šã€‚æ­¤å¤–ï¼Œå†…å­˜åˆ†é…è¿˜è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ŒJVMé‡‡ç”¨<strong>CAS+å¤±è´¥é‡è¯•æˆ–TLAB</strong>çš„æ–¹å¼ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚<ol><li>CAS+å¤±è´¥é‡è¯•ï¼šä¹è§‚é”çš„ä¸€ç§å®ç°ï¼Œæ¯æ¬¡å ç”¨èµ„æºä¸åŠ é”ï¼Œè€Œæ˜¯ä¸æ–­å°è¯•å ç”¨ã€‚</li><li>TLABï¼šçº¿ç¨‹åˆ›å»ºæ—¶é¢„å…ˆåœ¨å †ä¸­ç»™çº¿ç¨‹åˆ†é…ä¸€å—å†…å­˜ï¼Œç§°ä¸ºTLABï¼Œä¸“é—¨ç”¨æ¥å­˜æ”¾è¯¥çº¿ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­åˆ›å»ºçš„å¯¹è±¡ï¼Œè€ŒTLABæ»¡äº†æ—¶ï¼Œé‡‡ç”¨ä¸Šè¿°CASåœ¨å †çš„å…¶å®ƒå†…å­˜ä¸­åˆ†é…</li></ol></li><li><strong>åˆå§‹åŒ–</strong>ï¼šåˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼Œé€šè¿‡è¿™ä¸ªæ“ä½œä¿è¯äº†å¯¹è±¡çš„å­—æ®µå¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚</li><li><strong>è®¾ç½®å¯¹è±¡å¤´</strong>ï¼šåœ¨å¯¹è±¡å¤´ä¸­è®¾ç½®è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ã€æ˜¯å¦å¯ç”¨åå‘é”ç­‰ä¿¡æ¯ã€‚</li><li><strong>æ‰§è¡Œinitæ–¹æ³•ï¼š</strong>åˆå§‹åŒ–å¯¹è±¡ï¼Œå³æŒ‰ç…§ç¨‹åºå‘˜å†™çš„æ„é€ æ–¹æ³•ç»™å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ã€‚</li></ol><h3 id="1-11-æ‰§è¡Œmainæ–¹æ³•çš„è¿‡ç¨‹-ä¾‹ğŸŒ°"><a href="#1-11-æ‰§è¡Œmainæ–¹æ³•çš„è¿‡ç¨‹-ä¾‹ğŸŒ°" class="headerlink" title="1.11.æ‰§è¡Œmainæ–¹æ³•çš„è¿‡ç¨‹(ä¾‹ğŸŒ°)"></a>1.11.æ‰§è¡Œmainæ–¹æ³•çš„è¿‡ç¨‹(ä¾‹ğŸŒ°)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;å¤§B&quot;</span>);</span><br><span class="line">        p.getName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ç¼–è¯‘<code>Application.java</code>åå¾—åˆ° <code>Application.class</code> åï¼Œæ‰§è¡Œè¿™ä¸ª<code>class</code>æ–‡ä»¶ï¼Œç³»ç»Ÿä¼šå¯åŠ¨ä¸€ä¸ª <code>JVM</code> è¿›ç¨‹ï¼Œä»ç±»è·¯å¾„ä¸­æ‰¾åˆ°ä¸€ä¸ªåä¸º <code>Application.class</code> çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°† <code>Application</code> ç±»ä¿¡æ¯åŠ è½½åˆ°è¿è¡Œæ—¶æ•°æ®åŒºçš„æ–¹æ³•åŒºå†…ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšç±»çš„åŠ è½½ã€‚</li><li>JVM æ‰¾åˆ° <code>Application</code> çš„ä¸»ç¨‹åºå…¥å£ï¼Œæ‰§è¡Œ<code>main</code>æ–¹æ³•ã€‚</li><li><code>main</code>æ–¹æ³•çš„ç¬¬ä¸€æ¡è¯­å¥ä¸º <code>Person p = new Person(&quot;å¤§B&quot;) </code>ï¼Œå°±æ˜¯è®© JVM <u>åˆ›å»ºä¸€ä¸ª<code>Person</code>å¯¹è±¡(è§1.10)</u>ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™æ–¹æ³•åŒºä¸­æ˜¯æ²¡æœ‰ <code>Person</code> ç±»çš„ä¿¡æ¯çš„ï¼Œæ‰€ä»¥ JVM é©¬ä¸ŠåŠ è½½ <code>Person</code> ç±»ï¼ŒæŠŠ <code>Person</code> ç±»çš„ä¿¡æ¯æ”¾åˆ°æ–¹æ³•åŒºä¸­ã€‚</li><li>åŠ è½½å®Œ <code>Person</code> ç±»åï¼ŒJVM åœ¨å †ä¸­åˆ†é…å†…å­˜ç»™ <code>Person</code> å¯¹è±¡ï¼Œç„¶åè°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ– <code>Person</code> å¯¹è±¡ï¼Œè¿™ä¸ª <code>Person</code> å¯¹è±¡æŒæœ‰æŒ‡å‘æ–¹æ³•åŒºä¸­çš„ Person ç±»çš„ç±»å‹ä¿¡æ¯çš„å¼•ç”¨ã€‚</li><li>æ‰§è¡Œ<code>p.getName()</code>æ—¶ï¼ŒJVM æ ¹æ® p çš„å¼•ç”¨æ‰¾åˆ° p æ‰€æŒ‡å‘çš„å¯¹è±¡ï¼Œç„¶åæ ¹æ®æ­¤å¯¹è±¡æŒæœ‰çš„å¼•ç”¨å®šä½åˆ°æ–¹æ³•åŒºä¸­ <code>Person</code> ç±»çš„ç±»å‹ä¿¡æ¯çš„æ–¹æ³•è¡¨ï¼Œè·å¾— <code>getName()</code> çš„å­—èŠ‚ç åœ°å€ã€‚</li><li>æ‰§è¡Œ<code>getName()</code>æ–¹æ³•ã€‚</li></ol><h3 id="ğŸŒŸç±»çš„å®ä¾‹åŒ–é¡ºåºï¼Ÿ"><a href="#ğŸŒŸç±»çš„å®ä¾‹åŒ–é¡ºåºï¼Ÿ" class="headerlink" title="ğŸŒŸç±»çš„å®ä¾‹åŒ–é¡ºåºï¼Ÿ"></a>ğŸŒŸç±»çš„å®ä¾‹åŒ–é¡ºåºï¼Ÿ</h3><ol><li>çˆ¶ç±»ä¸­çš„<code>static</code>ä»£ç å—ï¼Œå½“å‰ç±»çš„<code>static</code>ä»£ç å—</li><li>çˆ¶ç±»çš„æ™®é€šä»£ç å—</li><li>çˆ¶ç±»çš„æ„é€ å‡½æ•°</li><li>å½“å‰ç±»æ™®é€šä»£ç å—</li><li>å½“å‰ç±»çš„æ„é€ å‡½æ•°</li></ol><h3 id="ğŸŒŸå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Ÿ"><a href="#ğŸŒŸå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Ÿ" class="headerlink" title="ğŸŒŸå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Ÿ"></a>ğŸŒŸå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Ÿ</h3><ol><li><strong>å¼•ç”¨è®¡æ•°æ³•</strong></li></ol><p>â€‹è¿™ç§æ–¹æ³•ä¸èƒ½è§£å†³å¯¹è±¡çš„å¾ªç¯å¼•ç”¨é—®é¢˜</p><ol start="2"><li><strong>å¯è¾¾æ€§åˆ†æï¼š</strong></li></ol><p>â€‹é€šè¿‡<u>GC Rootå¯¹è±¡</u>ä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„å«å¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°<code>GC Root</code>æ²¡æœ‰ä»»ä½•çš„å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼Œè¯´æ˜è¿™ä¸ªå¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚</p><p>â€‹<u>ä»€ä¹ˆæ˜¯GC Rootsçš„å¯¹è±¡ï¼Ÿ</u></p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­Nativeæ–¹æ³•å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li></ul><h3 id="ğŸŒŸä»€ä¹ˆæƒ…å†µä¸‹ç±»ä¼šè¢«å¸è½½ï¼Ÿ"><a href="#ğŸŒŸä»€ä¹ˆæƒ…å†µä¸‹ç±»ä¼šè¢«å¸è½½ï¼Ÿ" class="headerlink" title="ğŸŒŸä»€ä¹ˆæƒ…å†µä¸‹ç±»ä¼šè¢«å¸è½½ï¼Ÿ"></a>ğŸŒŸä»€ä¹ˆæƒ…å†µä¸‹ç±»ä¼šè¢«å¸è½½ï¼Ÿ</h3><p>éœ€è¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ 3 ä¸ªæ¡ä»¶ç±»æ‰å¯èƒ½ä¼šè¢«å¸è½½ ï¼š</p><ul><li>è¯¥ç±»<u>æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶</u>ã€‚</li><li>åŠ è½½è¯¥ç±»çš„<u>ç±»åŠ è½½å™¨</u>å·²ç»è¢«å›æ”¶ã€‚</li><li>è¯¥ç±»å¯¹åº”çš„ <code>java.lang.Class</code> å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚</li></ul><p>è™šæ‹Ÿæœºå¯ä»¥å¯¹æ»¡è¶³ä¸Šè¿° 3 ä¸ªæ¡ä»¶çš„ç±»è¿›è¡Œå›æ”¶ï¼Œä½†ä¸ä¸€å®šä¼šè¿›è¡Œå›æ”¶ã€‚</p><h3 id="ğŸŒŸMinor-GC-å’Œ-Full-GCçš„åŒºåˆ«ï¼Ÿ"><a href="#ğŸŒŸMinor-GC-å’Œ-Full-GCçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="ğŸŒŸMinor GC å’Œ Full GCçš„åŒºåˆ«ï¼Ÿ"></a>ğŸŒŸMinor GC å’Œ Full GCçš„åŒºåˆ«ï¼Ÿ</h3><ul><li>Minor GCï¼šå›æ”¶æ–°ç”Ÿä»£ï¼Œå› ä¸ºæ–°ç”Ÿä»£å¯¹è±¡å­˜æ´»æ—¶é—´å¾ˆçŸ­ï¼Œå› æ­¤ <code>Minor GC</code>ä¼šé¢‘ç¹æ‰§è¡Œï¼Œæ‰§è¡Œçš„é€Ÿåº¦ä¸€èˆ¬ä¹Ÿä¼šæ¯”è¾ƒå¿«ã€‚</li><li>Full GCï¼šå›æ”¶è€å¹´ä»£å’Œæ–°ç”Ÿä»£ï¼Œè€å¹´ä»£çš„å¯¹è±¡å­˜æ´»æ—¶é—´é•¿ï¼Œå› æ­¤ <code>Full GC</code> å¾ˆå°‘æ‰§è¡Œï¼Œæ‰§è¡Œé€Ÿåº¦ä¼šæ¯” <code>Minor GC</code> æ…¢å¾ˆå¤šã€‚</li></ul><h3 id="ğŸŒŸå†…å­˜çš„åˆ†é…ç­–ç•¥ï¼Ÿ"><a href="#ğŸŒŸå†…å­˜çš„åˆ†é…ç­–ç•¥ï¼Ÿ" class="headerlink" title="ğŸŒŸå†…å­˜çš„åˆ†é…ç­–ç•¥ï¼Ÿ"></a>ğŸŒŸå†…å­˜çš„åˆ†é…ç­–ç•¥ï¼Ÿ</h3><p><strong>å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åˆ†é…</strong></p><ul><li>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ <code>Eden</code> ä¸Šåˆ†é…ï¼Œ<u>å½“ <code>Eden</code> ç©ºé—´ä¸å¤Ÿæ—¶ï¼Œè§¦å‘ <code>Minor GC</code>ã€‚</u></li></ul><p><strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</strong></p><ul><li>å¤§å¯¹è±¡æ˜¯æŒ‡éœ€è¦è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼Œæœ€å…¸å‹çš„å¤§å¯¹è±¡æœ‰é•¿å­—ç¬¦ä¸²å’Œå¤§æ•°ç»„ã€‚å¯ä»¥è®¾ç½®JVMå‚æ•° <code>-XX:PretenureSizeThreshold</code>ï¼Œå¤§äºæ­¤å€¼çš„å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ã€‚</li></ul><p><strong>é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£</strong></p><ul><li>é€šè¿‡å‚æ•° <code>-XX:MaxTenuringThreshold</code> å¯ä»¥è®¾ç½®å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ã€‚å¯¹è±¡åœ¨<code>Survivor</code>åŒºæ¯ç»è¿‡ä¸€æ¬¡ <code>Minor GC</code>ï¼Œå¹´é¾„å°±å¢åŠ  1 å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚</li></ul><p><strong>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š</strong></p><ul><li>å¹¶éå¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ° <code>MaxTenuringThreshold</code> æ‰èƒ½æ™‹å‡è€å¹´ä»£ï¼Œ<u>å¦‚æœåœ¨ <code>Survivor</code> ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº <code>Survivor</code> ç©ºé—´çš„ä¸€åŠï¼Œåˆ™å¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— éœ€è¾¾åˆ° <code>MaxTenuringThreshold</code> å¹´é¾„é˜ˆå€¼ã€‚</u></li></ul><p><strong>ç©ºé—´åˆ†é…æ‹…ä¿</strong></p><ul><li>åœ¨å‘ç”Ÿ <code>Minor GC</code> ä¹‹å‰ï¼Œè™šæ‹Ÿæœºå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œå¦‚æœæ¡ä»¶æˆç«‹çš„è¯ï¼Œé‚£ä¹ˆ <code>Minor GC</code> æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä¸æˆç«‹çš„è¯è™šæ‹Ÿæœºä¼šæŸ¥çœ‹ <code>HandlePromotionFailure</code> çš„å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ã€‚å¦‚æœå…è®¸ï¼Œé‚£ä¹ˆå°±ä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•ç€è¿›è¡Œä¸€æ¬¡ <code>Minor GC</code>ï¼›å¦‚æœå°äºï¼Œæˆ–è€… <code>HandlePromotionFailure</code> çš„å€¼ä¸ºä¸å…è®¸æ‹…ä¿å¤±è´¥ï¼Œé‚£ä¹ˆå°±è¦è¿›è¡Œä¸€æ¬¡ <code>Full GC</code>ã€‚</li></ul><h3 id="ğŸŒŸå¯¹è±¡å¤´äº†è§£å—ï¼Ÿ"><a href="#ğŸŒŸå¯¹è±¡å¤´äº†è§£å—ï¼Ÿ" class="headerlink" title="ğŸŒŸå¯¹è±¡å¤´äº†è§£å—ï¼Ÿ"></a>ğŸŒŸå¯¹è±¡å¤´äº†è§£å—ï¼Ÿ</h3><p>Java å†…å­˜ä¸­çš„å¯¹è±¡ç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼šå¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å……å­—èŠ‚ã€‚</p><p>è€Œå¯¹è±¡å¤´ç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼š<strong>mark wordã€æŒ‡å‘ç±»ä¿¡æ¯çš„æŒ‡é’ˆå’Œæ•°ç»„é•¿åº¦ï¼ˆæ•°ç»„æ‰æœ‰ï¼‰ã€‚</strong></p><p><code>mark word</code>åŒ…å«ï¼š<u>å¯¹è±¡çš„å“ˆå¸Œç ã€åˆ†ä»£å¹´é¾„å’Œé”æ ‡å¿—ä½</u>ã€‚</p><p>å¯¹è±¡çš„å®ä¾‹æ•°æ®å°±æ˜¯ Java å¯¹è±¡çš„å±æ€§å’Œå€¼ã€‚</p><p>å¯¹é½å¡«å……å­—èŠ‚ï¼šå› ä¸ºJVMè¦æ±‚å¯¹è±¡å çš„å†…å­˜å¤§å°æ˜¯ 8bit çš„å€æ•°ï¼Œå› æ­¤åé¢æœ‰å‡ ä¸ªå­—èŠ‚ç”¨äºæŠŠå¯¹è±¡çš„å¤§å°è¡¥é½è‡³ 8bit çš„å€æ•°ã€‚</p><p>å†…å­˜å¯¹é½çš„ä¸»è¦ä½œç”¨æ˜¯ï¼š</p><ol><li>å¹³å°åŸå› ï¼šä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶å¹³å°éƒ½èƒ½è®¿é—®ä»»æ„åœ°å€ä¸Šçš„ä»»æ„æ•°æ®çš„ï¼›æŸäº›ç¡¬ä»¶å¹³å°åªèƒ½åœ¨æŸäº›åœ°å€å¤„å–æŸäº›ç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œå¦åˆ™æŠ›å‡ºç¡¬ä»¶å¼‚å¸¸ã€‚</li><li>æ€§èƒ½åŸå› ï¼šç»è¿‡å†…å­˜å¯¹é½åï¼ŒCPUçš„å†…å­˜è®¿é—®é€Ÿåº¦å¤§å¤§æå‡ã€‚</li></ol><p>æœ¬åšå®¢å¯¹ä»¥ä¸‹æ–‡ç« æœ‰å‚è€ƒå€Ÿé‰´ï¼Œååˆ†æ„Ÿè°¢è¿™äº›ä½œè€…çš„æ–‡ç« ğŸ™ï¼š</p><ul><li><a href="https://juejin.cn/post/7255137260881477688">javaç±»åŠ è½½æœºåˆ¶è¯¦è§£</a></li><li><a href="https://juejin.cn/post/6844903729435508750?searchId=20230914153350006A2B436CFFA81FD42F">è€å¤§éš¾çš„ Java ClassLoader å†ä¸ç†è§£å°±è€äº†</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> javaåŸç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> åŸç†å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•å°ç»“</title>
      <link href="/2023/05/26/%E7%AE%97%E6%B3%95%E5%B0%8F%E7%BB%93/"/>
      <url>/2023/05/26/%E7%AE%97%E6%B3%95%E5%B0%8F%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.cyc2018.xyz/">ä¼˜ç§€ç¬”è®°</a></p><h1 id="ç®—æ³•æ€æƒ³ï¼š"><a href="#ç®—æ³•æ€æƒ³ï¼š" class="headerlink" title="ç®—æ³•æ€æƒ³ï¼š"></a>ç®—æ³•æ€æƒ³ï¼š</h1><h2 id="åŒæŒ‡é’ˆï¼š"><a href="#åŒæŒ‡é’ˆï¼š" class="headerlink" title="åŒæŒ‡é’ˆï¼š"></a>åŒæŒ‡é’ˆï¼š</h2><p>åŒæŒ‡é’ˆä¸»è¦ç”¨äºéå†æ•°ç»„ï¼Œä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸åŒçš„å…ƒç´ ï¼Œä»è€ŒååŒå®Œæˆä»»åŠ¡ã€‚</p><h3 id="åº”ç”¨åœºæ™¯ï¼š"><a href="#åº”ç”¨åœºæ™¯ï¼š" class="headerlink" title="åº”ç”¨åœºæ™¯ï¼š"></a>åº”ç”¨åœºæ™¯ï¼š</h3><p>æ»¡è¶³å•è°ƒæ€§(æŒ‡é’ˆåœ¨ç§»åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œå¾…è¡¡é‡çš„é‡æ€»æ˜¯æœä¸€ä¸ªæ–¹å‘å˜åŒ–)</p><h4 id="åŒå‘åŒæŒ‡é’ˆï¼š"><a href="#åŒå‘åŒæŒ‡é’ˆï¼š" class="headerlink" title="åŒå‘åŒæŒ‡é’ˆï¼š"></a>åŒå‘åŒæŒ‡é’ˆï¼š</h4><p><a href="https://leetcode.cn/problems/longest-substring-without-repeating-characters/">3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a></p><p><a href="https://leetcode.cn/problems/minimum-size-subarray-sum/">209. é•¿åº¦æœ€å°çš„å­æ•°ç»„</a></p><p><a href="https://leetcode.cn/problems/subarray-product-less-than-k/">713. ä¹˜ç§¯å°äº K çš„å­æ•°ç»„</a></p><h4 id="ç›¸å‘åŒæŒ‡é’ˆï¼š"><a href="#ç›¸å‘åŒæŒ‡é’ˆï¼š" class="headerlink" title="ç›¸å‘åŒæŒ‡é’ˆï¼š"></a>ç›¸å‘åŒæŒ‡é’ˆï¼š</h4><p><a href="https://leetcode.cn/problems/two-sum-ii-input-array-is-sorted/">167. ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„</a></p><p><a href="https://leetcode.cn/problems/3sum/">15. ä¸‰æ•°ä¹‹å’Œ</a></p><p><a href="https://leetcode.cn/problems/container-with-most-water/">11. ç››æœ€å¤šæ°´çš„å®¹å™¨</a></p><p><a href="https://leetcode.cn/problems/trapping-rain-water/">42. æ¥é›¨æ°´</a></p><h1 id="å‰ç¼€å’ŒæŠ€å·§"><a href="#å‰ç¼€å’ŒæŠ€å·§" class="headerlink" title="å‰ç¼€å’ŒæŠ€å·§"></a>å‰ç¼€å’ŒæŠ€å·§</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äºŒç»´å‰ç¼€å’Œæ¨¡æ¿ï¼ˆ&#x27;A&#x27; çš„ ASCII ç æœ€ä½ä½ä¸º 1ï¼Œ&#x27;.&#x27; çš„ ASCII ç æœ€ä½ä½ä¸º 0ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MatrixSum</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span>[][] sum;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">MatrixSum</span><span class="params">(String[] matrix)</span> &#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> matrix.length, n = matrix[<span class="number">0</span>].length();</span><br><span class="line">      sum = <span class="keyword">new</span> <span class="title class_">int</span>[m + <span class="number">1</span>][n + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">              sum[i + <span class="number">1</span>][j + <span class="number">1</span>] = sum[i + <span class="number">1</span>][j] + sum[i][j + <span class="number">1</span>] - sum[i][j] + (matrix[i].charAt(j) &amp; <span class="number">1</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›å·¦ä¸Šè§’åœ¨ (r1,c1) å³ä¸‹è§’åœ¨ (r2-1,c2-1) çš„å­çŸ©é˜µå…ƒç´ å’Œï¼ˆç±»ä¼¼å‰ç¼€å’Œçš„å·¦é—­å³å¼€ï¼‰</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">query</span><span class="params">(<span class="type">int</span> r1, <span class="type">int</span> c1, <span class="type">int</span> r2, <span class="type">int</span> c2)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> sum[r2][c2] - sum[r2][c1] - sum[r1][c2] + sum[r1][c1];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><h1 id="äºŒåˆ†æŸ¥æ‰¾"><a href="#äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾"></a>äºŒåˆ†æŸ¥æ‰¾</h1><p>æœ‰ä¸¤ç§è®¡ç®—ä¸­å€¼ m çš„æ–¹å¼ï¼š</p><ul><li><p>m &#x3D; (l + h) &#x2F; 2</p></li><li><p>m &#x3D; l + (h - l) &#x2F; 2</p><p><strong>l + h å¯èƒ½å‡ºç°åŠ æ³•æº¢å‡º</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´åŠ æ³•çš„ç»“æœå¤§äºæ•´å‹èƒ½å¤Ÿè¡¨ç¤ºçš„èŒƒå›´ã€‚ä½†æ˜¯ l å’Œ h éƒ½ä¸ºæ­£æ•°ï¼Œå› æ­¤ h - l ä¸ä¼šå‡ºç°åŠ æ³•æº¢å‡ºé—®é¢˜ã€‚æ‰€ä»¥ï¼Œæœ€å¥½ä½¿ç”¨ç¬¬äºŒç§è®¡ç®—æ³•æ–¹æ³•ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœwhileä¸­æ˜¯ l &lt;= h çš„è¯ï¼Œé‚£ä¹ˆä¸‹é¢ä¹Ÿè¦å¯¹åº”çš„ l = m + 1; r = m - 1</span></span><br><span class="line"><span class="comment">//å¦‚ï¼š</span></span><br><span class="line"><span class="keyword">while</span>(l &lt;= h)&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l + (h - l)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(nums[mid] &lt; target)&#123;</span><br><span class="line">        l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(nums[mid] &gt;= target)&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums[mid] == target)&#123;tag = <span class="literal">true</span>;&#125;</span><br><span class="line">        h = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯  l &lt; h çš„è¯ï¼Œé‚£ä¹ˆä¸‹é¢åªéœ€è¦å‡ºç°ä¸€ä¸ª &#123;l = m + 1  and  r = m&#125;  æˆ–è€…  &#123;l = m  and  r = m - 1&#125;!</span></span><br></pre></td></tr></table></figure><p><a href="https://leetcode.cn/problems/capacity-to-ship-packages-within-d-days/">1011. åœ¨ D å¤©å†…é€è¾¾åŒ…è£¹çš„èƒ½åŠ›</a></p><p>&#x2F;&#x2F;è¿™é¢˜å¥½å¦™ï¼Œæœ¬èœé¸Ÿæ ¹æœ¬æƒ³ä¸åˆ°è¿™é¢˜è¿˜èƒ½äºŒåˆ†ï¼Œé•¿è§è¯†äº†ï¼</p><p>æˆ‘ä»¬å¯¹è¿è½½èƒ½åŠ›è¿›è¡Œè®¨è®ºï¼šå¯¹äºæŸè¿è½½èƒ½åŠ›ï¼Œ</p><ul><li><p>å¦‚æœæ­¤è¿è½½èƒ½åŠ›ä¸‹éœ€è¦çš„å¤©æ•°å¤§äºç³»ç»Ÿæ‰€è¿°çš„å¤©æ•°ï¼Œé‚£ä¹ˆéœ€è¦æé«˜è¿è½½èƒ½åŠ›ï¼›</p></li><li><p>å¦‚æœ    è¿è½½èƒ½åŠ›ä¸‹éœ€è¦çš„å¤©æ•°å°äºç³»ç»Ÿæ‰€è¿°çš„å¤©æ•°ï¼Œé‚£ä¹ˆéœ€è¦é™ä½è¿è½½èƒ½åŠ›ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">shipWithinDays</span><span class="params">(<span class="type">int</span>[] weights, <span class="type">int</span> days)</span> &#123;</span><br><span class="line">        <span class="comment">// ç¡®å®šäºŒåˆ†æŸ¥æ‰¾å·¦å³è¾¹ç•Œ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> Arrays.stream(weights).max().getAsInt(), right = Arrays.stream(weights).sum();</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left + right) / <span class="number">2</span>;</span><br><span class="line">            <span class="comment">// need ä¸ºéœ€è¦è¿é€çš„å¤©æ•°</span></span><br><span class="line">            <span class="comment">// cur ä¸ºå½“å‰è¿™ä¸€å¤©å·²ç»è¿é€çš„åŒ…è£¹é‡é‡ä¹‹å’Œ</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">need</span> <span class="operator">=</span> <span class="number">1</span>, cur = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> weight : weights) &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur + weight &gt; mid) &#123;</span><br><span class="line">                    ++need;</span><br><span class="line">                    cur = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                cur += weight;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//å› ä¸ºè¦æ±‚æœ€å°çš„è¿è½½èƒ½åŠ›ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¾—åˆ°ç¬¦åˆæ¡ä»¶æ‰€è¿°å¤©æ•°çš„è¿è½½èƒ½åŠ›æ—¶ï¼Œè¦å†å¾€å°çš„è¿è½½èƒ½åŠ›é‚£è¾¹è¯•è¯•</span></span><br><span class="line">            <span class="keyword">if</span> (need &lt;= days) &#123;</span><br><span class="line">                right = mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                left = mid + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><p><a href="https://leetcode.cn/problems/minimize-the-maximum-difference-of-pairs/">2616. æœ€å°åŒ–æ•°å¯¹çš„æœ€å¤§å·®å€¼</a></p><p>ä¸ä¸Šä¸€é¢˜æ€è·¯ç›¸åŒï¼š</p><p>â€‹ğŸŒŸçœ‹åˆ°ã€Œ<strong>æœ€å¤§åŒ–æœ€å°å€¼</strong>ã€æˆ–è€…ã€Œ<strong>æœ€å°åŒ–æœ€å¤§å€¼</strong>ã€å°±è¦æƒ³åˆ°<u>äºŒåˆ†ç­”æ¡ˆ</u>ï¼Œè¿™æ˜¯ä¸€ä¸ªå›ºå®šçš„å¥—è·¯ã€‚</p><p>ä¸ºä»€ä¹ˆï¼Ÿä¸€èˆ¬æ¥è¯´ï¼ŒäºŒåˆ†çš„å€¼è¶Šå¤§ï¼Œè¶Šèƒ½&#x2F;ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼›äºŒåˆ†çš„å€¼è¶Šå°ï¼Œè¶Šä¸èƒ½&#x2F;èƒ½æ»¡è¶³è¦æ±‚ï¼Œæœ‰å•è°ƒæ€§ï¼Œå¯ä»¥äºŒåˆ†ã€‚</p><p>åœ¨è¿™ä¸€é¢˜ä¸­ï¼Œæˆ‘ä»¬å¯¹ <strong>æœ€å¤§å·®å€¼çš„æœ€å°å€¼</strong> è¿›è¡ŒäºŒåˆ†(å·¦è¾¹ç•Œä¸º ä¸¤æ•°ç›¸ç­‰çš„å·®å€¼ï¼š0ï¼›å³è¾¹ç•Œä¸ºæœ€å¤§å€¼ä¸æœ€å°å€¼çš„å·®å€¼)å¯¹äºæŸä¸€ æœ€å¤§å·®å€¼çš„æœ€å°å€¼ midï¼šå¦‚æœæ»¡è¶³<u>å·®å€¼å°äºmid çš„æ•°å¯¹æ•°é‡</u>å¤§äºpï¼Œåˆ™åº”å½“å‡å°mid(æ»¡è¶³çš„å¤ªå¤šäº†ï¼Œè¦è®©æ¡ä»¶ä¸¥æ ¼ä¸€äº›)ï¼Œå¦åˆ™åä¹‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minimizeMax</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> p)</span> &#123;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length, left = -<span class="number">1</span>, right = nums[n - <span class="number">1</span>] - nums[<span class="number">0</span>]; <span class="comment">// å¼€åŒºé—´</span></span><br><span class="line">        <span class="keyword">while</span> (left + <span class="number">1</span> &lt; right) &#123; <span class="comment">// å¼€åŒºé—´</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left + right) &gt;&gt;&gt; <span class="number">1</span>, cnt = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n - <span class="number">1</span>; ++i)</span><br><span class="line">                <span class="keyword">if</span> (nums[i + <span class="number">1</span>] - nums[i] &lt;= mid) &#123; <span class="comment">// éƒ½é€‰</span></span><br><span class="line">                    ++cnt;</span><br><span class="line">                    ++i;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">if</span> (cnt &gt;= p) right = mid;</span><br><span class="line">            <span class="keyword">else</span> left = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ä½œè€…ï¼šendlesscheng</span><br><span class="line">é“¾æ¥ï¼šhttps:<span class="comment">//leetcode.cn/problems/minimize-the-maximum-difference-of-pairs/solution/er-fen-da-an-tan-xin-by-endlesscheng-dlxv/</span></span><br><span class="line">æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰</span><br><span class="line">è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</span><br></pre></td></tr></table></figure><h1 id="åˆ†æ²»ï¼š"><a href="#åˆ†æ²»ï¼š" class="headerlink" title="åˆ†æ²»ï¼š"></a>åˆ†æ²»ï¼š</h1><p><a href="https://leetcode.cn/problems/different-ways-to-add-parentheses/">241. ä¸ºè¿ç®—è¡¨è¾¾å¼è®¾è®¡ä¼˜å…ˆçº§</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">diffWaysToCompute</span><span class="params">(String input)</span> &#123;</span><br><span class="line">    List&lt;Integer&gt; ways = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; input.length(); i++) &#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> input.charAt(i);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="string">&#x27;+&#x27;</span> || c == <span class="string">&#x27;-&#x27;</span> || c == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">            List&lt;Integer&gt; left = diffWaysToCompute(input.substring(<span class="number">0</span>, i));</span><br><span class="line">            List&lt;Integer&gt; right = diffWaysToCompute(input.substring(i + <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> l : left) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> r : right) &#123;</span><br><span class="line">                    <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                            ways.add(l + r);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">                            ways.add(l - r);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">                            ways.add(l * r);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ways.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        ways.add(Integer.valueOf(input));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ways;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//çœŸçš„å¤ªä¼˜ç¾äº†ï¼</span></span><br></pre></td></tr></table></figure><p><a href="https://leetcode.cn/problems/unique-binary-search-trees-ii/">95. ä¸åŒçš„äºŒå‰æœç´¢æ ‘ II</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;TreeNode&gt; <span class="title function_">generateTrees</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;TreeNode&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> generate(<span class="number">1</span>,n);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;TreeNode&gt; <span class="title function_">generate</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span>&#123;</span><br><span class="line">        List&lt;TreeNode&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;TreeNode&gt;();</span><br><span class="line">        <span class="keyword">if</span>(start &gt; end)&#123;</span><br><span class="line">            res.add(<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i&lt;=end; i++)&#123;</span><br><span class="line">            List&lt;TreeNode&gt; left = generate(start, i - <span class="number">1</span>);</span><br><span class="line">            List&lt;TreeNode&gt; right = generate(i + <span class="number">1</span>, end);</span><br><span class="line">            <span class="keyword">for</span>(TreeNode l: left)&#123;</span><br><span class="line">                <span class="keyword">for</span>(TreeNode r: right)&#123;</span><br><span class="line">                    <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(i);</span><br><span class="line">                    root.left = l;</span><br><span class="line">                    root.right = r;</span><br><span class="line">                    res.add(root);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åšå®Œè¿™ä¸¤é“ï¼Œæ„Ÿè§‰å·²ç»æ‘¸æ¸…äº†åˆ†æ²»çš„åº•ç»†ï¼ éå†ç‰¹å¾ç‚¹ï¼Œå·¦è¾¹å’Œå³è¾¹çš„ä¸åŒæƒ…å†µæ’åˆ—ç»„åˆå¾—åˆ°å¤šç§ç»“æœ</p><h1 id="æœç´¢ï¼š"><a href="#æœç´¢ï¼š" class="headerlink" title="æœç´¢ï¼š"></a>æœç´¢ï¼š</h1><h2 id="BFSï¼š"><a href="#BFSï¼š" class="headerlink" title="BFSï¼š"></a>BFSï¼š</h2><p>â€‹åœ¨ç¨‹åºå®ç° BFS æ—¶éœ€è¦è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li><strong>é˜Ÿåˆ—</strong>ï¼šç”¨æ¥å­˜å‚¨æ¯ä¸€è½®éå†å¾—åˆ°çš„èŠ‚ç‚¹ï¼›</li><li><strong>æ ‡è®°</strong>ï¼šå¯¹äºéå†è¿‡çš„èŠ‚ç‚¹ï¼Œåº”è¯¥å°†å®ƒæ ‡è®°ï¼Œé˜²æ­¢é‡å¤éå†ã€‚</li></ul><p>LinkedList&lt;&gt;() çš„APIï¼š<strong>poll</strong>è·å–å¹¶åˆ é™¤é˜Ÿå¤´å…ƒç´ ï¼›<strong>offer</strong>å‘é˜Ÿå°¾æ·»åŠ å…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">ladderLength</span><span class="params">(String beginWord, String endWord, List&lt;String&gt; wordList)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!wordList.contains(endWord))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (beginWord.equals(endWord))<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//æ ‡è®°</span></span><br><span class="line">        HashSet&lt;String&gt; hashset = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//bfs</span></span><br><span class="line">        LinkedList&lt;String&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">        queue.offer(beginWord);</span><br><span class="line">        hashset.add(beginWord);</span><br><span class="line">        <span class="keyword">while</span>(queue.size() != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">sz</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            res++;</span><br><span class="line">            <span class="keyword">while</span>(sz-- != <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">word</span> <span class="operator">=</span> queue.poll();</span><br><span class="line"><span class="comment">//                if(word.equals(endWord))return res;</span></span><br><span class="line"><span class="comment">//                res++;</span></span><br><span class="line"><span class="comment">//                if(hashset.contains(word))continue;</span></span><br><span class="line">                <span class="keyword">for</span>(String s:wordList)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(judge(word,s) &amp;&amp; !hashset.contains(s))&#123;</span><br><span class="line">                        queue.offer(s);</span><br><span class="line">                        <span class="keyword">if</span>(s.equals(endWord))<span class="keyword">return</span> res;</span><br><span class="line">                        <span class="comment">// System.out.println(word + &quot;-&gt;&quot; +s);</span></span><br><span class="line">                        hashset.add(s);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//éœ€è¦å†™ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å·®å¼‚æ˜¯å¦ä¸ºä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">judge</span> <span class="params">(String s1, String s2)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s1.length() != s2.length())<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s1.length(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s1.charAt(i) != s2.charAt(i))count++;</span><br><span class="line">            <span class="keyword">if</span>(count &gt; <span class="number">1</span>)<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="DFS"><a href="#DFS" class="headerlink" title="DFS:"></a>DFS:</h2><p>â€‹ä»ä¸€ä¸ªèŠ‚ç‚¹å‡ºå‘ï¼Œä½¿ç”¨ DFS å¯¹ä¸€ä¸ªå›¾è¿›è¡Œéå†æ—¶ï¼Œèƒ½å¤Ÿéå†åˆ°çš„èŠ‚ç‚¹éƒ½æ˜¯ä»åˆå§‹èŠ‚ç‚¹å¯è¾¾çš„ï¼ŒDFS å¸¸ç”¨æ¥æ±‚è§£è¿™ç§ <strong>å¯è¾¾æ€§</strong> é—®é¢˜ã€‚</p><p>åœ¨ç¨‹åºå®ç° DFS æ—¶éœ€è¦è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li><strong>æ ˆ</strong>ï¼šç”¨æ ˆæ¥ä¿å­˜å½“å‰èŠ‚ç‚¹ä¿¡æ¯ï¼Œå½“éå†æ–°èŠ‚ç‚¹è¿”å›æ—¶èƒ½å¤Ÿç»§ç»­éå†å½“å‰èŠ‚ç‚¹ã€‚å¯ä»¥ä½¿ç”¨é€’å½’æ ˆã€‚</li><li><strong>æ ‡è®°</strong>ï¼šå’Œ BFS ä¸€æ ·åŒæ ·éœ€è¦å¯¹å·²ç»éå†è¿‡çš„èŠ‚ç‚¹è¿›è¡Œæ ‡è®°ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¥—è·¯æ ¼å¼</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> [][] direction =  <span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,-<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;-<span class="number">1</span>,<span class="number">0</span>&#125;&#125;;<span class="comment">//æ–¹å‘ï¼Œè§†é¢˜ç›®è€Œå®š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxAreaOfIsland</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; grid.length; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; grid[<span class="number">0</span>].length; j++)&#123;</span><br><span class="line">                res = Math.max(res, dfs(grid, i, j));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> [][] grid, <span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">      <span class="comment">//å‡ºç•Œæˆ–è€…å·²ç»åˆ°è¾¾è¿‡</span></span><br><span class="line">        <span class="keyword">if</span>(i &lt; <span class="number">0</span> || j &lt; <span class="number">0</span> || i &gt;= grid.length || j &gt;= grid[<span class="number">0</span>].length || grid[i][j] == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">addition</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        grid[i][j] = <span class="number">0</span>;<span class="comment">//åˆ°è¾¾è¿‡çš„åœ°ç‚¹å…¨éƒ¨è¿›è¡Œæ ‡è®°(ä¸èƒ½å†æ¬¡åˆ°è¾¾)</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; direction.length; k++)&#123;</span><br><span class="line">            addition += dfs(grid, i + direction[k][<span class="number">0</span>], j + direction[k][<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> addition;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å›æº¯ï¼š"><a href="#å›æº¯ï¼š" class="headerlink" title="å›æº¯ï¼š"></a>å›æº¯ï¼š</h2><p>å›æº¯åšé¢˜ä¸‰é—®ï¼š</p><ol><li>å½“å‰çš„æ“ä½œæ˜¯ä»€ä¹ˆ</li><li>å½“å‰æ“ä½œå¯¹åº”çš„å­é—®é¢˜æ˜¯ä»€ä¹ˆ</li><li>ä¸‹ä¸€ä¸ªå­é—®é¢˜æ˜¯ä»€ä¹ˆ</li></ol><h3 id="å­é›†å½¢å›æº¯ï¼š"><a href="#å­é›†å½¢å›æº¯ï¼š" class="headerlink" title="å­é›†å½¢å›æº¯ï¼š"></a>å­é›†å½¢å›æº¯ï¼š</h3><p>â€‹å¯¹æ¯ä¸ªç‚¹è¿›è¡Œé€‰æ‹©ï¼šé€‰ or ä¸é€‰</p><p>â€‹æˆ–è€…ä»ç­”æ¡ˆçš„è§’åº¦ï¼šå¦‚æœé€‰è¿™ä¸ªä¼šæ»¡è¶³æ¡ä»¶å†ä¾æ­¤ç»§ç»­</p><h3 id="ç»„åˆå‹å›æº¯ï¼š"><a href="#ç»„åˆå‹å›æº¯ï¼š" class="headerlink" title="ç»„åˆå‹å›æº¯ï¼š"></a>ç»„åˆå‹å›æº¯ï¼š</h3><p>â€‹æœ‰é¡ºåºè¦æ±‚å¯ä»¥è¿›è¡Œå‰ªæ</p><h3 id="æ’åˆ—å‹å›æº¯ï¼š"><a href="#æ’åˆ—å‹å›æº¯ï¼š" class="headerlink" title="æ’åˆ—å‹å›æº¯ï¼š"></a>æ’åˆ—å‹å›æº¯ï¼š</h3><p>â€‹</p><p>â€‹Backtrackingï¼ˆå›æº¯ï¼‰å±äº DFSã€‚</p><ul><li>æ™®é€š DFS ä¸»è¦ç”¨åœ¨ <strong>å¯è¾¾æ€§é—®é¢˜</strong> ï¼Œè¿™ç§é—®é¢˜åªéœ€è¦æ‰§è¡Œåˆ°ç‰¹ç‚¹çš„ä½ç½®ç„¶åè¿”å›å³å¯ã€‚</li><li>è€Œ Backtracking ä¸»è¦ç”¨äºæ±‚è§£ <strong>æ’åˆ—ç»„åˆ</strong> é—®é¢˜ï¼Œä¾‹å¦‚æœ‰ { â€˜aâ€™,â€™bâ€™,â€™câ€™ } ä¸‰ä¸ªå­—ç¬¦ï¼Œæ±‚è§£æ‰€æœ‰ç”±è¿™ä¸‰ä¸ªå­—ç¬¦æ’åˆ—å¾—åˆ°çš„å­—ç¬¦ä¸²ï¼Œè¿™ç§é—®é¢˜åœ¨æ‰§è¡Œåˆ°ç‰¹å®šçš„ä½ç½®è¿”å›ä¹‹åè¿˜ä¼šç»§ç»­æ‰§è¡Œæ±‚è§£è¿‡ç¨‹ã€‚</li></ul><p>å› ä¸º Backtracking ä¸æ˜¯ç«‹å³è¿”å›ï¼Œè€Œè¦ç»§ç»­æ±‚è§£ï¼Œå› æ­¤åœ¨ç¨‹åºå®ç°æ—¶ï¼Œéœ€è¦æ³¨æ„å¯¹å…ƒç´ çš„æ ‡è®°é—®é¢˜ï¼š</p><ul><li>åœ¨è®¿é—®ä¸€ä¸ªæ–°å…ƒç´ è¿›å…¥æ–°çš„é€’å½’è°ƒç”¨æ—¶ï¼Œéœ€è¦å°†æ–°å…ƒç´ æ ‡è®°ä¸ºå·²ç»è®¿é—®ï¼Œè¿™æ ·æ‰èƒ½åœ¨ç»§ç»­é€’å½’è°ƒç”¨æ—¶ä¸ç”¨é‡å¤è®¿é—®è¯¥å…ƒç´ ï¼›</li><li>ä½†æ˜¯åœ¨é€’å½’è¿”å›æ—¶ï¼Œéœ€è¦å°†å…ƒç´ æ ‡è®°ä¸ºæœªè®¿é—®ï¼Œå› ä¸ºåªéœ€è¦ä¿è¯åœ¨ä¸€ä¸ªé€’å½’é“¾ä¸­ä¸åŒæ—¶è®¿é—®ä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥è®¿é—®å·²ç»è®¿é—®è¿‡ä½†æ˜¯ä¸åœ¨å½“å‰é€’å½’é“¾ä¸­çš„å…ƒç´ ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å¯¹äºä¸€å®šè§„åˆ™ä¸‹çš„æ’åˆ—ç»„åˆé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨å›æº¯æ³•è¿›è¡Œæ±‚è§£</span><br><span class="line">å›æº¯æ³• = dfs+å›æº¯æ“ä½œ</span><br><span class="line">ä¸€èˆ¬è€Œè¨€void dfsçš„å‚æ•°å¦‚ä¸‹(int n, &lt;T&gt;å­˜å‚¨å½“å‰æ­¥éª¤ç”Ÿæˆçš„ä¸­é—´ç»“æœçš„å˜é‡,ç”¨äºå­˜å‚¨æœ€ç»ˆå„ç§æƒ…å†µçš„å˜é‡[ä¸€èˆ¬ä¸ºä¸€ä¸ªArrayList], å¾…è¿›è¡Œæ“ä½œçš„å…ƒç´ )ï¼›</span><br><span class="line">å¦‚ï¼šdfs(0,new StringBuilder(),res,s);</span><br><span class="line">dfsä¸­åˆšå¼€å§‹å†™ä¸Šç»ˆæ­¢æ¡ä»¶ï¼šnåˆ°è¾¾æŒ‡å®šè½®æ•°æˆ–ä¸æ»¡è¶³å…¶ä»–é™åˆ¶æ¡ä»¶ï¼Œç›´æ¥return</span><br><span class="line">æ¥ä¸‹æ¥æ ¹æ®å½“å‰å­˜å‚¨çš„ä¸­é—´ç»“æœï¼Œå†Â·ç»™ä¸­é—´ç»“æœæ·»åŠ è¿™è½®å¾—åˆ°çš„äº§ç‰© Â·Â·å¯¹å…¶è¿›è¡Œä¸‹ä¸€è½®dfs Â·Â·Â·å°†è¿™è½®çš„äº§ç‰©åˆ å»ï¼Œå¹¶æ¢æˆè¿™ä¸€è½®äº§ç‰©çš„ä¸‹ä¸€ç§æƒ…å†µï¼</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å›æº¯æ¨¡ç‰ˆï¼š</span></span><br><span class="line"><span class="comment">//åœ¨å›æº¯æ—¶ï¼Œå¦‚æœä½¿ç”¨ArrayListç­‰å¼•ç”¨å¯¹è±¡å­˜æ”¾ä½ äº§ç”Ÿçš„ç»“æœï¼Œåœ¨å°†å…¶æ·»åŠ è‡³ç»“æœé›†ä¸­æ—¶éœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªä¸å…¶ç›¸åŒçš„å‰¯æœ¬ï¼Œå°†å‰¯æœ¬åŠ å…¥ç»“æœé›†ï¼Œå¦‚æœä¸è¿™æ ·åšï¼Œå›æº¯ååˆ é™¤äº†å…ƒç´ ä¼šå¯¼è‡´ç»“æœé›†ä¸­å…ƒç´ çš„æ”¹å˜ã€‚ã€‚</span></span><br><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(nums.length == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">   ArrayList&lt;Integer&gt; curNum = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="type">boolean</span>[] tag = <span class="keyword">new</span> <span class="title class_">boolean</span>[nums.length];</span><br><span class="line">        dfs(curNum, tag, res, nums);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(ArrayList&lt;Integer&gt; curNum,<span class="type">boolean</span>[] tag, List&lt;List&lt;Integer&gt;&gt; res, <span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(curNum.size() == nums.length)&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(curNum));<span class="comment">//##############################å°±è¯´çš„æ˜¯è¿™é‡Œï¼ï¼ï¼ï¼</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!tag[i])&#123;</span><br><span class="line">                curNum.add(nums[i]);</span><br><span class="line">                tag[i] = <span class="literal">true</span>;</span><br><span class="line">                dfs(curNum, tag, res, nums);</span><br><span class="line">                curNum.remove(curNum.size() - <span class="number">1</span>);</span><br><span class="line">                tag[i] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºæ’åˆ—é—®é¢˜ï¼šæˆ‘ä»¬åªéœ€è¦éå†å¹¶å›æº¯æ‰€æœ‰çš„æƒ…å†µå¹¶è®°å½•å³å¯ï¼Œ</p><p><strong>ç»„åˆé—®é¢˜</strong>ï¼Œç›¸å¯¹äºæ’åˆ—é—®é¢˜è€Œè¨€ï¼Œä¸è®¡è¾ƒä¸€ä¸ªç»„åˆå†…å…ƒç´ çš„é¡ºåºæ€§ï¼ˆå³ [1, 2, 3] ä¸ [1, 3, 2] è®¤ä¸ºæ˜¯åŒä¸€ä¸ªç»„åˆï¼‰ï¼Œå› æ­¤å¾ˆå¤šæ—¶å€™<strong>éœ€è¦æŒ‰æŸç§é¡ºåºå±•å¼€æœç´¢</strong>ï¼Œè¿™æ ·æ‰èƒ½åšåˆ°ä¸é‡ä¸æ¼ã€‚</p><p>æˆ‘ä»¬éœ€è¦æŒ‰ç…§æŸç§é¡ºåº(æ¯”å¦‚å¤§å°é¡ºåº)è¿›è¡Œæœç´¢ï¼Œä¹Ÿå°±æ˜¯â€œå‰ªæâ€</p><p><u>ç¬”è®°çš„å›æº¯ç¬¬11ã€12ã€13ã€14ã€15é¢˜æœªåšï¼</u></p><h1 id="è´ªå¿ƒï¼š"><a href="#è´ªå¿ƒï¼š" class="headerlink" title="è´ªå¿ƒï¼š"></a>è´ªå¿ƒï¼š</h1><h3 id="é€‚ç”¨èŒƒå›´ï¼š"><a href="#é€‚ç”¨èŒƒå›´ï¼š" class="headerlink" title="é€‚ç”¨èŒƒå›´ï¼š"></a>é€‚ç”¨èŒƒå›´ï¼š</h3><p>è´ªå¿ƒç®—æ³•åœ¨<strong>æœ‰æœ€ä¼˜å­ç»“æ„</strong>çš„é—®é¢˜ä¸­å°¤ä¸ºæœ‰æ•ˆã€‚æœ€ä¼˜å­ç»“æ„çš„æ„æ€æ˜¯é—®é¢˜èƒ½å¤Ÿåˆ†è§£æˆå­é—®é¢˜æ¥è§£å†³ï¼Œå­é—®é¢˜çš„æœ€ä¼˜è§£èƒ½é€’æ¨åˆ°æœ€ç»ˆé—®é¢˜çš„æœ€ä¼˜è§£ã€‚</p><h2 id="ä¸¤ç§å¸¸è§æ€è·¯ï¼š"><a href="#ä¸¤ç§å¸¸è§æ€è·¯ï¼š" class="headerlink" title="ä¸¤ç§å¸¸è§æ€è·¯ï¼š"></a>ä¸¤ç§å¸¸è§æ€è·¯ï¼š</h2><h3 id="æ’åºè§£æ³•"><a href="#æ’åºè§£æ³•" class="headerlink" title="æ’åºè§£æ³•"></a>æ’åºè§£æ³•</h3><p>ç”¨æ’åºæ³•å¸¸è§çš„æƒ…å†µæ˜¯è¾“å…¥ä¸€ä¸ªåŒ…å«å‡ ä¸ªï¼ˆä¸€èˆ¬ä¸€åˆ°ä¸¤ä¸ªï¼‰æƒå€¼çš„æ•°ç»„ï¼Œé€šè¿‡æ’åºç„¶åéå†æ¨¡æ‹Ÿè®¡ç®—çš„æ–¹æ³•æ±‚å‡ºæœ€ä¼˜å€¼ã€‚</p><h3 id="åæ‚”è§£æ³•"><a href="#åæ‚”è§£æ³•" class="headerlink" title="åæ‚”è§£æ³•"></a>åæ‚”è§£æ³•</h3><p>æ€è·¯æ˜¯æ— è®ºå½“å‰çš„é€‰é¡¹æ˜¯å¦æœ€ä¼˜éƒ½æ¥å—ï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœé€‰æ‹©ä¹‹åä¸æ˜¯æœ€ä¼˜äº†ï¼Œåˆ™åæ‚”ï¼Œèˆå¼ƒæ‰è¿™ä¸ªé€‰é¡¹ï¼›å¦åˆ™ï¼Œæ­£å¼æ¥å—ã€‚å¦‚æ­¤å¾€å¤ã€‚</p><h1 id="åŠ¨æ€è§„åˆ’ï¼"><a href="#åŠ¨æ€è§„åˆ’ï¼" class="headerlink" title="åŠ¨æ€è§„åˆ’ï¼"></a>åŠ¨æ€è§„åˆ’ï¼</h1><p>â€‹å†™åˆ°0-1èƒŒåŒ…ç¬¬ä¸‰é¢˜</p><h1 id="é“¾è¡¨ï¼š"><a href="#é“¾è¡¨ï¼š" class="headerlink" title="é“¾è¡¨ï¼š"></a>é“¾è¡¨ï¼š</h1><h3 id="çº¯é“¾è¡¨æ“ä½œçš„é¢˜ç›®æœ‰å¾ˆå¤šéƒ½å¯ä»¥ä½¿ç”¨-é€’å½’-è§£å†³ï¼"><a href="#çº¯é“¾è¡¨æ“ä½œçš„é¢˜ç›®æœ‰å¾ˆå¤šéƒ½å¯ä»¥ä½¿ç”¨-é€’å½’-è§£å†³ï¼" class="headerlink" title="çº¯é“¾è¡¨æ“ä½œçš„é¢˜ç›®æœ‰å¾ˆå¤šéƒ½å¯ä»¥ä½¿ç”¨ é€’å½’ è§£å†³ï¼"></a>çº¯é“¾è¡¨æ“ä½œçš„é¢˜ç›®æœ‰å¾ˆå¤šéƒ½å¯ä»¥ä½¿ç”¨ <em>é€’å½’</em> è§£å†³ï¼</h3><p>å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¦æ±‚ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">swapPairs</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(head == <span class="literal">null</span> || head.next == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">next</span> <span class="operator">=</span> head.next;</span><br><span class="line">    head.next = swapPairs(next.next);</span><br><span class="line">    next.next = head;</span><br><span class="line">    <span class="keyword">return</span> next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é™¤äº†é€’å½’å¾ˆå¸¸è§ä»¥å¤–ï¼Œå¿«æ…¢æŒ‡é’ˆçš„æ–¹æ³•-ä¹Ÿå¾ˆå¸¸è§"><a href="#é™¤äº†é€’å½’å¾ˆå¸¸è§ä»¥å¤–ï¼Œå¿«æ…¢æŒ‡é’ˆçš„æ–¹æ³•-ä¹Ÿå¾ˆå¸¸è§" class="headerlink" title="é™¤äº†é€’å½’å¾ˆå¸¸è§ä»¥å¤–ï¼Œå¿«æ…¢æŒ‡é’ˆçš„æ–¹æ³• ä¹Ÿå¾ˆå¸¸è§"></a>é™¤äº†é€’å½’å¾ˆå¸¸è§ä»¥å¤–ï¼Œ<u><em>å¿«æ…¢æŒ‡é’ˆçš„æ–¹æ³•</em></u> ä¹Ÿå¾ˆå¸¸è§</h3><p>å¦‚åˆ¤æ–­é“¾è¡¨æ˜¯å¦å›æ–‡ï¼Œå¯ä»¥ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°é“¾è¡¨çš„ä¸­é—´(å…·ä½“å¥‡å¶ä½å†è€ƒè™‘)ï¼Œå†å°†é“¾è¡¨åˆ†å‰²ä½ä¸¤ä¸ªå­é“¾è¡¨ï¼Œåè½¬å…¶ä¸€ï¼Œå¦‚æœä¸¤ä¸ªå­é“¾è¡¨ç›¸ç­‰åˆ™å›æ–‡ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">null</span> || head.next == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head, fast = head.next;</span><br><span class="line">    <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">        fast = fast.next.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (fast != <span class="literal">null</span>) slow = slow.next;  <span class="comment">// å¶æ•°èŠ‚ç‚¹ï¼Œè®© slow æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    cut(head, slow);                     <span class="comment">// åˆ‡æˆä¸¤ä¸ªé“¾è¡¨</span></span><br><span class="line">    <span class="keyword">return</span> isEqual(head, reverse(slow));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cut</span><span class="params">(ListNode head, ListNode cutNode)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (head.next != cutNode) &#123;</span><br><span class="line">        head = head.next;</span><br><span class="line">    &#125;</span><br><span class="line">    head.next = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ListNode <span class="title function_">reverse</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">newHead</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span> (head != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">nextNode</span> <span class="operator">=</span> head.next;</span><br><span class="line">        head.next = newHead;</span><br><span class="line">        newHead = head;</span><br><span class="line">        head = nextNode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newHead;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isEqual</span><span class="params">(ListNode l1, ListNode l2)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (l1 != <span class="literal">null</span> &amp;&amp; l2 != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (l1.val != l2.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        l1 = l1.next;</span><br><span class="line">        l2 = l2.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ ‘ï¼š"><a href="#æ ‘ï¼š" class="headerlink" title="æ ‘ï¼š"></a>æ ‘ï¼š</h1><h2 id="é€’å½’ï¼š"><a href="#é€’å½’ï¼š" class="headerlink" title="é€’å½’ï¼š"></a>é€’å½’ï¼š</h2><p>ä¸€æ£µæ ‘è¦ä¹ˆæ˜¯ç©ºæ ‘ï¼Œè¦ä¹ˆæœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œæ¯ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€æ£µæ ‘ã€‚æ ‘æ˜¯ä¸€ç§é€’å½’ç»“æ„ï¼Œå¾ˆå¤šæ ‘çš„é—®é¢˜å¯ä»¥ä½¿ç”¨<strong>é€’å½’</strong>æ¥å¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">å¯¹æ ‘çš„æ“ä½œï¼Œä¸€èˆ¬å¯ä»¥ç”¨é€’å½’è§£å†³ï¼š</span><br><span class="line"><span class="comment">//é€šç”¨æ ¼å¼ï¼š</span></span><br><span class="line">functionname ( TreeNode root )&#123;</span><br><span class="line"><span class="keyword">if</span>(root  == <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> xx;</span><br><span class="line">  &#125;  </span><br><span class="line">  root.left = functionname(xxx);</span><br><span class="line">  root.right = functionname(xxx);</span><br><span class="line">  <span class="keyword">return</span> xxx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¾‹1:</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">diameterOfBinaryTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    depth(root);</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">depth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">leftDepth</span> <span class="operator">=</span> depth(root.left);</span><br><span class="line">    <span class="type">int</span> <span class="variable">rightDepth</span> <span class="operator">=</span> depth(root.right);</span><br><span class="line">    max = Math.max(max, leftDepth + rightDepth);</span><br><span class="line">    <span class="keyword">return</span> Math.max(leftDepth, rightDepth) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¾‹2:</span></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">invertTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;<span class="keyword">return</span> root;&#125;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">temp</span> <span class="operator">=</span> root.left;</span><br><span class="line">        root.left = invertTree(root.right);</span><br><span class="line">        root.right = invertTree(temp);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//ä¾‹3:</span></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">mergeTrees</span><span class="params">(TreeNode root1, TreeNode root2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root1 == <span class="literal">null</span> &amp;&amp; root2 == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root1 == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> root2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root2 == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> root1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">res</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(root1.val + root2.val);</span><br><span class="line">        res.left = mergeTrees(root1.left, root2.left);</span><br><span class="line">        res.right = mergeTrees(root1.right, root2.right);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¾‹4:ä¸€ç§æœ‰ç‚¹å¦™çš„æ ¼å¼ï¼š</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubtree</span><span class="params">(TreeNode s, TreeNode t)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> isSubtreeWithRoot(s, t) || isSubtree(s.left, t) || isSubtree(s.right, t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isSubtreeWithRoot</span><span class="params">(TreeNode s, TreeNode t)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (t == <span class="literal">null</span> &amp;&amp; s == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (t == <span class="literal">null</span> || s == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (t.val != s.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> isSubtreeWithRoot(s.left, t.left) &amp;&amp; isSubtreeWithRoot(s.right, t.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­åšå‰ä¸­ååºéå†!</p><h2 id="å±‚æ¬¡éå†ï¼š"><a href="#å±‚æ¬¡éå†ï¼š" class="headerlink" title="å±‚æ¬¡éå†ï¼š"></a>å±‚æ¬¡éå†ï¼š</h2><p>å¹¿åº¦ä¼˜å…ˆå³å¯</p><h2 id="å‰ä¸­ååºéå†ï¼š"><a href="#å‰ä¸­ååºéå†ï¼š" class="headerlink" title="å‰ä¸­ååºéå†ï¼š"></a>å‰ä¸­ååºéå†ï¼š</h2><h2 id="BSTï¼š"><a href="#BSTï¼š" class="headerlink" title="BSTï¼š"></a>BSTï¼š</h2><h2 id="Trieï¼š"><a href="#Trieï¼š" class="headerlink" title="Trieï¼š"></a>Trieï¼š</h2><h1 id="æ•°ç»„ä¸çŸ©é˜µï¼š"><a href="#æ•°ç»„ä¸çŸ©é˜µï¼š" class="headerlink" title="æ•°ç»„ä¸çŸ©é˜µï¼š"></a>æ•°ç»„ä¸çŸ©é˜µï¼š</h1><p>çœ‹åˆ°ï¼š5. æœ‰åºçŸ©é˜µçš„ Kth Element</p><h1 id="å›¾ï¼š"><a href="#å›¾ï¼š" class="headerlink" title="å›¾ï¼š"></a>å›¾ï¼š</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//javaå»ºå›¾æ¨¡æ¿</span></span><br><span class="line">g = <span class="keyword">new</span> <span class="title class_">ArrayList</span>[n];</span><br><span class="line">Arrays.setAll(g, e -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;() );</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> e : edges)&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> e[<span class="number">0</span>], y = e[<span class="number">1</span>];</span><br><span class="line">    g[x].add(y);</span><br><span class="line">    g[y].add(x);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒåˆ†å›¾ï¼š"><a href="#äºŒåˆ†å›¾ï¼š" class="headerlink" title="äºŒåˆ†å›¾ï¼š"></a>äºŒåˆ†å›¾ï¼š</h2><p>â€‹å¦‚æœå¯ä»¥ç”¨ä¸¤ç§é¢œè‰²å¯¹å›¾ä¸­çš„èŠ‚ç‚¹è¿›è¡Œç€è‰²ï¼Œå¹¶ä¸”ä¿è¯ç›¸é‚»çš„èŠ‚ç‚¹é¢œè‰²ä¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ªå›¾å°±æ˜¯äºŒåˆ†å›¾ã€‚</p><p>â€‹&#x2F;&#x2F;åˆ¤æ–­æ˜¯å¦æ˜¯äºŒåˆ†å›¾â¬‡ï¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">judge</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBipartite</span><span class="params">(<span class="type">int</span>[][] graph)</span> &#123;</span><br><span class="line">       <span class="comment">//colorè®°å½•æ¯ä¸ªèŠ‚ç‚¹çš„é¢œè‰²ï¼Œ0ä¸ºè¿˜æ²¡è¢«æŸ“è‰²ï¼Œ1ã€2åˆ†åˆ«ä¸ºä¸¤ç§é¢œè‰²</span></span><br><span class="line">       <span class="type">int</span> color[] = <span class="keyword">new</span> <span class="title class_">int</span>[graph.length];</span><br><span class="line">       <span class="comment">//æˆ‘è®¤ä¸ºåº”è¯¥æ·±åº¦éå†è¿™ä¸ªå›¾ï¼Œç»™éå†è¿‡çš„ç»“ç‚¹æŸ“è‰²ï¼Œ</span></span><br><span class="line">       <span class="comment">//å¦‚æœé‡åˆ°å·²ç»æŸ“è‰²çš„ï¼Œçœ‹çœ‹å¦‚æœå’Œè‡ªå·±é¢œè‰²ç›¸åŒï¼Œåˆ™ä¸æ˜¯äºŒåˆ†å›¾ï¼</span></span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; graph.length; i++)&#123;</span><br><span class="line">           <span class="comment">//å¯¹äºæ¯æ£µå­æ ‘ï¼Œå¦‚æœæœ‰ä¸€ä¸ªèŠ‚ç‚¹è¢«dfsè¿‡ï¼Œé‚£ä¹ˆå¦‚æœå¯ä»¥æ„æˆäºŒåˆ†å­å›¾çš„è¯ï¼Œè¿™é¢—å­æ ‘ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸å¿…å†è¿›è¡Œdfsäº†ï¼Œæ•…æ­¤å¤„åªæ‰¾è¿˜æœªè¢«æ¶‚è‰²çš„èŠ‚ç‚¹è¿›è¡Œdfsï¼</span></span><br><span class="line">           <span class="keyword">if</span>(color[i] == <span class="number">0</span>) &#123;</span><br><span class="line">               dfs(graph, i, <span class="number">1</span>, color);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> judge;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span>[][] graph, <span class="type">int</span> i, <span class="type">int</span> thisColor, <span class="type">int</span>[] color)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(!judge)<span class="keyword">return</span>;</span><br><span class="line">       color[i] = thisColor;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; graph[i].length; j++)&#123;</span><br><span class="line">           <span class="keyword">if</span>(color[graph[i][j]] == <span class="number">0</span>)&#123;</span><br><span class="line">               dfs(graph, graph[i][j], thisColor==<span class="number">1</span>?<span class="number">2</span>:<span class="number">1</span>, color);</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="keyword">if</span>(color[i] == color[graph[i][j]])&#123;</span><br><span class="line">                   judge = <span class="literal">false</span>;</span><br><span class="line">                   <span class="keyword">return</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="æ‹“æ‰‘æ’åºï¼š"><a href="#æ‹“æ‰‘æ’åºï¼š" class="headerlink" title="æ‹“æ‰‘æ’åºï¼š"></a>æ‹“æ‰‘æ’åºï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°†é‚»æ¥çŸ©é˜µè½¬æ¢ä¸ºé‚»æ¥è¡¨ï¼š</span></span><br><span class="line"><span class="type">int</span>[][] prerequisites <span class="comment">//é‚»æ¥çŸ©é˜µ</span></span><br><span class="line">List&lt;Integer&gt;[] graphic = <span class="keyword">new</span> <span class="title class_">List</span>[numCourses];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numCourses; i++) &#123;</span><br><span class="line">    graphic[i] = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span>[] pre : prerequisites) &#123;</span><br><span class="line">    graphic[pre[<span class="number">0</span>]].add(pre[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ³•1: æ·±åº¦ä¼˜å…ˆ</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*å®šä¹‰ä¸‰ç§çŠ¶æ€ï¼š0-&gt;æœªæœç´¢ï¼›1-&gt;æœç´¢ä¸­ï¼›2-&gt;å·²å®Œæˆ</span></span><br><span class="line"><span class="comment">*éå†æ‰€æœ‰ç»“ç‚¹ï¼Œå¯¹æœªæœç´¢çš„ç»“ç‚¹è¿›è¡Œdfsï¼Œ</span></span><br><span class="line"><span class="comment">*å¯¹äºdfsï¼šå…ˆå°†è¯¥ç»“ç‚¹ç½®ä¸º1çŠ¶æ€ï¼Œéå†æ‰€æœ‰è¯¥ç»“ç‚¹éœ€è¦çš„ç»“ç‚¹ï¼Œå¦‚æœæ²¡æœ‰ä¾èµ–çš„ç»“ç‚¹æˆ–è€…ä¾èµ–çš„ç»“ç‚¹çš„çŠ¶æ€éƒ½ä¸º2ï¼Œåˆ™è¯¥ç»“ç‚¹ä¹Ÿ</span></span><br><span class="line"><span class="comment">*å¯ä»¥æ ‡è®°æˆ2ï¼›å¦‚æœè¯¥ç»“ç‚¹ä¾èµ–çš„ç»“ç‚¹çŠ¶æ€ä¸º0ï¼Œåˆ™dfsä¾èµ–çš„ç»“ç‚¹ï¼›å¦‚æœä¾èµ–çš„ç»“ç‚¹çš„çŠ¶æ€ä¸º1ï¼Œåˆ™è¯´æ˜å­˜åœ¨ç¯ï¼Œä¸æ»¡è¶³æ‹“æ‰‘æ’</span></span><br><span class="line"><span class="comment">*åºï¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//æ·±åº¦ä¼˜å…ˆåˆ¤æ–­æ‹“æ‰‘æ’åºâ¬‡ï¸</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">loop</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] findOrderByDFS(<span class="type">int</span> numCourses, <span class="type">int</span>[][] prerequisites) &#123;</span><br><span class="line">        <span class="comment">//1.æ„å»ºå›¾</span></span><br><span class="line">        List&lt;Integer&gt;[] relation = <span class="keyword">new</span> <span class="title class_">ArrayList</span>[numCourses];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numCourses; i++)&#123;</span><br><span class="line">            relation[i] = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span>[] arr: prerequisites)&#123;</span><br><span class="line">            relation[arr[<span class="number">0</span>]].add(arr[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ„å»ºæ•°ç»„ï¼Œå­˜æ”¾æ¯é—¨è¯¾ç¨‹çš„çŠ¶æ€0ï¼Œ1ï¼Œ2</span></span><br><span class="line">        <span class="type">int</span>[] status = <span class="keyword">new</span> <span class="title class_">int</span>[numCourses];</span><br><span class="line">        LinkedList&lt;Integer&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();<span class="comment">//ç”¨äºå­˜æ”¾è¯¾ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numCourses; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(status[i] == <span class="number">0</span>)&#123; <span class="comment">//æœªæœç´¢è¿‡ï¼Œäºæ˜¯å¯¹å…¶è¿›è¡Œdfsæœç´¢ï¼</span></span><br><span class="line">                dfs(i, relation, status,stack);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(loop)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[numCourses];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> numCourses - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line">            res[i] = stack.pop();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> curCourse, List&lt;Integer&gt;[] relation, <span class="type">int</span>[] status, LinkedList&lt;Integer&gt; stack)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(loop)<span class="keyword">return</span>;</span><br><span class="line">        status[curCourse] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> next: relation[curCourse])&#123;</span><br><span class="line">            <span class="keyword">if</span>(status[next] == <span class="number">0</span>)&#123;</span><br><span class="line">                dfs(next, relation, status,stack);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(status[next] == <span class="number">1</span>)&#123;</span><br><span class="line">                loop = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stack.push(curCourse);</span><br><span class="line">        status[curCourse] = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ³•2: å¹¿åº¦ä¼˜å…ˆ</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*å°†é‚»æ¥çŸ©é˜µè½¬åŒ–ä¸ºé‚»æ¥è¡¨ å…¶ä¸­ï¼šAéœ€è¦B == B-&gt;A å› æ­¤ ä»»åŠ¡Kå…¥åº¦ä¸º0è¡¨ç¤ºKå¯ä»¥ç›´æ¥å®Œæˆï¼</span></span><br><span class="line"><span class="comment">  *ä½¿ç”¨é˜Ÿåˆ—ï¼Œå°†å…¥åº¦ä¸º0çš„ä»»åŠ¡æ·»åŠ è‡³é˜Ÿåˆ—ï¼Œéå†è¿™äº›ä»»åŠ¡ï¼Œå°†å®ƒä»¬æŒ‡å‘çš„é˜Ÿåˆ—çš„å…¥åº¦--ï¼›å°†æ“ä½œåå…¥åº¦ä¸º0çš„å†æ·»åŠ è¿›é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">  *ç›´åˆ°é˜Ÿåˆ—ä¸ºç©º(å¦‚æœä»é˜Ÿåˆ—å¼¹å‡ºçš„ä»»åŠ¡æ€»æ•° &lt; æ€»ä»»åŠ¡æ•°ï¼Œåˆ™è¯´æ˜å›¾ä¸­æœ‰ç¯ï¼Œä¸èƒ½æ„æˆæ‹“æ‰‘æ’åº)</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="comment">//å¹¿åº¦ä¼˜å…ˆåˆ¤æ–­æ‹“æ‰‘æ’åº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] findOrderByBFS(<span class="type">int</span> numCourses, <span class="type">int</span>[][] prerequisites) &#123;</span><br><span class="line">        <span class="comment">//1.æ„å»ºå›¾</span></span><br><span class="line">        <span class="comment">//å¹¿åº¦ä¼˜å…ˆï¼Œaéœ€è¦b åˆ™ b-&gt;a</span></span><br><span class="line">        <span class="comment">//æ¯æ¬¡è®°å½•å…¥åº¦ä¸º0çš„è¯¾ç¨‹,å› æ­¤éœ€è¦åˆ›å»ºæ•°ç»„è®°å½•æ¯ä¸ªè¯¾ç¨‹çš„å…¥åº¦</span></span><br><span class="line">        List&lt;Integer&gt;[] relation = <span class="keyword">new</span> <span class="title class_">ArrayList</span>[numCourses];</span><br><span class="line">        <span class="type">int</span> []inDegree = <span class="keyword">new</span> <span class="title class_">int</span>[numCourses];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numCourses; i++)&#123;</span><br><span class="line">            relation[i] = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span>[] arr: prerequisites)&#123;</span><br><span class="line">            relation[arr[<span class="number">1</span>]].add(arr[<span class="number">0</span>]);</span><br><span class="line">            inDegree[arr[<span class="number">0</span>]]++;</span><br><span class="line">        &#125;</span><br><span class="line">        LinkedList&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//é˜Ÿåˆ—åˆå§‹åŒ–ï¼šå°†æ‰€æœ‰å…¥åº¦ä¸º0çš„è¯¾ç¨‹éƒ½åŠ å…¥queue</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numCourses; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(inDegree[i] == <span class="number">0</span>)&#123;</span><br><span class="line">                queue.offer(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[numCourses];</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–å®Œæ¯•ï¼Œå¼€å§‹å¸¸è§„bfs</span></span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">sz</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            <span class="keyword">while</span>(sz-- &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">curCourse</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i: relation[curCourse])&#123;</span><br><span class="line">                    inDegree[i]--;</span><br><span class="line">                    <span class="keyword">if</span>(inDegree[i] == <span class="number">0</span>)&#123;</span><br><span class="line">                        queue.offer(i);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                res[index++] = curCourse;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> index == numCourses? res: <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å¹¶æŸ¥é›†ï¼š"><a href="#å¹¶æŸ¥é›†ï¼š" class="headerlink" title="å¹¶æŸ¥é›†ï¼š"></a>å¹¶æŸ¥é›†ï¼š</h2><p>å¹¶æŸ¥é›†å¯ä»¥åŠ¨æ€åœ°è¿é€šä¸¤ä¸ªç‚¹ï¼Œå¹¶ä¸”å¯ä»¥éå¸¸å¿«é€Ÿåœ°åˆ¤æ–­ä¸¤ä¸ªç‚¹æ˜¯å¦è¿é€šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *===============================å¹¶æŸ¥é›†æ¨¡æ¿ï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼ï¼ï¼=====================================</span></span><br><span class="line"><span class="comment"> * æ•°ç»„æ¨¡æ‹Ÿæ ‘ï¼Œå®ç°å¹¶æŸ¥é›†ã€‚æ•°ç»„å†…çš„å…ƒç´ è¡¨ç¤ºçˆ¶äº²çš„ä¸‹è§’è¡¨ï¼Œç›¸å½“äºæŒ‡é’ˆã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnionFind</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] parent;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UnionFind</span><span class="params">(<span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.size = size;</span><br><span class="line">        parent = <span class="keyword">new</span> <span class="title class_">int</span>[size];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            parent[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> element)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (element != parent[element]) &#123;</span><br><span class="line">            element = parent[element];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> element;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isConnected</span><span class="params">(<span class="type">int</span> firstElement, <span class="type">int</span> secondElement)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> find(firstElement) == find(secondElement);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unionElements</span><span class="params">(<span class="type">int</span> firstElement, <span class="type">int</span> secondElement)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">firstRoot</span> <span class="operator">=</span> find(firstElement);</span><br><span class="line">        <span class="type">int</span> <span class="variable">secondRoot</span> <span class="operator">=</span> find(secondElement);</span><br><span class="line">        <span class="keyword">if</span> (firstRoot == secondRoot) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        parent[firstRoot] = secondRoot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¹¶æŸ¥é›†çš„åº”ç”¨ï¼š</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] findRedundantConnection(<span class="type">int</span>[][] edges) &#123;</span><br><span class="line">        <span class="type">UnionFind</span> <span class="variable">unionfind</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">UnionFind</span>(edges.length + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span>[] edge:edges)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!unionfind.isConnected(edge[<span class="number">0</span>],edge[<span class="number">1</span>]))&#123;</span><br><span class="line">                unionfind.unionElements(edge[<span class="number">0</span>], edge[<span class="number">1</span>]);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> edge;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯»æ‰¾å›¾ä¸­çš„æœ€å¤§ç¯ï¼š"><a href="#å¯»æ‰¾å›¾ä¸­çš„æœ€å¤§ç¯ï¼š" class="headerlink" title="å¯»æ‰¾å›¾ä¸­çš„æœ€å¤§ç¯ï¼š"></a>å¯»æ‰¾å›¾ä¸­çš„æœ€å¤§ç¯ï¼š</h2><h1 id="è®¡æ•°æ’åº"><a href="#è®¡æ•°æ’åº" class="headerlink" title="è®¡æ•°æ’åº"></a>è®¡æ•°æ’åº</h1><p>ç”¨äº<u><strong>å€¼åŸŸè¾ƒå°çš„å¤§é‡æ•°å­—çš„æ’åº</strong></u>ï¼Œå°†å„ä¸ª<strong>æ•°å­—çš„å€¼</strong>ä¸<strong>ä¸ªæ•°</strong>ä½œä¸ºä¸€ä¸ª<strong>æ•°ç»„çš„ä¸‹æ ‡</strong>å’Œ<strong>å€¼</strong>é€šè¿‡éå†æ•°ç»„ï¼Œç´¯åŠ arr[]çš„å€¼ &#x3D; k<strong>å¾—åˆ°ç¬¬kå°çš„æ•°å­—</strong></p><h1 id="æ¡¶æ’åºï¼š"><a href="#æ¡¶æ’åºï¼š" class="headerlink" title="æ¡¶æ’åºï¼š"></a>æ¡¶æ’åºï¼š</h1><p>â€‹è®¾ç½®è‹¥å¹²ä¸ªæ¡¶ bucket[i] å­˜å‚¨å‡ºç°æ¬¡æ•°ä¸ºiçš„æ•°ï¼Œ bucketå®šä¹‰ä¸º ArrayList[ ] ç±»å‹</p><h1 id="å¿«é€Ÿé€‰æ‹©ï¼š"><a href="#å¿«é€Ÿé€‰æ‹©ï¼š" class="headerlink" title="å¿«é€Ÿé€‰æ‹©ï¼š"></a>å¿«é€Ÿé€‰æ‹©ï¼š</h1><p>å¹³å¸¸äººä»¬<strong>é€‰æ‹©æ•°æ®ä¸­æŸä¸ªç¬¬å‡ å¤§</strong>çš„æ•°æ®ï¼Œå¾€å¾€ä½¿ç”¨å…ˆæ’åºåœ¨é€‰æ‹©çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æœ€å¿«ä¸ºOnlognï¼ˆå¿«æ’æ—¶é—´å¤æ‚åº¦ï¼‰ï¼Œä½†åœ¨æ•°æ®è¾ƒå¤§æ—¶å¾€å¾€ä¼šè¶…å‡ºæ—¶é—´é™åˆ¶ï¼Œæ•…æœ¬æ¬¡ä»‹ç»æ—¶é—´å¤æ‚åº¦ä¸ºOnçš„å¿«é€Ÿé€‰æ‹©æ–¹æ³•</p><p>å¿«é€Ÿé€‰æ‹©ç®—æ³•ï¼šç®—æ³•æ ¸å¿ƒä¸ºé€’å½’å’Œåˆ†æ²»ï¼Œå’Œå¿«é€Ÿæ’åºç®—æ³•æœ‰ä¸€å®šçš„ç›¸ä¼¼åº¦ï¼Œç®—æ³•å¤§æ¦‚è¿‡ç¨‹ä¸º<br>1.å…ˆåˆ¤æ–­åŒºé—´çš„ç«¯ç‚¹l,rå’Œæ¯”è¾ƒæ•°pivot,pivotå¯å–ä¸ºarr[l],arr[r],arr[(l + r) &#x2F; 2)]ã€‚</p><p>2.è¿›è¡Œæ’åºäº¤æ¢ï¼Œä½¿åŒºé—´åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå·¦è¾¹éƒ¨åˆ†å°äºç­‰äºpivotï¼Œå³è¾¹éƒ¨åˆ†å¤§äºç­‰äºpivotã€‚</p><p>3.é€’å½’æ’åºå·¦å³è¾¹ï¼Œå½“è¦æ±‚çš„ç¬¬Kä¸ªæ•°,k &gt;&#x3D; slï¼Œåˆ™é€’å½’æ’åºå³è¾¹ï¼Œå¦åˆ™é€’å½’æ’åºå·¦è¾¹ï¼Œå¦‚æœåŒºé—´åªæœ‰ä¸€ä¸ªæ•°åˆ™è¿”å›ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">quickChoose</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> [] arr,<span class="type">int</span> k)</span>&#123;</span><br><span class="line">        <span class="comment">//å¦‚æœå½“å‰åªæœ‰ä¸€ä¸ªæ•°å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(l == r)&#123;</span><br><span class="line">           <span class="keyword">return</span> arr[l];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦åˆ™è¿›è¡Œæ’åºå’ŒæŸ¥æ‰¾</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l - <span class="number">1</span>,j = r + <span class="number">1</span>,pivot = arr[l];</span><br><span class="line">        <span class="comment">//æœ¬æ¬¡è¿”å›j,j + 1</span></span><br><span class="line">        <span class="comment">//å½“å‰å…ƒç´ åŒºé—´ä¸æ­¢ä¸ºä¸€ä¸ªæ•°æ—¶</span></span><br><span class="line">        <span class="keyword">while</span>(i &lt; j)&#123;</span><br><span class="line">            <span class="keyword">while</span>(arr[++i] &lt; pivot);</span><br><span class="line">            <span class="keyword">while</span>(arr[--j] &gt; pivot);</span><br><span class="line">            <span class="comment">//å¦‚æœæ»¡è¶³åŒºé—´å…ƒç´ ä¸ä¸º1</span></span><br><span class="line">            <span class="keyword">if</span>(i &lt; j)&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> arr[j];</span><br><span class="line">                arr[j] = arr[i];</span><br><span class="line">                arr[i] = t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœåœ¨å·¦åŠéƒ¨åˆ†ï¼Œç›´æ¥æ’åºå·¦è¾¹æ±‚è§£</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">s1</span> <span class="operator">=</span> j - l + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(s1 &gt;= k)&#123;</span><br><span class="line">            <span class="keyword">return</span> quickChoose(l,i - <span class="number">1</span>,arr,k);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//å¦åˆ™æ’åºå³è¾¹æ•°ç»„</span></span><br><span class="line">            k = k - s1;</span><br><span class="line">            <span class="keyword">return</span> quickChoose( i,r,arr,k);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="åŒˆç‰™åˆ©ç®—æ³•ï¼š"><a href="#åŒˆç‰™åˆ©ç®—æ³•ï¼š" class="headerlink" title="åŒˆç‰™åˆ©ç®—æ³•ï¼š"></a>åŒˆç‰™åˆ©ç®—æ³•ï¼š</h1><ul><li><p><strong>åŒˆç‰™åˆ©ç®—æ³•ä¸»è¦ç”¨æ¥è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼šæ±‚äºŒåˆ†å›¾çš„æœ€å¤§åŒ¹é…æ•°å’Œæœ€å°ç‚¹è¦†ç›–æ•°</strong>ã€‚</p><p>æ±‚äºŒåˆ†å›¾æœ€å¤§è¿é€šæ•° æ¨¡ç‰ˆâ¬‡ï¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ç±»åå¿…é¡»ä¸º Main, ä¸è¦æœ‰ä»»ä½• package xxx ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="comment">// æ³¨æ„ hasNext å’Œ hasNextLine çš„åŒºåˆ«</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">        List&lt;Integer&gt; odd = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Integer&gt; even = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">            <span class="keyword">if</span>(temp % <span class="number">2</span> == <span class="number">0</span>)&#123;even.add(temp);&#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;odd.add(temp);&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> [] match = <span class="keyword">new</span> <span class="title class_">int</span> [even.size()];</span><br><span class="line">        <span class="keyword">if</span>(odd.size() == <span class="number">0</span> || even.size() == <span class="number">0</span>)&#123; <span class="comment">//ç¼ºå°‘å¥‡æ•°æˆ–è€…å¶æ•°æ— æ³•æ„æˆç´ æ•°</span></span><br><span class="line">            System.out.println(count);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i: odd)&#123;</span><br><span class="line">            <span class="type">boolean</span> [] used = <span class="keyword">new</span> <span class="title class_">boolean</span> [even.size()];</span><br><span class="line">            <span class="keyword">if</span>(find(i,even, match, used))count++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        System.out.println(count);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> i, List&lt;Integer&gt; even, <span class="type">int</span>[] match,<span class="type">boolean</span> [] used)</span> &#123;</span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; even.size(); j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(isPrime(i + even.get(j)) &amp;&amp; !used[j])&#123;</span><br><span class="line">                used[j] = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span>(match[j] == <span class="number">0</span> || find(match[j], even, match,used))&#123;</span><br><span class="line">                    match[j] = i;  </span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPrime</span><span class="params">(<span class="type">int</span> n)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i * i &lt;= n; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(n % i == <span class="number">0</span>)<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="å¤šè·¯å½’å¹¶ï¼š"><a href="#å¤šè·¯å½’å¹¶ï¼š" class="headerlink" title="å¤šè·¯å½’å¹¶ï¼š"></a>å¤šè·¯å½’å¹¶ï¼š</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://lfool.github.io/LFool-Notes/algorithm/å¤šè·¯å½’å¹¶æŠ€å·§æ€»ç»“.html</span><br></pre></td></tr></table></figure><ul><li><p>21.åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨(ç®€å•)</p></li><li><p>23.åˆå¹¶Kä¸ªå‡åºé“¾è¡¨(<strong>å›°éš¾</strong>)</p><p>æ¯æ¬¡ä»æ‰€æœ‰é“¾è¡¨å¤´ä¸­é€‰æ‹©æ•°å€¼æœ€å°çš„å€¼åŠ å…¥ç»“æœé“¾è¡¨ä¸­å³å¯ã€‚è‡ªå·±åšæ—¶åªä½¿ç”¨äº†éå†çš„æ–¹æ³•ï¼Œä½†æ˜¯å‘ç°å¤§ç¥ä»¬<strong>ä½¿ç”¨å°æ ¹å †</strong>æ¥è·å–æœ€å°çš„é“¾è¡¨å¤´éƒ¨ï¼</p><ul><li>è¿˜å¯ä»¥ä½¿ç”¨å½’å¹¶çš„æ–¹æ³•ï¼Œ(åˆå¹¶nä¸ªé“¾è¡¨â€”â€“åˆ†åŠåˆ†åŠå†åˆ†åŠâ€”â€“&gt;åˆå¹¶2ä¸ªé“¾è¡¨)ï¼Œé’ˆå¯¹åˆå¹¶2ä¸ªé“¾è¡¨ç¼–å†™ä»£ç </li><li>è¿˜å¯ä»¥ä½¿ç”¨PriorityQueue<ListNode>ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå®ƒè‡ªåŠ¨å°†é˜Ÿåˆ—å†…çš„å…ƒç´ æŒ‰ç…§æä¾›çš„é‡å†™çš„compareæ–¹æ³•æ¥æ’åºï¼Œæ¯æ¬¡pollå‡ºæœ€å°çš„ï¼Œå†æŠŠå®ƒçš„next(å¦‚æœæœ‰)æ”¾å…¥é˜Ÿåˆ—</li></ul></li></ul><h1 id="å•è°ƒæ ˆï¼š"><a href="#å•è°ƒæ ˆï¼š" class="headerlink" title="å•è°ƒæ ˆï¼š"></a>å•è°ƒæ ˆï¼š</h1><p>â€‹<strong>ç”¨äºå¤„ç† è·å–é€’å¢å­åºåˆ—ä¹‹ç±»çš„é¢˜ç›®</strong></p><p>â€‹éå†æ‰€ç»™çš„æ•°æ®ï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ªæ ˆï¼Œ</p><p>â€‹æ¯”å¦‚ç°åœ¨éœ€è¦æ‰¾å‡ºé•¿åº¦ä¸ºnçš„æœ€å°å­—å…¸åºå­å­—ç¬¦ä¸²</p><p>â€‹å¦‚æœè·å¾—çš„æ•°æ®æ¯”æ ˆé¡¶çš„å°ï¼Œåˆ™å¼¹å‡ºæ ˆé¡¶ï¼Œç›´åˆ°æ ˆä¸ºç©º æˆ– æ ˆé¡¶å…ƒç´ å°äºæ‰€æŒå…ƒç´ ï¼Œ (è¿™é‡Œè¿˜æ³¨æ„ï¼šå› ä¸ºæˆ‘ä»¬éœ€è¦çš„æ˜¯é•¿åº¦ä¸ºnçš„å­åºåˆ—ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬æ¯æ¬¡æƒ³è¦popçš„æ—¶å€™éƒ½éœ€è¦åˆ¤æ–­ï¼šæ ˆä¸­å…ƒç´ ä»¥åŠæœªéå†çš„å…ƒç´ æ€»æ•°æ˜¯å¦è¾¾åˆ°äº†äº†nï¼Œè‹¥&gt;nï¼Œåˆ™å…è®¸pop)</p><p>æœ€åå°†æ ˆä¸­çš„æ•°æ®ä¾æ¬¡popï¼Œå†reverseä¸€ä¸‹å³å¯</p><h1 id="ğŸŒŸTreeSetçš„ä½¿ç”¨ï¼š"><a href="#ğŸŒŸTreeSetçš„ä½¿ç”¨ï¼š" class="headerlink" title="ğŸŒŸTreeSetçš„ä½¿ç”¨ï¼š"></a>ğŸŒŸTreeSetçš„ä½¿ç”¨ï¼š</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        TreeSet&lt;Integer&gt; treeSet = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;();</span><br><span class="line">        in.next();</span><br><span class="line">        <span class="keyword">while</span> (in.hasNextInt()) &#123; <span class="comment">// æ³¨æ„ while å¤„ç†å¤šä¸ª case</span></span><br><span class="line">            treeSet.add(in.nextInt());           </span><br><span class="line">        &#125;</span><br><span class="line">        Iterator&lt;Integer&gt; tree = treeSet.iterator();</span><br><span class="line">        <span class="keyword">while</span> (tree.hasNext())&#123;</span><br><span class="line">            System.out.println(tree.next());</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ceiling(E e)ï¼šè¿”å›å¤§äºç­‰äºç»™å®šå…ƒç´ çš„æœ€å°å…ƒç´ ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å› nullã€‚ </span></span><br><span class="line"><span class="comment">//  floor(E e)ï¼šè¿”å›å°äºç­‰äºç»™å®šå…ƒç´ çš„æœ€å¤§å…ƒç´ ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å› nullã€‚</span></span><br></pre></td></tr></table></figure><h1 id="System-arraycopy-çš„ä½¿ç”¨"><a href="#System-arraycopy-çš„ä½¿ç”¨" class="headerlink" title="System.arraycopy()çš„ä½¿ç”¨"></a>System.arraycopy()çš„ä½¿ç”¨</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span>      src      the source array. æºæ•°ç»„</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span>      srcPos   starting position in the source array. æºæ•°ç»„çš„èµ·å§‹ä½ç½®</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span>      dest     the destination array. ç›®æ ‡æ•°ç»„</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span>      destPos  starting position in the destination data. ç›®æ ‡æ•°ç»„çš„èµ·å§‹ä½ç½®</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span>      length   the number of array elements to be copied. å¤åˆ¶çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">arraycopy(Object src,<span class="type">int</span> srcPos,Object dest, <span class="type">int</span> destPos, <span class="type">int</span> length)ï¼›</span><br></pre></td></tr></table></figure><h1 id="åŠ¨æ€è§„åˆ’ï¼š"><a href="#åŠ¨æ€è§„åˆ’ï¼š" class="headerlink" title="åŠ¨æ€è§„åˆ’ï¼š"></a>åŠ¨æ€è§„åˆ’ï¼š</h1><h4 id="1031-ä¸¤ä¸ªéé‡å å­æ•°ç»„çš„æœ€å¤§å’Œ"><a href="#1031-ä¸¤ä¸ªéé‡å å­æ•°ç»„çš„æœ€å¤§å’Œ" class="headerlink" title="1031. ä¸¤ä¸ªéé‡å å­æ•°ç»„çš„æœ€å¤§å’Œ"></a><a href="https://leetcode.cn/problems/maximum-sum-of-two-non-overlapping-subarrays/">1031. ä¸¤ä¸ªéé‡å å­æ•°ç»„çš„æœ€å¤§å’Œ</a></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸¤ä¸ªæ•´æ•° firstLen å’Œ secondLenï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›ä¸¤ä¸ªéé‡å  å­æ•°ç»„ ä¸­å…ƒç´ çš„æœ€å¤§å’Œï¼Œé•¿åº¦åˆ†åˆ«ä¸º firstLen å’Œ secondLen ã€‚</span><br><span class="line">é•¿åº¦ä¸º firstLen çš„å­æ•°ç»„å¯ä»¥å‡ºç°åœ¨é•¿ä¸º secondLen çš„å­æ•°ç»„ä¹‹å‰æˆ–ä¹‹åï¼Œä½†äºŒè€…å¿…é¡»æ˜¯ä¸é‡å çš„ã€‚</span><br><span class="line">å­æ•°ç»„æ˜¯æ•°ç»„çš„ä¸€ä¸ª è¿ç»­ éƒ¨åˆ†ã€‚</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åŠ¨æ€è§„åˆ’ ï¼š</p><ul><li><p>dp1[ i ]è¡¨ç¤ºå‰iä¸ªæ•°ä¸­é•¿åº¦ä¸ºfirstLençš„å­æ•°ç»„çš„æœ€å¤§å€¼ (è‹¥ i &lt; firstLen)åˆ™dp1[ i ] &#x3D; å‰iä¸ªæ•°ä¹‹å’Œ</p></li><li><p>dp2[ i ]è¡¨ç¤ºå‰iä¸ªæ•°ä¸­é•¿åº¦ä¸ºsecondLençš„å­æ•°ç»„çš„æœ€å¤§å€¼</p><p>æˆ‘ä»¬å¾—åˆ°dp1[ ]ä¸dp2[ ]æ•°ç»„åï¼Œå¯¹äºæ¯ä¸ªiï¼Œæˆ‘ä»¬å¯ä»¥è®©res &#x3D; Max{res, æ•°ç»„1(firstLen)åŒ…å«äº†æœ€æ–°çš„ç¬¬iä½ï¼Œæ•°ç»„2(secondLen)åŒ…å«äº†æœ€æ–°çš„ç¬¬iä½}</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSumTwoNoOverlap</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> firstLen, <span class="type">int</span> secondLen)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            nums[i] += nums[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span>[] arr1 = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">        <span class="type">int</span>[] arr2 = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">        arr1[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        arr2[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            arr1[i] = firstLen&gt;i?nums[i]: Math.max(nums[i] - nums[i - firstLen],arr1[i - <span class="number">1</span>]);</span><br><span class="line">            arr2[i] = secondLen&gt;i?nums[i]: Math.max(nums[i] - nums[i - secondLen],arr2[i - <span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">if</span> (firstLen + secondLen &gt; i)&#123;</span><br><span class="line">                res = nums[i];</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                res = Math.max(res, nums[i] - nums[i - firstLen] + arr2[i - firstLen]);</span><br><span class="line">                res = Math.max(res, nums[i] - nums[i - secondLen] + arr1[i - secondLen]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul><p>**1606è‡ªå·±åšçš„è¶…æ—¶äº†ï¼Œç­”æ¡ˆçš„æ•°æ®ç»“æ„æœ‰ç‚¹å¤æ‚ï¼Œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™æœ‰ç©ºå†çœ‹çœ‹ï½</p><p>**2151 äºŒè¿›åˆ¶æšä¸¾ï¼Œæœ‰ç©ºæ¥å¤ç›˜ï¼</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
